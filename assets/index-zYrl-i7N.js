var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=e=>{let n={};for(var r in e)t(n,r,{get:e[r],enumerable:!0});return n},c=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},l=(n,r,a)=>(a=n==null?{}:e(i(n)),c(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var u=o((e=>{var t=Symbol.for(`react.transitional.element`),n=Symbol.for(`react.portal`),r=Symbol.for(`react.fragment`),i=Symbol.for(`react.strict_mode`),a=Symbol.for(`react.profiler`),o=Symbol.for(`react.consumer`),s=Symbol.for(`react.context`),c=Symbol.for(`react.forward_ref`),l=Symbol.for(`react.suspense`),u=Symbol.for(`react.memo`),d=Symbol.for(`react.lazy`),f=Symbol.for(`react.activity`),p=Symbol.iterator;function m(e){return typeof e!=`object`||!e?null:(e=p&&e[p]||e[`@@iterator`],typeof e==`function`?e:null)}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,_={};function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||h}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if(typeof e!=`object`&&typeof e!=`function`&&e!=null)throw Error(`takes an object of state variables to update or a function which returns an object of state variables.`);this.updater.enqueueSetState(this,e,t,`setState`)},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,`forceUpdate`)};function y(){}y.prototype=v.prototype;function b(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||h}var x=b.prototype=new y;x.constructor=b,g(x,v.prototype),x.isPureReactComponent=!0;var S=Array.isArray;function C(){}var w={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function E(e,n,r){var i=r.ref;return{$$typeof:t,type:e,key:n,ref:i===void 0?null:i,props:r}}function D(e,t){return E(e.type,t,e.props)}function O(e){return typeof e==`object`&&!!e&&e.$$typeof===t}function k(e){var t={"=":`=0`,":":`=2`};return`$`+e.replace(/[=:]/g,function(e){return t[e]})}var A=/\/+/g;function j(e,t){return typeof e==`object`&&e&&e.key!=null?k(``+e.key):t.toString(36)}function M(e){switch(e.status){case`fulfilled`:return e.value;case`rejected`:throw e.reason;default:switch(typeof e.status==`string`?e.then(C,C):(e.status=`pending`,e.then(function(t){e.status===`pending`&&(e.status=`fulfilled`,e.value=t)},function(t){e.status===`pending`&&(e.status=`rejected`,e.reason=t)})),e.status){case`fulfilled`:return e.value;case`rejected`:throw e.reason}}throw e}function N(e,r,i,a,o){var s=typeof e;(s===`undefined`||s===`boolean`)&&(e=null);var c=!1;if(e===null)c=!0;else switch(s){case`bigint`:case`string`:case`number`:c=!0;break;case`object`:switch(e.$$typeof){case t:case n:c=!0;break;case d:return c=e._init,N(c(e._payload),r,i,a,o)}}if(c)return o=o(e),c=a===``?`.`+j(e,0):a,S(o)?(i=``,c!=null&&(i=c.replace(A,`$&/`)+`/`),N(o,r,i,``,function(e){return e})):o!=null&&(O(o)&&(o=D(o,i+(o.key==null||e&&e.key===o.key?``:(``+o.key).replace(A,`$&/`)+`/`)+c)),r.push(o)),1;c=0;var l=a===``?`.`:a+`:`;if(S(e))for(var u=0;u<e.length;u++)a=e[u],s=l+j(a,u),c+=N(a,r,i,s,o);else if(u=m(e),typeof u==`function`)for(e=u.call(e),u=0;!(a=e.next()).done;)a=a.value,s=l+j(a,u++),c+=N(a,r,i,s,o);else if(s===`object`){if(typeof e.then==`function`)return N(M(e),r,i,a,o);throw r=String(e),Error(`Objects are not valid as a React child (found: `+(r===`[object Object]`?`object with keys {`+Object.keys(e).join(`, `)+`}`:r)+`). If you meant to render a collection of children, use an array instead.`)}return c}function ee(e,t,n){if(e==null)return e;var r=[],i=0;return N(e,r,``,``,function(e){return t.call(n,e,i++)}),r}function te(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(t){(e._status===0||e._status===-1)&&(e._status=1,e._result=t)},function(t){(e._status===0||e._status===-1)&&(e._status=2,e._result=t)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var P=typeof reportError==`function`?reportError:function(e){if(typeof window==`object`&&typeof window.ErrorEvent==`function`){var t=new window.ErrorEvent(`error`,{bubbles:!0,cancelable:!0,message:typeof e==`object`&&e&&typeof e.message==`string`?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process==`object`&&typeof process.emit==`function`){process.emit(`uncaughtException`,e);return}console.error(e)},ne={map:ee,forEach:function(e,t,n){ee(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ee(e,function(){t++}),t},toArray:function(e){return ee(e,function(e){return e})||[]},only:function(e){if(!O(e))throw Error(`React.Children.only expected to receive a single React element child.`);return e}};e.Activity=f,e.Children=ne,e.Component=v,e.Fragment=r,e.Profiler=a,e.PureComponent=b,e.StrictMode=i,e.Suspense=l,e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,e.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},e.cache=function(e){return function(){return e.apply(null,arguments)}},e.cacheSignal=function(){return null},e.cloneElement=function(e,t,n){if(e==null)throw Error(`The argument must be a React element, but you passed `+e+`.`);var r=g({},e.props),i=e.key;if(t!=null)for(a in t.key!==void 0&&(i=``+t.key),t)!T.call(t,a)||a===`key`||a===`__self`||a===`__source`||a===`ref`&&t.ref===void 0||(r[a]=t[a]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];r.children=o}return E(e.type,i,r)},e.createContext=function(e){return e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:o,_context:e},e},e.createElement=function(e,t,n){var r,i={},a=null;if(t!=null)for(r in t.key!==void 0&&(a=``+t.key),t)T.call(t,r)&&r!==`key`&&r!==`__self`&&r!==`__source`&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var s=Array(o),c=0;c<o;c++)s[c]=arguments[c+2];i.children=s}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return E(e,a,i)},e.createRef=function(){return{current:null}},e.forwardRef=function(e){return{$$typeof:c,render:e}},e.isValidElement=O,e.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:te}},e.memo=function(e,t){return{$$typeof:u,type:e,compare:t===void 0?null:t}},e.startTransition=function(e){var t=w.T,n={};w.T=n;try{var r=e(),i=w.S;i!==null&&i(n,r),typeof r==`object`&&r&&typeof r.then==`function`&&r.then(C,P)}catch(e){P(e)}finally{t!==null&&n.types!==null&&(t.types=n.types),w.T=t}},e.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},e.use=function(e){return w.H.use(e)},e.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},e.useCallback=function(e,t){return w.H.useCallback(e,t)},e.useContext=function(e){return w.H.useContext(e)},e.useDebugValue=function(){},e.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},e.useEffect=function(e,t){return w.H.useEffect(e,t)},e.useEffectEvent=function(e){return w.H.useEffectEvent(e)},e.useId=function(){return w.H.useId()},e.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},e.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},e.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},e.useMemo=function(e,t){return w.H.useMemo(e,t)},e.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},e.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},e.useRef=function(e){return w.H.useRef(e)},e.useState=function(e){return w.H.useState(e)},e.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},e.useTransition=function(){return w.H.useTransition()},e.version=`19.2.1`})),d=o(((e,t)=>{t.exports=u()})),f=o((e=>{function t(e,t){var n=e.length;e.push(t);a:for(;0<n;){var r=n-1>>>1,a=e[r];if(0<i(a,t))e[r]=t,e[n]=a,n=r;else break a}}function n(e){return e.length===0?null:e[0]}function r(e){if(e.length===0)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;a:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>i(c,n))l<a&&0>i(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else if(l<a&&0>i(u,n))e[r]=u,e[l]=n,r=l;else break a}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return n===0?e.id-t.id:n}if(e.unstable_now=void 0,typeof performance==`object`&&typeof performance.now==`function`){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var c=[],l=[],u=1,d=null,f=3,p=!1,m=!1,h=!1,g=!1,_=typeof setTimeout==`function`?setTimeout:null,v=typeof clearTimeout==`function`?clearTimeout:null,y=typeof setImmediate<`u`?setImmediate:null;function b(e){for(var i=n(l);i!==null;){if(i.callback===null)r(l);else if(i.startTime<=e)r(l),i.sortIndex=i.expirationTime,t(c,i);else break;i=n(l)}}function x(e){if(h=!1,b(e),!m)if(n(c)!==null)m=!0,S||(S=!0,O());else{var t=n(l);t!==null&&j(x,t.startTime-e)}}var S=!1,C=-1,w=5,T=-1;function E(){return g?!0:!(e.unstable_now()-T<w)}function D(){if(g=!1,S){var t=e.unstable_now();T=t;var i=!0;try{a:{m=!1,h&&(h=!1,v(C),C=-1),p=!0;var a=f;try{b:{for(b(t),d=n(c);d!==null&&!(d.expirationTime>t&&E());){var o=d.callback;if(typeof o==`function`){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=e.unstable_now(),typeof s==`function`){d.callback=s,b(t),i=!0;break b}d===n(c)&&r(c),b(t)}else r(c);d=n(c)}if(d!==null)i=!0;else{var u=n(l);u!==null&&j(x,u.startTime-t),i=!1}}break a}finally{d=null,f=a,p=!1}i=void 0}}finally{i?O():S=!1}}}var O;if(typeof y==`function`)O=function(){y(D)};else if(typeof MessageChannel<`u`){var k=new MessageChannel,A=k.port2;k.port1.onmessage=D,O=function(){A.postMessage(null)}}else O=function(){_(D,0)};function j(t,n){C=_(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error(`forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported`):w=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_requestPaint=function(){g=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(typeof a==`object`&&a?(a=a.delay,a=typeof a==`number`&&0<a?o+a:o):a=o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return s=a+s,r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s,sortIndex:-1},a>o?(r.sortIndex=a,t(l,r),n(c)===null&&r===n(l)&&(h?(v(C),C=-1):h=!0,j(x,a-o))):(r.sortIndex=s,t(c,r),m||p||(m=!0,S||(S=!0,O()))),r},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}})),p=o(((e,t)=>{t.exports=f()})),m=o((e=>{var t=d();function n(e){var t=`https://react.dev/errors/`+e;if(1<arguments.length){t+=`?args[]=`+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+=`&args[]=`+encodeURIComponent(arguments[n])}return`Minified React error #`+e+`; visit `+t+` for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`}function r(){}var i={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},a=Symbol.for(`react.portal`);function o(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:r==null?null:``+r,children:e,containerInfo:t,implementation:n}}var s=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){if(e===`font`)return``;if(typeof t==`string`)return t===`use-credentials`?t:``}e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,e.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)throw Error(n(299));return o(e,t,null,r)},e.flushSync=function(e){var t=s.T,n=i.p;try{if(s.T=null,i.p=2,e)return e()}finally{s.T=t,i.p=n,i.d.f()}},e.preconnect=function(e,t){typeof e==`string`&&(t?(t=t.crossOrigin,t=typeof t==`string`?t===`use-credentials`?t:``:void 0):t=null,i.d.C(e,t))},e.prefetchDNS=function(e){typeof e==`string`&&i.d.D(e)},e.preinit=function(e,t){if(typeof e==`string`&&t&&typeof t.as==`string`){var n=t.as,r=c(n,t.crossOrigin),a=typeof t.integrity==`string`?t.integrity:void 0,o=typeof t.fetchPriority==`string`?t.fetchPriority:void 0;n===`style`?i.d.S(e,typeof t.precedence==`string`?t.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:o}):n===`script`&&i.d.X(e,{crossOrigin:r,integrity:a,fetchPriority:o,nonce:typeof t.nonce==`string`?t.nonce:void 0})}},e.preinitModule=function(e,t){if(typeof e==`string`)if(typeof t==`object`&&t){if(t.as==null||t.as===`script`){var n=c(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:typeof t.integrity==`string`?t.integrity:void 0,nonce:typeof t.nonce==`string`?t.nonce:void 0})}}else t??i.d.M(e)},e.preload=function(e,t){if(typeof e==`string`&&typeof t==`object`&&t&&typeof t.as==`string`){var n=t.as,r=c(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:typeof t.integrity==`string`?t.integrity:void 0,nonce:typeof t.nonce==`string`?t.nonce:void 0,type:typeof t.type==`string`?t.type:void 0,fetchPriority:typeof t.fetchPriority==`string`?t.fetchPriority:void 0,referrerPolicy:typeof t.referrerPolicy==`string`?t.referrerPolicy:void 0,imageSrcSet:typeof t.imageSrcSet==`string`?t.imageSrcSet:void 0,imageSizes:typeof t.imageSizes==`string`?t.imageSizes:void 0,media:typeof t.media==`string`?t.media:void 0})}},e.preloadModule=function(e,t){if(typeof e==`string`)if(t){var n=c(t.as,t.crossOrigin);i.d.m(e,{as:typeof t.as==`string`&&t.as!==`script`?t.as:void 0,crossOrigin:n,integrity:typeof t.integrity==`string`?t.integrity:void 0})}else i.d.m(e)},e.requestFormReset=function(e){i.d.r(e)},e.unstable_batchedUpdates=function(e,t){return e(t)},e.useFormState=function(e,t,n){return s.H.useFormState(e,t,n)},e.useFormStatus=function(){return s.H.useHostTransitionStatus()},e.version=`19.2.1`})),h=o(((e,t)=>{function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>`u`||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=`function`))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),t.exports=m()})),g=o((e=>{var t=p(),n=d(),r=h();function i(e){var t=`https://react.dev/errors/`+e;if(1<arguments.length){t+=`?args[]=`+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+=`&args[]=`+encodeURIComponent(arguments[n])}return`Minified React error #`+e+`; visit `+t+` for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`}function a(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function o(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function s(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function c(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function l(e){if(o(e)!==e)throw Error(i(188))}function u(e){var t=e.alternate;if(!t){if(t=o(e),t===null)throw Error(i(188));return t===e?e:null}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var s=a.alternate;if(s===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return l(a),e;if(s===r)return l(a),t;s=s.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=s;else{for(var c=!1,u=a.child;u;){if(u===n){c=!0,n=a,r=s;break}if(u===r){c=!0,r=a,n=s;break}u=u.sibling}if(!c){for(u=s.child;u;){if(u===n){c=!0,n=s,r=a;break}if(u===r){c=!0,r=s,n=a;break}u=u.sibling}if(!c)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(n.tag!==3)throw Error(i(188));return n.stateNode.current===n?e:t}function f(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=f(e),t!==null)return t;e=e.sibling}return null}var m=Object.assign,g=Symbol.for(`react.element`),_=Symbol.for(`react.transitional.element`),v=Symbol.for(`react.portal`),y=Symbol.for(`react.fragment`),b=Symbol.for(`react.strict_mode`),x=Symbol.for(`react.profiler`),S=Symbol.for(`react.consumer`),C=Symbol.for(`react.context`),w=Symbol.for(`react.forward_ref`),T=Symbol.for(`react.suspense`),E=Symbol.for(`react.suspense_list`),D=Symbol.for(`react.memo`),O=Symbol.for(`react.lazy`),k=Symbol.for(`react.activity`),A=Symbol.for(`react.memo_cache_sentinel`),j=Symbol.iterator;function M(e){return typeof e!=`object`||!e?null:(e=j&&e[j]||e[`@@iterator`],typeof e==`function`?e:null)}var N=Symbol.for(`react.client.reference`);function ee(e){if(e==null)return null;if(typeof e==`function`)return e.$$typeof===N?null:e.displayName||e.name||null;if(typeof e==`string`)return e;switch(e){case y:return`Fragment`;case x:return`Profiler`;case b:return`StrictMode`;case T:return`Suspense`;case E:return`SuspenseList`;case k:return`Activity`}if(typeof e==`object`)switch(e.$$typeof){case v:return`Portal`;case C:return e.displayName||`Context`;case S:return(e._context.displayName||`Context`)+`.Consumer`;case w:var t=e.render;return e=e.displayName,e||=(e=t.displayName||t.name||``,e===``?`ForwardRef`:`ForwardRef(`+e+`)`),e;case D:return t=e.displayName||null,t===null?ee(e.type)||`Memo`:t;case O:t=e._payload,e=e._init;try{return ee(e(t))}catch{}}return null}var te=Array.isArray,P=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},ie=[],ae=-1;function oe(e){return{current:e}}function se(e){0>ae||(e.current=ie[ae],ie[ae]=null,ae--)}function ce(e,t){ae++,ie[ae]=e.current,e.current=t}var le=oe(null),ue=oe(null),de=oe(null),fe=oe(null);function pe(e,t){switch(ce(de,t),ce(ue,e),ce(le,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Zd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=Zd(t),e=Qd(t,e);else switch(e){case`svg`:e=1;break;case`math`:e=2;break;default:e=0}}se(le),ce(le,e)}function me(){se(le),se(ue),se(de)}function he(e){e.memoizedState!==null&&ce(fe,e);var t=le.current,n=Qd(t,e.type);t!==n&&(ce(ue,e),ce(le,n))}function ge(e){ue.current===e&&(se(le),se(ue)),fe.current===e&&(se(fe),np._currentValue=re)}var _e,ve;function ye(e){if(_e===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);_e=t&&t[1]||``,ve=-1<e.stack.indexOf(`
    at`)?` (<anonymous>)`:-1<e.stack.indexOf(`@`)?`@unknown:0:0`:``}return`
`+_e+e+ve}var be=!1;function xe(e,t){if(!e||be)return``;be=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,`props`,{set:function(){throw Error()}}),typeof Reflect==`object`&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){r=e}(n=e())&&typeof n.catch==`function`&&n.catch(function(){})}}catch(e){if(e&&r&&typeof e.stack==`string`)return[e.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName=`DetermineComponentFrameRoot`;var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,`name`);i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,`name`,{value:`DetermineComponentFrameRoot`});var a=r.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var c=o.split(`
`),l=s.split(`
`);for(i=r=0;r<c.length&&!c[r].includes(`DetermineComponentFrameRoot`);)r++;for(;i<l.length&&!l[i].includes(`DetermineComponentFrameRoot`);)i++;if(r===c.length||i===l.length)for(r=c.length-1,i=l.length-1;1<=r&&0<=i&&c[r]!==l[i];)i--;for(;1<=r&&0<=i;r--,i--)if(c[r]!==l[i]){if(r!==1||i!==1)do if(r--,i--,0>i||c[r]!==l[i]){var u=`
`+c[r].replace(` at new `,` at `);return e.displayName&&u.includes(`<anonymous>`)&&(u=u.replace(`<anonymous>`,e.displayName)),u}while(1<=r&&0<=i);break}}}finally{be=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:``)?ye(n):``}function Se(e,t){switch(e.tag){case 26:case 27:case 5:return ye(e.type);case 16:return ye(`Lazy`);case 13:return e.child!==t&&t!==null?ye(`Suspense Fallback`):ye(`Suspense`);case 19:return ye(`SuspenseList`);case 0:case 15:return xe(e.type,!1);case 11:return xe(e.type.render,!1);case 1:return xe(e.type,!0);case 31:return ye(`Activity`);default:return``}}function Ce(e){try{var t=``,n=null;do t+=Se(e,n),n=e,e=e.return;while(e);return t}catch(e){return`
Error generating stack: `+e.message+`
`+e.stack}}var we=Object.prototype.hasOwnProperty,Te=t.unstable_scheduleCallback,Ee=t.unstable_cancelCallback,De=t.unstable_shouldYield,Oe=t.unstable_requestPaint,ke=t.unstable_now,Ae=t.unstable_getCurrentPriorityLevel,je=t.unstable_ImmediatePriority,Me=t.unstable_UserBlockingPriority,Ne=t.unstable_NormalPriority,Pe=t.unstable_LowPriority,Fe=t.unstable_IdlePriority,Ie=t.log,Le=t.unstable_setDisableYieldValue,Re=null,ze=null;function Be(e){if(typeof Ie==`function`&&Le(e),ze&&typeof ze.setStrictMode==`function`)try{ze.setStrictMode(Re,e)}catch{}}var Ve=Math.clz32?Math.clz32:We,He=Math.log,Ue=Math.LN2;function We(e){return e>>>=0,e===0?32:31-(He(e)/Ue|0)|0}var Ge=256,Ke=262144,qe=4194304;function Je(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ye(e,t,n){var r=e.pendingLanes;if(r===0)return 0;var i=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=r&134217727;return s===0?(s=r&~a,s===0?o===0?n||(n=r&~e,n!==0&&(i=Je(n))):i=Je(o):i=Je(s)):(r=s&~a,r===0?(o&=s,o===0?n||(n=s&~e,n!==0&&(i=Je(n))):i=Je(o)):i=Je(r)),i===0?0:t!==0&&t!==i&&(t&a)===0&&(a=i&-i,n=t&-t,a>=n||a===32&&n&4194048)?t:i}function Xe(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function F(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ze(){var e=qe;return qe<<=1,!(qe&62914560)&&(qe=4194304),e}function Qe(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function $e(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function et(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-Ve(n),d=1<<u;s[u]=0,c[u]=-1;var f=l[u];if(f!==null)for(l[u]=null,u=0;u<f.length;u++){var p=f[u];p!==null&&(p.lane&=-536870913)}n&=~d}r!==0&&tt(e,r,0),a!==0&&i===0&&e.tag!==0&&(e.suspendedLanes|=a&~(o&~t))}function tt(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Ve(t);e.entangledLanes|=t,e.entanglements[r]=e.entanglements[r]|1073741824|n&261930}function nt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Ve(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function rt(e,t){var n=t&-t;return n=n&42?1:it(n),(n&(e.suspendedLanes|t))===0?n:0}function it(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function at(e){return e&=-e,2<e?8<e?e&134217727?32:268435456:8:2}function ot(){var e=ne.p;return e===0?(e=window.event,e===void 0?32:vp(e.type)):e}function st(e,t){var n=ne.p;try{return ne.p=e,t()}finally{ne.p=n}}var ct=Math.random().toString(36).slice(2),lt=`__reactFiber$`+ct,ut=`__reactProps$`+ct,dt=`__reactContainer$`+ct,ft=`__reactEvents$`+ct,pt=`__reactListeners$`+ct,mt=`__reactHandles$`+ct,ht=`__reactResources$`+ct,gt=`__reactMarker$`+ct;function _t(e){delete e[lt],delete e[ut],delete e[ft],delete e[pt],delete e[mt]}function vt(e){var t=e[lt];if(t)return t;for(var n=e.parentNode;n;){if(t=n[dt]||n[lt]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=yf(e);e!==null;){if(n=e[lt])return n;e=yf(e)}return t}e=n,n=e.parentNode}return null}function yt(e){if(e=e[lt]||e[dt]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function bt(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function xt(e){var t=e[ht];return t||=e[ht]={hoistableStyles:new Map,hoistableScripts:new Map},t}function St(e){e[gt]=!0}var Ct=new Set,wt={};function Tt(e,t){Et(e,t),Et(e+`Capture`,t)}function Et(e,t){for(wt[e]=t,e=0;e<t.length;e++)Ct.add(t[e])}var Dt=RegExp(`^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$`),Ot={},kt={};function At(e){return we.call(kt,e)?!0:we.call(Ot,e)?!1:Dt.test(e)?kt[e]=!0:(Ot[e]=!0,!1)}function jt(e,t,n){if(At(t))if(n===null)e.removeAttribute(t);else{switch(typeof n){case`undefined`:case`function`:case`symbol`:e.removeAttribute(t);return;case`boolean`:var r=t.toLowerCase().slice(0,5);if(r!==`data-`&&r!==`aria-`){e.removeAttribute(t);return}}e.setAttribute(t,``+n)}}function Mt(e,t,n){if(n===null)e.removeAttribute(t);else{switch(typeof n){case`undefined`:case`function`:case`symbol`:case`boolean`:e.removeAttribute(t);return}e.setAttribute(t,``+n)}}function Nt(e,t,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case`undefined`:case`function`:case`symbol`:case`boolean`:e.removeAttribute(n);return}e.setAttributeNS(t,n,``+r)}}function Pt(e){switch(typeof e){case`bigint`:case`boolean`:case`number`:case`string`:case`undefined`:return e;case`object`:return e;default:return``}}function Ft(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()===`input`&&(t===`checkbox`||t===`radio`)}function It(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&r!==void 0&&typeof r.get==`function`&&typeof r.set==`function`){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=``+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=``+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Lt(e){if(!e._valueTracker){var t=Ft(e)?`checked`:`value`;e._valueTracker=It(e,t,``+e[t])}}function Rt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=``;return e&&(r=Ft(e)?e.checked?`true`:`false`:e.value),e=r,e===n?!1:(t.setValue(e),!0)}function zt(e){if(e||=typeof document<`u`?document:void 0,e===void 0)return null;try{return e.activeElement||e.body}catch{return e.body}}var Bt=/[\n"\\]/g;function Vt(e){return e.replace(Bt,function(e){return`\\`+e.charCodeAt(0).toString(16)+` `})}function Ht(e,t,n,r,i,a,o,s){e.name=``,o!=null&&typeof o!=`function`&&typeof o!=`symbol`&&typeof o!=`boolean`?e.type=o:e.removeAttribute(`type`),t==null?o!==`submit`&&o!==`reset`||e.removeAttribute(`value`):o===`number`?(t===0&&e.value===``||e.value!=t)&&(e.value=``+Pt(t)):e.value!==``+Pt(t)&&(e.value=``+Pt(t)),t==null?n==null?r!=null&&e.removeAttribute(`value`):Wt(e,o,Pt(n)):Wt(e,o,Pt(t)),i==null&&a!=null&&(e.defaultChecked=!!a),i!=null&&(e.checked=i&&typeof i!=`function`&&typeof i!=`symbol`),s!=null&&typeof s!=`function`&&typeof s!=`symbol`&&typeof s!=`boolean`?e.name=``+Pt(s):e.removeAttribute(`name`)}function Ut(e,t,n,r,i,a,o,s){if(a!=null&&typeof a!=`function`&&typeof a!=`symbol`&&typeof a!=`boolean`&&(e.type=a),t!=null||n!=null){if(!(a!==`submit`&&a!==`reset`||t!=null)){Lt(e);return}n=n==null?``:``+Pt(n),t=t==null?n:``+Pt(t),s||t===e.value||(e.value=t),e.defaultValue=t}r??=i,r=typeof r!=`function`&&typeof r!=`symbol`&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,o!=null&&typeof o!=`function`&&typeof o!=`symbol`&&typeof o!=`boolean`&&(e.name=o),Lt(e)}function Wt(e,t,n){t===`number`&&zt(e.ownerDocument)===e||e.defaultValue===``+n||(e.defaultValue=``+n)}function Gt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[`$`+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(`$`+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=``+Pt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Kt(e,t,n){if(t!=null&&(t=``+Pt(t),t!==e.value&&(e.value=t),n==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=n==null?``:``+Pt(n)}function qt(e,t,n,r){if(t==null){if(r!=null){if(n!=null)throw Error(i(92));if(te(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}n??=``,t=n}n=Pt(t),e.defaultValue=n,r=e.textContent,r===n&&r!==``&&r!==null&&(e.value=r),Lt(e)}function Jt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Yt=new Set(`animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp`.split(` `));function Xt(e,t,n){var r=t.indexOf(`--`)===0;n==null||typeof n==`boolean`||n===``?r?e.setProperty(t,``):t===`float`?e.cssFloat=``:e[t]=``:r?e.setProperty(t,n):typeof n!=`number`||n===0||Yt.has(t)?t===`float`?e.cssFloat=n:e[t]=(``+n).trim():e[t]=n+`px`}function Zt(e,t,n){if(t!=null&&typeof t!=`object`)throw Error(i(62));if(e=e.style,n!=null){for(var r in n)!n.hasOwnProperty(r)||t!=null&&t.hasOwnProperty(r)||(r.indexOf(`--`)===0?e.setProperty(r,``):r===`float`?e.cssFloat=``:e[r]=``);for(var a in t)r=t[a],t.hasOwnProperty(a)&&n[a]!==r&&Xt(e,a,r)}else for(var o in t)t.hasOwnProperty(o)&&Xt(e,o,t[o])}function Qt(e){if(e.indexOf(`-`)===-1)return!1;switch(e){case`annotation-xml`:case`color-profile`:case`font-face`:case`font-face-src`:case`font-face-uri`:case`font-face-format`:case`font-face-name`:case`missing-glyph`:return!1;default:return!0}}var $t=new Map([[`acceptCharset`,`accept-charset`],[`htmlFor`,`for`],[`httpEquiv`,`http-equiv`],[`crossOrigin`,`crossorigin`],[`accentHeight`,`accent-height`],[`alignmentBaseline`,`alignment-baseline`],[`arabicForm`,`arabic-form`],[`baselineShift`,`baseline-shift`],[`capHeight`,`cap-height`],[`clipPath`,`clip-path`],[`clipRule`,`clip-rule`],[`colorInterpolation`,`color-interpolation`],[`colorInterpolationFilters`,`color-interpolation-filters`],[`colorProfile`,`color-profile`],[`colorRendering`,`color-rendering`],[`dominantBaseline`,`dominant-baseline`],[`enableBackground`,`enable-background`],[`fillOpacity`,`fill-opacity`],[`fillRule`,`fill-rule`],[`floodColor`,`flood-color`],[`floodOpacity`,`flood-opacity`],[`fontFamily`,`font-family`],[`fontSize`,`font-size`],[`fontSizeAdjust`,`font-size-adjust`],[`fontStretch`,`font-stretch`],[`fontStyle`,`font-style`],[`fontVariant`,`font-variant`],[`fontWeight`,`font-weight`],[`glyphName`,`glyph-name`],[`glyphOrientationHorizontal`,`glyph-orientation-horizontal`],[`glyphOrientationVertical`,`glyph-orientation-vertical`],[`horizAdvX`,`horiz-adv-x`],[`horizOriginX`,`horiz-origin-x`],[`imageRendering`,`image-rendering`],[`letterSpacing`,`letter-spacing`],[`lightingColor`,`lighting-color`],[`markerEnd`,`marker-end`],[`markerMid`,`marker-mid`],[`markerStart`,`marker-start`],[`overlinePosition`,`overline-position`],[`overlineThickness`,`overline-thickness`],[`paintOrder`,`paint-order`],[`panose-1`,`panose-1`],[`pointerEvents`,`pointer-events`],[`renderingIntent`,`rendering-intent`],[`shapeRendering`,`shape-rendering`],[`stopColor`,`stop-color`],[`stopOpacity`,`stop-opacity`],[`strikethroughPosition`,`strikethrough-position`],[`strikethroughThickness`,`strikethrough-thickness`],[`strokeDasharray`,`stroke-dasharray`],[`strokeDashoffset`,`stroke-dashoffset`],[`strokeLinecap`,`stroke-linecap`],[`strokeLinejoin`,`stroke-linejoin`],[`strokeMiterlimit`,`stroke-miterlimit`],[`strokeOpacity`,`stroke-opacity`],[`strokeWidth`,`stroke-width`],[`textAnchor`,`text-anchor`],[`textDecoration`,`text-decoration`],[`textRendering`,`text-rendering`],[`transformOrigin`,`transform-origin`],[`underlinePosition`,`underline-position`],[`underlineThickness`,`underline-thickness`],[`unicodeBidi`,`unicode-bidi`],[`unicodeRange`,`unicode-range`],[`unitsPerEm`,`units-per-em`],[`vAlphabetic`,`v-alphabetic`],[`vHanging`,`v-hanging`],[`vIdeographic`,`v-ideographic`],[`vMathematical`,`v-mathematical`],[`vectorEffect`,`vector-effect`],[`vertAdvY`,`vert-adv-y`],[`vertOriginX`,`vert-origin-x`],[`vertOriginY`,`vert-origin-y`],[`wordSpacing`,`word-spacing`],[`writingMode`,`writing-mode`],[`xmlnsXlink`,`xmlns:xlink`],[`xHeight`,`x-height`]]),en=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tn(e){return en.test(``+e)?`javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')`:e}function nn(){}var rn=null;function an(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var on=null,sn=null;function cn(e){var t=yt(e);if(t&&(e=t.stateNode)){var n=e[ut]||null;a:switch(e=t.stateNode,t.type){case`input`:if(Ht(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,n.type===`radio`&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(`input[name="`+Vt(``+t)+`"][type="radio"]`),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=r[ut]||null;if(!a)throw Error(i(90));Ht(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)r=n[t],r.form===e.form&&Rt(r)}break a;case`textarea`:Kt(e,n.value,n.defaultValue);break a;case`select`:t=n.value,t!=null&&Gt(e,!!n.multiple,t,!1)}}}var ln=!1;function un(e,t,n){if(ln)return e(t,n);ln=!0;try{return e(t)}finally{if(ln=!1,(on!==null||sn!==null)&&(ju(),on&&(t=on,e=sn,sn=on=null,cn(t),e)))for(t=0;t<e.length;t++)cn(e[t])}}function dn(e,t){var n=e.stateNode;if(n===null)return null;var r=n[ut]||null;if(r===null)return null;n=r[t];a:switch(t){case`onClick`:case`onClickCapture`:case`onDoubleClick`:case`onDoubleClickCapture`:case`onMouseDown`:case`onMouseDownCapture`:case`onMouseMove`:case`onMouseMoveCapture`:case`onMouseUp`:case`onMouseUpCapture`:case`onMouseEnter`:(r=!r.disabled)||(e=e.type,r=!(e===`button`||e===`input`||e===`select`||e===`textarea`)),e=!r;break a;default:e=!1}if(e)return null;if(n&&typeof n!=`function`)throw Error(i(231,t,typeof n));return n}var fn=!(typeof window>`u`||window.document===void 0||window.document.createElement===void 0),pn=!1;if(fn)try{var mn={};Object.defineProperty(mn,`passive`,{get:function(){pn=!0}}),window.addEventListener(`test`,mn,mn),window.removeEventListener(`test`,mn,mn)}catch{pn=!1}var hn=null,gn=null,_n=null;function vn(){if(_n)return _n;var e,t=gn,n=t.length,r,i=`value`in hn?hn.value:hn.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return _n=i.slice(e,1<r?1-r:void 0)}function yn(e){var t=e.keyCode;return`charCode`in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bn(){return!0}function xn(){return!1}function Sn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented==null?!1===i.returnValue:i.defaultPrevented)?bn:xn,this.isPropagationStopped=xn,this}return m(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!=`unknown`&&(e.returnValue=!1),this.isDefaultPrevented=bn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!=`unknown`&&(e.cancelBubble=!0),this.isPropagationStopped=bn)},persist:function(){},isPersistent:bn}),t}var Cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wn=Sn(Cn),Tn=m({},Cn,{view:0,detail:0}),En=Sn(Tn),Dn,On,kn,An=m({},Tn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bn,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return`movementX`in e?e.movementX:(e!==kn&&(kn&&e.type===`mousemove`?(Dn=e.screenX-kn.screenX,On=e.screenY-kn.screenY):On=Dn=0,kn=e),Dn)},movementY:function(e){return`movementY`in e?e.movementY:On}}),jn=Sn(An),Mn=Sn(m({},An,{dataTransfer:0})),Nn=Sn(m({},Tn,{relatedTarget:0})),eee=Sn(m({},Cn,{animationName:0,elapsedTime:0,pseudoElement:0})),Pn=Sn(m({},Cn,{clipboardData:function(e){return`clipboardData`in e?e.clipboardData:window.clipboardData}})),Fn=Sn(m({},Cn,{data:0})),In={Esc:`Escape`,Spacebar:` `,Left:`ArrowLeft`,Up:`ArrowUp`,Right:`ArrowRight`,Down:`ArrowDown`,Del:`Delete`,Win:`OS`,Menu:`ContextMenu`,Apps:`ContextMenu`,Scroll:`ScrollLock`,MozPrintableKey:`Unidentified`},Ln={8:`Backspace`,9:`Tab`,12:`Clear`,13:`Enter`,16:`Shift`,17:`Control`,18:`Alt`,19:`Pause`,20:`CapsLock`,27:`Escape`,32:` `,33:`PageUp`,34:`PageDown`,35:`End`,36:`Home`,37:`ArrowLeft`,38:`ArrowUp`,39:`ArrowRight`,40:`ArrowDown`,45:`Insert`,46:`Delete`,112:`F1`,113:`F2`,114:`F3`,115:`F4`,116:`F5`,117:`F6`,118:`F7`,119:`F8`,120:`F9`,121:`F10`,122:`F11`,123:`F12`,144:`NumLock`,145:`ScrollLock`,224:`Meta`},Rn={Alt:`altKey`,Control:`ctrlKey`,Meta:`metaKey`,Shift:`shiftKey`};function zn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Rn[e])?!!t[e]:!1}function Bn(){return zn}var Vn=Sn(m({},Tn,{key:function(e){if(e.key){var t=In[e.key]||e.key;if(t!==`Unidentified`)return t}return e.type===`keypress`?(e=yn(e),e===13?`Enter`:String.fromCharCode(e)):e.type===`keydown`||e.type===`keyup`?Ln[e.keyCode]||`Unidentified`:``},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bn,charCode:function(e){return e.type===`keypress`?yn(e):0},keyCode:function(e){return e.type===`keydown`||e.type===`keyup`?e.keyCode:0},which:function(e){return e.type===`keypress`?yn(e):e.type===`keydown`||e.type===`keyup`?e.keyCode:0}})),Hn=Sn(m({},An,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Un=Sn(m({},Tn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bn})),Wn=Sn(m({},Cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Gn=Sn(m({},An,{deltaX:function(e){return`deltaX`in e?e.deltaX:`wheelDeltaX`in e?-e.wheelDeltaX:0},deltaY:function(e){return`deltaY`in e?e.deltaY:`wheelDeltaY`in e?-e.wheelDeltaY:`wheelDelta`in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Kn=Sn(m({},Cn,{newState:0,oldState:0})),qn=[9,13,27,32],Jn=fn&&`CompositionEvent`in window,Yn=null;fn&&`documentMode`in document&&(Yn=document.documentMode);var Xn=fn&&`TextEvent`in window&&!Yn,Zn=fn&&(!Jn||Yn&&8<Yn&&11>=Yn),Qn=` `,$n=!1;function er(e,t){switch(e){case`keyup`:return qn.indexOf(t.keyCode)!==-1;case`keydown`:return t.keyCode!==229;case`keypress`:case`mousedown`:case`focusout`:return!0;default:return!1}}function tr(e){return e=e.detail,typeof e==`object`&&`data`in e?e.data:null}var nr=!1;function rr(e,t){switch(e){case`compositionend`:return tr(t);case`keypress`:return t.which===32?($n=!0,Qn):null;case`textInput`:return e=t.data,e===Qn&&$n?null:e;default:return null}}function ir(e,t){if(nr)return e===`compositionend`||!Jn&&er(e,t)?(e=vn(),_n=gn=hn=null,nr=!1,e):null;switch(e){case`paste`:return null;case`keypress`:if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case`compositionend`:return Zn&&t.locale!==`ko`?null:t.data;default:return null}}var ar={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function or(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t===`input`?!!ar[e.type]:t===`textarea`}function sr(e,t,n,r){on?sn?sn.push(r):sn=[r]:on=r,t=Fd(t,`onChange`),0<t.length&&(n=new wn(`onChange`,`change`,null,n,r),e.push({event:n,listeners:t}))}var cr=null,lr=null;function ur(e){Dd(e,0)}function dr(e){if(Rt(bt(e)))return e}function fr(e,t){if(e===`change`)return t}var pr=!1;if(fn){var mr;if(fn){var hr=`oninput`in document;if(!hr){var gr=document.createElement(`div`);gr.setAttribute(`oninput`,`return;`),hr=typeof gr.oninput==`function`}mr=hr}else mr=!1;pr=mr&&(!document.documentMode||9<document.documentMode)}function _r(){cr&&(cr.detachEvent(`onpropertychange`,vr),lr=cr=null)}function vr(e){if(e.propertyName===`value`&&dr(lr)){var t=[];sr(t,lr,e,an(e)),un(ur,t)}}function yr(e,t,n){e===`focusin`?(_r(),cr=t,lr=n,cr.attachEvent(`onpropertychange`,vr)):e===`focusout`&&_r()}function br(e){if(e===`selectionchange`||e===`keyup`||e===`keydown`)return dr(lr)}function xr(e,t){if(e===`click`)return dr(t)}function Sr(e,t){if(e===`input`||e===`change`)return dr(t)}function Cr(e,t){return e===t&&(e!==0||1/e==1/t)||e!==e&&t!==t}var wr=typeof Object.is==`function`?Object.is:Cr;function Tr(e,t){if(wr(e,t))return!0;if(typeof e!=`object`||!e||typeof t!=`object`||!t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!we.call(t,i)||!wr(e[i],t[i]))return!1}return!0}function Er(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Dr(e,t){var n=Er(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}a:{for(;n;){if(n.nextSibling){n=n.nextSibling;break a}n=n.parentNode}n=void 0}n=Er(n)}}function Or(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Or(e,t.parentNode):`contains`in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function kr(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=zt(e.document);t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href==`string`}catch{n=!1}if(n)e=t.contentWindow;else break;t=zt(e.document)}return t}function Ar(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t===`input`&&(e.type===`text`||e.type===`search`||e.type===`tel`||e.type===`url`||e.type===`password`)||t===`textarea`||e.contentEditable===`true`)}var jr=fn&&`documentMode`in document&&11>=document.documentMode,Mr=null,Nr=null,Pr=null,Fr=!1;function Ir(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Fr||Mr==null||Mr!==zt(r)||(r=Mr,`selectionStart`in r&&Ar(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Pr&&Tr(Pr,r)||(Pr=r,r=Fd(Nr,`onSelect`),0<r.length&&(t=new wn(`onSelect`,`select`,null,t,n),e.push({event:t,listeners:r}),t.target=Mr)))}function Lr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[`Webkit`+e]=`webkit`+t,n[`Moz`+e]=`moz`+t,n}var Rr={animationend:Lr(`Animation`,`AnimationEnd`),animationiteration:Lr(`Animation`,`AnimationIteration`),animationstart:Lr(`Animation`,`AnimationStart`),transitionrun:Lr(`Transition`,`TransitionRun`),transitionstart:Lr(`Transition`,`TransitionStart`),transitioncancel:Lr(`Transition`,`TransitionCancel`),transitionend:Lr(`Transition`,`TransitionEnd`)},zr={},Br={};fn&&(Br=document.createElement(`div`).style,`AnimationEvent`in window||(delete Rr.animationend.animation,delete Rr.animationiteration.animation,delete Rr.animationstart.animation),`TransitionEvent`in window||delete Rr.transitionend.transition);function Vr(e){if(zr[e])return zr[e];if(!Rr[e])return e;var t=Rr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Br)return zr[e]=t[n];return e}var Hr=Vr(`animationend`),Ur=Vr(`animationiteration`),Wr=Vr(`animationstart`),tee=Vr(`transitionrun`),Gr=Vr(`transitionstart`),Kr=Vr(`transitioncancel`),qr=Vr(`transitionend`),Jr=new Map,Yr=`abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel`.split(` `);Yr.push(`scrollEnd`);function Xr(e,t){Jr.set(e,t),Tt(t,[e])}var Zr=typeof reportError==`function`?reportError:function(e){if(typeof window==`object`&&typeof window.ErrorEvent==`function`){var t=new window.ErrorEvent(`error`,{bubbles:!0,cancelable:!0,message:typeof e==`object`&&e&&typeof e.message==`string`?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process==`object`&&typeof process.emit==`function`){process.emit(`uncaughtException`,e);return}console.error(e)},Qr=[],$r=0,ei=0;function ti(){for(var e=$r,t=ei=$r=0;t<e;){var n=Qr[t];Qr[t++]=null;var r=Qr[t];Qr[t++]=null;var i=Qr[t];Qr[t++]=null;var a=Qr[t];if(Qr[t++]=null,r!==null&&i!==null){var o=r.pending;o===null?i.next=i:(i.next=o.next,o.next=i),r.pending=i}a!==0&&ai(n,i,a)}}function ni(e,t,n,r){Qr[$r++]=e,Qr[$r++]=t,Qr[$r++]=n,Qr[$r++]=r,ei|=r,e.lanes|=r,e=e.alternate,e!==null&&(e.lanes|=r)}function ri(e,t,n,r){return ni(e,t,n,r),oi(e)}function ii(e,t){return ni(e,null,null,t),oi(e)}function ai(e,t,n){e.lanes|=n;var r=e.alternate;r!==null&&(r.lanes|=n);for(var i=!1,a=e.return;a!==null;)a.childLanes|=n,r=a.alternate,r!==null&&(r.childLanes|=n),a.tag===22&&(e=a.stateNode,e===null||e._visibility&1||(i=!0)),e=a,a=a.return;return e.tag===3?(a=e.stateNode,i&&t!==null&&(i=31-Ve(n),e=a.hiddenUpdates,r=e[i],r===null?e[i]=[t]:r.push(t),t.lane=n|536870912),a):null}function oi(e){if(50<Su)throw Su=0,Cu=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var si={};function ci(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function li(e,t,n,r){return new ci(e,t,n,r)}function ui(e){return e=e.prototype,!(!e||!e.isReactComponent)}function di(e,t){var n=e.alternate;return n===null?(n=li(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&65011712,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function fi(e,t){e.flags&=65011714;var n=e.alternate;return n===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function pi(e,t,n,r,a,o){var s=0;if(r=e,typeof e==`function`)ui(e)&&(s=1);else if(typeof e==`string`)s=qf(e,n,le.current)?26:e===`html`||e===`head`||e===`body`?27:5;else a:switch(e){case k:return e=li(31,n,t,a),e.elementType=k,e.lanes=o,e;case y:return mi(n.children,a,o,t);case b:s=8,a|=24;break;case x:return e=li(12,n,t,a|2),e.elementType=x,e.lanes=o,e;case T:return e=li(13,n,t,a),e.elementType=T,e.lanes=o,e;case E:return e=li(19,n,t,a),e.elementType=E,e.lanes=o,e;default:if(typeof e==`object`&&e)switch(e.$$typeof){case C:s=10;break a;case S:s=9;break a;case w:s=11;break a;case D:s=14;break a;case O:s=16,r=null;break a}s=29,n=Error(i(130,e===null?`null`:typeof e,``)),r=null}return t=li(s,n,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function mi(e,t,n,r){return e=li(7,e,r,t),e.lanes=n,e}function hi(e,t,n){return e=li(6,e,null,t),e.lanes=n,e}function gi(e){var t=li(18,null,null,0);return t.stateNode=e,t}function _i(e,t,n){return t=li(4,e.children===null?[]:e.children,e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var vi=new WeakMap;function yi(e,t){if(typeof e==`object`&&e){var n=vi.get(e);return n===void 0?(t={value:e,source:t,stack:Ce(t)},vi.set(e,t),t):n}return{value:e,source:t,stack:Ce(t)}}var bi=[],xi=0,Si=null,Ci=0,wi=[],Ti=0,Ei=null,Di=1,Oi=``;function ki(e,t){bi[xi++]=Ci,bi[xi++]=Si,Si=e,Ci=t}function Ai(e,t,n){wi[Ti++]=Di,wi[Ti++]=Oi,wi[Ti++]=Ei,Ei=e;var r=Di;e=Oi;var i=32-Ve(r)-1;r&=~(1<<i),n+=1;var a=32-Ve(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Di=1<<32-Ve(t)+i|n<<i|r,Oi=a+e}else Di=1<<a|n<<i|r,Oi=e}function ji(e){e.return!==null&&(ki(e,1),Ai(e,1,0))}function Mi(e){for(;e===Si;)Si=bi[--xi],bi[xi]=null,Ci=bi[--xi],bi[xi]=null;for(;e===Ei;)Ei=wi[--Ti],wi[Ti]=null,Oi=wi[--Ti],wi[Ti]=null,Di=wi[--Ti],wi[Ti]=null}function Ni(e,t){wi[Ti++]=Di,wi[Ti++]=Oi,wi[Ti++]=Ei,Di=t.id,Oi=t.overflow,Ei=e}var Pi=null,Fi=null,Ii=!1,Li=null,Ri=!1,zi=Error(i(519));function Bi(e){throw Ki(yi(Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?`text`:`HTML`,``)),e)),zi}function Vi(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[lt]=e,t[ut]=r,n){case`dialog`:Od(`cancel`,t),Od(`close`,t);break;case`iframe`:case`object`:case`embed`:Od(`load`,t);break;case`video`:case`audio`:for(n=0;n<Td.length;n++)Od(Td[n],t);break;case`source`:Od(`error`,t);break;case`img`:case`image`:case`link`:Od(`error`,t),Od(`load`,t);break;case`details`:Od(`toggle`,t);break;case`input`:Od(`invalid`,t),Ut(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case`select`:Od(`invalid`,t);break;case`textarea`:Od(`invalid`,t),qt(t,r.value,r.defaultValue,r.children)}n=r.children,typeof n!=`string`&&typeof n!=`number`&&typeof n!=`bigint`||t.textContent===``+n||!0===r.suppressHydrationWarning||Vd(t.textContent,n)?(r.popover!=null&&(Od(`beforetoggle`,t),Od(`toggle`,t)),r.onScroll!=null&&Od(`scroll`,t),r.onScrollEnd!=null&&Od(`scrollend`,t),r.onClick!=null&&(t.onclick=nn),t=!0):t=!1,t||Bi(e,!0)}function Hi(e){for(Pi=e.return;Pi;)switch(Pi.tag){case 5:case 31:case 13:Ri=!1;return;case 27:case 3:Ri=!0;return;default:Pi=Pi.return}}function Ui(e){if(e!==Pi)return!1;if(!Ii)return Hi(e),Ii=!0,!1;var t=e.tag,n;if((n=t!==3&&t!==27)&&((n=t===5)&&(n=e.type,n=!(n!==`form`&&n!==`button`)||$d(e.type,e.memoizedProps)),n=!n),n&&Fi&&Bi(e),Hi(e),t===13){if(e=e.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(317));Fi=vf(e)}else if(t===31){if(e=e.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(317));Fi=vf(e)}else t===27?(t=Fi,of(e.type)?(e=_f,_f=null,Fi=e):Fi=t):Fi=Pi?gf(e.stateNode.nextSibling):null;return!0}function Wi(){Fi=Pi=null,Ii=!1}function Gi(){var e=Li;return e!==null&&(cu===null?cu=e:cu.push.apply(cu,e),Li=null),e}function Ki(e){Li===null?Li=[e]:Li.push(e)}var qi=oe(null),Ji=null,Yi=null;function Xi(e,t,n){ce(qi,t._currentValue),t._currentValue=n}function Zi(e){e._currentValue=qi.current,se(qi)}function Qi(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)===t?r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t):(e.childLanes|=t,r!==null&&(r.childLanes|=t)),e===n)break;e=e.return}}function $i(e,t,n,r){var a=e.child;for(a!==null&&(a.return=e);a!==null;){var o=a.dependencies;if(o!==null){var s=a.child;o=o.firstContext;a:for(;o!==null;){var c=o;o=a;for(var l=0;l<t.length;l++)if(c.context===t[l]){o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Qi(o.return,n,e),r||(s=null);break a}o=c.next}}else if(a.tag===18){if(s=a.return,s===null)throw Error(i(341));s.lanes|=n,o=s.alternate,o!==null&&(o.lanes|=n),Qi(s,n,e),s=null}else s=a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===e){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}}function ea(e,t,n,r){e=null;for(var a=t,o=!1;a!==null;){if(!o){if(a.flags&524288)o=!0;else if(a.flags&262144)break}if(a.tag===10){var s=a.alternate;if(s===null)throw Error(i(387));if(s=s.memoizedProps,s!==null){var c=a.type;wr(a.pendingProps.value,s.value)||(e===null?e=[c]:e.push(c))}}else if(a===fe.current){if(s=a.alternate,s===null)throw Error(i(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(e===null?e=[np]:e.push(np))}a=a.return}e!==null&&$i(t,e,n,r),t.flags|=262144}function ta(e){for(e=e.firstContext;e!==null;){if(!wr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function na(e){Ji=e,Yi=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ra(e){return aa(Ji,e)}function ia(e,t){return Ji===null&&na(e),aa(e,t)}function aa(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},Yi===null){if(e===null)throw Error(i(308));Yi=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Yi=Yi.next=t;return n}var oa=typeof AbortController<`u`?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},sa=t.unstable_scheduleCallback,ca=t.unstable_NormalPriority,la={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ua(){return{controller:new oa,data:new Map,refCount:0}}function da(e){e.refCount--,e.refCount===0&&sa(ca,function(){e.controller.abort()})}var fa=null,pa=0,ma=0,ha=null;function ga(e,t){if(fa===null){var n=fa=[];pa=0,ma=yd(),ha={status:`pending`,value:void 0,then:function(e){n.push(e)}}}return pa++,t.then(_a,_a),t}function _a(){if(--pa===0&&fa!==null){ha!==null&&(ha.status=`fulfilled`);var e=fa;fa=null,ma=0,ha=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function va(e,t){var n=[],r={status:`pending`,value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status=`fulfilled`,r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status=`rejected`,r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}var ya=P.S;P.S=function(e,t){du=ke(),typeof t==`object`&&t&&typeof t.then==`function`&&ga(e,t),ya!==null&&ya(e,t)};var ba=oe(null);function xa(){var e=ba.current;return e===null?Kl.pooledCache:e}function Sa(e,t){t===null?ce(ba,ba.current):ce(ba,t.pool)}function Ca(){var e=xa();return e===null?null:{parent:la._currentValue,pool:e}}var wa=Error(i(460)),Ta=Error(i(474)),Ea=Error(i(542)),Da={then:function(){}};function Oa(e){return e=e.status,e===`fulfilled`||e===`rejected`}function ka(e,t,n){switch(n=e[n],n===void 0?e.push(t):n!==t&&(t.then(nn,nn),t=n),t.status){case`fulfilled`:return t.value;case`rejected`:throw e=t.reason,Na(e),e;default:if(typeof t.status==`string`)t.then(nn,nn);else{if(e=Kl,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status=`pending`,e.then(function(e){if(t.status===`pending`){var n=t;n.status=`fulfilled`,n.value=e}},function(e){if(t.status===`pending`){var n=t;n.status=`rejected`,n.reason=e}})}switch(t.status){case`fulfilled`:return t.value;case`rejected`:throw e=t.reason,Na(e),e}throw ja=t,wa}}function Aa(e){try{var t=e._init;return t(e._payload)}catch(e){throw typeof e==`object`&&e&&typeof e.then==`function`?(ja=e,wa):e}}var ja=null;function Ma(){if(ja===null)throw Error(i(459));var e=ja;return ja=null,e}function Na(e){if(e===wa||e===Ea)throw Error(i(483))}var Pa=null,Fa=0;function Ia(e){var t=Fa;return Fa+=1,Pa===null&&(Pa=[]),ka(Pa,e,t)}function La(e,t){t=t.props.ref,e.ref=t===void 0?null:t}function Ra(e,t){throw t.$$typeof===g?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e===`[object Object]`?`object with keys {`+Object.keys(t).join(`, `)+`}`:e)))}function za(e){function t(t,n){if(e){var r=t.deletions;r===null?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;r!==null;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;e!==null;)e.key===null?t.set(e.index,e):t.set(e.key,e),e=e.sibling;return t}function a(e,t){return e=di(e,t),e.index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?(r=t.alternate,r===null?(t.flags|=67108866,n):(r=r.index,r<n?(t.flags|=67108866,n):r)):(t.flags|=1048576,n)}function s(t){return e&&t.alternate===null&&(t.flags|=67108866),t}function c(e,t,n,r){return t===null||t.tag!==6?(t=hi(n,e.mode,r),t.return=e,t):(t=a(t,n),t.return=e,t)}function l(e,t,n,r){var i=n.type;return i===y?d(e,t,n.props.children,r,n.key):t!==null&&(t.elementType===i||typeof i==`object`&&i&&i.$$typeof===O&&Aa(i)===t.type)?(t=a(t,n.props),La(t,n),t.return=e,t):(t=pi(n.type,n.key,n.props,null,e.mode,r),La(t,n),t.return=e,t)}function u(e,t,n,r){return t===null||t.tag!==4||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=_i(n,e.mode,r),t.return=e,t):(t=a(t,n.children||[]),t.return=e,t)}function d(e,t,n,r,i){return t===null||t.tag!==7?(t=mi(n,e.mode,r,i),t.return=e,t):(t=a(t,n),t.return=e,t)}function f(e,t,n){if(typeof t==`string`&&t!==``||typeof t==`number`||typeof t==`bigint`)return t=hi(``+t,e.mode,n),t.return=e,t;if(typeof t==`object`&&t){switch(t.$$typeof){case _:return n=pi(t.type,t.key,t.props,null,e.mode,n),La(n,t),n.return=e,n;case v:return t=_i(t,e.mode,n),t.return=e,t;case O:return t=Aa(t),f(e,t,n)}if(te(t)||M(t))return t=mi(t,e.mode,n,null),t.return=e,t;if(typeof t.then==`function`)return f(e,Ia(t),n);if(t.$$typeof===C)return f(e,ia(e,t),n);Ra(e,t)}return null}function p(e,t,n,r){var i=t===null?null:t.key;if(typeof n==`string`&&n!==``||typeof n==`number`||typeof n==`bigint`)return i===null?c(e,t,``+n,r):null;if(typeof n==`object`&&n){switch(n.$$typeof){case _:return n.key===i?l(e,t,n,r):null;case v:return n.key===i?u(e,t,n,r):null;case O:return n=Aa(n),p(e,t,n,r)}if(te(n)||M(n))return i===null?d(e,t,n,r,null):null;if(typeof n.then==`function`)return p(e,t,Ia(n),r);if(n.$$typeof===C)return p(e,t,ia(e,n),r);Ra(e,n)}return null}function m(e,t,n,r,i){if(typeof r==`string`&&r!==``||typeof r==`number`||typeof r==`bigint`)return e=e.get(n)||null,c(t,e,``+r,i);if(typeof r==`object`&&r){switch(r.$$typeof){case _:return e=e.get(r.key===null?n:r.key)||null,l(t,e,r,i);case v:return e=e.get(r.key===null?n:r.key)||null,u(t,e,r,i);case O:return r=Aa(r),m(e,t,n,r,i)}if(te(r)||M(r))return e=e.get(n)||null,d(t,e,r,i,null);if(typeof r.then==`function`)return m(e,t,n,Ia(r),i);if(r.$$typeof===C)return m(e,t,n,ia(t,r),i);Ra(t,r)}return null}function h(i,a,s,c){for(var l=null,u=null,d=a,h=a=0,g=null;d!==null&&h<s.length;h++){d.index>h?(g=d,d=null):g=d.sibling;var _=p(i,d,s[h],c);if(_===null){d===null&&(d=g);break}e&&d&&_.alternate===null&&t(i,d),a=o(_,a,h),u===null?l=_:u.sibling=_,u=_,d=g}if(h===s.length)return n(i,d),Ii&&ki(i,h),l;if(d===null){for(;h<s.length;h++)d=f(i,s[h],c),d!==null&&(a=o(d,a,h),u===null?l=d:u.sibling=d,u=d);return Ii&&ki(i,h),l}for(d=r(d);h<s.length;h++)g=m(d,i,h,s[h],c),g!==null&&(e&&g.alternate!==null&&d.delete(g.key===null?h:g.key),a=o(g,a,h),u===null?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),Ii&&ki(i,h),l}function g(a,s,c,l){if(c==null)throw Error(i(151));for(var u=null,d=null,h=s,g=s=0,_=null,v=c.next();h!==null&&!v.done;g++,v=c.next()){h.index>g?(_=h,h=null):_=h.sibling;var y=p(a,h,v.value,l);if(y===null){h===null&&(h=_);break}e&&h&&y.alternate===null&&t(a,h),s=o(y,s,g),d===null?u=y:d.sibling=y,d=y,h=_}if(v.done)return n(a,h),Ii&&ki(a,g),u;if(h===null){for(;!v.done;g++,v=c.next())v=f(a,v.value,l),v!==null&&(s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return Ii&&ki(a,g),u}for(h=r(h);!v.done;g++,v=c.next())v=m(h,a,g,v.value,l),v!==null&&(e&&v.alternate!==null&&h.delete(v.key===null?g:v.key),s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return e&&h.forEach(function(e){return t(a,e)}),Ii&&ki(a,g),u}function b(e,r,o,c){if(typeof o==`object`&&o&&o.type===y&&o.key===null&&(o=o.props.children),typeof o==`object`&&o){switch(o.$$typeof){case _:a:{for(var l=o.key;r!==null;){if(r.key===l){if(l=o.type,l===y){if(r.tag===7){n(e,r.sibling),c=a(r,o.props.children),c.return=e,e=c;break a}}else if(r.elementType===l||typeof l==`object`&&l&&l.$$typeof===O&&Aa(l)===r.type){n(e,r.sibling),c=a(r,o.props),La(c,o),c.return=e,e=c;break a}n(e,r);break}else t(e,r);r=r.sibling}o.type===y?(c=mi(o.props.children,e.mode,c,o.key),c.return=e,e=c):(c=pi(o.type,o.key,o.props,null,e.mode,c),La(c,o),c.return=e,e=c)}return s(e);case v:a:{for(l=o.key;r!==null;){if(r.key===l)if(r.tag===4&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),c=a(r,o.children||[]),c.return=e,e=c;break a}else{n(e,r);break}else t(e,r);r=r.sibling}c=_i(o,e.mode,c),c.return=e,e=c}return s(e);case O:return o=Aa(o),b(e,r,o,c)}if(te(o))return h(e,r,o,c);if(M(o)){if(l=M(o),typeof l!=`function`)throw Error(i(150));return o=l.call(o),g(e,r,o,c)}if(typeof o.then==`function`)return b(e,r,Ia(o),c);if(o.$$typeof===C)return b(e,r,ia(e,o),c);Ra(e,o)}return typeof o==`string`&&o!==``||typeof o==`number`||typeof o==`bigint`?(o=``+o,r!==null&&r.tag===6?(n(e,r.sibling),c=a(r,o),c.return=e,e=c):(n(e,r),c=hi(o,e.mode,c),c.return=e,e=c),s(e)):n(e,r)}return function(e,t,n,r){try{Fa=0;var i=b(e,t,n,r);return Pa=null,i}catch(t){if(t===wa||t===Ea)throw t;var a=li(29,t,null,e.mode);return a.lanes=r,a.return=e,a}}}var Ba=za(!0),Va=za(!1),Ha=!1;function Ua(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ga(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ka(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Gl&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=oi(e),ai(e,null,n),t}return ni(e,r,t,n),oi(e)}function qa(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,n&4194048)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,nt(e,n)}}function Ja(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ya=!1;function Xa(){if(Ya){var e=ha;if(e!==null)throw e}}function Za(e,t,n,r){Ya=!1;var i=e.updateQueue;Ha=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var u=e.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==o&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(a!==null){var d=i.baseState;o=0,u=l=c=null,s=a;do{var f=s.lane&-536870913,p=f!==s.lane;if(p?(Jl&f)===f:(r&f)===f){f!==0&&f===ma&&(Ya=!0),u!==null&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});a:{var h=e,g=s;f=t;var _=n;switch(g.tag){case 1:if(h=g.payload,typeof h==`function`){d=h.call(_,d,f);break a}d=h;break a;case 3:h.flags=h.flags&-65537|128;case 0:if(h=g.payload,f=typeof h==`function`?h.call(_,d,f):h,f==null)break a;d=m({},d,f);break a;case 2:Ha=!0}}f=s.callback,f!==null&&(e.flags|=64,p&&(e.flags|=8192),p=i.callbacks,p===null?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;p=s,s=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(1);u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,a===null&&(i.shared.lanes=0),nu|=o,e.lanes=o,e.memoizedState=d}}function Qa(e,t){if(typeof e!=`function`)throw Error(i(191,e));e.call(t)}function $a(e,t){var n=e.callbacks;if(n!==null)for(e.callbacks=null,e=0;e<n.length;e++)Qa(n[e],t)}var eo=oe(null),to=oe(0);function no(e,t){e=eu,ce(to,e),ce(eo,t),eu=e|t.baseLanes}function ro(){ce(to,eu),ce(eo,eo.current)}function io(){eu=to.current,se(eo),se(to)}var ao=oe(null),oo=null;function so(e){var t=e.alternate;ce(po,po.current&1),ce(ao,e),oo===null&&(t===null||eo.current!==null||t.memoizedState!==null)&&(oo=e)}function co(e){ce(po,po.current),ce(ao,e),oo===null&&(oo=e)}function lo(e){e.tag===22?(ce(po,po.current),ce(ao,e),oo===null&&(oo=e)):uo(e)}function uo(){ce(po,po.current),ce(ao,ao.current)}function fo(e){se(ao),oo===e&&(oo=null),se(po)}var po=oe(0);function mo(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||pf(n)||mf(n)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder===`forwards`||t.memoizedProps.revealOrder===`backwards`||t.memoizedProps.revealOrder===`unstable_legacy-backwards`||t.memoizedProps.revealOrder===`together`)){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ho=0,go=null,_o=null,vo=null,yo=!1,bo=!1,xo=!1,So=0,Co=0,wo=null,To=0;function Eo(){throw Error(i(321))}function Do(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!wr(e[n],t[n]))return!1;return!0}function Oo(e,t,n,r,i,a){return ho=a,go=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,P.H=e===null||e.memoizedState===null?Ws:Gs,xo=!1,a=n(r,i),xo=!1,bo&&(a=Ao(t,n,r,i)),ko(e),a}function ko(e){P.H=Us;var t=_o!==null&&_o.next!==null;if(ho=0,vo=_o=go=null,yo=!1,Co=0,wo=null,t)throw Error(i(300));e===null||cc||(e=e.dependencies,e!==null&&ta(e)&&(cc=!0))}function Ao(e,t,n,r){go=e;var a=0;do{if(bo&&(wo=null),Co=0,bo=!1,25<=a)throw Error(i(301));if(a+=1,vo=_o=null,e.updateQueue!=null){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,o.memoCache!=null&&(o.memoCache.index=0)}P.H=Ks,o=t(n,r)}while(bo);return o}function jo(){var e=P.H,t=e.useState()[0];return t=typeof t.then==`function`?Ro(t):t,e=e.useState()[0],(_o===null?null:_o.memoizedState)!==e&&(go.flags|=1024),t}function Mo(){var e=So!==0;return So=0,e}function No(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Po(e){if(yo){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}yo=!1}ho=0,vo=_o=go=null,bo=!1,Co=So=0,wo=null}function Fo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vo===null?go.memoizedState=vo=e:vo=vo.next=e,vo}function Io(){if(_o===null){var e=go.alternate;e=e===null?null:e.memoizedState}else e=_o.next;var t=vo===null?go.memoizedState:vo.next;if(t!==null)vo=t,_o=e;else{if(e===null)throw go.alternate===null?Error(i(467)):Error(i(310));_o=e,e={memoizedState:_o.memoizedState,baseState:_o.baseState,baseQueue:_o.baseQueue,queue:_o.queue,next:null},vo===null?go.memoizedState=vo=e:vo=vo.next=e}return vo}function Lo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ro(e){var t=Co;return Co+=1,wo===null&&(wo=[]),e=ka(wo,e,t),t=go,(vo===null?t.memoizedState:vo.next)===null&&(t=t.alternate,P.H=t===null||t.memoizedState===null?Ws:Gs),e}function zo(e){if(typeof e==`object`&&e){if(typeof e.then==`function`)return Ro(e);if(e.$$typeof===C)return ra(e)}throw Error(i(438,String(e)))}function Bo(e){var t=null,n=go.updateQueue;if(n!==null&&(t=n.memoCache),t==null){var r=go.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(t??={data:[],index:0},n===null&&(n=Lo(),go.updateQueue=n),n.memoCache=t,n=t.data[t.index],n===void 0)for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=A;return t.index++,n}function Vo(e,t){return typeof t==`function`?t(e):t}function Ho(e){return Uo(Io(),_o,e)}function Uo(e,t,n){var r=e.queue;if(r===null)throw Error(i(311));r.lastRenderedReducer=n;var a=e.baseQueue,o=r.pending;if(o!==null){if(a!==null){var s=a.next;a.next=o.next,o.next=s}t.baseQueue=a=o,r.pending=null}if(o=e.baseState,a===null)e.memoizedState=o;else{t=a.next;var c=s=null,l=null,u=t,d=!1;do{var f=u.lane&-536870913;if(f===u.lane?(ho&f)===f:(Jl&f)===f){var p=u.revertLane;if(p===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),f===ma&&(d=!0);else if((ho&p)===p){u=u.next,p===ma&&(d=!0);continue}else f={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(c=l=f,s=o):l=l.next=f,go.lanes|=p,nu|=p;f=u.action,xo&&n(o,f),o=u.hasEagerState?u.eagerState:n(o,f)}else p={lane:f,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(c=l=p,s=o):l=l.next=p,go.lanes|=f,nu|=f;u=u.next}while(u!==null&&u!==t);if(l===null?s=o:l.next=c,!wr(o,e.memoizedState)&&(cc=!0,d&&(n=ha,n!==null)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=l,r.lastRenderedState=o}return a===null&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Wo(e){var t=Io(),n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do o=e(o,s.action),s=s.next;while(s!==a);wr(o,t.memoizedState)||(cc=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Go(e,t,n){var r=go,a=Io(),o=Ii;if(o){if(n===void 0)throw Error(i(407));n=n()}else n=t();var s=!wr((_o||a).memoizedState,n);if(s&&(a.memoizedState=n,cc=!0),a=a.queue,gs(Jo.bind(null,r,a,e),[e]),a.getSnapshot!==t||s||vo!==null&&vo.memoizedState.tag&1){if(r.flags|=2048,ds(9,{destroy:void 0},qo.bind(null,r,a,n,t),null),Kl===null)throw Error(i(349));o||ho&127||Ko(r,t,n)}return n}function Ko(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=go.updateQueue,t===null?(t=Lo(),go.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function qo(e,t,n,r){t.value=n,t.getSnapshot=r,Yo(t)&&Xo(e)}function Jo(e,t,n){return n(function(){Yo(t)&&Xo(e)})}function Yo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!wr(e,n)}catch{return!0}}function Xo(e){var t=ii(e,2);t!==null&&Eu(t,e,2)}function Zo(e){var t=Fo();if(typeof e==`function`){var n=e;if(e=n(),xo){Be(!0);try{n()}finally{Be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:e},t}function Qo(e,t,n,r){return e.baseState=n,Uo(e,_o,typeof r==`function`?r:Vo)}function $o(e,t,n,r,a){if(Bs(e))throw Error(i(485));if(e=t.action,e!==null){var o={payload:a,action:e,next:null,isTransition:!0,status:`pending`,value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};P.T===null?o.isTransition=!1:n(!0),r(o),n=t.pending,n===null?(o.next=t.pending=o,es(t,o)):(o.next=n.next,t.pending=n.next=o)}}function es(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=P.T,o={};P.T=o;try{var s=n(i,r),c=P.S;c!==null&&c(o,s),ts(e,t,s)}catch(n){rs(e,t,n)}finally{a!==null&&o.types!==null&&(a.types=o.types),P.T=a}}else try{a=n(i,r),ts(e,t,a)}catch(n){rs(e,t,n)}}function ts(e,t,n){typeof n==`object`&&n&&typeof n.then==`function`?n.then(function(n){ns(e,t,n)},function(n){return rs(e,t,n)}):ns(e,t,n)}function ns(e,t,n){t.status=`fulfilled`,t.value=n,is(t),e.state=n,t=e.pending,t!==null&&(n=t.next,n===t?e.pending=null:(n=n.next,t.next=n,es(e,n)))}function rs(e,t,n){var r=e.pending;if(e.pending=null,r!==null){r=r.next;do t.status=`rejected`,t.reason=n,is(t),t=t.next;while(t!==r)}e.action=null}function is(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function as(e,t){return t}function os(e,t){if(Ii){var n=Kl.formState;if(n!==null){a:{var r=go;if(Ii){if(Fi){b:{for(var i=Fi,a=Ri;i.nodeType!==8;){if(!a){i=null;break b}if(i=gf(i.nextSibling),i===null){i=null;break b}}a=i.data,i=a===`F!`||a===`F`?i:null}if(i){Fi=gf(i.nextSibling),r=i.data===`F!`;break a}}Bi(r)}r=!1}r&&(t=n[0])}}return n=Fo(),n.memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:as,lastRenderedState:t},n.queue=r,n=Ls.bind(null,go,r),r.dispatch=n,r=Zo(!1),a=zs.bind(null,go,!1,r.queue),r=Fo(),i={state:t,dispatch:null,action:e,pending:null},r.queue=i,n=$o.bind(null,go,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function ss(e){return cs(Io(),_o,e)}function cs(e,t,n){if(t=Uo(e,t,as)[0],e=Ho(Vo)[0],typeof t==`object`&&t&&typeof t.then==`function`)try{var r=Ro(t)}catch(e){throw e===wa?Ea:e}else r=t;t=Io();var i=t.queue,a=i.dispatch;return n!==t.memoizedState&&(go.flags|=2048,ds(9,{destroy:void 0},ls.bind(null,i,n),null)),[r,a,e]}function ls(e,t){e.action=t}function us(e){var t=Io(),n=_o;if(n!==null)return cs(t,n,e);Io(),t=t.memoizedState,n=Io();var r=n.queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ds(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},t=go.updateQueue,t===null&&(t=Lo(),go.updateQueue=t),n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function fs(){return Io().memoizedState}function ps(e,t,n,r){var i=Fo();go.flags|=e,i.memoizedState=ds(1|t,{destroy:void 0},n,r===void 0?null:r)}function ms(e,t,n,r){var i=Io();r=r===void 0?null:r;var a=i.memoizedState.inst;_o!==null&&r!==null&&Do(r,_o.memoizedState.deps)?i.memoizedState=ds(t,a,n,r):(go.flags|=e,i.memoizedState=ds(1|t,a,n,r))}function hs(e,t){ps(8390656,8,e,t)}function gs(e,t){ms(2048,8,e,t)}function _s(e){go.flags|=4;var t=go.updateQueue;if(t===null)t=Lo(),go.updateQueue=t,t.events=[e];else{var n=t.events;n===null?t.events=[e]:n.push(e)}}function vs(e){var t=Io().memoizedState;return _s({ref:t,nextImpl:e}),function(){if(Gl&2)throw Error(i(440));return t.impl.apply(void 0,arguments)}}function ys(e,t){return ms(4,2,e,t)}function bs(e,t){return ms(4,4,e,t)}function xs(e,t){if(typeof t==`function`){e=e();var n=t(e);return function(){typeof n==`function`?n():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Ss(e,t,n){n=n==null?null:n.concat([e]),ms(4,4,xs.bind(null,t,e),n)}function Cs(){}function ws(e,t){var n=Io();t=t===void 0?null:t;var r=n.memoizedState;return t!==null&&Do(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ts(e,t){var n=Io();t=t===void 0?null:t;var r=n.memoizedState;if(t!==null&&Do(t,r[1]))return r[0];if(r=e(),xo){Be(!0);try{e()}finally{Be(!1)}}return n.memoizedState=[r,t],r}function Es(e,t,n){return n===void 0||ho&1073741824&&!(Jl&261930)?e.memoizedState=t:(e.memoizedState=n,e=Tu(),go.lanes|=e,nu|=e,n)}function Ds(e,t,n,r){return wr(n,t)?n:eo.current===null?!(ho&42)||ho&1073741824&&!(Jl&261930)?(cc=!0,e.memoizedState=n):(e=Tu(),go.lanes|=e,nu|=e,t):(e=Es(e,n,r),wr(e,t)||(cc=!0),e)}function Os(e,t,n,r,i){var a=ne.p;ne.p=a!==0&&8>a?a:8;var o=P.T,s={};P.T=s,zs(e,!1,t,n);try{var c=i(),l=P.S;l!==null&&l(s,c),typeof c==`object`&&c&&typeof c.then==`function`?Rs(e,t,va(c,r),wu(e)):Rs(e,t,r,wu(e))}catch(n){Rs(e,t,{then:function(){},status:`rejected`,reason:n},wu())}finally{ne.p=a,o!==null&&s.types!==null&&(o.types=s.types),P.T=o}}function ks(){}function As(e,t,n,r){if(e.tag!==5)throw Error(i(476));var a=js(e).queue;Os(e,a,t,re,n===null?ks:function(){return Ms(e),n(r)})}function js(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:re},next:null};var n={};return t.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vo,lastRenderedState:n},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Ms(e){var t=js(e);t.next===null&&(t=e.alternate.memoizedState),Rs(e,t.next.queue,{},wu())}function Ns(){return ra(np)}function Ps(){return Io().memoizedState}function Fs(){return Io().memoizedState}function nee(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var n=wu();e=Ga(n);var r=Ka(t,e,n);r!==null&&(Eu(r,t,n),qa(r,t,n)),t={cache:ua()},e.payload=t;return}t=t.return}}function Is(e,t,n){var r=wu();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Bs(e)?Vs(t,n):(n=ri(e,t,n,r),n!==null&&(Eu(n,e,r),Hs(n,t,r)))}function Ls(e,t,n){Rs(e,t,n,wu())}function Rs(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Bs(e))Vs(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,wr(s,o))return ni(e,t,i,0),Kl===null&&ti(),!1}catch{}if(n=ri(e,t,i,r),n!==null)return Eu(n,e,r),Hs(n,t,r),!0}return!1}function zs(e,t,n,r){if(r={lane:2,revertLane:yd(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Bs(e)){if(t)throw Error(i(479))}else t=ri(e,n,r,2),t!==null&&Eu(t,e,2)}function Bs(e){var t=e.alternate;return e===go||t!==null&&t===go}function Vs(e,t){bo=yo=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hs(e,t,n){if(n&4194048){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,nt(e,n)}}var Us={readContext:ra,use:zo,useCallback:Eo,useContext:Eo,useEffect:Eo,useImperativeHandle:Eo,useLayoutEffect:Eo,useInsertionEffect:Eo,useMemo:Eo,useReducer:Eo,useRef:Eo,useState:Eo,useDebugValue:Eo,useDeferredValue:Eo,useTransition:Eo,useSyncExternalStore:Eo,useId:Eo,useHostTransitionStatus:Eo,useFormState:Eo,useActionState:Eo,useOptimistic:Eo,useMemoCache:Eo,useCacheRefresh:Eo};Us.useEffectEvent=Eo;var Ws={readContext:ra,use:zo,useCallback:function(e,t){return Fo().memoizedState=[e,t===void 0?null:t],e},useContext:ra,useEffect:hs,useImperativeHandle:function(e,t,n){n=n==null?null:n.concat([e]),ps(4194308,4,xs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ps(4194308,4,e,t)},useInsertionEffect:function(e,t){ps(4,2,e,t)},useMemo:function(e,t){var n=Fo();t=t===void 0?null:t;var r=e();if(xo){Be(!0);try{e()}finally{Be(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Fo();if(n!==void 0){var i=n(t);if(xo){Be(!0);try{n(t)}finally{Be(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Is.bind(null,go,e),[r.memoizedState,e]},useRef:function(e){var t=Fo();return e={current:e},t.memoizedState=e},useState:function(e){e=Zo(e);var t=e.queue,n=Ls.bind(null,go,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Cs,useDeferredValue:function(e,t){return Es(Fo(),e,t)},useTransition:function(){var e=Zo(!1);return e=Os.bind(null,go,e.queue,!0,!1),Fo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=go,a=Fo();if(Ii){if(n===void 0)throw Error(i(407));n=n()}else{if(n=t(),Kl===null)throw Error(i(349));Jl&127||Ko(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,hs(Jo.bind(null,r,o,e),[e]),r.flags|=2048,ds(9,{destroy:void 0},qo.bind(null,r,o,n,t),null),n},useId:function(){var e=Fo(),t=Kl.identifierPrefix;if(Ii){var n=Oi,r=Di;n=(r&~(1<<32-Ve(r)-1)).toString(32)+n,t=`_`+t+`R_`+n,n=So++,0<n&&(t+=`H`+n.toString(32)),t+=`_`}else n=To++,t=`_`+t+`r_`+n.toString(32)+`_`;return e.memoizedState=t},useHostTransitionStatus:Ns,useFormState:os,useActionState:os,useOptimistic:function(e){var t=Fo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=zs.bind(null,go,!0,n),n.dispatch=t,[e,t]},useMemoCache:Bo,useCacheRefresh:function(){return Fo().memoizedState=nee.bind(null,go)},useEffectEvent:function(e){var t=Fo(),n={impl:e};return t.memoizedState=n,function(){if(Gl&2)throw Error(i(440));return n.impl.apply(void 0,arguments)}}},Gs={readContext:ra,use:zo,useCallback:ws,useContext:ra,useEffect:gs,useImperativeHandle:Ss,useInsertionEffect:ys,useLayoutEffect:bs,useMemo:Ts,useReducer:Ho,useRef:fs,useState:function(){return Ho(Vo)},useDebugValue:Cs,useDeferredValue:function(e,t){return Ds(Io(),_o.memoizedState,e,t)},useTransition:function(){var e=Ho(Vo)[0],t=Io().memoizedState;return[typeof e==`boolean`?e:Ro(e),t]},useSyncExternalStore:Go,useId:Ps,useHostTransitionStatus:Ns,useFormState:ss,useActionState:ss,useOptimistic:function(e,t){return Qo(Io(),_o,e,t)},useMemoCache:Bo,useCacheRefresh:Fs};Gs.useEffectEvent=vs;var Ks={readContext:ra,use:zo,useCallback:ws,useContext:ra,useEffect:gs,useImperativeHandle:Ss,useInsertionEffect:ys,useLayoutEffect:bs,useMemo:Ts,useReducer:Wo,useRef:fs,useState:function(){return Wo(Vo)},useDebugValue:Cs,useDeferredValue:function(e,t){var n=Io();return _o===null?Es(n,e,t):Ds(n,_o.memoizedState,e,t)},useTransition:function(){var e=Wo(Vo)[0],t=Io().memoizedState;return[typeof e==`boolean`?e:Ro(e),t]},useSyncExternalStore:Go,useId:Ps,useHostTransitionStatus:Ns,useFormState:us,useActionState:us,useOptimistic:function(e,t){var n=Io();return _o===null?(n.baseState=e,[e,n.queue.dispatch]):Qo(n,_o,e,t)},useMemoCache:Bo,useCacheRefresh:Fs};Ks.useEffectEvent=vs;function qs(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:m({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Js={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=wu(),i=Ga(r);i.payload=t,n!=null&&(i.callback=n),t=Ka(e,i,r),t!==null&&(Eu(t,e,r),qa(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=wu(),i=Ga(r);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=Ka(e,i,r),t!==null&&(Eu(t,e,r),qa(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=wu(),r=Ga(n);r.tag=2,t!=null&&(r.callback=t),t=Ka(e,r,n),t!==null&&(Eu(t,e,n),qa(t,e,n))}};function Ys(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate==`function`?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!Tr(n,r)||!Tr(i,a):!0}function Xs(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps==`function`&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps==`function`&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Js.enqueueReplaceState(t,t.state,null)}function Zs(e,t){var n=t;if(`ref`in t)for(var r in n={},t)r!==`ref`&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=m({},n)),e)n[i]===void 0&&(n[i]=e[i]);return n}function Qs(e){Zr(e)}function $s(e){console.error(e)}function ec(e){Zr(e)}function tc(e,t){try{var n=e.onUncaughtError;n(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function nc(e,t,n){try{var r=e.onCaughtError;r(n.value,{componentStack:n.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function rc(e,t,n){return n=Ga(n),n.tag=3,n.payload={element:null},n.callback=function(){tc(e,t)},n}function ic(e){return e=Ga(e),e.tag=3,e}function ac(e,t,n,r){var i=n.type.getDerivedStateFromError;if(typeof i==`function`){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){nc(t,n,r)}}var o=n.stateNode;o!==null&&typeof o.componentDidCatch==`function`&&(e.callback=function(){nc(t,n,r),typeof i!=`function`&&(mu===null?mu=new Set([this]):mu.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:e===null?``:e})})}function oc(e,t,n,r,a){if(n.flags|=32768,typeof r==`object`&&r&&typeof r.then==`function`){if(t=n.alternate,t!==null&&ea(t,n,a,!0),n=ao.current,n!==null){switch(n.tag){case 31:case 13:return oo===null?Ru():n.alternate===null&&tu===0&&(tu=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===Da?n.flags|=16384:(t=n.updateQueue,t===null?n.updateQueue=new Set([r]):t.add(r),ed(e,r,a)),!1;case 22:return n.flags|=65536,r===Da?n.flags|=16384:(t=n.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):(n=t.retryQueue,n===null?t.retryQueue=new Set([r]):n.add(r)),ed(e,r,a)),!1}throw Error(i(435,n.tag))}return ed(e,r,a),Ru(),!1}if(Ii)return t=ao.current,t===null?(r!==zi&&(t=Error(i(423),{cause:r}),Ki(yi(t,n))),e=e.current.alternate,e.flags|=65536,a&=-a,e.lanes|=a,r=yi(r,n),a=rc(e.stateNode,r,a),Ja(e,a),tu!==4&&(tu=2)):(!(t.flags&65536)&&(t.flags|=256),t.flags|=65536,t.lanes=a,r!==zi&&(e=Error(i(422),{cause:r}),Ki(yi(e,n)))),!1;var o=Error(i(520),{cause:r});if(o=yi(o,n),su===null?su=[o]:su.push(o),tu!==4&&(tu=2),t===null)return!0;r=yi(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,e=rc(n.stateNode,r,e),Ja(n,e),!1;case 1:if(t=n.type,o=n.stateNode,!(n.flags&128)&&(typeof t.getDerivedStateFromError==`function`||o!==null&&typeof o.componentDidCatch==`function`&&(mu===null||!mu.has(o))))return n.flags|=65536,a&=-a,n.lanes|=a,a=ic(a),ac(a,e,n,r),Ja(n,a),!1}n=n.return}while(n!==null);return!1}var sc=Error(i(461)),cc=!1;function lc(e,t,n,r){t.child=e===null?Va(t,null,n,r):Ba(t,e.child,n,r)}function uc(e,t,n,r,i){n=n.render;var a=t.ref;if(`ref`in r){var o={};for(var s in r)s!==`ref`&&(o[s]=r[s])}else o=r;return na(t),r=Oo(e,t,n,o,a,i),s=Mo(),e!==null&&!cc?(No(e,t,i),Pc(e,t,i)):(Ii&&s&&ji(t),t.flags|=1,lc(e,t,r,i),t.child)}function dc(e,t,n,r,i){if(e===null){var a=n.type;return typeof a==`function`&&!ui(a)&&a.defaultProps===void 0&&n.compare===null?(t.tag=15,t.type=a,fc(e,t,a,r,i)):(e=pi(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!Fc(e,i)){var o=a.memoizedProps;if(n=n.compare,n=n===null?Tr:n,n(o,r)&&e.ref===t.ref)return Pc(e,t,i)}return t.flags|=1,e=di(a,r),e.ref=t.ref,e.return=t,t.child=e}function fc(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if(Tr(a,r)&&e.ref===t.ref)if(cc=!1,t.pendingProps=r=a,Fc(e,i))e.flags&131072&&(cc=!0);else return t.lanes=e.lanes,Pc(e,t,i)}return bc(e,t,n,r,i)}function pc(e,t,n,r){var i=r.children,a=e===null?null:e.memoizedState;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode===`hidden`){if(t.flags&128){if(a=a===null?n:a.baseLanes|n,e!==null){for(r=t.child=e.child,i=0;r!==null;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~a}else r=0,t.child=null;return hc(e,t,a,n,r)}if(n&536870912)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&Sa(t,a===null?null:a.cachePool),a===null?ro():no(t,a),lo(t);else return r=t.lanes=536870912,hc(e,t,a===null?n:a.baseLanes|n,n,r)}else a===null?(e!==null&&Sa(t,null),ro(),uo(t)):(Sa(t,a.cachePool),no(t,a),uo(t),t.memoizedState=null);return lc(e,t,i,n),t.child}function mc(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function hc(e,t,n,r,i){var a=xa();return a=a===null?null:{parent:la._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},e!==null&&Sa(t,null),ro(),lo(t),e!==null&&ea(e,t,r,!0),t.childLanes=i,null}function gc(e,t){return t=kc({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function _c(e,t,n){return Ba(t,e.child,null,n),e=gc(t,t.pendingProps),e.flags|=2,fo(t),t.memoizedState=null,e}function vc(e,t,n){var r=t.pendingProps,a=(t.flags&128)!=0;if(t.flags&=-129,e===null){if(Ii){if(r.mode===`hidden`)return e=gc(t,r),t.lanes=536870912,mc(null,e);if(co(t),(e=Fi)?(e=ff(e,Ri),e=e!==null&&e.data===`&`?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ei===null?null:{id:Di,overflow:Oi},retryLane:536870912,hydrationErrors:null},n=gi(e),n.return=t,t.child=n,Pi=t,Fi=null)):e=null,e===null)throw Bi(t);return t.lanes=536870912,null}return gc(t,r)}var o=e.memoizedState;if(o!==null){var s=o.dehydrated;if(co(t),a)if(t.flags&256)t.flags&=-257,t=_c(e,t,n);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(i(558));else if(cc||ea(e,t,n,!1),a=(n&e.childLanes)!==0,cc||a){if(r=Kl,r!==null&&(s=rt(r,n),s!==0&&s!==o.retryLane))throw o.retryLane=s,ii(e,s),Eu(r,e,s),sc;Ru(),t=_c(e,t,n)}else e=o.treeContext,Fi=gf(s.nextSibling),Pi=t,Ii=!0,Li=null,Ri=!1,e!==null&&Ni(t,e),t=gc(t,r),t.flags|=4096;return t}return e=di(e.child,{mode:r.mode,children:r.children}),e.ref=t.ref,t.child=e,e.return=t,e}function yc(e,t){var n=t.ref;if(n===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof n!=`function`&&typeof n!=`object`)throw Error(i(284));(e===null||e.ref!==n)&&(t.flags|=4194816)}}function bc(e,t,n,r,i){return na(t),n=Oo(e,t,n,r,void 0,i),r=Mo(),e!==null&&!cc?(No(e,t,i),Pc(e,t,i)):(Ii&&r&&ji(t),t.flags|=1,lc(e,t,n,i),t.child)}function xc(e,t,n,r,i,a){return na(t),t.updateQueue=null,n=Ao(t,r,n,i),ko(e),r=Mo(),e!==null&&!cc?(No(e,t,a),Pc(e,t,a)):(Ii&&r&&ji(t),t.flags|=1,lc(e,t,n,a),t.child)}function Sc(e,t,n,r,i){if(na(t),t.stateNode===null){var a=si,o=n.contextType;typeof o==`object`&&o&&(a=ra(o)),a=new n(r,a),t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Js,t.stateNode=a,a._reactInternals=t,a=t.stateNode,a.props=r,a.state=t.memoizedState,a.refs={},Ua(t),o=n.contextType,a.context=typeof o==`object`&&o?ra(o):si,a.state=t.memoizedState,o=n.getDerivedStateFromProps,typeof o==`function`&&(qs(t,n,o,r),a.state=t.memoizedState),typeof n.getDerivedStateFromProps==`function`||typeof a.getSnapshotBeforeUpdate==`function`||typeof a.UNSAFE_componentWillMount!=`function`&&typeof a.componentWillMount!=`function`||(o=a.state,typeof a.componentWillMount==`function`&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount==`function`&&a.UNSAFE_componentWillMount(),o!==a.state&&Js.enqueueReplaceState(a,a.state,null),Za(t,r,a,i),Xa(),a.state=t.memoizedState),typeof a.componentDidMount==`function`&&(t.flags|=4194308),r=!0}else if(e===null){a=t.stateNode;var s=t.memoizedProps,c=Zs(n,s);a.props=c;var l=a.context,u=n.contextType;o=si,typeof u==`object`&&u&&(o=ra(u));var d=n.getDerivedStateFromProps;u=typeof d==`function`||typeof a.getSnapshotBeforeUpdate==`function`,s=t.pendingProps!==s,u||typeof a.UNSAFE_componentWillReceiveProps!=`function`&&typeof a.componentWillReceiveProps!=`function`||(s||l!==o)&&Xs(t,a,r,o),Ha=!1;var f=t.memoizedState;a.state=f,Za(t,r,a,i),Xa(),l=t.memoizedState,s||f!==l||Ha?(typeof d==`function`&&(qs(t,n,d,r),l=t.memoizedState),(c=Ha||Ys(t,n,c,r,f,l,o))?(u||typeof a.UNSAFE_componentWillMount!=`function`&&typeof a.componentWillMount!=`function`||(typeof a.componentWillMount==`function`&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount==`function`&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount==`function`&&(t.flags|=4194308)):(typeof a.componentDidMount==`function`&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=o,r=c):(typeof a.componentDidMount==`function`&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Wa(e,t),o=t.memoizedProps,u=Zs(n,o),a.props=u,d=t.pendingProps,f=a.context,l=n.contextType,c=si,typeof l==`object`&&l&&(c=ra(l)),s=n.getDerivedStateFromProps,(l=typeof s==`function`||typeof a.getSnapshotBeforeUpdate==`function`)||typeof a.UNSAFE_componentWillReceiveProps!=`function`&&typeof a.componentWillReceiveProps!=`function`||(o!==d||f!==c)&&Xs(t,a,r,c),Ha=!1,f=t.memoizedState,a.state=f,Za(t,r,a,i),Xa();var p=t.memoizedState;o!==d||f!==p||Ha||e!==null&&e.dependencies!==null&&ta(e.dependencies)?(typeof s==`function`&&(qs(t,n,s,r),p=t.memoizedState),(u=Ha||Ys(t,n,u,r,f,p,c)||e!==null&&e.dependencies!==null&&ta(e.dependencies))?(l||typeof a.UNSAFE_componentWillUpdate!=`function`&&typeof a.componentWillUpdate!=`function`||(typeof a.componentWillUpdate==`function`&&a.componentWillUpdate(r,p,c),typeof a.UNSAFE_componentWillUpdate==`function`&&a.UNSAFE_componentWillUpdate(r,p,c)),typeof a.componentDidUpdate==`function`&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate==`function`&&(t.flags|=1024)):(typeof a.componentDidUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=c,r=u):(typeof a.componentDidUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,yc(e,t),r=(t.flags&128)!=0,a||r?(a=t.stateNode,n=r&&typeof n.getDerivedStateFromError!=`function`?null:a.render(),t.flags|=1,e!==null&&r?(t.child=Ba(t,e.child,null,i),t.child=Ba(t,null,n,i)):lc(e,t,n,i),t.memoizedState=a.state,e=t.child):e=Pc(e,t,i),e}function Cc(e,t,n,r){return Wi(),t.flags|=256,lc(e,t,n,r),t.child}var wc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Tc(e){return{baseLanes:e,cachePool:Ca()}}function Ec(e,t,n){return e=e===null?0:e.childLanes&~n,t&&(e|=au),e}function Dc(e,t,n){var r=t.pendingProps,a=!1,o=(t.flags&128)!=0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(po.current&2)!=0),s&&(a=!0,t.flags&=-129),s=(t.flags&32)!=0,t.flags&=-33,e===null){if(Ii){if(a?so(t):uo(t),(e=Fi)?(e=ff(e,Ri),e=e!==null&&e.data!==`&`?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ei===null?null:{id:Di,overflow:Oi},retryLane:536870912,hydrationErrors:null},n=gi(e),n.return=t,t.child=n,Pi=t,Fi=null)):e=null,e===null)throw Bi(t);return mf(e)?t.lanes=32:t.lanes=536870912,null}var c=r.children;return r=r.fallback,a?(uo(t),a=t.mode,c=kc({mode:`hidden`,children:c},a),r=mi(r,a,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,r=t.child,r.memoizedState=Tc(n),r.childLanes=Ec(e,s,n),t.memoizedState=wc,mc(null,r)):(so(t),Oc(t,c))}var l=e.memoizedState;if(l!==null&&(c=l.dehydrated,c!==null)){if(o)t.flags&256?(so(t),t.flags&=-257,t=Ac(e,t,n)):t.memoizedState===null?(uo(t),c=r.fallback,a=t.mode,r=kc({mode:`visible`,children:r.children},a),c=mi(c,a,n,null),c.flags|=2,r.return=t,c.return=t,r.sibling=c,t.child=r,Ba(t,e.child,null,n),r=t.child,r.memoizedState=Tc(n),r.childLanes=Ec(e,s,n),t.memoizedState=wc,t=mc(null,r)):(uo(t),t.child=e.child,t.flags|=128,t=null);else if(so(t),mf(c)){if(s=c.nextSibling&&c.nextSibling.dataset,s)var u=s.dgst;s=u,r=Error(i(419)),r.stack=``,r.digest=s,Ki({value:r,source:null,stack:null}),t=Ac(e,t,n)}else if(cc||ea(e,t,n,!1),s=(n&e.childLanes)!==0,cc||s){if(s=Kl,s!==null&&(r=rt(s,n),r!==0&&r!==l.retryLane))throw l.retryLane=r,ii(e,r),Eu(s,e,r),sc;pf(c)||Ru(),t=Ac(e,t,n)}else pf(c)?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,Fi=gf(c.nextSibling),Pi=t,Ii=!0,Li=null,Ri=!1,e!==null&&Ni(t,e),t=Oc(t,r.children),t.flags|=4096);return t}return a?(uo(t),c=r.fallback,a=t.mode,l=e.child,u=l.sibling,r=di(l,{mode:`hidden`,children:r.children}),r.subtreeFlags=l.subtreeFlags&65011712,u===null?(c=mi(c,a,n,null),c.flags|=2):c=di(u,c),c.return=t,r.return=t,r.sibling=c,t.child=r,mc(null,r),r=t.child,c=e.child.memoizedState,c===null?c=Tc(n):(a=c.cachePool,a===null?a=Ca():(l=la._currentValue,a=a.parent===l?a:{parent:l,pool:l}),c={baseLanes:c.baseLanes|n,cachePool:a}),r.memoizedState=c,r.childLanes=Ec(e,s,n),t.memoizedState=wc,mc(e.child,r)):(so(t),n=e.child,e=n.sibling,n=di(n,{mode:`visible`,children:r.children}),n.return=t,n.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function Oc(e,t){return t=kc({mode:`visible`,children:t},e.mode),t.return=e,e.child=t}function kc(e,t){return e=li(22,e,null,t),e.lanes=0,e}function Ac(e,t,n){return Ba(t,e.child,null,n),e=Oc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function jc(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Qi(e.return,t,n)}function Mc(e,t,n,r,i,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.treeForkCount=a)}function Nc(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;r=r.children;var o=po.current,s=(o&2)!=0;if(s?(o=o&1|2,t.flags|=128):o&=1,ce(po,o),lc(e,t,r,n),r=Ii?Ci:0,!s&&e!==null&&e.flags&128)a:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&jc(e,n,t);else if(e.tag===19)jc(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break a;for(;e.sibling===null;){if(e.return===null||e.return===t)break a;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case`forwards`:for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&mo(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Mc(t,!1,i,n,a,r);break;case`backwards`:case`unstable_legacy-backwards`:for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&mo(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Mc(t,!0,n,null,a,r);break;case`together`:Mc(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function Pc(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),nu|=t.lanes,(n&t.childLanes)===0)if(e!==null){if(ea(e,t,n,!1),(n&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,n=di(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=di(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Fc(e,t){return(e.lanes&t)===0?(e=e.dependencies,!!(e!==null&&ta(e))):!0}function ree(e,t,n){switch(t.tag){case 3:pe(t,t.stateNode.containerInfo),Xi(t,la,e.memoizedState.cache),Wi();break;case 27:case 5:he(t);break;case 4:pe(t,t.stateNode.containerInfo);break;case 10:Xi(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,co(t),null;break;case 13:var r=t.memoizedState;if(r!==null)return r.dehydrated===null?(n&t.child.childLanes)===0?(so(t),e=Pc(e,t,n),e===null?null:e.sibling):Dc(e,t,n):(so(t),t.flags|=128,null);so(t);break;case 19:var i=(e.flags&128)!=0;if(r=(n&t.childLanes)!==0,r||=(ea(e,t,n,!1),(n&t.childLanes)!==0),i){if(r)return Nc(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ce(po,po.current),r)break;return null;case 22:return t.lanes=0,pc(e,t,n,t.pendingProps);case 24:Xi(t,la,e.memoizedState.cache)}return Pc(e,t,n)}function Ic(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps)cc=!0;else{if(!Fc(e,n)&&!(t.flags&128))return cc=!1,ree(e,t,n);cc=!!(e.flags&131072)}else cc=!1,Ii&&t.flags&1048576&&Ai(t,Ci,t.index);switch(t.lanes=0,t.tag){case 16:a:{var r=t.pendingProps;if(e=Aa(t.elementType),t.type=e,typeof e==`function`)ui(e)?(r=Zs(e,r),t.tag=1,t=Sc(null,t,e,r,n)):(t.tag=0,t=bc(null,t,e,r,n));else{if(e!=null){var a=e.$$typeof;if(a===w){t.tag=11,t=uc(null,t,e,r,n);break a}else if(a===D){t.tag=14,t=dc(null,t,e,r,n);break a}}throw t=ee(e)||e,Error(i(306,t,``))}}return t;case 0:return bc(e,t,t.type,t.pendingProps,n);case 1:return r=t.type,a=Zs(r,t.pendingProps),Sc(e,t,r,a,n);case 3:a:{if(pe(t,t.stateNode.containerInfo),e===null)throw Error(i(387));r=t.pendingProps;var o=t.memoizedState;a=o.element,Wa(e,t),Za(t,r,null,n);var s=t.memoizedState;if(r=s.cache,Xi(t,la,r),r!==o.cache&&$i(t,[la],n,!0),Xa(),r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){t=Cc(e,t,r,n);break a}else if(r!==a){a=yi(Error(i(424)),t),Ki(a),t=Cc(e,t,r,n);break a}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName===`HTML`?e.ownerDocument.body:e}for(Fi=gf(e.firstChild),Pi=t,Ii=!0,Li=null,Ri=!0,n=Va(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(Wi(),r===a){t=Pc(e,t,n);break a}lc(e,t,r,n)}t=t.child}return t;case 26:return yc(e,t),e===null?(n=Pf(t.type,null,t.pendingProps,null))?t.memoizedState=n:Ii||(n=t.type,e=t.pendingProps,r=Xd(de.current).createElement(n),r[lt]=t,r[ut]=e,Wd(r,n,e),St(r),t.stateNode=r):t.memoizedState=Pf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return he(t),e===null&&Ii&&(r=t.stateNode=bf(t.type,t.pendingProps,de.current),Pi=t,Ri=!0,a=Fi,of(t.type)?(_f=a,Fi=gf(r.firstChild)):Fi=a),lc(e,t,t.pendingProps.children,n),yc(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Ii&&((a=r=Fi)&&(r=uf(r,t.type,t.pendingProps,Ri),r===null?a=!1:(t.stateNode=r,Pi=t,Fi=gf(r.firstChild),Ri=!1,a=!0)),a||Bi(t)),he(t),a=t.type,o=t.pendingProps,s=e===null?null:e.memoizedProps,r=o.children,$d(a,o)?r=null:s!==null&&$d(a,s)&&(t.flags|=32),t.memoizedState!==null&&(a=Oo(e,t,jo,null,null,n),np._currentValue=a),yc(e,t),lc(e,t,r,n),t.child;case 6:return e===null&&Ii&&((e=n=Fi)&&(n=df(n,t.pendingProps,Ri),n===null?e=!1:(t.stateNode=n,Pi=t,Fi=null,e=!0)),e||Bi(t)),null;case 13:return Dc(e,t,n);case 4:return pe(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ba(t,null,r,n):lc(e,t,r,n),t.child;case 11:return uc(e,t,t.type,t.pendingProps,n);case 7:return lc(e,t,t.pendingProps,n),t.child;case 8:return lc(e,t,t.pendingProps.children,n),t.child;case 12:return lc(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Xi(t,t.type,r.value),lc(e,t,r.children,n),t.child;case 9:return a=t.type._context,r=t.pendingProps.children,na(t),a=ra(a),r=r(a),t.flags|=1,lc(e,t,r,n),t.child;case 14:return dc(e,t,t.type,t.pendingProps,n);case 15:return fc(e,t,t.type,t.pendingProps,n);case 19:return Nc(e,t,n);case 31:return vc(e,t,n);case 22:return pc(e,t,n,t.pendingProps);case 24:return na(t),r=ra(la),e===null?(a=xa(),a===null&&(a=Kl,o=ua(),a.pooledCache=o,o.refCount++,o!==null&&(a.pooledCacheLanes|=n),a=o),t.memoizedState={parent:r,cache:a},Ua(t),Xi(t,la,a)):((e.lanes&n)!==0&&(Wa(e,t),Za(t,null,null,n),Xa()),a=e.memoizedState,o=t.memoizedState,a.parent===r?(r=o.cache,Xi(t,la,r),r!==a.cache&&$i(t,[la],n,!0)):(a={parent:r,cache:r},t.memoizedState=a,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=a),Xi(t,la,r))),lc(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Lc(e){e.flags|=4}function Rc(e,t,n,r,i){if((t=(e.mode&32)!=0)&&(t=!1),t){if(e.flags|=16777216,(i&335544128)===i)if(e.stateNode.complete)e.flags|=8192;else if(Fu())e.flags|=8192;else throw ja=Da,Ta}else e.flags&=-16777217}function zc(e,t){if(t.type!==`stylesheet`||t.state.loading&4)e.flags&=-16777217;else if(e.flags|=16777216,!Jf(t))if(Fu())e.flags|=8192;else throw ja=Da,Ta}function Bc(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag===22?536870912:Ze(),e.lanes|=t,ou|=t)}function Vc(e,t){if(!Ii)switch(e.tailMode){case`hidden`:t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case`collapsed`:n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hc(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&65011712,r|=i.flags&65011712,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Uc(e,t,n){var r=t.pendingProps;switch(Mi(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hc(t),null;case 1:return Hc(t),null;case 3:return n=t.stateNode,r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Zi(la),me(),n.pendingContext&&=(n.context=n.pendingContext,null),(e===null||e.child===null)&&(Ui(t)?Lc(t):e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Gi())),Hc(t),null;case 26:var a=t.type,o=t.memoizedState;return e===null?(Lc(t),o===null?(Hc(t),Rc(t,a,null,r,n)):(Hc(t),zc(t,o))):o?o===e.memoizedState?(Hc(t),t.flags&=-16777217):(Lc(t),Hc(t),zc(t,o)):(e=e.memoizedProps,e!==r&&Lc(t),Hc(t),Rc(t,a,e,r,n)),null;case 27:if(ge(t),n=de.current,a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Lc(t);else{if(!r){if(t.stateNode===null)throw Error(i(166));return Hc(t),null}e=le.current,Ui(t)?Vi(t,e):(e=bf(a,r,n),t.stateNode=e,Lc(t))}return Hc(t),null;case 5:if(ge(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Lc(t);else{if(!r){if(t.stateNode===null)throw Error(i(166));return Hc(t),null}if(o=le.current,Ui(t))Vi(t,o);else{var s=Xd(de.current);switch(o){case 1:o=s.createElementNS(`http://www.w3.org/2000/svg`,a);break;case 2:o=s.createElementNS(`http://www.w3.org/1998/Math/MathML`,a);break;default:switch(a){case`svg`:o=s.createElementNS(`http://www.w3.org/2000/svg`,a);break;case`math`:o=s.createElementNS(`http://www.w3.org/1998/Math/MathML`,a);break;case`script`:o=s.createElement(`div`),o.innerHTML=`<script><\/script>`,o=o.removeChild(o.firstChild);break;case`select`:o=typeof r.is==`string`?s.createElement(`select`,{is:r.is}):s.createElement(`select`),r.multiple?o.multiple=!0:r.size&&(o.size=r.size);break;default:o=typeof r.is==`string`?s.createElement(a,{is:r.is}):s.createElement(a)}}o[lt]=t,o[ut]=r;a:for(s=t.child;s!==null;){if(s.tag===5||s.tag===6)o.appendChild(s.stateNode);else if(s.tag!==4&&s.tag!==27&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break a;for(;s.sibling===null;){if(s.return===null||s.return===t)break a;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=o;a:switch(Wd(o,a,r),a){case`button`:case`input`:case`select`:case`textarea`:r=!!r.autoFocus;break a;case`img`:r=!0;break a;default:r=!1}r&&Lc(t)}}return Hc(t),Rc(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==r&&Lc(t);else{if(typeof r!=`string`&&t.stateNode===null)throw Error(i(166));if(e=de.current,Ui(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,a=Pi,a!==null)switch(a.tag){case 27:case 5:r=a.memoizedProps}e[lt]=t,e=!!(e.nodeValue===n||r!==null&&!0===r.suppressHydrationWarning||Vd(e.nodeValue,n)),e||Bi(t,!0)}else e=Xd(e).createTextNode(r),e[lt]=t,t.stateNode=e}return Hc(t),null;case 31:if(n=t.memoizedState,e===null||e.memoizedState!==null){if(r=Ui(t),n!==null){if(e===null){if(!r)throw Error(i(318));if(e=t.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(557));e[lt]=t}else Wi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Hc(t),e=!1}else n=Gi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return t.flags&256?(fo(t),t):(fo(t),null);if(t.flags&128)throw Error(i(558))}return Hc(t),null;case 13:if(r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(a=Ui(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(i(318));if(a=t.memoizedState,a=a===null?null:a.dehydrated,!a)throw Error(i(317));a[lt]=t}else Wi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Hc(t),a=!1}else a=Gi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return t.flags&256?(fo(t),t):(fo(t),null)}return fo(t),t.flags&128?(t.lanes=n,t):(n=r!==null,e=e!==null&&e.memoizedState!==null,n&&(r=t.child,a=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(a=r.alternate.memoizedState.cachePool.pool),o=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),o!==a&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),Bc(t,t.updateQueue),Hc(t),null);case 4:return me(),e===null&&jd(t.stateNode.containerInfo),Hc(t),null;case 10:return Zi(t.type),Hc(t),null;case 19:if(se(po),r=t.memoizedState,r===null)return Hc(t),null;if(a=(t.flags&128)!=0,o=r.rendering,o===null)if(a)Vc(r,!1);else{if(tu!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=mo(e),o!==null){for(t.flags|=128,Vc(r,!1),e=o.updateQueue,t.updateQueue=e,Bc(t,e),t.subtreeFlags=0,e=n,n=t.child;n!==null;)fi(n,e),n=n.sibling;return ce(po,po.current&1|2),Ii&&ki(t,r.treeForkCount),t.child}e=e.sibling}r.tail!==null&&ke()>fu&&(t.flags|=128,a=!0,Vc(r,!1),t.lanes=4194304)}else{if(!a)if(e=mo(o),e!==null){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,Bc(t,e),Vc(r,!0),r.tail===null&&r.tailMode===`hidden`&&!o.alternate&&!Ii)return Hc(t),null}else 2*ke()-r.renderingStartTime>fu&&n!==536870912&&(t.flags|=128,a=!0,Vc(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(e=r.last,e===null?t.child=o:e.sibling=o,r.last=o)}return r.tail===null?(Hc(t),null):(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ke(),e.sibling=null,n=po.current,ce(po,a?n&1|2:n&1),Ii&&ki(t,r.treeForkCount),e);case 22:case 23:return fo(t),io(),r=t.memoizedState!==null,e===null?r&&(t.flags|=8192):e.memoizedState!==null!==r&&(t.flags|=8192),r?n&536870912&&!(t.flags&128)&&(Hc(t),t.subtreeFlags&6&&(t.flags|=8192)):Hc(t),n=t.updateQueue,n!==null&&Bc(t,n.retryQueue),n=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),r=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),e!==null&&se(ba),null;case 24:return n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Zi(la),Hc(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function Wc(e,t){switch(Mi(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Zi(la),me(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return ge(t),null;case 31:if(t.memoizedState!==null){if(fo(t),t.alternate===null)throw Error(i(340));Wi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(fo(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));Wi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return se(po),null;case 4:return me(),null;case 10:return Zi(t.type),null;case 22:case 23:return fo(t),io(),e!==null&&se(ba),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Zi(la),null;case 25:return null;default:return null}}function Gc(e,t){switch(Mi(t),t.tag){case 3:Zi(la),me();break;case 26:case 27:case 5:ge(t);break;case 4:me();break;case 31:t.memoizedState!==null&&fo(t);break;case 13:fo(t);break;case 19:se(po);break;case 10:Zi(t.type);break;case 22:case 23:fo(t),io(),e!==null&&se(ba);break;case 24:Zi(la)}}function Kc(e,t){try{var n=t.updateQueue,r=n===null?null:n.lastEffect;if(r!==null){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(e){$u(t,t.return,e)}}function qc(e,t,n){try{var r=t.updateQueue,i=r===null?null:r.lastEffect;if(i!==null){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(s!==void 0){o.destroy=void 0,i=t;var c=n,l=s;try{l()}catch(e){$u(i,c,e)}}}r=r.next}while(r!==a)}}catch(e){$u(t,t.return,e)}}function Jc(e){var t=e.updateQueue;if(t!==null){var n=e.stateNode;try{$a(t,n)}catch(t){$u(e,e.return,t)}}}function Yc(e,t,n){n.props=Zs(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(n){$u(e,t,n)}}function Xc(e,t){try{var n=e.ref;if(n!==null){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;case 30:r=e.stateNode;break;default:r=e.stateNode}typeof n==`function`?e.refCleanup=n(r):n.current=r}}catch(n){$u(e,t,n)}}function Zc(e,t){var n=e.ref,r=e.refCleanup;if(n!==null)if(typeof r==`function`)try{r()}catch(n){$u(e,t,n)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof n==`function`)try{n(null)}catch(n){$u(e,t,n)}else n.current=null}function Qc(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{a:switch(t){case`button`:case`input`:case`select`:case`textarea`:n.autoFocus&&r.focus();break a;case`img`:n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(t){$u(e,e.return,t)}}function $c(e,t,n){try{var r=e.stateNode;Gd(r,e.type,n,t),r[ut]=t}catch(t){$u(e,e.return,t)}}function el(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&of(e.type)||e.tag===4}function tl(e){a:for(;;){for(;e.sibling===null;){if(e.return===null||el(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&of(e.type)||e.flags&2||e.child===null||e.tag===4)continue a;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function nl(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?(n.nodeType===9?n.body:n.nodeName===`HTML`?n.ownerDocument.body:n).insertBefore(e,t):(t=n.nodeType===9?n.body:n.nodeName===`HTML`?n.ownerDocument.body:n,t.appendChild(e),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=nn));else if(r!==4&&(r===27&&of(e.type)&&(n=e.stateNode,t=null),e=e.child,e!==null))for(nl(e,t,n),e=e.sibling;e!==null;)nl(e,t,n),e=e.sibling}function rl(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(r===27&&of(e.type)&&(n=e.stateNode),e=e.child,e!==null))for(rl(e,t,n),e=e.sibling;e!==null;)rl(e,t,n),e=e.sibling}function il(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);Wd(t,r,n),t[lt]=e,t[ut]=n}catch(t){$u(e,e.return,t)}}var al=!1,ol=!1,sl=!1,cl=typeof WeakSet==`function`?WeakSet:Set,ll=null;function ul(e,t){if(e=e.containerInfo,Jd=dp,e=kr(e),Ar(e)){if(`selectionStart`in e)var n={start:e.selectionStart,end:e.selectionEnd};else a:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break a}var s=0,c=-1,l=-1,u=0,d=0,f=e,p=null;b:for(;;){for(var m;f!==n||a!==0&&f.nodeType!==3||(c=s+a),f!==o||r!==0&&f.nodeType!==3||(l=s+r),f.nodeType===3&&(s+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===e)break b;if(p===n&&++u===a&&(c=s),p===o&&++d===r&&(l=s),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}n=c===-1||l===-1?null:{start:c,end:l}}else n=null}n||={start:0,end:0}}else n=null;for(Yd={focusedElem:e,selectionRange:n},dp=!1,ll=t;ll!==null;)if(t=ll,e=t.child,t.subtreeFlags&1028&&e!==null)e.return=t,ll=e;else for(;ll!==null;){switch(t=ll,o=t.alternate,e=t.flags,t.tag){case 0:if(e&4&&(e=t.updateQueue,e=e===null?null:e.events,e!==null))for(n=0;n<e.length;n++)a=e[n],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(e&1024&&o!==null){e=void 0,n=t,a=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var h=Zs(n.type,a);e=r.getSnapshotBeforeUpdate(h,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(e){$u(n,n.return,e)}}break;case 3:if(e&1024){if(e=t.stateNode.containerInfo,n=e.nodeType,n===9)lf(e);else if(n===1)switch(e.nodeName){case`HEAD`:case`HTML`:case`BODY`:lf(e);break;default:e.textContent=``}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(e&1024)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,ll=e;break}ll=t.return}}function dl(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:El(e,n),r&4&&Kc(5,n);break;case 1:if(El(e,n),r&4)if(e=n.stateNode,t===null)try{e.componentDidMount()}catch(e){$u(n,n.return,e)}else{var i=Zs(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){$u(n,n.return,e)}}r&64&&Jc(n),r&512&&Xc(n,n.return);break;case 3:if(El(e,n),r&64&&(e=n.updateQueue,e!==null)){if(t=null,n.child!==null)switch(n.child.tag){case 27:case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}try{$a(e,t)}catch(e){$u(n,n.return,e)}}break;case 27:t===null&&r&4&&il(n);case 26:case 5:El(e,n),t===null&&r&4&&Qc(n),r&512&&Xc(n,n.return);break;case 12:El(e,n);break;case 31:El(e,n),r&4&&_l(e,n);break;case 13:El(e,n),r&4&&vl(e,n),r&64&&(e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(n=rd.bind(null,n),hf(e,n))));break;case 22:if(r=n.memoizedState!==null||al,!r){t=t!==null&&t.memoizedState!==null||ol,i=al;var a=ol;al=r,(ol=t)&&!a?Ol(e,n,(n.subtreeFlags&8772)!=0):El(e,n),al=i,ol=a}break;case 30:break;default:El(e,n)}}function fl(e){var t=e.alternate;t!==null&&(e.alternate=null,fl(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&_t(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var pl=null,ml=!1;function hl(e,t,n){for(n=n.child;n!==null;)gl(e,t,n),n=n.sibling}function gl(e,t,n){if(ze&&typeof ze.onCommitFiberUnmount==`function`)try{ze.onCommitFiberUnmount(Re,n)}catch{}switch(n.tag){case 26:ol||Zc(n,t),hl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:ol||Zc(n,t);var r=pl,i=ml;of(n.type)&&(pl=n.stateNode,ml=!1),hl(e,t,n),xf(n.stateNode),pl=r,ml=i;break;case 5:ol||Zc(n,t);case 6:if(r=pl,i=ml,pl=null,hl(e,t,n),pl=r,ml=i,pl!==null)if(ml)try{(pl.nodeType===9?pl.body:pl.nodeName===`HTML`?pl.ownerDocument.body:pl).removeChild(n.stateNode)}catch(e){$u(n,t,e)}else try{pl.removeChild(n.stateNode)}catch(e){$u(n,t,e)}break;case 18:pl!==null&&(ml?(e=pl,sf(e.nodeType===9?e.body:e.nodeName===`HTML`?e.ownerDocument.body:e,n.stateNode),Lp(e)):sf(pl,n.stateNode));break;case 4:r=pl,i=ml,pl=n.stateNode.containerInfo,ml=!0,hl(e,t,n),pl=r,ml=i;break;case 0:case 11:case 14:case 15:qc(2,n,t),ol||qc(4,n,t),hl(e,t,n);break;case 1:ol||(Zc(n,t),r=n.stateNode,typeof r.componentWillUnmount==`function`&&Yc(n,t,r)),hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:ol=(r=ol)||n.memoizedState!==null,hl(e,t,n),ol=r;break;default:hl(e,t,n)}}function _l(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Lp(e)}catch(e){$u(t,t.return,e)}}}function vl(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Lp(e)}catch(e){$u(t,t.return,e)}}function yl(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new cl),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new cl),t;default:throw Error(i(435,e.tag))}}function bl(e,t){var n=yl(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=see.bind(null,e,t);t.then(r,r)}})}function xl(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r],o=e,s=t,c=s;a:for(;c!==null;){switch(c.tag){case 27:if(of(c.type)){pl=c.stateNode,ml=!1;break a}break;case 5:pl=c.stateNode,ml=!1;break a;case 3:case 4:pl=c.stateNode.containerInfo,ml=!0;break a}c=c.return}if(pl===null)throw Error(i(160));gl(o,s,a),pl=null,ml=!1,o=a.alternate,o!==null&&(o.return=null),a.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)Cl(t,e),t=t.sibling}var Sl=null;function Cl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:xl(t,e),wl(e),r&4&&(qc(3,e,e.return),Kc(3,e),qc(5,e,e.return));break;case 1:xl(t,e),wl(e),r&512&&(ol||n===null||Zc(n,n.return)),r&64&&al&&(e=e.updateQueue,e!==null&&(r=e.callbacks,r!==null&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=n===null?r:n.concat(r))));break;case 26:var a=Sl;if(xl(t,e),wl(e),r&512&&(ol||n===null||Zc(n,n.return)),r&4){var o=n===null?null:n.memoizedState;if(r=e.memoizedState,n===null)if(r===null)if(e.stateNode===null){a:{r=e.type,n=e.memoizedProps,a=a.ownerDocument||a;b:switch(r){case`title`:o=a.getElementsByTagName(`title`)[0],(!o||o[gt]||o[lt]||o.namespaceURI===`http://www.w3.org/2000/svg`||o.hasAttribute(`itemprop`))&&(o=a.createElement(r),a.head.insertBefore(o,a.querySelector(`head > title`))),Wd(o,r,n),o[lt]=e,St(o),r=o;break a;case`link`:var s=Gf(`link`,`href`,a).get(r+(n.href||``));if(s){for(var c=0;c<s.length;c++)if(o=s[c],o.getAttribute(`href`)===(n.href==null||n.href===``?null:n.href)&&o.getAttribute(`rel`)===(n.rel==null?null:n.rel)&&o.getAttribute(`title`)===(n.title==null?null:n.title)&&o.getAttribute(`crossorigin`)===(n.crossOrigin==null?null:n.crossOrigin)){s.splice(c,1);break b}}o=a.createElement(r),Wd(o,r,n),a.head.appendChild(o);break;case`meta`:if(s=Gf(`meta`,`content`,a).get(r+(n.content||``))){for(c=0;c<s.length;c++)if(o=s[c],o.getAttribute(`content`)===(n.content==null?null:``+n.content)&&o.getAttribute(`name`)===(n.name==null?null:n.name)&&o.getAttribute(`property`)===(n.property==null?null:n.property)&&o.getAttribute(`http-equiv`)===(n.httpEquiv==null?null:n.httpEquiv)&&o.getAttribute(`charset`)===(n.charSet==null?null:n.charSet)){s.splice(c,1);break b}}o=a.createElement(r),Wd(o,r,n),a.head.appendChild(o);break;default:throw Error(i(468,r))}o[lt]=e,St(o),r=o}e.stateNode=r}else Kf(a,e.type,e.stateNode);else e.stateNode=Bf(a,r,e.memoizedProps);else o===r?r===null&&e.stateNode!==null&&$c(e,e.memoizedProps,n.memoizedProps):(o===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):o.count--,r===null?Kf(a,e.type,e.stateNode):Bf(a,r,e.memoizedProps))}break;case 27:xl(t,e),wl(e),r&512&&(ol||n===null||Zc(n,n.return)),n!==null&&r&4&&$c(e,e.memoizedProps,n.memoizedProps);break;case 5:if(xl(t,e),wl(e),r&512&&(ol||n===null||Zc(n,n.return)),e.flags&32){a=e.stateNode;try{Jt(a,``)}catch(t){$u(e,e.return,t)}}r&4&&e.stateNode!=null&&(a=e.memoizedProps,$c(e,a,n===null?a:n.memoizedProps)),r&1024&&(sl=!0);break;case 6:if(xl(t,e),wl(e),r&4){if(e.stateNode===null)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(t){$u(e,e.return,t)}}break;case 3:if(Wf=null,a=Sl,Sl=wf(t.containerInfo),xl(t,e),Sl=a,wl(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Lp(t.containerInfo)}catch(t){$u(e,e.return,t)}sl&&(sl=!1,Tl(e));break;case 4:r=Sl,Sl=wf(e.stateNode.containerInfo),xl(t,e),wl(e),Sl=r;break;case 12:xl(t,e),wl(e);break;case 31:xl(t,e),wl(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,bl(e,r)));break;case 13:xl(t,e),wl(e),e.child.flags&8192&&e.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(uu=ke()),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,bl(e,r)));break;case 22:a=e.memoizedState!==null;var l=n!==null&&n.memoizedState!==null,u=al,d=ol;if(al=u||a,ol=d||l,xl(t,e),ol=d,al=u,wl(e),r&8192)a:for(t=e.stateNode,t._visibility=a?t._visibility&-2:t._visibility|1,a&&(n===null||l||al||ol||Dl(e)),n=null,t=e;;){if(t.tag===5||t.tag===26){if(n===null){l=n=t;try{if(o=l.stateNode,a)s=o.style,typeof s.setProperty==`function`?s.setProperty(`display`,`none`,`important`):s.display=`none`;else{c=l.stateNode;var f=l.memoizedProps.style,p=f!=null&&f.hasOwnProperty(`display`)?f.display:null;c.style.display=p==null||typeof p==`boolean`?``:(``+p).trim()}}catch(e){$u(l,l.return,e)}}}else if(t.tag===6){if(n===null){l=t;try{l.stateNode.nodeValue=a?``:l.memoizedProps}catch(e){$u(l,l.return,e)}}}else if(t.tag===18){if(n===null){l=t;try{var m=l.stateNode;a?cf(m,!0):cf(l.stateNode,!1)}catch(e){$u(l,l.return,e)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break a;for(;t.sibling===null;){if(t.return===null||t.return===e)break a;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}r&4&&(r=e.updateQueue,r!==null&&(n=r.retryQueue,n!==null&&(r.retryQueue=null,bl(e,n))));break;case 19:xl(t,e),wl(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,bl(e,r)));break;case 30:break;case 21:break;default:xl(t,e),wl(e)}}function wl(e){var t=e.flags;if(t&2){try{for(var n,r=e.return;r!==null;){if(el(r)){n=r;break}r=r.return}if(n==null)throw Error(i(160));switch(n.tag){case 27:var a=n.stateNode;rl(e,tl(e),a);break;case 5:var o=n.stateNode;n.flags&32&&(Jt(o,``),n.flags&=-33),rl(e,tl(e),o);break;case 3:case 4:var s=n.stateNode.containerInfo;nl(e,tl(e),s);break;default:throw Error(i(161))}}catch(t){$u(e,e.return,t)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Tl(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Tl(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function El(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)dl(e,t.alternate,t),t=t.sibling}function Dl(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:qc(4,t,t.return),Dl(t);break;case 1:Zc(t,t.return);var n=t.stateNode;typeof n.componentWillUnmount==`function`&&Yc(t,t.return,n),Dl(t);break;case 27:xf(t.stateNode);case 26:case 5:Zc(t,t.return),Dl(t);break;case 22:t.memoizedState===null&&Dl(t);break;case 30:Dl(t);break;default:Dl(t)}e=e.sibling}}function Ol(e,t,n){for(n&&=(t.subtreeFlags&8772)!=0,t=t.child;t!==null;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:Ol(i,a,n),Kc(4,a);break;case 1:if(Ol(i,a,n),r=a,i=r.stateNode,typeof i.componentDidMount==`function`)try{i.componentDidMount()}catch(e){$u(r,r.return,e)}if(r=a,i=r.updateQueue,i!==null){var s=r.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)Qa(c[i],s)}catch(e){$u(r,r.return,e)}}n&&o&64&&Jc(a),Xc(a,a.return);break;case 27:il(a);case 26:case 5:Ol(i,a,n),n&&r===null&&o&4&&Qc(a),Xc(a,a.return);break;case 12:Ol(i,a,n);break;case 31:Ol(i,a,n),n&&o&4&&_l(i,a);break;case 13:Ol(i,a,n),n&&o&4&&vl(i,a);break;case 22:a.memoizedState===null&&Ol(i,a,n),Xc(a,a.return);break;case 30:break;default:Ol(i,a,n)}t=t.sibling}}function kl(e,t){var n=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==n&&(e!=null&&e.refCount++,n!=null&&da(n))}function Al(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&da(e))}function jl(e,t,n,r){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Ml(e,t,n,r),t=t.sibling}function Ml(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:jl(e,t,n,r),i&2048&&Kc(9,t);break;case 1:jl(e,t,n,r);break;case 3:jl(e,t,n,r),i&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&da(e)));break;case 12:if(i&2048){jl(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;typeof s==`function`&&s(o,t.alternate===null?`mount`:`update`,e.passiveEffectDuration,-0)}catch(e){$u(t,t.return,e)}}else jl(e,t,n,r);break;case 31:jl(e,t,n,r);break;case 13:jl(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,t.memoizedState===null?a._visibility&2?jl(e,t,n,r):(a._visibility|=2,Nl(e,t,n,r,(t.subtreeFlags&10256)!=0||!1)):a._visibility&2?jl(e,t,n,r):Pl(e,t),i&2048&&kl(o,t);break;case 24:jl(e,t,n,r),i&2048&&Al(t.alternate,t);break;default:jl(e,t,n,r)}}function Nl(e,t,n,r,i){for(i&&=(t.subtreeFlags&10256)!=0||!1,t=t.child;t!==null;){var a=e,o=t,s=n,c=r,l=o.flags;switch(o.tag){case 0:case 11:case 15:Nl(a,o,s,c,i),Kc(8,o);break;case 23:break;case 22:var u=o.stateNode;o.memoizedState===null?(u._visibility|=2,Nl(a,o,s,c,i)):u._visibility&2?Nl(a,o,s,c,i):Pl(a,o),i&&l&2048&&kl(o.alternate,o);break;case 24:Nl(a,o,s,c,i),i&&l&2048&&Al(o.alternate,o);break;default:Nl(a,o,s,c,i)}t=t.sibling}}function Pl(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Pl(n,r),i&2048&&kl(r.alternate,r);break;case 24:Pl(n,r),i&2048&&Al(r.alternate,r);break;default:Pl(n,r)}t=t.sibling}}var Fl=8192;function Il(e,t,n){if(e.subtreeFlags&Fl)for(e=e.child;e!==null;)Ll(e,t,n),e=e.sibling}function Ll(e,t,n){switch(e.tag){case 26:Il(e,t,n),e.flags&Fl&&e.memoizedState!==null&&Yf(n,Sl,e.memoizedState,e.memoizedProps);break;case 5:Il(e,t,n);break;case 3:case 4:var r=Sl;Sl=wf(e.stateNode.containerInfo),Il(e,t,n),Sl=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=Fl,Fl=16777216,Il(e,t,n),Fl=r):Il(e,t,n));break;default:Il(e,t,n)}}function Rl(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function zl(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];ll=r,Hl(r,e)}Rl(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Bl(e),e=e.sibling}function Bl(e){switch(e.tag){case 0:case 11:case 15:zl(e),e.flags&2048&&qc(9,e,e.return);break;case 3:zl(e);break;case 12:zl(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Vl(e)):zl(e);break;default:zl(e)}}function Vl(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];ll=r,Hl(r,e)}Rl(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:qc(8,t,t.return),Vl(t);break;case 22:n=t.stateNode,n._visibility&2&&(n._visibility&=-3,Vl(t));break;default:Vl(t)}e=e.sibling}}function Hl(e,t){for(;ll!==null;){var n=ll;switch(n.tag){case 0:case 11:case 15:qc(8,n,t);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var r=n.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:da(n.memoizedState.cache)}if(r=n.child,r!==null)r.return=n,ll=r;else a:for(n=e;ll!==null;){r=ll;var i=r.sibling,a=r.return;if(fl(r),r===n){ll=null;break a}if(i!==null){i.return=a,ll=i;break a}ll=a}}}var Ul={getCacheForType:function(e){var t=ra(la),n=t.data.get(e);return n===void 0&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return ra(la).controller.signal}},Wl=typeof WeakMap==`function`?WeakMap:Map,Gl=0,Kl=null,ql=null,Jl=0,Yl=0,Xl=null,Zl=!1,Ql=!1,$l=!1,eu=0,tu=0,nu=0,ru=0,iu=0,au=0,ou=0,su=null,cu=null,lu=!1,uu=0,du=0,fu=1/0,pu=null,mu=null,hu=0,gu=null,_u=null,vu=0,yu=0,bu=null,xu=null,Su=0,Cu=null;function wu(){return Gl&2&&Jl!==0?Jl&-Jl:P.T===null?ot():yd()}function Tu(){if(au===0)if(!(Jl&536870912)||Ii){var e=Ke;Ke<<=1,!(Ke&3932160)&&(Ke=262144),au=e}else au=536870912;return e=ao.current,e!==null&&(e.flags|=32),au}function Eu(e,t,n){(e===Kl&&(Yl===2||Yl===9)||e.cancelPendingCommit!==null)&&(Nu(e,0),Au(e,Jl,au,!1)),$e(e,n),(!(Gl&2)||e!==Kl)&&(e===Kl&&(!(Gl&2)&&(ru|=n),tu===4&&Au(e,Jl,au,!1)),dd(e))}function Du(e,t,n){if(Gl&6)throw Error(i(327));var r=!n&&(t&127)==0&&(t&e.expiredLanes)===0||Xe(e,t),a=r?aee(e,t):zu(e,t,!0),o=r;do{if(a===0){Ql&&!r&&Au(e,t,0,!1);break}else{if(n=e.current.alternate,o&&!ku(n)){a=zu(e,t,!1),o=!1;continue}if(a===2){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=e.pendingLanes&-536870913,s=s===0?s&536870912?536870912:0:s;if(s!==0){t=s;a:{var c=e;a=su;var l=c.current.memoizedState.isDehydrated;if(l&&(Nu(c,s).flags|=256),s=zu(c,s,!1),s!==2){if($l&&!l){c.errorRecoveryDisabledLanes|=o,ru|=o,a=4;break a}o=cu,cu=a,o!==null&&(cu===null?cu=o:cu.push.apply(cu,o))}a=s}if(o=!1,a!==2)continue}}if(a===1){Nu(e,0),Au(e,t,0,!0);break}a:{switch(r=e,o=a,o){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:Au(r,t,au,!Zl);break a;case 2:cu=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(a=uu+300-ke(),10<a)){if(Au(r,t,au,!Zl),Ye(r,0,!0)!==0)break a;vu=t,r.timeoutHandle=tf(Ou.bind(null,r,n,cu,pu,lu,t,au,ru,ou,Zl,o,`Throttled`,-0,0),a);break a}Ou(r,n,cu,pu,lu,t,au,ru,ou,Zl,o,null,-0,0)}}break}while(1);dd(e)}function Ou(e,t,n,r,i,a,o,s,c,l,u,d,f,p){if(e.timeoutHandle=-1,d=t.subtreeFlags,d&8192||(d&16785408)==16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:nn},Ll(t,a,d);var m=(a&62914560)===a?uu-ke():(a&4194048)===a?du-ke():0;if(m=Zf(d,m),m!==null){vu=a,e.cancelPendingCommit=m(Gu.bind(null,e,t,a,n,r,i,o,s,c,u,d,null,f,p)),Au(e,a,o,!l);return}}Gu(e,t,a,n,r,i,o,s,c)}function ku(e){for(var t=e;;){var n=t.tag;if((n===0||n===11||n===15)&&t.flags&16384&&(n=t.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!wr(a(),i))return!1}catch{return!1}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Au(e,t,n,r){t&=~iu,t&=~ru,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Ve(i),o=1<<a;r[a]=-1,i&=~o}n!==0&&tt(e,n,t)}function ju(){return Gl&6?!0:(fd(0,!1),!1)}function Mu(){if(ql!==null){if(Yl===0)var e=ql.return;else e=ql,Yi=Ji=null,Po(e),Pa=null,Fa=0,e=ql;for(;e!==null;)Gc(e.alternate,e),e=e.return;ql=null}}function Nu(e,t){var n=e.timeoutHandle;n!==-1&&(e.timeoutHandle=-1,lee(n)),n=e.cancelPendingCommit,n!==null&&(e.cancelPendingCommit=null,n()),vu=0,Mu(),Kl=e,ql=n=di(e.current,null),Jl=t,Yl=0,Xl=null,Zl=!1,Ql=Xe(e,t),$l=!1,ou=au=iu=ru=nu=tu=0,cu=su=null,lu=!1,t&8&&(t|=t&32);var r=e.entangledLanes;if(r!==0)for(e=e.entanglements,r&=t;0<r;){var i=31-Ve(r),a=1<<i;t|=e[i],r&=~a}return eu=t,ti(),n}function Pu(e,t){go=null,P.H=Us,t===wa||t===Ea?(t=Ma(),Yl=3):t===Ta?(t=Ma(),Yl=4):Yl=t===sc?8:typeof t==`object`&&t&&typeof t.then==`function`?6:1,Xl=t,ql===null&&(tu=1,tc(e,yi(t,e.current)))}function Fu(){var e=ao.current;return e===null?!0:(Jl&4194048)===Jl?oo===null:(Jl&62914560)===Jl||Jl&536870912?e===oo:!1}function Iu(){var e=P.H;return P.H=Us,e===null?Us:e}function Lu(){var e=P.A;return P.A=Ul,e}function Ru(){tu=4,Zl||(Jl&4194048)!==Jl&&ao.current!==null||(Ql=!0),!(nu&134217727)&&!(ru&134217727)||Kl===null||Au(Kl,Jl,au,!1)}function zu(e,t,n){var r=Gl;Gl|=2;var i=Iu(),a=Lu();(Kl!==e||Jl!==t)&&(pu=null,Nu(e,t)),t=!1;var o=tu;a:do try{if(Yl!==0&&ql!==null){var s=ql,c=Xl;switch(Yl){case 8:Mu(),o=6;break a;case 3:case 2:case 9:case 6:ao.current===null&&(t=!0);var l=Yl;if(Yl=0,Xl=null,Hu(e,s,c,l),n&&Ql){o=0;break a}break;default:l=Yl,Yl=0,Xl=null,Hu(e,s,c,l)}}iee(),o=tu;break}catch(t){Pu(e,t)}while(1);return t&&e.shellSuspendCounter++,Yi=Ji=null,Gl=r,P.H=i,P.A=a,ql===null&&(Kl=null,Jl=0,ti()),o}function iee(){for(;ql!==null;)Bu(ql)}function aee(e,t){var n=Gl;Gl|=2;var r=Iu(),a=Lu();Kl!==e||Jl!==t?(pu=null,fu=ke()+500,Nu(e,t)):Ql=Xe(e,t);a:do try{if(Yl!==0&&ql!==null){t=ql;var o=Xl;b:switch(Yl){case 1:Yl=0,Xl=null,Hu(e,t,o,1);break;case 2:case 9:if(Oa(o)){Yl=0,Xl=null,Vu(t);break}t=function(){Yl!==2&&Yl!==9||Kl!==e||(Yl=7),dd(e)},o.then(t,t);break a;case 3:Yl=7;break a;case 4:Yl=5;break a;case 7:Oa(o)?(Yl=0,Xl=null,Vu(t)):(Yl=0,Xl=null,Hu(e,t,o,7));break;case 5:var s=null;switch(ql.tag){case 26:s=ql.memoizedState;case 5:case 27:var c=ql;if(s?Jf(s):c.stateNode.complete){Yl=0,Xl=null;var l=c.sibling;if(l!==null)ql=l;else{var u=c.return;u===null?ql=null:(ql=u,Uu(u))}break b}}Yl=0,Xl=null,Hu(e,t,o,5);break;case 6:Yl=0,Xl=null,Hu(e,t,o,6);break;case 8:Mu(),tu=6;break a;default:throw Error(i(462))}}oee();break}catch(t){Pu(e,t)}while(1);return Yi=Ji=null,P.H=r,P.A=a,Gl=n,ql===null?(Kl=null,Jl=0,ti(),tu):0}function oee(){for(;ql!==null&&!De();)Bu(ql)}function Bu(e){var t=Ic(e.alternate,e,eu);e.memoizedProps=e.pendingProps,t===null?Uu(e):ql=t}function Vu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=xc(n,t,t.pendingProps,t.type,void 0,Jl);break;case 11:t=xc(n,t,t.pendingProps,t.type.render,t.ref,Jl);break;case 5:Po(t);default:Gc(n,t),t=ql=fi(t,eu),t=Ic(n,t,eu)}e.memoizedProps=e.pendingProps,t===null?Uu(e):ql=t}function Hu(e,t,n,r){Yi=Ji=null,Po(t),Pa=null,Fa=0;var i=t.return;try{if(oc(e,i,t,n,Jl)){tu=1,tc(e,yi(n,e.current)),ql=null;return}}catch(t){if(i!==null)throw ql=i,t;tu=1,tc(e,yi(n,e.current)),ql=null;return}t.flags&32768?(Ii||r===1?e=!0:Ql||Jl&536870912?e=!1:(Zl=e=!0,(r===2||r===9||r===3||r===6)&&(r=ao.current,r!==null&&r.tag===13&&(r.flags|=16384))),Wu(t,e)):Uu(t)}function Uu(e){var t=e;do{if(t.flags&32768){Wu(t,Zl);return}e=t.return;var n=Uc(t.alternate,t,eu);if(n!==null){ql=n;return}if(t=t.sibling,t!==null){ql=t;return}ql=t=e}while(t!==null);tu===0&&(tu=5)}function Wu(e,t){do{var n=Wc(e.alternate,e);if(n!==null){n.flags&=32767,ql=n;return}if(n=e.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&(e=e.sibling,e!==null)){ql=e;return}ql=e=n}while(e!==null);tu=6,ql=null}function Gu(e,t,n,r,a,o,s,c,l){e.cancelPendingCommit=null;do Xu();while(hu!==0);if(Gl&6)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(o=t.lanes|t.childLanes,o|=ei,et(e,n,o,s,c,l),e===Kl&&(ql=Kl=null,Jl=0),_u=t,gu=e,vu=n,yu=o,bu=a,xu=r,t.subtreeFlags&10256||t.flags&10256?(e.callbackNode=null,e.callbackPriority=0,id(Ne,function(){return Zu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=(t.flags&13878)!=0,t.subtreeFlags&13878||r){r=P.T,P.T=null,a=ne.p,ne.p=2,s=Gl,Gl|=4;try{ul(e,t,n)}finally{Gl=s,ne.p=a,P.T=r}}hu=1,Ku(),qu(),Ju()}}function Ku(){if(hu===1){hu=0;var e=gu,t=_u,n=(t.flags&13878)!=0;if(t.subtreeFlags&13878||n){n=P.T,P.T=null;var r=ne.p;ne.p=2;var i=Gl;Gl|=4;try{Cl(t,e);var a=Yd,o=kr(e.containerInfo),s=a.focusedElem,c=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&Or(s.ownerDocument.documentElement,s)){if(c!==null&&Ar(s)){var l=c.start,u=c.end;if(u===void 0&&(u=l),`selectionStart`in s)s.selectionStart=l,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var p=f.getSelection(),m=s.textContent.length,h=Math.min(c.start,m),g=c.end===void 0?h:Math.min(c.end,m);!p.extend&&h>g&&(o=g,g=h,h=o);var _=Dr(s,h),v=Dr(s,g);if(_&&v&&(p.rangeCount!==1||p.anchorNode!==_.node||p.anchorOffset!==_.offset||p.focusNode!==v.node||p.focusOffset!==v.offset)){var y=d.createRange();y.setStart(_.node,_.offset),p.removeAllRanges(),h>g?(p.addRange(y),p.extend(v.node,v.offset)):(y.setEnd(v.node,v.offset),p.addRange(y))}}}}for(d=[],p=s;p=p.parentNode;)p.nodeType===1&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof s.focus==`function`&&s.focus(),s=0;s<d.length;s++){var b=d[s];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}dp=!!Jd,Yd=Jd=null}finally{Gl=i,ne.p=r,P.T=n}}e.current=t,hu=2}}function qu(){if(hu===2){hu=0;var e=gu,t=_u,n=(t.flags&8772)!=0;if(t.subtreeFlags&8772||n){n=P.T,P.T=null;var r=ne.p;ne.p=2;var i=Gl;Gl|=4;try{dl(e,t.alternate,t)}finally{Gl=i,ne.p=r,P.T=n}}hu=3}}function Ju(){if(hu===4||hu===3){hu=0,Oe();var e=gu,t=_u,n=vu,r=xu;t.subtreeFlags&10256||t.flags&10256?hu=5:(hu=0,_u=gu=null,Yu(e,e.pendingLanes));var i=e.pendingLanes;if(i===0&&(mu=null),at(n),t=t.stateNode,ze&&typeof ze.onCommitFiberRoot==`function`)try{ze.onCommitFiberRoot(Re,t,void 0,(t.current.flags&128)==128)}catch{}if(r!==null){t=P.T,i=ne.p,ne.p=2,P.T=null;try{for(var a=e.onRecoverableError,o=0;o<r.length;o++){var s=r[o];a(s.value,{componentStack:s.stack})}}finally{P.T=t,ne.p=i}}vu&3&&Xu(),dd(e),i=e.pendingLanes,n&261930&&i&42?e===Cu?Su++:(Su=0,Cu=e):Su=0,fd(0,!1)}}function Yu(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,da(t)))}function Xu(){return Ku(),qu(),Ju(),Zu()}function Zu(){if(hu!==5)return!1;var e=gu,t=yu;yu=0;var n=at(vu),r=P.T,a=ne.p;try{ne.p=32>n?32:n,P.T=null,n=bu,bu=null;var o=gu,s=vu;if(hu=0,_u=gu=null,vu=0,Gl&6)throw Error(i(331));var c=Gl;if(Gl|=4,Bl(o.current),Ml(o,o.current,s,n),Gl=c,fd(0,!1),ze&&typeof ze.onPostCommitFiberRoot==`function`)try{ze.onPostCommitFiberRoot(Re,o)}catch{}return!0}finally{ne.p=a,P.T=r,Yu(e,t)}}function Qu(e,t,n){t=yi(n,t),t=rc(e.stateNode,t,2),e=Ka(e,t,2),e!==null&&($e(e,2),dd(e))}function $u(e,t,n){if(e.tag===3)Qu(e,e,n);else for(;t!==null;){if(t.tag===3){Qu(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError==`function`||typeof r.componentDidCatch==`function`&&(mu===null||!mu.has(r))){e=yi(n,e),n=ic(2),r=Ka(t,n,2),r!==null&&(ac(n,r,t,e),$e(r,2),dd(r));break}}t=t.return}}function ed(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Wl;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||($l=!0,i.add(n),e=td.bind(null,e,t,n),t.then(e,e))}function td(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,Kl===e&&(Jl&n)===n&&(tu===4||tu===3&&(Jl&62914560)===Jl&&300>ke()-uu?!(Gl&2)&&Nu(e,0):iu|=n,ou===Jl&&(ou=0)),dd(e)}function nd(e,t){t===0&&(t=Ze()),e=ii(e,t),e!==null&&($e(e,t),dd(e))}function rd(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),nd(e,n)}function see(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}r!==null&&r.delete(t),nd(e,n)}function id(e,t){return Te(e,t)}var ad=null,od=null,sd=!1,cd=!1,ld=!1,ud=0;function dd(e){e!==od&&e.next===null&&(od===null?ad=od=e:od=od.next=e),cd=!0,sd||(sd=!0,vd())}function fd(e,t){if(!ld&&cd){ld=!0;do for(var n=!1,r=ad;r!==null;){if(!t)if(e!==0){var i=r.pendingLanes;if(i===0)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-Ve(42|e)+1)-1,a&=i&~(o&~s),a=a&201326741?a&201326741|1:a?a|2:0}a!==0&&(n=!0,_d(r,a))}else a=Jl,a=Ye(r,r===Kl?a:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),!(a&3)||Xe(r,a)||(n=!0,_d(r,a));r=r.next}while(n);ld=!1}}function pd(){md()}function md(){cd=sd=!1;var e=0;ud!==0&&cee()&&(e=ud);for(var t=ke(),n=null,r=ad;r!==null;){var i=r.next,a=hd(r,t);a===0?(r.next=null,n===null?ad=i:n.next=i,i===null&&(od=n)):(n=r,(e!==0||a&3)&&(cd=!0)),r=i}hu!==0&&hu!==5||fd(e,!1),ud!==0&&(ud=0)}function hd(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes&-62914561;0<a;){var o=31-Ve(a),s=1<<o,c=i[o];c===-1?((s&n)===0||(s&r)!==0)&&(i[o]=F(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}if(t=Kl,n=Jl,n=Ye(e,e===t?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r=e.callbackNode,n===0||e===t&&(Yl===2||Yl===9)||e.cancelPendingCommit!==null)return r!==null&&r!==null&&Ee(r),e.callbackNode=null,e.callbackPriority=0;if(!(n&3)||Xe(e,n)){if(t=n&-n,t===e.callbackPriority)return t;switch(r!==null&&Ee(r),at(n)){case 2:case 8:n=Me;break;case 32:n=Ne;break;case 268435456:n=Fe;break;default:n=Ne}return r=gd.bind(null,e),n=Te(n,r),e.callbackPriority=t,e.callbackNode=n,t}return r!==null&&r!==null&&Ee(r),e.callbackPriority=2,e.callbackNode=null,2}function gd(e,t){if(hu!==0&&hu!==5)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Xu()&&e.callbackNode!==n)return null;var r=Jl;return r=Ye(e,e===Kl?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r===0?null:(Du(e,r,t),hd(e,ke()),e.callbackNode!=null&&e.callbackNode===n?gd.bind(null,e):null)}function _d(e,t){if(Xu())return null;Du(e,t,!0)}function vd(){rf(function(){Gl&6?Te(je,pd):md()})}function yd(){if(ud===0){var e=ma;e===0&&(e=Ge,Ge<<=1,!(Ge&261888)&&(Ge=256)),ud=e}return ud}function bd(e){return e==null||typeof e==`symbol`||typeof e==`boolean`?null:typeof e==`function`?e:tn(``+e)}function xd(e,t){var n=t.ownerDocument.createElement(`input`);return n.name=t.name,n.value=t.value,e.id&&n.setAttribute(`form`,e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}function Sd(e,t,n,r,i){if(t===`submit`&&n&&n.stateNode===i){var a=bd((i[ut]||null).action),o=r.submitter;o&&(t=(t=o[ut]||null)?bd(t.formAction):o.getAttribute(`formAction`),t!==null&&(a=t,o=null));var s=new wn(`action`,`action`,null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(ud!==0){var e=o?xd(i,o):new FormData(i);As(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else typeof a==`function`&&(s.preventDefault(),e=o?xd(i,o):new FormData(i),As(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}for(var Cd=0;Cd<Yr.length;Cd++){var wd=Yr[Cd];Xr(wd.toLowerCase(),`on`+(wd[0].toUpperCase()+wd.slice(1)))}Xr(Hr,`onAnimationEnd`),Xr(Ur,`onAnimationIteration`),Xr(Wr,`onAnimationStart`),Xr(`dblclick`,`onDoubleClick`),Xr(`focusin`,`onFocus`),Xr(`focusout`,`onBlur`),Xr(tee,`onTransitionRun`),Xr(Gr,`onTransitionStart`),Xr(Kr,`onTransitionCancel`),Xr(qr,`onTransitionEnd`),Et(`onMouseEnter`,[`mouseout`,`mouseover`]),Et(`onMouseLeave`,[`mouseout`,`mouseover`]),Et(`onPointerEnter`,[`pointerout`,`pointerover`]),Et(`onPointerLeave`,[`pointerout`,`pointerover`]),Tt(`onChange`,`change click focusin focusout input keydown keyup selectionchange`.split(` `)),Tt(`onSelect`,`focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange`.split(` `)),Tt(`onBeforeInput`,[`compositionend`,`keypress`,`textInput`,`paste`]),Tt(`onCompositionEnd`,`compositionend focusout keydown keypress keyup mousedown`.split(` `)),Tt(`onCompositionStart`,`compositionstart focusout keydown keypress keyup mousedown`.split(` `)),Tt(`onCompositionUpdate`,`compositionupdate focusout keydown keypress keyup mousedown`.split(` `));var Td=`abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting`.split(` `),Ed=new Set(`beforetoggle cancel close invalid load scroll scrollend toggle`.split(` `).concat(Td));function Dd(e,t){t=(t&4)!=0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;a:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break a;a=s,i.currentTarget=l;try{a(i)}catch(e){Zr(e)}i.currentTarget=null,a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break a;a=s,i.currentTarget=l;try{a(i)}catch(e){Zr(e)}i.currentTarget=null,a=c}}}}function Od(e,t){var n=t[ft];n===void 0&&(n=t[ft]=new Set);var r=e+`__bubble`;n.has(r)||(Md(t,e,2,!1),n.add(r))}function kd(e,t,n){var r=0;t&&(r|=4),Md(n,e,r,t)}var Ad=`_reactListening`+Math.random().toString(36).slice(2);function jd(e){if(!e[Ad]){e[Ad]=!0,Ct.forEach(function(t){t!==`selectionchange`&&(Ed.has(t)||kd(t,!1,e),kd(t,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ad]||(t[Ad]=!0,kd(`selectionchange`,!1,t))}}function Md(e,t,n,r){switch(vp(t)){case 2:var i=fp;break;case 8:i=pp;break;default:i=mp}n=i.bind(null,t,n,e),i=void 0,!pn||t!==`touchstart`&&t!==`touchmove`&&t!==`wheel`||(i=!0),r?i===void 0?e.addEventListener(t,n,!0):e.addEventListener(t,n,{capture:!0,passive:i}):i===void 0?e.addEventListener(t,n,!1):e.addEventListener(t,n,{passive:i})}function Nd(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)a:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var c=r.stateNode.containerInfo;if(c===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&s.stateNode.containerInfo===i)return;s=s.return}for(;c!==null;){if(s=vt(c),s===null)return;if(l=s.tag,l===5||l===6||l===26||l===27){r=a=s;continue a}c=c.parentNode}}r=r.return}un(function(){var r=a,i=an(n),s=[];a:{var c=Jr.get(e);if(c!==void 0){var l=wn,u=e;switch(e){case`keypress`:if(yn(n)===0)break a;case`keydown`:case`keyup`:l=Vn;break;case`focusin`:u=`focus`,l=Nn;break;case`focusout`:u=`blur`,l=Nn;break;case`beforeblur`:case`afterblur`:l=Nn;break;case`click`:if(n.button===2)break a;case`auxclick`:case`dblclick`:case`mousedown`:case`mousemove`:case`mouseup`:case`mouseout`:case`mouseover`:case`contextmenu`:l=jn;break;case`drag`:case`dragend`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`dragstart`:case`drop`:l=Mn;break;case`touchcancel`:case`touchend`:case`touchmove`:case`touchstart`:l=Un;break;case Hr:case Ur:case Wr:l=eee;break;case qr:l=Wn;break;case`scroll`:case`scrollend`:l=En;break;case`wheel`:l=Gn;break;case`copy`:case`cut`:case`paste`:l=Pn;break;case`gotpointercapture`:case`lostpointercapture`:case`pointercancel`:case`pointerdown`:case`pointermove`:case`pointerout`:case`pointerover`:case`pointerup`:l=Hn;break;case`toggle`:case`beforetoggle`:l=Kn}var d=(t&4)!=0,f=!d&&(e===`scroll`||e===`scrollend`),p=d?c===null?null:c+`Capture`:c;d=[];for(var m=r,h;m!==null;){var g=m;if(h=g.stateNode,g=g.tag,g!==5&&g!==26&&g!==27||h===null||p===null||(g=dn(m,p),g!=null&&d.push(Pd(m,g,h))),f)break;m=m.return}0<d.length&&(c=new l(c,u,null,n,i),s.push({event:c,listeners:d}))}}if(!(t&7)){a:{if(c=e===`mouseover`||e===`pointerover`,l=e===`mouseout`||e===`pointerout`,c&&n!==rn&&(u=n.relatedTarget||n.fromElement)&&(vt(u)||u[dt]))break a;if((l||c)&&(c=i.window===i?i:(c=i.ownerDocument)?c.defaultView||c.parentWindow:window,l?(u=n.relatedTarget||n.toElement,l=r,u=u?vt(u):null,u!==null&&(f=o(u),d=u.tag,u!==f||d!==5&&d!==27&&d!==6)&&(u=null)):(l=null,u=r),l!==u)){if(d=jn,g=`onMouseLeave`,p=`onMouseEnter`,m=`mouse`,(e===`pointerout`||e===`pointerover`)&&(d=Hn,g=`onPointerLeave`,p=`onPointerEnter`,m=`pointer`),f=l==null?c:bt(l),h=u==null?c:bt(u),c=new d(g,m+`leave`,l,n,i),c.target=f,c.relatedTarget=h,g=null,vt(i)===r&&(d=new d(p,m+`enter`,u,n,i),d.target=h,d.relatedTarget=f,g=d),f=g,l&&u)b:{for(d=Id,p=l,m=u,h=0,g=p;g;g=d(g))h++;g=0;for(var _=m;_;_=d(_))g++;for(;0<h-g;)p=d(p),h--;for(;0<g-h;)m=d(m),g--;for(;h--;){if(p===m||m!==null&&p===m.alternate){d=p;break b}p=d(p),m=d(m)}d=null}else d=null;l!==null&&Ld(s,c,l,d,!1),u!==null&&f!==null&&Ld(s,f,u,d,!0)}}a:{if(c=r?bt(r):window,l=c.nodeName&&c.nodeName.toLowerCase(),l===`select`||l===`input`&&c.type===`file`)var v=fr;else if(or(c))if(pr)v=Sr;else{v=br;var y=yr}else l=c.nodeName,!l||l.toLowerCase()!==`input`||c.type!==`checkbox`&&c.type!==`radio`?r&&Qt(r.elementType)&&(v=fr):v=xr;if(v&&=v(e,r)){sr(s,v,n,i);break a}y&&y(e,c,r),e===`focusout`&&r&&c.type===`number`&&r.memoizedProps.value!=null&&Wt(c,`number`,c.value)}switch(y=r?bt(r):window,e){case`focusin`:(or(y)||y.contentEditable===`true`)&&(Mr=y,Nr=r,Pr=null);break;case`focusout`:Pr=Nr=Mr=null;break;case`mousedown`:Fr=!0;break;case`contextmenu`:case`mouseup`:case`dragend`:Fr=!1,Ir(s,n,i);break;case`selectionchange`:if(jr)break;case`keydown`:case`keyup`:Ir(s,n,i)}var b;if(Jn)b:{switch(e){case`compositionstart`:var x=`onCompositionStart`;break b;case`compositionend`:x=`onCompositionEnd`;break b;case`compositionupdate`:x=`onCompositionUpdate`;break b}x=void 0}else nr?er(e,n)&&(x=`onCompositionEnd`):e===`keydown`&&n.keyCode===229&&(x=`onCompositionStart`);x&&(Zn&&n.locale!==`ko`&&(nr||x!==`onCompositionStart`?x===`onCompositionEnd`&&nr&&(b=vn()):(hn=i,gn=`value`in hn?hn.value:hn.textContent,nr=!0)),y=Fd(r,x),0<y.length&&(x=new Fn(x,e,null,n,i),s.push({event:x,listeners:y}),b?x.data=b:(b=tr(n),b!==null&&(x.data=b)))),(b=Xn?rr(e,n):ir(e,n))&&(x=Fd(r,`onBeforeInput`),0<x.length&&(y=new Fn(`onBeforeInput`,`beforeinput`,null,n,i),s.push({event:y,listeners:x}),y.data=b)),Sd(s,e,r,n,i)}Dd(s,t)})}function Pd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Fd(e,t){for(var n=t+`Capture`,r=[];e!==null;){var i=e,a=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||a===null||(i=dn(e,n),i!=null&&r.unshift(Pd(e,i,a)),i=dn(e,t),i!=null&&r.push(Pd(e,i,a))),e.tag===3)return r;e=e.return}return[]}function Id(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Ld(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(s=s.tag,c!==null&&c===r)break;s!==5&&s!==26&&s!==27||l===null||(c=l,i?(l=dn(n,a),l!=null&&o.unshift(Pd(n,l,c))):i||(l=dn(n,a),l!=null&&o.push(Pd(n,l,c)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Rd=/\r\n?/g,zd=/\u0000|\uFFFD/g;function Bd(e){return(typeof e==`string`?e:``+e).replace(Rd,`
`).replace(zd,``)}function Vd(e,t){return t=Bd(t),Bd(e)===t}function Hd(e,t,n,r,a,o){switch(n){case`children`:typeof r==`string`?t===`body`||t===`textarea`&&r===``||Jt(e,r):(typeof r==`number`||typeof r==`bigint`)&&t!==`body`&&Jt(e,``+r);break;case`className`:Mt(e,`class`,r);break;case`tabIndex`:Mt(e,`tabindex`,r);break;case`dir`:case`role`:case`viewBox`:case`width`:case`height`:Mt(e,n,r);break;case`style`:Zt(e,r,o);break;case`data`:if(t!==`object`){Mt(e,`data`,r);break}case`src`:case`href`:if(r===``&&(t!==`a`||n!==`href`)){e.removeAttribute(n);break}if(r==null||typeof r==`function`||typeof r==`symbol`||typeof r==`boolean`){e.removeAttribute(n);break}r=tn(``+r),e.setAttribute(n,r);break;case`action`:case`formAction`:if(typeof r==`function`){e.setAttribute(n,`javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')`);break}else typeof o==`function`&&(n===`formAction`?(t!==`input`&&Hd(e,t,`name`,a.name,a,null),Hd(e,t,`formEncType`,a.formEncType,a,null),Hd(e,t,`formMethod`,a.formMethod,a,null),Hd(e,t,`formTarget`,a.formTarget,a,null)):(Hd(e,t,`encType`,a.encType,a,null),Hd(e,t,`method`,a.method,a,null),Hd(e,t,`target`,a.target,a,null)));if(r==null||typeof r==`symbol`||typeof r==`boolean`){e.removeAttribute(n);break}r=tn(``+r),e.setAttribute(n,r);break;case`onClick`:r!=null&&(e.onclick=nn);break;case`onScroll`:r!=null&&Od(`scroll`,e);break;case`onScrollEnd`:r!=null&&Od(`scrollend`,e);break;case`dangerouslySetInnerHTML`:if(r!=null){if(typeof r!=`object`||!(`__html`in r))throw Error(i(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(i(60));e.innerHTML=n}}break;case`multiple`:e.multiple=r&&typeof r!=`function`&&typeof r!=`symbol`;break;case`muted`:e.muted=r&&typeof r!=`function`&&typeof r!=`symbol`;break;case`suppressContentEditableWarning`:case`suppressHydrationWarning`:case`defaultValue`:case`defaultChecked`:case`innerHTML`:case`ref`:break;case`autoFocus`:break;case`xlinkHref`:if(r==null||typeof r==`function`||typeof r==`boolean`||typeof r==`symbol`){e.removeAttribute(`xlink:href`);break}n=tn(``+r),e.setAttributeNS(`http://www.w3.org/1999/xlink`,`xlink:href`,n);break;case`contentEditable`:case`spellCheck`:case`draggable`:case`value`:case`autoReverse`:case`externalResourcesRequired`:case`focusable`:case`preserveAlpha`:r!=null&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,``+r):e.removeAttribute(n);break;case`inert`:case`allowFullScreen`:case`async`:case`autoPlay`:case`controls`:case`default`:case`defer`:case`disabled`:case`disablePictureInPicture`:case`disableRemotePlayback`:case`formNoValidate`:case`hidden`:case`loop`:case`noModule`:case`noValidate`:case`open`:case`playsInline`:case`readOnly`:case`required`:case`reversed`:case`scoped`:case`seamless`:case`itemScope`:r&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,``):e.removeAttribute(n);break;case`capture`:case`download`:!0===r?e.setAttribute(n,``):!1!==r&&r!=null&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,r):e.removeAttribute(n);break;case`cols`:case`rows`:case`size`:case`span`:r!=null&&typeof r!=`function`&&typeof r!=`symbol`&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case`rowSpan`:case`start`:r==null||typeof r==`function`||typeof r==`symbol`||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case`popover`:Od(`beforetoggle`,e),Od(`toggle`,e),jt(e,`popover`,r);break;case`xlinkActuate`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:actuate`,r);break;case`xlinkArcrole`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:arcrole`,r);break;case`xlinkRole`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:role`,r);break;case`xlinkShow`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:show`,r);break;case`xlinkTitle`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:title`,r);break;case`xlinkType`:Nt(e,`http://www.w3.org/1999/xlink`,`xlink:type`,r);break;case`xmlBase`:Nt(e,`http://www.w3.org/XML/1998/namespace`,`xml:base`,r);break;case`xmlLang`:Nt(e,`http://www.w3.org/XML/1998/namespace`,`xml:lang`,r);break;case`xmlSpace`:Nt(e,`http://www.w3.org/XML/1998/namespace`,`xml:space`,r);break;case`is`:jt(e,`is`,r);break;case`innerText`:case`textContent`:break;default:(!(2<n.length)||n[0]!==`o`&&n[0]!==`O`||n[1]!==`n`&&n[1]!==`N`)&&(n=$t.get(n)||n,jt(e,n,r))}}function Ud(e,t,n,r,a,o){switch(n){case`style`:Zt(e,r,o);break;case`dangerouslySetInnerHTML`:if(r!=null){if(typeof r!=`object`||!(`__html`in r))throw Error(i(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(i(60));e.innerHTML=n}}break;case`children`:typeof r==`string`?Jt(e,r):(typeof r==`number`||typeof r==`bigint`)&&Jt(e,``+r);break;case`onScroll`:r!=null&&Od(`scroll`,e);break;case`onScrollEnd`:r!=null&&Od(`scrollend`,e);break;case`onClick`:r!=null&&(e.onclick=nn);break;case`suppressContentEditableWarning`:case`suppressHydrationWarning`:case`innerHTML`:case`ref`:break;case`innerText`:case`textContent`:break;default:if(!wt.hasOwnProperty(n))a:{if(n[0]===`o`&&n[1]===`n`&&(a=n.endsWith(`Capture`),t=n.slice(2,a?n.length-7:void 0),o=e[ut]||null,o=o==null?null:o[n],typeof o==`function`&&e.removeEventListener(t,o,a),typeof r==`function`)){typeof o!=`function`&&o!==null&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,a);break a}n in e?e[n]=r:!0===r?e.setAttribute(n,``):jt(e,n,r)}}}function Wd(e,t,n){switch(t){case`div`:case`span`:case`svg`:case`path`:case`a`:case`g`:case`p`:case`li`:break;case`img`:Od(`error`,e),Od(`load`,e);var r=!1,a=!1,o;for(o in n)if(n.hasOwnProperty(o)){var s=n[o];if(s!=null)switch(o){case`src`:r=!0;break;case`srcSet`:a=!0;break;case`children`:case`dangerouslySetInnerHTML`:throw Error(i(137,t));default:Hd(e,t,o,s,n,null)}}a&&Hd(e,t,`srcSet`,n.srcSet,n,null),r&&Hd(e,t,`src`,n.src,n,null);return;case`input`:Od(`invalid`,e);var c=o=s=a=null,l=null,u=null;for(r in n)if(n.hasOwnProperty(r)){var d=n[r];if(d!=null)switch(r){case`name`:a=d;break;case`type`:s=d;break;case`checked`:l=d;break;case`defaultChecked`:u=d;break;case`value`:o=d;break;case`defaultValue`:c=d;break;case`children`:case`dangerouslySetInnerHTML`:if(d!=null)throw Error(i(137,t));break;default:Hd(e,t,r,d,n,null)}}Ut(e,o,c,l,u,s,a,!1);return;case`select`:for(a in Od(`invalid`,e),r=s=o=null,n)if(n.hasOwnProperty(a)&&(c=n[a],c!=null))switch(a){case`value`:o=c;break;case`defaultValue`:s=c;break;case`multiple`:r=c;default:Hd(e,t,a,c,n,null)}t=o,n=s,e.multiple=!!r,t==null?n!=null&&Gt(e,!!r,n,!0):Gt(e,!!r,t,!1);return;case`textarea`:for(s in Od(`invalid`,e),o=a=r=null,n)if(n.hasOwnProperty(s)&&(c=n[s],c!=null))switch(s){case`value`:r=c;break;case`defaultValue`:a=c;break;case`children`:o=c;break;case`dangerouslySetInnerHTML`:if(c!=null)throw Error(i(91));break;default:Hd(e,t,s,c,n,null)}qt(e,r,a,o);return;case`option`:for(l in n)if(n.hasOwnProperty(l)&&(r=n[l],r!=null))switch(l){case`selected`:e.selected=r&&typeof r!=`function`&&typeof r!=`symbol`;break;default:Hd(e,t,l,r,n,null)}return;case`dialog`:Od(`beforetoggle`,e),Od(`toggle`,e),Od(`cancel`,e),Od(`close`,e);break;case`iframe`:case`object`:Od(`load`,e);break;case`video`:case`audio`:for(r=0;r<Td.length;r++)Od(Td[r],e);break;case`image`:Od(`error`,e),Od(`load`,e);break;case`details`:Od(`toggle`,e);break;case`embed`:case`source`:case`link`:Od(`error`,e),Od(`load`,e);case`area`:case`base`:case`br`:case`col`:case`hr`:case`keygen`:case`meta`:case`param`:case`track`:case`wbr`:case`menuitem`:for(u in n)if(n.hasOwnProperty(u)&&(r=n[u],r!=null))switch(u){case`children`:case`dangerouslySetInnerHTML`:throw Error(i(137,t));default:Hd(e,t,u,r,n,null)}return;default:if(Qt(t)){for(d in n)n.hasOwnProperty(d)&&(r=n[d],r!==void 0&&Ud(e,t,d,r,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(r=n[c],r!=null&&Hd(e,t,c,r,n,null))}function Gd(e,t,n,r){switch(t){case`div`:case`span`:case`svg`:case`path`:case`a`:case`g`:case`p`:case`li`:break;case`input`:var a=null,o=null,s=null,c=null,l=null,u=null,d=null;for(m in n){var f=n[m];if(n.hasOwnProperty(m)&&f!=null)switch(m){case`checked`:break;case`value`:break;case`defaultValue`:l=f;default:r.hasOwnProperty(m)||Hd(e,t,m,null,r,f)}}for(var p in r){var m=r[p];if(f=n[p],r.hasOwnProperty(p)&&(m!=null||f!=null))switch(p){case`type`:o=m;break;case`name`:a=m;break;case`checked`:u=m;break;case`defaultChecked`:d=m;break;case`value`:s=m;break;case`defaultValue`:c=m;break;case`children`:case`dangerouslySetInnerHTML`:if(m!=null)throw Error(i(137,t));break;default:m!==f&&Hd(e,t,p,m,r,f)}}Ht(e,s,c,l,u,d,o,a);return;case`select`:for(o in m=s=c=p=null,n)if(l=n[o],n.hasOwnProperty(o)&&l!=null)switch(o){case`value`:break;case`multiple`:m=l;default:r.hasOwnProperty(o)||Hd(e,t,o,null,r,l)}for(a in r)if(o=r[a],l=n[a],r.hasOwnProperty(a)&&(o!=null||l!=null))switch(a){case`value`:p=o;break;case`defaultValue`:c=o;break;case`multiple`:s=o;default:o!==l&&Hd(e,t,a,o,r,l)}t=c,n=s,r=m,p==null?!!r!=!!n&&(t==null?Gt(e,!!n,n?[]:``,!1):Gt(e,!!n,t,!0)):Gt(e,!!n,p,!1);return;case`textarea`:for(c in m=p=null,n)if(a=n[c],n.hasOwnProperty(c)&&a!=null&&!r.hasOwnProperty(c))switch(c){case`value`:break;case`children`:break;default:Hd(e,t,c,null,r,a)}for(s in r)if(a=r[s],o=n[s],r.hasOwnProperty(s)&&(a!=null||o!=null))switch(s){case`value`:p=a;break;case`defaultValue`:m=a;break;case`children`:break;case`dangerouslySetInnerHTML`:if(a!=null)throw Error(i(91));break;default:a!==o&&Hd(e,t,s,a,r,o)}Kt(e,p,m);return;case`option`:for(var h in n)if(p=n[h],n.hasOwnProperty(h)&&p!=null&&!r.hasOwnProperty(h))switch(h){case`selected`:e.selected=!1;break;default:Hd(e,t,h,null,r,p)}for(l in r)if(p=r[l],m=n[l],r.hasOwnProperty(l)&&p!==m&&(p!=null||m!=null))switch(l){case`selected`:e.selected=p&&typeof p!=`function`&&typeof p!=`symbol`;break;default:Hd(e,t,l,p,r,m)}return;case`img`:case`link`:case`area`:case`base`:case`br`:case`col`:case`embed`:case`hr`:case`keygen`:case`meta`:case`param`:case`source`:case`track`:case`wbr`:case`menuitem`:for(var g in n)p=n[g],n.hasOwnProperty(g)&&p!=null&&!r.hasOwnProperty(g)&&Hd(e,t,g,null,r,p);for(u in r)if(p=r[u],m=n[u],r.hasOwnProperty(u)&&p!==m&&(p!=null||m!=null))switch(u){case`children`:case`dangerouslySetInnerHTML`:if(p!=null)throw Error(i(137,t));break;default:Hd(e,t,u,p,r,m)}return;default:if(Qt(t)){for(var _ in n)p=n[_],n.hasOwnProperty(_)&&p!==void 0&&!r.hasOwnProperty(_)&&Ud(e,t,_,void 0,r,p);for(d in r)p=r[d],m=n[d],!r.hasOwnProperty(d)||p===m||p===void 0&&m===void 0||Ud(e,t,d,p,r,m);return}}for(var v in n)p=n[v],n.hasOwnProperty(v)&&p!=null&&!r.hasOwnProperty(v)&&Hd(e,t,v,null,r,p);for(f in r)p=r[f],m=n[f],!r.hasOwnProperty(f)||p===m||p==null&&m==null||Hd(e,t,f,p,r,m)}function Kd(e){switch(e){case`css`:case`script`:case`font`:case`img`:case`image`:case`input`:case`link`:return!0;default:return!1}}function qd(){if(typeof performance.getEntriesByType==`function`){for(var e=0,t=0,n=performance.getEntriesByType(`resource`),r=0;r<n.length;r++){var i=n[r],a=i.transferSize,o=i.initiatorType,s=i.duration;if(a&&s&&Kd(o)){for(o=0,s=i.responseEnd,r+=1;r<n.length;r++){var c=n[r],l=c.startTime;if(l>s)break;var u=c.transferSize,d=c.initiatorType;u&&Kd(d)&&(c=c.responseEnd,o+=u*(c<s?1:(s-l)/(c-l)))}if(--r,t+=8*(a+o)/(i.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e==`number`)?e:5}var Jd=null,Yd=null;function Xd(e){return e.nodeType===9?e:e.ownerDocument}function Zd(e){switch(e){case`http://www.w3.org/2000/svg`:return 1;case`http://www.w3.org/1998/Math/MathML`:return 2;default:return 0}}function Qd(e,t){if(e===0)switch(t){case`svg`:return 1;case`math`:return 2;default:return 0}return e===1&&t===`foreignObject`?0:e}function $d(e,t){return e===`textarea`||e===`noscript`||typeof t.children==`string`||typeof t.children==`number`||typeof t.children==`bigint`||typeof t.dangerouslySetInnerHTML==`object`&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ef=null;function cee(){var e=window.event;return e&&e.type===`popstate`?e===ef?!1:(ef=e,!0):(ef=null,!1)}var tf=typeof setTimeout==`function`?setTimeout:void 0,lee=typeof clearTimeout==`function`?clearTimeout:void 0,nf=typeof Promise==`function`?Promise:void 0,rf=typeof queueMicrotask==`function`?queueMicrotask:nf===void 0?tf:function(e){return nf.resolve(null).then(e).catch(af)};function af(e){setTimeout(function(){throw e})}function of(e){return e===`head`}function sf(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n===`/$`||n===`/&`){if(r===0){e.removeChild(i),Lp(t);return}r--}else if(n===`$`||n===`$?`||n===`$~`||n===`$!`||n===`&`)r++;else if(n===`html`)xf(e.ownerDocument.documentElement);else if(n===`head`){n=e.ownerDocument.head,xf(n);for(var a=n.firstChild;a;){var o=a.nextSibling,s=a.nodeName;a[gt]||s===`SCRIPT`||s===`STYLE`||s===`LINK`&&a.rel.toLowerCase()===`stylesheet`||n.removeChild(a),a=o}}else n===`body`&&xf(e.ownerDocument.body);n=i}while(n);Lp(t)}function cf(e,t){var n=e;e=0;do{var r=n.nextSibling;if(n.nodeType===1?t?(n._stashedDisplay=n.style.display,n.style.display=`none`):(n.style.display=n._stashedDisplay||``,n.getAttribute(`style`)===``&&n.removeAttribute(`style`)):n.nodeType===3&&(t?(n._stashedText=n.nodeValue,n.nodeValue=``):n.nodeValue=n._stashedText||``),r&&r.nodeType===8)if(n=r.data,n===`/$`){if(e===0)break;e--}else n!==`$`&&n!==`$?`&&n!==`$~`&&n!==`$!`||e++;n=r}while(n)}function lf(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case`HTML`:case`HEAD`:case`BODY`:lf(n),_t(n);continue;case`SCRIPT`:case`STYLE`:continue;case`LINK`:if(n.rel.toLowerCase()===`stylesheet`)continue}e.removeChild(n)}}function uf(e,t,n,r){for(;e.nodeType===1;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&(e.nodeName!==`INPUT`||e.type!==`hidden`))break}else if(r){if(!e[gt])switch(t){case`meta`:if(!e.hasAttribute(`itemprop`))break;return e;case`link`:if(a=e.getAttribute(`rel`),a===`stylesheet`&&e.hasAttribute(`data-precedence`)||a!==i.rel||e.getAttribute(`href`)!==(i.href==null||i.href===``?null:i.href)||e.getAttribute(`crossorigin`)!==(i.crossOrigin==null?null:i.crossOrigin)||e.getAttribute(`title`)!==(i.title==null?null:i.title))break;return e;case`style`:if(e.hasAttribute(`data-precedence`))break;return e;case`script`:if(a=e.getAttribute(`src`),(a!==(i.src==null?null:i.src)||e.getAttribute(`type`)!==(i.type==null?null:i.type)||e.getAttribute(`crossorigin`)!==(i.crossOrigin==null?null:i.crossOrigin))&&a&&e.hasAttribute(`async`)&&!e.hasAttribute(`itemprop`))break;return e;default:return e}}else if(t===`input`&&e.type===`hidden`){var a=i.name==null?null:``+i.name;if(i.type===`hidden`&&e.getAttribute(`name`)===a)return e}else return e;if(e=gf(e.nextSibling),e===null)break}return null}function df(e,t,n){if(t===``)return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!==`INPUT`||e.type!==`hidden`)&&!n||(e=gf(e.nextSibling),e===null))return null;return e}function ff(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!==`INPUT`||e.type!==`hidden`)&&!t||(e=gf(e.nextSibling),e===null))return null;return e}function pf(e){return e.data===`$?`||e.data===`$~`}function mf(e){return e.data===`$!`||e.data===`$?`&&e.ownerDocument.readyState!==`loading`}function hf(e,t){var n=e.ownerDocument;if(e.data===`$~`)e._reactRetry=t;else if(e.data!==`$?`||n.readyState!==`loading`)t();else{var r=function(){t(),n.removeEventListener(`DOMContentLoaded`,r)};n.addEventListener(`DOMContentLoaded`,r),e._reactRetry=r}}function gf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t===`$`||t===`$!`||t===`$?`||t===`$~`||t===`&`||t===`F!`||t===`F`)break;if(t===`/$`||t===`/&`)return null}}return e}var _f=null;function vf(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`/$`||n===`/&`){if(t===0)return gf(e.nextSibling);t--}else n!==`$`&&n!==`$!`&&n!==`$?`&&n!==`$~`&&n!==`&`||t++}e=e.nextSibling}return null}function yf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`$`||n===`$!`||n===`$?`||n===`$~`||n===`&`){if(t===0)return e;t--}else n!==`/$`&&n!==`/&`||t++}e=e.previousSibling}return null}function bf(e,t,n){switch(t=Xd(n),e){case`html`:if(e=t.documentElement,!e)throw Error(i(452));return e;case`head`:if(e=t.head,!e)throw Error(i(453));return e;case`body`:if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function xf(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);_t(e)}var Sf=new Map,Cf=new Set;function wf(e){return typeof e.getRootNode==`function`?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Tf=ne.d;ne.d={f:Ef,r:Df,D:Af,C:jf,L:Mf,m:uee,X:fee,S:dee,M:Nf};function Ef(){var e=Tf.f(),t=ju();return e||t}function Df(e){var t=yt(e);t!==null&&t.tag===5&&t.type===`form`?Ms(t):Tf.r(e)}var Of=typeof document>`u`?null:document;function kf(e,t,n){var r=Of;if(r&&typeof t==`string`&&t){var i=Vt(t);i=`link[rel="`+e+`"][href="`+i+`"]`,typeof n==`string`&&(i+=`[crossorigin="`+n+`"]`),Cf.has(i)||(Cf.add(i),e={rel:e,crossOrigin:n,href:t},r.querySelector(i)===null&&(t=r.createElement(`link`),Wd(t,`link`,e),St(t),r.head.appendChild(t)))}}function Af(e){Tf.D(e),kf(`dns-prefetch`,e,null)}function jf(e,t){Tf.C(e,t),kf(`preconnect`,e,t)}function Mf(e,t,n){Tf.L(e,t,n);var r=Of;if(r&&e&&t){var i=`link[rel="preload"][as="`+Vt(t)+`"]`;t===`image`&&n&&n.imageSrcSet?(i+=`[imagesrcset="`+Vt(n.imageSrcSet)+`"]`,typeof n.imageSizes==`string`&&(i+=`[imagesizes="`+Vt(n.imageSizes)+`"]`)):i+=`[href="`+Vt(e)+`"]`;var a=i;switch(t){case`style`:a=Ff(e);break;case`script`:a=Rf(e)}Sf.has(a)||(e=m({rel:`preload`,href:t===`image`&&n&&n.imageSrcSet?void 0:e,as:t},n),Sf.set(a,e),r.querySelector(i)!==null||t===`style`&&r.querySelector(If(a))||t===`script`&&r.querySelector(zf(a))||(t=r.createElement(`link`),Wd(t,`link`,e),St(t),r.head.appendChild(t)))}}function uee(e,t){Tf.m(e,t);var n=Of;if(n&&e){var r=t&&typeof t.as==`string`?t.as:`script`,i=`link[rel="modulepreload"][as="`+Vt(r)+`"][href="`+Vt(e)+`"]`,a=i;switch(r){case`audioworklet`:case`paintworklet`:case`serviceworker`:case`sharedworker`:case`worker`:case`script`:a=Rf(e)}if(!Sf.has(a)&&(e=m({rel:`modulepreload`,href:e},t),Sf.set(a,e),n.querySelector(i)===null)){switch(r){case`audioworklet`:case`paintworklet`:case`serviceworker`:case`sharedworker`:case`worker`:case`script`:if(n.querySelector(zf(a)))return}r=n.createElement(`link`),Wd(r,`link`,e),St(r),n.head.appendChild(r)}}}function dee(e,t,n){Tf.S(e,t,n);var r=Of;if(r&&e){var i=xt(r).hoistableStyles,a=Ff(e);t||=`default`;var o=i.get(a);if(!o){var s={loading:0,preload:null};if(o=r.querySelector(If(a)))s.loading=5;else{e=m({rel:`stylesheet`,href:e,"data-precedence":t},n),(n=Sf.get(a))&&Hf(e,n);var c=o=r.createElement(`link`);St(c),Wd(c,`link`,e),c._p=new Promise(function(e,t){c.onload=e,c.onerror=t}),c.addEventListener(`load`,function(){s.loading|=1}),c.addEventListener(`error`,function(){s.loading|=2}),s.loading|=4,Vf(o,t,r)}o={type:`stylesheet`,instance:o,count:1,state:s},i.set(a,o)}}}function fee(e,t){Tf.X(e,t);var n=Of;if(n&&e){var r=xt(n).hoistableScripts,i=Rf(e),a=r.get(i);a||(a=n.querySelector(zf(i)),a||(e=m({src:e,async:!0},t),(t=Sf.get(i))&&Uf(e,t),a=n.createElement(`script`),St(a),Wd(a,`link`,e),n.head.appendChild(a)),a={type:`script`,instance:a,count:1,state:null},r.set(i,a))}}function Nf(e,t){Tf.M(e,t);var n=Of;if(n&&e){var r=xt(n).hoistableScripts,i=Rf(e),a=r.get(i);a||(a=n.querySelector(zf(i)),a||(e=m({src:e,async:!0,type:`module`},t),(t=Sf.get(i))&&Uf(e,t),a=n.createElement(`script`),St(a),Wd(a,`link`,e),n.head.appendChild(a)),a={type:`script`,instance:a,count:1,state:null},r.set(i,a))}}function Pf(e,t,n,r){var a=(a=de.current)?wf(a):null;if(!a)throw Error(i(446));switch(e){case`meta`:case`title`:return null;case`style`:return typeof n.precedence==`string`&&typeof n.href==`string`?(t=Ff(n.href),n=xt(a).hoistableStyles,r=n.get(t),r||(r={type:`style`,instance:null,count:0,state:null},n.set(t,r)),r):{type:`void`,instance:null,count:0,state:null};case`link`:if(n.rel===`stylesheet`&&typeof n.href==`string`&&typeof n.precedence==`string`){e=Ff(n.href);var o=xt(a).hoistableStyles,s=o.get(e);if(s||(a=a.ownerDocument||a,s={type:`stylesheet`,instance:null,count:0,state:{loading:0,preload:null}},o.set(e,s),(o=a.querySelector(If(e)))&&!o._p&&(s.instance=o,s.state.loading=5),Sf.has(e)||(n={rel:`preload`,as:`style`,href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Sf.set(e,n),o||pee(a,e,n,s.state))),t&&r===null)throw Error(i(528,``));return s}if(t&&r!==null)throw Error(i(529,``));return null;case`script`:return t=n.async,n=n.src,typeof n==`string`&&t&&typeof t!=`function`&&typeof t!=`symbol`?(t=Rf(n),n=xt(a).hoistableScripts,r=n.get(t),r||(r={type:`script`,instance:null,count:0,state:null},n.set(t,r)),r):{type:`void`,instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Ff(e){return`href="`+Vt(e)+`"`}function If(e){return`link[rel="stylesheet"][`+e+`]`}function Lf(e){return m({},e,{"data-precedence":e.precedence,precedence:null})}function pee(e,t,n,r){e.querySelector(`link[rel="preload"][as="style"][`+t+`]`)?r.loading=1:(t=e.createElement(`link`),r.preload=t,t.addEventListener(`load`,function(){return r.loading|=1}),t.addEventListener(`error`,function(){return r.loading|=2}),Wd(t,`link`,n),St(t),e.head.appendChild(t))}function Rf(e){return`[src="`+Vt(e)+`"]`}function zf(e){return`script[async]`+e}function Bf(e,t,n){if(t.count++,t.instance===null)switch(t.type){case`style`:var r=e.querySelector(`style[data-href~="`+Vt(n.href)+`"]`);if(r)return t.instance=r,St(r),r;var a=m({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return r=(e.ownerDocument||e).createElement(`style`),St(r),Wd(r,`style`,a),Vf(r,n.precedence,e),t.instance=r;case`stylesheet`:a=Ff(n.href);var o=e.querySelector(If(a));if(o)return t.state.loading|=4,t.instance=o,St(o),o;r=Lf(n),(a=Sf.get(a))&&Hf(r,a),o=(e.ownerDocument||e).createElement(`link`),St(o);var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),Wd(o,`link`,r),t.state.loading|=4,Vf(o,n.precedence,e),t.instance=o;case`script`:return o=Rf(n.src),(a=e.querySelector(zf(o)))?(t.instance=a,St(a),a):(r=n,(a=Sf.get(o))&&(r=m({},n),Uf(r,a)),e=e.ownerDocument||e,a=e.createElement(`script`),St(a),Wd(a,`link`,r),e.head.appendChild(a),t.instance=a);case`void`:return null;default:throw Error(i(443,t.type))}else t.type===`stylesheet`&&!(t.state.loading&4)&&(r=t.instance,t.state.loading|=4,Vf(r,n.precedence,e));return t.instance}function Vf(e,t,n){for(var r=n.querySelectorAll(`link[rel="stylesheet"][data-precedence],style[data-precedence]`),i=r.length?r[r.length-1]:null,a=i,o=0;o<r.length;o++){var s=r[o];if(s.dataset.precedence===t)a=s;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=n.nodeType===9?n.head:n,t.insertBefore(e,t.firstChild))}function Hf(e,t){e.crossOrigin??=t.crossOrigin,e.referrerPolicy??=t.referrerPolicy,e.title??=t.title}function Uf(e,t){e.crossOrigin??=t.crossOrigin,e.referrerPolicy??=t.referrerPolicy,e.integrity??=t.integrity}var Wf=null;function Gf(e,t,n){if(Wf===null){var r=new Map,i=Wf=new Map;i.set(n,r)}else i=Wf,r=i.get(n),r||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[gt]||a[lt]||e===`link`&&a.getAttribute(`rel`)===`stylesheet`)&&a.namespaceURI!==`http://www.w3.org/2000/svg`){var o=a.getAttribute(t)||``;o=e+o;var s=r.get(o);s?s.push(a):r.set(o,[a])}}return r}function Kf(e,t,n){e=e.ownerDocument||e,e.head.insertBefore(n,t===`title`?e.querySelector(`head > title`):null)}function qf(e,t,n){if(n===1||t.itemProp!=null)return!1;switch(e){case`meta`:case`title`:return!0;case`style`:if(typeof t.precedence!=`string`||typeof t.href!=`string`||t.href===``)break;return!0;case`link`:if(typeof t.rel!=`string`||typeof t.href!=`string`||t.href===``||t.onLoad||t.onError)break;switch(t.rel){case`stylesheet`:return e=t.disabled,typeof t.precedence==`string`&&e==null;default:return!0}case`script`:if(t.async&&typeof t.async!=`function`&&typeof t.async!=`symbol`&&!t.onLoad&&!t.onError&&t.src&&typeof t.src==`string`)return!0}return!1}function Jf(e){return!(e.type===`stylesheet`&&!(e.state.loading&3))}function Yf(e,t,n,r){if(n.type===`stylesheet`&&(typeof r.media!=`string`||!1!==matchMedia(r.media).matches)&&!(n.state.loading&4)){if(n.instance===null){var i=Ff(r.href),a=t.querySelector(If(i));if(a){t=a._p,typeof t==`object`&&t&&typeof t.then==`function`&&(e.count++,e=Qf.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,St(a);return}a=t.ownerDocument||t,r=Lf(r),(i=Sf.get(i))&&Hf(r,i),a=a.createElement(`link`),St(a);var o=a;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),Wd(a,`link`,r),n.instance=a}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(n.state.loading&3)&&(e.count++,n=Qf.bind(e),t.addEventListener(`load`,n),t.addEventListener(`error`,n))}}var Xf=0;function Zf(e,t){return e.stylesheets&&e.count===0&&ep(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&ep(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&Xf===0&&(Xf=62500*qd());var i=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&ep(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>Xf?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}function Qf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ep(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var $f=null;function ep(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,$f=new Map,t.forEach(tp,e),$f=null,Qf.call(e))}function tp(e,t){if(!(t.state.loading&4)){var n=$f.get(e);if(n)var r=n.get(null);else{n=new Map,$f.set(e,n);for(var i=e.querySelectorAll(`link[data-precedence],style[data-precedence]`),a=0;a<i.length;a++){var o=i[a];(o.nodeName===`LINK`||o.getAttribute(`media`)!==`not all`)&&(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}i=t.instance,o=i.getAttribute(`data-precedence`),a=n.get(o)||r,a===r&&n.set(null,i),n.set(o,i),this.count++,r=Qf.bind(this),i.addEventListener(`load`,r),i.addEventListener(`error`,r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(i,e.firstChild)),t.state.loading|=4}}var np={$$typeof:C,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function rp(e,t,n,r,i,a,o,s,c){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qe(0),this.hiddenUpdates=Qe(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=c,this.incompleteTransitions=new Map}function ip(e,t,n,r,i,a,o,s,c,l,u,d){return e=new rp(e,t,n,o,c,l,u,d,s),t=1,!0===a&&(t|=24),a=li(3,null,null,t),e.current=a,a.stateNode=e,t=ua(),t.refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},Ua(a),e}function ap(e){return e?(e=si,e):si}function op(e,t,n,r,i,a){i=ap(i),r.context===null?r.context=i:r.pendingContext=i,r=Ga(t),r.payload={element:n},a=a===void 0?null:a,a!==null&&(r.callback=a),n=Ka(e,r,t),n!==null&&(Eu(n,e,t),qa(n,e,t))}function sp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function cp(e,t){sp(e,t),(e=e.alternate)&&sp(e,t)}function lp(e){if(e.tag===13||e.tag===31){var t=ii(e,67108864);t!==null&&Eu(t,e,67108864),cp(e,67108864)}}function up(e){if(e.tag===13||e.tag===31){var t=wu();t=it(t);var n=ii(e,t);n!==null&&Eu(n,e,t),cp(e,t)}}var dp=!0;function fp(e,t,n,r){var i=P.T;P.T=null;var a=ne.p;try{ne.p=2,mp(e,t,n,r)}finally{ne.p=a,P.T=i}}function pp(e,t,n,r){var i=P.T;P.T=null;var a=ne.p;try{ne.p=8,mp(e,t,n,r)}finally{ne.p=a,P.T=i}}function mp(e,t,n,r){if(dp){var i=hp(r);if(i===null)Nd(e,t,r,gp,n),Dp(e,r);else if(kp(i,e,t,n,r))r.stopPropagation();else if(Dp(e,r),t&4&&-1<Ep.indexOf(e)){for(;i!==null;){var a=yt(i);if(a!==null)switch(a.tag){case 3:if(a=a.stateNode,a.current.memoizedState.isDehydrated){var o=Je(a.pendingLanes);if(o!==0){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var c=1<<31-Ve(o);s.entanglements[1]|=c,o&=~c}dd(a),!(Gl&6)&&(fu=ke()+500,fd(0,!1))}}break;case 31:case 13:s=ii(a,2),s!==null&&Eu(s,a,2),ju(),cp(a,2)}if(a=hp(r),a===null&&Nd(e,t,r,gp,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Nd(e,t,r,null,n)}}function hp(e){return e=an(e),_p(e)}var gp=null;function _p(e){if(gp=null,e=vt(e),e!==null){var t=o(e);if(t===null)e=null;else{var n=t.tag;if(n===13){if(e=s(t),e!==null)return e;e=null}else if(n===31){if(e=c(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return gp=e,null}function vp(e){switch(e){case`beforetoggle`:case`cancel`:case`click`:case`close`:case`contextmenu`:case`copy`:case`cut`:case`auxclick`:case`dblclick`:case`dragend`:case`dragstart`:case`drop`:case`focusin`:case`focusout`:case`input`:case`invalid`:case`keydown`:case`keypress`:case`keyup`:case`mousedown`:case`mouseup`:case`paste`:case`pause`:case`play`:case`pointercancel`:case`pointerdown`:case`pointerup`:case`ratechange`:case`reset`:case`resize`:case`seeked`:case`submit`:case`toggle`:case`touchcancel`:case`touchend`:case`touchstart`:case`volumechange`:case`change`:case`selectionchange`:case`textInput`:case`compositionstart`:case`compositionend`:case`compositionupdate`:case`beforeblur`:case`afterblur`:case`beforeinput`:case`blur`:case`fullscreenchange`:case`focus`:case`hashchange`:case`popstate`:case`select`:case`selectstart`:return 2;case`drag`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`mousemove`:case`mouseout`:case`mouseover`:case`pointermove`:case`pointerout`:case`pointerover`:case`scroll`:case`touchmove`:case`wheel`:case`mouseenter`:case`mouseleave`:case`pointerenter`:case`pointerleave`:return 8;case`message`:switch(Ae()){case je:return 2;case Me:return 8;case Ne:case Pe:return 32;case Fe:return 268435456;default:return 32}default:return 32}}var yp=!1,bp=null,xp=null,Sp=null,Cp=new Map,wp=new Map,Tp=[],Ep=`mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset`.split(` `);function Dp(e,t){switch(e){case`focusin`:case`focusout`:bp=null;break;case`dragenter`:case`dragleave`:xp=null;break;case`mouseover`:case`mouseout`:Sp=null;break;case`pointerover`:case`pointerout`:Cp.delete(t.pointerId);break;case`gotpointercapture`:case`lostpointercapture`:wp.delete(t.pointerId)}}function Op(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=yt(t),t!==null&&lp(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function kp(e,t,n,r,i){switch(t){case`focusin`:return bp=Op(bp,e,t,n,r,i),!0;case`dragenter`:return xp=Op(xp,e,t,n,r,i),!0;case`mouseover`:return Sp=Op(Sp,e,t,n,r,i),!0;case`pointerover`:var a=i.pointerId;return Cp.set(a,Op(Cp.get(a)||null,e,t,n,r,i)),!0;case`gotpointercapture`:return a=i.pointerId,wp.set(a,Op(wp.get(a)||null,e,t,n,r,i)),!0}return!1}function Ap(e){var t=vt(e.target);if(t!==null){var n=o(t);if(n!==null){if(t=n.tag,t===13){if(t=s(n),t!==null){e.blockedOn=t,st(e.priority,function(){up(n)});return}}else if(t===31){if(t=c(n),t!==null){e.blockedOn=t,st(e.priority,function(){up(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function jp(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=hp(e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);rn=r,n.target.dispatchEvent(r),rn=null}else return t=yt(n),t!==null&&lp(t),e.blockedOn=n,!1;t.shift()}return!0}function Mp(e,t,n){jp(e)&&n.delete(t)}function Np(){yp=!1,bp!==null&&jp(bp)&&(bp=null),xp!==null&&jp(xp)&&(xp=null),Sp!==null&&jp(Sp)&&(Sp=null),Cp.forEach(Mp),wp.forEach(Mp)}function Pp(e,n){e.blockedOn===n&&(e.blockedOn=null,yp||(yp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Np)))}var Fp=null;function Ip(e){Fp!==e&&(Fp=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Fp===e&&(Fp=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if(typeof r!=`function`){if(_p(r||n)===null)continue;break}var a=yt(n);a!==null&&(e.splice(t,3),t-=3,As(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function Lp(e){function t(t){return Pp(t,e)}bp!==null&&Pp(bp,e),xp!==null&&Pp(xp,e),Sp!==null&&Pp(Sp,e),Cp.forEach(t),wp.forEach(t);for(var n=0;n<Tp.length;n++){var r=Tp[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Tp.length&&(n=Tp[0],n.blockedOn===null);)Ap(n),n.blockedOn===null&&Tp.shift();if(n=(e.ownerDocument||e).$$reactFormReplay,n!=null)for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],o=i[ut]||null;if(typeof a==`function`)o||Ip(n);else if(o){var s=null;if(a&&a.hasAttribute(`formAction`)){if(i=a,o=a[ut]||null)s=o.formAction;else if(_p(i)!==null)continue}else s=o.action;typeof s==`function`?n[r+1]=s:(n.splice(r,3),r-=3),Ip(n)}}}function Rp(){function e(e){e.canIntercept&&e.info===`react-transition`&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:`manual`,scroll:`manual`})}function t(){i!==null&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&e.url!=null&&navigation.navigate(e.url,{state:e.getState(),info:`react-transition`,history:`replace`})}}if(typeof navigation==`object`){var r=!1,i=null;return navigation.addEventListener(`navigate`,e),navigation.addEventListener(`navigatesuccess`,t),navigation.addEventListener(`navigateerror`,t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener(`navigate`,e),navigation.removeEventListener(`navigatesuccess`,t),navigation.removeEventListener(`navigateerror`,t),i!==null&&(i(),i=null)}}}function zp(e){this._internalRoot=e}Bp.prototype.render=zp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var n=t.current;op(n,wu(),e,t,null,null)},Bp.prototype.unmount=zp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;op(e.current,2,null,e,null,null),ju(),t[dt]=null}};function Bp(e){this._internalRoot=e}Bp.prototype.unstable_scheduleHydration=function(e){if(e){var t=ot();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Tp.length&&t!==0&&t<Tp[n].priority;n++);Tp.splice(n,0,e),n===0&&Ap(e)}};var Vp=n.version;if(Vp!==`19.2.1`)throw Error(i(527,Vp,`19.2.1`));ne.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render==`function`?Error(i(188)):(e=Object.keys(e).join(`,`),Error(i(268,e)));return e=u(t),e=e===null?null:f(e),e=e===null?null:e.stateNode,e};var Hp={bundleType:0,version:`19.2.1`,rendererPackageName:`react-dom`,currentDispatcherRef:P,reconcilerVersion:`19.2.1`};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<`u`){var Up=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Up.isDisabled&&Up.supportsFiber)try{Re=Up.inject(Hp),ze=Up}catch{}}e.createRoot=function(e,t){if(!a(e))throw Error(i(299));var n=!1,r=``,o=Qs,s=$s,c=ec;return t!=null&&(!0===t.unstable_strictMode&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onUncaughtError!==void 0&&(o=t.onUncaughtError),t.onCaughtError!==void 0&&(s=t.onCaughtError),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=ip(e,1,!1,null,null,n,r,null,o,s,c,Rp),e[dt]=t.current,jd(e),new zp(t)}})),_=o(((e,t)=>{function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>`u`||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=`function`))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),t.exports=g()})),v=_(),y=l(d());function b(e){let t=y.useRef(e);return t.current=e,y.useCallback((...e)=>t.current?.(...e),[])}var x=b;function S(){return!!(typeof window<`u`&&window.document&&window.document.createElement)}var C=S()?y.useLayoutEffect:y.useEffect,w=(e,t)=>{let n=y.useRef(!0);C(()=>e(n.current),t),C(()=>(n.current=!1,()=>{n.current=!0}),[])};const T=(e,t)=>{w(t=>{if(!t)return e()},t)};var E=w;function D(e){let t=y.useRef(!1),[n,r]=y.useState(e);y.useEffect(()=>(t.current=!1,()=>{t.current=!0}),[]);function i(e,n){n&&t.current||r(e)}return[n,i]}function O(e,t){let[n,r]=(0,y.useState)(e),i=t===void 0?n:t;return E(e=>{e||r(t)},[t]),[i,r]}var k=o((e=>{var t=Symbol.for(`react.element`),n=Symbol.for(`react.portal`),r=Symbol.for(`react.fragment`),i=Symbol.for(`react.strict_mode`),a=Symbol.for(`react.profiler`),o=Symbol.for(`react.provider`),s=Symbol.for(`react.context`),c=Symbol.for(`react.server_context`),l=Symbol.for(`react.forward_ref`),u=Symbol.for(`react.suspense`),d=Symbol.for(`react.suspense_list`),f=Symbol.for(`react.memo`),p=Symbol.for(`react.lazy`);function m(e){if(typeof e==`object`&&e){var m=e.$$typeof;switch(m){case t:switch(e=e.type,e){case r:case a:case i:case u:case d:return e;default:switch(e&&=e.$$typeof,e){case c:case s:case l:case p:case f:case o:return e;default:return m}}case n:return m}}}e.ForwardRef=l,e.isMemo=function(e){return m(e)===f}})),A=o(((e,t)=>{t.exports=k()}));function j(e,t,n){let r=y.useRef({});return(!(`value`in r.current)||n(r.current.condition,t))&&(r.current.value=e(),r.current.condition=t),r.current.value}var M=Symbol.for(`react.element`),N=Symbol.for(`react.transitional.element`),ee=Symbol.for(`react.fragment`);function te(e){return e&&typeof e==`object`&&(e.$$typeof===M||e.$$typeof===N)&&e.type===ee}var P=A(),ne=Number(y.version.split(`.`)[0]);const re=(e,t)=>{typeof e==`function`?e(t):typeof e==`object`&&e&&`current`in e&&(e.current=t)},ie=(...e)=>{let t=e.filter(Boolean);return t.length<=1?t[0]:t=>{e.forEach(e=>{re(e,t)})}},ae=(...e)=>j(()=>ie(...e),e,(e,t)=>e.length!==t.length||e.every((e,n)=>e!==t[n])),oe=e=>{if(!e)return!1;if(se(e)&&ne>=19)return!0;let t=(0,P.isMemo)(e)?e.type.type:e.type;return!(typeof t==`function`&&!t.prototype?.render&&t.$$typeof!==P.ForwardRef||typeof e==`function`&&!e.prototype?.render&&e.$$typeof!==P.ForwardRef)};function se(e){return(0,y.isValidElement)(e)&&!te(e)}const ce=e=>{if(e&&se(e)){let t=e;return t.props.propertyIsEnumerable(`ref`)?t.props.ref:t.ref}return null};function le(e,t){let n=e;for(let e=0;e<t.length;e+=1){if(n==null)return;n=n[t[e]]}return n}function ue(e,t,n,r){if(!t.length)return n;let[i,...a]=t,o;return o=!e&&typeof i==`number`?[]:Array.isArray(e)?[...e]:{...e},r&&n===void 0&&a.length===1?delete o[i][a[0]]:o[i]=ue(o[i],a,n,r),o}function de(e,t,n,r=!1){return t.length&&r&&n===void 0&&!le(e,t.slice(0,-1))?e:ue(e,t,n,r)}function fe(e){return typeof e==`object`&&!!e&&Object.getPrototypeOf(e)===Object.prototype}function pe(e){return Array.isArray(e)?[]:{}}var me=typeof Reflect>`u`?Object.keys:Reflect.ownKeys;function he(e,t={}){let{prepareArray:n}=t,r=n||(()=>[]),i=pe(e[0]);return e.forEach(e=>{function t(n,a){let o=new Set(a),s=le(e,n),c=Array.isArray(s);if(c||fe(s)){if(!o.has(s)){o.add(s);let e=le(i,n);c?i=de(i,n,r(e,s)):(!e||typeof e!=`object`)&&(i=de(i,n,pe(s))),me(s).forEach(e=>{t([...n,e],o)})}}else i=de(i,n,s)}t([])}),i}function ge(...e){return he(e)}var _e={},ve=[];const ye=e=>{ve.push(e)};function be(e,t){}function xe(e,t){}function Se(){_e={}}function Ce(e,t,n){!t&&!_e[n]&&(e(!1,n),_e[n]=!0)}function we(e,t){Ce(be,e,t)}function Te(e,t){Ce(xe,e,t)}we.preMessage=ye,we.resetWarned=Se,we.noteOnce=Te;var Ee=we;function De(e,t){let n=Object.assign({},e);return Array.isArray(t)&&t.forEach(e=>{delete n[e]}),n}function Oe(e,t={}){let n=[];return y.Children.forEach(e,e=>{e==null&&!t.keepEmpty||(Array.isArray(e)?n=n.concat(Oe(e)):te(e)&&e.props?n=n.concat(Oe(e.props.children,t)):n.push(e))}),n}function ke(){}var{resetWarned:Ae}=Ee;const je=y.createContext({}),Me=()=>{let e=()=>{};return e.deprecated=ke,e};function Ne(e){return e instanceof HTMLElement||e instanceof SVGElement}function Pe(e){return e&&typeof e==`object`&&Ne(e.nativeElement)?e.nativeElement:Ne(e)?e:null}const Fe=y.createContext(null);function Ie({children:e,onBatchResize:t}){let n=y.useRef(0),r=y.useRef([]),i=y.useContext(Fe),a=y.useCallback((e,a,o)=>{n.current+=1;let s=n.current;r.current.push({size:e,element:a,data:o}),Promise.resolve().then(()=>{s===n.current&&(t?.(r.current),r.current=[])}),i?.(e,a,o)},[t,i]);return y.createElement(Fe.Provider,{value:a},e)}var Le=new Map;function Re(e){e.forEach(e=>{let{target:t}=e;Le.get(t)?.forEach(e=>e(t))})}var ze;function Be(){return ze||=new ResizeObserver(Re),ze}function Ve(e,t){Le.has(e)||(Le.set(e,new Set),Be().observe(e)),Le.get(e).add(t)}function He(e,t){Le.has(e)&&(Le.get(e).delete(t),Le.get(e).size||(Be().unobserve(e),Le.delete(e)))}function Ue(e,t){let{children:n,disabled:r}=e,i=y.useRef(null),a=y.useContext(Fe),o=typeof n==`function`,s=o?n(i):n,c=y.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),l=!o&&y.isValidElement(s)&&oe(s),u=ae(l?ce(s):null,i),d=()=>Pe(i.current);y.useImperativeHandle(t,()=>d());let f=y.useRef(e);f.current=e;let p=y.useCallback(e=>{let{onResize:t,data:n}=f.current,{width:r,height:i}=e.getBoundingClientRect(),{offsetWidth:o,offsetHeight:s}=e,l=Math.floor(r),u=Math.floor(i);if(c.current.width!==l||c.current.height!==u||c.current.offsetWidth!==o||c.current.offsetHeight!==s){let d={width:l,height:u,offsetWidth:o,offsetHeight:s};c.current=d;let f=o===Math.round(r)?r:o,p=s===Math.round(i)?i:s,m={...d,offsetWidth:f,offsetHeight:p};a?.(m,e,n),t&&Promise.resolve().then(()=>{t(m,e)})}},[]);return y.useEffect(()=>{let e=d();return e&&!r&&Ve(e,p),()=>He(e,p)},[i.current,r]),l?y.cloneElement(s,{ref:u}):s}var We=y.forwardRef(Ue);function Ge(){return Ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ge.apply(this,arguments)}var Ke=`rc-observer-key`;function qe(e,t){let{children:n}=e;return(typeof n==`function`?[n]:Oe(n)).map((n,r)=>{let i=n?.key||`${Ke}-${r}`;return y.createElement(We,Ge({},e,{key:i,ref:r===0?t:void 0}),n)})}var Je=y.forwardRef(qe);Je.Collection=Ie;var Ye=Je;function Xe(e){var t,n,r=``;if(typeof e==`string`||typeof e==`number`)r+=e;else if(typeof e==`object`)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=Xe(e[t]))&&(r&&(r+=` `),r+=n)}else for(n in e)e[n]&&(r&&(r+=` `),r+=n);return r}function F(){for(var e,t,n=0,r=``,i=arguments.length;n<i;n++)(e=arguments[n])&&(t=Xe(e))&&(r&&(r+=` `),r+=t);return r}function Ze(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e){if(Array.isArray(e))return Ze(e)}function $e(e){if(typeof Symbol<`u`&&e[Symbol.iterator]!=null||e[`@@iterator`]!=null)return Array.from(e)}function et(e,t){if(e){if(typeof e==`string`)return Ze(e,t);var n={}.toString.call(e).slice(8,-1);return n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`?Array.from(e):n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(e,t):void 0}}function tt(){throw TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nt(e){return Qe(e)||$e(e)||et(e)||tt()}var rt=e=>+setTimeout(e,16),it=e=>clearTimeout(e);typeof window<`u`&&`requestAnimationFrame`in window&&(rt=e=>window.requestAnimationFrame(e),it=e=>window.cancelAnimationFrame(e));var at=0,ot=new Map;function st(e){ot.delete(e)}var ct=(e,t=1)=>{at+=1;let n=at;function r(t){if(t===0)st(n),e();else{let e=rt(()=>{r(t-1)});ot.set(n,e)}}return r(t),n};ct.cancel=e=>{let t=ot.get(e);return st(e),it(t)};var lt=ct;const ut=[`outlined`,`borderless`,`filled`,`underlined`],dt=y.createContext({getPrefixCls:(e,t)=>t||(e?`ant-${e}`:`ant`),iconPrefixCls:`anticon`}),{Consumer:ft}=dt;var pt={};function mt(e){let t=y.useContext(dt),{getPrefixCls:n,direction:r,getPopupContainer:i,renderEmpty:a}=t;return{classNames:pt,styles:pt,...t[e],getPrefixCls:n,direction:r,getPopupContainer:i,renderEmpty:a}}function ht(e){for(var t=0,n,r=0,i=e.length;i>=4;++r,i-=4)n=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,t=(n&65535)*1540483477+((n>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(i){case 3:t^=(e.charCodeAt(r+2)&255)<<16;case 2:t^=(e.charCodeAt(r+1)&255)<<8;case 1:t^=e.charCodeAt(r)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var gt=ht;function _t(e,t){if(!e)return!1;if(e.contains)return e.contains(t);let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}var vt=`data-rc-order`,yt=`data-rc-priority`,bt=`rc-util-key`,xt=new Map;function St({mark:e}={}){return e?e.startsWith(`data-`)?e:`data-${e}`:bt}function Ct(e){return e.attachTo?e.attachTo:document.querySelector(`head`)||document.body}function wt(e){return e===`queue`?`prependQueue`:e?`prepend`:`append`}function Tt(e){return Array.from((xt.get(e)||e).children).filter(e=>e.tagName===`STYLE`)}function Et(e,t={}){if(!S())return null;let{csp:n,prepend:r,priority:i=0}=t,a=wt(r),o=a===`prependQueue`,s=document.createElement(`style`);s.setAttribute(vt,a),o&&i&&s.setAttribute(yt,`${i}`),n?.nonce&&(s.nonce=n?.nonce),s.innerHTML=e;let c=Ct(t),{firstChild:l}=c;if(r){if(o){let e=(t.styles||Tt(c)).filter(e=>[`prepend`,`prependQueue`].includes(e.getAttribute(vt))?i>=Number(e.getAttribute(yt)||0):!1);if(e.length)return c.insertBefore(s,e[e.length-1].nextSibling),s}c.insertBefore(s,l)}else c.appendChild(s);return s}function Dt(e,t={}){let{styles:n}=t;return n||=Tt(Ct(t)),n.find(n=>n.getAttribute(St(t))===e)}function Ot(e,t={}){let n=Dt(e,t);n&&Ct(t).removeChild(n)}function kt(e,t){let n=xt.get(e);if(!n||!_t(document,n)){let n=Et(``,t),{parentNode:r}=n;xt.set(e,r),e.removeChild(n)}}function At(e,t,n={}){let r=Ct(n),i=Tt(r),a={...n,styles:i};kt(r,a);let o=Dt(t,a);if(o)return a.csp?.nonce&&o.nonce!==a.csp?.nonce&&(o.nonce=a.csp?.nonce),o.innerHTML!==e&&(o.innerHTML=e),o;let s=Et(e,a);return s.setAttribute(St(a),t),s}function jt(e,t,n=!1){let r=new Set;function i(e,t,a=1){let o=r.has(e);if(Ee(!o,`Warning: There may be circular references`),o)return!1;if(e===t)return!0;if(n&&a>1)return!1;r.add(e);let s=a+1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n],s))return!1;return!0}if(e&&t&&typeof e==`object`&&typeof t==`object`){let n=Object.keys(e);return n.length===Object.keys(t).length?n.every(n=>i(e[n],t[n],s)):!1}return!1}return i(e,t)}var Mt=jt,Nt=`%`;function Pt(e){return e.join(Nt)}var Ft=0,It=class{instanceId;constructor(e){this.instanceId=e}cache=new Map;updateTimes=new Map;extracted=new Set;get(e){return this.opGet(Pt(e))}opGet(e){return this.cache.get(e)||null}update(e,t){return this.opUpdate(Pt(e),t)}opUpdate(e,t){let n=t(this.cache.get(e));n===null?(this.cache.delete(e),this.updateTimes.delete(e)):(this.cache.set(e,n),this.updateTimes.set(e,Ft),Ft+=1)}};const Lt=`data-token-hash`,Rt=`data-css-hash`,zt=`__cssinjs_instance__`;function Bt(){let e=Math.random().toString(12).slice(2);if(typeof document<`u`&&document.head&&document.body){let t=document.body.querySelectorAll(`style[data-css-hash]`)||[],{firstChild:n}=document.head;Array.from(t).forEach(t=>{t[zt]=t.__cssinjs_instance__||e,t.__cssinjs_instance__===e&&document.head.insertBefore(t,n)});let r={};Array.from(document.querySelectorAll(`style[${Rt}]`)).forEach(t=>{let n=t.getAttribute(Rt);r[n]?t.__cssinjs_instance__===e&&t.parentNode?.removeChild(t):r[n]=!0})}return new It(e)}var Vt=y.createContext({hashPriority:`low`,cache:Bt(),defaultCache:!0,autoPrefix:!1});function Ht(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var Ut=class e{static MAX_CACHE_SIZE=20;static MAX_CACHE_OFFSET=5;cache;keys;cacheCallTimes;constructor(){this.cache=new Map,this.keys=[],this.cacheCallTimes=0}size(){return this.keys.length}internalGet(e,t=!1){let n={map:this.cache};return e.forEach(e=>{n=n?n?.map?.get(e):void 0}),n?.value&&t&&(n.value[1]=this.cacheCallTimes++),n?.value}get(e){return this.internalGet(e,!0)?.[0]}has(e){return!!this.internalGet(e)}set(t,n){if(!this.has(t)){if(this.size()+1>e.MAX_CACHE_SIZE+e.MAX_CACHE_OFFSET){let[e]=this.keys.reduce((e,t)=>{let[,n]=e;return this.internalGet(t)[1]<n?[t,this.internalGet(t)[1]]:e},[this.keys[0],this.cacheCallTimes]);this.delete(e)}this.keys.push(t)}let r=this.cache;t.forEach((e,i)=>{if(i===t.length-1)r.set(e,{value:[n,this.cacheCallTimes++]});else{let t=r.get(e);t?t.map||=new Map:r.set(e,{map:new Map}),r=r.get(e).map}})}deleteByPath(e,t){let n=e.get(t[0]);if(t.length===1)return n.map?e.set(t[0],{map:n.map}):e.delete(t[0]),n.value?.[0];let r=this.deleteByPath(n.map,t.slice(1));return(!n.map||n.map.size===0)&&!n.value&&e.delete(t[0]),r}delete(e){if(this.has(e))return this.keys=this.keys.filter(t=>!Ht(t,e)),this.deleteByPath(this.cache,e)}},Wt=0,Gt=class{derivatives;id;constructor(e){this.derivatives=Array.isArray(e)?e:[e],this.id=Wt,e.length===0&&e.length,Wt+=1}getDerivativeToken(e){return this.derivatives.reduce((t,n)=>n(e,t),void 0)}},Kt=new Ut;function qt(e){let t=Array.isArray(e)?e:[e];return Kt.has(t)||Kt.set(t,new Gt(t)),Kt.get(t)}var Jt=new WeakMap,Yt={};function Xt(e,t){let n=Jt;for(let e=0;e<t.length;e+=1){let r=t[e];n.has(r)||n.set(r,new WeakMap),n=n.get(r)}return n.has(Yt)||n.set(Yt,e()),n.get(Yt)}var Zt=new WeakMap;function Qt(e){let t=Zt.get(e)||``;return t||(Object.keys(e).forEach(n=>{let r=e[n];t+=n,r instanceof Gt?t+=r.id:r&&typeof r==`object`?t+=Qt(r):t+=r}),t=gt(t),Zt.set(e,t)),t}function $t(e,t){return gt(`${t}_${Qt(e)}`)}`random-${Date.now()}-${Math.random()}`.replace(/\./g,``);const en=S();function tn(e){return typeof e==`number`?`${e}px`:e}function nn(e){let{hashCls:t,hashPriority:n=`low`}=e||{};if(!t)return``;let r=`.${t}`;return n===`low`?`:where(${r})`:r}const rn=(e,t=``)=>`--${t?`${t}-`:``}${e}`.replace(/([a-z0-9])([A-Z])/g,`$1-$2`).replace(/([A-Z]+)([A-Z][a-z0-9]+)/g,`$1-$2`).replace(/([a-z])([A-Z0-9])/g,`$1-$2`).toLowerCase(),an=(e,t,n)=>{let{hashCls:r,hashPriority:i=`low`}=n||{};return Object.keys(e).length?`${nn({hashCls:r,hashPriority:i})}.${t}${n?.scope?`.${n.scope}`:``}{${Object.entries(e).map(([e,t])=>`${e}:${t};`).join(``)}}`:``},on=(e,t,n)=>{let{hashCls:r,hashPriority:i=`low`,prefix:a,unitless:o,ignore:s,preserve:c}=n||{},l={},u={};return Object.entries(e).forEach(([e,t])=>{if(c?.[e])u[e]=t;else if((typeof t==`string`||typeof t==`number`)&&!s?.[e]){let n=rn(e,a);l[n]=typeof t==`number`&&!o?.[e]?`${t}px`:String(t),u[e]=`var(${n})`}}),[u,an(l,t,{scope:n?.scope,hashCls:r,hashPriority:i})]};function sn(){return!1}var cn=sn,ln=new Map;function un(e,t,n,r,i){let{cache:a}=y.useContext(Vt),o=Pt([e,...t]);cn();let s=e=>{a.opUpdate(o,t=>{let[r=0,i]=t||[void 0,void 0],a=[r,i||n()];return e?e(a):a})};y.useMemo(()=>{s()},[o]);let c=a.opGet(o)[1];return(0,y.useInsertionEffect)(()=>(s(([e,t])=>[e+1,t]),ln.has(o)||(i?.(c),ln.set(o,!0),Promise.resolve().then(()=>{ln.delete(o)})),()=>{a.opUpdate(o,e=>{let[t=0,n]=e||[];return t-1==0?(r?.(n,!1),ln.delete(o),null):[t-1,n]})}),[o]),c}var dn={},fn=`css`,pn=new Map;function mn(e){pn.set(e,(pn.get(e)||0)+1)}function hn(e,t){typeof document<`u`&&document.querySelectorAll(`style[${Lt}="${e}"]`).forEach(e=>{e.__cssinjs_instance__===t&&e.parentNode?.removeChild(e)})}var gn=-1;function _n(e,t){pn.set(e,(pn.get(e)||0)-1);let n=new Set;pn.forEach((e,t)=>{e<=0&&n.add(t)}),pn.size-n.size>gn&&n.forEach(e=>{hn(e,t),pn.delete(e)})}const vn=(e,t,n,r)=>{let i={...n.getDerivativeToken(e),...t};return r&&(i=r(i)),i};function yn(e,t,n){let{cache:{instanceId:r},container:i,hashPriority:a}=(0,y.useContext)(Vt),{salt:o=``,override:s=dn,formatToken:c,getComputedToken:l,cssVar:u}=n,d=Xt(()=>Object.assign({},...t),t),f=Qt(d),p=Qt(s),m=Qt(u);return un(`token`,[o,e.id,f,p,m],()=>{let t=l?l(d,s,e):vn(d,s,e,c),n={...t},r=`${o}_${u.prefix}`,i=gt(r),f=`${fn}-${gt(r)}`;n._tokenKey=$t(n,r);let[p,m]=on(t,u.key,{prefix:u.prefix,ignore:u.ignore,unitless:u.unitless,preserve:u.preserve,hashPriority:a,hashCls:u.hashed?f:void 0});return p._hashId=i,mn(u.key),[p,f,n,m,u.key]},([,,,,e])=>{_n(e,r)},([,,,e,t])=>{if(!e)return;let n=At(e,gt(`css-var-${t}`),{mark:Rt,prepend:`queue`,attachTo:i,priority:-999});n[zt]=r,n.setAttribute(Lt,t)})}var bn={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},xn=`-ms-`,Sn=`-moz-`,Cn=`-webkit-`,wn=`comm`,Tn=`rule`,En=`decl`,Dn=`@import`,On=`@namespace`,kn=`@keyframes`,An=`@layer`,jn=Math.abs,Mn=String.fromCharCode,Nn=Object.assign;function eee(e,t){return Rn(e,0)^45?(((t<<2^Rn(e,0))<<2^Rn(e,1))<<2^Rn(e,2))<<2^Rn(e,3):0}function Pn(e){return e.trim()}function Fn(e,t){return(e=t.exec(e))?e[0]:e}function In(e,t,n){return e.replace(t,n)}function Ln(e,t,n){return e.indexOf(t,n)}function Rn(e,t){return e.charCodeAt(t)|0}function zn(e,t,n){return e.slice(t,n)}function Bn(e){return e.length}function Vn(e){return e.length}function Hn(e,t){return t.push(e),e}function Un(e,t){return e.map(t).join(``)}function Wn(e,t){return e.filter(function(e){return!Fn(e,t)})}var Gn=1,Kn=1,qn=0,Jn=0,Yn=0,Xn=``;function Zn(e,t,n,r,i,a,o,s){return{value:e,root:t,parent:n,type:r,props:i,children:a,line:Gn,column:Kn,length:o,return:``,siblings:s}}function Qn(e,t){return Nn(Zn(``,null,null,``,null,null,0,e.siblings),e,{length:-e.length},t)}function $n(e){for(;e.root;)e=Qn(e.root,{children:[e]});Hn(e,e.siblings)}function er(){return Yn}function tr(){return Yn=Jn>0?Rn(Xn,--Jn):0,Kn--,Yn===10&&(Kn=1,Gn--),Yn}function nr(){return Yn=Jn<qn?Rn(Xn,Jn++):0,Kn++,Yn===10&&(Kn=1,Gn++),Yn}function rr(){return Rn(Xn,Jn)}function ir(){return Jn}function ar(e,t){return zn(Xn,e,t)}function or(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function sr(e){return Gn=Kn=1,qn=Bn(Xn=e),Jn=0,[]}function cr(e){return Xn=``,e}function lr(e){return Pn(ar(Jn-1,fr(e===91?e+2:e===40?e+1:e)))}function ur(e){for(;(Yn=rr())&&Yn<33;)nr();return or(e)>2||or(Yn)>3?``:` `}function dr(e,t){for(;--t&&nr()&&!(Yn<48||Yn>102||Yn>57&&Yn<65||Yn>70&&Yn<97););return ar(e,ir()+(t<6&&rr()==32&&nr()==32))}function fr(e){for(;nr();)switch(Yn){case e:return Jn;case 34:case 39:e!==34&&e!==39&&fr(Yn);break;case 40:e===41&&fr(e);break;case 92:nr();break}return Jn}function pr(e,t){for(;nr()&&e+Yn!==57&&!(e+Yn===84&&rr()===47););return`/*`+ar(t,Jn-1)+`*`+Mn(e===47?e:nr())}function mr(e){for(;!or(rr());)nr();return ar(e,Jn)}function hr(e){return cr(gr(``,null,null,null,[``],e=sr(e),0,[0],e))}function gr(e,t,n,r,i,a,o,s,c){for(var l=0,u=0,d=o,f=0,p=0,m=0,h=1,g=1,_=1,v=0,y=``,b=i,x=a,S=r,C=y;g;)switch(m=v,v=nr()){case 40:if(m!=108&&Rn(C,d-1)==58){Ln(C+=In(lr(v),`&`,`&\f`),`&\f`,jn(l?s[l-1]:0))!=-1&&(_=-1);break}case 34:case 39:case 91:C+=lr(v);break;case 9:case 10:case 13:case 32:C+=ur(m);break;case 92:C+=dr(ir()-1,7);continue;case 47:switch(rr()){case 42:case 47:Hn(vr(pr(nr(),ir()),t,n,c),c),(or(m||1)==5||or(rr()||1)==5)&&Bn(C)&&zn(C,-1,void 0)!==` `&&(C+=` `);break;default:C+=`/`}break;case 123*h:s[l++]=Bn(C)*_;case 125*h:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:_==-1&&(C=In(C,/\f/g,``)),p>0&&(Bn(C)-d||h===0&&m===47)&&Hn(p>32?yr(C+`;`,r,n,d-1,c):yr(In(C,` `,``)+`;`,r,n,d-2,c),c);break;case 59:C+=`;`;default:if(Hn(S=_r(C,t,n,l,u,i,s,y,b=[],x=[],d,a),a),v===123)if(u===0)gr(C,t,S,S,b,a,d,s,x);else{switch(f){case 99:if(Rn(C,3)===110)break;case 108:if(Rn(C,2)===97)break;default:u=0;case 100:case 109:case 115:}u?gr(e,S,S,r&&Hn(_r(e,S,S,0,0,i,s,y,i,b=[],d,x),x),i,x,d,s,r?b:x):gr(C,S,S,S,[``],x,0,s,x)}}l=u=p=0,h=_=1,y=C=``,d=o;break;case 58:d=1+Bn(C),p=m;default:if(h<1){if(v==123)--h;else if(v==125&&h++==0&&tr()==125)continue}switch(C+=Mn(v),v*h){case 38:_=u>0?1:(C+=`\f`,-1);break;case 44:s[l++]=(Bn(C)-1)*_,_=1;break;case 64:rr()===45&&(C+=lr(nr())),f=rr(),u=d=Bn(y=C+=mr(ir())),v++;break;case 45:m===45&&Bn(C)==2&&(h=0)}}return a}function _r(e,t,n,r,i,a,o,s,c,l,u,d){for(var f=i-1,p=i===0?a:[``],m=Vn(p),h=0,g=0,_=0;h<r;++h)for(var v=0,y=zn(e,f+1,f=jn(g=o[h])),b=e;v<m;++v)(b=Pn(g>0?p[v]+` `+y:In(y,/&\f/g,p[v])))&&(c[_++]=b);return Zn(e,t,n,i===0?Tn:s,c,l,u,d)}function vr(e,t,n,r){return Zn(e,t,n,wn,Mn(er()),zn(e,2,-2),0,r)}function yr(e,t,n,r,i){return Zn(e,t,n,En,zn(e,0,r),zn(e,r+1,-1),r,i)}function br(e,t,n){switch(eee(e,t)){case 5103:return Cn+`print-`+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:case 6391:case 5879:case 5623:case 6135:case 4599:return Cn+e+e;case 4855:return Cn+e.replace(`add`,`source-over`).replace(`substract`,`source-out`).replace(`intersect`,`source-in`).replace(`exclude`,`xor`)+e;case 4789:return Sn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Cn+e+Sn+e+xn+e+e;case 5936:switch(Rn(e,t+11)){case 114:return Cn+e+xn+In(e,/[svh]\w+-[tblr]{2}/,`tb`)+e;case 108:return Cn+e+xn+In(e,/[svh]\w+-[tblr]{2}/,`tb-rl`)+e;case 45:return Cn+e+xn+In(e,/[svh]\w+-[tblr]{2}/,`lr`)+e}case 6828:case 4268:case 2903:return Cn+e+xn+e+e;case 6165:return Cn+e+xn+`flex-`+e+e;case 5187:return Cn+e+In(e,/(\w+).+(:[^]+)/,Cn+`box-$1$2`+xn+`flex-$1$2`)+e;case 5443:return Cn+e+xn+`flex-item-`+In(e,/flex-|-self/g,``)+(Fn(e,/flex-|baseline/)?``:xn+`grid-row-`+In(e,/flex-|-self/g,``))+e;case 4675:return Cn+e+xn+`flex-line-pack`+In(e,/align-content|flex-|-self/g,``)+e;case 5548:return Cn+e+xn+In(e,`shrink`,`negative`)+e;case 5292:return Cn+e+xn+In(e,`basis`,`preferred-size`)+e;case 6060:return Cn+`box-`+In(e,`-grow`,``)+Cn+e+xn+In(e,`grow`,`positive`)+e;case 4554:return Cn+In(e,/([^-])(transform)/g,`$1`+Cn+`$2`)+e;case 6187:return In(In(In(e,/(zoom-|grab)/,Cn+`$1`),/(image-set)/,Cn+`$1`),e,``)+e;case 5495:case 3959:return In(e,/(image-set\([^]*)/,Cn+"$1$`$1");case 4968:return In(In(e,/(.+:)(flex-)?(.*)/,Cn+`box-pack:$3`+xn+`flex-pack:$3`),/space-between/,`justify`)+Cn+e+e;case 4200:if(!Fn(e,/flex-|baseline/))return xn+`grid-column-align`+zn(e,t)+e;break;case 2592:case 3360:return xn+In(e,`template-`,``)+e;case 4384:case 3616:return n&&n.some(function(e,n){return t=n,Fn(e.props,/grid-\w+-end/)})?~Ln(e+(n=n[t].value),`span`,0)?e:xn+In(e,`-start`,``)+e+xn+`grid-row-span:`+(~Ln(n,`span`,0)?Fn(n,/\d+/):Fn(n,/\d+/)-+Fn(e,/\d+/))+`;`:xn+In(e,`-start`,``)+e;case 4896:case 4128:return n&&n.some(function(e){return Fn(e.props,/grid-\w+-start/)})?e:xn+In(In(e,`-end`,`-span`),`span `,``)+e;case 4095:case 3583:case 4068:case 2532:return In(e,/(.+)-inline(.+)/,Cn+`$1$2`)+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Bn(e)-1-t>6)switch(Rn(e,t+1)){case 109:if(Rn(e,t+4)!==45)break;case 102:return In(e,/(.+:)(.+)-([^]+)/,`$1`+Cn+`$2-$3$1`+Sn+(Rn(e,t+3)==108?`$3`:`$2-$3`))+e;case 115:return~Ln(e,`stretch`,0)?br(In(e,`stretch`,`fill-available`),t,n)+e:e}break;case 5152:case 5920:return In(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(t,n,r,i,a,o,s){return xn+n+`:`+r+s+(i?xn+n+`-span:`+(a?o:o-+r)+s:``)+e});case 4949:if(Rn(e,t+6)===121)return In(e,`:`,`:`+Cn)+e;break;case 6444:switch(Rn(e,Rn(e,14)===45?18:11)){case 120:return In(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,`$1`+Cn+(Rn(e,14)===45?`inline-`:``)+`box$3$1`+Cn+`$2$3$1`+xn+`$2box$3`)+e;case 100:return In(e,`:`,`:`+xn)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return In(e,`scroll-`,`scroll-snap-`)+e}return e}function xr(e,t){for(var n=``,r=0;r<e.length;r++)n+=t(e[r],r,e,t)||``;return n}function Sr(e,t,n,r){switch(e.type){case An:if(e.children.length)break;case Dn:case On:case En:return e.return=e.return||e.value;case wn:return``;case kn:return e.return=e.value+`{`+xr(e.children,r)+`}`;case Tn:if(!Bn(e.value=e.props.join(`,`)))return``}return Bn(n=xr(e.children,r))?e.return=e.value+`{`+n+`}`:``}function Cr(e){var t=Vn(e);return function(n,r,i,a){for(var o=``,s=0;s<t;s++)o+=e[s](n,r,i,a)||``;return o}}function wr(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case En:e.return=br(e.value,e.length,n);return;case kn:return xr([Qn(e,{value:In(e.value,`@`,`@`+Cn)})],r);case Tn:if(e.length)return Un(n=e.props,function(t){switch(Fn(t,r=/(::plac\w+|:read-\w+)/)){case`:read-only`:case`:read-write`:$n(Qn(e,{props:[In(t,/:(read-\w+)/,`:`+Sn+`$1`)]})),$n(Qn(e,{props:[t]})),Nn(e,{props:Wn(n,r)});break;case`::placeholder`:$n(Qn(e,{props:[In(t,/:(plac\w+)/,`:`+Cn+`input-$1`)]})),$n(Qn(e,{props:[In(t,/:(plac\w+)/,`:`+Sn+`$1`)]})),$n(Qn(e,{props:[In(t,/:(plac\w+)/,xn+`input-$1`)]})),$n(Qn(e,{props:[t]})),Nn(e,{props:Wn(n,r)});break}return``})}}const Tr=`data-ant-cssinjs-cache-path`;var Er,Dr=!0;function Or(){if(!Er&&(Er={},S())){let e=document.createElement(`div`);e.className=Tr,e.style.position=`fixed`,e.style.visibility=`hidden`,e.style.top=`-9999px`,document.body.appendChild(e);let t=getComputedStyle(e).content||``;t=t.replace(/^"/,``).replace(/"$/,``),t.split(`;`).forEach(e=>{let[t,n]=e.split(`:`);Er[t]=n});let n=document.querySelector(`style[${Tr}]`);n&&(Dr=!1,n.parentNode?.removeChild(n)),document.body.removeChild(e)}}function kr(e){return Or(),!!Er[e]}function Ar(e){let t=Er[e],n=null;if(t&&S())if(Dr)n=`_FILE_STYLE__`;else{let t=document.querySelector(`style[${Rt}="${Er[e]}"]`);t?n=t.innerHTML:delete Er[e]}return[n,t]}var jr=`_skip_check_`,Mr=`_multi_value_`;function Nr(e,t){return(t?xr(hr(e),Cr([wr,Sr])):xr(hr(e),Sr)).replace(/\{%%%\:[^;];}/g,`;`)}function Pr(e){return typeof e==`object`&&e&&(jr in e||Mr in e)}function Fr(e,t,n){if(!t)return e;let r=`.${t}`,i=n===`low`?`:where(${r})`:r;return e.split(`,`).map(e=>{let t=e.trim().split(/\s+/),n=t[0]||``,r=n.match(/^\w+/)?.[0]||``;return n=`${r}${i}${n.slice(r.length)}`,[n,...t.slice(1)].join(` `)}).join(`,`)}const Ir=(e,t={},{root:n,injectHash:r,parentSelectors:i}={root:!0,parentSelectors:[]})=>{let{hashId:a,layer:o,path:s,hashPriority:c,transformers:l=[],linters:u=[]}=t,d=``,f={};function p(e){let n=e.getName(a);if(!f[n]){let[r]=Ir(e.style,t,{root:!1,parentSelectors:i});f[n]=`@keyframes ${e.getName(a)}${r}`}}function m(e,t=[]){return e.forEach(e=>{Array.isArray(e)?m(e,t):e&&t.push(e)}),t}return m(Array.isArray(e)?e:[e]).forEach(e=>{let o=typeof e==`string`&&!n?{}:e;if(typeof o==`string`)d+=`${o}\n`;else if(o._keyframe)p(o);else{let e=l.reduce((e,t)=>t?.visit?.(e)||e,o);Object.keys(e).forEach(o=>{let s=e[o];if(typeof s==`object`&&s&&(o!==`animationName`||!s._keyframe)&&!Pr(s)){let e=!1,l=o.trim(),u=!1;(n||r)&&a?l.startsWith(`@`)?e=!0:l=Fr(l===`&`?``:o,a,c):n&&!a&&(l===`&`||l===``)&&(l=``,u=!0);let[p,m]=Ir(s,t,{root:u,injectHash:e,parentSelectors:[...i,l]});f={...f,...m},d+=`${l}${p}`}else{function e(e,t){let n=e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`),r=t;!bn[e]&&typeof r==`number`&&r!==0&&(r=`${r}px`),e===`animationName`&&t?._keyframe&&(p(t),r=t.getName(a)),d+=`${n}:${r};`}let t=s?.value??s;typeof s==`object`&&s?.[Mr]&&Array.isArray(t)?t.forEach(t=>{e(o,t)}):e(o,t)}})}}),n?o&&(d&&=`@layer ${o.name} {${d}}`,o.dependencies&&(f[`@layer ${o.name}`]=o.dependencies.map(e=>`@layer ${e}, ${o.name};`).join(`
`))):d=`{${d}}`,[d,f]};function Lr(e,t){return gt(`${e.join(`%`)}${t}`)}function Rr(e,t){let{path:n,hashId:r,layer:i,nonce:a,clientOnly:o,order:s=0}=e,{mock:c,hashPriority:l,container:u,transformers:d,linters:f,cache:p,layer:m,autoPrefix:h}=y.useContext(Vt),g=[r||``];m&&g.push(`layer`),g.push(...n);let _=en;un(`style`,g,()=>{let e=g.join(`|`);if(kr(e)){let[t,n]=Ar(e);if(t)return[t,n,{},o,s]}let[a,c]=Ir(t(),{hashId:r,hashPriority:l,layer:m?i:void 0,path:n.join(`-`),transformers:d,linters:f}),u=Nr(a,h||!1);return[u,Lr(g,u),c,o,s]},(e,t)=>{let[,n]=e;t&&en&&Ot(n,{mark:Rt,attachTo:u})},e=>{let[t,n,r,,i]=e;if(_&&t!==`_FILE_STYLE__`){let e={mark:Rt,prepend:m?!1:`queue`,attachTo:u,priority:i},o=typeof a==`function`?a():a;o&&(e.csp={nonce:o});let s=[],c=[];Object.keys(r).forEach(e=>{e.startsWith(`@layer`)?s.push(e):c.push(e)}),s.forEach(t=>{At(Nr(r[t],h||!1),`_layer-${t}`,{...e,prepend:!0})});let l=At(t,n,e);l[zt]=p.instanceId,c.forEach(t=>{At(Nr(r[t],h||!1),`_effect-${t}`,e)})}})}var zr=(e,t)=>{let{key:n,prefix:r,unitless:i,ignore:a,token:o,hashId:s,scope:c=``}=e,{cache:{instanceId:l},container:u,hashPriority:d}=(0,y.useContext)(Vt),{_tokenKey:f}=o,p=[...e.path,n,c,f];return un(`cssVar`,p,()=>{let[e,o]=on(t(),n,{prefix:r,unitless:i,ignore:a,scope:c,hashPriority:d,hashCls:s});return[e,o,Lr(p,o),n]},([,,e])=>{en&&Ot(e,{mark:Rt,attachTo:u})},([,e,t])=>{if(!e)return;let r=At(e,t,{mark:Rt,prepend:`queue`,attachTo:u,priority:-999});r[zt]=l,r.setAttribute(Lt,n)})},Br=class{name;style;constructor(e,t){this.name=e,this.style=t}getName(e=``){return e?`${e}-${this.name}`:this.name}_keyframe=!0};function Vr(e){return e.notSplit=!0,e}Vr([`borderTop`,`borderBottom`]),Vr([`borderTop`]),Vr([`borderBottom`]),Vr([`borderLeft`,`borderRight`]),Vr([`borderLeft`]),Vr([`borderRight`]);function Hr(e){"@babel/helpers - typeof";return Hr=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},Hr(e)}function Ur(e){if(Array.isArray(e))return e}function Wr(e,t){var n=e==null?null:typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`];if(n!=null){var r,i,a,o,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return s}}function tee(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gr(e,t){return Ur(e)||Wr(e,t)||et(e,t)||tee()}function Kr(e,t){if(Hr(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(Hr(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function qr(e){var t=Kr(e,`string`);return Hr(t)==`symbol`?t:t+``}function Jr(e,t,n){return(t=qr(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?Yr(Object(n),!0).forEach(function(t){Jr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Zr(e,t){if(!(e instanceof t))throw TypeError(`Cannot call a class as a function`)}function Qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,`value`in r&&(r.writable=!0),Object.defineProperty(e,qr(r.key),r)}}function $r(e,t,n){return t&&Qr(e.prototype,t),n&&Qr(e,n),Object.defineProperty(e,`prototype`,{writable:!1}),e}function ei(e){if(e===void 0)throw ReferenceError(`this hasn't been initialised - super() hasn't been called`);return e}function ti(e,t){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ti(e,t)}function ni(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Super expression must either be null or a function`);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,`prototype`,{writable:!1}),t&&ti(e,t)}function ri(e){return ri=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ri(e)}function ii(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ii=function(){return!!e})()}function ai(e,t){if(t&&(Hr(t)==`object`||typeof t==`function`))return t;if(t!==void 0)throw TypeError(`Derived constructors may only return object or undefined`);return ei(e)}function oi(e){var t=ii();return function(){var n,r=ri(e);if(t){var i=ri(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ai(this,n)}}var si=$r(function e(){Zr(this,e)}),ci=`CALC_UNIT`,li=new RegExp(ci,`g`);function ui(e){return typeof e==`number`?`${e}${ci}`:e}var di=function(e){ni(n,e);var t=oi(n);function n(e,r){var i;Zr(this,n),i=t.call(this),Jr(ei(i),`result`,``),Jr(ei(i),`unitlessCssVar`,void 0),Jr(ei(i),`lowPriority`,void 0);var a=Hr(e);return i.unitlessCssVar=r,e instanceof n?i.result=`(${e.result})`:a===`number`?i.result=ui(e):a===`string`&&(i.result=e),i}return $r(n,[{key:`add`,value:function(e){return e instanceof n?this.result=`${this.result} + ${e.getResult()}`:(typeof e==`number`||typeof e==`string`)&&(this.result=`${this.result} + ${ui(e)}`),this.lowPriority=!0,this}},{key:`sub`,value:function(e){return e instanceof n?this.result=`${this.result} - ${e.getResult()}`:(typeof e==`number`||typeof e==`string`)&&(this.result=`${this.result} - ${ui(e)}`),this.lowPriority=!0,this}},{key:`mul`,value:function(e){return this.lowPriority&&(this.result=`(${this.result})`),e instanceof n?this.result=`${this.result} * ${e.getResult(!0)}`:(typeof e==`number`||typeof e==`string`)&&(this.result=`${this.result} * ${e}`),this.lowPriority=!1,this}},{key:`div`,value:function(e){return this.lowPriority&&(this.result=`(${this.result})`),e instanceof n?this.result=`${this.result} / ${e.getResult(!0)}`:(typeof e==`number`||typeof e==`string`)&&(this.result=`${this.result} / ${e}`),this.lowPriority=!1,this}},{key:`getResult`,value:function(e){return this.lowPriority||e?`(${this.result})`:this.result}},{key:`equal`,value:function(e){var t=this,n=(e||{}).unit,r=!0;return typeof n==`boolean`?r=n:Array.from(this.unitlessCssVar).some(function(e){return t.result.includes(e)})&&(r=!1),this.result=this.result.replace(li,r?`px`:``),this.lowPriority===void 0?this.result:`calc(${this.result})`}}]),n}(si),fi=function(e){ni(n,e);var t=oi(n);function n(e){var r;return Zr(this,n),r=t.call(this),Jr(ei(r),`result`,0),e instanceof n?r.result=e.result:typeof e==`number`&&(r.result=e),r}return $r(n,[{key:`add`,value:function(e){return e instanceof n?this.result+=e.result:typeof e==`number`&&(this.result+=e),this}},{key:`sub`,value:function(e){return e instanceof n?this.result-=e.result:typeof e==`number`&&(this.result-=e),this}},{key:`mul`,value:function(e){return e instanceof n?this.result*=e.result:typeof e==`number`&&(this.result*=e),this}},{key:`div`,value:function(e){return e instanceof n?this.result/=e.result:typeof e==`number`&&(this.result/=e),this}},{key:`equal`,value:function(){return this.result}}]),n}(si),pi=function(e,t){var n=e===`css`?di:fi;return function(e){return new n(e,t)}},mi=function(e,t){return`${[t,e.replace(/([A-Z]+)([A-Z][a-z]+)/g,`$1-$2`).replace(/([a-z])([A-Z])/g,`$1-$2`)].filter(Boolean).join(`-`)}`};function hi(e,t,n,r){var i=Xr({},t[e]);r!=null&&r.deprecatedTokens&&r.deprecatedTokens.forEach(function(e){var t=Gr(e,2),n=t[0],r=t[1];(i!=null&&i[n]||i!=null&&i[r])&&(i[r]??(i[r]=i?.[n]))});var a=Xr(Xr({},n),i);return Object.keys(a).forEach(function(e){a[e]===t[e]&&delete a[e]}),a}var gi=hi,_i=typeof CSSINJS_STATISTIC<`u`,vi=!0;function yi(){var e=[...arguments];if(!_i)return Object.assign.apply(Object,[{}].concat(e));vi=!1;var t={};return e.forEach(function(e){Hr(e)===`object`&&Object.keys(e).forEach(function(n){Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return e[n]}})})}),vi=!0,t}var bi={};function xi(){}var Si=function(e){var t,n=e,r=xi;return _i&&typeof Proxy<`u`&&(t=new Set,n=new Proxy(e,{get:function(e,n){if(vi){var r;(r=t)==null||r.add(n)}return e[n]}}),r=function(e,n){bi[e]={global:Array.from(t),component:Xr(Xr({},bi[e]?.component),n)}}),{token:n,keys:t,flush:r}};function Ci(e,t,n){return typeof n==`function`?n(yi(t,t[e]??{})):n??{}}var wi=Ci;function Ti(e){return e===`js`?{max:Math.max,min:Math.min}:{max:function(){return`max(${[...arguments].map(function(e){return tn(e)}).join(`,`)})`},min:function(){return`min(${[...arguments].map(function(e){return tn(e)}).join(`,`)})`}}}var Ei=Ti,Di=1e3*60*10,Oi=new(function(){function e(){Zr(this,e),Jr(this,`map`,new Map),Jr(this,`objectIDMap`,new WeakMap),Jr(this,`nextID`,0),Jr(this,`lastAccessBeat`,new Map),Jr(this,`accessBeat`,0)}return $r(e,[{key:`set`,value:function(e,t){this.clear();var n=this.getCompositeKey(e);this.map.set(n,t),this.lastAccessBeat.set(n,Date.now())}},{key:`get`,value:function(e){var t=this.getCompositeKey(e),n=this.map.get(t);return this.lastAccessBeat.set(t,Date.now()),this.accessBeat+=1,n}},{key:`getCompositeKey`,value:function(e){var t=this;return e.map(function(e){return e&&Hr(e)===`object`?`obj_${t.getObjectID(e)}`:`${Hr(e)}_${e}`}).join(`|`)}},{key:`getObjectID`,value:function(e){if(this.objectIDMap.has(e))return this.objectIDMap.get(e);var t=this.nextID;return this.objectIDMap.set(e,t),this.nextID+=1,t}},{key:`clear`,value:function(){var e=this;if(this.accessBeat>1e4){var t=Date.now();this.lastAccessBeat.forEach(function(n,r){t-n>Di&&(e.map.delete(r),e.lastAccessBeat.delete(r))}),this.accessBeat=0}}}]),e}());function ki(e,t){return y.useMemo(function(){var n=Oi.get(t);if(n)return n;var r=e();return Oi.set(t,r),r},t)}var Ai=ki,ji=function(){return{}};function Mi(e){var t=e.useCSP,n=t===void 0?ji:t,r=e.useToken,i=e.usePrefix,a=e.getResetStyles,o=e.getCommonStyle,s=e.getCompUnitless;function c(e,t,n,r){var i=Array.isArray(e)?e[0]:e;function a(e){return`${String(i)}${e.slice(0,1).toUpperCase()}${e.slice(1)}`}var o=r?.unitless||{},c=Xr(Xr({},typeof s==`function`?s(e):{}),{},Jr({},a(`zIndexPopup`),!0));Object.keys(o).forEach(function(e){c[a(e)]=o[e]});var d=Xr(Xr({},r),{},{unitless:c,prefixToken:a}),f=u(e,t,n,d),p=l(i,n,d);return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e;return[f(e,t),p(t)]}}function l(e,t,n){var i=n.unitless,a=n.prefixToken,o=n.ignore;return function(s){var c=r(),l=c.cssVar,u=c.realToken;return zr({path:[e],prefix:l.prefix,key:l.key,unitless:i,ignore:o,token:u,scope:s},function(){var r=wi(e,u,t),i=gi(e,u,r,{deprecatedTokens:n?.deprecatedTokens});return r&&Object.keys(r).forEach(function(e){i[a(e)]=i[e],delete i[e]}),i}),l?.key}}function u(t,s,c){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=Array.isArray(t)?t:[t,t],d=Gr(u,1)[0],f=u.join(`-`),p=e.layer||{name:`antd`};return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,u=r(),m=u.theme,h=u.realToken,g=u.hashId,_=u.token,v=u.cssVar,b=u.zeroRuntime;if((0,y.useMemo)(function(){return b},[]))return g;var x=i(),S=x.rootPrefixCls,C=x.iconPrefixCls,w=n(),T=`css`,E=Ai(function(){var e=new Set;return Object.keys(l.unitless||{}).forEach(function(t){e.add(rn(t,v.prefix)),e.add(rn(t,mi(d,v.prefix)))}),pi(T,e)},[T,d,v?.prefix]),D=Ei(T),O=D.max,k=D.min,A={theme:m,token:_,hashId:g,nonce:function(){return w.nonce},clientOnly:l.clientOnly,layer:p,order:l.order||-999};return typeof a==`function`&&Rr(Xr(Xr({},A),{},{clientOnly:!1,path:[`Shared`,S]}),function(){return a(_,{prefix:{rootPrefixCls:S,iconPrefixCls:C},csp:w})}),Rr(Xr(Xr({},A),{},{path:[f,e,C]}),function(){if(l.injectStyle===!1)return[];var n=Si(_),r=n.token,i=n.flush,a=wi(d,h,c),u=`.${e}`,f=gi(d,h,a,{deprecatedTokens:l.deprecatedTokens});a&&Hr(a)===`object`&&Object.keys(a).forEach(function(e){a[e]=`var(${rn(e,mi(d,v.prefix))})`});var p=yi(r,{componentCls:u,prefixCls:e,iconCls:`.${C}`,antCls:`.${S}`,calc:E,max:O,min:k},a),m=s(p,{hashId:g,prefixCls:e,rootPrefixCls:S,iconPrefixCls:C});i(d,f);var y=typeof o==`function`?o(p,e,t,l.resetFont):null;return[l.resetStyle===!1?null:y,m]}),g}}function d(e,t,n){var r=u(e,t,n,Xr({resetStyle:!1,order:-998},arguments.length>3&&arguments[3]!==void 0?arguments[3]:{}));return function(e){var t=e.prefixCls,n=e.rootCls;return r(t,n===void 0?t:n),null}}return{genStyleHooks:c,genSubStyleComponent:d,genComponentStyleHook:u}}var Ni=Mi;const Pi=[`blue`,`purple`,`cyan`,`green`,`magenta`,`pink`,`red`,`orange`,`yellow`,`volcano`,`geekblue`,`lime`,`gold`];function Fi(e){return(e+8)/e}function Ii(e){let t=Array.from({length:10}).map((t,n)=>{let r=n-1,i=e*Math.E**(r/5),a=n>1?Math.floor(i):Math.ceil(i);return Math.floor(a/2)*2});return t[1]=e,t.map(e=>({size:e,lineHeight:Fi(e)}))}var Li=`6.1.0`;const Ri={blue:`#1677FF`,purple:`#722ED1`,cyan:`#13C2C2`,green:`#52C41A`,magenta:`#EB2F96`,pink:`#EB2F96`,red:`#F5222D`,orange:`#FA8C16`,yellow:`#FADB14`,volcano:`#FA541C`,geekblue:`#2F54EB`,gold:`#FAAD14`,lime:`#A0D911`};var zi={...Ri,colorPrimary:`#1677ff`,colorSuccess:`#52c41a`,colorWarning:`#faad14`,colorError:`#ff4d4f`,colorInfo:`#1677ff`,colorLink:``,colorTextBase:``,colorBgBase:``,fontFamily:`-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
'Noto Color Emoji'`,fontFamilyCode:`'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace`,fontSize:14,lineWidth:1,lineType:`solid`,motionUnit:.1,motionBase:0,motionEaseOutCirc:`cubic-bezier(0.08, 0.82, 0.17, 1)`,motionEaseInOutCirc:`cubic-bezier(0.78, 0.14, 0.15, 0.86)`,motionEaseOut:`cubic-bezier(0.215, 0.61, 0.355, 1)`,motionEaseInOut:`cubic-bezier(0.645, 0.045, 0.355, 1)`,motionEaseOutBack:`cubic-bezier(0.12, 0.4, 0.29, 1.46)`,motionEaseInBack:`cubic-bezier(0.71, -0.46, 0.88, 0.6)`,motionEaseInQuint:`cubic-bezier(0.755, 0.05, 0.855, 0.06)`,motionEaseOutQuint:`cubic-bezier(0.23, 1, 0.32, 1)`,borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0},Bi={aliceblue:`9ehhb`,antiquewhite:`9sgk7`,aqua:`1ekf`,aquamarine:`4zsno`,azure:`9eiv3`,beige:`9lhp8`,bisque:`9zg04`,black:`0`,blanchedalmond:`9zhe5`,blue:`73`,blueviolet:`5e31e`,brown:`6g016`,burlywood:`8ouiv`,cadetblue:`3qba8`,chartreuse:`4zshs`,chocolate:`87k0u`,coral:`9yvyo`,cornflowerblue:`3xael`,cornsilk:`9zjz0`,crimson:`8l4xo`,cyan:`1ekf`,darkblue:`3v`,darkcyan:`rkb`,darkgoldenrod:`776yz`,darkgray:`6mbhl`,darkgreen:`jr4`,darkgrey:`6mbhl`,darkkhaki:`7ehkb`,darkmagenta:`5f91n`,darkolivegreen:`3bzfz`,darkorange:`9yygw`,darkorchid:`5z6x8`,darkred:`5f8xs`,darksalmon:`9441m`,darkseagreen:`5lwgf`,darkslateblue:`2th1n`,darkslategray:`1ugcv`,darkslategrey:`1ugcv`,darkturquoise:`14up`,darkviolet:`5rw7n`,deeppink:`9yavn`,deepskyblue:`11xb`,dimgray:`442g9`,dimgrey:`442g9`,dodgerblue:`16xof`,firebrick:`6y7tu`,floralwhite:`9zkds`,forestgreen:`1cisi`,fuchsia:`9y70f`,gainsboro:`8m8kc`,ghostwhite:`9pq0v`,goldenrod:`8j4f4`,gold:`9zda8`,gray:`50i2o`,green:`pa8`,greenyellow:`6senj`,grey:`50i2o`,honeydew:`9eiuo`,hotpink:`9yrp0`,indianred:`80gnw`,indigo:`2xcoy`,ivory:`9zldc`,khaki:`9edu4`,lavenderblush:`9ziet`,lavender:`90c8q`,lawngreen:`4vk74`,lemonchiffon:`9zkct`,lightblue:`6s73a`,lightcoral:`9dtog`,lightcyan:`8s1rz`,lightgoldenrodyellow:`9sjiq`,lightgray:`89jo3`,lightgreen:`5nkwg`,lightgrey:`89jo3`,lightpink:`9z6wx`,lightsalmon:`9z2ii`,lightseagreen:`19xgq`,lightskyblue:`5arju`,lightslategray:`4nwk9`,lightslategrey:`4nwk9`,lightsteelblue:`6wau6`,lightyellow:`9zlcw`,lime:`1edc`,limegreen:`1zcxe`,linen:`9shk6`,magenta:`9y70f`,maroon:`4zsow`,mediumaquamarine:`40eju`,mediumblue:`5p`,mediumorchid:`79qkz`,mediumpurple:`5r3rv`,mediumseagreen:`2d9ip`,mediumslateblue:`4tcku`,mediumspringgreen:`1di2`,mediumturquoise:`2uabw`,mediumvioletred:`7rn9h`,midnightblue:`z980`,mintcream:`9ljp6`,mistyrose:`9zg0x`,moccasin:`9zfzp`,navajowhite:`9zest`,navy:`3k`,oldlace:`9wq92`,olive:`50hz4`,olivedrab:`472ub`,orange:`9z3eo`,orangered:`9ykg0`,orchid:`8iu3a`,palegoldenrod:`9bl4a`,palegreen:`5yw0o`,paleturquoise:`6v4ku`,palevioletred:`8k8lv`,papayawhip:`9zi6t`,peachpuff:`9ze0p`,peru:`80oqn`,pink:`9z8wb`,plum:`8nba5`,powderblue:`6wgdi`,purple:`4zssg`,rebeccapurple:`3zk49`,red:`9y6tc`,rosybrown:`7cv4f`,royalblue:`2jvtt`,saddlebrown:`5fmkz`,salmon:`9rvci`,sandybrown:`9jn1c`,seagreen:`1tdnb`,seashell:`9zje6`,sienna:`6973h`,silver:`7ir40`,skyblue:`5arjf`,slateblue:`45e4t`,slategray:`4e100`,slategrey:`4e100`,snow:`9zke2`,springgreen:`1egv`,steelblue:`2r1kk`,tan:`87yx8`,teal:`pds`,thistle:`8ggk8`,tomato:`9yqfb`,turquoise:`2j4r4`,violet:`9b10u`,wheat:`9ld4j`,white:`9zldr`,whitesmoke:`9lhpx`,yellow:`9zl6o`,yellowgreen:`61fzm`},Vi=Math.round;function Hi(e,t){let n=e.replace(/^[^(]*\((.*)/,`$1`).replace(/\).*/,``).match(/\d*\.?\d+%?/g)||[],r=n.map(e=>parseFloat(e));for(let e=0;e<3;e+=1)r[e]=t(r[e]||0,n[e]||``,e);return n[3]?r[3]=n[3].includes(`%`)?r[3]/100:r[3]:r[3]=1,r}var Ui=(e,t,n)=>n===0?e:e/100;function Wi(e,t){let n=t||255;return e>n?n:e<0?0:e}var Gi=class e{isValid=!0;r=0;g=0;b=0;a=1;_h;_s;_l;_v;_max;_min;_brightness;constructor(t){function n(e){return e[0]in t&&e[1]in t&&e[2]in t}if(t)if(typeof t==`string`){let e=t.trim();function n(t){return e.startsWith(t)}if(/^#?[A-F\d]{3,8}$/i.test(e))this.fromHexString(e);else if(n(`rgb`))this.fromRgbString(e);else if(n(`hsl`))this.fromHslString(e);else if(n(`hsv`)||n(`hsb`))this.fromHsvString(e);else{let t=Bi[e.toLowerCase()];t&&this.fromHexString(parseInt(t,36).toString(16).padStart(6,`0`))}}else if(t instanceof e)this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this._h=t._h,this._s=t._s,this._l=t._l,this._v=t._v;else if(n(`rgb`))this.r=Wi(t.r),this.g=Wi(t.g),this.b=Wi(t.b),this.a=typeof t.a==`number`?Wi(t.a,1):1;else if(n(`hsl`))this.fromHsl(t);else if(n(`hsv`))this.fromHsv(t);else throw Error(`@ant-design/fast-color: unsupported input `+JSON.stringify(t))}setR(e){return this._sc(`r`,e)}setG(e){return this._sc(`g`,e)}setB(e){return this._sc(`b`,e)}setA(e){return this._sc(`a`,e,1)}setHue(e){let t=this.toHsv();return t.h=e,this._c(t)}getLuminance(){function e(e){let t=e/255;return t<=.03928?t/12.92:((t+.055)/1.055)**2.4}let t=e(this.r),n=e(this.g),r=e(this.b);return .2126*t+.7152*n+.0722*r}getHue(){if(this._h===void 0){let e=this.getMax()-this.getMin();e===0?this._h=0:this._h=Vi(60*(this.r===this.getMax()?(this.g-this.b)/e+(this.g<this.b?6:0):this.g===this.getMax()?(this.b-this.r)/e+2:(this.r-this.g)/e+4))}return this._h}getSaturation(){if(this._s===void 0){let e=this.getMax()-this.getMin();e===0?this._s=0:this._s=e/this.getMax()}return this._s}getLightness(){return this._l===void 0&&(this._l=(this.getMax()+this.getMin())/510),this._l}getValue(){return this._v===void 0&&(this._v=this.getMax()/255),this._v}getBrightness(){return this._brightness===void 0&&(this._brightness=(this.r*299+this.g*587+this.b*114)/1e3),this._brightness}darken(e=10){let t=this.getHue(),n=this.getSaturation(),r=this.getLightness()-e/100;return r<0&&(r=0),this._c({h:t,s:n,l:r,a:this.a})}lighten(e=10){let t=this.getHue(),n=this.getSaturation(),r=this.getLightness()+e/100;return r>1&&(r=1),this._c({h:t,s:n,l:r,a:this.a})}mix(e,t=50){let n=this._c(e),r=t/100,i=e=>(n[e]-this[e])*r+this[e],a={r:Vi(i(`r`)),g:Vi(i(`g`)),b:Vi(i(`b`)),a:Vi(i(`a`)*100)/100};return this._c(a)}tint(e=10){return this.mix({r:255,g:255,b:255,a:1},e)}shade(e=10){return this.mix({r:0,g:0,b:0,a:1},e)}onBackground(e){let t=this._c(e),n=this.a+t.a*(1-this.a),r=e=>Vi((this[e]*this.a+t[e]*t.a*(1-this.a))/n);return this._c({r:r(`r`),g:r(`g`),b:r(`b`),a:n})}isDark(){return this.getBrightness()<128}isLight(){return this.getBrightness()>=128}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}clone(){return this._c(this)}toHexString(){let e=`#`,t=(this.r||0).toString(16);e+=t.length===2?t:`0`+t;let n=(this.g||0).toString(16);e+=n.length===2?n:`0`+n;let r=(this.b||0).toString(16);if(e+=r.length===2?r:`0`+r,typeof this.a==`number`&&this.a>=0&&this.a<1){let t=Vi(this.a*255).toString(16);e+=t.length===2?t:`0`+t}return e}toHsl(){return{h:this.getHue(),s:this.getSaturation(),l:this.getLightness(),a:this.a}}toHslString(){let e=this.getHue(),t=Vi(this.getSaturation()*100),n=Vi(this.getLightness()*100);return this.a===1?`hsl(${e},${t}%,${n}%)`:`hsla(${e},${t}%,${n}%,${this.a})`}toHsv(){return{h:this.getHue(),s:this.getSaturation(),v:this.getValue(),a:this.a}}toRgb(){return{r:this.r,g:this.g,b:this.b,a:this.a}}toRgbString(){return this.a===1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toString(){return this.toRgbString()}_sc(e,t,n){let r=this.clone();return r[e]=Wi(t,n),r}_c(e){return new this.constructor(e)}getMax(){return this._max===void 0&&(this._max=Math.max(this.r,this.g,this.b)),this._max}getMin(){return this._min===void 0&&(this._min=Math.min(this.r,this.g,this.b)),this._min}fromHexString(e){let t=e.replace(`#`,``);function n(e,n){return parseInt(t[e]+t[n||e],16)}t.length<6?(this.r=n(0),this.g=n(1),this.b=n(2),this.a=t[3]?n(3)/255:1):(this.r=n(0,1),this.g=n(2,3),this.b=n(4,5),this.a=t[6]?n(6,7)/255:1)}fromHsl({h:e,s:t,l:n,a:r}){if(this._h=e%360,this._s=t,this._l=n,this.a=typeof r==`number`?r:1,t<=0){let e=Vi(n*255);this.r=e,this.g=e,this.b=e}let i=0,a=0,o=0,s=e/60,c=(1-Math.abs(2*n-1))*t,l=c*(1-Math.abs(s%2-1));s>=0&&s<1?(i=c,a=l):s>=1&&s<2?(i=l,a=c):s>=2&&s<3?(a=c,o=l):s>=3&&s<4?(a=l,o=c):s>=4&&s<5?(i=l,o=c):s>=5&&s<6&&(i=c,o=l);let u=n-c/2;this.r=Vi((i+u)*255),this.g=Vi((a+u)*255),this.b=Vi((o+u)*255)}fromHsv({h:e,s:t,v:n,a:r}){this._h=e%360,this._s=t,this._v=n,this.a=typeof r==`number`?r:1;let i=Vi(n*255);if(this.r=i,this.g=i,this.b=i,t<=0)return;let a=e/60,o=Math.floor(a),s=a-o,c=Vi(n*(1-t)*255),l=Vi(n*(1-t*s)*255),u=Vi(n*(1-t*(1-s))*255);switch(o){case 0:this.g=u,this.b=c;break;case 1:this.r=l,this.b=c;break;case 2:this.r=c,this.b=u;break;case 3:this.r=c,this.g=l;break;case 4:this.r=u,this.g=c;break;case 5:default:this.g=c,this.b=l;break}}fromHsvString(e){let t=Hi(e,Ui);this.fromHsv({h:t[0],s:t[1],v:t[2],a:t[3]})}fromHslString(e){let t=Hi(e,Ui);this.fromHsl({h:t[0],s:t[1],l:t[2],a:t[3]})}fromRgbString(e){let t=Hi(e,(e,t)=>t.includes(`%`)?Vi(e/100*255):e);this.r=t[0],this.g=t[1],this.b=t[2],this.a=t[3]}},Ki=2,qi=.16,Ji=.05,Yi=.05,Xi=.15,Zi=5,Qi=4,$i=[{index:7,amount:15},{index:6,amount:25},{index:5,amount:30},{index:5,amount:45},{index:5,amount:65},{index:5,amount:85},{index:4,amount:90},{index:3,amount:95},{index:2,amount:97},{index:1,amount:98}];function ea(e,t,n){let r;return r=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-Ki*t:Math.round(e.h)+Ki*t:n?Math.round(e.h)+Ki*t:Math.round(e.h)-Ki*t,r<0?r+=360:r>=360&&(r-=360),r}function ta(e,t,n){if(e.h===0&&e.s===0)return e.s;let r;return r=n?e.s-qi*t:t===Qi?e.s+qi:e.s+Ji*t,r>1&&(r=1),n&&t===Zi&&r>.1&&(r=.1),r<.06&&(r=.06),Math.round(r*100)/100}function na(e,t,n){let r;return r=n?e.v+Yi*t:e.v-Xi*t,r=Math.max(0,Math.min(1,r)),Math.round(r*100)/100}function ra(e,t={}){let n=[],r=new Gi(e),i=r.toHsv();for(let e=Zi;e>0;--e){let t=new Gi({h:ea(i,e,!0),s:ta(i,e,!0),v:na(i,e,!0)});n.push(t)}n.push(r);for(let e=1;e<=Qi;e+=1){let t=new Gi({h:ea(i,e),s:ta(i,e),v:na(i,e)});n.push(t)}return t.theme===`dark`?$i.map(({index:e,amount:r})=>new Gi(t.backgroundColor||`#141414`).mix(n[e],r).toHexString()):n.map(e=>e.toHexString())}const ia={red:`#F5222D`,volcano:`#FA541C`,orange:`#FA8C16`,gold:`#FAAD14`,yellow:`#FADB14`,lime:`#A0D911`,green:`#52C41A`,cyan:`#13C2C2`,blue:`#1677FF`,geekblue:`#2F54EB`,purple:`#722ED1`,magenta:`#EB2F96`,grey:`#666666`},aa=[`#fff1f0`,`#ffccc7`,`#ffa39e`,`#ff7875`,`#ff4d4f`,`#f5222d`,`#cf1322`,`#a8071a`,`#820014`,`#5c0011`];aa.primary=aa[5];const oa=[`#fff2e8`,`#ffd8bf`,`#ffbb96`,`#ff9c6e`,`#ff7a45`,`#fa541c`,`#d4380d`,`#ad2102`,`#871400`,`#610b00`];oa.primary=oa[5];const sa=[`#fff7e6`,`#ffe7ba`,`#ffd591`,`#ffc069`,`#ffa940`,`#fa8c16`,`#d46b08`,`#ad4e00`,`#873800`,`#612500`];sa.primary=sa[5];const ca=[`#fffbe6`,`#fff1b8`,`#ffe58f`,`#ffd666`,`#ffc53d`,`#faad14`,`#d48806`,`#ad6800`,`#874d00`,`#613400`];ca.primary=ca[5];const la=[`#feffe6`,`#ffffb8`,`#fffb8f`,`#fff566`,`#ffec3d`,`#fadb14`,`#d4b106`,`#ad8b00`,`#876800`,`#614700`];la.primary=la[5];const ua=[`#fcffe6`,`#f4ffb8`,`#eaff8f`,`#d3f261`,`#bae637`,`#a0d911`,`#7cb305`,`#5b8c00`,`#3f6600`,`#254000`];ua.primary=ua[5];const da=[`#f6ffed`,`#d9f7be`,`#b7eb8f`,`#95de64`,`#73d13d`,`#52c41a`,`#389e0d`,`#237804`,`#135200`,`#092b00`];da.primary=da[5];const fa=[`#e6fffb`,`#b5f5ec`,`#87e8de`,`#5cdbd3`,`#36cfc9`,`#13c2c2`,`#08979c`,`#006d75`,`#00474f`,`#002329`];fa.primary=fa[5];const pa=[`#e6f4ff`,`#bae0ff`,`#91caff`,`#69b1ff`,`#4096ff`,`#1677ff`,`#0958d9`,`#003eb3`,`#002c8c`,`#001d66`];pa.primary=pa[5];const ma=[`#f0f5ff`,`#d6e4ff`,`#adc6ff`,`#85a5ff`,`#597ef7`,`#2f54eb`,`#1d39c4`,`#10239e`,`#061178`,`#030852`];ma.primary=ma[5];const ha=[`#f9f0ff`,`#efdbff`,`#d3adf7`,`#b37feb`,`#9254de`,`#722ed1`,`#531dab`,`#391085`,`#22075e`,`#120338`];ha.primary=ha[5];const ga=[`#fff0f6`,`#ffd6e7`,`#ffadd2`,`#ff85c0`,`#f759ab`,`#eb2f96`,`#c41d7f`,`#9e1068`,`#780650`,`#520339`];ga.primary=ga[5];const _a=[`#a6a6a6`,`#999999`,`#8c8c8c`,`#808080`,`#737373`,`#666666`,`#404040`,`#1a1a1a`,`#000000`,`#000000`];_a.primary=_a[5];const va={red:aa,volcano:oa,orange:sa,gold:ca,yellow:la,lime:ua,green:da,cyan:fa,blue:pa,geekblue:ma,purple:ha,magenta:ga,grey:_a},ya=[`#2a1215`,`#431418`,`#58181c`,`#791a1f`,`#a61d24`,`#d32029`,`#e84749`,`#f37370`,`#f89f9a`,`#fac8c3`];ya.primary=ya[5];const ba=[`#2b1611`,`#441d12`,`#592716`,`#7c3118`,`#aa3e19`,`#d84a1b`,`#e87040`,`#f3956a`,`#f8b692`,`#fad4bc`];ba.primary=ba[5];const xa=[`#2b1d11`,`#442a11`,`#593815`,`#7c4a15`,`#aa6215`,`#d87a16`,`#e89a3c`,`#f3b765`,`#f8cf8d`,`#fae3b7`];xa.primary=xa[5];const Sa=[`#2b2111`,`#443111`,`#594214`,`#7c5914`,`#aa7714`,`#d89614`,`#e8b339`,`#f3cc62`,`#f8df8b`,`#faedb5`];Sa.primary=Sa[5];const Ca=[`#2b2611`,`#443b11`,`#595014`,`#7c6e14`,`#aa9514`,`#d8bd14`,`#e8d639`,`#f3ea62`,`#f8f48b`,`#fafab5`];Ca.primary=Ca[5];const wa=[`#1f2611`,`#2e3c10`,`#3e4f13`,`#536d13`,`#6f9412`,`#8bbb11`,`#a9d134`,`#c9e75d`,`#e4f88b`,`#f0fab5`];wa.primary=wa[5];const Ta=[`#162312`,`#1d3712`,`#274916`,`#306317`,`#3c8618`,`#49aa19`,`#6abe39`,`#8fd460`,`#b2e58b`,`#d5f2bb`];Ta.primary=Ta[5];const Ea=[`#112123`,`#113536`,`#144848`,`#146262`,`#138585`,`#13a8a8`,`#33bcb7`,`#58d1c9`,`#84e2d8`,`#b2f1e8`];Ea.primary=Ea[5];const Da=[`#111a2c`,`#112545`,`#15325b`,`#15417e`,`#1554ad`,`#1668dc`,`#3c89e8`,`#65a9f3`,`#8dc5f8`,`#b7dcfa`];Da.primary=Da[5];const Oa=[`#131629`,`#161d40`,`#1c2755`,`#203175`,`#263ea0`,`#2b4acb`,`#5273e0`,`#7f9ef3`,`#a8c1f8`,`#d2e0fa`];Oa.primary=Oa[5];const ka=[`#1a1325`,`#24163a`,`#301c4d`,`#3e2069`,`#51258f`,`#642ab5`,`#854eca`,`#ab7ae0`,`#cda8f0`,`#ebd7fa`];ka.primary=ka[5];const Aa=[`#291321`,`#40162f`,`#551c3b`,`#75204f`,`#a02669`,`#cb2b83`,`#e0529c`,`#f37fb7`,`#f8a8cc`,`#fad2e3`];Aa.primary=Aa[5];const ja=[`#151515`,`#1f1f1f`,`#2d2d2d`,`#393939`,`#494949`,`#5a5a5a`,`#6a6a6a`,`#7b7b7b`,`#888888`,`#969696`];ja.primary=ja[5];function Ma(e,{generateColorPalettes:t,generateNeutralColorPalettes:n}){let{colorSuccess:r,colorWarning:i,colorError:a,colorInfo:o,colorPrimary:s,colorBgBase:c,colorTextBase:l}=e,u=t(s),d=t(r),f=t(i),p=t(a),m=t(o),h=n(c,l),g=t(e.colorLink||e.colorInfo),_=new Gi(p[1]).mix(new Gi(p[3]),50).toHexString();return{...h,colorPrimaryBg:u[1],colorPrimaryBgHover:u[2],colorPrimaryBorder:u[3],colorPrimaryBorderHover:u[4],colorPrimaryHover:u[5],colorPrimary:u[6],colorPrimaryActive:u[7],colorPrimaryTextHover:u[8],colorPrimaryText:u[9],colorPrimaryTextActive:u[10],colorSuccessBg:d[1],colorSuccessBgHover:d[2],colorSuccessBorder:d[3],colorSuccessBorderHover:d[4],colorSuccessHover:d[4],colorSuccess:d[6],colorSuccessActive:d[7],colorSuccessTextHover:d[8],colorSuccessText:d[9],colorSuccessTextActive:d[10],colorErrorBg:p[1],colorErrorBgHover:p[2],colorErrorBgFilledHover:_,colorErrorBgActive:p[3],colorErrorBorder:p[3],colorErrorBorderHover:p[4],colorErrorHover:p[5],colorError:p[6],colorErrorActive:p[7],colorErrorTextHover:p[8],colorErrorText:p[9],colorErrorTextActive:p[10],colorWarningBg:f[1],colorWarningBgHover:f[2],colorWarningBorder:f[3],colorWarningBorderHover:f[4],colorWarningHover:f[4],colorWarning:f[6],colorWarningActive:f[7],colorWarningTextHover:f[8],colorWarningText:f[9],colorWarningTextActive:f[10],colorInfoBg:m[1],colorInfoBgHover:m[2],colorInfoBorder:m[3],colorInfoBorderHover:m[4],colorInfoHover:m[4],colorInfo:m[6],colorInfoActive:m[7],colorInfoTextHover:m[8],colorInfoText:m[9],colorInfoTextActive:m[10],colorLinkHover:g[4],colorLink:g[6],colorLinkActive:g[7],colorBgMask:new Gi(`#000`).setA(.45).toRgbString(),colorWhite:`#fff`}}var Na=e=>{let t=e,n=e,r=e,i=e;return e<6&&e>=5?t=e+1:e<16&&e>=6?t=e+2:e>=16&&(t=16),e<7&&e>=5?n=4:e<8&&e>=7?n=5:e<14&&e>=8?n=6:e<16&&e>=14?n=7:e>=16&&(n=8),e<6&&e>=2?r=1:e>=6&&(r=2),e>4&&e<8?i=4:e>=8&&(i=6),{borderRadius:e,borderRadiusXS:r,borderRadiusSM:n,borderRadiusLG:t,borderRadiusOuter:i}};function Pa(e){let{motionUnit:t,motionBase:n,borderRadius:r,lineWidth:i}=e;return{motionDurationFast:`${(n+t).toFixed(1)}s`,motionDurationMid:`${(n+t*2).toFixed(1)}s`,motionDurationSlow:`${(n+t*3).toFixed(1)}s`,lineWidthBold:i+1,...Na(r)}}var Fa=e=>{let{controlHeight:t}=e;return{controlHeightSM:t*.75,controlHeightXS:t*.5,controlHeightLG:t*1.25}},Ia=e=>{let t=Ii(e),n=t.map(e=>e.size),r=t.map(e=>e.lineHeight),i=n[1],a=n[0],o=n[2],s=r[1],c=r[0],l=r[2];return{fontSizeSM:a,fontSize:i,fontSizeLG:o,fontSizeXL:n[3],fontSizeHeading1:n[6],fontSizeHeading2:n[5],fontSizeHeading3:n[4],fontSizeHeading4:n[3],fontSizeHeading5:n[2],lineHeight:s,lineHeightLG:l,lineHeightSM:c,fontHeight:Math.round(s*i),fontHeightLG:Math.round(l*o),fontHeightSM:Math.round(c*a),lineHeightHeading1:r[6],lineHeightHeading2:r[5],lineHeightHeading3:r[4],lineHeightHeading4:r[3],lineHeightHeading5:r[2]}};function La(e){let{sizeUnit:t,sizeStep:n}=e;return{sizeXXL:t*(n+8),sizeXL:t*(n+4),sizeLG:t*(n+2),sizeMD:t*(n+1),sizeMS:t*n,size:t*n,sizeSM:t*(n-1),sizeXS:t*(n-2),sizeXXS:t*(n-3)}}const Ra=(e,t)=>new Gi(e).setA(t).toRgbString(),za=(e,t)=>new Gi(e).darken(t).toHexString(),Ba=e=>{let t=ra(e);return{1:t[0],2:t[1],3:t[2],4:t[3],5:t[4],6:t[5],7:t[6],8:t[4],9:t[5],10:t[6]}},Va=(e,t)=>{let n=e||`#fff`,r=t||`#000`;return{colorBgBase:n,colorTextBase:r,colorText:Ra(r,.88),colorTextSecondary:Ra(r,.65),colorTextTertiary:Ra(r,.45),colorTextQuaternary:Ra(r,.25),colorFill:Ra(r,.15),colorFillSecondary:Ra(r,.06),colorFillTertiary:Ra(r,.04),colorFillQuaternary:Ra(r,.02),colorBgSolid:Ra(r,1),colorBgSolidHover:Ra(r,.75),colorBgSolidActive:Ra(r,.95),colorBgLayout:za(n,4),colorBgContainer:za(n,0),colorBgElevated:za(n,0),colorBgSpotlight:Ra(r,.85),colorBgBlur:`transparent`,colorBorder:za(n,15),colorBorderDisabled:za(n,15),colorBorderSecondary:za(n,6)}};function Ha(e){ia.pink=ia.magenta,va.pink=va.magenta;let t=Object.keys(Ri).map(t=>{let n=e[t]===ia[t]?va[t]:ra(e[t]);return Array.from({length:10},()=>1).reduce((e,r,i)=>(e[`${t}-${i+1}`]=n[i],e[`${t}${i+1}`]=n[i],e),{})}).reduce((e,t)=>(e={...e,...t},e),{});return{...e,...t,...Ma(e,{generateColorPalettes:Ba,generateNeutralColorPalettes:Va}),...Ia(e.fontSize),...La(e),...Fa(e),...Pa(e)}}var Ua=qt(Ha);const Wa={token:zi,override:{override:zi},hashed:!0},Ga=y.createContext(Wa);function Ka(e){return e>=0&&e<=255}function qa(e,t){let{r:n,g:r,b:i,a}=new Gi(e).toRgb();if(a<1)return e;let{r:o,g:s,b:c}=new Gi(t).toRgb();for(let e=.01;e<=1;e+=.01){let t=Math.round((n-o*(1-e))/e),a=Math.round((r-s*(1-e))/e),l=Math.round((i-c*(1-e))/e);if(Ka(t)&&Ka(a)&&Ka(l))return new Gi({r:t,g:a,b:l,a:Math.round(e*100)/100}).toRgbString()}return new Gi({r:n,g:r,b:i,a:1}).toRgbString()}var Ja=qa;function Ya(e){let{override:t,...n}=e,r={...t};Object.keys(zi).forEach(e=>{delete r[e]});let i={...n,...r},a=1200,o=1600;return i.motion===!1&&(i.motionDurationFast=`0s`,i.motionDurationMid=`0s`,i.motionDurationSlow=`0s`),{...i,colorFillContent:i.colorFillSecondary,colorFillContentHover:i.colorFill,colorFillAlter:i.colorFillQuaternary,colorBgContainerDisabled:i.colorFillTertiary,colorBorderBg:i.colorBgContainer,colorSplit:Ja(i.colorBorderSecondary,i.colorBgContainer),colorTextPlaceholder:i.colorTextQuaternary,colorTextDisabled:i.colorTextQuaternary,colorTextHeading:i.colorText,colorTextLabel:i.colorTextSecondary,colorTextDescription:i.colorTextTertiary,colorTextLightSolid:i.colorWhite,colorHighlight:i.colorError,colorBgTextHover:i.colorFillSecondary,colorBgTextActive:i.colorFill,colorIcon:i.colorTextTertiary,colorIconHover:i.colorText,colorErrorOutline:Ja(i.colorErrorBg,i.colorBgContainer),colorWarningOutline:Ja(i.colorWarningBg,i.colorBgContainer),fontSizeIcon:i.fontSizeSM,lineWidthFocus:i.lineWidth*3,lineWidth:i.lineWidth,controlOutlineWidth:i.lineWidth*2,controlInteractiveSize:i.controlHeight/2,controlItemBgHover:i.colorFillTertiary,controlItemBgActive:i.colorPrimaryBg,controlItemBgActiveHover:i.colorPrimaryBgHover,controlItemBgActiveDisabled:i.colorFill,controlTmpOutline:i.colorFillQuaternary,controlOutline:Ja(i.colorPrimaryBg,i.colorBgContainer),lineType:i.lineType,borderRadius:i.borderRadius,borderRadiusXS:i.borderRadiusXS,borderRadiusSM:i.borderRadiusSM,borderRadiusLG:i.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:`none`,linkHoverDecoration:`none`,linkFocusDecoration:`none`,controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:i.sizeXXS,paddingXS:i.sizeXS,paddingSM:i.sizeSM,padding:i.size,paddingMD:i.sizeMD,paddingLG:i.sizeLG,paddingXL:i.sizeXL,paddingContentHorizontalLG:i.sizeLG,paddingContentVerticalLG:i.sizeMS,paddingContentHorizontal:i.sizeMS,paddingContentVertical:i.sizeSM,paddingContentHorizontalSM:i.size,paddingContentVerticalSM:i.sizeXS,marginXXS:i.sizeXXS,marginXS:i.sizeXS,marginSM:i.sizeSM,margin:i.size,marginMD:i.sizeMD,marginLG:i.sizeLG,marginXL:i.sizeXL,marginXXL:i.sizeXXL,boxShadow:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowSecondary:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTertiary:`
      0 1px 2px 0 rgba(0, 0, 0, 0.03),
      0 1px 6px -1px rgba(0, 0, 0, 0.02),
      0 2px 4px 0 rgba(0, 0, 0, 0.02)
    `,screenXS:480,screenXSMin:480,screenXSMax:575,screenSM:576,screenSMMin:576,screenSMMax:767,screenMD:768,screenMDMin:768,screenMDMax:991,screenLG:992,screenLGMin:992,screenLGMax:a-1,screenXL:a,screenXLMin:a,screenXLMax:o-1,screenXXL:o,screenXXLMin:o,boxShadowPopoverArrow:`2px 2px 5px rgba(0, 0, 0, 0.05)`,boxShadowCard:`
      0 1px 2px -2px ${new Gi(`rgba(0, 0, 0, 0.16)`).toRgbString()},
      0 3px 6px 0 ${new Gi(`rgba(0, 0, 0, 0.12)`).toRgbString()},
      0 5px 12px 4px ${new Gi(`rgba(0, 0, 0, 0.09)`).toRgbString()}
    `,boxShadowDrawerRight:`
      -6px 0 16px 0 rgba(0, 0, 0, 0.08),
      -3px 0 6px -4px rgba(0, 0, 0, 0.12),
      -9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerLeft:`
      6px 0 16px 0 rgba(0, 0, 0, 0.08),
      3px 0 6px -4px rgba(0, 0, 0, 0.12),
      9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerUp:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerDown:`
      0 -6px 16px 0 rgba(0, 0, 0, 0.08),
      0 -3px 6px -4px rgba(0, 0, 0, 0.12),
      0 -9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTabsOverflowLeft:`inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)`,boxShadowTabsOverflowRight:`inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)`,boxShadowTabsOverflowTop:`inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)`,boxShadowTabsOverflowBottom:`inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)`,...r}}const Xa={lineHeight:!0,lineHeightSM:!0,lineHeightLG:!0,lineHeightHeading1:!0,lineHeightHeading2:!0,lineHeightHeading3:!0,lineHeightHeading4:!0,lineHeightHeading5:!0,opacityLoading:!0,fontWeightStrong:!0,zIndexPopupBase:!0,zIndexBase:!0,opacityImage:!0},Za={motionBase:!0,motionUnit:!0};var Qa={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0};const $a=(e,t,n)=>{let r=n.getDerivativeToken(e),{override:i,...a}=t,o={...r,override:i};return o=Ya(o),a&&Object.entries(a).forEach(([e,t])=>{let{theme:n,...r}=t,i=r;n&&(i=$a({...o,...r},{override:r},n)),o[e]=i}),o};function eo(){let{token:e,hashed:t,theme:n,override:r,cssVar:i,zeroRuntime:a}=y.useContext(Ga),o={prefix:i?.prefix||`ant`,key:i?.key||`css-var-root`},s=`${Li}-${t||``}`,c=n||Ua,[l,u,d]=yn(c,[zi,e],{salt:s,override:r,getComputedToken:$a,cssVar:{...o,unitless:Xa,ignore:Za,preserve:Qa}});return[c,d,t?u:``,l,o,!!a]}const to={overflow:`hidden`,whiteSpace:`nowrap`,textOverflow:`ellipsis`},no=(e,t=!1)=>({boxSizing:`border-box`,margin:0,padding:0,color:e.colorText,fontSize:e.fontSize,lineHeight:e.lineHeight,listStyle:`none`,fontFamily:t?`inherit`:e.fontFamily}),ro=()=>({display:`inline-flex`,alignItems:`center`,color:`inherit`,fontStyle:`normal`,lineHeight:0,textAlign:`center`,textTransform:`none`,verticalAlign:`-0.125em`,textRendering:`optimizeLegibility`,"-webkit-font-smoothing":`antialiased`,"-moz-osx-font-smoothing":`grayscale`,"> *":{lineHeight:1},svg:{display:`inline-block`}}),io=()=>({"&::before":{display:`table`,content:`""`},"&::after":{display:`table`,clear:`both`,content:`""`}}),ao=e=>({a:{color:e.colorLink,textDecoration:e.linkDecoration,backgroundColor:`transparent`,outline:`none`,cursor:`pointer`,transition:`color ${e.motionDurationSlow}`,"-webkit-text-decoration-skip":`objects`,"&:hover":{color:e.colorLinkHover},"&:active":{color:e.colorLinkActive},"&:active, &:hover":{textDecoration:e.linkHoverDecoration,outline:0},"&:focus":{textDecoration:e.linkFocusDecoration,outline:0},"&[disabled]":{color:e.colorTextDisabled,cursor:`not-allowed`}}}),oo=(e,t,n,r)=>{let i=`[class^="${t}"], [class*=" ${t}"]`,a=n?`.${n}`:i,o={boxSizing:`border-box`,"&::before, &::after":{boxSizing:`border-box`}},s={};return r!==!1&&(s={fontFamily:e.fontFamily,fontSize:e.fontSize}),{[a]:{...s,...o,[i]:o}}},so=(e,t)=>({outline:`${tn(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`,outlineOffset:t??1,transition:`outline-offset 0s, outline 0s`}),co=(e,t)=>({"&:focus-visible":so(e,t)}),lo=e=>({[`.${e}`]:{...ro(),[`.${e} .${e}-icon`]:{display:`block`}}}),uo=e=>({color:e.colorLink,textDecoration:e.linkDecoration,outline:`none`,cursor:`pointer`,transition:`all ${e.motionDurationSlow}`,border:0,padding:0,background:`none`,userSelect:`none`,...co(e),"&:hover":{color:e.colorLinkHover,textDecoration:e.linkHoverDecoration},"&:focus":{color:e.colorLinkHover,textDecoration:e.linkFocusDecoration},"&:active":{color:e.colorLinkActive,textDecoration:e.linkHoverDecoration}}),{genStyleHooks:fo,genComponentStyleHook:po,genSubStyleComponent:mo}=Ni({usePrefix:()=>{let{getPrefixCls:e,iconPrefixCls:t}=(0,y.useContext)(dt);return{rootPrefixCls:e(),iconPrefixCls:t}},useToken:()=>{let[e,t,n,r,i,a]=eo();return{theme:e,realToken:t,hashId:n,token:r,cssVar:i,zeroRuntime:a}},useCSP:()=>{let{csp:e}=(0,y.useContext)(dt);return e??{}},getResetStyles:(e,t)=>{let n=ao(e);return[n,{"&":n},lo(t?.prefix.iconPrefixCls??`anticon`)]},getCommonStyle:oo,getCompUnitless:()=>Xa}),ho=(e,t)=>{let n=`--${e.replace(`.`,``)}-${t}-`;return(e,t=!1)=>{let r=`${n}${e}`;return t?`var(${r})`:r}};function go(e,t){return Pi.reduce((n,r)=>{let i=e[`${r}1`],a=e[`${r}3`],o=e[`${r}6`],s=e[`${r}7`];return{...n,...t(r,{lightColor:i,lightBorderColor:a,darkColor:o,textColor:s})}},{})}var _o=(e,t)=>{let[n,r]=eo();return Rr({theme:n,token:r,hashId:``,path:[`ant-design-icons`,e],nonce:()=>t?.nonce,layer:{name:`antd`}},()=>lo(e))},vo={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z`}}]},name:`check-circle`,theme:`filled`},yo=(0,y.createContext)({});function bo(e){return e?.getRootNode?.()}function xo(e){return bo(e)instanceof ShadowRoot}function So(e){return xo(e)?bo(e):null}function Co(e){return e.replace(/-(.)/g,(e,t)=>t.toUpperCase())}function wo(e,t){we(e,`[@ant-design/icons] ${t}`)}function To(e){return typeof e==`object`&&typeof e.name==`string`&&typeof e.theme==`string`&&(typeof e.icon==`object`||typeof e.icon==`function`)}function Eo(e={}){return Object.keys(e).reduce((t,n)=>{let r=e[n];switch(n){case`class`:t.className=r,delete t.class;break;default:delete t[n],t[Co(n)]=r}return t},{})}function Do(e,t,n){return n?y.createElement(e.tag,{key:t,...Eo(e.attrs),...n},(e.children||[]).map((n,r)=>Do(n,`${t}-${e.tag}-${r}`))):y.createElement(e.tag,{key:t,...Eo(e.attrs)},(e.children||[]).map((n,r)=>Do(n,`${t}-${e.tag}-${r}`)))}function Oo(e){return ra(e)[0]}function ko(e){return e?Array.isArray(e)?e:[e]:[]}const Ao=e=>{let{csp:t,prefixCls:n,layer:r}=(0,y.useContext)(yo),i=`
.anticon {
  display: inline-flex;
  align-items: center;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
  vertical-align: inherit;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`;n&&(i=i.replace(/anticon/g,n)),r&&(i=`@layer ${r} {\n${i}\n}`),(0,y.useEffect)(()=>{let n=e.current,a=So(n);At(i,`@ant-design-icons`,{prepend:!r,csp:t,attachTo:a})},[])};var jo={primaryColor:`#333`,secondaryColor:`#E6E6E6`,calculated:!1};function Mo({primaryColor:e,secondaryColor:t}){jo.primaryColor=e,jo.secondaryColor=t||Oo(e),jo.calculated=!!t}function No(){return{...jo}}var Po=e=>{let{icon:t,className:n,onClick:r,style:i,primaryColor:a,secondaryColor:o,...s}=e,c=y.useRef(null),l=jo;if(a&&(l={primaryColor:a,secondaryColor:o||Oo(a)}),Ao(c),wo(To(t),`icon should be icon definiton, but got ${t}`),!To(t))return null;let u=t;return u&&typeof u.icon==`function`&&(u={...u,icon:u.icon(l.primaryColor,l.secondaryColor)}),Do(u.icon,`svg-${u.name}`,{className:n,onClick:r,style:i,"data-icon":u.name,width:`1em`,height:`1em`,fill:`currentColor`,"aria-hidden":`true`,...s,ref:c})};Po.displayName=`IconReact`,Po.getTwoToneColors=No,Po.setTwoToneColors=Mo;var Fo=Po;function Io(e){let[t,n]=ko(e);return Fo.setTwoToneColors({primaryColor:t,secondaryColor:n})}function Lo(){let e=Fo.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor}function Ro(){return Ro=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ro.apply(this,arguments)}Io(pa.primary);var zo=y.forwardRef((e,t)=>{let{className:n,icon:r,spin:i,rotate:a,tabIndex:o,onClick:s,twoToneColor:c,...l}=e,{prefixCls:u=`anticon`,rootClassName:d}=y.useContext(yo),f=F(d,u,{[`${u}-${r.name}`]:!!r.name,[`${u}-spin`]:!!i||r.name===`loading`},n),p=o;p===void 0&&s&&(p=-1);let m=a?{msTransform:`rotate(${a}deg)`,transform:`rotate(${a}deg)`}:void 0,[h,g]=ko(c);return y.createElement(`span`,Ro({role:`img`,"aria-label":r.name},l,{ref:t,tabIndex:p,onClick:s,className:f}),y.createElement(Fo,{icon:r,primaryColor:h,secondaryColor:g,style:m}))});zo.getTwoToneColor=Lo,zo.setTwoToneColor=Io;var Bo=zo;function Vo(){return Vo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vo.apply(this,arguments)}var Ho=y.forwardRef((e,t)=>y.createElement(Bo,Vo({},e,{ref:t,icon:vo}))),Uo={icon:{tag:`svg`,attrs:{"fill-rule":`evenodd`,viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z`}}]},name:`close-circle`,theme:`filled`};function Wo(){return Wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Wo.apply(this,arguments)}var Go=y.forwardRef((e,t)=>y.createElement(Bo,Wo({},e,{ref:t,icon:Uo}))),Ko={icon:{tag:`svg`,attrs:{"fill-rule":`evenodd`,viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z`}}]},name:`close`,theme:`outlined`};function qo(){return qo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},qo.apply(this,arguments)}var Jo=y.forwardRef((e,t)=>y.createElement(Bo,qo({},e,{ref:t,icon:Ko}))),Yo={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z`}}]},name:`exclamation-circle`,theme:`filled`};function Xo(){return Xo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xo.apply(this,arguments)}var Zo=y.forwardRef((e,t)=>y.createElement(Bo,Xo({},e,{ref:t,icon:Yo}))),Qo={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z`}}]},name:`info-circle`,theme:`filled`};function $o(){return $o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$o.apply(this,arguments)}var es=y.forwardRef((e,t)=>y.createElement(Bo,$o({},e,{ref:t,icon:Qo})));const ts=y.createContext({});function ns({children:e,...t}){return y.createElement(ts.Provider,{value:t},e)}function rs(e){let[,t]=y.useReducer(e=>e+1,0),n=y.useRef(e);return[x(()=>n.current),x(e=>{n.current=typeof e==`function`?e(n.current):e,t()})]}const is=`none`,as=`appear`,os=`enter`,ss=`leave`,cs=`prepare`,ls=`start`,us=`active`;function ds(e,t){let n={};return n[e.toLowerCase()]=t.toLowerCase(),n[`Webkit${e}`]=`webkit${t}`,n[`Moz${e}`]=`moz${t}`,n[`ms${e}`]=`MS${t}`,n[`O${e}`]=`o${t.toLowerCase()}`,n}function fs(e,t){let n={animationend:ds(`Animation`,`AnimationEnd`),transitionend:ds(`Transition`,`TransitionEnd`)};return e&&(`AnimationEvent`in t||delete n.animationend.animation,`TransitionEvent`in t||delete n.transitionend.transition),n}var ps=fs(S(),typeof window<`u`?window:{}),ms={};S()&&({style:ms}=document.createElement(`div`));var hs={};function gs(e){if(hs[e])return hs[e];let t=ps[e];if(t){let n=Object.keys(t),r=n.length;for(let i=0;i<r;i+=1){let r=n[i];if(Object.prototype.hasOwnProperty.call(t,r)&&r in ms)return hs[e]=t[r],hs[e]}}return``}var _s=gs(`animationend`),vs=gs(`transitionend`);const ys=!!(_s&&vs),bs=_s||`animationend`,xs=vs||`transitionend`;function Ss(e,t){return e?typeof e==`object`?e[t.replace(/-\w/g,e=>e[1].toUpperCase())]:`${e}-${t}`:null}var Cs=(e=>{let t=(0,y.useRef)();function n(t){t&&(t.removeEventListener(xs,e),t.removeEventListener(bs,e))}function r(r){t.current&&t.current!==r&&n(t.current),r&&r!==t.current&&(r.addEventListener(xs,e),r.addEventListener(bs,e),t.current=r)}return y.useEffect(()=>()=>{n(t.current),t.current=null},[]),[r,n]}),ws=S()?y.useLayoutEffect:y.useEffect,Ts=(()=>{let e=y.useRef(null);function t(){lt.cancel(e.current)}function n(r,i=2){t();let a=lt(()=>{i<=1?r({isCanceled:()=>a!==e.current}):n(r,i-1)});e.current=a}return y.useEffect(()=>()=>{t()},[]),[n,t]}),Es=[cs,ls,us,`end`],Ds=[cs,`prepared`];function Os(e){return e===`active`||e===`end`}var ks=((e,t,n)=>{let[r,i]=D(`none`),[a,o]=Ts();function s(){i(cs,!0)}let c=t?Ds:Es;return ws(()=>{if(r!==`none`&&r!==`end`){let e=c[c.indexOf(r)+1],t=n(r);t===!1?i(e,!0):e&&a(n=>{function r(){n.isCanceled()||i(e,!0)}t===!0?r():Promise.resolve(t).then(r)})}},[e,r]),y.useEffect(()=>()=>{o()},[]),[s,r]});function As(e,t,n,{motionEnter:r=!0,motionAppear:i=!0,motionLeave:a=!0,motionDeadline:o,motionLeaveImmediately:s,onAppearPrepare:c,onEnterPrepare:l,onLeavePrepare:u,onAppearStart:d,onEnterStart:f,onLeaveStart:p,onAppearActive:m,onEnterActive:h,onLeaveActive:g,onAppearEnd:_,onEnterEnd:v,onLeaveEnd:b,onVisibleChanged:S}){let[C,w]=D(),[T,E]=rs(is),[O,k]=D(null),A=T(),j=(0,y.useRef)(!1),M=(0,y.useRef)(null);function N(){return n()}let ee=(0,y.useRef)(!1);function te(){E(is),k(null,!0)}let P=x(e=>{let t=T();if(t===`none`)return;let n=N();if(e&&!e.deadline&&e.target!==n)return;let r=ee.current,i;t===`appear`&&r?i=_?.(n,e):t===`enter`&&r?i=v?.(n,e):t===`leave`&&r&&(i=b?.(n,e)),r&&i!==!1&&te()}),[ne]=Cs(P),re=e=>{switch(e){case as:return{[cs]:c,[ls]:d,[us]:m};case os:return{[cs]:l,[ls]:f,[us]:h};case ss:return{[cs]:u,[ls]:p,[us]:g};default:return{}}},ie=y.useMemo(()=>re(A),[A]),[ae,oe]=ks(A,!e,e=>{if(e===`prepare`){let e=ie[cs];return e?e(N()):!1}return oe in ie&&k(ie[oe]?.(N(),null)||null),oe===`active`&&A!==`none`&&(ne(N()),o>0&&(clearTimeout(M.current),M.current=setTimeout(()=>{P({deadline:!0})},o))),oe===`prepared`&&te(),!0});ee.current=Os(oe);let se=(0,y.useRef)(null);ws(()=>{if(j.current&&se.current===t)return;w(t);let n=j.current;j.current=!0;let o;!n&&t&&i&&(o=as),n&&t&&r&&(o=os),(n&&!t&&a||!n&&s&&!t&&a)&&(o=ss);let c=re(o);o&&(e||c.prepare)?(E(o),ae()):E(is),se.current=t},[t]),(0,y.useEffect)(()=>{(A===`appear`&&!i||A===`enter`&&!r||A===`leave`&&!a)&&E(is)},[i,r,a]),(0,y.useEffect)(()=>()=>{j.current=!1,clearTimeout(M.current)},[]);let ce=y.useRef(!1);(0,y.useEffect)(()=>{C&&(ce.current=!0),C!==void 0&&A===`none`&&((ce.current||C)&&S?.(C),ce.current=!0)},[C,A]);let le=O;return ie.prepare&&oe===`start`&&(le={transition:`none`,...le}),[T,oe,le,C??t]}function js(e){let t=e;typeof e==`object`&&({transitionSupport:t}=e);function n(e,n){return!!(e.motionName&&t&&n!==!1)}let r=y.forwardRef((e,t)=>{let{visible:r=!0,removeOnLeave:i=!0,forceRender:a,children:o,motionName:s,leavedClassName:c,eventProps:l}=e,{motion:u}=y.useContext(ts),d=n(e,u),f=(0,y.useRef)();function p(){return Pe(f.current)}let[m,h,g,_]=As(d,r,p,e),v=m(),b=y.useRef(_);_&&(b.current=!0);let x=y.useMemo(()=>{let e={};return Object.defineProperties(e,{nativeElement:{enumerable:!0,get:p},inMotion:{enumerable:!0,get:()=>()=>m()!==is},enableMotion:{enumerable:!0,get:()=>()=>d}}),e},[]);y.useImperativeHandle(t,()=>x,[]);let S,C={...l,visible:r};if(!o)S=null;else if(v===`none`)S=_?o({...C},f):!i&&b.current&&c?o({...C,className:c},f):a||!i&&!c?o({...C,style:{display:`none`}},f):null;else{let e;h===`prepare`?e=`prepare`:Os(h)?e=`active`:h===`start`&&(e=`start`);let t=Ss(s,`${v}-${e}`);S=o({...C,className:F(Ss(s,v),{[t]:t&&e,[s]:typeof s==`string`}),style:g},f)}return y.isValidElement(S)&&oe(S)&&(ce(S)||(S=y.cloneElement(S,{ref:f}))),S});return r.displayName=`CSSMotion`,r}var Ms=js(ys);const Ns=`keep`;function Ps(e){let t;return t=e&&typeof e==`object`&&`key`in e?e:{key:e},{...t,key:String(t.key)}}function Fs(e=[]){return e.map(Ps)}function nee(e=[],t=[]){let n=[],r=0,i=t.length,a=Fs(e),o=Fs(t);a.forEach(e=>{let t=!1;for(let a=r;a<i;a+=1){let i=o[a];if(i.key===e.key){r<a&&(n=n.concat(o.slice(r,a).map(e=>({...e,status:`add`}))),r=a),n.push({...i,status:Ns}),r+=1,t=!0;break}}t||n.push({...e,status:`remove`})}),r<i&&(n=n.concat(o.slice(r).map(e=>({...e,status:`add`}))));let s={};return n.forEach(({key:e})=>{s[e]=(s[e]||0)+1}),Object.keys(s).filter(e=>s[e]>1).forEach(e=>{n=n.filter(({key:t,status:n})=>t!==e||n!==`remove`),n.forEach(t=>{t.key===e&&(t.status=Ns)})}),n}function Is(){return Is=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Is.apply(this,arguments)}var Ls=[`eventProps`,`visible`,`children`,`motionName`,`motionAppear`,`motionEnter`,`motionLeave`,`motionLeaveImmediately`,`motionDeadline`,`removeOnLeave`,`leavedClassName`,`onAppearPrepare`,`onAppearStart`,`onAppearActive`,`onAppearEnd`,`onEnterStart`,`onEnterActive`,`onEnterEnd`,`onLeaveStart`,`onLeaveActive`,`onLeaveEnd`];function Rs(e,t=Ms){class n extends y.Component{static defaultProps={component:`div`};state={keyEntities:[]};static getDerivedStateFromProps({keys:e},{keyEntities:t}){return{keyEntities:nee(t,Fs(e)).filter(e=>{let n=t.find(({key:t})=>e.key===t);return!(n&&n.status===`removed`&&e.status===`remove`)})}}removeKey=e=>{this.setState(t=>({keyEntities:t.keyEntities.map(t=>t.key===e?{...t,status:`removed`}:t)}),()=>{let{keyEntities:e}=this.state;e.filter(({status:e})=>e!==`removed`).length===0&&this.props.onAllRemoved&&this.props.onAllRemoved()})};render(){let{keyEntities:e}=this.state,{component:n,children:r,onVisibleChanged:i,onAllRemoved:a,...o}=this.props,s=n||y.Fragment,c={};return Ls.forEach(e=>{c[e]=o[e],delete o[e]}),delete o.keys,y.createElement(s,o,e.map(({status:e,...n},a)=>{let o=e===`add`||e===`keep`;return y.createElement(t,Is({},c,{key:n.key,visible:o,eventProps:n,onVisibleChanged:e=>{i?.(e,{key:n.key}),e||this.removeKey(n.key)}}),(e,t)=>r({...e,index:a},t))}))}}return n}var zs=Rs(ys),Bs=Ms,Vs=`accept acceptCharset accessKey action allowFullScreen allowTransparency
    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge
    charSet checked classID className colSpan cols content contentEditable contextMenu
    controls coords crossOrigin data dateTime default defer dir disabled download draggable
    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder
    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity
    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media
    mediaGroup method min minLength multiple muted name noValidate nonce open
    optimum pattern placeholder poster preload radioGroup readOnly rel required
    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected
    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style
    summary tabIndex target title type useMap value width wmode wrap onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown
    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick
    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown
    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel
    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough
    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata
    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError`.split(/[\s\n]+/),Hs=`aria-`,Us=`data-`;function Ws(e,t){return e.indexOf(t)===0}function Gs(e,t=!1){let n;n=t===!1?{aria:!0,data:!0,attr:!0}:t===!0?{aria:!0}:{...t};let r={};return Object.keys(e).forEach(t=>{(n.aria&&(t===`role`||Ws(t,Hs))||n.data&&Ws(t,Us)||n.attr&&Vs.includes(t))&&(r[t]=e[t])}),r}var Ks={items_per_page:`/ page`,jump_to:`Go to`,jump_to_confirm:`confirm`,page:`Page`,prev_page:`Previous Page`,next_page:`Next Page`,prev_5:`Previous 5 Pages`,next_5:`Next 5 Pages`,prev_3:`Previous 3 Pages`,next_3:`Next 3 Pages`,page_size:`Page Size`},qs={yearFormat:`YYYY`,dayFormat:`D`,cellMeridiemFormat:`A`,monthBeforeYear:!0};function Js(e){"@babel/helpers - typeof";return Js=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},Js(e)}function Ys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Xs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?Ys(Object(n),!0).forEach(function(t){Zs(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Zs(e,t,n){return t=Qs(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qs(e){var t=$s(e,`string`);return Js(t)==`symbol`?t:String(t)}function $s(e,t){if(Js(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(Js(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}var ec=Xs(Xs({},qs),{},{locale:`en_US`,today:`Today`,now:`Now`,backToToday:`Back to today`,ok:`OK`,clear:`Clear`,week:`Week`,month:`Month`,year:`Year`,timeSelect:`select time`,dateSelect:`select date`,weekSelect:`Choose a week`,monthSelect:`Choose a month`,yearSelect:`Choose a year`,decadeSelect:`Choose a decade`,previousMonth:`Previous month (PageUp)`,nextMonth:`Next month (PageDown)`,previousYear:`Last year (Control + left)`,nextYear:`Next year (Control + right)`,previousDecade:`Last decade`,nextDecade:`Next decade`,previousCentury:`Last century`,nextCentury:`Next century`}),tc={placeholder:`Select time`,rangePlaceholder:[`Start time`,`End time`]},nc={lang:{placeholder:`Select date`,yearPlaceholder:`Select year`,quarterPlaceholder:`Select quarter`,monthPlaceholder:`Select month`,weekPlaceholder:`Select week`,rangePlaceholder:[`Start date`,`End date`],rangeYearPlaceholder:[`Start year`,`End year`],rangeQuarterPlaceholder:[`Start quarter`,`End quarter`],rangeMonthPlaceholder:[`Start month`,`End month`],rangeWeekPlaceholder:[`Start week`,`End week`],...ec},timePickerLocale:{...tc}},rc=nc,ic="${label} is not a valid ${type}",ac={locale:`en`,Pagination:Ks,DatePicker:nc,TimePicker:tc,Calendar:rc,global:{placeholder:`Please select`,close:`Close`,sortable:`sortable`},Table:{filterTitle:`Filter menu`,filterConfirm:`OK`,filterReset:`Reset`,filterEmptyText:`No filters`,filterCheckAll:`Select all items`,filterSearchPlaceholder:`Search in filters`,emptyText:`No data`,selectAll:`Select current page`,selectInvert:`Invert current page`,selectNone:`Clear all data`,selectionAll:`Select all data`,sortTitle:`Sort`,expand:`Expand row`,collapse:`Collapse row`,triggerDesc:`Click to sort descending`,triggerAsc:`Click to sort ascending`,cancelSort:`Click to cancel sorting`},Tour:{Next:`Next`,Previous:`Previous`,Finish:`Finish`},Modal:{okText:`OK`,cancelText:`Cancel`,justOkText:`OK`},Popconfirm:{okText:`OK`,cancelText:`Cancel`},Transfer:{titles:[``,``],searchPlaceholder:`Search here`,itemUnit:`item`,itemsUnit:`items`,remove:`Remove`,selectCurrent:`Select current page`,removeCurrent:`Remove current page`,selectAll:`Select all data`,deselectAll:`Deselect all data`,removeAll:`Remove all data`,selectInvert:`Invert current page`},Upload:{uploading:`Uploading...`,removeFile:`Remove file`,uploadError:`Upload error`,previewFile:`Preview file`,downloadFile:`Download file`},Empty:{description:`No data`},Icon:{icon:`icon`},Text:{edit:`Edit`,copy:`Copy`,copied:`Copied`,expand:`Expand`,collapse:`Collapse`},Form:{optional:`(optional)`,defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:ic,method:ic,array:ic,object:ic,number:ic,date:ic,boolean:ic,integer:ic,float:ic,regexp:ic,email:ic,url:ic,hex:ic},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},QRCode:{expired:`QR code expired`,refresh:`Refresh`,scanned:`Scanned`},ColorPicker:{presetEmpty:`Empty`,transparent:`Transparent`,singleColor:`Single`,gradientColor:`Gradient`}},oc={...ac.Modal},sc=[],cc=()=>sc.reduce((e,t)=>({...e,...t}),ac.Modal);function lc(e){if(e){let t={...e};return sc.push(t),oc=cc(),()=>{sc=sc.filter(e=>e!==t),oc=cc()}}oc={...ac.Modal}}function uc(){return oc}var dc=(0,y.createContext)(void 0),fc=(e,t)=>{let n=y.useContext(dc);return[y.useMemo(()=>{let r=t||ac[e],i=n?.[e]??{};return{...typeof r==`function`?r():r,...i||{}}},[e,t,n]),y.useMemo(()=>{let e=n?.locale;return n?.exist&&!e?ac.locale:e},[n])]},pc=e=>{let{locale:t={},children:n,_ANT_MARK__:r}=e;y.useEffect(()=>lc(t?.Modal),[t]);let i=y.useMemo(()=>({...t,exist:!0}),[t]);return y.createElement(dc.Provider,{value:i},n)};function mc(...e){let t={};return e.forEach(e=>{e&&Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])})}),t}var hc=mc,gc=e=>e!=null;const _c=e=>{if(!e)return;let{closable:t,closeIcon:n}=e;return{closable:t,closeIcon:n}};var vc={},yc=(e,t)=>{if(!e&&(e===!1||t===!1||t===null))return!1;if(e===void 0&&t===void 0)return null;let n={closeIcon:typeof t!=`boolean`&&t!==null?t:void 0};return e&&typeof e==`object`&&(n={...n,...e}),n},bc=(e,t,n)=>e===!1?!1:e?hc(n,t,e):t===!1?!1:t?hc(n,t):n.closable?n:!1,xc=(e,t,n)=>{let{closeIconRender:r}=t,{closeIcon:i,...a}=e,o=i,s=Gs(a,!0);return gc(o)&&(r&&(o=r(o)),o=y.isValidElement(o)?y.cloneElement(o,{"aria-label":n,...o.props,...s}):y.createElement(`span`,{"aria-label":n,...s},o)),[o,s]};const Sc=(e,t,n=vc,r=`Close`)=>{let i=yc(e?.closable,e?.closeIcon),a=yc(t?.closable,t?.closeIcon),o={closeIcon:y.createElement(Jo,null),...n},s=bc(i,a,o),c=typeof s==`boolean`?!1:!!s?.disabled;if(s===!1)return[!1,null,c,{}];let[l,u]=xc(s,o,r);return[!0,l,c,u]},Cc=(e,t,n=vc)=>{let[r]=fc(`global`,ac.global);return y.useMemo(()=>Sc(e,t,{closeIcon:y.createElement(Jo,null),...n},r.close),[e,t,n,r.close])},wc=()=>y.useReducer(e=>e+1,0);var Tc=e=>e&&typeof e==`object`?e:typeof e==`boolean`?{enabled:e,blur:e}:{};const Ec=(e,t,n)=>(0,y.useMemo)(()=>{let r=Tc(e),i={...Tc(t),...r},a=i.blur===!1?void 0:`${n}-mask-blur`;return[i.enabled!==!1,{mask:a}]},[e,t,n]),Dc=(e,...t)=>{let n=e||{};return t.filter(Boolean).reduce((e,t)=>(Object.keys(t||{}).forEach(r=>{let i=n[r],a=t[r];if(i&&typeof i==`object`)if(a&&typeof a==`object`)e[r]=Dc(i,e[r],a);else{let{_default:t}=i;t&&(e[r]=e[r]||{},e[r][t]=F(e[r][t],a))}else e[r]=F(e[r],a)}),e),{})};var Oc=(e,...t)=>y.useMemo(()=>Dc.apply(void 0,[e].concat(t)),[e].concat(t));const kc=(...e)=>e.filter(Boolean).reduce((e,t={})=>(Object.keys(t).forEach(n=>{e[n]={...e[n],...t[n]}}),e),{});var Ac=(...e)=>y.useMemo(()=>kc.apply(void 0,e),[].concat(e)),jc=(e,t)=>{let n={...e};return Object.keys(t).forEach(e=>{if(e!==`_default`){let r=t[e],i=n[e]||{};n[e]=r?jc(i,r):i}}),n};const Mc=(e,t)=>typeof e==`function`?e(t):e,Nc=(e,t,n,r)=>{let i=e.map(e=>e?Mc(e,n):void 0),a=t.map(e=>e?Mc(e,n):void 0),o=Oc.apply(void 0,[r].concat(nt(i))),s=Ac.apply(void 0,nt(a));return y.useMemo(()=>r?[jc(o,r),jc(s,r)]:[o,s],[o,s,r])};var Pc=e=>e===`horizontal`||e===`vertical`;const Fc=(e,t,n)=>(0,y.useMemo)(()=>{let r=Pc(e),i;return i=r?e:typeof t==`boolean`?t?`vertical`:`horizontal`:Pc(n)?n:`horizontal`,[i,i===`vertical`]},[n,e,t]),ree=()=>{let[e,t]=y.useState([]);return[e,y.useCallback(e=>(t(t=>[].concat(nt(t),[e])),()=>{t(t=>t.filter(t=>t!==e))}),[])]};var Ic=y.createContext(void 0),Lc=100;const Rc=Lc*10;Rc+Lc;const zc={Modal:Lc,Drawer:Lc,Popover:Lc,Popconfirm:Lc,Tooltip:Lc,Tour:Lc,FloatButton:Lc},Bc={SelectLike:50,Dropdown:50,DatePicker:50,Menu:50,ImagePreview:1};var Vc=e=>e in zc;const Hc=(e,t)=>{let[,n]=eo(),r=y.useContext(Ic),i=Vc(e),a;if(t!==void 0)a=[t,t];else{let o=r??0;i?o+=(r?0:n.zIndexPopupBase)+zc[e]:o+=Bc[e],a=[r===void 0?t:o,o]}return a};function Uc(e){return e&&y.isValidElement(e)&&e.type===y.Fragment}const Wc=(e,t,n)=>y.isValidElement(e)?y.cloneElement(e,typeof n==`function`?n(e.props||{}):n):t;function Gc(e,t){return Wc(e,e,t)}var Kc=e=>`${e}-css-var`,qc=(0,y.createContext)(void 0),Jc=y.createContext(null);let Yc=!1;function Xc(e){return typeof e==`boolean`&&(Yc=e),Yc}var Zc=[];function Qc(e,t){let[n]=y.useState(()=>S()?document.createElement(`div`):null),r=y.useRef(!1),i=y.useContext(Jc),[a,o]=y.useState(Zc),s=i||(r.current?void 0:e=>{o(t=>[e,...t])});function c(){n.parentElement||document.body.appendChild(n),r.current=!0}function l(){n.parentElement?.removeChild(n),r.current=!1}return E(()=>(e?i?i(c):c():l(),l),[e]),E(()=>{a.length&&(a.forEach(e=>e()),o(Zc))},[a]),[n,s]}function $c(e){let t=`rc-scrollbar-measure-${Math.random().toString(36).substring(7)}`,n=document.createElement(`div`);n.id=t;let r=n.style;r.position=`absolute`,r.left=`0`,r.top=`0`,r.width=`100px`,r.height=`100px`,r.overflow=`scroll`;let i,a;if(e){let n=getComputedStyle(e);r.scrollbarColor=n.scrollbarColor,r.scrollbarWidth=n.scrollbarWidth;let o=getComputedStyle(e,`::-webkit-scrollbar`),s=parseInt(o.width,10),c=parseInt(o.height,10);try{At(`
#${t}::-webkit-scrollbar {
${s?`width: ${o.width};`:``}
${c?`height: ${o.height};`:``}
}`,t)}catch(e){console.error(e),i=s,a=c}}document.body.appendChild(n);let o=e&&i&&!isNaN(i)?i:n.offsetWidth-n.clientWidth,s=e&&a&&!isNaN(a)?a:n.offsetHeight-n.clientHeight;return document.body.removeChild(n),Ot(t),{width:o,height:s}}function el(e){return typeof document>`u`||!e||!(e instanceof Element)?{width:0,height:0}:$c(e)}function tl(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var nl=`rc-util-locker-${Date.now()}`,rl=0;function il(e){let t=!!e,[n]=y.useState(()=>(rl+=1,`${nl}_${rl}`));E(()=>{if(t){let e=el(document.body).width;At(`
html body {
  overflow-y: hidden;
  ${tl()?`width: calc(100% - ${e}px);`:``}
}`,n)}else Ot(n);return()=>{Ot(n)}},[t,n])}var al=h(),ol=e=>e===!1?!1:!S()||!e?null:typeof e==`string`?document.querySelector(e):typeof e==`function`?e():e,sl=y.forwardRef((e,t)=>{let{open:n,autoLock:r,getContainer:i,debug:a,autoDestroy:o=!0,children:s}=e,[c,l]=y.useState(n),u=c||n;y.useEffect(()=>{(o||n)&&l(n)},[n,o]);let[d,f]=y.useState(()=>ol(i));y.useEffect(()=>{f(ol(i)??null)});let[p,m]=Qc(u&&!d,a),h=d??p;il(r&&n&&S()&&(h===p||h===document.body));let g=null;s&&oe(s)&&t&&(g=ce(s));let _=ae(g,t);if(!u||!S()||d===void 0)return null;let v=h===!1||Xc(),b=s;return t&&(b=y.cloneElement(s,{ref:_})),y.createElement(Jc.Provider,{value:m},v?b:(0,al.createPortal)(b,h))});function cl(){return{...y}.useId}var ll=0,ul=cl(),dl=ul?function(e){let t=ul();return e||t}:function(e){let[t,n]=y.useState(`ssr-id`);return y.useEffect(()=>{let e=ll;ll+=1,n(`rc_unique_${e}`)},[]),e||t};function fl(e){let{prefixCls:t,align:n,arrow:r,arrowPos:i}=e,{className:a,content:o,style:s}=r||{},{x:c=0,y:l=0}=i,u=y.useRef(null);if(!n||!n.points)return null;let d={position:`absolute`};if(n.autoArrow!==!1){let e=n.points[0],t=n.points[1],r=e[0],i=e[1],a=t[0],o=t[1];r===a||![`t`,`b`].includes(r)?d.top=l:r===`t`?d.top=0:d.bottom=0,i===o||![`l`,`r`].includes(i)?d.left=c:i===`l`?d.left=0:d.right=0}return y.createElement(`div`,{ref:u,className:F(`${t}-arrow`,a),style:{...d,...s}},o)}function pl(){return pl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pl.apply(this,arguments)}function ml(e){let{prefixCls:t,open:n,zIndex:r,mask:i,motion:a,mobile:o}=e;return i?y.createElement(Bs,pl({},a,{motionAppear:!0,visible:n,removeOnLeave:!0}),({className:e})=>y.createElement(`div`,{style:{zIndex:r},className:F(`${t}-mask`,o&&`${t}-mobile-mask`,e)})):null}var hl=y.memo(({children:e})=>e,(e,t)=>t.cache);function gl(e,t,n,r,i,a,o,s){let c=`auto`,l=e?{}:{left:`-1000vw`,top:`-1000vh`,right:c,bottom:c};if(!e&&(t||!n)){let{points:e}=r,t=r.dynamicInset||r._experimental?.dynamicInset,n=t&&e[0][1]===`r`,u=t&&e[0][0]===`b`;n?(l.right=i,l.left=c):(l.left=o,l.right=c),u?(l.bottom=a,l.top=c):(l.top=s,l.bottom=c)}return l}function _l(){return _l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_l.apply(this,arguments)}var vl=y.forwardRef((e,t)=>{let{popup:n,className:r,prefixCls:i,style:a,target:o,onVisibleChanged:s,open:c,keepDom:l,fresh:u,onClick:d,mask:f,arrow:p,arrowPos:m,align:h,motion:g,maskMotion:_,mobile:v,forceRender:b,getPopupContainer:S,autoDestroy:C,portal:w,children:T,zIndex:D,onMouseEnter:O,onMouseLeave:k,onPointerEnter:A,onPointerDownCapture:j,ready:M,offsetX:N,offsetY:ee,offsetR:te,offsetB:P,onAlign:ne,onPrepare:re,onResize:ae,stretch:oe,targetWidth:se,targetHeight:ce}=e,le=typeof n==`function`?n():n,ue=c||l,de=!!v,[fe,pe,me]=y.useMemo(()=>v?[v.mask,v.maskMotion,v.motion]:[f,_,g],[v,f,_,g]),he=S?.length>0,[ge,_e]=y.useState(!S||!he);E(()=>{!ge&&he&&o&&_e(!0)},[ge,he,o]);let ve=x((e,t)=>{ae?.(e,t),ne()}),ye=gl(de,M,c,h,te,P,N,ee);if(!ge)return null;let be={};return oe&&(oe.includes(`height`)&&ce?be.height=ce:oe.includes(`minHeight`)&&ce&&(be.minHeight=ce),oe.includes(`width`)&&se?be.width=se:oe.includes(`minWidth`)&&se&&(be.minWidth=se)),c||(be.pointerEvents=`none`),y.createElement(w,{open:b||ue,getContainer:S&&(()=>S(o)),autoDestroy:C},y.createElement(ml,{prefixCls:i,open:c,zIndex:D,mask:fe,motion:pe,mobile:de}),y.createElement(Ye,{onResize:ve,disabled:!c},e=>y.createElement(Bs,_l({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:b,leavedClassName:`${i}-hidden`},me,{onAppearPrepare:re,onEnterPrepare:re,visible:c,onVisibleChanged:e=>{g?.onVisibleChanged?.(e),s(e)}}),({className:n,style:o},s)=>{let l=F(i,n,r,{[`${i}-mobile`]:de});return y.createElement(`div`,{ref:ie(e,t,s),className:l,style:{"--arrow-x":`${m.x||0}px`,"--arrow-y":`${m.y||0}px`,...ye,...be,...o,boxSizing:`border-box`,zIndex:D,...a},onMouseEnter:O,onMouseLeave:k,onPointerEnter:A,onClick:d,onPointerDownCapture:j},p&&y.createElement(fl,{prefixCls:i,arrow:p,arrowPos:m,align:h}),y.createElement(hl,{cache:!c&&!u},le))})),T)}),yl=y.createContext(null);const bl=y.createContext(null);function xl(e){return e?Array.isArray(e)?e:[e]:[]}function Sl(e,t,n){return y.useMemo(()=>{let r=xl(t??e),i=xl(n??e),a=new Set(r),o=new Set(i);return a.has(`hover`)&&!a.has(`click`)&&a.add(`touch`),o.has(`hover`)&&!o.has(`click`)&&o.add(`touch`),[a,o]},[e,t,n])}var Cl=(e=>{if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){let{width:t,height:n}=e.getBBox();if(t||n)return!0}if(e.getBoundingClientRect){let{width:t,height:n}=e.getBoundingClientRect();if(t||n)return!0}}return!1});function wl(e=[],t=[],n){return n?e[0]===t[0]:e[0]===t[0]&&e[1]===t[1]}function Tl(e,t,n,r){let{points:i}=n,a=Object.keys(e);for(let n=0;n<a.length;n+=1){let o=a[n];if(wl(e[o]?.points,i,r))return`${t}-placement-${o}`}return``}function El(e){return e.ownerDocument.defaultView}function Dl(e){let t=[],n=e?.parentElement,r=[`hidden`,`scroll`,`clip`,`auto`];for(;n;){let{overflowX:e,overflowY:i,overflow:a}=El(n).getComputedStyle(n);[e,i,a].some(e=>r.includes(e))&&t.push(n),n=n.parentElement}return t}function Ol(e,t=1){return Number.isNaN(e)?t:e}function kl(e){return Ol(parseFloat(e),0)}function Al(e,t){let n={...e};return(t||[]).forEach(e=>{if(e instanceof HTMLBodyElement||e instanceof HTMLHtmlElement)return;let{overflow:t,overflowClipMargin:r,borderTopWidth:i,borderBottomWidth:a,borderLeftWidth:o,borderRightWidth:s}=El(e).getComputedStyle(e),c=e.getBoundingClientRect(),{offsetHeight:l,clientHeight:u,offsetWidth:d,clientWidth:f}=e,p=kl(i),m=kl(a),h=kl(o),g=kl(s),_=Ol(Math.round(c.width/d*1e3)/1e3),v=Ol(Math.round(c.height/l*1e3)/1e3),y=(d-f-h-g)*_,b=(l-u-p-m)*v,x=p*v,S=m*v,C=h*_,w=g*_,T=0,E=0;if(t===`clip`){let e=kl(r);T=e*_,E=e*v}let D=c.x+C-T,O=c.y+x-E,k=D+c.width+2*T-C-w-y,A=O+c.height+2*E-x-S-b;n.left=Math.max(n.left,D),n.top=Math.max(n.top,O),n.right=Math.min(n.right,k),n.bottom=Math.min(n.bottom,A)}),n}function jl(e,t=0){let n=`${t}`,r=n.match(/^(.*)\%$/);return r?e*(parseFloat(r[1])/100):parseFloat(n)}function Ml(e,t){let[n,r]=t||[];return[jl(e.width,n),jl(e.height,r)]}function Nl(e=``){return[e[0],e[1]]}function Pl(e,t){let n=t[0],r=t[1],i,a;return a=n===`t`?e.y:n===`b`?e.y+e.height:e.y+e.height/2,i=r===`l`?e.x:r===`r`?e.x+e.width:e.x+e.width/2,{x:i,y:a}}function Fl(e,t){let n={t:`b`,b:`t`,l:`r`,r:`l`};return e.map((e,r)=>r===t?n[e]||`c`:e).join(``)}function Il(e,t,n,r,i,a,o,s){let[c,l]=y.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:i[r]||{}}),u=y.useRef(0),d=y.useMemo(()=>!t||s?[]:Dl(t),[t]),f=y.useRef({});e||(f.current={});let p=x(()=>{if(t&&n&&e&&!s){let e=t,s=e.ownerDocument,c=El(e),{position:u}=c.getComputedStyle(e),p=e.style.left,m=e.style.top,h=e.style.right,g=e.style.bottom,_=e.style.overflow,v={...i[r],...a},y=s.createElement(`div`);e.parentElement?.appendChild(y),y.style.left=`${e.offsetLeft}px`,y.style.top=`${e.offsetTop}px`,y.style.position=u,y.style.height=`${e.offsetHeight}px`,y.style.width=`${e.offsetWidth}px`,e.style.left=`0`,e.style.top=`0`,e.style.right=`auto`,e.style.bottom=`auto`,e.style.overflow=`hidden`;let b;if(Array.isArray(n))b={x:n[0],y:n[1],width:0,height:0};else{let e=n.getBoundingClientRect();e.x=e.x??e.left,e.y=e.y??e.top,b={x:e.x,y:e.y,width:e.width,height:e.height}}let x=e.getBoundingClientRect(),{height:S,width:C}=c.getComputedStyle(e);x.x=x.x??x.left,x.y=x.y??x.top;let{clientWidth:w,clientHeight:T,scrollWidth:E,scrollHeight:D,scrollTop:O,scrollLeft:k}=s.documentElement,A=x.height,j=x.width,M=b.height,N=b.width,ee={left:0,top:0,right:w,bottom:T},te={left:-k,top:-O,right:E-k,bottom:D-O},{htmlRegion:P}=v,ne=`visible`,re=`visibleFirst`;P!==`scroll`&&P!==re&&(P=ne);let ie=P===re,ae=Al(te,d),oe=Al(ee,d),se=P===ne?oe:ae,ce=ie?oe:se;e.style.left=`auto`,e.style.top=`auto`,e.style.right=`0`,e.style.bottom=`0`;let le=e.getBoundingClientRect();e.style.left=p,e.style.top=m,e.style.right=h,e.style.bottom=g,e.style.overflow=_,e.parentElement?.removeChild(y);let ue=Ol(Math.round(j/parseFloat(C)*1e3)/1e3),de=Ol(Math.round(A/parseFloat(S)*1e3)/1e3);if(ue===0||de===0||Ne(n)&&!Cl(n))return;let{offset:fe,targetOffset:pe}=v,[me,he]=Ml(x,fe),[ge,_e]=Ml(b,pe);b.x-=ge,b.y-=_e;let[ve,ye]=v.points||[],be=Nl(ye),xe=Nl(ve),Se=Pl(b,be),Ce=Pl(x,xe),we={...v},Te=Se.x-Ce.x+me,Ee=Se.y-Ce.y+he;function De(e,t,n=se){let r=x.x+e,i=x.y+t,a=r+j,o=i+A,s=Math.max(r,n.left),c=Math.max(i,n.top),l=Math.min(a,n.right),u=Math.min(o,n.bottom);return Math.max(0,(l-s)*(u-c))}let Oe=De(Te,Ee),ke=De(Te,Ee,oe),Ae=Pl(b,[`t`,`l`]),je=Pl(x,[`t`,`l`]),Me=Pl(b,[`b`,`r`]),Pe=Pl(x,[`b`,`r`]),{adjustX:Fe,adjustY:Ie,shiftX:Le,shiftY:Re}=v.overflow||{},ze=e=>typeof e==`boolean`?e:e>=0,Be,Ve,He,Ue;function We(){Be=x.y+Ee,Ve=Be+A,He=x.x+Te,Ue=He+j}We();let Ge=ze(Ie),Ke=xe[0]===be[0];if(Ge&&xe[0]===`t`&&(Ve>ce.bottom||f.current.bt)){let e=Ee;Ke?e-=A-M:e=Ae.y-Pe.y-he;let t=De(Te,e),n=De(Te,e,oe);t>Oe||t===Oe&&(!ie||n>=ke)?(f.current.bt=!0,Ee=e,he=-he,we.points=[Fl(xe,0),Fl(be,0)]):f.current.bt=!1}if(Ge&&xe[0]===`b`&&(Be<ce.top||f.current.tb)){let e=Ee;Ke?e+=A-M:e=Me.y-je.y-he;let t=De(Te,e),n=De(Te,e,oe);t>Oe||t===Oe&&(!ie||n>=ke)?(f.current.tb=!0,Ee=e,he=-he,we.points=[Fl(xe,0),Fl(be,0)]):f.current.tb=!1}let qe=ze(Fe),Je=xe[1]===be[1];if(qe&&xe[1]===`l`&&(Ue>ce.right||f.current.rl)){let e=Te;Je?e-=j-N:e=Ae.x-Pe.x-me;let t=De(e,Ee),n=De(e,Ee,oe);t>Oe||t===Oe&&(!ie||n>=ke)?(f.current.rl=!0,Te=e,me=-me,we.points=[Fl(xe,1),Fl(be,1)]):f.current.rl=!1}if(qe&&xe[1]===`r`&&(He<ce.left||f.current.lr)){let e=Te;Je?e+=j-N:e=Me.x-je.x-me;let t=De(e,Ee),n=De(e,Ee,oe);t>Oe||t===Oe&&(!ie||n>=ke)?(f.current.lr=!0,Te=e,me=-me,we.points=[Fl(xe,1),Fl(be,1)]):f.current.lr=!1}We();let Ye=Le===!0?0:Le;typeof Ye==`number`&&(He<oe.left&&(Te-=He-oe.left-me,b.x+N<oe.left+Ye&&(Te+=b.x-oe.left+N-Ye)),Ue>oe.right&&(Te-=Ue-oe.right-me,b.x>oe.right-Ye&&(Te+=b.x-oe.right+Ye)));let Xe=Re===!0?0:Re;typeof Xe==`number`&&(Be<oe.top&&(Ee-=Be-oe.top-he,b.y+M<oe.top+Xe&&(Ee+=b.y-oe.top+M-Xe)),Ve>oe.bottom&&(Ee-=Ve-oe.bottom-he,b.y>oe.bottom-Xe&&(Ee+=b.y-oe.bottom+Xe)));let F=x.x+Te,Ze=F+j,Qe=x.y+Ee,$e=Qe+A,et=b.x,tt=et+N,nt=b.y,rt=nt+M,it=(Math.max(F,et)+Math.min(Ze,tt))/2-F,at=(Math.max(Qe,nt)+Math.min($e,rt))/2-Qe;o?.(t,we);let ot=le.right-x.x-(Te+x.width),st=le.bottom-x.y-(Ee+x.height);ue===1&&(Te=Math.round(Te),ot=Math.round(ot)),de===1&&(Ee=Math.round(Ee),st=Math.round(st)),l({ready:!0,offsetX:Te/ue,offsetY:Ee/de,offsetR:ot/ue,offsetB:st/de,arrowX:it/ue,arrowY:at/de,scaleX:ue,scaleY:de,align:we})}}),m=()=>{u.current+=1;let e=u.current;Promise.resolve().then(()=>{u.current===e&&p()})},h=()=>{l(e=>({...e,ready:!1}))};return E(h,[r]),E(()=>{e||h()},[e]),[c.ready,c.offsetX,c.offsetY,c.offsetR,c.offsetB,c.arrowX,c.arrowY,c.scaleX,c.scaleY,c.align,m]}function Ll(){let e=y.useRef(null),t=()=>{e.current&&=(clearTimeout(e.current),null)};return y.useEffect(()=>()=>{t()},[]),(n,r)=>{t(),r===0?n():e.current=setTimeout(()=>{n()},r*1e3)}}function Rl(e,t,n,r,i){E(()=>{if(e&&t&&n){let e=t,a=n,o=Dl(e),s=Dl(a),c=El(a),l=new Set([c,...o,...s]);function u(){r(),i()}return l.forEach(e=>{e.addEventListener(`scroll`,u,{passive:!0})}),c.addEventListener(`resize`,u,{passive:!0}),r(),()=>{l.forEach(e=>{e.removeEventListener(`scroll`,u),c.removeEventListener(`resize`,u)})}}},[e,t,n])}function zl(e,t,n,r,i,a,o,s){let c=y.useRef(e);c.current=e;let l=y.useRef(!1);y.useEffect(()=>{if(t&&r&&(!i||a)){let e=()=>{l.current=!1},t=e=>{c.current&&!o(e.composedPath?.()?.[0]||e.target)&&!l.current&&s(!1)},i=El(r);i.addEventListener(`pointerdown`,e,!0),i.addEventListener(`mousedown`,t,!0),i.addEventListener(`contextmenu`,t,!0);let a=So(n);return a&&(a.addEventListener(`mousedown`,t,!0),a.addEventListener(`contextmenu`,t,!0)),()=>{i.removeEventListener(`pointerdown`,e,!0),i.removeEventListener(`mousedown`,t,!0),i.removeEventListener(`contextmenu`,t,!0),a&&(a.removeEventListener(`mousedown`,t,!0),a.removeEventListener(`contextmenu`,t,!0))}}},[t,n,r,i,a]);function u(){l.current=!0}return u}function Bl(){let[e,t]=y.useState(null),[n,r]=y.useState(!1),[i,a]=y.useState(!1),o=y.useRef(null);return[x(e=>{e===!1?(o.current=null,r(!1)):i&&n?o.current=e:(r(!0),t(e),o.current=null,n||a(!0))}),n,e,x(e=>{e?(a(!1),o.current&&=(t(o.current),null)):(a(!1),o.current=null)})]}function Vl(){return Vl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vl.apply(this,arguments)}var Hl=e=>{let{prefixCls:t,isMobile:n,ready:r,open:i,align:a,offsetR:o,offsetB:s,offsetX:c,offsetY:l,arrowPos:u,popupSize:d,motion:f,uniqueContainerClassName:p,uniqueContainerStyle:m}=e,h=`${t}-unique-container`,[g,_]=y.useState(!1),v=gl(n,r,i,a,o,s,c,l),b=y.useRef(v);r&&(b.current=v);let x={};return d&&(x.width=d.width,x.height=d.height),y.createElement(Bs,Vl({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,leavedClassName:`${h}-hidden`},f,{visible:i,onVisibleChanged:e=>{_(e)}}),({className:e,style:t})=>{let n=F(h,e,p,{[`${h}-visible`]:g});return y.createElement(`div`,{className:n,style:{"--arrow-x":`${u?.x||0}px`,"--arrow-y":`${u?.y||0}px`,...b.current,...x,...t,...m}})})},Ul=({children:e,postTriggerProps:t})=>{let[n,r,i,a]=Bl(),o=y.useMemo(()=>!i||!t?i:t(i),[i,t]),[s,c]=y.useState(null),[l,u]=y.useState(null),d=y.useRef(null),f=x(e=>{d.current=e,Ne(e)&&s!==e&&c(e)}),p=y.useRef(null),m=Ll(),h=x((e,t)=>{p.current=t,m(()=>{n(e)},e.delay)}),g=e=>{m(()=>{p.current?.()||n(!1)},e)},_=x(e=>{a(e)}),[v,b,S,C,w,T,E,,,D,O]=Il(r,s,o?.target,o?.popupPlacement,o?.builtinPlacements||{},o?.popupAlign,void 0,!1),k=y.useMemo(()=>o?F(Tl(o.builtinPlacements||{},o.prefixCls||``,D,!1),o.getPopupClassNameFromAlign?.(D)):``,[D,o?.getPopupClassNameFromAlign,o?.builtinPlacements,o?.prefixCls]),A=y.useMemo(()=>({show:h,hide:g}),[]);y.useEffect(()=>{O()},[o?.target]);let j=x(()=>(O(),Promise.resolve())),M=y.useRef({}),N=y.useContext(yl),ee=y.useMemo(()=>({registerSubPopup:(e,t)=>{M.current[e]=t,N?.registerSubPopup(e,t)}}),[N]),te=o?.prefixCls;return y.createElement(bl.Provider,{value:A},e,o&&y.createElement(yl.Provider,{value:ee},y.createElement(vl,{ref:f,portal:sl,prefixCls:te,popup:o.popup,className:F(o.popupClassName,k,`${te}-unique-controlled`),style:o.popupStyle,target:o.target,open:r,keepDom:!0,fresh:!0,autoDestroy:!1,onVisibleChanged:_,ready:v,offsetX:b,offsetY:S,offsetR:C,offsetB:w,onAlign:O,onPrepare:j,onResize:e=>u({width:e.offsetWidth,height:e.offsetHeight}),arrowPos:{x:T,y:E},align:D,zIndex:o.zIndex,mask:o.mask,arrow:o.arrow,motion:o.popupMotion,maskMotion:o.maskMotion,getPopupContainer:o.getPopupContainer},y.createElement(Hl,{prefixCls:te,isMobile:!1,ready:v,open:r,align:D,offsetR:C,offsetB:w,offsetX:b,offsetY:S,arrowPos:{x:T,y:E},popupSize:l,motion:o.popupMotion,uniqueContainerClassName:F(o.uniqueContainerClassName,k),uniqueContainerStyle:o.uniqueContainerStyle}))))};function Wl(e=sl){return y.forwardRef((t,n)=>{let{prefixCls:r=`rc-trigger-popup`,children:i,action:a=`hover`,showAction:o,hideAction:s,popupVisible:c,defaultPopupVisible:l,onOpenChange:u,afterOpenChange:d,onPopupVisibleChange:f,afterPopupVisibleChange:p,mouseEnterDelay:m,mouseLeaveDelay:h=.1,focusDelay:g,blurDelay:_,mask:v,maskClosable:b=!0,getPopupContainer:S,forceRender:C,autoDestroy:w,popup:T,popupClassName:D,uniqueContainerClassName:k,uniqueContainerStyle:A,popupStyle:j,popupPlacement:M,builtinPlacements:N={},popupAlign:ee,zIndex:te,stretch:P,getPopupClassNameFromAlign:ne,fresh:re,unique:ie,alignPoint:ae,onPopupClick:oe,onPopupAlign:se,arrow:ce,popupMotion:le,maskMotion:ue,mobile:de,...fe}=t,pe=w||!1,me=c===void 0,he=!!de,ge=y.useRef({}),_e=y.useContext(yl),ve=y.useMemo(()=>({registerSubPopup:(e,t)=>{ge.current[e]=t,_e?.registerSubPopup(e,t)}}),[_e]),ye=y.useContext(bl),be=dl(),[xe,Se]=y.useState(null),Ce=y.useRef(null),we=x(e=>{Ce.current=e,Ne(e)&&xe!==e&&Se(e),_e?.registerSubPopup(be,e)}),[Te,Ee]=y.useState(null),De=y.useRef(null),Oe=x(e=>{Ne(e)&&Te!==e&&(Ee(e),De.current=e)}),ke={},Ae=x(e=>{let t=Te;return t?.contains(e)||So(t)?.host===e||e===t||xe?.contains(e)||So(xe)?.host===e||e===xe||Object.values(ge.current).some(t=>t?.contains(e)||e===t)}),je=ce?{...ce===!0?{}:ce}:null,[Me,Pe]=O(l||!1,c),Fe=Me||!1,Ie=y.useMemo(()=>{let e=typeof i==`function`?i({open:Fe}):i;return y.Children.only(e)},[i,Fe]),Le=Ie?.props||{},Re=x(()=>Fe),ze=x((e=0)=>({popup:T,target:Te,delay:e,prefixCls:r,popupClassName:D,uniqueContainerClassName:k,uniqueContainerStyle:A,popupStyle:j,popupPlacement:M,builtinPlacements:N,popupAlign:ee,zIndex:te,mask:v,maskClosable:b,popupMotion:le,maskMotion:ue,arrow:je,getPopupContainer:S,getPopupClassNameFromAlign:ne,id:be}));E(()=>{ye&&ie&&Te&&!me&&!_e&&(Fe?ye.show(ze(m),Re):ye.hide(h))},[Fe,Te]);let Be=y.useRef(Fe);Be.current=Fe;let Ve=y.useRef([]);Ve.current=[];let He=x(e=>{Pe(e),(Ve.current[Ve.current.length-1]??Fe)!==e&&(Ve.current.push(e),u?.(e),f?.(e))}),Ue=Ll(),We=(e,t=0)=>{if(c!==void 0){Ue(()=>{He(e)},t);return}if(ye&&ie&&me&&!_e){e?ye.show(ze(t),Re):ye.hide(t);return}Ue(()=>{He(e)},t)},[Ge,Ke]=y.useState(!1);E(e=>{(!e||Fe)&&Ke(!0)},[Fe]);let[qe,Je]=y.useState(null),[Xe,Ze]=y.useState(null),Qe=e=>{Ze([e.clientX,e.clientY])},[$e,et,tt,nt,rt,it,at,ot,st,ct,lt]=Il(Fe,xe,ae&&Xe!==null?Xe:Te,M,N,ee,se,he),[ut,dt]=Sl(a,o,s),ft=ut.has(`click`),pt=dt.has(`click`)||dt.has(`contextMenu`),mt=x(()=>{Ge||lt()});Rl(Fe,Te,xe,mt,()=>{Be.current&&ae&&pt&&We(!1)}),E(()=>{mt()},[Xe,M]),E(()=>{Fe&&!N?.[M]&&mt()},[JSON.stringify(ee)]);let ht=y.useMemo(()=>F(Tl(N,r,ct,ae),ne?.(ct)),[ct,ne,N,r,ae]);y.useImperativeHandle(n,()=>({nativeElement:De.current,popupElement:Ce.current,forceAlign:mt}));let[gt,_t]=y.useState(0),[vt,yt]=y.useState(0),bt=()=>{if(P&&Te){let e=Te.getBoundingClientRect();_t(e.width),yt(e.height)}},xt=()=>{bt(),mt()},St=e=>{Ke(!1),lt(),d?.(e),p?.(e)},Ct=()=>new Promise(e=>{bt(),Je(()=>e)});E(()=>{qe&&(lt(),qe(),Je(null))},[qe]);function wt(e,t,n,r,i){ke[e]=(a,...o)=>{(!i||!i())&&(r?.(a),We(t,n)),Le[e]?.(a,...o)}}let Tt=ut.has(`touch`),Et=dt.has(`touch`),Dt=y.useRef(!1);(Tt||Et)&&(ke.onTouchStart=(...e)=>{Dt.current=!0,Be.current&&Et?We(!1):!Be.current&&Tt&&We(!0),Le.onTouchStart?.(...e)}),(ft||pt)&&(ke.onClick=(e,...t)=>{Be.current&&pt?We(!1):!Be.current&&ft&&(Qe(e),We(!0)),Le.onClick?.(e,...t),Dt.current=!1});let Ot=zl(Fe,pt||Et,Te,xe,v,b,Ae,We),kt=ut.has(`hover`),At=dt.has(`hover`),jt,Mt,Nt=()=>Dt.current;if(kt){let e=e=>{Qe(e)};wt(`onMouseEnter`,!0,m,e,Nt),wt(`onPointerEnter`,!0,m,e,Nt),jt=e=>{(Fe||Ge)&&xe?.contains(e.target)&&We(!0,m)},ae&&(ke.onMouseMove=e=>{Le.onMouseMove?.(e)})}At&&(wt(`onMouseLeave`,!1,h,void 0,Nt),wt(`onPointerLeave`,!1,h,void 0,Nt),Mt=()=>{We(!1,h)}),ut.has(`focus`)&&wt(`onFocus`,!0,g),dt.has(`focus`)&&wt(`onBlur`,!1,_),ut.has(`contextMenu`)&&(ke.onContextMenu=(e,...t)=>{Be.current&&dt.has(`contextMenu`)?We(!1):(Qe(e),We(!0)),e.preventDefault(),Le.onContextMenu?.(e,...t)});let Pt=y.useRef(!1);Pt.current||=C||Fe||Ge;let Ft={...Le,...ke},It={};[`onContextMenu`,`onClick`,`onMouseDown`,`onTouchStart`,`onMouseEnter`,`onMouseLeave`,`onFocus`,`onBlur`].forEach(e=>{fe[e]&&(It[e]=(...t)=>{Ft[e]?.(...t),fe[e](...t)})});let Lt={x:it,y:at},Rt=y.cloneElement(Ie,{...Ft,...It});return y.createElement(y.Fragment,null,y.createElement(Ye,{disabled:!Fe,ref:Oe,onResize:xt},Rt),Pt.current&&(!ye||!ie)&&y.createElement(yl.Provider,{value:ve},y.createElement(vl,{portal:e,ref:we,prefixCls:r,popup:T,className:F(D,!he&&ht),style:j,target:Te,onMouseEnter:jt,onMouseLeave:Mt,onPointerEnter:jt,zIndex:te,open:Fe,keepDom:Ge,fresh:re,onClick:oe,onPointerDownCapture:Ot,mask:v,motion:le,maskMotion:ue,onVisibleChanged:St,onPrepare:Ct,forceRender:C,autoDestroy:pe,getPopupContainer:S,align:ct,arrow:je,arrowPos:Lt,ready:$e,offsetX:et,offsetY:tt,offsetR:nt,offsetB:rt,onAlign:mt,stretch:P,targetWidth:gt/ot,targetHeight:vt/st,mobile:de})))})}var Gl=Wl(sl),Kl=({children:e})=>{let{getPrefixCls:t}=y.useContext(dt),n=t();return y.isValidElement(e)?y.createElement(Bs,{visible:!0,motionName:`${n}-fade`,motionAppear:!0,motionEnter:!0,motionLeave:!1,removeOnLeave:!1},({style:t,className:n})=>{let{className:r,style:i}=e.props,a={...i,...t};return y.cloneElement(e,{className:F(r,n),style:a})}):e},ql=[null,null];function Jl(e){if(ql[0]!==e){let t={};Object.keys(e).forEach(n=>{t[n]={...e[n],dynamicInset:!1}}),ql[0]=e,ql[1]=t}return ql[1]}var Yl=({children:e})=>y.createElement(Ul,{postTriggerProps:e=>{let t=typeof e.popup==`function`?e.popup():e.popup,{id:n,builtinPlacements:r}=e,i=Jl(r);return{...e,getPopupContainer:null,arrow:!1,popup:y.createElement(Kl,{key:n},t),builtinPlacements:i}}},e),Xl=y.createContext(!1);const Zl=({children:e,disabled:t})=>{let n=y.useContext(Xl);return y.createElement(Xl.Provider,{value:t??n},e)};var Ql=Xl,$l=y.createContext(void 0);const eu=({children:e,size:t})=>{let n=y.useContext($l);return y.createElement($l.Provider,{value:t||n},e)};var tu=$l;function nu(){return{componentDisabled:(0,y.useContext)(Ql),componentSize:(0,y.useContext)(tu)}}var ru=nu;function iu(e,t,n){Me(`ConfigProvider`);let r=e||{},i=r.inherit===!1||!t?{...Wa,hashed:t?.hashed??Wa.hashed,cssVar:t?.cssVar}:t,a=(0,y.useId)();return j(()=>{if(!e)return t;let o={...i.components};Object.keys(e.components||{}).forEach(t=>{o[t]={...o[t],...e.components[t]}});let s=`css-var-${a.replace(/:/g,``)}`,c={prefix:n?.prefixCls,...i.cssVar,...r.cssVar,key:r.cssVar?.key||s};return{...i,...r,token:{...i.token,...r.token},components:o,cssVar:c}},[r,i],(e,t)=>e.some((e,n)=>{let r=t[n];return!Mt(e,r,!0)}))}var au=y.createContext(!0);function ou(e){let t=y.useContext(au),{children:n}=e,[,r]=eo(),{motion:i}=r,a=y.useRef(!1);return a.current||=t!==i,a.current?y.createElement(au.Provider,{value:i},y.createElement(ns,{motion:i},n)):n}var su=()=>null,cu=[`getTargetContainer`,`getPopupContainer`,`renderEmpty`,`input`,`pagination`,`form`,`select`,`button`],lu=e=>{let{prefixCls:t,iconPrefixCls:n,theme:r,holderRender:i}=e;`holderRender`in e},uu=e=>{let{children:t,csp:n,autoInsertSpaceInButton:r,alert:i,affix:a,anchor:o,form:s,locale:c,componentSize:l,direction:u,space:d,splitter:f,virtual:p,dropdownMatchSelectWidth:m,popupMatchSelectWidth:h,popupOverflow:g,legacyLocale:_,parentContext:v,iconPrefixCls:b,theme:x,componentDisabled:S,segmented:C,statistic:w,spin:T,calendar:E,carousel:D,cascader:O,collapse:k,typography:A,checkbox:M,descriptions:N,divider:ee,drawer:te,skeleton:P,steps:ne,image:re,layout:ie,list:ae,mentions:oe,modal:se,progress:ce,result:le,slider:ue,breadcrumb:de,masonry:fe,menu:pe,pagination:me,input:he,textArea:_e,otp:ve,empty:ye,badge:be,radio:xe,rate:Se,ribbon:Ce,switch:we,transfer:Te,avatar:Ee,message:De,tag:Oe,table:ke,card:Ae,cardMeta:Me,tabs:Ne,timeline:Pe,timePicker:Fe,upload:Ie,notification:Le,tree:Re,colorPicker:ze,datePicker:Be,rangePicker:Ve,flex:He,wave:Ue,dropdown:We,warning:Ge,tour:Ke,tooltip:qe,popover:Je,popconfirm:Ye,qrcode:Xe,floatButton:F,floatButtonGroup:Ze,variant:Qe,inputNumber:$e,treeSelect:et,watermark:tt}=e,nt=y.useCallback((t,n)=>{let{prefixCls:r}=e;if(n)return n;let i=r||v.getPrefixCls(``);return t?`${i}-${t}`:i},[v.getPrefixCls,e.prefixCls]),rt=b||v.iconPrefixCls||`anticon`,it=n||v.csp;_o(rt,it);let at=iu(x,v.theme,{prefixCls:nt(``)}),ot={csp:it,autoInsertSpaceInButton:r,alert:i,affix:a,anchor:o,locale:c||_,direction:u,space:d,splitter:f,virtual:p,popupMatchSelectWidth:h??m,popupOverflow:g,getPrefixCls:nt,iconPrefixCls:rt,theme:at,segmented:C,statistic:w,spin:T,calendar:E,carousel:D,cascader:O,collapse:k,typography:A,checkbox:M,descriptions:N,divider:ee,drawer:te,skeleton:P,steps:ne,image:re,input:he,textArea:_e,otp:ve,layout:ie,list:ae,mentions:oe,modal:se,progress:ce,result:le,slider:ue,breadcrumb:de,masonry:fe,menu:pe,pagination:me,empty:ye,badge:be,radio:xe,rate:Se,ribbon:Ce,switch:we,transfer:Te,avatar:Ee,message:De,tag:Oe,table:ke,card:Ae,cardMeta:Me,tabs:Ne,timeline:Pe,timePicker:Fe,upload:Ie,notification:Le,tree:Re,colorPicker:ze,datePicker:Be,rangePicker:Ve,flex:He,wave:Ue,dropdown:We,warning:Ge,tour:Ke,tooltip:qe,popover:Je,popconfirm:Ye,qrcode:Xe,floatButton:F,floatButtonGroup:Ze,variant:Qe,inputNumber:$e,treeSelect:et,watermark:tt},st={...v};Object.keys(ot).forEach(e=>{ot[e]!==void 0&&(st[e]=ot[e])}),cu.forEach(t=>{let n=e[t];n&&(st[t]=n)}),r!==void 0&&(st.button={autoInsertSpace:r,...st.button});let ct=j(()=>st,st,(e,t)=>{let n=Object.keys(e),r=Object.keys(t);return n.length!==r.length||n.some(n=>e[n]!==t[n])}),{layer:lt}=y.useContext(Vt),ut=y.useMemo(()=>({prefixCls:rt,csp:it,layer:lt?`antd`:void 0}),[rt,it,lt]),ft=y.createElement(y.Fragment,null,y.createElement(su,{dropdownMatchSelectWidth:m}),t),pt=y.useMemo(()=>ge(ac.Form?.defaultValidateMessages||{},ct.locale?.Form?.defaultValidateMessages||{},ct.form?.validateMessages||{},s?.validateMessages||{}),[ct,s?.validateMessages]);Object.keys(pt).length>0&&(ft=y.createElement(qc.Provider,{value:pt},ft)),c&&(ft=y.createElement(pc,{locale:c,_ANT_MARK__:`internalMark`},ft)),(rt||it)&&(ft=y.createElement(yo.Provider,{value:ut},ft)),l&&(ft=y.createElement(eu,{size:l},ft)),ft=y.createElement(ou,null,ft),qe?.unique&&(ft=y.createElement(Yl,null,ft));let mt=y.useMemo(()=>{let{algorithm:e,token:t,components:n,cssVar:r,...i}=at||{},a=e&&(!Array.isArray(e)||e.length>0)?qt(e):Ua,o={};Object.entries(n||{}).forEach(([e,t])=>{let n={...t};`algorithm`in n&&(n.algorithm===!0?n.theme=a:(Array.isArray(n.algorithm)||typeof n.algorithm==`function`)&&(n.theme=qt(n.algorithm)),delete n.algorithm),o[e]=n});let s={...zi,...t};return{...i,theme:a,token:s,components:o,override:{override:s,...o},cssVar:r}},[at]);return x&&(ft=y.createElement(Ga.Provider,{value:mt},ft)),ct.warning&&(ft=y.createElement(je.Provider,{value:ct.warning},ft)),S!==void 0&&(ft=y.createElement(Zl,{disabled:S},ft)),y.createElement(dt.Provider,{value:ct},ft)},du=e=>{let t=y.useContext(dt),n=y.useContext(dc);return y.createElement(uu,{parentContext:t,legacyLocale:n,...e})};du.ConfigContext=dt,du.SizeContext=tu,du.config=lu,du.useConfig=ru,Object.defineProperty(du,`SizeContext`,{get:()=>tu});var fu=du,pu={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){let{keyCode:t}=e;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=pu.F1&&t<=pu.F12)return!1;switch(t){case pu.ALT:case pu.CAPS_LOCK:case pu.CONTEXT_MENU:case pu.CTRL:case pu.DOWN:case pu.END:case pu.ESC:case pu.HOME:case pu.INSERT:case pu.LEFT:case pu.MAC_FF_META:case pu.META:case pu.NUMLOCK:case pu.NUM_CENTER:case pu.PAGE_DOWN:case pu.PAGE_UP:case pu.PAUSE:case pu.PRINT_SCREEN:case pu.RIGHT:case pu.SHIFT:case pu.UP:case pu.WIN_KEY:case pu.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=pu.ZERO&&e<=pu.NINE||e>=pu.NUM_ZERO&&e<=pu.NUM_MULTIPLY||e>=pu.A&&e<=pu.Z||window.navigator.userAgent.indexOf(`WebKit`)!==-1&&e===0)return!0;switch(e){case pu.SPACE:case pu.QUESTION_MARK:case pu.NUM_PLUS:case pu.NUM_MINUS:case pu.NUM_PERIOD:case pu.NUM_DIVISION:case pu.SEMICOLON:case pu.DASH:case pu.EQUALS:case pu.COMMA:case pu.PERIOD:case pu.SLASH:case pu.APOSTROPHE:case pu.SINGLE_QUOTE:case pu.OPEN_SQUARE_BRACKET:case pu.BACKSLASH:case pu.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}},mu=pu;function hu(){return hu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hu.apply(this,arguments)}var gu=y.forwardRef((e,t)=>{let{prefixCls:n,style:r,className:i,duration:a=4.5,showProgress:o,pauseOnHover:s=!0,eventKey:c,content:l,closable:u,props:d,onClick:f,onNoticeClose:p,times:m,hovering:h}=e,[g,_]=y.useState(!1),[v,b]=y.useState(0),[x,S]=y.useState(0),C=h||g,w=typeof a==`number`?a:0,T=w>0&&o,E=()=>{p(c)},D=e=>{(e.key===`Enter`||e.code===`Enter`||e.keyCode===mu.ENTER)&&E()};y.useEffect(()=>{if(!C&&w>0){let e=Date.now()-x,t=setTimeout(()=>{E()},w*1e3-x);return()=>{s&&clearTimeout(t),S(Date.now()-e)}}},[w,C,m]),y.useEffect(()=>{if(!C&&T&&(s||x===0)){let e=performance.now(),t,n=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(t=>{let r=t+x-e,i=Math.min(r/(w*1e3),1);b(i*100),i<1&&n()})};return n(),()=>{s&&cancelAnimationFrame(t)}}},[w,x,C,T,m]);let O=y.useMemo(()=>typeof u==`object`&&u?u:{},[u]),k=Gs(O,!0),A=100-(!v||v<0?0:v>100?100:v),j=`${n}-notice`;return y.createElement(`div`,hu({},d,{ref:t,className:F(j,i,{[`${j}-closable`]:u}),style:r,onMouseEnter:e=>{_(!0),d?.onMouseEnter?.(e)},onMouseLeave:e=>{_(!1),d?.onMouseLeave?.(e)},onClick:f}),y.createElement(`div`,{className:`${j}-content`},l),u&&y.createElement(`button`,hu({className:`${j}-close`,onKeyDown:D,"aria-label":`Close`},k,{onClick:e=>{e.preventDefault(),e.stopPropagation(),E()}}),O.closeIcon??`x`),T&&y.createElement(`progress`,{className:`${j}-progress`,max:`100`,value:A},A+`%`))});const _u=y.createContext({});var vu=({children:e,classNames:t})=>y.createElement(_u.Provider,{value:{classNames:t}},e),yu=8,bu=3,xu=16,Su=e=>{let t={offset:yu,threshold:bu,gap:xu};return e&&typeof e==`object`&&(t.offset=e.offset??yu,t.threshold=e.threshold??bu,t.gap=e.gap??xu),[!!e,t]};function Cu(){return Cu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cu.apply(this,arguments)}var wu=e=>{let{configList:t,placement:n,prefixCls:r,className:i,style:a,motion:o,onAllNoticeRemoved:s,onNoticeClose:c,stack:l}=e,{classNames:u}=(0,y.useContext)(_u),d=(0,y.useRef)({}),[f,p]=(0,y.useState)(null),[m,h]=(0,y.useState)([]),g=t.map(e=>({config:e,key:String(e.key)})),[_,{offset:v,threshold:b,gap:x}]=Su(l),S=_&&(m.length>0||g.length<=b),C=typeof o==`function`?o(n):o;return(0,y.useEffect)(()=>{_&&m.length>1&&h(e=>e.filter(e=>g.some(({key:t})=>e===t)))},[m,g,_]),(0,y.useEffect)(()=>{_&&d.current[g[g.length-1]?.key]&&p(d.current[g[g.length-1]?.key])},[g,_]),y.createElement(zs,Cu({key:n,className:F(r,`${r}-${n}`,u?.list,i,{[`${r}-stack`]:!!_,[`${r}-stack-expanded`]:S}),style:a,keys:g,motionAppear:!0},C,{onAllRemoved:()=>{s(n)}}),({config:e,className:t,style:i,index:a},o)=>{let{key:s,times:l}=e,p=String(s),{className:b,style:C,classNames:w,styles:T,...E}=e,D=g.findIndex(e=>e.key===p),O={};if(_){let e=g.length-1-(D>-1?D:a-1),t=n===`top`||n===`bottom`?`-50%`:`0`;if(e>0){O.height=S?d.current[p]?.offsetHeight:f?.offsetHeight;let r=0;for(let t=0;t<e;t++)r+=d.current[g[g.length-1-t].key]?.offsetHeight+x;O.transform=`translate3d(${t}, ${(S?r:e*v)*(n.startsWith(`top`)?1:-1)}px, 0) scaleX(${!S&&f?.offsetWidth&&d.current[p]?.offsetWidth?(f?.offsetWidth-v*2*(e<3?e:3))/d.current[p]?.offsetWidth:1})`}else O.transform=`translate3d(${t}, 0, 0)`}return y.createElement(`div`,{ref:o,className:F(`${r}-notice-wrapper`,t,w?.wrapper),style:{...i,...O,...T?.wrapper},onMouseEnter:()=>h(e=>e.includes(p)?e:[...e,p]),onMouseLeave:()=>h(e=>e.filter(e=>e!==p))},y.createElement(gu,Cu({},E,{ref:e=>{D>-1?d.current[p]=e:delete d.current[p]},prefixCls:r,classNames:w,styles:T,className:F(b,u?.notice),style:C,times:l,key:s,eventKey:s,onNoticeClose:c,hovering:_&&m.length>0})))})},Tu=h(),Eu=y.forwardRef((e,t)=>{let{prefixCls:n=`rc-notification`,container:r,motion:i,maxCount:a,className:o,style:s,onAllRemoved:c,stack:l,renderNotifications:u}=e,[d,f]=y.useState([]),p=e=>{let t=d.find(t=>t.key===e),n=t?.closable,{onClose:r}=n&&typeof n==`object`?n:{};r?.(),t?.onClose?.(),f(t=>t.filter(t=>t.key!==e))};y.useImperativeHandle(t,()=>({open:e=>{f(t=>{let n=[...t],r=n.findIndex(t=>t.key===e.key),i={...e};return r>=0?(i.times=(t[r]?.times||0)+1,n[r]=i):(i.times=0,n.push(i)),a>0&&n.length>a&&(n=n.slice(-a)),n})},close:e=>{p(e)},destroy:()=>{f([])}}));let[m,h]=y.useState({});y.useEffect(()=>{let e={};d.forEach(t=>{let{placement:n=`topRight`}=t;n&&(e[n]=e[n]||[],e[n].push(t))}),Object.keys(m).forEach(t=>{e[t]=e[t]||[]}),h(e)},[d]);let g=e=>{h(t=>{let n={...t};return(n[e]||[]).length||delete n[e],n})},_=y.useRef(!1);if(y.useEffect(()=>{Object.keys(m).length>0?_.current=!0:_.current&&=(c?.(),!1)},[m]),!r)return null;let v=Object.keys(m);return(0,Tu.createPortal)(y.createElement(y.Fragment,null,v.map(e=>{let t=m[e],r=y.createElement(wu,{key:e,configList:t,placement:e,prefixCls:n,className:o?.(e),style:s?.(e),motion:i,onNoticeClose:p,onAllNoticeRemoved:g,stack:l});return u?u(r,{prefixCls:n,key:e}):r})),r)}),Du=()=>document.body,Ou=0;function ku(...e){let t={};return e.forEach(e=>{e&&Object.keys(e).forEach(n=>{let r=e[n];r!==void 0&&(t[n]=r)})}),t}function Au(e={}){let{getContainer:t=Du,motion:n,prefixCls:r,maxCount:i,className:a,style:o,onAllRemoved:s,stack:c,renderNotifications:l,...u}=e,[d,f]=y.useState(),p=y.useRef(),m=y.createElement(Eu,{container:d,ref:p,prefixCls:r,motion:n,maxCount:i,className:a,style:o,onAllRemoved:s,stack:c,renderNotifications:l}),[h,g]=y.useState([]),_=x(e=>{let t=ku(u,e);(t.key===null||t.key===void 0)&&(t.key=`rc-notification-${Ou}`,Ou+=1),g(e=>[...e,{type:`open`,config:t}])}),v=y.useMemo(()=>({open:_,close:e=>{g(t=>[...t,{type:`close`,key:e}])},destroy:()=>{g(e=>[...e,{type:`destroy`}])}}),[]);return y.useEffect(()=>{f(t())}),y.useEffect(()=>{if(p.current&&h.length){h.forEach(e=>{switch(e.type){case`open`:p.current.open(e.config);break;case`close`:p.current.close(e.key);break;case`destroy`:p.current.destroy();break}});let e,t;g(n=>((e!==n||!t)&&(e=n,t=n.filter(e=>!h.includes(e))),t))}},[h]),[v,m]}var ju={icon:{tag:`svg`,attrs:{viewBox:`0 0 1024 1024`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z`}}]},name:`loading`,theme:`outlined`};function Mu(){return Mu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mu.apply(this,arguments)}var Nu=y.forwardRef((e,t)=>y.createElement(Bo,Mu({},e,{ref:t,icon:ju}))),Pu=e=>{let{componentCls:t,iconCls:n,boxShadow:r,colorText:i,colorSuccess:a,colorError:o,colorWarning:s,colorInfo:c,fontSizeLG:l,motionEaseInOutCirc:u,motionDurationSlow:d,marginXS:f,paddingXS:p,borderRadiusLG:m,zIndexPopup:h,contentPadding:g,contentBg:_}=e,v=`${t}-notice`,y=new Br(`MessageMoveIn`,{"0%":{padding:0,transform:`translateY(-100%)`,opacity:0},"100%":{padding:p,transform:`translateY(0)`,opacity:1}}),b=new Br(`MessageMoveOut`,{"0%":{maxHeight:e.height,padding:p,opacity:1},"100%":{maxHeight:0,padding:0,opacity:0}}),x={padding:p,textAlign:`center`,[`${t}-custom-content`]:{display:`flex`,alignItems:`center`},[`${t}-custom-content > ${n}`]:{marginInlineEnd:f,fontSize:l},[`${v}-content`]:{display:`inline-block`,padding:g,background:_,borderRadius:m,boxShadow:r,pointerEvents:`all`},[`${t}-success > ${n}`]:{color:a},[`${t}-error > ${n}`]:{color:o},[`${t}-warning > ${n}`]:{color:s},[`${t}-info > ${n},
      ${t}-loading > ${n}`]:{color:c}};return[{[t]:{...no(e),color:i,position:`fixed`,top:f,width:`100%`,pointerEvents:`none`,zIndex:h,[`${t}-move-up`]:{animationFillMode:`forwards`},[`
        ${t}-move-up-appear,
        ${t}-move-up-enter
      `]:{animationName:y,animationDuration:d,animationPlayState:`paused`,animationTimingFunction:u},[`
        ${t}-move-up-appear${t}-move-up-appear-active,
        ${t}-move-up-enter${t}-move-up-enter-active
      `]:{animationPlayState:`running`},[`${t}-move-up-leave`]:{animationName:b,animationDuration:d,animationPlayState:`paused`,animationTimingFunction:u},[`${t}-move-up-leave${t}-move-up-leave-active`]:{animationPlayState:`running`},"&-rtl":{direction:`rtl`,span:{direction:`rtl`}}}},{[t]:{[`${v}-wrapper`]:{...x}}},{[`${t}-notice-pure-panel`]:{...x,padding:0,textAlign:`start`}}]},Fu=fo(`Message`,e=>Pu(yi(e,{height:150})),e=>({zIndexPopup:e.zIndexPopupBase+Rc+10,contentBg:e.colorBgElevated,contentPadding:`${(e.controlHeightLG-e.fontSize*e.lineHeight)/2}px ${e.paddingSM}px`}));const Iu={info:y.createElement(es,null),success:y.createElement(Ho,null),error:y.createElement(Go,null),warning:y.createElement(Zo,null),loading:y.createElement(Nu,null)},Lu=e=>{let{prefixCls:t,type:n,icon:r,children:i,classNames:a,styles:o}=e,s=Gc(r||n&&Iu[n],e=>{let t={...e?.style,...o?.icon};return{className:F(e.className,a?.icon),style:t}});return y.createElement(`div`,{className:F(`${t}-custom-content`,`${t}-${n}`)},s,y.createElement(`span`,{className:a?.content,style:o?.content},i))};function Ru(e,t){return{motionName:t??`${e}-move-up`}}function zu(e){let t,n=new Promise(n=>{t=e(()=>{n(!0)})}),r=()=>{t?.()};return r.then=(e,t)=>n.then(e,t),r.promise=n,r}var iee=8,aee=3,oee=({children:e,prefixCls:t})=>{let n=Kc(t),[r,i]=Fu(t,n);return y.createElement(vu,{classNames:{list:F(r,i,n)}},e)},Bu=(e,{prefixCls:t,key:n})=>y.createElement(oee,{prefixCls:t,key:n},e),Vu=y.forwardRef((e,t)=>{let{top:n,prefixCls:r,getContainer:i,maxCount:a,duration:o=aee,rtl:s,transitionName:c,onAllRemoved:l,pauseOnHover:u=!0}=e,{getPrefixCls:d,direction:f,getPopupContainer:p}=mt(`message`),{message:m}=y.useContext(dt),h=r||d(`message`),g=()=>({left:`50%`,transform:`translateX(-50%)`,top:n??iee}),_=()=>F({[`${h}-rtl`]:s??f===`rtl`}),v=()=>Ru(h,c),[b,x]=Nc([e?.classNames,m?.classNames],[e?.styles,m?.styles],{props:e}),[S,C]=Au({prefixCls:h,style:g,className:_,motion:v,closable:!1,duration:o,getContainer:()=>i?.()||p?.()||document.body,maxCount:a,onAllRemoved:l,renderNotifications:Bu,pauseOnHover:u});return y.useImperativeHandle(t,()=>({...S,prefixCls:h,message:m,classNames:b,styles:x})),C}),Hu=0;function Uu(e){let t=y.useRef(null);return Me(`Message`),[y.useMemo(()=>{let n=e=>{t.current?.close(e)},r=r=>{if(!t.current){let e=()=>{};return e.then=()=>{},e}let{open:i,prefixCls:a,message:o,classNames:s,styles:c}=t.current,l=o?.className||{},u=o?.style||{},d=o?.classNames||{},f=o?.styles||{},p=`${a}-notice`,{content:m,icon:h,type:g,key:_,className:v,style:b,onClose:x,classNames:S={},styles:C={},...w}=r,T=_;gc(T)||(Hu+=1,T=`antd-message-${Hu}`);let E={...e,...r},D=Mc(d,{props:E}),O=Mc(S,{props:E}),k=Mc(f,{props:E}),A=Mc(C,{props:E}),j=Dc(void 0,D,O,s),M=kc(k,A,c);return zu(e=>(i({...w,key:T,content:y.createElement(Lu,{prefixCls:a,type:g,icon:h,classNames:j,styles:M},m),placement:`top`,className:F({[`${p}-${g}`]:g},v,l,j.root),style:{...M.root,...u,...b},onClose:()=>{x?.(),e()}}),()=>{n(T)}))},i={open:r,destroy:e=>{e===void 0?t.current?.destroy():n(e)}};return[`info`,`success`,`warning`,`error`,`loading`].forEach(e=>{i[e]=(t,n,i)=>{let a;a=t&&typeof t==`object`&&`content`in t?t:{content:t};let o,s;return typeof n==`function`?s=n:(o=n,s=i),r({onClose:s,duration:o,...a,type:e})}}),i},[]),y.createElement(Vu,{key:`message-holder`,...e,ref:t})]}function Wu(e){return Uu(e)}var Gu=`__rc_react_root__`;function Ku(e,t){let n=t[Gu]||(0,v.createRoot)(t);n.render(e),t[Gu]=n}async function qu(e){return Promise.resolve().then(()=>{e[Gu]?.unmount(),delete e[Gu]})}var Ju=()=>({height:0,opacity:0}),Yu=e=>{let{scrollHeight:t}=e;return{height:t,opacity:1}},Xu=e=>({height:e?e.offsetHeight:0}),Zu=(e,t)=>t?.deadline===!0||t.propertyName===`height`,Qu=(e=`ant`)=>({motionName:`${e}-motion-collapse`,onAppearStart:Ju,onEnterStart:Ju,onAppearActive:Yu,onEnterActive:Yu,onLeaveStart:Xu,onLeaveActive:Ju,onAppearEnd:Zu,onEnterEnd:Zu,onLeaveEnd:Zu,motionDeadline:500}),$u=(e,t,n)=>n===void 0?`${e}-${t}`:n,ed=Qu,td=po(`Wave`,e=>{let{componentCls:t,colorPrimary:n}=e;return{[t]:{position:`absolute`,background:`transparent`,pointerEvents:`none`,boxSizing:`border-box`,color:`var(--wave-color, ${n})`,boxShadow:`0 0 0 0 currentcolor`,opacity:.2,"&.wave-motion-appear":{transition:[`box-shadow 0.4s ${e.motionEaseOutCirc}`,`opacity 2s ${e.motionEaseOutCirc}`].join(`,`),"&-active":{boxShadow:`0 0 0 6px currentcolor`,opacity:0},"&.wave-quick":{transition:[`box-shadow ${e.motionDurationSlow} ${e.motionEaseInOut}`,`opacity ${e.motionDurationSlow} ${e.motionEaseInOut}`].join(`,`)}}}}});const nd=`ant-wave-target`;function rd(e){return e&&typeof e==`string`&&e!==`#fff`&&e!==`#ffffff`&&e!==`rgb(255, 255, 255)`&&e!==`rgba(255, 255, 255, 1)`&&!/rgba\((?:\d*, ){3}0\)/.test(e)&&e!==`transparent`&&e!==`canvastext`}function see(e,t=null){let n=getComputedStyle(e),{borderTopColor:r,borderColor:i,backgroundColor:a}=n;return t&&rd(n[t])?n[t]:[r,i,a].find(rd)??null}function id(e){return Number.isNaN(e)?0:e}var ad=e=>{let{className:t,target:n,component:r,colorSource:i}=e,a=y.useRef(null),[o,s]=y.useState(null),[c,l]=y.useState([]),[u,d]=y.useState(0),[f,p]=y.useState(0),[m,h]=y.useState(0),[g,_]=y.useState(0),[v,b]=y.useState(!1),x={left:u,top:f,width:m,height:g,borderRadius:c.map(e=>`${e}px`).join(` `)};o&&(x[`--wave-color`]=o);function S(){let e=getComputedStyle(n);s(see(n,i));let t=e.position===`static`,{borderLeftWidth:r,borderTopWidth:a}=e;d(t?n.offsetLeft:id(-Number.parseFloat(r))),p(t?n.offsetTop:id(-Number.parseFloat(a))),h(n.offsetWidth),_(n.offsetHeight);let{borderTopLeftRadius:o,borderTopRightRadius:c,borderBottomLeftRadius:u,borderBottomRightRadius:f}=e;l([o,c,f,u].map(e=>id(Number.parseFloat(e))))}if(y.useEffect(()=>{if(n){let e=lt(()=>{S(),b(!0)}),t;return typeof ResizeObserver<`u`&&(t=new ResizeObserver(S),t.observe(n)),()=>{lt.cancel(e),t?.disconnect()}}},[n]),!v)return null;let C=(r===`Checkbox`||r===`Radio`)&&n?.classList.contains(nd);return y.createElement(Bs,{visible:!0,motionAppear:!0,motionName:`wave-motion`,motionDeadline:5e3,onAppearEnd:(e,t)=>{if(t.deadline||t.propertyName===`opacity`){let e=a.current?.parentElement;qu(e).then(()=>{e?.remove()})}return!1}},({className:e},n)=>y.createElement(`div`,{ref:ie(a,n),className:F(t,e,{"wave-quick":C}),style:x}))},od=(e,t)=>{let{component:n}=t;if(n===`Checkbox`&&!e.querySelector(`input`)?.checked)return;let r=document.createElement(`div`);r.style.position=`absolute`,r.style.left=`0px`,r.style.top=`0px`,e?.insertBefore(r,e?.firstChild),Ku(y.createElement(ad,{...t,target:e}),r)},sd=(e,t,n,r)=>{let{wave:i}=y.useContext(dt),[,a,o]=eo(),s=x(s=>{let c=e.current;if(i?.disabled||!c)return;let l=c.querySelector(`.${nd}`)||c,{showEffect:u}=i||{};(u||od)(l,{className:t,token:a,component:n,event:s,hashId:o,colorSource:r})}),c=y.useRef(null);return y.useEffect(()=>()=>{lt.cancel(c.current)},[]),e=>{lt.cancel(c.current),c.current=lt(()=>{s(e)})}},cd=e=>{let{children:t,disabled:n,component:r,colorSource:i}=e,{getPrefixCls:a}=(0,y.useContext)(dt),o=(0,y.useRef)(null),s=a(`wave`),[,c]=td(s),l=sd(o,F(s,c),r,i);return y.useEffect(()=>{let e=o.current;if(!e||e.nodeType!==window.Node.ELEMENT_NODE||n)return;let t=t=>{!Cl(t.target)||!e.getAttribute||e.getAttribute(`disabled`)||e.disabled||e.className.includes(`disabled`)&&!e.className.includes(`disabled:`)||e.getAttribute(`aria-disabled`)===`true`||e.className.includes(`-leave`)||l(t)};return e.addEventListener(`click`,t,!0),()=>{e.removeEventListener(`click`,t,!0)}},[n]),y.isValidElement(t)?Gc(t,{ref:oe(t)?ie(ce(t),o):o}):t??null},ld=e=>{let t=y.useContext(tu);return y.useMemo(()=>e?typeof e==`string`?e??t:typeof e==`function`?e(t):t:t,[e,t])},ud=e=>{let{componentCls:t}=e;return{[t]:{display:`inline-flex`,"&-block":{display:`flex`,width:`100%`},"&-vertical":{flexDirection:`column`},"&-rtl":{direction:`rtl`}}}},dd=fo([`Space`,`Compact`],e=>[ud(e)],()=>({}),{resetStyle:!1});const fd=y.createContext(null),pd=(e,t)=>{let n=y.useContext(fd),r=y.useMemo(()=>{if(!n)return``;let{compactDirection:r,isFirstItem:i,isLastItem:a}=n,o=r===`vertical`?`-vertical-`:`-`;return F(`${e}-compact${o}item`,{[`${e}-compact${o}first-item`]:i,[`${e}-compact${o}last-item`]:a,[`${e}-compact${o}item-rtl`]:t===`rtl`})},[e,t,n]);return{compactSize:n?.compactSize,compactDirection:n?.compactDirection,compactItemClassnames:r}},md=e=>{let{children:t}=e;return y.createElement(fd.Provider,{value:null},t)};var hd=e=>{let{children:t,...n}=e;return y.createElement(fd.Provider,{value:y.useMemo(()=>n,[n])},t)},gd=e=>{let{getPrefixCls:t,direction:n}=y.useContext(dt),{size:r,direction:i,orientation:a,block:o,prefixCls:s,className:c,rootClassName:l,children:u,vertical:d,...f}=e,[p,m]=Fc(a,d,i),h=ld(e=>r??e),g=t(`space-compact`,s),[_]=dd(g),v=F(g,_,{[`${g}-rtl`]:n===`rtl`,[`${g}-block`]:o,[`${g}-vertical`]:m},c,l),b=y.useContext(fd),x=Oe(u),S=y.useMemo(()=>x.map((e,t)=>{let n=e?.key||`${g}-item-${t}`;return y.createElement(hd,{key:n,compactSize:h,compactDirection:p,isFirstItem:t===0&&(!b||b?.isFirstItem),isLastItem:t===x.length-1&&(!b||b?.isLastItem)},e)}),[x,b,p,h,g]);return x.length===0?null:y.createElement(`div`,{className:v,...f},S)};const _d=y.createContext(void 0);var vd=e=>{let{getPrefixCls:t,direction:n}=y.useContext(dt),{prefixCls:r,size:i,className:a,...o}=e,s=t(`btn-group`,r),[,,c]=eo(),l=y.useMemo(()=>{switch(i){case`large`:return`lg`;case`small`:return`sm`;default:return``}},[i]),u=F(s,{[`${s}-${l}`]:l,[`${s}-rtl`]:n===`rtl`},a,c);return y.createElement(_d.Provider,{value:i},y.createElement(`div`,{...o,className:u}))},yd=/^[\u4E00-\u9FA5]{2}$/;const bd=yd.test.bind(yd);function xd(e){return e===`danger`?{danger:!0}:{type:e}}function Sd(e){return typeof e==`string`}function Cd(e){return e===`text`||e===`link`}function wd(e,t,n,r){if(!gc(e)||e===``)return;let i=t?` `:``;return typeof e!=`string`&&typeof e!=`number`&&Sd(e.type)&&bd(e.props.children)?Gc(e,e=>({...e,children:e.children.split(``).join(i),className:r,style:n})):Sd(e)?y.createElement(`span`,{className:r,style:n},bd(e)?e.split(``).join(i):e):Uc(e)?y.createElement(`span`,{className:r,style:n},e):Gc(e,e=>({...e,className:F(e.className,r)||void 0,style:{...e.style,...n}}))}function Td(e,t,n,r){let i=!1,a=[];return y.Children.forEach(e,e=>{let t=typeof e,n=t===`string`||t===`number`;if(i&&n){let t=a.length-1;a[t]=`${a[t]}${e}`}else a.push(e);i=n}),y.Children.map(a,e=>wd(e,t,n,r))}[`default`,`primary`,`danger`].concat(nt(Pi));var Ed=(0,y.forwardRef)((e,t)=>{let{className:n,style:r,children:i,prefixCls:a}=e,o=F(`${a}-icon`,n);return y.createElement(`span`,{ref:t,className:o,style:r},i)}),Dd=(0,y.forwardRef)((e,t)=>{let{prefixCls:n,className:r,style:i,iconClassName:a}=e,o=F(`${n}-loading-icon`,r);return y.createElement(Ed,{prefixCls:n,className:o,style:i,ref:t},y.createElement(Nu,{className:a}))}),Od=()=>({width:0,opacity:0,transform:`scale(0)`}),kd=e=>({width:e.scrollWidth,opacity:1,transform:`scale(1)`}),Ad=e=>{let{prefixCls:t,loading:n,existIcon:r,className:i,style:a,mount:o}=e,s=!!n;return r?y.createElement(Dd,{prefixCls:t,className:i,style:a}):y.createElement(Bs,{visible:s,motionName:`${t}-loading-icon-motion`,motionAppear:!o,motionEnter:!o,motionLeave:!o,removeOnLeave:!0,onAppearStart:Od,onAppearActive:kd,onEnterStart:Od,onEnterActive:kd,onLeaveStart:kd,onLeaveActive:Od},({className:e,style:n},r)=>{let o={...a,...n};return y.createElement(Dd,{prefixCls:t,className:F(i,e),style:o,ref:r})})},jd=(e,t)=>({[`> span, > ${e}`]:{"&:not(:last-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineEndColor:t}}},"&:not(:first-child)":{[`&, & > ${e}`]:{"&:not(:disabled)":{borderInlineStartColor:t}}}}}),Md=e=>{let{componentCls:t,fontSize:n,lineWidth:r,groupBorderColor:i,colorErrorHover:a}=e;return{[`${t}-group`]:[{position:`relative`,display:`inline-flex`,[`> span, > ${t}`]:{"&:not(:last-child)":{[`&, & > ${t}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:e.calc(r).mul(-1).equal(),[`&, & > ${t}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[t]:{position:`relative`,zIndex:1,"&:hover, &:focus, &:active":{zIndex:2},"&[disabled]":{zIndex:0}},[`${t}-icon-only`]:{fontSize:n}},jd(`${t}-primary`,i),jd(`${t}-danger`,a)]}};const Nd=e=>Math.round(Number(e||0));var Pd=e=>{if(e instanceof Gi)return e;if(e&&typeof e==`object`&&`h`in e&&`b`in e){let{b:t,...n}=e;return{...n,v:t}}return typeof e==`string`&&/hsb/.test(e)?e.replace(/hsb/,`hsv`):e},Fd=class extends Gi{constructor(e){super(Pd(e))}toHsbString(){let e=this.toHsb(),t=Nd(e.s*100),n=Nd(e.b*100),r=Nd(e.h),i=e.a,a=`hsb(${r}, ${t}%, ${n}%)`,o=`hsba(${r}, ${t}%, ${n}%, ${i.toFixed(i===0?0:2)})`;return i===1?a:o}toHsb(){let{v:e,...t}=this.toHsv();return{...t,b:e,a:this.a}}};(e=>e instanceof Fd?e:new Fd(e))(`#1677ff`);const Id=(e,t)=>e?.replace(/[^\w/]/g,``).slice(0,t?8:6)||``,Ld=(e,t)=>e?Id(e,t):``;let Rd=function(){function e(t){if(Zr(this,e),this.cleared=!1,t instanceof e){this.metaColor=t.metaColor.clone(),this.colors=t.colors?.map(t=>({color:new e(t.color),percent:t.percent})),this.cleared=t.cleared;return}let n=Array.isArray(t);n&&t.length?(this.colors=t.map(({color:t,percent:n})=>({color:new e(t),percent:n})),this.metaColor=new Fd(this.colors[0].color.metaColor)):this.metaColor=new Fd(n?``:t),(!t||n&&!this.colors)&&(this.metaColor=this.metaColor.setA(0),this.cleared=!0)}return $r(e,[{key:`toHsb`,value:function(){return this.metaColor.toHsb()}},{key:`toHsbString`,value:function(){return this.metaColor.toHsbString()}},{key:`toHex`,value:function(){return Ld(this.toHexString(),this.metaColor.a<1)}},{key:`toHexString`,value:function(){return this.metaColor.toHexString()}},{key:`toRgb`,value:function(){return this.metaColor.toRgb()}},{key:`toRgbString`,value:function(){return this.metaColor.toRgbString()}},{key:`isGradient`,value:function(){return!!this.colors&&!this.cleared}},{key:`getColors`,value:function(){return this.colors||[{color:this,percent:0}]}},{key:`toCssString`,value:function(){let{colors:e}=this;return e?`linear-gradient(90deg, ${e.map(e=>`${e.color.toRgbString()} ${e.percent}%`).join(`, `)})`:this.metaColor.toRgbString()}},{key:`equals`,value:function(e){return!e||this.isGradient()!==e.isGradient()?!1:this.isGradient()?this.colors.length===e.colors.length&&this.colors.every((t,n)=>{let r=e.colors[n];return t.percent===r.percent&&t.color.equals(r.color)}):this.toHexString()===e.toHexString()}}])}();var zd={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z`}}]},name:`right`,theme:`outlined`};function Bd(){return Bd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Bd.apply(this,arguments)}var Vd=y.forwardRef((e,t)=>y.createElement(Bo,Bd({},e,{ref:t,icon:zd})));function Hd(){return Hd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hd.apply(null,arguments)}var Ud=e=>({[e.componentCls]:{[`${e.antCls}-motion-collapse-legacy`]:{overflow:`hidden`,"&-active":{transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}},[`${e.antCls}-motion-collapse`]:{overflow:`hidden`,transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}}}),Wd=e=>({animationDuration:e,animationFillMode:`both`}),Gd=e=>({animationDuration:e,animationFillMode:`both`});const Kd=(e,t,n,r,i=!1)=>{let a=i?`&`:``;return{[`
      ${a}${e}-enter,
      ${a}${e}-appear
    `]:{...Wd(r),animationPlayState:`paused`},[`${a}${e}-leave`]:{...Gd(r),animationPlayState:`paused`},[`
      ${a}${e}-enter${e}-enter-active,
      ${a}${e}-appear${e}-appear-active
    `]:{animationName:t,animationPlayState:`running`},[`${a}${e}-leave${e}-leave-active`]:{animationName:n,animationPlayState:`running`,pointerEvents:`none`}}},qd=new Br(`antFadeIn`,{"0%":{opacity:0},"100%":{opacity:1}}),Jd=new Br(`antFadeOut`,{"0%":{opacity:1},"100%":{opacity:0}}),Yd=(e,t=!1)=>{let{antCls:n}=e,r=`${n}-fade`,i=t?`&`:``;return[Kd(r,qd,Jd,e.motionDurationMid,t),{[`
        ${i}${r}-enter,
        ${i}${r}-appear
      `]:{opacity:0,animationTimingFunction:`linear`},[`${i}${r}-leave`]:{animationTimingFunction:`linear`}}]},Xd=new Br(`antMoveDownIn`,{"0%":{transform:`translate3d(0, 100%, 0)`,transformOrigin:`0 0`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1}}),Zd=new Br(`antMoveDownOut`,{"0%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1},"100%":{transform:`translate3d(0, 100%, 0)`,transformOrigin:`0 0`,opacity:0}}),Qd=new Br(`antMoveLeftIn`,{"0%":{transform:`translate3d(-100%, 0, 0)`,transformOrigin:`0 0`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1}}),$d=new Br(`antMoveLeftOut`,{"0%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1},"100%":{transform:`translate3d(-100%, 0, 0)`,transformOrigin:`0 0`,opacity:0}}),ef=new Br(`antMoveRightIn`,{"0%":{transform:`translate3d(100%, 0, 0)`,transformOrigin:`0 0`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1}}),cee=new Br(`antMoveRightOut`,{"0%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1},"100%":{transform:`translate3d(100%, 0, 0)`,transformOrigin:`0 0`,opacity:0}}),tf=new Br(`antMoveUpIn`,{"0%":{transform:`translate3d(0, -100%, 0)`,transformOrigin:`0 0`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1}}),lee=new Br(`antMoveUpOut`,{"0%":{transform:`translate3d(0, 0, 0)`,transformOrigin:`0 0`,opacity:1},"100%":{transform:`translate3d(0, -100%, 0)`,transformOrigin:`0 0`,opacity:0}});var nf={"move-up":{inKeyframes:tf,outKeyframes:lee},"move-down":{inKeyframes:Xd,outKeyframes:Zd},"move-left":{inKeyframes:Qd,outKeyframes:$d},"move-right":{inKeyframes:ef,outKeyframes:cee}};const rf=(e,t)=>{let{antCls:n}=e,r=`${n}-${t}`,{inKeyframes:i,outKeyframes:a}=nf[t];return[Kd(r,i,a,e.motionDurationMid),{[`
        ${r}-enter,
        ${r}-appear
      `]:{opacity:0,animationTimingFunction:e.motionEaseOutCirc},[`${r}-leave`]:{animationTimingFunction:e.motionEaseInOutCirc}}]},af=new Br(`antSlideUpIn`,{"0%":{transform:`scaleY(0.8)`,transformOrigin:`0% 0%`,opacity:0},"100%":{transform:`scaleY(1)`,transformOrigin:`0% 0%`,opacity:1}}),of=new Br(`antSlideUpOut`,{"0%":{transform:`scaleY(1)`,transformOrigin:`0% 0%`,opacity:1},"100%":{transform:`scaleY(0.8)`,transformOrigin:`0% 0%`,opacity:0}}),sf=new Br(`antSlideDownIn`,{"0%":{transform:`scaleY(0.8)`,transformOrigin:`100% 100%`,opacity:0},"100%":{transform:`scaleY(1)`,transformOrigin:`100% 100%`,opacity:1}}),cf=new Br(`antSlideDownOut`,{"0%":{transform:`scaleY(1)`,transformOrigin:`100% 100%`,opacity:1},"100%":{transform:`scaleY(0.8)`,transformOrigin:`100% 100%`,opacity:0}}),lf=new Br(`antSlideLeftIn`,{"0%":{transform:`scaleX(0.8)`,transformOrigin:`0% 0%`,opacity:0},"100%":{transform:`scaleX(1)`,transformOrigin:`0% 0%`,opacity:1}}),uf=new Br(`antSlideLeftOut`,{"0%":{transform:`scaleX(1)`,transformOrigin:`0% 0%`,opacity:1},"100%":{transform:`scaleX(0.8)`,transformOrigin:`0% 0%`,opacity:0}}),df=new Br(`antSlideRightIn`,{"0%":{transform:`scaleX(0.8)`,transformOrigin:`100% 0%`,opacity:0},"100%":{transform:`scaleX(1)`,transformOrigin:`100% 0%`,opacity:1}}),ff=new Br(`antSlideRightOut`,{"0%":{transform:`scaleX(1)`,transformOrigin:`100% 0%`,opacity:1},"100%":{transform:`scaleX(0.8)`,transformOrigin:`100% 0%`,opacity:0}});var pf={"slide-up":{inKeyframes:af,outKeyframes:of},"slide-down":{inKeyframes:sf,outKeyframes:cf},"slide-left":{inKeyframes:lf,outKeyframes:uf},"slide-right":{inKeyframes:df,outKeyframes:ff}};const mf=(e,t)=>{let{antCls:n}=e,r=`${n}-${t}`,{inKeyframes:i,outKeyframes:a}=pf[t];return[Kd(r,i,a,e.motionDurationMid),{[`
      ${r}-enter,
      ${r}-appear
    `]:{transform:`scale(0)`,transformOrigin:`0% 0%`,opacity:0,animationTimingFunction:e.motionEaseOutQuint,"&-prepare":{transform:`scale(1)`}},[`${r}-leave`]:{animationTimingFunction:e.motionEaseInQuint}}]},hf=new Br(`antZoomIn`,{"0%":{transform:`scale(0.2)`,opacity:0},"100%":{transform:`scale(1)`,opacity:1}}),gf=new Br(`antZoomOut`,{"0%":{transform:`scale(1)`},"100%":{transform:`scale(0.2)`,opacity:0}}),_f=new Br(`antZoomBigIn`,{"0%":{transform:`scale(0.8)`,opacity:0},"100%":{transform:`scale(1)`,opacity:1}}),vf=new Br(`antZoomBigOut`,{"0%":{transform:`scale(1)`},"100%":{transform:`scale(0.8)`,opacity:0}}),yf=new Br(`antZoomUpIn`,{"0%":{transform:`scale(0.8)`,transformOrigin:`50% 0%`,opacity:0},"100%":{transform:`scale(1)`,transformOrigin:`50% 0%`}}),bf=new Br(`antZoomUpOut`,{"0%":{transform:`scale(1)`,transformOrigin:`50% 0%`},"100%":{transform:`scale(0.8)`,transformOrigin:`50% 0%`,opacity:0}}),xf=new Br(`antZoomLeftIn`,{"0%":{transform:`scale(0.8)`,transformOrigin:`0% 50%`,opacity:0},"100%":{transform:`scale(1)`,transformOrigin:`0% 50%`}}),Sf=new Br(`antZoomLeftOut`,{"0%":{transform:`scale(1)`,transformOrigin:`0% 50%`},"100%":{transform:`scale(0.8)`,transformOrigin:`0% 50%`,opacity:0}}),Cf=new Br(`antZoomRightIn`,{"0%":{transform:`scale(0.8)`,transformOrigin:`100% 50%`,opacity:0},"100%":{transform:`scale(1)`,transformOrigin:`100% 50%`}}),wf=new Br(`antZoomRightOut`,{"0%":{transform:`scale(1)`,transformOrigin:`100% 50%`},"100%":{transform:`scale(0.8)`,transformOrigin:`100% 50%`,opacity:0}}),Tf=new Br(`antZoomDownIn`,{"0%":{transform:`scale(0.8)`,transformOrigin:`50% 100%`,opacity:0},"100%":{transform:`scale(1)`,transformOrigin:`50% 100%`}}),Ef=new Br(`antZoomDownOut`,{"0%":{transform:`scale(1)`,transformOrigin:`50% 100%`},"100%":{transform:`scale(0.8)`,transformOrigin:`50% 100%`,opacity:0}});var Df={zoom:{inKeyframes:hf,outKeyframes:gf},"zoom-big":{inKeyframes:_f,outKeyframes:vf},"zoom-big-fast":{inKeyframes:_f,outKeyframes:vf},"zoom-left":{inKeyframes:xf,outKeyframes:Sf},"zoom-right":{inKeyframes:Cf,outKeyframes:wf},"zoom-up":{inKeyframes:yf,outKeyframes:bf},"zoom-down":{inKeyframes:Tf,outKeyframes:Ef}};const Of=(e,t)=>{let{antCls:n}=e,r=`${n}-${t}`,{inKeyframes:i,outKeyframes:a}=Df[t];return[Kd(r,i,a,t===`zoom-big-fast`?e.motionDurationFast:e.motionDurationMid),{[`
        ${r}-enter,
        ${r}-appear
      `]:{transform:`scale(0)`,opacity:0,animationTimingFunction:e.motionEaseOutCirc,"&-prepare":{transform:`none`}},[`${r}-leave`]:{animationTimingFunction:e.motionEaseInOutCirc}}]},kf=e=>e instanceof Rd?e:new Rd(e),Af=(e,t)=>{let{r:n,g:r,b:i,a}=e.toRgb(),o=new Fd(e.toRgbString()).onBackground(t).toHsv();return a<=.5?o.v>.5:n*.299+r*.587+i*.114>192},jf=e=>{let{paddingInline:t,onlyIconSize:n,borderColorDisabled:r}=e;return yi(e,{buttonPaddingHorizontal:t,buttonPaddingVertical:0,buttonIconOnlyFontSize:n,colorBorderDisabled:r})},Mf=e=>{let t=e.contentFontSize??e.fontSize,n=e.contentFontSizeSM??e.fontSize,r=e.contentFontSizeLG??e.fontSizeLG,i=e.contentLineHeight??Fi(t),a=e.contentLineHeightSM??Fi(n),o=e.contentLineHeightLG??Fi(r),s=Af(new Rd(e.colorBgSolid),`#fff`)?`#000`:`#fff`,c=Pi.reduce((t,n)=>({...t,[`${n}ShadowColor`]:`0 ${tn(e.controlOutlineWidth)} 0 ${Ja(e[`${n}1`],e.colorBgContainer)}`}),{}),l=e.colorBgContainerDisabled,u=e.colorBgContainerDisabled;return{...c,fontWeight:400,iconGap:e.marginXS,defaultShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlTmpOutline}`,primaryShadow:`0 ${e.controlOutlineWidth}px 0 ${e.controlOutline}`,dangerShadow:`0 ${e.controlOutlineWidth}px 0 ${e.colorErrorOutline}`,primaryColor:e.colorTextLightSolid,dangerColor:e.colorTextLightSolid,borderColorDisabled:e.colorBorderDisabled,defaultGhostColor:e.colorBgContainer,ghostBg:`transparent`,defaultGhostBorderColor:e.colorBgContainer,paddingInline:e.paddingContentHorizontal-e.lineWidth,paddingInlineLG:e.paddingContentHorizontal-e.lineWidth,paddingInlineSM:8-e.lineWidth,onlyIconSize:`inherit`,onlyIconSizeSM:`inherit`,onlyIconSizeLG:`inherit`,groupBorderColor:e.colorPrimaryHover,linkHoverBg:`transparent`,textTextColor:e.colorText,textTextHoverColor:e.colorText,textTextActiveColor:e.colorText,textHoverBg:e.colorFillTertiary,defaultColor:e.colorText,defaultBg:e.colorBgContainer,defaultBorderColor:e.colorBorder,defaultBorderColorDisabled:e.colorBorder,defaultHoverBg:e.colorBgContainer,defaultHoverColor:e.colorPrimaryHover,defaultHoverBorderColor:e.colorPrimaryHover,defaultActiveBg:e.colorBgContainer,defaultActiveColor:e.colorPrimaryActive,defaultActiveBorderColor:e.colorPrimaryActive,solidTextColor:s,contentFontSize:t,contentFontSizeSM:n,contentFontSizeLG:r,contentLineHeight:i,contentLineHeightSM:a,contentLineHeightLG:o,paddingBlock:Math.max((e.controlHeight-t*i)/2-e.lineWidth,0),paddingBlockSM:Math.max((e.controlHeightSM-n*a)/2-e.lineWidth,0),paddingBlockLG:Math.max((e.controlHeightLG-r*o)/2-e.lineWidth,0),defaultBgDisabled:l,dashedBgDisabled:u}};var uee=e=>{let{componentCls:t,antCls:n}=e,r=ho(n,`btn`);return{[t]:[{[r(`border-width`)]:`1px`,[r(`border-color`)]:`#000`,[r(`border-color-hover`)]:`var(${r(`border-color`)})`,[r(`border-color-active`)]:`var(${r(`border-color`)})`,[r(`border-color-disabled`)]:`var(${r(`border-color`)})`,[r(`border-style`)]:`solid`,[r(`text-color`)]:`#000`,[r(`text-color-hover`)]:`var(${r(`text-color`)})`,[r(`text-color-active`)]:`var(${r(`text-color`)})`,[r(`text-color-disabled`)]:`var(${r(`text-color`)})`,[r(`bg-color`)]:`#ddd`,[r(`bg-color-hover`)]:`var(${r(`bg-color`)})`,[r(`bg-color-active`)]:`var(${r(`bg-color`)})`,[r(`bg-color-disabled`)]:e.colorBgContainerDisabled,[r(`bg-color-container`)]:e.colorBgContainer,[r(`shadow`)]:`none`},{border:`var(${r(`border-width`)}) var(${r(`border-style`)}) var(${r(`border-color`)})`,color:`var(${r(`text-color`)})`,backgroundColor:`var(${r(`bg-color`)})`,[`&:not(:disabled):not(${t}-disabled)`]:{"&:hover":{border:`var(${r(`border-width`)}) var(${r(`border-style`)}) var(${r(`border-color-hover`)})`,color:`var(${r(`text-color-hover`)})`,backgroundColor:`var(${r(`bg-color-hover`)})`},"&:active":{border:`var(${r(`border-width`)}) var(${r(`border-style`)}) var(${r(`border-color-active`)})`,color:`var(${r(`text-color-active`)})`,backgroundColor:`var(${r(`bg-color-active`)})`}}},{[`&${t}-variant-solid`]:{[r(`solid-bg-color`)]:`var(${r(`color-base`)})`,[r(`solid-bg-color-hover`)]:`var(${r(`color-hover`)})`,[r(`solid-bg-color-active`)]:`var(${r(`color-active`)})`,[r(`border-color`)]:`transparent`,[r(`text-color`)]:e.colorTextLightSolid,[r(`bg-color`)]:`var(${r(`solid-bg-color`)})`,[r(`bg-color-hover`)]:`var(${r(`solid-bg-color-hover`)})`,[r(`bg-color-active`)]:`var(${r(`solid-bg-color-active`)})`,boxShadow:`var(${r(`shadow`)})`},[`&${t}-variant-outlined, &${t}-variant-dashed`]:{[r(`border-color`)]:`var(${r(`color-base`)})`,[r(`border-color-hover`)]:`var(${r(`color-hover`)})`,[r(`border-color-active`)]:`var(${r(`color-active`)})`,[r(`bg-color`)]:`var(${r(`bg-color-container`)})`,[r(`text-color`)]:`var(${r(`color-base`)})`,[r(`text-color-hover`)]:`var(${r(`color-hover`)})`,[r(`text-color-active`)]:`var(${r(`color-active`)})`,boxShadow:`var(${r(`shadow`)})`},[`&${t}-variant-dashed`]:{[r(`border-style`)]:`dashed`,[r(`bg-color-disabled`)]:e.dashedBgDisabled},[`&${t}-variant-filled`]:{[r(`border-color`)]:`transparent`,[r(`text-color`)]:`var(${r(`color-base`)})`,[r(`bg-color`)]:`var(${r(`color-light`)})`,[r(`bg-color-hover`)]:`var(${r(`color-light-hover`)})`,[r(`bg-color-active`)]:`var(${r(`color-light-active`)})`},[`&${t}-variant-text, &${t}-variant-link`]:{[r(`border-color`)]:`transparent`,[r(`text-color`)]:`var(${r(`color-base`)})`,[r(`text-color-hover`)]:`var(${r(`color-hover`)})`,[r(`text-color-active`)]:`var(${r(`color-active`)})`,[r(`bg-color`)]:`transparent`,[r(`bg-color-hover`)]:`transparent`,[r(`bg-color-active`)]:`transparent`,[`&:disabled, &${e.componentCls}-disabled`]:{background:`transparent`,borderColor:`transparent`}},[`&${t}-variant-text`]:{[r(`bg-color-hover`)]:`var(${r(`color-light`)})`,[r(`bg-color-active`)]:`var(${r(`color-light-active`)})`}},{[`&${t}-variant-link`]:{[r(`color-base`)]:e.colorLink,[r(`color-hover`)]:e.colorLinkHover,[r(`color-active`)]:e.colorLinkActive},[`&${t}-color-primary`]:{[r(`color-base`)]:e.colorPrimary,[r(`color-hover`)]:e.colorPrimaryHover,[r(`color-active`)]:e.colorPrimaryActive,[r(`color-light`)]:e.colorPrimaryBg,[r(`color-light-hover`)]:e.colorPrimaryBgHover,[r(`color-light-active`)]:e.colorPrimaryBorder,[r(`shadow`)]:e.primaryShadow,[`&${t}-variant-solid`]:{[r(`text-color`)]:e.primaryColor,[r(`text-color-hover`)]:`var(${r(`text-color`)})`,[r(`text-color-active`)]:`var(${r(`text-color`)})`}},[`&${t}-color-dangerous`]:{[r(`color-base`)]:e.colorError,[r(`color-hover`)]:e.colorErrorHover,[r(`color-active`)]:e.colorErrorActive,[r(`color-light`)]:e.colorErrorBg,[r(`color-light-hover`)]:e.colorErrorBgFilledHover,[r(`color-light-active`)]:e.colorErrorBgActive,[r(`shadow`)]:e.dangerShadow,[`&${t}-variant-solid`]:{[r(`text-color`)]:e.dangerColor,[r(`text-color-hover`)]:`var(${r(`text-color`)})`,[r(`text-color-active`)]:`var(${r(`text-color`)})`}},[`&${t}-color-default`]:{[r(`solid-bg-color`)]:e.colorBgSolid,[r(`solid-bg-color-hover`)]:e.colorBgSolidHover,[r(`solid-bg-color-active`)]:e.colorBgSolidActive,[r(`color-base`)]:e.defaultBorderColor,[r(`color-hover`)]:e.defaultHoverBorderColor,[r(`color-active`)]:e.defaultActiveBorderColor,[r(`color-light`)]:e.colorFillTertiary,[r(`color-light-hover`)]:e.colorFillSecondary,[r(`color-light-active`)]:e.colorFill,[r(`text-color`)]:e.colorText,[r(`text-color-hover`)]:e.defaultHoverBorderColor,[r(`text-color-active`)]:e.defaultActiveBorderColor,[r(`shadow`)]:e.defaultShadow,[`&${t}-variant-solid`]:{[r(`text-color`)]:e.solidTextColor,[r(`text-color-hover`)]:`var(${r(`text-color`)})`,[r(`text-color-active`)]:`var(${r(`text-color`)})`},[`&${t}-variant-filled, &${t}-variant-text`]:{[r(`text-color-hover`)]:`var(${r(`text-color`)})`,[r(`text-color-active`)]:`var(${r(`text-color`)})`},[`&${t}-variant-outlined, &${t}-variant-dashed`]:{[r(`bg-color-hover`)]:e.defaultHoverBg,[r(`bg-color-active`)]:e.defaultActiveBg},[`&${t}-background-ghost`]:{[`&${t}-variant-outlined, &${t}-variant-dashed`]:{[r(`text-color`)]:e.defaultGhostColor,[r(`border-color`)]:e.defaultGhostBorderColor}}}},Pi.map(n=>{let i=e[`${n}6`],a=e[`${n}1`],o=e[`${n}5`],s=e[`${n}2`],c=e[`${n}3`],l=e[`${n}7`],u=e[`${n}ShadowColor`];return{[`&${t}-color-${n}`]:{[r(`color-base`)]:i,[r(`color-hover`)]:o,[r(`color-active`)]:l,[r(`color-light`)]:a,[r(`color-light-hover`)]:s,[r(`color-light-active`)]:c,[r(`shadow`)]:u}}}),{[`&:disabled, &${e.componentCls}-disabled`]:{cursor:`not-allowed`,borderColor:e.colorBorderDisabled,background:`var(${r(`bg-color-disabled`)})`,color:e.colorTextDisabled,boxShadow:`none`}},{[`&${t}-background-ghost`]:{[r(`bg-color`)]:`transparent`,[r(`shadow`)]:`none`}}]}},dee=e=>{let{componentCls:t,iconCls:n,fontWeight:r,opacityLoading:i,motionDurationSlow:a,motionEaseInOut:o,iconGap:s,calc:c}=e;return{[t]:{outline:`none`,position:`relative`,display:`inline-flex`,gap:s,alignItems:`center`,justifyContent:`center`,fontWeight:r,whiteSpace:`nowrap`,textAlign:`center`,backgroundImage:`none`,cursor:`pointer`,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,userSelect:`none`,touchAction:`manipulation`,"&:disabled > *":{pointerEvents:`none`},[`${t}-icon > svg`]:ro(),"> a":{color:`currentColor`},"&:not(:disabled)":co(e),[`&${t}-two-chinese-chars::first-letter`]:{letterSpacing:`0.34em`},[`&${t}-two-chinese-chars > *:not(${n})`]:{marginInlineEnd:`-0.34em`,letterSpacing:`0.34em`},[`&${t}-icon-only`]:{paddingInline:0,[`&${t}-compact-item`]:{flex:`none`}},[`&${t}-loading`]:{opacity:i,cursor:`default`},[`${t}-loading-icon`]:{transition:[`width`,`opacity`,`margin`].map(e=>`${e} ${a} ${o}`).join(`,`)},[`&:not(${t}-icon-end)`]:{[`${t}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineEnd:c(s).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineEnd:0},"&-leave-start":{marginInlineEnd:0},"&-leave-active":{marginInlineEnd:c(s).mul(-1).equal()}}},"&-icon-end":{flexDirection:`row-reverse`,[`${t}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineStart:c(s).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineStart:0},"&-leave-start":{marginInlineStart:0},"&-leave-active":{marginInlineStart:c(s).mul(-1).equal()}}}}}},fee=e=>({minWidth:e.controlHeight,paddingInline:0,borderRadius:`50%`}),Nf=(e,t=``)=>{let{componentCls:n,controlHeight:r,fontSize:i,borderRadius:a,buttonPaddingHorizontal:o,iconCls:s,buttonPaddingVertical:c,buttonIconOnlyFontSize:l}=e;return[{[t]:{fontSize:i,height:r,padding:`${tn(c)} ${tn(o)}`,borderRadius:a,[`&${n}-icon-only`]:{width:r,[s]:{fontSize:l}}}},{[`${n}${n}-circle${t}`]:fee(e)},{[`${n}${n}-round${t}`]:{borderRadius:e.controlHeight,[`&:not(${n}-icon-only)`]:{paddingInline:e.buttonPaddingHorizontal}}}]},Pf=e=>Nf(yi(e,{fontSize:e.contentFontSize}),e.componentCls),Ff=e=>Nf(yi(e,{controlHeight:e.controlHeightSM,fontSize:e.contentFontSizeSM,padding:e.paddingXS,buttonPaddingHorizontal:e.paddingInlineSM,buttonPaddingVertical:0,borderRadius:e.borderRadiusSM,buttonIconOnlyFontSize:e.onlyIconSizeSM}),`${e.componentCls}-sm`),If=e=>Nf(yi(e,{controlHeight:e.controlHeightLG,fontSize:e.contentFontSizeLG,buttonPaddingHorizontal:e.paddingInlineLG,buttonPaddingVertical:0,borderRadius:e.borderRadiusLG,buttonIconOnlyFontSize:e.onlyIconSizeLG}),`${e.componentCls}-lg`),Lf=e=>{let{componentCls:t}=e;return{[t]:{[`&${t}-block`]:{width:`100%`}}}},pee=fo(`Button`,e=>{let t=jf(e);return[dee(t),Pf(t),Ff(t),If(t),Lf(t),uee(t),Md(t)]},Mf,{unitless:{fontWeight:!0,contentLineHeight:!0,contentLineHeightSM:!0,contentLineHeightLG:!0}});function Rf(e,t,n,r){let{focusElCls:i,focus:a,borderElCls:o}=n,s=o?`> *`:``,c=[`hover`,a?`focus`:null,`active`].filter(Boolean).map(e=>`&:${e} ${s}`).join(`,`);return{[`&-item:not(${t}-last-item)`]:{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal()},[`&-item:not(${r}-status-success)`]:{zIndex:2},"&-item":{[c]:{zIndex:3},...i?{[`&${i}`]:{zIndex:3}}:{},[`&[disabled] ${s}`]:{zIndex:0}}}}function zf(e,t,n){let{borderElCls:r}=n,i=r?`> ${r}`:``;return{[`&-item:not(${t}-first-item):not(${t}-last-item) ${i}`]:{borderRadius:0},[`&-item:not(${t}-last-item)${t}-first-item`]:{[`& ${i}, &${e}-sm ${i}, &${e}-lg ${i}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&-item:not(${t}-first-item)${t}-last-item`]:{[`& ${i}, &${e}-sm ${i}, &${e}-lg ${i}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function Bf(e,t={focus:!0}){let{componentCls:n}=e,{componentCls:r}=t,i=r||n,a=`${i}-compact`;return{[a]:{...Rf(e,a,t,i),...zf(i,a,t)}}}function Vf(e,t,n){return{[`&-item:not(${t}-last-item)`]:{marginBottom:e.calc(e.lineWidth).mul(-1).equal()},[`&-item:not(${n}-status-success)`]:{zIndex:2},"&-item":{"&:hover,&:focus,&:active":{zIndex:3},"&[disabled]":{zIndex:0}}}}function Hf(e,t){return{[`&-item:not(${t}-first-item):not(${t}-last-item)`]:{borderRadius:0},[`&-item${t}-first-item:not(${t}-last-item)`]:{[`&, &${e}-sm, &${e}-lg`]:{borderEndEndRadius:0,borderEndStartRadius:0}},[`&-item${t}-last-item:not(${t}-first-item)`]:{[`&, &${e}-sm, &${e}-lg`]:{borderStartStartRadius:0,borderStartEndRadius:0}}}}function Uf(e){let t=`${e.componentCls}-compact-vertical`;return{[t]:{...Vf(e,t,e.componentCls),...Hf(e.componentCls,t)}}}var Wf=e=>{let{componentCls:t,colorPrimaryHover:n,lineWidth:r,calc:i}=e,a=i(r).mul(-1).equal(),o=e=>{let i=`${t}-compact${e?`-vertical`:``}-item`,o=`${i}${t}-primary:not([disabled])`;return{[i]:{transition:`none`},[`${o} + ${o}::before`]:{position:`absolute`,top:e?a:0,insetInlineStart:e?0:a,backgroundColor:n,content:`""`,width:e?`100%`:r,height:e?r:`100%`}}};return{...o(),...o(!0)}},Gf=mo([`Button`,`compact`],e=>{let t=jf(e);return[Bf(t),Uf(t),Wf(t)]},Mf);function Kf(e){if(typeof e==`object`&&e){let t=e?.delay;return t=!Number.isNaN(t)&&typeof t==`number`?t:0,{loading:t<=0,delay:t}}return{loading:!!e,delay:0}}var qf={default:[`default`,`outlined`],primary:[`primary`,`solid`],dashed:[`default`,`dashed`],link:[`link`,`link`],text:[`default`,`text`]},Jf=y.forwardRef((e,t)=>{let{_skipSemantic:n,loading:r=!1,prefixCls:i,color:a,variant:o,type:s,danger:c=!1,shape:l,size:u,disabled:d,className:f,rootClassName:p,children:m,icon:h,iconPosition:g,iconPlacement:_,ghost:v=!1,block:b=!1,htmlType:x=`button`,classNames:S,styles:C,style:w,autoInsertSpace:T,autoFocus:D,...O}=e,k=Oe(m),A=s||`default`,{button:j}=y.useContext(dt),M=l||j?.shape||`default`,[N,ee]=(0,y.useMemo)(()=>{if(a&&o)return[a,o];if(s||c){let e=qf[A]||[];return c?[`danger`,e[1]]:e}return j?.color&&j?.variant?[j.color,j.variant]:[`default`,`outlined`]},[a,o,s,c,j?.color,j?.variant,A]),[te,P]=(0,y.useMemo)(()=>v&&ee===`solid`?[N,`outlined`]:[N,ee],[N,ee,v]),ne=te===`danger`,re=ne?`dangerous`:te,{getPrefixCls:ie,direction:oe,autoInsertSpace:se,className:ce,style:le,classNames:ue,styles:de}=mt(`button`),fe=T??se??!0,pe=ie(`btn`,i),[me,he]=pee(pe),ge=(0,y.useContext)(Ql),_e=d??ge,ve=(0,y.useContext)(_d),ye=(0,y.useMemo)(()=>Kf(r),[r]),[be,xe]=(0,y.useState)(ye.loading),[Se,Ce]=(0,y.useState)(!1),we=(0,y.useRef)(null),Te=ae(t,we),Ee=k.length===1&&!h&&!Cd(P),ke=(0,y.useRef)(!0);y.useEffect(()=>(ke.current=!1,()=>{ke.current=!0}),[]),E(()=>{let e=null;ye.delay>0?e=setTimeout(()=>{e=null,xe(!0)},ye.delay):xe(ye.loading);function t(){e&&=(clearTimeout(e),null)}return t},[ye.delay,ye.loading]),(0,y.useEffect)(()=>{if(!we.current||!fe)return;let e=we.current.textContent||``;Ee&&bd(e)?Se||Ce(!0):Se&&Ce(!1)}),(0,y.useEffect)(()=>{D&&we.current&&we.current.focus()},[]);let Ae=y.useCallback(t=>{if(be||_e){t.preventDefault();return}e.onClick?.((`href`in e,t))},[e.onClick,be,_e]),{compactSize:je,compactItemClassnames:Me}=pd(pe,oe),Ne={large:`lg`,small:`sm`,middle:void 0},Pe=ld(e=>u??je??ve??e),Fe=Pe?Ne[Pe]??``:``,Ie=be?`loading`:h,Le=_??g??`start`,Re=De(O,[`navigate`]),ze={...e,type:A,color:te,variant:P,danger:ne,shape:M,size:Pe,disabled:_e,loading:be,iconPlacement:Le},[Be,Ve]=Nc([n?void 0:ue,S],[n?void 0:de,C],{props:ze}),He=F(pe,me,he,{[`${pe}-${M}`]:M!==`default`&&M!==`square`&&M,[`${pe}-${A}`]:A,[`${pe}-dangerous`]:c,[`${pe}-color-${re}`]:re,[`${pe}-variant-${P}`]:P,[`${pe}-${Fe}`]:Fe,[`${pe}-icon-only`]:!m&&m!==0&&!!Ie,[`${pe}-background-ghost`]:v&&!Cd(P),[`${pe}-loading`]:be,[`${pe}-two-chinese-chars`]:Se&&fe&&!be,[`${pe}-block`]:b,[`${pe}-rtl`]:oe===`rtl`,[`${pe}-icon-end`]:Le===`end`},Me,f,p,ce,Be.root),Ue={...Ve.root,...le,...w},We={className:Be.icon,style:Ve.icon},Ge=e=>y.createElement(Ed,{prefixCls:pe,...We},e),Ke=y.createElement(Ad,{existIcon:!!h,prefixCls:pe,loading:be,mount:ke.current,...We}),qe;qe=h&&!be?Ge(h):r&&typeof r==`object`&&r.icon?Ge(r.icon):Ke;let Je=gc(m)?Td(m,Ee&&fe,Ve.content,Be.content):null;if(Re.href!==void 0)return y.createElement(`a`,{...Re,className:F(He,{[`${pe}-disabled`]:_e}),href:_e?void 0:Re.href,style:Ue,onClick:Ae,ref:Te,tabIndex:_e?-1:0,"aria-disabled":_e},qe,Je);let Ye=y.createElement(`button`,{...O,type:x,className:He,style:Ue,onClick:Ae,disabled:_e,ref:Te},qe,Je,Me&&y.createElement(Gf,{prefixCls:pe}));return Cd(P)||(Ye=y.createElement(cd,{component:`Button`,disabled:be},Ye)),Ye});Jf.Group=vd,Jf.__ANT_BUTTON=!0;var Yf=Jf,Xf=e=>typeof e?.then==`function`,Zf=e=>{let{type:t,children:n,prefixCls:r,buttonProps:i,close:a,autoFocus:o,emitEvent:s,isSilent:c,quitOnNullishReturnValue:l,actionFn:u}=e,d=y.useRef(!1),f=y.useRef(null),[p,m]=D(!1),h=(...e)=>{a?.(...e)};y.useEffect(()=>{let e=null;return o&&(e=setTimeout(()=>{f.current?.focus({preventScroll:!0})})),()=>{e&&clearTimeout(e)}},[o]);let g=e=>{Xf(e)&&(m(!0),e.then((...e)=>{m(!1,!0),h.apply(void 0,e),d.current=!1},e=>{if(m(!1,!0),d.current=!1,!c?.())return Promise.reject(e)}))},_=e=>{if(d.current)return;if(d.current=!0,!u){h();return}let t;if(s){if(t=u(e),l&&!Xf(t)){d.current=!1,h(e);return}}else if(u.length)t=u(a),d.current=!1;else if(t=u(),!Xf(t)){h();return}g(t)};return y.createElement(Yf,{...xd(t),onClick:_,loading:p,prefixCls:r,...i,ref:f},n)};const Qf=y.createContext({}),{Provider:$f}=Qf;var ep=()=>{let{autoFocusButton:e,cancelButtonProps:t,cancelTextLocale:n,isSilent:r,mergedOkCancel:i,rootPrefixCls:a,close:o,onCancel:s,onConfirm:c,onClose:l}=(0,y.useContext)(Qf);return i?y.createElement(Zf,{isSilent:r,actionFn:s,close:(...e)=>{o?.(...e),c?.(!1),l?.()},autoFocus:e===`cancel`,buttonProps:t,prefixCls:`${a}-btn`},n):null},tp=()=>{let{autoFocusButton:e,close:t,isSilent:n,okButtonProps:r,rootPrefixCls:i,okTextLocale:a,okType:o,onConfirm:s,onOk:c,onClose:l}=(0,y.useContext)(Qf);return y.createElement(Zf,{isSilent:n,type:o||`primary`,actionFn:c,close:(...e)=>{t?.(...e),s?.(!0),l?.()},autoFocus:e===`ok`,buttonProps:r,prefixCls:`${i}-btn`},a)};const np=y.createContext({});function rp(e,t,n){let r=t;return!r&&n&&(r=`${e}-${n}`),r}function ip(e,t){let n=e[`page${t?`Y`:`X`}Offset`],r=`scroll${t?`Top`:`Left`}`;if(typeof n!=`number`){let t=e.document;n=t.documentElement[r],typeof n!=`number`&&(n=t.body[r])}return n}function ap(e){let t=e.getBoundingClientRect(),n={left:t.left,top:t.top},r=e.ownerDocument,i=r.defaultView||r.parentWindow;return n.left+=ip(i),n.top+=ip(i,!0),n}var op=y.memo(({children:e})=>e,(e,{shouldUpdate:t})=>!t);function sp(){return sp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sp.apply(this,arguments)}var cp={width:0,height:0,overflow:`hidden`,outline:`none`},lp={outline:`none`},up=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,style:i,title:a,ariaId:o,footer:s,closable:c,closeIcon:l,onClose:u,children:d,bodyStyle:f,bodyProps:p,modalRender:m,onMouseDown:h,onMouseUp:g,holderRef:_,visible:v,forceRender:b,width:x,height:S,classNames:C,styles:w}=e,{panel:T}=y.useContext(np),E=ae(_,T),D=(0,y.useRef)(null),O=(0,y.useRef)(null);y.useImperativeHandle(t,()=>({focus:()=>{D.current?.focus({preventScroll:!0})},changeActive:e=>{let{activeElement:t}=document;e&&t===O.current?D.current.focus({preventScroll:!0}):!e&&t===D.current&&O.current.focus({preventScroll:!0})}}));let k={};x!==void 0&&(k.width=x),S!==void 0&&(k.height=S);let A=s?y.createElement(`div`,{className:F(`${n}-footer`,C?.footer),style:{...w?.footer}},s):null,j=a?y.createElement(`div`,{className:F(`${n}-header`,C?.header),style:{...w?.header}},y.createElement(`div`,{className:F(`${n}-title`,C?.title),id:o,style:{...w?.title}},a)):null,M=(0,y.useMemo)(()=>typeof c==`object`&&c?c:c?{closeIcon:l??y.createElement(`span`,{className:`${n}-close-x`})}:{},[c,l,n]),N=Gs(M,!0),ee=typeof c==`object`&&c.disabled,te=c?y.createElement(`button`,sp({type:`button`,onClick:u,"aria-label":`Close`},N,{className:`${n}-close`,disabled:ee}),M.closeIcon):null,P=y.createElement(`div`,{className:F(`${n}-container`,C?.container),style:w?.container},te,j,y.createElement(`div`,sp({className:F(`${n}-body`,C?.body),style:{...f,...w?.body}},p),d),A);return y.createElement(`div`,{key:`dialog-element`,role:`dialog`,"aria-labelledby":a?o:null,"aria-modal":`true`,ref:E,style:{...i,...k},className:F(n,r),onMouseDown:h,onMouseUp:g},y.createElement(`div`,{ref:D,tabIndex:0,style:lp},y.createElement(op,{shouldUpdate:v||b},m?m(P):P)),y.createElement(`div`,{tabIndex:0,ref:O,style:cp}))});function dp(){return dp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dp.apply(this,arguments)}var fp=y.forwardRef((e,t)=>{let{prefixCls:n,title:r,style:i,className:a,visible:o,forceRender:s,destroyOnHidden:c,motionName:l,ariaId:u,onVisibleChanged:d,mousePosition:f}=e,p=(0,y.useRef)(null),m=(0,y.useRef)(null);y.useImperativeHandle(t,()=>({...m.current,inMotion:p.current.inMotion,enableMotion:p.current.enableMotion}));let[h,g]=y.useState(),_={};h&&(_.transformOrigin=h);function v(){let e=ap(p.current.nativeElement);g(f&&(f.x||f.y)?`${f.x-e.left}px ${f.y-e.top}px`:``)}return y.createElement(Bs,{visible:o,onVisibleChanged:d,onAppearPrepare:v,onEnterPrepare:v,forceRender:s,motionName:l,removeOnLeave:c,ref:p},({className:t,style:o},s)=>y.createElement(up,dp({},e,{ref:m,title:r,ariaId:u,prefixCls:n,holderRef:s,style:{...o,...i,..._},className:F(a,t)})))});function pp(){return pp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pp.apply(this,arguments)}var mp=e=>{let{prefixCls:t,style:n,visible:r,maskProps:i,motionName:a,className:o}=e;return y.createElement(Bs,{key:`mask`,visible:r,motionName:a,leavedClassName:`${t}-mask-hidden`},({className:e,style:r},a)=>y.createElement(`div`,pp({ref:a,style:{...r,...n},className:F(`${t}-mask`,e,o)},i)))};function hp(){return hp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hp.apply(this,arguments)}var gp=e=>{let{prefixCls:t=`rc-dialog`,zIndex:n,visible:r=!1,keyboard:i=!0,focusTriggerAfterClose:a=!0,wrapStyle:o,wrapClassName:s,wrapProps:c,onClose:l,afterOpenChange:u,afterClose:d,transitionName:f,animation:p,closable:m=!0,mask:h=!0,maskTransitionName:g,maskAnimation:_,maskClosable:v=!0,maskStyle:b,maskProps:x,rootClassName:S,rootStyle:C,classNames:w,styles:T}=e,E=(0,y.useRef)(null),D=(0,y.useRef)(null),O=(0,y.useRef)(null),[k,A]=y.useState(r),j=dl();function M(){_t(D.current,document.activeElement)||(E.current=document.activeElement)}function N(){_t(D.current,document.activeElement)||O.current?.focus()}function ee(){if(A(!1),h&&E.current&&a){try{E.current.focus({preventScroll:!0})}catch{}E.current=null}k&&d?.()}function te(e){e?N():ee(),u?.(e)}function P(e){l?.(e)}let ne=(0,y.useRef)(!1),re=(0,y.useRef)(null),ie=()=>{clearTimeout(re.current),ne.current=!0},ae=()=>{re.current=setTimeout(()=>{ne.current=!1})},oe=null;v&&(oe=e=>{ne.current?ne.current=!1:D.current===e.target&&P(e)});function se(e){if(i&&e.keyCode===mu.ESC){e.stopPropagation(),P(e);return}r&&e.keyCode===mu.TAB&&O.current.changeActive(!e.shiftKey)}(0,y.useEffect)(()=>{r?(A(!0),M()):k&&O.current.enableMotion()&&!O.current.inMotion()&&ee()},[r]),(0,y.useEffect)(()=>()=>{clearTimeout(re.current)},[]);let ce={zIndex:n,...o,...T?.wrapper,display:k?null:`none`};return y.createElement(`div`,hp({className:F(`${t}-root`,S),style:C},Gs(e,{data:!0})),y.createElement(mp,{prefixCls:t,visible:h&&r,motionName:rp(t,g,_),style:{zIndex:n,...b,...T?.mask},maskProps:x,className:w?.mask}),y.createElement(`div`,hp({tabIndex:-1,onKeyDown:se,className:F(`${t}-wrap`,s,w?.wrapper),ref:D,onClick:oe,style:ce},c),y.createElement(fp,hp({},e,{onMouseDown:ie,onMouseUp:ae,ref:O,closable:m,ariaId:j,prefixCls:t,visible:r&&k,onClose:P,onVisibleChanged:te,motionName:rp(t,f,p)}))))};function _p(){return _p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_p.apply(this,arguments)}var vp=e=>{let{visible:t,getContainer:n,forceRender:r,destroyOnHidden:i=!1,afterClose:a,closable:o,panelRef:s}=e,[c,l]=y.useState(t),u=y.useMemo(()=>({panel:s}),[s]);return y.useEffect(()=>{t&&l(!0)},[t]),!r&&i&&!c?null:y.createElement(np.Provider,{value:u},y.createElement(sl,{open:t||r||c,autoDestroy:!1,getContainer:n,autoLock:t||c},y.createElement(gp,_p({},e,{destroyOnHidden:i,afterClose:()=>{let{afterClose:e}=(o&&typeof o==`object`?o:{})||{};e?.(),a?.(),l(!1)}}))))};const yp=`RC_FORM_INTERNAL_HOOKS`;var bp=()=>{Ee(!1,`Can not find FormContext. Please make sure you wrap Field under Form.`)},xp=y.createContext({getFieldValue:bp,getFieldsValue:bp,getFieldError:bp,getFieldWarning:bp,getFieldsError:bp,isFieldsTouched:bp,isFieldTouched:bp,isFieldValidating:bp,isFieldsValidating:bp,resetFields:bp,setFields:bp,setFieldValue:bp,setFieldsValue:bp,validateFields:bp,submit:bp,getInternalHooks:()=>(bp(),{dispatch:bp,initEntityValue:bp,registerField:bp,useSubscribe:bp,setInitialValues:bp,destroyForm:bp,setCallbacks:bp,registerWatch:bp,getFields:bp,setValidateMessages:bp,setPreserve:bp,getInitialValue:bp,setBatchUpdate:bp})}),Sp=y.createContext(null);function Cp(e){return e==null?[]:Array.isArray(e)?e:[e]}function wp(e){return e&&!!e._init}function Tp(){return{default:`Validation error on field %s`,required:`%s is required`,enum:`%s must be one of %s`,whitespace:`%s cannot be empty`,date:{format:`%s date %s is invalid for format %s`,parse:`%s date could not be parsed, %s is invalid `,invalid:`%s date %s is invalid`},types:{string:`%s is not a %s`,method:`%s is not a %s (function)`,array:`%s is not an %s`,object:`%s is not an %s`,number:`%s is not a %s`,date:`%s is not a %s`,boolean:`%s is not a %s`,integer:`%s is not an %s`,float:`%s is not a %s`,regexp:`%s is not a valid %s`,email:`%s is not a valid %s`,url:`%s is not a valid %s`,hex:`%s is not a valid %s`},string:{len:`%s must be exactly %s characters`,min:`%s must be at least %s characters`,max:`%s cannot be longer than %s characters`,range:`%s must be between %s and %s characters`},number:{len:`%s must equal %s`,min:`%s cannot be less than %s`,max:`%s cannot be greater than %s`,range:`%s must be between %s and %s`},array:{len:`%s must be exactly %s in length`,min:`%s cannot be less than %s in length`,max:`%s cannot be greater than %s in length`,range:`%s must be between %s and %s in length`},pattern:{mismatch:`%s value %s does not match pattern %s`},clone:function(){var e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}var Ep=Tp();function Dp(e){try{return Function.toString.call(e).indexOf(`[native code]`)!==-1}catch{return typeof e==`function`}}function Op(e,t,n){if(ii())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&ti(i,n.prototype),i}function kp(e){var t=typeof Map==`function`?new Map:void 0;return kp=function(e){if(e===null||!Dp(e))return e;if(typeof e!=`function`)throw TypeError(`Super expression must either be null or a function`);if(t!==void 0){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Op(e,arguments,ri(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ti(n,e)},kp(e)}var Ap=/%[sdj%]/g,jp=function(){};function Mp(e){if(!e||!e.length)return null;var t={};return e.forEach(function(e){var n=e.field;t[n]=t[n]||[],t[n].push(e)}),t}function Np(e){var t=[...arguments].slice(1),n=0,r=t.length;return typeof e==`function`?e.apply(null,t):typeof e==`string`?e.replace(Ap,function(e){if(e===`%%`)return`%`;if(n>=r)return e;switch(e){case`%s`:return String(t[n++]);case`%d`:return Number(t[n++]);case`%j`:try{return JSON.stringify(t[n++])}catch{return`[Circular]`}break;default:return e}}):e}function Pp(e){return e===`string`||e===`url`||e===`hex`||e===`email`||e===`date`||e===`pattern`}function Fp(e,t){return!!(e==null||t===`array`&&Array.isArray(e)&&!e.length||Pp(t)&&typeof e==`string`&&!e)}function Ip(e,t,n){var r=[],i=0,a=e.length;function o(e){r.push.apply(r,nt(e||[])),i++,i===a&&n(r)}e.forEach(function(e){t(e,o)})}function Lp(e,t,n){var r=0,i=e.length;function a(o){if(o&&o.length){n(o);return}var s=r;r+=1,s<i?t(e[s],a):n([])}a([])}function Rp(e){var t=[];return Object.keys(e).forEach(function(n){t.push.apply(t,nt(e[n]||[]))}),t}var zp=function(e){ni(n,e);var t=oi(n);function n(e,r){var i;return Zr(this,n),i=t.call(this,`Async Validation Error`),Jr(ei(i),`errors`,void 0),Jr(ei(i),`fields`,void 0),i.errors=e,i.fields=r,i}return $r(n)}(kp(Error));function Bp(e,t,n,r,i){if(t.first){var a=new Promise(function(t,a){Lp(Rp(e),n,function(e){return r(e),e.length?a(new zp(e,Mp(e))):t(i)})});return a.catch(function(e){return e}),a}var o=t.firstFields===!0?Object.keys(e):t.firstFields||[],s=Object.keys(e),c=s.length,l=0,u=[],d=new Promise(function(t,a){var d=function(e){if(u.push.apply(u,e),l++,l===c)return r(u),u.length?a(new zp(u,Mp(u))):t(i)};s.length||(r(u),t(i)),s.forEach(function(t){var r=e[t];o.indexOf(t)===-1?Ip(r,n,d):Lp(r,n,d)})});return d.catch(function(e){return e}),d}function Vp(e){return!!(e&&e.message!==void 0)}function Hp(e,t){for(var n=e,r=0;r<t.length;r++){if(n==null)return n;n=n[t[r]]}return n}function Up(e,t){return function(n){var r=e.fullFields?Hp(t,e.fullFields):t[n.field||e.fullField];return Vp(n)?(n.field=n.field||e.fullField,n.fieldValue=r,n):{message:typeof n==`function`?n():n,fieldValue:r,field:n.field||e.fullField}}}function Wp(e,t){if(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];Hr(r)===`object`&&Hr(e[n])===`object`?e[n]=Xr(Xr({},e[n]),r):e[n]=r}}return e}var Gp=`enum`,mee=function(e,t,n,r,i){e[Gp]=Array.isArray(e[Gp])?e[Gp]:[],e[Gp].indexOf(t)===-1&&r.push(Np(i.messages[Gp],e.fullField,e[Gp].join(`, `)))},hee=function(e,t,n,r,i){e.pattern&&(e.pattern instanceof RegExp?(e.pattern.lastIndex=0,e.pattern.test(t)||r.push(Np(i.messages.pattern.mismatch,e.fullField,t,e.pattern))):typeof e.pattern==`string`&&(new RegExp(e.pattern).test(t)||r.push(Np(i.messages.pattern.mismatch,e.fullField,t,e.pattern))))},gee=function(e,t,n,r,i){var a=typeof e.len==`number`,o=typeof e.min==`number`,s=typeof e.max==`number`,c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l=t,u=null,d=typeof t==`number`,f=typeof t==`string`,p=Array.isArray(t);if(d?u=`number`:f?u=`string`:p&&(u=`array`),!u)return!1;p&&(l=t.length),f&&(l=t.replace(c,`_`).length),a?l!==e.len&&r.push(Np(i.messages[u].len,e.fullField,e.len)):o&&!s&&l<e.min?r.push(Np(i.messages[u].min,e.fullField,e.min)):s&&!o&&l>e.max?r.push(Np(i.messages[u].max,e.fullField,e.max)):o&&s&&(l<e.min||l>e.max)&&r.push(Np(i.messages[u].range,e.fullField,e.min,e.max))},Kp=function(e,t,n,r,i,a){e.required&&(!n.hasOwnProperty(e.field)||Fp(t,a||e.type))&&r.push(Np(i.messages.required,e.fullField))},qp,_ee=(function(){if(qp)return qp;var e=`[a-fA-F\\d:]`,t=function(t){return t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|\$))`:``},n=`(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}`,r=`[a-fA-F\\d]{1,4}`,i=`(?:${[`(?:${r}:){7}(?:${r}|:)`,`(?:${r}:){6}(?:${n}|:${r}|:)`,`(?:${r}:){5}(?::${n}|(?::${r}){1,2}|:)`,`(?:${r}:){4}(?:(?::${r}){0,1}:${n}|(?::${r}){1,3}|:)`,`(?:${r}:){3}(?:(?::${r}){0,2}:${n}|(?::${r}){1,4}|:)`,`(?:${r}:){2}(?:(?::${r}){0,3}:${n}|(?::${r}){1,5}|:)`,`(?:${r}:){1}(?:(?::${r}){0,4}:${n}|(?::${r}){1,6}|:)`,`(?::(?:(?::${r}){0,5}:${n}|(?::${r}){1,7}|:))`].join(`|`)})(?:%[0-9a-zA-Z]{1,})?`,a=RegExp(`(?:^${n}\$)|(?:^${i}\$)`),o=RegExp(`^${n}\$`),s=RegExp(`^${i}\$`),c=function(e){return e&&e.exact?a:RegExp(`(?:${t(e)}${n}${t(e)})|(?:${t(e)}${i}${t(e)})`,`g`)};c.v4=function(e){return e&&e.exact?o:RegExp(`${t(e)}${n}${t(e)}`,`g`)},c.v6=function(e){return e&&e.exact?s:RegExp(`${t(e)}${i}${t(e)}`,`g`)};var l=`(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${c.v4().source}|${c.v6().source}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?`;return qp=RegExp(`(?:^${l}\$)`,`i`),qp}),Jp={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},Yp={integer:function(e){return Yp.number(e)&&parseInt(e,10)===e},float:function(e){return Yp.number(e)&&!Yp.integer(e)},array:function(e){return Array.isArray(e)},regexp:function(e){if(e instanceof RegExp)return!0;try{return!0}catch{return!1}},date:function(e){return typeof e.getTime==`function`&&typeof e.getMonth==`function`&&typeof e.getYear==`function`&&!isNaN(e.getTime())},number:function(e){return isNaN(e)?!1:typeof e==`number`},object:function(e){return Hr(e)===`object`&&!Yp.array(e)},method:function(e){return typeof e==`function`},email:function(e){return typeof e==`string`&&e.length<=320&&!!e.match(Jp.email)},url:function(e){return typeof e==`string`&&e.length<=2048&&!!e.match(_ee())},hex:function(e){return typeof e==`string`&&!!e.match(Jp.hex)}},Xp={required:Kp,whitespace:function(e,t,n,r,i){(/^\s+$/.test(t)||t===``)&&r.push(Np(i.messages.whitespace,e.fullField))},type:function(e,t,n,r,i){if(e.required&&t===void 0){Kp(e,t,n,r,i);return}var a=[`integer`,`float`,`array`,`regexp`,`object`,`method`,`email`,`number`,`date`,`url`,`hex`],o=e.type;a.indexOf(o)>-1?Yp[o](t)||r.push(Np(i.messages.types[o],e.fullField,e.type)):o&&Hr(t)!==e.type&&r.push(Np(i.messages.types[o],e.fullField,e.type))},range:gee,enum:mee,pattern:hee},vee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i)}n(a)},yee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(t==null&&!e.required)return n();Xp.required(e,t,r,a,i,`array`),t!=null&&(Xp.type(e,t,r,a,i),Xp.range(e,t,r,a,i))}n(a)},bee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&Xp.type(e,t,r,a,i)}n(a)},xee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t,`date`)&&!e.required)return n();if(Xp.required(e,t,r,a,i),!Fp(t,`date`)){var o=t instanceof Date?t:new Date(t);Xp.type(e,o,r,a,i),o&&Xp.range(e,o.getTime(),r,a,i)}}n(a)},See=`enum`,Cee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&Xp[See](e,t,r,a,i)}n(a)},wee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&(Xp.type(e,t,r,a,i),Xp.range(e,t,r,a,i))}n(a)},Tee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&(Xp.type(e,t,r,a,i),Xp.range(e,t,r,a,i))}n(a)},Eee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&Xp.type(e,t,r,a,i)}n(a)},Dee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(t===``&&(t=void 0),Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&(Xp.type(e,t,r,a,i),Xp.range(e,t,r,a,i))}n(a)},Oee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),t!==void 0&&Xp.type(e,t,r,a,i)}n(a)},kee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t,`string`)&&!e.required)return n();Xp.required(e,t,r,a,i),Fp(t,`string`)||Xp.pattern(e,t,r,a,i)}n(a)},Aee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t)&&!e.required)return n();Xp.required(e,t,r,a,i),Fp(t)||Xp.type(e,t,r,a,i)}n(a)},jee=function(e,t,n,r,i){var a=[],o=Array.isArray(t)?`array`:Hr(t);Xp.required(e,t,r,a,i,o),n(a)},Mee=function(e,t,n,r,i){var a=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t,`string`)&&!e.required)return n();Xp.required(e,t,r,a,i,`string`),Fp(t,`string`)||(Xp.type(e,t,r,a,i),Xp.range(e,t,r,a,i),Xp.pattern(e,t,r,a,i),e.whitespace===!0&&Xp.whitespace(e,t,r,a,i))}n(a)},Zp=function(e,t,n,r,i){var a=e.type,o=[];if(e.required||!e.required&&r.hasOwnProperty(e.field)){if(Fp(t,a)&&!e.required)return n();Xp.required(e,t,r,o,i,a),Fp(t,a)||Xp.type(e,t,r,o,i)}n(o)},Qp={string:Mee,method:Eee,number:Dee,boolean:bee,regexp:Aee,integer:Tee,float:wee,array:yee,object:Oee,enum:Cee,pattern:kee,date:xee,url:Zp,hex:Zp,email:Zp,required:jee,any:vee},$p=function(){function e(t){Zr(this,e),Jr(this,`rules`,null),Jr(this,`_messages`,Ep),this.define(t)}return $r(e,[{key:`define`,value:function(e){var t=this;if(!e)throw Error(`Cannot configure a schema with no rules`);if(Hr(e)!==`object`||Array.isArray(e))throw Error(`Rules must be an object`);this.rules={},Object.keys(e).forEach(function(n){var r=e[n];t.rules[n]=Array.isArray(r)?r:[r]})}},{key:`messages`,value:function(e){return e&&(this._messages=Wp(Tp(),e)),this._messages}},{key:`validate`,value:function(t){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},a=t,o=r,s=i;if(typeof o==`function`&&(s=o,o={}),!this.rules||Object.keys(this.rules).length===0)return s&&s(null,a),Promise.resolve(a);function c(e){var t=[],n={};function r(e){if(Array.isArray(e)){var n;t=(n=t).concat.apply(n,nt(e))}else t.push(e)}for(var i=0;i<e.length;i++)r(e[i]);t.length?(n=Mp(t),s(t,n)):s(null,a)}if(o.messages){var l=this.messages();l===Ep&&(l=Tp()),Wp(l,o.messages),o.messages=l}else o.messages=this.messages();var u={};(o.keys||Object.keys(this.rules)).forEach(function(e){var r=n.rules[e],i=a[e];r.forEach(function(r){var o=r;typeof o.transform==`function`&&(a===t&&(a=Xr({},a)),i=a[e]=o.transform(i),i!=null&&(o.type=o.type||(Array.isArray(i)?`array`:Hr(i)))),o=typeof o==`function`?{validator:o}:Xr({},o),o.validator=n.getValidationMethod(o),o.validator&&(o.field=e,o.fullField=o.fullField||e,o.type=n.getType(o),u[e]=u[e]||[],u[e].push({rule:o,value:i,source:a,field:e}))})});var d={};return Bp(u,o,function(t,n){var r=t.rule,i=(r.type===`object`||r.type===`array`)&&(Hr(r.fields)===`object`||Hr(r.defaultField)===`object`);i&&=r.required||!r.required&&t.value,r.field=t.field;function s(e,t){return Xr(Xr({},t),{},{fullField:`${r.fullField}.${e}`,fullFields:r.fullFields?[].concat(nt(r.fullFields),[e]):[e]})}function c(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=Array.isArray(c)?c:[c];!o.suppressWarning&&l.length&&e.warning(`async-validator:`,l),l.length&&r.message!==void 0&&(l=[].concat(r.message));var u=l.map(Up(r,a));if(o.first&&u.length)return d[r.field]=1,n(u);if(!i)n(u);else{if(r.required&&!t.value)return r.message===void 0?o.error&&(u=[o.error(r,Np(o.messages.required,r.field))]):u=[].concat(r.message).map(Up(r,a)),n(u);var f={};r.defaultField&&Object.keys(t.value).map(function(e){f[e]=r.defaultField}),f=Xr(Xr({},f),t.rule.fields);var p={};Object.keys(f).forEach(function(e){var t=f[e];p[e]=(Array.isArray(t)?t:[t]).map(s.bind(null,e))});var m=new e(p);m.messages(o.messages),t.rule.options&&(t.rule.options.messages=o.messages,t.rule.options.error=o.error),m.validate(t.value,t.rule.options||o,function(e){var t=[];u&&u.length&&t.push.apply(t,nt(u)),e&&e.length&&t.push.apply(t,nt(e)),n(t.length?t:null)})}}var l;if(r.asyncValidator)l=r.asyncValidator(r,t.value,c,t.source,o);else if(r.validator){try{l=r.validator(r,t.value,c,t.source,o)}catch(e){var u,f;(u=(f=console).error)==null||u.call(f,e),o.suppressValidatorError||setTimeout(function(){throw e},0),c(e.message)}l===!0?c():l===!1?c(typeof r.message==`function`?r.message(r.fullField||r.field):r.message||`${r.fullField||r.field} fails`):l instanceof Array?c(l):l instanceof Error&&c(l.message)}l&&l.then&&l.then(function(){return c()},function(e){return c(e)})},function(e){c(e)},a)}},{key:`getType`,value:function(e){if(e.type===void 0&&e.pattern instanceof RegExp&&(e.type=`pattern`),typeof e.validator!=`function`&&e.type&&!Qp.hasOwnProperty(e.type))throw Error(Np(`Unknown rule type %s`,e.type));return e.type||`string`}},{key:`getValidationMethod`,value:function(e){if(typeof e.validator==`function`)return e.validator;var t=Object.keys(e),n=t.indexOf(`message`);return n!==-1&&t.splice(n,1),t.length===1&&t[0]===`required`?Qp.required:Qp[this.getType(e)]||void 0}}]),e}();Jr($p,`register`,function(e,t){if(typeof t!=`function`)throw Error(`Cannot register a validator by type, validator is not a function`);Qp[e]=t}),Jr($p,`warning`,jp),Jr($p,`messages`,Ep),Jr($p,`validators`,Qp);var Nee=$p,em="'${name}' is not a valid ${type}";const tm={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:em,method:em,array:em,object:em,number:em,date:em,boolean:em,integer:em,float:em,regexp:em,email:em,url:em,hex:em},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}};var nm=Nee;function Pee(e,t){return e.replace(/\\?\$\{\w+\}/g,e=>e.startsWith(`\\`)?e.slice(1):t[e.slice(2,-1)])}var rm=`CODE_LOGIC_ERROR`;async function im(e,t,n,r,i){let a={...n};if(delete a.ruleIndex,nm.warning=()=>void 0,a.validator){let e=a.validator;a.validator=(...t)=>{try{return e(...t)}catch(e){return console.error(e),Promise.reject(rm)}}}let o=null;a&&a.type===`array`&&a.defaultField&&(o=a.defaultField,delete a.defaultField);let s=new nm({[e]:[a]}),c=ge(tm,r.validateMessages);s.messages(c);let l=[];try{await Promise.resolve(s.validate({[e]:t},{...r}))}catch(e){e.errors&&(l=e.errors.map(({message:e},t)=>{let n=e===rm?c.default:e;return y.isValidElement(n)?y.cloneElement(n,{key:`error_${t}`}):n}))}if(!l.length&&o&&Array.isArray(t)&&t.length>0)return(await Promise.all(t.map((t,n)=>im(`${e}.${n}`,t,o,r,i)))).reduce((e,t)=>[...e,...t],[]);let u={...n,name:e,enum:(n.enum||[]).join(`, `),...i};return l.map(e=>typeof e==`string`?Pee(e,u):e)}function Fee(e,t,n,r,i,a){let o=e.join(`.`),s=n.map((e,t)=>{let n=e.validator,r={...e,ruleIndex:t};return n&&(r.validator=(e,t,r)=>{let i=!1,a=n(e,t,(...e)=>{Promise.resolve().then(()=>{Ee(!i,"Your validator function has already return a promise. `callback` will be ignored."),i||r(...e)})});i=a&&typeof a.then==`function`&&typeof a.catch==`function`,Ee(i,"`callback` is deprecated. Please return a promise instead."),i&&a.then(()=>{r()}).catch(e=>{r(e||` `)})}),r}).sort(({warningOnly:e,ruleIndex:t},{warningOnly:n,ruleIndex:r})=>!!e==!!n?t-r:e?1:-1),c;if(i===!0)c=new Promise(async(e,n)=>{for(let e=0;e<s.length;e+=1){let i=s[e],c=await im(o,t,i,r,a);if(c.length){n([{errors:c,rule:i}]);return}}e([])});else{let e=s.map(e=>im(o,t,e,r,a).then(t=>({errors:t,rule:e})));c=(i?Lee(e):Iee(e)).then(e=>Promise.reject(e))}return c.catch(e=>e),c}async function Iee(e){return Promise.all(e).then(e=>[].concat(...e))}async function Lee(e){let t=0;return new Promise(n=>{e.forEach(r=>{r.then(r=>{r.errors.length&&n([r]),t+=1,t===e.length&&n([])})})})}function am(e){return Cp(e)}function om(e,t){let n={};return t.forEach(t=>{let r=le(e,t);n=de(n,t,r)}),n}function sm(e,t,n=!1){return e&&e.some(e=>cm(t,e,n))}function cm(e,t,n=!1){return!e||!t||!n&&e.length!==t.length?!1:t.every((t,n)=>e[n]===t)}function Ree(e,t){if(e===t)return!0;if(!e&&t||e&&!t||!e||!t||typeof e!=`object`||typeof t!=`object`)return!1;let n=Object.keys(e),r=Object.keys(t);return[...new Set([...n,...r])].every(n=>{let r=e[n],i=t[n];return typeof r==`function`&&typeof i==`function`?!0:r===i})}function zee(e,...t){let n=t[0];return n&&n.target&&typeof n.target==`object`&&e in n.target?n.target[e]:n}function lm(e,t,n){let{length:r}=e;if(t<0||t>=r||n<0||n>=r)return e;let i=e[t],a=t-n;return a>0?[...e.slice(0,n),i,...e.slice(n,t),...e.slice(t+1,r)]:a<0?[...e.slice(0,t),...e.slice(t+1,n+1),i,...e.slice(n+1,r)]:e}function um(){return um=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},um.apply(this,arguments)}var dm=[],fm=[];function pm(e,t,n,r,i,a){return typeof e==`function`?e(t,n,`source`in a?{source:a.source}:{}):r!==i}var Bee=class extends y.Component{static contextType=xp;state={resetCount:0};cancelRegisterFunc=null;mounted=!1;touched=!1;dirty=!1;validatePromise;prevValidating;errors=dm;warnings=fm;constructor(e){if(super(e),e.fieldContext){let{getInternalHooks:t}=e.fieldContext,{initEntityValue:n}=t(yp);n(this)}}componentDidMount(){let{shouldUpdate:e,fieldContext:t}=this.props;if(this.mounted=!0,t){let{getInternalHooks:e}=t,{registerField:n}=e(yp);this.cancelRegisterFunc=n(this)}e===!0&&this.reRender()}componentWillUnmount(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}cancelRegister=()=>{let{preserve:e,isListField:t,name:n}=this.props;this.cancelRegisterFunc&&this.cancelRegisterFunc(t,e,am(n)),this.cancelRegisterFunc=null};getNamePath=()=>{let{name:e,fieldContext:t}=this.props,{prefixName:n=[]}=t;return e===void 0?[]:[...n,...e]};getRules=()=>{let{rules:e=[],fieldContext:t}=this.props;return e.map(e=>typeof e==`function`?e(t):e)};reRender(){this.mounted&&this.forceUpdate()}refresh=()=>{this.mounted&&this.setState(({resetCount:e})=>({resetCount:e+1}))};metaCache=null;triggerMetaEvent=e=>{let{onMetaChange:t}=this.props;if(t){let n={...this.getMeta(),destroy:e};Mt(this.metaCache,n)||t(n),this.metaCache=n}else this.metaCache=null};onStoreChange=(e,t,n)=>{let{shouldUpdate:r,dependencies:i=[],onReset:a}=this.props,{store:o}=n,s=this.getNamePath(),c=this.getValue(e),l=this.getValue(o),u=t&&sm(t,s);switch(n.type===`valueUpdate`&&n.source===`external`&&!Mt(c,l)&&(this.touched=!0,this.dirty=!0,this.validatePromise=null,this.errors=dm,this.warnings=fm,this.triggerMetaEvent()),n.type){case`reset`:if(!t||u){this.touched=!1,this.dirty=!1,this.validatePromise=void 0,this.errors=dm,this.warnings=fm,this.triggerMetaEvent(),a?.(),this.refresh();return}break;case`remove`:if(r&&pm(r,e,o,c,l,n)){this.reRender();return}break;case`setField`:{let{data:i}=n;if(u){`touched`in i&&(this.touched=i.touched),`validating`in i&&!(`originRCField`in i)&&(this.validatePromise=i.validating?Promise.resolve([]):null),`errors`in i&&(this.errors=i.errors||dm),`warnings`in i&&(this.warnings=i.warnings||fm),this.dirty=!0,this.triggerMetaEvent(),this.reRender();return}else if(`value`in i&&sm(t,s,!0)){this.reRender();return}if(r&&!s.length&&pm(r,e,o,c,l,n)){this.reRender();return}break}case`dependenciesUpdate`:if(i.map(am).some(e=>sm(n.relatedFields,e))){this.reRender();return}break;default:if(u||(!i.length||s.length||r)&&pm(r,e,o,c,l,n)){this.reRender();return}break}r===!0&&this.reRender()};validateRules=e=>{let t=this.getNamePath(),n=this.getValue(),{triggerName:r,validateOnly:i=!1}=e||{},a=Promise.resolve().then(async()=>{if(!this.mounted)return[];let{validateFirst:i=!1,messageVariables:o,validateDebounce:s}=this.props,c=this.getRules();if(r&&(c=c.filter(e=>e).filter(e=>{let{validateTrigger:t}=e;return t?Cp(t).includes(r):!0})),s&&r&&(await new Promise(e=>{setTimeout(e,s)}),this.validatePromise!==a))return[];let l=Fee(t,n,c,e,i,o);return l.catch(e=>e).then((e=dm)=>{if(this.validatePromise===a){this.validatePromise=null;let t=[],n=[];e.forEach?.(({rule:{warningOnly:e},errors:r=dm})=>{e?n.push(...r):t.push(...r)}),this.errors=t,this.warnings=n,this.triggerMetaEvent(),this.reRender()}}),l});return i?a:(this.validatePromise=a,this.dirty=!0,this.errors=dm,this.warnings=fm,this.triggerMetaEvent(),this.reRender(),a)};isFieldValidating=()=>!!this.validatePromise;isFieldTouched=()=>this.touched;isFieldDirty=()=>{if(this.dirty||this.props.initialValue!==void 0)return!0;let{fieldContext:e}=this.props,{getInitialValue:t}=e.getInternalHooks(yp);return t(this.getNamePath())!==void 0};getErrors=()=>this.errors;getWarnings=()=>this.warnings;isListField=()=>this.props.isListField;isList=()=>this.props.isList;isPreserve=()=>this.props.preserve;getMeta=()=>(this.prevValidating=this.isFieldValidating(),{touched:this.isFieldTouched(),validating:this.prevValidating,errors:this.errors,warnings:this.warnings,name:this.getNamePath(),validated:this.validatePromise===null});getOnlyChild=e=>{if(typeof e==`function`){let t=this.getMeta();return{...this.getOnlyChild(e(this.getControlled(),t,this.props.fieldContext)),isFunction:!0}}let t=Oe(e);return t.length!==1||!y.isValidElement(t[0])?{child:t,isFunction:!1}:{child:t[0],isFunction:!1}};getValue=e=>{let{getFieldsValue:t}=this.props.fieldContext,n=this.getNamePath();return le(e||t(!0),n)};getControlled=(e={})=>{let{name:t,trigger:n=`onChange`,validateTrigger:r,getValueFromEvent:i,normalize:a,valuePropName:o=`value`,getValueProps:s,fieldContext:c}=this.props,l=r===void 0?c.validateTrigger:r,u=this.getNamePath(),{getInternalHooks:d,getFieldsValue:f}=c,{dispatch:p}=d(yp),m=this.getValue(),h=s||(e=>({[o]:e})),g=e[n],_=t===void 0?{}:h(m),v={...e,..._};return v[n]=(...e)=>{this.touched=!0,this.dirty=!0,this.triggerMetaEvent();let t;t=i?i(...e):zee(o,...e),a&&(t=a(t,m,f(!0))),t!==m&&p({type:`updateValue`,namePath:u,value:t}),g&&g(...e)},Cp(l||[]).forEach(e=>{let t=v[e];v[e]=(...n)=>{t&&t(...n);let{rules:r}=this.props;r&&r.length&&p({type:`validateField`,namePath:u,triggerName:e})}}),v};render(){let{resetCount:e}=this.state,{children:t}=this.props,{child:n,isFunction:r}=this.getOnlyChild(t),i;return r?i=n:y.isValidElement(n)?i=y.cloneElement(n,this.getControlled(n.props)):(Ee(!n,"`children` of Field is not validate ReactElement."),i=n),y.createElement(y.Fragment,{key:e},i)}};function Vee({name:e,...t}){let n=y.useContext(xp),r=y.useContext(Sp),i=e===void 0?void 0:am(e),a=t.isListField??!!r,o=`keep`;return a||(o=`_${(i||[]).join(`_`)}`),y.createElement(Bee,um({key:o,name:i,isListField:a},t,{fieldContext:n}))}var mm=Vee;function Hee({name:e,initialValue:t,children:n,rules:r,validateTrigger:i,isListField:a}){let o=y.useContext(xp),s=y.useContext(Sp),c=y.useRef({keys:[],id:0}).current,l=y.useMemo(()=>[...am(o.prefixName)||[],...am(e)],[o.prefixName,e]),u=y.useMemo(()=>({...o,prefixName:l}),[o,l]),d=y.useMemo(()=>({getKey:e=>{let t=l.length,n=e[t];return[c.keys[n],e.slice(t+1)]}}),[c,l]);return typeof n==`function`?y.createElement(Sp.Provider,{value:d},y.createElement(xp.Provider,{value:u},y.createElement(mm,{name:[],shouldUpdate:(e,t,{source:n})=>n===`internal`?!1:e!==t,rules:r,validateTrigger:i,initialValue:t,isList:!0,isListField:a??!!s},({value:e=[],onChange:t},r)=>{let{getFieldValue:i}=o,a=()=>i(l||[])||[],s={add:(e,n)=>{let r=a();n>=0&&n<=r.length?(c.keys=[...c.keys.slice(0,n),c.id,...c.keys.slice(n)],t([...r.slice(0,n),e,...r.slice(n)])):(c.keys=[...c.keys,c.id],t([...r,e])),c.id+=1},remove:e=>{let n=a(),r=new Set(Array.isArray(e)?e:[e]);r.size<=0||(c.keys=c.keys.filter((e,t)=>!r.has(t)),t(n.filter((e,t)=>!r.has(t))))},move(e,n){if(e===n)return;let r=a();e<0||e>=r.length||n<0||n>=r.length||(c.keys=lm(c.keys,e,n),t(lm(r,e,n)))}},u=e||[];return Array.isArray(u)||(u=[]),n(u.map((e,t)=>{let n=c.keys[t];return n===void 0&&(c.keys[t]=c.id,n=c.keys[t],c.id+=1),{name:t,key:n,isListField:!0}}),s,r)}))):(Ee(!1,`Form.List only accepts function as children.`),null)}var Uee=Hee;function Wee(e){let t=!1,n=e.length,r=[];return e.length?new Promise((i,a)=>{e.forEach((e,o)=>{e.catch(e=>(t=!0,e)).then(e=>{--n,r[o]=e,!(n>0)&&(t&&a(r),i(r))})})}):Promise.resolve([])}var hm=`__@field_split__`;function gm(e){return e.map(e=>`${typeof e}:${e}`).join(hm)}var _m=class{kvs=new Map;set(e,t){this.kvs.set(gm(e),t)}get(e){return this.kvs.get(gm(e))}update(e,t){let n=t(this.get(e));n?this.set(e,n):this.delete(e)}delete(e){this.kvs.delete(gm(e))}map(e){return[...this.kvs.entries()].map(([t,n])=>e({key:t.split(hm).map(e=>{let[,t,n]=e.match(/^([^:]*):(.*)$/);return t===`number`?Number(n):n}),value:n}))}toJSON(){let e={};return this.map(({key:t,value:n})=>(e[t.join(`.`)]=n,null)),e}},Gee=class{formHooked=!1;forceRootUpdate;subscribable=!0;store={};fieldEntities=[];initialValues={};callbacks={};validateMessages=null;preserve=null;lastValidatePromise=null;constructor(e){this.forceRootUpdate=e}getForm=()=>({getFieldValue:this.getFieldValue,getFieldsValue:this.getFieldsValue,getFieldError:this.getFieldError,getFieldWarning:this.getFieldWarning,getFieldsError:this.getFieldsError,isFieldsTouched:this.isFieldsTouched,isFieldTouched:this.isFieldTouched,isFieldValidating:this.isFieldValidating,isFieldsValidating:this.isFieldsValidating,resetFields:this.resetFields,setFields:this.setFields,setFieldValue:this.setFieldValue,setFieldsValue:this.setFieldsValue,validateFields:this.validateFields,submit:this.submit,_init:!0,getInternalHooks:this.getInternalHooks});getInternalHooks=e=>e===`RC_FORM_INTERNAL_HOOKS`?(this.formHooked=!0,{dispatch:this.dispatch,initEntityValue:this.initEntityValue,registerField:this.registerField,useSubscribe:this.useSubscribe,setInitialValues:this.setInitialValues,destroyForm:this.destroyForm,setCallbacks:this.setCallbacks,setValidateMessages:this.setValidateMessages,getFields:this.getFields,setPreserve:this.setPreserve,getInitialValue:this.getInitialValue,registerWatch:this.registerWatch,setBatchUpdate:this.setBatchUpdate}):(Ee(!1,"`getInternalHooks` is internal usage. Should not call directly."),null);useSubscribe=e=>{this.subscribable=e};prevWithoutPreserves=null;setInitialValues=(e,t)=>{if(this.initialValues=e||{},t){let t=ge(e,this.store);this.prevWithoutPreserves?.map(({key:n})=>{t=de(t,n,le(e,n))}),this.prevWithoutPreserves=null,this.updateStore(t)}};destroyForm=e=>{if(e)this.updateStore({});else{let e=new _m;this.getFieldEntities(!0).forEach(t=>{this.isMergedPreserve(t.isPreserve())||e.set(t.getNamePath(),!0)}),this.prevWithoutPreserves=e}};getInitialValue=e=>{let t=le(this.initialValues,e);return e.length?ge(t):t};setCallbacks=e=>{this.callbacks=e};setValidateMessages=e=>{this.validateMessages=e};setPreserve=e=>{this.preserve=e};watchList=[];registerWatch=e=>(this.watchList.push(e),()=>{this.watchList=this.watchList.filter(t=>t!==e)});notifyWatch=(e=[])=>{if(this.watchList.length){let t=this.getFieldsValue(),n=this.getFieldsValue(!0);this.watchList.forEach(r=>{r(t,n,e)})}};notifyWatchNamePathList=[];batchNotifyWatch=e=>{this.notifyWatchNamePathList.push(e),this.batch(`notifyWatch`,()=>{this.notifyWatch(this.notifyWatchNamePathList),this.notifyWatchNamePathList=[]})};batchUpdate;setBatchUpdate=e=>{this.batchUpdate=e};batch=(e,t)=>{this.batchUpdate(e,t)};timeoutId=null;warningUnhooked=()=>{};updateStore=e=>{this.store=e};getFieldEntities=(e=!1)=>e?this.fieldEntities.filter(e=>e.getNamePath().length):this.fieldEntities;getFieldsMap=(e=!1)=>{let t=new _m;return this.getFieldEntities(e).forEach(e=>{let n=e.getNamePath();t.set(n,e)}),t};getFieldEntitiesForNamePathList=e=>{if(!e)return this.getFieldEntities(!0);let t=this.getFieldsMap(!0);return e.map(e=>{let n=am(e);return t.get(n)||{INVALIDATE_NAME_PATH:am(e)}})};getFieldsValue=(e,t)=>{this.warningUnhooked();let n,r;if(e===!0||Array.isArray(e)?(n=e,r=t):e&&typeof e==`object`&&(r=e.filter),n===!0&&!r)return this.store;let i=this.getFieldEntitiesForNamePathList(Array.isArray(n)?n:null),a=[],o=[];i.forEach(e=>{let t=e.INVALIDATE_NAME_PATH||e.getNamePath();if(e.isList?.()){o.push(t);return}if(!r)a.push(t);else{let n=`getMeta`in e?e.getMeta():null;r(n)&&a.push(t)}});let s=om(this.store,a.map(am));return o.forEach(e=>{le(s,e)||(s=de(s,e,[]))}),s};getFieldValue=e=>{this.warningUnhooked();let t=am(e);return le(this.store,t)};getFieldsError=e=>(this.warningUnhooked(),this.getFieldEntitiesForNamePathList(e).map((t,n)=>t&&!t.INVALIDATE_NAME_PATH?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:am(e[n]),errors:[],warnings:[]}));getFieldError=e=>{this.warningUnhooked();let t=am(e);return this.getFieldsError([t])[0].errors};getFieldWarning=e=>{this.warningUnhooked();let t=am(e);return this.getFieldsError([t])[0].warnings};isFieldsTouched=(...e)=>{this.warningUnhooked();let[t,n]=e,r,i=!1;e.length===0?r=null:e.length===1?Array.isArray(t)?(r=t.map(am),i=!1):(r=null,i=t):(r=t.map(am),i=n);let a=this.getFieldEntities(!0),o=e=>e.isFieldTouched();if(!r)return i?a.every(e=>o(e)||e.isList()):a.some(o);let s=new _m;r.forEach(e=>{s.set(e,[])}),a.forEach(e=>{let t=e.getNamePath();r.forEach(n=>{n.every((e,n)=>t[n]===e)&&s.update(n,t=>[...t,e])})});let c=e=>e.some(o),l=s.map(({value:e})=>e);return i?l.every(c):l.some(c)};isFieldTouched=e=>(this.warningUnhooked(),this.isFieldsTouched([e]));isFieldsValidating=e=>{this.warningUnhooked();let t=this.getFieldEntities();if(!e)return t.some(e=>e.isFieldValidating());let n=e.map(am);return t.some(e=>sm(n,e.getNamePath())&&e.isFieldValidating())};isFieldValidating=e=>(this.warningUnhooked(),this.isFieldsValidating([e]));resetWithFieldInitialValue=(e={})=>{let t=new _m,n=this.getFieldEntities(!0);n.forEach(e=>{let{initialValue:n}=e.props,r=e.getNamePath();if(n!==void 0){let i=t.get(r)||new Set;i.add({entity:e,value:n}),t.set(r,i)}});let r=n=>{n.forEach(n=>{let{initialValue:r}=n.props;if(r!==void 0){let r=n.getNamePath();if(this.getInitialValue(r)!==void 0)Ee(!1,`Form already set 'initialValues' with path '${r.join(`.`)}'. Field can not overwrite it.`);else{let i=t.get(r);if(i&&i.size>1)Ee(!1,`Multiple Field with path '${r.join(`.`)}' set 'initialValue'. Can not decide which one to pick.`);else if(i){let t=this.getFieldValue(r);!n.isListField()&&(!e.skipExist||t===void 0)&&this.updateStore(de(this.store,r,[...i][0].value))}}}})},i;e.entities?i=e.entities:e.namePathList?(i=[],e.namePathList.forEach(e=>{let n=t.get(e);n&&i.push(...[...n].map(e=>e.entity))})):i=n,r(i)};resetFields=e=>{this.warningUnhooked();let t=this.store;if(!e){this.updateStore(ge(this.initialValues)),this.resetWithFieldInitialValue(),this.notifyObservers(t,null,{type:`reset`}),this.notifyWatch();return}let n=e.map(am);n.forEach(e=>{let t=this.getInitialValue(e);this.updateStore(de(this.store,e,t))}),this.resetWithFieldInitialValue({namePathList:n}),this.notifyObservers(t,n,{type:`reset`}),this.notifyWatch(n)};setFields=e=>{this.warningUnhooked();let t=this.store,n=[];e.forEach(e=>{let{name:r,...i}=e,a=am(r);n.push(a),`value`in i&&this.updateStore(de(this.store,a,i.value)),this.notifyObservers(t,[a],{type:`setField`,data:e})}),this.notifyWatch(n)};getFields=()=>this.getFieldEntities(!0).map(e=>{let t=e.getNamePath(),n={...e.getMeta(),name:t,value:this.getFieldValue(t)};return Object.defineProperty(n,`originRCField`,{value:!0}),n});initEntityValue=e=>{let{initialValue:t}=e.props;if(t!==void 0){let n=e.getNamePath();le(this.store,n)===void 0&&this.updateStore(de(this.store,n,t))}};isMergedPreserve=e=>(e===void 0?this.preserve:e)??!0;registerField=e=>{this.fieldEntities.push(e);let t=e.getNamePath();if(this.batchNotifyWatch(t),e.props.initialValue!==void 0){let t=this.store;this.resetWithFieldInitialValue({entities:[e],skipExist:!0}),this.notifyObservers(t,[e.getNamePath()],{type:`valueUpdate`,source:`internal`})}return(n,r,i=[])=>{if(this.fieldEntities=this.fieldEntities.filter(t=>t!==e),!this.isMergedPreserve(r)&&(!n||i.length>1)){let e=n?void 0:this.getInitialValue(t);if(t.length&&this.getFieldValue(t)!==e&&this.fieldEntities.every(e=>!cm(e.getNamePath(),t))){let n=this.store;this.updateStore(de(n,t,e,!0)),this.notifyObservers(n,[t],{type:`remove`}),this.triggerDependenciesUpdate(n,t)}}this.batchNotifyWatch(t)}};dispatch=e=>{switch(e.type){case`updateValue`:{let{namePath:t,value:n}=e;this.updateValue(t,n);break}case`validateField`:{let{namePath:t,triggerName:n}=e;this.validateFields([t],{triggerName:n});break}default:}};notifyObservers=(e,t,n)=>{if(this.subscribable){let r={...n,store:this.getFieldsValue(!0)};this.getFieldEntities().forEach(({onStoreChange:n})=>{n(e,t,r)})}else this.forceRootUpdate()};triggerDependenciesUpdate=(e,t)=>{let n=this.getDependencyChildrenFields(t);return n.length&&this.validateFields(n),this.notifyObservers(e,n,{type:`dependenciesUpdate`,relatedFields:[t,...n]}),n};updateValue=(e,t)=>{let n=am(e),r=this.store;this.updateStore(de(this.store,n,t)),this.notifyObservers(r,[n],{type:`valueUpdate`,source:`internal`}),this.notifyWatch([n]);let i=this.triggerDependenciesUpdate(r,n),{onValuesChange:a}=this.callbacks;if(a){let e=om(this.store,[n]);a(e,ge(this.getFieldsValue(),e))}this.triggerOnFieldsChange([n,...i])};setFieldsValue=e=>{this.warningUnhooked();let t=this.store;if(e){let t=ge(this.store,e);this.updateStore(t)}this.notifyObservers(t,null,{type:`valueUpdate`,source:`external`}),this.notifyWatch()};setFieldValue=(e,t)=>{this.setFields([{name:e,value:t,errors:[],warnings:[],touched:!0}])};getDependencyChildrenFields=e=>{let t=new Set,n=[],r=new _m;this.getFieldEntities().forEach(e=>{let{dependencies:t}=e.props;(t||[]).forEach(t=>{let n=am(t);r.update(n,(t=new Set)=>(t.add(e),t))})});let i=e=>{(r.get(e)||new Set).forEach(e=>{if(!t.has(e)){t.add(e);let r=e.getNamePath();e.isFieldDirty()&&r.length&&(n.push(r),i(r))}})};return i(e),n};triggerOnFieldsChange=(e,t)=>{let{onFieldsChange:n}=this.callbacks;if(n){let r=this.getFields();if(t){let e=new _m;t.forEach(({name:t,errors:n})=>{e.set(t,n)}),r.forEach(t=>{t.errors=e.get(t.name)||t.errors})}let i=r.filter(({name:t})=>sm(e,t));i.length&&n(i,r)}};validateFields=(e,t)=>{this.warningUnhooked();let n,r;Array.isArray(e)||typeof e==`string`||typeof t==`string`?(n=e,r=t):r=e;let i=!!n,a=i?n.map(am):[],o=[...a],s=[],c=String(Date.now()),l=new Set,{recursive:u,dirty:d}=r||{};this.getFieldEntities(!0).forEach(e=>{let t=e.getNamePath();if(i||((!e.isList()||!a.some(e=>cm(e,t,!0)))&&o.push(t),a.push(t)),!(!e.props.rules||!e.props.rules.length)&&!(d&&!e.isFieldDirty())&&(l.add(t.join(c)),!i||sm(a,t,u))){let n=e.validateRules({validateMessages:{...tm,...this.validateMessages},...r});s.push(n.then(()=>({name:t,errors:[],warnings:[]})).catch(e=>{let n=[],r=[];return e.forEach?.(({rule:{warningOnly:e},errors:t})=>{e?r.push(...t):n.push(...t)}),n.length?Promise.reject({name:t,errors:n,warnings:r}):{name:t,errors:n,warnings:r}}))}});let f=Wee(s);this.lastValidatePromise=f,f.catch(e=>e).then(e=>{let t=e.map(({name:e})=>e);this.notifyObservers(this.store,t,{type:`validateFinish`}),this.triggerOnFieldsChange(t,e)});let p=f.then(()=>this.lastValidatePromise===f?Promise.resolve(this.getFieldsValue(o)):Promise.reject([])).catch(e=>{let t=e.filter(e=>e&&e.errors.length),n=t[0]?.errors?.[0];return Promise.reject({message:n,values:this.getFieldsValue(a),errorFields:t,outOfDate:this.lastValidatePromise!==f})});p.catch(e=>e);let m=a.filter(e=>l.has(e.join(c)));return this.triggerOnFieldsChange(m),p};submit=()=>{this.warningUnhooked(),this.validateFields().then(e=>{let{onFinish:t}=this.callbacks;if(t)try{t(e)}catch(e){console.error(e)}}).catch(e=>{let{onFinishFailed:t}=this.callbacks;t&&t(e)})}};function Kee(e){let t=y.useRef(null),[,n]=y.useState({});return t.current||(e?t.current=e:t.current=new Gee(()=>{n({})}).getForm()),[t.current]}var qee=Kee,vm=y.createContext({triggerFormChange:()=>{},triggerFormFinish:()=>{},registerForm:()=>{},unregisterForm:()=>{}}),Jee=({validateMessages:e,onFormChange:t,onFormFinish:n,children:r})=>{let i=y.useContext(vm),a=y.useRef({});return y.createElement(vm.Provider,{value:{...i,validateMessages:{...i.validateMessages,...e},triggerFormChange:(e,n)=>{t&&t(e,{changedFields:n,forms:a.current}),i.triggerFormChange(e,n)},triggerFormFinish:(e,t)=>{n&&n(e,{values:t,forms:a.current}),i.triggerFormFinish(e,t)},registerForm:(e,t)=>{e&&(a.current={...a.current,[e]:t}),i.registerForm(e,t)},unregisterForm:e=>{let t={...a.current};delete t[e],a.current=t,i.unregisterForm(e)}}},r)},Yee=vm,Xee=y.forwardRef((e,t)=>{let[n,r]=y.useState({});return y.useLayoutEffect(()=>{let e=Object.keys(n);e.length&&(e.forEach(e=>{n[e]?.()}),r({}))},[n]),y.useImperativeHandle(t,()=>({batch:(e,t)=>{r(n=>({...n,[e]:t}))}})),null});function ym(){return ym=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ym.apply(this,arguments)}var Zee=({name:e,initialValues:t,fields:n,form:r,preserve:i,children:a,component:o=`form`,validateMessages:s,validateTrigger:c=`onChange`,onValuesChange:l,onFieldsChange:u,onFinish:d,onFinishFailed:f,clearOnDestroy:p,...m},h)=>{let g=y.useRef(null),_=y.useContext(Yee),[v]=qee(r),{useSubscribe:b,setInitialValues:x,setCallbacks:S,setValidateMessages:C,setPreserve:w,destroyForm:T,setBatchUpdate:E}=v.getInternalHooks(yp);y.useImperativeHandle(h,()=>({...v,nativeElement:g.current})),y.useEffect(()=>(_.registerForm(e,v),()=>{_.unregisterForm(e)}),[_,v,e]),C({..._.validateMessages,...s}),S({onValuesChange:l,onFieldsChange:(t,...n)=>{_.triggerFormChange(e,t),u&&u(t,...n)},onFinish:t=>{_.triggerFormFinish(e,t),d&&d(t)},onFinishFailed:f}),w(i);let D=y.useRef(null);x(t,!D.current),D.current||=!0;let O=y.useRef(null),k=y.useRef([]),A=()=>{O.current&&(k.current.forEach(([e,t])=>{O.current.batch(e,t)}),k.current=[])},j=y.useCallback(e=>{O.current=e,A()},[]);E((e,t)=>{k.current.push([e,t]),A()}),y.useEffect(()=>()=>T(p),[]);let M,N=typeof a==`function`;M=N?a(v.getFieldsValue(!0),v):a,b(!N);let ee=y.useRef(null);y.useEffect(()=>{Ree(ee.current||[],n||[])||v.setFields(n||[]),ee.current=n},[n,v]);let te=y.useMemo(()=>({...v,validateTrigger:c}),[v,c]),P=y.createElement(Sp.Provider,{value:null},y.createElement(xp.Provider,{value:te},M),y.createElement(Xee,{ref:j}));return o===!1?P:y.createElement(o,ym({},m,{ref:g,onSubmit:e=>{e.preventDefault(),e.stopPropagation(),v.submit()},onReset:e=>{e.preventDefault(),v.resetFields(),m.onReset?.(e)}}),P)};function bm(e){try{return JSON.stringify(e)}catch{return Math.random()}}function Qee(...e){let[t,n={}]=e,r=wp(n)?{form:n}:n,i=r.form,[a,o]=(0,y.useState)(()=>typeof t==`function`?t({}):void 0),s=(0,y.useMemo)(()=>bm(a),[a]),c=(0,y.useRef)(s);c.current=s;let l=(0,y.useContext)(xp),u=i||l,d=u&&u._init,{getFieldsValue:f,getInternalHooks:p}=u,{registerWatch:m}=p(yp),h=x((e,n)=>{let i=r.preserve?n??f(!0):e??f(),s=typeof t==`function`?t(i):le(i,am(t));bm(a)!==bm(s)&&o(s)});return(0,y.useEffect)(()=>{d&&h()},[d,typeof t==`function`?t:JSON.stringify(t)]),(0,y.useEffect)(()=>{if(d)return m((e,t)=>{h(e,t)})},[d]),a}var $ee=Qee,xm=y.forwardRef(Zee);xm.FormProvider=Jee,xm.Field=mm,xm.List=Uee,xm.useForm=qee,xm.useWatch=$ee;const Sm=y.createContext({}),ete=({children:e,status:t,override:n})=>{let r=y.useContext(Sm),i=y.useMemo(()=>{let e={...r};return n&&delete e.isFormItemInput,t&&(delete e.status,delete e.hasFeedback,delete e.feedbackIcon),e},[t,n,r]);return y.createElement(Sm.Provider,{value:i},e)},tte=y.createContext(void 0);var Cm=e=>{let{space:t,form:n,children:r}=e;if(!gc(r))return null;let i=r;return n&&(i=y.createElement(ete,{override:!0,status:!0},i)),t&&(i=y.createElement(md,null,i)),i},nte=e=>{if(S()&&window.document.documentElement){let t=Array.isArray(e)?e:[e],{documentElement:n}=window.document;return t.some(e=>e in n.style)}return!1},rte=(e,t)=>{if(!nte(e))return!1;let n=document.createElement(`div`),r=n.style[e];return n.style[e]=t,n.style[e]!==r};function ite(e,t){return!Array.isArray(e)&&t!==void 0?rte(e,t):nte(e)}const ate=()=>S()&&window.document.documentElement;var wm=e=>{let{prefixCls:t,className:n,style:r,size:i,shape:a}=e,o=F({[`${t}-lg`]:i===`large`,[`${t}-sm`]:i===`small`}),s=F({[`${t}-circle`]:a===`circle`,[`${t}-square`]:a===`square`,[`${t}-round`]:a===`round`}),c=y.useMemo(()=>typeof i==`number`?{width:i,height:i,lineHeight:`${i}px`}:{},[i]);return y.createElement(`span`,{className:F(t,o,s,n),style:{...c,...r}})},ote=new Br(`ant-skeleton-loading`,{"0%":{backgroundPosition:`100% 50%`},"100%":{backgroundPosition:`0 50%`}}),Tm=e=>({height:e,lineHeight:tn(e)}),Em=e=>({width:e,...Tm(e)}),ste=e=>({background:e.skeletonLoadingBackground,backgroundSize:`400% 100%`,animationName:ote,animationDuration:e.skeletonLoadingMotionDuration,animationTimingFunction:`ease`,animationIterationCount:`infinite`}),Dm=(e,t)=>({width:t(e).mul(5).equal(),minWidth:t(e).mul(5).equal(),...Tm(e)}),cte=e=>{let{skeletonAvatarCls:t,gradientFromColor:n,controlHeight:r,controlHeightLG:i,controlHeightSM:a}=e;return{[t]:{display:`inline-block`,verticalAlign:`top`,background:n,...Em(r)},[`${t}${t}-circle`]:{borderRadius:`50%`},[`${t}${t}-lg`]:{...Em(i)},[`${t}${t}-sm`]:{...Em(a)}}},lte=e=>{let{controlHeight:t,borderRadiusSM:n,skeletonInputCls:r,controlHeightLG:i,controlHeightSM:a,gradientFromColor:o,calc:s}=e;return{[r]:{display:`inline-block`,verticalAlign:`top`,background:o,borderRadius:n,...Dm(t,s)},[`${r}-lg`]:{...Dm(i,s)},[`${r}-sm`]:{...Dm(a,s)}}},ute=e=>{let{gradientFromColor:t,borderRadiusSM:n,imageSizeBase:r,calc:i}=e;return{display:`inline-flex`,alignItems:`center`,justifyContent:`center`,verticalAlign:`middle`,background:t,borderRadius:n,...Em(i(r).mul(2).equal())}},dte=e=>({[e.skeletonNodeCls]:{...ute(e)}}),fte=e=>{let{skeletonImageCls:t,imageSizeBase:n,calc:r}=e;return{[t]:{...ute(e),[`${t}-path`]:{fill:`#bfbfbf`},[`${t}-svg`]:{...Em(n),maxWidth:r(n).mul(4).equal(),maxHeight:r(n).mul(4).equal()},[`${t}-svg${t}-svg-circle`]:{borderRadius:`50%`}},[`${t}${t}-circle`]:{borderRadius:`50%`}}},Om=(e,t,n)=>{let{skeletonButtonCls:r}=e;return{[`${n}${r}-circle`]:{width:t,minWidth:t,borderRadius:`50%`},[`${n}${r}-round`]:{borderRadius:t}}},km=(e,t)=>({width:t(e).mul(2).equal(),minWidth:t(e).mul(2).equal(),...Tm(e)}),pte=e=>{let{borderRadiusSM:t,skeletonButtonCls:n,controlHeight:r,controlHeightLG:i,controlHeightSM:a,gradientFromColor:o,calc:s}=e;return{[n]:{display:`inline-block`,verticalAlign:`top`,background:o,borderRadius:t,width:s(r).mul(2).equal(),minWidth:s(r).mul(2).equal(),...km(r,s)},...Om(e,r,n),[`${n}-lg`]:{...km(i,s)},...Om(e,i,`${n}-lg`),[`${n}-sm`]:{...km(a,s)},...Om(e,a,`${n}-sm`)}},mte=e=>{let{componentCls:t,skeletonAvatarCls:n,skeletonTitleCls:r,skeletonParagraphCls:i,skeletonButtonCls:a,skeletonInputCls:o,skeletonNodeCls:s,skeletonImageCls:c,controlHeight:l,controlHeightLG:u,controlHeightSM:d,gradientFromColor:f,padding:p,marginSM:m,borderRadius:h,titleHeight:g,blockRadius:_,paragraphLiHeight:v,controlHeightXS:y,paragraphMarginTop:b}=e;return{[t]:{display:`table`,width:`100%`,[`${t}-header`]:{display:`table-cell`,paddingInlineEnd:p,verticalAlign:`top`,[n]:{display:`inline-block`,verticalAlign:`top`,background:f,...Em(l)},[`${n}-circle`]:{borderRadius:`50%`},[`${n}-lg`]:{...Em(u)},[`${n}-sm`]:{...Em(d)}},[`${t}-section`]:{display:`table-cell`,width:`100%`,verticalAlign:`top`,[r]:{width:`100%`,height:g,background:f,borderRadius:_,[`+ ${i}`]:{marginBlockStart:d}},[i]:{padding:0,"> li":{width:`100%`,height:v,listStyle:`none`,background:f,borderRadius:_,"+ li":{marginBlockStart:y}}},[`${i}> li:last-child:not(:first-child):not(:nth-child(2))`]:{width:`61%`}},[`&-round ${t}-section`]:{[`${r}, ${i} > li`]:{borderRadius:h}}},[`${t}-with-avatar ${t}-section`]:{[r]:{marginBlockStart:m,[`+ ${i}`]:{marginBlockStart:b}}},[`${t}${t}-element`]:{display:`inline-block`,width:`auto`,...pte(e),...cte(e),...lte(e),...dte(e),...fte(e)},[`${t}${t}-block`]:{width:`100%`,[a]:{width:`100%`},[o]:{width:`100%`}},[`${t}${t}-active`]:{[`
        ${r},
        ${i} > li,
        ${n},
        ${a},
        ${o},
        ${s},
        ${c}
      `]:{...ste(e)}}}},Am=fo(`Skeleton`,e=>{let{componentCls:t,calc:n}=e;return mte(yi(e,{skeletonAvatarCls:`${t}-avatar`,skeletonTitleCls:`${t}-title`,skeletonParagraphCls:`${t}-paragraph`,skeletonButtonCls:`${t}-button`,skeletonInputCls:`${t}-input`,skeletonNodeCls:`${t}-node`,skeletonImageCls:`${t}-image`,imageSizeBase:n(e.controlHeight).mul(1.5).equal(),borderRadius:100,skeletonLoadingBackground:`linear-gradient(90deg, ${e.gradientFromColor} 25%, ${e.gradientToColor} 37%, ${e.gradientFromColor} 63%)`,skeletonLoadingMotionDuration:`1.4s`}))},e=>{let{colorFillContent:t,colorFill:n}=e,r=t,i=n;return{color:r,colorGradientEnd:i,gradientFromColor:r,gradientToColor:i,titleHeight:e.controlHeight/2,blockRadius:e.borderRadiusSM,paragraphMarginTop:e.marginLG+e.marginXXS,paragraphLiHeight:e.controlHeight/2}},{deprecatedTokens:[[`color`,`gradientFromColor`],[`colorGradientEnd`,`gradientToColor`]]}),hte=e=>{let{prefixCls:t,className:n,classNames:r,rootClassName:i,active:a,style:o,styles:s,shape:c=`circle`,size:l=`default`,...u}=e,{getPrefixCls:d}=y.useContext(dt),f=d(`skeleton`,t),[p,m]=Am(f),h=F(f,`${f}-element`,{[`${f}-active`]:a},r?.root,n,i,p,m);return y.createElement(`div`,{className:h,style:s?.root},y.createElement(wm,{prefixCls:`${f}-avatar`,className:r?.content,style:{...s?.content,...o},shape:c,size:l,...u}))},gte=e=>{let{prefixCls:t,className:n,rootClassName:r,classNames:i,active:a,style:o,styles:s,block:c=!1,size:l=`default`,...u}=e,{getPrefixCls:d}=y.useContext(dt),f=d(`skeleton`,t),[p,m]=Am(f),h=F(f,`${f}-element`,{[`${f}-active`]:a,[`${f}-block`]:c},i?.root,n,r,p,m);return y.createElement(`div`,{className:h,style:s?.root},y.createElement(wm,{prefixCls:`${f}-button`,className:i?.content,style:{...s?.content,...o},size:l,...u}))},_te=e=>{let{prefixCls:t,className:n,classNames:r,rootClassName:i,internalClassName:a,style:o,styles:s,active:c,children:l}=e,{getPrefixCls:u}=y.useContext(dt),d=u(`skeleton`,t),[f,p]=Am(d),m=F(d,`${d}-element`,{[`${d}-active`]:c},f,r?.root,n,i,p);return y.createElement(`div`,{className:m,style:s?.root},y.createElement(`div`,{className:F(r?.content,a||`${d}-node`),style:{...s?.content,...o}},l))},vte=`M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z`,yte=e=>{let{getPrefixCls:t}=y.useContext(dt),n=t(`skeleton`,e.prefixCls);return y.createElement(_te,{...e,internalClassName:`${n}-image`},y.createElement(`svg`,{viewBox:`0 0 1098 1024`,xmlns:`http://www.w3.org/2000/svg`,className:`${n}-image-svg`},y.createElement(`title`,null,`Image placeholder`),y.createElement(`path`,{d:vte,className:`${n}-image-path`})))},bte=e=>{let{prefixCls:t,className:n,classNames:r,rootClassName:i,active:a,block:o,style:s,styles:c,size:l=`default`,...u}=e,{getPrefixCls:d}=y.useContext(dt),f=d(`skeleton`,t),[p,m]=Am(f),h=F(f,`${f}-element`,{[`${f}-active`]:a,[`${f}-block`]:o},r?.root,n,i,p,m);return y.createElement(`div`,{className:h,style:c?.root},y.createElement(wm,{prefixCls:`${f}-input`,className:r?.content,style:{...c?.content,...s},size:l,...u}))},xte=(e,t)=>{let{width:n,rows:r=2}=t;if(Array.isArray(n))return n[e];if(r-1===e)return n},Ste=e=>{let{prefixCls:t,className:n,style:r,rows:i=0}=e,a=Array.from({length:i}).map((t,n)=>y.createElement(`li`,{key:n,style:{width:xte(n,e)}}));return y.createElement(`ul`,{className:F(t,n),style:r},a)},Cte=({prefixCls:e,className:t,width:n,style:r})=>y.createElement(`h3`,{className:F(e,t),style:{width:n,...r}});function jm(e){return e&&typeof e==`object`?e:{}}function wte(e,t){return e&&!t?{size:`large`,shape:`square`}:{size:`large`,shape:`circle`}}function Tte(e,t){return!e&&t?{width:`38%`}:e&&t?{width:`50%`}:{}}function Ete(e,t){let n={};return(!e||!t)&&(n.width=`61%`),!e&&t?n.rows=3:n.rows=2,n}var Mm=e=>{let{prefixCls:t,loading:n,className:r,rootClassName:i,classNames:a,style:o,styles:s,children:c,avatar:l=!1,title:u=!0,paragraph:d=!0,active:f,round:p}=e,{getPrefixCls:m,direction:h,className:g,style:_,classNames:v,styles:b}=mt(`skeleton`),x=m(`skeleton`,t),[S,C]=Am(x),w={...e,avatar:l,title:u,paragraph:d},[T,E]=Nc([v,a],[b,s],{props:w});if(n||!(`loading`in e)){let e=!!l,t=!!u,n=!!d,a;if(e){let e={className:T.avatar,prefixCls:`${x}-avatar`,...wte(t,n),...jm(l),style:E.avatar};a=y.createElement(`div`,{className:F(T.header,`${x}-header`),style:E.header},y.createElement(wm,{...e}))}let s;if(t||n){let r;if(t){let t={className:T.title,prefixCls:`${x}-title`,...Tte(e,n),...jm(u),style:E.title};r=y.createElement(Cte,{...t})}let i;if(n){let n={className:T.paragraph,prefixCls:`${x}-paragraph`,...Ete(e,t),...jm(d),style:E.paragraph};i=y.createElement(Ste,{...n})}s=y.createElement(`div`,{className:F(T.section,`${x}-section`),style:E.section},r,i)}let c=F(x,{[`${x}-with-avatar`]:e,[`${x}-active`]:f,[`${x}-rtl`]:h===`rtl`,[`${x}-round`]:p},T.root,g,r,i,S,C);return y.createElement(`div`,{className:c,style:{...E.root,..._,...o}},a,s)}return c??null};Mm.Button=gte,Mm.Avatar=hte,Mm.Input=bte,Mm.Image=yte,Mm.Node=_te;var Nm=Mm;function Pm(){}var Dte=y.createContext({add:Pm,remove:Pm});function Ote(e){let t=y.useContext(Dte),n=y.useRef(null);return x(r=>{if(r){let i=e?r.querySelector(e):r;i&&(t.add(i),n.current=i)}else t.remove(n.current)})}var Fm=()=>{let{cancelButtonProps:e,cancelTextLocale:t,onCancel:n}=(0,y.useContext)(Qf);return y.createElement(Yf,{onClick:n,...e},t)},Im=()=>{let{confirmLoading:e,okButtonProps:t,okType:n,okTextLocale:r,onOk:i}=(0,y.useContext)(Qf);return y.createElement(Yf,{...xd(n),loading:e,onClick:i,...t},r)};function kte(e,t){return y.createElement(`span`,{className:`${e}-close-x`},t||y.createElement(Jo,{className:`${e}-close-icon`}))}const Ate=e=>{let{okText:t,okType:n=`primary`,cancelText:r,confirmLoading:i,onOk:a,onCancel:o,okButtonProps:s,cancelButtonProps:c,footer:l}=e,[u]=fc(`Modal`,uc()),d=t||u?.okText,f=r||u?.cancelText,p=y.useMemo(()=>({confirmLoading:i,okButtonProps:s,cancelButtonProps:c,okTextLocale:d,cancelTextLocale:f,okType:n,onOk:a,onCancel:o}),[i,s,c,d,f,n,a,o]),m;return typeof l==`function`||l===void 0?(m=y.createElement(y.Fragment,null,y.createElement(Fm,null),y.createElement(Im,null)),typeof l==`function`&&(m=l(m,{OkBtn:Im,CancelBtn:Fm})),m=y.createElement($f,{value:p},m)):m=l,y.createElement(Zl,{disabled:!1},m)};var jte=e=>{let{componentCls:t}=e;return{[t]:{display:`flex`,flexFlow:`row wrap`,minWidth:0,"&::before, &::after":{display:`flex`},"&-no-wrap":{flexWrap:`nowrap`},"&-start":{justifyContent:`flex-start`},"&-center":{justifyContent:`center`},"&-end":{justifyContent:`flex-end`},"&-space-between":{justifyContent:`space-between`},"&-space-around":{justifyContent:`space-around`},"&-space-evenly":{justifyContent:`space-evenly`},"&-top":{alignItems:`flex-start`},"&-middle":{alignItems:`center`},"&-bottom":{alignItems:`flex-end`}}}},Mte=e=>{let{componentCls:t}=e;return{[t]:{position:`relative`,maxWidth:`100%`,minHeight:1}}},Nte=(e,t)=>{let{prefixCls:n,componentCls:r,gridColumns:i}=e,a={};for(let e=i;e>=0;e--)e===0?(a[`${r}${t}-${e}`]={display:`none`},a[`${r}-push-${e}`]={insetInlineStart:`auto`},a[`${r}-pull-${e}`]={insetInlineEnd:`auto`},a[`${r}${t}-push-${e}`]={insetInlineStart:`auto`},a[`${r}${t}-pull-${e}`]={insetInlineEnd:`auto`},a[`${r}${t}-offset-${e}`]={marginInlineStart:0},a[`${r}${t}-order-${e}`]={order:0}):(a[`${r}${t}-${e}`]=[{"--ant-display":`block`,display:`block`},{display:`var(--ant-display)`,flex:`0 0 ${e/i*100}%`,maxWidth:`${e/i*100}%`}],a[`${r}${t}-push-${e}`]={insetInlineStart:`${e/i*100}%`},a[`${r}${t}-pull-${e}`]={insetInlineEnd:`${e/i*100}%`},a[`${r}${t}-offset-${e}`]={marginInlineStart:`${e/i*100}%`},a[`${r}${t}-order-${e}`]={order:e});return a[`${r}${t}-flex`]={flex:`var(--${n}${t}-flex)`},a},Lm=(e,t)=>Nte(e,t),Pte=(e,t,n)=>({[`@media (min-width: ${tn(t)})`]:{...Lm(e,n)}});const Fte=()=>({}),Ite=()=>({});fo(`Grid`,jte,Fte);const Rm=e=>({xs:e.screenXSMin,sm:e.screenSMMin,md:e.screenMDMin,lg:e.screenLGMin,xl:e.screenXLMin,xxl:e.screenXXLMin});fo(`Grid`,e=>{let t=yi(e,{gridColumns:24}),n=Rm(t);return delete n.xs,[Mte(t),Lm(t,``),Lm(t,`-xs`),Object.keys(n).map(e=>Pte(t,n[e],`-${e}`)).reduce((e,t)=>({...e,...t}),{})]},Ite);function zm(e){return{position:e,inset:0}}const Lte=e=>{let{componentCls:t,antCls:n}=e;return[{[`${t}-root`]:{[`${t}${n}-zoom-enter, ${t}${n}-zoom-appear`]:{transform:`none`,opacity:0,animationDuration:e.motionDurationSlow,userSelect:`none`},[`${t}${n}-zoom-leave ${t}-container`]:{pointerEvents:`none`},[`${t}-mask`]:{...zm(`fixed`),zIndex:e.zIndexPopupBase,height:`100%`,backgroundColor:e.colorBgMask,pointerEvents:`none`,[`&${t}-mask-blur`]:{backdropFilter:`blur(4px)`},[`${t}-hidden`]:{display:`none`}},[`${t}-wrap`]:{...zm(`fixed`),zIndex:e.zIndexPopupBase,overflow:`auto`,outline:0,WebkitOverflowScrolling:`touch`}}},{[`${t}-root`]:Yd(e)}]};var Rte=e=>{let{componentCls:t}=e;return[{[`${t}-root`]:{[`${t}-wrap-rtl`]:{direction:`rtl`},[`${t}-centered`]:{textAlign:`center`,"&::before":{display:`inline-block`,width:0,height:`100%`,verticalAlign:`middle`,content:`""`},[t]:{top:0,display:`inline-block`,paddingBottom:0,textAlign:`start`,verticalAlign:`middle`}},[`@media (max-width: ${e.screenSMMax}px)`]:{[t]:{maxWidth:`calc(100vw - 16px)`,margin:`${tn(e.marginXS)} auto`},[`${t}-centered`]:{[t]:{flex:1}}}}},{[t]:{...no(e),pointerEvents:`none`,position:`relative`,top:100,width:`auto`,maxWidth:`calc(100vw - ${tn(e.calc(e.margin).mul(2).equal())})`,margin:`0 auto`,paddingBottom:e.paddingLG,[`${t}-title`]:{margin:0,color:e.titleColor,fontWeight:e.fontWeightStrong,fontSize:e.titleFontSize,lineHeight:e.titleLineHeight,wordWrap:`break-word`},[`${t}-container`]:{position:`relative`,backgroundColor:e.contentBg,backgroundClip:`padding-box`,border:0,borderRadius:e.borderRadiusLG,boxShadow:e.boxShadow,pointerEvents:`auto`,padding:e.contentPadding},[`${t}-close`]:{position:`absolute`,top:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),insetInlineEnd:e.calc(e.modalHeaderHeight).sub(e.modalCloseBtnSize).div(2).equal(),zIndex:e.calc(e.zIndexPopupBase).add(10).equal(),padding:0,color:e.modalCloseIconColor,fontWeight:e.fontWeightStrong,lineHeight:1,textDecoration:`none`,background:`transparent`,borderRadius:e.borderRadiusSM,width:e.modalCloseBtnSize,height:e.modalCloseBtnSize,border:0,outline:0,cursor:`pointer`,transition:`color ${e.motionDurationMid}, background-color ${e.motionDurationMid}`,"&-x":{display:`flex`,fontSize:e.fontSizeLG,fontStyle:`normal`,lineHeight:tn(e.modalCloseBtnSize),justifyContent:`center`,textTransform:`none`,textRendering:`auto`},"&:disabled":{pointerEvents:`none`},"&:hover":{color:e.modalCloseIconHoverColor,backgroundColor:e.colorBgTextHover,textDecoration:`none`},"&:active":{backgroundColor:e.colorBgTextActive},...co(e)},[`${t}-header`]:{color:e.colorText,background:e.headerBg,borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0`,marginBottom:e.headerMarginBottom,padding:e.headerPadding,borderBottom:e.headerBorderBottom},[`${t}-body`]:{fontSize:e.fontSize,lineHeight:e.lineHeight,wordWrap:`break-word`,padding:e.bodyPadding,[`${t}-body-skeleton`]:{width:`100%`,height:`100%`,display:`flex`,justifyContent:`center`,alignItems:`center`,margin:`${tn(e.margin)} auto`}},[`${t}-footer`]:{textAlign:`end`,background:e.footerBg,marginTop:e.footerMarginTop,padding:e.footerPadding,borderTop:e.footerBorderTop,borderRadius:e.footerBorderRadius,[`> ${e.antCls}-btn + ${e.antCls}-btn`]:{marginInlineStart:e.marginXS}},[`${t}-open`]:{overflow:`hidden`}}},{[`${t}-pure-panel`]:{top:`auto`,padding:0,display:`flex`,flexDirection:`column`,[`${t}-container,
          ${t}-body,
          ${t}-confirm-body-wrapper`]:{display:`flex`,flexDirection:`column`,flex:`auto`},[`${t}-confirm-body`]:{marginBottom:`auto`}}}]},zte=e=>{let{componentCls:t}=e;return{[`${t}-root`]:{[`${t}-wrap-rtl`]:{direction:`rtl`,[`${t}-confirm-body`]:{direction:`rtl`}}}}},Bte=e=>{let{componentCls:t}=e,n=Rm(e),r={...n};delete r.xs;let i=`--${t.replace(`.`,``)}-`,a=Object.keys(r).map(e=>({[`@media (min-width: ${tn(r[e])})`]:{width:`var(${i}${e}-width)`}}));return{[`${t}-root`]:{[t]:[].concat(nt(Object.keys(n).map((e,t)=>{let r=Object.keys(n)[t-1];return r?{[`${i}${e}-width`]:`var(${i}${r}-width)`}:null})),[{width:`var(${i}xs-width)`}],nt(a))}}};const Bm=e=>{let t=e.padding,n=e.fontSizeHeading5,r=e.lineHeightHeading5;return yi(e,{modalHeaderHeight:e.calc(e.calc(r).mul(n).equal()).add(e.calc(t).mul(2).equal()).equal(),modalFooterBorderColorSplit:e.colorSplit,modalFooterBorderStyle:e.lineType,modalFooterBorderWidth:e.lineWidth,modalCloseIconColor:e.colorIcon,modalCloseIconHoverColor:e.colorIconHover,modalCloseBtnSize:e.controlHeight,modalConfirmIconSize:e.fontHeight,modalTitleHeight:e.calc(e.titleFontSize).mul(e.titleLineHeight).equal()})},Vm=e=>({footerBg:`transparent`,headerBg:`transparent`,titleLineHeight:e.lineHeightHeading5,titleFontSize:e.fontSizeHeading5,contentBg:e.colorBgElevated,titleColor:e.colorTextHeading,contentPadding:e.wireframe?0:`${tn(e.paddingMD)} ${tn(e.paddingContentHorizontalLG)}`,headerPadding:e.wireframe?`${tn(e.padding)} ${tn(e.paddingLG)}`:0,headerBorderBottom:e.wireframe?`${tn(e.lineWidth)} ${e.lineType} ${e.colorSplit}`:`none`,headerMarginBottom:e.wireframe?0:e.marginXS,bodyPadding:e.wireframe?e.paddingLG:0,footerPadding:e.wireframe?`${tn(e.paddingXS)} ${tn(e.padding)}`:0,footerBorderTop:e.wireframe?`${tn(e.lineWidth)} ${e.lineType} ${e.colorSplit}`:`none`,footerBorderRadius:e.wireframe?`0 0 ${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)}`:0,footerMarginTop:e.wireframe?0:e.marginSM,confirmBodyPadding:e.wireframe?`${tn(e.padding*2)} ${tn(e.padding*2)} ${tn(e.paddingLG)}`:0,confirmIconMarginInlineEnd:e.wireframe?e.margin:e.marginSM,confirmBtnsMarginTop:e.wireframe?e.marginLG:e.marginSM,mask:!0});var Vte=fo(`Modal`,e=>{let t=Bm(e);return[Rte(t),zte(t),Lte(t),Of(t,`zoom`),Bte(t)]},Vm,{unitless:{titleLineHeight:!0}}),Hm;ate()&&document.documentElement.addEventListener(`click`,e=>{Hm={x:e.pageX,y:e.pageY},setTimeout(()=>{Hm=null},100)},!0);var Hte=e=>{let{prefixCls:t,className:n,rootClassName:r,open:i,wrapClassName:a,centered:o,getContainer:s,focusTriggerAfterClose:c=!0,style:l,width:u=520,footer:d,classNames:f,styles:p,children:m,loading:h,confirmLoading:g,zIndex:_,mousePosition:v,onOk:b,onCancel:x,okButtonProps:S,cancelButtonProps:C,destroyOnHidden:w,destroyOnClose:T,panelRef:E=null,closable:D,mask:O,modalRender:k,...A}=e,{getPopupContainer:j,getPrefixCls:M,direction:N,className:ee,style:te,classNames:P,styles:ne,centered:re,cancelButtonProps:ae,okButtonProps:oe,mask:se}=mt(`modal`),{modal:ce}=y.useContext(dt),[le,ue]=y.useMemo(()=>typeof D==`boolean`?[void 0,void 0]:[D?.afterClose,D?.onClose],[D]),de=M(`modal`,t),fe=M(),[pe,me]=Ec(O,se,de),he=e=>{g||(x?.(e),ue?.())},ge=e=>{b?.(e),ue?.()},_e=Kc(de),[ve,ye]=Vte(de,_e),be=F(a,{[`${de}-centered`]:o??re,[`${de}-wrap-rtl`]:N===`rtl`}),xe=d!==null&&!h?y.createElement(Ate,{...e,okButtonProps:{...oe,...S},onOk:ge,cancelButtonProps:{...ae,...C},onCancel:he}):null,[Se,Ce,we,Te]=Cc(_c(e),_c(ce),{closable:!0,closeIcon:y.createElement(Jo,{className:`${de}-close-icon`}),closeIconRender:e=>kte(de,e)}),Ee=Se?{disabled:we,closeIcon:Ce,afterClose:le,...Te}:!1,De=k?e=>y.createElement(`div`,{className:`${de}-render`},k(e)):void 0,Oe=ie(E,Ote(`.${de}-${k?`render`:`container`}`)),[ke,Ae]=Hc(`Modal`,_),je={...e,width:u,panelRef:E,focusTriggerAfterClose:c,mask:pe,zIndex:ke},[Me,Ne]=Nc([P,f,me],[ne,p],{props:je}),[Pe,Fe]=y.useMemo(()=>u&&typeof u==`object`?[void 0,u]:[u,void 0],[u]),Ie=y.useMemo(()=>{let e={};return Fe&&Object.keys(Fe).forEach(t=>{let n=Fe[t];n!==void 0&&(e[`--${de}-${t}-width`]=typeof n==`number`?`${n}px`:n)}),e},[de,Fe]);return y.createElement(Cm,{form:!0,space:!0},y.createElement(Ic.Provider,{value:Ae},y.createElement(vp,{width:Pe,...A,zIndex:ke,getContainer:s===void 0?j:s,prefixCls:de,rootClassName:F(ve,r,ye,_e,Me.root),rootStyle:Ne.root,footer:xe,visible:i,mousePosition:v??Hm,onClose:he,closable:Ee,closeIcon:Ce,focusTriggerAfterClose:c,transitionName:$u(fe,`zoom`,e.transitionName),maskTransitionName:$u(fe,`fade`,e.maskTransitionName),mask:pe,className:F(ve,n,ee),style:{...te,...l,...Ie},classNames:{...Me,wrapper:F(Me.wrapper,be)},styles:Ne,panelRef:Oe,destroyOnHidden:w??T,modalRender:De},h?y.createElement(Nm,{active:!0,title:!1,paragraph:{rows:4},className:`${de}-body-skeleton`}):m)))},Ute=e=>{let{componentCls:t,titleFontSize:n,titleLineHeight:r,modalConfirmIconSize:i,fontSize:a,lineHeight:o,modalTitleHeight:s,fontHeight:c,confirmBodyPadding:l}=e,u=`${t}-confirm`;return{[u]:{"&-rtl":{direction:`rtl`},[`${e.antCls}-modal-header`]:{display:`none`},[`${u}-body-wrapper`]:{...io()},[`&${t} ${t}-body`]:{padding:l},[`${u}-body`]:{display:`flex`,flexWrap:`nowrap`,alignItems:`start`,[`> ${e.iconCls}`]:{flex:`none`,fontSize:i,marginInlineEnd:e.confirmIconMarginInlineEnd,marginTop:e.calc(e.calc(c).sub(i).equal()).div(2).equal()},[`&-has-title > ${e.iconCls}`]:{marginTop:e.calc(e.calc(s).sub(i).equal()).div(2).equal()}},[`${u}-paragraph`]:{display:`flex`,flexDirection:`column`,flex:`auto`,rowGap:e.marginXS,maxWidth:`calc(100% - ${tn(e.marginSM)})`},[`${e.iconCls} + ${u}-paragraph`]:{maxWidth:`calc(100% - ${tn(e.calc(e.modalConfirmIconSize).add(e.marginSM).equal())})`},[`${u}-title`]:{color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:n,lineHeight:r},[`${u}-container`]:{color:e.colorText,fontSize:a,lineHeight:o},[`${u}-btns`]:{textAlign:`end`,marginTop:e.confirmBtnsMarginTop,[`${e.antCls}-btn + ${e.antCls}-btn`]:{marginBottom:0,marginInlineStart:e.marginXS}}},[`${u}-error ${u}-body > ${e.iconCls}`]:{color:e.colorError},[`${u}-warning ${u}-body > ${e.iconCls},
        ${u}-confirm ${u}-body > ${e.iconCls}`]:{color:e.colorWarning},[`${u}-info ${u}-body > ${e.iconCls}`]:{color:e.colorInfo},[`${u}-success ${u}-body > ${e.iconCls}`]:{color:e.colorSuccess}}},Wte=mo([`Modal`,`confirm`],e=>Ute(Bm(e)),Vm,{order:-1e3});const Gte=e=>{let{prefixCls:t,icon:n,okText:r,cancelText:i,confirmPrefixCls:a,type:o,okCancel:s,footer:c,locale:l,...u}=e,d=n;if(!n&&n!==null)switch(o){case`info`:d=y.createElement(es,null);break;case`success`:d=y.createElement(Ho,null);break;case`error`:d=y.createElement(Go,null);break;default:d=y.createElement(Zo,null)}let f=s??o===`confirm`,p=e.autoFocusButton===null?!1:e.autoFocusButton||`ok`,[m]=fc(`Modal`),h=l||m,g=r||(f?h?.okText:h?.justOkText),_=i||h?.cancelText,{closable:v}=u,{onClose:b}=v&&typeof v==`object`?v:{},x=y.useMemo(()=>({autoFocusButton:p,cancelTextLocale:_,okTextLocale:g,mergedOkCancel:f,onClose:b,...u}),[p,_,g,f,b,u]),S=y.createElement(y.Fragment,null,y.createElement(ep,null),y.createElement(tp,null)),C=e.title!==void 0&&e.title!==null,w=`${a}-body`;return y.createElement(`div`,{className:`${a}-body-wrapper`},y.createElement(`div`,{className:F(w,{[`${w}-has-title`]:C})},d,y.createElement(`div`,{className:`${a}-paragraph`},C&&y.createElement(`span`,{className:`${a}-title`},e.title),y.createElement(`div`,{className:`${a}-content`},e.content))),c===void 0||typeof c==`function`?y.createElement($f,{value:x},y.createElement(`div`,{className:`${a}-btns`},typeof c==`function`?c(S,{OkBtn:tp,CancelBtn:ep}):S)):c,y.createElement(Wte,{prefixCls:t}))};var Kte=e=>{let{close:t,zIndex:n,maskStyle:r,direction:i,prefixCls:a,wrapClassName:o,rootPrefixCls:s,bodyStyle:c,closable:l=!1,onConfirm:u,styles:d,title:f,okButtonProps:p,cancelButtonProps:m}=e,{cancelButtonProps:h,okButtonProps:g}=mt(`modal`),_=`${a}-confirm`,v=e.width||416,b=e.style||{},x=e.maskClosable===void 0?!1:e.maskClosable,S=F(_,`${_}-${e.type}`,{[`${_}-rtl`]:i===`rtl`},e.className),[,C]=eo(),w=y.useMemo(()=>n===void 0?C.zIndexPopupBase+Rc:n,[n,C]);return y.createElement(Hte,{...e,className:S,wrapClassName:F({[`${_}-centered`]:!!e.centered},o),onCancel:()=>{t?.({triggerCancel:!0}),u?.(!1)},title:f,footer:null,transitionName:$u(s||``,`zoom`,e.transitionName),maskTransitionName:$u(s||``,`fade`,e.maskTransitionName),maskClosable:x,style:b,styles:{body:c,mask:r,...d},width:v,zIndex:w,closable:l},y.createElement(Gte,{...e,confirmPrefixCls:_,okButtonProps:{...g,...p},cancelButtonProps:{...h,...m}}))},qte=e=>{let{rootPrefixCls:t,iconPrefixCls:n,direction:r,theme:i}=e;return y.createElement(fu,{prefixCls:t,iconPrefixCls:n,direction:r,theme:i},y.createElement(Kte,{...e}))},Jte=[];function Yte(e){return{...e,type:`warning`}}function Xte(e){return{...e,type:`info`}}function Zte(e){return{...e,type:`success`}}function Qte(e){return{...e,type:`error`}}function $te(e){return{...e,type:`confirm`}}var ene=y.forwardRef(({afterClose:e,config:t,...n},r)=>{let[i,a]=y.useState(!0),[o,s]=y.useState(t),{direction:c,getPrefixCls:l}=y.useContext(dt),u=l(`modal`),d=l(),f=()=>{e(),o.afterClose?.()},p=(...e)=>{a(!1),e.some(e=>e?.triggerCancel)&&o.onCancel?.(()=>{},...e.slice(1))};y.useImperativeHandle(r,()=>({destroy:p,update:e=>{s(t=>{let n=typeof e==`function`?e(t):e;return{...t,...n}})}}));let m=o.okCancel??o.type===`confirm`,[h]=fc(`Modal`,ac.Modal);return y.createElement(qte,{prefixCls:u,rootPrefixCls:d,...o,close:p,open:i,afterClose:f,okText:o.okText||(m?h?.okText:h?.justOkText),direction:o.direction||c,cancelText:o.cancelText||h?.cancelText,...n})}),Um=0,tne=y.memo(y.forwardRef((e,t)=>{let[n,r]=ree();return y.useImperativeHandle(t,()=>({patchElement:r}),[r]),y.createElement(y.Fragment,null,n)}));function nne(){let e=y.useRef(null),[t,n]=y.useState([]);y.useEffect(()=>{t.length&&(nt(t).forEach(e=>{e()}),n([]))},[t]);let r=y.useCallback(t=>function(r){Um+=1;let i=y.createRef(),a,o=new Promise(e=>{a=e}),s=!1,c,l=y.createElement(ene,{key:`modal-${Um}`,config:t(r),ref:i,afterClose:()=>{c?.()},isSilent:()=>s,onConfirm:e=>{a(e)}});return c=e.current?.patchElement(l),c&&Jte.push(c),{destroy:()=>{function e(){i.current?.destroy()}i.current?e():n(t=>[].concat(nt(t),[e]))},update:e=>{function t(){i.current?.update(e)}i.current?t():n(e=>[].concat(nt(e),[t]))},then:e=>(s=!0,o.then(e))}},[]);return[y.useMemo(()=>({info:r(Xte),success:r(Zte),error:r(Qte),warning:r(Yte),confirm:r($te)}),[r]),y.createElement(tne,{key:`modal-holder`,ref:e})]}var rne=nne,ine=e=>{let{componentCls:t,notificationMarginEdge:n,animationMaxHeight:r}=e,i=`${t}-notice`,a=new Br(`antNotificationFadeIn`,{"0%":{transform:`translate3d(100%, 0, 0)`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,opacity:1}}),o=new Br(`antNotificationTopFadeIn`,{"0%":{top:-r,opacity:0},"100%":{top:0,opacity:1}}),s=new Br(`antNotificationBottomFadeIn`,{"0%":{bottom:e.calc(r).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),c=new Br(`antNotificationLeftFadeIn`,{"0%":{transform:`translate3d(-100%, 0, 0)`,opacity:0},"100%":{transform:`translate3d(0, 0, 0)`,opacity:1}});return{[t]:{[`&${t}-top, &${t}-bottom`]:{marginInline:0,[i]:{marginInline:`auto auto`}},[`&${t}-top`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:o}},[`&${t}-bottom`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:s}},[`&${t}-topRight, &${t}-bottomRight`]:{[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:a}},[`&${t}-topLeft, &${t}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:n,_skip_check_:!0},[i]:{marginInlineEnd:`auto`,marginInlineStart:0},[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationName:c}}}}};const ane=[`top`,`topLeft`,`topRight`,`bottom`,`bottomLeft`,`bottomRight`];var one={topLeft:`left`,topRight:`right`,bottomLeft:`left`,bottomRight:`right`,top:`left`,bottom:`left`},sne=(e,t)=>{let{componentCls:n}=e;return{[`${n}-${t}`]:{[`&${n}-stack > ${n}-notice-wrapper`]:{[t.startsWith(`top`)?`top`:`bottom`]:0,[one[t]]:{value:0,_skip_check_:!0}}}}},cne=e=>{let t={};for(let n=1;n<e.notificationStackLayer;n++)t[`&:nth-last-child(${n+1})`]={overflow:`hidden`,[`& > ${e.componentCls}-notice`]:{opacity:0,transition:`opacity ${e.motionDurationMid}`}};return{[`&:not(:nth-last-child(-n+${e.notificationStackLayer}))`]:{opacity:0,overflow:`hidden`,color:`transparent`,pointerEvents:`none`},...t}},lne=e=>{let t={};for(let n=1;n<e.notificationStackLayer;n++)t[`&:nth-last-child(${n+1})`]={background:e.colorBgBlur,backdropFilter:`blur(10px)`,"-webkit-backdrop-filter":`blur(10px)`};return{...t}},une=e=>{let{componentCls:t}=e;return{[`${t}-stack`]:{[`& > ${t}-notice-wrapper`]:{transition:`transform ${e.motionDurationSlow}, backdrop-filter 0s`,willChange:`transform, opacity`,position:`absolute`,...cne(e)}},[`${t}-stack:not(${t}-stack-expanded)`]:{[`& > ${t}-notice-wrapper`]:{...lne(e)}},[`${t}-stack${t}-stack-expanded`]:{[`& > ${t}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:`unset`,color:`inherit`,pointerEvents:`auto`,[`& > ${e.componentCls}-notice`]:{opacity:1}},"&:after":{content:`""`,position:`absolute`,height:e.margin,width:`100%`,insetInline:0,bottom:e.calc(e.margin).mul(-1).equal(),background:`transparent`,pointerEvents:`auto`}}},...ane.map(t=>sne(e,t)).reduce((e,t)=>({...e,...t}),{})}};const dne=e=>{let{iconCls:t,componentCls:n,boxShadow:r,fontSizeLG:i,notificationMarginBottom:a,borderRadiusLG:o,colorSuccess:s,colorInfo:c,colorWarning:l,colorError:u,colorTextHeading:d,notificationBg:f,notificationPadding:p,notificationMarginEdge:m,progressBg:h,notificationProgressHeight:g,fontSize:_,lineHeight:v,width:y,notificationIconSize:b,colorText:x,colorSuccessBg:S,colorErrorBg:C,colorInfoBg:w,colorWarningBg:T}=e,E=`${n}-notice`;return{position:`relative`,marginBottom:a,marginInlineStart:`auto`,background:f,borderRadius:o,boxShadow:r,[E]:{padding:p,width:y,maxWidth:`calc(100vw - ${tn(e.calc(m).mul(2).equal())})`,lineHeight:v,wordWrap:`break-word`,borderRadius:o,overflow:`hidden`,"&-success":S?{background:S}:{},"&-error":C?{background:C}:{},"&-info":w?{background:w}:{},"&-warning":T?{background:T}:{}},[`${E}-title`]:{marginBottom:e.marginXS,color:d,fontSize:i,lineHeight:e.lineHeightLG},[`${E}-description`]:{fontSize:_,color:x,marginTop:e.marginXS},[`${E}-closable ${E}-title`]:{paddingInlineEnd:e.paddingLG},[`${E}-with-icon ${E}-title`]:{marginBottom:e.marginXS,marginInlineStart:e.calc(e.marginSM).add(b).equal(),fontSize:i},[`${E}-with-icon ${E}-description`]:{marginInlineStart:e.calc(e.marginSM).add(b).equal(),fontSize:_},[`${E}-icon`]:{position:`absolute`,fontSize:b,lineHeight:1,[`&-success${t}`]:{color:s},[`&-info${t}`]:{color:c},[`&-warning${t}`]:{color:l},[`&-error${t}`]:{color:u}},[`${E}-close`]:{position:`absolute`,top:e.notificationPaddingVertical,insetInlineEnd:e.notificationPaddingHorizontal,color:e.colorIcon,outline:`none`,width:e.notificationCloseButtonSize,height:e.notificationCloseButtonSize,borderRadius:e.borderRadiusSM,transition:`background-color ${e.motionDurationMid}, color ${e.motionDurationMid}`,display:`flex`,alignItems:`center`,justifyContent:`center`,background:`none`,border:`none`,"&:hover":{color:e.colorIconHover,backgroundColor:e.colorBgTextHover},"&:active":{backgroundColor:e.colorBgTextActive},...co(e)},[`${E}-progress`]:{position:`absolute`,display:`block`,appearance:`none`,inlineSize:`calc(100% - ${tn(o)} * 2)`,left:{_skip_check_:!0,value:o},right:{_skip_check_:!0,value:o},bottom:0,blockSize:g,border:0,"&, &::-webkit-progress-bar":{borderRadius:o,backgroundColor:`rgba(0, 0, 0, 0.04)`},"&::-moz-progress-bar":{background:h},"&::-webkit-progress-value":{borderRadius:o,background:h}},[`${E}-actions`]:{float:`right`,marginTop:e.marginSM}}};var fne=e=>{let{componentCls:t,notificationMarginBottom:n,notificationMarginEdge:r,motionDurationMid:i,motionEaseInOut:a}=e,o=`${t}-notice`,s=new Br(`antNotificationFadeOut`,{"0%":{maxHeight:e.animationMaxHeight,marginBottom:n},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[t]:{...no(e),position:`fixed`,zIndex:e.zIndexPopup,marginRight:{value:r,_skip_check_:!0},[`${t}-hook-holder`]:{position:`relative`},[`${t}-fade-appear-prepare`]:{opacity:`0 !important`},[`${t}-fade-enter, ${t}-fade-appear`]:{animationDuration:e.motionDurationMid,animationTimingFunction:a,animationFillMode:`both`,opacity:0,animationPlayState:`paused`},[`${t}-fade-leave`]:{animationTimingFunction:a,animationFillMode:`both`,animationDuration:i,animationPlayState:`paused`},[`${t}-fade-enter${t}-fade-enter-active, ${t}-fade-appear${t}-fade-appear-active`]:{animationPlayState:`running`},[`${t}-fade-leave${t}-fade-leave-active`]:{animationName:s,animationPlayState:`running`},"&-rtl":{direction:`rtl`,[`${o}-actions`]:{float:`left`}}}},{[t]:{[`${o}-wrapper`]:dne(e)}}]};const pne=e=>({zIndexPopup:e.zIndexPopupBase+Rc+50,width:384,progressBg:`linear-gradient(90deg, ${e.colorPrimaryBorderHover}, ${e.colorPrimary})`,colorSuccessBg:e.colorSuccessBg,colorErrorBg:e.colorErrorBg,colorInfoBg:e.colorInfoBg,colorWarningBg:e.colorWarningBg}),mne=e=>{let t=e.paddingMD,n=e.paddingLG;return yi(e,{notificationBg:e.colorBgElevated,notificationPaddingVertical:t,notificationPaddingHorizontal:n,notificationIconSize:e.calc(e.fontSizeLG).mul(e.lineHeightLG).equal(),notificationCloseButtonSize:e.calc(e.controlHeightLG).mul(.55).equal(),notificationMarginBottom:e.margin,notificationPadding:`${tn(e.paddingMD)} ${tn(e.paddingContentHorizontalLG)}`,notificationMarginEdge:e.marginLG,animationMaxHeight:150,notificationStackLayer:3,notificationProgressHeight:2})};var hne=fo(`Notification`,e=>{let t=mne(e);return[fne(t),ine(t),une(t)]},pne);function Wm(e,t){return t===null||t===!1?null:t||y.createElement(Jo,{className:`${e}-close-icon`})}var gne={success:Ho,info:es,error:Go,warning:Zo};const _ne=e=>{let{prefixCls:t,icon:n,type:r,title:i,description:a,actions:o,role:s=`alert`,styles:c,classNames:l}=e,u=null;return n?u=y.createElement(`span`,{className:F(`${t}-icon`,l.icon),style:c.icon},n):r&&(u=y.createElement(gne[r]||null,{className:F(`${t}-icon`,l.icon,`${t}-icon-${r}`),style:c.icon})),y.createElement(`div`,{className:F({[`${t}-with-icon`]:u}),role:s},u,y.createElement(`div`,{className:F(`${t}-title`,l.title),style:c.title},i),a&&y.createElement(`div`,{className:F(`${t}-description`,l.description),style:c.description},a),o&&y.createElement(`div`,{className:F(`${t}-actions`,l.actions),style:c.actions},o))};function vne(e,t,n){let r;switch(e){case`top`:r={left:`50%`,transform:`translateX(-50%)`,right:`auto`,top:t,bottom:`auto`};break;case`topLeft`:r={left:0,top:t,bottom:`auto`};break;case`topRight`:r={right:0,top:t,bottom:`auto`};break;case`bottom`:r={left:`50%`,transform:`translateX(-50%)`,right:`auto`,top:`auto`,bottom:n};break;case`bottomLeft`:r={left:0,top:`auto`,bottom:n};break;default:r={right:0,top:`auto`,bottom:n};break}return r}function yne(e){return{motionName:`${e}-fade`}}function bne(e,t,n){return e===void 0?t?.closeIcon===void 0?n?.closeIcon:t.closeIcon:e}var Gm=24,xne=4.5,Sne=`topRight`,Cne=({children:e,prefixCls:t})=>{let n=Kc(t),[r,i]=hne(t,n);return y.createElement(vu,{classNames:{list:F(r,i,n)}},e)},wne=(e,{prefixCls:t,key:n})=>y.createElement(Cne,{prefixCls:t,key:n},e),Tne=y.forwardRef((e,t)=>{let{top:n,bottom:r,prefixCls:i,getContainer:a,maxCount:o,rtl:s,onAllRemoved:c,stack:l,duration:u=xne,pauseOnHover:d=!0,showProgress:f}=e,{getPrefixCls:p,getPopupContainer:m,direction:h}=mt(`notification`),{notification:g}=(0,y.useContext)(dt),[,_]=eo(),v=i||p(`notification`),b=(0,y.useMemo)(()=>typeof u==`number`&&u>0?u:!1,[u]),[x,S]=Au({prefixCls:v,style:e=>vne(e,n??Gm,r??Gm),className:()=>F({[`${v}-rtl`]:s??h===`rtl`}),motion:()=>yne(v),closable:{closeIcon:Wm(v)},duration:b,getContainer:()=>a?.()||m?.()||document.body,maxCount:o,pauseOnHover:d,showProgress:f,onAllRemoved:c,renderNotifications:wne,stack:l===!1?!1:{threshold:typeof l==`object`?l?.threshold:void 0,offset:8,gap:_.margin}}),[C,w]=Nc([g?.classNames,e?.classNames],[g?.styles,e?.styles],{props:e});return y.useImperativeHandle(t,()=>({...x,prefixCls:v,notification:g,classNames:C,styles:w})),S});function Ene(e){let t=y.useRef(null);Me(`Notification`);let{notification:n}=y.useContext(dt);return[y.useMemo(()=>{let r=r=>{if(!t.current)return;let{open:i,prefixCls:a,notification:o,classNames:s,styles:c}=t.current,l=o?.className||{},u=o?.style||{},d=`${a}-notice`,{title:f,message:p,description:m,icon:h,type:g,btn:_,actions:v,className:b,style:x,role:S=`alert`,closeIcon:C,closable:w,classNames:T={},styles:E={},...D}=r,O=f??p,k=v??_,A=Wm(d,bne(C,e,o)),[j,M,,N]=Sc(_c({...e||{},...r}),_c(n),{closable:!0,closeIcon:A}),ee=j?{onClose:w&&typeof w==`object`?w.onClose:void 0,closeIcon:M,...N}:!1,te=Mc(T,{props:r}),P=Mc(E,{props:r}),ne=Dc(void 0,s,te),re=kc(c,P);return i({placement:e?.placement??Sne,...D,content:y.createElement(_ne,{prefixCls:d,icon:h,type:g,title:O,description:m,actions:k,role:S,classNames:ne,styles:re}),className:F({[`${d}-${g}`]:g},b,l,ne.root),style:{...u,...re.root,...x},closable:ee})},i={open:r,destroy:e=>{e===void 0?t.current?.destroy():t.current?.close(e)}};return[`success`,`info`,`warning`,`error`].forEach(e=>{i[e]=t=>r({...t,type:e})}),i},[e,n]),y.createElement(Tne,{key:`notification-holder`,...e,ref:t})]}function Dne(e){return Ene(e)}const Km=y.createContext({});var qm=y.createContext({message:{},notification:{},modal:{}}),One=fo(`App`,e=>{let{componentCls:t,colorText:n,fontSize:r,lineHeight:i,fontFamily:a}=e;return{[t]:{color:n,fontSize:r,lineHeight:i,fontFamily:a,[`&${t}-rtl`]:{direction:`rtl`}}}},()=>({})),kne=e=>{let{prefixCls:t,children:n,className:r,rootClassName:i,message:a,notification:o,style:s,component:c=`div`}=e,{direction:l,getPrefixCls:u}=(0,y.useContext)(dt),d=u(`app`,t),[f,p]=One(d),m=F(f,d,r,i,p,{[`${d}-rtl`]:l===`rtl`}),h=(0,y.useContext)(Km),g=y.useMemo(()=>({message:{...h.message,...a},notification:{...h.notification,...o}}),[a,o,h.message,h.notification]),[_,v]=Wu(g.message),[b,x]=Dne(g.notification),[S,C]=rne(),w=y.useMemo(()=>({message:_,notification:b,modal:S}),[_,b,S]);Me(`App`)(!(p&&c===!1),`usage`,"When using cssVar, ensure `component` is assigned a valid React component string.");let T=c===!1?y.Fragment:c,E={className:m,style:s};return y.createElement(qm.Provider,{value:w},y.createElement(Km.Provider,{value:g},y.createElement(T,{...c===!1?void 0:E},C,v,x,n)))},Ane=()=>y.useContext(qm),Jm=kne;Jm.useApp=Ane;var Ym=Jm;function jne(e){return t=>y.createElement(fu,{theme:{token:{motion:!1,zIndexPopupBase:0}}},y.createElement(e,{...t}))}var Mne=(e,t,n,r,i)=>jne(a=>{let{prefixCls:o,style:s}=a,c=y.useRef(null),[l,u]=y.useState(0),[d,f]=y.useState(0),[p,m]=O(!1,a.open),{getPrefixCls:h}=y.useContext(dt),g=h(r||`select`,o);y.useEffect(()=>{if(m(!0),typeof ResizeObserver<`u`){let e=new ResizeObserver(e=>{let t=e[0].target;u(t.offsetHeight+8),f(t.offsetWidth)}),t=setInterval(()=>{let n=i?`.${i(g)}`:`.${g}-dropdown`,r=c.current?.querySelector(n);r&&(clearInterval(t),e.observe(r))},10);return()=>{clearInterval(t),e.disconnect()}}},[g]);let _={...a,style:{...s,margin:0},open:p,getPopupContainer:()=>c.current};n&&(_=n(_)),t&&Object.assign(_,{[t]:{overflow:{adjustX:!1,adjustY:!1}}});let v={paddingBottom:l,position:`relative`,minWidth:d};return y.createElement(`div`,{ref:c,style:v},y.createElement(e,{..._}))});const Nne=(e,t,n,r,i=!1,a,o)=>{let s=(0,y.useMemo)(()=>typeof n==`boolean`?{allowClear:n}:n&&typeof n==`object`?n:{allowClear:!1},[n]);return(0,y.useMemo)(()=>{let e=!i&&s.allowClear!==!1&&(t.length||a)&&!(o===`combobox`&&a===``);return{allowClear:e,clearIcon:e?s.clearIcon||r||``:null}},[s,r,i,t.length,a,o])},Xm=y.createContext(null);function Zm(){return y.useContext(Xm)}function Pne(e=250){let t=y.useRef(null),n=y.useRef(null);y.useEffect(()=>()=>{window.clearTimeout(n.current)},[]);function r(r){(r||t.current===null)&&(t.current=r),window.clearTimeout(n.current),n.current=window.setTimeout(()=>{t.current=null},e)}return[()=>t.current,r]}function Qm(e,t){return e.filter(e=>e).some(e=>e.contains(t)||e===t)}function Fne(e,t,n,r){let i=x(i=>{if(r)return;let a=i.target;a.shadowRoot&&i.composed&&(a=i.composedPath()[0]||a),i._ori_target&&(a=i._ori_target),t&&!Qm(e(),a)&&n(!1)});y.useEffect(()=>(window.addEventListener(`mousedown`,i),()=>window.removeEventListener(`mousedown`,i)),[i])}function $m(){return $m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$m.apply(this,arguments)}var Ine=e=>{let t=e===!0?0:1;return{bottomLeft:{points:[`tl`,`bl`],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:`scroll`},bottomRight:{points:[`tr`,`br`],offset:[0,4],overflow:{adjustX:t,adjustY:1},htmlRegion:`scroll`},topLeft:{points:[`bl`,`tl`],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:`scroll`},topRight:{points:[`br`,`tr`],offset:[0,-4],overflow:{adjustX:t,adjustY:1},htmlRegion:`scroll`}}},Lne=y.forwardRef((e,t)=>{let{prefixCls:n,disabled:r,visible:i,children:a,popupElement:o,animation:s,transitionName:c,popupStyle:l,popupClassName:u,direction:d=`ltr`,placement:f,builtinPlacements:p,popupMatchSelectWidth:m,popupRender:h,popupAlign:g,getPopupContainer:_,empty:v,onPopupVisibleChange:b,onPopupMouseEnter:x,onPopupMouseDown:S,onPopupBlur:C,...w}=e,T=`${n}-dropdown`,E=o;h&&(E=h(o));let D=y.useMemo(()=>p||Ine(m),[p,m]),O=s?`${T}-${s}`:c,k=typeof m==`number`,A=y.useMemo(()=>k?null:m===!1?`minWidth`:`width`,[m,k]),j=l;k&&(j={...l,width:m});let M=y.useRef(null);return y.useImperativeHandle(t,()=>({getPopupElement:()=>M.current?.popupElement})),y.createElement(Gl,$m({},w,{showAction:b?[`click`]:[],hideAction:b?[`click`]:[],popupPlacement:f||(d===`rtl`?`bottomRight`:`bottomLeft`),builtinPlacements:D,prefixCls:T,popupMotion:{motionName:O},popup:y.createElement(`div`,{onMouseEnter:x,onMouseDown:S,onBlur:C},E),ref:M,stretch:A,popupAlign:g,popupVisible:i,getPopupContainer:_,popupClassName:F(u,{[`${T}-empty`]:v}),popupStyle:j,onPopupVisibleChange:b}),a)});function eh(e,t){let{key:n}=e,r;return`value`in e&&({value:r}=e),n??(r===void 0?`rc-index-key-${t}`:r)}function th(e){return e!==void 0&&!Number.isNaN(e)}function nh(e,t){let{label:n,value:r,options:i,groupLabel:a}=e||{},o=n||(t?`children`:`label`);return{label:o,value:r||`value`,options:i||`options`,groupLabel:a||o}}function Rne(e,{fieldNames:t,childrenAsData:n}={}){let r=[],{label:i,value:a,options:o,groupLabel:s}=nh(t,!1);function c(e,t){Array.isArray(e)&&e.forEach(e=>{if(t||!(o in e)){let n=e[a];r.push({key:eh(e,r.length),groupOption:t,data:e,label:e[i],value:n})}else{let t=e[s];t===void 0&&n&&(t=e.label),r.push({key:eh(e,r.length),group:!0,data:e,label:t}),c(e[o],!0)}})}return c(e,!1),r}function rh(e){let t={...e};return`props`in t||Object.defineProperty(t,`props`,{get(){return Ee(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),t}}),t}const zne=(e,t,n)=>{if(!t||!t.length)return null;let r=!1,i=(e,[t,...n])=>{if(!t)return[e];let a=e.split(t);return r||=a.length>1,a.reduce((e,t)=>[...e,...i(t,n)],[]).filter(Boolean)},a=i(e,t);return r?n===void 0?a:a.slice(0,n):null};function Bne(e){let{visible:t,values:n}=e;return t?y.createElement(`span`,{"aria-live":`polite`,style:{width:0,height:0,position:`absolute`,overflow:`hidden`,opacity:0}},`${n.slice(0,50).map(({label:e,value:t})=>[`number`,`string`].includes(typeof e)?e:t).join(`, `)}`,n.length>50?`, ...`:null):null}var Vne=e=>{let t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(null)};const ih=(e,t=1)=>{if(t<=0){e();return}Vne(()=>{ih(e,t-1)})};function Hne(e,t,n){let[r,i]=(0,y.useState)(!1);(0,y.useEffect)(()=>{i(!0)},[]);let[a,o]=O(!1,e),s=n(r?a:!1),c=(0,y.useRef)(0),l=x(e=>{t&&s!==e&&t(e),o(e)});return[s,x((e,t={})=>{let{cancelFun:n}=t;c.current+=1;let r=c.current,i=typeof e==`boolean`?e:!s;function a(){r===c.current&&!n?.()&&l(i)}i?a():ih(()=>{a()})})]}function ah(e){let{children:t,...n}=e;return t?y.createElement(`div`,n,t):null}var oh=y.createContext(null);function sh(){return y.useContext(oh)}var Une=oh,ch=y.forwardRef((e,t)=>{let{onChange:n,onKeyDown:r,onBlur:i,style:a,syncWidth:o,value:s,className:c,autoComplete:l,...u}=e,{prefixCls:d,mode:f,onSearch:p,onSearchSubmit:m,onInputBlur:h,autoFocus:g,tokenWithEnter:_,placeholder:v,components:{input:b=`input`}}=sh(),{id:x,classNames:S,styles:C,open:w,activeDescendantId:T,role:D,disabled:O}=Zm()||{},k=F(`${d}-input`,S?.input,c),A=y.useRef(!1),j=y.useRef(null),M=y.useRef(null);y.useImperativeHandle(t,()=>M.current);let N=e=>{let{value:t}=e.target;if(_&&j.current&&/[\r\n]/.test(j.current)){let e=j.current.replace(/[\r\n]+$/,``).replace(/\r\n/g,` `).replace(/[\r\n]/g,` `);t=t.replace(e,j.current)}j.current=null,p&&p(t,!0,A.current),n?.(e)},ee=e=>{let{key:t}=e,{value:n}=e.currentTarget;t===`Enter`&&f===`tags`&&!A.current&&m&&m(n),r?.(e)},te=e=>{h?.(),i?.(e)},P=()=>{A.current=!0},ne=e=>{if(A.current=!1,f!==`combobox`){let{value:t}=e.currentTarget;p?.(t,!0,!1)}},re=e=>{let{clipboardData:t}=e;j.current=t?.getData(`text`)||``},[ae,oe]=y.useState(void 0);E(()=>{let e=M.current;if(o&&e){e.style.width=`0px`;let t=e.scrollWidth;oe(t),e.style.width=``}},[o,s]);let se={id:x,type:f===`combobox`?`text`:`search`,...u,ref:M,style:{...C?.input,...a,"--select-input-width":ae},autoFocus:g,autoComplete:l||`off`,className:k,disabled:O,value:s||``,onChange:N,onKeyDown:ee,onBlur:te,onPaste:re,onCompositionStart:P,onCompositionEnd:ne,role:D||`combobox`,"aria-expanded":w||!1,"aria-haspopup":`listbox`,"aria-owns":w?`${x}_list`:void 0,"aria-autocomplete":`list`,"aria-controls":w?`${x}_list`:void 0,"aria-activedescendant":w?T:void 0};if(y.isValidElement(b)){let t=b.props||{},n={placeholder:e.placeholder||v,...se,...t};return Object.keys(t).forEach(e=>{let r=t[e];typeof r==`function`&&(n[e]=(...t)=>{r(...t),se[e]?.(...t)})}),n.ref=ie(b.ref,se.ref),y.cloneElement(b,n)}let ce=b;return y.createElement(ce,se)});function lh(e){let{prefixCls:t,placeholder:n,displayValues:r}=sh(),{classNames:i,styles:a}=Zm(),{show:o=!0}=e;return r.length?null:y.createElement(`div`,{className:F(`${t}-placeholder`,i?.placeholder),style:{visibility:o?`visible`:`hidden`,...a?.placeholder}},n)}var uh=y.createContext(null);function dh(e){return Array.isArray(e)?e:e===void 0?[]:[e]}typeof window<`u`&&window.document&&window.document.documentElement;function Wne(e){return e!=null}function Gne(e){return!e&&e!==0}function fh(e){return[`string`,`number`].includes(typeof e)}function ph(e){let t;return e&&(fh(e.title)?t=e.title.toString():fh(e.label)&&(t=e.label.toString())),t}function mh(){return mh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},mh.apply(this,arguments)}var Kne=y.forwardRef(({inputProps:e},t)=>{let{prefixCls:n,searchValue:r,activeValue:i,displayValues:a,maxLength:o,mode:s}=sh(),{triggerOpen:c,title:l,showSearch:u,classNames:d,styles:f}=Zm(),p=y.useContext(uh),[m,h]=y.useState(!1),g=s===`combobox`,_=a[0],v=y.useMemo(()=>g&&i&&!m&&c?i:u?r:``,[g,i,m,c,r,u]),b=y.useMemo(()=>{let e={className:`${n}-content-value`,style:{visibility:v?`hidden`:`visible`}};if(_&&p?.flattenOptions){let t=p.flattenOptions.find(e=>e.value===_.value);if(t?.data){let{label:n,value:r,className:i,style:a,key:o,...s}=t.data;e={...e,...s,title:ph(t.data),className:F(e.className,i),style:{...e.style,...a}}}}return _&&!e.title&&(e.title=ph(_)),l!==void 0&&(e.title=l),e},[_,p?.flattenOptions,n,v,l]);return y.useEffect(()=>{g&&h(!1)},[g,i]),y.createElement(`div`,{className:F(`${n}-content`,d?.content),style:f?.content},_?y.createElement(`div`,b,_.label):y.createElement(lh,{show:!v}),y.createElement(ch,mh({ref:t},e,{value:v,maxLength:s===`combobox`?o:void 0,onChange:t=>{h(!0),e.onChange?.(t)}})))}),hh=void 0;function qne(e,t){let{prefixCls:n,invalidate:r,item:i,renderItem:a,responsive:o,responsiveDisabled:s,registerSize:c,itemKey:l,className:u,style:d,children:f,display:p,order:m,component:h=`div`,...g}=e,_=o&&!p;function v(e){c(l,e)}y.useEffect(()=>()=>{v(null)},[]);let b=a&&i!==hh?a(i,{index:m}):f,x;r||(x={opacity:_?0:1,height:_?0:hh,overflowY:_?`hidden`:hh,order:o?m:hh,pointerEvents:_?`none`:hh,position:_?`absolute`:hh});let S={};_&&(S[`aria-hidden`]=!0);let C=y.createElement(h,Hd({className:F(!r&&n,u),style:{...x,...d}},S,g,{ref:t}),b);return o&&(C=y.createElement(Ye,{onResize:({offsetWidth:e})=>{v(e)},disabled:s},C)),C}var gh=y.forwardRef(qne);function Jne(e){if(typeof MessageChannel>`u`)lt(e);else{let t=new MessageChannel;t.port1.onmessage=()=>e(),t.port2.postMessage(void 0)}}var Yne=h();function Xne(){let e=y.useRef(null);return t=>{e.current||(e.current=[],Jne(()=>{(0,Yne.unstable_batchedUpdates)(()=>{e.current.forEach(e=>{e()}),e.current=null})})),e.current.push(t)}}function _h(e,t){let[n,r]=y.useState(t);return[n,x(t=>{e(()=>{r(t)})})]}const vh=y.createContext(null);var Zne=y.forwardRef((e,t)=>{let n=y.useContext(vh);if(!n){let{component:n=`div`,...r}=e;return y.createElement(n,Hd({},r,{ref:t}))}let{className:r,...i}=n,{className:a,...o}=e;return y.createElement(vh.Provider,{value:null},y.createElement(gh,Hd({ref:t,className:F(r,a)},i,o)))}),yh=`responsive`,bh=`invalidate`;function Qne(e){return`+ ${e.length} ...`}function $ne(e,t){let{prefixCls:n=`rc-overflow`,data:r=[],renderItem:i,renderRawItem:a,itemKey:o,itemWidth:s=10,ssr:c,style:l,className:u,maxCount:d,renderRest:f,renderRawRest:p,prefix:m,suffix:h,component:g=`div`,itemComponent:_,onVisibleChange:v,...b}=e,x=c===`full`,S=Xne(),[C,w]=_h(S,null),T=C||0,[D,O]=_h(S,new Map),[k,A]=_h(S,0),[j,M]=_h(S,0),[N,ee]=_h(S,0),[te,P]=_h(S,0),[ne,re]=(0,y.useState)(null),[ie,ae]=(0,y.useState)(null),oe=y.useMemo(()=>ie===null&&x?2**53-1:ie||0,[ie,C]),[se,ce]=(0,y.useState)(!1),le=`${n}-item`,ue=Math.max(k,j),de=d===yh,fe=r.length&&de,pe=d===bh,me=fe||typeof d==`number`&&r.length>d,he=(0,y.useMemo)(()=>{let e=r;return fe?e=C===null&&x?r:r.slice(0,Math.min(r.length,T/s)):typeof d==`number`&&(e=r.slice(0,d)),e},[r,s,C,d,fe]),ge=(0,y.useMemo)(()=>fe?r.slice(oe+1):r.slice(he.length),[r,he,fe,oe]),_e=(0,y.useCallback)((e,t)=>typeof o==`function`?o(e):(o&&e?.[o])??t,[o]),ve=(0,y.useCallback)(i||(e=>e),[i]);function ye(e,t,n){ie===e&&(t===void 0||t===ne)||(ae(e),n||(ce(e<r.length-1),v?.(e)),t!==void 0&&re(t))}function be(e,t){w(t.clientWidth)}function xe(e,t){O(n=>{let r=new Map(n);return t===null?r.delete(e):r.set(e,t),r})}function Se(e,t){M(t),A(j)}function Ce(e,t){ee(t)}function we(e,t){P(t)}function Te(e){return D.get(_e(he[e],e))}E(()=>{if(T&&typeof ue==`number`&&he){let e=N+te,t=he.length,n=t-1;if(!t){ye(0,null);return}for(let r=0;r<t;r+=1){let t=Te(r);if(x&&(t||=0),t===void 0){ye(r-1,void 0,!0);break}if(e+=t,n===0&&e<=T||r===n-1&&e+Te(n)<=T){ye(n,null);break}else if(e+ue>T){ye(r-1,e-t-te+j);break}}h&&Te(0)+te>T&&re(null)}},[T,D,j,N,te,_e,he]);let Ee=se&&!!ge.length,De={};ne!==null&&fe&&(De={position:`absolute`,left:ne,top:0});let Oe={prefixCls:le,responsive:fe,component:_,invalidate:pe},ke=a?(e,t)=>{let n=_e(e,t);return y.createElement(vh.Provider,{key:n,value:{...Oe,order:t,item:e,itemKey:n,registerSize:xe,display:t<=oe}},a(e,t))}:(e,t)=>{let n=_e(e,t);return y.createElement(gh,Hd({},Oe,{order:t,key:n,item:e,renderItem:ve,itemKey:n,registerSize:xe,display:t<=oe}))},Ae={order:Ee?oe:2**53-1,className:`${le}-rest`,registerSize:Se,display:Ee},je=f||Qne,Me=p?y.createElement(vh.Provider,{value:{...Oe,...Ae}},p(ge)):y.createElement(gh,Hd({},Oe,Ae),typeof je==`function`?je(ge):je),Ne=y.createElement(g,Hd({className:F(!pe&&n,u),style:l,ref:t},b),m&&y.createElement(gh,Hd({},Oe,{responsive:de,responsiveDisabled:!fe,order:-1,className:`${le}-prefix`,registerSize:Ce,display:!0}),m),he.map(ke),me?Me:null,h&&y.createElement(gh,Hd({},Oe,{responsive:de,responsiveDisabled:!fe,order:oe,className:`${le}-suffix`,registerSize:we,display:!0,style:De}),h));return de?y.createElement(Ye,{onResize:be,disabled:!fe},Ne):Ne}var xh=y.forwardRef($ne);xh.Item=Zne,xh.RESPONSIVE=yh,xh.INVALIDATE=bh;var Sh=xh,Ch=e=>{let{className:t,style:n,customizeIcon:r,customizeIconProps:i,children:a,onMouseDown:o,onClick:s}=e,c=typeof r==`function`?r(i):r;return y.createElement(`span`,{className:t,onMouseDown:e=>{e.preventDefault(),o?.(e)},style:{userSelect:`none`,WebkitUserSelect:`none`,...n},unselectable:`on`,onClick:s,"aria-hidden":!0},c===void 0?y.createElement(`span`,{className:F(t.split(/\s+/).map(e=>`${e}-icon`))},a):c)};function wh(){return wh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wh.apply(this,arguments)}function ere(e){return e.key??e.value}var Th=e=>{e.preventDefault(),e.stopPropagation()},tre=y.forwardRef(function({inputProps:e},t){let{prefixCls:n,displayValues:r,searchValue:i,mode:a,onSelectorRemove:o,removeIcon:s}=sh(),{disabled:c,showSearch:l,triggerOpen:u,toggleOpen:d,autoClearSearchValue:f,tagRender:p,maxTagPlaceholder:m,maxTagTextLength:h,maxTagCount:g,classNames:_,styles:v}=Zm(),b=`${n}-selection-item`,x=i;!u&&a===`multiple`&&f!==!1&&(x=``);let S=l&&x||``,C=l&&!c,w=s??``,T=m??(e=>`+ ${e.length} ...`),E=p,D=e=>{d(e)},O=e=>{o?.(e)},k=(e,t,n,r,i)=>y.createElement(`span`,{title:ph(e),className:F(b,{[`${b}-disabled`]:n},_?.item),style:v?.item},y.createElement(`span`,{className:F(`${b}-content`,_?.itemContent),style:v?.itemContent},t),r&&y.createElement(Ch,{className:F(`${b}-remove`,_?.itemRemove),style:v?.itemRemove,onMouseDown:Th,onClick:i,customizeIcon:w},``)),A=(e,t,n,r,i,a,o)=>y.createElement(`span`,{onMouseDown:e=>{Th(e),D(!u)}},E({label:t,value:e,index:o?.index,disabled:n,closable:r,onClose:i,isMaxTag:!!a}));return y.createElement(Sh,{prefixCls:`${n}-content`,className:_?.content,style:v?.content,prefix:!r.length&&(!i||!u)?y.createElement(lh,null):null,data:r,renderItem:(e,t)=>{let{disabled:n,label:r,value:i}=e,a=!c&&!n,o=r;if(typeof h==`number`&&(typeof r==`string`||typeof r==`number`)){let e=String(o);e.length>h&&(o=`${e.slice(0,h)}...`)}let s=t=>{t&&t.stopPropagation(),O(e)};return typeof E==`function`?A(i,o,n,a,s,void 0,t):k(e,o,n,a,s)},renderRest:e=>{if(!r.length)return null;let t=typeof T==`function`?T(e):T;return typeof E==`function`?A(void 0,t,!1,!1,void 0,!0):k({title:t},t,!1)},suffix:y.createElement(ch,wh({ref:t,disabled:c,readOnly:!C},e,{value:S||``,syncWidth:!0})),itemKey:ere,maxCount:g})}),nre=y.forwardRef(function(e,t){let{multiple:n,onInputKeyDown:r,tabIndex:i}=sh(),a=Zm(),{showSearch:o}=a,s={...Gs(a,{aria:!0}),onKeyDown:r,readOnly:!o,tabIndex:i};return n?y.createElement(tre,{ref:t,inputProps:s}):y.createElement(Kne,{ref:t,inputProps:s})});function rre(e){return e&&![mu.ESC,mu.SHIFT,mu.BACKSPACE,mu.TAB,mu.WIN_KEY,mu.ALT,mu.META,mu.WIN_KEY_RIGHT,mu.CTRL,mu.SEMICOLON,mu.EQUALS,mu.CAPS_LOCK,mu.CONTEXT_MENU,mu.UP,mu.LEFT,mu.RIGHT,mu.F1,mu.F2,mu.F3,mu.F4,mu.F5,mu.F6,mu.F7,mu.F8,mu.F9,mu.F10,mu.F11,mu.F12].includes(e)}function Eh(){return Eh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Eh.apply(this,arguments)}var ire=[`value`,`onChange`,`removeIcon`,`placeholder`,`maxTagCount`,`maxTagTextLength`,`maxTagPlaceholder`,`choiceTransitionName`,`onInputKeyDown`,`onPopupScroll`,`tabIndex`,`activeValue`,`onSelectorRemove`,`focused`],are=y.forwardRef(function(e,t){let{prefixCls:n,className:r,style:i,prefix:a,suffix:o,clearIcon:s,children:c,multiple:l,displayValues:u,placeholder:d,mode:f,searchValue:p,onSearch:m,onSearchSubmit:h,onInputBlur:g,maxLength:_,autoFocus:v,onMouseDown:b,onClearMouseDown:S,onInputKeyDown:C,onSelectorRemove:w,tokenWithEnter:T,components:E,...D}=e,{triggerOpen:O,toggleOpen:k,showSearch:A,disabled:j,loading:M,classNames:N,styles:ee}=Zm(),te=y.useRef(null),P=y.useRef(null),ne=x(e=>{let{which:t}=e,n=P.current instanceof HTMLTextAreaElement;!n&&O&&(t===mu.UP||t===mu.DOWN)&&e.preventDefault(),C&&C(e),!(n&&!O&&~[mu.UP,mu.DOWN,mu.LEFT,mu.RIGHT].indexOf(t))&&rre(t)&&k(!0)});y.useImperativeHandle(t,()=>({focus:e=>{(P.current||te.current).focus?.(e)},blur:()=>{(P.current||te.current).blur?.()},nativeElement:te.current}));let re=x(e=>{if(!j){let t=Pe(P.current);e.nativeEvent._ori_target=t,t&&e.target!==t&&!t.contains(e.target)&&e.preventDefault();let n=O&&!l&&(f===`combobox`||A);e.nativeEvent._select_lazy?O&&k(!1):(P.current?.focus(),n||k())}b?.(e)}),{root:ae}=E,oe=De(D,ire),se={...e,onInputKeyDown:ne};return ae?y.isValidElement(ae)?y.cloneElement(ae,{...oe,ref:ie(ae.ref,te)}):y.createElement(ae,Eh({},oe,{ref:te})):y.createElement(Une.Provider,{value:se},y.createElement(`div`,Eh({},oe,{ref:te,className:r,style:i,onMouseDown:re}),y.createElement(ah,{className:F(`${n}-prefix`,N?.prefix),style:ee?.prefix},a),y.createElement(nre,{ref:P}),y.createElement(ah,{className:F(`${n}-suffix`,{[`${n}-suffix-loading`]:M},N?.suffix),style:ee?.suffix},o),s&&y.createElement(ah,{className:F(`${n}-clear`,N?.clear),style:ee?.clear,onMouseDown:e=>{e.nativeEvent._select_lazy=!0,S?.(e)}},s),c))});function ore(e,t,n){return y.useMemo(()=>{let{root:r,input:i}=e||{};return n&&(r=n()),t&&(i=t()),{root:r,input:i}},[e,t,n])}function Dh(){return Dh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Dh.apply(this,arguments)}const Oh=e=>e===`tags`||e===`multiple`;var sre=y.forwardRef((e,t)=>{let{id:n,prefixCls:r,className:i,styles:a,classNames:o,showSearch:s,tagRender:c,showScrollBar:l=`optional`,direction:u,omitDomProps:d,displayValues:f,onDisplayValuesChange:p,emptyOptions:m,notFoundContent:h=`Not Found`,onClear:g,maxCount:_,placeholder:v,mode:b,disabled:S,loading:C,getInputElement:w,getRawInputElement:T,open:E,defaultOpen:D,onPopupVisibleChange:O,activeValue:k,onActiveValueChange:A,activeDescendantId:j,searchValue:M,autoClearSearchValue:N,onSearch:ee,onSearchSplit:te,tokenSeparators:P,allowClear:ne,prefix:re,suffix:ie,suffixIcon:ae,clearIcon:oe,OptionList:se,animation:ce,transitionName:le,popupStyle:ue,popupClassName:de,popupMatchSelectWidth:fe,popupRender:pe,popupAlign:me,placement:he,builtinPlacements:ge,getPopupContainer:_e,showAction:ve=[],onFocus:ye,onBlur:be,onKeyUp:xe,onKeyDown:Se,onMouseDown:Ce,components:we,...Te}=e,Ee=Oh(b),De=y.useRef(null),Oe=y.useRef(null),ke=y.useRef(null),[Ae,je]=y.useState(!1);y.useImperativeHandle(t,()=>({focus:De.current?.focus,blur:De.current?.blur,scrollTo:e=>ke.current?.scrollTo(e),nativeElement:Pe(De.current)}));let Me=ore(we,w,T),Ne=y.useMemo(()=>{if(b!==`combobox`)return M;let e=f[0]?.value;return typeof e==`string`||typeof e==`number`?String(e):``},[M,b,f]),Fe=b===`combobox`&&typeof w==`function`&&w()||null,Ie=!h&&m,[Le,Re]=Hne(E,O,e=>S||Ie?!1:e),ze=y.useMemo(()=>(P||[]).some(e=>[`
`,`\r
`].includes(e)),[P]),Be=(e,t,n)=>{if(Ee&&th(_)&&f.length>=_)return;let r=!0,i=e;A?.(null);let a=zne(e,P,th(_)?_-f.length:void 0),o=n?null:a;return b!==`combobox`&&o&&(i=``,te?.(o),Re(!1),r=!1),ee&&Ne!==i&&ee(i,{source:t?`typing`:`effect`}),e&&t&&r&&Re(!0),r},Ve=e=>{!e||!e.trim()||ee(e,{source:`submit`})};y.useEffect(()=>{!Le&&!Ee&&b!==`combobox`&&Be(``,!1,!1)},[Le]),y.useEffect(()=>{S&&(Re(!1),je(!1))},[S,Le]);let[He,Ue]=Pne(),We=y.useRef(!1),Ge=e=>{let t=He(),{key:n}=e,r=n===`Enter`;if(r&&(b!==`combobox`&&e.preventDefault(),Le||Re(!0)),Ue(!!Ne),n===`Backspace`&&!t&&Ee&&!Ne&&f.length){let e=[...f],t=null;for(let n=e.length-1;n>=0;--n){let r=e[n];if(!r.disabled){e.splice(n,1),t=r;break}}t&&p(e,{type:`remove`,values:[t]})}Le&&(!r||!We.current)&&(r&&(We.current=!0),ke.current?.onKeyDown(e)),Se?.(e)},Ke=(e,...t)=>{Le&&ke.current?.onKeyUp(e,...t),e.key===`Enter`&&(We.current=!1),xe?.(e,...t)},qe=x(e=>{p(f.filter(t=>t!==e),{type:`remove`,values:[e]})}),Je=()=>{We.current=!1},Ye=()=>[Pe(De.current),Oe.current?.getPopupElement()];Fne(Ye,Le,Re,!!Me.root);let Xe=y.useRef(!1),Ze=e=>{je(!0),S||(ve.includes(`focus`)&&Re(!0),ye?.(e))},Qe=()=>{Le&&!Xe.current&&Re(!1,{cancelFun:()=>Qm(Ye(),document.activeElement)})},$e=e=>{je(!1),Ne&&(b===`tags`?ee(Ne,{source:`submit`}):b===`multiple`&&ee(``,{source:`blur`})),Qe(),S||be?.(e)},et=(e,...t)=>{let{target:n}=e;(Oe.current?.getPopupElement())?.contains(n)&&Re&&Re(!0),Ce?.(e,...t),Xe.current=!0,ih(()=>{Xe.current=!1})},[,tt]=y.useState({});function nt(){tt({})}let rt;Me.root&&(rt=e=>{Re(e)});let it=y.useMemo(()=>({...e,notFoundContent:h,open:Le,triggerOpen:Le,id:n,showSearch:s,multiple:Ee,toggleOpen:Re,showScrollBar:l,styles:a,classNames:o}),[e,h,Re,n,s,Ee,Le,l,a,o]),at=y.useMemo(()=>{let e=ie??ae;return typeof e==`function`?e({searchValue:Ne,open:Le,focused:Ae,showSearch:s,loading:C}):e},[ie,ae,Ne,Le,Ae,s,C]),ot=()=>{g?.(),De.current?.focus(),p([],{type:`clear`,values:f}),Be(``,!1,!1)},{allowClear:st,clearIcon:ct}=Nne(r,f,ne,oe,S,Ne,b),lt=y.createElement(se,{ref:ke}),ut=F(r,i,{[`${r}-focused`]:Ae,[`${r}-multiple`]:Ee,[`${r}-single`]:!Ee,[`${r}-allow-clear`]:st,[`${r}-show-arrow`]:at!=null,[`${r}-disabled`]:S,[`${r}-loading`]:C,[`${r}-open`]:Le,[`${r}-customize-input`]:Fe,[`${r}-show-search`]:s}),dt=y.createElement(are,Dh({},Te,{ref:De,prefixCls:r,className:ut,focused:Ae,prefix:re,suffix:at,clearIcon:ct,multiple:Ee,mode:b,displayValues:f,placeholder:v,searchValue:Ne,activeValue:k,onSearch:Be,onSearchSubmit:Ve,onInputBlur:Je,onFocus:Ze,onBlur:$e,onClearMouseDown:ot,onKeyDown:Ge,onKeyUp:Ke,onSelectorRemove:qe,tokenWithEnter:ze,onMouseDown:et,components:Me}));return dt=y.createElement(Lne,{ref:Oe,disabled:S,prefixCls:r,visible:Le,popupElement:lt,animation:ce,transitionName:le,popupStyle:ue,popupClassName:de,direction:u,popupMatchSelectWidth:fe,popupRender:pe,popupAlign:me,placement:he,builtinPlacements:ge,getPopupContainer:_e,empty:m,onPopupVisibleChange:rt,onPopupMouseEnter:nt,onPopupMouseDown:et,onPopupBlur:Qe},dt),y.createElement(Xm.Provider,{value:it},y.createElement(Bne,{visible:Ae&&!Le,values:f}),dt)}),kh=()=>null;kh.isSelectOptGroup=!0;var Ah=kh,jh=()=>null;jh.isSelectOption=!0;var Mh=jh,Nh=y.forwardRef(({height:e,offsetY:t,offsetX:n,children:r,prefixCls:i,onInnerResize:a,innerProps:o,rtl:s,extra:c},l)=>{let u={},d={display:`flex`,flexDirection:`column`};return t!==void 0&&(u={height:e,position:`relative`,overflow:`hidden`},d={...d,transform:`translateY(${t}px)`,[s?`marginRight`:`marginLeft`]:-n,position:`absolute`,left:0,right:0,top:0}),y.createElement(`div`,{style:u},y.createElement(Ye,{onResize:({offsetHeight:e})=>{e&&a&&a()}},y.createElement(`div`,Hd({style:d,className:F({[`${i}-holder-inner`]:i}),ref:l},o),r,c)))});Nh.displayName=`Filler`;var cre=Nh;function lre({children:e,setRef:t}){let n=y.useCallback(e=>{t(e)},[]);return y.cloneElement(e,{ref:n})}function ure(e,t,n,r,i,a,o,{getKey:s}){return e.slice(t,n+1).map((e,n)=>{let c=o(e,t+n,{style:{width:r},offsetX:i}),l=s(e);return y.createElement(lre,{key:l,setRef:t=>a(e,t)},c)})}function dre(e,t,n){let r=e.length,i=t.length,a,o;if(r===0&&i===0)return null;r<i?(a=e,o=t):(a=t,o=e);let s={__EMPTY_ITEM__:!0};function c(e){return e===void 0?s:n(e)}let l=null,u=Math.abs(r-i)!==1;for(let e=0;e<o.length;e+=1){let t=c(a[e]);if(t!==c(o[e])){l=e,u||=t!==c(o[e+1]);break}}return l===null?null:{index:l,multiple:u}}function fre(e,t,n){let[r,i]=y.useState(e),[a,o]=y.useState(null);return y.useEffect(()=>{let a=dre(r||[],e||[],t);a?.index!==void 0&&(n?.(a.index),o(e[a.index])),i(e)},[e]),[a]}var Ph=typeof navigator==`object`&&/Firefox/i.test(navigator.userAgent),Fh=((e,t,n,r)=>{let i=(0,y.useRef)(!1),a=(0,y.useRef)(null);function o(){clearTimeout(a.current),i.current=!0,a.current=setTimeout(()=>{i.current=!1},50)}let s=(0,y.useRef)({top:e,bottom:t,left:n,right:r});return s.current.top=e,s.current.bottom=t,s.current.left=n,s.current.right=r,(e,t,n=!1)=>{let r=e?t<0&&s.current.left||t>0&&s.current.right:t<0&&s.current.top||t>0&&s.current.bottom;return n&&r?(clearTimeout(a.current),i.current=!1):(!r||i.current)&&o(),!i.current&&r}});function pre(e,t,n,r,i,a,o){let s=(0,y.useRef)(0),c=(0,y.useRef)(null),l=(0,y.useRef)(null),u=(0,y.useRef)(!1),d=Fh(t,n,r,i);function f(e,t){if(lt.cancel(c.current),d(!1,t))return;let n=e;if(!n._virtualHandled)n._virtualHandled=!0;else return;s.current+=t,l.current=t,Ph||n.preventDefault(),c.current=lt(()=>{let e=u.current?10:1;o(s.current*e,!1),s.current=0})}function p(e,t){o(t,!0),Ph||e.preventDefault()}let m=(0,y.useRef)(null),h=(0,y.useRef)(null);function g(t){if(!e)return;lt.cancel(h.current),h.current=lt(()=>{m.current=null},2);let{deltaX:n,deltaY:r,shiftKey:i}=t,o=n,s=r;(m.current===`sx`||!m.current&&i&&r&&!n)&&(o=r,s=0,m.current=`sx`);let c=Math.abs(o),l=Math.abs(s);m.current===null&&(m.current=a&&c>l?`x`:`y`),m.current===`y`?f(t,s):p(t,o)}function _(t){e&&(u.current=t.detail===l.current)}return[g,_]}function mre(e,t,n,r){let[i,a]=y.useMemo(()=>[new Map,[]],[e,n.id,r]);return(o,s=o)=>{let c=i.get(o),l=i.get(s);if(c===void 0||l===void 0){let u=e.length;for(let d=a.length;d<u;d+=1){let u=e[d],f=t(u);i.set(f,d);let p=n.get(f)??r;if(a[d]=(a[d-1]||0)+p,f===o&&(c=d),f===s&&(l=d),c!==void 0&&l!==void 0)break}}return{top:a[c-1]||0,bottom:a[l]}}}var hre=class{maps;id=0;diffRecords=new Map;constructor(){this.maps=Object.create(null)}set(e,t){this.diffRecords.set(e,this.maps[e]),this.maps[e]=t,this.id+=1}get(e){return this.maps[e]}resetRecord(){this.diffRecords.clear()}getRecord(){return this.diffRecords}};function Ih(e){let t=parseFloat(e);return isNaN(t)?0:t}function gre(e,t,n){let[r,i]=y.useState(0),a=(0,y.useRef)(new Map),o=(0,y.useRef)(new hre),s=(0,y.useRef)(0);function c(){s.current+=1}function l(e=!1){c();let t=()=>{let e=!1;a.current.forEach((t,n)=>{if(t&&t.offsetParent){let{offsetHeight:r}=t,{marginTop:i,marginBottom:a}=getComputedStyle(t),s=Ih(i),c=Ih(a),l=r+s+c;o.current.get(n)!==l&&(o.current.set(n,l),e=!0)}}),e&&i(e=>e+1)};if(e)t();else{s.current+=1;let e=s.current;Promise.resolve().then(()=>{e===s.current&&t()})}}function u(r,i){let o=e(r),s=a.current.get(o);i?(a.current.set(o,i),l()):a.current.delete(o),!s!=!i&&(i?t?.(r):n?.(r))}return(0,y.useEffect)(()=>c,[]),[u,l,o.current,r]}var Lh=14/15;function _re(e,t,n){let r=(0,y.useRef)(!1),i=(0,y.useRef)(0),a=(0,y.useRef)(0),o=(0,y.useRef)(null),s=(0,y.useRef)(null),c,l=e=>{if(r.current){let t=Math.ceil(e.touches[0].pageX),r=Math.ceil(e.touches[0].pageY),o=i.current-t,c=a.current-r,l=Math.abs(o)>Math.abs(c);l?i.current=t:a.current=r;let u=n(l,l?o:c,!1,e);u&&e.preventDefault(),clearInterval(s.current),u&&(s.current=setInterval(()=>{l?o*=Lh:c*=Lh;let e=Math.floor(l?o:c);(!n(l,e,!0)||Math.abs(e)<=.1)&&clearInterval(s.current)},16))}},u=()=>{r.current=!1,c()},d=e=>{c(),e.touches.length===1&&!r.current&&(r.current=!0,i.current=Math.ceil(e.touches[0].pageX),a.current=Math.ceil(e.touches[0].pageY),o.current=e.target,o.current.addEventListener(`touchmove`,l,{passive:!1}),o.current.addEventListener(`touchend`,u,{passive:!0}))};c=()=>{o.current&&(o.current.removeEventListener(`touchmove`,l),o.current.removeEventListener(`touchend`,u))},E(()=>(e&&t.current.addEventListener(`touchstart`,d,{passive:!0}),()=>{t.current?.removeEventListener(`touchstart`,d),c(),clearInterval(s.current)}),[e])}function Rh(e){return Math.floor(e**.5)}function zh(e,t){return(`touches`in e?e.touches[0]:e)[t?`pageX`:`pageY`]-window[t?`scrollX`:`scrollY`]}function vre(e,t,n){y.useEffect(()=>{let r=t.current;if(e&&r){let e=!1,t,i,a=()=>{lt.cancel(t)},o=()=>{a(),t=lt(()=>{n(i),o()})},s=()=>{e=!1,a()},c=t=>{if(t.target.draggable||t.button!==0)return;let n=t;n._virtualHandled||(n._virtualHandled=!0,e=!0)},l=t=>{if(e){let e=zh(t,!1),{top:n,bottom:s}=r.getBoundingClientRect();e<=n?(i=-Rh(n-e),o()):e>=s?(i=Rh(e-s),o()):a()}};return r.addEventListener(`mousedown`,c),r.ownerDocument.addEventListener(`mouseup`,s),r.ownerDocument.addEventListener(`mousemove`,l),r.ownerDocument.addEventListener(`dragend`,s),()=>{r.removeEventListener(`mousedown`,c),r.ownerDocument.removeEventListener(`mouseup`,s),r.ownerDocument.removeEventListener(`mousemove`,l),r.ownerDocument.removeEventListener(`dragend`,s),a()}}},[e])}var yre=10;function bre(e,t,n,r,i,a,o,s){let c=y.useRef(),[l,u]=y.useState(null);return E(()=>{if(l&&l.times<yre){if(!e.current){u(e=>({...e}));return}a();let{targetAlign:s,originAlign:c,index:d,offset:f}=l,p=e.current.clientHeight,m=!1,h=s,g=null;if(p){let a=s||c,u=0,_=0,v=0,y=Math.min(t.length-1,d);for(let e=0;e<=y;e+=1){let a=i(t[e]);_=u;let o=n.get(a);v=_+(o===void 0?r:o),u=v}let b=a===`top`?f:p-f;for(let e=y;e>=0;--e){let r=i(t[e]),a=n.get(r);if(a===void 0){m=!0;break}if(b-=a,b<=0)break}switch(a){case`top`:g=_-f;break;case`bottom`:g=v-p+f;break;default:{let{scrollTop:t}=e.current,n=t+p;_<t?h=`top`:v>n&&(h=`bottom`)}}g!==null&&o(g),g!==l.lastTop&&(m=!0)}m&&u({...l,times:l.times+1,targetAlign:h,lastTop:g})}},[l,e.current]),e=>{if(e==null){s();return}if(lt.cancel(c.current),typeof e==`number`)o(e);else if(e&&typeof e==`object`){let n,{align:r}=e;`index`in e?{index:n}=e:n=t.findIndex(t=>i(t)===e.key);let{offset:a=0}=e;u({times:0,index:n,offset:a,originAlign:r})}}}var Bh=y.forwardRef((e,t)=>{let{prefixCls:n,rtl:r,scrollOffset:i,scrollRange:a,onStartMove:o,onStopMove:s,onScroll:c,horizontal:l,spinSize:u,containerSize:d,style:f,thumbStyle:p,showScrollBar:m}=e,[h,g]=y.useState(!1),[_,v]=y.useState(null),[b,x]=y.useState(null),S=!r,C=y.useRef(),w=y.useRef(),[T,E]=y.useState(m),D=y.useRef(),O=()=>{m===!0||m===!1||(clearTimeout(D.current),E(!0),D.current=setTimeout(()=>{E(!1)},3e3))},k=a-d||0,A=d-u||0,j=y.useMemo(()=>i===0||k===0?0:i/k*A,[i,k,A]),M=e=>{e.stopPropagation(),e.preventDefault()},N=y.useRef({top:j,dragging:h,pageY:_,startTop:b});N.current={top:j,dragging:h,pageY:_,startTop:b};let ee=e=>{g(!0),v(zh(e,l)),x(N.current.top),o(),e.stopPropagation(),e.preventDefault()};y.useEffect(()=>{let e=e=>{e.preventDefault()},t=C.current,n=w.current;return t.addEventListener(`touchstart`,e,{passive:!1}),n.addEventListener(`touchstart`,ee,{passive:!1}),()=>{t.removeEventListener(`touchstart`,e),n.removeEventListener(`touchstart`,ee)}},[]);let te=y.useRef();te.current=k;let P=y.useRef();P.current=A,y.useEffect(()=>{if(h){let e,t=t=>{let{dragging:n,pageY:r,startTop:i}=N.current;lt.cancel(e);let a=C.current.getBoundingClientRect(),o=d/(l?a.width:a.height);if(n){let n=(zh(t,l)-r)*o,a=i;!S&&l?a-=n:a+=n;let s=te.current,u=P.current,d=u?a/u:0,f=Math.ceil(d*s);f=Math.max(f,0),f=Math.min(f,s),e=lt(()=>{c(f,l)})}},n=()=>{g(!1),s()};return window.addEventListener(`mousemove`,t,{passive:!0}),window.addEventListener(`touchmove`,t,{passive:!0}),window.addEventListener(`mouseup`,n,{passive:!0}),window.addEventListener(`touchend`,n,{passive:!0}),()=>{window.removeEventListener(`mousemove`,t),window.removeEventListener(`touchmove`,t),window.removeEventListener(`mouseup`,n),window.removeEventListener(`touchend`,n),lt.cancel(e)}}},[h]),y.useEffect(()=>(O(),()=>{clearTimeout(D.current)}),[i]),y.useImperativeHandle(t,()=>({delayHidden:O}));let ne=`${n}-scrollbar`,re={position:`absolute`,visibility:T?null:`hidden`},ie={position:`absolute`,borderRadius:99,background:`var(--rc-virtual-list-scrollbar-bg, rgba(0, 0, 0, 0.5))`,cursor:`pointer`,userSelect:`none`};return l?(Object.assign(re,{height:8,left:0,right:0,bottom:0}),Object.assign(ie,{height:`100%`,width:u,[S?`left`:`right`]:j})):(Object.assign(re,{width:8,top:0,bottom:0,[S?`right`:`left`]:0}),Object.assign(ie,{width:`100%`,height:u,top:j})),y.createElement(`div`,{ref:C,className:F(ne,{[`${ne}-horizontal`]:l,[`${ne}-vertical`]:!l,[`${ne}-visible`]:T}),style:{...re,...f},onMouseDown:M,onMouseMove:O},y.createElement(`div`,{ref:w,className:F(`${ne}-thumb`,{[`${ne}-thumb-moving`]:h}),style:{...ie,...p},onMouseDown:ee}))}),xre=20;function Vh(e=0,t=0){let n=e/t*e;return isNaN(n)&&(n=0),n=Math.max(n,xre),Math.floor(n)}var Hh=h(),Sre=[],Cre={overflowY:`auto`,overflowAnchor:`none`};function wre(e,t){let{prefixCls:n=`rc-virtual-list`,className:r,height:i,itemHeight:a,fullHeight:o=!0,style:s,data:c,children:l,itemKey:u,virtual:d,direction:f,scrollWidth:p,component:m=`div`,onScroll:h,onVirtualScroll:g,onVisibleChange:_,innerProps:v,extraRender:b,styles:S,showScrollBar:C=`optional`,...w}=e,T=y.useCallback(e=>typeof u==`function`?u(e):e?.[u],[u]),[D,O,k,A]=gre(T,null,null),j=!!(d!==!1&&i&&a),M=y.useMemo(()=>Object.values(k.maps).reduce((e,t)=>e+t,0),[k.id,k.maps]),N=j&&c&&(Math.max(a*c.length,M)>i||!!p),ee=f===`rtl`,te=F(n,{[`${n}-rtl`]:ee},r),P=c||Sre,ne=(0,y.useRef)(),re=(0,y.useRef)(),ie=(0,y.useRef)(),[ae,oe]=(0,y.useState)(0),[se,ce]=(0,y.useState)(0),[le,ue]=(0,y.useState)(!1),de=()=>{ue(!0)},fe=()=>{ue(!1)},pe={getKey:T};function me(e){oe(t=>{let n;n=typeof e==`function`?e(t):e;let r=je(n);return ne.current.scrollTop=r,r})}let he=(0,y.useRef)({start:0,end:P.length}),ge=(0,y.useRef)(),[_e]=fre(P,T);ge.current=_e;let{scrollHeight:ve,start:ye,end:be,offset:xe}=y.useMemo(()=>{if(!j)return{scrollHeight:void 0,start:0,end:P.length-1,offset:void 0};if(!N)return{scrollHeight:re.current?.offsetHeight||0,start:0,end:P.length-1,offset:void 0};let e=0,t,n,r,o=P.length;for(let s=0;s<o;s+=1){let o=P[s],c=T(o),l=k.get(c),u=e+(l===void 0?a:l);u>=ae&&t===void 0&&(t=s,n=e),u>ae+i&&r===void 0&&(r=s),e=u}return t===void 0&&(t=0,n=0,r=Math.ceil(i/a)),r===void 0&&(r=P.length-1),r=Math.min(r+1,P.length-1),{scrollHeight:e,start:t,end:r,offset:n}},[N,j,ae,P,A,i]);he.current.start=ye,he.current.end=be,y.useLayoutEffect(()=>{let e=k.getRecord();if(e.size===1){let t=Array.from(e.keys())[0],n=e.get(t),r=P[ye];if(r&&n===void 0&&T(r)===t){let e=k.get(t)-a;me(t=>t+e)}}k.resetRecord()},[ve]);let[Se,Ce]=y.useState({width:0,height:i}),we=e=>{Ce({width:e.offsetWidth,height:e.offsetHeight})},Te=(0,y.useRef)(),Ee=(0,y.useRef)(),De=y.useMemo(()=>Vh(Se.width,p),[Se.width,p]),Oe=y.useMemo(()=>Vh(Se.height,ve),[Se.height,ve]),ke=ve-i,Ae=(0,y.useRef)(ke);Ae.current=ke;function je(e){let t=e;return Number.isNaN(Ae.current)||(t=Math.min(t,Ae.current)),t=Math.max(t,0),t}let Me=ae<=0,Ne=ae>=ke,Pe=se<=0,Fe=se>=p,Ie=Fh(Me,Ne,Pe,Fe),Le=()=>({x:ee?-se:se,y:ae}),Re=(0,y.useRef)(Le()),ze=x(e=>{if(g){let t={...Le(),...e};(Re.current.x!==t.x||Re.current.y!==t.y)&&(g(t),Re.current=t)}});function Be(e,t){let n=e;t?((0,Hh.flushSync)(()=>{ce(n)}),ze()):me(n)}function Ve(e){let{scrollTop:t}=e.currentTarget;t!==ae&&me(t),h?.(e),ze()}let He=e=>{let t=e,n=p?p-Se.width:0;return t=Math.max(t,0),t=Math.min(t,n),t},Ue=x((e,t)=>{t?((0,Hh.flushSync)(()=>{ce(t=>He(t+(ee?-e:e)))}),ze()):me(t=>t+e)}),[We,Ge]=pre(j,Me,Ne,Pe,Fe,!!p,Ue);_re(j,ne,(e,t,n,r)=>{let i=r;return Ie(e,t,n)?!1:!i||!i._virtualHandled?(i&&(i._virtualHandled=!0),We({preventDefault(){},deltaX:e?t:0,deltaY:e?0:t}),!0):!1}),vre(N,ne,e=>{me(t=>t+e)}),E(()=>{function e(e){let t=Me&&e.detail<0,n=Ne&&e.detail>0;j&&!t&&!n&&e.preventDefault()}let t=ne.current;return t.addEventListener(`wheel`,We,{passive:!1}),t.addEventListener(`DOMMouseScroll`,Ge,{passive:!0}),t.addEventListener(`MozMousePixelScroll`,e,{passive:!1}),()=>{t.removeEventListener(`wheel`,We),t.removeEventListener(`DOMMouseScroll`,Ge),t.removeEventListener(`MozMousePixelScroll`,e)}},[j,Me,Ne]),E(()=>{if(p){let e=He(se);ce(e),ze({x:e})}},[Se.width,p]);let Ke=()=>{Te.current?.delayHidden(),Ee.current?.delayHidden()},qe=bre(ne,P,k,a,T,()=>O(!0),me,Ke);y.useImperativeHandle(t,()=>({nativeElement:ie.current,getScrollInfo:Le,scrollTo:e=>{function t(e){return e&&typeof e==`object`&&(`left`in e||`top`in e)}t(e)?(e.left!==void 0&&ce(He(e.left)),qe(e.top)):qe(e)}})),E(()=>{_&&_(P.slice(ye,be+1),P)},[ye,be,P]);let Je=mre(P,T,k,a),Xe=b?.({start:ye,end:be,virtual:N,offsetX:se,offsetY:xe,rtl:ee,getSize:Je}),Ze=ure(P,ye,be,p,se,D,l,pe),Qe=null;i&&(Qe={[o?`height`:`maxHeight`]:i,...Cre},j&&(Qe.overflowY=`hidden`,p&&(Qe.overflowX=`hidden`),le&&(Qe.pointerEvents=`none`)));let $e={};return ee&&($e.dir=`rtl`),y.createElement(`div`,Hd({ref:ie,style:{...s,position:`relative`},className:te},$e,w),y.createElement(Ye,{onResize:we},y.createElement(m,{className:`${n}-holder`,style:Qe,ref:ne,onScroll:Ve,onMouseEnter:Ke},y.createElement(cre,{prefixCls:n,height:ve,offsetX:se,offsetY:xe,scrollWidth:p,onInnerResize:O,ref:re,innerProps:v,rtl:ee,extra:Xe},Ze))),N&&ve>i&&y.createElement(Bh,{ref:Te,prefixCls:n,scrollOffset:ae,scrollRange:ve,rtl:ee,onScroll:Be,onStartMove:de,onStopMove:fe,spinSize:Oe,containerSize:Se.height,style:S?.verticalScrollBar,thumbStyle:S?.verticalScrollBarThumb,showScrollBar:C}),N&&p>Se.width&&y.createElement(Bh,{ref:Ee,prefixCls:n,scrollOffset:se,scrollRange:p,rtl:ee,onScroll:Be,onStartMove:de,onStopMove:fe,spinSize:De,containerSize:Se.width,horizontal:!0,style:S?.horizontalScrollBar,thumbStyle:S?.horizontalScrollBarThumb,showScrollBar:C}))}var Uh=y.forwardRef(wre);Uh.displayName=`List`;var Tre=Uh;function Ere(){return/(mac\sos|macintosh)/i.test(navigator.appVersion)}function Wh(){return Wh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Wh.apply(this,arguments)}function Gh(e){return typeof e==`string`||typeof e==`number`}var Dre=y.forwardRef((e,t)=>{let{prefixCls:n,id:r,open:i,multiple:a,mode:o,searchValue:s,toggleOpen:c,notFoundContent:l,onPopupScroll:u,showScrollBar:d}=Zm(),{maxCount:f,flattenOptions:p,onActiveValue:m,defaultActiveFirstOption:h,onSelect:g,menuItemSelectedIcon:_,rawValues:v,fieldNames:b,virtual:x,direction:S,listHeight:C,listItemHeight:w,optionRender:T,classNames:E,styles:D}=y.useContext(uh),O=`${n}-item`,k=j(()=>p,[i,p],(e,t)=>t[0]&&e[1]!==t[1]),A=y.useRef(null),M=y.useMemo(()=>a&&th(f)&&v?.size>=f,[a,f,v?.size]),N=e=>{e.preventDefault()},ee=e=>{A.current?.scrollTo(typeof e==`number`?{index:e}:e)},te=y.useCallback(e=>o===`combobox`?!1:v.has(e),[o,[...v].toString(),v.size]),P=(e,t=1)=>{let n=k.length;for(let r=0;r<n;r+=1){let i=(e+r*t+n)%n,{group:a,data:o}=k[i]||{};if(!a&&!o?.disabled&&(te(o.value)||!M))return i}return-1},[ne,re]=y.useState(()=>P(0)),ie=(e,t=!1)=>{re(e);let n={source:t?`keyboard`:`mouse`},r=k[e];if(!r){m(null,-1,n);return}m(r.value,e,n)};(0,y.useEffect)(()=>{ie(h===!1?-1:P(0))},[k.length,s]);let ae=y.useCallback(e=>o===`combobox`?String(e).toLowerCase()===s.toLowerCase():v.has(e),[o,s,[...v].toString(),v.size]);(0,y.useEffect)(()=>{let e;if(!a&&i&&v.size===1){let t=Array.from(v)[0],n=k.findIndex(({data:e})=>s?String(e.value).startsWith(s):e.value===t);n!==-1&&(ie(n),e=setTimeout(()=>{ee(n)}))}return i&&A.current?.scrollTo(void 0),()=>clearTimeout(e)},[i,s]);let oe=e=>{e!==void 0&&g(e,{selected:!v.has(e)}),a||c(!1)};if(y.useImperativeHandle(t,()=>({onKeyDown:e=>{let{which:t,ctrlKey:n}=e;switch(t){case mu.N:case mu.P:case mu.UP:case mu.DOWN:{let e=0;if(t===mu.UP?e=-1:t===mu.DOWN?e=1:Ere()&&n&&(t===mu.N?e=1:t===mu.P&&(e=-1)),e!==0){let t=P(ne+e,e);ee(t),ie(t,!0)}break}case mu.TAB:case mu.ENTER:{let t=k[ne];if(!t||t.data.disabled)return oe(void 0);!M||v.has(t.value)?oe(t.value):oe(void 0),i&&e.preventDefault();break}case mu.ESC:c(!1),i&&e.stopPropagation()}},onKeyUp:()=>{},scrollTo:e=>{ee(e)}})),k.length===0)return y.createElement(`div`,{role:`listbox`,id:`${r}_list`,className:`${O}-empty`,onMouseDown:N},l);let se=Object.keys(b).map(e=>b[e]),ce=e=>e.label;function le(e,t){let{group:n}=e;return{role:n?`presentation`:`option`,id:`${r}_list_${t}`}}let ue=e=>{let t=k[e];if(!t)return null;let n=t.data||{},{value:r}=n,{group:i}=t,a=Gs(n,!0),o=ce(t);return t?y.createElement(`div`,Wh({"aria-label":typeof o==`string`&&!i?o:null},a,{key:e},le(t,e),{"aria-selected":ae(r)}),r):null},de={role:`listbox`,id:`${r}_list`};return y.createElement(y.Fragment,null,x&&y.createElement(`div`,Wh({},de,{style:{height:0,width:0,overflow:`hidden`}}),ue(ne-1),ue(ne),ue(ne+1)),y.createElement(Tre,{itemKey:`key`,ref:A,data:k,height:C,itemHeight:w,fullHeight:!1,onMouseDown:N,onScroll:u,virtual:x,direction:S,innerProps:x?null:de,showScrollBar:d,className:E?.popup?.list,style:D?.popup?.list},(e,t)=>{let{group:n,groupOption:r,data:i,label:a,value:o}=e,{key:s}=i;if(n){let e=i.title??(Gh(a)?a.toString():void 0);return y.createElement(`div`,{className:F(O,`${O}-group`,i.className),title:e},a===void 0?s:a)}let{disabled:c,title:l,children:u,style:d,className:f,...p}=i,m=De(p,se),h=te(o),g=c||!h&&M,v=`${O}-option`,b=F(O,v,f,E?.popup?.listItem,{[`${v}-grouped`]:r,[`${v}-active`]:ne===t&&!g,[`${v}-disabled`]:g,[`${v}-selected`]:h}),S=ce(e),C=!_||typeof _==`function`||h,w=typeof S==`number`?S:S||o,k=Gh(w)?w.toString():void 0;return l!==void 0&&(k=l),y.createElement(`div`,Wh({},Gs(m),x?{}:le(e,t),{"aria-selected":x?void 0:ae(o),className:b,title:k,onMouseMove:()=>{ne===t||g||ie(t)},onClick:()=>{g||oe(o)},style:{...D?.popup?.listItem,...d}}),y.createElement(`div`,{className:`${v}-content`},typeof T==`function`?T(e,{index:t}):w),y.isValidElement(_)||h,C&&y.createElement(Ch,{className:`${O}-option-state`,customizeIcon:_,customizeIconProps:{value:o,disabled:g,isSelected:h}},h?``:null))}))}),Ore=((e,t)=>{let n=y.useRef({values:new Map,options:new Map});return[y.useMemo(()=>{let{values:r,options:i}=n.current,a=e.map(e=>e.label===void 0?{...e,label:r.get(e.value)?.label}:e),o=new Map,s=new Map;return a.forEach(e=>{o.set(e.value,e),s.set(e.value,t.get(e.value)||i.get(e.value))}),n.current.values=o,n.current.options=s,a},[e,t]),y.useCallback(e=>t.get(e)||n.current.options.get(e),[t])]});function Kh(e,t){return dh(e).join(``).toUpperCase().includes(t)}var kre=((e,t,n,r,i)=>y.useMemo(()=>{if(!n||r===!1)return e;let{options:a,label:o,value:s}=t,c=[],l=typeof r==`function`,u=n.toUpperCase(),d=l?r:(e,t)=>i&&i.length?i.some(e=>Kh(t[e],u)):t[a]?Kh(t[o===`children`?`label`:o],u):Kh(t[s],u),f=l?e=>rh(e):e=>e;return e.forEach(e=>{if(e[a]){if(d(n,f(e)))c.push(e);else{let t=e[a].filter(e=>d(n,f(e)));t.length&&c.push({...e,[a]:t})}return}d(n,f(e))&&c.push(e)}),c},[e,r,i,n,t]));function Are(e){let{key:t,props:{children:n,value:r,...i}}=e;return{key:t,value:r===void 0?t:r,children:n,...i}}function qh(e,t=!1){return Oe(e).map((e,n)=>{if(!y.isValidElement(e)||!e.type)return null;let{type:{isSelectOptGroup:r},key:i,props:{children:a,...o}}=e;return t||!r?Are(e):{key:`__RC_SELECT_GRP__${i===null?n:i}__`,label:i,...o,options:qh(a)}}).filter(e=>e)}var jre=(e,t,n,r,i)=>y.useMemo(()=>{let a=e;e||(a=qh(t));let o=new Map,s=new Map,c=(e,t,n)=>{n&&typeof n==`string`&&e.set(t[n],t)},l=(e,t=!1)=>{for(let a=0;a<e.length;a+=1){let u=e[a];!u[n.options]||t?(o.set(u[n.value],u),c(s,u,n.label),r.forEach(e=>{c(s,u,e)}),c(s,u,i)):l(u[n.options],!0)}};return l(a),{options:a,valueOptions:o,labelOptions:s}},[e,t,n,r,i]);function Jh(e){let t=y.useRef();return t.current=e,y.useCallback((...e)=>t.current(...e),[])}function Mre(e,t,n){let{filterOption:r,searchValue:i,optionFilterProp:a,filterSort:o,onSearch:s,autoClearSearchValue:c}=t;return y.useMemo(()=>{let t=typeof e==`object`,l={filterOption:r,searchValue:i,optionFilterProp:a,filterSort:o,onSearch:s,autoClearSearchValue:c,...t?e:{}};return[t||n===`combobox`||n===`tags`||n===`multiple`&&e===void 0?!0:e,l]},[n,e,r,i,a,o,s,c])}function Yh(){return Yh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Yh.apply(this,arguments)}var Nre=[`inputValue`];function Pre(e){return!e||typeof e!=`object`}var Xh=y.forwardRef((e,t)=>{let{id:n,mode:r,prefixCls:i=`rc-select`,backfill:a,fieldNames:o,showSearch:s,searchValue:c,onSearch:l,autoClearSearchValue:u,filterOption:d,optionFilterProp:f,filterSort:p,onSelect:m,onDeselect:h,onActive:g,popupMatchSelectWidth:_=!0,optionLabelProp:v,options:b,optionRender:x,children:S,defaultActiveFirstOption:C,menuItemSelectedIcon:w,virtual:T,direction:E,listHeight:D=200,listItemHeight:k=20,labelRender:A,value:j,defaultValue:M,labelInValue:N,onChange:ee,maxCount:te,classNames:P,styles:ne,...re}=e,[ie,ae]=Mre(s,{searchValue:c,onSearch:l,autoClearSearchValue:u,filterOption:d,optionFilterProp:f,filterSort:p},r),{filterOption:oe,searchValue:se,optionFilterProp:ce,filterSort:le,onSearch:ue,autoClearSearchValue:de=!0}=ae,fe=y.useMemo(()=>ce?Array.isArray(ce)?ce:[ce]:[],[ce]),pe=dl(n),me=Oh(r),he=!!(!b&&S),ge=y.useMemo(()=>oe===void 0&&r===`combobox`?!1:oe,[oe,r]),_e=y.useMemo(()=>nh(o,he),[JSON.stringify(o),he]),[ve,ye]=O(``,se),be=ve||``,xe=jre(b,S,_e,fe,v),{valueOptions:Se,labelOptions:Ce,options:we}=xe,Te=y.useCallback(e=>dh(e).map(e=>{let t,n,r,i;Pre(e)?t=e:(n=e.label,t=e.value);let a=Se.get(t);return a&&(n===void 0&&(n=a?.[v||_e.label]),r=a?.disabled,i=a?.title),{label:n,value:t,key:t,disabled:r,title:i}}),[_e,v,Se]),[Ee,De]=O(M,j),[Oe,ke]=Ore(y.useMemo(()=>{let e=Te(me&&Ee===null?[]:Ee);return r===`combobox`&&Gne(e[0]?.value)?[]:e},[Ee,Te,r,me]),Se),Ae=y.useMemo(()=>{if(!r&&Oe.length===1){let e=Oe[0];if(e.value===null&&(e.label===null||e.label===void 0))return[]}return Oe.map(e=>({...e,label:(typeof A==`function`?A(e):e.label)??e.value}))},[r,Oe,A]),je=y.useMemo(()=>new Set(Oe.map(e=>e.value)),[Oe]);y.useEffect(()=>{if(r===`combobox`){let e=Oe[0]?.value;ye(Wne(e)?String(e):``)}},[Oe]);let Me=Jh((e,t)=>{let n=t??e;return{[_e.value]:e,[_e.label]:n}}),Ne=kre(y.useMemo(()=>{if(r!==`tags`)return we;let e=[...we],t=e=>Se.has(e);return[...Oe].sort((e,t)=>e.value<t.value?-1:1).forEach(n=>{let r=n.value;t(r)||e.push(Me(r,n.label))}),e},[Me,we,Se,Oe,r]),_e,be,ge,fe),Pe=y.useMemo(()=>{let e=e=>fe.length?fe.some(t=>e?.[t]===be):e?.value===be;return r!==`tags`||!be||Ne.some(t=>e(t))||Ne.some(e=>e[_e.value]===be)?Ne:[Me(be),...Ne]},[Me,fe,r,Ne,be,_e]),Fe=e=>[...e].sort((e,t)=>le(e,t,{searchValue:be})).map(e=>Array.isArray(e.options)?{...e,options:e.options.length>0?Fe(e.options):e.options}:e),Ie=y.useMemo(()=>le?Fe(Pe):Pe,[Pe,le,be]),Le=y.useMemo(()=>Rne(Ie,{fieldNames:_e,childrenAsData:he}),[Ie,_e,he]),Re=e=>{let t=Te(e);if(De(t),ee&&(t.length!==Oe.length||t.some((e,t)=>Oe[t]?.value!==e?.value))){let e=N?t.map(({label:e,value:t})=>({label:e,value:t})):t.map(e=>e.value),n=t.map(e=>rh(ke(e.value)));ee(me?e:e[0],me?n:n[0])}},[ze,Be]=y.useState(null),[Ve,He]=y.useState(0),Ue=C===void 0?r!==`combobox`:C,We=y.useRef(),Ge=y.useCallback((e,t,{source:n=`keyboard`}={})=>{He(t),a&&r===`combobox`&&e!==null&&n===`keyboard`&&Be(String(e));let i=Promise.resolve().then(()=>{We.current===i&&g?.(e)});We.current=i},[a,r,g]),Ke=(e,t,n)=>{let r=()=>{let t=ke(e);return[N?{label:t?.[_e.label],value:e}:e,rh(t)]};if(t&&m){let[e,t]=r();m(e,t)}else if(!t&&h&&n!==`clear`){let[e,t]=r();h(e,t)}},qe=Jh((e,t)=>{let n,i=me?t.selected:!0;n=i?me?[...Oe,e]:[e]:Oe.filter(t=>t.value!==e),Re(n),Ke(e,i),r===`combobox`?Be(``):(!Oh||de)&&(ye(``),Be(``))}),Je=(e,t)=>{Re(e);let{type:n,values:r}=t;(n===`remove`||n===`clear`)&&r.forEach(e=>{Ke(e.value,!1,n)})},Ye=(e,t)=>{if(ye(e),Be(null),t.source===`submit`){let t=(e||``).trim();t&&(Re(Array.from(new Set([...je,t]))),Ke(t,!0),ye(``));return}t.source!==`blur`&&(r===`combobox`&&Re(e),ue?.(e))},Xe=e=>{let t=e;r!==`tags`&&(t=e.map(e=>Ce.get(e)?.value).filter(e=>e!==void 0));let n=Array.from(new Set([...je,...t]));Re(n),n.forEach(e=>{Ke(e,!0)})},F=y.useMemo(()=>{let e=T!==!1&&_!==!1;return{...xe,flattenOptions:Le,onActiveValue:Ge,defaultActiveFirstOption:Ue,onSelect:qe,menuItemSelectedIcon:w,rawValues:je,fieldNames:_e,virtual:e,direction:E,listHeight:D,listItemHeight:k,childrenAsData:he,maxCount:te,optionRender:x,classNames:P,styles:ne}},[te,xe,Le,Ge,Ue,qe,w,je,_e,T,_,E,D,k,he,x,P,ne]);return y.createElement(uh.Provider,{value:F},y.createElement(sre,Yh({},re,{id:pe,prefixCls:i,ref:t,omitDomProps:Nre,mode:r,classNames:P,styles:ne,displayValues:Ae,onDisplayValuesChange:Je,maxCount:te,direction:E,showSearch:ie,searchValue:be,onSearch:Ye,autoClearSearchValue:de,onSearchSplit:Xe,popupMatchSelectWidth:_,OptionList:Dre,emptyOptions:!Le.length,activeValue:ze,activeDescendantId:`${pe}_list_${Ve}`})))});Xh.Option=Mh,Xh.OptGroup=Ah;var Fre=Xh;const Zh=(e,t,n)=>F({[`${e}-status-success`]:t===`success`,[`${e}-status-warning`]:t===`warning`,[`${e}-status-error`]:t===`error`,[`${e}-status-validating`]:t===`validating`,[`${e}-has-feedback`]:n}),Qh=(e,t)=>t||e;var Ire=()=>{let[,e]=eo(),[t]=fc(`Empty`),n=new Gi(e.colorBgBase).toHsl().l<.5?{opacity:.65}:{};return y.createElement(`svg`,{style:n,width:`184`,height:`152`,viewBox:`0 0 184 152`,xmlns:`http://www.w3.org/2000/svg`},y.createElement(`title`,null,t?.description||`Empty`),y.createElement(`g`,{fill:`none`,fillRule:`evenodd`},y.createElement(`g`,{transform:`translate(24 31.67)`},y.createElement(`ellipse`,{fillOpacity:`.8`,fill:`#F5F5F7`,cx:`67.797`,cy:`106.89`,rx:`67.797`,ry:`12.668`}),y.createElement(`path`,{d:`M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z`,fill:`#AEB8C2`}),y.createElement(`path`,{d:`M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z`,fill:`url(#linearGradient-1)`,transform:`translate(13.56)`}),y.createElement(`path`,{d:`M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z`,fill:`#F5F5F7`}),y.createElement(`path`,{d:`M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z`,fill:`#DCE0E6`})),y.createElement(`path`,{d:`M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z`,fill:`#DCE0E6`}),y.createElement(`g`,{transform:`translate(149.65 15.383)`,fill:`#FFF`},y.createElement(`ellipse`,{cx:`20.654`,cy:`3.167`,rx:`2.849`,ry:`2.815`}),y.createElement(`path`,{d:`M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z`}))))},Lre=()=>{let[,e]=eo(),[t]=fc(`Empty`),{colorFill:n,colorFillTertiary:r,colorFillQuaternary:i,colorBgContainer:a}=e,{borderColor:o,shadowColor:s,contentColor:c}=(0,y.useMemo)(()=>({borderColor:new Gi(n).onBackground(a).toHexString(),shadowColor:new Gi(r).onBackground(a).toHexString(),contentColor:new Gi(i).onBackground(a).toHexString()}),[n,r,i,a]);return y.createElement(`svg`,{width:`64`,height:`41`,viewBox:`0 0 64 41`,xmlns:`http://www.w3.org/2000/svg`},y.createElement(`title`,null,t?.description||`Empty`),y.createElement(`g`,{transform:`translate(0 1)`,fill:`none`,fillRule:`evenodd`},y.createElement(`ellipse`,{fill:s,cx:`32`,cy:`33`,rx:`32`,ry:`7`}),y.createElement(`g`,{fillRule:`nonzero`,stroke:o},y.createElement(`path`,{d:`M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z`}),y.createElement(`path`,{d:`M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z`,fill:c}))))},Rre=e=>{let{componentCls:t,margin:n,marginXS:r,marginXL:i,fontSize:a,lineHeight:o}=e;return{[t]:{marginInline:r,fontSize:a,lineHeight:o,textAlign:`center`,[`${t}-image`]:{height:e.emptyImgHeight,marginBottom:r,opacity:e.opacityImage,img:{height:`100%`},svg:{maxWidth:`100%`,height:`100%`,margin:`auto`}},[`${t}-description`]:{color:e.colorTextDescription},[`${t}-footer`]:{marginTop:n},"&-normal":{marginBlock:i,color:e.colorTextDescription,[`${t}-description`]:{color:e.colorTextDescription},[`${t}-image`]:{height:e.emptyImgHeightMD}},"&-small":{marginBlock:r,color:e.colorTextDescription,[`${t}-image`]:{height:e.emptyImgHeightSM}}}}},zre=fo(`Empty`,e=>{let{componentCls:t,controlHeightLG:n,calc:r}=e;return Rre(yi(e,{emptyImgCls:`${t}-img`,emptyImgHeight:r(n).mul(2.5).equal(),emptyImgHeightMD:n,emptyImgHeightSM:r(n).mul(.875).equal()}))}),$h=y.createElement(Ire,null),eg=y.createElement(Lre,null),tg=e=>{let{className:t,rootClassName:n,prefixCls:r,image:i,description:a,children:o,imageStyle:s,style:c,classNames:l,styles:u,...d}=e,{getPrefixCls:f,direction:p,className:m,style:h,classNames:g,styles:_,image:v}=mt(`empty`),b=f(`empty`,r),[x,S]=zre(b),[C,w]=Nc([g,l],[_,u],{props:e}),[T]=fc(`Empty`),E=a===void 0?T?.description:a,D=typeof E==`string`?E:`empty`,O=i??v??$h,k=null;return k=typeof O==`string`?y.createElement(`img`,{draggable:!1,alt:D,src:O}):O,y.createElement(`div`,{className:F(x,S,b,m,{[`${b}-normal`]:O===eg,[`${b}-rtl`]:p===`rtl`},t,n,C.root),style:{...w.root,...h,...c},...d},y.createElement(`div`,{className:F(`${b}-image`,C.image),style:{...s,...w.image}},k),E&&y.createElement(`div`,{className:F(`${b}-description`,C.description),style:w.description},E),o&&y.createElement(`div`,{className:F(`${b}-footer`,C.footer),style:w.footer},o))};tg.PRESENTED_IMAGE_DEFAULT=$h,tg.PRESENTED_IMAGE_SIMPLE=eg;var ng=tg,Bre=e=>{let{componentName:t}=e,{getPrefixCls:n}=(0,y.useContext)(dt),r=n(`empty`);switch(t){case`Table`:case`List`:return y.createElement(ng,{image:ng.PRESENTED_IMAGE_SIMPLE});case`Select`:case`TreeSelect`:case`Cascader`:case`Transfer`:case`Mentions`:return y.createElement(ng,{image:ng.PRESENTED_IMAGE_SIMPLE,className:`${r}-small`});case`Table.filter`:return null;default:return y.createElement(ng,null)}},rg=(e,t,n)=>{let{variant:r,[e]:i}=y.useContext(dt),a=y.useContext(tte),o=i?.variant,s;s=t===void 0?n===!1?`borderless`:a??o??r??`outlined`:t;let c=ut.includes(s);return[s,c]},Vre=e=>{let t={overflow:{adjustX:!0,adjustY:!0,shiftY:!0},htmlRegion:e===`scroll`?`scroll`:`visible`,dynamicInset:!0};return{bottomLeft:{...t,points:[`tl`,`bl`],offset:[0,4]},bottomRight:{...t,points:[`tr`,`br`],offset:[0,4]},topLeft:{...t,points:[`bl`,`tl`],offset:[0,-4]},topRight:{...t,points:[`br`,`tr`],offset:[0,-4]}}};function Hre(e,t){return e||Vre(t)}var Ure=Hre,ig=e=>{let{optionHeight:t,optionFontSize:n,optionLineHeight:r,optionPadding:i}=e;return{position:`relative`,display:`block`,minHeight:t,padding:i,color:e.colorText,fontWeight:`normal`,fontSize:n,lineHeight:r,boxSizing:`border-box`}},Wre=e=>{let{antCls:t,componentCls:n}=e,r=`${n}-item`,i=`&${t}-slide-up-enter${t}-slide-up-enter-active`,a=`&${t}-slide-up-appear${t}-slide-up-appear-active`,o=`&${t}-slide-up-leave${t}-slide-up-leave-active`,s=`${n}-dropdown-placement-`,c=`${r}-option-selected`;return[{[`${n}-dropdown`]:{...no(e),position:`absolute`,top:-9999,zIndex:e.zIndexPopup,boxSizing:`border-box`,padding:e.paddingXXS,overflow:`hidden`,fontSize:e.fontSize,fontVariant:`initial`,backgroundColor:e.colorBgElevated,borderRadius:e.borderRadiusLG,outline:`none`,boxShadow:e.boxShadowSecondary,[`
          ${i}${s}bottomLeft,
          ${a}${s}bottomLeft
        `]:{animationName:af},[`
          ${i}${s}topLeft,
          ${a}${s}topLeft,
          ${i}${s}topRight,
          ${a}${s}topRight
        `]:{animationName:sf},[`${o}${s}bottomLeft`]:{animationName:of},[`
          ${o}${s}topLeft,
          ${o}${s}topRight
        `]:{animationName:cf},"&-hidden":{display:`none`},[r]:{...ig(e),cursor:`pointer`,transition:`background ${e.motionDurationSlow} ease`,borderRadius:e.borderRadiusSM,"&-group":{color:e.colorTextDescription,fontSize:e.fontSizeSM,cursor:`default`},"&-option":{display:`flex`,"&-content":{flex:`auto`,...to},"&-state":{flex:`none`,display:`flex`,alignItems:`center`},[`&-active:not(${r}-option-disabled)`]:{backgroundColor:e.optionActiveBg},[`&-selected:not(${r}-option-disabled)`]:{color:e.optionSelectedColor,fontWeight:e.optionSelectedFontWeight,backgroundColor:e.optionSelectedBg,[`${r}-option-state`]:{color:e.colorPrimary}},"&-disabled":{[`&${r}-option-selected`]:{backgroundColor:e.colorBgContainerDisabled},color:e.colorTextDisabled,cursor:`not-allowed`},"&-grouped":{paddingInlineStart:e.calc(e.controlPaddingHorizontal).mul(2).equal()}},"&-empty":{...ig(e),color:e.colorTextDisabled}},[`${c}:has(+ ${c})`]:{borderEndStartRadius:0,borderEndEndRadius:0,[`& + ${c}`]:{borderStartStartRadius:0,borderStartEndRadius:0}},"&-rtl":{direction:`rtl`}}},mf(e,`slide-up`),mf(e,`slide-down`),rf(e,`move-up`),rf(e,`move-down`)]},Gre=e=>{let{componentCls:t}=e;return{[`&${t}-customize`]:{border:0,padding:0,fontSize:`inherit`,lineHeight:`inherit`,[`${t}-placeholder`]:{display:`none`},[`${t}-content`]:{margin:0,padding:0,"&-value":{display:`none`}}}}},ag=4,Kre=e=>{let{componentCls:t,calc:n,iconCls:r,paddingXS:i,paddingXXS:a,INTERNAL_FIXED_ITEM_MARGIN:o,lineWidth:s,colorIcon:c,colorIconHover:l,inputPaddingHorizontalBase:u}=e;return{"&-multiple":{"--select-multi-item-background":e.multipleItemBg,"--select-multi-item-border-color":`transparent`,"--select-multi-item-border-radius":e.borderRadiusSM,"--select-multi-item-height":e.multipleItemHeight,"--select-multi-padding-base":`calc((var(--select-height) - var(--select-multi-item-height)) / 2)`,"--select-multi-padding-vertical":`calc(var(--select-multi-padding-base) - ${o} - ${s})`,"--select-multi-item-padding-horizontal":`calc(${u} - var(--select-multi-padding-vertical) - ${s} * 2)`,paddingBlock:`var(--select-multi-padding-vertical)`,paddingInlineStart:`calc(var(--select-multi-padding-base) - ${s})`,[`${t}-prefix`]:{marginInlineStart:`var(--select-multi-item-padding-horizontal)`},[`${t}-prefix + ${t}-content`]:{[`${t}-placeholder`]:{insetInlineStart:0},[`${t}-content-item${t}-content-item-suffix`]:{marginInlineStart:0}},[`${t}-placeholder`]:{position:`absolute`,lineHeight:`var(--select-line-height)`,insetInlineStart:`var(--select-multi-item-padding-horizontal)`,width:`calc(100% - var(--select-multi-item-padding-horizontal))`,top:`50%`,transform:`translateY(-50%)`},[`${t}-content`]:{flexWrap:`wrap`,alignItems:`center`,lineHeight:1,"&-item-prefix":{height:`var(--select-font-size)`},"&-item":{lineHeight:1,maxWidth:`calc(100% - ${ag}px)`},[`${t}-content-item-prefix + ${t}-content-item-suffix,
          ${t}-content-item-suffix:first-child`]:{marginInlineStart:`var(--select-multi-item-padding-horizontal)`},[`${t}-selection-item`]:{lineHeight:`calc(var(--select-multi-item-height) - ${s} * 2)`,border:`${s} solid var(--select-multi-item-border-color)`,display:`flex`,marginBlock:o,marginInlineEnd:n(o).mul(2).equal(),background:`var(--select-multi-item-background)`,borderRadius:`var(--select-multi-item-border-radius)`,paddingInlineStart:i,paddingInlineEnd:a,transition:[`height`,`line-height`,`padding`].map(t=>`${t} ${e.motionDurationSlow}`).join(`,`),"&-content":{...to,marginInlineEnd:a},"&-remove":{...ro(),display:`inline-flex`,alignItems:`center`,color:c,fontWeight:`bold`,fontSize:10,lineHeight:`inherit`,cursor:`pointer`,[`> ${r}`]:{verticalAlign:`-0.2em`},"&:hover":{color:l}}},[`${t}-input`]:{lineHeight:n(o).mul(2).add(`var(--select-multi-item-height)`).equal(),width:`calc(var(--select-input-width, 0) * 1px)`,minWidth:ag,maxWidth:`100%`,transition:`line-height ${e.motionDurationSlow}`}},[`&${t}-sm`]:{"--select-multi-item-height":e.multipleItemHeightSM,"--select-multi-item-border-radius":e.borderRadiusXS},[`&${t}-lg`]:{"--select-multi-item-height":e.multipleItemHeightLG,"--select-multi-item-border-radius":e.borderRadius},[`&${t}-filled`]:{"--select-multi-item-border-color":e.colorSplit,"--select-multi-item-background":e.colorBgContainer,[`&${t}-disabled`]:{"--select-multi-item-border-color":`transparent`}}}}},og=(e,t)=>{let{componentCls:n}=e,{border:r,borderHover:i,borderActive:a,borderOutline:o}=t,s=t.background||e.colorBgContainer;return{"--select-border-color":r,"--select-background":s,"--select-color":t.color||e.colorText,[`&:not(${n}-disabled)`]:{"&:hover":{"--select-border-color":i,"--select-background":t.backgroundHover||s},[`&${n}-focused`]:{"--select-border-color":a,"--select-background":t.backgroundActive||s,boxShadow:`0 0 0 ${tn(e.controlOutlineWidth)} ${o}`}},[`&${n}-disabled`]:{"--select-border-color":t.borderDisabled||t.border,"--select-background":t.backgroundDisabled||t.background}}},sg=(e,t,n,r={},i={},a)=>{let{componentCls:o}=e;return{[`&${o}-${t}`]:[og(e,n),{[`&${o}-status-error`]:og(e,{...n,color:r.color||e.colorError,...r}),[`&${o}-status-warning`]:og(e,{...n,color:i.color||e.colorWarning,...i})},a]}},qre=e=>{let{componentCls:t,calc:n,fontHeight:r,controlHeight:i,iconCls:a}=e;return{[t]:[{"--select-border-radius":e.borderRadius,"--select-border-color":`#000`,"--select-border-size":e.lineWidth,"--select-background":e.colorBgContainer,"--select-font-size":e.fontSize,"--select-line-height":e.lineHeight,"--select-font-height":r,"--select-color":e.colorText,"--select-height":i,"--select-padding-horizontal":n(e.paddingSM).sub(e.lineWidth).equal(),"--select-padding-vertical":`calc((var(--select-height) - var(--select-font-height)) / 2 - var(--select-border-size))`,...no(e,!0),display:`inline-flex`,flexWrap:`nowrap`,position:`relative`,transition:`all ${e.motionDurationSlow}`,alignItems:`flex-start`,outline:0,cursor:`pointer`,borderRadius:`var(--select-border-radius)`,borderWidth:`var(--select-border-size)`,borderStyle:e.lineType,borderColor:`var(--select-border-color)`,background:`var(--select-background)`,fontSize:`var(--select-font-size)`,lineHeight:`var(--select-line-height)`,color:`var(--select-color)`,paddingInline:`var(--select-padding-horizontal)`,paddingBlock:`var(--select-padding-vertical)`,[`${t}-prefix`]:{flex:`none`,lineHeight:1},[`${t}-placeholder`]:{...to,color:e.colorTextPlaceholder,pointerEvents:`none`,zIndex:1},[`${t}-content`]:{flex:`auto`,minWidth:0,position:`relative`,display:`flex`,marginInlineEnd:n(e.paddingXXS).mul(1.5).equal(),"&:before":{content:`"\\a0"`,width:0,overflow:`hidden`},"&-value":{...to,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,zIndex:1},"input[readonly]":{cursor:`inherit`,caretColor:`transparent`}},[`&-open ${t}-content-value`]:{color:e.colorTextPlaceholder},[`${t}-suffix`]:{flex:`none`,color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,lineHeight:1,"> :not(:last-child)":{marginInlineEnd:e.marginXS}},[`${t}-prefix, ${t}-suffix`]:{alignSelf:`center`,[a]:{verticalAlign:`top`}},"&-disabled":{background:e.colorBgContainerDisabled,color:e.colorTextDisabled,cursor:`not-allowed`},"&-sm":{"--select-height":e.controlHeightSM,"--select-padding-horizontal":n(e.paddingXS).sub(e.lineWidth).equal(),"--select-border-radius":e.borderRadiusSM},"&-lg":{"--select-height":e.controlHeightLG,"--select-font-size":e.fontSizeLG,"--select-line-height":e.lineHeightLG,"--select-font-height":e.fontHeightLG,"--select-border-radius":e.borderRadiusLG}},{[`&:not(${t}-customize)`]:{[`${t}-input`]:{outline:`none`,background:`transparent`,appearance:`none`,border:0,margin:0,padding:0,color:`inherit`,"&::-webkit-search-cancel-button":{display:`none`,appearance:`none`}}}},{[`&-single:not(${t}-customize)`]:{[`${t}-input`]:{position:`absolute`,insetInline:0,insetBlock:`calc(var(--select-padding-vertical) * -1)`,lineHeight:`calc(var(--select-font-height) + var(--select-padding-vertical) * 2)`},[`${t}-content`]:{alignSelf:`center`}}},Kre(e),sg(e,`outlined`,{border:e.colorBorder,borderHover:e.hoverBorderColor,borderActive:e.activeBorderColor,borderOutline:e.activeOutlineColor,borderDisabled:e.colorBorderDisabled},{border:e.colorError,borderHover:e.colorErrorHover,borderActive:e.colorError,borderOutline:e.colorErrorOutline},{border:e.colorWarning,borderHover:e.colorWarningHover,borderActive:e.colorWarning,borderOutline:e.colorWarningOutline}),sg(e,`filled`,{border:`transparent`,borderHover:`transparent`,borderActive:e.activeBorderColor,borderOutline:`transparent`,borderDisabled:e.colorBorderDisabled,background:e.colorFillTertiary,backgroundHover:e.colorFillSecondary,backgroundActive:e.colorBgContainer},{background:e.colorErrorBg,backgroundHover:e.colorErrorBgHover,borderActive:e.colorError},{background:e.colorWarningBg,backgroundHover:e.colorWarningBgHover,borderActive:e.colorWarning}),sg(e,`borderless`,{border:`transparent`,borderHover:`transparent`,borderActive:`transparent`,borderOutline:`transparent`,background:`transparent`}),sg(e,`underlined`,{border:e.colorBorder,borderHover:e.hoverBorderColor,borderActive:e.activeBorderColor,borderOutline:`transparent`},{border:e.colorError,borderHover:e.colorErrorHover,borderActive:e.colorError},{border:e.colorWarning,borderHover:e.colorWarningHover,borderActive:e.colorWarning},{borderRadius:0,borderTopColor:`transparent`,borderRightColor:`transparent`,borderLeftColor:`transparent`}),Gre(e)]}};const Jre=e=>{let{fontSize:t,lineHeight:n,lineWidth:r,controlHeight:i,controlHeightSM:a,controlHeightLG:o,paddingXXS:s,controlPaddingHorizontal:c,zIndexPopupBase:l,colorText:u,fontWeightStrong:d,controlItemBgActive:f,controlItemBgHover:p,colorBgContainer:m,colorFillSecondary:h,colorBgContainerDisabled:g,colorTextDisabled:_,colorPrimaryHover:v,colorPrimary:y,controlOutline:b}=e,x=s*2,S=r*2,C=Math.min(i-x,i-S),w=Math.min(a-x,a-S),T=Math.min(o-x,o-S);return{INTERNAL_FIXED_ITEM_MARGIN:Math.floor(s/2),zIndexPopup:l+50,optionSelectedColor:u,optionSelectedFontWeight:d,optionSelectedBg:f,optionActiveBg:p,optionPadding:`${(i-t*n)/2}px ${c}px`,optionFontSize:t,optionLineHeight:n,optionHeight:i,selectorBg:m,clearBg:m,singleItemHeightLG:o,multipleItemBg:h,multipleItemBorderColor:`transparent`,multipleItemHeight:C,multipleItemHeightSM:w,multipleItemHeightLG:T,multipleSelectorBgDisabled:g,multipleItemColorDisabled:_,multipleItemBorderColorDisabled:`transparent`,showArrowPaddingInlineEnd:Math.ceil(e.fontSize*1.25),hoverBorderColor:v,activeBorderColor:y,activeOutlineColor:b,selectAffixPadding:s}};var Yre=e=>{let{antCls:t,componentCls:n,inputPaddingHorizontalBase:r}=e,i={[`${n}-clear`]:{opacity:1,background:e.colorBgBase,borderRadius:`50%`}};return{[n]:{...no(e),[`${n}-selection-item`]:{flex:1,fontWeight:`normal`,position:`relative`,userSelect:`none`,...to,[`> ${t}-typography`]:{display:`inline`}},[`${n}-prefix`]:{flex:`none`,marginInlineEnd:e.selectAffixPadding},[`${n}-clear`]:{position:`absolute`,top:`50%`,insetInlineStart:`auto`,insetInlineEnd:r,zIndex:1,display:`inline-block`,width:e.fontSizeIcon,height:e.fontSizeIcon,marginTop:e.calc(e.fontSizeIcon).mul(-1).div(2).equal(),color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,fontStyle:`normal`,lineHeight:1,textAlign:`center`,textTransform:`none`,cursor:`pointer`,opacity:0,transition:`color ${e.motionDurationMid} ease, opacity ${e.motionDurationSlow} ease`,textRendering:`auto`,transform:`translateZ(0)`,"&:before":{display:`block`},"&:hover":{color:e.colorIcon}},"@media(hover:none)":i,"&:hover":i},[`${n}-status`]:{"&-error, &-warning, &-success, &-validating":{[`&${n}-has-feedback`]:{[`${n}-clear`]:{insetInlineEnd:e.calc(r).add(e.fontSize).add(e.paddingXS).equal()}}}}}},Xre=e=>{let{componentCls:t}=e;return[{[t]:{[`&${t}-in-form-item`]:{width:`100%`}}},Yre(e),Wre(e),{[`${t}-rtl`]:{direction:`rtl`}},Bf(e,{focusElCls:`${t}-focused`})]},Zre=fo(`Select`,(e,{rootPrefixCls:t})=>{let n=yi(e,{rootPrefixCls:t,inputPaddingHorizontalBase:e.calc(e.paddingSM).sub(e.lineWidth).equal(),multipleSelectItemHeight:e.multipleItemHeight,selectHeight:e.controlHeight});return[Xre(n),qre(n)]},Jre,{unitless:{optionLineHeight:!0,optionSelectedFontWeight:!0}}),Qre={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z`}}]},name:`check`,theme:`outlined`};function cg(){return cg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cg.apply(this,arguments)}var lg=y.forwardRef((e,t)=>y.createElement(Bo,cg({},e,{ref:t,icon:Qre}))),$re={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z`}}]},name:`down`,theme:`outlined`};function ug(){return ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ug.apply(this,arguments)}var eie=y.forwardRef((e,t)=>y.createElement(Bo,ug({},e,{ref:t,icon:$re}))),tie={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z`}}]},name:`search`,theme:`outlined`};function dg(){return dg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dg.apply(this,arguments)}var fg=y.forwardRef((e,t)=>y.createElement(Bo,dg({},e,{ref:t,icon:tie})));function nie({suffixIcon:e,clearIcon:t,menuItemSelectedIcon:n,removeIcon:r,loading:i,multiple:a,hasFeedback:o,showSuffixIcon:s,feedbackIcon:c,showArrow:l,componentName:u}){let d=t??y.createElement(Go,null),f=t=>e===null&&!o&&!l?null:y.createElement(y.Fragment,null,s!==!1&&t,o&&c),p=null;p=e===void 0?i?f(y.createElement(Nu,{spin:!0})):({open:e,showSearch:t})=>f(e&&t?y.createElement(fg,null):y.createElement(eie,null)):f(e);let m=null;m=n===void 0?a?y.createElement(lg,null):null:n;let h=null;return h=r===void 0?y.createElement(Jo,null):r,{clearIcon:d,suffixIcon:p,itemIcon:m,removeIcon:h}}function rie(e){return y.useMemo(()=>{if(e)return(...t)=>y.createElement(Cm,{space:!0},e.apply(void 0,t))},[e])}var iie=rie;function aie(e,t){return t===void 0?e!==null:t}var pg=`SECRET_COMBOBOX_MODE_DO_NOT_USE`,mg=y.forwardRef((e,t)=>{let{prefixCls:n,bordered:r,className:i,rootClassName:a,getPopupContainer:o,popupClassName:s,dropdownClassName:c,listHeight:l=256,placement:u,listItemHeight:d,size:f,disabled:p,notFoundContent:m,status:h,builtinPlacements:g,dropdownMatchSelectWidth:_,popupMatchSelectWidth:v,direction:b,style:x,allowClear:S,variant:C,popupStyle:w,dropdownStyle:T,transitionName:E,tagRender:D,maxCount:O,prefix:k,dropdownRender:A,popupRender:j,onDropdownVisibleChange:M,onOpenChange:N,styles:ee,classNames:te,...P}=e,{getPopupContainer:ne,getPrefixCls:re,renderEmpty:ie,direction:ae,virtual:oe,popupMatchSelectWidth:se,popupOverflow:ce}=y.useContext(dt),{showSearch:le,style:ue,styles:de,className:fe,classNames:pe}=mt(`select`),[,me]=eo(),he=d??me?.controlHeight,ge=re(`select`,n),_e=re(),ve=b??ae,{compactSize:ye,compactItemClassnames:be}=pd(ge,ve),[xe,Se]=rg(`select`,C,r),Ce=Kc(ge),[we,Te]=Zre(ge,Ce),Ee=y.useMemo(()=>{let{mode:t}=e;if(t!==`combobox`)return t===pg?`combobox`:t},[e.mode]),Oe=Ee===`multiple`||Ee===`tags`,ke=aie(e.suffixIcon,e.showArrow),Ae=v??_??se,je=iie(j||A),Me=N||M,{status:Ne,hasFeedback:Pe,isFormItemInput:Fe,feedbackIcon:Ie}=y.useContext(Sm),Le=Qh(Ne,h),Re;Re=m===void 0?Ee===`combobox`?null:ie?.(`Select`)||y.createElement(Bre,{componentName:`Select`}):m;let{suffixIcon:ze,itemIcon:Be,removeIcon:Ve,clearIcon:He}=nie({...P,multiple:Oe,hasFeedback:Pe,feedbackIcon:Ie,showSuffixIcon:ke,prefixCls:ge,componentName:`Select`}),Ue=S===!0?{clearIcon:He}:S,We=De(P,[`suffixIcon`,`itemIcon`]),Ge=ld(e=>f??ye??e),Ke=y.useContext(Ql),qe=p??Ke,Je={...e,variant:xe,status:Le,disabled:qe,size:Ge},[Ye,Xe]=Nc([pe,te],[de,ee],{props:Je},{popup:{_default:`root`}}),Ze=F(Ye.popup?.root,s,c,{[`${ge}-dropdown-${ve}`]:ve===`rtl`},a,Te,Ce,we),Qe={...Xe.popup?.root,...w??T},$e=F({[`${ge}-lg`]:Ge===`large`,[`${ge}-sm`]:Ge===`small`,[`${ge}-rtl`]:ve===`rtl`,[`${ge}-${xe}`]:Se,[`${ge}-in-form-item`]:Fe},Zh(ge,Le,Pe),be,fe,i,Ye.root,a,Te,Ce,we),et=y.useMemo(()=>u===void 0?ve===`rtl`?`bottomRight`:`bottomLeft`:u,[u,ve]),[tt]=Hc(`SelectLike`,Xe.popup?.root?.zIndex??Qe?.zIndex);return y.createElement(Fre,{ref:t,virtual:oe,classNames:Ye,styles:Xe,showSearch:le,...We,style:{...Xe.root,...ue,...x},popupMatchSelectWidth:Ae,transitionName:$u(_e,`slide-up`,E),builtinPlacements:Ure(g,ce),listHeight:l,listItemHeight:he,mode:Ee,prefixCls:ge,placement:et,direction:ve,prefix:k,suffixIcon:ze,menuItemSelectedIcon:Be,removeIcon:Ve,allowClear:Ue,notFoundContent:Re,className:$e,getPopupContainer:o||ne,popupClassName:Ze,disabled:qe,popupStyle:{...Xe.popup?.root,...Qe,zIndex:tt},maxCount:Oe?O:void 0,tagRender:Oe?D:void 0,popupRender:je,onPopupVisibleChange:Me})}),oie=Mne(mg,`popupAlign`);mg.SECRET_COMBOBOX_MODE_DO_NOT_USE=pg,mg.Option=Mh,mg.OptGroup=Ah,mg._InternalPanelDoNotUseOrYouWillBeFired=oie;var hg=mg,gg=e=>{let{children:t,prefixCls:n,id:r,classNames:i,styles:a,className:o,style:s}=e;return y.createElement(`div`,{id:r,className:F(`${n}-container`,i?.container,o),style:{...a?.container,...s},role:`tooltip`},typeof t==`function`?t():t)},_g={shiftX:64,adjustY:1},vg={adjustX:1,shiftY:!0},yg=[0,0];const sie={left:{points:[`cr`,`cl`],overflow:vg,offset:[-4,0],targetOffset:yg},right:{points:[`cl`,`cr`],overflow:vg,offset:[4,0],targetOffset:yg},top:{points:[`bc`,`tc`],overflow:_g,offset:[0,-4],targetOffset:yg},bottom:{points:[`tc`,`bc`],overflow:_g,offset:[0,4],targetOffset:yg},topLeft:{points:[`bl`,`tl`],overflow:_g,offset:[0,-4],targetOffset:yg},leftTop:{points:[`tr`,`tl`],overflow:vg,offset:[-4,0],targetOffset:yg},topRight:{points:[`br`,`tr`],overflow:_g,offset:[0,-4],targetOffset:yg},rightTop:{points:[`tl`,`tr`],overflow:vg,offset:[4,0],targetOffset:yg},bottomRight:{points:[`tr`,`br`],overflow:_g,offset:[0,4],targetOffset:yg},rightBottom:{points:[`bl`,`br`],overflow:vg,offset:[4,0],targetOffset:yg},bottomLeft:{points:[`tl`,`bl`],overflow:_g,offset:[0,4],targetOffset:yg},leftBottom:{points:[`br`,`bl`],overflow:vg,offset:[-4,0],targetOffset:yg}};function bg(){return bg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},bg.apply(this,arguments)}var cie=y.forwardRef((e,t)=>{let{trigger:n=[`hover`],mouseEnterDelay:r=0,mouseLeaveDelay:i=.1,prefixCls:a=`rc-tooltip`,children:o,onVisibleChange:s,afterVisibleChange:c,motion:l,placement:u=`right`,align:d={},destroyOnHidden:f=!1,defaultVisible:p,getTooltipContainer:m,arrowContent:h,overlay:g,id:_,showArrow:v=!0,classNames:b,styles:x,...S}=e,C=dl(_),w=(0,y.useRef)(null);(0,y.useImperativeHandle)(t,()=>w.current);let T={...S};`visible`in e&&(T.popupVisible=e.visible);let E=y.useMemo(()=>{if(!v)return!1;let e=v===!0?{}:v;return{...e,className:F(e.className,b?.arrow),style:{...e.style,...x?.arrow},content:e.content??h}},[v,b?.arrow,x?.arrow,h]);return y.createElement(Gl,bg({popupClassName:b?.root,prefixCls:a,popup:y.createElement(gg,{key:`content`,prefixCls:a,id:C,classNames:b,styles:x},g),action:n,builtinPlacements:sie,popupPlacement:u,ref:w,popupAlign:d,getPopupContainer:m,onOpenChange:s,afterOpenChange:c,popupMotion:l,defaultPopupVisible:p,autoDestroy:f,mouseLeaveDelay:i,popupStyle:x?.root,mouseEnterDelay:r,arrow:E,uniqueContainerClassName:b?.uniqueContainer,uniqueContainerStyle:x?.uniqueContainer},T),({open:e})=>{let t=y.Children.only(o),n={"aria-describedby":g&&e?C:void 0};return y.cloneElement(t,n)})});function lie(e){let{sizePopupArrow:t,borderRadiusXS:n,borderRadiusOuter:r}=e,i=t/2,a=i,o=r*1/Math.sqrt(2),s=i-r*(1-1/Math.sqrt(2)),c=i-n*(1/Math.sqrt(2)),l=r*(Math.sqrt(2)-1)+n*(1/Math.sqrt(2)),u=2*i-c,d=l,f=2*i-o,p=s,m=2*i-0,h=a,g=i*Math.sqrt(2)+r*(Math.sqrt(2)-2),_=r*(Math.sqrt(2)-1),v=`polygon(${_}px 100%, 50% ${_}px, ${2*i-_}px 100%, ${_}px 100%)`;return{arrowShadowWidth:g,arrowPath:`path('M 0 ${a} A ${r} ${r} 0 0 0 ${o} ${s} L ${c} ${l} A ${n} ${n} 0 0 1 ${u} ${d} L ${f} ${p} A ${r} ${r} 0 0 0 ${m} ${h} Z')`,arrowPolygon:v}}const uie=(e,t,n)=>{let{sizePopupArrow:r,arrowPolygon:i,arrowPath:a,arrowShadowWidth:o,borderRadiusXS:s,calc:c}=e;return{pointerEvents:`none`,width:r,height:r,overflow:`hidden`,"&::before":{position:`absolute`,bottom:0,insetInlineStart:0,width:r,height:c(r).div(2).equal(),background:t,clipPath:{_multi_value_:!0,value:[i,a]},content:`""`},"&::after":{content:`""`,position:`absolute`,width:o,height:o,bottom:0,insetInline:0,margin:`auto`,borderRadius:{_skip_check_:!0,value:`0 0 ${tn(s)} 0`},transform:`translateY(50%) rotate(-135deg)`,boxShadow:n,zIndex:0,background:`transparent`}}};function xg(e){let{contentRadius:t,limitVerticalRadius:n}=e,r=t>12?t+2:12;return{arrowOffsetHorizontal:r,arrowOffsetVertical:n?8:r}}function Sg(e,t){return e?t:{}}function die(e,t,n){let{componentCls:r,boxShadowPopoverArrow:i,arrowOffsetVertical:a,arrowOffsetHorizontal:o}=e,{arrowDistance:s=0,arrowPlacement:c={left:!0,right:!0,top:!0,bottom:!0}}=n||{};return{[r]:{[`${r}-arrow`]:[{position:`absolute`,zIndex:1,display:`block`,...uie(e,t,i),"&:before":{background:t}}],...Sg(!!c.top,{[[`&-placement-top > ${r}-arrow`,`&-placement-topLeft > ${r}-arrow`,`&-placement-topRight > ${r}-arrow`].join(`,`)]:{bottom:s,transform:`translateY(100%) rotate(180deg)`},[`&-placement-top > ${r}-arrow`]:{left:{_skip_check_:!0,value:`50%`},transform:`translateX(-50%) translateY(100%) rotate(180deg)`},"&-placement-topLeft":{"--arrow-offset-horizontal":o,[`> ${r}-arrow`]:{left:{_skip_check_:!0,value:o}}},"&-placement-topRight":{"--arrow-offset-horizontal":`calc(100% - ${tn(o)})`,[`> ${r}-arrow`]:{right:{_skip_check_:!0,value:o}}}}),...Sg(!!c.bottom,{[[`&-placement-bottom > ${r}-arrow`,`&-placement-bottomLeft > ${r}-arrow`,`&-placement-bottomRight > ${r}-arrow`].join(`,`)]:{top:s,transform:`translateY(-100%)`},[`&-placement-bottom > ${r}-arrow`]:{left:{_skip_check_:!0,value:`50%`},transform:`translateX(-50%) translateY(-100%)`},"&-placement-bottomLeft":{"--arrow-offset-horizontal":o,[`> ${r}-arrow`]:{left:{_skip_check_:!0,value:o}}},"&-placement-bottomRight":{"--arrow-offset-horizontal":`calc(100% - ${tn(o)})`,[`> ${r}-arrow`]:{right:{_skip_check_:!0,value:o}}}}),...Sg(!!c.left,{[[`&-placement-left > ${r}-arrow`,`&-placement-leftTop > ${r}-arrow`,`&-placement-leftBottom > ${r}-arrow`].join(`,`)]:{right:{_skip_check_:!0,value:s},transform:`translateX(100%) rotate(90deg)`},[`&-placement-left > ${r}-arrow`]:{top:{_skip_check_:!0,value:`50%`},transform:`translateY(-50%) translateX(100%) rotate(90deg)`},[`&-placement-leftTop > ${r}-arrow`]:{top:a},[`&-placement-leftBottom > ${r}-arrow`]:{bottom:a}}),...Sg(!!c.right,{[[`&-placement-right > ${r}-arrow`,`&-placement-rightTop > ${r}-arrow`,`&-placement-rightBottom > ${r}-arrow`].join(`,`)]:{left:{_skip_check_:!0,value:s},transform:`translateX(-100%) rotate(-90deg)`},[`&-placement-right > ${r}-arrow`]:{top:{_skip_check_:!0,value:`50%`},transform:`translateY(-50%) translateX(-100%) rotate(-90deg)`},[`&-placement-rightTop > ${r}-arrow`]:{top:a},[`&-placement-rightBottom > ${r}-arrow`]:{bottom:a}})}}}function fie(e,t,n,r){if(r===!1)return{adjustX:!1,adjustY:!1};let i=r&&typeof r==`object`?r:{},a={};switch(e){case`top`:case`bottom`:a.shiftX=t.arrowOffsetHorizontal*2+n,a.shiftY=!0,a.adjustY=!0;break;case`left`:case`right`:a.shiftY=t.arrowOffsetVertical*2+n,a.shiftX=!0,a.adjustX=!0;break}let o={...a,...i};return o.shiftX||(o.adjustX=!0),o.shiftY||(o.adjustY=!0),o}var Cg={left:{points:[`cr`,`cl`]},right:{points:[`cl`,`cr`]},top:{points:[`bc`,`tc`]},bottom:{points:[`tc`,`bc`]},topLeft:{points:[`bl`,`tl`]},leftTop:{points:[`tr`,`tl`]},topRight:{points:[`br`,`tr`]},rightTop:{points:[`tl`,`tr`]},bottomRight:{points:[`tr`,`br`]},rightBottom:{points:[`bl`,`br`]},bottomLeft:{points:[`tl`,`bl`]},leftBottom:{points:[`br`,`bl`]}},pie={topLeft:{points:[`bl`,`tc`]},leftTop:{points:[`tr`,`cl`]},topRight:{points:[`br`,`tc`]},rightTop:{points:[`tl`,`cr`]},bottomRight:{points:[`tr`,`bc`]},rightBottom:{points:[`bl`,`cr`]},bottomLeft:{points:[`tl`,`bc`]},leftBottom:{points:[`br`,`cl`]}},mie=new Set([`topLeft`,`topRight`,`bottomLeft`,`bottomRight`,`leftTop`,`leftBottom`,`rightTop`,`rightBottom`]);function hie(e){let{arrowWidth:t,autoAdjustOverflow:n,arrowPointAtCenter:r,offset:i,borderRadius:a,visibleFirst:o}=e,s=t/2,c={},l=xg({contentRadius:a,limitVerticalRadius:!0});return Object.keys(Cg).forEach(e=>{let a={...r&&pie[e]||Cg[e],offset:[0,0],dynamicInset:!0};switch(c[e]=a,mie.has(e)&&(a.autoArrow=!1),e){case`top`:case`topLeft`:case`topRight`:a.offset[1]=-s-i;break;case`bottom`:case`bottomLeft`:case`bottomRight`:a.offset[1]=s+i;break;case`left`:case`leftTop`:case`leftBottom`:a.offset[0]=-s-i;break;case`right`:case`rightTop`:case`rightBottom`:a.offset[0]=s+i;break}if(r)switch(e){case`topLeft`:case`bottomLeft`:a.offset[0]=-l.arrowOffsetHorizontal-s;break;case`topRight`:case`bottomRight`:a.offset[0]=l.arrowOffsetHorizontal+s;break;case`leftTop`:case`rightTop`:a.offset[1]=-l.arrowOffsetHorizontal*2+s;break;case`leftBottom`:case`rightBottom`:a.offset[1]=l.arrowOffsetHorizontal*2-s;break}a.overflow=fie(e,l,t,n),o&&(a.htmlRegion=`visibleFirst`)}),c}var gie=(e,t)=>{let n=e=>typeof e==`boolean`?{show:e}:e||{};return y.useMemo(()=>{let r=n(e),i=n(t);return{...i,...r,show:r.show??i.show??!0}},[e,t])},_ie=e=>{let{calc:t,componentCls:n,tooltipMaxWidth:r,tooltipColor:i,tooltipBg:a,tooltipBorderRadius:o,zIndexPopup:s,controlHeight:c,boxShadowSecondary:l,paddingSM:u,paddingXS:d,arrowOffsetHorizontal:f,sizePopupArrow:p}=e,m=t(o).add(p).add(f).equal(),h={minWidth:t(o).mul(2).add(p).equal(),minHeight:c,padding:`${tn(e.calc(u).div(2).equal())} ${tn(d)}`,color:`var(--ant-tooltip-color, ${i})`,textAlign:`start`,textDecoration:`none`,wordWrap:`break-word`,backgroundColor:a,borderRadius:o,boxShadow:l,boxSizing:`border-box`},g={"--valid-offset-x":`var(--arrow-offset-horizontal, var(--arrow-x))`,transformOrigin:[`var(--valid-offset-x, 50%)`,`var(--arrow-y, 50%)`].join(` `)};return[{[n]:{...no(e),position:`absolute`,zIndex:s,display:`block`,width:`max-content`,maxWidth:r,visibility:`visible`,...g,"&-hidden":{display:`none`},"--antd-arrow-background-color":a,[`${n}-container`]:[h,Yd(e,!0)],[`&:has(~ ${n}-unique-container)`]:{[`${n}-container`]:{border:`none`,background:`transparent`,boxShadow:`none`}},[[`&-placement-topLeft`,`&-placement-topRight`,`&-placement-bottomLeft`,`&-placement-bottomRight`].join(`,`)]:{minWidth:m},[[`&-placement-left`,`&-placement-leftTop`,`&-placement-leftBottom`,`&-placement-right`,`&-placement-rightTop`,`&-placement-rightBottom`].join(`,`)]:{[`${n}-inner`]:{borderRadius:e.min(o,8)}},[`${n}-content`]:{position:`relative`},...go(e,(e,{darkColor:t})=>({[`&${n}-${e}`]:{[`${n}-container`]:{backgroundColor:t},[`${n}-arrow`]:{"--antd-arrow-background-color":t}}})),"&-rtl":{direction:`rtl`}}},die(e,`var(--antd-arrow-background-color)`),{[`${n}-pure`]:{position:`relative`,maxWidth:`none`,margin:e.sizePopupArrow}},{[`${n}-unique-container`]:{...h,...g,position:`absolute`,zIndex:t(s).sub(1).equal(),"&-hidden":{display:`none`},"&-visible":{transition:`all ${e.motionDurationSlow}`}}}]};const vie=e=>({zIndexPopup:e.zIndexPopupBase+70,...xg({contentRadius:e.borderRadius,limitVerticalRadius:!0}),...lie(yi(e,{borderRadiusOuter:Math.min(e.borderRadiusOuter,4)}))});var wg=(e,t,n=!0)=>fo(`Tooltip`,e=>{let{borderRadius:t,colorTextLightSolid:n,colorBgSpotlight:r}=e;return[_ie(yi(e,{tooltipMaxWidth:250,tooltipColor:n,tooltipBorderRadius:t,tooltipBg:r})),Of(e,`zoom-big-fast`)]},vie,{resetStyle:!1,injectStyle:n})(e,t),yie=Pi.map(e=>`${e}-inverse`);const bie=[`success`,`processing`,`error`,`default`,`warning`];function Tg(e,t=!0){return t?[].concat(nt(yie),nt(Pi)).includes(e):Pi.includes(e)}function xie(e){return bie.includes(e)}function Eg(e,t){let n=Tg(t),r=F({[`${e}-${t}`]:t&&n}),i={},a={},o=kf(t).toRgb(),s=(.299*o.r+.587*o.g+.114*o.b)/255<.5?`#FFF`:`#000`;return t&&!n&&(i.background=t,i[`--ant-tooltip-color`]=s,a[`--antd-arrow-background-color`]=t),{className:r,overlayStyle:i,arrowStyle:a}}var Sie=e=>{let{prefixCls:t,className:n,placement:r=`top`,title:i,color:a,overlayInnerStyle:o,classNames:s,styles:c}=e,{getPrefixCls:l}=y.useContext(dt),u=l(`tooltip`,t),d=Kc(u),[f,p]=wg(u,d),m=Eg(u,a),h=m.arrowStyle,g=y.useMemo(()=>({container:{...o,...m.overlayStyle}}),[o,m.overlayStyle]),_={...e,placement:r},[v,b]=Nc([s],[g,c],{props:_}),x=F(d,f,p,u,`${u}-pure`,`${u}-placement-${r}`,n,m.className);return y.createElement(`div`,{className:x,style:h},y.createElement(`div`,{className:`${u}-arrow`}),y.createElement(gg,{...e,className:f,prefixCls:u,classNames:v,styles:b},i))},Dg=y.forwardRef((e,t)=>{let{prefixCls:n,openClassName:r,getTooltipContainer:i,color:a,children:o,afterOpenChange:s,arrow:c,destroyTooltipOnHide:l,destroyOnHidden:u,title:d,overlay:f,trigger:p,builtinPlacements:m,autoAdjustOverflow:h=!0,motion:g,getPopupContainer:_,placement:v=`top`,mouseEnterDelay:b=.1,mouseLeaveDelay:x=.1,rootClassName:S,styles:C,classNames:w,onOpenChange:T,overlayInnerStyle:E,overlayStyle:D,overlayClassName:k,...A}=e,[,j]=eo(),{getPopupContainer:M,getPrefixCls:N,direction:ee,className:te,style:P,classNames:ne,styles:re,arrow:ie,trigger:ae}=mt(`tooltip`),oe=gie(c,ie),se=oe.show,ce=p||ae||`hover`;Me(`Tooltip`);let le=y.useRef(null),ue=()=>{le.current?.forceAlign()};y.useImperativeHandle(t,()=>({forceAlign:ue,nativeElement:le.current?.nativeElement,popupElement:le.current?.popupElement}));let[de,fe]=O(e.defaultOpen??!1,e.open),pe=!d&&!f&&d!==0,me=e=>{fe(pe?!1:e),!pe&&T&&T(e)},he=y.useMemo(()=>m||hie({arrowPointAtCenter:oe?.pointAtCenter??!1,autoAdjustOverflow:h,arrowWidth:se?j.sizePopupArrow:0,borderRadius:j.borderRadius,offset:j.marginXXS,visibleFirst:!0}),[oe,m,j,se,h]),ge=y.useMemo(()=>d===0?d:f||d||``,[f,d]),_e=y.createElement(Cm,{space:!0},typeof ge==`function`?ge():ge),ve={...e,trigger:ce,color:a,placement:v,builtinPlacements:m,openClassName:r,arrow:c,autoAdjustOverflow:h,getPopupContainer:_,children:o,destroyTooltipOnHide:l,destroyOnHidden:u},[ye,be]=Nc([ne,w],[re,C],{props:ve}),xe=N(`tooltip`,n),Se=N(),Ce=e[`data-popover-inject`],we=de;!(`open`in e)&&pe&&(we=!1);let Te=y.isValidElement(o)&&!Uc(o)?o:y.createElement(`span`,null,o),Ee=Te.props,De=!Ee.className||typeof Ee.className==`string`?F(Ee.className,r||`${xe}-open`):Ee.className,Oe=Kc(xe),[ke,Ae]=wg(xe,Oe,!Ce),je=Eg(xe,a),Ne=je.arrowStyle,Pe=F(Oe,ke,Ae),Fe=F(k,{[`${xe}-rtl`]:ee===`rtl`},je.className,S,Pe,te,ye.root),[Ie,Le]=Hc(`Tooltip`,A.zIndex),Re={...be.container,...E,...je.overlayStyle},ze=y.createElement(cie,{unique:!0,...A,trigger:ce,zIndex:Ie,showArrow:se,placement:v,mouseEnterDelay:b,mouseLeaveDelay:x,prefixCls:xe,classNames:{root:Fe,container:ye.container,arrow:ye.arrow,uniqueContainer:F(Pe,ye.container)},styles:{root:{...Ne,...be.root,...P,...D},container:Re,uniqueContainer:Re,arrow:be.arrow},getTooltipContainer:_||i||M,ref:le,builtinPlacements:he,overlay:_e,visible:we,onVisibleChange:me,afterVisibleChange:s,arrowContent:y.createElement(`span`,{className:`${xe}-arrow-content`}),motion:{motionName:$u(Se,`zoom-big-fast`,typeof g?.motionName==`string`?g?.motionName:void 0),motionDeadline:1e3},destroyOnHidden:u??!!l},we?Gc(Te,{className:De}):Te);return y.createElement(Ic.Provider,{value:Le},ze)});Dg._InternalPanelDoNotUseOrYouWillBeFired=Sie,Dg.UniqueProvider=Yl;var Og=Dg,Cie={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z`}}]},name:`left`,theme:`outlined`};function kg(){return kg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kg.apply(this,arguments)}var Ag=y.forwardRef((e,t)=>y.createElement(Bo,kg({},e,{ref:t,icon:Cie}))),{ESC:wie,TAB:Tie}=mu;function Eie({visible:e,triggerRef:t,onVisibleChange:n,autoFocus:r,overlayRef:i}){let a=y.useRef(!1),o=()=>{e&&(t.current?.focus?.(),n?.(!1))},s=()=>i.current?.focus?(i.current.focus(),a.current=!0,!0):!1,c=e=>{switch(e.keyCode){case wie:o();break;case Tie:{let t=!1;a.current||(t=s()),t?e.preventDefault():o();break}}};y.useEffect(()=>e?(window.addEventListener(`keydown`,c),r&&lt(s,3),()=>{window.removeEventListener(`keydown`,c),a.current=!1}):()=>{a.current=!1},[e])}var Die=(0,y.forwardRef)((e,t)=>{let{overlay:n,arrow:r,prefixCls:i}=e,a=(0,y.useMemo)(()=>{let e;return e=typeof n==`function`?n():n,e},[n]),o=ie(t,ce(a));return y.createElement(y.Fragment,null,r&&y.createElement(`div`,{className:`${i}-arrow`}),y.cloneElement(a,{ref:oe(a)?o:void 0}))}),jg={adjustX:1,adjustY:1},Mg=[0,0],Oie={topLeft:{points:[`bl`,`tl`],overflow:jg,offset:[0,-4],targetOffset:Mg},top:{points:[`bc`,`tc`],overflow:jg,offset:[0,-4],targetOffset:Mg},topRight:{points:[`br`,`tr`],overflow:jg,offset:[0,-4],targetOffset:Mg},bottomLeft:{points:[`tl`,`bl`],overflow:jg,offset:[0,4],targetOffset:Mg},bottom:{points:[`tc`,`bc`],overflow:jg,offset:[0,4],targetOffset:Mg},bottomRight:{points:[`tr`,`br`],overflow:jg,offset:[0,4],targetOffset:Mg}};function Ng(){return Ng=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ng.apply(this,arguments)}var kie=y.forwardRef((e,t)=>{let{arrow:n=!1,prefixCls:r=`rc-dropdown`,transitionName:i,animation:a,align:o,placement:s=`bottomLeft`,placements:c=Oie,getPopupContainer:l,showAction:u,hideAction:d,overlayClassName:f,overlayStyle:p,visible:m,trigger:h=[`hover`],autoFocus:g,overlay:_,children:v,onVisibleChange:b,...x}=e,[S,C]=y.useState(),w=`visible`in e?m:S,T=a?`${r}-${a}`:i,E=y.useRef(null),D=y.useRef(null),O=y.useRef(null);y.useImperativeHandle(t,()=>E.current);let k=e=>{C(e),b?.(e)};Eie({visible:w,triggerRef:O,onVisibleChange:k,autoFocus:g,overlayRef:D});let A=t=>{let{onOverlayClick:n}=e;C(!1),n&&n(t)},j=()=>y.createElement(Die,{ref:D,overlay:_,prefixCls:r,arrow:n}),M=()=>typeof _==`function`?j:j(),N=()=>{let{minOverlayWidthMatchTrigger:t,alignPoint:n}=e;return`minOverlayWidthMatchTrigger`in e?t:!n},ee=y.cloneElement(v,{className:F(v.props?.className,w&&(()=>{let{openClassName:t}=e;return t===void 0?`${r}-open`:t})()),ref:oe(v)?ie(O,ce(v)):void 0}),te=d;return!te&&h.indexOf(`contextMenu`)!==-1&&(te=[`click`]),y.createElement(Gl,Ng({builtinPlacements:c},x,{prefixCls:r,ref:E,popupClassName:F(f,{[`${r}-show-arrow`]:n}),popupStyle:p,action:h,showAction:u,hideAction:te,popupPlacement:s,popupAlign:o,popupMotion:{motionName:T},popupVisible:w,stretch:N()?`minWidth`:``,popup:M(),onOpenChange:k,onPopupClick:A,getPopupContainer:l}),ee)});const Pg=y.createContext(null);function Fg(e,t){return`${e}-${t}`}function Ig(e){return Fg(y.useContext(Pg),e)}const Lg=y.createContext(null);function Aie(e,t){let n={...e};return Object.keys(t).forEach(e=>{let r=t[e];r!==void 0&&(n[e]=r)}),n}function Rg({children:e,locked:t,...n}){let r=y.useContext(Lg),i=j(()=>Aie(r,n),[r,n],(e,n)=>!t&&(e[0]!==n[0]||!Mt(e[1],n[1],!0)));return y.createElement(Lg.Provider,{value:i},e)}var jie=[];const zg=y.createContext(null);function Bg(){return y.useContext(zg)}const Vg=y.createContext(jie);function Hg(e){let t=y.useContext(Vg);return y.useMemo(()=>e===void 0?t:[...t,e],[t,e])}const Ug=y.createContext(null);var Wg=y.createContext({});function Gg(e,t=!1){if(Cl(e)){let n=e.nodeName.toLowerCase(),r=[`input`,`select`,`textarea`,`button`].includes(n)||e.isContentEditable||n===`a`&&!!e.getAttribute(`href`),i=e.getAttribute(`tabindex`),a=Number(i),o=null;return i&&!Number.isNaN(a)?o=a:r&&o===null&&(o=0),r&&e.disabled&&(o=null),o!==null&&(o>=0||t&&o<0)}return!1}function Mie(e,t=!1){let n=[...e.querySelectorAll(`*`)].filter(e=>Gg(e,t));return Gg(e,t)&&n.unshift(e),n}function Kg(e,t){if(!e)return;e.focus(t);let{cursor:n}=t||{};if(n&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)){let t=e.value.length;switch(n){case`start`:e.setSelectionRange(0,0);break;case`end`:e.setSelectionRange(t,t);break;default:e.setSelectionRange(0,t)}}}var{LEFT:qg,RIGHT:Jg,UP:Yg,DOWN:Xg,ENTER:Zg,ESC:Qg,HOME:$g,END:e_}=mu,t_=[Yg,Xg,qg,Jg];function Nie(e,t,n,r){let i=`prev`,a=`next`,o=`children`,s=`parent`;if(e===`inline`&&r===Zg)return{inlineTrigger:!0};let c={[Yg]:i,[Xg]:a},l={[qg]:n?a:i,[Jg]:n?i:a,[Xg]:o,[Zg]:o},u={[Yg]:i,[Xg]:a,[Zg]:o,[Qg]:s,[qg]:n?o:s,[Jg]:n?s:o};switch({inline:c,horizontal:l,vertical:u,inlineSub:c,horizontalSub:u,verticalSub:u}[`${e}${t?``:`Sub`}`]?.[r]){case i:return{offset:-1,sibling:!0};case a:return{offset:1,sibling:!0};case s:return{offset:-1,sibling:!1};case o:return{offset:1,sibling:!1};default:return null}}function Pie(e){let t=e;for(;t;){if(t.getAttribute(`data-menu-list`))return t;t=t.parentElement}return null}function Fie(e,t){let n=e||document.activeElement;for(;n;){if(t.has(n))return n;n=n.parentElement}return null}function n_(e,t){return Mie(e,!0).filter(e=>t.has(e))}function r_(e,t,n,r=1){if(!e)return null;let i=n_(e,t),a=i.length,o=i.findIndex(e=>n===e);return r<0?o===-1?o=a-1:--o:r>0&&(o+=1),o=(o+a)%a,i[o]}const i_=(e,t)=>{let n=new Set,r=new Map,i=new Map;return e.forEach(e=>{let a=document.querySelector(`[data-menu-id='${Fg(t,e)}']`);a&&(n.add(a),i.set(a,e),r.set(e,a))}),{elements:n,key2element:r,element2key:i}};function Iie(e,t,n,r,i,a,o,s,c,l){let u=y.useRef(),d=y.useRef();d.current=t;let f=()=>{lt.cancel(u.current)};return y.useEffect(()=>()=>{f()},[]),p=>{let{which:m}=p;if([...t_,Zg,Qg,$g,e_].includes(m)){let l=a(),h=i_(l,r),{elements:g,key2element:_,element2key:v}=h,y=Fie(_.get(t),g),b=v.get(y),x=Nie(e,o(b,!0).length===1,n,m);if(!x&&m!==$g&&m!==e_)return;(t_.includes(m)||[$g,e_].includes(m))&&p.preventDefault();let S=e=>{if(e){let t=e,n=e.querySelector(`a`);n?.getAttribute(`href`)&&(t=n);let r=v.get(e);s(r),f(),u.current=lt(()=>{d.current===r&&t.focus()})}};if([$g,e_].includes(m)||x.sibling||!y){let t;t=!y||e===`inline`?i.current:Pie(y);let n,r=n_(t,g);n=m===$g?r[0]:m===e_?r[r.length-1]:r_(t,g,y,x.offset),S(n)}else if(x.inlineTrigger)c(b);else if(x.offset>0)c(b,!0),f(),u.current=lt(()=>{h=i_(l,r);let e=y.getAttribute(`aria-controls`);S(r_(document.getElementById(e),h.elements))},5);else if(x.offset<0){let e=o(b,!0),t=e[e.length-2],n=_.get(t);c(t,!1),S(n)}}l?.(p)}}function Lie(e){Promise.resolve().then(e)}var a_=`__RC_UTIL_PATH_SPLIT__`,o_=e=>e.join(a_),Rie=e=>e.split(a_);const s_=`rc-menu-more`;function zie(){let[,e]=y.useState({}),t=(0,y.useRef)(new Map),n=(0,y.useRef)(new Map),[r,i]=y.useState([]),a=(0,y.useRef)(0),o=(0,y.useRef)(!1),s=()=>{o.current||e({})},c=(0,y.useCallback)((e,r)=>{let i=o_(r);n.current.set(i,e),t.current.set(e,i),a.current+=1;let o=a.current;Lie(()=>{o===a.current&&s()})},[]),l=(0,y.useCallback)((e,r)=>{let i=o_(r);n.current.delete(i),t.current.delete(e)},[]),u=(0,y.useCallback)(e=>{i(e)},[]),d=(0,y.useCallback)((e,n)=>{let i=Rie(t.current.get(e)||``);return n&&r.includes(i[0])&&i.unshift(s_),i},[r]),f=(0,y.useCallback)((e,t)=>e.filter(e=>e!==void 0).some(e=>d(e,!0).includes(t)),[d]),p=()=>{let e=[...t.current.keys()];return r.length&&e.push(s_),e},m=(0,y.useCallback)(e=>{let r=`${t.current.get(e)}${a_}`,i=new Set;return[...n.current.keys()].forEach(e=>{e.startsWith(r)&&i.add(n.current.get(e))}),i},[]);return y.useEffect(()=>()=>{o.current=!0},[]),{registerPath:c,unregisterPath:l,refreshOverflowKeys:u,isSubPathKey:f,getKeyPath:d,getKeys:p,getSubPathKeys:m}}function c_(e){let t=y.useRef(e);t.current=e;let n=y.useCallback((...e)=>t.current?.(...e),[]);return e?n:void 0}function l_(e,t,n,r){let{activeKey:i,onActive:a,onInactive:o}=y.useContext(Lg),s={active:i===e};return t||(s.onMouseEnter=t=>{n?.({key:e,domEvent:t}),a(e)},s.onMouseLeave=t=>{r?.({key:e,domEvent:t}),o(e)}),s}function u_(e){let{mode:t,rtl:n,inlineIndent:r}=y.useContext(Lg);if(t!==`inline`)return null;let i=e;return n?{paddingRight:i*r}:{paddingLeft:i*r}}function Bie({icon:e,props:t,children:n}){let r;return e===null||e===!1?null:(typeof e==`function`?r=y.createElement(e,{...t}):typeof e!=`boolean`&&(r=e),r||n||null)}function d_({item:e,...t}){return Object.defineProperty(t,`item`,{get:()=>(Ee(!1,"`info.item` is deprecated since we will move to function component that not provides React Node instance in future."),e)}),t}function f_(){return f_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f_.apply(this,arguments)}var Vie=class extends y.Component{render(){let{title:e,attribute:t,elementRef:n,...r}=this.props,i=De(r,[`eventKey`,`popupClassName`,`popupOffset`,`onTitleClick`]);return Ee(!t,"`attribute` of Menu.Item is deprecated. Please pass attribute directly."),y.createElement(Sh.Item,f_({},t,{title:typeof e==`string`?e:void 0},i,{ref:n}))}},Hie=y.forwardRef((e,t)=>{let{style:n,className:r,eventKey:i,warnKey:a,disabled:o,itemIcon:s,children:c,role:l,onMouseEnter:u,onMouseLeave:d,onClick:f,onKeyDown:p,onFocus:m,...h}=e,g=Ig(i),{prefixCls:_,onItemClick:v,disabled:b,overflowDisabled:x,itemIcon:S,selectedKeys:C,onActive:w}=y.useContext(Lg),{_internalRenderMenuItem:T}=y.useContext(Wg),E=`${_}-item`,D=y.useRef(),O=y.useRef(),k=b||o,A=ae(t,O),j=Hg(i),M=e=>({key:i,keyPath:[...j].reverse(),item:D.current,domEvent:e}),N=s||S,{active:ee,...te}=l_(i,k,u,d),P=C.includes(i),ne=u_(j.length),re=e=>{if(k)return;let t=M(e);f?.(d_(t)),v(t)},ie=e=>{if(p?.(e),e.which===mu.ENTER){let t=M(e);f?.(d_(t)),v(t)}},oe=e=>{w(i),m?.(e)},se={};e.role===`option`&&(se[`aria-selected`]=P);let ce=y.createElement(Vie,f_({ref:D,elementRef:A,role:l===null?`none`:l||`menuitem`,tabIndex:o?null:-1,"data-menu-id":x&&g?null:g},De(h,[`extra`]),te,se,{component:`li`,"aria-disabled":o,style:{...ne,...n},className:F(E,{[`${E}-active`]:ee,[`${E}-selected`]:P,[`${E}-disabled`]:k},r),onClick:re,onKeyDown:ie,onFocus:oe}),c,y.createElement(Bie,{props:{...e,isSelected:P},icon:N}));return T&&(ce=T(ce,e,{selected:P})),ce});function Uie(e,t){let{eventKey:n}=e,r=Bg(),i=Hg(n);return y.useEffect(()=>{if(r)return r.registerPath(n,i),()=>{r.unregisterPath(n,i)}},[i]),r?null:y.createElement(Hie,f_({},e,{ref:t}))}var p_=y.forwardRef(Uie);function m_(){return m_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m_.apply(this,arguments)}var Wie=y.forwardRef(({className:e,children:t,...n},r)=>{let{prefixCls:i,mode:a,rtl:o}=y.useContext(Lg);return y.createElement(`ul`,m_({className:F(i,o&&`${i}-rtl`,`${i}-sub`,`${i}-${a===`inline`?`inline`:`vertical`}`,e),role:`menu`},n,{"data-menu-list":!0,ref:r}),t)});function h_(e,t){return Oe(e).map((e,n)=>{if(y.isValidElement(e)){let{key:r}=e,i=e.props?.eventKey??r;i??=`tmp_key-${[...t,n].join(`-`)}`;let a={key:i,eventKey:i};return y.cloneElement(e,a)}return e})}var g_={adjustX:1,adjustY:1};const Gie={topLeft:{points:[`bl`,`tl`],overflow:g_},topRight:{points:[`br`,`tr`],overflow:g_},bottomLeft:{points:[`tl`,`bl`],overflow:g_},bottomRight:{points:[`tr`,`br`],overflow:g_},leftTop:{points:[`tr`,`tl`],overflow:g_},leftBottom:{points:[`br`,`bl`],overflow:g_},rightTop:{points:[`tl`,`tr`],overflow:g_},rightBottom:{points:[`bl`,`br`],overflow:g_}},Kie={topLeft:{points:[`bl`,`tl`],overflow:g_},topRight:{points:[`br`,`tr`],overflow:g_},bottomLeft:{points:[`tl`,`bl`],overflow:g_},bottomRight:{points:[`tr`,`br`],overflow:g_},rightTop:{points:[`tr`,`tl`],overflow:g_},rightBottom:{points:[`br`,`bl`],overflow:g_},leftTop:{points:[`tl`,`tr`],overflow:g_},leftBottom:{points:[`bl`,`br`],overflow:g_}};function qie(e,t,n){if(t)return t;if(n)return n[e]||n.other}var Jie={horizontal:`bottomLeft`,vertical:`rightTop`,"vertical-left":`rightTop`,"vertical-right":`leftTop`};function Yie({prefixCls:e,visible:t,children:n,popup:r,popupStyle:i,popupClassName:a,popupOffset:o,disabled:s,mode:c,onVisibleChange:l}){let{getPopupContainer:u,rtl:d,subMenuOpenDelay:f,subMenuCloseDelay:p,builtinPlacements:m,triggerSubMenuAction:h,forceSubMenuRender:g,rootClassName:_,motion:v,defaultMotions:b}=y.useContext(Lg),[x,S]=y.useState(!1),C=d?{...Kie,...m}:{...Gie,...m},w=Jie[c],T=qie(c,v,b),E=y.useRef(T);c!==`inline`&&(E.current=T);let D={...E.current,leavedClassName:`${e}-hidden`,removeOnLeave:!1,motionAppear:!0},O=y.useRef();return y.useEffect(()=>(O.current=lt(()=>{S(t)}),()=>{lt.cancel(O.current)}),[t]),y.createElement(Gl,{prefixCls:e,popupClassName:F(`${e}-popup`,{[`${e}-rtl`]:d},a,_),stretch:c===`horizontal`?`minWidth`:null,getPopupContainer:u,builtinPlacements:C,popupPlacement:w,popupVisible:x,popup:r,popupStyle:i,popupAlign:o&&{offset:o},action:s?[]:[h],mouseEnterDelay:f,mouseLeaveDelay:p,onPopupVisibleChange:l,forceRender:g,popupMotion:D,fresh:!0},n)}function __(){return __=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},__.apply(this,arguments)}function Xie({id:e,open:t,keyPath:n,children:r}){let i=`inline`,{prefixCls:a,forceSubMenuRender:o,motion:s,defaultMotions:c,mode:l}=y.useContext(Lg),u=y.useRef(!1);u.current=l===i;let[d,f]=y.useState(!u.current),p=u.current?t:!1;y.useEffect(()=>{u.current&&f(!1)},[l]);let m={...qie(i,s,c)};n.length>1&&(m.motionAppear=!1);let h=m.onVisibleChanged;return m.onVisibleChanged=e=>(!u.current&&!e&&f(!0),h?.(e)),d?null:y.createElement(Rg,{mode:i,locked:!u.current},y.createElement(Bs,__({visible:p},m,{forceRender:o,removeOnLeave:!1,leavedClassName:`${a}-hidden`}),({className:t,style:n})=>y.createElement(Wie,{id:e,className:t,style:n},r)))}function v_(){return v_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v_.apply(this,arguments)}var Zie=y.forwardRef((e,t)=>{let{style:n,className:r,styles:i,classNames:a,title:o,eventKey:s,warnKey:c,disabled:l,internalPopupClose:u,children:d,itemIcon:f,expandIcon:p,popupClassName:m,popupOffset:h,popupStyle:g,onClick:_,onMouseEnter:v,onMouseLeave:b,onTitleClick:x,onTitleMouseEnter:S,onTitleMouseLeave:C,popupRender:w,...T}=e,E=Ig(s),{prefixCls:D,mode:O,openKeys:k,disabled:A,overflowDisabled:j,activeKey:M,selectedKeys:N,itemIcon:ee,expandIcon:te,onItemClick:P,onOpenChange:ne,onActive:re,popupRender:ie}=y.useContext(Lg),{_internalRenderSubMenuItem:ae}=y.useContext(Wg),{isSubPathKey:oe}=y.useContext(Ug),se=Hg(),ce=`${D}-submenu`,le=A||l,ue=y.useRef(),de=y.useRef(),fe=f??ee,pe=p??te,me=k.includes(s),he=!j&&me,ge=oe(N,s),{active:_e,...ve}=l_(s,le,S,C),[ye,be]=y.useState(!1),xe=e=>{le||be(e)},Se=e=>{xe(!0),v?.({key:s,domEvent:e})},Ce=e=>{xe(!1),b?.({key:s,domEvent:e})},we=y.useMemo(()=>_e||(O===`inline`?!1:ye||oe([M],s)),[O,_e,M,ye,s,oe]),Te=u_(se.length),Ee=e=>{le||(x?.({key:s,domEvent:e}),O===`inline`&&ne(s,!me))},De=c_(e=>{_?.(d_(e)),P(e)}),Oe=e=>{O!==`inline`&&ne(s,e)},ke=()=>{re(s)},Ae=E&&`${E}-popup`,je=y.useMemo(()=>y.createElement(Bie,{icon:O===`horizontal`?void 0:pe,props:{...e,isOpen:he,isSubMenu:!0}},y.createElement(`i`,{className:`${ce}-arrow`})),[O,pe,e,he,ce]),Me=y.createElement(`div`,v_({role:`menuitem`,style:Te,className:`${ce}-title`,tabIndex:le?null:-1,ref:ue,title:typeof o==`string`?o:null,"data-menu-id":j&&E?null:E,"aria-expanded":he,"aria-haspopup":!0,"aria-controls":Ae,"aria-disabled":le,onClick:Ee,onFocus:ke},ve),o,je),Ne=y.useRef(O);O!==`inline`&&se.length>1?Ne.current=`vertical`:Ne.current=O;let Pe=Ne.current,Fe=y.useMemo(()=>{let t=y.createElement(Rg,{classNames:a,styles:i,mode:Pe===`horizontal`?`vertical`:Pe},y.createElement(Wie,{id:Ae,ref:de},d)),n=w||ie;return n?n(t,{item:e,keys:se}):t},[w,ie,se,Ae,d,e,Pe]);if(!j){let e=Ne.current;Me=y.createElement(Yie,{mode:e,prefixCls:ce,visible:!u&&he&&O!==`inline`,popupClassName:m,popupOffset:h,popupStyle:g,popup:Fe,disabled:le,onVisibleChange:Oe},Me)}let Ie=y.createElement(Sh.Item,v_({ref:t,role:`none`},T,{component:`li`,style:n,className:F(ce,`${ce}-${O}`,r,{[`${ce}-open`]:he,[`${ce}-active`]:we,[`${ce}-selected`]:ge,[`${ce}-disabled`]:le}),onMouseEnter:Se,onMouseLeave:Ce}),Me,!j&&y.createElement(Xie,{id:Ae,open:he,keyPath:se},d));return ae&&(Ie=ae(Ie,e,{selected:ge,active:we,open:he,disabled:le})),y.createElement(Rg,{classNames:a,styles:i,onItemClick:De,mode:O===`horizontal`?`vertical`:O,itemIcon:fe,expandIcon:pe},Ie)}),y_=y.forwardRef((e,t)=>{let{eventKey:n,children:r}=e,i=Hg(n),a=h_(r,i),o=Bg();y.useEffect(()=>{if(o)return o.registerPath(n,i),()=>{o.unregisterPath(n,i)}},[i]);let s;return s=o?a:y.createElement(Zie,v_({ref:t},e),a),y.createElement(Vg.Provider,{value:i},s)});function Qie({className:e,style:t}){let{prefixCls:n}=y.useContext(Lg);return Bg()?null:y.createElement(`li`,{role:`separator`,className:F(`${n}-item-divider`,e),style:t})}function b_(){return b_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b_.apply(this,arguments)}var $ie=y.forwardRef((e,t)=>{let{className:n,title:r,eventKey:i,children:a,...o}=e,{prefixCls:s,classNames:c,styles:l}=y.useContext(Lg),u=`${s}-item-group`;return y.createElement(`li`,b_({ref:t,role:`presentation`},o,{onClick:e=>e.stopPropagation(),className:F(u,n)}),y.createElement(`div`,{role:`presentation`,className:F(`${u}-title`,c?.listTitle),style:l?.listTitle,title:typeof r==`string`?r:void 0},r),y.createElement(`ul`,{role:`group`,className:F(`${u}-list`,c?.list),style:l?.list},a))}),eae=y.forwardRef((e,t)=>{let{eventKey:n,children:r}=e,i=h_(r,Hg(n));return Bg()?i:y.createElement($ie,b_({ref:t},De(e,[`warnKey`])),i)});function x_(){return x_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},x_.apply(this,arguments)}function S_(e,t,n){let{item:r,group:i,submenu:a,divider:o}=t;return(e||[]).map((e,s)=>{if(e&&typeof e==`object`){let{label:c,children:l,key:u,type:d,extra:f,...p}=e,m=u??`tmp-${s}`;return l||d===`group`?d===`group`?y.createElement(i,x_({key:m},p,{title:c}),S_(l,t,n)):y.createElement(a,x_({key:m},p,{title:c}),S_(l,t,n)):d===`divider`?y.createElement(o,x_({key:m},p)):y.createElement(r,x_({key:m},p,{extra:f}),c,(!!f||f===0)&&y.createElement(`span`,{className:`${n}-item-extra`},f))}return null}).filter(e=>e)}function tae(e,t,n,r,i){let a=e,o={divider:Qie,item:p_,group:eae,submenu:y_,...r};return t&&(a=S_(t,o,i)),h_(a,n)}var nae=h();function C_(){return C_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C_.apply(this,arguments)}var w_=[],T_=y.forwardRef((e,t)=>{let{prefixCls:n=`rc-menu`,rootClassName:r,style:i,className:a,styles:o,classNames:s,tabIndex:c=0,items:l,children:u,direction:d,id:f,mode:p=`vertical`,inlineCollapsed:m,disabled:h,disabledOverflow:g,subMenuOpenDelay:_=.1,subMenuCloseDelay:v=.1,forceSubMenuRender:b,defaultOpenKeys:x,openKeys:S,activeKey:C,defaultActiveFirst:w,selectable:T=!0,multiple:E=!1,defaultSelectedKeys:D,selectedKeys:k,onSelect:A,onDeselect:j,inlineIndent:M=24,motion:N,defaultMotions:ee,triggerSubMenuAction:te=`hover`,builtinPlacements:P,itemIcon:ne,expandIcon:re,overflowedIndicator:ie=`...`,overflowedIndicatorPopupClassName:ae,getPopupContainer:oe,onClick:se,onOpenChange:ce,onKeyDown:le,openAnimation:ue,openTransitionName:de,_internalRenderMenuItem:fe,_internalRenderSubMenuItem:pe,_internalComponents:me,popupRender:he,...ge}=e,[_e,ve]=y.useMemo(()=>[tae(u,l,w_,me,n),tae(u,l,w_,{},n)],[u,l,me]),[ye,be]=y.useState(!1),xe=y.useRef(),Se=dl(f?`rc-menu-uuid-${f}`:`rc-menu-uuid`),Ce=d===`rtl`,[we,Te]=O(x,S),Ee=we||w_,De=(e,t=!1)=>{function n(){Te(e),ce?.(e)}t?(0,nae.flushSync)(n):n()},[Oe,ke]=y.useState(Ee),Ae=y.useRef(!1),[je,Me]=y.useMemo(()=>(p===`inline`||p===`vertical`)&&m?[`vertical`,m]:[p,!1],[p,m]),Ne=je===`inline`,[Pe,Fe]=y.useState(je),[Ie,Le]=y.useState(Me);y.useEffect(()=>{Fe(je),Le(Me),Ae.current&&(Ne?Te(Oe):De(w_))},[je,Me]);let[Re,ze]=y.useState(0),Be=Re>=_e.length-1||Pe!==`horizontal`||g;y.useEffect(()=>{Ne&&ke(Ee)},[Ee]),y.useEffect(()=>(Ae.current=!0,()=>{Ae.current=!1}),[]);let{registerPath:Ve,unregisterPath:He,refreshOverflowKeys:Ue,isSubPathKey:We,getKeyPath:Ge,getKeys:Ke,getSubPathKeys:qe}=zie(),Je=y.useMemo(()=>({registerPath:Ve,unregisterPath:He}),[Ve,He]),Ye=y.useMemo(()=>({isSubPathKey:We}),[We]);y.useEffect(()=>{Ue(Be?w_:_e.slice(Re+1).map(e=>e.key))},[Re,Be]);let[Xe,Ze]=O(C||w&&_e[0]?.key,C),Qe=c_(e=>{Ze(e)}),$e=c_(()=>{Ze(void 0)});(0,y.useImperativeHandle)(t,()=>({list:xe.current,focus:e=>{let t=Ke(),{elements:n,key2element:r,element2key:i}=i_(t,Se),a=n_(xe.current,n),o;o=Xe&&t.includes(Xe)?Xe:a[0]?i.get(a[0]):_e.find(e=>!e.props.disabled)?.key;let s=r.get(o);o&&s&&s?.focus?.(e)},findItem:({key:e})=>{let{key2element:t}=i_(Ke(),Se);return t.get(e)||null}}));let[et,tt]=O(D||[],k),nt=y.useMemo(()=>Array.isArray(et)?et:et==null?w_:[et],[et]),rt=e=>{if(T){let{key:t}=e,n=nt.includes(t),r;r=E?n?nt.filter(e=>e!==t):[...nt,t]:[t],tt(r);let i={...e,selectedKeys:r};n?j?.(i):A?.(i)}!E&&Ee.length&&Pe!==`inline`&&De(w_)},it=c_(e=>{se?.(d_(e)),rt(e)}),at=c_((e,t)=>{let n=Ee.filter(t=>t!==e);if(t)n.push(e);else if(Pe!==`inline`){let t=qe(e);n=n.filter(e=>!t.has(e))}Mt(Ee,n,!0)||De(n,!0)}),ot=Iie(Pe,Xe,Ce,Se,xe,Ke,Ge,Ze,(e,t)=>{at(e,t??!Ee.includes(e))},le);y.useEffect(()=>{be(!0)},[]);let st=y.useMemo(()=>({_internalRenderMenuItem:fe,_internalRenderSubMenuItem:pe}),[fe,pe]),ct=Pe!==`horizontal`||g?_e:_e.map((e,t)=>y.createElement(Rg,{key:e.key,overflowDisabled:t>Re,classNames:s,styles:o},e)),lt=y.createElement(Sh,C_({id:f,ref:xe,prefixCls:`${n}-overflow`,component:`ul`,itemComponent:p_,className:F(n,`${n}-root`,`${n}-${Pe}`,a,{[`${n}-inline-collapsed`]:Ie,[`${n}-rtl`]:Ce},r),dir:d,style:i,role:`menu`,tabIndex:c,data:ct,renderRawItem:e=>e,renderRawRest:e=>{let t=e.length,n=t?_e.slice(-t):null;return y.createElement(y_,{eventKey:s_,title:ie,disabled:Be,internalPopupClose:t===0,popupClassName:ae},n)},maxCount:Pe!==`horizontal`||g?Sh.INVALIDATE:Sh.RESPONSIVE,ssr:`full`,"data-menu-list":!0,onVisibleChange:e=>{ze(e)},onKeyDown:ot},ge));return y.createElement(Wg.Provider,{value:st},y.createElement(Pg.Provider,{value:Se},y.createElement(Rg,{prefixCls:n,rootClassName:r,classNames:s,styles:o,mode:Pe,openKeys:Ee,rtl:Ce,disabled:h,motion:ye?N:null,defaultMotions:ye?ee:null,activeKey:Xe,onActive:Qe,onInactive:$e,selectedKeys:nt,inlineIndent:M,subMenuOpenDelay:_,subMenuCloseDelay:v,forceSubMenuRender:b,builtinPlacements:P,triggerSubMenuAction:te,getPopupContainer:oe,itemIcon:ne,expandIcon:re,onItemClick:it,onOpenChange:at,popupRender:he},y.createElement(Ug.Provider,{value:Ye},lt),y.createElement(`div`,{style:{display:`none`},"aria-hidden":!0},y.createElement(zg.Provider,{value:Je},ve)))))});T_.Item=p_,T_.SubMenu=y_,T_.ItemGroup=eae,T_.Divider=Qie;var rae=T_,iae={icon:{tag:`svg`,attrs:{viewBox:`0 0 1024 1024`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z`}}]},name:`bars`,theme:`outlined`};function E_(){return E_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E_.apply(this,arguments)}var aae=y.forwardRef((e,t)=>y.createElement(Bo,E_({},e,{ref:t,icon:iae})));const oae=y.createContext({siderHook:{addSider:()=>null,removeSider:()=>null}});var sae=e=>{let{antCls:t,componentCls:n,colorText:r,footerBg:i,headerHeight:a,headerPadding:o,headerColor:s,footerPadding:c,fontSize:l,bodyBg:u,headerBg:d}=e;return{[n]:{display:`flex`,flex:`auto`,flexDirection:`column`,minHeight:0,background:u,"&, *":{boxSizing:`border-box`},[`&${n}-has-sider`]:{flexDirection:`row`,[`> ${n}, > ${n}-content`]:{width:0}},[`${n}-header, &${n}-footer`]:{flex:`0 0 auto`},"&-rtl":{direction:`rtl`}},[`${n}-header`]:{height:a,padding:o,color:s,lineHeight:tn(a),background:d,[`${t}-menu`]:{lineHeight:`inherit`}},[`${n}-footer`]:{padding:c,color:r,fontSize:l,background:i},[`${n}-content`]:{flex:`auto`,color:r,minHeight:0}}};const cae=e=>{let{colorBgLayout:t,controlHeight:n,controlHeightLG:r,colorText:i,controlHeightSM:a,marginXXS:o,colorTextLightSolid:s,colorBgContainer:c}=e,l=r*1.25;return{colorBgHeader:`#001529`,colorBgBody:t,colorBgTrigger:`#002140`,bodyBg:t,headerBg:`#001529`,headerHeight:n*2,headerPadding:`0 ${l}px`,headerColor:i,footerPadding:`${a}px ${l}px`,footerBg:t,siderBg:`#001529`,triggerHeight:r+o*2,triggerBg:`#002140`,triggerColor:s,zeroTriggerWidth:r,zeroTriggerHeight:r,lightSiderBg:c,lightTriggerBg:c,lightTriggerColor:i}},lae=[[`colorBgBody`,`bodyBg`],[`colorBgHeader`,`headerBg`],[`colorBgTrigger`,`triggerBg`]];var uae=fo(`Layout`,sae,cae,{deprecatedTokens:lae}),dae=fo([`Layout`,`Sider`],e=>{let{componentCls:t,siderBg:n,motionDurationMid:r,motionDurationSlow:i,antCls:a,triggerHeight:o,triggerColor:s,triggerBg:c,headerHeight:l,zeroTriggerWidth:u,zeroTriggerHeight:d,borderRadiusLG:f,lightSiderBg:p,lightTriggerColor:m,lightTriggerBg:h,bodyBg:g}=e;return{[t]:{position:`relative`,minWidth:0,background:n,transition:`all ${r}, background 0s`,"&-has-trigger":{paddingBottom:o},"&-right":{order:1},[`${t}-children`]:{height:`100%`,marginTop:-.1,paddingTop:.1,[`${a}-menu${a}-menu-inline-collapsed`]:{width:`auto`}},[`&-zero-width ${t}-children`]:{overflow:`hidden`},[`${t}-trigger`]:{position:`fixed`,bottom:0,zIndex:1,height:o,color:s,lineHeight:tn(o),textAlign:`center`,background:c,cursor:`pointer`,transition:`all ${r}`},[`${t}-zero-width-trigger`]:{position:`absolute`,top:l,insetInlineEnd:e.calc(u).mul(-1).equal(),zIndex:1,width:u,height:d,color:s,fontSize:e.fontSizeXL,display:`flex`,alignItems:`center`,justifyContent:`center`,background:n,borderRadius:`0 ${tn(f)} ${tn(f)} 0`,cursor:`pointer`,transition:`background ${i} ease`,"&::after":{position:`absolute`,inset:0,background:`transparent`,transition:`all ${i}`,content:`""`},"&:hover::after":{background:`rgba(255, 255, 255, 0.2)`},"&-right":{insetInlineStart:e.calc(u).mul(-1).equal(),borderRadius:`${tn(f)} 0 0 ${tn(f)}`}},"&-light":{background:p,[`${t}-trigger`]:{color:m,background:h},[`${t}-zero-width-trigger`]:{color:m,background:h,border:`1px solid ${g}`,borderInlineStart:0}}}}},cae,{deprecatedTokens:lae}),fae={xs:`479.98px`,sm:`575.98px`,md:`767.98px`,lg:`991.98px`,xl:`1199.98px`,xxl:`1599.98px`},pae=e=>!Number.isNaN(Number.parseFloat(e))&&Number.isFinite(Number(e));const mae=y.createContext({});var hae=(()=>{let e=0;return(t=``)=>(e+=1,`${t}${e}`)})(),gae=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,trigger:i,children:a,defaultCollapsed:o=!1,theme:s=`dark`,style:c={},collapsible:l=!1,reverseArrow:u=!1,width:d=200,collapsedWidth:f=80,zeroWidthTriggerStyle:p,breakpoint:m,onCollapse:h,onBreakpoint:g,..._}=e,{siderHook:v}=(0,y.useContext)(oae),[b,x]=(0,y.useState)(`collapsed`in e?e.collapsed:o),[S,C]=(0,y.useState)(!1);(0,y.useEffect)(()=>{`collapsed`in e&&x(e.collapsed)},[e.collapsed]);let w=(t,n)=>{`collapsed`in e||x(t),h?.(t,n)},{getPrefixCls:T,direction:E}=(0,y.useContext)(dt),D=T(`layout-sider`,n),[O,k]=dae(D),A=(0,y.useRef)(null);A.current=e=>{C(e.matches),g?.(e.matches),b!==e.matches&&w(e.matches,`responsive`)},(0,y.useEffect)(()=>{function e(e){return A.current?.(e)}let t;return window?.matchMedia!==void 0&&m&&m in fae&&(t=window.matchMedia(`screen and (max-width: ${fae[m]})`),typeof t?.addEventListener==`function`&&t.addEventListener(`change`,e),e(t)),()=>{typeof t?.removeEventListener==`function`&&t.removeEventListener(`change`,e)}},[m]),(0,y.useEffect)(()=>{let e=hae(`ant-sider-`);return v.addSider(e),()=>v.removeSider(e)},[]);let j=()=>{w(!b,`clickTrigger`)},M=De(_,[`collapsed`]),N=b?f:d,ee=pae(N)?`${N}px`:String(N),te=Number.parseFloat(String(f||0))===0?y.createElement(`span`,{onClick:j,className:F(`${D}-zero-width-trigger`,`${D}-zero-width-trigger-${u?`right`:`left`}`),style:p},i||y.createElement(aae,null)):null,P=E===`rtl`==!u,ne={expanded:P?y.createElement(Vd,null):y.createElement(Ag,null),collapsed:P?y.createElement(Ag,null):y.createElement(Vd,null)}[b?`collapsed`:`expanded`],re=i===null?null:te||y.createElement(`div`,{className:`${D}-trigger`,onClick:j,style:{width:ee}},i||ne),ie={...c,flex:`0 0 ${ee}`,maxWidth:ee,minWidth:ee,width:ee},ae=F(D,`${D}-${s}`,{[`${D}-collapsed`]:!!b,[`${D}-has-trigger`]:l&&i!==null&&!te,[`${D}-below`]:!!S,[`${D}-zero-width`]:Number.parseFloat(ee)===0},r,O,k),oe=y.useMemo(()=>({siderCollapsed:b}),[b]);return y.createElement(mae.Provider,{value:oe},y.createElement(`aside`,{className:ae,...M,style:ie,ref:t},y.createElement(`div`,{className:`${D}-children`},a),l||S&&te?re:null))}),_ae={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z`}}]},name:`ellipsis`,theme:`outlined`};function D_(){return D_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D_.apply(this,arguments)}var vae=y.forwardRef((e,t)=>y.createElement(Bo,D_({},e,{ref:t,icon:_ae}))),O_=Yf;function yae(e){return e===void 0||e===!1?[]:Array.isArray(e)?e:[e]}function bae(e){return yae(e).join(`_`)}var xae=y.createContext(null);const Sae=xae.Provider;var Cae=xae;const wae=y.createContext(null),Tae=wae.Provider;function k_(){return k_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k_.apply(this,arguments)}var Eae=(0,y.forwardRef)((e,t)=>{let{prefixCls:n=`rc-checkbox`,className:r,style:i,checked:a,disabled:o,defaultChecked:s=!1,type:c=`checkbox`,title:l,onChange:u,...d}=e,f=(0,y.useRef)(null),p=(0,y.useRef)(null),[m,h]=O(s,a);(0,y.useImperativeHandle)(t,()=>({focus:e=>{f.current?.focus(e)},blur:()=>{f.current?.blur()},input:f.current,nativeElement:p.current}));let g=F(n,r,{[`${n}-checked`]:m,[`${n}-disabled`]:o});return y.createElement(`span`,{className:g,title:l,style:i,ref:p},y.createElement(`input`,k_({},d,{className:`${n}-input`,ref:f,onChange:t=>{o||(`checked`in e||h(t.target.checked),u?.({target:{...e,type:c,checked:t.target.checked},stopPropagation(){t.stopPropagation()},preventDefault(){t.preventDefault()},nativeEvent:t.nativeEvent}))},disabled:o,checked:!!m,type:c})),y.createElement(`span`,{className:`${n}-inner`}))});function Dae(e){let t=y.useRef(null),n=()=>{lt.cancel(t.current),t.current=null};return[()=>{n(),t.current=lt(()=>{t.current=null})},r=>{t.current&&(r.stopPropagation(),n()),e?.(r)}]}var Oae=e=>{let{componentCls:t,antCls:n}=e,r=`${t}-group`;return{[r]:{...no(e),display:`inline-block`,fontSize:0,[`&${r}-rtl`]:{direction:`rtl`},[`&${r}-block`]:{display:`flex`},[`${n}-badge ${n}-badge-count`]:{zIndex:1},[`> ${n}-badge:not(:first-child) > ${n}-button-wrapper`]:{borderInlineStart:`none`},"&-vertical":{display:`flex`,flexDirection:`column`,rowGap:e.marginXS}}}},kae=e=>{let{componentCls:t,wrapperMarginInlineEnd:n,colorPrimary:r,radioSize:i,motionDurationSlow:a,motionDurationMid:o,motionEaseInOutCirc:s,colorBgContainer:c,colorBorder:l,lineWidth:u,colorBgContainerDisabled:d,colorTextDisabled:f,paddingXS:p,dotColorDisabled:m,lineType:h,radioColor:g,radioBgColor:_,calc:v}=e,y=`${t}-inner`,b=v(i).sub(v(4).mul(2)),x=v(1).mul(i).equal({unit:!0});return{[`${t}-wrapper`]:{...no(e),display:`inline-flex`,alignItems:`baseline`,marginInlineStart:0,marginInlineEnd:n,cursor:`pointer`,"&:last-child":{marginInlineEnd:0},[`&${t}-wrapper-rtl`]:{direction:`rtl`},"&-disabled":{cursor:`not-allowed`,color:e.colorTextDisabled},"&::after":{display:`inline-block`,width:0,overflow:`hidden`,content:`"\\a0"`},"&-block":{flex:1,justifyContent:`center`},[`${t}-checked::after`]:{position:`absolute`,insetBlockStart:0,insetInlineStart:0,width:`100%`,height:`100%`,border:`${tn(u)} ${h} ${r}`,borderRadius:`50%`,visibility:`hidden`,opacity:0,content:`""`},[t]:{...no(e),position:`relative`,display:`inline-block`,outline:`none`,cursor:`pointer`,alignSelf:`center`,borderRadius:`50%`},[`${t}-wrapper:hover &,
        &:hover ${y}`]:{borderColor:r},[`${t}-input:focus-visible + ${y}`]:so(e),[`${t}:hover::after, ${t}-wrapper:hover &::after`]:{visibility:`visible`},[`${t}-inner`]:{"&::after":{boxSizing:`border-box`,position:`absolute`,insetBlockStart:`50%`,insetInlineStart:`50%`,display:`block`,width:x,height:x,marginBlockStart:v(1).mul(i).div(-2).equal({unit:!0}),marginInlineStart:v(1).mul(i).div(-2).equal({unit:!0}),backgroundColor:g,borderBlockStart:0,borderInlineStart:0,borderRadius:x,transform:`scale(0)`,opacity:0,transition:`all ${a} ${s}`,content:`""`},boxSizing:`border-box`,position:`relative`,insetBlockStart:0,insetInlineStart:0,display:`block`,width:x,height:x,backgroundColor:c,borderColor:l,borderStyle:`solid`,borderWidth:u,borderRadius:`50%`,transition:`all ${o}`},[`${t}-input`]:{position:`absolute`,inset:0,zIndex:1,cursor:`pointer`,opacity:0},[`${t}-checked`]:{[y]:{borderColor:r,backgroundColor:_,"&::after":{transform:`scale(${e.calc(e.dotSize).div(i).equal()})`,opacity:1,transition:`all ${a} ${s}`}}},[`${t}-disabled`]:{cursor:`not-allowed`,[y]:{backgroundColor:d,borderColor:l,cursor:`not-allowed`,"&::after":{backgroundColor:m}},[`${t}-input`]:{cursor:`not-allowed`},[`${t}-disabled + span`]:{color:f,cursor:`not-allowed`},[`&${t}-checked`]:{[y]:{"&::after":{transform:`scale(${v(b).div(i).equal()})`}}}},[`span${t} + *`]:{paddingInlineStart:p,paddingInlineEnd:p}}}},Aae=e=>{let{buttonColor:t,controlHeight:n,componentCls:r,lineWidth:i,lineType:a,colorBorder:o,motionDurationMid:s,buttonPaddingInline:c,fontSize:l,buttonBg:u,fontSizeLG:d,controlHeightLG:f,controlHeightSM:p,paddingXS:m,borderRadius:h,borderRadiusSM:g,borderRadiusLG:_,buttonCheckedBg:v,buttonSolidCheckedColor:y,colorTextDisabled:b,colorBgContainerDisabled:x,buttonCheckedBgDisabled:S,buttonCheckedColorDisabled:C,colorPrimary:w,colorPrimaryHover:T,colorPrimaryActive:E,buttonSolidCheckedBg:D,buttonSolidCheckedHoverBg:O,buttonSolidCheckedActiveBg:k,calc:A}=e;return{[`${r}-button-wrapper`]:{position:`relative`,display:`inline-block`,height:n,margin:0,paddingInline:c,paddingBlock:0,color:t,fontSize:l,lineHeight:tn(A(n).sub(A(i).mul(2)).equal()),background:u,border:`${tn(i)} ${a} ${o}`,borderBlockStartWidth:A(i).add(.02).equal(),borderInlineEndWidth:i,cursor:`pointer`,transition:[`color ${s}`,`background ${s}`,`box-shadow ${s}`].join(`,`),a:{color:t},[`> ${r}-button`]:{position:`absolute`,insetBlockStart:0,insetInlineStart:0,zIndex:-1,width:`100%`,height:`100%`},"&:not(:last-child)":{marginInlineEnd:A(i).mul(-1).equal()},"&:first-child":{borderInlineStart:`${tn(i)} ${a} ${o}`,borderStartStartRadius:h,borderEndStartRadius:h},"&:last-child":{borderStartEndRadius:h,borderEndEndRadius:h},"&:first-child:last-child":{borderRadius:h},[`${r}-group-large &`]:{height:f,fontSize:d,lineHeight:tn(A(f).sub(A(i).mul(2)).equal()),"&:first-child":{borderStartStartRadius:_,borderEndStartRadius:_},"&:last-child":{borderStartEndRadius:_,borderEndEndRadius:_}},[`${r}-group-small &`]:{height:p,paddingInline:A(m).sub(i).equal(),paddingBlock:0,lineHeight:tn(A(p).sub(A(i).mul(2)).equal()),"&:first-child":{borderStartStartRadius:g,borderEndStartRadius:g},"&:last-child":{borderStartEndRadius:g,borderEndEndRadius:g}},"&:hover":{position:`relative`,color:w},"&:has(:focus-visible)":so(e),[`${r}-inner, input[type='checkbox'], input[type='radio']`]:{width:0,height:0,opacity:0,pointerEvents:`none`},[`&-checked:not(${r}-button-wrapper-disabled)`]:{zIndex:1,color:w,background:v,borderColor:w,"&::before":{backgroundColor:w},"&:first-child":{borderColor:w},"&:hover":{color:T,borderColor:T,"&::before":{backgroundColor:T}},"&:active":{color:E,borderColor:E,"&::before":{backgroundColor:E}}},[`${r}-group-solid &-checked:not(${r}-button-wrapper-disabled)`]:{color:y,background:D,borderColor:D,"&:hover":{color:y,background:O,borderColor:O},"&:active":{color:y,background:k,borderColor:k}},"&-disabled":{color:b,backgroundColor:x,borderColor:o,cursor:`not-allowed`,"&:first-child, &:hover":{color:b,backgroundColor:x,borderColor:o}},[`&-disabled${r}-button-wrapper-checked`]:{color:C,backgroundColor:S,borderColor:o,boxShadow:`none`},"&-block":{flex:1,textAlign:`center`}}}},jae=fo(`Radio`,e=>{let{controlOutline:t,controlOutlineWidth:n}=e,r=`0 0 0 ${tn(n)} ${t}`,i=yi(e,{radioFocusShadow:r,radioButtonFocusShadow:r});return[Oae(i),kae(i),Aae(i)]},e=>{let{wireframe:t,padding:n,marginXS:r,lineWidth:i,fontSizeLG:a,colorText:o,colorBgContainer:s,colorTextDisabled:c,controlItemBgActiveDisabled:l,colorTextLightSolid:u,colorPrimary:d,colorPrimaryHover:f,colorPrimaryActive:p,colorWhite:m}=e,h=a;return{radioSize:h,dotSize:t?h-8:h-(4+i)*2,dotColorDisabled:c,buttonSolidCheckedColor:u,buttonSolidCheckedBg:d,buttonSolidCheckedHoverBg:f,buttonSolidCheckedActiveBg:p,buttonBg:s,buttonCheckedBg:s,buttonColor:o,buttonCheckedBgDisabled:l,buttonCheckedColorDisabled:c,buttonPaddingInline:n-i,wrapperMarginInlineEnd:r,radioColor:t?d:m,radioBgColor:t?s:d}},{unitless:{radioSize:!0,dotSize:!0}}),A_=y.forwardRef((e,t)=>{let n=y.useContext(Cae),r=y.useContext(wae),{getPrefixCls:i,direction:a,className:o,style:s,classNames:c,styles:l}=mt(`radio`),u=ie(t,y.useRef(null)),{isFormItemInput:d}=y.useContext(Sm),f=t=>{e.onChange?.(t),n?.onChange?.(t)},{prefixCls:p,className:m,rootClassName:h,children:g,style:_,title:v,classNames:b,styles:x,...S}=e,C=i(`radio`,p),w=(n?.optionType||r)===`button`,T=w?`${C}-button`:C,E=Kc(C),[D,O]=jae(C,E),k={...S},A=y.useContext(Ql);n&&(k.name=n.name,k.onChange=f,k.checked=e.value===n.value,k.disabled=k.disabled??n.disabled),k.disabled=k.disabled??A;let j={...e,...k},[M,N]=Nc([c,b],[l,x],{props:j}),ee=F(`${T}-wrapper`,{[`${T}-wrapper-checked`]:k.checked,[`${T}-wrapper-disabled`]:k.disabled,[`${T}-wrapper-rtl`]:a===`rtl`,[`${T}-wrapper-in-form-item`]:d,[`${T}-wrapper-block`]:!!n?.block},o,m,h,M.root,D,O,E),[te,P]=Dae(k.onClick);return y.createElement(cd,{component:`Radio`,disabled:k.disabled},y.createElement(`label`,{className:ee,style:{...N.root,...s,..._},onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,title:v,onClick:te},y.createElement(Eae,{...k,className:F(M.icon,{[nd]:!w}),style:N.icon,type:`radio`,prefixCls:T,ref:u,onClick:P}),g===void 0?null:y.createElement(`span`,{className:F(`${T}-label`,M.label),style:N.label},g)))}),Mae=y.forwardRef((e,t)=>{let{getPrefixCls:n,direction:r}=y.useContext(dt),{name:i}=y.useContext(Sm),a=dl(bae(i)),{prefixCls:o,className:s,rootClassName:c,options:l,buttonStyle:u=`outline`,disabled:d,children:f,size:p,style:m,id:h,optionType:g,name:_=a,defaultValue:v,value:b,block:x=!1,onChange:S,onMouseEnter:C,onMouseLeave:w,onFocus:T,onBlur:E,orientation:D,vertical:k}=e,[A,j]=O(v,b),M=y.useCallback(t=>{let n=A,r=t.target.value;`value`in e||j(r),r!==n&&S?.(t)},[A,j,S]),N=n(`radio`,o),ee=`${N}-group`,te=Kc(N),[P,ne]=jae(N,te),re=f;l&&l.length>0&&(re=l.map(e=>typeof e==`string`||typeof e==`number`?y.createElement(A_,{key:e.toString(),prefixCls:N,disabled:d,value:e,checked:A===e},e):y.createElement(A_,{key:`radio-group-value-options-${e.value}`,prefixCls:N,disabled:e.disabled||d,value:e.value,checked:A===e.value,title:e.title,style:e.style,className:e.className,id:e.id,required:e.required},e.label)));let ie=ld(p),[,ae]=Fc(D,k),oe=F(ee,`${ee}-${u}`,{[`${ee}-${ie}`]:ie,[`${ee}-rtl`]:r===`rtl`,[`${ee}-block`]:x},s,c,P,ne,te),se=y.useMemo(()=>({onChange:M,value:A,disabled:d,name:_,optionType:g,block:x}),[M,A,d,_,g,x]);return y.createElement(`div`,{...Gs(e,{aria:!0,data:!0}),className:F(oe,{[`${N}-group-vertical`]:ae}),style:m,onMouseEnter:C,onMouseLeave:w,onFocus:T,onBlur:E,id:h,ref:t},y.createElement(Sae,{value:se},re))}),Nae=y.memo(Mae),Pae=y.forwardRef((e,t)=>{let{getPrefixCls:n}=y.useContext(dt),{prefixCls:r,...i}=e,a=n(`radio`,r);return y.createElement(Tae,{value:`button`},y.createElement(A_,{prefixCls:a,...i,type:`radio`,ref:t}))}),j_=A_;j_.Button=Pae,j_.Group=Nae,j_.__ANT_RADIO=!0;var M_=j_;function N_(e){return yi(e,{inputAffixPadding:e.paddingXXS})}const P_=e=>{let{controlHeight:t,fontSize:n,lineHeight:r,lineWidth:i,controlHeightSM:a,controlHeightLG:o,fontSizeLG:s,lineHeightLG:c,paddingSM:l,controlPaddingHorizontalSM:u,controlPaddingHorizontal:d,colorFillAlter:f,colorPrimaryHover:p,colorPrimary:m,controlOutlineWidth:h,controlOutline:g,colorErrorOutline:_,colorWarningOutline:v,colorBgContainer:y,inputFontSize:b,inputFontSizeLG:x,inputFontSizeSM:S}=e,C=b||n,w=S||C,T=x||s,E=Math.round((t-C*r)/2*10)/10-i,D=Math.round((a-w*r)/2*10)/10-i,O=Math.ceil((o-T*c)/2*10)/10-i;return{paddingBlock:Math.max(E,0),paddingBlockSM:Math.max(D,0),paddingBlockLG:Math.max(O,0),paddingInline:l-i,paddingInlineSM:u-i,paddingInlineLG:d-i,addonBg:f,activeBorderColor:m,hoverBorderColor:p,activeShadow:`0 0 0 ${h}px ${g}`,errorActiveShadow:`0 0 0 ${h}px ${_}`,warningActiveShadow:`0 0 0 ${h}px ${v}`,hoverBg:y,activeBg:y,inputFontSize:C,inputFontSizeLG:T,inputFontSizeSM:w}},Fae=e=>({borderColor:e.hoverBorderColor,backgroundColor:e.hoverBg}),F_=e=>({color:e.colorTextDisabled,backgroundColor:e.colorBgContainerDisabled,borderColor:e.colorBorder,boxShadow:`none`,cursor:`not-allowed`,opacity:1,"input[disabled], textarea[disabled]":{cursor:`not-allowed`},"&:hover:not([disabled])":{...Fae(yi(e,{hoverBorderColor:e.colorBorder,hoverBg:e.colorBgContainerDisabled}))}}),Iae=(e,t)=>({background:e.colorBgContainer,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:t.borderColor,"&:hover":{borderColor:t.hoverBorderColor,backgroundColor:e.hoverBg},"&:focus, &:focus-within":{borderColor:t.activeBorderColor,boxShadow:t.activeShadow,outline:0,backgroundColor:e.activeBg}});var Lae=(e,t)=>({[`&${e.componentCls}-status-${t.status}:not(${e.componentCls}-disabled)`]:{...Iae(e,t),[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:t.affixColor}},[`&${e.componentCls}-status-${t.status}${e.componentCls}-disabled`]:{borderColor:t.borderColor}});const Rae=(e,t)=>({"&-outlined":{...Iae(e,{borderColor:e.colorBorder,hoverBorderColor:e.hoverBorderColor,activeBorderColor:e.activeBorderColor,activeShadow:e.activeShadow}),[`&${e.componentCls}-disabled, &[disabled]`]:{...F_(e)},...Lae(e,{status:`error`,borderColor:e.colorError,hoverBorderColor:e.colorErrorBorderHover,activeBorderColor:e.colorError,activeShadow:e.errorActiveShadow,affixColor:e.colorError}),...Lae(e,{status:`warning`,borderColor:e.colorWarning,hoverBorderColor:e.colorWarningBorderHover,activeBorderColor:e.colorWarning,activeShadow:e.warningActiveShadow,affixColor:e.colorWarning}),...t}});var zae=(e,t)=>({[`&${e.componentCls}-group-wrapper-status-${t.status}`]:{[`${e.componentCls}-group-addon`]:{borderColor:t.addonBorderColor,color:t.addonColor}}});const Bae=e=>({"&-outlined":{[`${e.componentCls}-group`]:{"&-addon":{background:e.addonBg,border:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}},...zae(e,{status:`error`,addonBorderColor:e.colorError,addonColor:e.colorErrorText}),...zae(e,{status:`warning`,addonBorderColor:e.colorWarning,addonColor:e.colorWarningText}),[`&${e.componentCls}-group-wrapper-disabled`]:{[`${e.componentCls}-group-addon`]:{...F_(e)}}}}),Vae=(e,t)=>{let{componentCls:n}=e;return{"&-borderless":{background:`transparent`,border:`none`,"&:focus, &:focus-within":{outline:`none`},[`&${n}-disabled, &[disabled]`]:{color:e.colorTextDisabled,cursor:`not-allowed`},[`&${n}-status-error`]:{"&, & input, & textarea":{color:e.colorError}},[`&${n}-status-warning`]:{"&, & input, & textarea":{color:e.colorWarning}},...t}}};var Hae=(e,t)=>({background:t.bg,borderWidth:e.lineWidth,borderStyle:e.lineType,borderColor:`transparent`,"input&, & input, textarea&, & textarea":{color:t?.inputColor??`unset`},"&:hover":{background:t.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:t.activeBorderColor,backgroundColor:e.activeBg}}),Uae=(e,t)=>({[`&${e.componentCls}-status-${t.status}:not(${e.componentCls}-disabled)`]:{...Hae(e,t),[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:t.affixColor}}});const Wae=(e,t)=>({"&-filled":{...Hae(e,{bg:e.colorFillTertiary,hoverBg:e.colorFillSecondary,activeBorderColor:e.activeBorderColor,inputColor:e.colorText}),[`&${e.componentCls}-disabled, &[disabled]`]:{...F_(e)},...Uae(e,{status:`error`,bg:e.colorErrorBg,hoverBg:e.colorErrorBgHover,activeBorderColor:e.colorError,inputColor:e.colorErrorText,affixColor:e.colorError}),...Uae(e,{status:`warning`,bg:e.colorWarningBg,hoverBg:e.colorWarningBgHover,activeBorderColor:e.colorWarning,inputColor:e.colorWarningText,affixColor:e.colorWarning}),...t}});var Gae=(e,t)=>({[`&${e.componentCls}-group-wrapper-status-${t.status}`]:{[`${e.componentCls}-group-addon`]:{background:t.addonBg,color:t.addonColor}}});const Kae=e=>({"&-filled":{[`${e.componentCls}-group-addon`]:{background:e.colorFillTertiary,"&:last-child":{position:`static`}},...Gae(e,{status:`error`,addonBg:e.colorErrorBg,addonColor:e.colorErrorText}),...Gae(e,{status:`warning`,addonBg:e.colorWarningBg,addonColor:e.colorWarningText}),[`&${e.componentCls}-group-wrapper-disabled`]:{[`${e.componentCls}-group`]:{"&-addon":{background:e.colorFillTertiary,color:e.colorTextDisabled},"&-addon:first-child":{borderInlineStart:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderTop:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderBottom:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},"&-addon:last-child":{borderInlineEnd:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderTop:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderBottom:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`}}}}}),qae=(e,t)=>({background:e.colorBgContainer,borderWidth:`${tn(e.lineWidth)} 0`,borderStyle:`${e.lineType} none`,borderColor:`transparent transparent ${t.borderColor} transparent`,borderRadius:0,"&:hover":{borderColor:`transparent transparent ${t.hoverBorderColor} transparent`,backgroundColor:e.hoverBg},"&:focus, &:focus-within":{borderColor:`transparent transparent ${t.activeBorderColor} transparent`,outline:0,backgroundColor:e.activeBg}});var Jae=(e,t)=>({[`&${e.componentCls}-status-${t.status}:not(${e.componentCls}-disabled)`]:{...qae(e,t),[`${e.componentCls}-prefix, ${e.componentCls}-suffix`]:{color:t.affixColor}},[`&${e.componentCls}-status-${t.status}${e.componentCls}-disabled`]:{borderColor:`transparent transparent ${t.borderColor} transparent`}});const Yae=(e,t)=>({"&-underlined":{...qae(e,{borderColor:e.colorBorder,hoverBorderColor:e.hoverBorderColor,activeBorderColor:e.activeBorderColor,activeShadow:e.activeShadow}),[`&${e.componentCls}-disabled, &[disabled]`]:{color:e.colorTextDisabled,boxShadow:`none`,cursor:`not-allowed`,"&:hover":{borderColor:`transparent transparent ${e.colorBorder} transparent`}},"input[disabled], textarea[disabled]":{cursor:`not-allowed`},...Jae(e,{status:`error`,borderColor:e.colorError,hoverBorderColor:e.colorErrorBorderHover,activeBorderColor:e.colorError,activeShadow:e.errorActiveShadow,affixColor:e.colorError}),...Jae(e,{status:`warning`,borderColor:e.colorWarning,hoverBorderColor:e.colorWarningBorderHover,activeBorderColor:e.colorWarning,activeShadow:e.warningActiveShadow,affixColor:e.colorWarning}),...t}}),Xae=e=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:e,userSelect:`none`},"&:placeholder-shown":{textOverflow:`ellipsis`}});var Zae=e=>{let{paddingBlockLG:t,lineHeightLG:n,borderRadiusLG:r,paddingInlineLG:i}=e;return{padding:`${tn(t)} ${tn(i)}`,fontSize:e.inputFontSizeLG,lineHeight:n,borderRadius:r}};const Qae=e=>({padding:`${tn(e.paddingBlockSM)} ${tn(e.paddingInlineSM)}`,fontSize:e.inputFontSizeSM,borderRadius:e.borderRadiusSM}),$ae=(e,t={})=>({position:`relative`,display:`inline-block`,width:`100%`,minWidth:0,padding:`${tn(e.paddingBlock)} ${tn(e.paddingInline)}`,color:e.colorText,fontSize:e.inputFontSize,lineHeight:e.lineHeight,borderRadius:e.borderRadius,transition:`all ${e.motionDurationMid}`,...Xae(e.colorTextPlaceholder),"&-lg":{...Zae(e),...t.largeStyle},"&-sm":{...Qae(e),...t.smallStyle},"&-rtl, &-textarea-rtl":{direction:`rtl`}}),eoe=e=>{let{componentCls:t,antCls:n}=e;return{position:`relative`,display:`table`,width:`100%`,borderCollapse:`separate`,borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:e.paddingXS,"&:last-child":{paddingInlineEnd:0}},[`&-lg ${t}, &-lg > ${t}-group-addon`]:{...Zae(e)},[`&-sm ${t}, &-sm > ${t}-group-addon`]:{...Qae(e)},[`&-lg ${n}-select-single`]:{height:e.controlHeightLG},[`&-sm ${n}-select-single`]:{height:e.controlHeightSM},[`> ${t}`]:{display:`table-cell`,"&:not(:first-child):not(:last-child)":{borderRadius:0}},[`${t}-group`]:{"&-addon, &-wrap":{display:`table-cell`,width:1,whiteSpace:`nowrap`,verticalAlign:`middle`,"&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:`block !important`},"&-addon":{position:`relative`,padding:`0 ${tn(e.paddingInline)}`,color:e.colorText,fontWeight:`normal`,fontSize:e.inputFontSize,textAlign:`center`,borderRadius:e.borderRadius,transition:`all ${e.motionDurationSlow}`,lineHeight:1,[`${n}-select`]:{margin:`${tn(e.calc(e.paddingBlock).add(1).mul(-1).equal())} ${tn(e.calc(e.paddingInline).mul(-1).equal())}`,[`&${n}-select-single:not(${n}-select-customize-input):not(${n}-pagination-size-changer)`]:{backgroundColor:`inherit`,border:`${tn(e.lineWidth)} ${e.lineType} transparent`,boxShadow:`none`}},[`${n}-cascader-picker`]:{margin:`-9px ${tn(e.calc(e.paddingInline).mul(-1).equal())}`,backgroundColor:`transparent`,[`${n}-cascader-input`]:{textAlign:`start`,border:0,boxShadow:`none`}}}},[t]:{width:`100%`,marginBottom:0,textAlign:`inherit`,"&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1}},[`> ${t}:first-child, ${t}-group-addon:first-child`]:{borderStartEndRadius:0,borderEndEndRadius:0,[`${n}-select`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${t}-affix-wrapper`]:{[`&:not(:first-child) ${t}`]:{borderStartStartRadius:0,borderEndStartRadius:0},[`&:not(:last-child) ${t}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${t}:last-child, ${t}-group-addon:last-child`]:{borderStartStartRadius:0,borderEndStartRadius:0,[`${n}-select`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`${t}-affix-wrapper`]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0},"&:not(:first-child)":{borderStartStartRadius:0,borderEndStartRadius:0}},[`&${t}-group-compact`]:{display:`block`,...io(),[`${t}-group-addon, ${t}-group-wrap, > ${t}`]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:e.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:`inline-flex`,float:`none`,verticalAlign:`top`,borderRadius:0},[`
        & > ${t}-affix-wrapper,
        & > ${t}-number-affix-wrapper,
        & > ${n}-picker-range
      `]:{display:`inline-flex`},"& > *:not(:last-child)":{marginInlineEnd:e.calc(e.lineWidth).mul(-1).equal(),borderInlineEndWidth:e.lineWidth},[t]:{float:`none`},[`& > ${n}-select,
      & > ${n}-select-auto-complete ${t},
      & > ${n}-cascader-picker ${t},
      & > ${t}-group-wrapper ${t}`]:{borderInlineEndWidth:e.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},[`& > ${n}-select-focused`]:{zIndex:1},[`& > ${n}-select > ${n}-select-arrow`]:{zIndex:1},[`& > *:first-child,
      & > ${n}-select:first-child,
      & > ${n}-select-auto-complete:first-child ${t},
      & > ${n}-cascader-picker:first-child ${t}`]:{borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius},[`& > *:last-child,
      & > ${n}-select:last-child,
      & > ${n}-cascader-picker:last-child ${t},
      & > ${n}-cascader-picker-focused:last-child ${t}`]:{borderInlineEndWidth:e.lineWidth,borderStartEndRadius:e.borderRadius,borderEndEndRadius:e.borderRadius},[`& > ${n}-select-auto-complete ${t}`]:{verticalAlign:`top`},[`${t}-group-wrapper + ${t}-group-wrapper`]:{marginInlineStart:e.calc(e.lineWidth).mul(-1).equal(),[`${t}-affix-wrapper`]:{}}}}},toe=e=>{let{componentCls:t,controlHeightSM:n,lineWidth:r,calc:i}=e,a=i(n).sub(i(r).mul(2)).sub(16).div(2).equal();return{[t]:{...no(e),...$ae(e),...Rae(e),...Wae(e),...Vae(e),...Yae(e),'&[type="color"]':{height:e.controlHeight,[`&${t}-lg`]:{height:e.controlHeightLG},[`&${t}-sm`]:{height:n,paddingTop:a,paddingBottom:a}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{appearance:`none`}}}};var noe=e=>{let{componentCls:t}=e;return{[`${t}-clear-icon`]:{margin:0,padding:0,lineHeight:0,color:e.colorTextQuaternary,fontSize:e.fontSizeIcon,verticalAlign:-1,cursor:`pointer`,transition:`color ${e.motionDurationSlow}`,border:`none`,outline:`none`,backgroundColor:`transparent`,"&:hover":{color:e.colorIcon},"&:active":{color:e.colorText},"&-hidden":{visibility:`hidden`},"&-has-suffix":{margin:`0 ${tn(e.inputAffixPadding)}`}}}};const roe=e=>{let{componentCls:t,inputAffixPadding:n,colorTextDescription:r,motionDurationSlow:i,colorIcon:a,colorIconHover:o,iconCls:s}=e,c=`${t}-affix-wrapper`,l=`${t}-affix-wrapper-disabled`;return{[c]:{...$ae(e),display:`inline-flex`,"&-focused, &:focus":{zIndex:1},[`> input${t}`]:{padding:0},[`> input${t}, > textarea${t}`]:{fontSize:`inherit`,border:`none`,borderRadius:0,outline:`none`,background:`transparent`,color:`inherit`,"&::-ms-reveal":{display:`none`},"&:focus":{boxShadow:`none !important`}},"&::before":{display:`inline-block`,width:0,visibility:`hidden`,content:`"\\a0"`},[t]:{"&-prefix, &-suffix":{display:`flex`,flex:`none`,alignItems:`center`,"> *:not(:last-child)":{marginInlineEnd:e.paddingXS}},"&-show-count-suffix":{color:r,direction:`ltr`},"&-show-count-has-suffix":{marginInlineEnd:e.paddingXXS},"&-prefix":{marginInlineEnd:n},"&-suffix":{marginInlineStart:n}},...noe(e),[`${s}${t}-password-icon`]:{color:a,cursor:`pointer`,transition:`all ${i}`,"&:hover":{color:o}}},[`${t}-underlined`]:{borderRadius:0},[l]:{[`${s}${t}-password-icon`]:{color:a,cursor:`not-allowed`,"&:hover":{color:a}}}}};var ioe=e=>{let{componentCls:t,borderRadiusLG:n,borderRadiusSM:r}=e;return{[`${t}-group`]:{...no(e),...eoe(e),"&-rtl":{direction:`rtl`},"&-wrapper":{display:`inline-block`,width:`100%`,textAlign:`start`,verticalAlign:`top`,"&-rtl":{direction:`rtl`},"&-lg":{[`${t}-group-addon`]:{borderRadius:n,fontSize:e.inputFontSizeLG}},"&-sm":{[`${t}-group-addon`]:{borderRadius:r}},...Bae(e),...Kae(e),[`&:not(${t}-compact-first-item):not(${t}-compact-last-item)${t}-compact-item`]:{[`${t}, ${t}-group-addon`]:{borderRadius:0}},[`&:not(${t}-compact-last-item)${t}-compact-first-item`]:{[`${t}, ${t}-group-addon`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${t}-compact-first-item)${t}-compact-last-item`]:{[`${t}, ${t}-group-addon`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&:not(${t}-compact-last-item)${t}-compact-item`]:{[`${t}-affix-wrapper`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${t}-compact-first-item)${t}-compact-item`]:{[`${t}-affix-wrapper`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}}},aoe=e=>{let{componentCls:t}=e;return{[`${t}-out-of-range`]:{[`&, & input, & textarea, ${t}-show-count-suffix, ${t}-data-count`]:{color:e.colorError}}}};const ooe=fo([`Input`,`Shared`],e=>{let t=yi(e,N_(e));return[toe(t),roe(t)]},P_,{resetFont:!1});var soe=fo([`Input`,`Component`],e=>{let t=yi(e,N_(e));return[ioe(t),aoe(t),Bf(t)]},P_,{resetFont:!1}),coe={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z`}},{tag:`path`,attrs:{d:`M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z`}}]},name:`plus`,theme:`outlined`};function I_(){return I_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I_.apply(this,arguments)}var loe=y.forwardRef((e,t)=>y.createElement(Bo,I_({},e,{ref:t,icon:coe}))),uoe=l(o(((e,t)=>{t.exports=a,t.exports.isMobile=a,t.exports.default=a;var n=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|redmi|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,r=/CrOS/,i=/android|ipad|playbook|silk/i;function a(e){e||={};let t=e.ua;if(!t&&typeof navigator<`u`&&(t=navigator.userAgent),t&&t.headers&&typeof t.headers[`user-agent`]==`string`&&(t=t.headers[`user-agent`]),typeof t!=`string`)return!1;let a=n.test(t)&&!r.test(t)||!!e.tablet&&i.test(t);return!a&&e.tablet&&e.featureDetect&&navigator&&navigator.maxTouchPoints>1&&t.indexOf(`Macintosh`)!==-1&&t.indexOf(`Safari`)!==-1&&(a=!0),a}}))()),L_,doe=(()=>(L_===void 0&&(L_=(0,uoe.default)()),L_)),R_=(0,y.createContext)(null),foe=e=>{let{activeTabOffset:t,horizontal:n,rtl:r,indicator:i={}}=e,{size:a,align:o=`center`}=i,[s,c]=(0,y.useState)(),l=(0,y.useRef)(),u=y.useCallback(e=>typeof a==`function`?a(e):typeof a==`number`?a:e,[a]);function d(){lt.cancel(l.current)}return(0,y.useEffect)(()=>{let e={};if(t)if(n){e.width=u(t.width);let n=r?`right`:`left`;o===`start`&&(e[n]=t[n]),o===`center`&&(e[n]=t[n]+t.width/2,e.transform=r?`translateX(50%)`:`translateX(-50%)`),o===`end`&&(e[n]=t[n]+t.width,e.transform=`translateX(-100%)`)}else e.height=u(t.height),o===`start`&&(e.top=t.top),o===`center`&&(e.top=t.top+t.height/2,e.transform=`translateY(-50%)`),o===`end`&&(e.top=t.top+t.height,e.transform=`translateY(-100%)`);return d(),l.current=lt(()=>{s&&e&&Object.keys(e).every(t=>{let n=e[t],r=s[t];return typeof n==`number`&&typeof r==`number`?Math.round(n)===Math.round(r):n===r})||c(e)}),d},[JSON.stringify(t),n,r,o,u]),{style:s}},poe={width:0,height:0,left:0,top:0};function moe(e,t,n){return(0,y.useMemo)(()=>{let n=new Map,r=t.get(e[0]?.key)||poe,i=r.left+r.width;for(let r=0;r<e.length;r+=1){let{key:a}=e[r],o=t.get(a);o||=t.get(e[r-1]?.key)||poe;let s=n.get(a)||{...o};s.right=i-s.left-s.width,n.set(a,s)}return n},[e.map(e=>e.key).join(`_`),t,n])}function hoe(e,t){let n=y.useRef(e),[,r]=y.useState({});function i(e){let i=typeof e==`function`?e(n.current):e;i!==n.current&&t(i,n.current),n.current=i,r({})}return[n.current,i]}var goe=.1,_oe=.01,z_=20,voe=.995**z_;function yoe(e,t){let[n,r]=(0,y.useState)(),[i,a]=(0,y.useState)(0),[o,s]=(0,y.useState)(0),[c,l]=(0,y.useState)(),u=(0,y.useRef)();function d(e){let{screenX:t,screenY:n}=e.touches[0];r({x:t,y:n}),window.clearInterval(u.current)}function f(e){if(!n)return;let{screenX:o,screenY:c}=e.touches[0];r({x:o,y:c});let u=o-n.x,d=c-n.y;t(u,d);let f=Date.now();a(f),s(f-i),l({x:u,y:d})}function p(){if(n&&(r(null),l(null),c)){let e=c.x/o,n=c.y/o,r=Math.abs(e),i=Math.abs(n);if(Math.max(r,i)<goe)return;let a=e,s=n;u.current=window.setInterval(()=>{if(Math.abs(a)<_oe&&Math.abs(s)<_oe){window.clearInterval(u.current);return}a*=voe,s*=voe,t(a*z_,s*z_)},z_)}}let m=(0,y.useRef)();function h(e){let{deltaX:n,deltaY:r}=e,i=0,a=Math.abs(n),o=Math.abs(r);a===o?i=m.current===`x`?n:r:a>o?(i=n,m.current=`x`):(i=r,m.current=`y`),t(-i,-i)&&e.preventDefault()}let g=(0,y.useRef)(null);g.current={onTouchStart:d,onTouchMove:f,onTouchEnd:p,onWheel:h},y.useEffect(()=>{function t(e){g.current.onTouchStart(e)}function n(e){g.current.onTouchMove(e)}function r(e){g.current.onTouchEnd(e)}function i(e){g.current.onWheel(e)}return document.addEventListener(`touchmove`,n,{passive:!1}),document.addEventListener(`touchend`,r,{passive:!0}),e.current.addEventListener(`touchstart`,t,{passive:!0}),e.current.addEventListener(`wheel`,i,{passive:!1}),()=>{document.removeEventListener(`touchmove`,n),document.removeEventListener(`touchend`,r)}},[])}function boe(e){let[t,n]=(0,y.useState)(0),r=(0,y.useRef)(0),i=(0,y.useRef)();return i.current=e,T(()=>{i.current?.()},[t]),()=>{r.current===t&&(r.current+=1,n(r.current))}}function xoe(e){let t=(0,y.useRef)([]),[,n]=(0,y.useState)({}),r=(0,y.useRef)(typeof e==`function`?e():e),i=boe(()=>{let e=r.current;t.current.forEach(t=>{e=t(e)}),t.current=[],r.current=e,n({})});function a(e){t.current.push(e),i()}return[r.current,a]}var Soe={width:0,height:0,left:0,top:0,right:0};function Coe(e,t,n,r,i,a,{tabs:o,tabPosition:s,rtl:c}){let l,u,d;return[`top`,`bottom`].includes(s)?(l=`width`,u=c?`right`:`left`,d=Math.abs(n)):(l=`height`,u=`top`,d=-n),(0,y.useMemo)(()=>{if(!o.length)return[0,0];let n=o.length,r=n;for(let i=0;i<n;i+=1){let n=e.get(o[i].key)||Soe;if(Math.floor(n[u]+n[l])>Math.floor(d+t)){r=i-1;break}}let i=0;for(let t=n-1;t>=0;--t)if((e.get(o[t].key)||Soe)[u]<d){i=t+1;break}return i>r?[0,-1]:[i,r]},[e,t,r,i,a,d,s,o.map(e=>e.key).join(`_`),c])}function woe(e){let t;return e instanceof Map?(t={},e.forEach((e,n)=>{t[n]=e})):t=e,JSON.stringify(t)}var Toe=`TABS_DQ`;function Eoe(e){return String(e).replace(/"/g,Toe)}function B_(e,t,n,r){return!(!n||r||e===!1||e===void 0&&(t===!1||t===null))}var Doe=y.forwardRef((e,t)=>{let{prefixCls:n,editable:r,locale:i,style:a}=e;return!r||r.showAdd===!1?null:y.createElement(`button`,{ref:t,type:`button`,className:`${n}-nav-add`,style:a,"aria-label":i?.addAriaLabel||`Add tab`,onClick:e=>{r.onEdit(`add`,{event:e})}},r.addIcon||`+`)}),Ooe=y.forwardRef((e,t)=>{let{position:n,prefixCls:r,extra:i}=e;if(!i)return null;let a,o={};return typeof i==`object`&&!y.isValidElement(i)?o=i:o.right=i,n===`right`&&(a=o.right),n===`left`&&(a=o.left),a?y.createElement(`div`,{className:`${r}-extra-content`,ref:t},a):null});function V_(){return V_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V_.apply(this,arguments)}var koe=y.forwardRef((e,t)=>{let{prefixCls:n,id:r,tabs:i,locale:a,mobile:o,more:s={},style:c,className:l,editable:u,tabBarGutter:d,rtl:f,removeAriaLabel:p,onTabClick:m,getPopupContainer:h,popupClassName:g,popupStyle:_}=e,[v,b]=(0,y.useState)(!1),[x,S]=(0,y.useState)(null),{icon:C=`More`}=s,w=`${r}-more-popup`,T=`${n}-dropdown`,E=x===null?null:`${w}-${x}`,D=a?.dropdownAriaLabel;function O(e,t){e.preventDefault(),e.stopPropagation(),u.onEdit(`remove`,{key:t,event:e})}let k=y.createElement(rae,{onClick:({key:e,domEvent:t})=>{m(e,t),b(!1)},prefixCls:`${T}-menu`,id:w,tabIndex:-1,role:`listbox`,"aria-activedescendant":E,selectedKeys:[x],"aria-label":D===void 0?`expanded dropdown`:D},i.map(e=>{let{closable:t,disabled:n,closeIcon:i,key:a,label:o}=e,s=B_(t,i,u,n);return y.createElement(p_,{key:a,id:`${w}-${a}`,role:`option`,"aria-controls":r&&`${r}-panel-${a}`,disabled:n},y.createElement(`span`,null,o),s&&y.createElement(`button`,{type:`button`,"aria-label":p||`remove`,tabIndex:0,className:`${T}-menu-item-remove`,onClick:e=>{e.stopPropagation(),O(e,a)}},i||u.removeIcon||``))}));function A(e){let t=i.filter(e=>!e.disabled),n=t.findIndex(e=>e.key===x)||0,r=t.length;for(let i=0;i<r;i+=1){n=(n+e+r)%r;let i=t[n];if(!i.disabled){S(i.key);return}}}function j(e){let{which:t}=e;if(!v){[mu.DOWN,mu.SPACE,mu.ENTER].includes(t)&&(b(!0),e.preventDefault());return}switch(t){case mu.UP:A(-1),e.preventDefault();break;case mu.DOWN:A(1),e.preventDefault();break;case mu.ESC:b(!1);break;case mu.SPACE:case mu.ENTER:x!==null&&m(x,e);break}}(0,y.useEffect)(()=>{let e=document.getElementById(E);e?.scrollIntoView&&e.scrollIntoView(!1)},[E,x]),(0,y.useEffect)(()=>{v||S(null)},[v]);let M={marginInlineStart:d};i.length||(M.visibility=`hidden`,M.order=1);let N=F(g,{[`${T}-rtl`]:f}),ee=o?null:y.createElement(kie,V_({prefixCls:T,overlay:k,visible:i.length?v:!1,onVisibleChange:b,overlayClassName:N,overlayStyle:_,mouseEnterDelay:.1,mouseLeaveDelay:.1,getPopupContainer:h},s),y.createElement(`button`,{type:`button`,className:`${n}-nav-more`,style:M,"aria-haspopup":`listbox`,"aria-controls":w,id:`${r}-more`,"aria-expanded":v,onKeyDown:j},C));return y.createElement(`div`,{className:F(`${n}-nav-operations`,l),style:c,ref:t},ee,y.createElement(Doe,{prefixCls:n,locale:a,editable:u}))}),Aoe=y.memo(koe,(e,t)=>t.tabMoving),joe=e=>{let{prefixCls:t,id:n,active:r,focus:i,tab:{key:a,label:o,disabled:s,closeIcon:c,icon:l},closable:u,renderWrapper:d,removeAriaLabel:f,editable:p,onClick:m,onFocus:h,onBlur:g,onKeyDown:_,onMouseDown:v,onMouseUp:b,style:x,className:S,tabCount:C,currentPosition:w}=e,T=`${t}-tab`,E=B_(u,c,p,s);function D(e){s||m(e)}function O(e){e.preventDefault(),e.stopPropagation(),p.onEdit(`remove`,{key:a,event:e})}let k=y.useMemo(()=>l&&typeof o==`string`?y.createElement(`span`,null,o):o,[o,l]),A=y.useRef(null);y.useEffect(()=>{i&&A.current&&A.current.focus()},[i]);let j=y.createElement(`div`,{key:a,"data-node-key":Eoe(a),className:F(T,S,{[`${T}-with-remove`]:E,[`${T}-active`]:r,[`${T}-disabled`]:s,[`${T}-focus`]:i}),style:x,onClick:D},y.createElement(`div`,{ref:A,role:`tab`,"aria-selected":r,id:n&&`${n}-tab-${a}`,className:`${T}-btn`,"aria-controls":n&&`${n}-panel-${a}`,"aria-disabled":s,tabIndex:s?null:r?0:-1,onClick:e=>{e.stopPropagation(),D(e)},onKeyDown:_,onMouseDown:v,onMouseUp:b,onFocus:h,onBlur:g},i&&y.createElement(`div`,{"aria-live":`polite`,style:{width:0,height:0,position:`absolute`,overflow:`hidden`,opacity:0}},`Tab ${w} of ${C}`),l&&y.createElement(`span`,{className:`${T}-icon`},l),o&&k),E&&y.createElement(`button`,{type:`button`,"aria-label":f||`remove`,tabIndex:r?0:-1,className:`${T}-remove`,onClick:e=>{e.stopPropagation(),O(e)}},c||p.removeIcon||``));return d?d(j):j};function H_(){return H_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},H_.apply(this,arguments)}var Moe=(e,t)=>{let{offsetWidth:n,offsetHeight:r,offsetTop:i,offsetLeft:a}=e,{width:o,height:s,left:c,top:l}=e.getBoundingClientRect();return Math.abs(o-n)<1?[o,s,c-t.left,l-t.top]:[n,r,a,i]},U_=e=>{let{offsetWidth:t=0,offsetHeight:n=0}=e.current||{};if(e.current){let{width:n,height:r}=e.current.getBoundingClientRect();if(Math.abs(n-t)<1)return[n,r]}return[t,n]},W_=(e,t)=>e[t?0:1],Noe=y.forwardRef((e,t)=>{let{className:n,style:r,id:i,animated:a,activeKey:o,rtl:s,extra:c,editable:l,locale:u,tabPosition:d,tabBarGutter:f,children:p,onTabClick:m,onTabScroll:h,indicator:g,classNames:_,styles:v}=e,{prefixCls:b,tabs:S}=y.useContext(R_),C=(0,y.useRef)(null),w=(0,y.useRef)(null),T=(0,y.useRef)(null),E=(0,y.useRef)(null),D=(0,y.useRef)(null),O=(0,y.useRef)(null),k=(0,y.useRef)(null),A=d===`top`||d===`bottom`,[j,M]=hoe(0,(e,t)=>{A&&h&&h({direction:e>t?`left`:`right`})}),[N,ee]=hoe(0,(e,t)=>{!A&&h&&h({direction:e>t?`top`:`bottom`})}),[te,P]=(0,y.useState)([0,0]),[ne,re]=(0,y.useState)([0,0]),[ie,oe]=(0,y.useState)([0,0]),[se,ce]=(0,y.useState)([0,0]),[le,ue]=xoe(new Map),de=moe(S,le,ne[0]),fe=W_(te,A),pe=W_(ne,A),me=W_(ie,A),he=W_(se,A),ge=Math.floor(fe)<Math.floor(pe+me),_e=ge?fe-he:fe-me,ve=`${b}-nav-operations-hidden`,ye=0,be=0;A&&s?(ye=0,be=Math.max(0,pe-_e)):(ye=Math.min(0,_e-pe),be=0);function xe(e){return e<ye?ye:e>be?be:e}let Se=(0,y.useRef)(null),[Ce,we]=(0,y.useState)();function Te(){we(Date.now())}function Ee(){Se.current&&clearTimeout(Se.current)}yoe(E,(e,t)=>{function n(e,t){e(e=>xe(e+t))}return ge?(A?n(M,e):n(ee,t),Ee(),Te(),!0):!1}),(0,y.useEffect)(()=>(Ee(),Ce&&(Se.current=setTimeout(()=>{we(0)},100)),Ee),[Ce]);let[De,Oe]=Coe(de,_e,A?j:N,pe,me,he,{...e,tabs:S}),ke=x((e=o)=>{let t=de.get(e)||{width:0,height:0,left:0,right:0,top:0};if(A){let e=j;s?t.right<j?e=t.right:t.right+t.width>j+_e&&(e=t.right+t.width-_e):t.left<-j?e=-t.left:t.left+t.width>-j+_e&&(e=-(t.left+t.width-_e)),ee(0),M(xe(e))}else{let e=N;t.top<-N?e=-t.top:t.top+t.height>-N+_e&&(e=-(t.top+t.height-_e)),M(0),ee(xe(e))}}),[Ae,je]=(0,y.useState)(),[Me,Ne]=(0,y.useState)(!1),Pe=S.filter(e=>!e.disabled).map(e=>e.key),Fe=e=>{let t=Pe.indexOf(Ae||o),n=Pe.length,r=Pe[(t+e+n)%n];je(r)},Ie=(e,t)=>{let n=Pe.indexOf(e),r=S.find(t=>t.key===e);B_(r?.closable,r?.closeIcon,l,r?.disabled)&&(t.preventDefault(),t.stopPropagation(),l.onEdit(`remove`,{key:e,event:t}),n===Pe.length-1?Fe(-1):Fe(1))},Le=(e,t)=>{Ne(!0),t.button===1&&Ie(e,t)},Re=e=>{let{code:t}=e,n=s&&A,r=Pe[0],i=Pe[Pe.length-1];switch(t){case`ArrowLeft`:A&&Fe(n?1:-1);break;case`ArrowRight`:A&&Fe(n?-1:1);break;case`ArrowUp`:e.preventDefault(),A||Fe(-1);break;case`ArrowDown`:e.preventDefault(),A||Fe(1);break;case`Home`:e.preventDefault(),je(r);break;case`End`:e.preventDefault(),je(i);break;case`Enter`:case`Space`:e.preventDefault(),m(Ae??o,e);break;case`Backspace`:case`Delete`:Ie(Ae,e);break}},ze={};A?ze.marginInlineStart=f:ze.marginTop=f;let Be=S.map((e,t)=>{let{key:n}=e;return y.createElement(joe,{id:i,prefixCls:b,key:n,tab:e,className:_?.item,style:t===0?v?.item:{...ze,...v?.item},closable:e.closable,editable:l,active:n===o,focus:n===Ae,renderWrapper:p,removeAriaLabel:u?.removeAriaLabel,tabCount:Pe.length,currentPosition:t+1,onClick:e=>{m(n,e)},onKeyDown:Re,onFocus:()=>{Me||je(n),ke(n),Te(),E.current&&(s||(E.current.scrollLeft=0),E.current.scrollTop=0)},onBlur:()=>{je(void 0)},onMouseDown:e=>Le(n,e),onMouseUp:()=>{Ne(!1)}})}),Ve=()=>ue(()=>{let e=new Map,t=D.current?.getBoundingClientRect();return S.forEach(({key:n})=>{let r=D.current?.querySelector(`[data-node-key="${Eoe(n)}"]`);if(r){let[i,a,o,s]=Moe(r,t);e.set(n,{width:i,height:a,left:o,top:s})}}),e});(0,y.useEffect)(()=>{Ve()},[S.map(e=>e.key).join(`_`)]);let He=boe(()=>{let e=U_(C),t=U_(w),n=U_(T);P([e[0]-t[0]-n[0],e[1]-t[1]-n[1]]);let r=U_(k);oe(r),ce(U_(O));let i=U_(D);re([i[0]-r[0],i[1]-r[1]]),Ve()}),Ue=S.slice(0,De),We=S.slice(Oe+1),Ge=[...Ue,...We],Ke=de.get(o),{style:qe}=foe({activeTabOffset:Ke,horizontal:A,indicator:g,rtl:s});(0,y.useEffect)(()=>{ke()},[o,ye,be,woe(Ke),woe(de),A]),(0,y.useEffect)(()=>{He()},[s]);let Je=!!Ge.length,Xe=`${b}-nav-wrap`,Ze,Qe,$e,et;return A?s?(Qe=j>0,Ze=j!==be):(Ze=j<0,Qe=j!==ye):($e=N<0,et=N!==ye),y.createElement(Ye,{onResize:He},y.createElement(`div`,{ref:ae(t,C),role:`tablist`,"aria-orientation":A?`horizontal`:`vertical`,className:F(`${b}-nav`,n,_?.header),style:{...v?.header,...r},onKeyDown:()=>{Te()}},y.createElement(Ooe,{ref:w,position:`left`,extra:c,prefixCls:b}),y.createElement(Ye,{onResize:He},y.createElement(`div`,{className:F(Xe,{[`${Xe}-ping-left`]:Ze,[`${Xe}-ping-right`]:Qe,[`${Xe}-ping-top`]:$e,[`${Xe}-ping-bottom`]:et}),ref:E},y.createElement(Ye,{onResize:He},y.createElement(`div`,{ref:D,className:`${b}-nav-list`,style:{transform:`translate(${j}px, ${N}px)`,transition:Ce?`none`:void 0}},Be,y.createElement(Doe,{ref:k,prefixCls:b,locale:u,editable:l,style:{...Be.length===0?void 0:ze,visibility:Je?`hidden`:null}}),y.createElement(`div`,{className:F(`${b}-ink-bar`,_?.indicator,{[`${b}-ink-bar-animated`]:a.inkBar}),style:{...qe,...v?.indicator}}))))),y.createElement(Aoe,H_({},e,{removeAriaLabel:u?.removeAriaLabel,ref:O,prefixCls:b,tabs:Ge,className:!Je&&ve,popupStyle:v?.popup,tabMoving:!!Ce})),y.createElement(Ooe,{ref:T,position:`right`,extra:c,prefixCls:b})))}),Poe=({renderTabBar:e,...t})=>e?e(t,Noe):y.createElement(Noe,t),Foe=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,style:i,id:a,active:o,tabKey:s,children:c}=e,l=y.Children.count(c)>0;return y.createElement(`div`,{id:a&&`${a}-panel-${s}`,role:`tabpanel`,tabIndex:o&&l?0:-1,"aria-labelledby":a&&`${a}-tab-${s}`,"aria-hidden":!o,style:i,className:F(n,o&&`${n}-active`,r),ref:t},c)});function G_(){return G_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},G_.apply(this,arguments)}var Ioe=e=>{let{id:t,activeKey:n,animated:r,tabPosition:i,destroyOnHidden:a,contentStyle:o,contentClassName:s}=e,{prefixCls:c,tabs:l}=y.useContext(R_),u=r.tabPane,d=`${c}-tabpane`;return y.createElement(`div`,{className:F(`${c}-content-holder`)},y.createElement(`div`,{className:F(`${c}-content`,`${c}-content-${i}`,{[`${c}-content-animated`]:u})},l.map(e=>{let{key:i,forceRender:c,style:l,className:f,destroyOnHidden:p,...m}=e,h=i===n;return y.createElement(Bs,G_({key:i,visible:h,forceRender:c,removeOnLeave:!!(a??p),leavedClassName:`${d}-hidden`},r.tabPaneMotion),({style:e,className:n},r)=>y.createElement(Foe,G_({},m,{prefixCls:d,id:t,tabKey:i,animated:u,active:h,style:{...o,...l,...e},className:F(s,f,n),ref:r})))})))};function Loe(e={inkBar:!0,tabPane:!1}){let t;return t=e===!1?{inkBar:!1,tabPane:!1}:e===!0?{inkBar:!0,tabPane:!1}:{inkBar:!0,...typeof e==`object`?e:{}},t.tabPaneMotion&&t.tabPane===void 0&&(t.tabPane=!0),!t.tabPaneMotion&&t.tabPane&&(t.tabPane=!1),t}function K_(){return K_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},K_.apply(this,arguments)}var Roe=0,zoe=y.forwardRef((e,t)=>{let{id:n,prefixCls:r=`rc-tabs`,className:i,items:a,direction:o,activeKey:s,defaultActiveKey:c,editable:l,animated:u,tabPosition:d=`top`,tabBarGutter:f,tabBarStyle:p,tabBarExtraContent:m,locale:h,more:g,destroyOnHidden:_,renderTabBar:v,onChange:b,onTabClick:x,onTabScroll:S,getPopupContainer:C,popupClassName:w,indicator:T,classNames:E,styles:D,...k}=e,A=y.useMemo(()=>(a||[]).filter(e=>e&&typeof e==`object`&&`key`in e),[a]),j=o===`rtl`,M=Loe(u),[N,ee]=(0,y.useState)(!1);(0,y.useEffect)(()=>{ee(doe())},[]);let[te,P]=O(c??A[0]?.key,s),[ne,re]=(0,y.useState)(()=>A.findIndex(e=>e.key===te));(0,y.useEffect)(()=>{let e=A.findIndex(e=>e.key===te);e===-1&&(e=Math.max(0,Math.min(ne,A.length-1)),P(A[e]?.key)),re(e)},[A.map(e=>e.key).join(`_`),te,ne]);let[ie,ae]=O(null,n);(0,y.useEffect)(()=>{n||(ae(`rc-tabs-${Roe}`),Roe+=1)},[]);function oe(e,t){x?.(e,t);let n=e!==te;P(e),n&&b?.(e)}let se={id:ie,activeKey:te,animated:M,tabPosition:d,rtl:j,mobile:N},ce={...se,editable:l,locale:h,more:g,tabBarGutter:f,onTabClick:oe,onTabScroll:S,extra:m,style:p,getPopupContainer:C,popupClassName:F(w,E?.popup),indicator:T,styles:D,classNames:E},le=y.useMemo(()=>({tabs:A,prefixCls:r}),[A,r]);return y.createElement(R_.Provider,{value:le},y.createElement(`div`,K_({ref:t,id:n,className:F(r,`${r}-${d}`,{[`${r}-mobile`]:N,[`${r}-editable`]:l,[`${r}-rtl`]:j},i)},k),y.createElement(Poe,K_({},ce,{renderTabBar:v})),y.createElement(Ioe,K_({destroyOnHidden:_},se,{contentStyle:D?.content,contentClassName:E?.content,animated:M}))))}),Boe={motionAppear:!1,motionEnter:!0,motionLeave:!0};function Voe(e,t={inkBar:!0,tabPane:!1}){let n;return n=t===!1?{inkBar:!1,tabPane:!1}:t===!0?{inkBar:!0,tabPane:!0}:{inkBar:!0,...typeof t==`object`?t:{}},n.tabPane&&(n.tabPaneMotion={...Boe,motionName:$u(e,`switch`)}),n}function Hoe(e){return e.filter(e=>e)}function Uoe(e,t){return e?e.map(e=>({...e,destroyOnHidden:e.destroyOnHidden??e.destroyInactiveTabPane})):Hoe(Oe(t).map(e=>{if(y.isValidElement(e)){let{key:t,props:n}=e,{tab:r,...i}=n||{};return{key:String(t),...i,label:r}}return null}))}var Woe=Uoe,Goe=e=>{let{componentCls:t,motionDurationSlow:n}=e;return[{[t]:{[`${t}-switch`]:{"&-appear, &-enter":{transition:`none`,"&-start":{opacity:0},"&-active":{opacity:1,transition:`opacity ${n}`}},"&-leave":{position:`absolute`,transition:`none`,inset:0,"&-start":{opacity:1},"&-active":{opacity:0,transition:`opacity ${n}`}}}}},[mf(e,`slide-up`),mf(e,`slide-down`)]]},Koe=e=>{let{componentCls:t,tabsCardPadding:n,cardBg:r,cardGutter:i,colorBorderSecondary:a,itemSelectedColor:o}=e;return{[`${t}-card`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab`]:{margin:0,padding:n,background:r,border:`${tn(e.lineWidth)} ${e.lineType} ${a}`,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOut}`},[`${t}-tab-active`]:{color:o,background:e.colorBgContainer},[`${t}-tab-focus:has(${t}-tab-btn:focus-visible)`]:so(e,-3),[`& ${t}-tab${t}-tab-focus ${t}-tab-btn:focus-visible`]:{outline:`none`},[`${t}-ink-bar`]:{visibility:`hidden`}},[`&${t}-top, &${t}-bottom`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab + ${t}-tab`]:{marginLeft:{_skip_check_:!0,value:tn(i)}}}},[`&${t}-top`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab`]:{borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0`},[`${t}-tab-active`]:{borderBottomColor:e.colorBgContainer}}},[`&${t}-bottom`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab`]:{borderRadius:`0 0 ${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)}`},[`${t}-tab-active`]:{borderTopColor:e.colorBgContainer}}},[`&${t}-left, &${t}-right`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab + ${t}-tab`]:{marginTop:tn(i)}}},[`&${t}-left`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab`]:{borderRadius:{_skip_check_:!0,value:`${tn(e.borderRadiusLG)} 0 0 ${tn(e.borderRadiusLG)}`}},[`${t}-tab-active`]:{borderRightColor:{_skip_check_:!0,value:e.colorBgContainer}}}},[`&${t}-right`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0`}},[`${t}-tab-active`]:{borderLeftColor:{_skip_check_:!0,value:e.colorBgContainer}}}}}}},qoe=e=>{let{componentCls:t,itemHoverColor:n,dropdownEdgeChildVerticalPadding:r}=e;return{[`${t}-dropdown`]:{...no(e),position:`absolute`,top:-9999,left:{_skip_check_:!0,value:-9999},zIndex:e.zIndexPopup,display:`block`,"&-hidden":{display:`none`},[`${t}-dropdown-menu`]:{maxHeight:e.tabsDropdownHeight,margin:0,padding:`${tn(r)} 0`,overflowX:`hidden`,overflowY:`auto`,textAlign:{_skip_check_:!0,value:`left`},listStyleType:`none`,backgroundColor:e.colorBgContainer,backgroundClip:`padding-box`,borderRadius:e.borderRadiusLG,outline:`none`,boxShadow:e.boxShadowSecondary,"&-item":{...to,display:`flex`,alignItems:`center`,minWidth:e.tabsDropdownWidth,margin:0,padding:`${tn(e.paddingXXS)} ${tn(e.paddingSM)}`,color:e.colorText,fontWeight:`normal`,fontSize:e.fontSize,lineHeight:e.lineHeight,cursor:`pointer`,transition:`all ${e.motionDurationSlow}`,"> span":{flex:1,whiteSpace:`nowrap`},"&-remove":{flex:`none`,marginLeft:{_skip_check_:!0,value:e.marginSM},color:e.colorIcon,fontSize:e.fontSizeSM,background:`transparent`,border:0,cursor:`pointer`,"&:hover":{color:n}},"&:hover":{background:e.controlItemBgHover},"&-disabled":{"&, &:hover":{color:e.colorTextDisabled,background:`transparent`,cursor:`not-allowed`}}}}}}},Joe=e=>{let{componentCls:t,margin:n,colorBorderSecondary:r,horizontalMargin:i,verticalItemPadding:a,verticalItemMargin:o,calc:s}=e;return{[`${t}-top, ${t}-bottom`]:{flexDirection:`column`,[`> ${t}-nav, > div > ${t}-nav`]:{margin:i,"&::before":{position:`absolute`,right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},borderBottom:`${tn(e.lineWidth)} ${e.lineType} ${r}`,content:`''`},[`${t}-ink-bar`]:{height:e.lineWidthBold,"&-animated":{transition:`width ${e.motionDurationSlow}, left ${e.motionDurationSlow},
            right ${e.motionDurationSlow}`}},[`${t}-nav-wrap`]:{"&::before, &::after":{top:0,bottom:0,width:e.controlHeight},"&::before":{left:{_skip_check_:!0,value:0},boxShadow:e.boxShadowTabsOverflowLeft},"&::after":{right:{_skip_check_:!0,value:0},boxShadow:e.boxShadowTabsOverflowRight},[`&${t}-nav-wrap-ping-left::before`]:{opacity:1},[`&${t}-nav-wrap-ping-right::after`]:{opacity:1}}}},[`${t}-top`]:{[`> ${t}-nav,
        > div > ${t}-nav`]:{"&::before":{bottom:0},[`${t}-ink-bar`]:{bottom:0}}},[`${t}-bottom`]:{[`> ${t}-nav, > div > ${t}-nav`]:{order:1,marginTop:n,marginBottom:0,"&::before":{top:0},[`${t}-ink-bar`]:{top:0}},[`> ${t}-content-holder, > div > ${t}-content-holder`]:{order:0}},[`${t}-left, ${t}-right`]:{[`> ${t}-nav, > div > ${t}-nav`]:{flexDirection:`column`,minWidth:s(e.controlHeight).mul(1.25).equal(),[`${t}-tab`]:{padding:a,textAlign:`center`},[`${t}-tab + ${t}-tab`]:{margin:o},[`${t}-nav-wrap`]:{flexDirection:`column`,"&::before, &::after":{right:{_skip_check_:!0,value:0},left:{_skip_check_:!0,value:0},height:e.controlHeight},"&::before":{top:0,boxShadow:e.boxShadowTabsOverflowTop},"&::after":{bottom:0,boxShadow:e.boxShadowTabsOverflowBottom},[`&${t}-nav-wrap-ping-top::before`]:{opacity:1},[`&${t}-nav-wrap-ping-bottom::after`]:{opacity:1}},[`${t}-ink-bar`]:{width:e.lineWidthBold,"&-animated":{transition:`height ${e.motionDurationSlow}, top ${e.motionDurationSlow}`}},[`${t}-nav-list, ${t}-nav-operations`]:{flex:`1 0 auto`,flexDirection:`column`}}},[`${t}-left`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-ink-bar`]:{right:{_skip_check_:!0,value:0}}},[`> ${t}-content-holder, > div > ${t}-content-holder`]:{marginLeft:{_skip_check_:!0,value:tn(s(e.lineWidth).mul(-1).equal())},borderLeft:{_skip_check_:!0,value:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},[`> ${t}-content > ${t}-tabpane`]:{paddingLeft:{_skip_check_:!0,value:e.paddingLG}}}},[`${t}-right`]:{[`> ${t}-nav, > div > ${t}-nav`]:{order:1,[`${t}-ink-bar`]:{left:{_skip_check_:!0,value:0}}},[`> ${t}-content-holder, > div > ${t}-content-holder`]:{order:0,marginRight:{_skip_check_:!0,value:s(e.lineWidth).mul(-1).equal()},borderRight:{_skip_check_:!0,value:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`},[`> ${t}-content > ${t}-tabpane`]:{paddingRight:{_skip_check_:!0,value:e.paddingLG}}}}}},Yoe=e=>{let{componentCls:t,cardPaddingSM:n,cardPaddingLG:r,cardHeightSM:i,cardHeightLG:a,horizontalItemPaddingSM:o,horizontalItemPaddingLG:s}=e;return{[t]:{"&-small":{[`> ${t}-nav`]:{[`${t}-tab`]:{padding:o,fontSize:e.titleFontSizeSM}}},"&-large":{[`> ${t}-nav`]:{[`${t}-tab`]:{padding:s,fontSize:e.titleFontSizeLG,lineHeight:e.lineHeightLG}}}},[`${t}-card`]:{[`&${t}-small`]:{[`> ${t}-nav`]:{[`${t}-tab`]:{padding:n},[`${t}-nav-add`]:{minWidth:i,minHeight:i}},[`&${t}-bottom`]:{[`> ${t}-nav ${t}-tab`]:{borderRadius:`0 0 ${tn(e.borderRadius)} ${tn(e.borderRadius)}`}},[`&${t}-top`]:{[`> ${t}-nav ${t}-tab`]:{borderRadius:`${tn(e.borderRadius)} ${tn(e.borderRadius)} 0 0`}},[`&${t}-right`]:{[`> ${t}-nav ${t}-tab`]:{borderRadius:{_skip_check_:!0,value:`0 ${tn(e.borderRadius)} ${tn(e.borderRadius)} 0`}}},[`&${t}-left`]:{[`> ${t}-nav ${t}-tab`]:{borderRadius:{_skip_check_:!0,value:`${tn(e.borderRadius)} 0 0 ${tn(e.borderRadius)}`}}}},[`&${t}-large`]:{[`> ${t}-nav`]:{[`${t}-tab`]:{padding:r},[`${t}-nav-add`]:{minWidth:a,minHeight:a}}}}}},Xoe=e=>{let{componentCls:t,itemActiveColor:n,itemHoverColor:r,iconCls:i,tabsHorizontalItemMargin:a,horizontalItemPadding:o,itemSelectedColor:s,itemColor:c}=e,l=`${t}-tab`;return{[l]:{position:`relative`,WebkitTouchCallout:`none`,WebkitTapHighlightColor:`transparent`,display:`inline-flex`,alignItems:`center`,padding:o,fontSize:e.titleFontSize,background:`transparent`,border:0,outline:`none`,cursor:`pointer`,color:c,"&-btn, &-remove":{"&:focus:not(:focus-visible), &:active":{color:n}},"&-btn":{outline:`none`,transition:`all ${e.motionDurationSlow}`,[`${l}-icon:not(:last-child)`]:{marginInlineEnd:e.marginSM}},"&-remove":{flex:`none`,lineHeight:1,marginRight:{_skip_check_:!0,value:e.calc(e.marginXXS).mul(-1).equal()},marginLeft:{_skip_check_:!0,value:e.marginXS},color:e.colorIcon,fontSize:e.fontSizeSM,background:`transparent`,border:`none`,outline:`none`,cursor:`pointer`,transition:`all ${e.motionDurationSlow}`,"&:hover":{color:e.colorTextHeading},...co(e)},"&:hover":{color:r},[`&${l}-active ${l}-btn`]:{color:s},[`&${l}-focus ${l}-btn:focus-visible`]:so(e),[`&${l}-disabled`]:{color:e.colorTextDisabled,cursor:`not-allowed`},[`&${l}-disabled ${l}-btn, &${l}-disabled ${t}-remove`]:{"&:focus, &:active":{color:e.colorTextDisabled}},[`& ${l}-remove ${i}`]:{margin:0,verticalAlign:`middle`},[`${i}:not(:last-child)`]:{marginRight:{_skip_check_:!0,value:e.marginSM}}},[`${l} + ${l}`]:{margin:{_skip_check_:!0,value:a}}}},Zoe=e=>{let{componentCls:t,tabsHorizontalItemMarginRTL:n,iconCls:r,cardGutter:i,calc:a}=e;return{[`${t}-rtl`]:{direction:`rtl`,[`${t}-nav`]:{[`${t}-tab`]:{margin:{_skip_check_:!0,value:n},[`${t}-tab:last-of-type`]:{marginLeft:{_skip_check_:!0,value:0}},[r]:{marginRight:{_skip_check_:!0,value:0},marginLeft:{_skip_check_:!0,value:tn(e.marginSM)}},[`${t}-tab-remove`]:{marginRight:{_skip_check_:!0,value:tn(e.marginXS)},marginLeft:{_skip_check_:!0,value:tn(a(e.marginXXS).mul(-1).equal())},[r]:{margin:0}}}},[`&${t}-left`]:{[`> ${t}-nav`]:{order:1},[`> ${t}-content-holder`]:{order:0}},[`&${t}-right`]:{[`> ${t}-nav`]:{order:0},[`> ${t}-content-holder`]:{order:1}},[`&${t}-card${t}-top, &${t}-card${t}-bottom`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-tab + ${t}-tab`]:{marginRight:{_skip_check_:!0,value:i},marginLeft:{_skip_check_:!0,value:0}}}}},[`${t}-dropdown-rtl`]:{direction:`rtl`},[`${t}-menu-item`]:{[`${t}-dropdown-rtl`]:{textAlign:{_skip_check_:!0,value:`right`}}}}},Qoe=e=>{let{componentCls:t,tabsCardPadding:n,cardHeight:r,cardGutter:i,itemHoverColor:a,itemActiveColor:o,colorBorderSecondary:s}=e;return{[t]:{...no(e),display:`flex`,[`> ${t}-nav, > div > ${t}-nav`]:{position:`relative`,display:`flex`,flex:`none`,alignItems:`center`,[`${t}-nav-wrap`]:{position:`relative`,display:`flex`,flex:`auto`,alignSelf:`stretch`,overflow:`hidden`,whiteSpace:`nowrap`,transform:`translate(0)`,"&::before, &::after":{position:`absolute`,zIndex:1,opacity:0,transition:`opacity ${e.motionDurationSlow}`,content:`''`,pointerEvents:`none`}},[`${t}-nav-list`]:{position:`relative`,display:`flex`,transition:`opacity ${e.motionDurationSlow}`},[`${t}-nav-operations`]:{display:`flex`,alignSelf:`stretch`},[`${t}-nav-operations-hidden`]:{position:`absolute`,visibility:`hidden`,pointerEvents:`none`},[`${t}-nav-more`]:{position:`relative`,padding:n,background:`transparent`,border:0,color:e.colorText,"&::after":{position:`absolute`,right:{_skip_check_:!0,value:0},bottom:0,left:{_skip_check_:!0,value:0},height:e.calc(e.controlHeightLG).div(8).equal(),transform:`translateY(100%)`,content:`''`}},[`${t}-nav-add`]:{minWidth:r,minHeight:r,marginLeft:{_skip_check_:!0,value:i},background:`transparent`,border:`${tn(e.lineWidth)} ${e.lineType} ${s}`,borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0`,outline:`none`,cursor:`pointer`,color:e.colorText,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOut}`,"&:hover":{color:a},"&:active, &:focus:not(:focus-visible)":{color:o},...co(e,-3)}},[`${t}-extra-content`]:{flex:`none`},[`${t}-ink-bar`]:{position:`absolute`,background:e.inkBarColor,pointerEvents:`none`},...Xoe(e),[`${t}-content`]:{position:`relative`,width:`100%`},[`${t}-content-holder`]:{flex:`auto`,minWidth:0,minHeight:0},[`${t}-tabpane`]:{...co(e),"&-hidden":{display:`none`}}},[`${t}-centered`]:{[`> ${t}-nav, > div > ${t}-nav`]:{[`${t}-nav-wrap`]:{[`&:not([class*='${t}-nav-wrap-ping']) > ${t}-nav-list`]:{margin:`auto`}}}}}},$oe=fo(`Tabs`,e=>{let t=yi(e,{tabsCardPadding:e.cardPadding,dropdownEdgeChildVerticalPadding:e.paddingXXS,tabsDropdownHeight:200,tabsDropdownWidth:120,tabsHorizontalItemMargin:`0 0 0 ${tn(e.horizontalItemGutter)}`,tabsHorizontalItemMarginRTL:`0 0 0 ${tn(e.horizontalItemGutter)}`});return[Yoe(t),Zoe(t),Joe(t),qoe(t),Koe(t),Qoe(t),Goe(t)]},e=>{let{cardHeight:t,cardHeightSM:n,cardHeightLG:r,controlHeight:i,controlHeightLG:a}=e,o=t||a,s=n||i,c=r||a+8;return{zIndexPopup:e.zIndexPopupBase+50,cardBg:e.colorFillAlter,cardHeight:o,cardHeightSM:s,cardHeightLG:c,cardPadding:`${(o-e.fontHeight)/2-e.lineWidth}px ${e.padding}px`,cardPaddingSM:`${(s-e.fontHeight)/2-e.lineWidth}px ${e.paddingXS}px`,cardPaddingLG:`${(c-e.fontHeightLG)/2-e.lineWidth}px ${e.padding}px`,titleFontSize:e.fontSize,titleFontSizeLG:e.fontSizeLG,titleFontSizeSM:e.fontSize,inkBarColor:e.colorPrimary,horizontalMargin:`0 0 ${e.margin}px 0`,horizontalItemGutter:32,horizontalItemMargin:``,horizontalItemMarginRTL:``,horizontalItemPadding:`${e.paddingSM}px 0`,horizontalItemPaddingSM:`${e.paddingXS}px 0`,horizontalItemPaddingLG:`${e.padding}px 0`,verticalItemPadding:`${e.paddingXS}px ${e.paddingLG}px`,verticalItemMargin:`${e.margin}px 0 0 0`,itemColor:e.colorText,itemSelectedColor:e.colorPrimary,itemHoverColor:e.colorPrimaryHover,itemActiveColor:e.colorPrimaryActive,cardGutter:e.marginXXS/2}}),ese=()=>null,tse=y.forwardRef((e,t)=>{let{type:n,className:r,rootClassName:i,size:a,onEdit:o,hideAdd:s,centered:c,addIcon:l,removeIcon:u,moreIcon:d,more:f,popupClassName:p,children:m,items:h,animated:g,style:_,indicatorSize:v,indicator:b,classNames:x,styles:S,destroyInactiveTabPane:C,destroyOnHidden:w,tabPlacement:T,tabPosition:E,...D}=e,{prefixCls:O}=D,{getPrefixCls:k,direction:A,getPopupContainer:j,className:M,style:N,classNames:ee,styles:te}=mt(`tabs`),{tabs:P}=y.useContext(dt),ne=k(`tabs`,O),re=Kc(ne),[ie,ae]=$oe(ne,re),oe=y.useRef(null);y.useImperativeHandle(t,()=>({nativeElement:oe.current}));let se;n===`editable-card`&&(se={onEdit:(e,{key:t,event:n})=>{o?.(e===`add`?n:t,e)},removeIcon:u??P?.removeIcon??y.createElement(Jo,null),addIcon:(l??P?.addIcon)||y.createElement(loe,null),showAdd:s!==!0});let ce=k(),le=ld(a),ue=Woe(h,m),de=Voe(ne,g),fe={align:b?.align??P?.indicator?.align,size:b?.size??v??P?.indicator?.size??P?.indicatorSize},pe=y.useMemo(()=>{let e=T??E??void 0,t=A===`rtl`;switch(e){case`start`:return t?`right`:`left`;case`end`:return t?`left`:`right`;default:return e}},[T,E,A]),me={...e,size:le,tabPlacement:pe,items:ue},[he,ge]=Nc([ee,x],[te,S],{props:me},{popup:{_default:`root`}});return y.createElement(zoe,{ref:oe,direction:A,getPopupContainer:j,...D,items:ue,className:F({[`${ne}-${le}`]:le,[`${ne}-card`]:[`card`,`editable-card`].includes(n),[`${ne}-editable-card`]:n===`editable-card`,[`${ne}-centered`]:c},M,r,i,he.root,ie,ae,re),classNames:{...he,popup:F(p,ie,ae,re,he.popup?.root)},styles:ge,style:{...ge.root,...N,..._},editable:se,more:{icon:P?.more?.icon??P?.moreIcon??d??y.createElement(vae,null),transitionName:`${ce}-slide-up`,...f},prefixCls:ne,animated:de,indicator:fe,destroyOnHidden:w??C,tabPosition:pe})});tse.TabPane=ese;var nse=tse,rse=({prefixCls:e,className:t,hoverable:n=!0,...r})=>{let{getPrefixCls:i}=y.useContext(dt),a=i(`card`,e),o=F(`${a}-grid`,t,{[`${a}-grid-hoverable`]:n});return y.createElement(`div`,{...r,className:o})},ise=e=>{let{antCls:t,componentCls:n,headerHeight:r,headerPadding:i,tabsMarginBottom:a}=e;return{display:`flex`,justifyContent:`center`,flexDirection:`column`,minHeight:r,marginBottom:-1,padding:`0 ${tn(i)}`,color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:e.headerFontSize,background:e.headerBg,borderBottom:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorderSecondary}`,borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0`,...io(),"&-wrapper":{width:`100%`,display:`flex`,alignItems:`center`},"&-title":{display:`inline-block`,flex:1,...to,[`
          > ${n}-typography,
          > ${n}-typography-edit-content
        `]:{insetInlineStart:0,marginTop:0,marginBottom:0}},[`${t}-tabs-top`]:{clear:`both`,marginBottom:a,color:e.colorText,fontWeight:`normal`,fontSize:e.fontSize,"&-bar":{borderBottom:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorderSecondary}`}}}},ase=e=>{let{cardPaddingBase:t,colorBorderSecondary:n,cardShadow:r,lineWidth:i}=e;return{width:`33.33%`,padding:t,border:0,borderRadius:0,boxShadow:`
      ${tn(i)} 0 0 0 ${n},
      0 ${tn(i)} 0 0 ${n},
      ${tn(i)} ${tn(i)} 0 0 ${n},
      ${tn(i)} 0 0 0 ${n} inset,
      0 ${tn(i)} 0 0 ${n} inset;
    `,transition:`all ${e.motionDurationMid}`,"&-hoverable:hover":{position:`relative`,zIndex:1,boxShadow:r}}},ose=e=>{let{componentCls:t,iconCls:n,actionsLiMargin:r,cardActionsIconSize:i,colorBorderSecondary:a,actionsBg:o}=e;return{margin:0,padding:0,listStyle:`none`,background:o,borderTop:`${tn(e.lineWidth)} ${e.lineType} ${a}`,display:`flex`,borderRadius:`0 0 ${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)}`,...io(),"& > li":{margin:r,color:e.colorTextDescription,textAlign:`center`,"> span":{position:`relative`,display:`block`,minWidth:e.calc(e.cardActionsIconSize).mul(2).equal(),fontSize:e.fontSize,lineHeight:e.lineHeight,cursor:`pointer`,"&:hover":{color:e.colorPrimary,transition:`color ${e.motionDurationMid}`},[`a:not(${t}-btn), > ${n}`]:{display:`inline-block`,width:`100%`,color:e.colorIcon,lineHeight:tn(e.fontHeight),transition:`color ${e.motionDurationMid}`,"&:hover":{color:e.colorPrimary}},[`> ${n}`]:{fontSize:i,lineHeight:tn(e.calc(i).mul(e.lineHeight).equal())}},"&:not(:last-child)":{borderInlineEnd:`${tn(e.lineWidth)} ${e.lineType} ${a}`}}}},sse=e=>({margin:`${tn(e.calc(e.marginXXS).mul(-1).equal())} 0`,display:`flex`,...io(),"&-avatar":{paddingInlineEnd:e.padding},"&-section":{overflow:`hidden`,flex:1,"> div:not(:last-child)":{marginBottom:e.marginXS}},"&-title":{color:e.colorTextHeading,fontWeight:e.fontWeightStrong,fontSize:e.fontSizeLG,...to},"&-description":{color:e.colorTextDescription}}),cse=e=>{let{componentCls:t,colorFillAlter:n,headerPadding:r,bodyPadding:i}=e;return{[`${t}-head`]:{padding:`0 ${tn(r)}`,background:n,"&-title":{fontSize:e.fontSize}},[`${t}-body`]:{padding:`${tn(e.padding)} ${tn(i)}`}}},lse=e=>{let{componentCls:t}=e;return{overflow:`hidden`,[`${t}-body`]:{userSelect:`none`}}},use=e=>{let{componentCls:t,cardShadow:n,cardHeadPadding:r,colorBorderSecondary:i,boxShadowTertiary:a,bodyPadding:o,extraColor:s}=e;return{[t]:{...no(e),position:`relative`,background:e.colorBgContainer,borderRadius:e.borderRadiusLG,[`&:not(${t}-bordered)`]:{boxShadow:a},[`${t}-head`]:ise(e),[`${t}-extra`]:{marginInlineStart:`auto`,color:s,fontWeight:`normal`,fontSize:e.fontSize},[`${t}-body`]:{padding:o,borderRadius:`0 0 ${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)}`},[`${t}-grid`]:ase(e),[`${t}-cover`]:{"> *":{display:`block`,width:`100%`,borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0`}},[`${t}-actions`]:ose(e),[`${t}-meta`]:sse(e)},[`${t}-bordered`]:{border:`${tn(e.lineWidth)} ${e.lineType} ${i}`,[`${t}-cover`]:{marginTop:-1,marginInlineStart:-1,marginInlineEnd:-1}},[`${t}-hoverable`]:{cursor:`pointer`,transition:`box-shadow ${e.motionDurationMid}, border-color ${e.motionDurationMid}`,"&:hover":{borderColor:`transparent`,boxShadow:n}},[`${t}-contain-grid`]:{borderRadius:`${tn(e.borderRadiusLG)} ${tn(e.borderRadiusLG)} 0 0 `,[`${t}-body`]:{display:`flex`,flexWrap:`wrap`},[`&:not(${t}-loading) ${t}-body`]:{marginBlockStart:e.calc(e.lineWidth).mul(-1).equal(),marginInlineStart:e.calc(e.lineWidth).mul(-1).equal(),padding:0}},[`${t}-contain-tabs`]:{[`> div${t}-head`]:{minHeight:0,[`${t}-head-title, ${t}-extra`]:{paddingTop:r}}},[`${t}-type-inner`]:cse(e),[`${t}-loading`]:lse(e),[`${t}-rtl`]:{direction:`rtl`}}},dse=e=>{let{componentCls:t,bodyPaddingSM:n,headerPaddingSM:r,headerHeightSM:i,headerFontSizeSM:a}=e;return{[`${t}-small`]:{[`> ${t}-head`]:{minHeight:i,padding:`0 ${tn(r)}`,fontSize:a,[`> ${t}-head-wrapper`]:{[`> ${t}-extra`]:{fontSize:e.fontSize}}},[`> ${t}-body`]:{padding:n}},[`${t}-small${t}-contain-tabs`]:{[`> ${t}-head`]:{[`${t}-head-title, ${t}-extra`]:{paddingTop:0,display:`flex`,alignItems:`center`}}}}},fse=fo(`Card`,e=>{let t=yi(e,{cardShadow:e.boxShadowCard,cardHeadPadding:e.padding,cardPaddingBase:e.paddingLG,cardActionsIconSize:e.fontSize});return[use(t),dse(t)]},e=>({headerBg:`transparent`,headerFontSize:e.fontSizeLG,headerFontSizeSM:e.fontSize,headerHeight:e.fontSizeLG*e.lineHeightLG+e.padding*2,headerHeightSM:e.fontSize*e.lineHeight+e.paddingXS*2,actionsBg:e.colorBgContainer,actionsLiMargin:`${e.paddingSM}px 0`,tabsMarginBottom:-e.padding-e.lineWidth,extraColor:e.colorText,bodyPaddingSM:12,headerPaddingSM:12,bodyPadding:e.bodyPadding??e.paddingLG,headerPadding:e.headerPadding??e.paddingLG})),pse=e=>{let{actionClasses:t,actions:n=[],actionStyle:r}=e;return y.createElement(`ul`,{className:t,style:r},n.map((e,t)=>{let r=`action-${t}`;return y.createElement(`li`,{style:{width:`${100/n.length}%`},key:r},y.createElement(`span`,null,e))}))},mse=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,rootClassName:i,style:a,extra:o,headStyle:s={},bodyStyle:c={},title:l,loading:u,bordered:d,variant:f,size:p,type:m,cover:h,actions:g,tabList:_,children:v,activeTabKey:b,defaultActiveTabKey:x,tabBarExtraContent:S,hoverable:C,tabProps:w={},classNames:T,styles:E,...D}=e,{getPrefixCls:O,direction:k,className:A,style:j,classNames:M,styles:N}=mt(`card`),[ee]=rg(`card`,f,d),te=ld(p),P={...e,size:te,variant:ee,loading:u},[ne,re]=Nc([M,T],[N,E],{props:P}),ie=t=>{e.onTabChange?.(t)},ae=y.useMemo(()=>Oe(v).some(e=>y.isValidElement(e)&&e.type===rse),[v]),oe=O(`card`,n),[se,ce]=fse(oe),le=y.createElement(Nm,{loading:!0,active:!0,paragraph:{rows:4},title:!1},v),ue=b!==void 0,de={...w,[ue?`activeKey`:`defaultActiveKey`]:ue?b:x,tabBarExtraContent:S},fe,pe=!te||te===`default`?`large`:te,me=_?y.createElement(nse,{size:pe,...de,className:`${oe}-head-tabs`,onChange:ie,items:_.map(({tab:e,...t})=>({label:e,...t}))}):null;if(l||o||me){let e=F(`${oe}-head`,ne.header),t=F(`${oe}-head-title`,ne.title),n=F(`${oe}-extra`,ne.extra),r={...s,...re.header};fe=y.createElement(`div`,{className:e,style:r},y.createElement(`div`,{className:`${oe}-head-wrapper`},l&&y.createElement(`div`,{className:t,style:re.title},l),o&&y.createElement(`div`,{className:n,style:re.extra},o)),me)}let he=F(`${oe}-cover`,ne.cover),ge=h?y.createElement(`div`,{className:he,style:re.cover},h):null,_e=F(`${oe}-body`,ne.body),ve={...c,...re.body},ye=y.createElement(`div`,{className:_e,style:ve},u?le:v),be=F(`${oe}-actions`,ne.actions),xe=g?.length?y.createElement(pse,{actionClasses:be,actionStyle:re.actions,actions:g}):null,Se=De(D,[`onTabChange`]),Ce=F(oe,A,{[`${oe}-loading`]:u,[`${oe}-bordered`]:ee!==`borderless`,[`${oe}-hoverable`]:C,[`${oe}-contain-grid`]:ae,[`${oe}-contain-tabs`]:_?.length,[`${oe}-${te}`]:te,[`${oe}-type-${m}`]:!!m,[`${oe}-rtl`]:k===`rtl`},r,i,se,ce,ne.root),we={...re.root,...j,...a};return y.createElement(`div`,{ref:t,...Se,className:Ce,style:we},fe,ge,ye,xe)}),hse=e=>{let{prefixCls:t,className:n,avatar:r,title:i,description:a,style:o,classNames:s,styles:c,...l}=e,{getPrefixCls:u,className:d,style:f,classNames:p,styles:m}=mt(`cardMeta`),h=`${u(`card`,t)}-meta`,[g,_]=Nc([p,s],[m,c],{props:e}),v=F(h,n,d,g.root),b={...f,..._.root,...o},x=F(`${h}-avatar`,g.avatar),S=F(`${h}-title`,g.title),C=F(`${h}-description`,g.description),w=F(`${h}-section`,g.section),T=r?y.createElement(`div`,{className:x,style:_.avatar},r):null,E=i?y.createElement(`div`,{className:S,style:_.title},i):null,D=a?y.createElement(`div`,{className:C,style:_.description},a):null,O=E||D?y.createElement(`div`,{className:w,style:_.section},E,D):null;return y.createElement(`div`,{...l,className:v,style:b},T,O)},q_=mse;q_.Grid=rse,q_.Meta=hse;var gse=q_,_se=e=>{let{componentCls:t}=e;return{[t]:{"&-horizontal":{[`&${t}`]:{"&-sm":{marginBlock:e.marginXS},"&-md":{marginBlock:e.margin}}}}}},vse=e=>{let{componentCls:t,sizePaddingEdgeHorizontal:n,colorSplit:r,lineWidth:i,textPaddingInline:a,orientationMargin:o,verticalMarginInline:s}=e,c=`${t}-rail`;return{[t]:{...no(e),borderBlockStart:`${tn(i)} solid ${r}`,[c]:{borderBlockStart:`${tn(i)} solid ${r}`},"&-vertical":{position:`relative`,top:`-0.06em`,display:`inline-block`,height:`0.9em`,marginInline:s,marginBlock:0,verticalAlign:`middle`,borderTop:0,borderInlineStart:`${tn(i)} solid ${r}`},"&-horizontal":{display:`flex`,clear:`both`,width:`100%`,minWidth:`100%`,margin:`${tn(e.marginLG)} 0`},[`&-horizontal${t}-with-text`]:{display:`flex`,alignItems:`center`,margin:`${tn(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:`nowrap`,textAlign:`center`,borderBlockStart:`0 ${r}`,[`${c}-start, ${c}-end`]:{width:`50%`,borderBlockStartColor:`inherit`,borderBlockEnd:0,content:`''`}},[`&-horizontal${t}-with-text-start`]:{[`${c}-start`]:{width:`calc(${o} * 100%)`},[`${c}-end`]:{width:`calc(100% - ${o} * 100%)`}},[`&-horizontal${t}-with-text-end`]:{[`${c}-start`]:{width:`calc(100% - ${o} * 100%)`},[`${c}-end`]:{width:`calc(${o} * 100%)`}},[`${t}-inner-text`]:{display:`inline-block`,paddingBlock:0,paddingInline:a},"&-dashed":{background:`none`,borderColor:r,borderStyle:`dashed`,borderWidth:`${tn(i)} 0 0`,[c]:{borderBlockStart:`${tn(i)} dashed ${r}`}},[`&-horizontal${t}-with-text${t}-dashed`]:{[`${c}-start, ${c}-end`]:{borderStyle:`dashed none none`}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:`none`,borderColor:r,borderStyle:`dotted`,borderWidth:`${tn(i)} 0 0`,[c]:{borderBlockStart:`${tn(i)} dotted ${r}`}},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:`dotted none none`}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:`normal`,fontSize:e.fontSize},[`&-horizontal${t}-with-text-start${t}-no-default-orientation-margin-start`]:{[`${c}-start`]:{width:0},[`${c}-end`]:{width:`100%`},[`${t}-inner-text`]:{paddingInlineStart:n}},[`&-horizontal${t}-with-text-end${t}-no-default-orientation-margin-end`]:{[`${c}-start`]:{width:`100%`},[`${c}-end`]:{width:0},[`${t}-inner-text`]:{paddingInlineEnd:n}}}}},yse=fo(`Divider`,e=>{let t=yi(e,{dividerHorizontalWithTextGutterMargin:e.margin,sizePaddingEdgeHorizontal:0});return[vse(t),_se(t)]},e=>({textPaddingInline:`1em`,orientationMargin:.05,verticalMarginInline:e.marginXS}),{unitless:{orientationMargin:!0}}),bse=[`left`,`right`,`center`,`start`,`end`],xse={small:`sm`,middle:`md`},J_=e=>{let{getPrefixCls:t,direction:n,className:r,style:i,classNames:a,styles:o}=mt(`divider`),{prefixCls:s,type:c,orientation:l,vertical:u,titlePlacement:d,orientationMargin:f,className:p,rootClassName:m,children:h,dashed:g,variant:_=`solid`,plain:v,style:b,size:x,classNames:S,styles:C,...w}=e,T=t(`divider`,s),E=`${T}-rail`,[D,O]=yse(T),k=ld(x),A=xse[k],j=!!h,M=bse.includes(l||``),N=y.useMemo(()=>{let e=d??(M?l:`center`);return e===`left`?n===`rtl`?`end`:`start`:e===`right`?n===`rtl`?`start`:`end`:e},[n,l,d,M]),ee=N===`start`&&f!=null,te=N===`end`&&f!=null,[P,ne]=Fc(l,u,c),re={...e,orientation:P,titlePlacement:N,size:k},[ie,ae]=Nc([a,S],[o,C],{props:re}),oe=F(T,r,D,O,`${T}-${P}`,{[`${T}-with-text`]:j,[`${T}-with-text-${N}`]:j,[`${T}-dashed`]:!!g,[`${T}-${_}`]:_!==`solid`,[`${T}-plain`]:!!v,[`${T}-rtl`]:n===`rtl`,[`${T}-no-default-orientation-margin-start`]:ee,[`${T}-no-default-orientation-margin-end`]:te,[`${T}-${A}`]:!!A,[E]:!h,[ie.rail]:ie.rail&&!h},p,m,ie.root),se=y.useMemo(()=>typeof f==`number`?f:/^\d+$/.test(f)?Number(f):f,[f]),ce={marginInlineStart:ee?se:void 0,marginInlineEnd:te?se:void 0};return y.createElement(`div`,{className:oe,style:{...i,...ae.root,...h?{}:ae.rail,...b},...w,role:`separator`},h&&!ne&&y.createElement(y.Fragment,null,y.createElement(`div`,{className:F(E,`${E}-start`,ie.rail),style:ae.rail}),y.createElement(`span`,{className:F(`${T}-inner-text`,ie.content),style:{...ce,...ae.content}},h),y.createElement(`div`,{className:F(E,`${E}-end`,ie.rail),style:ae.rail})))},Sse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M766.4 744.3c43.7 0 79.4-36.2 79.4-80.5 0-53.5-79.4-140.8-79.4-140.8S687 610.3 687 663.8c0 44.3 35.7 80.5 79.4 80.5zm-377.1-44.1c7.1 7.1 18.6 7.1 25.6 0l256.1-256c7.1-7.1 7.1-18.6 0-25.6l-256-256c-.6-.6-1.3-1.2-2-1.7l-78.2-78.2a9.11 9.11 0 00-12.8 0l-48 48a9.11 9.11 0 000 12.8l67.2 67.2-207.8 207.9c-7.1 7.1-7.1 18.6 0 25.6l255.9 256zm12.9-448.6l178.9 178.9H223.4l178.8-178.9zM904 816H120c-4.4 0-8 3.6-8 8v80c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-80c0-4.4-3.6-8-8-8z`}}]},name:`bg-colors`,theme:`outlined`};function Y_(){return Y_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Y_.apply(this,arguments)}var Cse=y.forwardRef((e,t)=>y.createElement(Bo,Y_({},e,{ref:t,icon:Sse}))),wse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z`}}]},name:`camera`,theme:`outlined`};function X_(){return X_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},X_.apply(this,arguments)}var Tse=y.forwardRef((e,t)=>y.createElement(Bo,X_({},e,{ref:t,icon:wse}))),Ese={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z`}}]},name:`copy`,theme:`outlined`};function Z_(){return Z_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Z_.apply(this,arguments)}var Dse=y.forwardRef((e,t)=>y.createElement(Bo,Z_({},e,{ref:t,icon:Ese}))),Ose={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z`}}]},name:`delete`,theme:`outlined`};function Q_(){return Q_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Q_.apply(this,arguments)}var kse=y.forwardRef((e,t)=>y.createElement(Bo,Q_({},e,{ref:t,icon:Ose}))),Ase={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z`}}]},name:`download`,theme:`outlined`};function $_(){return $_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$_.apply(this,arguments)}var jse=y.forwardRef((e,t)=>y.createElement(Bo,$_({},e,{ref:t,icon:Ase}))),Mse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z`}}]},name:`edit`,theme:`outlined`};function ev(){return ev=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ev.apply(this,arguments)}var Nse=y.forwardRef((e,t)=>y.createElement(Bo,ev({},e,{ref:t,icon:Mse}))),Pse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M864 170h-60c-4.4 0-8 3.6-8 8v518H310v-73c0-6.7-7.8-10.5-13-6.3l-141.9 112a8 8 0 000 12.6l141.9 112c5.3 4.2 13 .4 13-6.3v-75h498c35.3 0 64-28.7 64-64V178c0-4.4-3.6-8-8-8z`}}]},name:`enter`,theme:`outlined`};function tv(){return tv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},tv.apply(this,arguments)}var Fse=y.forwardRef((e,t)=>y.createElement(Bo,tv({},e,{ref:t,icon:Pse}))),Ise={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 472a40 40 0 1080 0 40 40 0 10-80 0zm367 352.9L696.3 352V178H768v-68H256v68h71.7v174L145 824.9c-2.8 7.4-4.3 15.2-4.3 23.1 0 35.3 28.7 64 64 64h614.6c7.9 0 15.7-1.5 23.1-4.3 33-12.7 49.4-49.8 36.6-82.8zM395.7 364.7V180h232.6v184.7L719.2 600c-20.7-5.3-42.1-8-63.9-8-61.2 0-119.2 21.5-165.3 60a188.78 188.78 0 01-121.3 43.9c-32.7 0-64.1-8.3-91.8-23.7l118.8-307.5zM210.5 844l41.7-107.8c35.7 18.1 75.4 27.8 116.6 27.8 61.2 0 119.2-21.5 165.3-60 33.9-28.2 76.3-43.9 121.3-43.9 35 0 68.4 9.5 97.6 27.1L813.5 844h-603z`}}]},name:`experiment`,theme:`outlined`};function nv(){return nv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},nv.apply(this,arguments)}var Lse=y.forwardRef((e,t)=>y.createElement(Bo,nv({},e,{ref:t,icon:Ise}))),Rse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z`}},{tag:`path`,attrs:{d:`M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z`}}]},name:`eye-invisible`,theme:`outlined`};function rv(){return rv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},rv.apply(this,arguments)}var zse=y.forwardRef((e,t)=>y.createElement(Bo,rv({},e,{ref:t,icon:Rse}))),Bse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z`}}]},name:`eye`,theme:`outlined`};function iv(){return iv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iv.apply(this,arguments)}var av=y.forwardRef((e,t)=>y.createElement(Bo,iv({},e,{ref:t,icon:Bse}))),Vse={icon:function(e,t){return{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M534 352V136H232v752h560V394H576a42 42 0 01-42-42z`,fill:t}},{tag:`path`,attrs:{d:`M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z`,fill:e}}]}},name:`file`,theme:`twotone`};function ov(){return ov=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ov.apply(this,arguments)}var Hse=y.forwardRef((e,t)=>y.createElement(Bo,ov({},e,{ref:t,icon:Vse}))),Use={icon:{tag:`svg`,attrs:{viewBox:`0 0 1024 1024`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z`}}]},name:`inbox`,theme:`outlined`};function sv(){return sv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},sv.apply(this,arguments)}var Wse=y.forwardRef((e,t)=>y.createElement(Bo,sv({},e,{ref:t,icon:Use}))),Gse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z`}}]},name:`paper-clip`,theme:`outlined`};function cv(){return cv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cv.apply(this,arguments)}var Kse=y.forwardRef((e,t)=>y.createElement(Bo,cv({},e,{ref:t,icon:Gse}))),qse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm-88-532h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8zm224 0h-48c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8z`}}]},name:`pause-circle`,theme:`outlined`};function lv(){return lv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lv.apply(this,arguments)}var Jse=y.forwardRef((e,t)=>y.createElement(Bo,lv({},e,{ref:t,icon:qse}))),Yse={icon:function(e,t){return{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z`,fill:e}},{tag:`path`,attrs:{d:`M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z`,fill:t}},{tag:`path`,attrs:{d:`M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z`,fill:t}},{tag:`path`,attrs:{d:`M276 368a28 28 0 1056 0 28 28 0 10-56 0z`,fill:t}},{tag:`path`,attrs:{d:`M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z`,fill:e}}]}},name:`picture`,theme:`twotone`};function uv(){return uv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uv.apply(this,arguments)}var Xse=y.forwardRef((e,t)=>y.createElement(Bo,uv({},e,{ref:t,icon:Yse}))),Zse={icon:{tag:`svg`,attrs:{viewBox:`64 64 896 896`,focusable:`false`},children:[{tag:`path`,attrs:{d:`M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z`}},{tag:`path`,attrs:{d:`M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z`}}]},name:`play-circle`,theme:`outlined`};function dv(){return dv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dv.apply(this,arguments)}var Qse=y.forwardRef((e,t)=>y.createElement(Bo,dv({},e,{ref:t,icon:Zse}))),$se=e=>{let{componentCls:t,borderRadius:n,paddingSM:r,colorBorder:i,paddingXS:a,fontSizeLG:o,fontSizeSM:s,borderRadiusLG:c,borderRadiusSM:l,colorBgContainerDisabled:u,lineWidth:d}=e;return{[t]:[{display:`inline-flex`,alignItems:`center`,gap:0,paddingInline:r,margin:0,borderWidth:d,borderStyle:`solid`,borderRadius:n,"&:hover":{zIndex:0},[`&${t}-disabled`]:{color:e.colorTextDisabled},"&-large":{fontSize:o,borderRadius:c},"&-small":{paddingInline:a,borderRadius:l,fontSize:s},"&-compact-last-item":{borderEndStartRadius:0,borderStartStartRadius:0},"&-compact-first-item":{borderEndEndRadius:0,borderStartEndRadius:0},"&-compact-item:not(:first-child):not(:last-child)":{borderRadius:0},"&-compact-item:not(:last-child)":{borderInlineEndWidth:0},"&-compact-item:not(:first-child)":{borderInlineStartWidth:0}},{"--space-addon-border-color":i,"--space-addon-background":u,"--space-addon-border-color-outlined":i,"--space-addon-background-filled":u,borderColor:`var(--space-addon-border-color)`,background:`var(--space-addon-background)`,"&-variant-outlined":{"--space-addon-border-color":`var(--space-addon-border-color-outlined)`},"&-variant-filled":{"--space-addon-border-color":`transparent`,"--space-addon-background":`var(--space-addon-background-filled)`,[`&${t}-disabled`]:{"--space-addon-border-color":i,"--space-addon-background":u}},"&-variant-borderless":{border:`none`,background:`transparent`},"&-variant-underlined":{border:`none`,background:`transparent`}},{"&-status-error":{"--space-addon-border-color-outlined":e.colorError,"--space-addon-background-filled":e.colorErrorBg,color:e.colorError},"&-status-warning":{"--space-addon-border-color-outlined":e.colorWarning,"--space-addon-background-filled":e.colorWarningBg,color:e.colorWarning}}]}},ece=fo([`Space`,`Addon`],e=>[$se(e),Bf(e,{focus:!1})]),tce=y.forwardRef((e,t)=>{let{className:n,children:r,style:i,prefixCls:a,variant:o=`outlined`,disabled:s,status:c,...l}=e,{getPrefixCls:u,direction:d}=y.useContext(dt),f=u(`space-addon`,a),[p,m]=ece(f),{compactItemClassnames:h,compactSize:g}=pd(f,d),_=Zh(f,c),v=F(f,p,h,m,`${f}-variant-${o}`,_,{[`${f}-${g}`]:g,[`${f}-disabled`]:s},n);return y.createElement(`div`,{ref:t,className:v,style:i,...l},r)});function nce(e){return!!(e.addonBefore||e.addonAfter)}function rce(e){return!!(e.prefix||e.suffix||e.allowClear)}function fv(e,t,n){let r=t.cloneNode(!0),i=Object.create(e,{target:{value:r},currentTarget:{value:r}});return r.value=n,typeof t.selectionStart==`number`&&typeof t.selectionEnd==`number`&&(r.selectionStart=t.selectionStart,r.selectionEnd=t.selectionEnd),r.setSelectionRange=(...e)=>{t.setSelectionRange(...e)},i}function pv(e,t,n,r){if(!n)return;let i=t;if(t.type===`click`){i=fv(t,e,``),n(i);return}if(e.type!==`file`&&r!==void 0){i=fv(t,e,r),n(i);return}n(i)}function mv(){return mv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},mv.apply(this,arguments)}var hv=y.forwardRef((e,t)=>{let{inputElement:n,children:r,prefixCls:i,prefix:a,suffix:o,addonBefore:s,addonAfter:c,className:l,style:u,disabled:d,readOnly:f,focused:p,triggerFocus:m,allowClear:h,value:g,handleReset:_,hidden:v,classes:b,classNames:x,dataAttrs:S,styles:C,components:w,onClear:T}=e,E=r??n,D=w?.affixWrapper||`span`,O=w?.groupWrapper||`span`,k=w?.wrapper||`span`,A=w?.groupAddon||`span`,j=(0,y.useRef)(null),M=e=>{j.current?.contains(e.target)&&m?.()},N=rce(e),ee=(0,y.cloneElement)(E,{value:g,className:F(E.props?.className,!N&&x?.variant)||null}),te=(0,y.useRef)(null);if(y.useImperativeHandle(t,()=>({nativeElement:te.current||j.current})),N){let e=null;if(h){let t=!d&&!f&&g,n=`${i}-clear-icon`,r=typeof h==`object`&&h?.clearIcon?h.clearIcon:``;e=y.createElement(`button`,{type:`button`,tabIndex:-1,onClick:e=>{_?.(e),T?.()},onMouseDown:e=>e.preventDefault(),className:F(n,{[`${n}-hidden`]:!t,[`${n}-has-suffix`]:!!o})},r)}let t=`${i}-affix-wrapper`,n=F(t,{[`${i}-disabled`]:d,[`${t}-disabled`]:d,[`${t}-focused`]:p,[`${t}-readonly`]:f,[`${t}-input-with-clear-btn`]:o&&h&&g},b?.affixWrapper,x?.affixWrapper,x?.variant),r=(o||h)&&y.createElement(`span`,{className:F(`${i}-suffix`,x?.suffix),style:C?.suffix},e,o);ee=y.createElement(D,mv({className:n,style:C?.affixWrapper,onClick:M},S?.affixWrapper,{ref:j}),a&&y.createElement(`span`,{className:F(`${i}-prefix`,x?.prefix),style:C?.prefix},a),ee,r)}if(nce(e)){let e=`${i}-group`,t=`${e}-addon`,n=`${e}-wrapper`,r=F(`${i}-wrapper`,e,b?.wrapper,x?.wrapper),a=F(n,{[`${n}-disabled`]:d},b?.group,x?.groupWrapper);ee=y.createElement(O,{className:a,ref:te},y.createElement(k,{className:r},s&&y.createElement(A,{className:t},s),ee,c&&y.createElement(A,{className:t},c)))}return y.cloneElement(ee,{className:F(ee.props?.className,l)||null,style:{...ee.props?.style,...u},hidden:v})});function gv(e,t){return y.useMemo(()=>{let n={};t&&(n.show=typeof t==`object`&&t.formatter?t.formatter:!!t),n={...n,...e};let{show:r,...i}=n;return{...i,show:!!r,showFormatter:typeof r==`function`?r:void 0,strategy:i.strategy||(e=>e.length)}},[e,t])}function _v(){return _v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_v.apply(this,arguments)}var ice=(0,y.forwardRef)((e,t)=>{let{autoComplete:n,onChange:r,onFocus:i,onBlur:a,onPressEnter:o,onKeyDown:s,onKeyUp:c,prefixCls:l=`rc-input`,disabled:u,htmlSize:d,className:f,maxLength:p,suffix:m,showCount:h,count:g,type:_=`text`,classes:v,classNames:b,styles:x,onCompositionStart:S,onCompositionEnd:C,...w}=e,[T,E]=(0,y.useState)(!1),D=(0,y.useRef)(!1),k=(0,y.useRef)(!1),A=(0,y.useRef)(null),j=(0,y.useRef)(null),M=e=>{A.current&&Kg(A.current,e)},[N,ee]=O(e.defaultValue,e.value),te=N==null?``:String(N),[P,ne]=(0,y.useState)(null),re=gv(g,h),ie=re.max||p,ae=re.strategy(te),oe=!!ie&&ae>ie;(0,y.useImperativeHandle)(t,()=>({focus:M,blur:()=>{A.current?.blur()},setSelectionRange:(e,t,n)=>{A.current?.setSelectionRange(e,t,n)},select:()=>{A.current?.select()},input:A.current,nativeElement:j.current?.nativeElement||A.current})),(0,y.useEffect)(()=>{k.current&&=!1,E(e=>e&&u?!1:e)},[u]);let se=(e,t,n)=>{let i=t;if(!D.current&&re.exceedFormatter&&re.max&&re.strategy(t)>re.max)i=re.exceedFormatter(t,{max:re.max}),t!==i&&ne([A.current?.selectionStart||0,A.current?.selectionEnd||0]);else if(n.source===`compositionEnd`)return;ee(i),A.current&&pv(A.current,e,r,i)};(0,y.useEffect)(()=>{P&&A.current?.setSelectionRange(...P)},[P]);let ce=e=>{se(e,e.target.value,{source:`change`})},le=e=>{D.current=!1,se(e,e.currentTarget.value,{source:`compositionEnd`}),C?.(e)},ue=e=>{o&&e.key===`Enter`&&!k.current&&!e.nativeEvent.isComposing&&(k.current=!0,o(e)),s?.(e)},de=e=>{e.key===`Enter`&&(k.current=!1),c?.(e)},fe=e=>{E(!0),i?.(e)},pe=e=>{k.current&&=!1,E(!1),a?.(e)},me=e=>{ee(``),M(),A.current&&pv(A.current,e,r)},he=oe&&`${l}-out-of-range`;return y.createElement(hv,_v({},w,{prefixCls:l,className:F(f,he),handleReset:me,value:te,focused:T,triggerFocus:M,suffix:(()=>{let e=Number(ie)>0;if(m||re.show){let t=re.showFormatter?re.showFormatter({value:te,count:ae,maxLength:ie}):`${ae}${e?` / ${ie}`:``}`;return y.createElement(y.Fragment,null,re.show&&y.createElement(`span`,{className:F(`${l}-show-count-suffix`,{[`${l}-show-count-has-suffix`]:!!m},b?.count),style:{...x?.count}},t),m)}return null})(),disabled:u,classes:v,classNames:b,styles:x,ref:j}),(()=>{let t=De(e,[`prefixCls`,`onPressEnter`,`addonBefore`,`addonAfter`,`prefix`,`suffix`,`allowClear`,`defaultValue`,`showCount`,`count`,`classes`,`htmlSize`,`styles`,`classNames`,`onClear`]);return y.createElement(`input`,_v({autoComplete:n},t,{onChange:ce,onFocus:fe,onBlur:pe,onKeyDown:ue,onKeyUp:de,className:F(l,{[`${l}-disabled`]:u},b?.input),style:x?.input,ref:A,size:d,type:_,onCompositionStart:e=>{D.current=!0,S?.(e)},onCompositionEnd:le}))})())}),vv=e=>{let t;return typeof e==`object`&&e?.clearIcon?t=e:e&&(t={clearIcon:y.createElement(Go,null)}),t};function yv(e,t){let n=(0,y.useRef)([]),r=()=>{n.current.push(setTimeout(()=>{e.current?.input&&e.current?.input.getAttribute(`type`)===`password`&&e.current?.input.hasAttribute(`value`)&&e.current?.input.removeAttribute(`value`)}))};return(0,y.useEffect)(()=>(t&&r(),()=>n.current.forEach(e=>{e&&clearTimeout(e)})),[]),r}function ace(e){return!!(e.prefix||e.suffix||e.allowClear||e.showCount)}var bv=(0,y.forwardRef)((e,t)=>{let{prefixCls:n,bordered:r=!0,status:i,size:a,disabled:o,onBlur:s,onFocus:c,suffix:l,allowClear:u,addonAfter:d,addonBefore:f,className:p,style:m,styles:h,rootClassName:g,onChange:_,classNames:v,variant:b,...x}=e,{getPrefixCls:S,direction:C,allowClear:w,autoComplete:T,className:E,style:D,classNames:O,styles:k}=mt(`input`),A=S(`input`,n),j=(0,y.useRef)(null),M=Kc(A),[N,ee]=ooe(A,g);soe(A,M);let{compactSize:te,compactItemClassnames:P}=pd(A,C),ne=ld(e=>a??te??e),re=y.useContext(Ql),ae=o??re,oe={...e,size:ne,disabled:ae},[se,ce]=Nc([O,v],[k,h],{props:oe}),{status:le,hasFeedback:ue,feedbackIcon:de}=(0,y.useContext)(Sm),fe=Qh(le,i);(0,y.useRef)(ace(e)||!!ue);let pe=yv(j,!0),me=e=>{pe(),s?.(e)},he=e=>{pe(),c?.(e)},ge=e=>{pe(),_?.(e)},_e=(ue||l)&&y.createElement(y.Fragment,null,l,ue&&de),ve=vv(u??w),[ye,be]=rg(`input`,b,r);return y.createElement(ice,{ref:ie(t,j),prefixCls:A,autoComplete:T,...x,disabled:ae,onBlur:me,onFocus:he,style:{...ce.root,...D,...m},styles:ce,suffix:_e,allowClear:ve,className:F(p,g,ee,M,P,E,se.root),onChange:ge,addonBefore:f&&y.createElement(Cm,{form:!0,space:!0},f),addonAfter:d&&y.createElement(Cm,{form:!0,space:!0},d),classNames:{...se,input:F({[`${A}-sm`]:ne===`small`,[`${A}-lg`]:ne===`large`,[`${A}-rtl`]:C===`rtl`},se.input,N),variant:F({[`${A}-${ye}`]:be},Zh(A,fe)),affixWrapper:F({[`${A}-affix-wrapper-sm`]:ne===`small`,[`${A}-affix-wrapper-lg`]:ne===`large`,[`${A}-affix-wrapper-rtl`]:C===`rtl`},N),wrapper:F({[`${A}-group-rtl`]:C===`rtl`},N),groupWrapper:F({[`${A}-group-wrapper-sm`]:ne===`small`,[`${A}-group-wrapper-lg`]:ne===`large`,[`${A}-group-wrapper-rtl`]:C===`rtl`,[`${A}-group-wrapper-${ye}`]:be},Zh(`${A}-group-wrapper`,fe,ue),N)}})});function xv(e){return[`small`,`middle`,`large`].includes(e)}function Sv(e){return e?typeof e==`number`&&!Number.isNaN(e):!1}const Cv=y.createContext({latestIndex:0}),oce=Cv.Provider;var sce=e=>{let{className:t,prefix:n,index:r,children:i,separator:a,style:o,classNames:s,styles:c}=e,{latestIndex:l}=y.useContext(Cv);return gc(i)?y.createElement(y.Fragment,null,y.createElement(`div`,{className:t,style:o},i),r<l&&a&&y.createElement(`span`,{className:F(`${n}-item-separator`,s.separator),style:c.separator},a)):null},cce=e=>{let{componentCls:t,antCls:n}=e;return{[t]:{display:`inline-flex`,"&-rtl":{direction:`rtl`},"&-vertical":{flexDirection:`column`},"&-align":{flexDirection:`column`,"&-center":{alignItems:`center`},"&-start":{alignItems:`flex-start`},"&-end":{alignItems:`flex-end`},"&-baseline":{alignItems:`baseline`}},[`${t}-item:empty`]:{display:`none`},[`${t}-item > ${n}-badge-not-a-wrapper:only-child`]:{display:`block`}}}},lce=e=>{let{componentCls:t}=e;return{[t]:{"&-gap-row-small":{rowGap:e.spaceGapSmallSize},"&-gap-row-middle":{rowGap:e.spaceGapMiddleSize},"&-gap-row-large":{rowGap:e.spaceGapLargeSize},"&-gap-col-small":{columnGap:e.spaceGapSmallSize},"&-gap-col-middle":{columnGap:e.spaceGapMiddleSize},"&-gap-col-large":{columnGap:e.spaceGapLargeSize}}}},uce=fo(`Space`,e=>{let t=yi(e,{spaceGapSmallSize:e.paddingXS,spaceGapMiddleSize:e.padding,spaceGapLargeSize:e.paddingLG});return[cce(t),lce(t)]},()=>({}),{resetStyle:!1}),wv=y.forwardRef((e,t)=>{let{getPrefixCls:n,direction:r,size:i,className:a,style:o,classNames:s,styles:c}=mt(`space`),{size:l=i??`small`,align:u,className:d,rootClassName:f,children:p,direction:m,orientation:h,prefixCls:g,split:_,separator:v,style:b,vertical:x,wrap:S=!1,classNames:C,styles:w,...T}=e,[E,D]=Array.isArray(l)?l:[l,l],O=xv(D),k=xv(E),A=Sv(D),j=Sv(E),M=Oe(p,{keepEmpty:!0}),[N,ee]=Fc(h,x,m),te=u===void 0&&!ee?`center`:u,P=v??_,ne=n(`space`,g),[re,ie]=uce(ne),ae={...e,size:l,orientation:N,align:te},[oe,se]=Nc([s,C],[c,w],{props:ae}),ce=F(ne,a,re,`${ne}-${N}`,{[`${ne}-rtl`]:r===`rtl`,[`${ne}-align-${te}`]:te,[`${ne}-gap-row-${D}`]:O,[`${ne}-gap-col-${E}`]:k},d,f,ie,oe.root),le=F(`${ne}-item`,oe.item),ue=M.map((e,t)=>{let n=e?.key||`${le}-${t}`;return y.createElement(sce,{prefix:ne,classNames:oe,styles:se,className:le,key:n,index:t,separator:P,style:se.item},e)}),de=y.useMemo(()=>({latestIndex:M.reduce((e,t,n)=>gc(t)?n:e,0)}),[M]);if(M.length===0)return null;let fe={};return S&&(fe.flexWrap=`wrap`),!k&&j&&(fe.columnGap=E),!O&&A&&(fe.rowGap=D),y.createElement(`div`,{ref:t,className:ce,style:{...fe,...se.root,...o,...b},...T},y.createElement(oce,{value:de},ue))});wv.Compact=gd,wv.Addon=tce;var dce=wv,fce=e=>{let{getPrefixCls:t,direction:n}=(0,y.useContext)(dt),{prefixCls:r,className:i}=e,a=t(`input-group`,r),[o,s]=soe(t(`input`)),c=F(a,s,{[`${a}-lg`]:e.size===`large`,[`${a}-sm`]:e.size===`small`,[`${a}-compact`]:e.compact,[`${a}-rtl`]:n===`rtl`},o,i),l=(0,y.useContext)(Sm),u=(0,y.useMemo)(()=>({...l,isFormItemInput:!1}),[l]);return y.createElement(Sm.Provider,{value:u},y.createElement(dce.Compact,{className:c,style:e.style,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onFocus:e.onFocus,onBlur:e.onBlur},e.children))},pce=e=>{let{componentCls:t,paddingXS:n}=e;return{[t]:{display:`inline-flex`,alignItems:`center`,flexWrap:`nowrap`,columnGap:n,[`${t}-input-wrapper`]:{position:`relative`,[`${t}-mask-icon`]:{position:`absolute`,zIndex:`1`,top:`50%`,right:`50%`,transform:`translate(50%, -50%)`,pointerEvents:`none`},[`${t}-mask-input`]:{color:`transparent`,caretColor:e.colorText},[`${t}-mask-input[type=number]::-webkit-inner-spin-button`]:{"-webkit-appearance":`none`,margin:0},[`${t}-mask-input[type=number]`]:{"-moz-appearance":`textfield`}},"&-rtl":{direction:`rtl`},[`${t}-input`]:{textAlign:`center`,paddingInline:e.paddingXXS},[`&${t}-sm ${t}-input`]:{paddingInline:e.calc(e.paddingXXS).div(2).equal()},[`&${t}-lg ${t}-input`]:{paddingInline:e.paddingXS}}}},mce=fo([`Input`,`OTP`],e=>pce(yi(e,N_(e))),P_),hce=y.forwardRef((e,t)=>{let{className:n,value:r,onChange:i,onActiveChange:a,index:o,mask:s,onFocus:c,...l}=e,{getPrefixCls:u}=y.useContext(dt),d=u(`otp`),f=typeof s==`string`?s:r,p=y.useRef(null);y.useImperativeHandle(t,()=>p.current);let m=e=>{i(o,e.target.value)},h=()=>{lt(()=>{let e=p.current?.input;document.activeElement===e&&e&&e.select()})},g=e=>{c?.(e),h()},_=e=>{let{key:t,ctrlKey:n,metaKey:i}=e;t===`ArrowLeft`?a(o-1):t===`ArrowRight`?a(o+1):t===`z`&&(n||i)?e.preventDefault():t===`Backspace`&&!r&&a(o-1),h()};return y.createElement(`span`,{className:`${d}-input-wrapper`,role:`presentation`},s&&r!==``&&r!==void 0&&y.createElement(`span`,{className:`${d}-mask-icon`,"aria-hidden":`true`},f),y.createElement(bv,{"aria-label":`OTP Input ${o+1}`,type:s===!0?`password`:`text`,...l,ref:p,value:r,onInput:m,onFocus:g,onKeyDown:_,onMouseDown:h,onMouseUp:h,className:F(n,{[`${d}-mask-input`]:s})}))});function Tv(e){return(e||``).split(``)}var gce=e=>{let{index:t,prefixCls:n,separator:r,className:i,style:a}=e,o=typeof r==`function`?r(t):r;return o?y.createElement(`span`,{className:F(`${n}-separator`,i),style:a},o):null},_ce=y.forwardRef((e,t)=>{let{prefixCls:n,length:r=6,size:i,defaultValue:a,value:o,onChange:s,formatter:c,separator:l,variant:u,disabled:d,status:f,autoFocus:p,mask:m,type:h,onInput:g,onFocus:_,inputMode:v,classNames:b,styles:S,className:C,style:w,...T}=e,{classNames:E,styles:D,getPrefixCls:O,direction:k,style:A,className:j}=mt(`otp`),M=O(`otp`,n),N={...e,length:r},[ee,te]=Nc([E,b],[D,S],{props:N}),P=Gs(T,{aria:!0,data:!0,attr:!0}),[ne,re]=mce(M),ie=ld(e=>i??e),ae=y.useContext(Sm),oe=Qh(ae.status,f),se=y.useMemo(()=>({...ae,status:oe,hasFeedback:!1,feedbackIcon:null}),[ae,oe]),ce=y.useRef(null),le=y.useRef({});y.useImperativeHandle(t,()=>({focus:()=>{le.current[0]?.focus()},blur:()=>{for(let e=0;e<r;e+=1)le.current[e]?.blur()},nativeElement:ce.current}));let ue=e=>c?c(e):e,[de,fe]=y.useState(()=>Tv(ue(a||``)));y.useEffect(()=>{o!==void 0&&fe(Tv(o))},[o]);let pe=x(e=>{fe(e),g&&g(e),s&&e.length===r&&e.every(e=>e)&&e.some((e,t)=>de[t]!==e)&&s(e.join(``))}),me=x((e,t)=>{let n=nt(de);for(let t=0;t<e;t+=1)n[t]||(n[t]=``);t.length<=1?n[e]=t:n=n.slice(0,e).concat(Tv(t)),n=n.slice(0,r);for(let e=n.length-1;e>=0&&!n[e];--e)n.pop();return n=Tv(ue(n.map(e=>e||` `).join(``))).map((e,t)=>e===` `&&!n[t]?n[t]:e),n}),he=(e,t)=>{let n=me(e,t),i=Math.min(e+t.length,r-1);i!==e&&n[e]!==void 0&&le.current[i]?.focus(),pe(n)},ge=e=>{le.current[e]?.focus()},_e=(e,t)=>{for(let e=0;e<t;e+=1)if(!le.current[e]?.input?.value){le.current[e]?.focus();break}_?.(e)},ve={variant:u,disabled:d,status:oe,mask:m,type:h,inputMode:v};return y.createElement(`div`,{...P,ref:ce,className:F(C,M,{[`${M}-sm`]:ie===`small`,[`${M}-lg`]:ie===`large`,[`${M}-rtl`]:k===`rtl`},re,ne,j,ee.root),style:{...te.root,...A,...w},role:`group`},y.createElement(Sm.Provider,{value:se},Array.from({length:r}).map((e,t)=>{let n=`otp-${t}`,i=de[t]||``;return y.createElement(y.Fragment,{key:n},y.createElement(hce,{ref:e=>{le.current[t]=e},index:t,size:ie,htmlSize:1,className:F(ee.input,`${M}-input`),style:te.input,onChange:he,value:i,onActiveChange:ge,autoFocus:t===0&&p,onFocus:e=>_e(e,t),...ve}),t<r-1&&y.createElement(gce,{separator:l,index:t,prefixCls:M,className:F(ee.separator),style:te.separator}))})))}),vce=e=>e?y.createElement(av,null):y.createElement(zse,null),yce={click:`onClick`,hover:`onMouseOver`},bce=y.forwardRef((e,t)=>{let{disabled:n,action:r=`click`,visibilityToggle:i=!0,iconRender:a=vce,suffix:o}=e,s=y.useContext(Ql),c=n??s,l=typeof i==`object`&&i.visible!==void 0,[u,d]=(0,y.useState)(()=>l?i.visible:!1),f=(0,y.useRef)(null);y.useEffect(()=>{l&&d(i.visible)},[l,i]);let p=yv(f),m=()=>{if(c)return;u&&p();let e=!u;d(e),typeof i==`object`&&i.onVisibleChange?.(e)},h=e=>{let t=yce[r]||``,n=a(u),i={[t]:m,className:`${e}-icon`,key:`passwordIcon`,onMouseDown:e=>{e.preventDefault()},onMouseUp:e=>{e.preventDefault()}};return y.cloneElement(y.isValidElement(n)?n:y.createElement(`span`,null,n),i)},{className:g,prefixCls:_,inputPrefixCls:v,size:b,...x}=e,{getPrefixCls:S}=y.useContext(dt),C=S(`input`,v),w=S(`input-password`,_),T=i&&h(w),E=F(w,g,{[`${w}-${b}`]:!!b}),D={...De(x,[`suffix`,`iconRender`,`visibilityToggle`]),type:u?`text`:`password`,className:E,prefixCls:C,suffix:y.createElement(y.Fragment,null,T,o)};return b&&(D.size=b),y.createElement(bv,{ref:ie(t,f),...D})}),xce=e=>{let{componentCls:t}=e,n=`${t}-btn`;return{[t]:{width:`100%`,[n]:{"&-filled":{background:e.colorFillTertiary,"&:not(:disabled)":{"&:hover":{background:e.colorFillSecondary},"&:active":{background:e.colorFill}}}}}}},Sce=fo([`Input`,`Search`],e=>[xce(e)]),Cce=y.forwardRef((e,t)=>{let{prefixCls:n,inputPrefixCls:r,className:i,size:a,style:o,enterButton:s=!1,addonAfter:c,loading:l,disabled:u,onSearch:d,onChange:f,onCompositionStart:p,onCompositionEnd:m,variant:h,onPressEnter:g,classNames:_,styles:v,hidden:b,...x}=e,{direction:S,getPrefixCls:C,classNames:w,styles:T}=mt(`inputSearch`),E={...e,enterButton:s},[D,O]=Nc([w,_],[T,v],{props:E},{button:{_default:`root`}}),k=y.useRef(!1),A=C(`input-search`,n),j=C(`input`,r),[M,N]=Sce(A),{compactSize:ee}=pd(A,S),te=ld(e=>a??ee??e),P=y.useRef(null),ne=e=>{e?.target&&e.type===`click`&&d&&d(e.target.value,e,{source:`clear`}),f?.(e)},re=e=>{document.activeElement===P.current?.input&&e.preventDefault()},ae=e=>{d&&d(P.current?.input?.value,e,{source:`input`})},oe=e=>{k.current||l||(g?.(e),ae(e))},se=typeof s==`boolean`?y.createElement(fg,null):null,ce=`${A}-btn`,le=F(ce,{[`${ce}-${h}`]:h}),ue,de=s||{},fe=de.type&&de.type.__ANT_BUTTON===!0;ue=fe||de.type===`button`?Gc(de,{onMouseDown:re,onClick:e=>{de?.props?.onClick?.(e),ae(e)},key:`enterButton`,...fe?{className:le,size:te}:{}}):y.createElement(Yf,{classNames:D.button,styles:O.button,className:le,color:s?`primary`:`default`,size:te,disabled:u,key:`enterButton`,onMouseDown:re,onClick:ae,loading:l,icon:se,variant:h===`borderless`||h===`filled`||h===`underlined`?`text`:s?`solid`:void 0},s),c&&(ue=[ue,Gc(c,{key:`addonAfter`})]);let pe=F(A,N,{[`${A}-rtl`]:S===`rtl`,[`${A}-${te}`]:!!te,[`${A}-with-button`]:!!s},i,M,D.root),me=e=>{k.current=!0,p?.(e)},he=e=>{k.current=!1,m?.(e)},ge=Gs(x,{data:!0}),_e=De({...x,classNames:De(D,[`button`,`root`]),styles:De(O,[`button`,`root`]),prefixCls:j,type:`search`,size:te,variant:h,onPressEnter:oe,onCompositionStart:me,onCompositionEnd:he,onChange:ne,disabled:u},Object.keys(ge));return y.createElement(gd,{className:pe,style:{...o,...O.root},...ge,hidden:b},y.createElement(bv,{ref:ie(P,t),..._e}),ue)}),wce=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,Tce=[`letter-spacing`,`line-height`,`padding-top`,`padding-bottom`,`font-family`,`font-weight`,`font-size`,`font-variant`,`text-rendering`,`text-transform`,`width`,`text-indent`,`padding-left`,`padding-right`,`border-width`,`box-sizing`,`word-break`,`white-space`],Ev={},Dv;function Ece(e,t=!1){let n=e.getAttribute(`id`)||e.getAttribute(`data-reactid`)||e.getAttribute(`name`);if(t&&Ev[n])return Ev[n];let r=window.getComputedStyle(e),i=r.getPropertyValue(`box-sizing`)||r.getPropertyValue(`-moz-box-sizing`)||r.getPropertyValue(`-webkit-box-sizing`),a=parseFloat(r.getPropertyValue(`padding-bottom`))+parseFloat(r.getPropertyValue(`padding-top`)),o=parseFloat(r.getPropertyValue(`border-bottom-width`))+parseFloat(r.getPropertyValue(`border-top-width`)),s={sizingStyle:Tce.map(e=>`${e}:${r.getPropertyValue(e)}`).join(`;`),paddingSize:a,borderSize:o,boxSizing:i};return t&&n&&(Ev[n]=s),s}function Dce(e,t=!1,n=null,r=null){Dv||(Dv=document.createElement(`textarea`),Dv.setAttribute(`tab-index`,`-1`),Dv.setAttribute(`aria-hidden`,`true`),Dv.setAttribute(`name`,`hiddenTextarea`),document.body.appendChild(Dv)),e.getAttribute(`wrap`)?Dv.setAttribute(`wrap`,e.getAttribute(`wrap`)):Dv.removeAttribute(`wrap`);let{paddingSize:i,borderSize:a,boxSizing:o,sizingStyle:s}=Ece(e,t);Dv.setAttribute(`style`,`${s};${wce}`),Dv.value=e.value||e.placeholder||``;let c,l,u,d=Dv.scrollHeight;if(o===`border-box`?d+=a:o===`content-box`&&(d-=i),n!==null||r!==null){Dv.value=` `;let e=Dv.scrollHeight-i;n!==null&&(c=e*n,o===`border-box`&&(c=c+i+a),d=Math.max(c,d)),r!==null&&(l=e*r,o===`border-box`&&(l=l+i+a),u=d>l?``:`hidden`,d=Math.min(l,d))}let f={height:d,overflowY:u,resize:`none`};return c&&(f.minHeight=c),l&&(f.maxHeight=l),f}function Ov(){return Ov=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ov.apply(this,arguments)}var kv=0,Av=1,jv=2,Oce=y.forwardRef((e,t)=>{let{prefixCls:n,defaultValue:r,value:i,autoSize:a,onResize:o,className:s,style:c,disabled:l,onChange:u,onInternalAutoSize:d,...f}=e,[p,m]=O(r,i),h=p??``,g=e=>{m(e.target.value),u?.(e)},_=y.useRef();y.useImperativeHandle(t,()=>({textArea:_.current}));let[v,b]=y.useMemo(()=>a&&typeof a==`object`?[a.minRows,a.maxRows]:[],[a]),x=!!a,[S,C]=y.useState(jv),[w,T]=y.useState(),D=()=>{C(kv)};E(()=>{x&&D()},[i,v,b,x]),E(()=>{if(S===kv)C(Av);else if(S===Av){let e=Dce(_.current,!1,v,b);C(jv),T(e)}},[S]);let k=y.useRef(),A=()=>{lt.cancel(k.current)},j=e=>{S===jv&&(o?.(e),a&&(A(),k.current=lt(()=>{D()})))};y.useEffect(()=>A,[]);let M=x?w:null,N={...c,...M};return(S===kv||S===Av)&&(N.overflowY=`hidden`,N.overflowX=`hidden`),y.createElement(Ye,{onResize:j,disabled:!(a||o)},y.createElement(`textarea`,Ov({},f,{ref:_,style:N,className:F(n,s,{[`${n}-disabled`]:l}),disabled:l,value:h,onChange:g})))});function Mv(){return Mv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Mv.apply(this,arguments)}var kce=y.forwardRef(({defaultValue:e,value:t,onFocus:n,onBlur:r,onChange:i,allowClear:a,maxLength:o,onCompositionStart:s,onCompositionEnd:c,suffix:l,prefixCls:u=`rc-textarea`,showCount:d,count:f,className:p,style:m,disabled:h,hidden:g,classNames:_,styles:v,onResize:b,onClear:x,onPressEnter:S,readOnly:C,autoSize:w,onKeyDown:T,...E},D)=>{let[k,A]=O(e,t),j=k==null?``:String(k),[M,N]=y.useState(!1),ee=y.useRef(!1),[te,P]=y.useState(null),ne=(0,y.useRef)(null),re=(0,y.useRef)(null),ie=()=>re.current?.textArea,ae=()=>{ie().focus()};(0,y.useImperativeHandle)(D,()=>({resizableTextArea:re.current,focus:ae,blur:()=>{ie().blur()},nativeElement:ne.current?.nativeElement||ie()})),(0,y.useEffect)(()=>{N(e=>!h&&e)},[h]);let[oe,se]=y.useState(null);y.useEffect(()=>{oe&&ie().setSelectionRange(...oe)},[oe]);let ce=gv(f,d),le=ce.max??o,ue=Number(le)>0,de=ce.strategy(j),fe=!!le&&de>le,pe=(e,t)=>{let n=t;!ee.current&&ce.exceedFormatter&&ce.max&&ce.strategy(t)>ce.max&&(n=ce.exceedFormatter(t,{max:ce.max}),t!==n&&se([ie().selectionStart||0,ie().selectionEnd||0])),A(n),pv(e.currentTarget,e,i,n)},me=e=>{ee.current=!0,s?.(e)},he=e=>{ee.current=!1,pe(e,e.currentTarget.value),c?.(e)},ge=e=>{pe(e,e.target.value)},_e=e=>{e.key===`Enter`&&S&&!e.nativeEvent.isComposing&&S(e),T?.(e)},ve=e=>{N(!0),n?.(e)},ye=e=>{N(!1),r?.(e)},be=e=>{A(``),ae(),pv(ie(),e,i)},xe=l,Se;ce.show&&(Se=ce.showFormatter?ce.showFormatter({value:j,count:de,maxLength:le}):`${de}${ue?` / ${le}`:``}`,xe=y.createElement(y.Fragment,null,xe,y.createElement(`span`,{className:F(`${u}-data-count`,_?.count),style:v?.count},Se)));let Ce=e=>{b?.(e),ie()?.style.height&&P(!0)},we=!w&&!d&&!a;return y.createElement(hv,{ref:ne,value:j,allowClear:a,handleReset:be,suffix:xe,prefixCls:u,classNames:{..._,affixWrapper:F(_?.affixWrapper,{[`${u}-show-count`]:d,[`${u}-textarea-allow-clear`]:a})},disabled:h,focused:M,className:F(p,fe&&`${u}-out-of-range`),style:{...m,...te&&!we?{height:`auto`}:{}},dataAttrs:{affixWrapper:{"data-count":typeof Se==`string`?Se:void 0}},hidden:g,readOnly:C,onClear:x},y.createElement(Oce,Mv({},E,{autoSize:w,maxLength:o,onKeyDown:_e,onChange:ge,onFocus:ve,onBlur:ye,onCompositionStart:me,onCompositionEnd:he,className:F(_?.textarea),style:{resize:m?.resize,...v?.textarea},disabled:h,prefixCls:u,onResize:Ce,ref:re,readOnly:C})))}),Ace=e=>{let{componentCls:t,paddingLG:n}=e,r=`${t}-textarea`;return{[`textarea${t}`]:{maxWidth:`100%`,height:`auto`,minHeight:e.controlHeight,lineHeight:e.lineHeight,verticalAlign:`bottom`,transition:`all ${e.motionDurationSlow}`,resize:`vertical`,[`&${t}-mouse-active`]:{transition:`all ${e.motionDurationSlow}, height 0s, width 0s`}},[`${t}-textarea-affix-wrapper-resize-dirty`]:{width:`auto`},[r]:{position:`relative`,"&-show-count":{[`${t}-data-count`]:{position:`absolute`,bottom:e.calc(e.fontSize).mul(e.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:e.colorTextDescription,whiteSpace:`nowrap`,pointerEvents:`none`}},[`
        &-allow-clear > ${t},
        &-affix-wrapper${r}-has-feedback ${t}
      `]:{paddingInlineEnd:n},[`&-affix-wrapper${t}-affix-wrapper`]:{padding:0,[`> textarea${t}`]:{fontSize:`inherit`,border:`none`,outline:`none`,background:`transparent`,minHeight:e.calc(e.controlHeight).sub(e.calc(e.lineWidth).mul(2)).equal(),"&:focus":{boxShadow:`none !important`}},[`${t}-suffix`]:{margin:0,"> *:not(:last-child)":{marginInline:0},[`${t}-clear-icon`]:{position:`absolute`,insetInlineEnd:e.paddingInline,insetBlockStart:e.paddingXS},[`${r}-suffix`]:{position:`absolute`,top:0,insetInlineEnd:e.paddingInline,bottom:0,zIndex:1,display:`inline-flex`,alignItems:`center`,margin:`auto`,pointerEvents:`none`}}},[`&-affix-wrapper${t}-affix-wrapper-rtl`]:{[`${t}-suffix`]:{[`${t}-data-count`]:{direction:`ltr`,insetInlineStart:0}}},[`&-affix-wrapper${t}-affix-wrapper-sm`]:{[`${t}-suffix`]:{[`${t}-clear-icon`]:{insetInlineEnd:e.paddingInlineSM}}}}}},jce=fo([`Input`,`TextArea`],e=>Ace(yi(e,N_(e))),P_,{resetFont:!1}),Nv=(0,y.forwardRef)((e,t)=>{let{prefixCls:n,bordered:r=!0,size:i,disabled:a,status:o,allowClear:s,classNames:c,rootClassName:l,className:u,style:d,styles:f,variant:p,showCount:m,onMouseDown:h,onResize:g,..._}=e,{getPrefixCls:v,direction:b,allowClear:x,autoComplete:S,className:C,style:w,classNames:T,styles:E}=mt(`textArea`),D=y.useContext(Ql),O=a??D,{status:k,hasFeedback:A,feedbackIcon:j}=y.useContext(Sm),M=Qh(k,o),[N,ee]=Nc([T,c],[E,f],{props:e}),te=y.useRef(null);y.useImperativeHandle(t,()=>({resizableTextArea:te.current?.resizableTextArea,focus:e=>{Kg(te.current?.resizableTextArea?.textArea,e)},blur:()=>te.current?.blur()}));let P=v(`input`,n),ne=Kc(P),[re,ie]=ooe(P,l);jce(P,ne);let{compactSize:ae,compactItemClassnames:oe}=pd(P,b),se=ld(e=>i??ae??e),[ce,le]=rg(`textArea`,p,r),ue=vv(s??x),[de,fe]=y.useState(!1),[pe,me]=y.useState(!1),he=e=>{fe(!0),h?.(e);let t=()=>{fe(!1),document.removeEventListener(`mouseup`,t)};document.addEventListener(`mouseup`,t)},ge=e=>{if(g?.(e),de&&typeof getComputedStyle==`function`){let e=te.current?.nativeElement?.querySelector(`textarea`);e&&getComputedStyle(e).resize===`both`&&me(!0)}};return y.createElement(kce,{autoComplete:S,..._,style:{...ee.root,...w,...d},styles:ee,disabled:O,allowClear:ue,className:F(ie,ne,u,l,oe,C,N.root,{[`${P}-textarea-affix-wrapper-resize-dirty`]:pe}),classNames:{...N,textarea:F({[`${P}-sm`]:se===`small`,[`${P}-lg`]:se===`large`},re,N.textarea,de&&`${P}-mouse-active`),variant:F({[`${P}-${ce}`]:le},Zh(P,M)),affixWrapper:F(`${P}-textarea-affix-wrapper`,{[`${P}-affix-wrapper-rtl`]:b===`rtl`,[`${P}-affix-wrapper-sm`]:se===`small`,[`${P}-affix-wrapper-lg`]:se===`large`,[`${P}-textarea-show-count`]:m||e.count?.show},re)},prefixCls:P,suffix:A&&y.createElement(`span`,{className:`${P}-textarea-suffix`},j),showCount:m,ref:te,onResize:ge,onMouseDown:he})}),Pv=bv;Pv.Group=fce,Pv.Search=Cce,Pv.TextArea=Nv,Pv.Password=bce,Pv.OTP=_ce;var Mce=Pv;function Nce(e,t,n){return typeof n==`boolean`?n:e.length?!0:Oe(t).some(e=>e.type===gae)}function Fv({suffixCls:e,tagName:t,displayName:n}){return n=>y.forwardRef((r,i)=>y.createElement(n,{ref:i,suffixCls:e,tagName:t,...r}))}var Iv=y.forwardRef((e,t)=>{let{prefixCls:n,suffixCls:r,className:i,tagName:a,...o}=e,{getPrefixCls:s}=y.useContext(dt),c=s(`layout`,n),[l]=uae(c),u=r?`${c}-${r}`:c;return y.createElement(a,{className:F(n||u,i,l),ref:t,...o})}),Pce=y.forwardRef((e,t)=>{let{direction:n}=y.useContext(dt),[r,i]=y.useState([]),{prefixCls:a,className:o,rootClassName:s,children:c,hasSider:l,tagName:u,style:d,...f}=e,p=De(f,[`suffixCls`]),{getPrefixCls:m,className:h,style:g}=mt(`layout`),_=m(`layout`,a),v=Nce(r,c,l),[b,x]=uae(_),S=F(_,{[`${_}-has-sider`]:v,[`${_}-rtl`]:n===`rtl`},h,o,s,b,x),C=y.useMemo(()=>({siderHook:{addSider:e=>{i(t=>[].concat(nt(t),[e]))},removeSider:e=>{i(t=>t.filter(t=>t!==e))}}}),[]);return y.createElement(oae.Provider,{value:C},y.createElement(u,{ref:t,className:S,style:{...g,...d},...p},c))}),Fce=Fv({tagName:`div`,displayName:`Layout`})(Pce),Ice=Fv({suffixCls:`header`,tagName:`header`,displayName:`Header`})(Iv),Lce=Fv({suffixCls:`footer`,tagName:`footer`,displayName:`Footer`})(Iv),Rce=Fv({suffixCls:`content`,tagName:`main`,displayName:`Content`})(Iv),Lv=Fce;Lv.Header=Ice,Lv.Footer=Lce,Lv.Content=Rce,Lv.Sider=gae,Lv._InternalSiderContext=mae;var Rv=Lv,zce=(e,t=!1)=>t&&!gc(e)?[]:Array.isArray(e)?e:[e];const Bce={percent:0,prefixCls:`rc-progress`,strokeColor:`#2db7f5`,strokeLinecap:`round`,strokeWidth:1,railColor:`#D9D9D9`,railWidth:1,gapPosition:`bottom`,loading:!1},Vce=()=>{let e=(0,y.useRef)([]),t=(0,y.useRef)(null);return(0,y.useEffect)(()=>{let n=Date.now(),r=!1;e.current.forEach(e=>{if(!e)return;r=!0;let i=e.style;i.transitionDuration=`.3s, .3s, .3s, .06s`,t.current&&n-t.current<100&&(i.transitionDuration=`0s, 0s`)}),r&&(t.current=Date.now())}),e.current};var zv=({bg:e,children:t})=>y.createElement(`div`,{style:{width:`100%`,height:`100%`,background:e}},t);function Bv(e,t){return Object.keys(e).map(n=>{let r=parseFloat(n),i=`${Math.floor(r*t)}%`;return`${e[n]} ${i}`})}var Hce=y.forwardRef((e,t)=>{let{prefixCls:n,color:r,gradientId:i,radius:a,className:o,style:s,ptg:c,strokeLinecap:l,strokeWidth:u,size:d,gapDegree:f}=e,p=r&&typeof r==`object`,m=p?`#FFF`:void 0,h=d/2,g=y.createElement(`circle`,{className:F(`${n}-circle-path`,o),r:a,cx:h,cy:h,stroke:m,strokeLinecap:l,strokeWidth:u,opacity:c===0?0:1,style:s,ref:t});if(!p)return g;let _=`${i}-conic`,v=f?`${180+f/2}deg`:`0deg`,b=Bv(r,(360-f)/360),x=Bv(r,1),S=`conic-gradient(from ${v}, ${b.join(`, `)})`,C=`linear-gradient(to ${f?`bottom`:`top`}, ${x.join(`, `)})`;return y.createElement(y.Fragment,null,y.createElement(`mask`,{id:_},g),y.createElement(`foreignObject`,{x:0,y:0,width:d,height:d,mask:`url(#${_})`},y.createElement(zv,{bg:C},y.createElement(zv,{bg:S}))))});const Vv=(e,t,n,r,i,a,o,s,c,l,u=0)=>{let d=n/100*360*((360-a)/360),f=a===0?0:{bottom:0,top:180,left:90,right:-90}[o],p=(100-r)/100*t;return c===`round`&&r!==100&&(p+=l/2,p>=t&&(p=t-.01)),{stroke:typeof s==`string`?s:void 0,strokeDasharray:`${t}px ${e}`,strokeDashoffset:p+u,transform:`rotate(${i+d+f}deg)`,transformOrigin:`50px 50px`,transition:`stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s`,fillOpacity:0}};var Uce=(({id:e,loading:t})=>{if(!t)return{indeterminateStyleProps:{},indeterminateStyleAnimation:null};let n=`${e}-indeterminate-animate`;return{indeterminateStyleProps:{transform:`rotate(0deg)`,animation:`${n} 1s linear infinite`},indeterminateStyleAnimation:y.createElement(`style`,null,`@keyframes ${n} {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }`)}});function Hv(){return Hv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Hv.apply(this,arguments)}function Uv(e){let t=e??[];return Array.isArray(t)?t:[t]}var Wce=e=>{let{id:t,prefixCls:n,classNames:r={},styles:i={},steps:a,strokeWidth:o,railWidth:s,gapDegree:c=0,gapPosition:l,railColor:u,strokeLinecap:d,style:f,className:p,strokeColor:m,percent:h,loading:g,..._}={...Bce,...e},v=dl(t),b=`${v}-gradient`,x=50-o/2,S=Math.PI*2*x,C=c>0?90+c/2:-90,w=S*((360-c)/360),{count:T,gap:E}=typeof a==`object`?a:{count:a,gap:2},D=Uv(h),O=Uv(m),k=O.find(e=>e&&typeof e==`object`),A=k&&typeof k==`object`?`butt`:d,{indeterminateStyleProps:j,indeterminateStyleAnimation:M}=Uce({id:v,loading:g}),N=Vv(S,w,0,100,C,c,l,u,A,o),ee=Vce(),te=()=>{let e=0;return D.map((t,a)=>{let s=O[a]||O[O.length-1],u=Vv(S,w,e,t,C,c,l,s,A,o);return e+=t,y.createElement(Hce,{key:a,color:s,ptg:t,radius:x,prefixCls:n,gradientId:b,className:r.track,style:{...u,...j,...i.track},strokeLinecap:A,strokeWidth:o,gapDegree:c,ref:e=>{ee[a]=e},size:100})}).reverse()},P=()=>{let e=Math.round(T*(D[0]/100)),t=100/T,a=0;return Array(T).fill(null).map((s,d)=>{let f=d<=e-1?O[0]:u,p=f&&typeof f==`object`?`url(#${b})`:void 0,m=Vv(S,w,a,t,C,c,l,f,`butt`,o,E);return a+=(w-m.strokeDashoffset+E)*100/w,y.createElement(`circle`,{key:d,className:F(`${n}-circle-path`,r.track),r:x,cx:50,cy:50,stroke:p,strokeWidth:o,opacity:1,style:{...m,...i.track},ref:e=>{ee[d]=e}})})};return y.createElement(`svg`,Hv({className:F(`${n}-circle`,r.root,p),viewBox:`0 0 100 100`,style:{...i.root,...f},id:t,role:`presentation`},_),!T&&y.createElement(`circle`,{className:F(`${n}-circle-rail`,r.rail),r:x,cx:50,cy:50,stroke:u,strokeLinecap:A,strokeWidth:s||o,style:{...N,...i.rail}}),T?P():te(),M)};function Wv(e){return!e||e<0?0:e>100?100:e}function Gv({success:e}){let t;return e&&`percent`in e&&(t=e.percent),t}const Gce=({percent:e,success:t})=>{let n=Wv(Gv({success:t}));return[n,Wv(Wv(e)-n)]},Kce=({success:e={},strokeColor:t})=>{let{strokeColor:n}=e;return[n||ia.green,t||null]},Kv=(e,t,n)=>{let r=-1,i=-1;if(t===`step`){let t=n.steps,a=n.strokeWidth;typeof e==`string`||e===void 0?(r=e===`small`?2:14,i=a??8):typeof e==`number`?[r,i]=[e,e]:[r=14,i=8]=Array.isArray(e)?e:[e.width,e.height],r*=t}else if(t===`line`){let t=n?.strokeWidth;typeof e==`string`||e===void 0?i=t||(e===`small`?6:8):typeof e==`number`?[r,i]=[e,e]:[r=-1,i=8]=Array.isArray(e)?e:[e.width,e.height]}else (t===`circle`||t===`dashboard`)&&(typeof e==`string`||e===void 0?[r,i]=e===`small`?[60,60]:[120,120]:typeof e==`number`?[r,i]=[e,e]:Array.isArray(e)&&(r=e[0]??e[1]??120,i=e[0]??e[1]??120));return[r,i]};var qce=3,Jce=e=>qce/e*100,qv=[`root`,`body`,`indicator`],Yce=e=>{let{prefixCls:t,classNames:n,styles:r,railColor:i,trailColor:a,strokeLinecap:o=`round`,gapPosition:s,gapPlacement:c,gapDegree:l,width:u=120,type:d,children:f,success:p,size:m=u,steps:h}=e,{direction:g}=mt(`progress`),_=i??a,[v,b]=Kv(m,`circle`),{strokeWidth:x}=e;x===void 0&&(x=Math.max(Jce(v),6));let S={width:v,height:b,fontSize:v*.15+6},C=y.useMemo(()=>{if(l||l===0)return l;if(d===`dashboard`)return 75},[l,d]),w=Gce(e),T=y.useMemo(()=>{let e=(c??s)||d===`dashboard`&&`bottom`||void 0,t=g===`rtl`;switch(e){case`start`:return t?`right`:`left`;case`end`:return t?`left`:`right`;default:return e}},[g,c,s,d]),E=Object.prototype.toString.call(e.strokeColor)===`[object Object]`,D=Kce({success:p,strokeColor:e.strokeColor}),O=F(`${t}-body`,{[`${t}-circle-gradient`]:E},n.body),k=y.createElement(Wce,{steps:h,percent:h?w[1]:w,strokeWidth:x,railWidth:x,strokeColor:h?D[1]:D,strokeLinecap:o,railColor:_,prefixCls:t,gapDegree:C,gapPosition:T,classNames:De(n,qv),styles:De(r,qv)}),A=v<=20,j=y.createElement(`div`,{className:O,style:{...S,...r.body}},k,!A&&f);return A?y.createElement(Og,{title:f},j):j};const Jv=`--progress-line-stroke-color`;var Xce=e=>{let t=e?`100%`:`-100%`;return new Br(`antProgress${e?`RTL`:`LTR`}Active`,{"0%":{transform:`translateX(${t}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${t}) scaleX(0)`,opacity:.5},to:{transform:`translateX(0) scaleX(1)`,opacity:0}})},Zce=e=>{let{componentCls:t,iconCls:n}=e;return{[t]:{...no(e),display:`inline-flex`,"&-rtl":{direction:`rtl`},[`${t}-indicator`]:{color:e.colorText,lineHeight:1,whiteSpace:`nowrap`,verticalAlign:`middle`,wordBreak:`normal`,[n]:{fontSize:e.fontSize}},[`&${t}-status-exception`]:{[`${t}-indicator`]:{color:e.colorError}},[`&${t}-status-success`]:{[`${t}-indicator`]:{color:e.colorSuccess}}}}},Qce=e=>{let{componentCls:t}=e;return{[`${t}-line`]:{position:`relative`,width:`100%`,fontSize:e.fontSize,[`${t}-body`]:{display:`inline-flex`,alignItems:`center`,width:`100%`,gap:e.marginXS},[`${t}-rail`]:{flex:`auto`,background:e.remainingColor,borderRadius:e.lineBorderRadius,position:`relative`,width:`100%`},[`&${t}-status-active`]:{[`${t}-track:after`]:{content:`""`,position:`absolute`,inset:0,backgroundColor:e.colorBgContainer,borderRadius:`inherit`,opacity:0,animationName:Xce(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:`infinite`}},[`${t}-track`]:{position:`absolute`,insetInlineStart:0,insetBlock:0,borderRadius:`inherit`,background:e.defaultColor,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`,minWidth:`max-content`,display:`flex`,alignItems:`center`,"&-success":{background:e.colorSuccess}},[`&${t}-status-exception`]:{[`${t}-track`]:{background:e.colorError}},[`&${t}-status-success`]:{[`${t}-track`]:{background:e.colorSuccess}},[`${t}-indicator-outer`]:{[`&${t}-indicator-start`]:{order:-1}},[`${t}-body-layout-bottom`]:{flexDirection:`column`,alignItems:`center`,gap:e.marginXXS},[`${t}-indicator${t}-indicator-inner`]:{color:e.colorWhite,paddingInline:e.paddingXXS,width:`100%`,display:`flex`,justifyContent:`center`,[`&${t}-indicator-end`]:{justifyContent:`end`},[`&${t}-indicator-start`]:{justifyContent:`start`},[`&${t}-indicator-bright`]:{color:`rgba(0, 0, 0, 0.45)`}}}}},$ce=e=>{let{componentCls:t,iconCls:n}=e;return{[`${t}-circle`]:{[`${t}-circle-rail`]:{stroke:e.remainingColor},[`${t}-body:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.defaultColor}},[`${t}-body`]:{position:`relative`,lineHeight:1,backgroundColor:`transparent`},[`${t}-indicator`]:{position:`absolute`,insetBlockStart:`50%`,insetInlineStart:0,width:`100%`,margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:`normal`,textAlign:`center`,transform:`translateY(-50%)`,[n]:{fontSize:e.circleIconFontSize}},[`&${t}-status-exception`]:{[`${t}-body:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorError}}},[`&${t}-status-success`]:{[`${t}-body:not(${t}-circle-gradient)`]:{[`${t}-circle-path`]:{stroke:e.colorSuccess}}}},[`${t}-inline-circle`]:{lineHeight:1,[`${t}-inner`]:{verticalAlign:`bottom`}}}},ele=e=>{let{componentCls:t}=e;return{[t]:{[`${t}-steps`]:{display:`inline-block`,"&-body":{display:`flex`,flexDirection:`row`,alignItems:`center`,gap:e.progressStepMarginInlineEnd,[`${t}-indicator`]:{marginInlineStart:e.marginXS}},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},tle=e=>{let{componentCls:t,iconCls:n}=e;return{[t]:{[`${t}-small&-line, ${t}-small&-line ${t}-indicator ${n}`]:{fontSize:e.fontSizeSM}}}},nle=fo(`Progress`,e=>{let t=e.calc(e.marginXXS).div(2).equal(),n=yi(e,{progressStepMarginInlineEnd:t,progressStepMinWidth:t,progressActiveMotionDuration:`2.4s`});return[Zce(n),Qce(n),$ce(n),ele(n),tle(n)]},e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:`1em`,circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}));const rle=e=>{let t=[];return Object.keys(e).forEach(n=>{let r=Number.parseFloat(n.replace(/%/g,``));Number.isNaN(r)||t.push({key:r,value:e[n]})}),t=t.sort((e,t)=>e.key-t.key),t.map(({key:e,value:t})=>`${t} ${e}%`).join(`, `)},ile=(e,t)=>{let{from:n=ia.blue,to:r=ia.blue,direction:i=t===`rtl`?`to left`:`to right`,...a}=e;if(Object.keys(a).length!==0){let e=`linear-gradient(${i}, ${rle(a)})`;return{background:e,[Jv]:e}}let o=`linear-gradient(${i}, ${n}, ${r})`;return{background:o,[Jv]:o}};var ale=e=>{let{prefixCls:t,classNames:n,styles:r,direction:i,percent:a,size:o,strokeWidth:s,strokeColor:c,strokeLinecap:l=`round`,children:u,railColor:d,trailColor:f,percentPosition:p,success:m}=e,{align:h,type:g}=p,_=d??f,v=l===`square`||l===`butt`?0:void 0,[b,x]=Kv(o??[-1,s||(o===`small`?6:8)],`line`,{strokeWidth:s}),S={backgroundColor:_||void 0,borderRadius:v,height:x},C=`${t}-track`,w=c&&typeof c!=`string`?ile(c,i):{[Jv]:c,background:c},T={width:`${Wv(a)}%`,height:x,borderRadius:v,...w},E=Gv(e),D={width:`${Wv(E)}%`,height:x,borderRadius:v,backgroundColor:m?.strokeColor};return y.createElement(`div`,{className:F(`${t}-body`,n.body,{[`${t}-body-layout-bottom`]:h===`center`&&g===`outer`}),style:{width:b>0?b:`100%`,...r.body}},y.createElement(`div`,{className:F(`${t}-rail`,n.rail),style:{...S,...r.rail}},y.createElement(`div`,{className:F(C,n.track),style:{...T,...r.track}},g===`inner`&&u),E!==void 0&&y.createElement(`div`,{className:F(C,`${C}-success`,n.track),style:{...D,...r.track}})),g===`outer`&&u)},ole=e=>{let{classNames:t,styles:n,size:r,steps:i,rounding:a=Math.round,percent:o=0,strokeWidth:s=8,strokeColor:c,railColor:l,trailColor:u,prefixCls:d,children:f}=e,p=a(i*(o/100)),[m,h]=Kv(r??[r===`small`?2:14,s],`step`,{steps:i,strokeWidth:s}),g=m/i,_=Array.from({length:i}),v=l??u;for(let e=0;e<i;e++){let r=Array.isArray(c)?c[e]:c;_[e]=y.createElement(`div`,{key:e,className:F(`${d}-steps-item`,{[`${d}-steps-item-active`]:e<=p-1},t.track),style:{backgroundColor:e<=p-1?r:v,width:g,height:h,...n.track}})}return y.createElement(`div`,{className:F(`${d}-steps-body`,t.body),style:n.body},_,f)},sle=[`normal`,`exception`,`active`,`success`],cle=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,rootClassName:i,classNames:a,styles:o,steps:s,strokeColor:c,percent:l=0,size:u=`default`,showInfo:d=!0,type:f=`line`,status:p,format:m,style:h,percentPosition:g={},..._}=e,{align:v=`end`,type:b=`outer`}=g,x=Array.isArray(c)?c[0]:c,S=typeof c==`string`||Array.isArray(c)?c:void 0,C=y.useMemo(()=>x?new Gi(typeof x==`string`?x:Object.values(x)[0]).isLight():!1,[c]),w=y.useMemo(()=>{let t=Gv(e);return Number.parseInt(t===void 0?(l??0)?.toString():(t??0)?.toString(),10)},[l,e.success]),T=y.useMemo(()=>!sle.includes(p)&&w>=100?`success`:p||`normal`,[p,w]),{getPrefixCls:E,direction:D,className:O,style:k,classNames:A,styles:j}=mt(`progress`),M=E(`progress`,n),[N,ee]=nle(M),te={...e,percent:l,type:f,size:u,showInfo:d,percentPosition:g},[P,ne]=Nc([A,a],[j,o],{props:te}),re=f===`line`,ie=re&&!s,ae=y.useMemo(()=>{if(!d)return null;let t=Gv(e),n,r=m||(e=>`${e}%`),i=re&&C&&b===`inner`;return b===`inner`||m||T!==`exception`&&T!==`success`?n=r(Wv(l),Wv(t)):T===`exception`?n=re?y.createElement(Go,null):y.createElement(Jo,null):T===`success`&&(n=re?y.createElement(Ho,null):y.createElement(lg,null)),y.createElement(`span`,{className:F(`${M}-indicator`,{[`${M}-indicator-bright`]:i,[`${M}-indicator-${v}`]:ie,[`${M}-indicator-${b}`]:ie},P.indicator),style:ne.indicator,title:typeof n==`string`?n:void 0},n)},[d,l,w,T,f,M,m,re,C,b,v,ie,P.indicator,ne.indicator]),oe={...e,classNames:P,styles:ne},se;f===`line`?se=s?y.createElement(ole,{...oe,strokeColor:S,prefixCls:M,steps:typeof s==`object`?s.count:s},ae):y.createElement(ale,{...oe,strokeColor:x,prefixCls:M,direction:D,percentPosition:{align:v,type:b}},ae):(f===`circle`||f===`dashboard`)&&(se=y.createElement(Yce,{...oe,strokeColor:x,prefixCls:M,progressStatus:T},ae));let ce=F(M,`${M}-status-${T}`,{[`${M}-${f===`dashboard`&&`circle`||f}`]:f!==`line`,[`${M}-inline-circle`]:f===`circle`&&Kv(u,`circle`)[0]<=20,[`${M}-line`]:ie,[`${M}-line-align-${v}`]:ie,[`${M}-line-position-${b}`]:ie,[`${M}-steps`]:s,[`${M}-show-info`]:d,[`${M}-${u}`]:typeof u==`string`,[`${M}-rtl`]:D===`rtl`},O,r,i,P.root,N,ee);return y.createElement(`div`,{ref:t,style:{...k,...ne.root,...h},className:ce,role:`progressbar`,"aria-valuenow":w,"aria-valuemin":0,"aria-valuemax":100,...De(_,[`railColor`,`trailColor`,`strokeWidth`,`width`,`gapDegree`,`gapPosition`,`gapPlacement`,`strokeLinecap`,`success`])},se)}),lle=e=>{let{paddingXXS:t,lineWidth:n,tagPaddingHorizontal:r,componentCls:i,calc:a}=e,o=a(r).sub(n).equal(),s=a(t).sub(n).equal();return{[i]:{...no(e),display:`inline-block`,height:`auto`,paddingInline:o,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:`nowrap`,backgroundColor:e.defaultBg,border:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:`start`,position:`relative`,[`&${i}-rtl`]:{direction:`rtl`},"&, a, a:hover":{color:e.defaultColor},[`${i}-close-icon`]:{marginInlineStart:s,fontSize:e.tagIconSize,color:e.colorIcon,cursor:`pointer`,transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},"&-checkable":{backgroundColor:`transparent`,borderColor:`transparent`,cursor:`pointer`,[`&:not(${i}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive},"&-disabled":{cursor:`not-allowed`,[`&:not(${i}-checkable-checked)`]:{color:e.colorTextDisabled,"&:hover":{backgroundColor:`transparent`}},[`&${i}-checkable-checked`]:{color:e.colorTextDisabled,backgroundColor:e.colorBgContainerDisabled},"&:hover, &:active":{backgroundColor:e.colorBgContainerDisabled,color:e.colorTextDisabled},[`&:not(${i}-checkable-checked):hover`]:{color:e.colorTextDisabled}},"&-group":{display:`flex`,flexWrap:`wrap`,gap:e.paddingXS}},"&-hidden":{display:`none`},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:o}},[`&${e.componentCls}-solid`]:{borderColor:`transparent`,color:e.colorTextLightSolid,backgroundColor:e.colorBgSolid,[`&${i}-default`]:{color:e.solidTextColor}},[`${i}-filled`]:{borderColor:`transparent`,backgroundColor:e.tagBorderlessBg},[`&${i}-disabled`]:{color:e.colorTextDisabled,cursor:`not-allowed`,backgroundColor:e.colorBgContainerDisabled,a:{cursor:`not-allowed`,pointerEvents:`none`,color:e.colorTextDisabled,"&:hover":{color:e.colorTextDisabled}},"a&":{"&:hover, &:active":{color:e.colorTextDisabled}},[`&${i}-outlined`]:{borderColor:e.colorBorderDisabled},[`&${i}-solid, &${i}-filled`]:{color:e.colorTextDisabled,[`${i}-close-icon`]:{color:e.colorTextDisabled}},[`${i}-close-icon`]:{cursor:`not-allowed`,color:e.colorTextDisabled,"&:hover":{color:e.colorTextDisabled}}}}};const Yv=e=>{let{lineWidth:t,fontSizeIcon:n,calc:r}=e,i=e.fontSizeSM;return yi(e,{tagFontSize:i,tagLineHeight:tn(r(e.lineHeightSM).mul(i).equal()),tagIconSize:r(n).sub(r(t).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},Xv=e=>{let t=Af(new Rd(e.colorBgSolid),`#fff`)?`#000`:`#fff`;return{defaultBg:new Gi(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText,solidTextColor:t}};var Zv=fo(`Tag`,e=>lle(Yv(e)),Xv),Qv=y.forwardRef((e,t)=>{let{prefixCls:n,style:r,className:i,checked:a,children:o,icon:s,onChange:c,onClick:l,disabled:u,...d}=e,{getPrefixCls:f,tag:p}=y.useContext(dt),m=y.useContext(Ql),h=u??m,g=e=>{h||(c?.(!a),l?.(e))},_=f(`tag`,n),[v,b]=Zv(_),x=F(_,`${_}-checkable`,{[`${_}-checkable-checked`]:a,[`${_}-checkable-disabled`]:h},p?.className,i,v,b);return y.createElement(`span`,{...d,ref:t,style:{...r,...p?.style},className:x,onClick:g},s,y.createElement(`span`,null,o))});function ule(e,t){let{id:n,prefixCls:r,rootClassName:i,className:a,style:o,classNames:s,styles:c,disabled:l,options:u,value:d,defaultValue:f,onChange:p,multiple:m,...h}=e,{getPrefixCls:g,direction:_,className:v,style:b,classNames:x,styles:S}=mt(`tag`),C=g(`tag`,r),w=`${C}-checkable-group`,[T,E]=Zv(C,Kc(C)),[D,k]=Nc([x,s],[S,c],{props:e}),A=(0,y.useMemo)(()=>(u||[]).map(e=>e&&typeof e==`object`?e:{value:e,label:e}),[u]),[j,M]=O(f,d),N=(e,t)=>{let n=null;if(m){let r=j||[];n=e?[].concat(nt(r),[t.value]):r.filter(e=>e!==t.value)}else n=e?t.value:null;M(n),p?.(n)},ee=y.useRef(null);(0,y.useImperativeHandle)(t,()=>({nativeElement:ee.current}));let te=Gs(h,{aria:!0,data:!0});return y.createElement(`div`,{...te,className:F(w,v,i,{[`${w}-disabled`]:l,[`${w}-rtl`]:_===`rtl`},T,E,a,D.root),style:{...b,...k.root,...o},id:n,ref:ee},A.map(e=>y.createElement(Qv,{key:e.value,className:F(`${w}-item`,D.item),style:k.item,checked:m?(j||[]).includes(e.value):j===e.value,onChange:t=>N(t,e),disabled:l},e.label)))}var dle=y.forwardRef(ule);function fle(e,t){let{color:n,variant:r,bordered:i}=e;return y.useMemo(()=>{let e=n?.endsWith(`-inverse`),a;a=r||(e?`solid`:i===!1?`filled`:t||`filled`);let o=e?n?.replace(`-inverse`,``):n,s=Tg(n),c=xie(n),l={};if(!s&&!c&&o)if(a===`solid`)l.backgroundColor=n;else{let e=new Gi(o).toHsl();e.l=.95,l.backgroundColor=new Gi(e).toHexString(),l.color=n,a===`outlined`&&(l.borderColor=n)}return[a,o,s,c,l]},[n,r,i,t])}var ple=e=>go(e,(t,{textColor:n,lightBorderColor:r,lightColor:i,darkColor:a})=>({[`${e.componentCls}${e.componentCls}-${t}:not(${e.componentCls}-disabled)`]:{[`&${e.componentCls}-outlined`]:{backgroundColor:i,borderColor:r,color:n},[`&${e.componentCls}-solid`]:{backgroundColor:a,borderColor:a,color:e.colorTextLightSolid},[`&${e.componentCls}-filled`]:{backgroundColor:i,color:n}}})),mle=mo([`Tag`,`preset`],e=>ple(Yv(e)),Xv);function hle(e){return typeof e==`string`?e.charAt(0).toUpperCase()+e.slice(1):e}var $v=(e,t,n)=>{let r=hle(n);return{[`${e.componentCls}${e.componentCls}-${t}:not(${e.componentCls}-disabled)`]:{[`&${e.componentCls}-outlined`]:{backgroundColor:e[`color${r}Bg`],borderColor:e[`color${r}Border`],color:e[`color${n}`]},[`&${e.componentCls}-solid`]:{backgroundColor:e[`color${n}`],borderColor:e[`color${n}`]},[`&${e.componentCls}-filled`]:{backgroundColor:e[`color${r}Bg`],color:e[`color${n}`]}}}},gle=mo([`Tag`,`status`],e=>{let t=Yv(e);return[$v(t,`success`,`Success`),$v(t,`processing`,`Info`),$v(t,`error`,`Error`),$v(t,`warning`,`Warning`)]},Xv),ey=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,rootClassName:i,style:a,children:o,icon:s,color:c,variant:l,onClose:u,bordered:d,disabled:f,href:p,target:m,styles:h,classNames:g,..._}=e,{getPrefixCls:v,direction:b,className:x,variant:S,style:C,classNames:w,styles:T}=mt(`tag`),[E,D,O,k,A]=fle(e,S),j=O||k,M=y.useContext(Ql),N=f??M,{tag:ee}=y.useContext(dt),[te,P]=y.useState(!0),ne=De(_,[`closeIcon`,`closable`]),re={...e,color:D,variant:E,disabled:N,href:p,target:m,icon:s},[ie,ae]=Nc([w,g],[T,h],{props:re}),oe=y.useMemo(()=>{let e={...ae.root,...C,...a};return N||(e={...A,...e}),e},[ae.root,C,a,A,N]),se=v(`tag`,n),[ce,le]=Zv(se),ue=F(se,x,ie.root,`${se}-${E}`,{[`${se}-${D}`]:j,[`${se}-hidden`]:!te,[`${se}-rtl`]:b===`rtl`,[`${se}-disabled`]:N},r,i,ce,le),de=e=>{N||(e.stopPropagation(),u?.(e),!e.defaultPrevented&&P(!1))},[,fe]=Cc(_c(e),_c(ee),{closable:!1,closeIconRender:e=>Wc(e,y.createElement(`span`,{className:`${se}-close-icon`,onClick:de},e),e=>({onClick:t=>{e?.onClick?.(t),de(t)},className:F(e?.className,`${se}-close-icon`)}))}),pe=typeof _.onClick==`function`||o&&o.type===`a`,me=Gc(s,{className:F(y.isValidElement(s)?s.props?.className:``,ie.icon),style:ae.icon}),he=me?y.createElement(y.Fragment,null,me,o&&y.createElement(`span`,{className:ie.content,style:ae.content},o)):o,ge=p?`a`:`span`,_e=y.createElement(ge,{...ne,ref:t,className:ue,style:oe,href:N?void 0:p,target:m,onClick:N?void 0:ne.onClick,...p&&N?{"aria-disabled":!0}:{}},he,fe,O&&y.createElement(mle,{key:`preset`,prefixCls:se}),k&&y.createElement(gle,{key:`status`,prefixCls:se}));return pe?y.createElement(cd,{component:`Tag`},_e):_e});ey.CheckableTag=Qv,ey.CheckableTagGroup=dle;var ty=ey,_le=(e,t,n,r)=>{let{titleMarginBottom:i,fontWeightStrong:a}=r;return{marginBottom:i,color:n,fontWeight:a,fontSize:e,lineHeight:t}};const vle=e=>{let t=[1,2,3,4,5],n={};return t.forEach(t=>{n[`
      h${t}&,
      div&-h${t},
      div&-h${t} > textarea,
      h${t}
    `]=_le(e[`fontSizeHeading${t}`],e[`lineHeightHeading${t}`],e.colorTextHeading,e)}),n},yle=e=>{let{componentCls:t}=e;return{"a&, a":{...uo(e),userSelect:`text`,[`&[disabled], &${t}-disabled`]:{color:e.colorTextDisabled,cursor:`not-allowed`,"&:active, &:hover":{color:e.colorTextDisabled},"&:active":{pointerEvents:`none`}}}}},ble=e=>({code:{margin:`0 0.2em`,paddingInline:`0.4em`,paddingBlock:`0.2em 0.1em`,fontSize:`85%`,fontFamily:e.fontFamilyCode,background:`rgba(150, 150, 150, 0.1)`,border:`1px solid rgba(100, 100, 100, 0.2)`,borderRadius:3},kbd:{margin:`0 0.2em`,paddingInline:`0.4em`,paddingBlock:`0.15em 0.1em`,fontSize:`90%`,fontFamily:e.fontFamilyCode,background:`rgba(150, 150, 150, 0.06)`,border:`1px solid rgba(100, 100, 100, 0.2)`,borderBottomWidth:2,borderRadius:3},mark:{padding:0,backgroundColor:ca[2]},"u, ins":{textDecoration:`underline`,textDecorationSkipInk:`auto`},"s, del":{textDecoration:`line-through`},strong:{fontWeight:e.fontWeightStrong},"ul, ol":{marginInline:0,marginBlock:`0 1em`,padding:0,li:{marginInline:`20px 0`,marginBlock:0,paddingInline:`4px 0`,paddingBlock:0}},ul:{listStyleType:`circle`,ul:{listStyleType:`disc`}},ol:{listStyleType:`decimal`},"pre, blockquote":{margin:`1em 0`},pre:{padding:`0.4em 0.6em`,whiteSpace:`pre-wrap`,wordWrap:`break-word`,background:`rgba(150, 150, 150, 0.1)`,border:`1px solid rgba(100, 100, 100, 0.2)`,borderRadius:3,fontFamily:e.fontFamilyCode,code:{display:`inline`,margin:0,padding:0,fontSize:`inherit`,fontFamily:`inherit`,background:`transparent`,border:0}},blockquote:{paddingInline:`0.6em 0`,paddingBlock:0,borderInlineStart:`4px solid rgba(100, 100, 100, 0.2)`,opacity:.85}}),xle=e=>{let{componentCls:t,paddingSM:n}=e,r=n;return{"&-edit-content":{position:`relative`,"div&":{insetInlineStart:e.calc(e.paddingSM).mul(-1).equal(),insetBlockStart:e.calc(r).div(-2).add(1).equal(),marginBottom:e.calc(r).div(2).sub(2).equal()},[`${t}-edit-content-confirm`]:{position:`absolute`,insetInlineEnd:e.calc(e.marginXS).add(2).equal(),insetBlockEnd:e.marginXS,color:e.colorIcon,fontWeight:`normal`,fontSize:e.fontSize,fontStyle:`normal`,pointerEvents:`none`},textarea:{margin:`0!important`,MozTransition:`none`,height:`1em`}}}},Sle=e=>({[`${e.componentCls}-copy-success`]:{"\n    &,\n    &:hover,\n    &:focus":{color:e.colorSuccess}},[`${e.componentCls}-copy-icon-only`]:{marginInlineStart:0}}),Cle=()=>({"\n  a&-ellipsis,\n  span&-ellipsis\n  ":{display:`inline-block`,maxWidth:`100%`},"&-ellipsis-single-line":{whiteSpace:`nowrap`,overflow:`hidden`,textOverflow:`ellipsis`,"a&, span&":{verticalAlign:`bottom`},"> code":{paddingBlock:0,maxWidth:`calc(100% - 1.2em)`,display:`inline-block`,overflow:`hidden`,textOverflow:`ellipsis`,verticalAlign:`bottom`,boxSizing:`content-box`}},"&-ellipsis-multiple-line":{display:`-webkit-box`,overflow:`hidden`,WebkitLineClamp:3,WebkitBoxOrient:`vertical`}});var ny=fo(`Typography`,e=>{let{componentCls:t,titleMarginTop:n}=e;return{[t]:{color:e.colorText,wordBreak:`break-word`,lineHeight:e.lineHeight,[`&${t}-secondary`]:{color:e.colorTextDescription},[`&${t}-success`]:{color:e.colorSuccessText},[`&${t}-warning`]:{color:e.colorWarningText},[`&${t}-danger`]:{color:e.colorErrorText,"a&:active, a&:focus":{color:e.colorErrorTextActive},"a&:hover":{color:e.colorErrorTextHover}},[`&${t}-disabled`]:{color:e.colorTextDisabled,cursor:`not-allowed`,userSelect:`none`},"\n        div&,\n        p\n      ":{marginBottom:`1em`},...vle(e),[`
      & + h1${t},
      & + h2${t},
      & + h3${t},
      & + h4${t},
      & + h5${t}
      `]:{marginTop:n},"\n      div,\n      ul,\n      li,\n      p,\n      h1,\n      h2,\n      h3,\n      h4,\n      h5":{"\n        + h1,\n        + h2,\n        + h3,\n        + h4,\n        + h5\n        ":{marginTop:n}},...ble(e),...yle(e),[`
        ${t}-expand,
        ${t}-collapse,
        ${t}-edit,
        ${t}-copy
      `]:{...uo(e),marginInlineStart:e.marginXXS},...xle(e),...Sle(e),...Cle(),"&-rtl":{direction:`rtl`}}}},()=>({titleMarginTop:`1.2em`,titleMarginBottom:`0.5em`})),wle=e=>{let{prefixCls:t,"aria-label":n,className:r,style:i,direction:a,maxLength:o,autoSize:s=!0,value:c,onSave:l,onCancel:u,onEnd:d,component:f,enterIcon:p=y.createElement(Fse,null)}=e,m=y.useRef(null),h=y.useRef(!1),g=y.useRef(null),[_,v]=y.useState(c);y.useEffect(()=>{v(c)},[c]),y.useEffect(()=>{if(m.current?.resizableTextArea){let{textArea:e}=m.current.resizableTextArea;e.focus();let{length:t}=e.value;e.setSelectionRange(t,t)}},[]);let b=({target:e})=>{v(e.value.replace(/[\n\r]/g,``))},x=()=>{h.current=!0},S=()=>{h.current=!1},C=({keyCode:e})=>{h.current||(g.current=e)},w=()=>{l(_.trim())},T=({keyCode:e,ctrlKey:t,altKey:n,metaKey:r,shiftKey:i})=>{g.current!==e||h.current||t||n||r||i||(e===mu.ENTER?(w(),d?.()):e===mu.ESC&&u())},E=()=>{w()},[D,O]=ny(t),k=F(t,`${t}-edit-content`,{[`${t}-rtl`]:a===`rtl`,[`${t}-${f}`]:!!f},r,D,O);return y.createElement(`div`,{className:k,style:i},y.createElement(Nv,{ref:m,maxLength:o,value:_,onChange:b,onKeyDown:C,onKeyUp:T,onCompositionStart:x,onCompositionEnd:S,onBlur:E,"aria-label":n,rows:1,autoSize:s}),p===null?null:Gc(p,{className:`${t}-edit-content-confirm`}))},Tle=(e,t)=>{let n=!1,r=r=>{r.stopPropagation(),r.preventDefault(),r.clipboardData?.clearData(),r.clipboardData?.setData(`text/plain`,e),t&&r.clipboardData?.setData(`text/html`,e),n=!0};try{return document.addEventListener(`copy`,r,{capture:!0}),document.execCommand(`copy`),n}catch{return!1}finally{document.removeEventListener(`copy`,r,{capture:!0})}},Ele=async(e,t)=>{try{return t?await navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:`text/html`}),"text/plain":new Blob([e],{type:`text/plain`})})]):await navigator.clipboard.writeText(e),!0}catch{return!1}};async function Dle(e,t){if(typeof e!=`string`)return!1;let n=t?.format===`text/html`;return!!(await Ele(e,n)||Tle(e,n))}var Ole=Dle,kle=({copyConfig:e,children:t})=>{let[n,r]=y.useState(!1),[i,a]=y.useState(!1),o=y.useRef(null),s=()=>{o.current&&clearTimeout(o.current)},c={};return e.format&&(c.format=e.format),y.useEffect(()=>s,[]),{copied:n,copyLoading:i,onClick:x(async n=>{n?.preventDefault(),n?.stopPropagation(),a(!0);try{await Ole((typeof e.text==`function`?await e.text():e.text)||zce(t,!0).join(``)||``,c),a(!1),r(!0),s(),o.current=setTimeout(()=>{r(!1)},3e3),e.onCopy?.(n)}catch(e){throw a(!1),e}})}};function ry(e,t){return y.useMemo(()=>{let n=!!e;return[n,{...t,...n&&typeof e==`object`?e:null}]},[e])}var Ale=e=>{let t=(0,y.useRef)(void 0);return(0,y.useEffect)(()=>{t.current=e}),t.current},jle=(e,t,n)=>(0,y.useMemo)(()=>e===!0?{title:t??n}:(0,y.isValidElement)(e)?{title:e}:typeof e==`object`?{title:t??n,...e}:{title:e},[e,t,n]),iy=y.forwardRef((e,t)=>{let{prefixCls:n,component:r=`article`,className:i,rootClassName:a,children:o,direction:s,style:c,...l}=e,{getPrefixCls:u,direction:d,className:f,style:p}=mt(`typography`),m=s??d,h=u(`typography`,n),[g,_]=ny(h),v=F(h,f,{[`${h}-rtl`]:m===`rtl`},i,a,g,_),b={...p,...c};return y.createElement(r,{className:v,style:b,ref:t,...l},o)});function ay(e){return e===!1?[!1,!1]:Array.isArray(e)?e:[e]}function oy(e,t,n){return e===!0||e===void 0?t:e||n&&t}function Mle(e){let t=document.createElement(`em`);e.appendChild(t);let n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return e.removeChild(t),n.left>r.left||r.right>n.right||n.top>r.top||r.bottom>n.bottom}const sy=e=>[`string`,`number`].includes(typeof e);var Nle=({prefixCls:e,copied:t,locale:n,iconOnly:r,tooltips:i,icon:a,tabIndex:o,onCopy:s,loading:c})=>{let l=ay(i),u=ay(a),{copied:d,copy:f}=n??{},p=t?d:f,m=oy(l[t?1:0],p),h=typeof m==`string`?m:p;return y.createElement(Og,{title:m},y.createElement(`button`,{type:`button`,className:F(`${e}-copy`,{[`${e}-copy-success`]:t,[`${e}-copy-icon-only`]:r}),onClick:s,"aria-label":h,tabIndex:o},t?oy(u[1],y.createElement(lg,null),!0):oy(u[0],c?y.createElement(Nu,null):y.createElement(Dse,null),!0)))},cy=y.forwardRef(({style:e,children:t},n)=>{let r=y.useRef(null);return y.useImperativeHandle(n,()=>({isExceed:()=>{let e=r.current;return e.scrollHeight>e.clientHeight},getHeight:()=>r.current.clientHeight})),y.createElement(`span`,{"aria-hidden":!0,ref:r,style:{position:`fixed`,display:`block`,left:0,top:0,pointerEvents:`none`,backgroundColor:`rgba(255, 0, 0, 0.65)`,...e}},t)}),Ple=e=>e.reduce((e,t)=>e+(sy(t)?String(t).length:1),0);function ly(e,t){let n=0,r=[];for(let i=0;i<e.length;i+=1){if(n===t)return r;let a=e[i],o=sy(a)?String(a).length:1,s=n+o;if(s>t){let e=t-n;return r.push(String(a).slice(0,e)),r}r.push(a),n=s}return e}var uy=0,dy=1,fy=2,py=3,my=4,hy={display:`-webkit-box`,overflow:`hidden`,WebkitBoxOrient:`vertical`};function Fle(e){let{enableMeasure:t,width:n,text:r,children:i,rows:a,expanded:o,miscDeps:s,onEllipsis:c}=e,l=y.useMemo(()=>Oe(r),[r]),u=y.useMemo(()=>Ple(l),[r]),d=y.useMemo(()=>i(l,!1),[r]),[f,p]=y.useState(null),m=y.useRef(null),h=y.useRef(null),g=y.useRef(null),_=y.useRef(null),v=y.useRef(null),[b,x]=y.useState(!1),[S,C]=y.useState(uy),[w,T]=y.useState(0),[D,O]=y.useState(null);E(()=>{C(t&&n&&u?dy:uy)},[n,r,a,t,l]),E(()=>{if(S===dy)C(fy),O(h.current&&getComputedStyle(h.current).whiteSpace);else if(S===fy){let e=!!g.current?.isExceed();C(e?py:my),p(e?[0,u]:null),x(e);let t=g.current?.getHeight()||0,n=a===1?0:_.current?.getHeight()||0,r=v.current?.getHeight()||0;T(Math.max(t,n+r)+1),c(e)}},[S]);let k=f?Math.ceil((f[0]+f[1])/2):0;E(()=>{let[e,t]=f||[0,0];if(e!==t){let n=(m.current?.getHeight()||0)>w,r=k;t-e===1&&(r=n?e:t),p(n?[e,r]:[r,t])}},[f,k]);let A=y.useMemo(()=>{if(!t)return i(l,!1);if(S!==py||!f||f[0]!==f[1]){let e=i(l,!1);return[my,uy].includes(S)?e:y.createElement(`span`,{style:{...hy,WebkitLineClamp:a}},e)}return i(o?l:ly(l,f[0]),b)},[o,S,f,l].concat(nt(s))),j={width:n,margin:0,padding:0,whiteSpace:D===`nowrap`?`normal`:`inherit`};return y.createElement(y.Fragment,null,A,S===fy&&y.createElement(y.Fragment,null,y.createElement(cy,{style:{...j,...hy,WebkitLineClamp:a},ref:g},d),y.createElement(cy,{style:{...j,...hy,WebkitLineClamp:a-1},ref:_},d),y.createElement(cy,{style:{...j,...hy,WebkitLineClamp:1},ref:v},i([],!0))),S===py&&f&&f[0]!==f[1]&&y.createElement(cy,{style:{...j,top:400},ref:m},i(ly(l,k),!0)),S===dy&&y.createElement(`span`,{style:{whiteSpace:`inherit`},ref:h}))}var Ile=({enableEllipsis:e,isEllipsis:t,children:n,tooltipProps:r})=>!r?.title||!e?n:y.createElement(Og,{open:t?void 0:!1,...r},n);function Lle({mark:e,code:t,underline:n,delete:r,strong:i,keyboard:a,italic:o},s){let c=s;function l(e,t){t&&(c=y.createElement(e,{},c))}return l(`strong`,i),l(`u`,n),l(`del`,r),l(`code`,t),l(`mark`,e),l(`kbd`,a),l(`i`,o),c}var Rle=`...`,gy=[`delete`,`mark`,`code`,`underline`,`strong`,`keyboard`,`italic`],_y=y.forwardRef((e,t)=>{let{prefixCls:n,className:r,style:i,type:a,disabled:o,children:s,ellipsis:c,editable:l,copyable:u,component:d,title:f,...p}=e,{getPrefixCls:m,direction:h}=y.useContext(dt),[g]=fc(`Text`),_=y.useRef(null),v=y.useRef(null),b=m(`typography`,n),x=De(p,gy),[S,C]=ry(l),[w,T]=O(!1,C.editing),{triggerType:D=[`icon`]}=C,k=e=>{e&&C.onStart?.(),T(e)},A=Ale(w);E(()=>{!w&&A&&v.current?.focus()},[w]);let j=e=>{e?.preventDefault(),k(!0)},M=e=>{C.onChange?.(e),k(!1)},N=()=>{C.onCancel?.(),k(!1)},[ee,te]=ry(u),{copied:P,copyLoading:ne,onClick:re}=kle({copyConfig:te,children:s}),[ae,oe]=y.useState(!1),[se,ce]=y.useState(!1),[le,ue]=y.useState(!1),[de,fe]=y.useState(!1),[pe,me]=y.useState(!0),[he,ge]=ry(c,{expandable:!1,symbol:e=>e?g?.collapse:g?.expand}),[_e,ve]=O(ge.defaultExpanded||!1,ge.expanded),ye=he&&(!_e||ge.expandable===`collapsible`),{rows:be=1}=ge,xe=y.useMemo(()=>ye&&(ge.suffix!==void 0||ge.onEllipsis||ge.expandable||S||ee),[ye,ge,S,ee]);E(()=>{he&&!xe&&(oe(ite(`webkitLineClamp`)),ce(ite(`textOverflow`)))},[xe,he]);let[Se,Ce]=y.useState(ye),we=y.useMemo(()=>xe?!1:be===1?se:ae,[xe,se,ae]);E(()=>{Ce(we&&ye)},[we,ye]);let Te=ye&&(Se?de:le),Ee=ye&&be===1&&Se,ke=ye&&be>1&&Se,Ae=(e,t)=>{ve(t.expanded),ge.onExpand?.(e,t)},[je,Me]=y.useState(0),Ne=({offsetWidth:e})=>{Me(e)},Pe=e=>{ue(e),le!==e&&ge.onEllipsis?.(e)};y.useEffect(()=>{let e=_.current;if(he&&Se&&e){let t=Mle(e);de!==t&&fe(t)}},[he,Se,s,ke,pe,je]),y.useEffect(()=>{let e=_.current;if(typeof IntersectionObserver>`u`||!e||!Se||!ye)return;let t=new IntersectionObserver(()=>{me(!!e.offsetParent)});return t.observe(e),()=>{t.disconnect()}},[Se,ye]);let Fe=jle(ge.tooltip,C.text,s),Ie=y.useMemo(()=>{if(!(!he||Se))return[C.text,s,f,Fe.title].find(sy)},[he,Se,f,Fe.title,Te]);if(w)return y.createElement(wle,{value:C.text??(typeof s==`string`?s:``),onSave:M,onCancel:N,onEnd:C.onEnd,prefixCls:b,className:r,style:i,direction:h,component:d,maxLength:C.maxLength,autoSize:C.autoSize,enterIcon:C.enterIcon});let Le=()=>{let{expandable:e,symbol:t}=ge;return e?y.createElement(`button`,{type:`button`,key:`expand`,className:`${b}-${_e?`collapse`:`expand`}`,onClick:e=>Ae(e,{expanded:!_e}),"aria-label":_e?g.collapse:g?.expand},typeof t==`function`?t(_e):t):null},Re=()=>{if(!S)return;let{icon:e,tooltip:t,tabIndex:n}=C,r=Oe(t)[0]||g?.edit,i=typeof r==`string`?r:``;return D.includes(`icon`)?y.createElement(Og,{key:`edit`,title:t===!1?``:r},y.createElement(`button`,{type:`button`,ref:v,className:`${b}-edit`,onClick:j,"aria-label":i,tabIndex:n},e||y.createElement(Nse,{role:`button`}))):null},ze=()=>ee?y.createElement(Nle,{key:`copy`,...te,prefixCls:b,copied:P,locale:g,onCopy:re,loading:ne,iconOnly:!gc(s)}):null,Be=e=>[e&&Le(),Re(),ze()],Ve=e=>[e&&!_e&&y.createElement(`span`,{"aria-hidden":!0,key:`ellipsis`},Rle),ge.suffix,Be(e)];return y.createElement(Ye,{onResize:Ne,disabled:!ye},c=>y.createElement(Ile,{tooltipProps:Fe,enableEllipsis:ye,isEllipsis:Te},y.createElement(iy,{className:F({[`${b}-${a}`]:a,[`${b}-disabled`]:o,[`${b}-ellipsis`]:he,[`${b}-ellipsis-single-line`]:Ee,[`${b}-ellipsis-multiple-line`]:ke},r),prefixCls:n,style:{...i,WebkitLineClamp:ke?be:void 0},component:d,ref:ie(c,_,t),direction:h,onClick:D.includes(`text`)?j:void 0,"aria-label":Ie?.toString(),title:f,...x},y.createElement(Fle,{enableMeasure:ye&&!Se,text:s,rows:be,width:je,onEllipsis:Pe,expanded:_e,miscDeps:[P,_e,ne,S,ee,g].concat(nt(gy.map(t=>e[t])))},(t,n)=>Lle(e,y.createElement(y.Fragment,null,t.length>0&&n&&!_e&&Ie?y.createElement(`span`,{key:`show-content`,"aria-hidden":!0},t):t,Ve(n)))))))}),zle=y.forwardRef((e,t)=>{let{ellipsis:n,rel:r,children:i,navigate:a,...o}=e,s={...o,rel:r===void 0&&o.target===`_blank`?`noopener noreferrer`:r};return y.createElement(_y,{...s,ref:t,ellipsis:!!n,component:`a`},i)}),Ble=y.forwardRef((e,t)=>{let{children:n,...r}=e;return y.createElement(_y,{ref:t,...r,component:`div`},n)}),Vle=y.forwardRef((e,t)=>{let{ellipsis:n,children:r,...i}=e,a=y.useMemo(()=>n&&typeof n==`object`?De(n,[`expandable`,`rows`]):n,[n]);return y.createElement(_y,{ref:t,...i,ellipsis:a,component:`span`},r)}),Hle=[1,2,3,4,5],Ule=y.forwardRef((e,t)=>{let{level:n=1,children:r,...i}=e,a=Hle.includes(n)?`h${n}`:`h1`;return y.createElement(_y,{ref:t,...i,component:a},r)}),vy=iy;vy.Text=Vle,vy.Link=zle,vy.Title=Ule,vy.Paragraph=Ble;var Wle=vy,Gle=((e,t)=>{if(e&&t){let n=Array.isArray(t)?t:t.split(`,`),r=e.name||``,i=e.type||``,a=i.replace(/\/.*$/,``);return n.some(e=>{let t=e.trim();if(/^\*(\/\*)?$/.test(e))return!0;if(t.charAt(0)===`.`){let e=r.toLowerCase(),n=t.toLowerCase(),i=[n];return(n===`.jpg`||n===`.jpeg`)&&(i=[`.jpg`,`.jpeg`]),i.some(t=>e.endsWith(t))}return/\/\*$/.test(t)?a===t.replace(/\/.*$/,``):i===t?!0:/^\w+$/.test(t)?(Ee(!1,`Upload takes an invalidate 'accept' type '${t}'.Skip for check.`),!0):!1})}return!0});function Kle(e,t){let n=`cannot ${e.method} ${e.action} ${t.status}'`,r=Error(n);return r.status=t.status,r.method=e.method,r.url=e.action,r}function yy(e){let t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch{return t}}function by(e){let t=new XMLHttpRequest;e.onProgress&&t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});let n=new FormData;e.data&&Object.keys(e.data).forEach(t=>{let r=e.data[t];if(Array.isArray(r)){r.forEach(e=>{n.append(`${t}[]`,e)});return}n.append(t,r)}),e.file instanceof Blob?n.append(e.filename,e.file,e.file.name):n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){return t.status<200||t.status>=300?e.onError(Kle(e,t),yy(t)):e.onSuccess(yy(t),t)},t.open(e.method,e.action,!0),e.withCredentials&&`withCredentials`in t&&(t.withCredentials=!0);let r=e.headers||{};return r[`X-Requested-With`]!==null&&t.setRequestHeader(`X-Requested-With`,`XMLHttpRequest`),Object.keys(r).forEach(e=>{r[e]!==null&&t.setRequestHeader(e,r[e])}),t.send(n),{abort(){t.abort()}}}var qle=async(e,t)=>{let n=[],r=[];e.forEach(e=>r.push(e.webkitGetAsEntry()));async function i(e){let t=e.createReader(),n=[];for(;;){let e=await new Promise(e=>{t.readEntries(e,()=>e([]))}),r=e.length;if(!r)break;for(let t=0;t<r;t++)n.push(e[t])}return n}async function a(e){return new Promise(n=>{e.file(r=>{t(r)?(e.fullPath&&!r.webkitRelativePath&&(Object.defineProperties(r,{webkitRelativePath:{writable:!0}}),r.webkitRelativePath=e.fullPath.replace(/^\//,``),Object.defineProperties(r,{webkitRelativePath:{writable:!1}})),n(r)):n(null)})})}let o=async(e,t)=>{if(e){if(e.path=t||``,e.isFile){let t=await a(e);t&&n.push(t)}else if(e.isDirectory){let t=await i(e);r.push(...t)}}},s=0;for(;s<r.length;)await o(r[s]),s++;return n},Jle=+new Date,Yle=0;function xy(){return`rc-upload-${Jle}-${++Yle}`}function Sy(){return Sy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Sy.apply(this,arguments)}var Xle=class extends y.Component{state={uid:xy()};reqs={};fileInput;_isMounted;filterFile=(e,t=!1)=>{let{accept:n,directory:r}=this.props,i,a;if(typeof n==`string`)a=n;else{let{filter:e,format:t}=n||{};a=t,i=e===`native`?()=>!0:e}return(i||(r||t?e=>Gle(e,a):()=>!0))(e)};onChange=e=>{let{files:t}=e.target,n=[...t].filter(e=>this.filterFile(e));this.uploadFiles(n),this.reset()};onClick=e=>{let t=this.fileInput;if(!t)return;let n=e.target,{onClick:r}=this.props;n&&n.tagName===`BUTTON`&&(t.parentNode.focus(),n.blur()),t.click(),r&&r(e)};onKeyDown=e=>{e.key===`Enter`&&this.onClick(e)};onDataTransferFiles=async(e,t)=>{let{multiple:n,directory:r}=this.props,i=[...e.items||[]],a=[...e.files||[]];if((a.length>0||i.some(e=>e.kind===`file`))&&t?.(),r)a=await qle(Array.prototype.slice.call(i),this.filterFile),this.uploadFiles(a);else{let e=[...a].filter(e=>this.filterFile(e,!0));n===!1&&(e=a.slice(0,1)),this.uploadFiles(e)}};onFilePaste=async e=>{let{pastable:t}=this.props;if(t&&e.type===`paste`){let t=e.clipboardData;return this.onDataTransferFiles(t,()=>{e.preventDefault()})}};onFileDragOver=e=>{e.preventDefault()};onFileDrop=async e=>{if(e.preventDefault(),e.type===`drop`){let t=e.dataTransfer;return this.onDataTransferFiles(t)}};componentDidMount(){this._isMounted=!0;let{pastable:e}=this.props;e&&document.addEventListener(`paste`,this.onFilePaste)}componentWillUnmount(){this._isMounted=!1,this.abort(),document.removeEventListener(`paste`,this.onFilePaste)}componentDidUpdate(e){let{pastable:t}=this.props;t&&!e.pastable?document.addEventListener(`paste`,this.onFilePaste):!t&&e.pastable&&document.removeEventListener(`paste`,this.onFilePaste)}uploadFiles=e=>{let t=[...e],n=t.map(e=>(e.uid=xy(),this.processFile(e,t)));Promise.all(n).then(e=>{let{onBatchStart:t}=this.props;t?.(e.map(({origin:e,parsedFile:t})=>({file:e,parsedFile:t}))),e.filter(e=>e.parsedFile!==null).forEach(e=>{this.post(e)})})};processFile=async(e,t)=>{let{beforeUpload:n}=this.props,r=e;if(n){try{r=await n(e,t)}catch{r=!1}if(r===!1)return{origin:e,parsedFile:null,action:null,data:null}}let{action:i}=this.props,a;a=typeof i==`function`?await i(e):i;let{data:o}=this.props,s;s=typeof o==`function`?await o(e):o;let c=(typeof r==`object`||typeof r==`string`)&&r?r:e,l;l=c instanceof File?c:new File([c],e.name,{type:e.type});let u=l;return u.uid=e.uid,{origin:e,data:s,parsedFile:u,action:a}};post({data:e,origin:t,action:n,parsedFile:r}){if(!this._isMounted)return;let{onStart:i,customRequest:a,name:o,headers:s,withCredentials:c,method:l}=this.props,{uid:u}=t,d=a||by,f={action:n,filename:o,data:e,file:r,headers:s,withCredentials:c,method:l||`post`,onProgress:e=>{let{onProgress:t}=this.props;t?.(e,r)},onSuccess:(e,t)=>{let{onSuccess:n}=this.props;n?.(e,r,t),delete this.reqs[u]},onError:(e,t)=>{let{onError:n}=this.props;n?.(e,t,r),delete this.reqs[u]}};i(t),this.reqs[u]=d(f,{defaultRequest:by})}reset(){this.setState({uid:xy()})}abort(e){let{reqs:t}=this;if(e){let n=e.uid?e.uid:e;t[n]&&t[n].abort&&t[n].abort(),delete t[n]}else Object.keys(t).forEach(e=>{t[e]&&t[e].abort&&t[e].abort(),delete t[e]})}saveFileInput=e=>{this.fileInput=e};render(){let{component:e,prefixCls:t,className:n,classNames:r={},disabled:i,id:a,name:o,style:s,styles:c={},multiple:l,accept:u,capture:d,children:f,directory:p,openFileDialogOnClick:m,onMouseEnter:h,onMouseLeave:g,hasControlInside:_,...v}=this.props,b=typeof u==`string`?u:u?.format,x=F(t,{[`${t}-disabled`]:i,[n]:n}),S=p?{directory:`directory`,webkitdirectory:`webkitdirectory`}:{},C=i?{}:{onClick:m?this.onClick:()=>{},onKeyDown:m?this.onKeyDown:()=>{},onMouseEnter:h,onMouseLeave:g,onDrop:this.onFileDrop,onDragOver:this.onFileDragOver,tabIndex:_?void 0:`0`};return y.createElement(e,Sy({},C,{className:x,role:_?void 0:`button`,style:s}),y.createElement(`input`,Sy({},Gs(v,{aria:!0,data:!0}),{id:a,name:o,disabled:i,type:`file`,ref:this.saveFileInput,onClick:e=>e.stopPropagation(),key:this.state.uid,style:{display:`none`,...c.input},className:r.input,accept:b},S,{multiple:l,onChange:this.onChange},d==null?{}:{capture:d})),f)}};function Cy(){return Cy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Cy.apply(this,arguments)}function wy(){}var Ty=class extends y.Component{static defaultProps={component:`span`,prefixCls:`rc-upload`,data:{},headers:{},name:`file`,multipart:!1,onStart:wy,onError:wy,onSuccess:wy,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1};uploader;abort(e){this.uploader.abort(e)}saveUploader=e=>{this.uploader=e};render(){return y.createElement(Xle,Cy({},this.props,{ref:this.saveUploader}))}},Zle=e=>{let{componentCls:t,iconCls:n}=e;return{[`${t}-wrapper`]:{[`${t}-drag`]:{position:`relative`,width:`100%`,height:`100%`,textAlign:`center`,background:e.colorFillAlter,border:`${tn(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:`pointer`,transition:`border-color ${e.motionDurationSlow}`,[t]:{padding:e.padding},[`${t}-btn`]:{display:`table`,width:`100%`,height:`100%`,outline:`none`,borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${tn(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${t}-drag-container`]:{display:`table-cell`,verticalAlign:`middle`},[`
          &:not(${t}-disabled):hover,
          &-hover:not(${t}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${t}-drag-icon`]:{marginBottom:e.margin,[n]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${t}-text`]:{margin:`0 0 ${tn(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${t}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${t}-disabled`]:{[`p${t}-drag-icon ${n},
            p${t}-text,
            p${t}-hint
          `]:{color:e.colorTextDisabled}}}}}},Qle=e=>{let{componentCls:t,iconCls:n,fontSize:r,lineHeight:i,calc:a}=e,o=`${t}-list-item`,s=`${o}-actions`,c=`${o}-action`;return{[`${t}-wrapper`]:{[`${t}-list`]:{...io(),lineHeight:e.lineHeight,[o]:{position:`relative`,height:a(e.lineHeight).mul(r).equal(),marginTop:e.marginXS,fontSize:r,display:`flex`,alignItems:`center`,transition:`background-color ${e.motionDurationSlow}`,borderRadius:e.borderRadiusSM,"&:hover":{backgroundColor:e.controlItemBgHover},[`${o}-name`]:{...to,padding:`0 ${tn(e.paddingXS)}`,lineHeight:i,flex:`auto`,transition:`all ${e.motionDurationSlow}`},[s]:{whiteSpace:`nowrap`,[c]:{opacity:0},[n]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${c}:focus-visible,
              &.picture ${c}
            `]:{opacity:1}},[`${t}-icon ${n}`]:{color:e.colorIcon,fontSize:r},[`${o}-progress`]:{position:`absolute`,bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:`100%`,paddingInlineStart:a(r).add(e.paddingXS).equal(),fontSize:r,lineHeight:0,pointerEvents:`none`,"> div":{margin:0}}},[`${o}:hover ${c}`]:{opacity:1},[`${o}-error`]:{color:e.colorError,[`${o}-name, ${t}-icon ${n}`]:{color:e.colorError},[s]:{[`${n}, ${n}:hover`]:{color:e.colorError},[c]:{opacity:1}}},[`${t}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:`table`,width:0,height:0,content:`""`}}}}}},$le=e=>{let{componentCls:t}=e,n=new Br(`uploadAnimateInlineIn`,{from:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),r=new Br(`uploadAnimateInlineOut`,{to:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),i=`${t}-animate-inline`;return[{[`${t}-wrapper`]:{[`${i}-appear, ${i}-enter, ${i}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:`forwards`},[`${i}-appear, ${i}-enter`]:{animationName:n},[`${i}-leave`]:{animationName:r}}},{[`${t}-wrapper`]:Yd(e)},n,r]},eue=e=>{let{componentCls:t,iconCls:n,uploadThumbnailSize:r,uploadProgressOffset:i,calc:a}=e,o=`${t}-list`,s=`${o}-item`;return{[`${t}-wrapper`]:{[`
        ${o}${o}-picture,
        ${o}${o}-picture-card,
        ${o}${o}-picture-circle
      `]:{[s]:{position:`relative`,height:a(r).add(a(e.lineWidth).mul(2)).add(a(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${tn(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:`transparent`},[`${s}-thumbnail`]:{...to,width:r,height:r,lineHeight:tn(a(r).add(e.paddingSM).equal()),textAlign:`center`,flex:`none`,[n]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:`block`,width:`100%`,height:`100%`,overflow:`hidden`}},[`${s}-progress`]:{bottom:i,width:`calc(100% - ${tn(a(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:a(r).add(e.paddingXS).equal()}},[`${s}-error`]:{borderColor:e.colorError,[`${s}-thumbnail ${n}`]:{[`svg path[fill='${pa[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${pa.primary}']`]:{fill:e.colorError}}},[`${s}-uploading`]:{borderStyle:`dashed`,[`${s}-name`]:{marginBottom:i}}},[`${o}${o}-picture-circle ${s}`]:{[`&, &::before, ${s}-thumbnail`]:{borderRadius:`50%`}}}}},tue=e=>{let{componentCls:t,iconCls:n,fontSizeLG:r,colorTextLightSolid:i,calc:a}=e,o=`${t}-list`,s=`${o}-item`,c=e.uploadPicCardSize;return{[`
      ${t}-wrapper${t}-picture-card-wrapper,
      ${t}-wrapper${t}-picture-circle-wrapper
    `]:{...io(),display:`block`,[`${t}${t}-select`]:{width:c,height:c,textAlign:`center`,verticalAlign:`top`,backgroundColor:e.colorFillAlter,border:`${tn(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:`pointer`,transition:`border-color ${e.motionDurationSlow}`,[`> ${t}`]:{display:`flex`,alignItems:`center`,justifyContent:`center`,height:`100%`,textAlign:`center`},[`&:not(${t}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${o}${o}-picture-card, ${o}${o}-picture-circle`]:{display:`flex`,flexWrap:`wrap`,"@supports not (gap: 1px)":{"& > *":{marginBlockEnd:e.marginXS,marginInlineEnd:e.marginXS}},"@supports (gap: 1px)":{gap:e.marginXS},[`${o}-item-container`]:{display:`inline-block`,width:c,height:c,verticalAlign:`top`},"&::after":{display:`none`},"&::before":{display:`none`},[s]:{height:`100%`,margin:0,"&::before":{position:`absolute`,zIndex:1,width:`calc(100% - ${tn(a(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${tn(a(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:`" "`}},[`${s}:hover`]:{[`&::before, ${s}-actions`]:{opacity:1}},[`${s}-actions`]:{position:`absolute`,insetInlineStart:0,zIndex:10,width:`100%`,whiteSpace:`nowrap`,textAlign:`center`,opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${n}-eye,
            ${n}-download,
            ${n}-delete
          `]:{zIndex:10,width:r,margin:`0 ${tn(e.marginXXS)}`,fontSize:r,cursor:`pointer`,transition:`all ${e.motionDurationSlow}`,color:i,"&:hover":{color:i},svg:{verticalAlign:`baseline`}}},[`${s}-thumbnail, ${s}-thumbnail img`]:{position:`static`,display:`block`,width:`100%`,height:`100%`,objectFit:`contain`},[`${s}-name`]:{display:`none`,textAlign:`center`},[`${s}-file + ${s}-name`]:{position:`absolute`,bottom:e.margin,display:`block`,width:`calc(100% - ${tn(a(e.paddingXS).mul(2).equal())})`},[`${s}-uploading`]:{[`&${s}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${n}-eye, ${n}-download, ${n}-delete`]:{display:`none`}},[`${s}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${tn(a(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}},[`${t}-wrapper${t}-picture-circle-wrapper`]:{[`${t}${t}-select`]:{borderRadius:`50%`}}}},nue=e=>{let{componentCls:t}=e;return{[`${t}-rtl`]:{direction:`rtl`}}},rue=e=>{let{componentCls:t,colorTextDisabled:n}=e;return{[`${t}-wrapper`]:{...no(e),[t]:{outline:0,"input[type='file']":{cursor:`pointer`}},[`${t}-select`]:{display:`inline-block`},[`${t}-hidden`]:{display:`none`},[`${t}-disabled`]:{color:n,cursor:`not-allowed`}}}},iue=fo(`Upload`,e=>{let{fontSizeHeading3:t,fontHeight:n,lineWidth:r,pictureCardSize:i,calc:a}=e,o=yi(e,{uploadThumbnailSize:a(t).mul(2).equal(),uploadProgressOffset:a(a(n).div(2)).add(r).equal(),uploadPicCardSize:i});return[rue(o),Zle(o),eue(o),tue(o),Qle(o),$le(o),nue(o),Ud(o)]},e=>({actionsColor:e.colorIcon,pictureCardSize:e.controlHeightLG*2.55}));function Ey(e){return{...e,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e}}function Dy(e,t){let n=nt(t),r=n.findIndex(({uid:t})=>t===e.uid);return r===-1?n.push(e):n[r]=e,n}function Oy(e,t){let n=e.uid===void 0?`name`:`uid`;return t.filter(t=>t[n]===e[n])[0]}function aue(e,t){let n=e.uid===void 0?`name`:`uid`,r=t.filter(t=>t[n]!==e[n]);return r.length===t.length?null:r}var oue=(e=``)=>{let t=e.split(`/`),n=t[t.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(n)||[``])[0]},ky=e=>e.indexOf(`image/`)===0;const sue=e=>{if(e.type&&!e.thumbUrl)return ky(e.type);let t=e.thumbUrl||e.url||``,n=oue(t);return/^data:image\//.test(t)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(n)?!0:!(/^data:/.test(t)||n)};var Ay=200;function cue(e){return new Promise(t=>{if(!e.type||!ky(e.type)){t(``);return}let n=document.createElement(`canvas`);n.width=Ay,n.height=Ay,n.style.cssText=`position: fixed; left: 0; top: 0; width: ${Ay}px; height: ${Ay}px; z-index: 9999; display: none;`,document.body.appendChild(n);let r=n.getContext(`2d`),i=new Image;if(i.onload=()=>{let{width:e,height:a}=i,o=Ay,s=Ay,c=0,l=0;e>a?(s=a*(Ay/e),l=-(s-o)/2):(o=e*(Ay/a),c=-(o-s)/2),r.drawImage(i,c,l,o,s);let u=n.toDataURL();document.body.removeChild(n),window.URL.revokeObjectURL(i.src),t(u)},i.crossOrigin=`anonymous`,e.type.startsWith(`image/svg+xml`)){let t=new FileReader;t.onload=()=>{t.result&&typeof t.result==`string`&&(i.src=t.result)},t.readAsDataURL(e)}else if(e.type.startsWith(`image/gif`)){let n=new FileReader;n.onload=()=>{n.result&&t(n.result)},n.readAsDataURL(e)}else i.src=window.URL.createObjectURL(e)})}var lue=y.forwardRef(({prefixCls:e,className:t,style:n,classNames:r,styles:i,locale:a,listType:o,file:s,items:c,progress:l,iconRender:u,actionIconRender:d,itemRender:f,isImgUrl:p,showPreviewIcon:m,showRemoveIcon:h,showDownloadIcon:g,previewIcon:_,removeIcon:v,downloadIcon:b,extra:x,onPreview:S,onDownload:C,onClose:w},T)=>{let{status:E}=s,[D,O]=y.useState(E);y.useEffect(()=>{E!==`removed`&&O(E)},[E]);let[k,A]=y.useState(!1);y.useEffect(()=>{let e=setTimeout(()=>{A(!0)},300);return()=>{clearTimeout(e)}},[]);let j=u(s),M=y.createElement(`div`,{className:`${e}-icon`},j);if(o===`picture`||o===`picture-card`||o===`picture-circle`)if(D===`uploading`||!s.thumbUrl&&!s.url){let t=F(`${e}-list-item-thumbnail`,{[`${e}-list-item-file`]:D!==`uploading`});M=y.createElement(`div`,{className:t},j)}else{let t=p?.(s)?y.createElement(`img`,{src:s.thumbUrl||s.url,alt:s.name,className:`${e}-list-item-image`,crossOrigin:s.crossOrigin}):j,n=F(`${e}-list-item-thumbnail`,{[`${e}-list-item-file`]:p&&!p(s)});M=y.createElement(`a`,{className:n,onClick:e=>S(s,e),href:s.url||s.thumbUrl,target:`_blank`,rel:`noopener noreferrer`},t)}let N=F(`${e}-list-item`,`${e}-list-item-${D}`,r?.item),ee=typeof s.linkProps==`string`?JSON.parse(s.linkProps):s.linkProps,te=(typeof h==`function`?h(s):h)?d((typeof v==`function`?v(s):v)||y.createElement(kse,null),()=>w(s),e,a.removeFile,!0):null,P=(typeof g==`function`?g(s):g)&&D===`done`?d((typeof b==`function`?b(s):b)||y.createElement(jse,null),()=>C(s),e,a.downloadFile):null,ne=o!==`picture-card`&&o!==`picture-circle`&&y.createElement(`span`,{key:`download-delete`,className:F(`${e}-list-item-actions`,{picture:o===`picture`})},P,te),re=typeof x==`function`?x(s):x,ie=re&&y.createElement(`span`,{className:`${e}-list-item-extra`},re),ae=F(`${e}-list-item-name`),oe=s.url?y.createElement(`a`,{key:`view`,target:`_blank`,rel:`noopener noreferrer`,className:ae,title:s.name,...ee,href:s.url,onClick:e=>S(s,e)},s.name,ie):y.createElement(`span`,{key:`view`,className:ae,onClick:e=>S(s,e),title:s.name},s.name,ie),se=(typeof m==`function`?m(s):m)&&(s.url||s.thumbUrl)?y.createElement(`a`,{href:s.url||s.thumbUrl,target:`_blank`,rel:`noopener noreferrer`,onClick:e=>S(s,e),title:a.previewFile},typeof _==`function`?_(s):_||y.createElement(av,null)):null,ce=(o===`picture-card`||o===`picture-circle`)&&D!==`uploading`&&y.createElement(`span`,{className:`${e}-list-item-actions`},se,D===`done`&&P,te),{getPrefixCls:le}=y.useContext(dt),ue=le(),de=y.createElement(`div`,{className:N,style:i?.item},M,oe,ne,ce,k&&y.createElement(Bs,{motionName:`${ue}-fade`,visible:D===`uploading`,motionDeadline:2e3},({className:t})=>{let n=`percent`in s?y.createElement(cle,{type:`line`,percent:s.percent,"aria-label":s[`aria-label`],"aria-labelledby":s[`aria-labelledby`],...l}):null;return y.createElement(`div`,{className:F(`${e}-list-item-progress`,t)},n)})),fe=s.response&&typeof s.response==`string`?s.response:s.error?.statusText||s.error?.message||a.uploadError,pe=D===`error`?y.createElement(Og,{title:fe,getPopupContainer:e=>e.parentNode},de):de;return y.createElement(`div`,{className:F(`${e}-list-item-container`,t),style:n,ref:T},f?f(pe,s,c,{download:C.bind(null,s),preview:S.bind(null,s),remove:w.bind(null,s)}):pe)}),uue=y.forwardRef((e,t)=>{let{listType:n=`text`,previewFile:r=cue,onPreview:i,onDownload:a,onRemove:o,locale:s,iconRender:c,isImageUrl:l=sue,prefixCls:u,items:d=[],showPreviewIcon:f=!0,showRemoveIcon:p=!0,showDownloadIcon:m=!1,removeIcon:h,previewIcon:g,downloadIcon:_,extra:v,progress:b={size:[-1,2],showInfo:!1},appendAction:x,appendActionVisible:S=!0,itemRender:C,disabled:w,classNames:T,styles:E}=e,[,D]=wc(),[O,k]=y.useState(!1),A=[`picture-card`,`picture-circle`].includes(n);y.useEffect(()=>{n.startsWith(`picture`)&&(d||[]).forEach(e=>{!(e.originFileObj instanceof File||e.originFileObj instanceof Blob)||e.thumbUrl!==void 0||(e.thumbUrl=``,r?.(e.originFileObj).then(t=>{e.thumbUrl=t||``,D()}))})},[n,d,r]),y.useEffect(()=>{k(!0)},[]);let j=(e,t)=>{if(i)return t?.preventDefault(),i(e)},M=e=>{typeof a==`function`?a(e):e.url&&window.open(e.url)},N=e=>{o?.(e)},ee=e=>{if(c)return c(e,n);let t=e.status===`uploading`;if(n.startsWith(`picture`)){let r=n===`picture`?y.createElement(Nu,null):s.uploading,i=l?.(e)?y.createElement(Xse,null):y.createElement(Hse,null);return t?r:i}return t?y.createElement(Nu,null):y.createElement(Kse,null)},te=(e,t,n,r,i)=>{let a={type:`text`,size:`small`,title:r,onClick:n=>{t(),y.isValidElement(e)&&e.props.onClick?.(n)},className:`${n}-list-item-action`,disabled:i?w:!1};return y.isValidElement(e)?y.createElement(Yf,{...a,icon:Gc(e,{...e.props,onClick:()=>{}})}):y.createElement(Yf,{...a},y.createElement(`span`,null,e))};y.useImperativeHandle(t,()=>({handlePreview:j,handleDownload:M}));let{getPrefixCls:P}=y.useContext(dt),ne=P(`upload`,u),re=P(),ie=F(`${ne}-list`,`${ne}-list-${n}`,T?.list),ae=y.useMemo(()=>De(ed(re),[`onAppearEnd`,`onEnterEnd`,`onLeaveEnd`]),[re]),oe={...A?{}:ae,motionDeadline:2e3,motionName:`${ne}-${A?`animate-inline`:`animate`}`,keys:nt(d.map(e=>({key:e.uid,file:e}))),motionAppear:O};return y.createElement(`div`,{className:ie,style:E?.list},y.createElement(zs,{...oe,component:!1},({key:e,file:t,className:r,style:i})=>y.createElement(lue,{key:e,locale:s,prefixCls:ne,className:r,style:i,classNames:T,styles:E,file:t,items:d,progress:b,listType:n,isImgUrl:l,showPreviewIcon:f,showRemoveIcon:p,showDownloadIcon:m,removeIcon:h,previewIcon:g,downloadIcon:_,extra:v,iconRender:ee,actionIconRender:te,itemRender:C,onPreview:j,onDownload:M,onClose:N})),x&&y.createElement(Bs,{...oe,visible:S,forceRender:!0},({className:e,style:t})=>Gc(x,n=>({className:F(n.className,e),style:{...t,pointerEvents:e?`none`:void 0,...n.style}}))))}),jy=h();const My=`__LIST_IGNORE_${Date.now()}__`;var Ny=y.forwardRef((e,t)=>{let n=mt(`upload`),{fileList:r,defaultFileList:i,onRemove:a,showUploadList:o=!0,listType:s=`text`,onPreview:c,onDownload:l,onChange:u,onDrop:d,previewFile:f,disabled:p,locale:m,iconRender:h,isImageUrl:g,progress:_,prefixCls:v,className:b,type:x=`select`,children:S,style:C,itemRender:w,maxCount:T,data:E={},multiple:D=!1,hasControlInside:k=!0,action:A=``,accept:j=``,supportServerRender:M=!0,rootClassName:N,styles:ee,classNames:te}=e,P=y.useContext(Ql),ne=p??P,re=e.customRequest||n.customRequest,[ie,ae]=O(i,r),oe=ie||[],[se,ce]=y.useState(`drop`),le=y.useRef(null),ue=y.useRef(null);y.useMemo(()=>{let e=Date.now();(r||[]).forEach((t,n)=>{!t.uid&&!Object.isFrozen(t)&&(t.uid=`__AUTO__${e}_${n}__`)})},[r]);let de=(e,t,n)=>{let r=nt(t),i=!1;T===1?r=r.slice(-1):T&&(i=r.length>T,r=r.slice(0,T)),(0,jy.flushSync)(()=>{ae(r)});let a={file:e,fileList:r};n&&(a.event=n),(!i||e.status===`removed`||r.some(t=>t.uid===e.uid))&&(0,jy.flushSync)(()=>{u?.(a)})},fe=async(t,n)=>{let{beforeUpload:r}=e,i=t;if(r){let e=await r(t,n);if(e===!1)return!1;if(delete t[My],e===My)return Object.defineProperty(t,My,{value:!0,configurable:!0}),!1;typeof e==`object`&&e&&(i=e)}return i},pe=e=>{let t=e.filter(e=>!e.file[My]);if(!t.length)return;let n=t.map(e=>Ey(e.file)),r=nt(oe);n.forEach(e=>{r=Dy(e,r)}),n.forEach((e,n)=>{let i=e;if(t[n].parsedFile)e.status=`uploading`;else{let{originFileObj:t}=e,n;try{n=new File([t],t.name,{type:t.type})}catch{n=new Blob([t],{type:t.type}),n.name=t.name,n.lastModifiedDate=new Date,n.lastModified=new Date().getTime()}n.uid=e.uid,i=n}de(i,r)})},me=(e,t,n)=>{try{typeof e==`string`&&(e=JSON.parse(e))}catch{}if(!Oy(t,oe))return;let r=Ey(t);r.status=`done`,r.percent=100,r.response=e,r.xhr=n,de(r,Dy(r,oe))},he=(e,t)=>{if(!Oy(t,oe))return;let n=Ey(t);n.status=`uploading`,n.percent=e.percent,de(n,Dy(n,oe),e)},ge=(e,t,n)=>{if(!Oy(n,oe))return;let r=Ey(n);r.error=e,r.response=t,r.status=`error`,de(r,Dy(r,oe))},_e=e=>{let t;Promise.resolve(typeof a==`function`?a(e):a).then(n=>{if(n===!1)return;let r=aue(e,oe);r&&(t={...e,status:`removed`},oe?.forEach(e=>{let n=t.uid===void 0?`name`:`uid`;e[n]===t[n]&&!Object.isFrozen(e)&&(e.status=`removed`)}),le.current?.abort(t),de(t,r))})},ve=e=>{ce(e.type),e.type===`drop`&&d?.(e)};y.useImperativeHandle(t,()=>({onBatchStart:pe,onSuccess:me,onProgress:he,onError:ge,fileList:oe,upload:le.current,nativeElement:ue.current}));let{getPrefixCls:ye,direction:be,className:xe,style:Se,classNames:Ce,styles:we}=mt(`upload`),Te=ye(`upload`,v),Ee={...e,listType:s,showUploadList:o,type:x,multiple:D,hasControlInside:k,supportServerRender:M,disabled:ne},[De,Oe]=Nc([Ce,te],[we,ee],{props:Ee}),ke={onBatchStart:pe,onError:ge,onProgress:he,onSuccess:me,...e,customRequest:re,data:E,multiple:D,action:A,accept:j,supportServerRender:M,prefixCls:Te,disabled:ne,beforeUpload:fe,onChange:void 0,hasControlInside:k};delete ke.className,delete ke.style,(!S||ne)&&delete ke.id;let Ae=`${Te}-wrapper`,[je,Me]=iue(Te,Ae),[Ne]=fc(`Upload`,ac.Upload),{showRemoveIcon:Pe,showPreviewIcon:Fe,showDownloadIcon:Ie,removeIcon:Le,previewIcon:Re,downloadIcon:ze,extra:Be}=typeof o==`boolean`?{}:o,Ve=Pe===void 0?!ne:Pe,He=(e,t)=>o?y.createElement(uue,{classNames:De,styles:Oe,prefixCls:Te,listType:s,items:oe,previewFile:f,onPreview:c,onDownload:l,onRemove:_e,showRemoveIcon:Ve,showPreviewIcon:Fe,showDownloadIcon:Ie,removeIcon:Le,previewIcon:Re,downloadIcon:ze,iconRender:h,extra:Be,locale:{...Ne,...m},isImageUrl:g,progress:_,appendAction:e,appendActionVisible:t,itemRender:w,disabled:ne}):e,Ue=F(Ae,b,N,je,Me,xe,De.root,{[`${Te}-rtl`]:be===`rtl`,[`${Te}-picture-card-wrapper`]:s===`picture-card`,[`${Te}-picture-circle-wrapper`]:s===`picture-circle`}),We={...Oe.root},Ge={...Se,...C};if(x===`drag`){let e=F(je,Te,`${Te}-drag`,{[`${Te}-drag-uploading`]:oe.some(e=>e.status===`uploading`),[`${Te}-drag-hover`]:se===`dragover`,[`${Te}-disabled`]:ne,[`${Te}-rtl`]:be===`rtl`});return y.createElement(`span`,{className:Ue,ref:ue,style:We},y.createElement(`div`,{className:e,style:Ge,onDrop:ve,onDragOver:ve,onDragLeave:ve},y.createElement(Ty,{...ke,ref:le,className:`${Te}-btn`},y.createElement(`div`,{className:`${Te}-drag-container`},S))),He())}let Ke=F(Te,`${Te}-select`,{[`${Te}-disabled`]:ne,[`${Te}-hidden`]:!S}),qe=y.createElement(`div`,{className:Ke,style:Ge},y.createElement(Ty,{...ke,ref:le}));return s===`picture-card`||s===`picture-circle`?y.createElement(`span`,{className:Ue,ref:ue,style:We},He(qe,!!S)):y.createElement(`span`,{className:Ue,ref:ue,style:We},qe,He())}),due=y.forwardRef((e,t)=>{let{style:n,height:r,hasControlInside:i=!1,children:a,...o}=e,s={...n,height:r};return y.createElement(Ny,{ref:t,hasControlInside:i,...o,style:s,type:`drag`},a)}),Py=Ny;Py.Dragger=due,Py.LIST_IGNORE=My;var fue=Py,pue=o((e=>{var t=Symbol.for(`react.transitional.element`),n=Symbol.for(`react.fragment`);function r(e,n,r){var i=null;if(r!==void 0&&(i=``+r),n.key!==void 0&&(i=``+n.key),`key`in n)for(var a in r={},n)a!==`key`&&(r[a]=n[a]);else r=n;return n=r.ref,{$$typeof:t,type:e,key:i,ref:n===void 0?null:n,props:r}}e.Fragment=n,e.jsx=r,e.jsxs=r})),I=o(((e,t)=>{t.exports=pue()}))(),Fy=(0,y.createContext)(void 0);const mue=({children:e})=>{let t=(0,y.useRef)(null),[n,r]=(0,y.useState)(!1),i=(0,y.useCallback)(e=>{t.current=e,r(!0)},[]),a=(0,y.useMemo)(()=>({plugin:t.current,setPlugin:i}),[n,i]);return(0,I.jsx)(Fy.Provider,{value:a,children:e})},Iy=()=>{let e=(0,y.useContext)(Fy);if(!e)throw Error(`useMolstar must be used within MolContextProvider`);return e};var Ly=function(){if(typeof window<`u`&&window.performance){let e=window.performance;return()=>e.now()}else if(typeof process<`u`&&process.hrtime!==`undefined`&&typeof process.hrtime==`function`)return()=>{let e=process.hrtime();return e[0]*1e3+e[1]/1e6};else if(Date.now)return()=>Date.now();else return()=>+new Date}();function Ry(e,t=!0){if(isNaN(e))return`n/a`;let n=Math.floor(e/(3600*1e3)),r=Math.floor(e/(60*1e3)%60),i=Math.floor(e/1e3%60),a=Math.floor(e%1e3).toString();for(;a.length<3;)a=`0`+a;for(;!t&&a.length>1&&a[a.length-1]===`0`;)a=a.substr(0,a.length-1);return n>0?`${n}h${r}m${i}.${a}s`:r>0?`${r}m${i}.${a}s`:i>0?`${i}.${a}s`:`${e.toFixed(0)}ms`}var zy;(function(e){let t=typeof btoa<`u`?btoa:e=>Buffer.from(e).toString(`base64`),n=[];function r(){let e=+new Date+Ly();for(let t=0;t<16;t++)n[t]=String.fromCharCode((e+Math.random()*255)%255|0),e=Math.floor(e/255);return t(n.join(``)).replace(/\+/g,`-`).replace(/\//g,`_`).substr(0,22)}e.create22=r;function i(){let e=+new Date+Ly();return`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g,function(t){let n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t===`x`?n:n&3|8).toString(16)})}e.createv4=i;function a(e){return typeof e==`string`}e.is=a})(zy||={});const By={is(e){return typeof e.charCodeAt==`function`},toString(e){try{return e.toString()}catch(t){throw Error(`Failed to convert StringLike object into string. This might be because the length ${e.length} exceeds maximum allowed string length ${Vy}. (${t})`)}}},Vy=536870888;var Hy=28,hue=class e{get length(){return this._length}constructor(e=Hy){this._chunks=[],this._length=0,this._tmpArray=[],this.STRING_CHUNK_SIZE=2**e,this.STRING_CHUNK_SHIFT=e,this.STRING_CHUNK_MASK=2**e-1}static fromString(t,n=Hy){let r=new e(n);return r._append(t),r}static fromStrings(t,n=Hy){let r=new e(n);for(let e of t)r._append(e);return r}static fromUtf8Data(t,n=0,r=t.length,i=Hy){let a=2**i,o=[],s=n;for(;s<r;){let e=Math.min(s+a,r);if(e<r){for(;(t[e]&192)==128;)if(e--,e===s)throw Error(`Input is rubbish, no UTF-8 character start found in a chunk`)}let n=Ky(t,s,e-s);o.push(n),s=e}return e.fromStrings(o,i)}_append(e){let t=this.STRING_CHUNK_SIZE,n=this._chunks.length===0||this._chunks[this._chunks.length-1].length===t?``:this._chunks.pop(),r=t-n.length;for(this._chunks.push(n+e.substring(0,r));r<e.length;)this._chunks.push(e.substring(r,r+t)),r+=t;this._length+=e.length}_getChunkIndex(e){return e>>>this.STRING_CHUNK_SHIFT}_getIndexInChunk(e){return e&this.STRING_CHUNK_MASK}_isOutOfRange(e){return e<0||e>=this.length}at(e){return-this.length<=e&&e<0?this.at(e+this.length):this.charAt(e)||void 0}charAt(e){if(this._isOutOfRange(e))return``;let t=this._getChunkIndex(e),n=this._getIndexInChunk(e);return this._chunks[t][n]}charCodeAt(e){if(this._isOutOfRange(e))return NaN;let t=this._getChunkIndex(e),n=this._getIndexInChunk(e);return this._chunks[t].charCodeAt(n)}substring(e,t){let n=Math.min(Math.max(e??0,0),this.length),r=Math.min(Math.max(t??this.length,0),this.length);if(n>r)return this.substring(r,n);if(n===r)return``;if(r-n>536870888)throw Error(`Trying to create get a substring longer (${r-n}) than maximum allowed string length (${Vy}).`);let i=this._getChunkIndex(n),a=this._getIndexInChunk(n),o=this._getChunkIndex(r),s=this._getIndexInChunk(r);if(i===o)return this._chunks[i].substring(a,s);{let e=this._getTmpArray();e.push(this._chunks[i].substring(a,this.STRING_CHUNK_SIZE));for(let t=i+1;t<o;t++)e.push(this._chunks[t]);return e.push(this._chunks[o].substring(0,s)),e.join(``)}}_getTmpArray(){for(;this._tmpArray.length;)this._tmpArray.pop();return this._tmpArray}indexOf(e,t=0){if(e.length>this.STRING_CHUNK_SIZE)throw Error(`NotImplementedError: indexOf is only implemented for searchString shorter than STRING_CHUNK_SIZE`);t<0&&(t=0);let n=this._getChunkIndex(t);for(let r=n;r<this._chunks.length;r++){let i=this._chunks[r],a=r===n?this._getIndexInChunk(t):0,o=i.indexOf(e,a);if(o>=0)return r*this.STRING_CHUNK_SIZE+o;if(r!==this._chunks.length-1){let t=Math.max(this.STRING_CHUNK_SIZE-e.length+1,a),n=(i.substring(t,void 0)+this._chunks[r+1].substring(0,e.length-1)).indexOf(e);if(n>=0)return r*this.STRING_CHUNK_SIZE+t+n}}return-1}includes(e,t=0){return this.indexOf(e,t)>=0}startsWith(e,t=0){if(e.length>this.STRING_CHUNK_SIZE)throw Error(`NotImplementedError: startsWith is only implemented for searchString shorter than STRING_CHUNK_SIZE`);return this.substring(t,t+e.length)===e}toString(){try{return this._chunks.join(``)}catch(e){throw Error(`Failed to convert StringLike object into string. This might be because the length ${this.length} exceeds maximum allowed string length ${Vy}. (${e})`)}}};function Uy(e,t,n){for(let r=0,i=n.length;r<i;r++){let i=n.charCodeAt(r);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw Error(`bad codepoint `+i)}}var gue=function(){let e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function Wy(e){throw Error(e)}function _ue(e,t,n){let r=gue,i,a=0,o=[];for(let s=t,c=t+n;s<c;s++){let t=e[s];t&128?(t&224)==192?o[a++]=r[(t&15)<<6|e[++s]&63]:(t&240)==224?o[a++]=String.fromCharCode((t&15)<<12|(e[++s]&63)<<6|(e[++s]&63)<<0):(t&248)==240?o[a++]=String.fromCharCode((t&7)<<18|(e[++s]&63)<<12|(e[++s]&63)<<6|(e[++s]&63)<<0):Wy(`Invalid byte `+t.toString(16)):o[a++]=r[t],a===512&&(i||=[],i[i.length]=o.join(``),a=0)}return i?(a>0&&(i[i.length]=o.slice(0,a).join(``)),i.join(``)):o.slice(0,a).join(``)}var Gy=typeof TextDecoder<`u`?new TextDecoder:void 0;function Ky(e,t=0,n=e.length){if(Gy){let r=t||n!==e.length?e.subarray(t,t+n):e;return Gy.decode(r)}else return _ue(e,t,n)}function qy(e,t=0,n=e.length){if(n<=536870888)return Ky(e,t,n);let r=hue.fromUtf8Data(e,t,t+n);return r.length<=536870888?r.toString():r}function Jy(e){let t=0;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);if(r<128){t+=1;continue}if(r<2048){t+=2;continue}if(r<65536){t+=3;continue}if(r<1114112){t+=4;continue}Wy(`bad codepoint `+r)}return t}function vue(){let e=(function(){let e=typeof window<`u`&&window,t=typeof self<`u`&&typeof WorkerGlobalScope<`u`&&self instanceof WorkerGlobalScope&&self;return e||typeof global<`u`&&global||t})(),t={},n=typeof document<`u`?document:void 0,r=1,i;function a(e,...n){return typeof e!=`function`&&(e=Function(``+e)),t[r]={callback:e,args:n},i(r),r++}function o(e){delete t[e]}function s(e){let t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n);break}}function c(e){let n=t[e];o(e),s(n)}function l(){i=function(e){process.nextTick(function(){c(e)})}}function u(){if(e&&e.postMessage&&!e.importScripts){let t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage(``,`*`),e.onmessage=n,t}}function d(){let t=`setImmediate$`+Math.random()+`$`,n=function(n){n.source===e&&typeof n.data==`string`&&n.data.indexOf(t)===0&&c(+n.data.slice(t.length))};window.addEventListener?window.addEventListener(`message`,n,!1):window.attachEvent(`onmessage`,n),i=function(e){window.postMessage(t+e,`*`)}}function f(){let e=new MessageChannel;e.port1.onmessage=function(e){let t=e.data;c(t)},i=function(t){e.port2.postMessage(t)}}function p(){let e=n.documentElement;i=function(t){let r=n.createElement(`script`);r.onreadystatechange=function(){c(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}function m(){i=function(e){setTimeout(c,0,e)}}return typeof process<`u`&&{}.toString.call(process)===`[object process]`?l():u()?d():typeof MessageChannel<`u`?f():n&&`onreadystatechange`in n.createElement(`script`)?p():m(),{setImmediate:a,clearImmediate:o}}var Yy=function(){return typeof setImmediate<`u`?typeof window<`u`?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:vue()}();function yue(e){Yy.setImmediate(e)}var Xy={setImmediate:Yy.setImmediate,clearImmediate:Yy.clearImmediate,immediatePromise(){return new Promise(yue)},delay(e,t=void 0){return new Promise(n=>setTimeout(n,e,t))}},Zy=function(){try{return!0}catch{return!1}}(),Qy=function(){try{let e={}.DEBUG;return e===`*`||e===`molstar`}catch{return!1}}(),$y=!1,eb=[];function bue(e){eb.includes(e)||eb.push(e)}function xue(e){let t=eb.indexOf(e);t!==-1&&eb.splice(t,1)}var tb=typeof performance<`u`&&!!performance.mark&&performance.measure&&$y,nb;(function(e){function t(e){return`startTask${e.id}`}function n(e){return`endTask${e.id}`}function r(e){tb&&performance.mark(t(e))}e.markStart=r;function i(e){tb&&performance.mark(n(e))}e.markEnd=i;function a(e){tb&&performance.measure(` ${e.name}`,t(e),n(e))}e.measure=a})(nb||={});function Sue(e,t,n=250){let r=ab(e,t,n);return cb(e,new fb(r,r.root))}function Cue(e,t,n=250){let r=ab(e,t,n);return new fb(r,r.root)}function rb(e,t){return cb(t,e)}function wue(e,t,n){return e.runChild(t,n)}function ib(e){return{taskId:e.id,taskName:e.name,message:``,startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function ab(e,t,n){let r={abortRequested:!1,treeAborted:!1,reason:``};return{updateRateMs:n,lastNotified:Ly(),observer:t,abortToken:r,taskId:e.id,root:{progress:ib(e),children:[]},tryAbort:Tue(r)}}function Tue(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function ob(e){return{progress:{...e.progress},children:e.children.map(ob)}}function sb(e){return e.progress.canAbort&&e.children.every(sb)}function Eue(e){return{root:ob(e.root),canAbort:sb(e.root),requestAbort:e.tryAbort}}async function cb(e,t){nb.markStart(e),t.node.progress.startedTime=Ly();try{let n=await e.f(t);return nb.markEnd(e),nb.measure(e),t.info.abortToken.abortRequested&&lb(t.info),n}catch(n){throw hb.isAbort(n)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise(e=>{t.onChildrenFinished=e}),e.onAbort&&e.onAbort()),n}}function lb(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,ub(e.root),db(e,Ly())),hb.Aborted(e.abortToken.reason)}function ub(e){let t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message=`Aborting...`;for(let t of e.children)ub(t)}function db(e,t){e.lastNotified=t;let n=Eue(e);e.observer(n)}var fb=class e{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,lb(this.info))}get shouldUpdate(){return this.checkAborted(),Ly()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;let t=this.node.progress;typeof e==`string`?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=Ly(),this.updateProgress(e),!t)return db(this.info,this.lastUpdatedTime),this.checkAborted(),Xy.immediatePromise()}async runChild(t,n){this.updateProgress(n);let r={progress:ib(t),children:[]},i=this.node.children;i.push(r);let a=new e(this.info,r);try{return await cb(t,a)}catch(e){if(hb.isAbort(e)&&this.isAborted)return;throw e}finally{let e=i.indexOf(r);if(e>=0){for(let t=e,n=i.length-1;t<n;t++)i[t]=i[t+1];i.pop()}i.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}};const pb=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(e,t){}};function mb(e=0,t=2**53-1){let n=e;return()=>{let e=n;return n=(n+1)%t,e}}var hb;(function(e){class t{run(e,t=250){return e?Sue(this,e,t):this.f(pb)}runAsChild(e,t){return e.isSynchronous?this.f(pb):wue(e,this,t)}runInContext(e){return e.isSynchronous?this.f(pb):rb(e,this)}constructor(e,t,n){this.name=e,this.f=t,this.onAbort=n,this.id=u()}}function n(e){let t=e;return!!e&&typeof t.id==`number`&&typeof t.name==`string`&&!!t.run}e.is=n;function r(e){return!!e&&!!e.isAborted}e.isAbort=r;function i(e){return{isAborted:!0,reason:e,toString(){return`Aborted${e?`: `+e:``}`}}}e.Aborted=i;function a(e,n,r){return new t(e,n,r)}e.create=a;function o(e,t){return a(e,async e=>t)}e.constant=o;function s(){return a(``,async e=>{})}e.empty=s;function c(e,t){return a(e,async e=>{throw Error(t)})}e.fail=c;function l(e,t){return n(e)?t?e.runInContext(t):e.run():e}e.resolveInContext=l;let u=mb(0,1073741823)})(hb||={});var Due;(function(e){e.Synchronous=pb})(Due||={});var Oue;(function(e){function t(e,n=``){let r=e.progress;if(!e.children.length)return r.isIndeterminate?`${n}${r.taskName}: ${r.message}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}`;let i=n+`  |_ `,a=e.children.map(e=>t(e,i));return r.isIndeterminate?`${n}${r.taskName}: ${r.message}\n${a.join(`
`)}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}\n${a.join(`
`)}`}function n(e){return t(e.root)}e.format=n})(Oue||={});async function gb(e,t,n,r,i){let a=Math.max(t,0),o=0,s=0;if(e.isSynchronous)return r(2**53-1,n),n;let c=Ly(),l=0,u=0;for(;(l=r(a,n))>0;){o+=l;let t=Ly()-c;u+=t,s+=t,e.shouldUpdate&&(await i(e,n,o),a=Math.round(u*o/s)+1,c=Ly(),u=0)}return e.shouldUpdate&&await i(e,n,o),n}const _b=typeof process<`u`&&process.versions!=null&&process.versions.node!=null,vb=kue();function kue(){if(typeof File>`u`||_b){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(e,t,n){return this.blob.slice(e,t,n)}stream(){return this.blob.stream()}text(){return this.blob.text()}bytes(){return this.blob.bytes()}constructor(e,t,n){this.blob=new Blob(e,n),this.size=this.blob.size,this.type=this.blob.type,this.name=t,this.lastModified=n?.lastModified??0,this.webkitRelativePath=``}}return e}else return File}function Aue(e){return e>>0}function yb(e,t){return e[t]|e[t+1]<<8}function bb(e,t,n){e[t]=n&255,e[t+1]=n>>8&255}function xb(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Sb(e,t,n){e[t]=n&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function jue(e,t,n){let r=``;for(let i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r}function Mue(e){return e.length<2?`0`+e:e}function Nue(e,t,n){let r=``,i;for(let i=0;i<n;i++)r+=`%`+Mue(e[t+i].toString(16));try{i=decodeURIComponent(r)}catch{return jue(e,t,n)}return i}function Pue(e,t,n){let r=n.length,i=0;for(let a=0;a<r;a++){let r=n.charCodeAt(a);if(!(r&4294967168))e[t+i]=r,i++;else if(!(r&4294965248))e[t+i]=192|r>>6,e[t+i+1]=128|r>>0&63,i+=2;else if(!(r&4294901760))e[t+i]=224|r>>12,e[t+i+1]=128|r>>6&63,e[t+i+2]=128|r>>0&63,i+=3;else if(!(r&4292870144))e[t+i]=240|r>>18,e[t+i+1]=128|r>>12&63,e[t+i+2]=128|r>>6&63,e[t+i+3]=128|r>>0&63,i+=4;else throw Error(`e`)}return i}function Cb(e){let t=e.length,n=0;for(let r=0;r<t;r++){let t=e.charCodeAt(r);if(!(t&4294967168))n++;else if(!(t&4294965248))n+=2;else if(!(t&4294901760))n+=3;else if(!(t&4292870144))n+=4;else throw Error(`e`)}return n}var Fue=(function(){let e=new Uint32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n&1?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e})();function Iue(e,t,n,r){for(let i=0;i<r;i++)e=Fue[(e^t[n+i])&255]^e>>>8;return e}function wb(e,t,n){return Iue(4294967295,e,t,n)^4294967295}var Tb={deflate:void 0,"deflate-raw":void 0,gzip:void 0};function Eb(e){if(Tb[e]===void 0)try{new CompressionStream(e),Tb[e]=!0}catch{Tb[e]=!1}return!!Tb[e]}const Db=(function(){let e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}})();(function(){for(let e=0;e<32768;e++){let t=e;t=(t&2863311530)>>>1|(t&1431655765)<<1,t=(t&3435973836)>>>2|(t&858993459)<<2,t=(t&4042322160)>>>4|(t&252645135)<<4,t=(t&4278255360)>>>8|(t&16711935)<<8,Db.rev15[e]=(t>>>16|t<<16)>>>17}function e(e,t,n){for(;t--!==0;)e.push(0,n)}for(let e=0;e<32;e++)Db.ldef[e]=Db.of0[e]<<3|Db.exb[e],Db.ddef[e]=Db.df0[e]<<4|Db.dxb[e];e(Db.fltree,144,8),e(Db.fltree,112,9),e(Db.fltree,24,7),e(Db.fltree,8,8),kb(Db.fltree,9),Ob(Db.fltree,9,Db.flmap),Ab(Db.fltree,9),e(Db.fdtree,32,5),kb(Db.fdtree,5),Ob(Db.fdtree,5,Db.fdmap),Ab(Db.fdtree,5),e(Db.itree,19,0),e(Db.ltree,286,0),e(Db.dtree,30,0),e(Db.ttree,320,0)})();function Ob(e,t,n){let r=e.length,i=Db.rev15;for(let a=0;a<r;a+=2)if(e[a+1]!==0){let r=a>>1,o=e[a+1],s=r<<4|o,c=t-o,l=e[a]<<c,u=l+(1<<c);for(;l!==u;){let e=i[l]>>>15-t;n[e]=s,l++}}}function kb(e,t){let n=e.length,r=Db.bl_count;for(let e=0;e<=t;e++)r[e]=0;for(let t=1;t<n;t+=2)r[e[t]]++;let i=Db.next_code,a=0;r[0]=0;for(let e=1;e<=t;e++)a=a+r[e-1]<<1,i[e]=a;for(let t=0;t<n;t+=2){let n=e[t+1];n!==0&&(e[t]=i[n],i[n]++)}}function Ab(e,t){let n=Db.rev15,r=15-t;for(let i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r}function Lue(e,t){let n=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:n,BFINAL:0,off:0,pos:0}}function Rue(e,t){let{data:n,noBuf:r}=e,{buf:i,BFINAL:a,off:o,pos:s}=e,c=0;for(;a===0&&c<t;){let e,t,l=0,u=0;a=Pb(n,s,1),c+=1;let d=Pb(n,s+1,2);if(s+=3,d===0){s&7&&(s+=8-(s&7));let e=(s>>>3)+4,t=n[e-4]|n[e-3]<<8;r&&(i=jb(i,o+t)),i.set(new Uint8Array(n.buffer,n.byteOffset+e,t),o),s=e+t<<3,o+=t;continue}if(r&&(i=jb(i,o+(1<<17))),d===1)e=Db.flmap,t=Db.fdmap,l=511,u=31;else if(d===2){let r=Nb(n,s,5)+257,i=Nb(n,s+5,5)+1,a=Nb(n,s+10,4)+4;s+=14;for(let e=0;e<38;e+=2)Db.itree[e]=0,Db.itree[e+1]=0;let o=1;for(let e=0;e<a;e++){let t=Nb(n,s+e*3,3);Db.itree[(Db.ordr[e]<<1)+1]=t,t>o&&(o=t)}s+=3*a,kb(Db.itree,o),Ob(Db.itree,o,Db.imap),e=Db.lmap,t=Db.dmap,s=Bue(Db.imap,(1<<o)-1,r+i,n,s,Db.ttree);let c=Mb(Db.ttree,0,r,Db.ltree);l=(1<<c)-1;let d=Mb(Db.ttree,r,i,Db.dtree);u=(1<<d)-1,kb(Db.ltree,c),Ob(Db.ltree,c,e),kb(Db.dtree,d),Ob(Db.dtree,d,t)}else throw Error(`unknown BTYPE ${d}`);for(;;){let a=e[Fb(n,s)&l];s+=a&15;let c=a>>>4;if(!(c>>>8))i[o++]=c;else if(c===256)break;else{let e=o+c-254;if(c>264){let t=Db.ldef[c-257];e=o+(t>>>3)+Nb(n,s,t&7),s+=t&7}let a=t[Fb(n,s)&u];s+=a&15;let l=a>>>4,d=Db.ddef[l],f=(d>>>4)+Pb(n,s,d&15);for(s+=d&15,r&&(i=jb(i,o+(1<<17)));o<e;)i[o]=i[o++-f],i[o]=i[o++-f],i[o]=i[o++-f],i[o]=i[o++-f];o=e}}}e.buf=i,e.BFINAL=a,e.off=o,e.pos=s}async function zue(e,t,n){if(t[0]===3&&t[1]===0)return n||new Uint8Array;if(Eb(`deflate-raw`)){let r=new DecompressionStream(`deflate-raw`),i=new Blob([t]).stream().pipeThrough(r),a=0,o=[],s=i.getReader(),c=async()=>{let{done:t,value:r}=await s.read();if(!t)return e.shouldUpdate&&await e.update({message:`Inflating blocks...`,current:a,max:n?.length}),n?n.set(r,a):o.push(r),a+=r.length,c()};if(await c(),!n){n=new Uint8Array(a);for(let e=0,t=0;e<o.length;e++)n.set(o[e],t),t+=o[e].length}return n}let r=Lue(t,n);for(;r.BFINAL===0;)e.shouldUpdate&&await e.update({message:`Inflating blocks...`,current:r.pos,max:t.length}),Rue(r,100);return r.buf.length===r.off?r.buf:r.buf.slice(0,r.off)}function jb(e,t){let n=e.length;if(t<=n)return e;let r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r}function Bue(e,t,n,r,i,a){let o=0;for(;o<n;){let n=e[Fb(r,i)&t];i+=n&15;let s=n>>>4;if(s<=15)a[o]=s,o++;else{let e=0,t=0;s===16?(t=3+Nb(r,i,2),i+=2,e=a[o-1]):s===17?(t=3+Nb(r,i,3),i+=3):s===18&&(t=11+Nb(r,i,7),i+=7);let n=o+t;for(;o<n;)a[o]=e,o++}}return i}function Mb(e,t,n,r){let i=0,a=0,o=r.length>>>1;for(;a<n;){let n=e[a+t];r[a<<1]=0,r[(a<<1)+1]=n,n>i&&(i=n),a++}for(;a<o;)r[a<<1]=0,r[(a<<1)+1]=0,a++;return i}function Nb(e,t,n){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<n)-1}function Pb(e,t,n){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<n)-1}function Fb(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function Ib(e){return Object.keys(e)}function Lb(e){throw Error(`unreachable`)}function Rb(e){return typeof e?.then==`function`}function zb(e,t,n){let r=[],i=e.length,a=t.length;for(let e=0;e<a;e+=2)t[e]=0,t[e+1]=0;for(let t=0;t<i;t++)e[t]!==0&&r.push({lit:t,f:e[t],d:void 0});let o=r.length,s=r.slice(0);if(o===0)return 0;if(o===1){let e=r[0].lit,n=e===0?1:0;return t[(e<<1)+1]=1,t[(n<<1)+1]=1,1}r.sort(function(e,t){return e.f-t.f});let c=r[0],l=r[1],u=0,d=1,f=2;for(r[0]={lit:-1,f:c.f+l.f,l:c,r:l,d:0};d!==o-1;)c=u!==d&&(f===o||r[u].f<r[f].f)?r[u++]:r[f++],l=u!==d&&(f===o||r[u].f<r[f].f)?r[u++]:r[f++],r[d++]={lit:-1,f:c.f+l.f,l:c,r:l,d:void 0};let p=Bb(r[d-1],0);p>n&&(Vue(s,n,p),p=n);for(let e=0;e<o;e++)t[(s[e].lit<<1)+1]=s[e].d;return p}function Bb(e,t){return e.lit===-1?Math.max(Bb(e.l,t+1),Bb(e.r,t+1)):(e.d=t,t)}function Vue(e,t,n){let r=0,i=0,a=1<<n-t;for(e.sort(function(e,t){return t.d===e.d?e.f-t.f:t.d-e.d}),r=0;r<e.length&&e[r].d>t;r++){let o=e[r].d;e[r].d=t,i+=a-(1<<n-o)}for(i>>>=n-t;i>0;){let n=e[r].d;n<t?(e[r].d++,i-=1<<t-n-1):r++}for(;r>=0;r--)e[r].d===t&&i<0&&(e[r].d--,i++);i!==0&&console.log(`debt left`)}function Hue(e,t,n,r){let{lits:i,strt:a,prev:o}=Db;return{data:e,out:t,opt:Wue[r],i:0,pos:n<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:a,prev:o}}function Uue(e,t){let{data:n,dlen:r,out:i,opt:a}=e,{i:o,pos:s,cvrd:c,li:l,lc:u,bs:d,ebits:f,c:p,nc:m}=e,{lits:h,strt:g,prev:_}=Db,v=Math.min(o+t,r);for(;o<v;o++){if(p=m,o+1<r-2){m=Vb(n,o+1);let e=o+1&32767;_[e]=g[m],g[m]=e}if(c<=o){(l>14e3||u>26697)&&r-o>100&&(c<o&&(h[l]=o-c,l+=2,c=o),s=Hb(o===r-1||c===r?1:0,h,l,f,n,d,o-d,i,s),l=u=f=0,d=o);let e=0;if(o<r-2&&(e=Kue(n,o,_,p,Math.min(a[2],r-o),a[3])),e!==0){let t=e>>>16,n=e&65535,r=qb(t,Db.of0);Db.lhst[257+r]++;let i=qb(n,Db.df0);Db.dhst[i]++,f+=Db.exb[r]+Db.dxb[i],h[l]=t<<23|o-c,h[l+1]=n<<16|r<<8|i,l+=2,c=o+t}else Db.lhst[n[o]]++;u++}}e.i=o,e.pos=s,e.cvrd=c,e.li=l,e.lc=u,e.bs=d,e.ebits=f,e.c=p,e.nc=m}var Wue=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];async function Gue(e,t,n,r,i){if(Eb(`deflate-raw`)){let i=new CompressionStream(`deflate-raw`),a=new Blob([t]).stream().pipeThrough(i).getReader(),o=r,s=async()=>{let{done:t,value:r}=await a.read();if(!t)return e.shouldUpdate&&await e.update({message:`Deflating...`,current:o,max:n.length}),n.set(r,o),o+=r.length,s()};return await s(),o}let a=Hue(t,n,r,i),{dlen:o}=a;if(i===0){let{i:e,pos:r}=a;for(;e<o;){let i=Math.min(65535,o-e);Yb(n,r,e+i===o?1:0),r=Ub(t,e,i,n,r+8),e+=i}return r>>>3}for(o>2&&(a.nc=Vb(t,0),a.strt[a.nc]=0);a.i<o;)e.shouldUpdate&&await e.update({message:`Deflating...`,current:a.i,max:o}),Uue(a,1024*1024);let{li:s,cvrd:c,pos:l}=a,{i:u,lits:d,bs:f,ebits:p}=a;for((f!==u||t.length===0)&&(c<u&&(d[s]=u-c,s+=2,c=u),l=Hb(1,d,s,p,t,f,u-f,n,l));l&7;)l++;return l>>>3}function Kue(e,t,n,r,i,a){let o=t&32767,s=n[o],c=o-s+32768&32767;if(s===o||r!==Vb(e,t-c))return 0;let l=0,u=0,d=Math.min(32767,t);for(;c<=d&&--a!==0&&s!==o;){if(l===0||e[t+l]===e[t+l-c]){let r=que(e,t,c);if(r>l){if(l=r,u=c,l>=i)break;c+2<r&&(r=c+2);let e=0;for(let i=0;i<r-2;i++){let r=t-c+i+32768&32767,a=r-n[r]+32768&32767;a>e&&(e=a,s=r)}}}o=s,s=n[o],c+=o-s+32768&32767}return l<<16|u}function que(e,t,n){if(e[t]!==e[t-n]||e[t+1]!==e[t+1-n]||e[t+2]!==e[t+2-n])return 0;let r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]===e[t-n];)t++;return t-r}function Vb(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function Hb(e,t,n,r,i,a,o,s,c){Db.lhst[256]++;let[l,u,d,f,p,m,h,g]=Jue(),_=(c+3&7?8-(c+3&7):0)+32+(o<<3),v=r+Wb(Db.fltree,Db.lhst)+Wb(Db.fdtree,Db.dhst),y=r+Wb(Db.ltree,Db.lhst)+Wb(Db.dtree,Db.dhst);y+=14+3*m+Wb(Db.itree,Db.ihst)+(Db.ihst[16]*2+Db.ihst[17]*3+Db.ihst[18]*7);for(let e=0;e<286;e++)Db.lhst[e]=0;for(let e=0;e<30;e++)Db.dhst[e]=0;for(let e=0;e<19;e++)Db.ihst[e]=0;let b=_<v&&_<y?0:v<y?1:2;if(Xb(s,c,e),Xb(s,c+1,b),c+=3,b===0){for(;c&7;)c++;c=Ub(i,a,o,s,c)}else{let e,r;if(b===1)e=Db.fltree,r=Db.fdtree;else if(b===2){kb(Db.ltree,l),Ab(Db.ltree,l),kb(Db.dtree,u),Ab(Db.dtree,u),kb(Db.itree,d),Ab(Db.itree,d),e=Db.ltree,r=Db.dtree,Yb(s,c,f-257),c+=5,Yb(s,c,p-1),c+=5,Yb(s,c,m-4),c+=4;for(let e=0;e<m;e++)Yb(s,c+e*3,Db.itree[(Db.ordr[e]<<1)+1]);c+=3*m,c=Gb(h,Db.itree,s,c),c=Gb(g,Db.itree,s,c)}else Lb(b);let o=a;for(let a=0;a<n;a+=2){let n=t[a],l=n>>>23,u=o+(n&(1<<23)-1);for(;o<u;)c=Jb(i[o++],e,s,c);if(l!==0){let n=t[a+1],i=n>>16,u=n>>8&255,d=n&255;c=Jb(257+u,e,s,c),Yb(s,c,l-Db.of0[u]),c+=Db.exb[u],c=Jb(d,r,s,c),Xb(s,c,i-Db.df0[d]),c+=Db.dxb[d],o+=l}}c=Jb(256,e,s,c)}return c}function Ub(e,t,n,r,i){let a=i>>>3;return r[a]=n,r[a+1]=n>>>8,r[a+2]=255-r[a],r[a+3]=255-r[a+1],a+=4,r.set(new Uint8Array(e.buffer,t,n),a),i+(n+4<<3)}function Jue(){let e=zb(Db.lhst,Db.ltree,15),t=zb(Db.dhst,Db.dtree,15),n=[],r=Kb(Db.ltree,n),i=[],a=Kb(Db.dtree,i);for(let e=0;e<n.length;e+=2)Db.ihst[n[e]]++;for(let e=0;e<i.length;e+=2)Db.ihst[i[e]]++;let o=zb(Db.ihst,Db.itree,7),s=19;for(;s>4&&Db.itree[(Db.ordr[s-1]<<1)+1]===0;)s--;return[e,t,o,r,a,s,n,i]}function Wb(e,t){let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[(r<<1)+1];return n}function Gb(e,t,n,r){for(let i=0;i<e.length;i+=2){let a=e[i],o=e[i+1];r=Jb(a,t,n,r);let s=a===16?2:a===17?3:7;a>15&&(Yb(n,r,o),r+=s)}return r}function Kb(e,t){let n=e.length;for(;n!==2&&e[n-1]===0;)n-=2;for(let r=0;r<n;r+=2){let i=e[r+1],a=r+3<n?e[r+3]:-1,o=r+5<n?e[r+5]:-1,s=r===0?-1:e[r-1];if(i===0&&a===i&&o===i){let a=r+5;for(;a+2<n&&e[a+2]===i;)a+=2;let o=Math.min(a+1-r>>>1,138);o<11?t.push(17,o-3):t.push(18,o-11),r+=o*2-2}else if(i===s&&a===i&&o===i){let a=r+5;for(;a+2<n&&e[a+2]===i;)a+=2;let o=Math.min(a+1-r>>>1,6);t.push(16,o-3),r+=o*2-2}else t.push(i,0)}return n>>>1}function qb(e,t){let n=0;return t[n|16]<=e&&(n|=16),t[n|8]<=e&&(n|=8),t[n|4]<=e&&(n|=4),t[n|2]<=e&&(n|=2),t[n|1]<=e&&(n|=1),n}function Jb(e,t,n,r){return Xb(n,r,t[e<<1]),r+t[(e<<1)+1]}function Yb(e,t,n){n<<=t&7;let r=t>>>3;e[r]|=n,e[r+1]|=n>>>8}function Xb(e,t,n){n<<=t&7;let r=t>>>3;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16}async function Zb(e,t,n=!1){let r=Object.create(null),i=new Uint8Array(t);if(yb(i,0)!==19280)throw Error(`Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).`);let a=i.length-4;for(;xb(i,a)!==101010256;)a--;let o=a;o+=4,o+=4;let s=yb(i,o);o+=2,o+=2,o+=4;let c=xb(i,o);o+=4,o=c;for(let t=0;t<s;t++){o+=4,o+=4,o+=4,o+=4,o+=4,o+=4,o+=4;let t=yb(i,o),a=yb(i,o+2),s=yb(i,o+4);o+=6,o+=8;let c=xb(i,o);o+=4,o+=t+a+s,await Yue(e,i,c,r,n)}return r}async function Yue(e,t,n,r,i){n+=4,n+=2,n+=2;let a=yb(t,n);n+=2,n+=4,n+=4;let o=xb(t,n);n+=4;let s=xb(t,n);n+=4;let c=yb(t,n);n+=2;let l=yb(t,n);n+=2;let u=Nue(t,n,c);if(n+=c,n+=l,i){r[u]={size:s,csize:o};return}let d=new Uint8Array(t.buffer,n,o);if(a===0)r[u]=d;else if(a===8){let t=new Uint8Array(s);await Qb(e,d,t),r[u]=t}else throw Error(`unknown compression method: ${a}`)}async function Qb(e,t,n){return zue(e,t,n)}async function $b(e,t,n){let r=t[3],i=10;if(r&4){let e=yb(t,i);i+=e}if(r&8){let e=i;for(;t[e]!==0;)++e;i=e+1}if(r&16){let e=i;for(;t[e]!==0;)++e;i=e+1}r&1&&(i+=2);let a=Aue(xb(t,t.length-8)),o=xb(t,t.length-4);n===void 0&&(n=new Uint8Array(o));let s=await Qb(e,new Uint8Array(t.buffer,t.byteOffset+i,t.length-i-8),n);return a!==wb(s,0,s.length)&&console.error(`ungzip: checksums don't match`),s}async function Xue(e,t,n){n===void 0&&(n={level:6});let r=new Uint8Array(50+Math.floor(t.length*1.1)),i=await Gue(e,t,r,0,n.level);return new Uint8Array(r.buffer,0,i)}function Zue(e,t=!1){return hb.create(`Zip`,n=>Que(n,e,t))}async function Que(e,t,n=!1){let r=0,i={};for(let r in t){let a=!$ue(r)&&!n,o=t[r],s=wb(o,0,o.length);i[r]={cpr:a,usize:o.length,crc:s,file:a?await Xue(e,o):o}}for(let e in i)r+=i[e].file.length+30+46+2*Cb(e);r+=22;let a=new Uint8Array(r),o=0,s=[];for(let e in i){let t=i[e];s.push(o),o=ex(a,o,e,t,0)}let c=0,l=o;for(let e in i){let t=i[e];s.push(o),o=ex(a,o,e,t,1,s[c++])}let u=o-l;return Sb(a,o,101010256),o+=4,o+=4,bb(a,o,c),o+=2,bb(a,o,c),o+=2,Sb(a,o,u),o+=4,Sb(a,o,l),o+=4,o+=2,a.buffer}function $ue(e){let t=e.split(`.`).pop().toLowerCase();return`png,jpg,jpeg,zip`.indexOf(t)!==-1}function ex(e,t,n,r,i,a=0){let o=r.file;Sb(e,t,i===0?67324752:33639248),t+=4,i===1&&(t+=2),bb(e,t,20),t+=2,bb(e,t,0),t+=2,bb(e,t,r.cpr?8:0),t+=2,Sb(e,t,0),t+=4,Sb(e,t,r.crc),t+=4,Sb(e,t,o.length),t+=4,Sb(e,t,r.usize),t+=4,bb(e,t,Cb(n)),t+=2,bb(e,t,0),t+=2,i===1&&(t+=2,t+=2,t+=6,Sb(e,t,a),t+=4);let s=Pue(e,t,n);return t+=s,i===0&&(e.set(o,t),t+=o.length),t}var tx;(function(e){e[e.None=0]=`None`,e[e.Gzip=1]=`Gzip`,e[e.Zip=2]=`Zip`})(tx||={});function nx(e,t){return rde(e,t)}function rx(e){return typeof e==`string`?lx(e,e,`string`):lx(e.title,e.url,e.type||`string`,e.body,e.headers)}function ede(e){if(_b)throw Error("`isDone` should not be used when running in Node.js");if(e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE;throw Error(`unknown data type`)}function ix(e){return e?`Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.`:`Failed to open file.`}function ax(e,t,n){if(_b)throw Error("`readData` should not be used when running in Node.js");return new Promise((r,i)=>{if(ede(n)){let{error:e}=n;e==null?r(n):i(e??ix(n instanceof XMLHttpRequest));return}let a=!1;n.onerror=e=>{if(a)return;let{error:t}=e.target;i(t??ix(n instanceof XMLHttpRequest))},n.onprogress=n=>{if(!(!e.shouldUpdate||a))try{n.lengthComputable?e.update({message:t,isIndeterminate:!1,current:n.loaded,max:n.total}):e.update({message:`${t} ${(n.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(e){a=!0,i(e)}},n.onload=e=>{r(n)}})}function ox(e){return/\.gz$/i.test(e)?tx.Gzip:/\.zip$/i.test(e)?tx.Zip:tx.None}var tde=/^(__MACOSX|.DS_Store)/;async function nde(e,t,n){switch(n){case tx.None:return t;case tx.Gzip:return $b(e,t);case tx.Zip:let n=await Zb(e,t.buffer),r=Object.keys(n).filter(e=>!tde.test(e));if(r.length!==1)throw Error(`can only decompress zip files with a single entry`);return n[r[0]]}}async function sx(e,t,n,r){if(t===null)throw Error(`no data given`);let i=new Uint8Array(t);if(r!==tx.None&&n!==`zip`&&(i=await nde(e,i,r)),n===`binary`)return i;if(n===`zip`)return await Zb(e,i.buffer);if(n===`string`)return qy(i);if(n===`xml`)return new DOMParser().parseFromString(Ky(i),`application/xml`);if(n===`json`)return JSON.parse(Ky(i));throw Error(`could not get requested response data '${n}'`)}function rde(e,t){if(_b)return ide(e,t);let n;return hb.create(`Read File`,async r=>{try{await r.update({message:`Opening file...`,canAbort:!0}),n=new FileReader,n.readAsArrayBuffer(e);let i=(await ax(r,`Reading...`,n)).result;return await r.update({message:`Processing file...`,canAbort:!1}),await sx(r,i,t,ox(e.name))}finally{n=void 0}},()=>{n&&n.abort()})}function ide(e,t){return hb.create(`Read File`,async n=>{await n.update({message:`Opening file...`,canAbort:!1});let r=await e.arrayBuffer();return await n.update({message:`Processing file...`,canAbort:!1}),await sx(n,r,t,ox(e.name))})}var cx=class e{static get(){if(_b)throw Error("`RequestPool.get` should not be used when running in Node.js");return this.pool.length?this.pool.pop():new XMLHttpRequest}static emptyFunc(){}static deposit(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))}};cx.pool=[],cx.poolSize=15;function ade(e,t){if(e.status>=200&&e.status<400){let{response:n}=e;if(cx.deposit(e),(t===`binary`||t===`zip`)&&n instanceof ArrayBuffer)return new Uint8Array(n);if(t===`string`&&typeof n==`string`||t===`xml`&&n instanceof XMLDocument||t===`json`&&typeof n==`object`)return n;throw Error(`could not get requested response data '${t}'`)}else throw cx.deposit(e),Error(`Download failed with status code ${e.status}`)}function ode(e){switch(e){case`json`:return`json`;case`xml`:return`document`;case`string`:return`text`;case`binary`:return`arraybuffer`;case`zip`:return`arraybuffer`}}function lx(e,t,n,r,i){if(_b)return t.startsWith(`file://`)?lde(e,t,n,r,i):ude(e,t,n,r,i);let a;return hb.create(e||`Download`,async e=>{if(a=cx.get(),a.open(r?`post`:`get`,t,!0),i)for(let[e,t]of i)a.setRequestHeader(e,t);a.responseType=ode(n),a.send(r),await e.update({message:`Waiting for server...`,canAbort:!0});let o=await ax(e,`Downloading...`,a);return a=void 0,await e.update({message:`Parsing response...`,canAbort:!1}),ade(o,n)},()=>{a&&=(a.abort(),void 0)})}var ux=void 0;function sde(){if(!ux)throw Error(`When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.`);return ux}function cde(e){return new Promise((t,n)=>{sde().readFile(e,(e,r)=>{e?n(e):t(r)})})}function lde(e,t,n,r,i){if(!_b)throw Error(`This function should only be used when running in Node.js`);if(!t.startsWith(`file://`))throw Error(`This function is only for URLs with protocol file://`);return hb.create(e??`Download`,async e=>{let r=t.substring(7);await e.update({message:`Loading file...`,canAbort:!1});let i=await cde(r);return await e.update({message:`Parsing response...`,canAbort:!1}),await sx(e,i.buffer,n,tx.None)})}function ude(e,t,n,r,i){if(!_b)throw Error(`This function should only be used when running in Node.js`);let a=new AbortController;return hb.create(e??`Download`,async e=>{await e.update({message:`Downloading...`,canAbort:!0});let r=await fetch(t,{signal:a.signal});if(!(r.status>=200&&r.status<400))throw Error(`Download failed with status code ${r.status}`);let i=await r.bytes();return await e.update({message:`Parsing response...`,canAbort:!1}),await sx(e,i.buffer,n,tx.None)},()=>{a.abort()})}async function dde(e,t,n,r){let i=n.length,a=Array(n.length);await e.update({message:`Downloading...`,current:0,max:i});let o=[],s=[],c=0;for(let a=Math.min(i,r);c<a;c++){let r=n[c];o.push(fx(c,r.id,t.resolve(gx.getUrlAsset(t,r.url),r.isBinary?`binary`:`string`).runAsChild(e))),s.push(c)}let l=0;for(;o.length>0;){let r=await Promise.race(o),u=n[r.index],d=s.indexOf(r.index);if(l++,r.kind===`error`&&!u.canFail)throw Error(`${u.url}: ${r.error}`);if(e.shouldUpdate&&await e.update({message:`Downloading...`,current:l,max:i}),a[r.index]=r,o=o.filter(dx,d),s=s.filter(dx,d),c<i){let r=n[c],i=t.resolve(gx.getUrlAsset(t,r.url),r.isBinary?`binary`:`string`).runAsChild(e);o.push(fx(c,r.id,i)),s.push(c),c++}}return a}function dx(e,t){return this!==t}async function fx(e,t,n){try{return{kind:`ok`,result:await n,index:e,id:t}}catch(n){return{kind:`error`,error:n,index:e,id:t}}}function px(e,t){for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n]}function mx(e){if(Array.from)return Array.from(e);let t=[];for(;;){let{done:n,value:r}=e.next();if(n)break;t[t.length]=r}return t}function hx(e,t,n){let r=t-e+1,i=n?new n(r):new Int32Array(r);for(let t=0;t<r;t++)i[t]=t+e;return i}function fde(e,t){let n=new(pde(e))(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=e[t[r]];return n}function pde(e){let t=e.constructor;if(!t)throw Error(`data does not define a constructor and it should`);return t}var gx;(function(e){function t(e,t){return{kind:`url`,id:zy.create22(),url:e,...t}}e.Url=t;function n(e){return{kind:`file`,id:zy.create22(),name:e.name,file:e}}e.File=n;function r(e){return e?.kind===`url`}e.isUrl=r;function i(e){return e?.kind===`file`}e.isFile=i;function a(e,t,n){return{data:e,dispose:()=>{n.release(t)}}}e.Wrapper=a;function o(e){return typeof e==`string`?e:e.url}e.getUrl=o;function s(e,n,r){return typeof n==`string`?e.tryFindUrl(n,r)||t(n,{body:r}):n}e.getUrlAsset=s})(gx||={});var mde=class{constructor(){this._assets=new Map}get assets(){return mx(this._assets.values())}tryFindUrl(e,t){let n=this.assets.values();for(;;){let r=n.next();if(r.done)return;let i=r.value.asset;if(gx.isUrl(i)&&i.url===e&&(i.body||``)===(t||``))return i}}tryFindFilename(e){let t=this._assets.values();for(;;){let{done:n,value:r}=t.next();if(n)break;if(r.file.name===e)return r.asset}}set(e,t,n){this._assets.set(e.id,{asset:e,file:t,refCount:0,tag:n?.tag,isStatic:n?.isStatic})}get(e){return this._assets.get(e.id)}delete(e){return this._assets.delete(e.id)}has(e){return this._assets.has(e.id)}resolve(e,t,n=!0){return gx.isUrl(e)?hb.create(`Download ${e.title||e.url}`,async r=>{if(this._assets.has(e.id)){let n=this._assets.get(e.id);return n.refCount++,gx.Wrapper(await nx(n.file,t).runInContext(r),e,this)}if(!n)return gx.Wrapper(await rx({...e,type:t}).runInContext(r),e,this);let i=new vb([await rx({...e,type:`binary`}).runInContext(r)],`raw-data`);return this._assets.set(e.id,{asset:e,file:i,refCount:1}),gx.Wrapper(await nx(i,t).runInContext(r),e,this)}):hb.create(`Read ${e.name}`,async r=>{if(this._assets.has(e.id)){let n=this._assets.get(e.id);return n.refCount++,gx.Wrapper(await nx(n.file,t).runInContext(r),e,this)}if(!(e.file instanceof vb))throw Error(`Cannot resolve file asset '${e.name}' (${e.id})`);return n&&this._assets.set(e.id,{asset:e,file:e.file,refCount:1}),gx.Wrapper(await nx(e.file,t).runInContext(r),e,this)})}release(e){let t=this._assets.get(e.id);t&&(t.refCount--,t.refCount<=0&&!t.isStatic&&this._assets.delete(e.id))}clearTag(e){let t=Array.from(this._assets.keys());for(let n of t){let t=this._assets.get(n);t&&t.tag===e&&this._assets.delete(n)}}clear(){this._assets.clear()}dispose(){this.clear()}},_x;(function(e){function t(e){return e}e.create=t;function n(e,t){return(e&t)!==0}e.has=n;function r(e,t){return!!t&&(e&t)===t}e.hasAll=r})(_x||={});var vx;(function(e){function t(e=512){return{current:[],offset:0,capacity:e,chunks:[]}}e.create=t;function n(e){return e.chunks.length?(e.offset>0&&(e.chunks[e.chunks.length]=e.current.length===e.offset?e.current.join(``):e.current.slice(0,e.offset).join(``)),e.chunks.join(``)):e.current.length===e.offset?e.current.join(``):e.current.splice(0,e.offset).join(``)}e.getString=n;function r(e){let t=0;for(let n of e.chunks)t+=n.length;for(let n=0;n<e.offset;n++)t+=e.current[n].length;return t}e.getSize=r;function i(e){return e.offset>0&&(e.current.length===e.offset?e.chunks[e.chunks.length]=e.current.join(``):e.chunks[e.chunks.length]=e.current.slice(0,e.offset).join(``),e.offset=0),e.chunks}e.getChunks=i;let a;(function(e){e[e.Count=512]=`Count`})(a||={});let o=[];(function(){let e=``;for(let t=0;t<a.Count;t++)o[t]=e,e+=` `})();function s(e){d(e,`
`)}e.newline=s;function c(e,t){t>0&&d(e,o[t])}e.whitespace=c;function l(e){d(e,` `)}e.whitespace1=l;function u(e,t){t&&(e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(``),e.offset=0),e.current[e.offset++]=t)}e.write=u;function d(e,t){e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(``),e.offset=0),e.current[e.offset++]=t}e.writeSafe=d;function f(e,t,n){if(!t){c(e,n);return}c(e,n-t.length),d(e,t)}e.writePadLeft=f;function p(e,t,n){if(!t){c(e,n);return}let r=n-t.length;d(e,t),c(e,r)}e.writePadRight=p;function m(e,t){d(e,``+t)}e.writeInteger=m;function h(e,t){d(e,``+t+` `)}e.writeIntegerAndSpace=h;function g(e,t,n){let r=``+t;c(e,n-r.length),d(e,r)}e.writeIntegerPadLeft=g;function _(e,t,n){let r=``+t,i=n-r.length;d(e,r),c(e,i)}e.writeIntegerPadRight=_;function v(e,t,n){d(e,``+Math.round(n*t)/n)}e.writeFloat=v;function y(e,t,n,r){let i=``+Math.round(n*t)/n;c(e,r-i.length),d(e,i)}e.writeFloatPadLeft=y;function b(e,t,n,r){let i=``+Math.round(n*t)/n,a=r-i.length;d(e,i),c(e,a)}e.writeFloatPadRight=b})(vx||={});function hde(e,t){return e-t}function gde(e){return Array.prototype.sort.call(e,hde),e}var _de;(function(e){class t{has(e){return!1}forEach(e,t){return t}constructor(){this.size=0}}class n{has(e){return e===this.idx}forEach(e,t){return e(this.idx,t),t}constructor(e){this.idx=e,this.size=1}}class r{has(e){return e<this.length&&!!this.mask[e]}_forEach(e,t){for(let n=0;n<this.length;n++)this.mask[n]&&e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e,t){this.mask=e,this.size=t,this.length=e.length}}class i{has(e){return!0}_forEach(e,t){for(let n=0;n<this.size;n++)e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.size=e}}class a{has(e){return this.set.has(e)}_forEach(e,t){for(let n of this.flatten())e(n,t)}flatten(){if(this._flat)return this._flat;let e=new Int32Array(this.size),t=0;return this.set.forEach(n=>e[t++]=n),gde(e),this._flat=e,this._flat}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.set=e,this._flat=void 0,this.size=e.size}}function o(e){return new i(e)}e.always=o,e.never=new t;function s(e){return new a(e)}e.ofSet=s;function c(e){return new n(e)}e.singleton=c;function l(e){let o=e.length;if(o===0)return new t;if(o===1)return new n(e[0]);let s=0;for(let t of e)t>s&&(s=t);if(o===s)return new i(o);if(o/s<1/12){let t=new Set;for(let n of e)t.add(n);return new a(t)}let c=new Int8Array(s+1);for(let t of e)c[t]=1;return new r(c,e.length)}e.ofUniqueIndices=l;function u(e,t){return new r(e,t)}e.ofMask=u;function d(e,t){for(let n of t)if(e.has(n))return!0;return!1}e.hasAny=d;function f(e,t){let n=0,r=0;if(t.forEach(t=>{e.has(t)||(n++,t>r&&(r=t))}),n/r<1/12){let n=new Set;return t.forEach(t=>{e.has(t)||n.add(t)}),s(n)}else{let i=new Uint8Array(r+1);return t.forEach(t=>{e.has(t)||(i[t]=1)}),u(i,n)}}e.complement=f})(_de||={});var yx;(function(e){function t(e){return{ref:e}}e.create=t;function n(e,t){return e.ref=t,e}e.set=n})(yx||={});var vde=mb(0,2147483647),bx;(function(e){function t(e,t){return{id:vde(),version:0,value:e,metadata:t}}e.create=t;function n(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}e.withValue=n})(bx||={});var L;(function(e){function t(e,t){return yx.create(bx.create(e,t))}e.create=t;function n(e,t){return yx.set(e,bx.withValue(e.ref,t))}e.update=n;function r(e,t){return yx.set(e,t)}e.set=r;function i(e,t){return e.ref.value===t?e:n(e,t)}e.updateIfChanged=i})(L||={});const xx=function(){};function Sx(e,t){let n=10**t;return Math.round(n*e)/n}function Cx(e,t){let n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}var wx=Object.prototype.hasOwnProperty;function Tx(e,t){if(e===t)return!0;let n=Array.isArray(e),r=Array.isArray(t);if(n&&r){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Tx(e[n],t[n]))return!1;return!0}if(n!==r)return!1;if(e&&t&&typeof e==`object`&&typeof t==`object`){let n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;let r=e instanceof Date,i=t instanceof Date;if(r&&i)return e.getTime()===t.getTime();if(r!==i)return!1;let a=e instanceof RegExp,o=t instanceof RegExp;if(a&&o)return e.toString()===t.toString();if(a!==o)return!1;for(let e=0;e<n.length;e++)if(!wx.call(t,n[e]))return!1;for(let r=0;r<n.length;r++)if(!Tx(e[n[r]],t[n[r]]))return!1;return!0}return!1}function Ex(e,t){if(e===t)return!0;let n=Array.isArray(e),r=Array.isArray(t);return n&&r?yde(e,t):n===r&&e&&t&&typeof e==`object`&&typeof t==`object`?Dx(e,t):!1}function Dx(e,t){if(e===t)return!0;if(!e||!t)return!1;let n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(let r of n)if(!wx.call(e,r)||e[r]!==t[r])return!1;return!0}function yde(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}function Ox(e,t){return e===void 0?t:e}function kx(e){return(e<10?`0`:``)+e}function bde(e){let t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return`${t}:${kx(n)}:${kx(r)}`}function Ax(){let e=((t,n)=>t.commands.dispatch(e,n||{}));return e.subscribe=(t,n)=>t.commands.subscribe(e,n),e.id=zy.create22(),e}var xde=class{constructor(){this.subs=new Map,this.disposing=!1}subscribe(e,t){let n=this.subs.get(e.id);return n||(n=[],this.subs.set(e.id,n)),n.push(t),{unsubscribe:()=>{let n=this.subs.get(e.id);if(!n)return;let r=n.indexOf(t);if(!(r<0)){for(let e=r+1;e<n.length;e++)n[e-1]=n[e];n.pop()}}}}dispatch(e,t){return new Promise((n,r)=>{if(this.disposing){r(`disposed`);return}if(!this.subs.get(e.id)){n();return}this.resolve({cmd:e,params:t,resolve:n,reject:r})})}dispose(){this.subs.clear()}async resolve(e){let t=this.subs.get(e.cmd.id);if(!t){e.resolve();return}try{for(let n of t)await n(e.params);e.resolve()}catch(t){e.reject(t)}}};const jx={State:{SetCurrentObject:Ax(),ApplyAction:Ax(),Update:Ax(),RemoveObject:Ax(),ToggleExpanded:Ax(),ToggleVisibility:Ax(),Snapshots:{Add:Ax(),Replace:Ax(),Move:Ax(),Remove:Ax(),Apply:Ax(),Clear:Ax(),Upload:Ax(),Fetch:Ax(),DownloadToFile:Ax(),OpenFile:Ax(),OpenUrl:Ax()}},Interactivity:{Object:{Highlight:Ax()},Structure:{Highlight:Ax(),Select:Ax()},ClearHighlights:Ax()},Layout:{Update:Ax()},Toast:{Show:Ax(),Hide:Ax()},Camera:{Reset:Ax(),SetSnapshot:Ax(),Focus:Ax(),FocusObject:Ax(),OrientAxes:Ax(),ResetAxes:Ax()},Canvas3D:{SetSettings:Ax(),ResetSettings:Ax()}};var Mx;(function(e){function t(){return e=>n(e)}e.factory=t;function n(e){var t;return t=class{static is(t){return!!t&&e===t.type}constructor(t,n){this.data=t,this.id=zy.create22(),this.type=e,this.label=n&&n.label||e.name,this.description=n&&n.description}},t.type=e,t}e.create=n;function r(e,t){if(!e.tags)return!1;for(let n of e.tags)if(n===t)return!0;return!1}e.hasTag=r,e.Null={id:zy.create22(),type:{name:`Null`,typeClass:`Null`},data:void 0,label:`Null`}})(Mx||={});var Nx;(function(e){function t(e){let t=e;return!!t&&!!t.transform&&!!t.parent&&!!t.status}e.is=t;function n(t,n){let r=typeof n==`string`?n:e.is(n)?n.transform.ref:n.ref;return t.cells.get(r)}e.resolve=n})(Nx||={});var Px=class{get cell(){return this.state?.cells.get(this.ref)}get obj(){return this.state?.cells.get(this.ref)?.obj}get data(){return this.obj?.data}update(e,t){if(!this.state)throw Error(`To use update() from StateObjectSelector, 'state' must be defined.`);return t||=this.state.build(),(t||this.state.build()).to(this).update(e),t}checkValid(){if(!this.state)throw Error(`Unassigned State.`);let e=this.cell;if(!e)throw Error(`Not created at all. Did you await/then the corresponding state update?`);if(e.status===`ok`)return!0;throw e.status===`error`?Error(e.errorText):e.obj===Mx.Null?Error(`The object is Null.`):Error(`Unresolved. Did you await/then the corresponding state update?`)}get isOk(){let e=this.cell;return e&&e.status===`ok`&&e.obj!==Mx.Null}constructor(e,t){this.ref=e,this.state=t}},Fx;(function(e){function t(e){if(e)return typeof e==`string`?e:Nx.is(e)?e.transform.ref:e.cell?.transform.ref}e.resolveRef=t;function n(e,t){if(t)return Nx.is(t)?t:typeof t==`string`?e.cells.get(t):t.cell}e.resolve=n;function r(e,t){let r=n(e,t);if(!(!r||!r.obj||r.status!==`ok`))return r}e.resolveAndCheck=r})(Fx||={});var Ix=`@@__IMMUTABLE_INDEXED__@@`;function Lx(e){return!!(e&&e[Ix])}var Rx=`@@__IMMUTABLE_KEYED__@@`;function zx(e){return!!(e&&e[Rx])}function Bx(e){return zx(e)||Lx(e)}var Vx=`@@__IMMUTABLE_ITERABLE__@@`;function Hx(e){return!!(e&&e[Vx])}var Ux=function(e){return Hx(e)?e:jS(e)},Wx=function(e){function t(e){return zx(e)?e:MS(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ux),Gx=function(e){function t(e){return Lx(e)?e:NS(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ux),Kx=function(e){function t(e){return Hx(e)&&!Bx(e)?e:PS(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Ux);Ux.Keyed=Wx,Ux.Indexed=Gx,Ux.Set=Kx;var qx=0,Jx=1,Yx=2,Xx=typeof Symbol==`function`&&Symbol.iterator,Zx=`@@iterator`,Qx=Xx||Zx,$x=function(e){this.next=e};$x.prototype.toString=function(){return`[Iterator]`},$x.KEYS=qx,$x.VALUES=Jx,$x.ENTRIES=Yx,$x.prototype.inspect=$x.prototype.toSource=function(){return this.toString()},$x.prototype[Qx]=function(){return this};function eS(e,t,n,r){var i=e===qx?t:e===Jx?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function tS(){return{value:void 0,done:!0}}function nS(e){return Array.isArray(e)?!0:!!aS(e)}function rS(e){return!!(e&&typeof e.next==`function`)}function iS(e){var t=aS(e);return t&&t.call(e)}function aS(e){var t=e&&(Xx&&e[Xx]||e[Zx]);if(typeof t==`function`)return t}function Sde(e){var t=aS(e);return t&&t===e.entries}function Cde(e){var t=aS(e);return t&&t===e.keys}var oS=`delete`,sS=5,cS=1<<sS,lS=cS-1,uS={};function dS(){return{value:!1}}function fS(e){e&&(e.value=!0)}function pS(){}function mS(e){return e.size===void 0&&(e.size=e.__iterate(gS)),e.size}function hS(e,t){if(typeof t!=`number`){var n=t>>>0;if(``+n!==t||n===4294967295)return NaN;t=n}return t<0?mS(e)+t:t}function gS(){return!0}function _S(e,t,n){return(e===0&&!xS(e)||n!==void 0&&e<=-n)&&(t===void 0||n!==void 0&&t>=n)}function vS(e,t){return bS(e,t,0)}function yS(e,t){return bS(e,t,t)}function bS(e,t,n){return e===void 0?n:xS(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function xS(e){return e<0||e===0&&1/e==-1/0}var SS=`@@__IMMUTABLE_RECORD__@@`;function CS(e){return!!(e&&e[SS])}function wS(e){return Hx(e)||CS(e)}var TS=`@@__IMMUTABLE_ORDERED__@@`;function ES(e){return!!(e&&e[TS])}var DS=`@@__IMMUTABLE_SEQ__@@`;function OS(e){return!!(e&&e[DS])}var kS=Object.prototype.hasOwnProperty;function AS(e){return Array.isArray(e)||typeof e==`string`?!0:e&&typeof e==`object`&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var jS=function(e){function t(e){return e==null?LS():wS(e)?e.toSeq():Ede(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString(`Seq {`,`}`)},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(e,t){var n=this._cache;if(n){for(var r=n.length,i=0;i!==r;){var a=n[t?r-++i:i++];if(e(a[1],a[0],this)===!1)break}return i}return this.__iterateUncached(e,t)},t.prototype.__iterator=function(e,t){var n=this._cache;if(n){var r=n.length,i=0;return new $x(function(){if(i===r)return tS();var a=n[t?r-++i:i++];return eS(e,a[0],a[1])})}return this.__iteratorUncached(e,t)},t}(Ux),MS=function(e){function t(e){return e==null?LS().toKeyedSeq():Hx(e)?zx(e)?e.toSeq():e.fromEntrySeq():CS(e)?e.toSeq():RS(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(jS),NS=function(e){function t(e){return e==null?LS():Hx(e)?zx(e)?e.entrySeq():e.toIndexedSeq():CS(e)?e.toSeq().entrySeq():zS(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString(`Seq [`,`]`)},t}(jS),PS=function(e){function t(e){return(Hx(e)&&!Bx(e)?e:NS(e)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(jS);jS.isSeq=OS,jS.Keyed=MS,jS.Set=PS,jS.Indexed=NS,jS.prototype[DS]=!0;var FS=function(e){function t(e){this._array=e,this.size=e.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this.has(e)?this._array[hS(this,e)]:t},t.prototype.__iterate=function(e,t){for(var n=this._array,r=n.length,i=0;i!==r;){var a=t?r-++i:i++;if(e(n[a],a,this)===!1)break}return i},t.prototype.__iterator=function(e,t){var n=this._array,r=n.length,i=0;return new $x(function(){if(i===r)return tS();var a=t?r-++i:i++;return eS(e,a,n[a])})},t}(NS),IS=function(e){function t(e){var t=Object.keys(e).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]);this._object=e,this._keys=t,this.size=t.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return t!==void 0&&!this.has(e)?t:this._object[e]},t.prototype.has=function(e){return kS.call(this._object,e)},t.prototype.__iterate=function(e,t){for(var n=this._object,r=this._keys,i=r.length,a=0;a!==i;){var o=r[t?i-++a:a++];if(e(n[o],o,this)===!1)break}return a},t.prototype.__iterator=function(e,t){var n=this._object,r=this._keys,i=r.length,a=0;return new $x(function(){if(a===i)return tS();var o=r[t?i-++a:a++];return eS(e,o,n[o])})},t}(MS);IS.prototype[TS]=!0;var wde=function(e){function t(e){this._collection=e,this.size=e.length||e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._collection,r=iS(n),i=0;if(rS(r))for(var a;!(a=r.next()).done&&e(a.value,i++,this)!==!1;);return i},t.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._collection,r=iS(n);if(!rS(r))return new $x(tS);var i=0;return new $x(function(){var t=r.next();return t.done?t:eS(e,i++,t.value)})},t}(NS),Tde;function LS(){return Tde||=new FS([])}function RS(e){var t=BS(e);if(t)return t.fromEntrySeq();if(typeof e==`object`)return new IS(e);throw TypeError(`Expected Array or collection object of [k, v] entries, or keyed object: `+e)}function zS(e){var t=BS(e);if(t)return t;throw TypeError(`Expected Array or collection object of values: `+e)}function Ede(e){var t=BS(e);if(t)return Sde(e)?t.fromEntrySeq():Cde(e)?t.toSetSeq():t;if(typeof e==`object`)return new IS(e);throw TypeError(`Expected Array or collection object of values, or keyed object: `+e)}function BS(e){return AS(e)?new FS(e):nS(e)?new wde(e):void 0}function VS(){return this.__ensureOwner()}function HS(){return this.__ownerID?this:this.__ensureOwner(new pS)}var US=typeof Math.imul==`function`?Math.imul:function(e,t){e|=0,t|=0;var n=e&65535,r=t&65535;return n*r+((e>>>16)*r+n*(t>>>16)<<16>>>0)|0};function WS(e){return e>>>1&1073741824|e&3221225471}var Dde=Object.prototype.valueOf;function GS(e){if(e==null)return KS(e);if(typeof e.hashCode==`function`)return WS(e.hashCode(e));var t=Nde(e);if(t==null)return KS(t);switch(typeof t){case`boolean`:return t?1108378657:1108378656;case`number`:return Ode(t);case`string`:return t.length>Pde?kde(t):qS(t);case`object`:case`function`:return jde(t);case`symbol`:return Ade(t);default:if(typeof t.toString==`function`)return qS(t.toString());throw Error(`Value type `+typeof t+` cannot be hashed.`)}}function KS(e){return e===null?1108378658:1108378659}function Ode(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return WS(t)}function kde(e){var t=rC[e];return t===void 0&&(t=qS(e),nC===Fde&&(nC=0,rC={}),nC++,rC[e]=t),t}function qS(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return WS(t)}function Ade(e){var t=$S[e];return t===void 0?(t=XS(),$S[e]=t,t):t}function jde(e){var t;if(ZS&&(t=QS.get(e),t!==void 0)||(t=e[tC],t!==void 0)||!YS&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[tC],t!==void 0||(t=Mde(e),t!==void 0)))return t;if(t=XS(),ZS)QS.set(e,t);else if(JS!==void 0&&JS(e)===!1)throw Error(`Non-extensible objects are not allowed as keys.`);else if(YS)Object.defineProperty(e,tC,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[tC]=t;else if(e.nodeType!==void 0)e[tC]=t;else throw Error(`Unable to set a non-enumerable property on object.`);return t}var JS=Object.isExtensible,YS=(function(){try{return Object.defineProperty({},`@`,{}),!0}catch{return!1}})();function Mde(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function Nde(e){return e.valueOf!==Dde&&typeof e.valueOf==`function`?e.valueOf(e):e}function XS(){var e=++eC;return eC&1073741824&&(eC=0),e}var ZS=typeof WeakMap==`function`,QS;ZS&&(QS=new WeakMap);var $S=Object.create(null),eC=0,tC=`__immutablehash__`;typeof Symbol==`function`&&(tC=Symbol(tC));var Pde=16,Fde=255,nC=0,rC={},iC=function(e){function t(e,t){this._iter=e,this._useKeys=t,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this._iter.get(e,t)},t.prototype.has=function(e){return this._iter.has(e)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var e=this,t=uC(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},t.prototype.map=function(e,t){var n=this,r=lC(this,e,t);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t,r){return e(t,r,n)},t)},t.prototype.__iterator=function(e,t){return this._iter.__iterator(e,t)},t}(MS);iC.prototype[TS]=!0;var aC=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this,r=0;return t&&mS(this),this._iter.__iterate(function(i){return e(i,t?n.size-++r:r++,n)},t)},t.prototype.__iterator=function(e,t){var n=this,r=this._iter.__iterator(Jx,t),i=0;return t&&mS(this),new $x(function(){var a=r.next();return a.done?a:eS(e,t?n.size-++i:i++,a.value,a)})},t}(NS),oC=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(Jx,t);return new $x(function(){var t=n.next();return t.done?t:eS(e,t.value,t.value,t)})},t}(PS),sC=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){if(t){bC(t);var r=Hx(t);return e(r?t.get(1):t[1],r?t.get(0):t[0],n)}},t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(Jx,t);return new $x(function(){for(;;){var t=n.next();if(t.done)return t;var r=t.value;if(r){bC(r);var i=Hx(r);return eS(e,i?r.get(0):r[0],i?r.get(1):r[1],t)}}})},t}(MS);aC.prototype.cacheResult=iC.prototype.cacheResult=oC.prototype.cacheResult=sC.prototype.cacheResult=CC;function cC(e){var t=SC(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=CC,t.__iterateUncached=function(t,n){var r=this;return e.__iterate(function(e,n){return t(n,e,r)!==!1},n)},t.__iteratorUncached=function(t,n){if(t===Yx){var r=e.__iterator(t,n);return new $x(function(){var e=r.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===Jx?qx:Jx,n)},t}function lC(e,t,n){var r=SC(e);return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var a=e.get(r,uS);return a===uS?i:t.call(n,a,r,e)},r.__iterateUncached=function(r,i){var a=this;return e.__iterate(function(e,i,o){return r(t.call(n,e,i,o),i,a)!==!1},i)},r.__iteratorUncached=function(r,i){var a=e.__iterator(Yx,i);return new $x(function(){var i=a.next();if(i.done)return i;var o=i.value,s=o[0];return eS(r,s,t.call(n,o[1],s,e),i)})},r}function uC(e,t){var n=this,r=SC(e);return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var t=cC(e);return t.reverse=function(){return e.flip()},t}),r.get=function(n,r){return e.get(t?n:-1-n,r)},r.has=function(n){return e.has(t?n:-1-n)},r.includes=function(t){return e.includes(t)},r.cacheResult=CC,r.__iterate=function(n,r){var i=this,a=0;return r&&mS(e),e.__iterate(function(e,o){return n(e,t?o:r?i.size-++a:a++,i)},!r)},r.__iterator=function(r,i){var a=0;i&&mS(e);var o=e.__iterator(Yx,!i);return new $x(function(){var e=o.next();if(e.done)return e;var s=e.value;return eS(r,t?s[0]:i?n.size-++a:a++,s[1],e)})},r}function dC(e,t,n,r){var i=SC(e);return r&&(i.has=function(r){var i=e.get(r,uS);return i!==uS&&!!t.call(n,i,r,e)},i.get=function(r,i){var a=e.get(r,uS);return a!==uS&&t.call(n,a,r,e)?a:i}),i.__iterateUncached=function(i,a){var o=this,s=0;return e.__iterate(function(e,a,c){if(t.call(n,e,a,c))return s++,i(e,r?a:s-1,o)},a),s},i.__iteratorUncached=function(i,a){var o=e.__iterator(Yx,a),s=0;return new $x(function(){for(;;){var a=o.next();if(a.done)return a;var c=a.value,l=c[0],u=c[1];if(t.call(n,u,l,e))return eS(i,r?l:s++,u,a)}})},i}function Ide(e,t,n){var r=YC().asMutable();return e.__iterate(function(i,a){r.update(t.call(n,i,a,e),0,function(e){return e+1})}),r.asImmutable()}function Lde(e,t,n){var r=zx(e),i=(ES(e)?Nw():YC()).asMutable();e.__iterate(function(a,o){i.update(t.call(n,a,o,e),function(e){return e||=[],e.push(r?[o,a]:a),e})});var a=xC(e);return i.map(function(t){return yC(e,a(t))}).asImmutable()}function Rde(e,t,n){var r=zx(e),i=[[],[]];e.__iterate(function(a,o){i[t.call(n,a,o,e)?1:0].push(r?[o,a]:a)});var a=xC(e);return i.map(function(t){return yC(e,a(t))})}function fC(e,t,n,r){var i=e.size;if(_S(t,n,i))return e;if(i===void 0&&(t<0||n<0))return fC(e.toSeq().cacheResult(),t,n,r);var a=vS(t,i),o=yS(n,i)-a,s;o===o&&(s=o<0?0:o);var c=SC(e);return c.size=s===0?s:e.size&&s||void 0,!r&&OS(e)&&s>=0&&(c.get=function(t,n){return t=hS(this,t),t>=0&&t<s?e.get(t+a,n):n}),c.__iterateUncached=function(t,n){var i=this;if(s===0)return 0;if(n)return this.cacheResult().__iterate(t,n);var o=0,c=!0,l=0;return e.__iterate(function(e,n){if(!(c&&=o++<a))return l++,t(e,r?n:l-1,i)!==!1&&l!==s}),l},c.__iteratorUncached=function(t,n){if(s!==0&&n)return this.cacheResult().__iterator(t,n);if(s===0)return new $x(tS);var i=e.__iterator(t,n),o=0,c=0;return new $x(function(){for(;o++<a;)i.next();if(++c>s)return tS();var e=i.next();return r||t===Jx||e.done?e:t===qx?eS(t,c-1,void 0,e):eS(t,c-1,e.value[1],e)})},c}function zde(e,t,n){var r=SC(e);return r.__iterateUncached=function(r,i){var a=this;if(i)return this.cacheResult().__iterate(r,i);var o=0;return e.__iterate(function(e,i,s){return t.call(n,e,i,s)&&++o&&r(e,i,a)}),o},r.__iteratorUncached=function(r,i){var a=this;if(i)return this.cacheResult().__iterator(r,i);var o=e.__iterator(Yx,i),s=!0;return new $x(function(){if(!s)return tS();var e=o.next();if(e.done)return e;var i=e.value,c=i[0],l=i[1];return t.call(n,l,c,a)?r===Yx?e:eS(r,c,l,e):(s=!1,tS())})},r}function pC(e,t,n,r){var i=SC(e);return i.__iterateUncached=function(i,a){var o=this;if(a)return this.cacheResult().__iterate(i,a);var s=!0,c=0;return e.__iterate(function(e,a,l){if(!(s&&=t.call(n,e,a,l)))return c++,i(e,r?a:c-1,o)}),c},i.__iteratorUncached=function(i,a){var o=this;if(a)return this.cacheResult().__iterator(i,a);var s=e.__iterator(Yx,a),c=!0,l=0;return new $x(function(){var e,a,u;do{if(e=s.next(),e.done)return r||i===Jx?e:i===qx?eS(i,l++,void 0,e):eS(i,l++,e.value[1],e);var d=e.value;a=d[0],u=d[1],c&&=t.call(n,u,a,o)}while(c);return i===Yx?e:eS(i,a,u,e)})},i}var Bde=function(e){function t(e){this._wrappedIterables=e.flatMap(function(e){return e._wrappedIterables?e._wrappedIterables:[e]}),this.size=this._wrappedIterables.reduce(function(e,t){if(e!==void 0){var n=t.size;if(n!==void 0)return e+n}},0),this[Rx]=this._wrappedIterables[0][Rx],this[Ix]=this._wrappedIterables[0][Ix],this[TS]=this._wrappedIterables[0][TS]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(e,t){if(this._wrappedIterables.length!==0){if(t)return this.cacheResult().__iterate(e,t);for(var n=0,r=zx(this),i=r?Yx:Jx,a=this._wrappedIterables[n].__iterator(i,t),o=!0,s=0;o;){for(var c=a.next();c.done;){if(n++,n===this._wrappedIterables.length)return s;a=this._wrappedIterables[n].__iterator(i,t),c=a.next()}o=(r?e(c.value[1],c.value[0],this):e(c.value,s,this))!==!1,s++}return s}},t.prototype.__iteratorUncached=function(e,t){var n=this;if(this._wrappedIterables.length===0)return new $x(tS);if(t)return this.cacheResult().__iterator(e,t);var r=0,i=this._wrappedIterables[r].__iterator(e,t);return new $x(function(){for(var a=i.next();a.done;){if(r++,r===n._wrappedIterables.length)return a;i=n._wrappedIterables[r].__iterator(e,t),a=i.next()}return a})},t}(jS);function Vde(e,t){var n=zx(e),r=[e].concat(t).map(function(e){return Hx(e)?n&&(e=Wx(e)):e=n?RS(e):zS(Array.isArray(e)?e:[e]),e}).filter(function(e){return e.size!==0});if(r.length===0)return e;if(r.length===1){var i=r[0];if(i===e||n&&zx(i)||Lx(e)&&Lx(i))return i}return new Bde(r)}function mC(e,t,n){var r=SC(e);return r.__iterateUncached=function(i,a){if(a)return this.cacheResult().__iterate(i,a);var o=0,s=!1;function c(e,l){e.__iterate(function(e,a){return(!t||l<t)&&Hx(e)?c(e,l+1):(o++,i(e,n?a:o-1,r)===!1&&(s=!0)),!s},a)}return c(e,0),o},r.__iteratorUncached=function(r,i){if(i)return this.cacheResult().__iterator(r,i);var a=e.__iterator(r,i),o=[],s=0;return new $x(function(){for(;a;){var e=a.next();if(e.done!==!1){a=o.pop();continue}var c=e.value;if(r===Yx&&(c=c[1]),(!t||o.length<t)&&Hx(c))o.push(a),a=c.__iterator(r,i);else return n?e:eS(r,s++,c,e)}return tS()})},r}function Hde(e,t,n){var r=xC(e);return e.toSeq().map(function(i,a){return r(t.call(n,i,a,e))}).flatten(!0)}function Ude(e,t){var n=SC(e);return n.size=e.size&&e.size*2-1,n.__iterateUncached=function(n,r){var i=this,a=0;return e.__iterate(function(e){return(!a||n(t,a++,i)!==!1)&&n(e,a++,i)!==!1},r),a},n.__iteratorUncached=function(n,r){var i=e.__iterator(Jx,r),a=0,o;return new $x(function(){return(!o||a%2)&&(o=i.next(),o.done)?o:a%2?eS(n,a++,t):eS(n,a++,o.value,o)})},n}function hC(e,t,n){t||=wC;var r=zx(e),i=0,a=e.toSeq().map(function(t,r){return[r,t,i++,n?n(t,r,e):t]}).valueSeq().toArray();return a.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){a[t].length=2}:function(e,t){a[t]=e[1]}),r?MS(a):Lx(e)?NS(a):PS(a)}function gC(e,t,n){if(t||=wC,n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return _C(t,e[1],n[1])?n:e});return r&&r[0]}return e.reduce(function(e,n){return _C(t,e,n)?n:e})}function _C(e,t,n){var r=e(n,t);return r===0&&n!==t&&(n==null||n!==n)||r>0}function vC(e,t,n,r){var i=SC(e),a=new FS(n).map(function(e){return e.size});return i.size=r?a.max():a.min(),i.__iterate=function(e,t){for(var n=this.__iterator(Jx,t),r,i=0;!(r=n.next()).done&&e(r.value,i++,this)!==!1;);return i},i.__iteratorUncached=function(e,i){var a=n.map(function(e){return e=Ux(e),iS(i?e.reverse():e)}),o=0,s=!1;return new $x(function(){var n;return s||=(n=a.map(function(e){return e.next()}),r?n.every(function(e){return e.done}):n.some(function(e){return e.done})),s?tS():eS(e,o++,t.apply(null,n.map(function(e){return e.value})))})},i}function yC(e,t){return e===t?e:OS(e)?t:e.constructor(t)}function bC(e){if(e!==Object(e))throw TypeError(`Expected [K, V] tuple: `+e)}function xC(e){return zx(e)?Wx:Lx(e)?Gx:Kx}function SC(e){return Object.create((zx(e)?MS:Lx(e)?NS:PS).prototype)}function CC(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):jS.prototype.cacheResult.call(this)}function wC(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function TC(e){return!!(e&&typeof e.equals==`function`&&typeof e.hashCode==`function`)}function EC(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf==`function`&&typeof t.valueOf==`function`){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(TC(e)&&TC(t)&&e.equals(t))}function DC(e,t,n,r){return hw(e,[t],n,r)}function OC(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return AC(this,e)}function kC(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(typeof e!=`function`)throw TypeError(`Invalid merger function: `+e);return AC(this,t,e)}function AC(e,t,n){for(var r=[],i=0;i<t.length;i++){var a=Wx(t[i]);a.size!==0&&r.push(a)}return r.length===0?e:e.toSeq().size===0&&!e.__ownerID&&r.length===1?CS(e)?e:e.constructor(r[0]):e.withMutations(function(e){for(var t=n?function(t,r){DC(e,r,uS,function(e){return e===uS?t:n(e,t,r)})}:function(t,n){e.set(n,t)},i=0;i<r.length;i++)r[i].forEach(t)})}var Wde=Object.prototype.toString;function Gde(e){if(!e||typeof e!=`object`||Wde.call(e)!==`[object Object]`)return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var n=t,r=Object.getPrototypeOf(t);r!==null;)n=r,r=Object.getPrototypeOf(n);return n===t}function jC(e){return typeof e==`object`&&(wS(e)||Array.isArray(e)||Gde(e))}function MC(e,t){t||=0;for(var n=Math.max(0,e.length-t),r=Array(n),i=0;i<n;i++)r[i]=e[i+t];return r}function NC(e){if(Array.isArray(e))return MC(e);var t={};for(var n in e)kS.call(e,n)&&(t[n]=e[n]);return t}function PC(e,t,n){return FC(e,t,Kde(n))}function FC(e,t,n){if(!jC(e))throw TypeError(`Cannot merge into non-data-structure value: `+e);if(wS(e))return typeof n==`function`&&e.mergeWith?e.mergeWith.apply(e,[n].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var r=Array.isArray(e),i=e,a=r?Gx:Wx,o=r?function(t){i===e&&(i=NC(i)),i.push(t)}:function(t,r){var a=kS.call(i,r),o=a&&n?n(i[r],t,r):t;(!a||o!==i[r])&&(i===e&&(i=NC(i)),i[r]=o)},s=0;s<t.length;s++)a(t[s]).forEach(o);return i}function Kde(e){function t(n,r,i){return jC(n)&&jC(r)&&qde(n,r)?FC(n,[r],t):e?e(n,r,i):r}return t}function qde(e,t){var n=jS(e),r=jS(t);return Lx(n)===Lx(r)&&zx(n)===zx(r)}function IC(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return PC(this,e)}function LC(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return PC(this,t,e)}function RC(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return hw(this,e,aw(),function(e){return PC(e,t)})}function zC(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return hw(this,e,aw(),function(e){return FC(e,t)})}function Jde(e,t,n){return hw(e,t,uS,function(){return n})}function BC(e,t){return Jde(this,e,t)}function VC(e,t,n){return arguments.length===1?e(this):DC(this,e,t,n)}function HC(e,t,n){return hw(this,e,t,n)}function UC(){return this.__altered}function WC(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}var GC=`@@__IMMUTABLE_MAP__@@`;function KC(e){return!!(e&&e[GC])}function qC(e,t){if(!e)throw Error(t)}function JC(e){qC(e!==1/0,`Cannot perform this action with an infinite size.`)}var YC=function(e){function t(t){return t==null?aw():KC(t)&&!ES(t)?t:aw().withMutations(function(n){var r=e(t);JC(r.size),r.forEach(function(e,t){return n.set(t,e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.__toString(`Map {`,`}`)},t.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},t.prototype.set=function(e,t){return ow(this,e,t)},t.prototype.remove=function(e){return ow(this,e,uS)},t.prototype.deleteAll=function(e){var t=Ux(e);return t.size===0?this:this.withMutations(function(e){t.forEach(function(t){return e.remove(t)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):aw()},t.prototype.sort=function(e){return Nw(hC(this,e))},t.prototype.sortBy=function(e,t){return Nw(hC(this,t,e))},t.prototype.map=function(e,t){var n=this;return this.withMutations(function(r){r.forEach(function(i,a){r.set(a,e.call(t,i,a,n))})})},t.prototype.__iterator=function(e,t){return new Yde(this,e,t)},t.prototype.__iterate=function(e,t){var n=this,r=0;return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?iw(this.size,this._root,e,this.__hash):this.size===0?aw():(this.__ownerID=e,this.__altered=!1,this)},t}(Wx);YC.isMap=KC;var XC=YC.prototype;XC[GC]=!0,XC[oS]=XC.remove,XC.removeAll=XC.deleteAll,XC.setIn=BC,XC.removeIn=XC.deleteIn=_w,XC.update=VC,XC.updateIn=HC,XC.merge=XC.concat=OC,XC.mergeWith=kC,XC.mergeDeep=IC,XC.mergeDeepWith=LC,XC.mergeIn=zC,XC.mergeDeepIn=RC,XC.withMutations=WC,XC.wasAltered=UC,XC.asImmutable=VS,XC[`@@transducer/init`]=XC.asMutable=HS,XC[`@@transducer/step`]=function(e,t){return e.set(t[0],t[1])},XC[`@@transducer/result`]=function(e){return e.asImmutable()};var ZC=function(e,t){this.ownerID=e,this.entries=t};ZC.prototype.get=function(e,t,n,r){for(var i=this.entries,a=0,o=i.length;a<o;a++)if(EC(n,i[a][0]))return i[a][1];return r},ZC.prototype.update=function(e,t,n,r,i,a,o){for(var s=i===uS,c=this.entries,l=0,u=c.length;l<u&&!EC(r,c[l][0]);l++);var d=l<u;if(d?c[l][1]===i:s)return this;if(fS(o),(s||!d)&&fS(a),!(s&&c.length===1)){if(!d&&!s&&c.length>=nfe)return Zde(e,c,r,i);var f=e&&e===this.ownerID,p=f?c:MC(c);return d?s?l===u-1?p.pop():p[l]=p.pop():p[l]=[r,i]:p.push([r,i]),f?(this.entries=p,this):new ZC(e,p)}};var QC=function(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n};QC.prototype.get=function(e,t,n,r){t===void 0&&(t=GS(n));var i=1<<((e===0?t:t>>>e)&lS),a=this.bitmap;return(a&i)===0?r:this.nodes[uw(a&i-1)].get(e+sS,t,n,r)},QC.prototype.update=function(e,t,n,r,i,a,o){n===void 0&&(n=GS(r));var s=(t===0?n:n>>>t)&lS,c=1<<s,l=this.bitmap,u=(l&c)!==0;if(!u&&i===uS)return this;var d=uw(l&c-1),f=this.nodes,p=u?f[d]:void 0,m=sw(p,e,t+sS,n,r,i,a,o);if(m===p)return this;if(!u&&m&&f.length>=rfe)return $de(e,f,l,s,m);if(u&&!m&&f.length===2&&cw(f[d^1]))return f[d^1];if(u&&m&&f.length===1&&cw(m))return m;var h=e&&e===this.ownerID,g=u?m?l:l^c:l|c,_=u?m?dw(f,d,m,h):tfe(f,d,h):efe(f,d,m,h);return h?(this.bitmap=g,this.nodes=_,this):new QC(e,g,_)};var $C=function(e,t,n){this.ownerID=e,this.count=t,this.nodes=n};$C.prototype.get=function(e,t,n,r){t===void 0&&(t=GS(n));var i=(e===0?t:t>>>e)&lS,a=this.nodes[i];return a?a.get(e+sS,t,n,r):r},$C.prototype.update=function(e,t,n,r,i,a,o){n===void 0&&(n=GS(r));var s=(t===0?n:n>>>t)&lS,c=i===uS,l=this.nodes,u=l[s];if(c&&!u)return this;var d=sw(u,e,t+sS,n,r,i,a,o);if(d===u)return this;var f=this.count;if(!u)f++;else if(!d&&(f--,f<ife))return Qde(e,l,f,s);var p=e&&e===this.ownerID,m=dw(l,s,d,p);return p?(this.count=f,this.nodes=m,this):new $C(e,f,m)};var ew=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n};ew.prototype.get=function(e,t,n,r){for(var i=this.entries,a=0,o=i.length;a<o;a++)if(EC(n,i[a][0]))return i[a][1];return r},ew.prototype.update=function(e,t,n,r,i,a,o){n===void 0&&(n=GS(r));var s=i===uS;if(n!==this.keyHash)return s?this:(fS(o),fS(a),lw(this,e,t,n,[r,i]));for(var c=this.entries,l=0,u=c.length;l<u&&!EC(r,c[l][0]);l++);var d=l<u;if(d?c[l][1]===i:s)return this;if(fS(o),(s||!d)&&fS(a),s&&u===2)return new tw(e,this.keyHash,c[l^1]);var f=e&&e===this.ownerID,p=f?c:MC(c);return d?s?l===u-1?p.pop():p[l]=p.pop():p[l]=[r,i]:p.push([r,i]),f?(this.entries=p,this):new ew(e,this.keyHash,p)};var tw=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n};tw.prototype.get=function(e,t,n,r){return EC(n,this.entry[0])?this.entry[1]:r},tw.prototype.update=function(e,t,n,r,i,a,o){var s=i===uS,c=EC(r,this.entry[0]);if(c?i===this.entry[1]:s)return this;if(fS(o),s){fS(a);return}return c?e&&e===this.ownerID?(this.entry[1]=i,this):new tw(e,this.keyHash,[r,i]):(fS(a),lw(this,e,t,GS(r),[r,i]))},ZC.prototype.iterate=ew.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;r<=i;r++)if(e(n[t?i-r:r])===!1)return!1},QC.prototype.iterate=$C.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;r<=i;r++){var a=n[t?i-r:r];if(a&&a.iterate(e,t)===!1)return!1}},tw.prototype.iterate=function(e,t){return e(this.entry)};var Yde=function(e){function t(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&rw(e._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n=t.node,r=t.index++,i=void 0;if(n.entry){if(r===0)return nw(e,n.entry)}else if(n.entries){if(i=n.entries.length-1,r<=i)return nw(e,n.entries[this._reverse?i-r:r])}else if(i=n.nodes.length-1,r<=i){var a=n.nodes[this._reverse?i-r:r];if(a){if(a.entry)return nw(e,a.entry);t=this._stack=rw(a,t)}continue}t=this._stack=this._stack.__prev}return tS()},t}($x);function nw(e,t){return eS(e,t[0],t[1])}function rw(e,t){return{node:e,index:0,__prev:t}}function iw(e,t,n,r){var i=Object.create(XC);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}var Xde;function aw(){return Xde||=iw(0)}function ow(e,t,n){var r,i;if(e._root){var a=dS(),o=dS();if(r=sw(e._root,e.__ownerID,0,void 0,t,n,a,o),!o.value)return e;i=e.size+(a.value?n===uS?-1:1:0)}else{if(n===uS)return e;i=1,r=new ZC(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=i,e._root=r,e.__hash=void 0,e.__altered=!0,e):r?iw(i,r):aw()}function sw(e,t,n,r,i,a,o,s){return e?e.update(t,n,r,i,a,o,s):a===uS?e:(fS(s),fS(o),new tw(t,r,[i,a]))}function cw(e){return e.constructor===tw||e.constructor===ew}function lw(e,t,n,r,i){if(e.keyHash===r)return new ew(t,r,[e.entry,i]);var a=(n===0?e.keyHash:e.keyHash>>>n)&lS,o=(n===0?r:r>>>n)&lS,s,c=a===o?[lw(e,t,n+sS,r,i)]:(s=new tw(t,r,i),a<o?[e,s]:[s,e]);return new QC(t,1<<a|1<<o,c)}function Zde(e,t,n,r){e||=new pS;for(var i=new tw(e,GS(n),[n,r]),a=0;a<t.length;a++){var o=t[a];i=i.update(e,0,void 0,o[0],o[1])}return i}function Qde(e,t,n,r){for(var i=0,a=0,o=Array(n),s=0,c=1,l=t.length;s<l;s++,c<<=1){var u=t[s];u!==void 0&&s!==r&&(i|=c,o[a++]=u)}return new QC(e,i,o)}function $de(e,t,n,r,i){for(var a=0,o=Array(cS),s=0;n!==0;s++,n>>>=1)o[s]=n&1?t[a++]:void 0;return o[r]=i,new $C(e,a+1,o)}function uw(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function dw(e,t,n,r){var i=r?e:MC(e);return i[t]=n,i}function efe(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;for(var a=Array(i),o=0,s=0;s<i;s++)s===t?(a[s]=n,o=-1):a[s]=e[s+o];return a}function tfe(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;for(var i=Array(r),a=0,o=0;o<r;o++)o===t&&(a=1),i[o]=e[o+a];return i}var nfe=cS/4,rfe=cS/2,ife=cS/4;function fw(e){if(AS(e)&&typeof e!=`string`)return e;if(ES(e))return e.toArray();throw TypeError(`Invalid keyPath: expected Ordered Collection or Array: `+e)}function pw(e){try{return typeof e==`string`?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function afe(e,t){return wS(e)?e.has(t):jC(e)&&kS.call(e,t)}function mw(e,t,n){return wS(e)?e.get(t,n):afe(e,t)?typeof e.get==`function`?e.get(t):e[t]:n}function ofe(e,t){if(!jC(e))throw TypeError(`Cannot update non-data-structure value: `+e);if(wS(e)){if(!e.remove)throw TypeError(`Cannot update immutable value without .remove() method: `+e);return e.remove(t)}if(!kS.call(e,t))return e;var n=NC(e);return Array.isArray(n)?n.splice(t,1):delete n[t],n}function sfe(e,t,n){if(!jC(e))throw TypeError(`Cannot update non-data-structure value: `+e);if(wS(e)){if(!e.set)throw TypeError(`Cannot update immutable value without .set() method: `+e);return e.set(t,n)}if(kS.call(e,t)&&n===e[t])return e;var r=NC(e);return r[t]=n,r}function hw(e,t,n,r){r||(r=n,n=void 0);var i=gw(wS(e),e,fw(t),0,n,r);return i===uS?n:i}function gw(e,t,n,r,i,a){var o=t===uS;if(r===n.length){var s=o?i:t,c=a(s);return c===s?t:c}if(!o&&!jC(t))throw TypeError(`Cannot update within non-data-structure value in path [`+Array.from(n).slice(0,r).map(pw)+`]: `+t);var l=n[r],u=o?uS:mw(t,l,uS),d=gw(u===uS?e:wS(u),u,n,r+1,i,a);return d===u?t:d===uS?ofe(t,l):sfe(o?e?aw():{}:t,l,d)}function cfe(e,t){return hw(e,t,function(){return uS})}function _w(e){return cfe(this,e)}var vw=`@@__IMMUTABLE_LIST__@@`;function yw(e){return!!(e&&e[vw])}var bw=function(e){function t(t){var n=Ew();if(t==null)return n;if(yw(t))return t;var r=e(t),i=r.size;return i===0?n:(JC(i),i>0&&i<cS?Tw(0,i,sS,null,new Sw(r.toArray())):n.withMutations(function(e){e.setSize(i),r.forEach(function(t,n){return e.set(n,t)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString(`List [`,`]`)},t.prototype.get=function(e,t){if(e=hS(this,e),e>=0&&e<this.size){e+=this._origin;var n=kw(this,e);return n&&n.array[e&lS]}return t},t.prototype.set=function(e,t){return lfe(this,e,t)},t.prototype.remove=function(e){return this.has(e)?e===0?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},t.prototype.insert=function(e,t){return this.splice(e,0,t)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=sS,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):Ew()},t.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){Aw(n,0,t+e.length);for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},t.prototype.pop=function(){return Aw(this,0,-1)},t.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){Aw(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},t.prototype.shift=function(){return Aw(this,1)},t.prototype.shuffle=function(e){return e===void 0&&(e=Math.random),this.withMutations(function(t){for(var n=t.size,r,i;n;)r=Math.floor(e()*n--),i=t.get(r),t.set(r,t.get(n)),t.set(n,i)})},t.prototype.concat=function(){for(var t=arguments,n=[],r=0;r<arguments.length;r++){var i=t[r],a=e(typeof i!=`string`&&nS(i)?i:[i]);a.size!==0&&n.push(a)}return n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(e){n.forEach(function(t){return t.forEach(function(t){return e.push(t)})})})},t.prototype.setSize=function(e){return Aw(this,0,e)},t.prototype.map=function(e,t){var n=this;return this.withMutations(function(r){for(var i=0;i<n.size;i++)r.set(i,e.call(t,r.get(i),i,n))})},t.prototype.slice=function(e,t){var n=this.size;return _S(e,t,n)?this:Aw(this,vS(e,n),yS(t,n))},t.prototype.__iterator=function(e,t){var n=t?this.size:0,r=ww(this,t);return new $x(function(){var i=r();return i===Cw?tS():eS(e,t?--n:n++,i)})},t.prototype.__iterate=function(e,t){for(var n=t?this.size:0,r=ww(this,t),i;(i=r())!==Cw&&e(i,t?--n:n++,this)!==!1;);return n},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Tw(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):this.size===0?Ew():(this.__ownerID=e,this.__altered=!1,this)},t}(Gx);bw.isList=yw;var xw=bw.prototype;xw[vw]=!0,xw[oS]=xw.remove,xw.merge=xw.concat,xw.setIn=BC,xw.deleteIn=xw.removeIn=_w,xw.update=VC,xw.updateIn=HC,xw.mergeIn=zC,xw.mergeDeepIn=RC,xw.withMutations=WC,xw.wasAltered=UC,xw.asImmutable=VS,xw[`@@transducer/init`]=xw.asMutable=HS,xw[`@@transducer/step`]=function(e,t){return e.push(t)},xw[`@@transducer/result`]=function(e){return e.asImmutable()};var Sw=function(e,t){this.array=e,this.ownerID=t};Sw.prototype.removeBefore=function(e,t,n){if(!(n&(1<<t+sS)-1)||this.array.length===0)return this;var r=n>>>t&lS;if(r>=this.array.length)return new Sw([],e);var i=r===0,a;if(t>0){var o=this.array[r];if(a=o&&o.removeBefore(e,t-sS,n),a===o&&i)return this}if(i&&!a)return this;var s=Ow(this,e);if(!i)for(var c=0;c<r;c++)s.array[c]=void 0;return a&&(s.array[r]=a),s},Sw.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t+sS:cS)||this.array.length===0)return this;var r=n-1>>>t&lS;if(r>=this.array.length)return this;var i;if(t>0){var a=this.array[r];if(i=a&&a.removeAfter(e,t-sS,n),i===a&&r===this.array.length-1)return this}var o=Ow(this,e);return o.array.splice(r+1),i&&(o.array[r]=i),o};var Cw={};function ww(e,t){var n=e._origin,r=e._capacity,i=jw(r),a=e._tail;return o(e._root,e._level,0);function o(e,t,n){return t===0?s(e,n):c(e,t,n)}function s(e,o){var s=o===i?a&&a.array:e&&e.array,c=o>n?0:n-o,l=r-o;return l>cS&&(l=cS),function(){if(c===l)return Cw;var e=t?--l:c++;return s&&s[e]}}function c(e,i,a){var s,c=e&&e.array,l=a>n?0:n-a>>i,u=(r-a>>i)+1;return u>cS&&(u=cS),function(){for(;;){if(s){var e=s();if(e!==Cw)return e;s=null}if(l===u)return Cw;var n=t?--u:l++;s=o(c&&c[n],i-sS,a+(n<<i))}}}}function Tw(e,t,n,r,i,a,o){var s=Object.create(xw);return s.size=t-e,s._origin=e,s._capacity=t,s._level=n,s._root=r,s._tail=i,s.__ownerID=a,s.__hash=o,s.__altered=!1,s}function Ew(){return Tw(0,0,sS)}function lfe(e,t,n){if(t=hS(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(e){t<0?Aw(e,t).set(0,n):Aw(e,0,t+1).set(t,n)});t+=e._origin;var r=e._tail,i=e._root,a=dS();return t>=jw(e._capacity)?r=Dw(r,e.__ownerID,0,t,n,a):i=Dw(i,e.__ownerID,e._level,t,n,a),a.value?e.__ownerID?(e._root=i,e._tail=r,e.__hash=void 0,e.__altered=!0,e):Tw(e._origin,e._capacity,e._level,i,r):e}function Dw(e,t,n,r,i,a){var o=r>>>n&lS,s=e&&o<e.array.length;if(!s&&i===void 0)return e;var c;if(n>0){var l=e&&e.array[o],u=Dw(l,t,n-sS,r,i,a);return u===l?e:(c=Ow(e,t),c.array[o]=u,c)}return s&&e.array[o]===i?e:(a&&fS(a),c=Ow(e,t),i===void 0&&o===c.array.length-1?c.array.pop():c.array[o]=i,c)}function Ow(e,t){return t&&e&&t===e.ownerID?e:new Sw(e?e.array.slice():[],t)}function kw(e,t){if(t>=jw(e._capacity))return e._tail;if(t<1<<e._level+sS){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&lS],r-=sS;return n}}function Aw(e,t,n){t!==void 0&&(t|=0),n!==void 0&&(n|=0);var r=e.__ownerID||new pS,i=e._origin,a=e._capacity,o=i+t,s=n===void 0?a:n<0?a+n:i+n;if(o===i&&s===a)return e;if(o>=s)return e.clear();for(var c=e._level,l=e._root,u=0;o+u<0;)l=new Sw(l&&l.array.length?[void 0,l]:[],r),c+=sS,u+=1<<c;u&&(o+=u,i+=u,s+=u,a+=u);for(var d=jw(a),f=jw(s);f>=1<<c+sS;)l=new Sw(l&&l.array.length?[l]:[],r),c+=sS;var p=e._tail,m=f<d?kw(e,s-1):f>d?new Sw([],r):p;if(p&&f>d&&o<a&&p.array.length){l=Ow(l,r);for(var h=l,g=c;g>sS;g-=sS){var _=d>>>g&lS;h=h.array[_]=Ow(h.array[_],r)}h.array[d>>>sS&lS]=p}if(s<a&&(m&&=m.removeAfter(r,0,s)),o>=f)o-=f,s-=f,c=sS,l=null,m&&=m.removeBefore(r,0,o);else if(o>i||f<d){for(u=0;l;){var v=o>>>c&lS;if(v!==f>>>c&lS)break;v&&(u+=(1<<c)*v),c-=sS,l=l.array[v]}l&&o>i&&(l=l.removeBefore(r,c,o-u)),l&&f<d&&(l=l.removeAfter(r,c,f-u)),u&&(o-=u,s-=u)}return e.__ownerID?(e.size=s-o,e._origin=o,e._capacity=s,e._level=c,e._root=l,e._tail=m,e.__hash=void 0,e.__altered=!0,e):Tw(o,s,c,l,m)}function jw(e){return e<cS?0:e-1>>>sS<<sS}function Mw(e){return KC(e)&&ES(e)}var Nw=function(e){function t(e){return e==null?Fw():Mw(e)?e:Fw().withMutations(function(t){var n=Wx(e);JC(n.size),n.forEach(function(e,n){return t.set(n,e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString(`OrderedMap {`,`}`)},t.prototype.get=function(e,t){var n=this._map.get(e);return n===void 0?t:this._list.get(n)[1]},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):Fw()},t.prototype.set=function(e,t){return Iw(this,e,t)},t.prototype.remove=function(e){return Iw(this,e,uS)},t.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},t.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Pw(t,n,e,this.__hash):this.size===0?Fw():(this.__ownerID=e,this.__altered=!1,this._map=t,this._list=n,this)},t}(YC);Nw.isOrderedMap=Mw,Nw.prototype[TS]=!0,Nw.prototype[oS]=Nw.prototype.remove;function Pw(e,t,n,r){var i=Object.create(Nw.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}var ufe;function Fw(){return ufe||=Pw(aw(),Ew())}function Iw(e,t,n){var r=e._map,i=e._list,a=r.get(t),o=a!==void 0,s,c;if(n===uS){if(!o)return e;i.size>=cS&&i.size>=r.size*2?(c=i.filter(function(e,t){return e!==void 0&&a!==t}),s=c.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(s.__ownerID=c.__ownerID=e.__ownerID)):(s=r.remove(t),c=a===i.size-1?i.pop():i.set(a,void 0))}else if(o){if(n===i.get(a)[1])return e;s=r,c=i.set(a,[t,n])}else s=r.set(t,i.size),c=i.set(i.size,[t,n]);return e.__ownerID?(e.size=s.size,e._map=s,e._list=c,e.__hash=void 0,e.__altered=!0,e):Pw(s,c)}var Lw=`@@__IMMUTABLE_STACK__@@`;function Rw(e){return!!(e&&e[Lw])}var zw=function(e){function t(e){return e==null?Hw():Rw(e)?e:Hw().pushAll(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString(`Stack [`,`]`)},t.prototype.get=function(e,t){var n=this._head;for(e=hS(this,e);n&&e--;)n=n.next;return n?n.value:t},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var e=arguments;if(arguments.length===0)return this;for(var t=this.size+arguments.length,n=this._head,r=arguments.length-1;r>=0;r--)n={value:e[r],next:n};return this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Vw(t,n)},t.prototype.pushAll=function(t){if(t=e(t),t.size===0)return this;if(this.size===0&&Rw(t))return t;JC(t.size);var n=this.size,r=this._head;return t.__iterate(function(e){n++,r={value:e,next:r}},!0),this.__ownerID?(this.size=n,this._head=r,this.__hash=void 0,this.__altered=!0,this):Vw(n,r)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Hw()},t.prototype.slice=function(t,n){if(_S(t,n,this.size))return this;var r=vS(t,this.size);if(yS(n,this.size)!==this.size)return e.prototype.slice.call(this,t,n);for(var i=this.size-r,a=this._head;r--;)a=a.next;return this.__ownerID?(this.size=i,this._head=a,this.__hash=void 0,this.__altered=!0,this):Vw(i,a)},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Vw(this.size,this._head,e,this.__hash):this.size===0?Hw():(this.__ownerID=e,this.__altered=!1,this)},t.prototype.__iterate=function(e,t){var n=this;if(t)return new FS(this.toArray()).__iterate(function(t,r){return e(t,r,n)},t);for(var r=0,i=this._head;i&&e(i.value,r++,this)!==!1;)i=i.next;return r},t.prototype.__iterator=function(e,t){if(t)return new FS(this.toArray()).__iterator(e,t);var n=0,r=this._head;return new $x(function(){if(r){var t=r.value;return r=r.next,eS(e,n++,t)}return tS()})},t}(Gx);zw.isStack=Rw;var Bw=zw.prototype;Bw[Lw]=!0,Bw.shift=Bw.pop,Bw.unshift=Bw.push,Bw.unshiftAll=Bw.pushAll,Bw.withMutations=WC,Bw.wasAltered=UC,Bw.asImmutable=VS,Bw[`@@transducer/init`]=Bw.asMutable=HS,Bw[`@@transducer/step`]=function(e,t){return e.unshift(t)},Bw[`@@transducer/result`]=function(e){return e.asImmutable()};function Vw(e,t,n,r){var i=Object.create(Bw);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}var dfe;function Hw(){return dfe||=Vw(0)}function Uw(e,t,n,r,i,a){return JC(e.size),e.__iterate(function(e,a,o){i?(i=!1,n=e):n=t.call(r,n,e,a,o)},a),n}function ffe(e,t){return t}function pfe(e,t){return[t,e]}function Ww(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return!e.apply(this,t)}}function Gw(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return-e.apply(this,t)}}function Kw(e,t){return e<t?1:e>t?-1:0}function qw(e,t){if(e===t)return!0;if(!Hx(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||zx(e)!==zx(t)||Lx(e)!==Lx(t)||ES(e)!==ES(t))return!1;if(e.size===0&&t.size===0)return!0;var n=!Bx(e);if(ES(e)){var r=e.entries();return t.every(function(e,t){var i=r.next().value;return i&&EC(i[1],e)&&(n||EC(i[0],t))})&&r.next().done}var i=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult==`function`&&e.cacheResult();else{i=!0;var a=e;e=t,t=a}var o=!0,s=t.__iterate(function(t,r){if(n?!e.has(t):i?!EC(t,e.get(r,uS)):!EC(e.get(r,uS),t))return o=!1,!1});return o&&e.size===s}var mfe=function(e){function t(e,n,r){if(r===void 0&&(r=1),!(this instanceof t))return new t(e,n,r);if(qC(r!==0,`Cannot step a Range by 0`),qC(e!==void 0,`You must define a start value when using Range`),qC(n!==void 0,`You must define an end value when using Range`),r=Math.abs(r),n<e&&(r=-r),this._start=e,this._end=n,this._step=r,this.size=Math.max(0,Math.ceil((n-e)/r-1)+1),this.size===0){if(Jw)return Jw;Jw=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?`Range []`:`Range [ `+this._start+`...`+this._end+(this._step===1?``:` by `+this._step)+` ]`},t.prototype.get=function(e,t){return this.has(e)?this._start+hS(this,e)*this._step:t},t.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},t.prototype.slice=function(e,n){return _S(e,n,this.size)?this:(e=vS(e,this.size),n=yS(n,this.size),n<=e?new t(0,0):new t(this.get(e,this._end),this.get(n,this._end),this._step))},t.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step===0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},t.prototype.lastIndexOf=function(e){return this.indexOf(e)},t.prototype.__iterate=function(e,t){for(var n=this.size,r=this._step,i=t?this._start+(n-1)*r:this._start,a=0;a!==n&&e(i,t?n-++a:a++,this)!==!1;)i+=t?-r:r;return a},t.prototype.__iterator=function(e,t){var n=this.size,r=this._step,i=t?this._start+(n-1)*r:this._start,a=0;return new $x(function(){if(a===n)return tS();var o=i;return i+=t?-r:r,eS(e,t?n-++a:a++,o)})},t.prototype.equals=function(e){return e instanceof t?this._start===e._start&&this._end===e._end&&this._step===e._step:qw(this,e)},t}(NS),Jw,Yw=`@@__IMMUTABLE_SET__@@`;function Xw(e){return!!(e&&e[Yw])}var Zw=function(e){function t(t){return t==null?tT():Xw(t)&&!ES(t)?t:tT().withMutations(function(n){var r=e(t);JC(r.size),r.forEach(function(e){return n.add(e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this(Wx(e).keySeq())},t.intersect=function(e){return e=Ux(e).toArray(),e.length?Qw.intersect.apply(t(e.pop()),e):tT()},t.union=function(e){return e=Ux(e).toArray(),e.length?Qw.union.apply(t(e.pop()),e):tT()},t.prototype.toString=function(){return this.__toString(`Set {`,`}`)},t.prototype.has=function(e){return this._map.has(e)},t.prototype.add=function(e){return $w(this,this._map.set(e,e))},t.prototype.remove=function(e){return $w(this,this._map.remove(e))},t.prototype.clear=function(){return $w(this,this._map.clear())},t.prototype.map=function(e,t){var n=this,r=!1,i=$w(this,this._map.mapEntries(function(i){var a=i[1],o=e.call(t,a,a,n);return o!==a&&(r=!0),[o,o]},t));return r?i:this},t.prototype.union=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return t=t.filter(function(e){return e.size!==0}),t.length===0?this:this.size===0&&!this.__ownerID&&t.length===1?this.constructor(t[0]):this.withMutations(function(n){for(var r=0;r<t.length;r++)typeof t[r]==`string`?n.add(t[r]):e(t[r]).forEach(function(e){return n.add(e)})})},t.prototype.intersect=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t.length===0)return this;t=t.map(function(t){return e(t)});var r=[];return this.forEach(function(e){t.every(function(t){return t.includes(e)})||r.push(e)}),this.withMutations(function(e){r.forEach(function(t){e.remove(t)})})},t.prototype.subtract=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t.length===0)return this;t=t.map(function(t){return e(t)});var r=[];return this.forEach(function(e){t.some(function(t){return t.includes(e)})&&r.push(e)}),this.withMutations(function(e){r.forEach(function(t){e.remove(t)})})},t.prototype.sort=function(e){return mT(hC(this,e))},t.prototype.sortBy=function(e,t){return mT(hC(this,t,e))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t){return e(t,t,n)},t)},t.prototype.__iterator=function(e,t){return this._map.__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):this.size===0?this.__empty():(this.__ownerID=e,this._map=t,this)},t}(Kx);Zw.isSet=Xw;var Qw=Zw.prototype;Qw[Yw]=!0,Qw[oS]=Qw.remove,Qw.merge=Qw.concat=Qw.union,Qw.withMutations=WC,Qw.asImmutable=VS,Qw[`@@transducer/init`]=Qw.asMutable=HS,Qw[`@@transducer/step`]=function(e,t){return e.add(t)},Qw[`@@transducer/result`]=function(e){return e.asImmutable()},Qw.__empty=tT,Qw.__make=eT;function $w(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function eT(e,t){var n=Object.create(Qw);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}var hfe;function tT(){return hfe||=eT(aw())}function nT(e,t,n){for(var r=fw(t),i=0;i!==r.length;)if(e=mw(e,r[i++],uS),e===uS)return n;return e}function rT(e,t){return nT(this,e,t)}function gfe(e,t){return nT(e,t,uS)!==uS}function _fe(e){return gfe(this,e)}function iT(){JC(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e}function aT(e){if(!e||typeof e!=`object`)return e;if(!Hx(e)){if(!jC(e))return e;e=jS(e)}if(zx(e)){var t={};return e.__iterate(function(e,n){t[n]=aT(e)}),t}var n=[];return e.__iterate(function(e){n.push(aT(e))}),n}function vfe(e){if(e.size===1/0)return 0;var t=ES(e),n=zx(e),r=t?1:0;return e.__iterate(n?t?function(e,t){r=31*r+oT(GS(e),GS(t))|0}:function(e,t){r=r+oT(GS(e),GS(t))|0}:t?function(e){r=31*r+GS(e)|0}:function(e){r=r+GS(e)|0}),yfe(e.size,r)}function yfe(e,t){return t=US(t,3432918353),t=US(t<<15|t>>>-15,461845907),t=US(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=US(t^t>>>16,2246822507),t=US(t^t>>>13,3266489909),t=WS(t^t>>>16),t}function oT(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function sT(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}Ux.Iterator=$x,sT(Ux,{toArray:function(){JC(this.size);var e=Array(this.size||0),t=zx(this),n=0;return this.__iterate(function(r,i){e[n++]=t?[i,r]:r}),e},toIndexedSeq:function(){return new aC(this)},toJS:function(){return aT(this)},toKeyedSeq:function(){return new iC(this,!0)},toMap:function(){return YC(this.toKeyedSeq())},toObject:iT,toOrderedMap:function(){return Nw(this.toKeyedSeq())},toOrderedSet:function(){return mT(zx(this)?this.valueSeq():this)},toSet:function(){return Zw(zx(this)?this.valueSeq():this)},toSetSeq:function(){return new oC(this)},toSeq:function(){return Lx(this)?this.toIndexedSeq():zx(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return zw(zx(this)?this.valueSeq():this)},toList:function(){return bw(zx(this)?this.valueSeq():this)},toString:function(){return`[Collection]`},__toString:function(e,t){return this.size===0?e+t:e+` `+this.toSeq().map(this.__toStringMapper).join(`, `)+` `+t},concat:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return yC(this,Vde(this,e))},includes:function(e){return this.some(function(t){return EC(t,e)})},entries:function(){return this.__iterator(Yx)},every:function(e,t){JC(this.size);var n=!0;return this.__iterate(function(r,i,a){if(!e.call(t,r,i,a))return n=!1,!1}),n},filter:function(e,t){return yC(this,dC(this,e,t,!0))},partition:function(e,t){return Rde(this,e,t)},find:function(e,t,n){var r=this.findEntry(e,t);return r?r[1]:n},forEach:function(e,t){return JC(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){JC(this.size),e=e===void 0?`,`:``+e;var t=``,n=!0;return this.__iterate(function(r){n?n=!1:t+=e,t+=r==null?``:r.toString()}),t},keys:function(){return this.__iterator(qx)},map:function(e,t){return yC(this,lC(this,e,t))},reduce:function(e,t,n){return Uw(this,e,t,n,arguments.length<2,!1)},reduceRight:function(e,t,n){return Uw(this,e,t,n,arguments.length<2,!0)},reverse:function(){return yC(this,uC(this,!0))},slice:function(e,t){return yC(this,fC(this,e,t,!0))},some:function(e,t){JC(this.size);var n=!1;return this.__iterate(function(r,i,a){if(e.call(t,r,i,a))return n=!0,!1}),n},sort:function(e){return yC(this,hC(this,e))},values:function(){return this.__iterator(Jx)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size===void 0?!this.some(function(){return!0}):this.size===0},count:function(e,t){return mS(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return Ide(this,e,t)},equals:function(e){return qw(this,e)},entrySeq:function(){var e=this;if(e._cache)return new FS(e._cache);var t=e.toSeq().map(pfe).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Ww(e),t)},findEntry:function(e,t,n){var r=n;return this.__iterate(function(n,i,a){if(e.call(t,n,i,a))return r=[i,n],!1}),r},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(e){return this.find(gS,null,e)},flatMap:function(e,t){return yC(this,Hde(this,e,t))},flatten:function(e){return yC(this,mC(this,e,!0))},fromEntrySeq:function(){return new sC(this)},get:function(e,t){return this.find(function(t,n){return EC(n,e)},void 0,t)},getIn:rT,groupBy:function(e,t){return Lde(this,e,t)},has:function(e){return this.get(e,uS)!==uS},hasIn:_fe,isSubset:function(e){return e=typeof e.includes==`function`?e:Ux(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return e=typeof e.isSubset==`function`?e:Ux(e),e.isSubset(this)},keyOf:function(e){return this.findKey(function(t){return EC(t,e)})},keySeq:function(){return this.toSeq().map(ffe).toIndexedSeq()},last:function(e){return this.toSeq().reverse().first(e)},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return gC(this,e)},maxBy:function(e,t){return gC(this,t,e)},min:function(e){return gC(this,e?Gw(e):Kw)},minBy:function(e,t){return gC(this,t?Gw(t):Kw,e)},rest:function(){return this.slice(1)},skip:function(e){return e===0?this:this.slice(Math.max(0,e))},skipLast:function(e){return e===0?this:this.slice(0,-Math.max(0,e))},skipWhile:function(e,t){return yC(this,pC(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Ww(e),t)},sortBy:function(e,t){return yC(this,hC(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return this.slice(-Math.max(0,e))},takeWhile:function(e,t){return yC(this,zde(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Ww(e),t)},update:function(e){return e(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||=vfe(this)}});var cT=Ux.prototype;cT[Vx]=!0,cT[Qx]=cT.values,cT.toJSON=cT.toArray,cT.__toStringMapper=pw,cT.inspect=cT.toSource=function(){return this.toString()},cT.chain=cT.flatMap,cT.contains=cT.includes,sT(Wx,{flip:function(){return yC(this,cC(this))},mapEntries:function(e,t){var n=this,r=0;return yC(this,this.toSeq().map(function(i,a){return e.call(t,[a,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return yC(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}});var lT=Wx.prototype;lT[Rx]=!0,lT[Qx]=cT.entries,lT.toJSON=iT,lT.__toStringMapper=function(e,t){return pw(t)+`: `+pw(e)},sT(Gx,{toKeyedSeq:function(){return new iC(this,!1)},filter:function(e,t){return yC(this,dC(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e);return t===void 0?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return t===void 0?-1:t},reverse:function(){return yC(this,uC(this,!1))},slice:function(e,t){return yC(this,fC(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(t||0,0),n===0||n===2&&!t)return this;e=vS(e,e<0?this.count():this.size);var r=this.slice(0,e);return yC(this,n===1?r:r.concat(MC(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t);return n?n[0]:-1},first:function(e){return this.get(0,e)},flatten:function(e){return yC(this,mC(this,e,!1))},get:function(e,t){return e=hS(this,e),e<0||this.size===1/0||this.size!==void 0&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return e=hS(this,e),e>=0&&(this.size===void 0?this.indexOf(e)!==-1:this.size===1/0||e<this.size)},interpose:function(e){return yC(this,Ude(this,e))},interleave:function(){var e=[this].concat(MC(arguments)),t=vC(this.toSeq(),NS.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),yC(this,n)},keySeq:function(){return mfe(0,this.size)},last:function(e){return this.get(-1,e)},skipWhile:function(e,t){return yC(this,pC(this,e,t,!1))},zip:function(){var e=[this].concat(MC(arguments));return yC(this,vC(this,fT,e))},zipAll:function(){var e=[this].concat(MC(arguments));return yC(this,vC(this,fT,e,!0))},zipWith:function(e){var t=MC(arguments);return t[0]=this,yC(this,vC(this,e,t))}});var uT=Gx.prototype;uT[Ix]=!0,uT[TS]=!0,sT(Kx,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}});var dT=Kx.prototype;dT.has=cT.includes,dT.contains=dT.includes,dT.keys=dT.values,sT(MS,lT),sT(NS,uT),sT(PS,dT);function fT(){return MC(arguments)}function pT(e){return Xw(e)&&ES(e)}var mT=function(e){function t(e){return e==null?_T():pT(e)?e:_T().withMutations(function(t){var n=Kx(e);JC(n.size),n.forEach(function(e){return t.add(e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this(Wx(e).keySeq())},t.prototype.toString=function(){return this.__toString(`OrderedSet {`,`}`)},t}(Zw);mT.isOrderedSet=pT;var hT=mT.prototype;hT[TS]=!0,hT.zip=uT.zip,hT.zipWith=uT.zipWith,hT.zipAll=uT.zipAll,hT.__empty=_T,hT.__make=gT;function gT(e,t){var n=Object.create(hT);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}var bfe;function _T(){return bfe||=gT(Fw())}function xfe(e){if(CS(e))throw Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(wS(e))throw Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(typeof e!=`object`||!e)throw Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var vT=function(e,t){var n;xfe(e);var r=function(a){var o=this;if(a instanceof r)return a;if(!(this instanceof r))return new r(a);if(!n){n=!0;var s=Object.keys(e),c=i._indices={};i._name=t,i._keys=s,i._defaultValues=e;for(var l=0;l<s.length;l++){var u=s[l];c[u]=l,i[u]?typeof console==`object`&&console.warn&&console.warn(`Cannot define `+xT(this)+` with property "`+u+`" since that property name is part of the Record API.`):Sfe(i,u)}}return this.__ownerID=void 0,this._values=bw().withMutations(function(e){e.setSize(o._keys.length),Wx(a).forEach(function(t,n){e.set(o._indices[n],t===o._defaultValues[n]?void 0:t)})}),this},i=r.prototype=Object.create(yT);return i.constructor=r,t&&(r.displayName=t),r};vT.prototype.toString=function(){for(var e=xT(this)+` { `,t=this._keys,n,r=0,i=t.length;r!==i;r++)n=t[r],e+=(r?`, `:``)+n+`: `+pw(this.get(n));return e+` }`},vT.prototype.equals=function(e){return this===e||CS(e)&&ST(this).equals(ST(e))},vT.prototype.hashCode=function(){return ST(this).hashCode()},vT.prototype.has=function(e){return this._indices.hasOwnProperty(e)},vT.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._indices[e],r=this._values.get(n);return r===void 0?this._defaultValues[e]:r},vT.prototype.set=function(e,t){if(this.has(e)){var n=this._values.set(this._indices[e],t===this._defaultValues[e]?void 0:t);if(n!==this._values&&!this.__ownerID)return bT(this,n)}return this},vT.prototype.remove=function(e){return this.set(e)},vT.prototype.clear=function(){var e=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:bT(this,e)},vT.prototype.wasAltered=function(){return this._values.wasAltered()},vT.prototype.toSeq=function(){return ST(this)},vT.prototype.toJS=function(){return aT(this)},vT.prototype.entries=function(){return this.__iterator(Yx)},vT.prototype.__iterator=function(e,t){return ST(this).__iterator(e,t)},vT.prototype.__iterate=function(e,t){return ST(this).__iterate(e,t)},vT.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._values.__ensureOwner(e);return e?bT(this,t,e):(this.__ownerID=e,this._values=t,this)},vT.isRecord=CS,vT.getDescriptiveName=xT;var yT=vT.prototype;yT[SS]=!0,yT[oS]=yT.remove,yT.deleteIn=yT.removeIn=_w,yT.getIn=rT,yT.hasIn=cT.hasIn,yT.merge=OC,yT.mergeWith=kC,yT.mergeIn=zC,yT.mergeDeep=IC,yT.mergeDeepWith=LC,yT.mergeDeepIn=RC,yT.setIn=BC,yT.update=VC,yT.updateIn=HC,yT.withMutations=WC,yT.asMutable=HS,yT.asImmutable=VS,yT[Qx]=yT.entries,yT.toJSON=yT.toObject=cT.toObject,yT.inspect=yT.toSource=function(){return this.toString()};function bT(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._values=t,r.__ownerID=n,r}function xT(e){return e.constructor.displayName||e.constructor.name||`Record`}function ST(e){return RS(e._keys.map(function(t){return[t,e.get(t)]}))}function Sfe(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){qC(this.__ownerID,`Cannot set on an immutable record.`),this.set(t,e)}})}catch{}}function R(){return R.zero()}(function(e){function t(){let e=[.1,0];return e[0]=0,e}e.zero=t;function n(e){let n=t();return n[0]=e[0],n[1]=e[1],n}e.clone=n;function r(e){return a(e.x,e.y)}e.fromObj=r;function i(e){return{x:e[0],y:e[1]}}e.toObj=i;function a(e,n){let r=t();return r[0]=e,r[1]=n,r}e.create=a;function o(e){return Number.isNaN(e[0])||Number.isNaN(e[1])}e.hasNaN=o;function s(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t}e.toArray=s;function c(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e}e.fromArray=c;function l(e,t){return e[0]=t[0],e[1]=t[1],e}e.copy=l;function u(e,t,n){return e[0]=t,e[1]=n,e}e.set=u;function d(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}e.add=d;function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}e.sub=f;function p(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}e.mul=p;function m(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}e.div=m;function h(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}e.scale=h;function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}e.round=g;function _(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}e.ceil=_;function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}e.floor=v;function y(e,t){let n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}e.distance=y;function b(e,t){let n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}e.squaredDistance=b;function x(e){let t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}e.magnitude=x;function S(e){let t=e[0],n=e[1];return t*t+n*n}e.squaredMagnitude=S;function C(e,t,n){return h(e,T(e,t),n)}e.setMagnitude=C;function w(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}e.inverse=w;function T(e,t){let n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}e.normalize=T;function E(e,t){return e[0]===t[0]&&e[1]===t[1]}e.areEqual=E;function D(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)}}]`}e.toString=D})(R||={});const CT=1e-6;function wT(e,t,n){return Math.abs(e-t)<=n}function TT(){return TT.zero()}(function(e){function t(){let e=[.1,0,0,0,0,0,0,0,0];return e[0]=0,e}e.zero=t;function n(){let e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}e.identity=n;function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}e.setIdentity=r;function i(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t}e.toArray=i;function a(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e}e.fromArray=a;function o(e,t,n,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=n[0],e[4]=n[1],e[5]=n[2],e[6]=r[0],e[7]=r[1],e[8]=r[2],e}e.fromColumns=o;function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}e.fromMat4=s;let c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(e,t,n){return z.fromEuler(c,t,n),s(e,c)}e.fromEuler=l;function u(e,t,n){return z.fromRotation(c,t,n),s(e,c)}e.fromRotation=u;function d(e,n,r,i,a,o,s,c,l){let u=t();return u[0]=e,u[1]=n,u[2]=r,u[3]=i,u[4]=a,u[5]=o,u[6]=s,u[7]=c,u[8]=l,u}e.create=d;let f=n();function p(e,t){return g(e,f,t===void 0?CT:t)}e.isIdentity=p;function m(e){for(let t=0;t<9;t++)if(Number.isNaN(e[t]))return!0;return!1}e.hasNaN=m;function h(e){return y(t(),e)}e.clone=h;function g(e,t,n){for(let r=0;r<9;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}e.areEqual=g;function _(e,t,n,r){e[3*n+t]=r}e.setValue=_;function v(e,t,n){return e[3*n+t]}e.getValue=v;function y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}e.copy=y;function b(e,t){if(e===t){let n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}e.transpose=b;function x(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=u*o-s*l,f=-u*a+s*c,p=l*a-o*c,m=n*d+r*f+i*p;return m?(m=1/m,e[0]=d*m,e[1]=(-u*r+i*l)*m,e[2]=(s*r-i*o)*m,e[3]=f*m,e[4]=(u*n-i*c)*m,e[5]=(-s*n+i*a)*m,e[6]=p*m,e[7]=(-l*n+r*c)*m,e[8]=(o*n-r*a)*m,e):(console.warn(`non-invertible matrix.`,t),e)}e.invert=x;function S(e,t){return e===t?(e[3]=t[1],e[6]=t[2],e[7]=t[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[1],e[4]=t[4],e[5]=t[5],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e}e.symmtricFromUpper=S;function C(e,t){return e===t?(e[1]=t[3],e[2]=t[6],e[5]=t[7]):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[3],e[4]=t[4],e[5]=t[7],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e}e.symmtricFromLower=C;function w(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=l*a-o*c,d=-l*i+o*s,f=c*i-a*s;return t*u+n*d+r*f}e.determinant=w;function T(e){return e[0]+e[4]+e[8]}e.trace=T;function E(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}e.sub=E;function D(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}e.add=D;function O(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=n[0],p=n[1],m=n[2],h=n[3],g=n[4],_=n[5],v=n[6],y=n[7],b=n[8];return e[0]=f*r+p*o+m*l,e[1]=f*i+p*s+m*u,e[2]=f*a+p*c+m*d,e[3]=h*r+g*o+_*l,e[4]=h*i+g*s+_*u,e[5]=h*a+g*c+_*d,e[6]=v*r+y*o+b*l,e[7]=v*i+y*s+b*u,e[8]=v*a+y*c+b*d,e}e.mul=O;function k(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e[3]=t[3]-n,e[4]=t[4]-n,e[5]=t[5]-n,e[6]=t[6]-n,e[7]=t[7]-n,e[8]=t[8]-n,e}e.subScalar=k;function A(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e[3]=t[3]+n,e[4]=t[4]+n,e[5]=t[5]+n,e[6]=t[6]+n,e[7]=t[7]+n,e[8]=t[8]+n,e}e.addScalar=A;function j(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}e.mulScalar=j;let M=Math.PI/3,N=t();function ee(t,n){let r=n[1]*n[1]+n[2]*n[2]+n[5]*n[5];if(r===0)t[0]=n[0],t[1]=n[4],t[2]=n[8];else{let i=T(n)/3,a=n[0]-i,o=n[4]-i,s=n[8]-i,c=a*a+o*o+s*s+2*r,l=Math.sqrt(c/6);j(N,e.Identity,i),E(N,n,N),j(N,N,1/l);let u=w(N)/2,d=u<=-1?M:u>=1?0:Math.acos(u)/3;t[0]=i+2*l*Math.cos(d),t[2]=i+2*l*Math.cos(d+2*M),t[1]=3*i-t[0]-t[2]}return t}e.symmetricEigenvalues=ee;let te=[.1,0,0],P=[.1,0,0],ne=[.1,0,0],re=[.1,0,0],ie=[.1,0,0],ae=[.1,0,0];function oe(e,t,n){B.set(te,t[0]-n,t[1],t[2]),B.set(P,t[1],t[4]-n,t[5]),B.set(ne,t[2],t[5],t[8]-n),B.cross(re,te,P),B.cross(ie,te,ne),B.cross(ae,P,ne);let r=B.dot(re,re),i=B.dot(ie,ie),a=B.dot(ae,ae),o=r,s=0;return i>o&&(o=i,s=1),a>o&&(s=2),s===0?B.scale(e,re,1/Math.sqrt(r)):s===1?B.scale(e,ie,1/Math.sqrt(i)):B.scale(e,ae,1/Math.sqrt(a)),e}e.eigenvector=oe;function se(e,t){return s(e,t),x(e,e),b(e,e),e}e.directionTransform=se,e.Identity=n();function ce(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[4]*t[4]+e[5]*t[5]+e[6]*t[6]+e[7]*t[7]+e[8]*t[8]}e.innerProduct=ce;function le(e,t){let n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],c=t[8],l=t[9],u=t[10];return e[0]=o*u-s*l,e[1]=s*c-a*u,e[2]=a*l-o*c,e[3]=l*i-u*r,e[4]=u*n-c*i,e[5]=c*r-l*n,e[6]=r*s-i*o,e[7]=i*a-n*s,e[8]=n*o-r*a,e}e.adjointFromMat4=le})(TT||={});function ET(e,t,n){return(e-t)/(n-t)}function DT(e,t,n){return Math.max(t,Math.min(n,e))}function Cfe(e){return DT(e,0,1)}function OT(e,t,n){return e+(t-e)*n}function kT(e,t,n,r,i,a){let o=(n-e)*a,s=(r-t)*a,c=i*i,l=i*c;return(2*t-2*n+o+s)*l+(-3*t+3*n-2*o-s)*c+o*i+t}function AT(e,t,n,r){let i=1-r;return i*i*e+2*i*r*t+r*r*n}function jT(e,t,n){return n=Cfe(ET(n,e,t)),n*n*(3-2*n)}function MT(){return MT.zero()}(function(e){function t(){let e=[.1,0,0,0];return e[0]=0,e}e.zero=t;function n(){let e=t();return e[3]=1,e}e.identity=n;function r(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}e.setIdentity=r;function i(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])||Number.isNaN(e[3])}e.hasNaN=i;function a(e,t,r,i){let a=n();return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a}e.create=a;function o(e,t,n){n*=.5;let r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}e.setAxisAngle=o;function s(e,t){let n=Math.acos(t[3])*2,r=Math.sin(n/2);return r===0?(e[0]=1,e[1]=0,e[2]=0):(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r),n}e.getAxisAngle=s;function c(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3],s=n[0],c=n[1],l=n[2],u=n[3];return e[0]=r*u+o*s+i*l-a*c,e[1]=i*u+o*c+a*s-r*l,e[2]=a*u+o*l+r*c-i*s,e[3]=o*u-r*s-i*c-a*l,e}e.multiply=c;function l(e,t,n){n*=.5;let r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*s,e[1]=i*c+a*s,e[2]=a*c-i*s,e[3]=o*c-r*s,e}e.rotateX=l;function u(e,t,n){n*=.5;let r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c-a*s,e[1]=i*c+o*s,e[2]=a*c+r*s,e[3]=o*c-i*s,e}e.rotateY=u;function d(e,t,n){n*=.5;let r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*s,e[1]=i*c-r*s,e[2]=a*c+o*s,e[3]=o*c-a*s,e}e.rotateZ=d;function f(e,t){let n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}e.calculateW=f;function p(e,t,n,r){let i=t[0],a=t[1],o=t[2],s=t[3],c=n[0],l=n[1],u=n[2],d=n[3],f,p,m,h,g;return p=i*c+a*l+o*u+s*d,p<0&&(p=-p,c=-c,l=-l,u=-u,d=-d),1-p>1e-6?(f=Math.acos(p),m=Math.sin(f),h=Math.sin((1-r)*f)/m,g=Math.sin(r*f)/m):(h=1-r,g=r),e[0]=h*i+g*c,e[1]=h*a+g*l,e[2]=h*o+g*u,e[3]=h*s+g*d,e}e.slerp=p;function m(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=a*s,e}e.invert=m;function h(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}e.conjugate=h;function g(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}e.dot=g;function _(e,t){let n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);let i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[i*3+i]-t[a*3+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[i*3+a]-t[a*3+i])*r,e[i]=(t[i*3+n]+t[n*3+i])*r,e[a]=(t[a*3+n]+t[n*3+a])*r}return e}e.fromMat3=_;let v=[0,0,0,0,0,0,0,0,0,0,0,0];function y(e,t){return TT.fromMat4(v,t),_(e,v)}e.fromMat4=y;function b(e,t,n){let[r,i,a]=t,o=Math.cos(r/2),s=Math.cos(i/2),c=Math.cos(a/2),l=Math.sin(r/2),u=Math.sin(i/2),d=Math.sin(a/2);switch(n){case`XYZ`:e[0]=l*s*c+o*u*d,e[1]=o*u*c-l*s*d,e[2]=o*s*d+l*u*c,e[3]=o*s*c-l*u*d;break;case`YXZ`:e[0]=l*s*c+o*u*d,e[1]=o*u*c-l*s*d,e[2]=o*s*d-l*u*c,e[3]=o*s*c+l*u*d;break;case`ZXY`:e[0]=l*s*c-o*u*d,e[1]=o*u*c+l*s*d,e[2]=o*s*d+l*u*c,e[3]=o*s*c-l*u*d;break;case`ZYX`:e[0]=l*s*c-o*u*d,e[1]=o*u*c+l*s*d,e[2]=o*s*d-l*u*c,e[3]=o*s*c+l*u*d;break;case`YZX`:e[0]=l*s*c+o*u*d,e[1]=o*u*c+l*s*d,e[2]=o*s*d-l*u*c,e[3]=o*s*c-l*u*d;break;case`XZY`:e[0]=l*s*c-o*u*d,e[1]=o*u*c-l*s*d,e[2]=o*s*d+l*u*c,e[3]=o*s*c+l*u*d;break;default:Lb(n)}return e}e.fromEuler=b;let x=[0,0,0];function S(e,t,n){let r=B.dot(t,n)+1;return r<1e-6?(r=0,Math.abs(t[0])>Math.abs(t[2])?B.set(x,-t[1],t[0],0):B.set(x,0,-t[2],t[1])):B.cross(x,t,n),e[0]=x[0],e[1]=x[1],e[2]=x[2],e[3]=r,re(e,e),e}e.fromUnitVec3=S;let C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function w(e,t,n,r){return z.fromBasis(C,t,n,r),y(e,C)}e.fromBasis=w;function T(e){let n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}e.clone=T;function E(e){return a(e.x,e.y,e.z,e.w)}e.fromObj=E;function D(e){return{x:e[0],y:e[1],z:e[2],w:e[3]}}e.toObj=D;function O(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t}e.toArray=O;function k(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e}e.fromArray=k;function A(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}e.copy=A;function j(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}e.set=j;function M(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}e.exactEquals=M;function N(e,t){let n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=1e-6*Math.max(1,Math.abs(a),Math.abs(l))}e.equals=N;function ee(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}e.add=ee;function te(e){let t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}e.magnitude=te;function P(e){let t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}e.squaredMagnitude=P;function ne(e,t){return 2*Math.acos(Math.abs(DT(g(e,t),-1,1)))}e.angle=ne;function re(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o),e}e.normalize=re;let ie=[0,0,0],ae=[1,0,0],oe=[0,1,0];function se(e,t,n){let r=B.dot(t,n);return r<-.999999?(B.cross(ie,ae,t),B.magnitude(ie)<1e-6&&B.cross(ie,oe,t),B.normalize(ie,ie),o(e,ie,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(B.cross(ie,t,n),e[0]=ie[0],e[1]=ie[1],e[2]=ie[2],e[3]=1+r,re(e,e))}e.rotationTo=se;let ce=t(),le=t();function ue(e,t,n,r,i,a){return p(ce,t,i,a),p(le,n,r,a),p(e,ce,le,2*a*(1-a)),e}e.sqlerp=ue;let de=[0,0,0,0,0,0,0,0,0];function fe(e,t,n,r){return de[0]=n[0],de[3]=n[1],de[6]=n[2],de[1]=r[0],de[4]=r[1],de[7]=r[2],de[2]=-t[0],de[5]=-t[1],de[8]=-t[2],re(e,_(e,de))}e.setAxes=fe;function pe(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`}e.toString=pe,e.Identity=n()})(MT||={});const NT=Math.PI/2,PT=Math.PI/180;function FT(e){return e*PT}function IT(e){return e/PT}function LT(e){return e!==0&&(e&e-1)==0}function wfe(...e){let t=0,n=0;for(let r=0,i=e.length;r<i;++r){let i=e[r],a=Math.abs(i);a>n&&(t=i,n=a)}return t}function RT(e,t){return e*t}function zT(e){let t=0,n=0,r=0,i=-1,a=e*2+1,o=a/2,s=[];for(let e=a**2;e>0;--e){if(-o<t&&t<=o&&-o<n&&n<=o&&s.push([t,n]),t===n||t<0&&t===-n||t>0&&t===1-n){let e=r;r=-i,i=e}t+=r,n+=i}return s}function z(){return z.zero()}(function(e){function t(){let e=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return e[0]=0,e}e.zero=t;function n(){let e=t();return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.identity=n;function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.setIdentity=r;function i(e){for(let t=0;t<16;t++)if(e[t]!==0)return!1;return!0}e.isZero=i;function a(e){for(let t=0;t<16;t++)e[t]=0;return e}e.setZero=a;function o(e){let n=t();for(let t=0;t<4;t++){let r=e[t];for(let e=0;e<4;e++)n[4*e+t]=r[e]}return n}e.ofRows=o;let s=n();function c(e,t){return u(e,s,t===void 0?CT:t)}e.isIdentity=c;function l(e){for(let t=0;t<16;t++)if(Number.isNaN(e[t]))return!0;return!1}e.hasNaN=l;function u(e,t,n){for(let r=0;r<16;r++)if(Math.abs(e[r]-t[r])>n)return!1;return!0}e.areEqual=u;function d(e,t,n,r){e[4*n+t]=r}e.setValue=d;function f(e,t,n){return e[4*n+t]}e.getValue=f;function p(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t}e.toArray=p;function m(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e[9]=t[n+9],e[10]=t[n+10],e[11]=t[n+11],e[12]=t[n+12],e[13]=t[n+13],e[14]=t[n+14],e[15]=t[n+15],e}e.fromArray=m;function h(e,t,n,r){return a(e),d(e,0,0,t[0]),d(e,1,0,t[1]),d(e,2,0,t[2]),d(e,0,1,n[0]),d(e,1,1,n[1]),d(e,2,1,n[2]),d(e,0,2,r[0]),d(e,1,2,r[1]),d(e,2,2,r[2]),d(e,3,3,1),e}e.fromBasis=h;function g(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}e.copy=g;function _(e){return g(t(),e)}e.clone=_;function v(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}e.getTranslation=v;function y(e,t){let n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(c*c+l*l+u*u),e}e.getScaling=y;function b(e,t){let n=t[0]+t[5]+t[10],r=0;return n>0?(r=Math.sqrt(n+1)*2,e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=Math.sqrt(1+t[0]-t[5]-t[10])*2,e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=Math.sqrt(1+t[5]-t[0]-t[10])*2,e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=Math.sqrt(1+t[10]-t[0]-t[5])*2,e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}e.getRotation=b;function x(e,t){let n=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),i=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=0,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=0,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.extractRotation=x;function S(e,t){if(e===t){let n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}e.transpose=S;function C(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15],v=n*s-r*o,y=n*c-i*o,b=n*l-a*o,x=r*c-i*s,S=r*l-a*s,C=i*l-a*c,w=u*h-d*m,T=u*g-f*m,E=u*_-p*m,D=d*g-f*h,O=d*_-p*h,k=f*_-p*g,A=v*k-y*O+b*D+x*E-S*T+C*w;return A?(A=1/A,e[0]=(s*k-c*O+l*D)*A,e[1]=(i*O-r*k-a*D)*A,e[2]=(h*C-g*S+_*x)*A,e[3]=(f*S-d*C-p*x)*A,e[4]=(c*E-o*k-l*T)*A,e[5]=(n*k-i*E+a*T)*A,e[6]=(g*b-m*C-_*y)*A,e[7]=(u*C-f*b+p*y)*A,e[8]=(o*O-s*E+l*w)*A,e[9]=(r*E-n*O-a*w)*A,e[10]=(m*S-h*b+_*v)*A,e[11]=(d*b-u*S-p*v)*A,e[12]=(s*T-o*D-c*w)*A,e[13]=(n*D-r*T+i*w)*A,e[14]=(h*y-m*x-g*v)*A,e[15]=(u*x-d*y+f*v)*A,!0):!1}e.tryInvert=C;function w(e,t){return C(e,t)||console.warn(`non-invertible matrix.`,t),e}e.invert=w;function T(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],p=t[10],m=t[11],h=t[12],g=t[13],_=t[14],v=t[15],y=n[0],b=n[1],x=n[2],S=n[3];return e[0]=y*r+b*s+x*d+S*h,e[1]=y*i+b*c+x*f+S*g,e[2]=y*a+b*l+x*p+S*_,e[3]=y*o+b*u+x*m+S*v,y=n[4],b=n[5],x=n[6],S=n[7],e[4]=y*r+b*s+x*d+S*h,e[5]=y*i+b*c+x*f+S*g,e[6]=y*a+b*l+x*p+S*_,e[7]=y*o+b*u+x*m+S*v,y=n[8],b=n[9],x=n[10],S=n[11],e[8]=y*r+b*s+x*d+S*h,e[9]=y*i+b*c+x*f+S*g,e[10]=y*a+b*l+x*p+S*_,e[11]=y*o+b*u+x*m+S*v,y=n[12],b=n[13],x=n[14],S=n[15],e[12]=y*r+b*s+x*d+S*h,e[13]=y*i+b*c+x*f+S*g,e[14]=y*a+b*l+x*p+S*_,e[15]=y*o+b*u+x*m+S*v,e}e.mul=T;function E(e,t,n,r,i,a){let o=t[0+i],s=t[1+i],c=t[2+i],l=t[3+i],u=t[4+i],d=t[5+i],f=t[6+i],p=t[7+i],m=t[8+i],h=t[9+i],g=t[10+i],_=t[11+i],v=t[12+i],y=t[13+i],b=t[14+i],x=t[15+i],S=n[0+a],C=n[1+a],w=n[2+a],T=n[3+a];return e[0+r]=S*o+C*u+w*m+T*v,e[1+r]=S*s+C*d+w*h+T*y,e[2+r]=S*c+C*f+w*g+T*b,e[3+r]=S*l+C*p+w*_+T*x,S=n[4+a],C=n[5+a],w=n[6+a],T=n[7+a],e[4+r]=S*o+C*u+w*m+T*v,e[5+r]=S*s+C*d+w*h+T*y,e[6+r]=S*c+C*f+w*g+T*b,e[7+r]=S*l+C*p+w*_+T*x,S=n[8+a],C=n[9+a],w=n[10+a],T=n[11+a],e[8+r]=S*o+C*u+w*m+T*v,e[9+r]=S*s+C*d+w*h+T*y,e[10+r]=S*c+C*f+w*g+T*b,e[11+r]=S*l+C*p+w*_+T*x,S=n[12+a],C=n[13+a],w=n[14+a],T=n[15+a],e[12+r]=S*o+C*u+w*m+T*v,e[13+r]=S*s+C*d+w*h+T*y,e[14+r]=S*c+C*f+w*g+T*b,e[15+r]=S*l+C*p+w*_+T*x,e}e.mulOffset=E;function D(e,t,n,r){return T(e,T(e,t,n),r)}e.mul3=D;function O(e,t,n){let r=n[0],i=n[1],a=n[2],o,s,c,l,u,d,f,p,m,h,g,_;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*a+t[12],e[13]=t[1]*r+t[5]*i+t[9]*a+t[13],e[14]=t[2]*r+t[6]*i+t[10]*a+t[14],e[15]=t[3]*r+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],c=t[2],l=t[3],u=t[4],d=t[5],f=t[6],p=t[7],m=t[8],h=t[9],g=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=f,e[7]=p,e[8]=m,e[9]=h,e[10]=g,e[11]=_,e[12]=o*r+u*i+m*a+t[12],e[13]=s*r+d*i+h*a+t[13],e[14]=c*r+f*i+g*a+t[14],e[15]=l*r+p*i+_*a+t[15]),e}e.translate=O;function k(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}e.fromTranslation=k;function A(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e}e.setTranslation=A;function j(e,t,n,r){return e[0]=n[0],e[4]=n[1],e[8]=n[2],e[1]=r[0],e[5]=r[1],e[9]=r[2],e[2]=t[0],e[6]=t[1],e[10]=t[2],e}e.setAxes=j;function M(e,t,r,i){let a=i[0],o=i[1],s=i[2],c=Math.sqrt(a*a+o*o+s*s);if(Math.abs(c)<1e-6)return n();c=1/c,a*=c,o*=c,s*=c;let l=Math.sin(r),u=Math.cos(r),d=1-u,f=t[0],p=t[1],m=t[2],h=t[3],g=t[4],_=t[5],v=t[6],y=t[7],b=t[8],x=t[9],S=t[10],C=t[11],w=a*a*d+u,T=o*a*d+s*l,E=s*a*d-o*l,D=a*o*d-s*l,O=o*o*d+u,k=s*o*d+a*l,A=a*s*d+o*l,j=o*s*d-a*l,M=s*s*d+u;return e[0]=f*w+g*T+b*E,e[1]=p*w+_*T+x*E,e[2]=m*w+v*T+S*E,e[3]=h*w+y*T+C*E,e[4]=f*D+g*O+b*k,e[5]=p*D+_*O+x*k,e[6]=m*D+v*O+S*k,e[7]=h*D+y*O+C*k,e[8]=f*A+g*j+b*M,e[9]=p*A+_*j+x*M,e[10]=m*A+v*j+S*M,e[11]=h*A+y*j+C*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}e.rotate=M;function N(e,t,n){let i=n[0],a=n[1],o=n[2],s=Math.sqrt(i*i+a*a+o*o);if(Math.abs(s)<1e-6)return r(e);s=1/s,i*=s,a*=s,o*=s;let c=Math.sin(t),l=Math.cos(t),u=1-l;return e[0]=i*i*u+l,e[1]=a*i*u+o*c,e[2]=o*i*u-a*c,e[3]=0,e[4]=i*a*u-o*c,e[5]=a*a*u+l,e[6]=o*a*u+i*c,e[7]=0,e[8]=i*o*u+a*c,e[9]=a*o*u-i*c,e[10]=o*o*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.fromRotation=N;function ee(e,t,n){let r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}e.scale=ee;function te(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}e.scaleUniformly=te;function P(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.fromScaling=P;function ne(e,t){return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.fromUniformScaling=ne;let re=[0,0,0],ie=[0,0,0];function ae(e,t,n){let r=B.cross(re,t,B.unitX);B.dot(r,r)<1e-6&&B.cross(r,t,B.unitY),B.normalize(r,r);let i=B.cross(ie,t,r);return B.normalize(i,i),j(e,t,r,i),e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}e.fromPlane=ae;function oe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e}e.fromMat3=oe;function se(e,t,n,r){let[i,a,o,s]=n,c=i+i,l=a+a,u=o+o,d=i*c,f=i*l,p=i*u,m=a*l,h=a*u,g=o*u,_=s*c,v=s*l,y=s*u,[b,x,S]=r;return e[0]=(1-(m+g))*b,e[1]=(f+y)*b,e[2]=(p-v)*b,e[3]=0,e[4]=(f-y)*x,e[5]=(1-(d+g))*x,e[6]=(h+_)*x,e[7]=0,e[8]=(p+v)*S,e[9]=(h-_)*S,e[10]=(1-(d+m))*S,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}e.compose=se;let ce=[0,0,0],le=t();function ue(e,t,n,r){let i=B.magnitude(B.set(ce,e[0],e[1],e[2])),a=B.magnitude(B.set(ce,e[4],e[5],e[6])),o=B.magnitude(B.set(ce,e[8],e[9],e[10]));pe(e)<0&&(i=-i),t[0]=e[12],t[1]=e[13],t[2]=e[14],g(le,e);let s=1/i,c=1/a,l=1/o;return le[0]*=s,le[1]*=s,le[2]*=s,le[4]*=c,le[5]*=c,le[6]*=c,le[8]*=l,le[9]*=l,le[10]*=l,b(n,le),r[0]=i,r[1]=a,r[2]=o,e}e.decompose=ue;function de(e){let t=B(),n=MT(),r=B();return ue(e,t,n,r),{position:t,quaternion:n,scale:r}}e.getDecomposition=de;function fe(e){let t=``;for(let n=0;n<4;n++){for(let r=0;r<4;r++)t+=e[4*r+n].toString(),r<3&&(t+=` `);n<3&&(t+=`
`)}return t}e.makeTable=fe;function pe(e){let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=e[9],d=e[10],f=e[11],p=e[12],m=e[13],h=e[14],g=e[15],_=t*o-n*a,v=t*s-r*a,y=t*c-i*a,b=n*s-r*o,x=n*c-i*o,S=r*c-i*s,C=l*m-u*p,w=l*h-d*p,T=l*g-f*p,E=u*h-d*m,D=u*g-f*m;return _*(d*g-f*h)-v*D+y*E+b*T-x*w+S*C}e.determinant=pe;function me(e,t){return he(e,t===void 0?CT:t)}e.isRotationAndTranslation=me;function he(e,t){let n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],p=e[11],m=e[15];return!(!wT(m,1,t)||!wT(a,0,t)||!wT(l,0,t)||!wT(p,0,t)||!wT(Math.abs(n*(s*f-c*d)-r*(o*f-c*u)+i*(o*d-s*u)),1,t))}function ge(e,t){return _e(e,t===void 0?CT:t)}e.isTranslationAndUniformScaling=ge;function _e(e,t){let n=e[0];return wT(e[1],0,t)&&wT(e[2],0,t)&&wT(e[3],0,t)&&wT(e[4],0,t)&&wT(e[5],n,t)&&wT(e[6],0,t)&&wT(e[7],0,t)&&wT(e[8],0,t)&&wT(e[9],0,t)&&wT(e[10],n,t)&&wT(e[11],0,t)&&wT(e[15],1,t)}function ve(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,c=i+i,l=n*o,u=r*o,d=r*s,f=i*o,p=i*s,m=i*c,h=a*o,g=a*s,_=a*c;return e[0]=1-d-m,e[1]=u+_,e[2]=f-g,e[3]=0,e[4]=u-_,e[5]=1-l-m,e[6]=p+h,e[7]=0,e[8]=f+g,e[9]=p-h,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.fromQuat=ve;function ye(e,t,n){let r=t[0],i=t[1],a=t[2],o=Math.cos(r),s=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(a),d=Math.sin(a);if(n===`XYZ`){let t=o*u,n=o*d,r=s*u,i=s*d;e[0]=c*u,e[4]=-c*d,e[8]=l,e[1]=n+r*l,e[5]=t-i*l,e[9]=-s*c,e[2]=i-t*l,e[6]=r+n*l,e[10]=o*c}else if(n===`YXZ`){let t=c*u,n=c*d,r=l*u,i=l*d;e[0]=t+i*s,e[4]=r*s-n,e[8]=o*l,e[1]=o*d,e[5]=o*u,e[9]=-s,e[2]=n*s-r,e[6]=i+t*s,e[10]=o*c}else if(n===`ZXY`){let t=c*u,n=c*d,r=l*u,i=l*d;e[0]=t-i*s,e[4]=-o*d,e[8]=r+n*s,e[1]=n+r*s,e[5]=o*u,e[9]=i-t*s,e[2]=-o*l,e[6]=s,e[10]=o*c}else if(n===`ZYX`){let t=o*u,n=o*d,r=s*u,i=s*d;e[0]=c*u,e[4]=r*l-n,e[8]=t*l+i,e[1]=c*d,e[5]=i*l+t,e[9]=n*l-r,e[2]=-l,e[6]=s*c,e[10]=o*c}else if(n===`YZX`){let t=o*c,n=o*l,r=s*c,i=s*l;e[0]=c*u,e[4]=i-t*d,e[8]=r*d+n,e[1]=d,e[5]=o*u,e[9]=-s*u,e[2]=-l*u,e[6]=n*d+r,e[10]=t-i*d}else if(n===`XZY`){let t=o*c,n=o*l,r=s*c,i=s*l;e[0]=c*u,e[4]=-d,e[8]=l*u,e[1]=t*d+i,e[5]=o*u,e[9]=n*d-r,e[2]=r*d-n,e[6]=s*u,e[10]=i*d+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.fromEuler=ye;function be(e,t,n,r,i,a,o){let s=2*a/(n-t),c=2*a/(r-i),l=(n+t)/(n-t),u=(r+i)/(r-i),d=-(o+a)/(o-a),f=-2*o*a/(o-a);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=l,e[9]=u,e[10]=d,e[11]=-1,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}e.perspective=be;function xe(e,t,n,r,i,a,o){let s=1/(n-t),c=1/(r-i),l=1/(o-a),u=(n+t)*s,d=(r+i)*c,f=(o+a)*l;return e[0]=2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2*l,e[11]=0,e[12]=-u,e[13]=-d,e[14]=-f,e[15]=1,e}e.ortho=xe;function Se(e,t,n,i){let a,o,s,c,l,u,d,f,p,m,h=t[0],g=t[1],_=t[2],v=i[0],y=i[1],b=i[2],x=n[0],S=n[1],C=n[2];return Math.abs(h-x)<1e-6&&Math.abs(g-S)<1e-6&&Math.abs(_-C)<1e-6?r(e):(d=h-x,f=g-S,p=_-C,m=1/Math.sqrt(d*d+f*f+p*p),d*=m,f*=m,p*=m,a=y*p-b*f,o=b*d-v*p,s=v*f-y*d,m=Math.sqrt(a*a+o*o+s*s),m?(m=1/m,a*=m,o*=m,s*=m):(a=0,o=0,s=0),c=f*s-p*o,l=p*a-d*s,u=d*o-f*a,m=Math.sqrt(c*c+l*l+u*u),m?(m=1/m,c*=m,l*=m,u*=m):(c=0,l=0,u=0),e[0]=a,e[1]=c,e[2]=d,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=s,e[9]=u,e[10]=p,e[11]=0,e[12]=-(a*h+o*g+s*_),e[13]=-(c*h+l*g+u*_),e[14]=-(d*h+f*g+p*_),e[15]=1,e)}e.lookAt=Se;function Ce(e,t,n,r){let i=t[0],a=t[1],o=t[2],s=r[0],c=r[1],l=r[2],u=i-n[0],d=a-n[1],f=o-n[2],p=u*u+d*d+f*f;p>0&&(p=1/Math.sqrt(p),u*=p,d*=p,f*=p);let m=c*f-l*d,h=l*u-s*f,g=s*d-c*u;return p=m*m+h*h+g*g,p>0&&(p=1/Math.sqrt(p),m*=p,h*=p,g*=p),e[0]=m,e[1]=h,e[2]=g,e[3]=0,e[4]=d*g-f*h,e[5]=f*m-u*g,e[6]=u*h-d*m,e[7]=0,e[8]=u,e[9]=d,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}e.targetTo=Ce;function we(e,t){a(e);for(let n=0;n<4;n++){let r=t[n];d(e,n,r,1)}return e}e.fromPermutation=we;function Te(e){let t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}e.getMaxScaleOnAxis=Te;function Ee(e){return{x:B.create(e[0],e[1],e[2]),y:B.create(e[4],e[5],e[6]),z:B.create(e[8],e[9],e[10])}}e.extractBasis=Ee;let De=[1,0,0],Oe=[0,1,0],ke=[0,0,1];e.rotX90=N(t(),FT(90),De),e.rotX180=N(t(),FT(180),De),e.rotY90=N(t(),FT(90),Oe),e.rotY180=N(t(),FT(180),Oe),e.rotY270=N(t(),FT(270),Oe),e.rotZ90=N(t(),FT(90),ke),e.rotZ180=N(t(),FT(180),ke),e.rotXY90=T(t(),e.rotX90,e.rotY90),e.rotZY90=T(t(),e.rotZ90,e.rotY90),e.rotZYZ90=T(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=T(t(),e.rotZ90,e.rotX180),e.rotY90Z180=T(t(),e.rotY90,e.rotZ180),e.id=n()})(z||={});var BT=isFinite;function B(){return B.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;function n(e){let n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}e.clone=n;function r(e){return BT(e[0])&&BT(e[1])&&BT(e[2])}e.isFinite=r;function i(e){return Number.isInteger(e[0])&&Number.isInteger(e[1])&&Number.isInteger(e[2])}e.isInteger=i;function a(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])}e.hasNaN=a;function o(e){return e[0]=NaN,e[1]=NaN,e[2]=NaN,e}e.setNaN=o;function s(e){return d(e.x,e.y,e.z)}e.fromObj=s;function c(e){return{x:e[0],y:e[1],z:e[2]}}e.toObj=c;function l(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e}e.fromArray=l;function u(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t}e.toArray=u;function d(e,n,r){let i=t();return i[0]=e,i[1]=n,i[2]=r,i}e.create=d;function f(e){let n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}e.ofArray=f;function p(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}e.set=p;function m(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}e.copy=m;function h(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}e.add=h;function g(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}e.sub=g;function _(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}e.mul=_;function v(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}e.div=v;function y(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}e.scale=y;function b(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}e.scaleAndAdd=b;function x(e,t,n,r){return e[0]=t[0]-n[0]*r,e[1]=t[1]-n[1]*r,e[2]=t[2]-n[2]*r,e}e.scaleAndSub=x;function S(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e}e.addScalar=S;function C(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e}e.subScalar=C;function w(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}e.round=w;function T(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}e.ceil=T;function E(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}e.floor=E;function D(e,t){return e[0]=Math.trunc(t[0]),e[1]=Math.trunc(t[1]),e[2]=Math.trunc(t[2]),e}e.trunc=D;function O(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}e.abs=O;function k(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}e.min=k;function A(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}e.max=A;function j(e,t,n,r){return e[0]=Math.max(n[0],Math.min(r[0],t[0])),e[1]=Math.max(n[1],Math.min(r[1],t[1])),e[2]=Math.max(n[2],Math.min(r[2],t[2])),e}e.clamp=j;function M(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}e.distance=M;function N(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}e.squaredDistance=N;function ee(e){let t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}e.magnitude=ee;function te(e){let t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}e.squaredMagnitude=te;function P(e,t,n){return y(e,ie(e,t),n)}e.setMagnitude=P;function ne(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}e.negate=ne;function re(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}e.inverse=re;function ie(e,t){let n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}e.normalize=ie;function ae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}e.dot=ae;function oe(e,t,n){let r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2];return e[0]=i*c-a*s,e[1]=a*o-r*c,e[2]=r*s-i*o,e}e.cross=oe;function se(e,t,n,r){let i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}e.lerp=se;let ce=t();function le(e,t,n,r){let i=DT(ae(t,n),-1,1),a=Math.acos(i)*r;return b(ce,n,t,-i),ie(ce,ce),h(e,y(e,t,Math.cos(a)),y(ce,ce,Math.sin(a)))}e.slerp=le;function ue(e,t,n,r,i,a){let o=a*a,s=o*(2*a-3)+1,c=o*(a-2)+a,l=o*(a-1),u=o*(3-2*a);return e[0]=t[0]*s+n[0]*c+r[0]*l+i[0]*u,e[1]=t[1]*s+n[1]*c+r[1]*l+i[1]*u,e[2]=t[2]*s+n[2]*c+r[2]*l+i[2]*u,e}e.hermite=ue;function de(e,t,n,r,i,a){let o=1-a,s=o*o,c=a*a,l=s*o,u=3*a*s,d=3*c*o,f=c*a;return e[0]=t[0]*l+n[0]*u+r[0]*d+i[0]*f,e[1]=t[1]*l+n[1]*u+r[1]*d+i[1]*f,e[2]=t[2]*l+n[2]*u+r[2]*d+i[2]*f,e}e.bezier=de;function fe(e,t,n,r,i){return e[0]=AT(t[0],n[0],r[0],i),e[1]=AT(t[1],n[1],r[1],i),e[2]=AT(t[2],n[2],r[2],i),e}e.quadraticBezier=fe;function pe(e,t,n,r,i,a,o){return e[0]=kT(t[0],n[0],r[0],i[0],a,o),e[1]=kT(t[1],n[1],r[1],i[1],a,o),e[2]=kT(t[2],n[2],r[2],i[2],a,o),e}e.spline=pe;function me(e,t){let n=Math.random()*2*Math.PI,r=Math.random()*2-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}e.random=me;function he(e,t,n){let r=t[0],i=t[1],a=t[2],o=1/(n[3]*r+n[7]*i+n[11]*a+n[15]||1);return e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])*o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])*o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])*o,e}e.transformMat4=he;function ge(e,t,n){let r=t[0],i=t[1],a=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*a,e[1]=n[1]*r+n[5]*i+n[9]*a,e[2]=n[2]*r+n[6]*i+n[10]*a,ie(e,e)}e.transformDirection=ge;function _e(e,t,n,r,i,a){let o=t[0+i],s=t[1+i],c=t[2+i],l=1/(n[3+a]*o+n[7+a]*s+n[11+a]*c+n[15+a]||1);return e[0+r]=(n[0+a]*o+n[4+a]*s+n[8+a]*c+n[12+a])*l,e[1+r]=(n[1+a]*o+n[5+a]*s+n[9+a]*c+n[13+a])*l,e[2+r]=(n[2+a]*o+n[6+a]*s+n[10+a]*c+n[14+a])*l,e}e.transformMat4Offset=_e;function ve(e,t,n,r,i,a){let o=t[0+i],s=t[1+i],c=t[2+i];e[0+r]=n[0+a]*o+n[4+a]*s+n[8+a]*c,e[1+r]=n[1+a]*o+n[5+a]*s+n[9+a]*c,e[2+r]=n[2+a]*o+n[6+a]*s+n[10+a]*c;let l=Math.hypot(e[0+r],e[1+r],e[2+r]);return l>0&&(e[0+r]/=l,e[1+r]/=l,e[2+r]/=l),e}e.transformDirectionOffset=ve;function ye(e,t,n){let r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}e.transformMat3=ye;function be(e,t,n){let r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],c=n[2],l=n[3],u=l*r+s*a-c*i,d=l*i+c*r-o*a,f=l*a+o*i-s*r,p=-o*r-s*i-c*a;return e[0]=u*l+p*-o+d*-c-f*-s,e[1]=d*l+p*-s+f*-o-u*-c,e[2]=f*l+p*-c+u*-s-d*-o,e}e.transformQuat=be;function xe(e,t){let n=Math.sqrt(te(e)*te(t));if(n===0)return Math.PI/2;let r=ae(e,t)/n;return Math.acos(DT(r,-1,1))}e.angle=xe;let Se=t(),Ce=t(),we=t(),Te=t(),Ee=t(),De=t(),Oe=t();function ke(e,t,n,r){g(Se,e,t),g(Ce,n,t),g(we,t,n),g(Te,r,n),oe(Ee,Se,Ce),oe(De,we,Te);let i=xe(Ee,De);return oe(Oe,Ee,De),ae(Ce,Oe)>0?i:-i}e.dihedralAngle=ke;function Ae(t,n,r,i){return e.set(t,i*Math.cos(r)*Math.sin(n),i*Math.sin(r)*Math.sin(n),i*Math.cos(n))}e.directionFromSpherical=Ae;function je(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}e.exactEquals=je;function Me(e,t){let n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}e.equals=Me;let Ne=t();function Pe(t,n,r){let i=xe(n,r);if(Math.abs(i)<1e-4)return z.setIdentity(t);if(Math.abs(i-Math.PI)<1e-6)return z.fromRotation(t,Math.PI,Math.abs(n[0])<.9?e.unitX:e.unitZ);let a=oe(Ne,n,r);return z.fromRotation(t,i,a)}e.makeRotation=Pe;function Fe(e){return e[0]===0&&e[1]===0&&e[2]===0}e.isZero=Fe;function Ie(e,t,n,r){return g(e,t,r),h(e,y(e,n,ae(n,e)/te(n)),r)}e.projectPointOnVector=Ie;let Le=t();function Re(e,t,n,r){return ie(Le,n),g(e,t,r),g(e,t,y(Le,Le,ae(e,Le)))}e.projectPointOnPlane=Re;function ze(e,t,n){return y(e,n,ae(n,t)/te(n))}e.projectOnVector=ze;let Be=t();function Ve(e,t,n){return ze(Be,t,n),g(e,t,Be)}e.projectOnPlane=Ve;function He(t,n,r){return ie(t,oe(t,oe(t,n,r),n)),!e.isZero(t)||(t[0]=1,t[1]=0,t[2]=0,ie(t,oe(t,oe(t,n,t),n)),!e.isZero(t))||(t[0]=0,t[1]=1,t[2]=0,ie(t,oe(t,oe(t,n,t),n)),!e.isZero(t))||(ie(t,r),!e.isZero(t))?t:(t[0]=1,t[1]=0,t[2]=0,t)}e.orthogonalize=He;function Ue(e,t,n){return ae(t,n)>0?m(e,t):ne(e,m(e,t)),e}e.matchDirection=Ue;function We(n,r){if(Fe(r))return m(n,e.unitX);{let e=t();return Math.abs(r[0])<Math.abs(r[1])&&Math.abs(r[0])<Math.abs(r[2])?(e[0]=0,e[1]=r[2],e[2]=-r[1]):Math.abs(r[1])<Math.abs(r[2])?(e[0]=-r[2],e[1]=0,e[2]=r[0]):(e[0]=r[1],e[1]=-r[0],e[2]=0),ie(n,e)}}e.orthogonalDirection=We;let Ge=t(),Ke=t();function qe(e,t,n,r){return g(Ge,n,t),g(Ke,r,t),ie(e,oe(e,Ge,Ke))}e.triangleNormal=qe;let Je=t();function Ye(t,n,r){return e.scaleAndAdd(t,n,e.sub(Je,r,n),.5)}e.center=Ye;function Xe(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}]`}e.toString=Xe,e.origin=d(0,0,0),e.unit=d(1,1,1),e.negUnit=d(-1,-1,-1),e.unitX=d(1,0,0),e.unitY=d(0,1,0),e.unitZ=d(0,0,1),e.negUnitX=d(-1,0,0),e.negUnitY=d(0,-1,0),e.negUnitZ=d(0,0,-1)})(B||={});var VT=Object.prototype.hasOwnProperty;function Tfe(e,t){for(let n of Object.keys(t))VT.call(t,n)&&e[n]===void 0&&(e[n]=t[n]);return e}function Efe(e,t){let n=!1;for(let r of Object.keys(t))if(VT.call(t,r)&&t[r]!==e[r]){n=!0;break}return n?Object.assign({},e,t):e}function HT(e,t){if(!e)return!t;if(!t)return!1;let n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(let r of n)if(!VT.call(e,r)||e[r]!==t[r])return!1;return!0}function Dfe(e,t){let n=e;for(let r=0;r<t.length;r++)if(t[r]&&(n=Efe(e,t[r]),n!==e)){for(let e=r+1;e<t.length;e++)n=Object.assign(n,t[e]);break}return n}function UT(e){if(typeof e!=`object`||!e)return e;if(e instanceof Array){let t=[];for(let n=0,r=e.length;n<r;n++)t[n]=UT(e[n]);return t}if(typeof e==`object`&&!(`prototype`in e)){let t={};for(let n in e)VT.call(e,n)&&(t[n]=UT(e[n]));return t}throw Error(`Can't clone, type "${typeof e}" unsupported`)}function WT(e,t){if(e)for(let n of Object.keys(e))t(e[n],n)}function GT(e,t=` `){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function KT(e){return qT(GT(e))}const Ofe=e=>e.toUpperCase();function kfe(e){return e?typeof e==`string`?e.toUpperCase():`${e}`.toUpperCase():``}function qT(e){return e.toLowerCase().replace(/^\w|\s\w/g,Ofe)}function Afe(e){return e.replace(/_/g,` `)}function jfe(e){return e.replace(/-/g,` `)}function JT(e){return qT(GT(Afe(jfe(e))))}function Mfe(e,t){let n=Object.keys(t),r=Object.values(t);return Function(...n,`return \`${e}\`;`)(...r)}function YT(e){return e.replace(/<\/?[^>]+>/g,``)}function XT(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function ZT(){return ZT.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;function n(e,n,r){let i=t();return i[0]=e,i[1]=n,i[2]=r,i}e.create=n;function r(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}e.set=r;function i(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}e.distance=i;function a(e,t){let[n,r,i]=tE.toRgb(t),[a,o,s]=T(n,r,i),c=116*o-16;return e[0]=c<0?0:c,e[1]=500*(a-o),e[2]=200*(o-s),e}e.fromColor=a;function o(e,t){return QT.toLab(e,t)}e.fromHcl=o;function s(e){let t=(e[0]+16)/116,n=isNaN(e[1])?t:t+e[1]/500,r=isNaN(e[2])?t:t-e[2]/200;t=_*S(t),n=g*S(n),r=v*S(r);let i=x(3.2404542*n-1.5371385*t-.4985314*r),a=x(-.969266*n+1.8760108*t+.041556*r),o=x(.0556434*n-.2040259*t+1.0572252*r);return tE.fromRgb(Math.round(DT(i,0,255)),Math.round(DT(a,0,255)),Math.round(DT(o,0,255)))}e.toColor=s;function c(e,t){let[n,r,i]=t,a=Math.sqrt(r*r+i*i),o=(IT(Math.atan2(i,r))+360)%360;return Math.round(a*1e4)===0&&(o=NaN),e[0]=o,e[1]=a,e[2]=n,e}e.toHcl=c;function l(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}e.copy=l;function u(e,t,n){return e[0]=t[0]-h*n,e[1]=t[1],e[2]=t[2],e}e.darken=u;function d(e,t,n){return u(e,t,-n)}e.lighten=d;let f=[0,0,0];function p(e,t,n){return c(f,t),QT.toLab(e,QT.saturate(f,f,n))}e.saturate=p;function m(e,t,n){return p(e,t,-n)}e.desaturate=m;let h=18,g=.95047,_=1,v=1.08883,y=.137931034,b=.12841855;function x(e){return 255*(e<=.00304?12.92*e:1.055*e**(1/2.4)-.055)}function S(e){return e>.206896552?e*e*e:b*(e-y)}function C(e){return(e/=255)<=.04045?e/12.92:((e+.055)/1.055)**2.4}function w(e){return e>.008856452?e**(1/3):e/b+y}function T(e,t,n){return e=C(e),t=C(t),n=C(n),[w((.4124564*e+.3575761*t+.1804375*n)/g),w((.2126729*e+.7151522*t+.072175*n)/1),w((.0193339*e+.119192*t+.9503041*n)/v)]}})(ZT||={});function QT(){return QT.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;function n(e,n,r){let i=t();return i[0]=e,i[1]=n,i[2]=r,i}e.create=n;function r(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}e.set=r;function i(e){return!isNaN(e[0])}e.hasHue=i;let a=[0,0,0];function o(e,t){return ZT.toHcl(e,ZT.fromColor(a,t))}e.fromColor=o;function s(e,t){return ZT.toHcl(e,t)}e.fromLab=s;let c=[0,0,0];function l(e){return ZT.toColor(u(c,e))}e.toColor=l;function u(e,t){let[n,r,i]=t;return isNaN(n)&&(n=0),n=FT(n),e[0]=i,e[1]=Math.cos(n)*r,e[2]=Math.sin(n)*r,e}e.toLab=u;function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}e.copy=d;function f(e,t,n){return e[0]=t[0],e[1]=Math.max(0,t[1]+_*n),e[2]=t[2],e}e.saturate=f;function p(e,t,n){return f(e,t,-n)}e.desaturate=p;let m=[0,0,0];function h(e,t,n){return u(m,t),ZT.toHcl(e,ZT.darken(m,m,n))}e.darken=h;function g(e,t,n){return h(e,t,-n)}e.lighten=g;let _=18})(QT||={});function $T(){return $T.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;function n(e,t){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(t&255)/255,e}e.fromColor=n;function r(e){return e[0]*255<<16|e[1]*255<<8|e[2]*255}e.toColor=r})($T||={});function eE(){return eE.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;let n=$T();function r(t,r){return $T.fromColor(n,r),e.fromRgb(t,n)}e.fromColor=r;function i(e){return c(n,e),$T.toColor(n)}e.toColor=i;function a(e,t){let[n,r,i]=t,a=Math.min(n,r,i),o=Math.max(n,r,i),s=(o+a)/2,c=0,l=0;return o===a?(c=0,l=NaN):c=s<.5?(o-a)/(o+a):(o-a)/(2-o-a),n===o?l=(r-i)/(o-a):r===o?l=2+(i-n)/(o-a):i===o&&(l=4+(n-r)/(o-a)),l*=60,l<0&&(l+=360),e[0]=l,e[1]=c,e[2]=s,e}e.fromRgb=a;let o=[0,0,0],s=[0,0,0];function c(e,t){let[n,r,i]=t,a,c,l;if(r===0)a=c=l=i;else{let e=o,t=s,u=i<.5?i*(1+r):i+r-i*r,d=2*i-u,f=n/360;e[0]=f+1/3,e[1]=f,e[2]=f-1/3;for(let n=0;n<3;n++)e[n]<0&&(e[n]+=1),e[n]>1&&--e[n],6*e[n]<1?t[n]=d+(u-d)*6*e[n]:2*e[n]<1?t[n]=u:3*e[n]<2?t[n]=d+(u-d)*(2/3-e[n])*6:t[n]=d;a=t[0],c=t[1],l=t[2]}return e[0]=a,e[1]=c,e[2]=l,e}e.toRgb=c;function l(e,t,n,r){let i=t,a=n,[o,s,c]=i,[l,u,d]=a,f,p,m;!isNaN(o)&&!isNaN(l)?(m=l>o&&l-o>180?l-(o+360):l<o&&o-l>180?l+360-o:l-o,p=o+r*m):isNaN(o)?isNaN(l)?p=NaN:(p=l,(c===1||c===0)&&(f=u)):(p=o,(d===1||d===0)&&(f=s)),f===void 0&&(f=s+r*(u-s));let h=c+r*(d-c);return e[0]=p,e[1]=f,e[2]=h,e}e.interpolate=l})(eE||={});function tE(e){return e}(function(e){function t(e){return`rgb(${e>>16&255}, ${e>>8&255}, ${e&255})`}e.toStyle=t;function n(e){return`#`+(`000000`+e.toString(16)).slice(-6)}e.toHexStyle=n;function r(e){return`0x`+(`000000`+e.toString(16)).slice(-6)}e.toHexString=r;function i(t){return`RGB: ${e.toRgb(t).join(`, `)}`}e.toRgbString=i;function a(e){return[e>>16&255,e>>8&255,e&255]}e.toRgb=a;function o(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]}e.toRgbNormalized=o;function s(e){return parseInt(e.replace(`#`,`0x`))}e.fromHexStyle=s;function c(e){return parseInt(e)}e.fromHexString=c;function l(e,t,n){return e<<16|t<<8|n}e.fromRgb=l;function u(e,t,n){return e*255<<16|t*255<<8|n*255}e.fromNormalizedRgb=u;function d(e,t){return l(e[t],e[t+1],e[t+2])}e.fromArray=d;function f(e,t){return u(e[t],e[t+1],e[t+2])}e.fromNormalizedArray=f;function p(e){return typeof e==`number`?e:e[0]}e.fromColorListEntry=p;function m(e,t,n){return t[n]=e>>16&255,t[n+1]=e>>8&255,t[n+2]=e&255,t}e.toArray=m;function h(e,t,n){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(e&255)/255,t}e.toArrayNormalized=h;function g(e,t){return e[0]=t>>16&255,e[1]=t>>8&255,e[2]=t&255,e}e.toVec3=g;function _(e,t){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(t&255)/255,e}e.toVec3Normalized=_;function v(e,t,n){let r=e>>16&255,i=e>>8&255,a=e&255,o=t>>16&255,s=t>>8&255,c=t&255,l=r+(o-r)*n,u=i+(s-i)*n,d=a+(c-a)*n;return l<<16|u<<8|d}e.interpolate=v;let y=eE.zero(),b=eE.zero();function x(e,t,n){let r=eE.fromColor(y,e),i=eE.fromColor(b,t);return eE.interpolate(r,r,i,n),eE.toColor(r)}e.interpolateHsl=x;function S(e){let t=e>>16&255,n=e>>8&255,r=e&255;return t!==n||t!==r}e.hasHue=S;let C=[0,0,0];function w(e,t){return S(e)?(QT.fromColor(C,e),QT.toColor(QT.saturate(C,C,t))):e}e.saturate=w;function T(e,t){return w(e,-t)}e.desaturate=T;let E=[0,0,0];function D(e,t){return ZT.fromColor(E,e),ZT.toColor(ZT.darken(E,E,t))}e.darken=D;function O(e,t){return D(e,-t)}e.lighten=O;function k(e){return e<=.03928?e/12.92:((e+.055)/1.055)**2.4}function A(e){let t=k((e>>16&255)/255),n=k((e>>8&255)/255),r=k((e&255)/255);return .2126*t+.7152*n+.0722*r}e.luminance=A;function j(e,t){let n=A(e),r=A(t);return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}e.contrast=j;function M(e){return e<.04045?e*.0773993808:(e*.9478672986+.0521327014)**2.4}function N(e){return u(M((e>>16&255)/255),M((e>>8&255)/255),M((e&255)/255))}e.sRGBToLinear=N;function ee(e){return e<.0031308?e*12.92:1.055*e**.41666-.055}function te(e){return u(ee((e>>16&255)/255),ee((e>>8&255)/255),ee((e&255)/255))}e.linearToSRGB=te})(tE||={});function nE(e,t,n,r){return{label:e,description:n,list:r,type:t}}function rE(e){return e}function iE(e,t,n){let r={};for(let i in e){let a=e[i];a=tE.saturate(a,t),a=tE.darken(a,-n),r[i]=a}return r}function Nfe(e){return e}const aE={reds:nE(`Reds`,`sequential`,`Reds, sequential color scheme from ColorBrewer 2.0`,[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),oranges:nE(`Oranges`,`sequential`,`Oranges, sequential color scheme from ColorBrewer 2.0`,[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),greens:nE(`Greens`,`sequential`,`Greens, sequential color scheme from ColorBrewer 2.0`,[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),blues:nE(`Blues`,`sequential`,`Blues, sequential color scheme from ColorBrewer 2.0`,[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),purples:nE(`Purples`,`sequential`,`Purples, sequential color scheme from ColorBrewer 2.0`,[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),greys:nE(`Greys`,`sequential`,`Greys, sequential color scheme from ColorBrewer 2.0`,[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"orange-red":nE(`Orange-Red`,`sequential`,`OrRd, sequential color scheme from ColorBrewer 2.0`,[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"blue-green":nE(`Blue-Green`,`sequential`,`BuGn, sequential color scheme from ColorBrewer 2.0`,[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"purple-blue-green":nE(`Purple-Blue-Green`,`sequential`,`PuBuGn, sequential color scheme from ColorBrewer 2.0`,[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),"green-blue":nE(`Green-Blue`,`sequential`,`GnBu, sequential color scheme from ColorBrewer 2.0`,[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),"purple-blue":nE(`Purple-Blue`,`sequential`,`PuBu, sequential color scheme from ColorBrewer 2.0`,[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":nE(`Blue-Purple`,`sequential`,`BuPu, sequential color scheme from ColorBrewer 2.0`,[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),"red-purple":nE(`Red-Purple`,`sequential`,`RdPu, sequential color scheme from ColorBrewer 2.0`,[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),"purple-red":nE(`Purple-Red`,`sequential`,`PuRd, sequential color scheme from ColorBrewer 2.0`,[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),"yellow-orange-red":nE(`Yellow-Orange-Red`,`sequential`,`YlOrRd, sequential color scheme from ColorBrewer 2.0`,[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"yellow-orange-brown":nE(`Yellow-Orange-Brown`,`sequential`,`YlOrBr, sequential color scheme from ColorBrewer 2.0`,[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":nE(`Yellow-Green`,`sequential`,`YlGn, sequential color scheme from ColorBrewer 2.0`,[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),"yellow-green-blue":nE(`Yellow-Green-Blue`,`sequential`,`YlGnBu, sequential color scheme from ColorBrewer 2.0`,[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),"red-blue":nE(`Red-Blue`,`diverging`,`RdBu, diverging color scheme from ColorBrewer 2.0`,[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"red-grey":nE(`Red-Grey`,`diverging`,`RdGy, diverging color scheme from ColorBrewer 2.0`,[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"pink-yellow-green":nE(`Pink-Yellow-Green`,`diverging`,`PiYG, diverging color scheme from ColorBrewer 2.0`,[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"brown-white-green":nE(`Brown-White-Green`,`diverging`,`BrBG, diverging color scheme from ColorBrewer 2.0`,[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"purple-green":nE(`Purple-Green`,`diverging`,`PRGn, diverging color scheme from ColorBrewer 2.0`,[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"purple-orange":nE(`Purple-Orange`,`diverging`,`PuOr, diverging color scheme from ColorBrewer 2.0`,[2949195,5515144,8418220,11709394,14211819,16250871,16703670,16627811,14713364,11753478,8338184]),"orange-purple":nE(`Orange-Purple`,`diverging`,`Reversed PuOr, diverging color scheme from ColorBrewer 2.0`,[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"red-yellow-green":nE(`Red-Yellow-Green`,`diverging`,`RdYlGn, diverging color scheme from ColorBrewer 2.0`,[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-yellow-blue":nE(`Red-Yellow-Blue`,`diverging`,`RdYlBu, diverging color scheme from ColorBrewer 2.0`,[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),spectral:nE(`Spectral`,`diverging`,`Spectral, diverging color scheme from ColorBrewer 2.0`,[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),magma:nE(`Magma`,`sequential`,`Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white`,[4,131595,328726,591648,920363,1314358,1708098,2167117,2691418,3346535,3870576,4460406,4985210,5510013,5969279,6560384,7019905,7676289,8135554,8660609,9185665,9710720,10235519,10826110,11351164,12007289,12532343,13057395,13516656,14042475,14567784,14962532,15357537,15687006,16017244,16216156,16349533,16483167,16551011,16619112,16686957,16689523,16692347,16694658,16696970,16699282,16701594,16638627,16640940,16577718,16580031]),"magma-no-black":nE(`Magma (no black)`,`sequential`,`Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white (with the black region removed)`,[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:nE(`Inferno`,`sequential`,`Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow`,[4,131596,328727,657186,1050925,1444665,1969221,2427985,3082843,3737955,4328040,4852843,5377645,5902702,6427502,6952814,7477870,8133997,8659051,9184105,9643623,10168676,10693729,11218782,11743834,12334932,12794703,13254730,13583429,14109502,14504250,14833460,15162926,15427112,15757088,15955993,16154643,16288012,16421383,16489222,16557322,16559634,16497183,16434218,16305463,16176966,16048470,15919721,15921789,16120210,16580516]),"inferno-no-black":nE(`Inferno (no black)`,`sequential`,`Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow (with the black region removed)`,[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:nE(`Plasma`,`sequential`,`Plasma, sequential color scheme from Matplotlib, perceptually uniform shades of blue-red-yellow`,[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:nE(`Viridis`,`sequential`,`Viridis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-green-yellow`,[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:nE(`Cividis`,`sequential`,`Cividis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-grey-yellow, should look effectively identical to colorblind and non-colorblind users`,[8273,9305,10079,76644,339560,668266,1062508,1390957,1916270,2375790,2835566,3295342,3754862,4214638,4543085,5068397,5462638,5856878,6185326,6579567,6908272,7236721,7499890,7828595,8091764,8354933,8617846,8946551,9209463,9472888,9736056,10064760,10327928,10656632,10985591,11379830,11708532,12102770,12497264,12891501,13285994,13745766,14140259,14600287,14994522,15389014,15717970,16046926,16310347,16508232,16640581]),twilight:nE(`Twilight`,`cyclical`,`Twilight, cyclical color scheme from Matplotlib, perceptually uniform shades of white-blue-black-red-white`,[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),"set-2":nE(`Set-2`,`qualitative`,`Set2, categorical color scheme from ColorBrewer 2.0`,[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:nE(`Accent`,`qualitative`,`Accent, categorical color scheme from ColorBrewer 2.0`,[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":nE(`Set-1`,`qualitative`,`Set1, categorical color scheme from ColorBrewer 2.0`,[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":nE(`Set-3`,`qualitative`,`Set3, categorical color scheme from ColorBrewer 2.0`,[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":nE(`Dark-2`,`qualitative`,`Dark2, categorical color scheme from ColorBrewer 2.0`,[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:nE(`Paired`,`qualitative`,`Paired, categorical color scheme from ColorBrewer 2.0`,[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":nE(`Pastel-2`,`qualitative`,`Pastel2, categorical color scheme from ColorBrewer 2.0`,[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":nE(`Pastel-1`,`qualitative`,`Pastel1, categorical color scheme from ColorBrewer 2.0`,[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),turbo:nE(`Turbo`,`sequential`,`Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization`,[2299675,3547990,4337541,4799658,4934343,4872413,4613867,4289780,3900152,3510520,3120629,2796271,2602726,2474716,2477264,2611140,2875575,3270826,3731101,4387984,5109892,5897080,6815085,7798371,8781145,9829201,10811209,11858498,12774460,13755446,14605618,15389486,16042283,16563496,16757029,16753699,16750369,16746782,16743196,16608538,16146200,15487253,14763026,13973263,13052940,12198408,11344133,10621442,9965056,9571328,9440256]),"turbo-no-black":nE(`Turbo (no black)`,`sequential`,`Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization, with black region removed`,[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),warm:nE(`Warm`,`sequential`,`Warm, sequential color scheme from D3.js`,[7225514,7684013,8208303,8797873,9322162,9846195,10370483,10960051,11484338,12008625,12532911,13057452,13581737,14040742,14434210,14959005,15352473,15746196,16074382,16402824,16665475,16731772,16732790,16733808,16734826,16735843,16737117,16738135,16739409,16740939,16742471,16743746,16745277,16747065,16748598,16487987,16162097,15901743,15575598,15184174,14858031,14466608,14140466,13748788,13422648,13030972,12704833,12378438,12052044,11791187,11530331]),cool:nE(`Cool`,`sequential`,`Cool, sequential color scheme from D3.js`,[7225514,7095217,6899639,6769597,6574275,6313160,6117837,5856977,5596117,5335513,5009115,4748510,4422368,4161761,3835361,3575009,3314401,3053791,2793438,2598363,2337752,2208213,2013137,1883340,1819335,1755074,1691068,1692086,1758640,1825706,1957795,2155164,2352790,2615695,2878601,3207042,3600764,3994230,4453489,4912492,5437031,5961315,6551391,7140956,7730778,8386136,8975703,9630807,10285911,10940761,11530331]),"cubehelix-default":nE(`CubehelixDefault`,`sequential`,`CubehelixDefault, sequential color scheme from D3.js`,[0,525064,984594,1313308,1576742,1709360,1776697,1712705,1649479,1520715,1457486,1394254,1396557,1529674,1662534,2057794,2518076,3109175,3765555,4618288,5536047,6519343,7568178,8550967,9599551,10516809,11368789,12155235,12745329,13270146,13663891,13861539,13928371,13929921,13800654,13606106,13411811,13217514,12957935,12829170,12700403,12768243,12835826,13099761,13428976,13823727,14349039,14939888,15530483,16186616,16777215]),rainbow:nE(`Rainbow`,`cyclical`,`Rainbow, cyclical color scheme from D3.js`,[7225514,8208303,9322162,10370483,11484338,12532911,13581737,14434210,15352473,16074382,16665475,16732790,16734826,16737117,16739409,16742471,16745277,16748598,16162097,15575598,14858031,14140466,13422648,12704833,12052044,11530331,10285911,8975703,7730777,6485855,5437031,4453489,3600764,2878601,2352790,1957795,1758896,1691068,1819335,2013137,2337752,2793438,3314401,3835617,4422368,5009115,5596117,6117837,6574275,6899639,7225514]),sinebow:nE(`Sinebow`,`cyclical`,`Sinebow, cyclical color scheme from D3.js`,[16728128,16666162,16473382,16149788,15695122,15174923,14458117,13740802,12892928,11978752,10999043,9953287,8972813,7860757,6879262,5831722,4849463,3931972,3079507,2357858,1635442,1109378,648082,317858,118193,49087,111053,303833,561890,1081837,1602292,2319098,3036157,3884287,4798463,5778172,6823928,7804402,8916458,9897952,10945493,11927752,12845243,13697708,14419357,15141773,15667837,16129133,16459357,16659022,16728128]),"category-10":nE(`Category10`,`qualitative`,`Category10, categorical color scheme from D3.js / tab10 from Matplotlib (default in Matplotlib)`,[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175]),"observable-10":nE(`Observable10`,`qualitative`,`Observable10, categorical color scheme from D3.js`,[4352464,15708440,16740956,7128496,3975505,16747191,10773490,9944053,10251086,9738400]),"tableau-10":nE(`Tableau10`,`qualitative`,`Tableau10, categorical color scheme from D3.js`,[5142951,15896108,14767961,7780274,5873999,15583561,11500193,16752039,10253663,12234923]),"simple-rainbow":nE(`Simple rainbow`,`sequential`,`Simple 5-color rainbow (blue-green-yellow-orange-red)`,[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":nE(`Red-White-Blue`,`diverging`,`Diverging color scheme with red-white-blue`,[12526114,16777215,3367393]),"many-distinct":nE(`Many-Distinct`,`qualitative`,`Customized color scheme combining colors from multiple standard schemes (Dark2, Set1, Set2)`,[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947])},oE=Object.keys(aE).map(e=>[e,aE[e].label,qT(aE[e].type),aE[e].description]),Pfe=oE.filter(e=>aE[e[0]].type===`sequential`||aE[e[0]].type===`diverging`||aE[e[0]].type===`cyclical`),Ffe=oE.filter(e=>aE[e[0]].type===`qualitative`);function sE(e){return e in aE?aE[e]:(console.warn(`unknown color list named '${e}'`),aE[`red-yellow-blue`])}var V;(function(e){e.Essential={isEssential:!0};function t(e,t){return t?(t.label&&(e.label=t.label),t.description&&(e.description=t.description),t.legend&&(e.legend=t.legend),t.fieldLabels&&(e.fieldLabels=t.fieldLabels),t.isHidden&&(e.isHidden=t.isHidden),t.shortLabel&&(e.shortLabel=t.shortLabel),t.twoColumns&&(e.twoColumns=t.twoColumns),t.isEssential&&(e.isEssential=t.isEssential),t.category&&(e.category=t.category),t.hideIf&&(e.hideIf=t.hideIf),t.help&&(e.help=t.help),e):e}function n(e){let t={...e};return t.isOptional=!0,t}e.Optional=n;function r(e,n){return t({type:`value`,defaultValue:e},n)}e.Value=r;function i(e,n,r){return t({type:`select`,defaultValue:ge(e,n),options:n,cycle:r?.cycle},r)}e.Select=i;function a(e,n,r){let i=t({type:`multi-select`,defaultValue:e,options:n},r);return r?.emptyValue&&(i.emptyValue=r.emptyValue),i}e.MultiSelect=a;function o(e,n){return t({type:`boolean`,defaultValue:e},n)}e.Boolean=o;function s(e=``,n){return t({type:`text`,defaultValue:e,multiline:n?.multiline,placeholder:n?.placeholder,disableInteractiveUpdates:n?.disableInteractiveUpdates},n)}e.Text=s;function c(e,n){let r=t({type:`color`,defaultValue:e},n);return n?.isExpanded&&(r.isExpanded=n.isExpanded),r}e.Color=c;function l(e,n){let r;if(typeof e==`string`){let t=sE(e);r={kind:t.type===`qualitative`?`set`:`interpolate`,colors:t.list}}else r=e;return t({type:`color-list`,presetKind:n?.presetKind||`all`,defaultValue:r,offsets:!!n?.offsets},n)}e.ColorList=l;function u(e,n,r){return t(h({type:`vec3`,defaultValue:e},n),r)}e.Vec3=u;function d(e,n){return t({type:`mat4`,defaultValue:e},n)}e.Mat4=d;function f(e,n){return t({type:`url`,defaultValue:typeof e==`string`?gx.Url(e):gx.Url(e.url,{body:e.body})},n)}e.Url=f;function p(e){let n=t({type:`file`,defaultValue:null},e);return e?.accept&&(n.accept=e.accept),n}e.File=p;function m(e){let n=t({type:`file-list`,defaultValue:null},e);return e?.accept&&(n.accept=e.accept),n}e.FileList=m;function h(e,t){return t?(t.min!==void 0&&(e.min=t.min),t.max!==void 0&&(e.max=t.max),t.step!==void 0&&(e.step=t.step),e):e}function g(e,n,r){let i=t(h({type:`number`,defaultValue:e},n),r);return r?.immediateUpdate&&(i.immediateUpdate=!0),i}e.Numeric=g;function _(e,n,r){return t(h({type:`interval`,defaultValue:e},n),r)}e.Interval=_;function v(e,n){let r=t({type:`line-graph`,defaultValue:e},n);return n?.getVolume&&(r.getVolume=n.getVolume),r}e.LineGraph=v;function y(e,n){let r=t({type:`group`,defaultValue:n?.customDefault||M(e),params:e},n);return n?.presets&&(r.presets=n.presets),n?.isExpanded&&(r.isExpanded=n.isExpanded),n?.isFlat&&(r.isFlat=n.isFlat),n?.pivot&&(r.pivot=n.pivot),r}e.Group=y;function b(e){return y({},e)}e.EmptyGroup=b;function x(e,n,r,a){let o=ge(e,n);return t({type:`mapped`,defaultValue:{name:o,params:r(o).defaultValue},select:i(o,n,a),map:r},a)}e.Mapped=x;function S(e,n,r){let a=r?.options?r.options:Object.keys(n).map(e=>[e,n[e].label||JT(e)]),o=ge(e,a);return t({type:`mapped`,defaultValue:{name:o,params:n[o].defaultValue},select:i(o,a,r),map:e=>n[e]},r)}e.MappedStatic=S;function C(e,n,r){return t({type:`object-list`,element:e,getLabel:n,ctor:w,defaultValue:r?.defaultValue||[]},r)}e.ObjectList=C;function w(){return M(this.element)}function T(){throw Error(`getValue not set. Fix runtime.`)}function E(e,n,r){return t({type:`value-ref`,defaultValue:{ref:r?.defaultRef??``,getValue:T},getOptions:e,resolveRef:n},r)}e.ValueRef=E;function D(e){return t({type:`data-ref`,defaultValue:{ref:e?.defaultRef??``,getValue:T}},e)}e.DataRef=D;function O(e,n,r){return t({type:`converted`,defaultValue:n(r.defaultValue),converted:r,fromValue:e,toValue:n},r)}e.Converted=O;function k(e,n,r,a,o){let s=Object.keys(n).map(e=>[e,e]);return t({type:`conditioned`,select:i(r(e),s,o),defaultValue:e,conditionParams:n,conditionForValue:r,conditionedValue:a},o)}e.Conditioned=k;function A(e,n){return t({type:`script`,defaultValue:e},n)}e.Script=A;function j(e){return 0}e.For=j;function M(e){let t={};for(let n of Object.keys(e))e[n].isOptional||(t[n]=e[n].defaultValue);return t}e.getDefaultValues=M;function N(e,t,n){return()=>e(t,n)}function ee(e,t,n){if(t){if(e.type===`value-ref`){let r=t;r.ref?r.getValue=N(e.resolveRef,r.ref,n):r.getValue=()=>{throw Error(`Unset ref in ValueRef value.`)}}else if(e.type===`data-ref`){let e=t;e.ref?e.getValue=N(n,e.ref,n):e.getValue=()=>{throw Error(`Unset ref in ValueRef value.`)}}else if(e.type===`group`)ne(e.params,t,n);else if(e.type===`mapped`){let r=t;ee(e.map(r.name),r.params,n)}else if(e.type===`object-list`){if(!P(e.element))return;for(let r of t)ne(e.element,r,n)}}}function te(e){if(e.type===`value-ref`||e.type===`data-ref`)return!0;if(e.type===`group`){if(P(e.params))return!0}else if(e.type===`mapped`){for(let[t]of e.select.options)if(te(e.map(t)))return!0}else if(e.type===`object-list`)return P(e.element);return!1}function P(e){for(let t of Object.keys(e))if(te(e[t]))return!0;return!1}function ne(e,t,n){for(let r of Object.keys(e))ee(e[r],t?.[r],n)}e.resolveRefs=ne;function re(e,t){for(let n of Object.keys(e))e[n].isOptional||(e[n].defaultValue=t[n])}e.setDefaultValues=re;function ie(e){return UT(e)}e.clone=ie;function ae(e,t){}e.validate=ae;function oe(e,t,n){if(t===n)return!0;if(typeof t!=`object`||typeof n!=`object`)return!1;for(let r of Object.keys(e))if(!se(e[r],t[r],n[r]))return!1;return!0}e.areEqual=oe;function se(e,t,n){if(t===n)return!0;if(e.type===`group`)return oe(e.params,t,n);if(e.type===`mapped`){let r=t,i=n;return r.name===i.name?se(e.map(r.name),r.params,i.params):!1}else if(e.type===`multi-select`){let e=t,r=n;if(e.length!==r.length)return!1;if(e.length<10){for(let t=0,n=e.length;t<n;t++)if(e[t]!==r[t]&&r.indexOf(e[t])<0)return!1}else{let t=new Set(r);for(let n=0,i=e.length;n<i;n++)if(e[n]!==r[n]&&!t.has(e[n]))return!1}return!0}else if(e.type===`interval`)return t[0]===n[0]&&t[1]===n[1];else if(e.type===`line-graph`){let e=t,r=n;if(e.length!==r.length)return!1;for(let t=0,n=e.length;t<n;t++)if(!R.areEqual(e[t],r[t]))return!1;return!0}else if(e.type===`vec3`)return B.equals(t,n);else if(e.type===`mat4`)return z.areEqual(t,n,CT);else if(e.type===`script`){let e=t,r=n;return e.language===r.language&&e.expression===r.expression}else if(e.type===`object-list`){let r=t,i=n,a=r.length;if(a!==i.length)return!1;for(let t=0;t<a;t++)if(!oe(e.element,r[t],i[t]))return!1;return!0}else if(typeof t==`object`&&typeof n==`object`)return Dx(t,n);return!1}e.isParamEqual=se;function ce(e,t,n){if(t===void 0)return{...n};if(n===void 0)return{...t};let r={};for(let i of Object.keys(e))r[i]=le(e[i],t[i],n[i]);return r}e.merge=ce;function le(e,t,n){if(t===void 0)return typeof n==`object`&&!Array.isArray(n)?{...n}:n;if(n===void 0)return typeof t==`object`&&!Array.isArray(t)?{...t}:t;if(e.type===`group`)return ce(e.params,t,n);if(e.type===`mapped`){let r=t,i=n;if(r.name!==i.name)return{...i};let a=e.map(i.name);return{name:i.name,params:le(a,r.params,i.params)}}else if(e.type===`value`)return n;else if(typeof t==`object`&&typeof n==`object`)return Array.isArray(n)?n:{...t,...n};else return n}e.mergeParam=le;function ue(e,t){for(let n of e.options)if(n[0]===t)return!0;return!1}function de(e,t,n){if(t==null)return n?e.defaultValue:void 0;if(e.type===`value`)return t;if(e.type===`group`){let r={};for(let i of Object.keys(e.params)){let a=e.params[i];t[i]===void 0?n&&(r[i]=a.defaultValue):r[i]=de(a,t[i],n)}return r}else if(e.type===`mapped`){let r=t;if(typeof r.name!=`string`)return e.defaultValue;if(r.params===void 0)return n?e.defaultValue:void 0;if(!ue(e.select,r.name))return e.defaultValue;let i=e.map(r.name);return{name:r.name,params:de(i,r.params,n)}}else if(e.type===`select`)return ue(e,t)?t:e.defaultValue;else if(e.type===`multi-select`){if(!Array.isArray(t))return e.defaultValue;let n=t.filter(function(e){return ue(this,e)},e);return t.length>0&&n.length===0?e.defaultValue:n}else if(e.type===`object-list`)return Array.isArray(t)?t.map(t=>fe(e.element,t,n?`all`:`skip`)):e.defaultValue;return t}function fe(e,t,n){if(typeof t!=`object`||!t)return n?M(e):t;let r={};for(let i of Object.keys(e)){let a=e[i];t[i]===void 0?n===`all`&&(r[i]=a.defaultValue):r[i]=de(a,t[i],n!==`skip`)}return r}e.normalizeParams=fe;function pe(e,t){let n=[];for(let r of Object.keys(e))if(!t)typeof e[r]==`string`?n.push([r,e[r]]):n.push([r,t===null?r:JT(r)]);else{let i=t(r,e[r]);n.push(typeof i==`string`?[r,i]:[r,i[0],i[1]])}return n}e.objectToOptions=pe;function me(e,t){let n=[];for(let r of e)t?n.push([r,t(r)]):n.push([r,t===null?r:JT(r)]);return n}e.arrayToOptions=me;function he(e,t){for(let n of e.options)if(n[0]===t)return n[1];return``}e.optionLabel=he;function ge(e,t){for(let n of t)if(n[0]===e)return e;return t.length>0?t[0][0]:void 0}function _e(e,t){let n={};for(let r of Object.keys(t)){let i=t[r];!e[r]||i==null||e[r].defaultValue===i||(n[r]={...e[r],defaultValue:i})}return{...e,...n}}e.withDefaults=_e})(V||={});var cE;(function(e){function t(e){let t={create(e){return{action:t,params:e}},id:zy.create22(),definition:e,createDefaultParams(t,n){return e.params?V.getDefaultValues(e.params(t,n)):{}}};return t}e.create=t;function n(e){let n=e.definition;return t({from:n.from,display:n.display,params:n.params,isApplicable:e.definition.isApplicable?(t,n,r)=>e.definition.isApplicable(t,r):void 0,run({cell:t,state:n,params:r}){let i=n.build().to(t.transform.ref).apply(e,r);return n.updateTree(i)}})}e.fromTransformer=n;let r;(function(e){function n(e){return n=>t({from:e.from instanceof Array?e.from:e.from?[e.from]:[],display:typeof e.display==`string`?{name:e.display}:e.display?e.display:{name:`Unnamed State Action`},params:typeof e.params==`object`?()=>e.params:e.params?e.params:void 0,isApplicable:e.isApplicable,...typeof n==`function`?{run:n}:n})}e.build=e=>n(e)})(r=e.Builder||={}),e.build=r.build})(cE||={});var lE;(function(e){function t(e,t,n){return e.definition.params?e.definition.params(t,n):{}}e.getParamDefinition=t;function n(e){return!!e&&typeof e.toAction==`function`&&typeof e.apply==`function`}e.is=n;let r;(function(e){e[e.Unchanged=0]=`Unchanged`,e[e.Updated=1]=`Updated`,e[e.Recreate=2]=`Recreate`,e[e.Null=3]=`Null`})(r=e.UpdateResult||={});let i=new Map,a=new Map;function o(e){for(let t of e.definition.from)a.has(t.type)?a.get(t.type).push(e):a.set(t.type,[e])}function s(){return Array.from(i.values())}e.getAll=s;function c(e){let t=i.get(e);if(!t)throw Error(`A transformer with signature '${e}' is not registered.`);return t}e.get=c;function l(e){return a.get(e)||[]}e.fromType=l;function u(e,t){let{name:n}=t,r=`${e}.${n}`;i.has(r)&&console.warn(`A transform with id '${n}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);let a={apply(e,t,n){return yE.create(e,a,t,n)},toAction(){return cE.fromTransformer(a)},namespace:e,id:r,definition:t,createDefaultParams(e,n){return t.params?V.getDefaultValues(t.params(e,n)):{}}};return i.set(r,a),o(a),a}e.create=u;function d(e){return t=>u(e,t)}e.factory=d;function f(e){return p.build(e)}e.builderFactory=f;let p;(function(e){function t(e,t){return n=>u(e,{name:t.name,from:t.from instanceof Array?t.from:[t.from],to:t.to instanceof Array?t.to:[t.to],display:typeof t.display==`string`?{name:t.display}:t.display?t.display:{name:qT(t.name.replace(/[-]/g,` `))},params:typeof t.params==`object`?()=>t.params:t.params?t.params:void 0,isDecorator:t.isDecorator,...n})}function n(e){return n=>t(e,n)}e.build=n})(p=e.Builder||={});function m(e){return p.build(e)}e.build=m,e.ROOT=u(`build-in`,{name:`root`,from:[],to:[],display:{name:`Root`,description:`For internal use.`},apply(){throw Error(`should never be applied`)},update(){return r.Unchanged}})})(lE||={});function uE(e){let t=e^e>>4;return t=(t^3735928559)+(t<<5),t^=t>>11,t}function dE(e,t){let n=23;return n=31*n+e|0,n=31*n+t|0,n^=n>>4,n=(n^3735928559)+(n<<5),n^=n>>11,n}function Ife(e,t,n){let r=23;return r=31*r+e|0,r=31*r+t|0,r=31*r+n|0,r^=r>>4,r=(r^3735928559)+(r<<5),r^=r>>11,r}function Lfe(e,t,n,r){let i=23;return i=31*i+e|0,i=31*i+t|0,i=31*i+n|0,i=31*i+r|0,i^=i>>4,i=(i^3735928559)+(i<<5),i^=i>>11,i}function fE(e){let t=0;for(let n=0,r=e.length;n<r;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t}function pE(e,t){return(e+t)*(e+t+1)/2+t}function mE(e,t){return e<t?pE(e,t):pE(t,e)}function hE(e,t){let n=Math.floor((Math.sqrt(8*t+1)-1)/2),r=t-(n*n+n)/2;return e[0]=n-r,e[1]=r,e}function gE(e){let t=2166136261;for(let n=0,r=e.length;n<r;++n)t^=e[n],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}new class{constructor(){this.hashTarget=new Uint32Array(8),this.numberBytes=new Uint8Array(8),this.numberView=new DataView(this.numberBytes.buffer)}hash(e){return this.hashTarget.set(Rfe),this.hashValue(e,0),Hfe(this.hashTarget)}hashValue(e,t){if(t>50)return;let n=typeof e;switch(this.addByte(n.charCodeAt(0)),n){case`string`:this.addString(e);break;case`number`:this.addNumber(e);break;case`boolean`:this.addByte(e?1:0);break;case`object`:e===null?this.addByte(0):Array.isArray(e)?this.addArray(e,t):this.addObject(e,t);break;case`undefined`:this.addByte(255);break}}addByte(e){this.hashTarget[0]^=e&255,zfe(this.hashTarget)}addString(e){for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);n<128?this.addByte(n):n<2048?(this.addByte(192|n>>6),this.addByte(128|n&63)):(this.addByte(224|n>>12),this.addByte(128|n>>6&63),this.addByte(128|n&63))}}addNumber(e){if(Number.isNaN(e))this.addByte(127),this.addByte(192),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0);else if(!Number.isFinite(e))e>0?(this.addByte(127),this.addByte(128),this.addByte(0),this.addByte(0)):(this.addByte(255),this.addByte(128),this.addByte(0),this.addByte(0)),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0);else{this.numberView.setFloat64(0,e,!1);for(let e=0;e<8;e++)this.addByte(this.numberBytes[e])}}addArray(e,t){this.addNumber(e.length);for(let n=0;n<e.length;n++)this.addNumber(n),this.hashValue(e[n],t+1)}addObject(e,t){let n=Object.keys(e).sort();this.addNumber(n.length);for(let r of n)this.addString(r),this.hashValue(e[r],t+1)}};var Rfe=new Uint32Array([1818371886,129696066,1656234357,1653982605,383153456,3715178979,3004645376,256]),_E=new Uint32Array(8),vE=new Uint32Array(8);function zfe(e){_E[0]=0,_E[1]=0,_E[2]=e[0]<<24,_E[3]=e[0]>>>8|e[1]<<24,_E[4]=e[1]>>>8|e[2]<<24,_E[5]=e[2]>>>8|e[3]<<24,_E[6]=e[3]>>>8|e[4]<<24,_E[7]=e[4]>>>8|e[5]<<24,vE[0]=e[0]<<8,vE[1]=e[0]>>>24|e[1]<<8,vE[2]=e[1]>>>24|e[2]<<8,vE[3]=e[2]>>>24|e[3]<<8,vE[4]=e[3]>>>24|e[4]<<8,vE[5]=e[4]>>>24|e[5]<<8,vE[6]=e[5]>>>24|e[6]<<8,vE[7]=e[6]>>>24|e[7]<<8;let t=0;for(let n=0;n<8;n++){let r=e[n]*59+t;e[n]=r>>>0,t=Math.floor(r/4294967296)}t=0;for(let n=0;n<8;n++){let r=e[n]+_E[n]+vE[n]+t;e[n]=r>>>0,t=r>=4294967296?1:0}}var Bfe=[`00000000`,`0000000`,`000000`,`00000`,`0000`,`000`,`00`,`0`];function Vfe(e){let t=e.toString(16);return t.length>=8?t:Bfe[t.length]+t}function Hfe(e){let t=``;for(let n=7;n>=0;n--)t+=Vfe(e[n]);return t}function Ufe(e,t=42){return Wfe(JSON.stringify(e),t)}function Wfe(e,t){let n=t>>>0,r=t>>>0,i=t>>>0,a=t>>>0,o=e.length%16,s=e.length-o;for(let t=0;t<s;t+=16){let o=e.charCodeAt(t)&255|(e.charCodeAt(t+1)&255)<<8|(e.charCodeAt(t+2)&255)<<16|(e.charCodeAt(t+3)&255)<<24,s=e.charCodeAt(t+4)&255|(e.charCodeAt(t+5)&255)<<8|(e.charCodeAt(t+6)&255)<<16|(e.charCodeAt(t+7)&255)<<24,c=e.charCodeAt(t+8)&255|(e.charCodeAt(t+9)&255)<<8|(e.charCodeAt(t+10)&255)<<16|(e.charCodeAt(t+11)&255)<<24,l=e.charCodeAt(t+12)&255|(e.charCodeAt(t+13)&255)<<8|(e.charCodeAt(t+14)&255)<<16|(e.charCodeAt(t+15)&255)<<24;o=Math.imul(o,597399067),o=o<<15|o>>>17,o=Math.imul(o,2869860233),n^=o,n=n<<19|n>>>13,n+=r,n=Math.imul(n,5)+1444728091,s=Math.imul(s,2869860233),s=s<<16|s>>>16,s=Math.imul(s,951274213),r^=s,r=r<<17|r>>>15,r+=i,r=Math.imul(r,5)+197830471,c=Math.imul(c,951274213),c=c<<17|c>>>15,c=Math.imul(c,2716044179),i^=c,i=i<<15|i>>>17,i+=a,i=Math.imul(i,5)+2530024501,l=Math.imul(l,2716044179),l=l<<13|l>>>19,l=Math.imul(l,597399067),a^=l,a=a<<13|a>>>19,a+=n,a=Math.imul(a,5)+850148119}let c=0,l=0,u=0,d=0;switch(o){case 15:d^=e.charCodeAt(s+14)<<16;case 14:d^=e.charCodeAt(s+13)<<8;case 13:d^=e.charCodeAt(s+12),d=Math.imul(d,2716044179),d=d<<13|d>>>19,d=Math.imul(d,597399067),a^=d;case 12:u^=e.charCodeAt(s+11)<<24;case 11:u^=e.charCodeAt(s+10)<<16;case 10:u^=e.charCodeAt(s+9)<<8;case 9:u^=e.charCodeAt(s+8),u=Math.imul(u,951274213),u=u<<17|u>>>15,u=Math.imul(u,2716044179),i^=u;case 8:l^=e.charCodeAt(s+7)<<24;case 7:l^=e.charCodeAt(s+6)<<16;case 6:l^=e.charCodeAt(s+5)<<8;case 5:l^=e.charCodeAt(s+4),l=Math.imul(l,2869860233),l=l<<16|l>>>16,l=Math.imul(l,951274213),r^=l;case 4:c^=e.charCodeAt(s+3)<<24;case 3:c^=e.charCodeAt(s+2)<<16;case 2:c^=e.charCodeAt(s+1)<<8;case 1:c^=e.charCodeAt(s),c=Math.imul(c,597399067),c=c<<15|c>>>17,c=Math.imul(c,2869860233),n^=c}return n^=e.length,r^=e.length,i^=e.length,a^=e.length,n+=r,n+=i,n+=a,r+=n,i+=n,a+=n,n^=n>>>16,n=Math.imul(n,2246822507),n^=n>>>13,n=Math.imul(n,3266489909),n^=n>>>16,r^=r>>>16,r=Math.imul(r,2246822507),r^=r>>>13,r=Math.imul(r,3266489909),r^=r>>>16,i^=i>>>16,i=Math.imul(i,2246822507),i^=i>>>13,i=Math.imul(i,3266489909),i^=i>>>16,a^=a>>>16,a=Math.imul(a,2246822507),a^=a>>>13,a=Math.imul(a,3266489909),a^=a>>>16,n+=r,n+=i,n+=a,r+=n,i+=n,a+=n,(n>>>0).toString(16).padStart(8,`0`)+(r>>>0).toString(16).padStart(8,`0`)+(i>>>0).toString(16).padStart(8,`0`)+(a>>>0).toString(16).padStart(8,`0`)}var yE;(function(e){e.RootRef=`-=root=-`;function t(e,t){return t?t.isCollapsed!==void 0&&e.isCollapsed!==t.isCollapsed||t.isHidden!==void 0&&e.isHidden!==t.isHidden||t.isGhost!==void 0&&e.isGhost!==t.isGhost||t.isLocked!==void 0&&e.isLocked!==t.isLocked:!1}e.isStateChange=t;function n(e,t){if(!t)return!1;let n=!1;for(let r of Object.keys(t)){let i=t[r],a=e[r];!!i!=!!a&&(n=!0,e[r]=i)}return n}e.assignState=n;function r(e,t){if(!t)return!1;let n=!1;for(let r of Object.keys(t)){let i=t[r],a=e[r];!!i!=!!a&&(n=!0,i===void 0?delete e[r]:e[r]=i)}for(let r of Object.keys(e)){let i=t[r],a=e[r];!!i!=!!a&&(n=!0,i===void 0?delete e[r]:e[r]=i)}return n}e.syncState=r;function i(e,t,n,r){let i=r&&r.ref?r.ref:zy.create22(),a;return r&&r.tags&&(a=typeof r.tags==`string`?[r.tags]:r.tags,a.length===0?a=void 0:a.sort()),{parent:e,transformer:t,state:r?.state||{},tags:a,ref:i,dependsOn:r&&r.dependsOn,params:n,version:zy.create22()}}e.create=i;function a(e,t){return{...e,params:t,version:zy.create22()}}e.withParams=a;function o(e,t){return t?{...e,state:{...e.state,...t}}:e}e.withState=o;function s(e,t){let n;return t&&(n=typeof t==`string`?[t]:t,n.length===0?n=void 0:n.sort()),{...e,tags:n,version:zy.create22()}}e.withTags=s;function c(e,t){let n;return t&&(n=typeof t==`string`?[t]:t,n.length===0?n=void 0:n.sort()),{...e,dependsOn:n,version:zy.create22()}}e.withDependsOn=c;function l(e,t){return{...e,parent:t,version:zy.create22()}}e.withParent=l;function u(t){return i(e.RootRef,lE.ROOT,{},{ref:e.RootRef,state:t})}e.createRoot=u;function d(e,t){return e.tags?e.tags.indexOf(t)>=0:!1}e.hasTag=d;function f(e,t){if(!e.tags)return typeof t!=`string`&&t.length===0;if(typeof t==`string`)return d(e,t);for(let n of t)if(e.tags.indexOf(n)<0)return!1;return!0}e.hasTags=f;let p={};function m(e){let t;try{t=Ufe(e.params??p)}catch{t=Ufe((e.transformer.definition.customSerialization?e.transformer.definition.customSerialization.toJSON:h)(e.params??p))}e.version=t}e.setParamsHashVersion=m;function h(e){return e}function g(e){let t=e.transformer.definition.customSerialization?e.transformer.definition.customSerialization.toJSON:h,n;for(let t of Object.keys(e.state))e.state[t]&&(n||={},n[t]=!0);return{parent:e.parent,transformer:e.transformer.id,params:e.params?t(e.params):void 0,state:n,tags:e.tags,ref:e.ref,dependsOn:e.dependsOn,version:e.version}}e.toJSON=g;function _(e){let t=lE.get(e.transformer),n=t.definition.customSerialization?t.definition.customSerialization.fromJSON:h;return{parent:e.parent,transformer:t,params:e.params?n(e.params):void 0,state:e.state||{},tags:e.tags,ref:e.ref,dependsOn:e.dependsOn,version:e.version}}e.fromJSON=_})(yE||={});function bE(e){let t=-1/0;for(let n=0,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}function xE(e){let t=1/0;for(let n=0,r=e.length;n<r;++n)e[n]<t&&(t=e[n]);return t}function SE(e){let t=1/0,n=-1/0;for(let r=0,i=e.length;r<i;++r)e[r]<t&&(t=e[r]),e[r]>n&&(n=e[r]);return[t,n]}function Gfe(e,t=1,n=0){let r=e.length,i=0;for(let a=n;a<r;a+=t)i+=e[a];return i}function CE(e,t=1,n=0){return Gfe(e,t,n)/(e.length/t)}function wE(e){let t=e.length,n=0;for(let r=0;r<t;++r){let t=e[r];n+=t*t}return Math.sqrt(n/t)}function TE(e,t){for(let n=0,r=t?Math.min(t,e.length):e.length;n<r;++n)e[n]=n;return e}function EE(e,t){let n=0,r=!1;for(let i=e.length;n<i;n++)if(e[n]===t){r=!0;break}return r?(DE(e,n),!0):!1}function DE(e,t){for(let n=t,r=e.length-1;n<r;n++)e[n]=e[n+1];e.pop()}function OE(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function kE(e,t){let n=e.indexOf(t);if(n<0)return!1;for(let t=n,r=e.length-1;t<r;t++)e[t]=e[t+1];return e.pop(),!0}function AE(e,t){let n=0;for(let r=0,i=e.length;r<i;++r)t.includes(e[r])&&(n+=1);return n}function jE(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;let n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Kfe(e){for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}function ME(e,t,n){for(let r=0,i=e.length;r<i;++r)if(e[r][0]===t){e[r][1]=n;return}e.push([t,n])}function qfe(e,t){t===void 0&&(t=e,e=0);let n=Math.max(t-e,0),r=Array(n);for(let t=0;t<n;t++)r[t]=e+t;return r}var Jfe=class{get childMutations(){return this._childMutations||=new Map,this._childMutations}get dependencyMutations(){return this._dependencyMutations||=new Map,this._dependencyMutations}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(yE.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).add(t);else{let n=this.children.get(e).asMutable();n.add(t),this.children.set(e,n),this.childMutations.set(e,n)}}removeChild(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).remove(t);else{let n=this.children.get(e).asMutable();n.remove(t),this.children.set(e,n),this.childMutations.set(e,n)}}clearRoot(){let e=yE.RootRef;if(this.children.get(e).size===0)return;this.changeChildren();let t=mT();this.children.set(e,t),this.childMutations.set(e,t)}mutateDependency(e,t,n){let r=this.dependencyMutations.get(e);if(!r){let t=this.dependencies.get(e);if(!t&&n===`remove`)return;this.changeDependencies(),r=t?t.asMutable():mT().asMutable(),this.dependencyMutations.set(e,r),this.dependencies.set(e,r)}n===`add`?r.add(t):r.remove(t)}changeParent(e,t){NE(this.transforms,e);let n=this.transforms.get(e);this.removeChild(n.parent,e),this.addChild(t,e),this.changeNodes(),this.transforms.set(e,yE.withParent(n,t))}add(e){let t=e.ref;this.transforms.has(e.ref)&&this.transforms.get(e.ref).parent!==e.parent&&Zfe(e.ref);let n=this.children.get(e.parent);if(n||Qfe(e.parent),n.has(e.ref)||this.addChild(e.parent,e.ref),this.children.has(e.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(e.ref,mT())),this.changeNodes(),this.transforms.set(t,e),e.dependsOn)for(let n of e.dependsOn)this.mutateDependency(n,t,`add`);return this}setParams(e,t){NE(this.transforms,e);let n=this.transforms.get(e);return HT(n.params,t)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,yE.withParams(n,t)),!0)}setTags(e,t){NE(this.transforms,e);let n=this.transforms.get(e),r=yE.withTags(n,t);return jE(n.tags,r.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,r),!0)}setDependsOn(e,t){NE(this.transforms,e);let n=this.transforms.get(e),r=yE.withDependsOn(n,t);return jE(n.dependsOn,r.dependsOn)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,r),!0)}assignState(e,t){NE(this.transforms,e);let n=this.transforms.get(e);if(this._stateUpdates&&this._stateUpdates.has(e))return yE.assignState(n.state,t),n;{this._stateUpdates||=new Set,this._stateUpdates.add(n.ref),this.changeNodes();let r=yE.withState(n,t);return this.transforms.set(e,r),r}}remove(e){let t=this.transforms.get(e);if(!t)return[];let n=PE.subtreePostOrder(this,t);if(e===yE.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(t.parent,t.ref)}this.changeNodes(),this.changeChildren();for(let e of n)this.transforms.delete(e.ref),this.children.delete(e.ref),this._childMutations&&this._childMutations.delete(e.ref);let r=[];for(let e of n){if(e.dependsOn)for(let t of e.dependsOn)this.transforms.has(t)&&this.mutateDependency(t,e.ref,`remove`);if(this.dependencies.has(e.ref)){let t=this.dependencies.get(e.ref).toArray();this.changeDependencies(),this.dependencies.delete(e.ref),this._dependencyMutations&&this._dependencyMutations.delete(e.ref);for(let e of t)if(this.transforms.has(e))for(let t of this.remove(e))r[r.length]=t}}for(let e of r)n[n.length]=e;return n}asImmutable(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(Yfe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(Xfe,this.dependencies),PE.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))}constructor(e){this.tree=e,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}};function Yfe(e,t){this.set(t,e.asImmutable())}function Xfe(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function Zfe(e){throw Error(`Transform '${e}' is already present in the tree.`)}function Qfe(e){throw Error(`Parent '${e}' must be present in the tree.`)}function NE(e,t){if(!e.has(t))throw Error(`Node '${t}' is not present in the tree.`)}var PE;(function(e){class t{get root(){return this.transforms.get(yE.RootRef)}asTransient(){return new Jfe(this)}constructor(e,t,n){this.transforms=e,this.children=t,this.dependencies=n}}function n(e){let t=e||yE.createRoot();return r(YC([[t.ref,t]]),YC([[t.ref,mT()]]),YC())}e.createEmpty=n;function r(e,n,r){return new t(e,n,r)}e.create=r;function i(e){a(this,this.tree.transforms.get(e))}function a(e,t){let n=e.tree.children.get(t.ref);n&&n.size&&n.forEach(i,e),e.f(t,e.tree,e.state)}function o(e,t,n,r){let i={tree:e,state:n,f:r};return a(i,t),i.state}e.doPostOrder=o;function s(e){c(this,this.tree.transforms.get(e))}function c(e,t){let n=e.f(t,e.tree,e.state);if(typeof n==`boolean`&&!n)return;let r=e.tree.children.get(t.ref);r&&r.size&&r.forEach(s,e)}function l(e,t,n,r){let i={tree:e,state:n,f:r};return c(i,t),i.state}e.doPreOrder=l;function u(e,t,n){n.push(e)}function d(e,t){return o(e,t,[],u)}e.subtreePostOrder=d;function f(e,t,n){n.push(yE.toJSON(e))}function p(e){let t=[];return l(e,e.root,t,f),{transforms:t}}e.toJSON=p;function m(e){let t=YC().asMutable(),n=YC().asMutable(),i=YC().asMutable();for(let r of e.transforms){let e=yE.fromJSON(r);t.set(e.ref,e),n.has(e.ref)||n.set(e.ref,mT().asMutable()),e.ref!==e.parent&&n.get(e.parent).add(e.ref)}let a=new Set;for(let t of e.transforms){let e=t.ref;if(n.set(e,n.get(e).asImmutable()),t.dependsOn)for(let n of t.dependsOn)a.add(n),i.has(n)?i.get(n).add(e):i.set(n,mT([e]).asMutable())}return a.forEach(e=>{i.set(e,i.get(e).asImmutable())}),r(t.asImmutable(),n.asImmutable(),i.asImmutable())}e.fromJSON=m;function h(e){console.log({tr:e.transforms.keySeq().toArray(),tr1:e.transforms.valueSeq().toArray().map(e=>e.ref),ch:e.children.keySeq().toArray()})}e.dump=h;function g(e,t,n){if(t===n)return!0;let r=e.children.get(t).values();for(;;){let t=r.next();if(t.done)return!1;if(g(e,t.value,n))return!0}}function _(e,t,n){return!e.transforms.has(t)||!e.transforms.has(n)?!1:g(e,t,n)}e.subtreeHasRef=_;function v(e,t){let n=e.children.get(t);if(n.size!==1)return t;let r=e.transforms.get(n.first());return r?.transformer.definition.isDecorator?v(e,r.ref):t}e.getDecoratorRoot=v;function y(e,t){for(let n of t){let t=e.transforms.get(n);t&&yE.setParamsHashVersion(t)}}e.setParamHashVersion=y;function b(e,t){let n=new Map(t.transforms.map(e=>[e.ref,e]));for(let t of e.transforms){let e=n.get(t.ref);e&&(t.transformer!==e.transformer||t.version!==e.version||(t.params=e.params))}}e.reuseTransformParams=b})(PE||={});var FE;(function(e){function t(e,t){return n(e)(t)}e.select=t;function n(e){let t=e||l.root,n;return n=i(t)?t.compile():r(t)?l.byValue(t).compile():a(t)?t:l.byRef(t).compile(),n}e.compile=n;function r(e){return e.transform!==void 0&&e.status!==void 0}function i(e){return e.compile!==void 0}function a(e){return typeof e==`function`}let o={select(e){return t(this,e||this.state)}};function s(e,t){o[e]=function(...e){return t.call(void 0,this,...e)}}function c(e){return Object.create(o,{compile:{writable:!1,configurable:!1,value:e}})}let l;(function(e){e.root=c(()=>e=>[e.cells.get(e.tree.root.ref)]);function t(...e){return c(()=>t=>{let n=[];for(let r of e){let e=t.cells.get(r);e&&n.push(e)}return n})}e.byRef=t;function n(...e){return c(()=>t=>e)}e.byValue=n;function r(e,t=yE.RootRef){return c(()=>n=>{let r={roots:[],cells:n.cells,type:e.type};return PE.doPreOrder(n.tree,n.tree.transforms.get(t),r,s),r.roots})}e.rootsOfType=r;function i(e,t=yE.RootRef){return c(()=>n=>{let r={ret:[],cells:n.cells,type:e.type};return PE.doPreOrder(n.tree,n.tree.transforms.get(t),r,l),r.ret})}e.ofType=i;function a(e,t=yE.RootRef){return c(()=>n=>{let r={ret:[],cells:n.cells,t:e};return PE.doPreOrder(n.tree,n.tree.transforms.get(t),r,u),r.ret})}e.ofTransformer=a;function o(e,t=yE.RootRef){return c(()=>n=>{let r={ret:[],cells:n.cells,t:e};return PE.doPreOrder(n.tree,n.tree.transforms.get(t),r,d),r.ret})}e.ofTransformerWithError=o;function s(e,t,n){let r=n.cells.get(e.ref);return r&&r.obj&&r.obj.type===n.type?(n.roots.push(r),!1):!0}function l(e,t,n){let r=n.cells.get(e.ref);return r&&r.obj&&r.obj.type===n.type&&n.ret.push(r),!0}function u(e,t,n){let r=n.cells.get(e.ref);return r&&r.obj&&r.transform.transformer===n.t&&n.ret.push(r),!0}function d(e,t,n){let r=n.cells.get(e.ref);return r&&r.status===`error`&&r.transform.transformer===n.t&&n.ret.push(r),!0}})(l=e.Generators||={}),s(`flatMap`,u);function u(e,t){let r=n(e);return c(()=>e=>{let n=[];for(let i of r(e))for(let r of t(i,e))n.push(r);return n})}e.flatMap=u,s(`mapObject`,d);function d(e,t){let r=n(e);return c(()=>e=>{let n=[];for(let i of r(e)){let r=t(i,e);r&&n.push(r)}return n})}e.mapObject=d,s(`unique`,f);function f(e){let t=n(e);return c(()=>e=>{let n=new Set,r=[];for(let i of t(e))i&&(n.has(i.transform.ref)||(n.add(i.transform.ref),r.push(i)));return r})}e.unique=f,s(`first`,p);function p(e){let t=n(e);return c(()=>e=>{let n=t(e);return n.length?[n[0]]:[]})}e.first=p,s(`filter`,m);function m(e,t){return u(e,e=>t(e)?[e]:[])}e.filter=m,s(`withStatus`,h);function h(e,t){return m(e,e=>e.status===t)}e.withStatus=h,s(`withTag`,g);function g(e,t){return m(e,e=>!!e.transform.tags&&e.transform.tags.indexOf(t)>=0)}e.withTag=g,s(`subtree`,_);function _(e){return u(e,(e,t)=>{let n=[];return PE.doPreOrder(t.tree,t.tree.transforms.get(e.transform.ref),n,(e,t,n)=>{n.push(e.ref)}),n.map(e=>t.cells.get(e))})}e.subtree=_,s(`children`,v);function v(e){return u(e,(e,t)=>{let n=[];return t.tree.children.get(e.transform.ref).forEach(e=>n.push(t.cells.get(e))),n})}e.children=v,s(`ofType`,y);function y(e,t){return m(e,e=>e.obj?e.obj.type===t.type:!1)}e.ofType=y,s(`ancestor`,b);function b(e,t){return f(d(e,(e,n)=>O(n.tree,n.cells,e.transform.ref,t)))}e.ancestor=b,s(`ancestorOfType`,x);function x(e,t){return f(d(e,(e,n)=>j(n.tree,n.cells,e.transform.ref,t)))}e.ancestorOfType=x,s(`ancestorWithTransformer`,S);function S(e,t){return f(d(e,(e,n)=>A(n.tree,n.cells,e.transform.ref,t)))}e.ancestorWithTransformer=S,s(`withTransformer`,C);function C(e,t){return m(e,e=>e.transform.transformer===t)}e.withTransformer=C,s(`root`,w);function w(e,t){return f(d(e,(e,n)=>k(n.tree,n.cells,e.transform.ref,t)))}e.root=w,s(`rootOfType`,T);function T(e,t){return f(d(e,(e,n)=>M(n.tree,n.cells,e.transform.ref,t)))}e.rootOfType=T,s(`parent`,E);function E(e){return f(d(e,(e,t)=>t.cells.get(t.tree.transforms.get(e.transform.ref).parent)))}e.parent=E;function D(e,t,n,r,i){let a=e.transforms.get(n),o;for(;;){a=e.transforms.get(a.parent);let n=t.get(a.ref);if(n.obj&&r(n)&&(o=n,i)||a.ref===yE.RootRef)return o}}function O(e,t,n,r){return D(e,t,n,r,!0)}e.findAncestor=O;function k(e,t,n,r){return D(e,t,n,r,!1)}e.findRoot=k;function A(e,t,n,r){return O(e,t,n,Array.isArray(r)?e=>r.indexOf(e.transform.transformer)>=0:e=>e.transform.transformer===r)}e.findAncestorWithTransformer=A;function j(e,t,n,r){return O(e,t,n,N(r))}e.findAncestorOfType=j;function M(e,t,n,r){return k(e,t,n,N(r))}e.findRootOfType=M;function N(e){return Array.isArray(e)?t=>{for(let n of e)if(n.type===t.obj.type)return!0}:t=>t.obj.type===e.type}function ee(e,t,n){return PE.doPreOrder(e,e.transforms.get(t),{refs:{},tags:n},te).refs}e.findUniqueTagsInSubtree=ee;function te(e,t,n){if(e.tags){for(let t of e.tags)if(n.tags.has(t)){n.refs[t]=e.ref;break}}return!0}function P(e,t,n){return PE.doPreOrder(e,e.transforms.get(t),{ref:void 0,tag:n},ne).ref}e.findTagInSubtree=P;function ne(e,t,n){return e.tags&&e.tags.indexOf(n.tag)>=0?(n.ref=e.ref,!1):!0}function re(e,t,n){return PE.doPreOrder(e,e.transforms.get(t),{refs:[],tags:n},ie).refs}e.findWithAllTags=re;function ie(e,t,n){if(e.tags){let t=n.tags.size,r=0;for(let i of e.tags)if(n.tags.has(i)&&(r++,r===t)){n.refs.push(e);break}}else n.tags.size===0&&n.refs.push(e)}function ae(e,t,n){if(e.transforms.get(t).transformer===n)return e.cells.get(t);let r=e.tree.children.get(t);if(r.size!==1)return;let i=r.first();if(i&&e.transforms.get(i).transformer.definition.isDecorator)return ae(e,i,n)}e.tryFindDecorator=ae;function oe(e,t){let n=e.tree.children.get(t);if(n.size!==1)return e.cells.get(t);let r=n.first();return r&&e.transforms.get(r).transformer.definition.isDecorator?oe(e,r):e.cells.get(t)}e.getDecorated=oe})(FE||={});var IE=function(e,t){return IE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},IE(e,t)};function LE(e,t){if(typeof t!=`function`&&t!==null)throw TypeError(`Class extends value `+String(t)+` is not a constructor or null`);IE(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function $fe(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}function epe(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,o=Object.create((typeof Iterator==`function`?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol==`function`&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return c([e,t])}}function c(s){if(r)throw TypeError(`Generator is already executing.`);for(;o&&(o=0,s[0]&&(n=0)),n;)try{if(r=1,i&&(a=s[0]&2?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if((a=n.trys,!(a=a.length>0&&a[a.length-1]))&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){n.label=s[1];break}if(s[0]===6&&n.label<a[1]){n.label=a[1],a=s;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(s);break}a[2]&&n.ops.pop(),n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e],i=0}finally{r=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function RE(e){var t=typeof Symbol==`function`&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length==`number`)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?`Object is not iterable.`:`Symbol.iterator is not defined.`)}function zE(e,t){var n=typeof Symbol==`function`&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function BE(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||=Array.prototype.slice.call(t,0,r),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}function VE(e){return this instanceof VE?(this.v=e,this):new VE(e)}function tpe(e,t,n){if(!Symbol.asyncIterator)throw TypeError(`Symbol.asyncIterator is not defined.`);var r=n.apply(e,t||[]),i,a=[];return i=Object.create((typeof AsyncIterator==`function`?AsyncIterator:Object).prototype),s(`next`),s(`throw`),s(`return`,o),i[Symbol.asyncIterator]=function(){return this},i;function o(e){return function(t){return Promise.resolve(t).then(e,d)}}function s(e,t){r[e]&&(i[e]=function(t){return new Promise(function(n,r){a.push([e,t,n,r])>1||c(e,t)})},t&&(i[e]=t(i[e])))}function c(e,t){try{l(r[e](t))}catch(e){f(a[0][3],e)}}function l(e){e.value instanceof VE?Promise.resolve(e.value.v).then(u,d):f(a[0][2],e)}function u(e){c(`next`,e)}function d(e){c(`throw`,e)}function f(e,t){e(t),a.shift(),a.length&&c(a[0][0],a[0][1])}}function npe(e){if(!Symbol.asyncIterator)throw TypeError(`Symbol.asyncIterator is not defined.`);var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof RE==`function`?RE(e):e[Symbol.iterator](),n={},r(`next`),r(`throw`),r(`return`),n[Symbol.asyncIterator]=function(){return this},n);function r(t){n[t]=e[t]&&function(n){return new Promise(function(r,a){n=e[t](n),i(r,a,n.done,n.value)})}}function i(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}}function HE(e){return typeof e==`function`}function rpe(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var UE=rpe(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,t){return t+1+`) `+e.toString()}).join(`
  `):``,this.name=`UnsubscriptionError`,this.errors=t}});function WE(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var GE=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=RE(a),s=o.next();!s.done;s=o.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var c=this.initialTeardown;if(HE(c))try{c()}catch(e){i=e instanceof UE?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=RE(l),d=u.next();!d.done;d=u.next()){var f=d.value;try{ope(f)}catch(e){i??=[],e instanceof UE?i=BE(BE([],zE(i)),zE(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new UE(i)}},e.prototype.add=function(t){if(t&&t!==this)if(this.closed)ope(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=this._finalizers??[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&WE(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&WE(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=(function(){var t=new e;return t.closed=!0,t})(),e}(),ipe=GE.EMPTY;function ape(e){return e instanceof GE||e&&`closed`in e&&HE(e.remove)&&HE(e.add)&&HE(e.unsubscribe)}function ope(e){HE(e)?e():e.unsubscribe()}var KE={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},qE={setTimeout:function(e,t){var n=[...arguments].slice(2),r=qE.delegate;return r?.setTimeout?r.setTimeout.apply(r,BE([e,t],zE(n))):setTimeout.apply(void 0,BE([e,t],zE(n)))},clearTimeout:function(e){return(qE.delegate?.clearTimeout||clearTimeout)(e)},delegate:void 0};function spe(e){qE.setTimeout(function(){var t=KE.onUnhandledError;if(t)t(e);else throw e})}function cpe(){}var lpe=(function(){return JE(`C`,void 0,void 0)})();function upe(e){return JE(`E`,void 0,e)}function dpe(e){return JE(`N`,e,void 0)}function JE(e,t,n){return{kind:e,value:t,error:n}}var YE=null;function XE(e){if(KE.useDeprecatedSynchronousErrorHandling){var t=!YE;if(t&&(YE={errorThrown:!1,error:null}),e(),t){var n=YE,r=n.errorThrown,i=n.error;if(YE=null,r)throw i}}else e()}function fpe(e){KE.useDeprecatedSynchronousErrorHandling&&YE&&(YE.errorThrown=!0,YE.error=e)}var ZE=function(e){LE(t,e);function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ape(t)&&t.add(n)):n.destination=gpe,n}return t.create=function(e,t,n){return new $E(e,t,n)},t.prototype.next=function(e){this.isStopped?tD(dpe(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?tD(upe(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?tD(lpe,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(GE),ppe=Function.prototype.bind;function QE(e,t){return ppe.call(e,t)}var mpe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){eD(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){eD(e)}else eD(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){eD(e)}},e}(),$E=function(e){LE(t,e);function t(t,n,r){var i=e.call(this)||this,a;if(HE(t)||!t)a={next:t??void 0,error:n??void 0,complete:r??void 0};else{var o;i&&KE.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&QE(t.next,o),error:t.error&&QE(t.error,o),complete:t.complete&&QE(t.complete,o)}):a=t}return i.destination=new mpe(a),i}return t}(ZE);function eD(e){KE.useDeprecatedSynchronousErrorHandling?fpe(e):spe(e)}function hpe(e){throw e}function tD(e,t){var n=KE.onStoppedNotification;n&&qE.setTimeout(function(){return n(e,t)})}var gpe={closed:!0,next:cpe,error:hpe,complete:cpe},nD=(function(){return typeof Symbol==`function`&&Symbol.observable||`@@observable`})();function rD(e){return e}function _pe(e){return e.length===0?rD:e.length===1?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}var iD=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=bpe(e)?e:new $E(e,t,n);return XE(function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))}),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return t=vpe(t),new t(function(t,r){var i=new $E({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)})},e.prototype._subscribe=function(e){return this.source?.subscribe(e)},e.prototype[nD]=function(){return this},e.prototype.pipe=function(){return _pe([...arguments])(this)},e.prototype.toPromise=function(e){var t=this;return e=vpe(e),new e(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function vpe(e){return e??KE.Promise??Promise}function ype(e){return e&&HE(e.next)&&HE(e.error)&&HE(e.complete)}function bpe(e){return e&&e instanceof ZE||ype(e)&&ape(e)}function xpe(e){return HE(e?.lift)}function aD(e){return function(t){if(xpe(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError(`Unable to lift unknown Observable type`)}}function oD(e,t,n,r,i){return new Spe(e,t,n,r,i)}var Spe=function(e){LE(t,e);function t(t,n,r,i,a,o){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=o,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)==null||t.call(this))}},t}(ZE),Cpe=rpe(function(e){return function(){e(this),this.name=`ObjectUnsubscribedError`,this.message=`object unsubscribed`}}),sD=function(e){LE(t,e);function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return t.prototype.lift=function(e){var t=new wpe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Cpe},t.prototype.next=function(e){var t=this;XE(function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||=Array.from(t.observers);try{for(var i=RE(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;XE(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;XE(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,`observed`,{get:function(){return this.observers?.length>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers;return r||i?ipe:(this.currentObservers=null,a.push(e),new GE(function(){t.currentObservers=null,WE(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new iD;return e.source=this,e},t.create=function(e,t){return new wpe(e,t)},t}(iD),wpe=function(e){LE(t,e);function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return t.prototype.next=function(e){var t,n;(n=(t=this.destination)?.next)==null||n.call(t,e)},t.prototype.error=function(e){var t,n;(n=(t=this.destination)?.error)==null||n.call(t,e)},t.prototype.complete=function(){var e,t;(t=(e=this.destination)?.complete)==null||t.call(e)},t.prototype._subscribe=function(e){return this.source?.subscribe(e)??ipe},t}(sD),cD=function(e){LE(t,e);function t(t){var n=e.call(this)||this;return n._value=t,n}return Object.defineProperty(t.prototype,`value`,{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(sD),Tpe={now:function(){return(Tpe.delegate||Date).now()},delegate:void 0},Epe=function(e){LE(t,e);function t(t,n){return e.call(this)||this}return t.prototype.schedule=function(e,t){return t===void 0&&(t=0),this},t}(GE),lD={setInterval:function(e,t){var n=[...arguments].slice(2),r=lD.delegate;return r?.setInterval?r.setInterval.apply(r,BE([e,t],zE(n))):setInterval.apply(void 0,BE([e,t],zE(n)))},clearInterval:function(e){return(lD.delegate?.clearInterval||clearInterval)(e)},delegate:void 0},Dpe=function(e){LE(t,e);function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return t.prototype.schedule=function(e,t){if(t===void 0&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id??this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return n===void 0&&(n=0),lD.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return t;t!=null&&lD.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error(`executing a cancelled action`);this.pending=!1;var n=this._execute(e,t);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r;try{this.work(e)}catch(e){n=!0,r=e||Error(`Scheduled action threw falsy error`)}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this,n=t.id,r=t.scheduler,i=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,WE(i,this),n!=null&&(this.id=this.recycleAsyncId(r,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Epe),Ope=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Tpe.now,e}(),uD=new(function(e){LE(t,e);function t(t,n){n===void 0&&(n=Ope.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return t.prototype.flush=function(e){var t=this.actions;if(this._active){t.push(e);return}var n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}},t}(Ope))(Dpe),kpe=uD,Ape=new iD(function(e){return e.complete()});function jpe(e){return e&&HE(e.schedule)}function Mpe(e){return e[e.length-1]}function Npe(e){return jpe(Mpe(e))?e.pop():void 0}function Ppe(e,t){return typeof Mpe(e)==`number`?e.pop():t}var Fpe=(function(e){return e&&typeof e.length==`number`&&typeof e!=`function`});function Ipe(e){return HE(e?.then)}function Lpe(e){return HE(e[nD])}function Rpe(e){return Symbol.asyncIterator&&HE(e?.[Symbol.asyncIterator])}function zpe(e){return TypeError(`You provided `+(typeof e==`object`&&e?`an invalid object`:`'`+e+`'`)+` where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Bpe(){return typeof Symbol!=`function`||!Symbol.iterator?`@@iterator`:Symbol.iterator}var Vpe=Bpe();function Hpe(e){return HE(e?.[Vpe])}function Upe(e){return tpe(this,arguments,function(){var t,n,r,i;return epe(this,function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,VE(t.read())];case 3:return n=a.sent(),r=n.value,i=n.done,i?[4,VE(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,VE(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Wpe(e){return HE(e?.getReader)}function dD(e){if(e instanceof iD)return e;if(e!=null){if(Lpe(e))return Gpe(e);if(Fpe(e))return Kpe(e);if(Ipe(e))return qpe(e);if(Rpe(e))return Ype(e);if(Hpe(e))return Jpe(e);if(Wpe(e))return Xpe(e)}throw zpe(e)}function Gpe(e){return new iD(function(t){var n=e[nD]();if(HE(n.subscribe))return n.subscribe(t);throw TypeError(`Provided object does not correctly implement Symbol.observable`)})}function Kpe(e){return new iD(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function qpe(e){return new iD(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,spe)})}function Jpe(e){return new iD(function(t){var n,r;try{for(var i=RE(e),a=i.next();!a.done;a=i.next()){var o=a.value;if(t.next(o),t.closed)return}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function Ype(e){return new iD(function(t){Zpe(e,t).catch(function(e){return t.error(e)})})}function Xpe(e){return Ype(Upe(e))}function Zpe(e,t){var n,r,i,a;return $fe(this,void 0,void 0,function(){var o,s;return epe(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=npe(e),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),r.done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),i={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function fD(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var a=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!i)return a}function Qpe(e,t){return t===void 0&&(t=0),aD(function(n,r){n.subscribe(oD(r,function(n){return fD(r,e,function(){return r.next(n)},t)},function(){return fD(r,e,function(){return r.complete()},t)},function(n){return fD(r,e,function(){return r.error(n)},t)}))})}function $pe(e,t){return t===void 0&&(t=0),aD(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function eme(e,t){return dD(e).pipe($pe(t),Qpe(t))}function tme(e,t){return dD(e).pipe($pe(t),Qpe(t))}function nme(e,t){return new iD(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function rme(e,t){return new iD(function(n){var r;return fD(n,t,function(){r=e[Vpe](),fD(n,t,function(){var e,t,i;try{e=r.next(),t=e.value,i=e.done}catch(e){n.error(e);return}i?n.complete():n.next(t)},0,!0)}),function(){return HE(r?.return)&&r.return()}})}function ime(e,t){if(!e)throw Error(`Iterable cannot be null`);return new iD(function(n){fD(n,t,function(){var r=e[Symbol.asyncIterator]();fD(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}function ame(e,t){return ime(Upe(e),t)}function ome(e,t){if(e!=null){if(Lpe(e))return eme(e,t);if(Fpe(e))return nme(e,t);if(Ipe(e))return tme(e,t);if(Rpe(e))return ime(e,t);if(Hpe(e))return rme(e,t);if(Wpe(e))return ame(e,t)}throw zpe(e)}function sme(e,t){return t?ome(e,t):dD(e)}function cme(e){return e instanceof Date&&!isNaN(e)}function lme(e,t){return aD(function(n,r){var i=0;n.subscribe(oD(r,function(n){r.next(e.call(t,n,i++))}))})}function ume(e,t,n,r,i,a,o,s){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&t.complete()},p=function(e){return l<r?m(e):c.push(e)},m=function(e){a&&t.next(e),l++;var s=!1;dD(n(e,u++)).subscribe(oD(t,function(e){i?.(e),a?p(e):t.next(e)},function(){s=!0},void 0,function(){if(s)try{l--;for(var e=function(){var e=c.shift();o?fD(t,o,function(){return m(e)}):m(e)};c.length&&l<r;)e();f()}catch(e){t.error(e)}}))};return e.subscribe(oD(t,p,function(){d=!0,f()})),function(){s?.()}}function dme(e,t,n){return n===void 0&&(n=1/0),HE(t)?dme(function(n,r){return lme(function(e,i){return t(n,e,r,i)})(dD(e(n,r)))},n):(typeof t==`number`&&(n=t),aD(function(t,r){return ume(t,r,e,n)}))}function fme(e){return e===void 0&&(e=1/0),dme(rD,e)}function pme(e,t,n){e===void 0&&(e=0),n===void 0&&(n=kpe);var r=-1;return t!=null&&(jpe(t)?n=t:r=t),new iD(function(t){var i=cme(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule(function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())},i)})}function pD(){var e=[...arguments],t=Npe(e),n=Ppe(e,1/0),r=e;return r.length?r.length===1?dD(r[0]):fme(n)(sme(r,t)):Ape}function mD(e,t){return aD(function(n,r){var i=0;n.subscribe(oD(r,function(n){return e.call(t,n,i++)&&r.next(n)}))})}function hD(e,t){return t===void 0&&(t=uD),aD(function(n,r){var i=null,a=null,o=null,s=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function c(){var n=o+e,a=t.now();if(a<n){i=this.schedule(void 0,n-a),r.add(i);return}s()}n.subscribe(oD(r,function(n){a=n,o=t.now(),i||(i=t.schedule(c,e),r.add(i))},function(){s(),r.complete()},void 0,function(){a=i=null}))})}function mme(e){return e<=0?function(){return Ape}:aD(function(t,n){var r=0;t.subscribe(oD(n,function(t){++r<=e&&(n.next(t),e<=r&&n.complete())}))})}function hme(e,t){return t===void 0&&(t=rD),e??=gme,aD(function(n,r){var i,a=!0;n.subscribe(oD(r,function(n){var o=t(n);(a||!e(i,o))&&(a=!1,i=o,r.next(n))}))})}function gme(e,t){return e===t}function _me(e){return mD(function(t,n){return e<=n})}function vme(e,t){return aD(function(n,r){var i=t??{},a=i.leading,o=a===void 0?!0:a,s=i.trailing,c=s===void 0?!1:s,l=!1,u=null,d=null,f=!1,p=function(){d?.unsubscribe(),d=null,c&&(g(),f&&r.complete())},m=function(){d=null,f&&r.complete()},h=function(t){return d=dD(e(t)).subscribe(oD(r,p,m))},g=function(){if(l){l=!1;var e=u;u=null,r.next(e),!f&&h(e)}};n.subscribe(oD(r,function(e){l=!0,u=e,!(d&&!d.closed)&&(o?g():h(e))},function(){f=!0,!(c&&l&&d&&!d.closed)&&r.complete()}))})}function gD(e,t,n){t===void 0&&(t=uD);var r=pme(e,t);return vme(function(){return r},n)}var _D;(function(e){function t(){let e=new yme,t=(()=>e.create());return t.dispose=()=>e.dispose(),t.behavior=t=>e.behavior(t),t}e.create=t})(_D||={});var yme=class{constructor(){this._eventList=[],this._disposed=!1}create(){let e=new sD;return this._eventList.push(e),e}behavior(e){let t=new cD(e);return this._eventList.push(t),t}dispose(){if(!this._disposed){for(let e of this._eventList)e.complete();this._disposed=!0}}},bme=o((e=>{var t={Remove:`remove`,Replace:`replace`,Add:`add`},n=Symbol.for(`__MUTATIVE_PROXY_DRAFT__`),r=Symbol(`__MUTATIVE_RAW_RETURN_SYMBOL__`),i=Symbol.iterator,a={mutable:`mutable`,immutable:`immutable`},o={};function s(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){if(t in e){let n=Reflect.getPrototypeOf(e);for(;n;){let e=Reflect.getOwnPropertyDescriptor(n,t);if(e)return e;n=Reflect.getPrototypeOf(n)}}}function l(e){return Object.getPrototypeOf(e)===Set.prototype}function u(e){return Object.getPrototypeOf(e)===Map.prototype}function d(e){return e.copy??e.original}function f(e){return!!p(e)}function p(e){return typeof e==`object`?e?.[n]:null}function m(e){let t=p(e);return t?t.copy??t.original:e}function h(e,t){if(!e||typeof e!=`object`)return!1;let n;return Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!t?.mark&&((n=t.mark(e,a))===a.immutable||typeof n==`function`)}function g(e,t=[]){if(Object.hasOwnProperty.call(e,`key`)){let n=e.parent.copy,r=p(v(n,e.key));if(r!==null&&r?.original!==e.original)return null;let i=e.parent.type===3,a=i?Array.from(e.parent.setMap.keys()).indexOf(e.key):e.key;if(!(i&&n.size>a||s(n,a)))return null;t.push(a)}if(e.parent)return g(e.parent,t);t.reverse();try{(function(e,t){for(let n=0;n<t.length-1;n+=1){let r=t[n];if(typeof(e=v(_(e)===3?Array.from(e):e,r))!=`object`)throw Error(`Cannot resolve patch at '${t.join(`/`)}'.`)}})(e.copy,t)}catch{return null}return t}function _(e){return Array.isArray(e)?1:e instanceof Map?2:e instanceof Set?3:0}function v(e,t){return _(e)===2?e.get(t):e[t]}function y(e,t,n){_(e)===2?e.set(t,n):e[t]=n}function b(e,t){let n=p(e);return(n?d(n):e)[t]}function x(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function S(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function C(e,t){return t?e:[``].concat(e).map((e=>{let t=`${e}`;return t.indexOf(`/`)===-1&&t.indexOf(`~`)===-1?t:t.replace(/~/g,`~0`).replace(/\//g,`~1`)})).join(`/`)}var w=Object.prototype.propertyIsEnumerable;function T(e,t){let n;if(Array.isArray(e))return Array.prototype.concat.call(e);if(e instanceof Set)return l(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(Object.getPrototypeOf(e)).constructor(e.values());if(e instanceof Map)return u(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e);if(t?.mark&&(n=t.mark(e,a),n!==void 0)&&n!==a.mutable){if(n===a.immutable)return function(e){let t=Object.create(Object.getPrototypeOf(e));return Reflect.ownKeys(e).forEach((n=>{let r=Reflect.getOwnPropertyDescriptor(e,n);r.enumerable&&r.configurable&&r.writable?t[n]=e[n]:(r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[n]}),Reflect.defineProperty(t,n,r))})),t}(e);if(typeof n==`function`)return n();throw Error(`Unsupported mark result: ${n}`)}if(typeof e==`object`&&Object.getPrototypeOf(e)===Object.prototype){let t={};return Object.keys(e).forEach((n=>{t[n]=e[n]})),Object.getOwnPropertySymbols(e).forEach((n=>{w.call(e,n)&&(t[n]=e[n])})),t}throw Error(`Please check mark() to ensure that it is a stable marker draftable function.`)}function E(e){e.copy||=T(e.original,e.options)}function D(e){if(!h(e))return m(e);if(Array.isArray(e))return e.map(D);if(e instanceof Map){let t=Array.from(e.entries()).map((([e,t])=>[e,D(t)]));return u(e)?new Map(t):new(Object.getPrototypeOf(e)).constructor(t)}if(e instanceof Set){let t=Array.from(e).map(D);return l(e)?new Set(t):new(Object.getPrototypeOf(e)).constructor(t)}let t=Object.create(Object.getPrototypeOf(e));for(let n in e)t[n]=D(e[n]);return t}function O(e){return f(e)?D(e):e}function k(e){e.assignedMap=e.assignedMap??new Map,e.operated||(e.operated=!0,e.parent&&k(e.parent))}function A(){throw Error(`Cannot modify frozen object`)}function j(e){return e&&typeof e==`object`&&!Object.isFrozen(e)}function M(e,t,n,r,i){if(!(Object.isFrozen(e)||f(e)))switch(_(e)){case 2:for(let[t,n]of e)j(t)&&M(t),j(n)&&M(n);e.set=e.clear=e.delete=A;break;case 3:for(let t of e)j(t)&&M(t);e.add=e.clear=e.delete=A;break;case 1:Object.freeze(e);for(let t of e)j(t)&&M(t);break;default:Object.freeze(e),Object.keys(e).forEach((t=>{let n=e[t];j(n)&&M(n)}))}}function N(e,t){let n=_(e);if(n===0)Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)}));else if(n===1){let n=0;for(let r of e)t(n,r,e),n+=1}else e.forEach(((n,r)=>t(r,n,e)))}function ee(e,t,n){if(f(e)||!h(e,n)||t.has(e)||Object.isFrozen(e))return;let r=e instanceof Set,i=r?new Map:void 0;if(t.add(e),N(e,((a,o)=>{if(f(o)){let t=p(o);E(t);let n=t.assignedMap?.size||t.operated?t.copy:t.original;y(r?i:e,a,n)}else ee(o,t,n)})),i){let t=e,n=Array.from(t);t.clear(),n.forEach((e=>{t.add(i.has(e)?i.get(e):e)}))}}function te(e,t){let n=e.type===3?e.setMap:e.copy;e.finalities.revoke.length>1&&e.assignedMap.get(t)&&n&&ee(v(n,t),e.finalities.handledSet,e.options)}function P(e){e.type===3&&e.copy&&(e.copy.clear(),e.setMap.forEach((t=>{e.copy.add(m(t))})))}function ne(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){let i=g(e);i&&t(e,i,n,r)}e.finalized=!0}}function re(e,t,n,r){let i=p(n);i&&(i.callbacks||=[],i.callbacks.push(((a,o)=>{let s=e.type===3?e.setMap:e.copy;if(x(v(s,t),n)){let n=i.original;i.copy&&(n=i.copy),P(e),ne(e,r,a,o),y(s,t,n)}})),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),h(n,e.options)&&e.finalities.draft.push((()=>{x(v(e.type===3?e.setMap:e.copy,t),n)&&te(e,t)}))}function ie(e,n,r,i){let{pathAsArray:a=!0}=e.options.enablePatches;switch(e.type){case 0:case 2:return function({original:e,copy:n,assignedMap:r},i,a,o,c){r.forEach(((r,l)=>{let u=v(e,l),d=O(v(n,l)),f=r?s(e,l)?t.Replace:t.Add:t.Remove;if(x(u,d)&&f===t.Replace)return;let p=C(i.concat(l),c);a.push(f===t.Remove?{op:f,path:p}:{op:f,path:p,value:d}),o.push(f===t.Add?{op:t.Remove,path:p}:f===t.Remove?{op:t.Add,path:p,value:u}:{op:t.Replace,path:p,value:u})}))}(e,n,r,i,a);case 1:return function(e,n,r,i,a){let{original:o,assignedMap:s,options:c}=e,l=e.copy;l.length<o.length&&([o,l]=[l,o],[r,i]=[i,r]);for(let e=0;e<o.length;e+=1)if(s.get(e.toString())&&l[e]!==o[e]){let s=C(n.concat([e]),a);r.push({op:t.Replace,path:s,value:O(l[e])}),i.push({op:t.Replace,path:s,value:O(o[e])})}for(let e=o.length;e<l.length;e+=1){let i=C(n.concat([e]),a);r.push({op:t.Add,path:i,value:O(l[e])})}if(o.length<l.length){let{arrayLengthAssignment:e=!0}=c.enablePatches;if(e){let e=C(n.concat([`length`]),a);i.push({op:t.Replace,path:e,value:o.length})}else for(let e=l.length;o.length<e;--e){let r=C(n.concat([e-1]),a);i.push({op:t.Remove,path:r})}}}(e,n,r,i,a);case 3:return function({original:e,copy:n},r,i,a,o){let s=0;e.forEach((e=>{if(!n.has(e)){let n=C(r.concat([s]),o);i.push({op:t.Remove,path:n,value:e}),a.unshift({op:t.Add,path:n,value:e})}s+=1})),s=0,n.forEach((n=>{if(!e.has(n)){let e=C(r.concat([s]),o);i.push({op:t.Add,path:e,value:n}),a.unshift({op:t.Remove,path:e,value:n})}s+=1}))}(e,n,r,i,a)}}var ae=!1,oe=(e,t,n=!1)=>{if(typeof e==`object`&&e&&(!h(e,t)||n)&&!ae)throw Error(`Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.`)},se={get size(){return d(p(this)).size},has(e){return d(p(this)).has(e)},set(e,t){let n=p(this),r=d(n);return r.has(e)&&x(r.get(e),t)||(E(n),k(n),n.assignedMap.set(e,!0),n.copy.set(e,t),re(n,e,t,ie)),this},delete(e){if(!this.has(e))return!1;let t=p(this);return E(t),k(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){let e=p(this);if(this.size){E(e),k(e),e.assignedMap=new Map;for(let[t]of e.original)e.assignedMap.set(t,!1);e.copy.clear()}},forEach(e,t){d(p(this)).forEach(((n,r)=>{e.call(t,this.get(r),r,this)}))},get(e){var t;let n=p(this),r=d(n).get(e),i=(t=n.options).mark?.call(t,r,a)===a.mutable;if(n.options.strict&&oe(r,n.options,i),i||n.finalized||!h(r,n.options)||r!==n.original.get(e))return r;let s=o.createDraft({original:r,parentDraft:n,key:e,finalities:n.finalities,options:n.options});return E(n),n.copy.set(e,s),s},keys(){return d(p(this)).keys()},values(){let e=this.keys();return{[i]:()=>this.values(),next:()=>{let t=e.next();return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){let e=this.keys();return{[i]:()=>this.entries(),next:()=>{let t=e.next();if(t.done)return t;let n=this.get(t.value);return{done:!1,value:[t.value,n]}}}},[i](){return this.entries()}},ce=Reflect.ownKeys(se),le=(e,t,{isValuesIterator:n})=>()=>{var r;let i=t.next();if(i.done)return i;let s=i.value,c=e.setMap.get(s),l=p(c),u=(r=e.options).mark?.call(r,c,a)===a.mutable;if(e.options.strict&&oe(s,e.options,u),u||l||!h(s,e.options)||e.finalized||!e.original.has(s))l&&(c=l.proxy);else{let t=o.createDraft({original:s,parentDraft:e,key:s,finalities:e.finalities,options:e.options});e.setMap.set(s,t),c=t}return{done:!1,value:n?c:[c,c]}},ue={get size(){return p(this).setMap.size},has(e){let t=p(this);if(t.setMap.has(e))return!0;E(t);let n=p(e);return!(!n||!t.setMap.has(n.original))},add(e){let t=p(this);return this.has(e)||(E(t),k(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),re(t,e,e,ie)),this},delete(e){if(!this.has(e))return!1;let t=p(this);E(t),k(t);let n=p(e);return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return;let e=p(this);E(e),k(e);for(let t of e.original)e.assignedMap.set(t,!1);e.setMap.clear()},values(){let e=p(this);E(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:le(e,t,{isValuesIterator:!0})}},entries(){let e=p(this);E(e);let t=e.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:le(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[i](){return this.values()},forEach(e,t){let n=this.values(),r=n.next();for(;!r.done;)e.call(t,r.value,r.value,this),r=n.next()}};Set.prototype.difference&&Object.assign(ue,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}});var de=Reflect.ownKeys(ue),fe={get(e,t,r){let i=e.copy?.[t];if(i&&e.finalities.draftsCache.has(i))return i;if(t===n)return e;let o;if(e.options.mark){let n=t===`size`&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,r);if(o=e.options.mark(n,a),o===a.mutable)return e.options.strict&&oe(n,e.options,!0),n}let l=d(e);if(l instanceof Map&&ce.includes(t))return t===`size`?Object.getOwnPropertyDescriptor(se,`size`).get.call(e.proxy):se[t].bind(e.proxy);if(l instanceof Set&&de.includes(t))return t===`size`?Object.getOwnPropertyDescriptor(ue,`size`).get.call(e.proxy):ue[t].bind(e.proxy);if(!s(l,t)){let n=c(l,t);return n?`value`in n?n.value:n.get?.call(e.proxy):void 0}let u=l[t];if(e.options.strict&&oe(u,e.options),e.finalized||!h(u,e.options))return u;if(u===b(e.original,t)){if(E(e),e.copy[t]=pe({original:e.original[t],parentDraft:e,key:e.type===1?Number(t):t,finalities:e.finalities,options:e.options}),typeof o==`function`){let n=p(e.copy[t]);return E(n),k(n),n.copy}return e.copy[t]}return f(u)&&e.finalities.draftsCache.add(u),u},set(e,t,n){if(e.type===3||e.type===2)throw Error(`Map/Set draft does not support any property assignment.`);let r;if(e.type===1&&t!==`length`&&(!(Number.isInteger(r=Number(t))&&r>=0)||t!==0&&r!==0&&String(r)!==String(t)))throw Error(`Only supports setting array indices and the 'length' property.`);let i=c(d(e),t);if(i?.set)return i.set.call(e.proxy,n),!0;let a=b(d(e),t),o=p(a);return o&&x(o.original,n)?(e.copy[t]=n,e.assignedMap=e.assignedMap??new Map,e.assignedMap.set(t,!1),!0):(x(n,a)&&(n!==void 0||s(e.original,t))||(E(e),k(e),s(e.original,t)&&x(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,re(e,t,n,ie)),!0)},has:(e,t)=>t in d(e),ownKeys:e=>Reflect.ownKeys(d(e)),getOwnPropertyDescriptor(e,t){let n=d(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type!==1||t!==`length`,enumerable:r.enumerable,value:n[t]}},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw Error(`Cannot call 'setPrototypeOf()' on drafts`)},defineProperty(){throw Error(`Cannot call 'defineProperty()' on drafts`)},deleteProperty(e,t){return e.type===1?fe.set.call(this,e,t,void 0,e.proxy):(b(e.original,t)!==void 0||t in e.original?(E(e),k(e),e.assignedMap.set(t,!1)):(e.assignedMap=e.assignedMap??new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}};function pe(e){let{original:t,parentDraft:n,key:r,finalities:i,options:a}=e,o=_(t),s={type:o,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:a,setMap:o===3?new Map(t.entries()):void 0};(r||`key`in e)&&(s.key=r);let{proxy:c,revoke:l}=Proxy.revocable(o===1?Object.assign([],s):s,fe);if(i.revoke.push(l),s.proxy=c,n){let e=n;e.finalities.draft.push(((t,n)=>{var i;let a=p(c),o=e.type===3?e.setMap:e.copy,s=v(o,r),l=p(s);if(l){let e=l.original;l.operated&&(e=m(s)),P(l),ne(l,ie,t,n),y(o,r,e)}(i=a.callbacks)==null||i.forEach((e=>{e(t,n)}))}))}else{let e=p(c);e.finalities.draft.push(((t,n)=>{P(e),ne(e,ie,t,n)}))}return c}function me(e,n,r,i,a){let o=p(e),s=o?.original??e,c=!!n.length;if(o?.operated)for(;o.finalities.draft.length>0;)o.finalities.draft.pop()(r,i);let l=c?n[0]:o?o.operated?o.copy:o.original:e;return o&&S(o),a&&M(l,0,o==null||o.options.updatedValues),[l,r&&c?[{op:t.Replace,path:[],value:n[0]}]:r,i&&c?[{op:t.Replace,path:[],value:s}]:i]}function he(e){let{rootDraft:t,value:n,useRawReturn:r=!1,isRoot:i=!0}=e;N(n,((n,r,i)=>{let a=p(r);if(a&&t&&a.finalities===t.finalities){e.isContainDraft=!0;let t=a.original;if(i instanceof Set){let e=Array.from(i);i.clear(),e.forEach((e=>i.add(n===e?t:e)))}else y(i,n,t)}else typeof r==`object`&&r&&(e.value=r,e.isRoot=!1,he(e))}))}function ge(e){let t=p(e);if(!h(e,t?.options))return e;let n=_(e);if(t&&!t.operated)return t.original;let r;function i(){r=n===2?u(e)?new Map(e):new(Object.getPrototypeOf(e)).constructor(e):n===3?Array.from(t.setMap.values()):T(e,t?.options)}if(t){t.finalized=!0;try{i()}finally{t.finalized=!1}}else r=e;if(N(r,((n,a)=>{if(t&&x(v(t.original,n),a))return;let o=ge(a);o!==a&&(r===e&&i(),y(r,n,o))})),n===3){let e=t?.original??r;return l(e)?new Set(r):new(Object.getPrototypeOf(e)).constructor(r)}return r}function _e(e){if(!f(e))throw Error(`current() is only used for Draft, parameter: ${e}`);return ge(e)}o.createDraft=pe;var ve=e=>function t(n,i,o){var s,c,l;if(typeof n==`function`&&typeof i!=`function`)return function(e,...r){return t(e,(e=>n.call(this,e,...r)),i)};let u=n,d=i,m=o;typeof i!=`function`&&(m=i),m=Object.assign(Object.assign({},e),m);let g=f(u)?_e(u):u,_=Array.isArray(m.mark)?(e,t)=>{for(let n of m.mark){let r=n(e,t);if(r)return r}}:m.mark,v=(s=m.enablePatches)!=null&&s,y=(c=m.strict)!=null&&c,b={enableAutoFreeze:(l=m.enableAutoFreeze)!=null&&l,mark:_,strict:y,enablePatches:v};if(!h(g,b)&&typeof g==`object`&&g)throw Error(`Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.`);let[C,w]=function(e,t){let n={draft:[],revoke:[],handledSet:new WeakSet,draftsCache:new WeakSet},r,i;t.enablePatches&&(r=[],i=[]);let o=t.mark?.call(t,e,a)!==a.mutable&&h(e,t)?pe({original:e,parentDraft:null,finalities:n,options:t}):e;return[o,(e=[])=>{let[n,a,s]=me(o,e,r,i,t.enableAutoFreeze);return t.enablePatches?[n,a,s]:n}]}(g,b);if(typeof i!=`function`){if(!h(g,b))throw Error(`Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.`);return[C,w]}let T;try{T=d(C)}catch(e){throw S(p(C)),e}let E=e=>{let t=p(C);if(!f(e)){if(e!==void 0&&!x(e,C)&&t?.operated)throw Error(`Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.`);let n=e?.[r];if(n){let r=n[0];return b.strict&&typeof e==`object`&&e&&he({rootDraft:t,value:e,useRawReturn:!0}),w([r])}if(e!==void 0)return typeof e==`object`&&e&&he({rootDraft:t,value:e}),w([e])}if(e===C||e===void 0)return w([]);let n=p(e);if(b===n.options){if(n.operated)throw Error(`Cannot return a modified child draft.`);return w([_e(e)])}return w([e])};return T instanceof Promise?T.then(E,(e=>{throw S(p(C)),e})):E(T)},ye=ve(),be=Object.prototype.constructor.toString();e.apply=function(e,n,r){let i;for(i=n.length-1;i>=0;--i){let{value:r,op:a,path:o}=n[i];if(!o.length&&a===t.Replace||o===``&&a===t.Add){e=r;break}}i>-1&&(n=n.slice(i+1));let a=e=>{n.forEach((n=>{let{path:r,op:i}=n,a=function(e){return Array.isArray(e)?e:e.split(`/`).map((e=>e.replace(/~1/g,`/`).replace(/~0/g,`~`))).slice(1)}(r),o=e;for(let e=0;e<a.length-1;e+=1){let t=_(o),n=a[e];if(typeof n!=`string`&&typeof n!=`number`&&(n=String(n)),(t===0||t===1)&&(n===`__proto__`||n===`constructor`)||typeof o==`function`&&n===`prototype`)throw Error(`Patching reserved attributes like __proto__ and constructor is not allowed.`);if(o=v(t===3?Array.from(o):o,n),typeof o!=`object`)throw Error(`Cannot apply patch at '${a.join(`/`)}'.`)}let s=_(o),c=D(n.value),l=a[a.length-1];switch(i){case t.Replace:switch(s){case 2:return o.set(l,c);case 3:throw Error(`Cannot apply replace patch to set.`);default:return o[l]=c}case t.Add:switch(s){case 1:return l===`-`?o.push(c):o.splice(l,0,c);case 2:return o.set(l,c);case 3:return o.add(c);default:return o[l]=c}case t.Remove:switch(s){case 1:return o.splice(l,1);case 2:return o.delete(l);case 3:return o.delete(n.value);default:return delete o[l]}default:throw Error(`Unsupported patch operation: ${i}.`)}}))};if(!r?.mutable){if(f(e)){if(r!==void 0)throw Error(`Cannot apply patches with options to a draft.`);return a(e),e}return ye(e,a,Object.assign(Object.assign({},r),{enablePatches:!1}))}a(e)},e.castDraft=function(e){return e},e.castImmutable=function(e){return e},e.castMutable=function(e){return e},e.create=ye,e.current=_e,e.isDraft=f,e.isDraftable=h,e.makeCreator=ve,e.markSimpleObject=e=>{if((e=>{if(!e||typeof e!=`object`)return!1;let t=Object.getPrototypeOf(e);if(t===null)return!0;let n=Object.hasOwnProperty.call(t,`constructor`)&&t.constructor;return n===Object||typeof n==`function`&&Function.toString.call(n)===be})(e))return a.immutable},e.original=function(e){let t=p(e);if(!t)throw Error(`original() is only used for a draft, parameter: ${e}`);return t.original},e.rawReturn=function(e){if(arguments.length===0)throw Error(`rawReturn() must be called with a value.`);if(arguments.length>1)throw Error(`rawReturn() must be called with one argument.`);return{[r]:[e]}},e.unsafe=function(e){let t;ae=!0;try{t=e()}finally{ae=!1}return t}})),xme=o(((e,t)=>{t.exports=bme()}))();function vD(e,t){return typeof e==`object`&&!(`prototype`in e)?(0,xme.create)({...e},t):(0,xme.create)(e,t)}var yD;(function(e){function t(e){let t=new Set;for(let n of e.actions)switch(n.kind){case`add`:t.add(n.transform.ref);break;case`update`:t.add(n.ref);break;case`delete`:t.add(n.ref);break;case`insert`:{t.add(n.ref),t.add(n.transform.ref);let r=e.tree.children.get(n.ref).toArray();for(let e of r)t.add(e);break}}return Array.from(t)}function n(e,n){if(!e.state||e.state.tree===e.editInfo.sourceTree){let r=e.tree.asImmutable();return n?.useHashVersion&&PE.setParamHashVersion(r,t(e)),r}let r=e.state.tree.asTransient();for(let t of e.actions)switch(t.kind){case`add`:r.add(t.transform);break;case`update`:r.setParams(t.ref,t.params);break;case`delete`:r.remove(t.ref);break;case`insert`:{let e=r.children.get(t.ref).toArray();r.add(t.transform);for(let n of e)r.changeParent(n,t.transform.ref);break}}e.editInfo.sourceTree=e.tree;let i=r.asImmutable();return n?.useHashVersion&&PE.setParamHashVersion(i,t(e)),i}function r(e){return!!e&&typeof e.getTree==`function`}e.is=r;function i(e){return!!e&&typeof e.getTree==`function`&&typeof e.ref==`string`}e.isTo=i;class a{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(e){let t=typeof e==`string`?e:Nx.is(e)?e.transform.ref:e.ref;return new o(this.state,t,this)}toRoot(){return new o(this.state,this.state.tree.root.ref,this)}delete(e){let t=Fx.resolveRef(e);return!t||!this.state.tree.transforms.has(t)?this:(this.editInfo.count++,this.state.tree.remove(t),this.state.actions.push({kind:`delete`,ref:t}),this)}getTree(e){return n(this.state,e)}commit(e){if(!this.state.state)throw Error(`Cannot commit template tree`);return this.state.state.runTask(this.state.state.updateTree(this,e))}constructor(e,t){this.state={state:t,tree:e.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:e,count:0,lastUpdate:void 0}}}}e.Root=a;class o{get editInfo(){return this.state.editInfo}get selector(){return new Px(this.ref,this.state.state)}getApplyRoot(){return PE.getDecoratorRoot(this.state.tree,this.ref)}apply(e,t,n){if(e.definition.isDecorator)return this.insert(e,t,n);let r=this.getApplyRoot(),i=e.apply(r,t,n);return this.state.tree.add(i),this.editInfo.count++,this.editInfo.lastUpdate=i.ref,this.state.actions.push({kind:`add`,transform:i}),new o(this.state,i.ref,this.root)}applyOrUpdate(e,t,n,r){if(this.state.tree.transforms.has(e)){let t=this.to(e);return n&&t.update(n),t}else return this.apply(t,n,{...r,ref:e})}applyOrUpdateTagged(e,t,n,r){if(t.definition.isDecorator)throw Error(`Can't use applyOrUpdateTagged on decorator transformers.`);let i=this.getApplyRoot(),a=this.state.tree.children.get(i).values();for(;;){let t=a.next();if(t.done)break;let i=this.state.tree.transforms.get(t.value);if(i&&yE.hasTags(i,e)){let a=this.to(t.value);return a.updateTagged(n,bD(i.tags,e,r&&r.tags)),a}}let s=t.apply(i,n,{...r,tags:bD(e,r&&r.tags)});return this.state.tree.add(s),this.editInfo.count++,this.editInfo.lastUpdate=s.ref,this.state.actions.push({kind:`add`,transform:s}),new o(this.state,s.ref,this.root)}group(e,t,n){return this.apply(e,t,n)}insert(e,t,n){let r=this.state.tree.children.get(this.ref).toArray(),i=e.apply(this.ref,t,n);this.state.tree.add(i);for(let e of r)this.state.tree.changeParent(e,i.ref);return this.editInfo.count++,this.editInfo.lastUpdate=i.ref,this.state.actions.push({kind:`insert`,ref:this.ref,transform:i}),new o(this.state,i.ref,this.root)}updateTagged(e,t){(this.state.tree.setParams(this.ref,e)||this.state.tree.setTags(this.ref,t))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:`update`,ref:this.ref,params:e}))}update(e,t){let n;return n=t?vD(this.state.tree.transforms.get(this.ref).params,t):typeof e==`function`?vD(this.state.tree.transforms.get(this.ref).params,e):e,this.state.tree.setParams(this.ref,n)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:`update`,ref:this.ref,params:n})),this.root}updateState(e){let t=this.state.tree.transforms.get(this.ref);yE.isStateChange(t.state,e)&&(this.state.tree.assignState(this.ref,e),this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.find(e=>e.kind===`update`&&e.ref===this.ref)||this.state.actions.push({kind:`update`,ref:this.ref,params:t.params}))}tag(e){let t=this.state.tree.transforms.get(this.ref);return this.updateTagged(t.params,bD(t.tags,e)),this}dependsOn(e){let t=this.state.tree.transforms.get(this.ref);this.state.tree.setDependsOn(this.ref,bD(t.dependsOn,e))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:`update`,ref:this.ref,params:t.params}))}to(e){return this.root.to(e)}toRoot(){return this.root.toRoot()}delete(e){return this.root.delete(e)}getTree(e){return n(this.state,e)}commit(e){if(!this.state.state)throw Error(`Cannot commit template tree`);return this.state.state.runTask(this.state.state.updateTree(this,e))}constructor(e,t,n){if(this.state=e,this.root=n,this.ref=t,!this.state.tree.transforms.has(t))throw Error(`Could not find node '${t}'.`)}}e.To=o})(yD||={});function bD(...e){let t,n=[];for(let r of e)if(r)if(t||=new Set,typeof r==`string`){if(t.has(r))continue;t.add(r),n.push(r)}else for(let e of r)t.has(e)||(t.add(e),n.push(e));return n}var Sme=class{constructor(){this.ev=_D.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}add(e){let t=lE.is(e)?e.toAction():e;if(this.actions.has(t.id))return this;this.actions.set(t.id,t);for(let e of t.definition.from)this.fromTypeIndex.has(e.type)?this.fromTypeIndex.get(e.type).push(t):this.fromTypeIndex.set(e.type,[t]);return this.events.added.next(void 0),this}remove(e){let t=lE.is(e)?e.toAction().id:zy.is(e)?e:e.id,n=this.actions.get(t);if(!n)return this;this.actions.delete(t);for(let e of n.definition.from){let t=this.fromTypeIndex.get(e.type);t&&(kE(t,n),t.length===0&&this.fromTypeIndex.delete(e.type))}return this.events.removed.next(void 0),this}fromCell(e,t){let n=e.obj;if(!n)return[];let r=this.fromTypeIndex.get(n.type);if(!r)return[];let i=!1;for(let e of r)if(e.definition.isApplicable){i=!0;break}if(!i)return r;let a=[];for(let i of r)i.definition.isApplicable?i.definition.isApplicable(n,e.transform,t)&&a.push(i):a.push(i);return a}dispose(){this.ev.dispose()}},xD;(function(e){function t(e){return{type:`message`,timestamp:new Date,message:e}}e.message=t;function n(e){return{type:`error`,timestamp:new Date,message:e}}e.error=n;function r(e){return{type:`warning`,timestamp:new Date,message:e}}e.warning=r;function i(e){return{type:`info`,timestamp:new Date,message:e}}e.info=i})(xD||={});var SD;(function(e){class t{get current(){return this._current}set current(e){this._current=e}getAncestorOfType(e){if(!this._current)return;let t=this._current;for(;;){if(t=this.cells.get(t.transform.parent),!t.obj)return;if(t.obj.type===e.type)return t.obj;if(t.transform.ref===yE.RootRef)return}}getRootOfType(e){if(!this._current)return;let t=this._current,n;for(;;){if(!t.obj)return;if(t.obj.type===e.type&&(n=t),t.transform.ref===yE.RootRef)return n?n.obj:void 0;t=this.cells.get(t.transform.parent)}}constructor(e){this.cells=e,this._current=void 0}}e.Impl=t;function n(e,t){let n=e.cells,r=n.get(t),i=[r];for(;r?.transform.transformer.definition.isDecorator;)r=n.get(r.transform.parent),i.push(r);return i}e.getDecoratorChain=n;function r(e,t,n){let r,i=e.cells.get(n);if(i)for(;;){if(!i.obj)return;if(i.obj.type===t.type&&(r=i),i.transform.ref===yE.RootRef)return r?r.obj:void 0;i=e.cells.get(i.transform.parent)}}e.getRootOfType=r})(SD||={});var Cme=class{constructor(){this.queue=[],this.signal=new sD}get length(){return this.queue.length}enqueue(e){return this.queue.push(e),this.queue.length===1?!0:this.waitFor(e)}handled(e){EE(this.queue,e),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(e){let t=EE(this.queue,e);return t&&this.signal.next({v:e,stillPresent:!1}),t}waitFor(e){return new Promise(t=>{let n=this.signal.subscribe(({v:r,stillPresent:i})=>{r===e&&(n.unsubscribe(),t(i))})})}},CD;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function n({keys:e,array:t},n,r){return e.has(n)?!1:(e.add(n),t[t.length]=r,!0)}e.add=n;function r({keys:e},t){return e.has(t)}e.has=r})(CD||={});var wD=class{get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new yD.Root(this.tree,this)}registerRefResolver(e,t){this.refResolvers.push([e,t])}removeRefResolver(e){this.refResolvers=this.refResolvers.filter(t=>t[0]!==e)}addHistory(e,t){this.historyCapacity!==0&&(this.history.unshift([e,t||`Update`]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){return hb.create(`Undo`,async e=>{let t=this.history.shift();if(t){this.events.historyUpdated.next({state:this}),this.undoingHistory=!0;try{await this.updateTree(t[0],{canUndo:!1}).runInContext(e)}finally{this.undoingHistory=!1}}})}getSnapshot(){return{tree:PE.toJSON(this._tree)}}setSnapshot(e){let t=PE.fromJSON(e.tree);return this.updateTree(t)}setCurrent(e){this.behaviors.currentObject.next({state:this,ref:e})}updateCellState(e,t){let n=this.cells.get(e);if(!n)return;let r=typeof t==`function`?t(n.state):t;yE.assignState(n.state,r)&&(n.transform=this._tree.assignState(n.transform.ref,r),this.events.cell.stateUpdated.next({state:this,ref:e,cell:n}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(e){return FE.select(e,this)}selectQ(e){return typeof e==`string`?FE.select(e,this):FE.select(e(FE.Generators),this)}applyAction(e,t,n=yE.RootRef){return hb.create(`Apply Action`,r=>{let i=this.cells.get(n);if(!i)throw Error(`'${n}' does not exist.`);if(i.status!==`ok`)throw Error(`Action cannot be applied to a cell with status '${i.status}'`);return kD(e.definition.run({ref:n,cell:i,a:i.obj,params:t,state:this},this.globalContext),r)})}transaction(e,t){return hb.create(`State Transaction`,async n=>{let r=this.inTransaction,i=this._tree.asImmutable(),a=!1;try{r||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,await e(n),this.inTransactionError&&(a=!0,await this.updateTree(i).runInContext(n))}catch(e){if(a||(a=!0,await this.updateTree(i).runInContext(n),this.events.log.next(xD.error(`Error during state transaction, reverting`))),r)throw this.inTransactionError=!0,e;if(t?.rethrowErrors)throw e;console.error(e)}finally{r||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),a||(t?.canUndo?this.addHistory(i,typeof t.canUndo==`string`?t.canUndo:void 0):this.clearHistory()))}})}get inUpdate(){return this._inUpdate}updateTree(e,t){let n={tree:e,options:t};return hb.create(`Update Tree`,async r=>{if(!await this.updateQueue.enqueue(n))return;this._inUpdate=!0;let i=t?.canUndo?this._tree.asImmutable():void 0,a=!1;this.inTransaction||this.behaviors.isUpdating.next(!0);try{if(yD.is(e)){if(e.editInfo.applied)throw Error(`This builder has already been applied. Create a new builder for further state updates`);e.editInfo.applied=!0}this.reverted=!1;let i=t&&(t.revertIfAborted||t.revertOnError)?await this._revertibleTreeUpdate(r,n,t):await this._updateTree(r,n);return a=this.reverted,i.ctx.hadError&&(this.inTransactionError=!0),i.cell?new Px(i.cell.transform.ref,this):void 0}finally{this._inUpdate=!1,this.updateQueue.handled(n),this.inTransaction||(this.behaviors.isUpdating.next(!1),t?.canUndo?a||this.addHistory(i,typeof t.canUndo==`string`?t.canUndo:void 0):this.undoingHistory||this.clearHistory())}},()=>{this.updateQueue.remove(n)})}async _revertibleTreeUpdate(e,t,n){let r=this.tree,i=await this._updateTree(e,t);return(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,await this._updateTree(e,{tree:r,options:t.options})):i}async _updateTree(e,t){let n=!1,r=this.updateTreeAndCreateCtx(t.tree,e,t.options);try{return n=await Tme(r),yD.isTo(t.tree)?{ctx:r,cell:this.select(t.tree.ref)[0]}:{ctx:r}}finally{this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction})}}updateTreeAndCreateCtx(e,t,n){let r=(yD.is(e)?e.getTree():e).asTransient(),i=this._tree;this._tree=r;let a={parent:this,editInfo:yD.is(e)?e.editInfo:void 0,errorFree:this.errorFree,taskCtx:t,oldTree:i,tree:r,cells:this.cells,spine:this.spine,results:[],options:{...wme,...n},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:this.tryGetCellData};return this.errorFree=!0,a}constructor(e,t){this.errorFree=!0,this.ev=_D.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:yE.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new Sme,this.cells=new Map,this.spine=new SD.Impl(this.cells),this.refResolvers=[],this.tryGetCellData=e=>{let t=this.cells.get(e)?.obj?.data;if(t===void 0){for(let[,n]of this.refResolvers)if(t=n(this,e),t!==void 0)break;if(t===void 0)throw Error(`Cell '${e}' data undefined.`)}return t},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new Cme,this._tree=PE.createEmpty(yE.createRoot(t&&t.rootState)).asTransient();let n=this._tree.root;this.runTask=t.runTask,t?.historyCapacity!==void 0&&(this.historyCapacity=t.historyCapacity),this.cells.set(n.ref,{parent:this,transform:n,sourceRef:void 0,obj:e,status:`ok`,state:{...n.state},errorText:void 0,params:{definition:{},values:{}},dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=t&&t.globalContext}};(function(e){function t(t,n){return new e(t,n)}e.create=t,(function(e){function t(e,t){return!!t&&e.ref===t.transform.ref&&e.state===t.parent}e.isCell=t})(e.ObjectEvent||={})})(wD||={});var wme={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};async function Tme(e){let t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),n,r=[],i;if(t)n=[],i=[e.editInfo.lastUpdate];else{n=kme(e);let t=e.parent.current,a=!1;for(let e of n)if(e===t){a=!0;break}if(a){let r=Rme(e.oldTree,t,n,e.cells);e.parent.setCurrent(r)}for(let t=n.length-1;t>=0;t--){let r=e.cells.get(n[t]);r&&DD(r.transform,r.obj,r?.transform.params,r.cache,e.parent.globalContext)}for(let t of n){let n=e.cells.get(t);n&&(n.parent=void 0,Pme(n));let i=n&&n.obj;e.cells.delete(t),r.push(i)}i=Eme(e.cells,e.tree)}let a=Lme(e,i);for(let t of a.added)e.parent.events.cell.created.next({state:e.parent,ref:t.transform.ref,cell:t});for(let t=0;t<n.length;t++){let i=n[t],a=e.oldTree.transforms.get(i).parent;e.parent.events.object.removed.next({state:e.parent,ref:i,obj:r[t]}),e.parent.events.cell.removed.next({state:e.parent,ref:i,parent:a})}if(r.length&&(r=[]),a.dependent)for(let e of a.dependent)i.push(e.transform.ref);Nme(e,i);for(let t of i)await Vme(e,t);e.editInfo||jme(e);let o=e.newCurrent;for(let t of e.results)t.action===`created`?(e.parent.events.object.created.next({state:e.parent,ref:t.ref,obj:t.obj}),e.newCurrent||!e.tree.transforms.get(t.ref).state.isGhost&&t.obj!==Mx.Null&&(o=t.ref)):t.action===`updated`?e.parent.events.object.updated.next({state:e.parent,ref:t.ref,action:`in-place`,obj:t.obj,oldData:t.oldData}):t.action===`replaced`&&e.parent.events.object.updated.next({state:e.parent,ref:t.ref,action:`recreate`,obj:t.obj,oldObj:t.oldObj});if(o)e.options.doNotUpdateCurrent||e.parent.setCurrent(o);else{let t=e.parent.current,n=e.cells.get(t);n&&(n.obj===Mx.Null||n.status===`error`&&n.errorText===Bme)&&(o=Rme(e.oldTree,t,[],e.cells),e.parent.setCurrent(o))}return n.length>0||i.length>0||e.changed}function Eme(e,t){let n={roots:[],cells:e};return PE.doPreOrder(t,t.root,n,Dme),n.roots}function Dme(e,t,n){let r=n.cells.get(e.ref);return!r||r.transform.version!==e.version?(n.roots.push(e.ref),!1):!(r.status===`error`||r&&r.obj===Mx.Null)}function Ome(e,t,n){!n.newTree.transforms.has(e.ref)&&n.cells.has(e.ref)&&n.deletes.push(e.ref)}function kme(e){let t={newTree:e.tree,cells:e.cells,deletes:[]};return PE.doPostOrder(e.oldTree,e.oldTree.root,t,Ome),t.deletes}function Ame(e,t,n){let r=n.cells.get(e.ref);!r||!yE.syncState(r.state,e.state)||n.parent.events.cell.stateUpdated.next({state:n.parent,ref:e.ref,cell:r})}function jme(e){PE.doPreOrder(e.tree,e.tree.root,e,Ame)}function TD(e,t,n,r){let i=e.cells.get(t),a=i.status!==n;i.status=n,i.errorText=r,a&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function Mme(e,t,n){n.cells.get(e.ref).transform=e,TD(n,e.ref,`pending`)}function Nme(e,t){for(let n of t)PE.doPreOrder(e.tree,e.tree.transforms.get(n),e,Mme)}function Pme(e){for(let t of e.dependencies.dependsOn)kE(t.dependencies.dependentBy,e)}function Fme(e,t,{ctx:n,added:r,visited:i}){if(i.add(e.ref),n.cells.has(e.ref))return;let a={parent:n.parent,transform:e,sourceRef:void 0,status:`pending`,state:{...e.state},errorText:void 0,params:void 0,dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,a),r.push(a)}function Ime(e,t){if(e.transform.dependsOn)for(let n of e.transform.dependsOn){if(!t.tree.transforms.get(n))throw Error(`Cannot depend on a non-existent transform.`);let r=t.cells.get(n);OE(e.dependencies.dependsOn,r),OE(r.dependencies.dependentBy,e)}}function Lme(e,t){let n={ctx:e,visited:new Set,added:[]};for(let r of t)PE.doPreOrder(e.tree,e.tree.transforms.get(r),n,Fme);for(let t of n.added)Ime(t,e);let r;return n.visited.forEach(t=>{let i=e.cells.get(t);for(let e of i.dependencies.dependentBy)n.visited.has(e.transform.ref)||(r||=CD.create(),CD.add(r,e.transform.ref,e))}),{added:n.added,dependent:r?r.array:void 0}}function Rme(e,t,n,r){return zme(e,t,new Set(n),r)}function zme(e,t,n,r){if(t===yE.RootRef)return t;let i=e.transforms.get(t),a=e.children.get(i.parent).values(),o,s=!1;for(;;){let i=a.next();if(i.done)break;if(n.has(i.value))continue;let c=r.get(i.value);if(!c||c.status===`error`||c.obj===Mx.Null)continue;let l=e.transforms.get(i.value);if(!l.state.isGhost){if(i.value===t){s=!0,n.has(t)||(o=t);continue}if(s)return l.ref;o=l.ref}}return o||zme(e,i.parent,n,r)}function ED(e,t,n,r){r||(e.hadError=!0,e.parent.errorFree=!1);let i=e.cells.get(t);if(n){e.wasAborted=e.wasAborted||hb.isAbort(n);let i=``+n;TD(e,t,`error`,i),r||e.parent.events.log.next({type:`error`,timestamp:new Date,message:i})}else i.params=void 0;if(i.obj){let n=i.obj;i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:n})}let a=e.tree.children.get(t).values();for(;;){let t=a.next();if(t.done)return;ED(e,t.value,void 0,r)}}var Bme=`Parent is null`;async function Vme(e,t){TD(e,t,`processing`);let n=!1;try{let r=Ly(),i=await Ume(e,t),a=Ly()-r;i.action!==`none`&&(e.changed=!0),TD(e,t,`ok`),e.results.push(i),i.action===`created`?(n=i.obj===Mx.Null,!n&&!e.options.doNotLogTiming&&e.parent.events.log.next(xD.info(`Created ${i.obj.label} in ${Ry(a)}.`))):(i.action===`updated`||i.action===`replaced`)&&(n=i.obj===Mx.Null,!n&&!e.options.doNotLogTiming&&e.parent.events.log.next(xD.info(`Updated ${i.obj.label} in ${Ry(a)}.`)))}catch(n){e.changed=!0,e.hadError||(e.newCurrent=t),ED(e,t,n,!1),console.error(n);return}let r=e.tree.children.get(t).values();for(;;){let t=r.next();if(t.done)return;n?ED(e,t.value,void 0,!0):await Vme(e,t.value)}}function Hme(e,t,n,r){let i=t.transformer.definition.params,a=i?i(n,e.parent.globalContext):{};if(t.version!==t._normalized_param_version)t.params=V.normalizeParams(a,t.params,`all`),t._normalized_param_version=t.version;else{let e=V.getDefaultValues(a);t.params=t.params?Tfe(t.params,e):e}return V.resolveRefs(a,t.params,e.getCellData),{definition:a,values:t.params}}async function Ume(e,t){let{oldTree:n,tree:r}=e,i=e.cells.get(t),a=i.transform;if(i.transform.ref===yE.RootRef)return{action:`none`};let o=e.cells.get(i.transform.parent);if(o?.obj===Mx.Null)if(i.sourceRef=o.transform.ref,n.transforms.has(t)&&i.params){let n=i.params.values,r=i.cache;return DD(a,i.obj,n,r,e.parent.globalContext),i.params=void 0,i.obj=Mx.Null,{ref:t,action:`updated`,obj:i.obj}}else return i.params=void 0,{ref:t,action:`created`,obj:Mx.Null};let s=a.transformer.definition.from.length===0?o:FE.findAncestorOfType(r,e.cells,t,a.transformer.definition.from);if(!s)throw Error(`No suitable parent found for '${t}'`);e.spine.current=i;let c=s.obj;i.sourceRef=s.transform.ref;let l=Hme(e,a,c,i);if(!n.transforms.has(t)||!i.params){i.params=l;let n=await Gme(e,i,a.transformer,c,l.values);return OD(n,a),i.obj=n,{ref:t,action:`created`,obj:n}}else{let n=i.params.values,r=i.cache,o=i.obj?.data,s=l.values;switch(i.params=l,i.obj&&i.obj!==Mx.Null?await Kme(e,i,a.transformer,c,i.obj,n,s):lE.UpdateResult.Recreate){case lE.UpdateResult.Recreate:{let o=i.obj;DD(a,o,n,r,e.parent.globalContext);let l=await Gme(e,i,a.transformer,c,s);return OD(l,a),i.obj=l,{ref:t,action:`replaced`,oldObj:o,obj:l}}case lE.UpdateResult.Updated:return OD(i.obj,a),{ref:t,action:`updated`,oldData:o,obj:i.obj};case lE.UpdateResult.Null:return DD(a,i.obj,n,r,e.parent.globalContext),i.obj=Mx.Null,{ref:t,action:`updated`,obj:i.obj};default:return{action:`none`}}}}function DD(e,t,n,r,i){var a,o;(o=(a=e.transformer.definition).dispose)==null||o.call(a,{b:t===Mx.Null?void 0:t,params:n,cache:r},i)}function OD(e,t){!e||e===Mx.Null||(e.tags=t.tags)}function kD(e,t){return typeof e.runInContext==`function`?e.runInContext(t):e}function Wme(e){if(e.dependencies.dependsOn.length===0)return;let t=Object.create(null);for(let n of e.dependencies.dependsOn){if(!n.obj)throw Error(`Unresolved dependency.`);t[n.transform.ref]=n.obj}return t}function Gme(e,t,n,r,i){return t.cache||=Object.create(null),kD(n.definition.apply({a:r,params:i,cache:t.cache,spine:e.spine,dependencies:Wme(t)},e.parent.globalContext),e.taskCtx)}async function Kme(e,t,n,r,i,a,o){return n.definition.update?(t.cache||=Object.create(null),kD(n.definition.update({a:r,oldParams:a,b:i,newParams:o,cache:t.cache,spine:e.spine,dependencies:Wme(t)},e.parent.globalContext),e.taskCtx)):lE.UpdateResult.Recreate}var H;(function(e){e.Create=Mx.factory();function t(e){return!!e&&e.type.typeClass===`Representation3D`}e.isRepresentation3D=t;function n(e){return!!e&&e.type.typeClass===`Behavior`}e.isBehavior=n;function r(t){return e.Create({...t,typeClass:`Representation3D`})}e.CreateRepresentation3D=r;function i(t){return e.Create({...t,typeClass:`Behavior`})}e.CreateBehavior=i;class a extends e.Create({name:`Root`,typeClass:`Root`}){}e.Root=a;class o extends e.Create({name:`Group`,typeClass:`Group`}){}e.Group=o,(function(t){class n extends e.Create({name:`String Data`,typeClass:`Data`}){}t.String=n;class r extends e.Create({name:`Binary Data`,typeClass:`Data`}){}t.Binary=r;class i extends e.Create({name:`Data Blob`,typeClass:`Data`}){}t.Blob=i})(e.Data||={}),(function(t){class n extends e.Create({name:`JSON Data`,typeClass:`Data`}){}t.Json=n;class r extends e.Create({name:`CIF File`,typeClass:`Data`}){}t.Cif=r;class i extends e.Create({name:`Cube File`,typeClass:`Data`}){}t.Cube=i;class a extends e.Create({name:`PSF File`,typeClass:`Data`}){}t.Psf=a;class o extends e.Create({name:`PRMTOP File`,typeClass:`Data`}){}t.Prmtop=o;class s extends e.Create({name:`TOP File`,typeClass:`Data`}){}t.Top=s;class c extends e.Create({name:`PLY File`,typeClass:`Data`}){}t.Ply=c;class l extends e.Create({name:`CCP4/MRC/MAP File`,typeClass:`Data`}){}t.Ccp4=l;class u extends e.Create({name:`DSN6/BRIX File`,typeClass:`Data`}){}t.Dsn6=u;class d extends e.Create({name:`DX File`,typeClass:`Data`}){}t.Dx=d;class f extends e.Create({name:`Format Blob`,typeClass:`Data`}){}t.Blob=f})(e.Format||={}),(function(t){class n extends e.Create({name:`Coordinates`,typeClass:`Object`}){}t.Coordinates=n;class i extends e.Create({name:`Topology`,typeClass:`Object`}){}t.Topology=i;class a extends e.Create({name:`Model`,typeClass:`Object`}){}t.Model=a;class o extends e.Create({name:`Trajectory`,typeClass:`Object`}){}t.Trajectory=o;class s extends e.Create({name:`Structure`,typeClass:`Object`}){}t.Structure=s,(function(t){class n extends r({name:`Structure 3D`}){}t.Representation3D=n;class i extends e.Create({name:`Structure 3D State`,typeClass:`Object`}){}t.Representation3DState=i;class a extends e.Create({name:`Selections`,typeClass:`Object`}){}t.Selections=a})(s=t.Structure||={})})(e.Molecule||={}),(function(t){class n extends e.Create({name:`Volume`,typeClass:`Object`}){}t.Data=n;class i extends e.Create({name:`Lazy Volume`,typeClass:`Object`}){}t.Lazy=i;class a extends r({name:`Volume 3D`}){}t.Representation3D=a})(e.Volume||={}),(function(t){class n extends e.Create({name:`Shape Provider`,typeClass:`Object`}){}t.Provider=n;class i extends r({name:`Shape 3D`}){}t.Representation3D=i})(e.Shape||={})})(H||={});var AD;(function(e){e.CreateBuiltIn=lE.factory(`ms-plugin`),e.BuiltIn=lE.builderFactory(`ms-plugin`)})(AD||={});var jD;(function(e){function t(e,t=-1){return new r(e,t)}e.error=t;function n(e,t=[]){return new i(e,t)}e.success=n;class r{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(e,t){this.message=e,this.line=t,this.isError=!0}}e.Error=r;class i{constructor(e,t){this.result=e,this.warnings=t,this.isError=!1}}e.Success=i})(jD||={});var MD;(function(e){function t(e){let t=new DataView(e.buffer);return Object.assign(e.subarray(0),{readInt8:e=>t.getInt8(e),readUInt8:e=>t.getUint8(e),writeInt8:(e,n)=>t.setInt8(n,e),writeUInt8:(e,n)=>t.setUint8(n,e),readInt16LE:e=>t.getInt16(e,!0),readInt32LE:e=>t.getInt32(e,!0),readUInt16LE:e=>t.getUint16(e,!0),readUInt32LE:e=>t.getUint32(e,!0),readFloatLE:e=>t.getFloat32(e,!0),readDoubleLE:e=>t.getFloat64(e,!0),writeInt16LE:(e,n)=>t.setInt16(n,e,!0),writeInt32LE:(e,n)=>t.setInt32(n,e,!0),writeUInt16LE:(e,n)=>t.setUint16(n,e,!0),writeUInt32LE:(e,n)=>t.setUint32(n,e,!0),writeFloatLE:(e,n)=>t.setFloat32(n,e,!0),writeDoubleLE:(e,n)=>t.setFloat64(n,e,!0),readInt16BE:e=>t.getInt16(e,!1),readInt32BE:e=>t.getInt32(e,!1),readUInt16BE:e=>t.getUint16(e,!1),readUInt32BE:e=>t.getUint32(e,!1),readFloatBE:e=>t.getFloat32(e,!1),readDoubleBE:e=>t.getFloat64(e,!1),writeInt16BE:(e,n)=>t.setInt16(n,e,!1),writeInt32BE:(e,n)=>t.setInt32(n,e,!1),writeUInt16BE:(e,n)=>t.setUint16(n,e,!1),writeUInt32BE:(e,n)=>t.setUint32(n,e,!1),writeFloatBE:(e,n)=>t.setFloat32(n,e,!1),writeDoubleBE:(e,n)=>t.setFloat64(n,e,!1),copy:(t,n,r,i)=>(n=Ox(n,0),r=Ox(r,0),i=Ox(i,e.length),t.set(e.subarray(r,i),n),i-r)})}e.fromUint8Array=t;function n(e){return t(new Uint8Array(e))}e.fromArrayBuffer=n;function r(e){return e}e.fromBuffer=r,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function i(e,t,n,r,i){for(let a=0,o=n;a<o;a+=r)for(let n=0;n<r;n++)t[i+a+r-n-1]=e[i+a+n]}e.flipByteOrder=i;function a(e,t=0,n){let r=new Int16Array(e,t,n);for(let e=0,t=r.length;e<t;++e){let t=r[e];r[e]=(t&255)<<8|t>>8&255}}e.flipByteOrderInPlace2=a;function o(t,n,r,a,o){e.IsNativeEndianLittle||!r||a<=1||i(t,n,r,a,o)}e.ensureLittleEndian=o})(MD||={});var ND;(function(e){function t(e,t){return{name:t,readBuffer:(t,n,r,i)=>{let a,o;if(typeof n==`number`){r=Ox(r,n);let i=t,s=Math.min(e.length,i+r);a=s-i,o=MD.fromUint8Array(new Uint8Array(e.buffer,i,s-i))}else{r=Ox(r,n.length);let s=t,c=Math.min(e.length,s+r);n.set(e.subarray(s,c),i),a=c-s,o=n}return r!==a&&console.warn(`byteCount ${r} and bytesRead ${a} differ`),Promise.resolve({bytesRead:a,buffer:o})},writeBuffer:(e,t,n)=>(n=Ox(n,t.length),console.error(`.writeBuffer not implemented for FileHandle.fromBuffer`),Promise.resolve(0)),writeBufferSync:(e,t,n)=>(n=Ox(n,t.length),console.error(`.writeSync not implemented for FileHandle.fromBuffer`),0),close:xx}}e.fromBuffer=t})(ND||={});var PD;(function(e){e.Float32=`float32`,e.Int8=`int8`,e.Int16=`int16`,e.Uint16=`uint16`})(PD||={});function qme(e){return e===PD.Float32?4:e===PD.Int16||e===PD.Uint16?2:1}function Jme(e,t,n=0,r){return e===PD.Float32?new Float32Array(t,n,r):e===PD.Int16?new Int16Array(t,n,r):e===PD.Uint16?new Uint16Array(t,n,r):new Int8Array(t,n,r)}function Yme(e,t){let n=qme(t),r=new ArrayBuffer(n*e),i=MD.fromArrayBuffer(r),a=MD.IsNativeEndianLittle?r:new ArrayBuffer(n*e);return{type:t,elementByteSize:n,readBuffer:i,valuesBuffer:new Uint8Array(a),values:Jme(t,a)}}async function Xme(e,t,n,r,i,a){return await t.readBuffer(n,e.readBuffer,r,i),e.elementByteSize>1&&(a!==void 0&&a!==MD.IsNativeEndianLittle||!MD.IsNativeEndianLittle)&&MD.flipByteOrder(e.readBuffer,e.valuesBuffer,r,e.elementByteSize,i),e.values}async function Zme(e){let{buffer:t}=await e.readBuffer(0,1024),n=String.fromCharCode(t.readUInt8(208),t.readUInt8(209),t.readUInt8(210),t.readUInt8(211));if(n!==`MAP `)throw Error(`ccp4 format error, missing "MAP " string`);let r=[t.readUInt8(212),t.readUInt8(213)],i=!1;r[0]===68&&r[1]===65?i=!0:r[0]===17&&r[1]===17?i=!1:t.readInt32LE(12)<=16&&(i=!0);let a=i?e=>t.readInt32LE(e*4):e=>t.readInt32BE(e*4),o=i?e=>t.readFloatLE(e*4):e=>t.readFloatBE(e*4);return{header:{NC:a(0),NR:a(1),NS:a(2),MODE:a(3),NCSTART:a(4),NRSTART:a(5),NSSTART:a(6),NX:a(7),NY:a(8),NZ:a(9),xLength:o(10),yLength:o(11),zLength:o(12),alpha:o(13),beta:o(14),gamma:o(15),MAPC:a(16),MAPR:a(17),MAPS:a(18),AMIN:o(19),AMAX:o(20),AMEAN:o(21),ISPG:a(22),NSYMBT:a(23),LSKFLG:a(24),SKWMAT:[],SKWTRN:[],userFlag1:a(39),userFlag2:a(40),originX:o(49),originY:o(50),originZ:o(51),MAP:n,MACHST:r,ARMS:o(54)},littleEndian:i}}async function Qme(e,t,n,r,i,a){if(ehe(e)){let a=3*i;await n.readBuffer(r,t.readBuffer,i,a);let o=new Int8Array(t.valuesBuffer.buffer,a),s=(e.AMAX-e.AMIN)/255,c=.5*(e.AMIN+e.AMAX+s);for(let e=0,n=i;e<n;++e)t.values[e]=s*o[e]+c}else await Xme(t,n,r,i,0,a)}function $me(e){switch(e){case 0:return PD.Int8;case 1:return PD.Int16;case 2:return PD.Float32;case 3:throw Error(`mode 3 unsupported, complex 16-bit integers`);case 4:throw Error(`mode 4 unsupported, complex 32-bit reals`);case 6:PD.Uint16;case 16:throw Error(`mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)`)}throw Error(`unknown mode '${e}'`)}function ehe(e){return e.userFlag1===-128&&e.userFlag2===127}function the(e){return ehe(e)?PD.Float32:$me(e.MODE)}function nhe(e){return 256*4+e.NSYMBT}async function rhe(e,t,n){await n.update({message:`Parsing CCP4/MRC/MAP file...`});let{header:r,littleEndian:i}=await Zme(e),a=nhe(r),o=$me(r.MODE),s=the(r),c=r.NC*r.NR*r.NS,l=c*qme(o),u=Yme(c,s);return Qme(r,u,e,a,l,i),{header:r,values:u.values,name:e.name}}function ihe(e,t){return hb.create(`Parse CCP4/MRC/MAP`,async n=>{try{return jD.success(await rhe(e,t,n))}catch(e){return jD.error(e)}})}function ahe(e,t){return ihe(ND.fromBuffer(MD.fromUint8Array(e),t),e.length)}function FD(e,t){return{start:t&&t.start!==void 0?Math.max(Math.min(t.start,e-1),0):0,end:t&&t.end!==void 0?Math.min(t.end,e):e}}function ID(e,t){let n=t&&t.array!==void 0?t.array:Array,{start:r,end:i}=FD(e,t);return{array:new n(i-r),start:r,end:i}}function ohe(e,t,n){for(let r=0,i=t.length;r<i;r++)t[r]=e(n+r);return t}function LD(e,t,n){let{array:r,start:i}=ID(e,n);return ohe(t,r,i)}function RD(e){return!!e.buffer&&typeof e.byteLength==`number`&&typeof e.BYTES_PER_ELEMENT==`number`}function zD(e,t){let{constructor:n,buffer:r,length:i,byteOffset:a,BYTES_PER_ELEMENT:o}=e,{start:s,end:c}=FD(i,t);return s===0&&c===i?e:new n(r,a+o*s,Math.min(i,c-s))}var BD;(function(e){function t(e,t,n){let r=[];for(let e=0;e<t.length;e++)r[e]=t[t.length-e-1];let i=[1];for(let t=1;t<e.length;t++)i[t]=e[r[t-1]];return{dimensions:e,axisOrderFastToSlow:r,axisOrderSlowToFast:t,accessDimensions:i,defaultCtor:n||Float64Array}}function n(e,t){return{space:e,data:t}}e.create=n;function r(e,n,r){let i=t(e,n,r),{get:a,set:o,add:s,dataOffset:c,getCoords:l}=p(i);return{rank:e.length,dimensions:e,axisOrderSlowToFast:n,create:m(i),get:a,set:o,add:s,dataOffset:c,getCoords:l}}e.Space=r;function i(e){return e}e.Data1=i;function a(e,t){return r([e],[0],t)}e.Vector=a;function o(e,t,n){return r([e,t],[1,0],n)}e.ColumnMajorMatrix=o;function s(e,t,n){return r([e,t],[0,1],n)}e.RowMajorMatrix=s;function c(e,t,n){if(t.rank!==2)throw Error(`Invalid tensor rank`);let r=Math.min(4,t.dimensions[0]),i=Math.min(4,t.dimensions[1]);for(let a=0;a<r;a++)for(let r=0;r<i;r++)z.setValue(e,a,r,t.get(n,a,r));return e}e.toMat4=c;function l(e,t,n){if(t.rank!==2)throw Error(`Invalid tensor rank`);let r=Math.min(3,t.dimensions[0]),i=Math.min(3,t.dimensions[1]);for(let a=0;a<r;a++)for(let r=0;r<i;r++)TT.setValue(e,a,r,t.get(n,a,r));return e}e.toMat3=l;function u(e,t,n){if(t.rank!==1)throw Error(`Invalid tensor rank`);let r=Math.min(3,t.dimensions[0]);for(let t=0;t<r;t++)e[t]=n[t];return e}e.toVec3=u;function d(e,t,n){if(t.rank!==1)throw Error(`Invalid tensor rank`);let r=Math.min(4,t.dimensions[0]);for(let t=0;t<r;t++)e[t]=n[t];return e}e.toVec4=d;function f(e,t){let n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}e.areEqualExact=f;function p(e){let{dimensions:t,axisOrderFastToSlow:n}=e;switch(t.length){case 1:return{get:(e,t)=>e[t],set:(e,t,n)=>e[t]=n,add:(e,t,n)=>e[t]+=n,dataOffset:e=>e,getCoords:(e,t)=>(t[0]=e,t)};case 2:if(n[0]===0&&n[1]===1){let e=t[0];return{get:(t,n,r)=>t[r*e+n],set:(t,n,r,i)=>t[r*e+n]=i,add:(t,n,r,i)=>t[r*e+n]+=i,dataOffset:(t,n)=>n*e+t,getCoords:(t,n)=>(n[0]=t%e,n[1]=Math.floor(t/e),n)}}if(n[0]===1&&n[1]===0){let e=t[1];return{get:(t,n,r)=>t[n*e+r],set:(t,n,r,i)=>t[n*e+r]=i,add:(t,n,r,i)=>t[n*e+r]+=i,dataOffset:(t,n)=>t*e+n,getCoords:(t,n)=>(n[0]=Math.floor(t/e),n[1]=t%e,n)}}throw Error(`bad axis order`);case 3:if(n[0]===0&&n[1]===1&&n[2]===2){let e=t[0],n=t[1],r=e*n;return{get:(t,n,i,a)=>t[n+i*e+a*r],set:(t,n,i,a,o)=>t[n+i*e+a*r]=o,add:(t,n,i,a,o)=>t[n+i*e+a*r]+=o,dataOffset:(t,n,i)=>t+n*e+i*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=t%e,r[1]=i%n,r[2]=Math.floor(i/n),r}}}if(n[0]===0&&n[1]===2&&n[2]===1){let e=t[0],n=t[2],r=e*n;return{get:(t,n,i,a)=>t[n+a*e+i*r],set:(t,n,i,a,o)=>t[n+a*e+i*r]=o,add:(t,n,i,a,o)=>t[n+a*e+i*r]+=o,dataOffset:(t,n,i)=>t+i*e+n*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=t%e,r[1]=Math.floor(i/n),r[2]=i%n,r}}}if(n[0]===1&&n[1]===0&&n[2]===2){let e=t[1],n=t[0],r=e*n;return{get:(t,n,i,a)=>t[i+n*e+a*r],set:(t,n,i,a,o)=>t[i+n*e+a*r]=o,add:(t,n,i,a,o)=>t[i+n*e+a*r]+=o,dataOffset:(t,n,i)=>n+t*e+i*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=i%n,r[1]=t%e,r[2]=Math.floor(i/n),r}}}if(n[0]===1&&n[1]===2&&n[2]===0){let e=t[1],n=t[2],r=e*n;return{get:(t,n,i,a)=>t[i+a*e+n*r],set:(t,n,i,a,o)=>t[i+a*e+n*r]=o,add:(t,n,i,a,o)=>t[i+a*e+n*r]+=o,dataOffset:(t,n,i)=>n+i*e+t*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=Math.floor(i/n),r[1]=t%e,r[2]=i%n,r}}}if(n[0]===2&&n[1]===0&&n[2]===1){let e=t[2],n=t[0],r=e*n;return{get:(t,n,i,a)=>t[a+n*e+i*r],set:(t,n,i,a,o)=>t[a+n*e+i*r]=o,add:(t,n,i,a,o)=>t[a+n*e+i*r]+=o,dataOffset:(t,n,i)=>i+t*e+n*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=i%n,r[1]=Math.floor(i/n),r[2]=t%e,r}}}if(n[0]===2&&n[1]===1&&n[2]===0){let e=t[2],n=t[1],r=e*n;return{get:(t,n,i,a)=>t[a+i*e+n*r],set:(t,n,i,a,o)=>t[a+i*e+n*r]=o,add:(t,n,i,a,o)=>t[a+i*e+n*r]+=o,dataOffset:(t,n,i)=>i+n*e+t*r,getCoords:(t,r)=>{let i=Math.floor(t/e);return r[0]=Math.floor(i/n),r[1]=i%n,r[2]=t%e,r}}}throw Error(`bad axis order`);default:return{get:(t,...n)=>t[h(e,n)],set:(t,...n)=>t[h(e,n)]=n[n.length-1],add:(t,...n)=>t[h(e,n)]+=n[n.length-1],dataOffset:(...t)=>h(e,t),getCoords:(t,n)=>g(e,t,n)}}}function m(e){let{dimensions:t}=e,n=1;for(let e=0,r=t.length;e<r;e++)n*=t[e];return t=>new(t||e.defaultCtor)(n)}function h(e,t){let{accessDimensions:n,axisOrderFastToSlow:r}=e,i=n.length-1,a=n[i]*t[r[i]];for(let e=i-1;e>=0;e--)a=(a+t[r[e]])*n[e];return a}function g(e,t,n){let{dimensions:r,axisOrderFastToSlow:i}=e,a=r.length,o=t;for(let e=0;e<a;e++){let t=r[i[e]];n[i[e]]=o%t,o=Math.floor(o/t)}return n[i[a+1]]=o,n}function _(e){let t=[];for(let n=0;n<e.length;n++)t[n]=e[e.length-n-1];return t}e.invertAxisOrder=_;function v(e,t){let n=[];for(let r=0;r<e.length;r++)n[r]=e[t[r]];return n}function y(e){let t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[n]]=n;return e=>v(e,t)}e.convertToCanonicalAxisIndicesFastToSlow=y;function b(e){let t=new Int32Array(e.length);for(let n=0;n<e.length;n++)t[e[e.length-n-1]]=n;return e=>v(e,t)}e.convertToCanonicalAxisIndicesSlowToFast=b})(BD||={});function VD(e,t,n){for(;t<n&&e.charCodeAt(t)===32;)t++;return HD(e,t,n)}function HD(e,t,n){let r=t,i=0,a=1;for(e.charCodeAt(r)===45?(a=-1,++r):e.charCodeAt(r)===43&&++r;r<n;r++){let t=e.charCodeAt(r)-48;if(t>9||t<0)return a*i|0;i=10*i+t|0}return a*i}function she(e,t,n,r){return t.charCodeAt(n)===43&&n++,e*10**HD(t,n,r)}function che(e,t,n){for(;t<n&&e.charCodeAt(t)===32;)t++;return UD(e,t,n)}function UD(e,t,n){let r=t,i=1,a=0,o=0,s=1;for(e.charCodeAt(r)===45?(i=-1,++r):e.charCodeAt(r)===43&&++r;r<n;){let t=e.charCodeAt(r)-48;if(t>=0&&t<10)a=a*10+t,++r;else if(t===-2){for(++r;r<n;)if(t=e.charCodeAt(r)-48,t>=0&&t<10)o=10*o+t,s=10*s,++r;else if(t===53||t===21)return she(i*(a+o/s),e,r+1,n);else return i*(a+o/s);return i*(a+o/s)}else if(t===53||t===21)return she(i*a,e,r+1,n);else break}return i*a}var WD;(function(e){e[e.Int=0]=`Int`,e[e.Float=1]=`Float`,e[e.Scientific=2]=`Scientific`,e[e.NaN=3]=`NaN`})(WD||={}),WD.Int,WD.Float,WD.Scientific,WD.NaN;var U;(function(e){let t;(function(e){e.str={"@type":`str`,T:``,valueType:`str`},e.ustr={"@type":`str`,T:``,valueType:`str`,transform:`uppercase`},e.lstr={"@type":`str`,T:``,valueType:`str`,transform:`lowercase`},e.int={"@type":`int`,T:0,valueType:`int`},e.coord={"@type":`coord`,T:0,valueType:`float`},e.float={"@type":`float`,T:0,valueType:`float`};function t(e){return{"@type":`str`,T:e?.defaultValue??``,transform:e?.transform,valueType:`str`}}e.Str=t;function n(e=0){return{"@type":`int`,T:e,valueType:`int`}}e.Int=n;function r(e=0){return{"@type":`float`,T:e,valueType:`float`}}e.Float=r;function i(t,n=e.float){return{"@type":`tensor`,T:t.create(),space:t,valueType:`tensor`,baseType:n}}e.Tensor=i;function a(t,n=e.float){return i(BD.Vector(t,n[`@type`]===`int`?Int32Array:Float64Array),n)}e.Vector=a;function o(t,n,r=e.float){return i(BD.ColumnMajorMatrix(t,n,r[`@type`]===`int`?Int32Array:Float64Array),r)}e.Matrix=o;function s(e){return e}e.Aliased=s;function c(e,t,n=[]){return{"@type":`list`,T:n,separator:e,itemParse:t,valueType:`list`}}e.List=c})(t=e.Schema||={});function n(e){return!!e&&!!e.schema&&!!e.value}e.is=n;let r;(function(e){e[e.Present=0]=`Present`,e[e.NotPresent=1]=`NotPresent`,e[e.Unknown=2]=`Unknown`})(r=e.ValueKinds||={}),e.ValueKind={Present:r.Present,NotPresent:r.NotPresent,Unknown:r.Unknown};function i(e,t){return dhe(t.T,e,t,r.NotPresent)}e.Undefined=i;function a(e,t,n){return dhe(e,t,n,r.Present)}e.ofConst=a;function o(e){return GD(e)}e.ofLambda=o;function s(e,n){return o({value:t=>t+e,rowCount:Math.max(n-e+1,0),schema:t.int})}e.range=s;function c(e){return KD(e)}e.ofArray=c;function l(e){return KD({array:e,schema:t.int})}e.ofIntArray=l;function u(e){return KD({array:e,schema:t.float})}e.ofFloatArray=u;function d(e){return KD({array:e,schema:t.str})}e.ofStringArray=d;function f(e){return KD({array:e,schema:t.Aliased(t.str)})}e.ofStringAliasArray=f;function p(e,n=`,`){return KD({array:e,schema:t.List(n,e=>e)})}e.ofStringListArray=p;function m(e){let{count:n,data:r,indices:i}=e;return GD({value:e=>HD(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.int})}e.ofIntTokens=m;function h(e){let{count:n,data:r,indices:i}=e;return GD({value:e=>UD(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.float})}e.ofFloatTokens=h;function g(e){let{count:n,data:r,indices:i}=e;return GD({value:e=>{let t=r.substring(i[2*e],i[2*e+1]);return t===`.`||t===`?`?``:t},rowCount:n,schema:t.str})}e.ofStringTokens=g;function _(e,t,n){return fhe(e,t,n)}e.window=_;function v(e,t,n=!0){return ghe(e,t,n)}e.view=v;function y(e){return lhe(e)}e.createFirstIndexMap=y;function b(e){return uhe(e)}e.createIndexer=b;function x(e,t,n){return yhe(e,t,n||Array)}e.mapToArray=x;function S(e,t){return bhe(e,t)}e.areEqual=S;function C(e,t){return Che(e,t)}e.indicesOf=C;function w(e,t){return e.__array?e:e.isDefined?KD({array:e.toArray({array:t}),schema:e.schema,valueKind:e.valueKind}):i(e.rowCount,e.schema)}e.asArrayColumn=w;function T(e,t,n=0){if(!e.isDefined)return;let r=e.__array;if(r)for(let e=0,i=r.length;e<i;e++)t[n+e]=r[e];else for(let r=0,i=e.rowCount;r<i;r++)t[n+r]=e.value(r)}e.copyToArray=T;function E(e){for(let t=0,n=e.rowCount;t<n;t++)if(t!==e.value(t))return!1;return!0}e.isIdentity=E})(U||={});function lhe(e){let t=new Map;for(let n=0,r=e.rowCount;n<r;n++){let r=e.value(n);t.has(r)||t.set(e.value(n),n)}return t}function uhe(e){let t=new Map;for(let n=0,r=e.rowCount;n<r;n++){let r=e.value(n);t.has(r)||t.set(e.value(n),n)}return e=>t.has(e)?t.get(e):-1}function dhe(e,t,n,r){return{schema:n,__array:void 0,isDefined:r===U.ValueKinds.Present,rowCount:t,value:t=>e,valueKind:e=>r,toArray:n=>{let{array:r}=ID(t,n);for(let t=0,n=r.length;t<n;t++)r[t]=e;return r},areValuesEqual:(e,t)=>!0}}function GD({value:e,valueKind:t,areValuesEqual:n,rowCount:r,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:r,value:e,valueKind:t||(e=>U.ValueKinds.Present),toArray:t=>{let{array:n,start:i}=ID(r,t);for(let t=0,r=n.length;t<r;t++)n[t]=e(t+i);return n},areValuesEqual:n||((t,n)=>e(t)===e(n))}}function KD({array:e,schema:t,valueKind:n}){let r=e.length,i=t.T,a=t.valueType===`str`?t.transform===`lowercase`?t=>{let n=e[t];return typeof n==`string`?n.toLowerCase():`${n??i}`.toLowerCase()}:t.transform===`uppercase`?t=>{let n=e[t];return typeof n==`string`?n.toUpperCase():`${n??i}`.toUpperCase()}:t=>{let n=e[t];return typeof n==`string`?n:`${n??i}`}:t=>e[t],o=RD(e);return{schema:t,__array:e,isDefined:!0,rowCount:r,value:a,valueKind:n||(e=>U.ValueKinds.Present),toArray:t.valueType===`str`?t.transform===`lowercase`?t=>{let{start:n,end:a}=FD(r,t),o=new(t&&t.array!==void 0?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){let r=e[n+t];o[t]=typeof r==`string`?r.toLowerCase():`${r??i}`.toLowerCase()}return o}:t.transform===`uppercase`?t=>{let{start:n,end:a}=FD(r,t),o=new(t&&t.array!==void 0?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){let r=e[n+t];o[t]=typeof r==`string`?r.toUpperCase():`${r??i}`.toUpperCase()}return o}:t=>{let{start:n,end:a}=FD(r,t),o=new(t&&t.array!==void 0?t.array:e.constructor)(a-n);for(let t=0,r=a-n;t<r;t++){let r=e[n+t];o[t]=typeof r==`string`?r:`${r??i}`}return o}:o?t=>zD(e,t):t=>{let{start:n,end:i}=FD(r,t);if(n===0&&i===e.length)return e;let a=new(t&&t.array!==void 0?t.array:e.constructor)(i-n);for(let t=0,r=i-n;t<r;t++)a[t]=e[n+t];return a},areValuesEqual:(t,n)=>e[t]===e[n]}}function fhe(e,t,n){return e.isDefined?t===0&&n===e.rowCount?e:e.__array&&RD(e.__array)?phe(e,t,n):mhe(e,t,n):U.Undefined(n-t,e.schema)}function phe(e,t,n){let r=zD(e.__array,{start:t,end:n}),i=e.valueKind;return KD({array:r,schema:e.schema,valueKind:e=>i(t+e)})}function mhe(e,t,n){let r=e.value,i=e.valueKind,a=e.areValuesEqual,o=t===0?r:e=>r(e+t),s=n-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:o,valueKind:t===0?i:e=>i(e+t),toArray:e=>{let{array:n}=ID(s,e);for(let e=0,i=n.length;e<i;e++)n[e]=r(e+t);return n},areValuesEqual:t===0?a:(e,n)=>a(e+t,n+t)}}function hhe(e,t){if(e.length!==t)return!1;for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}function ghe(e,t,n){return e.rowCount===0||n&&hhe(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?_he(e,t):vhe(e,t)}function _he(e,t){let n=e.__array,r=new n.constructor(t.length);for(let e=0,i=t.length;e<i;e++)r[e]=n[t[e]];let i=e.valueKind;return KD({array:r,schema:e.schema,valueKind:e=>i(t[e])})}function vhe(e,t){let n=e.value,r=e.valueKind,i=e.areValuesEqual,a=e=>n(t[e]),o=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:o,value:a,valueKind:e=>r(t[e]),toArray:e=>{let{array:r}=ID(o,e);for(let e=0,i=r.length;e<i;e++)r[e]=n(t[e]);return r},areValuesEqual:(e,n)=>i(t[e],t[n])}}function yhe(e,t,n){let r=new n(e.rowCount);for(let n=0,i=e.rowCount;n<i;n++)r[n]=t(e.value(n));return r}function bhe(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?xhe(e,t):She(e,t)}function xhe(e,t){let n=e.__array,r=t.__array;for(let t=0,i=e.rowCount;t<i;t++)if(n[t]!==r[t])return!1;return!0}function She(e,t){let n=e.value,r=t.value;for(let t=0,i=e.rowCount;t<i;t++)if(n(t)!==r(t))return!1;return!0}function Che(e,t){let n=[],r=e.value;for(let i=0,a=e.rowCount;i<a;i++)t(r(i))&&(n[n.length]=i);return n}function qD(e,t,n){return e[t]-e[n]}function JD(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function whe(e,t,n,r){let i=n+r>>1;return t(e,n,r)>0?t(e,n,i)>0?t(e,i,r)>0?i:r:n:t(e,r,i)>0?t(e,i,n)>0?i:n:r}function The(e,t,n){let{cmp:r,swap:i,data:a,parts:o}=e,s=t+1,c=n;for(i(a,t,whe(a,r,t,n));r(a,c,t)>0;)--c;for(let e=t+1;e<=c;e++){let n=r(a,e,t);if(n>0){for(i(a,e,c),--c;r(a,c,t)>0;)--c;e--}else n===0&&(i(a,e,s),s++)}for(let e=t;e<s;e++)i(a,e,t+c-e);o[0]=c-s+t+1,o[1]=c}function Ehe({data:e,cmp:t,swap:n},r,i){for(let a=r+1;a<=i;a++){let i=a-1;for(;i>=r&&t(e,i,i+1)>0;)n(e,i,i+1),--i}}function YD(e,t,n){let{parts:r}=e;for(;t<n;){if(n-t<16){Ehe(e,t,n);return}The(e,t,n);let i=r[0],a=r[1];i-t<n-a?(YD(e,t,i-1),t=a+1):(YD(e,a+1,n),n=i-1)}}function Dhe(e,t,n,r){let i=n+1,a=r;JD(e,n,whe(e,qD,n,r));let o=e[n];for(;e[a]>o;)--a;for(let t=n+1;t<=a;t++){let n=e[t];if(n>o){for(JD(e,t,a),--a;e[a]>o;)--a;t--}else n===o&&(JD(e,t,i),++i)}for(let t=n;t<i;t++)JD(e,t,n+a-t);t[0]=a-i+n+1,t[1]=a}function Ohe(e,t,n){for(let r=t+1;r<=n;r++){let n=e[r],i=r-1;for(;i>=t&&e[i]>n;)e[i+1]=e[i],--i;e[i+1]=n}}function XD(e,t,n,r){for(;n<r;){if(r-n<16){Ohe(e,n,r);return}Dhe(e,t,n,r);let i=t[0],a=t[1];i-n<r-a?(XD(e,t,n,i-1),n=a+1):(XD(e,t,a+1,r),r=i-1)}}function ZD(e,t=qD){return khe(e,0,e.length,t)}function khe(e,t,n,r=qD){return r===qD?XD(e,[0,0],t,n-1):YD({data:e,cmp:r,swap:JD,parts:[0,0]},t,n-1),e}function Ahe(e,t,n,r,i){return YD({data:e,cmp:r,swap:i,parts:[0,0]},t,n-1),e}var QD;(function(e){function t(e){return e&&typeof e._rowCount==`number`&&!!e._columns&&!!e._schema}e.is=t;function n(e,t,n={}){let r=Object.create(null),i=Object.keys(e);r._rowCount=t._rowCount,r._columns=i,r._schema=e;for(let e of i)if(t[e])r[e]=t[e];else if(n[e])r[e]=n[e];else throw Error(`Cannot find column '${e}'.`);return r}e.pickColumns=n;function r(e,t){let n=Object.keys(t);return{_rowCount:t[n[0]].rowCount,_columns:n,_schema:e,...t}}e.ofColumns=r;function i(e,t,n){let r=Object.create(null),i=Object.keys(e);r._rowCount=n,r._columns=i,r._schema=e;for(let a of i)a in t?r[a]=t[a]:r[a]=U.Undefined(n,e[a]);return r}e.ofPartialColumns=i;function a(e,t){let n=Object.create(null),r=Object.keys(e);n._rowCount=t,n._columns=r,n._schema=e;for(let i of r)n[i]=U.Undefined(t,e[i]);return n}e.ofUndefinedColumns=a;function o(e,t){let n=Object.create(null),r=t.length,i=Object.keys(e);n._rowCount=r,n._columns=i,n._schema=e;for(let a of i)n[a]=U.ofLambda({rowCount:r,schema:e[a],value:e=>t[e][a],valueKind:e=>t[e][a]===void 0?U.ValueKinds.NotPresent:U.ValueKinds.Present});return n}e.ofRows=o;function s(e,t){let n=Object.create(null),r=Object.keys(e);n._rowCount=0,n._columns=r,n._schema=e;for(let i of r)t[i]===void 0?n[i]=U.Undefined(n._rowCount,e[i]):(n[i]=U.ofArray({array:t[i],schema:e[i]}),n._rowCount=t[i]?.length);return n}e.ofArrays=s;function c(e,t,n){let r=Object.create(null),i=Object.keys(t);r._rowCount=n.length,r._columns=i,r._schema=t;for(let t of i)r[t]=U.view(e[t],n);return r}e.view=c;function l(e,t,n){let r=[];for(let t=0,i=e._rowCount;t<i;++t)n(t)&&r.push(t);return c(e,t,r)}e.pick=l;function u(e,t,n,r){if(n===0&&r===e._rowCount)return e;let i=Object.create(null),a=Object.keys(t);i._rowCount=r-n,i._columns=a,i._schema=t;for(let t of a)i[t]=U.window(e[t],n,r);return i}e.window=u;function d(e,t){let n=Object.create(null),r=Object.keys(t);n._rowCount=0;for(let t of e)n._rowCount+=t._rowCount;let i={};for(let e of r)i[e]=Array(n._rowCount);n._columns=r,n._schema=t;let a=0;for(let t of e){for(let e of r)U.copyToArray(t[e],i[e],a);a+=t._rowCount}for(let e of r)n[e]=U.ofArray({array:i[e],schema:t[e]});return n}e.concat=d;function f(e,t,n){e[t]=U.asArrayColumn(e[t],n)}e.columnToArray=f;function p(e,t){let n=new Int32Array(e._rowCount);for(let e=0,t=n.length;e<t;e++)n[e]=e;ZD(n,(e,n,r)=>t(n,r));let r=!0;for(let e=0,t=n.length;e<t;e++)if(n[e]!==e){r=!1;break}if(r)return e;let i=Object.create(null);i._rowCount=e._rowCount,i._columns=e._columns,i._schema=e._schema;for(let t of e._columns)i[t]=U.view(e[t],n,!1);return i}e.sort=p;function m(e,t){if(e._rowCount!==t._rowCount||e._columns.length!==t._columns.length)return!1;for(let n of e._columns)if(!t[n])return!1;for(let n of e._columns)if(!U.areEqual(e[n],t[n]))return!1;return!0}e.areEqual=m;function h(e,t){let n=Object.create(null),{_columns:r}=e;for(let i=0;i<r.length;i++){let a=r[i];n[a]=e[a].value(t)}return n}e.getRow=h;function g(e,t){for(let n=0,r=e._rowCount;n<r;++n)if(t(n))return h(e,n)}e.pickRow=g;function _(e){let t=[],{_rowCount:n}=e;for(let r=0;r<n;r++)t[r]=h(e,r);return t}e.getRows=_;function v(e){let t={},{_columns:n}=e;for(let r=0;r<n.length;r++){let i=n[r];t[i]=e[i].toArray()}return t}e.toArrays=v;function y(e){let t=vx.create(),{_columns:n,_rowCount:r}=e,i=1;vx.write(t,`|`);for(let e=0;e<n.length;e++)vx.write(t,n[e]),vx.write(t,`|`),i+=n[e].length+1;vx.newline(t),vx.write(t,Array(i+1).join(`-`)),vx.newline(t);for(let i=0;i<r;i++){vx.write(t,`|`);for(let r=0;r<n.length;r++){let a=e[n[r]];a.valueKind(i)===U.ValueKinds.Present?(vx.write(t,a.value(i)),vx.write(t,`|`)):vx.write(t,`.|`)}vx.newline(t)}return vx.getString(t)}e.formatToString=y})(QD||={});var jhe;(function(e){function t(e,t,n){let r=Object.keys(n),i=Object.create(null),a=[];i._name=e,i._tableNames=a,i._schema=t;for(let e of r)QD.is(n[e])&&(i[e]=n[e],a[a.length]=e);return i}e.ofTables=t;function n(e){let t={};for(let n of e._tableNames)t[n]=QD.getRows(e[n]);return t}e.getTablesAsRows=n})(jhe||={});function $D(e){return function(t){return eO(e,t)}}function eO(e,t){let{data:n,indices:r,count:i}=e,{valueType:a}=t,o=a===`str`?e=>n.substring(r[2*e],r[2*e+1]):a===`int`?e=>HD(n,r[2*e],r[2*e+1])||0:e=>UD(n,r[2*e],r[2*e+1])||0;return{schema:t,__array:void 0,isDefined:!0,rowCount:i,value:o,valueKind:e=>U.ValueKinds.Present,toArray:e=>LD(i,o,e),areValuesEqual:Mhe(e)}}function Mhe(e){let{data:t,indices:n}=e;return function(e,r){let i=n[2*e],a=n[2*r],o=n[2*e+1]-i;if(o!==n[2*r+1]-a)return!1;for(let e=0;e<o;e++)if(t.charCodeAt(e+i)!==t.charCodeAt(e+a))return!1;return!0}}function Nhe(e){let{count:t,indices:n}=e;for(let e=0;e<t;++e)if(n[2*e]!==n[2*e+1])return!1;return!0}function Phe(e,t){return{name:t,blocks:e}}function tO(e,t,n,r=[]){return{categoryNames:e,header:n,categories:t,saveFrames:r,getField(e){let[n,r]=e.split(`.`);return t[n].getField(r||``)}}}function Fhe(e,t,n){return{categoryNames:e,header:n,categories:t}}function nO(e,t,n,r){return{rowCount:t,name:e,fieldNames:[...n],getField(e){return r[e]}}}(function(e){function t(e){return{rowCount:0,name:e,fieldNames:[],getField(e){}}}e.empty=t;function n(e,t){let n=Object.keys(t);return{rowCount:n.length>0?t[n[0]].rowCount:0,name:e,fieldNames:n,getField(e){return t[e]}}}e.ofFields=n;function r(e,t){let r={};for(let e of t._columns)r[e]=rO.ofColumn(t[e]);return n(e,r)}e.ofTable=r})(nO||={});var rO;(function(e){function t(e){return n([e])}e.ofString=t;function n(e){let t=e.length,n=t=>{let n=e[t];return!n||n===`.`||n===`?`?``:n},r=t=>{let n=e[t];return HD(n,0,n.length)||0},i=t=>{let n=e[t];return UD(n,0,n.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:i,valueKind:t=>{let n=e[t],r=n.length;if(r>1)return U.ValueKinds.Present;if(r===0)return U.ValueKinds.NotPresent;let i=n.charCodeAt(0);return i===46?U.ValueKinds.NotPresent:i===63?U.ValueKinds.Unknown:U.ValueKinds.Present},areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:r=>r?LD(t,n,r):e,toIntArray:e=>LD(t,r,e),toFloatArray:e=>LD(t,i,e)}}e.ofStrings=n;function r(e){let t=e.length,n=t=>``+e[t],r=t=>e[t],i=e=>U.ValueKinds.Present,a=n=>!n||n.array&&e instanceof n.array?e:LD(t,r,n);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:r,valueKind:i,areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:e=>LD(t,n,e),toIntArray:a,toFloatArray:a}}e.ofNumbers=r;function i(e){let{data:t,indices:n,count:r}=e,i=e=>{let r=t.substring(n[2*e],n[2*e+1]);return r===`.`||r===`?`?``:r},a=e=>HD(t,n[2*e],n[2*e+1])||0,o=e=>UD(t,n[2*e],n[2*e+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:i,int:a,float:o,valueKind:e=>{let r=n[2*e],i=n[2*e+1]-r;if(i>1)return U.ValueKinds.Present;if(i===0)return U.ValueKinds.NotPresent;let a=t.charCodeAt(r);return a===46?U.ValueKinds.NotPresent:a===63?U.ValueKinds.Unknown:U.ValueKinds.Present},areValuesEqual:Mhe(e),toStringArray:e=>LD(r,i,e),toIntArray:e=>LD(r,a,e),toFloatArray:e=>LD(r,o,e)}}e.ofTokens=i;function a(e){let{rowCount:t,valueKind:n,areValuesEqual:r,isDefined:i}=e,a,o,s;switch(e.schema.valueType){case`float`:case`int`:a=t=>``+e.value(t),o=e.value,s=e.value;break;case`str`:a=e.value,o=t=>{let n=e.value(t);return HD(n,0,n.length)||0},s=t=>{let n=e.value(t);return UD(n,0,n.length)||0};break;case`list`:let{separator:t}=e.schema;a=n=>e.value(n).join(t),o=e=>NaN,s=e=>NaN;break;default:throw Error(`unsupported valueType '${e.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:i,rowCount:t,str:a,int:o,float:s,valueKind:n,areValuesEqual:r,toStringArray:e=>LD(t,a,e),toIntArray:e=>LD(t,o,e),toFloatArray:e=>LD(t,s,e)}}e.ofColumn=a;function o(e,t){return a(U.Undefined(e,t))}e.ofUndefined=o})(rO||={});function Ihe(e,t,n,r){let i=n?0:1;switch(t){case 1:return r===`brackets`?t=>`${e}[${t+i}]`:t=>`${e}_${t+i}`;case 2:return r===`brackets`?(t,n)=>`${e}[${t+i}][${n+i}]`:(t,n)=>`${e}_${t+i}${n+i}`;case 3:return r===`brackets`?(t,n,r)=>`${e}[${t+i}][${n+i}][${r+i}]`:(t,n,r)=>`${e}_${t+i}${n+i}${r+i}`;default:throw Error(`Tensors with rank > 3 or rank 0 are currently not supported.`)}}function Lhe(e,t,n,r){let i=t.create();if(t.rank===1){let a=t.dimensions[0];for(let o=0;o<a;o++){let a=e.getField(r(o));t.set(i,o,a?a.float(n):0)}}else if(t.rank===2){let a=t.dimensions[0],o=t.dimensions[1];for(let s=0;s<a;s++)for(let a=0;a<o;a++){let o=e.getField(r(s,a));t.set(i,s,a,o?o.float(n):0)}}else if(t.rank===3){let a=t.dimensions[0],o=t.dimensions[1],s=t.dimensions[2];for(let c=0;c<a;c++)for(let a=0;a<o;a++)for(let o=0;o<s;o++){let s=e.getField(r(c,a,o));t.set(i,c,a,o,s?s.float(n):0)}}else throw Error(`Tensors with rank > 3 or rank 0 are currently not supported.`);return i}function iO(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(e){return e.data.substring(e.tokenStart,e.tokenEnd)}e.getTokenString=t;function n(e){e.position=0,e.lineNumber=1,e.tokenStart=0,e.tokenEnd=0}e.reset=n;function r(e){let{data:t}=e;for(;e.position<e.length;)switch(t.charCodeAt(e.position)){case 10:return e.tokenEnd=e.position,++e.position,++e.lineNumber,!0;case 13:return e.tokenEnd=e.position,++e.position,++e.lineNumber,t.charCodeAt(e.position)===10&&++e.position,!0;default:++e.position;break}return e.tokenEnd=e.position,e.tokenStart!==e.tokenEnd}e.eatLine=r;function i(e){e.tokenStart=e.position}e.markStart=i;function a(e){return e.tokenStart=e.position,r(e)}e.markLine=a;function o(e){return a(e),t(e)}e.readLine=o;function s(e){a(e);let n=e.position;return v(e,e.tokenStart,e.tokenEnd),e.position=n,t(e)}e.readLineTrim=s;function c(e,t,n){let r=0;for(let i=0;i<t;i++){if(!a(e))return r;aO.addUnchecked(n,e.tokenStart,e.tokenEnd),r++}return r}function l(e,t){let n=aO.create(e.data,t*2);return c(e,t,n),n}e.markLines=l;function u(t,n){let r=[];for(let i=0;i<n;i++)r.push(e.readLine(t));return r}e.readLines=u;async function d(e,t,n,r=1e5){let i=aO.create(e.data,t*2),a=0;return await gb(n,r,e,(e,n)=>{let r=Math.min(t-a,e);return c(n,r,i),a+=r,r},(e,t)=>e.update({message:`Parsing...`,current:t.position,max:t.length})),i}e.readLinesAsync=d;function f(t){let n=e(t),r=aO.create(n.data,Math.max(t.length/80,2));for(;a(n);)aO.add(r,n.tokenStart,n.tokenEnd);return r}e.readAllLines=f;function p(e,t,n){let r=0;for(let i=0;i<t;i++){if(!a(e))return r;aO.add(n,e.tokenStart,e.tokenEnd),r++}return r}async function m(t,n,r=1e5){let i=e(t),a=aO.create(i.data,Math.max(t.length/80,2));return await gb(n,r,i,(e,t)=>(p(t,e,a),t.position<t.length?e:0),(e,t)=>e.update({message:`Parsing...`,current:t.position,max:t.length})),a}e.readAllLinesAsync=m;function h(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}e.eatValue=h;function g(e){let t=-1;for(;e.position<e.length;){let n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:t!==13&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}e.skipWhitespace=g;function _(e){let t=-1;for(;e.position<e.length;){let n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;default:return t}}return t}e.skipStrictWhitespace=_;function v(e,t,n){let{data:r}=e,i=t,a=n-1,o=r.charCodeAt(i);for(;(o===9||o===32)&&i<=a;)o=r.charCodeAt(++i);for(o=r.charCodeAt(a);(o===9||o===32)&&a>=i;)o=r.charCodeAt(--a);return e.tokenStart=i,e.tokenEnd=a+1,e.position=n,e}e.trim=v})(iO||={});function Rhe(e,t,n){let r=t,i=n-1,a=e.charCodeAt(r);for(;(a===9||a===32)&&r<=i;)a=e.charCodeAt(++r);for(a=e.charCodeAt(i);(a===9||a===32)&&i>=r;)a=e.charCodeAt(--i);return e.substring(r,i+1)}var aO;(function(e){function t(e){let t=new Uint32Array(1.61*e.indices.length|0);t.set(e.indices),e.indices=t,e.indicesLenMinus2=t.length-2|0}function n(e,n,r){let i=e;i.offset>i.indicesLenMinus2&&t(i),i.indices[i.offset++]=n,i.indices[i.offset++]=r,e.count++}e.add=n;function r(e,t){n(e,t.tokenStart,t.tokenEnd)}e.addToken=r;function i(e,t,n){e.indices[e.offset++]=t,e.indices[e.offset++]=n,e.count++}e.addUnchecked=i;function a(e,t){return t=Math.max(10,t),{data:e,indicesLenMinus2:t-2|0,count:0,offset:0,indices:new Uint32Array(t)}}e.create=a})(aO||={});var oO;(function(e){e[e.Data=0]=`Data`,e[e.Save=1]=`Save`,e[e.Loop=2]=`Loop`,e[e.Value=3]=`Value`,e[e.ColumnName=4]=`ColumnName`,e[e.Comment=5]=`Comment`,e[e.End=6]=`End`})(oO||={});function zhe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function Bhe(e,t){let n,r;for(++e.position;e.position<e.length;)if(r=e.data.charCodeAt(e.position),r===t)switch(n=e.data.charCodeAt(e.position+1),n){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(!Number.isFinite(n)){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(r===10||r===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function Vhe(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&Khe(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function Hhe(e){let t=59,n=e.position+1,r;for(;n<e.length;)if(r=e.data.charCodeAt(n),r===59&&(t===10||t===13)){for(e.position=n+1,e.tokenStart++,n--,r=e.data.charCodeAt(n);r===10||r===13;)n--,r=e.data.charCodeAt(n);e.tokenEnd=n+1,e.isEscaped=!0;return}else (r===13||r===10&&t!==13)&&e.lineNumber++,t=r,++n;return e.position=n,t}function Uhe(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function Whe(e){for(;e.position<e.length;){let t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function Ghe(e){let t=10;for(;e.position<e.length;){let n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:t!==13&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}function Khe(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function qhe(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function Jhe(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function Yhe(e){if(e.tokenEnd-e.tokenStart!==5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function Xhe(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function Zhe(e,t,n){let r,i=n-t,a=e.tokenStart-t,o=e.tokenEnd-e.tokenStart;if(o<i)return!1;for(r=t;r<n;++r)if(e.data.charCodeAt(r)!==e.data.charCodeAt(r+a))return!1;return i===o||e.data.charCodeAt(r+a)===46}function Qhe(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function $he(e,t){return e.data.substring(e.tokenStart,t)}function ege(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function sO(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function tge(e){let t=Ghe(e);if(e.position>=e.length){e.tokenType=oO.End;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;let n=e.data.charCodeAt(e.position);switch(n){case 35:Whe(e),e.tokenType=oO.Comment;break;case 39:if(Khe(e)){Vhe(e),e.tokenType=oO.Value;break}case 34:Bhe(e,n),e.tokenType=oO.Value;break;case 59:t===10||t===13?Hhe(e):zhe(e),e.tokenType=oO.Value;break;default:e.isImportGet?Uhe(e):zhe(e),e.isEscaped?e.tokenType=oO.Value:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&Xhe(e)&&(e.isImportGet=!0),e.tokenType=oO.ColumnName):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?qhe(e)?e.tokenType=oO.Data:Jhe(e)?e.tokenType=oO.Save:Yhe(e)?e.tokenType=oO.Loop:e.tokenType=oO.Value:e.tokenType=oO.Value;break}}function cO(e){for(tge(e);e.tokenType===oO.Comment;)tge(e)}function nge(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:oO.End,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function lO(){return{categoryNames:[],categoryData:Object.create(null)}}function uO(e,t){let n=Object.create(null);for(let r of e){let e=t[r];n[r]=nO(e.name,e.rowCount,e.fieldNames,e.fields)}return n}function rge(e,t,n){return tO(e.categoryNames,uO(e.categoryNames,e.categoryData),t,n)}function ige(e,t){return tO(e.categoryNames,uO(e.categoryNames,e.categoryData),t)}function dO(e,t,n,r,i){if(t in e.categoryData){let n=e.categoryData[t];n.fieldNames.push(...r),Object.assign(n.fields,i)}else e.categoryData[t]={name:t,rowCount:n,fieldNames:r,fields:i},e.categoryNames.push(t)}function age(e,t){let n=e.tokenStart,r=Qhe(e),i=$he(e,r),a=Object.create(null),o=[],s=!0;for(;s;){if(e.tokenType!==oO.ColumnName||!Zhe(e,n,r)){s=!1;break}let t=sO(e).substring(i.length+1);if(cO(e),e.tokenType!==oO.Value)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`Expected value.`};a[t]=rO.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),o[o.length]=t,cO(e)}return dO(t,i.substr(1),1,o,a),{hasError:!1,errorLine:0,errorMessage:``}}function oge(e,t){let{tokenizer:n,tokens:r,fieldCount:i}=t,a=t.tokenCount,o=0;for(;n.tokenType===oO.Value&&o<e;)aO.add(r[a++%i],n.tokenStart,n.tokenEnd),cO(n),o++;return t.tokenCount=a,o}function sge(e,t){return e.update({message:`Parsing...`,current:t.tokenizer.position,max:t.tokenizer.data.length})}async function cge(e,t){let n=e.lineNumber;cO(e);let r=$he(e,Qhe(e)),i=ege(e),a=[];for(;e.tokenType===oO.ColumnName;)a[a.length]=i?sO(e):sO(e).substring(r.length+1),cO(e);let o=r===`_atom_site`?e.data.length/100|0:32,s=[],c=a.length;for(let t=0;t<c;t++)s[t]=aO.create(e.data,o);let l={fieldCount:c,tokenCount:0,tokenizer:e,tokens:s};if(await gb(e.runtimeCtx,1e6,l,oge,sge),l.tokenCount%c!==0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`};let u=l.tokenCount/c|0;if(i)for(let e=0;e<c;e++){let n={"":rO.ofTokens(s[e])};dO(t,a[e].substr(1),u,[``],n)}else{let e=Object.create(null);for(let t=0;t<c;t++)e[a[t]]=rO.ofTokens(s[t]);dO(t,r.substr(1),u,a,e)}return{hasError:!1,errorLine:0,errorMessage:``}}function fO(e,t){return jD.error(t,e)}function lge(e){return jD.success(e)}async function uge(e,t){let n=[],r=nge(e,t),i=``,a=lO(),o=[],s=lO(),c=Fhe(s.categoryNames,uO(s.categoryNames,s.categoryData),``),l=``;for(t.update({message:`Parsing...`,current:0,max:e.length}),cO(r);r.tokenType!==oO.End;){let t=r.tokenType;if(t===oO.Data){if(r.inSaveFrame)return fO(r.lineNumber,`Unexpected data block inside a save frame.`);a.categoryNames.length>0&&n.push(rge(a,i,o)),i=e.substring(r.tokenStart+5,r.tokenEnd),a=lO(),o=[],cO(r)}else if(t===oO.Save){if(r.tokenEnd-r.tokenStart===5)s.categoryNames.length>0&&(o[o.length]=ige(s,l)),r.inSaveFrame=!1;else{if(r.inSaveFrame)return fO(r.lineNumber,`Save frames cannot be nested.`);r.inSaveFrame=!0,l=e.substring(r.tokenStart+5,r.tokenEnd),s=lO()}cO(r)}else if(t===oO.Loop){let e=await cge(r,r.inSaveFrame?s:a);if(e.hasError)return fO(e.errorLine,e.errorMessage)}else if(t===oO.ColumnName){let e=age(r,r.inSaveFrame?s:a);if(e.hasError)return fO(e.errorLine,e.errorMessage)}else return console.log(r.tokenType,iO.getTokenString(r)),fO(r.lineNumber,`Unexpected token. Expected data_, loop_, or data name.`)}return r.inSaveFrame?fO(r.lineNumber,`Unfinished save frame (${c.header}).`):((a.categoryNames.length>0||o.length>0)&&n.push(rge(a,i,o)),lge(Phe(n)))}function dge(e){return hb.create(`Parse CIF`,async t=>await uge(e,t))}var pO;(function(e){(function(e){e[e.Int8=1]=`Int8`,e[e.Int16=2]=`Int16`,e[e.Int32=3]=`Int32`,e[e.Uint8=4]=`Uint8`,e[e.Uint16=5]=`Uint16`,e[e.Uint32=6]=`Uint32`})(e.IntDataType||={}),(function(e){e[e.Float32=32]=`Float32`,e[e.Float64=33]=`Float64`})(e.FloatDataType||={});function t(t){let n;return n=t instanceof Int8Array?e.IntDataType.Int8:t instanceof Int16Array?e.IntDataType.Int16:t instanceof Int32Array?e.IntDataType.Int32:t instanceof Uint8Array?e.IntDataType.Uint8:t instanceof Uint16Array?e.IntDataType.Uint16:t instanceof Uint32Array?e.IntDataType.Uint32:t instanceof Float32Array?e.FloatDataType.Float32:t instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32,n}e.getDataType=t;function n(e){if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array)return!0;for(let t=0,n=e.length;t<n;t++)if(t<0)return!1;return!0}e.isSignedIntegerDataType=n})(pO||={});const fge=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function pge(e,t){let n=new ArrayBuffer(e.length),r=new Uint8Array(n);for(let n=0,i=e.length;n<i;n+=t)for(let i=0;i<t;i++)r[n+t-i-1]=e[n+i];return n}var mO=28672;function mge(e){if(e.length>mO){let t=[];for(let n=0;n<e.length;n+=mO)t.push(String.fromCharCode.apply(null,e.subarray(n,n+mO)));return t.join(``)}else return String.fromCharCode.apply(null,e)}function hO(e){let t=e.data;for(let n=e.encoding.length-1;n>=0;n--)t=hge(t,e.encoding[n]);return t}function hge(e,t){switch(t.kind){case`ByteArray`:switch(t.type){case pO.IntDataType.Uint8:return e;case pO.IntDataType.Int8:return vge(e);case pO.IntDataType.Int16:return yge(e);case pO.IntDataType.Uint16:return bge(e);case pO.IntDataType.Int32:return xge(e);case pO.IntDataType.Uint32:return Sge(e);case pO.FloatDataType.Float32:return Cge(e);case pO.FloatDataType.Float64:return wge(e);default:Lb(t.type)}case`FixedPoint`:return Tge(e,t);case`IntervalQuantization`:return Ege(e,t);case`RunLength`:return Dge(e,t);case`Delta`:return Oge(e,t);case`IntegerPacking`:return jge(e,t);case`StringArray`:return Mge(e,t)}}function gge(e,t){switch(e){case pO.IntDataType.Int8:return new Int8Array(t);case pO.IntDataType.Int16:return new Int16Array(t);case pO.IntDataType.Int32:return new Int32Array(t);case pO.IntDataType.Uint8:return new Uint8Array(t);case pO.IntDataType.Uint16:return new Uint16Array(t);case pO.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function _ge(e,t){switch(e){case pO.FloatDataType.Float32:return new Float32Array(t);case pO.FloatDataType.Float64:return new Float64Array(t);default:return new Float64Array(t)}}function vge(e){return new Int8Array(e.buffer,e.byteOffset)}function gO(e,t,n){return fge?new n(e.buffer):new n(pge(e,t))}function yge(e){return gO(e,2,Int16Array)}function bge(e){return gO(e,2,Uint16Array)}function xge(e){return gO(e,4,Int32Array)}function Sge(e){return gO(e,4,Uint32Array)}function Cge(e){return gO(e,4,Float32Array)}function wge(e){return gO(e,8,Float64Array)}function Tge(e,t){let n=e.length,r=_ge(t.srcType,n),i=1/t.factor;for(let t=0;t<n;t++)r[t]=i*e[t];return r}function Ege(e,t){let n=e.length,r=_ge(t.srcType,n),i=(t.max-t.min)/(t.numSteps-1),a=t.min;for(let t=0;t<n;t++)r[t]=a+i*e[t];return r}function Dge(e,t){let n=gge(t.srcType,t.srcSize),r=0;for(let t=0,i=e.length;t<i;t+=2){let i=e[t],a=e[t+1];for(let e=0;e<a;++e)n[r++]=i}return n}function Oge(e,t){let n=e.length,r=gge(t.srcType,n);if(!n)return e;r[0]=e[0]+(t.origin|0);for(let t=1;t<n;++t)r[t]=e[t]+r[t-1];return r}function kge(e,t){let n=t.byteCount===1?127:32767,r=-n-1,i=e.length,a=new Int32Array(t.srcSize),o=0,s=0;for(;o<i;){let t=0,i=e[o];for(;i===n||i===r;)t+=i,o++,i=e[o];t+=i,a[s]=t,o++,s++}return a}function Age(e,t){let n=t.byteCount===1?255:65535,r=e.length,i=new Int32Array(t.srcSize),a=0,o=0;for(;a<r;){let t=0,r=e[a];for(;r===n;)t+=r,a++,r=e[a];t+=r,i[o]=t,a++,o++}return i}function jge(e,t){return e.length===t.srcSize?e:t.isUnsigned?Age(e,t):kge(e,t)}function Mge(e,t){let n=hO({encoding:t.offsetEncoding,data:t.offsets}),r=hO({encoding:t.dataEncoding,data:e}),i=t.stringData,a=Array(n.length);a[0]=``;for(let e=1,t=n.length;e<t;e++)a[e]=i.substring(n[e-1],n[e]);let o=0,s=Array(r.length);for(let e=0,t=r.length;e<t;e++)s[o++]=a[r[e]+1];return s}var _O;(function(e){function t(e){return e.creator&&e.chunkSize}e.is=t;function n(e){let t=e.growBy*e.elementSize;e.currentSize=t,e.currentIndex=0,e.currentChunk=new e.ctor(t),e.allocatedSize+=t,e.chunks[e.chunks.length]=e.currentChunk}function r(e,t,r,i,a){e.currentIndex>=e.currentSize&&n(e);let o=e.currentChunk,s=e.currentIndex;return o[s]=t,o[s+1]=r,o[s+2]=i,o[s+3]=a,e.currentIndex+=4,e.elementCount++}e.add4=r;function i(e,t,r,i){e.currentIndex>=e.currentSize&&n(e);let a=e.currentChunk,o=e.currentIndex;return a[o]=t,a[o+1]=r,a[o+2]=i,e.currentIndex+=3,e.elementCount++}e.add3=i;function a(e,t,r){e.currentIndex>=e.currentSize&&n(e);let i=e.currentChunk,a=e.currentIndex;return i[a]=t,i[a+1]=r,e.currentIndex+=2,e.elementCount++}e.add2=a;function o(e,t){return e.currentIndex>=e.currentSize&&n(e),e.currentChunk[e.currentIndex]=t,e.currentIndex+=1,e.elementCount++}e.add=o;function s(e,t,r){for(let i=0;i<t;i++)e.currentIndex>=e.currentSize&&n(e),e.currentChunk[e.currentIndex++]=r,e.elementCount++;return e.elementCount}e.addRepeat=s;function c(e,t){let{elementSize:r}=e;for(let i=0,a=t.length;i<a;i+=r){e.currentIndex>=e.currentSize&&n(e);let{currentChunk:a}=e;for(let n=0;n<r;n++)a[e.currentIndex++]=t[i+n];e.elementCount++}return e.elementCount}e.addMany=c;function l(e,t=!1){return u(e,t)}e.compact=l;function u(e,t){let{ctor:n,chunks:r,currentIndex:i}=e;if(!r.length)return new n(0);if(r.length===1&&(t||i===e.allocatedSize))return r[0];let a=0;for(let e=0,t=r.length-1;e<t;e++)a+=r[e].length;a+=e.currentIndex;let o=new n(a),s=0;if(o.buffer)for(let e=0,t=r.length-1;e<t;e++)o.set(r[e],s),s+=r[e].length;else for(let e=0,t=r.length-1;e<t;e++){let t=r[e];for(let e=0,n=t.length;e<n;e++)o[s+e]=t[e];s+=t.length}let c=r[r.length-1];if(o.buffer&&i>=e.currentSize)o.set(c,s);else for(let e=0,t=c.length;e<t;e++)o[s+e]=c[e];return o}e._compact=u;function d(e,t,n,r){let i={ctor:e,elementSize:t,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(r===void 0)return i;if(typeof r==`number`)return i.currentChunk=new e(r*t),i.allocatedSize=r*t,i.currentSize=i.currentChunk.length,i.chunks[0]=i.currentChunk,i;let a=r;if(a.length%t!==0)throw Error(`initialChunk length must be a multiple of the element size.`);return i.currentChunk=a,i.allocatedSize=a.length,i.currentSize=a.length,i.chunks[0]=a,i}e.create=d})(_O||={});function Nge(e,t,n){return e[t].key<e[n].key?-1:1}function Pge(e,t,n,r,i){let a=new Map,o=[],s=t(e[0]),c=!0;for(let n=r;n<i;n++){let r=t(e[n]);if(a.has(r))a.get(r).count++,s!==r&&(c=!1);else{let e={key:r,count:1,offset:n};a.set(r,e),o[o.length]=e}s=r}let l=new Int32Array(o.length+1);l[o.length]=i;let u=!0;if(n){for(let e=1,t=o.length;e<t;e++)if(o[e-1].key>o[e].key){u=!1;break}}if(c&&u){for(let e=0;e<o.length;e++)l[e]=o[e].offset;return l}n&&!u&&Ahe(o,0,o.length,Nge,JD);let d=0;for(let e=0;e<o.length;e++){let t=o[e];t.offset=d,d+=t.count}let f=new Int32Array(i-r);for(let n=r;n<i;n++){let r=t(e[n]),i=a.get(r);f[i.offset++]=e[n]}for(let t=0,n=f.length;t<n;t++)e[t+r]=f[t];l[0]=r;for(let e=1;e<o.length;e++)l[e]=o[e-1].offset+r;return l}function vO(e,t,n){let r=n&&n.start||0,i=n&&n.end||e.length;if(i-r<=0)throw Error(`Can only bucket non-empty collections.`);return Pge(e,t,!!(n&&n.sort),r,i)}var Fge=class{createGroup(e,t){let n=this.id++,r=[e];return this.groups[n]=r,{id:n,keys:r,value:t}}add(e,t){let n=this.getHash(t);if(this.byHash.has(n)){let r=this.byHash.get(n);for(let n=0,i=r.length;n<i;n++){let i=r[n];if(this.areEqual(t,i.value))return i.keys[i.keys.length]=e,i.value}let i=this.createGroup(e,t);return r[r.length]=i,i.value}else{let r=this.createGroup(e,t);return this.byHash.set(n,[r]),r.value}}constructor(e,t){this.getHash=e,this.areEqual=t,this.id=0,this.byHash=new Map,this.groups=[]}};function Ige(e,t){return new Fge(e,t)}function Lge(e,t,n){let r=1,i;for(i=0;i<t;i++){let t=r*e;if(Math.abs(Math.round(t)-t)<=n)return i;r*=10}return-1}function Rge(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function zge(e,t,n){let r=1,i=0;for(let a=0,o=e.length;a<o;a++){if(r>=0){let i=Lge(e[a],t,n);i<0?r=-1:i>r&&(r=i)}let o=Math.abs(e[a]);if(o>n){let e=Math.floor(Math.log10(Math.abs(o)))+1;e>i&&(i=e)}}return{mantissaDigits:r,integerDigits:i}}function Bge(e){e=e.trim();let t=parseInt(e,10);return Number.isNaN(t)?!1:t.toString()===e}function yO(e){if(!isFinite(e))return 0;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,++n;return n}function bO(e,t){return parseFloat(e.toPrecision(t))}function Vge(e,t){return parseFloat(e.toFixed(t))}function xO(e){return SO.classify(e)}function Hge(e){return Uge.classify(e)}var SO;(function(e){function t(e,t){return e>=0?Math.ceil((e+1)/t):Math.ceil((e+1)/(-t-1))}function n(e){let t=!1;for(let n=0,r=e.length;n<r;n++)if(e[n]<0){t=!0;break}return t?{signed:t,limit8:127,limit16:32767}:{signed:t,limit8:255,limit16:65535}}function r(){return{pack8:0,pack16:0,count:0}}function i({limit8:e,limit16:n},r,i){r.pack8+=t(i,e),r.pack16+=t(i,n),r.count+=1}function a(e,n){e.pack8+=t(n,127),e.pack16+=t(n,32767),e.count+=1}function o(e){return e.count*4<e.pack16*2?{length:e.count*4,elem:4}:e.pack16*2<e.pack8?{length:e.pack16*2,elem:2}:{length:e.pack8,elem:1}}function s(e,t){let n=r();for(let r=0,a=e.length;r<a;r++)i(t,n,e[r]);return{...o(n),kind:`pack`}}function c(e,t){let n=r(),i=e[0];for(let t=1,r=e.length;t<r;t++)a(n,e[t]-i),i=e[t];return{...o(n),kind:`delta`}}function l(e,t){let n=r(),a=1;for(let r=1,o=e.length;r<o;r++)e[r-1]===e[r]?a++:(i(t,n,e[r-1]),i(t,n,a),a=1);return i(t,n,e[e.length-1]),i(t,n,a),{...o(n),kind:`rle`}}function u(e,t){let n=r(),i=1,s=0,c=0;for(let t=1,r=e.length;t<r;t++){let r=e[t]-s;c===r?i++:(a(n,c),a(n,i),i=1),c=r,s=e[t]}return a(n,c),a(n,i),{...o(n),kind:`delta-rle`}}function d(e){let t=n(e),r=[s(e,t),l(e,t),c(e,t),u(e,t)];return r.sort((e,t)=>e.length-t.length),r}e.getSize=d;function f(e){if(e.length<2)return wO.by(wO.byteArray);let t=d(e)[0];switch(t.kind){case`pack`:return wO.by(wO.integerPacking);case`rle`:return wO.by(wO.runLength).and(wO.integerPacking);case`delta`:return wO.by(wO.delta).and(wO.integerPacking);case`delta-rle`:return wO.by(wO.delta).and(wO.runLength).and(wO.integerPacking);default:Lb(t)}}e.classify=f})(SO||={});var Uge;(function(e){function t(e){let{mantissaDigits:t,integerDigits:r}=zge(e,4,1e-6);if(t<0||t+r>10)return wO.by(wO.byteArray);if(t===0)return SO.classify(e);let i=n(t),a=new Int32Array(e.length);for(let t=0,n=e.length;t<n;t++)a[t]=Math.round(i*e[t]);let o=SO.getSize(a)[0],s=wO.by(wO.fixedPoint(i));switch(o.kind){case`pack`:return s.and(wO.integerPacking);case`rle`:return s.and(wO.runLength).and(wO.integerPacking);case`delta`:return s.and(wO.delta).and(wO.integerPacking);case`delta-rle`:return s.and(wO.delta).and(wO.runLength).and(wO.integerPacking);default:Lb(o)}}e.classify=t;function n(e){let t=1;for(let n=0;n<e;n++)t*=10;return t}})(Uge||={});var Wge=class e{and(t){return new e(this.providers.concat([t]))}encode(e){let t=[];for(let n of this.providers){let r=n(e);if(!r.encodings.length)throw Error(`Encodings must be non-empty.`);e=r.data;for(let e of r.encodings)t.push(e)}if(!(e instanceof Uint8Array))throw Error(`The encoding must result in a Uint8Array. Fix your encoding chain.`);return{encoding:t,data:e}}constructor(e){this.providers=e}},CO;(function(e){function t(e){return new Wge([e])}e.by=t;function n(e){let n=t(r(e[0]));for(let t=1;t<e.length&&e[t-1].kind!==`IntegerPacking`;t++)n=n.and(r(e[t]));return n}e.fromEncoding=n;function r(e){switch(e.kind){case`ByteArray`:return wO.byteArray;case`FixedPoint`:return wO.fixedPoint(e.factor);case`IntervalQuantization`:return wO.intervalQuantizaiton(e.min,e.max,e.numSteps);case`RunLength`:return wO.runLength;case`Delta`:return wO.delta;case`IntegerPacking`:return wO.integerPacking;case`StringArray`:return wO.stringArray}}})(CO||={});var wO;(function(e){function t(e){return new Wge([e])}e.by=t;function n(e){return{encodings:[{kind:`ByteArray`,type:pO.IntDataType.Uint8}],data:e}}function r(e){return{encodings:[{kind:`ByteArray`,type:pO.IntDataType.Int8}],data:new Uint8Array(e.buffer,e.byteOffset)}}let i={[pO.IntDataType.Int16]:function(e,t,n){e.setInt16(2*t,n,!0)},[pO.IntDataType.Uint16]:function(e,t,n){e.setUint16(2*t,n,!0)},[pO.IntDataType.Int32]:function(e,t,n){e.setInt32(4*t,n,!0)},[pO.IntDataType.Uint32]:function(e,t,n){e.setUint32(4*t,n,!0)},[pO.FloatDataType.Float32]:function(e,t,n){e.setFloat32(4*t,n,!0)},[pO.FloatDataType.Float64]:function(e,t,n){e.setFloat64(8*t,n,!0)}},a={[pO.IntDataType.Int16]:2,[pO.IntDataType.Uint16]:2,[pO.IntDataType.Int32]:4,[pO.IntDataType.Uint32]:4,[pO.FloatDataType.Float32]:4,[pO.FloatDataType.Float64]:8};function o(e){let t=pO.getDataType(e);if(t===pO.IntDataType.Int8)return r(e);if(t===pO.IntDataType.Uint8)return n(e);let o=new Uint8Array(e.length*a[t]),s=i[t],c=new DataView(o.buffer);for(let t=0,n=e.length;t<n;t++)s(c,t,e[t]);return{encodings:[{kind:`ByteArray`,type:t}],data:o}}e.byteArray=o;function s(e,t){let n=pO.getDataType(e),r=new Int32Array(e.length);for(let n=0,i=e.length;n<i;n++)r[n]=Math.round(e[n]*t);return{encodings:[{kind:`FixedPoint`,factor:t,srcType:n}],data:r}}function c(e){return t=>s(t,e)}e.fixedPoint=c;function l(e,t,n,r,i){let a=pO.getDataType(e);if(!e.length)return{encodings:[{kind:`IntervalQuantization`,min:t,max:n,numSteps:r,srcType:a}],data:new Int32Array};if(n<t){let e=t;t=n,n=e}let o=(n-t)/(r-1),s=new i(e.length);for(let i=0,a=e.length;i<a;i++){let a=e[i];a<=t?s[i]=0:a>=n?s[i]=r-1:s[i]=Math.round((a-t)/o)|0}return{encodings:[{kind:`IntervalQuantization`,min:t,max:n,numSteps:r,srcType:a}],data:s}}function u(e,t,n,r=Int32Array){return i=>l(i,e,t,n,r)}e.intervalQuantizaiton=u;function d(e){let t=pO.getDataType(e);if(t===void 0&&(e=new Int32Array(e),t=pO.IntDataType.Int32),!e.length)return{encodings:[{kind:`RunLength`,srcType:t,srcSize:0}],data:new Int32Array};let n=2;for(let t=1,r=e.length;t<r;t++)e[t-1]!==e[t]&&(n+=2);let r=new Int32Array(n),i=0,a=1;for(let t=1,n=e.length;t<n;t++)e[t-1]===e[t]?++a:(r[i]=e[t-1],r[i+1]=a,a=1,i+=2);return r[i]=e[e.length-1],r[i+1]=a,{encodings:[{kind:`RunLength`,srcType:t,srcSize:e.length}],data:r}}e.runLength=d;function f(e){if(!pO.isSignedIntegerDataType(e))throw Error(`Only signed integer types can be encoded using delta encoding.`);let t=pO.getDataType(e);if(t===void 0&&(e=new Int32Array(e),t=pO.IntDataType.Int32),!e.length)return{encodings:[{kind:`Delta`,origin:0,srcType:t}],data:new e.constructor(0)};let n=new e.constructor(e.length),r=e[0];n[0]=e[0];for(let t=1,r=e.length;t<r;t++)n[t]=e[t]-e[t-1];return n[0]=0,{encodings:[{kind:`Delta`,origin:r,srcType:t}],data:n}}e.delta=f;function p(e){for(let t=0,n=e.length;t<n;t++)if(e[t]<0)return!0;return!1}function m(e,t){let n=0;for(let r=0,i=e.length;r<i;r++)n+=e[r]/t|0;return n+=e.length,n}function h(e,t){let n=-t-1,r=0;for(let i=0,a=e.length;i<a;i++){let a=e[i];a>=0?r+=a/t|0:r+=a/n|0}return r+=e.length,r}function g(e){let t=p(e),n=t?h(e,127):m(e,255),r=t?h(e,32767):m(e,65535);return e.length*4<r*2?{isSigned:t,size:e.length,bytesPerElement:4}:r*2<n?{isSigned:t,size:r,bytesPerElement:2}:{isSigned:t,size:n,bytesPerElement:1}}function _(e,t){let n=t.isSigned?t.bytesPerElement===1?127:32767:t.bytesPerElement===1?255:65535,r=-n-1,i=e.length,a=t.isSigned?t.bytesPerElement===1?new Int8Array(t.size):new Int16Array(t.size):t.bytesPerElement===1?new Uint8Array(t.size):new Uint16Array(t.size),s=0;for(let t=0;t<i;t++){let i=e[t];if(i>=0)for(;i>=n;)a[s]=n,++s,i-=n;else for(;i<=r;)a[s]=r,++s,i-=r;a[s]=i,++s}let c=o(a);return{encodings:[{kind:`IntegerPacking`,byteCount:t.bytesPerElement,isUnsigned:!t.isSigned,srcSize:i},c.encodings[0]],data:c.data}}function v(e){let t=g(e);return t.bytesPerElement===4?o(e):_(e,t)}e.integerPacking=v;function y(e){let t=Object.create(null),n=[],r=new Int32Array(e.length),i=_O.create(Int32Array,1,Math.min(1024,e.length<32?e.length+1:Math.round(e.length/8)+1));_O.add(i,0);let a=0,o=0;for(let s of e){if(s==null){r[o++]=-1;continue}let e=t[s];e===void 0&&(a+=s.length,e=n.length,n[e]=s,t[s]=e,_O.add(i,a)),r[o++]=e}let s=_O.compact(i),c=xO(s).encode(s),l=xO(r).encode(r);return{encodings:[{kind:`StringArray`,dataEncoding:l.encoding,stringData:n.join(``),offsetEncoding:c.encoding,offsets:c.data}],data:l.data}}e.stringArray=y})(wO||={});function Gge(e){let t=e.mask?hO(e.mask):void 0,n=hO(e.data),r=RD(n),i=r?t?e=>t[e]===U.ValueKinds.Present?``+n[e]:``:e=>``+n[e]:t?e=>t[e]===U.ValueKinds.Present?n[e]:``:e=>n[e],a=r?e=>n[e]:e=>{let t=n[e];return HD(t,0,t.length)},o=r?e=>n[e]:e=>{let t=n[e];return UD(t,0,t.length)},s=t?e=>t[e]:e=>U.ValueKinds.Present,c=n.length;return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:c,str:i,int:a,float:o,valueKind:s,areValuesEqual:(e,t)=>n[e]===n[t],toStringArray:e=>LD(c,i,e),toIntArray:r?e=>zD(n,e):e=>LD(c,a,e),toFloatArray:r?e=>zD(n,e):e=>LD(c,o,e)}}function Kge(e){return kO({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function TO(e,t){let n={};for(let r=0;r<t;r++){let t=kO(e);n[t]=kO(e)}return n}function EO(e,t){let n=new Uint8Array(t),r=e.offset;for(let i=0;i<t;i++)n[i]=e.buffer[i+r];return e.offset+=t,n}function DO(e,t){let n=Ky(e.buffer,e.offset,t);return e.offset+=t,n}function OO(e,t){let n=Array(t);for(let r=0;r<t;r++)n[r]=kO(e);return n}function kO(e){let t=e.buffer[e.offset],n,r;if(!(t&128))return e.offset++,t;if((t&240)==128)return r=t&15,e.offset++,TO(e,r);if((t&240)==144)return r=t&15,e.offset++,OO(e,r);if((t&224)==160)return r=t&31,e.offset++,DO(e,r);if((t&224)==224)return n=e.dataView.getInt8(e.offset),e.offset++,n;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,EO(e,r);case 197:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,EO(e,r);case 198:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,EO(e,r);case 202:return n=e.dataView.getFloat32(e.offset+1),e.offset+=5,n;case 203:return n=e.dataView.getFloat64(e.offset+1),e.offset+=9,n;case 204:return n=e.buffer[e.offset+1],e.offset+=2,n;case 205:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n;case 206:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n;case 208:return n=e.dataView.getInt8(e.offset+1),e.offset+=2,n;case 209:return n=e.dataView.getInt16(e.offset+1),e.offset+=3,n;case 210:return n=e.dataView.getInt32(e.offset+1),e.offset+=5,n;case 217:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,DO(e,r);case 218:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,DO(e,r);case 219:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,DO(e,r);case 220:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,OO(e,r);case 221:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,OO(e,r);case 222:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,TO(e,r);case 223:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,TO(e,r)}throw Error(`Unknown type 0x`+t.toString(16))}function qge(e,t){for(let n=0;n<2;n++)if(e[n]>t[n])return!1;return!0}function Jge(e){let t=Object.create(null),n=Object.create(null);for(let n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substring(1),fieldNames:e.columns.map(e=>e.name),getField(e){let r=t[e];if(r)return n[e]||(n[e]=Gge(r)),n[e]}}}function Yge(e){return hb.create(`Parse BinaryCIF`,async t=>{let n=[0,3];try{let t=Kge(e);if(!qge(n,t.version.match(/(\d)\.(\d)\.\d/).slice(1).map(e=>+e)))return jD.error(`Unsupported format version. Current ${t.version}, required ${n.join(`.`)}.`);let r=Phe(t.dataBlocks.map(e=>{let t=Object.create(null);for(let n of e.categories)t[n.name.substring(1)]=Jge(n);return tO(e.categories.map(e=>e.name.substring(1)),t,e.header)}));return jD.success(r)}catch(e){return jD.error(``+e)}})}function AO(){return AO.zero()}(function(e){function t(){let e=[.1,0,0,0];return e[0]=0,e}e.zero=t;function n(e){let n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}e.clone=n;function r(e,n,r,i){let a=t();return a[0]=e,a[1]=n,a[2]=r,a[3]=i,a}e.create=r;function i(e,t){return e[0]=t.center[0],e[1]=t.center[1],e[2]=t.center[2],e[3]=t.radius,e}e.fromSphere=i;function a(e){return i(t(),e)}e.ofSphere=a;function o(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])||Number.isNaN(e[3])}e.hasNaN=o;function s(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t}e.toArray=s;function c(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e}e.fromArray=c;function l(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]}e.toVec3Array=l;function u(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=0,e}e.fromVec3Array=u;function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}e.copy=d;function f(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}e.set=f;function p(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}e.add=p;function m(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}e.distance=m;function h(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[4]=t[4]*n,e}e.scale=h;function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}e.round=g;function _(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}e.ceil=_;function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}e.floor=v;function y(e,t){let n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}e.squaredDistance=y;function b(e){let t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}e.norm=b;function x(e){let t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}e.squaredNorm=x;function S(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}e.transformMat4=S;function C(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}e.dot=C;function w(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}e.inverse=w;function T(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}e.exactEquals=T;function E(e,t){let n=e[0],r=e[1],i=e[2],a=e[3],o=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=1e-6*Math.max(1,Math.abs(a),Math.abs(l))}e.equals=E;function D(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`}e.toString=D})(AO||={});var jO;(function(e){function t(e){return e.replace(`.`,`_`).replace(/\[/,`_`).replace(/(\[|\])/g,``)}e.canonical=t;function n(e,n){return t(e)===t(n)}e.equal=n;function r(e,n,r=!1){let i=`${e}${n?`.${n}`:``}`;return r?t(i):i}e.create=r})(jO||={});function Xge(e,t,n){let r={};for(let i of t.blocks)r[i.header]=MO(e,i,n);return r}function MO(e,t,n){return i_e(e,t,n)}function Zge(e,t){return new r_e(t,e,!0)}function Qge(e){switch(e.valueType){case`str`:return(t,n,r)=>$ge(e,t,t.str,t.toStringArray);case`int`:return(t,n,r)=>e_e(e,t,t.int,t.toIntArray);case`float`:return(t,n,r)=>e_e(e,t,t.float,t.toFloatArray);case`list`:throw Error(`Use createListColumn instead.`);case`tensor`:throw Error(`Use createTensorColumn instead.`)}}function $ge(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:e.transform===`lowercase`?e=>n(e).toLowerCase():e.transform===`uppercase`?e=>n(e).toUpperCase():n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:e.transform===`lowercase`?e=>Array.from(r(e)).map(e=>e.toLowerCase()):e.transform===`uppercase`?e=>Array.from(r(e)).map(e=>e.toUpperCase()):r}}function e_e(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:r}}function t_e(e,t,n){let r=e.separator,i=e.itemParse,a=t.getField(n),o=a?e=>a.str(e).split(r).map(e=>i(e.trim())).filter(e=>!!e):e=>[];return{schema:e,__array:void 0,isDefined:!!a,rowCount:t.rowCount,value:o,valueKind:a?a.valueKind:()=>U.ValueKinds.NotPresent,areValuesEqual:(e,t)=>Cx(o(e),o(t)),toArray:e=>LD(t.rowCount,o,e)}}function n_e(e,t,n){let r=e.space,i=t.fieldNames.includes(`${n}[0]`)||t.fieldNames.includes(`${n}[0][0]`)||t.fieldNames.includes(`${n}[0][0][0]`),a=i?0:1,o=t.fieldNames.includes(`${n}_1`)||t.fieldNames.includes(`${n}_11`)||t.fieldNames.includes(`${n}_111`)?`underscore`:`brackets`,s=Ihe(n,r.rank,i,o),c=t.getField(s(a,a,a))||U.Undefined(t.rowCount,e),l=e=>Lhe(t,r,e,s);return{schema:e,__array:void 0,isDefined:c.isDefined,rowCount:t.rowCount,value:l,valueKind:c.valueKind,areValuesEqual:(e,t)=>BD.areEqualExact(l(e),l(t)),toArray:e=>LD(t.rowCount,l,e)}}var r_e=class{constructor(e,t,n){this._isDefined=n;let r=Object.keys(t);this._rowCount=e.rowCount,this._columns=r,this._schema=t;let i=Object.create(null);for(let n of r)Object.defineProperty(this,n,{get:function(){if(i[n])return i[n];let r=t[n];if(r.valueType===`list`)i[n]=t_e(r,e,n);else if(r.valueType===`tensor`)i[n]=n_e(r,e,n);else{let t=Qge(r),a=e.getField(n);i[n]=a?t(a,e,n):U.Undefined(e.rowCount,r)}return i[n]},enumerable:!0,configurable:!1})}};function i_e(e,t,n){let r=Object.create(null);for(let i of Object.keys(e))r[i]=s_e(i,e[i],t,n);return jhe.ofTables(t.header,e,r)}function a_e(e){let t=Object.create(null);for(let n of Object.keys(e.categories))for(let r of e.categories[n].fieldNames){let i=jO.create(n,r,!0);t[i]=e.categories[n].getField(r)}return t}function o_e(e,t,n,r){let i=jO.create(t,e),a=jO.canonical(i);if(a in n)return n[a];if(r&&i in r)for(let e of r[i]){let t=jO.canonical(e);if(t in n)return n[t]}}function s_e(e,t,n,r){let i=n.categories[e];if(r){let a=a_e(n),o=Object.create(null),s=[],c=0;for(let n of Object.keys(t)){let t=o_e(n,e,a,r);t&&(o[n]=t,s.push(n),c=t.rowCount)}i={rowCount:c,name:e,fieldNames:[...s],getField(e){return o[e]}}}return new r_e(i||nO.empty(e),t,!!i)}var NO=U.Schema,W=NO.str,PO=NO.int,FO=NO.float,IO=NO.coord,LO=NO.Aliased,RO=NO.Matrix,zO=NO.Vector,BO=NO.lstr,VO=NO.List;const HO={atom_site:{auth_asym_id:W,auth_atom_id:W,auth_comp_id:W,auth_seq_id:PO,B_iso_or_equiv:FO,Cartn_x:IO,Cartn_y:IO,Cartn_z:IO,group_PDB:LO(W),id:PO,label_alt_id:W,label_asym_id:W,label_atom_id:W,label_comp_id:W,label_entity_id:W,label_seq_id:PO,occupancy:FO,type_symbol:W,pdbx_PDB_ins_code:W,pdbx_PDB_model_num:PO,pdbx_formal_charge:PO,pdbx_label_index:PO,pdbx_sifts_xref_db_name:W,pdbx_sifts_xref_db_acc:W,pdbx_sifts_xref_db_num:W,pdbx_sifts_xref_db_res:W,ihm_model_id:PO},atom_site_anisotrop:{id:PO,type_symbol:W,U:RO(3,3),U_esd:RO(3,3),pdbx_auth_seq_id:PO,pdbx_auth_asym_id:W,pdbx_auth_atom_id:W,pdbx_auth_comp_id:W,pdbx_label_seq_id:PO,pdbx_label_alt_id:W,pdbx_label_asym_id:W,pdbx_label_atom_id:W,pdbx_label_comp_id:W,pdbx_PDB_ins_code:W},atom_sites:{entry_id:W,fract_transf_matrix:RO(3,3),fract_transf_vector:zO(3)},audit_author:{name:W,pdbx_ordinal:PO,identifier_ORCID:W},audit_conform:{dict_location:W,dict_name:W,dict_version:W},cell:{angle_alpha:FO,angle_beta:FO,angle_gamma:FO,entry_id:W,length_a:FO,length_b:FO,length_c:FO,Z_PDB:PO,pdbx_unique_axis:W},chem_comp:{formula:W,formula_weight:FO,id:W,mon_nstd_flag:LO(BO),name:W,type:LO(BO),pdbx_synonyms:VO(`;`,e=>e)},chem_comp_bond:{atom_id_1:W,atom_id_2:W,comp_id:W,value_order:LO(BO),pdbx_ordinal:PO,pdbx_stereo_config:LO(BO),pdbx_aromatic_flag:LO(BO)},citation:{book_publisher:W,country:W,id:W,journal_abbrev:W,journal_id_ASTM:W,journal_id_CSD:W,journal_id_ISSN:W,journal_volume:W,page_first:W,page_last:W,title:W,year:PO,pdbx_database_id_DOI:W,pdbx_database_id_PubMed:PO},citation_author:{citation_id:W,name:W,ordinal:PO},database_2:{database_id:LO(BO),database_code:W},entity:{details:W,formula_weight:FO,id:W,src_method:LO(BO),type:LO(BO),pdbx_description:VO(`,`,e=>e),pdbx_number_of_molecules:PO,pdbx_parent_entity_id:W,pdbx_mutation:W,pdbx_fragment:W,pdbx_ec:VO(`,`,e=>e)},entity_poly:{entity_id:W,nstd_linkage:LO(BO),nstd_monomer:LO(BO),type:LO(W),pdbx_strand_id:VO(`,`,e=>e),pdbx_seq_one_letter_code:W,pdbx_seq_one_letter_code_can:W,pdbx_target_identifier:W},entity_poly_seq:{entity_id:W,hetero:LO(BO),mon_id:W,num:PO},entry:{id:W},exptl:{entry_id:W,method:LO(W)},software:{classification:W,date:W,description:W,name:W,type:LO(BO),version:W,pdbx_ordinal:PO},struct:{entry_id:W,title:W,pdbx_structure_determination_methodology:LO(W),pdbx_descriptor:W},struct_asym:{details:W,entity_id:W,id:W,pdbx_modified:W,pdbx_blank_PDB_chainid_flag:LO(W)},struct_conf:{beg_label_asym_id:W,beg_label_comp_id:W,beg_label_seq_id:PO,beg_auth_asym_id:W,beg_auth_comp_id:W,beg_auth_seq_id:PO,conf_type_id:LO(BO),details:W,end_label_asym_id:W,end_label_comp_id:W,end_label_seq_id:PO,end_auth_asym_id:W,end_auth_comp_id:W,end_auth_seq_id:PO,id:W,pdbx_beg_PDB_ins_code:W,pdbx_end_PDB_ins_code:W,pdbx_PDB_helix_class:W,pdbx_PDB_helix_length:PO,pdbx_PDB_helix_id:W},struct_conn:{conn_type_id:LO(BO),details:W,id:W,ptnr1_label_asym_id:W,ptnr1_label_atom_id:W,ptnr1_label_comp_id:W,ptnr1_label_seq_id:PO,ptnr1_auth_asym_id:W,ptnr1_auth_comp_id:W,ptnr1_auth_seq_id:PO,ptnr1_symmetry:W,ptnr2_label_asym_id:W,ptnr2_label_atom_id:W,ptnr2_label_comp_id:W,ptnr2_label_seq_id:PO,ptnr2_auth_asym_id:W,ptnr2_auth_comp_id:W,ptnr2_auth_seq_id:PO,ptnr2_symmetry:W,pdbx_ptnr1_PDB_ins_code:W,pdbx_ptnr1_label_alt_id:W,pdbx_ptnr1_standard_comp_id:W,pdbx_ptnr2_PDB_ins_code:W,pdbx_ptnr2_label_alt_id:W,pdbx_ptnr3_PDB_ins_code:W,pdbx_ptnr3_label_alt_id:W,pdbx_ptnr3_label_asym_id:W,pdbx_ptnr3_label_atom_id:W,pdbx_ptnr3_label_comp_id:W,pdbx_ptnr3_label_seq_id:PO,pdbx_PDB_id:W,pdbx_dist_value:FO,pdbx_value_order:LO(BO)},struct_conn_type:{criteria:W,id:LO(BO),reference:W},struct_keywords:{entry_id:W,text:VO(`,`,e=>e),pdbx_keywords:W},struct_mon_prot_cis:{label_alt_id:W,label_asym_id:W,label_comp_id:W,label_seq_id:PO,auth_asym_id:W,auth_comp_id:W,auth_seq_id:PO,pdbx_auth_asym_id_2:W,pdbx_auth_comp_id_2:W,pdbx_auth_seq_id_2:PO,pdbx_label_asym_id_2:W,pdbx_label_comp_id_2:W,pdbx_label_seq_id_2:PO,pdbx_PDB_ins_code:W,pdbx_PDB_ins_code_2:W,pdbx_PDB_model_num:PO,pdbx_omega_angle:W,pdbx_id:W,pdbx_auth_ins_code:W,pdbx_auth_ins_code_2:W},struct_ncs_oper:{code:LO(W),details:W,id:PO,matrix:RO(3,3),vector:zO(3)},struct_sheet_range:{beg_label_asym_id:W,beg_label_comp_id:W,beg_label_seq_id:PO,end_label_asym_id:W,end_label_comp_id:W,end_label_seq_id:PO,beg_auth_asym_id:W,beg_auth_comp_id:W,beg_auth_seq_id:PO,end_auth_asym_id:W,end_auth_comp_id:W,end_auth_seq_id:PO,id:W,sheet_id:W,pdbx_beg_PDB_ins_code:W,pdbx_end_PDB_ins_code:W},struct_site:{details:W,id:W,pdbx_num_residues:PO,pdbx_evidence_code:W,pdbx_auth_asym_id:W,pdbx_auth_comp_id:W,pdbx_auth_seq_id:PO,pdbx_auth_ins_code:W},struct_site_gen:{details:W,id:W,label_alt_id:W,label_asym_id:W,label_atom_id:W,label_comp_id:W,label_seq_id:PO,auth_asym_id:W,auth_atom_id:W,auth_comp_id:W,auth_seq_id:PO,site_id:W,symmetry:W,pdbx_auth_ins_code:W,pdbx_num_res:PO},struct_site_keywords:{site_id:W,text:W},symmetry:{entry_id:W,cell_setting:LO(BO),Int_Tables_number:PO,space_group_name_Hall:W,"space_group_name_H-M":W},pdbx_database_status:{status_code:LO(W),status_code_sf:LO(W),status_code_mr:LO(W),entry_id:W,recvd_initial_deposition_date:W,SG_entry:LO(BO),deposit_site:LO(W),process_site:LO(W),status_code_cs:LO(W),methods_development_category:LO(W),pdb_format_compatible:LO(BO)},pdbx_nonpoly_scheme:{asym_id:W,entity_id:W,mon_id:W,pdb_strand_id:W,ndb_seq_num:W,pdb_seq_num:W,auth_seq_num:W,pdb_mon_id:W,auth_mon_id:W,pdb_ins_code:W},pdbx_database_related:{db_name:LO(W),details:W,db_id:W,content_type:LO(W)},pdbx_entity_nonpoly:{entity_id:W,comp_id:W,name:W},pdbx_chem_comp_synonyms:{name:W,comp_id:W,provenance:LO(W)},pdbx_chem_comp_identifier:{comp_id:W,identifier:W,type:LO(W),program:W,program_version:W},pdbx_unobs_or_zero_occ_residues:{id:PO,polymer_flag:LO(BO),occupancy_flag:LO(PO),PDB_model_num:PO,auth_asym_id:W,auth_comp_id:W,auth_seq_id:PO,PDB_ins_code:W,label_asym_id:W,label_comp_id:W,label_seq_id:PO},pdbx_struct_mod_residue:{id:PO,auth_asym_id:W,auth_comp_id:W,auth_seq_id:PO,PDB_ins_code:W,label_asym_id:W,label_comp_id:W,label_seq_id:PO,parent_comp_id:W,details:W},pdbx_struct_oper_list:{id:W,type:LO(W),name:W,symmetry_operation:W,matrix:RO(3,3),vector:zO(3)},pdbx_struct_assembly:{method_details:W,oligomeric_details:W,oligomeric_count:PO,details:W,id:W},pdbx_struct_assembly_gen:{asym_id_list:VO(`,`,e=>e),assembly_id:W,oper_expression:W},pdbx_reference_entity_list:{prd_id:W,ref_entity_id:W,type:LO(BO),details:W,component_id:PO},pdbx_reference_entity_link:{link_id:PO,prd_id:W,details:W,ref_entity_id_1:W,ref_entity_id_2:W,entity_seq_num_1:PO,entity_seq_num_2:PO,comp_id_1:W,comp_id_2:W,atom_id_1:W,atom_id_2:W,value_order:LO(BO),component_1:PO,component_2:PO,link_class:LO(W)},pdbx_reference_entity_poly_link:{link_id:PO,prd_id:W,ref_entity_id:W,component_id:PO,entity_seq_num_1:PO,entity_seq_num_2:PO,comp_id_1:W,comp_id_2:W,atom_id_1:W,atom_id_2:W,value_order:LO(BO)},pdbx_molecule:{prd_id:W,instance_id:PO,asym_id:W},pdbx_molecule_features:{prd_id:W,class:LO(BO),type:LO(BO),name:W,details:W},entity_src_nat:{entity_id:W,pdbx_organism_scientific:W,pdbx_plasmid_name:W,pdbx_src_id:PO,pdbx_beg_seq_num:PO,pdbx_end_seq_num:PO},entity_src_gen:{entity_id:W,pdbx_gene_src_gene:VO(`,`,e=>e),pdbx_gene_src_scientific_name:W,plasmid_name:W,pdbx_src_id:PO,pdbx_beg_seq_num:PO,pdbx_end_seq_num:PO},pdbx_entity_src_syn:{organism_scientific:W,entity_id:W,pdbx_src_id:PO,pdbx_beg_seq_num:PO,pdbx_end_seq_num:PO},pdbx_entity_branch_descriptor:{entity_id:W,descriptor:W,type:LO(BO),program:W,program_version:W,ordinal:PO},pdbx_entity_instance_feature:{details:W,feature_type:LO(W),auth_asym_id:W,asym_id:W,auth_seq_num:W,seq_num:PO,comp_id:W,auth_comp_id:W,ordinal:PO},pdbx_entity_branch_list:{entity_id:W,hetero:LO(BO),comp_id:W,num:PO},pdbx_entity_branch_link:{link_id:PO,details:W,entity_id:W,entity_branch_list_num_1:PO,entity_branch_list_num_2:PO,comp_id_1:W,comp_id_2:W,atom_id_1:W,leaving_atom_id_1:W,atom_stereo_config_1:LO(BO),atom_id_2:W,leaving_atom_id_2:W,atom_stereo_config_2:LO(BO),value_order:LO(BO)},pdbx_entity_branch:{entity_id:W,type:LO(W)},pdbx_branch_scheme:{entity_id:W,hetero:LO(BO),asym_id:W,mon_id:W,num:PO,pdb_asym_id:W,pdb_seq_num:W,pdb_mon_id:W,auth_asym_id:W,auth_seq_num:W,auth_mon_id:W},pdbx_chem_comp_related:{comp_id:W,related_comp_id:W,relationship_type:LO(W),details:W},ihm_starting_model_details:{starting_model_id:W,entity_id:W,entity_description:W,asym_id:W,entity_poly_segment_id:PO,starting_model_source:LO(W),starting_model_auth_asym_id:W,starting_model_sequence_offset:PO,dataset_list_id:PO},ihm_starting_comparative_models:{id:PO,starting_model_id:W,starting_model_auth_asym_id:W,starting_model_seq_id_begin:PO,starting_model_seq_id_end:PO,template_auth_asym_id:W,template_seq_id_begin:PO,template_seq_id_end:PO,template_sequence_identity:FO,template_sequence_identity_denominator:LO(PO),template_dataset_list_id:PO,alignment_file_id:PO},ihm_starting_model_seq_dif:{id:PO,entity_id:W,asym_id:W,seq_id:PO,comp_id:W,starting_model_id:W,db_asym_id:W,db_seq_id:PO,db_comp_id:W,details:W},ihm_model_representation:{id:PO,name:W,details:W},ihm_model_representation_details:{id:PO,representation_id:PO,entity_poly_segment_id:PO,entity_id:W,entity_description:W,entity_asym_id:W,model_object_primitive:LO(W),starting_model_id:W,model_mode:LO(W),model_granularity:LO(W),model_object_count:PO},ihm_struct_assembly_details:{id:PO,assembly_id:PO,parent_assembly_id:PO,entity_description:W,entity_id:W,asym_id:W,entity_poly_segment_id:PO},ihm_struct_assembly:{id:PO,name:W,description:W},ihm_modeling_protocol:{id:PO,num_steps:PO,protocol_name:W},ihm_modeling_protocol_details:{id:PO,protocol_id:PO,step_id:PO,struct_assembly_id:PO,dataset_group_id:PO,struct_assembly_description:W,step_name:W,step_method:W,num_models_begin:PO,num_models_end:PO,multi_scale_flag:LO(BO),multi_state_flag:LO(BO),ordered_flag:LO(BO),script_file_id:PO,software_id:PO},ihm_multi_state_modeling:{state_id:PO,state_group_id:PO,population_fraction:FO,population_fraction_sd:FO,state_type:W,state_name:W,experiment_type:LO(W),details:W},ihm_modeling_post_process:{id:PO,protocol_id:PO,analysis_id:PO,step_id:PO,type:LO(W),feature:LO(W),num_models_begin:PO,num_models_end:PO},ihm_ensemble_info:{ensemble_id:PO,ensemble_name:W,post_process_id:PO,model_group_id:PO,ensemble_clustering_method:LO(W),ensemble_clustering_feature:LO(W),num_ensemble_models:PO,num_ensemble_models_deposited:PO,ensemble_precision_value:FO,ensemble_file_id:PO},ihm_model_list:{model_id:PO,model_name:W,assembly_id:PO,protocol_id:PO,representation_id:PO},ihm_model_group:{id:PO,name:W,details:W},ihm_model_group_link:{model_id:PO,group_id:PO},ihm_model_representative:{id:PO,model_group_id:PO,model_id:PO,selection_criteria:LO(W)},ihm_dataset_list:{id:PO,data_type:LO(W),database_hosted:LO(BO)},ihm_dataset_group:{id:PO,name:W,application:LO(W),details:W},ihm_dataset_group_link:{dataset_list_id:PO,group_id:PO},ihm_related_datasets:{dataset_list_id_derived:PO,dataset_list_id_primary:PO},ihm_dataset_related_db_reference:{id:PO,dataset_list_id:PO,db_name:LO(W),accession_code:W,version:W,details:W},ihm_external_reference_info:{reference_id:PO,reference_provider:W,reference_type:LO(W),reference:W,refers_to:LO(W),associated_url:W},ihm_external_files:{id:PO,reference_id:PO,file_path:W,content_type:LO(W),file_size_bytes:FO,details:W},ihm_dataset_external_reference:{id:PO,dataset_list_id:PO,file_id:PO},ihm_localization_density_files:{id:PO,file_id:PO,ensemble_id:PO,entity_id:W,entity_poly_segment_id:PO,asym_id:W},ihm_predicted_contact_restraint:{id:PO,group_id:PO,entity_id_1:W,entity_id_2:W,asym_id_1:W,asym_id_2:W,comp_id_1:W,comp_id_2:W,seq_id_1:PO,seq_id_2:PO,rep_atom_1:LO(W),rep_atom_2:LO(W),distance_lower_limit:FO,distance_upper_limit:FO,probability:FO,restraint_type:LO(W),model_granularity:LO(W),dataset_list_id:PO,software_id:PO},ihm_cross_link_list:{id:PO,group_id:PO,entity_description_1:W,entity_description_2:W,entity_id_1:W,entity_id_2:W,comp_id_1:W,comp_id_2:W,seq_id_1:PO,seq_id_2:PO,linker_type:LO(W),dataset_list_id:PO},ihm_cross_link_restraint:{id:PO,group_id:PO,entity_id_1:W,entity_id_2:W,asym_id_1:W,asym_id_2:W,comp_id_1:W,comp_id_2:W,seq_id_1:PO,seq_id_2:PO,atom_id_1:W,atom_id_2:W,restraint_type:LO(W),conditional_crosslink_flag:LO(W),model_granularity:LO(W),distance_threshold:FO,psi:FO,sigma_1:FO,sigma_2:FO},ihm_cross_link_result_parameters:{id:PO,restraint_id:PO,model_id:PO,psi:FO,sigma_1:FO,sigma_2:FO},ihm_2dem_class_average_restraint:{id:PO,dataset_list_id:PO,number_raw_micrographs:PO,pixel_size_width:FO,pixel_size_height:FO,image_resolution:FO,image_segment_flag:LO(BO),number_of_projections:PO,struct_assembly_id:PO,details:W},ihm_2dem_class_average_fitting:{id:PO,restraint_id:PO,model_id:PO,cross_correlation_coefficient:FO,rot_matrix:RO(3,3),tr_vector:zO(3)},ihm_3dem_restraint:{id:PO,dataset_list_id:PO,model_id:PO,struct_assembly_id:PO,fitting_method:W,number_of_gaussians:PO,cross_correlation_coefficient:FO},ihm_sas_restraint:{id:PO,dataset_list_id:PO,model_id:PO,struct_assembly_id:PO,profile_segment_flag:LO(BO),fitting_atom_type:W,fitting_method:W,fitting_state:LO(W),radius_of_gyration:FO,chi_value:FO,details:W},ihm_starting_model_coord:{ordinal_id:PO,starting_model_id:W,group_PDB:LO(W),id:PO,type_symbol:W,entity_id:W,atom_id:W,comp_id:W,seq_id:PO,asym_id:W,Cartn_x:FO,Cartn_y:FO,Cartn_z:FO,B_iso_or_equiv:FO},ihm_sphere_obj_site:{id:PO,entity_id:W,seq_id_begin:PO,seq_id_end:PO,asym_id:W,Cartn_x:FO,Cartn_y:FO,Cartn_z:FO,object_radius:FO,rmsf:FO,model_id:PO},ihm_gaussian_obj_site:{id:PO,entity_id:W,seq_id_begin:PO,seq_id_end:PO,asym_id:W,mean_Cartn_x:FO,mean_Cartn_y:FO,mean_Cartn_z:FO,weight:FO,covariance_matrix:RO(3,3),model_id:PO},ihm_gaussian_obj_ensemble:{id:PO,entity_id:W,seq_id_begin:PO,seq_id_end:PO,asym_id:W,mean_Cartn_x:FO,mean_Cartn_y:FO,mean_Cartn_z:FO,weight:FO,covariance_matrix:RO(3,3),ensemble_id:PO},ihm_feature_list:{feature_id:PO,feature_type:LO(W),entity_type:LO(W)},ihm_poly_residue_feature:{ordinal_id:PO,feature_id:PO,entity_id:W,asym_id:W,comp_id_begin:W,comp_id_end:W,seq_id_begin:PO,seq_id_end:PO},ihm_derived_distance_restraint:{id:PO,group_id:PO,feature_id_1:PO,feature_id_2:PO,group_conditionality:LO(W),random_exclusion_fraction:FO,distance_upper_limit:FO,restraint_type:LO(W),dataset_list_id:PO},ma_model_list:{ordinal_id:PO,model_id:PO,model_group_id:PO,model_name:W,model_group_name:W,model_type:LO(W),data_id:PO},ma_target_entity:{entity_id:W,data_id:PO,origin:LO(W)},ma_target_entity_instance:{asym_id:W,entity_id:W,details:W},ma_target_ref_db_details:{target_entity_id:W,db_name:LO(W),db_code:W,db_accession:W,seq_db_isoform:W,seq_db_align_begin:W,seq_db_align_end:W,ncbi_taxonomy_id:W,organism_scientific:W},ma_data:{id:PO,content_type:LO(W),content_type_other_details:W,name:W},ma_software_group:{ordinal_id:PO,group_id:PO,software_id:PO},ma_qa_metric:{id:PO,name:W,type:LO(W),mode:LO(W),software_group_id:PO},ma_qa_metric_global:{ordinal_id:PO,model_id:PO,metric_id:PO,metric_value:FO},ma_qa_metric_local:{ordinal_id:PO,model_id:PO,label_asym_id:W,label_seq_id:PO,label_comp_id:W,metric_id:PO,metric_value:FO},ma_qa_metric_local_pairwise:{ordinal_id:PO,model_id:PO,label_asym_id_1:W,label_seq_id_1:PO,label_comp_id_1:W,label_asym_id_2:W,label_seq_id_2:PO,label_comp_id_2:W,metric_id:PO,metric_value:FO}};var UO=U.Schema,WO=UO.str,c_e=UO.float,l_e=UO.List,GO=UO.lstr,KO=UO.Aliased,qO=UO.int,JO=UO.coord;const u_e={chem_comp:{formula:WO,formula_weight:c_e,id:WO,mon_nstd_parent_comp_id:l_e(`,`,e=>e),name:WO,one_letter_code:WO,three_letter_code:WO,type:KO(GO),pdbx_synonyms:l_e(`;`,e=>e),pdbx_type:WO,pdbx_ambiguous_flag:WO,pdbx_replaced_by:WO,pdbx_replaces:WO,pdbx_formal_charge:qO,pdbx_model_coordinates_details:WO,pdbx_model_coordinates_db_code:WO,pdbx_ideal_coordinates_details:WO,pdbx_ideal_coordinates_missing_flag:KO(GO),pdbx_model_coordinates_missing_flag:KO(GO),pdbx_initial_date:WO,pdbx_modified_date:WO,pdbx_release_status:KO(WO),pdbx_processing_site:KO(WO)},chem_comp_atom:{alt_atom_id:WO,atom_id:WO,charge:qO,model_Cartn_x:JO,model_Cartn_y:JO,model_Cartn_z:JO,comp_id:WO,type_symbol:WO,pdbx_align:qO,pdbx_ordinal:qO,pdbx_model_Cartn_x_ideal:JO,pdbx_model_Cartn_y_ideal:JO,pdbx_model_Cartn_z_ideal:JO,pdbx_stereo_config:KO(GO),pdbx_aromatic_flag:KO(GO),pdbx_leaving_atom_flag:KO(GO)},chem_comp_bond:{atom_id_1:WO,atom_id_2:WO,comp_id:WO,value_order:KO(GO),pdbx_ordinal:qO,pdbx_stereo_config:KO(GO),pdbx_aromatic_flag:KO(GO)},pdbx_chem_comp_descriptor:{comp_id:WO,descriptor:WO,type:KO(GO),program:WO,program_version:WO},pdbx_chem_comp_identifier:{comp_id:WO,identifier:WO,type:KO(WO),program:WO,program_version:WO}};var YO=U.Schema,XO=YO.str,d_e=YO.float,ZO=YO.lstr,QO=YO.Aliased,$O=YO.int;const f_e={pdbx_reference_molecule:{prd_id:XO,formula_weight:d_e,formula:XO,type:QO(ZO),type_evidence_code:XO,class:QO(ZO),class_evidence_code:XO,name:XO,represent_as:QO(ZO),chem_comp_id:XO,compound_details:XO,description:XO,representative_PDB_id_code:XO,release_status:QO(ZO),replaces:XO,replaced_by:XO},pdbx_reference_entity_list:{prd_id:XO,ref_entity_id:XO,type:QO(ZO),details:XO,component_id:$O},pdbx_reference_entity_nonpoly:{prd_id:XO,ref_entity_id:XO,name:XO,chem_comp_id:XO},pdbx_reference_entity_link:{link_id:$O,prd_id:XO,details:XO,ref_entity_id_1:XO,ref_entity_id_2:XO,entity_seq_num_1:$O,entity_seq_num_2:$O,comp_id_1:XO,comp_id_2:XO,atom_id_1:XO,atom_id_2:XO,value_order:QO(ZO),component_1:$O,component_2:$O,link_class:QO(XO)},pdbx_reference_entity_poly_link:{link_id:$O,prd_id:XO,ref_entity_id:XO,component_id:$O,entity_seq_num_1:$O,entity_seq_num_2:$O,comp_id_1:XO,comp_id_2:XO,atom_id_1:XO,atom_id_2:XO,value_order:QO(ZO)},pdbx_reference_entity_poly:{prd_id:XO,ref_entity_id:XO,type:QO(XO),db_code:XO,db_name:XO},pdbx_reference_entity_poly_seq:{prd_id:XO,ref_entity_id:XO,mon_id:XO,parent_mon_id:XO,num:$O,observed:QO(ZO),hetero:QO(ZO)},pdbx_reference_entity_sequence:{prd_id:XO,ref_entity_id:XO,type:QO(XO),NRP_flag:QO(XO),one_letter_codes:XO},pdbx_reference_entity_src_nat:{prd_id:XO,ref_entity_id:XO,ordinal:$O,organism_scientific:XO,taxid:XO,db_code:XO,db_name:XO},pdbx_prd_audit:{prd_id:XO,date:XO,processing_site:QO(XO),action_type:QO(XO)}};var p_e=U.Schema,ek=p_e.str,m_e=p_e.float;const h_e={datablock:{id:ek,description:ek},dictionary:{title:ek,datablock_id:ek,version:ek},dictionary_history:{version:ek,update:ek,revision:ek},sub_category:{id:ek,description:ek},category_group_list:{id:ek,parent_id:ek,description:ek},item_type_list:{code:ek,primitive_code:ek,construct:ek,detail:ek},item_units_list:{code:ek,detail:ek},item_units_conversion:{from_code:ek,to_code:ek,operator:ek,factor:m_e}};var tk=U.Schema,nk=tk.str,rk=tk.int,ik=tk.float,ak=tk.Aliased,ok=tk.Vector;ak(nk),ak(nk),ak(nk),ak(nk),ok(3),ok(3);const g_e={volume_data_3d_info:{name:nk,axis_order:ok(3,rk),origin:ok(3),dimensions:ok(3),sample_rate:rk,sample_count:ok(3,rk),spacegroup_number:rk,spacegroup_cell_size:ok(3),spacegroup_cell_angles:ok(3),mean_source:ik,mean_sampled:ik,sigma_source:ik,sigma_sampled:ik,min_source:ik,min_sampled:ik,max_source:ik,max_sampled:ik},volume_data_3d:{values:ik}};var sk=U.Schema,ck=sk.float,lk=sk.str,__e=sk.int,v_e=sk.Matrix;const y_e={cell:{angle_alpha:ck,angle_beta:ck,angle_gamma:ck,formula_units_z:ck,length_a:ck,length_b:ck,length_c:ck,volume:ck},chemical:{melting_point:ck,name_common:lk,name_systematic:lk},chemical_formula:{moiety:lk,sum:lk,weight:ck},space_group:{crystal_system:lk,it_number:__e,"name_h-m_full":lk},space_group_symop:{operation_xyz:lk},geom_bond:{atom_site_label_1:lk,atom_site_label_2:lk,distance:ck,publ_flag:lk,site_symmetry_1:lk,site_symmetry_2:lk,valence:ck},audit:{block_doi:lk},database_code:{cod:lk,csd:lk,depnum_ccdc_archive:lk,depnum_ccdc_fiz:lk,icsd:lk,mdf:lk,nbs:lk},atom_site:{adp_type:lk,calc_flag:lk,disorder_assembly:lk,disorder_group:lk,fract_x:ck,fract_y:ck,fract_z:ck,label:lk,occupancy:ck,refinement_flags:lk,site_symmetry_multiplicity:__e,type_symbol:lk,u_iso_or_equiv:ck},atom_site_aniso:{label:lk,u_11:ck,u:v_e(3,3),u_12:ck,u_13:ck,u_22:ck,u_23:ck,u_33:ck},atom_type:{description:lk,symbol:lk},atom_type_scat:{dispersion_imag:ck,dispersion_real:ck,source:lk}},b_e={"cell.formula_units_z":[`cell_formula_units_Z`],"space_group.it_number":[`space_group_IT_number`,`symmetry_Int_Tables_number`],"space_group.name_h-m_full":[`symmetry_space_group_name_H-M`],"space_group_symop.operation_xyz":[`symmetry_equiv_pos_as_xyz`],"geom_bond.atom_site_label_1":[`geom_bond_atom_site_id_1`],"geom_bond.atom_site_label_2":[`geom_bond_atom_site_id_2`],"geom_bond.distance":[`geom_bond_dist`],"audit.block_doi":[`audit_block_DOI`],"database_code.cod":[`database_code_COD`],"database_code.csd":[`database_code_CSD`],"database_code.depnum_ccdc_archive":[`database_code_depnum_CCDC_archive`],"database_code.depnum_ccdc_fiz":[`database_code_depnum_CCDC_fiz`],"database_code.icsd":[`database_code_ICSD`],"database_code.mdf":[`database_code_MDF`],"database_code.nbs":[`database_code_NBS`],"atom_site.adp_type":[`atom_site_ADP_type`,`atom_site_thermal_displace_type`],"atom_site.label":[`atom_site_id`],"atom_site.site_symmetry_multiplicity":[`atom_site_symmetry_multiplicity`],"atom_site.u_iso_or_equiv":[`atom_site_U_iso_or_equiv`],"atom_site_aniso.label":[`atom_site_anisotrop_id`],"atom_site_aniso.u_11":[`atom_site_aniso_U_11`,`atom_site_anisotrop_U_11`],"atom_site_aniso.u_12":[`atom_site_aniso_U_12`,`atom_site_anisotrop_U_12`],"atom_site_aniso.u_13":[`atom_site_aniso_U_13`,`atom_site_anisotrop_U_13`],"atom_site_aniso.u_22":[`atom_site_aniso_U_22`,`atom_site_anisotrop_U_22`],"atom_site_aniso.u_23":[`atom_site_aniso_U_23`,`atom_site_anisotrop_U_23`],"atom_site_aniso.u_33":[`atom_site_aniso_U_33`,`atom_site_anisotrop_U_33`]};var uk=U.Schema.int;const x_e={volume_data_3d_info:g_e.volume_data_3d_info,segmentation_data_table:{set_id:uk,segment_id:uk},segmentation_data_3d:{values:uk}},dk={parse:e=>By.is(e)?dge(e):Yge(e),parseText:dge,parseBinary:Yge,toDatabaseCollection:Xge,toDatabase:MO,schema:{mmCIF:e=>MO(HO,e),CCD:e=>MO(u_e,e),BIRD:e=>MO(f_e,e),dic:e=>MO(h_e,e),cifCore:e=>MO(y_e,e,b_e),densityServer:e=>MO(g_e,e),segmentation:e=>MO(x_e,e)}};function S_e(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function C_e(e,t){let n=t?t=>e.readInt16LE(t*2):t=>e.readInt16BE(t*2),r=1/n(17);return{xStart:n(0),yStart:n(1),zStart:n(2),xExtent:n(3),yExtent:n(4),zExtent:n(5),xRate:n(6),yRate:n(7),zRate:n(8),xlen:n(9)*r,ylen:n(10)*r,zlen:n(11)*r,alpha:n(12)*r,beta:n(13)*r,gamma:n(14)*r,divisor:n(15)/100,summand:n(16),sigma:void 0}}function w_e(e){let{xExtent:t,yExtent:n,zExtent:r}=e;return{xBlocks:Math.ceil(t/8),yBlocks:Math.ceil(n/8),zBlocks:Math.ceil(r/8)}}async function T_e(e){let{buffer:t}=await e.readBuffer(0,512),n=String.fromCharCode.apply(null,t),r=n.startsWith(`:-)`),i=r||t.readInt16LE(36)===100;return{header:r?S_e(n):C_e(t,i),littleEndian:i}}async function E_e(e,t,n,r){r||MD.flipByteOrderInPlace2(t.buffer);let{divisor:i,summand:a,xExtent:o,yExtent:s,zExtent:c}=e,{xBlocks:l,yBlocks:u,zBlocks:d}=w_e(e),f=0;for(let e=0;e<d;++e)for(let r=0;r<u;++r)for(let u=0;u<l;++u)for(let l=0;l<8;++l){let d=8*e+l;for(let e=0;e<8;++e){let l=8*r+e;for(let e=0;e<8;++e){let r=8*u+e;if(r<o&&l<s&&d<c){let e=(r*s+l)*c+d;n[e]=(t[f]-a)/i,++f}else{f+=8-e;break}}}}}function D_e(e){let{xExtent:t,yExtent:n,zExtent:r}=e,{xBlocks:i,yBlocks:a,zBlocks:o}=w_e(e),s=t*n*r,c=i*8*a*8*o*8;return{count:c,byteCount:c*1,valueCount:s}}async function O_e(e,t,n){await n.update({message:`Parsing DSN6/BRIX file...`});let{header:r,littleEndian:i}=await T_e(e),{buffer:a}=await e.readBuffer(512,t-512),{valueCount:o}=D_e(r),s=new Float32Array(o);return await E_e(r,a,s,i),{header:r,values:s,name:e.name}}function k_e(e,t){return hb.create(`Parse DSN6/BRIX`,async n=>{try{return jD.success(await O_e(e,t,n))}catch(e){return jD.error(e)}})}function A_e(e,t){return k_e(ND.fromBuffer(MD.fromUint8Array(e),t),e.length)}const j_e=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}));function fk(e){if(!j_e.has(e))throw Error(`unknown ply type '${e}'`);return e}function M_e(e,t,n){let r=new Map;for(let n=0,i=t.length;n<i;++n)r.set(t[n],e[n]);return{comments:n,elementNames:t,getElement:e=>r.get(e)}}function N_e(e,t){return{data:e,tokenizer:iO(e),runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function P_e(e){let t=e.data.indexOf(`end_header`,e.position);if(t===-1)throw Error(`no 'end_header' record found`);e.tokenStart=e.position,e.tokenEnd=t,e.position=t,iO.eatLine(e)}function F_e(e){let{tokenizer:t,comments:n,elementSpecs:r}=e;P_e(t);let i=iO.getTokenString(t).split(/\r?\n/);if(i[0]!==`ply`)throw Error(`data not starting with 'ply'`);if(i[1]!==`format ascii 1.0`)throw Error(`format not 'ascii 1.0'`);let a,o,s;function c(){if(a!==void 0&&o!==void 0&&s!==void 0){let e=!1;for(let t=0,n=s.length;t<n;++t)if(s[t].kind===`list`){e=!0;break}e&&s.length,e?r.push({kind:`list`,name:a,count:o,property:s[0]}):r.push({kind:`table`,name:a,count:o,properties:s})}}for(let e=2,t=i.length;e<t;++e){let t=i[e],r=t.split(` `);if(t.startsWith(`comment`))n.push(t.substr(8));else if(t.startsWith(`element`))c(),s=[],a=r[1],o=parseInt(r[2]);else if(t.startsWith(`property`)){if(s===void 0)throw Error(`properties outside of element`);r[1]===`list`?s.push({kind:`list`,countType:fk(r[2]),dataType:fk(r[3]),name:r[4]}):s.push({kind:`column`,type:fk(r[1]),name:r[2]})}else t.startsWith(`end_header`)?c():console.warn(`unknown header line`)}}function I_e(e){let{elementSpecs:t}=e;for(let n=0,r=t.length;n<r;++n){let r=t[n];r.kind===`table`?R_e(e,r):r.kind===`list`&&z_e(e,r)}}function L_e(e){switch(e){case`char`:case`uchar`:case`int8`:case`uint8`:case`short`:case`ushort`:case`int16`:case`uint16`:case`int`:case`uint`:case`int32`:case`uint32`:return U.Schema.int;case`float`:case`double`:case`float32`:case`float64`:return U.Schema.float}}function R_e(e,t){let{elements:n,tokenizer:r}=e,{count:i,properties:a}=t,o=a.length,s=[],c=[],l=[],u=new Map;for(let e=0,t=o;e<t;++e){let e=aO.create(r.data,i*2);l.push(e)}for(let e=0,t=i;e<t;++e)for(let e=0,t=o;e<t;++e)iO.skipWhitespace(r),iO.markStart(r),iO.eatValue(r),aO.addUnchecked(l[e],r.tokenStart,r.tokenEnd);for(let e=0,t=o;e<t;++e){let{type:t,name:n}=a[e],r=eO(l[e],L_e(t));s.push(n),c.push(t),u.set(n,r)}n.push({kind:`table`,rowCount:i,propertyNames:s,propertyTypes:c,getProperty:e=>u.get(e)})}function z_e(e,t){let{elements:n,tokenizer:r}=e,{count:i,property:a}=t,o=aO.create(r.data,i*2*3),s=new Uint32Array(i+1),c=0;for(let e=0,t=i;e<t;++e){for(iO.skipWhitespace(r),iO.markStart(r);iO.skipWhitespace(r)!==10;)++c,iO.markStart(r),iO.eatValue(r),aO.addToken(o,r);s[e+1]=c}let l={entries:[],count:0},u=eO(o,L_e(a.dataType));n.push({kind:`list`,rowCount:i,name:a.name,type:a.dataType,value:e=>{let t=s[e]+1,n=u.value(t-1);for(let e=t,r=t+n;e<r;++e)l.entries[e-t]=u.value(e);return l.count=n,l}})}async function B_e(e,t){let n=N_e(e,t);t.update({message:`Parsing...`,current:0,max:e.length}),F_e(n),I_e(n);let{elements:r,elementSpecs:i,comments:a}=n,o=M_e(r,i.map(e=>e.name),a);return jD.success(o)}function V_e(e){return hb.create(`Parse PLY`,async t=>await B_e(e,t))}var{readLine:pk,skipWhitespace:H_e,eatValue:U_e,eatLine:W_e,markStart:mk}=iO,hk=/\s+/,G_e=/(^\*|REMARK)*/;function K_e(e,t){return{tokenizer:e,runtimeCtx:t}}async function q_e(e,t){let{tokenizer:n}=e,r=aO.create(n.data,t*2),i=aO.create(n.data,t*2),a=aO.create(n.data,t*2),o=aO.create(n.data,t*2),s=aO.create(n.data,t*2),c=aO.create(n.data,t*2),l=aO.create(n.data,t*2),u=aO.create(n.data,t*2),{position:d}=n,f=pk(n).trim();n.position=d;let p=f.split(hk).length===7,m=p?6:8,{length:h}=n,g=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let d=Math.min(t-g,e);for(let e=0;e<d;++e){for(let e=0;e<m;++e)if(H_e(n),mk(n),U_e(n),p)switch(e){case 0:aO.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:aO.addUnchecked(a,n.tokenStart,n.tokenEnd);break;case 2:aO.addUnchecked(s,n.tokenStart,n.tokenEnd);break;case 3:aO.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case 4:aO.addUnchecked(l,n.tokenStart,n.tokenEnd);break;case 5:aO.addUnchecked(u,n.tokenStart,n.tokenEnd);break}else switch(e){case 0:aO.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:aO.addUnchecked(i,n.tokenStart,n.tokenEnd);break;case 2:aO.addUnchecked(a,n.tokenStart,n.tokenEnd);break;case 3:aO.addUnchecked(o,n.tokenStart,n.tokenEnd);break;case 4:aO.addUnchecked(s,n.tokenStart,n.tokenEnd);break;case 5:aO.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case 6:aO.addUnchecked(l,n.tokenStart,n.tokenEnd);break;case 7:aO.addUnchecked(u,n.tokenStart,n.tokenEnd);break}W_e(n),mk(n)}return g+=d,d},e=>e.update({message:`Parsing...`,current:n.position,max:h})),{count:t,atomId:$D(r)(U.Schema.int),segmentName:p?$D(a)(U.Schema.str):$D(i)(U.Schema.str),residueId:$D(a)(U.Schema.int),residueName:p?$D(a)(U.Schema.str):$D(o)(U.Schema.str),atomName:$D(s)(U.Schema.str),atomType:$D(c)(U.Schema.str),charge:$D(l)(U.Schema.float),mass:$D(u)(U.Schema.float)}}async function J_e(e,t){let{tokenizer:n}=e,r=aO.create(n.data,t*2),i=aO.create(n.data,t*2),{length:a}=n,o=0;return await gb(e.runtimeCtx,10,void 0,e=>{let a=Math.min(t-o,e);for(let e=0;e<a;++e)for(let e=0;e<2;++e)switch(H_e(n),mk(n),U_e(n),e){case 0:aO.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:aO.addUnchecked(i,n.tokenStart,n.tokenEnd);break}return o+=a,a},e=>e.update({message:`Parsing...`,current:n.position,max:a})),{count:t,atomIdA:$D(r)(U.Schema.int),atomIdB:$D(i)(U.Schema.int)}}function Y_e(e,t){let n=[];for(let r=0;r<t;++r){let t=pk(e.tokenizer);n.push(t.replace(G_e,``).trim())}return n}async function X_e(e,t){let n=iO(e),r=K_e(n,t),i,a,o,s=pk(r.tokenizer).trim();for(;n.tokenEnd<n.length;){let e=pk(r.tokenizer).trim();if(e.includes(`!NTITLE`))i=Y_e(r,parseInt(e.split(hk)[0]));else if(e.includes(`!NATOM`))a=await q_e(r,parseInt(e.split(hk)[0]));else if(e.includes(`!NBOND`)){o=await J_e(r,parseInt(e.split(hk)[0]));break}else e.includes(`!NTHETA`)||e.includes(`!NPHI`)||e.includes(`!NIMPHI`)||e.includes(`!NDON`)||e.includes(`!NACC`)||e.includes(`!NNB`)||e.includes(`!NGRP NST2`)||e.includes(`!MOLNT`)||e.includes(`!NUMLP NUMLPH`)||e.includes(`!NCRTERM`)}if(i===void 0&&(i=[]),a===void 0)return jD.error(`no atoms data`);if(o===void 0)return jD.error(`no bonds data`);let c={id:s,title:i,atoms:a,bonds:o};return jD.success(c)}function Z_e(e){return hb.create(`Parse PSF`,async t=>await X_e(e,t))}var Q_e=.529177210859;function $_e(e){let t=iO.readLines(e,6),n=(e,n)=>{let r=+t[e].trim().split(/\s+/g)[n];return Number.isNaN(r)?0:r},r=e=>{let t=n(e+2,0),r=Q_e;return[Math.abs(t),B.create(n(e+2,1)*r,n(e+2,2)*r,n(e+2,3)*r),t]},i=t[0].trim(),a=t[1].trim(),[o,s,c]=r(0),[l,u]=r(1),[d,f]=r(2),[p,m]=r(3),h=eve(e,o,Q_e),g=[];if(c>=0){let e=n(2,4);e===0&&(e=1);for(let t=0;t<e;t++)g.push(t)}else{let t=iO.readLine(e).trim().split(/\s+/g);for(let e=0,n=+t[0];e<n;e++)g.push(+t[e+1])}return{header:{orbitals:c<0,comment1:i,comment2:a,atomCount:o,origin:s,dim:B.create(l,d,p),basisX:u,basisY:f,basisZ:m,dataSetIds:g},atoms:h}}function eve(e,t,n){let r=new Int32Array(t),i=new Float64Array(t),a=new Float32Array(t),o=new Float32Array(t),s=new Float32Array(t);for(let c=0;c<t;c++){let t=iO.readLine(e).trim().split(/\s+/g);r[c]=+t[0],i[c]=+t[1],a[c]=+t[2]*n,o[c]=+t[3]*n,s[c]=+t[4]*n}return{count:t,number:U.ofArray({array:r,schema:U.Schema.int}),nuclearCharge:U.ofArray({array:i,schema:U.Schema.float}),x:U.ofArray({array:a,schema:U.Schema.float}),y:U.ofArray({array:o,schema:U.Schema.float}),z:U.ofArray({array:s,schema:U.Schema.float})}}function tve(e,t,n){let r=n.dim[0]*n.dim[1]*n.dim[2]*n.dataSetIds.length,i=1e4*100,a=new Float64Array(r),o=0;return gb(e,i,a,(e,n)=>{let a=Math.min(r,o+e);for(let e=o;e<a;e++)iO.skipWhitespace(t),t.tokenStart=t.position,iO.eatValue(t),n[e]=UD(t.data,t.tokenStart,t.tokenEnd);return o=a,a===r?0:i},(e,t,n)=>e.update({current:Math.min(n,r),max:r}))}function nve(e,t){return hb.create(`Parse Cube`,async n=>{await n.update(`Reading header...`);let r=iO(e),{header:i,atoms:a}=$_e(r),o=await tve(n,r,i);return jD.success({header:i,atoms:a,values:o,name:t})})}function rve(e){let t={h:B()},n=0,r=0,i=/\s+/g;for(;;){let a=iO.readLine(e),o;if(a.startsWith(`object 1`))o=a.split(i),t.dim=B.create(parseInt(o[5]),parseInt(o[6]),parseInt(o[7]));else if(a.startsWith(`origin`))o=a.split(i),t.min=B.create(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if(a.startsWith(`delta`))o=a.split(i),r===0?t.h[0]=parseFloat(o[1]):r===1?t.h[1]=parseFloat(o[2]):r===2&&(t.h[2]=parseFloat(o[3])),r+=1;else if(a.startsWith(`object 3`)){n+=a.length+1;break}n+=a.length+1}return{header:t,headerByteCount:n}}function ive(e,t,n){let r=n.dim[0]*n.dim[1]*n.dim[2],i=1e4*100,a=new Float64Array(r),o=0;return gb(e,i,a,(e,n)=>{let a=Math.min(r,o+e);for(let e=o;e<a;e++)iO.skipWhitespace(t),t.tokenStart=t.position,iO.eatValue(t),n[e]=UD(t.data,t.tokenStart,t.tokenEnd);return o=a,a===r?0:i},(e,t,n)=>e.update({current:Math.min(n,r),max:r}))}async function ave(e,t,n){await e.update(`Reading header...`);let r=iO(t),{header:i}=rve(r);await e.update(`Reading values...`);let a=await ive(e,r,i);return jD.success({header:i,values:a,name:n})}async function ove(e,t,n){await e.update(`Reading header...`);let{header:r,headerByteCount:i}=rve(iO(Ky(t,0,1e3)));await e.update(`Reading values...`);let a=r.dim[0]*r.dim[1]*r.dim[2],o=new DataView(t.buffer,t.byteOffset+i),s=new Float64Array(a);for(let e=0;e<a;e++)s[e]=o.getFloat64(e*8,!0);return jD.success({header:r,values:s,name:n})}function sve(e,t){return hb.create(`Parse DX`,n=>By.is(e)?ave(n,e,t):ove(n,e,t))}const gk=rE({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});(function(){let e=new Map;return Object.keys(gk).forEach(t=>{e.set(gk[t],t)}),e})();var cve=Object.keys({NATOM:``,NTYPES:``,NBONH:``,MBONA:``,NTHETH:``,MTHETA:``,NPHIH:``,MPHIA:``,NHPARM:``,NPARM:``,NNB:``,NRES:``,NBONA:``,NTHETA:``,NPHIA:``,NUMBND:``,NUMANG:``,NPTRA:``,NATYP:``,NPHB:``,IFPERT:``,NBPER:``,NGPER:``,NDPER:``,MBPER:``,MGPER:``,MDPER:``,IFBOX:``,NMXRS:``,IFCAP:``,NUMEXTRA:``,NCOPY:``}),{readLine:_k,markLine:lve,trim:uve}=iO;function dve(e,t){return{tokenizer:e,runtimeCtx:t}}function fve(e){let{tokenizer:t}=e,n=[];for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!==`%`;){let e=_k(t).trim();e&&n.push(e)}return n}function pve(e){let{tokenizer:t}=e,n=Object.create(null);cve.forEach(e=>{n[e]=0});let r=0;for(;t.tokenEnd<t.length&&t.data.charAt(t.position)!==`%`;){let e=_k(t),i=Math.min(r+10,32);for(let t=0;r<i;++t,++r)n[cve[r]]=parseInt(e.substring(t*8,t*8+8).trim())}return n}function vk(e,t,n,r){let{tokenizer:i}=e,a=aO.create(i.data,t*2),o=0;for(;i.tokenEnd<i.length&&i.data.charAt(i.position)!==`%`;){i.tokenStart=i.position;let e=Math.min(o+n,t);for(let t=0;o<e;++t,++o){let e=i.position;uve(i,i.position,i.position+r),aO.addUnchecked(a,i.tokenStart,i.tokenEnd),i.position=e+r}lve(i)}return a}async function mve(e,t){let n=iO(e),r=dve(n,t),i=Object.create(null),a=0;for(;n.tokenEnd<n.length;){n.position-a>1e5&&t.shouldUpdate&&(a=n.position,await t.update({current:n.position,max:n.length}));let e=_k(r.tokenizer).trim();if(e.startsWith(`%VERSION`))i.version=e.substring(8).trim();else if(e.startsWith(`%FLAG`)){let t=e.substring(5).trim(),a=_k(r.tokenizer).trim();for(;a.startsWith(`%COMMENT`);)a=_k(r.tokenizer).trim();if(!a.startsWith(`%FORMAT`))throw Error(`expected %FORMAT got "${a}"`);if(t===`TITLE`||t===`CTITLE`)i.title=fve(r);else if(t===`POINTERS`)i.pointers=pve(r);else if(t===`ATOM_NAME`)i.atomName=$D(vk(r,i.pointers.NATOM,20,4))(U.Schema.str);else if(t===`CHARGE`)i.charge=$D(vk(r,i.pointers.NATOM,5,16))(U.Schema.float);else if(t===`MASS`)i.mass=$D(vk(r,i.pointers.NATOM,5,16))(U.Schema.float);else if(t===`RESIDUE_LABEL`)i.residueLabel=$D(vk(r,i.pointers.NRES,20,4))(U.Schema.str);else if(t===`RESIDUE_POINTER`)i.residuePointer=$D(vk(r,i.pointers.NRES,10,8))(U.Schema.int);else if(t===`BONDS_INC_HYDROGEN`)i.bondsIncHydrogen=$D(vk(r,i.pointers.NBONH*3,10,8))(U.Schema.int);else if(t===`BONDS_WITHOUT_HYDROGEN`)i.bondsWithoutHydrogen=$D(vk(r,i.pointers.NBONA*3,10,8))(U.Schema.int);else if(t===`RADII`)i.radii=$D(vk(r,i.pointers.NATOM,5,16))(U.Schema.float);else for(;n.tokenEnd<n.length&&n.data.charAt(n.position)!==`%`;)lve(n)}}return jD.success(i)}function hve(e){return hb.create(`Parse PRMTOP`,async t=>await mve(e,t))}var gve={nr:U.Schema.Int(),type:U.Schema.Str(),resnr:U.Schema.Int(),residu:U.Schema.Str(),atom:U.Schema.Str(),cgnr:U.Schema.Int(),charge:U.Schema.Float(),mass:U.Schema.Float()},_ve={ai:U.Schema.Int(),aj:U.Schema.Int()},vve={compound:U.Schema.Str(),molCount:U.Schema.Int()},{readLine:yk,markLine:bk,skipWhitespace:xk,markStart:Sk,eatValue:Ck,eatLine:yve}=iO;function bve(e,t){return{tokenizer:e,runtimeCtx:t}}var xve=/\[ (.+) \]/,Sve=/\s+/;function Cve(e){let{tokenizer:t}=e,n;for(;t.tokenEnd<t.length;){xk(t);let e=t.data.charAt(t.position);if(e===`[`)break;if(e===`;`||e===`*`){bk(t);continue}if(n!==void 0)throw Error(`more than one molName`);n=yk(t).split(Sve)[0]}if(n===void 0)throw Error(`missing molName`);return n}function wve(e){let{tokenizer:t}=e,n=aO.create(t.data,64),r=aO.create(t.data,64),i=aO.create(t.data,64),a=aO.create(t.data,64),o=aO.create(t.data,64),s=aO.create(t.data,64),c=aO.create(t.data,64),l=aO.create(t.data,64);for(;t.tokenEnd<t.length;){xk(t);let e=t.data.charAt(t.position);if(e===`[`)break;if(e===`;`||e===`*`){bk(t);continue}for(let e=0;e<8;++e)switch(xk(t),Sk(t),Ck(t),e){case 0:aO.add(n,t.tokenStart,t.tokenEnd);break;case 1:aO.add(r,t.tokenStart,t.tokenEnd);break;case 2:aO.add(i,t.tokenStart,t.tokenEnd);break;case 3:aO.add(a,t.tokenStart,t.tokenEnd);break;case 4:aO.add(o,t.tokenStart,t.tokenEnd);break;case 5:aO.add(s,t.tokenStart,t.tokenEnd);break;case 6:aO.add(c,t.tokenStart,t.tokenEnd);break;case 7:aO.add(l,t.tokenStart,t.tokenEnd);break}bk(t)}return QD.ofColumns(gve,{nr:$D(n)(U.Schema.int),type:$D(r)(U.Schema.str),resnr:$D(i)(U.Schema.int),residu:$D(a)(U.Schema.str),atom:$D(o)(U.Schema.str),cgnr:$D(s)(U.Schema.int),charge:$D(c)(U.Schema.float),mass:$D(l)(U.Schema.float)})}function Tve(e){let{tokenizer:t}=e,n=aO.create(t.data,64),r=aO.create(t.data,64);for(;t.tokenEnd<t.length;){xk(t);let e=t.data.charAt(t.position);if(e===`[`)break;if(e===`;`||e===`*`){bk(t);continue}for(let e=0;e<2;++e)switch(xk(t),Sk(t),Ck(t),e){case 0:aO.add(n,t.tokenStart,t.tokenEnd);break;case 1:aO.add(r,t.tokenStart,t.tokenEnd);break}bk(t)}return QD.ofColumns(_ve,{ai:$D(n)(U.Schema.int),aj:$D(r)(U.Schema.int)})}function Eve(e){let{tokenizer:t}=e,n;for(;t.tokenEnd<t.length;){xk(t);let e=t.data.charAt(t.position);if(e===`[`)break;if(e===`;`||e===`*`){bk(t);continue}if(n!==void 0)throw Error(`more than one system`);n=yk(t).trim()}if(n===void 0)throw Error(`missing system`);return n}function Dve(e){let{tokenizer:t}=e,n=aO.create(t.data,64),r=aO.create(t.data,64);for(;t.tokenEnd<t.length&&(xk(t),!(t.position>=t.length));){let e=t.data.charAt(t.position);if(e===`[`)break;if(e===`;`||e===`*`){bk(t);continue}for(let e=0;e<2;++e)switch(xk(t),Sk(t),Ck(t),e){case 0:aO.add(n,t.tokenStart,t.tokenEnd);break;case 1:aO.add(r,t.tokenStart,t.tokenEnd);break}yve(t),Sk(t)}return QD.ofColumns(vve,{compound:$D(n)(U.Schema.str),molCount:$D(r)(U.Schema.int)})}async function Ove(e,t){let n=iO(e),r=bve(n,t),i=Object.create(null),a=0;i.compounds={};let o={},s=``;function c(){s&&o.atoms&&(i.compounds[s]=o,o={},s=``)}for(;n.tokenEnd<n.length;){n.position-a>1e5&&t.shouldUpdate&&(a=n.position,await t.update({current:n.position,max:n.length}));let e=yk(r.tokenizer).trim();if(!(!e||e[0]===`*`||e[0]===`;`)){if(e.startsWith(`#include`))throw Error(`#include statements not allowed`);if(e.startsWith(`[`)){let t=e.match(xve);if(t===null)throw Error(`expected field name`);let a=t[1];if(a===`moleculetype`)c(),s=Cve(r);else if(a===`atoms`)o.atoms=wve(r);else if(a===`bonds`)o.bonds=Tve(r);else if(a===`system`)i.system=Eve(r);else if(a===`molecules`)c(),i.molecules=Dve(r);else for(;n.tokenEnd<n.length&&n.data.charAt(n.position)!==`[`;)bk(n)}}}return jD.success(i)}function kve(e){return hb.create(`Parse TOP`,async t=>await Ove(e,t))}var Ave=s({DeflateData:()=>Nve,Download:()=>jve,DownloadBlob:()=>Mve,ImportJson:()=>qve,ImportString:()=>Kve,LazyVolume:()=>Yve,ParseBlob:()=>Ive,ParseCcp4:()=>Uve,ParseCif:()=>Lve,ParseCube:()=>Rve,ParseDsn6:()=>Wve,ParseDx:()=>Gve,ParseJson:()=>Jve,ParsePly:()=>Hve,ParsePrmtop:()=>Bve,ParsePsf:()=>zve,ParseTop:()=>Vve,RawData:()=>Pve,ReadFile:()=>Fve}),jve=AD.BuiltIn({name:`download`,display:{name:`Download`,description:`Download string or binary data from the specified URL`},from:[H.Root],to:[H.Data.String,H.Data.Binary],params:{url:V.Url(`https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif`,{description:`Resource URL. Must be the same domain or support CORS.`}),label:V.Optional(V.Text(``)),isBinary:V.Optional(V.Boolean(!1,{description:`If true, download data as binary (string otherwise)`}))}})({apply({params:e,cache:t},n){return hb.create(`Download`,async r=>{let i=gx.getUrlAsset(n.managers.asset,e.url),a=await n.managers.asset.resolve(i,e.isBinary?`binary`:`string`).runInContext(r);return t.asset=a,e.isBinary?new H.Data.Binary(a.data,{label:e.label?e.label:i.url}):new H.Data.String(a.data,{label:e.label?e.label:i.url})})},dispose({cache:e}){var t;(t=e?.asset)==null||t.dispose()},update({oldParams:e,newParams:t,b:n}){return e.url!==t.url||e.isBinary!==t.isBinary?lE.UpdateResult.Recreate:e.label===t.label?lE.UpdateResult.Unchanged:(n.label=t.label||(typeof t.url==`string`?t.url:t.url.url),lE.UpdateResult.Updated)}}),Mve=AD.BuiltIn({name:`download-blob`,display:{name:`Download Blob`,description:`Download multiple string or binary data from the specified URLs.`},from:H.Root,to:H.Data.Blob,params:{sources:V.ObjectList({id:V.Text(``,{label:`Unique ID`}),url:V.Url(`https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif`,{description:`Resource URL. Must be the same domain or support CORS.`}),isBinary:V.Optional(V.Boolean(!1,{description:`If true, download data as binary (string otherwise)`})),canFail:V.Optional(V.Boolean(!1,{description:`Indicate whether the download can fail and not be included in the blob as a result.`}))},e=>`${e.id}: ${e.url}`),maxConcurrency:V.Optional(V.Numeric(4,{min:1,max:12,step:1},{description:`The maximum number of concurrent downloads.`}))}})({apply({params:e,cache:t},n){return hb.create(`Download Blob`,async r=>{let i=[],a=await dde(r,n.managers.asset,e.sources,e.maxConcurrency||4),o=[];for(let t=0;t<a.length;t++){let r=a[t],s=e.sources[t];r.kind===`error`?n.log.warn(`Download ${r.id} (${s.url}) failed: ${r.error}`):(o.push(r.result),i.push(s.isBinary?{id:r.id,kind:`binary`,data:r.result.data}:{id:r.id,kind:`string`,data:r.result.data}))}return t.assets=o,new H.Data.Blob(i,{label:`Data Blob`,description:`${i.length} ${i.length===1?`entry`:`entries`}`})})},dispose({cache:e},t){let n=e?.assets;if(n)for(let e of n)e.dispose()}}),Nve=AD.BuiltIn({name:`defalate-data`,display:{name:`Deflate`,description:`Deflate compressed data`},params:{method:V.Select(`gzip`,[[`gzip`,`gzip`]]),isString:V.Boolean(!1),stringEncoding:V.Optional(V.Select(`utf-8`,[[`utf-8`,`UTF8`]])),label:V.Optional(V.Text(``))},from:[H.Data.Binary],to:[H.Data.Binary,H.Data.String]})({apply({a:e,params:t},n){return hb.create(`Gzip`,async n=>{let r=await $b(n,e.data),i=t.label?t.label:e.label;if(t.isString){let e=qy(r);return new H.Data.String(e,{label:i})}return new H.Data.Binary(r,{label:i})})}}),Pve=AD.BuiltIn({name:`raw-data`,display:{name:`Raw Data`,description:`Raw data supplied by value.`},from:[H.Root],to:[H.Data.String,H.Data.Binary],params:{data:V.Value(``,{isHidden:!0}),label:V.Optional(V.Text(``))}})({apply({params:e}){return hb.create(`Raw Data`,async()=>{if(typeof e.data==`string`)return new H.Data.String(e.data,{label:e.label?e.label:`String`});if(Array.isArray(e.data)||e.data instanceof ArrayBuffer)return new H.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:`Binary`});if(e.data instanceof Uint8Array)return new H.Data.Binary(e.data,{label:e.label?e.label:`Binary`});Lb(e.data)})},update({oldParams:e,newParams:t,b:n}){return e.data===t.data?e.label===t.label?lE.UpdateResult.Unchanged:(n.label=t.label||n.label,lE.UpdateResult.Updated):lE.UpdateResult.Recreate},customSerialization:{toJSON(e){if(typeof e.data==`string`||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){let t=new Uint8Array(e.data),n=Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=t[e];return{data:n,label:e.label}}else if(e.data instanceof Uint8Array){let t=Array(e.data.length);for(let n=0,r=e.data.length;n<r;n++)t[n]=e.data[n];return{data:t,label:e.label}}},fromJSON(e){return e}}}),Fve=AD.BuiltIn({name:`read-file`,display:{name:`Read File`,description:`Read string or binary data from the specified file`},from:H.Root,to:[H.Data.String,H.Data.Binary],params:{file:V.File(),label:V.Optional(V.Text(``)),isBinary:V.Optional(V.Boolean(!1,{description:`If true, open file as as binary (string otherwise)`}))}})({apply({params:e,cache:t},n){return hb.create(`Open File`,async r=>{if(e.file===null)return n.log.error(`No file(s) selected`),Mx.Null;let i=await n.managers.asset.resolve(e.file,e.isBinary?`binary`:`string`).runInContext(r);return t.asset=i,e.isBinary?new H.Data.Binary(i.data,{label:e.label?e.label:e.file.name}):new H.Data.String(i.data,{label:e.label?e.label:e.file.name})})},dispose({cache:e}){var t;(t=e?.asset)==null||t.dispose()},update({oldParams:e,newParams:t,b:n}){return e.label===t.label?lE.UpdateResult.Unchanged:(n.label=t.label||e.file?.name||``,lE.UpdateResult.Updated)},isSerializable:()=>({isSerializable:!1,reason:`Cannot serialize user loaded files.`})}),Ive=AD.BuiltIn({name:`parse-blob`,display:{name:`Parse Blob`,description:`Parse multiple data enties`},from:H.Data.Blob,to:H.Format.Blob,params:{formats:V.ObjectList({id:V.Text(``,{label:`Unique ID`}),format:V.Select(`cif`,[[`cif`,`cif`]])},e=>`${e.id}: ${e.format}`)}})({apply({a:e,params:t},n){return hb.create(`Parse Blob`,async n=>{let r=new Map;for(let e of t.formats)r.set(e.id,e.format);let i=[];for(let t of e.data){if(!r.has(t.id))continue;let e=await(t.kind===`string`?dk.parse(t.data):dk.parseBinary(t.data)).runInContext(n);if(e.isError)throw Error(`${t.id}: ${e.message}`);i.push({id:t.id,kind:`cif`,data:e.result})}return new H.Format.Blob(i,{label:`Format Blob`,description:`${i.length} ${i.length===1?`entry`:`entries`}`})})}}),Lve=AD.BuiltIn({name:`parse-cif`,display:{name:`Parse CIF`,description:`Parse CIF from String or Binary data`},from:[H.Data.String,H.Data.Binary],to:H.Format.Cif})({apply({a:e}){return hb.create(`Parse CIF`,async t=>{let n=await dk.parse(e.data).runInContext(t);if(n.isError)throw Error(n.message);return n.result.blocks.length===0?Mx.Null:new H.Format.Cif(n.result)})}}),Rve=AD.BuiltIn({name:`parse-cube`,display:{name:`Parse Cube`,description:`Parse Cube from String data`},from:H.Data.String,to:H.Format.Cube})({apply({a:e}){return hb.create(`Parse Cube`,async t=>{let n=await nve(e.data,e.label).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Cube(n.result)})}}),zve=AD.BuiltIn({name:`parse-psf`,display:{name:`Parse PSF`,description:`Parse PSF from String data`},from:[H.Data.String],to:H.Format.Psf})({apply({a:e}){return hb.create(`Parse PSF`,async t=>{let n=await Z_e(e.data).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Psf(n.result)})}}),Bve=AD.BuiltIn({name:`parse-prmtop`,display:{name:`Parse PRMTOP`,description:`Parse PRMTOP from String data`},from:[H.Data.String],to:H.Format.Prmtop})({apply({a:e}){return hb.create(`Parse PRMTOP`,async t=>{let n=await hve(e.data).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Prmtop(n.result)})}}),Vve=AD.BuiltIn({name:`parse-top`,display:{name:`Parse TOP`,description:`Parse TOP from String data`},from:[H.Data.String],to:H.Format.Top})({apply({a:e}){return hb.create(`Parse TOP`,async t=>{let n=await kve(e.data).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Top(n.result)})}}),Hve=AD.BuiltIn({name:`parse-ply`,display:{name:`Parse PLY`,description:`Parse PLY from String data`},from:[H.Data.String],to:H.Format.Ply})({apply({a:e}){return hb.create(`Parse PLY`,async t=>{let n=await V_e(e.data).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Ply(n.result,{label:n.result.comments[0]||`PLY Data`})})}}),Uve=AD.BuiltIn({name:`parse-ccp4`,display:{name:`Parse CCP4/MRC/MAP`,description:`Parse CCP4/MRC/MAP from Binary data`},from:[H.Data.Binary],to:H.Format.Ccp4})({apply({a:e}){return hb.create(`Parse CCP4/MRC/MAP`,async t=>{let n=await ahe(e.data,e.label).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Ccp4(n.result)})}}),Wve=AD.BuiltIn({name:`parse-dsn6`,display:{name:`Parse DSN6/BRIX`,description:`Parse CCP4/BRIX from Binary data`},from:[H.Data.Binary],to:H.Format.Dsn6})({apply({a:e}){return hb.create(`Parse DSN6/BRIX`,async t=>{let n=await A_e(e.data,e.label).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Dsn6(n.result)})}}),Gve=AD.BuiltIn({name:`parse-dx`,display:{name:`Parse DX`,description:`Parse DX from Binary/String data`},from:[H.Data.Binary,H.Data.String],to:H.Format.Dx})({apply({a:e}){return hb.create(`Parse DX`,async t=>{let n=await sve(e.data,e.label).runInContext(t);if(n.isError)throw Error(n.message);return new H.Format.Dx(n.result)})}}),Kve=AD.BuiltIn({name:`import-string`,display:{name:`Import String`,description:`Import given data as a string`},from:H.Root,to:H.Data.String,params:{data:V.Value(``),label:V.Optional(V.Text(``))}})({apply({params:{data:e,label:t}}){return new H.Data.String(e,{label:t||``})},update({oldParams:e,newParams:t,b:n}){return e.data===t.data?e.label===t.label?lE.UpdateResult.Unchanged:(n.label=t.label||``,lE.UpdateResult.Updated):lE.UpdateResult.Recreate},isSerializable:()=>({isSerializable:!1,reason:`Cannot serialize user imported strings.`})}),qve=AD.BuiltIn({name:`import-json`,display:{name:`Import JSON`,description:`Import given data as a JSON`},from:H.Root,to:H.Format.Json,params:{data:V.Value({}),label:V.Optional(V.Text(``))}})({apply({params:{data:e,label:t}}){return new H.Format.Json(e,{label:t||``})},update({oldParams:e,newParams:t,b:n}){return e.data===t.data?e.label===t.label?lE.UpdateResult.Unchanged:(n.label=t.label||``,lE.UpdateResult.Updated):lE.UpdateResult.Recreate},isSerializable:()=>({isSerializable:!1,reason:`Cannot serialize user imported JSON.`})}),Jve=AD.BuiltIn({name:`parse-json`,display:{name:`Parse JSON`,description:`Parse JSON from String data`},from:[H.Data.String],to:H.Format.Json})({apply({a:e}){return hb.create(`Parse JSON`,async t=>{let n=await new Response(By.toString(e.data)).json();return new H.Format.Json(n)})}}),Yve=AD.BuiltIn({name:`lazy-volume`,display:{name:`Lazy Volume`,description:`A placeholder for lazy loaded volume representation`},from:H.Root,to:H.Volume.Lazy,params:{url:V.Url(``),isBinary:V.Boolean(!1),format:V.Text(`ccp4`),entryId:V.Value(``,{isHidden:!0}),isovalues:V.ObjectList({type:V.Text(`relative`),value:V.Numeric(0),color:V.Color(gk.black),alpha:V.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:V.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply({a:e,params:t}){return hb.create(`Lazy Volume`,async e=>{let n=Array.isArray(t.entryId)?t.entryId.join(`, `):t.entryId;return new H.Volume.Lazy(t,{label:`${n||t.url}`,description:`Lazy Volume`})})}}),Xve=s({CreateGroup:()=>Zve}),Zve=AD.BuiltIn({name:`create-group`,display:{name:`Group`},from:[],to:H.Group,params:{label:V.Text(`Group`),description:V.Optional(V.Text(``))}})({apply({params:e}){return new H.Group({},e)},update({oldParams:e,newParams:t,b:n}){return Dx(e,t)?lE.UpdateResult.Unchanged:(n.label=t.label,n.description=t.description,lE.UpdateResult.Updated)}});function Qve(e){let t=new DataView(e.buffer),n=Object.create(null),r=[],i=0,a=new Int32Array(e.buffer,0,23),o=a[0]!==t.getInt32(0);if(a[0]!==84){let n=e.byteLength;for(let e=0;e<n;e+=4)t.setFloat32(e,t.getFloat32(e),!0)}if(a[0]!==84)throw Error(`dcd bad format, header block start`);if(String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))!==`CORD`)throw Error(`dcd bad format, format string`);let s=!1,c=!1,l=!1;if(a[22]!==0&&(s=!0,a[12]!==0&&(c=!0),a[13]===1&&(l=!0)),n.NSET=a[2],n.ISTART=a[3],n.NSAVC=a[4],n.NAMNF=a[10],s?n.DELTA=t.getFloat32(44,o):n.DELTA=t.getFloat64(44,o),a[22]!==84)throw Error(`dcd bad format, header block end`);i=i+84+8;let u=t.getInt32(i,o),d=i+1;if((u-4)%80!=0)throw Error(`dcd bad format, title block start`);if(n.TITLE=mge(e.subarray(d,u)),t.getInt32(d+u+4-1,o)!==u)throw Error(`dcd bad format, title block end`);if(i=i+u+8,t.getInt32(i,o)!==4)throw Error(`dcd bad format, natom block start`);if(n.NATOM=t.getInt32(i+4,o),t.getInt32(i+8,o)!==4)throw Error(`dcd bad format, natom block end`);if(i=i+4+8,n.NAMNF>0)throw Error(`dcd format with fixed atoms unsupported, aborting`);let f=n.NATOM,p=f*4;for(let a=0,s=n.NSET;a<s;++a){let n=Object.create(null);n.elementCount=f,c&&(i+=4,n.cell=[t.getFloat64(i,o),t.getFloat64(i+1,o),t.getFloat64(i+16,o),t.getFloat64(i+24,o),t.getFloat64(i+32,o),t.getFloat64(i+40,o)],i+=48,i+=4);for(let r=0;r<3;++r){if(t.getInt32(i,o)!==p)throw Error(`dcd bad format, coord block start: ${a}, ${r}`);i+=4;let s=new Float32Array(e.buffer,i,f);if(r===0?n.x=s:r===1?n.y=s:n.z=s,i+=p,t.getInt32(i,o)!==p)throw Error(`dcd bad format, coord block end: ${a}, ${r}`);i+=4}if(l){let e=t.getInt32(i,o);i+=4+e+4}r.push(n)}return{header:n,frames:r}}function $ve(e){return hb.create(`Parse DCD`,async t=>{try{let t=Qve(e);return jD.success(t)}catch(e){return jD.error(e)}})}function eye(e){return function(t,n,r){return tye(e,t,n,r)}}function tye(e,t,n,r){let{data:i,indices:a,count:o}=e,{valueType:s}=r,c=s===`str`?e=>{let r=a[2*e]+t,o=a[2*e+1];if(r>=o)return``;let s=r+n;return s>o&&(s=o),Rhe(i,r,s)}:s===`int`?e=>{let r=a[2*e]+t;return r>a[2*e+1]?0:VD(i,r,r+n)}:e=>{let r=a[2*e]+t;return r>a[2*e+1]?0:che(i,r,r+n)};return{schema:r,__array:void 0,isDefined:!0,rowCount:o,value:c,valueKind:e=>U.ValueKinds.Present,toArray:e=>LD(o,c,e),areValuesEqual:(e,t)=>c(e)===c(t)}}function nye(){return{title:``,timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function rye(e,t){return{tokenizer:e,header:nye(),numberOfAtoms:0,runtimeCtx:t}}function iye(e){let{tokenizer:t,header:n}=e,r=iO.readLine(t);r.trim().length===0&&(r=iO.readLine(t));let i=r.lastIndexOf(`t=`);i>=0?(n.timeInPs=parseFloat(r.substring(i+2)),n.title=r.substring(0,i).trim(),n.title&&n.title[n.title.length-1]===`,`&&(n.title=n.title.substring(0,n.title.length-1))):n.title=r}function aye(e){let{tokenizer:t}=e;iO.markLine(t);let n=iO.getTokenString(t);e.numberOfAtoms=parseInt(n)}async function oye(e){let{tokenizer:t,numberOfAtoms:n}=e,r=await iO.readLinesAsync(t,n,e.runtimeCtx,1e5),i=t.data.substring(r.indices[0],r.indices[1]).substring(20).match(/\.\d+/g),a=i.length===6;e.header.hasVelocities=a,e.header.precision.position=i[0].length-1,e.header.precision.velocity=a?i[3].length-1:0;let o=e.header.precision.position+5,s=20+3*o,c=e.header.precision.velocity+4,l=eye(r),u=U.Undefined(e.numberOfAtoms,U.Schema.float);return{count:e.numberOfAtoms,residueNumber:l(0,5,U.Schema.int),residueName:l(5,5,U.Schema.str),atomName:l(10,5,U.Schema.str),atomNumber:l(15,5,U.Schema.int),x:l(20,o,U.Schema.float),y:l(20+o,o,U.Schema.float),z:l(20+2*o,o,U.Schema.float),vx:a?l(s,c,U.Schema.float):u,vy:a?l(s+c,c,U.Schema.float):u,vz:a?l(s+2*c,c,U.Schema.float):u}}function sye(e){let{tokenizer:t}=e,n=iO.readLine(t).trim().split(/\s+/g);e.header.box=[+n[0],+n[1],+n[2]]}async function cye(e,t){let n=iO(e);await t.update({message:`Parsing...`,current:0,max:e.length});let r=[];for(;n.position<e.length;){let e=rye(n,t);iye(e),aye(e);let i=await oye(e);sye(e),r.push({header:e.header,atoms:i})}let i={structures:r};return jD.success(i)}function lye(e){return hb.create(`Parse GRO`,async t=>await cye(e,t))}function uye(e,t,n=!1){return hb.create(`Parse PDB`,async r=>jD.success({lines:await iO.readAllLinesAsync(e,r),id:t,isPdbqt:n}))}function wk(e){return{kind:`table-legend`,table:e}}function dye(e,t,n){return{kind:`scale-legend`,minLabel:e,maxLabel:t,colors:n}}var Tk;(function(e){e.Zero=0;let{_int32:t,_float64:n,_int32_1:r,_float64_1:i}=function(){let e=new ArrayBuffer(8),t=new ArrayBuffer(8);return{_int32:new Int32Array(e),_float64:new Float64Array(e),_int32_1:new Int32Array(t),_float64_1:new Float64Array(t)}}();function a(e){return typeof e==`number`}e.is=a;function o(e,r){return t[0]=e,t[1]=r,n[0]}e.create=o;function s(e){return n[0]=e,t[1]-t[0]}e.diff=s;function c(e){return n[0]=e,t[0]}e.fst=c;function l(e){return n[0]=e,t[1]}e.snd=l;function u(e,a){return n[0]=e,i[0]=a,t[0]===r[0]&&t[1]===r[1]}e.areEqual=u;function d(e,a){n[0]=e,i[0]=a;let o=t[0]-r[0];return o===0?t[1]-r[1]:o}e.compare=d;function f(e,a,o){n[0]=e[a],i[0]=e[o];let s=t[0]-r[0];return s===0?t[1]-r[1]:s}e.compareInArray=f;function p(e){return n[0]=e,dE(t[0],t[1])}e.hashCode=p;function m(e){return n[0]=e,`(${t[0]}, ${t[1]})`}e.toString=m})(Tk||={});const fye=Tk.Zero;function pye(e,t){return t<e?Tk.create(e,e):Tk.create(e,t+1)}function Ek(e,t){return t<=e?Tk.create(e,e):Tk.create(e,t)}function mye(e){return e<0?Tk.create(0,0):Tk.create(0,e)}const hye=Tk.is,Dk=Tk.fst,Ok=Tk.snd,kk=Tk.fst;function Ak(e){return Tk.snd(e)-1}const jk=Tk.diff,gye=Tk.hashCode,_ye=Tk.toString;function vye(e,t){return Tk.fst(e)<=t&&t<Tk.snd(e)}function yye(e,t){let n=Dk(e);return t>=n&&t<Ok(e)?t-n:-1}function bye(e,t){return Tk.fst(e)+t}const xye=Tk.areEqual;function Sye(e,t){let n=jk(e),r=jk(t);return n===0&&r===0?!0:n>0&&r>0&&Ak(e)>=kk(t)&&kk(e)<=Ak(t)}function Cye(e,t){return jk(e)?jk(t)?Dk(e)<=Dk(t)&&Ok(e)>=Ok(t):!0:jk(t)===0}function Mk(e,t){let n=Dk(e);if(t<=n)return 0;let r=Ok(e);return t>=r?r-n:t-n}function wye(e,t,n){let r=Dk(n),i=Dk(e);if(t<=r+i)return r;let a=Ok(n);return t>=a+i?a:t-i}function Tye(e,t,n){return Ek(Mk(e,t),Mk(e,n+1))}function Eye(e,t){return Sye(e,t)?Ek(Math.max(Dk(e),Dk(t)),Math.min(Ok(e),Ok(t))):fye}function Dye(e,t){return jk(Tye(e,kk(t),Ak(t)))}function Oye(e,t){return Tk.create(Dk(e)+t,Ok(e)+t)}var G;(function(e){e.Empty=fye,e.ofSingleton=e=>pye(e,e),e.ofRange=pye,e.ofBounds=Ek,e.ofLength=mye,e.is=hye,e.has=vye,e.indexOf=yye,e.getAt=bye,e.start=Dk,e.end=Ok,e.min=kk,e.max=Ak,e.size=jk,e.hashCode=gye,e.toString=_ye,e.areEqual=xye,e.areIntersecting=Sye,e.isSubInterval=Cye,e.findPredecessorIndex=Mk,e.findPredecessorIndexInInterval=wye,e.findRange=Tye,e.intersectionSize=Dye,e.intersect=Eye,e.offset=Oye})(G||={});const Nk=[];function kye(e){return[e]}function Pk(e){return e}function Aye(e){return ZD(e),e}function jye(e,t){if(t<e)return[];let n=new Int32Array(t-e+1);for(let r=e;r<=t;r++)n[r-e]=r;return n}function Mye(e){return e&&(Array.isArray(e)||!!e.buffer)}function Nye(e){return e[e.length-1]-e[0]+1===e.length}function Fk(e){return e[0]}function Ik(e){return e[e.length-1]+1}function Pye(e){return e[0]}function Fye(e){return e[e.length-1]}function Iye(e){return e.length}function Lye(e){let t=e.length;return t?t>2?Lfe(t,e[0],e[t-1],e[t>>1]):Ife(t,e[0],e[t-1]):0}function Rye(e){let t=e.length;return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(`, `)}]`}function zye(e,t){let n=e.length;return n===0?-1:e[0]<=t&&t<=e[n-1]?Kye(e,t,0,n):-1}function Bye(e,t,n){return Vye(e,t,G.start(n),G.end(n))}function Vye(e,t,n,r){return e.length===0||r<=n?-1:e[n]<=t&&t<=e[r-1]?Kye(e,t,n,r):-1}function Hye(e,t){return zye(e,t)>=0}function Uye(e,t){if(e===t)return!0;let n=e.length;if(n!==t.length||e[0]!==t[0]||e[n-1]!==t[n-1])return!1;if(Nye(e))return!0;n--;for(let r=1;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Lk(e,t){return qye(e,t,0,e.length)}function Wye(e,t,n){return qye(e,t,G.start(n),G.end(n))}function Gye(e,t,n){return G.ofBounds(Lk(e,t),Lk(e,n+1))}function Kye(e,t,n,r){let i=n,a=r-1;for(;i<=a;){if(i+11>a){for(let n=i;n<=a;n++)if(t===e[n])return n;return-1}let n=i+a>>1,r=e[n];if(t<r)a=n-1;else if(t>r)i=n+1;else return n}return-1}function qye(e,t,n,r){if(n===r||e[n]>=t)return n;if(e[r-1]<t)return r;let i=n,a=r;for(;a-i>4;){let n=i+a>>1;e[n]>=t?a=n:i=n+1}for(let n=i;n<a;n++)if(e[n]>=t)return n;return a}function Jye(e,t){if(e===t)return!0;let{startI:n,startJ:r,endI:i,endJ:a}=Bk(e,t);for(;n<i&&r<a;){let i=e[n],a=t[r];if(i<a)n++;else if(i>a)r++;else return!0}return!1}function Yye(e,t){if(e===t)return!0;let n=t.length,{startI:r,startJ:i,endI:a,endJ:o}=Bk(e,t);if(o-i<n||a-r<n)return!1;let s=0;for(;r<a&&i<o;){let n=e[r],a=t[i];n<a?r++:n>a?i++:(r++,i++,s++)}return s===n}function Xye(e,t){if(e===t)return e;let n=e.length,r=t.length;if(n===0)return t;if(r===0)return e;if(e[0]>t[0])return Xye(t,e);let{startI:i,startJ:a,endI:o,endJ:s}=Bk(e,t),c=Rk(e,t,i,a,o,s);if(c===n&&c===r||c===r)return e;if(c===n)return t;let l=new Int32Array(n+r-c),u=0,d=0,f=0;for(u=0;u<i;u++)l[f++]=e[u];for(;d<s&&e[i]>t[d];)l[f++]=t[d++];for(;u<o&&d<s;){let n=e[u],r=t[d];n<r?(l[f++]=n,u++):n>r?(l[f++]=r,d++):(l[f++]=n,u++,d++)}for(;u<o;u++)l[f++]=e[u];for(;d<s;d++)l[f++]=t[d];for(;u<n;u++)l[f++]=e[u];for(;d<r;d++)l[f++]=t[d];return Pk(l)}function Zye(e,t){if(e===t)return Iye(e);let{startI:n,startJ:r,endI:i,endJ:a}=Bk(e,t);return Rk(e,t,n,r,i,a)}function Rk(e,t,n,r,i,a){let o=n,s=r,c=0;for(;o<i&&s<a;){let n=e[o],r=t[s];n<r?o++:n>r?s++:(o++,s++,c++)}return c}function Qye(e,t){if(e===t)return e;let{startI:n,startJ:r,endI:i,endJ:a}=Bk(e,t),o=Rk(e,t,n,r,i,a),s=e.length,c=t.length;if(!o)return Nk;if(o===s&&o===c||o===c)return t;if(o===s)return e;let l=new Int32Array(o),u=0,d=n,f=r;for(;d<i&&f<a;){let n=e[d],r=t[f];n<r?d++:n>r?f++:(l[u++]=n,d++,f++)}return Pk(l)}function $ye(e,t){if(e===t)return Nk;let n=e.length,{startI:r,startJ:i,endI:a,endJ:o}=Bk(e,t),s=r,c=i,l=0;for(;s<a&&c<o;){let n=e[s],r=t[c];n<r?s++:n>r?c++:(s++,c++,l++)}if(!l)return e;if(l>=n)return Nk;let u=new Int32Array(n-l),d=0;for(let t=0;t<r;t++)u[d++]=e[t];for(s=r,c=i;s<a&&c<o;){let n=e[s],r=t[c];n<r?(u[d++]=n,s++):(n>r||s++,c++)}for(;s<n;s++)u[d++]=e[s];return Pk(u)}function ebe(e){if(e.length<2)return e;let t=1;for(let n=0,r=e.length-1;n<r;n++)e[n]!==e[n+1]&&t++;if(t===e.length)return e;let n=new Int32Array(t),r=0;for(let t=0,i=e.length-1;t<i;t++)e[t]!==e[t+1]&&(n[r++]=e[t]);return n[r]=e[e.length-1],n}function tbe(e,t){if(Uye(e,t))return Pk(hx(0,e.length-1));let{startI:n,startJ:r,endI:i,endJ:a}=Bk(e,t),o=n,s=r,c=0;for(;o<i&&s<a;){let n=e[o],r=t[s];n<r?o++:n>r?s++:(o++,s++,c++)}let l=e.length;if(!c)return Nk;if(c===l)return Pk(hx(0,e.length-1));let u=new Int32Array(c),d=0;for(o=n,s=r;o<i&&s<a;){let n=e[o],r=t[s];n<r?o++:n>r?s++:(u[d++]=o,o++,s++)}return Pk(u)}var zk={startI:0,startJ:0,endI:0,endJ:0};function Bk(e,t){let n=e.length,r=t.length,i=n/r;return n>=128||r>=128||i<=.34||i>=2.99?(zk.startI=Lk(e,Fk(t)),zk.startJ=Lk(t,Fk(e)),zk.endI=Lk(e,Ik(t)),zk.endJ=Lk(t,Ik(e))):(zk.startI=0,zk.startJ=0,zk.endI=n,zk.endJ=r),zk}var Vk;(function(e){e.Empty=Nk,e.ofUnsortedArray=Aye,e.ofSingleton=kye,e.ofSortedArray=Pk,e.ofRange=jye,e.ofBounds=(e,t)=>jye(e,t-1),e.is=Mye,e.isRange=Nye,e.has=Hye,e.indexOf=zye,e.indexOfInInterval=Bye,e.indexOfInRange=Vye,e.start=Fk,e.end=Ik,e.min=Pye,e.max=Fye,e.size=Iye,e.hashCode=Lye,e.toString=Rye,e.areEqual=Uye,e.areIntersecting=Jye,e.isSubset=Yye,e.union=Xye,e.intersect=Qye,e.subtract=$ye,e.findPredecessorIndex=Lk,e.findPredecessorIndexInInterval=Wye,e.findRange=Gye,e.intersectionSize=Zye,e.deduplicate=ebe,e.indicesOf=tbe})(Vk||={});const nbe={domain:[0,1],reverse:!1,listOrName:`red-yellow-blue`,minLabel:``,maxLabel:``};var Hk;(function(e){function t(e){return r(e,`continuous`)}e.create=t;function n(e){return r(e,`discrete`)}e.createDiscrete=n;function r(e,t){let{domain:n,reverse:r,listOrName:c}={...nbe,...e},l=typeof c==`string`?sE(c).list:c,u=r?l.slice().reverse():l,d=0,f=0,p=0;function m(e,t){f=e,p=t,d=p-f||1}m(n[0],n[1]);let h=Ox(e.minLabel,f.toString()),g=Ox(e.maxLabel,p.toString()),_;if(u.every(e=>Array.isArray(e))){let e=[...u];e.sort((e,t)=>e[1]-t[1]);let n=e.map(e=>e[0]),r=Vk.ofSortedArray(e.map(e=>e[1])),a=n.length-1;switch(t){case`continuous`:_=e=>i(e,n,r,f,a,d);break;case`discrete`:_=e=>o(e,n,r,f,a,d);break}}else switch(t){case`continuous`:_=e=>a(e,u,f,d);break;case`discrete`:_=e=>s(e,u,f,p,d);break}return{color:_,colorToArray:(e,t,n)=>{tE.toArray(_(e),t,n)},normalizedColorToArray:(e,t,n)=>{tE.toArrayNormalized(_(e),t,n)},setDomain:m,get legend(){return dye(h,g,u)}}}function i(e,t,n,r,i,a){let o=DT((e-r)/a,0,1),s=Vk.findPredecessorIndex(n,o);if(s===0)return t[0];if(s>i)return t[i];let c=n[s-1],l=n[s],u=DT((o-c)/(l-c),0,1);return tE.interpolate(t[s-1],t[s],u)}function a(e,t,n,r){let i=Math.min(t.length-1,Math.max(0,(e-n)/r*(t.length-1))),a=Math.floor(i),o=t[a],s=t[Math.ceil(i)];return tE.interpolate(o,s,i-a)}function o(e,t,n,r,i,a){if(t.length===0)return tE.fromRgb(0,0,0);let o=DT((e-r)/a,0,1),s=Vk.findPredecessorIndex(n,o);return s===0?t[0]:s>i?t[i]:t[s]}function s(e,t,n,r,i){if(t.length===0)return tE.fromRgb(0,0,0);let a=i/t.length;return e<=n?t[0]:e>=r?t[t.length-1]:t[Math.min(t.length-1,Math.floor((e-n)/a))]}})(Hk||={});const Uk=G.Empty,rbe=G.ofSingleton,ibe=G.ofRange,abe=G.ofBounds;function Wk(e){return e.length?Vk.isRange(e)?G.ofRange(e[0],e[e.length-1]):e:Uk}function Gk(e){return G.is(e)?G.size(e):Vk.size(e)}function obe(e,t){return G.is(e)?G.has(e,t):Vk.has(e,t)}function sbe(e,t){return G.is(e)?G.indexOf(e,t):Vk.indexOf(e,t)}function Kk(e,t){return G.is(e)?G.getAt(e,t):e[t]}function qk(e){return G.is(e)?G.min(e):Vk.min(e)}function Jk(e){return G.is(e)?G.max(e):Vk.max(e)}function cbe(e){return G.is(e)?G.start(e):Vk.start(e)}function lbe(e){return G.is(e)?G.end(e):Vk.end(e)}function ube(e){return Gk(e)===0}function dbe(e){return G.is(e)?G.hashCode(e):Vk.hashCode(e)}function fbe(e){return G.is(e)?G.toString(e):Vk.toString(e)}function pbe(e,t){return G.is(e)?G.is(t)?G.areEqual(e,t):Cbe(e,t):G.is(t)?Cbe(t,e):Vk.areEqual(e,t)}function mbe(e,t){return G.is(e)?G.is(t)?G.areIntersecting(e,t):wbe(t,e):G.is(t)?wbe(e,t):Vk.areIntersecting(e,t)}function hbe(e,t){return G.is(e)?G.is(t)?G.isSubInterval(e,t):Ebe(e,t):G.is(t)?Tbe(e,t):Vk.isSubset(e,t)}function gbe(e,t){return G.is(e)?G.findPredecessorIndex(e,t):Vk.findPredecessorIndex(e,t)}function _be(e,t,n){return G.is(e)?G.findPredecessorIndexInInterval(e,t,n):Vk.findPredecessorIndexInInterval(e,t,n)}function vbe(e,t,n){return G.is(e)?G.findRange(e,t,n):Vk.findRange(e,t,n)}function ybe(e,t){return G.is(e)?G.is(t)?G.intersectionSize(e,t):jbe(t,e):G.is(t)?jbe(e,t):Vk.intersectionSize(e,t)}function bbe(e,t){return G.is(e)?G.is(t)?kbe(e,t):Abe(t,e):G.is(t)?Abe(e,t):Wk(Vk.union(e,t))}function xbe(e,t){return G.is(e)?G.is(t)?G.intersect(e,t):Mbe(t,e):G.is(t)?Mbe(e,t):Wk(Vk.intersect(e,t))}function Sbe(e,t){return G.is(e)?G.is(t)?Nbe(e,t):Fbe(e,t):G.is(t)?Pbe(e,t):Wk(Vk.subtract(e,t))}function Cbe(e,t){return G.size(e)===Vk.size(t)&&G.start(e)===Vk.start(t)&&G.end(e)===Vk.end(t)}function wbe(e,t){return e.length!==0&&G.size(Vk.findRange(e,G.min(t),G.max(t)))!==0}function Tbe(e,t){let n=G.min(t),r=G.max(t);if(r-n+1===0)return!0;let i=Vk.min(e),a=Vk.max(e);if(n<i||r>a)return!1;let o=Vk.findRange(e,n,r);return G.size(o)===G.size(t)}function Ebe(e,t){let n=G.min(e),r=G.max(e);if(r-n+1===0)return!1;let i=Vk.min(t),a=Vk.max(t);return i>=n&&a<=r}function Dbe(e,t){let n=Gk(e),r=Gk(t);return n===0&&r===0?!0:n>0&&r>0&&Jk(e)>=qk(t)&&qk(e)<=Jk(t)}function Obe(e,t){return Gk(e)?Gk(t)?qk(e)<=qk(t)&&Jk(e)>=Jk(t):!0:Gk(t)===0}function kbe(e,t){if(G.areEqual(e,t))return e;let n=G.size(e),r=G.size(t);if(!r)return e;if(!n)return t;let i=G.min(e),a=G.min(t);if(Dbe(e,t))return G.ofRange(Math.min(i,a),Math.max(G.max(e),G.max(t)));let o,s,c,l;i<a?(o=n,s=i,c=r,l=a):(o=r,s=a,c=n,l=i);let u=new Int32Array(n+r);for(let e=0;e<o;e++)u[e]=e+s;for(let e=0;e<c;e++)u[e+o]=e+l;return Wk(u)}function Abe(e,t){let n=G.size(t);if(!n)return e;if(Obe(t,e))return t;let r=G.min(t),i=G.max(t),a=Vk.findRange(e,r,i),o=G.start(a),s=G.end(a),c=new Int32Array(o+(e.length-s)+n),l=0;for(let t=0;t<o;t++)c[l++]=e[t];for(let e=r;e<=i;e++)c[l++]=e;for(let t=s,n=e.length;t<n;t++)c[l++]=e[t];return Wk(c)}function jbe(e,t){if(!G.size(t))return 0;let n=Vk.findRange(e,G.min(t),G.max(t));return G.end(n)-G.start(n)}function Mbe(e,t){if(!G.size(t))return Uk;let n=Vk.findRange(e,G.min(t),G.max(t)),r=G.start(n),i=G.end(n),a=i-r;if(!a)return Uk;if(a===e.length)return e;let o=new Int32Array(a),s=0;for(let t=r;t<i;t++)o[s++]=e[t];return Wk(o)}function Nbe(e,t){if(G.areEqual(e,t))return Uk;if(!G.areIntersecting(e,t))return e;let n=G.min(e),r=G.max(e),i=G.min(t),a=G.max(t);if(r<n||a<i)return e;if(G.isSubInterval(t,e))return Uk;if(G.isSubInterval(e,t)){let e=i-n,t=r-a;if(e<=0)return G.ofRange(a+1,a+t);if(t<=0)return G.ofRange(n,n+e-1);let o=new Int32Array(e+t),s=0;for(let t=0;t<e;t++)o[s++]=n+t;for(let e=1;e<=t;e++)o[s++]=a+e;return Wk(o)}return n<i?G.ofRange(n,i-1):G.ofRange(a+1,r)}function Pbe(e,t){let n=G.min(t),r=G.max(t);if(r<n)return e;let i=Vk.findRange(e,n,r),a=G.start(i),o=G.end(i),s=e.length-(o-a);if(s<=0)return Uk;if(s===e.length)return e;let c=new Int32Array(s),l=0;for(let t=0;t<a;t++)c[l++]=e[t];for(let t=o,n=e.length;t<n;t++)c[l++]=e[t];return Wk(c)}function Fbe(e,t){let n=G.min(e),r=G.max(e);if(r<n)return e;let i=r-n+1,a=Vk.findRange(t,n,r),o=G.start(a),s=G.end(a),c=s-o;if(c===0)return e;let l=i-c;if(l<=0)return Uk;let u=new Int32Array(l),d=t.length-1,f=t[Math.min(o,d)],p=t[Math.min(s,d)],m=0;for(let e=n;e<f;e++)u[m++]=e;for(let e=f;e<=p;e++)Vk.indexOfInInterval(t,e,a)<0&&(u[m++]=e);for(let e=p+1;e<=r;e++)u[m++]=e;return Wk(u)}function Ibe(e,t,n){if(G.is(e)){let r=G.min(e);for(let i=r,a=G.max(e);i<=a;i++)t(i,i-r,n)}else for(let r=0,i=e.length;r<i;r++)t(e[r],r,n);return n}function Lbe(e,t,n,r){if(G.is(e)){let i=0;for(let a=G.min(e),o=G.max(e);a<=o;a++){let e=t(a),s=a+1;for(;s<o&&t(s)===e;)s++;a=s-1,n(e,i,r),i++}}else{let i=0;for(let a=0,o=e.length;a<o;a++){let s=t(e[a]),c=a+1;for(;c<o&&t(e[c])===s;)c++;a=c-1,n(s,i,r),i++}}return r}function Rbe(e,t,n){if(t===n)return e;let r=Gk(e),i=t.length,a=n.length;if(r===0||i===0||a===0)return Uk;let o=Vk.findPredecessorIndex(n,t[qk(e)]),s=Vk.findPredecessorIndex(n,t[Jk(e)]+1),c=0,l=0,u=0,d=o;for(;u<r&&d<s;){let r=t[Kk(e,u)],i=n[d];r<i?u++:r>i?d++:(c++,u++,d++)}if(c===0)return Uk;if(c===i&&c===a)return e;let f=new Int32Array(c);for(l=0,u=0,d=o;u<r&&d<s;){let r=t[Kk(e,u)],i=n[d];r<i?u++:r>i?d++:(f[l++]=d,u++,d++)}return Wk(f)}var K;(function(e){e.Empty=Uk,e.ofSingleton=rbe,e.ofRange=ibe,e.ofBounds=abe,e.ofSortedArray=Wk,e.has=obe,e.indexOf=sbe,e.getAt=Kk,e.isEmpty=ube,e.min=qk,e.max=Jk,e.start=cbe,e.end=lbe,e.size=Gk,e.hashCode=dbe,e.areEqual=pbe,e.areIntersecting=mbe,e.isSubset=hbe,e.union=bbe,e.intersect=xbe,e.indexedIntersect=Rbe,e.subtract=Sbe,e.findPredecessorIndex=gbe,e.findPredecessorIndexInInterval=_be,e.findRange=vbe,e.intersectionSize=ybe;function t(e,t,n){return Ibe(e,t,n)}e.forEach=t;function n(e,t,n,r){return Lbe(e,t,n,r)}e.forEachSegment=n;function r(e){return G.is(e)}e.isInterval=r;function i(e){return!G.is(e)}e.isSortedArray=i;function a(t){let n=[];return e.forEach(t,e=>n.push(e)),n}e.toArray=a;function o(e){return fbe(e)}e.toString=o})(K||={});function Yk(){return Yk.empty()}(function(e){function t(e,t,n,r){return{origin:e,dirA:t,dirB:n,dirC:r}}e.create=t;function n(){return{origin:B(),dirA:B(),dirB:B(),dirC:B()}}e.empty=n;function r(e,t){return B.copy(e.origin,t.origin),B.copy(e.dirA,t.dirA),B.copy(e.dirB,t.dirB),B.copy(e.dirC,t.dirC),e}e.copy=r;function i(e){return r(n(),e)}e.clone=i;function a(e,t){return B.set(e,B.magnitude(t.dirA)*2,B.magnitude(t.dirB)*2,B.magnitude(t.dirC)*2)}e.size=a;let o=B();function s(e){return a(o,e),o[0]*o[1]*o[2]}e.volume=s;function c(e,t){return B.copy(e.origin,t.origin),B.normalize(e.dirA,t.dirA),B.normalize(e.dirB,t.dirB),B.normalize(e.dirC,t.dirC),e}e.normalize=c;let l=TT();function u(e,t,n){B.transformMat4(e.origin,t.origin,n);let r=TT.directionTransform(l,n);return B.transformMat3(e.dirA,t.dirA,r),B.transformMat3(e.dirB,t.dirB,r),B.transformMat3(e.dirC,t.dirC,r),e}e.transform=u;function d(e,t,n){return B.scale(e.dirA,t.dirA,n),B.scale(e.dirB,t.dirB,n),B.scale(e.dirC,t.dirC,n),e}e.scale=d})(Yk||={});var Xk;(function(e){function t(e,t,n=Float32Array){let r=e*t;return{data:new n(r),size:r,cols:e,rows:t}}e.create=t;function n(e,t,n){return e.data[e.rows*n+t]}e.get=n;function r(e,t,n,r){return e.data[e.rows*n+t]=r,e}e.set=r;function i(e,t,n,r){return e.data[e.rows*n+t]+=r,e}e.add=i;function a(e){return e.data.fill(0),e}e.makeZero=a;function o(e){return{data:e.data.slice(),size:e.size,cols:e.cols,rows:e.rows}}e.clone=o;function s(e,t,n){return{data:e,size:t*n,cols:t,rows:n}}e.fromArray=s;function c(e,t){if(e.cols!==t.rows||e.rows!==t.cols)throw Error(`transpose: matrix dimensions incompatible`);if(e.data===t.data)throw Error(`transpose: matrices share memory`);let n=t.rows,r=t.cols,i=t.data,a=e.data;for(let e=0,t=0,o=0;e<n;o+=1,t+=r,++e){let e=o;for(let o=0;o<r;e+=n,o++)a[e]=i[t+o]}return e}e.transpose=c;function l(e,t,n){let r=t.cols,i=t.rows,a=n.rows,o=t.data,s=n.data,c=e.data;for(let e=0,t=0,n=0;e<i;t+=r,e++)for(let e=0,i=0;i<a;n++,i++){let i=0,a=t;for(let t=0;t<r;a++,e++,t++)i+=o[a]*s[e];c[n]=i}return e}e.multiplyABt=l;function u(e){let t=e.rows,n=e.cols,r=e.data,i=Array(n);for(let e=0;e<n;++e)i[e]=0;for(let e=0,a=0;e<t;++e)for(let e=0;e<n;++e,++a)i[e]+=r[a];for(let e=0;e<n;++e)i[e]/=t;return i}e.meanRows=u;function d(e,t){let n=e.rows,r=e.cols,i=e.data;for(let e=0,a=0;e<n;++e)for(let e=0;e<r;++e,++a)i[a]-=t[e];return e}e.subRows=d})(Xk||={});function Zk(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r}function zbe(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var Bbe=1.192092896e-7,Vbe=1e-37;function Hbe(e,t,n,r,i,a,o,s){let c=Bbe*2,l=Vbe,u=0,d=0,f=0,p=0,m=Math.max(a,30),h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=0,j=0,M=4660,N=0,ee=0,te=0,P=new Float64Array(o<<3);for(;u<o;u++){for(f=0,T=0;f<a;f++)S=e[u*t+f],T+=S*S;if(P[u]=T,r){for(f=0;f<o;f++)r[u*i+f]=0;r[u*i+u]=1}}for(;p<m;p++){for(y=0,u=0;u<o-1;u++)for(d=u+1;d<o;d++){for(h=u*t|0,g=d*t|0,k=P[u],A=0,j=P[d],f=2,A+=e[h]*e[g],A+=e[h+1]*e[g+1];f<a;f++)A+=e[h+f]*e[g+f];if(!(Math.abs(A)<=c*Math.sqrt(k*j))){for(A*=2,E=k-j,D=zbe(A,E),E<0?(O=(D-E)*.5,x=Math.sqrt(O/D),b=A/(D*x*2)):(b=Math.sqrt((D+E)/(D*2)),x=A/(D*b*2)),k=0,j=0,f=2,C=b*e[h]+x*e[g],w=-x*e[h]+b*e[g],e[h]=C,e[g]=w,k+=C*C,j+=w*w,C=b*e[h+1]+x*e[g+1],w=-x*e[h+1]+b*e[g+1],e[h+1]=C,e[g+1]=w,k+=C*C,j+=w*w;f<a;f++)C=b*e[h+f]+x*e[g+f],w=-x*e[h+f]+b*e[g+f],e[h+f]=C,e[g+f]=w,k+=C*C,j+=w*w;if(P[u]=k,P[d]=j,y=1,r)for(_=u*i|0,v=d*i|0,f=2,C=b*r[_]+x*r[v],w=-x*r[_]+b*r[v],r[_]=C,r[v]=w,C=b*r[_+1]+x*r[v+1],w=-x*r[_+1]+b*r[v+1],r[_+1]=C,r[v+1]=w;f<o;f++)C=b*r[_+f]+x*r[v+f],w=-x*r[_+f]+b*r[v+f],r[_+f]=C,r[v+f]=w}}if(y===0)break}for(u=0;u<o;u++){for(f=0,T=0;f<a;f++)S=e[u*t+f],T+=S*S;P[u]=Math.sqrt(T)}for(u=0;u<o-1;u++){for(d=u,f=u+1;f<o;f++)P[d]<P[f]&&(d=f);if(u!==d&&(Zk(P,u,d,T),r)){for(f=0;f<a;f++)Zk(e,u*t+f,d*t+f,S);for(f=0;f<o;f++)Zk(r,u*i+f,d*i+f,S)}}for(u=0;u<o;u++)n[u]=P[u];if(r)for(u=0;u<s;u++){for(T=u<o?P[u]:0;T<=l;){for(ee=1/a,f=0;f<a;f++)M=M*214013+2531011,N=M>>16&256?ee:-ee,e[u*t+f]=N;for(p=0;p<2;p++)for(d=0;d<u;d++){for(T=0,f=0;f<a;f++)T+=e[u*t+f]*e[d*t+f];for(te=0,f=0;f<a;f++)S=e[u*t+f]-T*e[d*t+f],e[u*t+f]=S,te+=Math.abs(S);for(te=te?1/te:0,f=0;f<a;f++)e[u*t+f]*=te}for(T=0,f=0;f<a;f++)S=e[u*t+f],T+=S*S;T=Math.sqrt(T)}for(x=1/T,f=0;f<a;f++)e[u*t+f]*=x}}function Ube(e,t,n,r){let i=0,a=0,o=e.rows,s=e.cols,c=o,l=s;c<l&&(i=1,a=c,c=l,l=a);let u=Xk.create(c,c),d=Xk.create(1,l),f=Xk.create(l,l);if(i===0)Xk.transpose(u,e);else{for(a=0;a<s*o;a++)u.data[a]=e.data[a];for(;a<l*c;a++)u.data[a]=0}if(Hbe(u.data,c,d.data,f.data,l,c,l,c),t){for(a=0;a<l;a++)t.data[a]=d.data[a];for(;a<s;a++)t.data[a]=0}i===0?(n&&Xk.transpose(n,u),r&&Xk.transpose(r,f)):(n&&Xk.transpose(n,f),r&&Xk.transpose(r,u))}var Qk;(function(e){function t(e){let t=n(e);return{momentsAxes:t,boxAxes:a(e,t)}}e.ofPositions=t;function n(e){if(e.length===3)return Yk.create(B.fromArray(B(),e,0),B.create(1,0,0),B.create(0,1,0),B.create(0,0,1));let t=Xk.fromArray(e,3,e.length/3),n=t.rows,r=n/3,i=Xk.create(3,3),a=Xk.create(1,3),o=Xk.create(3,3),s=Xk.create(3,3),c=Xk.meanRows(t),l=Xk.subRows(Xk.clone(t),c),u=Xk.transpose(Xk.create(n,3),l);Xk.multiplyABt(i,u,u),Ube(i,a,o,s);let d=B.create(c[0],c[1],c[2]),f=B.create(o.data[0],o.data[3],o.data[6]),p=B.create(o.data[1],o.data[4],o.data[7]),m=B.create(o.data[2],o.data[5],o.data[8]);return B.scale(f,f,Math.sqrt(a.data[0]/r)),B.scale(p,p,Math.sqrt(a.data[1]/r)),B.scale(m,m,Math.sqrt(a.data[2]/r)),Yk.create(d,f,p,m)}e.calculateMomentsAxes=n;function r(e){let t=Yk.clone(e);return B.magnitude(t.dirC)<1e-6&&B.cross(t.dirC,t.dirA,t.dirB),Yk.normalize(t,t)}e.calculateNormalizedAxes=r;let i=B();function a(e,t){if(e.length===3)return Yk.clone(t);let n=-1/0,a=-1/0,o=-1/0,s=-1/0,c=-1/0,l=-1/0,u=B(),d=B(),f=t.origin,p=r(t);for(let t=0,r=e.length;t<r;t+=3){B.projectPointOnVector(u,B.fromArray(u,e,t),p.dirA,f);let r=B.dot(p.dirA,B.normalize(d,B.sub(d,u,f))),i=B.distance(u,f);r>0?i>n&&(n=i):i>a&&(a=i),B.projectPointOnVector(u,B.fromArray(u,e,t),p.dirB,f);let m=B.dot(p.dirB,B.normalize(d,B.sub(d,u,f))),h=B.distance(u,f);m>0?h>o&&(o=h):h>s&&(s=h),B.projectPointOnVector(u,B.fromArray(u,e,t),p.dirC,f);let g=B.dot(p.dirC,B.normalize(d,B.sub(d,u,f))),_=B.distance(u,f);g>0?_>c&&(c=_):_>l&&(l=_)}let m=B.setMagnitude(B(),p.dirA,(n+a)/2),h=B.setMagnitude(B(),p.dirB,(o+s)/2),g=B.setMagnitude(B(),p.dirC,(c+l)/2),_=B.isFinite(m),v=B.isFinite(h),y=B.isFinite(g),b=B(),x=function(e,t,n){B.copy(i,f),_&&B.scaleAndAdd(i,i,p.dirA,e),v&&B.scaleAndAdd(i,i,p.dirB,t),y&&B.scaleAndAdd(i,i,p.dirC,n),B.add(b,b,i)};return x(n,o,c),x(n,o,-l),x(n,-s,-l),x(n,-s,c),x(-a,-s,-l),x(-a,-s,c),x(-a,o,c),x(-a,o,-l),B.scale(b,b,1/8),Yk.create(b,m,h,g)}e.calculateBoxAxes=a})(Qk||={});function q(){return q.zero()}(function(e){function t(e){return e.extrema!==void 0}e.hasExtrema=t;function n(e,t){return{center:e,radius:t}}e.create=n;function r(){return{center:B(),radius:0}}e.zero=r;function i(e){let r=n(B.clone(e.center),e.radius);return t(e)&&(r.extrema=e.extrema.map(e=>B.clone(e))),r}e.clone=i;function a(e,t,n){return B.copy(e.center,t),e.radius=n,e}e.set=a;function o(e,n){return B.copy(e.center,n.center),e.radius=n.radius,t(n)&&s(e,n.extrema.map(e=>B.clone(e))),e}e.copy=o;function s(e,t){return e.extrema===void 0?e.extrema=t:(e.extrema.length=0,e.extrema.push(...t)),e}e.setExtrema=s;function c(e){let{x:t,y:n,z:r,indices:i}=e,a=0,o=0,s=0,c=0,l=K.size(i);for(let e=0;e<l;e++){let c=K.getAt(i,e);a+=t[c],o+=n[c],s+=r[c]}l>0&&(a/=l,o/=l,s/=l);for(let e=0;e<l;e++){let l=K.getAt(i,e),u=t[l]-a,d=n[l]-o,f=r[l]-s,p=u*u+d*d+f*f;p>c&&(c=p)}return{center:B.create(a,o,s),radius:Math.sqrt(c)}}e.computeBounding=c;function l(e,n,r){return B.transformMat4(e.center,n.center,r),e.radius=n.radius*z.getMaxScaleOnAxis(r),t(n)&&s(e,n.extrema.map(e=>B.transformMat4(B(),e,r))),e}e.transform=l;function u(e,n,r){return B.add(e.center,n.center,r),t(n)&&s(e,n.extrema.map(e=>B.add(B(),e,r))),e}e.translate=u;function d(e,n,r){return B.scale(e.center,n.center,r),e.radius=n.radius*r,t(n)&&s(e,n.extrema.map(e=>B.scale(B(),e,r))),e}e.scale=d;function f(e,t,n){return B.scale(e.center,t.center,n),e.radius=t.radius*n,e}e.scaleNX=f;function p(e,t,n){return B.toArray(e.center,t,n),t[n+3]=e.radius,t}e.toArray=p;function m(e,t,n){return B.fromArray(e.center,t,n),e.radius=t[n+3],e}e.fromArray=m;function h(t,n){return B.scale(t.center,B.add(t.center,n.max,n.min),.5),t.radius=B.distance(t.center,n.max),e.setExtrema(t,[B.create(n.min[0],n.min[1],n.min[2]),B.create(n.max[0],n.max[1],n.max[2]),B.create(n.max[0],n.min[1],n.min[2]),B.create(n.min[0],n.max[1],n.max[2]),B.create(n.min[0],n.min[1],n.max[2]),B.create(n.max[0],n.min[1],n.max[2]),B.create(n.max[0],n.max[1],n.min[2]),B.create(n.min[0],n.max[1],n.min[2])]),t}e.fromBox3D=h;function g(e,t){return B.copy(e.center,t.origin),e.radius=Math.max(B.magnitude(t.dirA),B.magnitude(t.dirB),B.magnitude(t.dirC)),e}e.fromAxes3D=g;let _=B();function v(t,n,r){let[i,a,o]=n,s=B.create(0,0,0);B.transformMat4(s,s,r);let c=B.create(i,a,o);B.transformMat4(c,c,r);let l=B.create(i,0,0);B.transformMat4(l,l,r);let u=B.create(0,a,o);B.transformMat4(u,u,r);let d=B.create(0,0,o);B.transformMat4(d,d,r);let f=B.create(i,0,o);B.transformMat4(f,f,r);let p=B.create(i,a,0);B.transformMat4(p,p,r);let m=B.create(0,a,0);B.transformMat4(m,m,r),B.add(_,s,c),B.scale(_,_,.5);let h=Math.max(B.distance(s,c),B.distance(l,u));return e.set(t,_,h/2),e.setExtrema(t,[s,c,l,u,d,f,p,m]),t}e.fromDimensionsAndTransform=v;let y=B();function b(t,n,r){return B.distance(n.center,r)<n.radius?e.copy(t,n):(B.sub(y,n.center,r),B.sub(y,n.center,y),B.setMagnitude(y,y,n.radius),B.scale(t.center,B.add(y,y,r),.5),t.radius=B.distance(t.center,r),t)}e.addVec3=b;function x(e,n,r){return B.copy(e.center,n.center),e.radius=Math.max(n.radius,B.distance(n.center,r.center)+r.radius),t(n)&&t(r)&&s(e,[...n.extrema.map(e=>B.clone(e)),...r.extrema.map(e=>B.clone(e))]),e}e.expandBySphere=x;let S=B();function C(e,n,r){if(B.copy(e.center,n.center),e.radius=n.radius+r,n.radius<1e-12||(n.extrema?.length??0)<=1)return e.extrema=void 0,e;if(t(n)){let t=new Float32Array(n.extrema.length*3);for(let e=0;e<n.extrema.length;e++)B.toArray(n.extrema[e],t,e*3);let i=Qk.calculateMomentsAxes(t);Yk.scale(i,Yk.normalize(i,i),r),s(e,n.extrema.map(t=>{B.normalize(S,B.sub(S,t,n.center));let r=B.clone(t),a=B.dot(S,i.dirA)<0?-1:1;B.scaleAndAdd(r,r,i.dirA,a);let o=B.dot(S,i.dirB)<0?-1:1;B.scaleAndAdd(r,r,i.dirB,o);let s=B.dot(S,i.dirC)<0?-1:1;return B.scaleAndAdd(r,r,i.dirC,s),B.distance(e.center,r)>e.radius&&(n.extrema.length>=14&&B.normalize(S,B.sub(S,r,n.center)),B.scaleAndAdd(r,e.center,S,e.radius)),r}))}return e}e.expand=C;function w(e,t){return e.radius===t.radius&&B.exactEquals(e.center,t.center)}e.exactEquals=w;function T(e,t){let n=e.radius,r=t.radius;return Math.abs(n-r)<=1e-6*Math.max(1,Math.abs(n),Math.abs(r))&&B.equals(e.center,t.center)}e.equals=T;function E(e,n){if(t(n)){for(let t of n.extrema)if(B.distance(e.center,t)>e.radius)return!1;return!0}else return B.distance(e.center,n.center)+n.radius<=e.radius}e.includes=E;function D(e,t){return B.distance(e.center,t.center)<=e.radius+t.radius}e.overlaps=D;function O(e,t){return B.distance(e.center,t.center)-e.radius+t.radius}e.distance=O;function k(e,t){let{center:n,radius:r}=e;return B.distance(t,n)-r}e.distanceToVec=k})(q||={});function $k(){return $k.zero()}(function(e){function t(e,t){return{min:e,max:t}}e.create=t;function n(){return{min:B(),max:B()}}e.zero=n;function r(e,t){return B.copy(e.min,t.min),B.copy(e.max,t.max),e}e.copy=r;function i(e,t,n){return B.copy(e.min,t),B.copy(e.max,n),e}e.set=i;function a(e){return r(n(),e)}e.clone=a;let o=B();function s(e,t){return q.hasExtrema(t)&&t.extrema.length>=14?l(e,t.extrema):(B.set(o,t.radius,t.radius,t.radius),B.sub(e.min,t.center,o),B.add(e.max,t.center,o),e)}e.fromSphere3D=s;function c(e,t){for(let n=0,r=t.length;n<r;n++)v(e,t[n]);return e}e.addVec3Array=c;function l(e,t){return _(e),c(e,t),e}e.fromVec3Array=l;function u(e,t){return q.hasExtrema(t)&&t.extrema.length>=14?c(e,t.extrema):(v(e,B.subScalar(o,t.center,t.radius)),v(e,B.addScalar(o,t.center,t.radius)),e)}e.addSphere3D=u;function d(e,t){return v(e,t.min),v(e,t.max),e}e.addBox3D=d;function f(e,t){return B.clamp(o,t.center,e.min,e.max),B.squaredDistance(o,t.center)<=t.radius*t.radius}e.intersectsSphere3D=f;function p(e){let t=B.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=B.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:r,y:i,z:a,indices:o}=e;for(let e=0,s=K.size(o);e<s;e++){let s=K.getAt(o,e);t[0]=Math.min(r[s],t[0]),t[1]=Math.min(i[s],t[1]),t[2]=Math.min(a[s],t[2]),n[0]=Math.max(r[s],n[0]),n[1]=Math.max(i[s],n[1]),n[2]=Math.max(a[s],n[2])}return{min:t,max:n}}e.computeBounding=p;function m(e,t){return B.sub(e,t.max,t.min)}e.size=m;let h=B();function g(e){return m(h,e),h[0]*h[1]*h[2]}e.volume=g;function _(e){return B.set(e.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B.set(e.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e}e.setEmpty=_;function v(e,t){return B.min(e.min,e.min,t),B.max(e.max,e.max,t),e}e.add=v;function y(e,t,n){return B.sub(e.min,t.min,n),B.add(e.max,t.max,n),e}e.expand=y;function b(e,t,n){return B.subScalar(e.min,t.min,n),B.addScalar(e.max,t.max,n),e}e.expandUniformly=b;function x(e,t,n){return B.scale(e.min,t.min,n),B.scale(e.max,t.max,n),e}e.scale=x;let S=B();function C(e,t,n){let[r,i,a]=t.min,[o,s,c]=t.max;return _(e),v(e,B.transformMat4(S,B.set(S,r,i,a),n)),v(e,B.transformMat4(S,B.set(S,r,i,c),n)),v(e,B.transformMat4(S,B.set(S,r,s,a),n)),v(e,B.transformMat4(S,B.set(S,r,s,c),n)),v(e,B.transformMat4(S,B.set(S,o,i,a),n)),v(e,B.transformMat4(S,B.set(S,o,i,c),n)),v(e,B.transformMat4(S,B.set(S,o,s,a),n)),v(e,B.transformMat4(S,B.set(S,o,s,c),n)),e}e.transform=C;function w(e,t){return!(t[0]<e.min[0]||t[0]>e.max[0]||t[1]<e.min[1]||t[1]>e.max[1]||t[2]<e.min[2]||t[2]>e.max[2])}e.containsVec3=w;function T(e,t){return!(e.max[0]<t.min[0]||e.min[0]>t.max[0]||e.max[1]<t.min[1]||e.min[1]>t.max[1]||e.max[2]<t.min[2]||e.min[2]>t.max[2])}e.overlaps=T;function E(e,t){let n=t.center,r=t.radius;return!(n[0]-r<e.min[0]||n[0]+r>e.max[0]||n[1]-r<e.min[1]||n[1]+r>e.max[1]||n[2]-r<e.min[2]||n[2]+r>e.max[2])}e.containsSphere3D=E;function D(e,t){return B.center(e,t.max,t.min)}e.center=D;function O(e,t){return B.exactEquals(e.min,t.min)&&B.exactEquals(e.max,t.max)}e.exactEquals=O;function k(e,t){return B.equals(e.min,t.min)&&B.equals(e.max,t.max)}e.equals=k})($k||={});function eA(e,t,n){let r=new Float32Array(e);for(let e=0;e<r.length;e++)r[e]=t+n*e;return r}var tA;(function(e){e.DefaultName=`1_555`,e.Default=t(e.DefaultName,z.identity()),e.RotationTranslationEpsilon=.005;function t(t,n,r){let{assembly:i,ncsId:o,hkl:s,spgrOp:c,key:l}=r||{},u=s?B.clone(s):B();c??=-1,l??=-1,o||=-1;let d=z.isIdentity(n),f=a(r,d),p=r?.instanceId??t;return d?{name:t,instanceId:p,assembly:i,matrix:n,inverse:z.identity(),isIdentity:!0,hkl:u,spgrOp:c,ncsId:o,suffix:f,key:l}:(z.isRotationAndTranslation(n,e.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${t}) should be a composition of rotation and translation.`),{name:t,instanceId:p,assembly:i,matrix:n,inverse:z.invert(z(),n),isIdentity:!1,hkl:u,spgrOp:c,key:l,ncsId:o,suffix:f})}e.create=t;function n(e){return!!e&&!!e.matrix&&!!e.inverse&&typeof e.name==`string`}function r(e,t,n,r){let i=e=>e>=0&&e<=9?`${e}`:`(${e})`;return`${e+1}_${i(t+5)}${i(n+5)}${i(r+5)}`}e.getSymmetryOperatorName=r;function i(e){return`ASM-`+e.join(`-`)}e.getAssemblyOperatorName=i;function a(e,t){if(!e)return``;if(e.assembly)return n(e)?e.suffix:t?``:`_${e.assembly.operId}`;if(e.spgrOp!==void 0&&e.hkl!==void 0&&e.spgrOp!==-1){let[t,n,i]=e.hkl;return`-${r(e.spgrOp,t,n,i)}`}return e.ncsId===-1?``:`_${e.ncsId}`}let o=z();function s(t,n){z.setIdentity(o);for(let e=0;e<3;e++)for(let n=0;n<3;n++)z.setValue(o,e,n,TT.getValue(t,e,n));return z.setTranslation(o,n),z.isRotationAndTranslation(o,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=s;function c(e,n,r,i){let a=z.identity();for(let e=0;e<3;e++)for(let t=0;t<3;t++)z.setValue(a,e,t,TT.getValue(n,e,t));return z.setTranslation(a,r),t(e,a,{ncsId:i})}e.ofRotationAndOffset=c;let l=MT.identity(),u=MT(),d=MT(),f=B();function p(e,t,n){let r=t.inverse;if(t.isIdentity)return z.copy(e,r);let i=1-n;z.getRotation(u,r),MT.slerp(u,l,u,i);let a=MT.getAxisAngle(f,u);return z.fromRotation(e,a,f),z.setValue(e,0,3,i*z.getValue(r,0,3)),z.setValue(e,1,3,i*z.getValue(r,1,3)),z.setValue(e,2,3,i*z.getValue(r,2,3)),e}e.lerpFromIdentity=p;function m(e,t,n,r){if(Math.abs(r)<=1e-5)return z.copy(e,t);if(Math.abs(r-1)<=1e-5)return z.copy(e,n);z.getRotation(u,t),z.getRotation(d,n),MT.slerp(d,u,d,r);let i=MT.getAxisAngle(f,d);return z.fromRotation(e,i,f),z.setValue(e,0,3,OT(z.getValue(t,0,3),z.getValue(n,0,3),r)),z.setValue(e,1,3,OT(z.getValue(t,1,3),z.getValue(n,1,3),r)),z.setValue(e,2,3,OT(z.getValue(t,2,3),z.getValue(n,2,3),r)),e}e.slerp=m;function h(e,n){let r=z.mul(z(),n.matrix,e.matrix);return t(n.name,r,n)}e.compose=h;class g{constructor(e,t,n=nA){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z,this._m=e.matrix}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],B.transformMat4(t,t,this._m),t}x(e){let t=this._m,n=t[0],r=t[4],i=t[8],a=t[12],o=this._x[e],s=this._y[e],c=this._z[e],l=t[3]*o+t[7]*s+t[11]*c+t[15]||1;return(n*o+r*s+i*c+a)/l}y(e){let t=this._m,n=t[1],r=t[5],i=t[9],a=t[13],o=this._x[e],s=this._y[e],c=this._z[e],l=t[3]*o+t[7]*s+t[11]*c+t[15]||1;return(n*o+r*s+i*c+a)/l}z(e){let t=this._m,n=t[2],r=t[6],i=t[10],a=t[14],o=this._x[e],s=this._y[e],c=this._z[e],l=t[3]*o+t[7]*s+t[11]*c+t[15]||1;return(n*o+r*s+i*c+a)/l}}class _{constructor(e,t,n=nA){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z,this._m=e.matrix}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this.x(e),t[1]=this.y(e),t[2]=this.z(e),t}x(e){let t=this._m;return t[0]*this._x[e]+t[4]*this._y[e]+t[8]*this._z[e]+t[12]}y(e){let t=this._m;return t[1]*this._x[e]+t[5]*this._y[e]+t[9]*this._z[e]+t[13]}z(e){let t=this._m;return t[2]*this._x[e]+t[6]*this._y[e]+t[10]*this._z[e]+t[14]}}class v{constructor(e,t,n=nA){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}x(e){return this._x[e]}y(e){return this._y[e]}z(e){return this._z[e]}}function y(e,t,n=nA){return z.isIdentity(e.matrix)?new v(e,t,n):Wbe(e.matrix)?new _(e,t,n):new g(e,t,n)}e.createMapping=y})(tA||={});function nA(e){return 0}function Wbe(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}const rA=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],Gbe=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],Kbe=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],iA={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function qbe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function Jbe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw Error(`unknown spacegroup index '${e}'`)}const aA=function(){let e=Object.create(null);for(let t of Object.keys(iA))e[iA[t]]=t;return e}(),Ybe=function(){let e=Object.create(null);for(let t of Object.keys(iA)){let n=iA[t];e[n]=Jbe(n)}return e}();function Xbe(e){let t=typeof e==`number`?qbe(e):iA[e];return t===void 0||aA[t]===void 0?-1:t}var oA;(function(e){e.Zero=n(`P 1`,B.create(1,1,1),B.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(e){return e?e.index===0&&e.size[0]===1&&e.size[1]===1&&e.size[1]===1:!0}e.isZero=t;function n(t,n,r){let i=Xbe(t);if(i<0)return console.warn(`Unknown spacegroup '${t}', returning a 'P 1' with cellsize [1, 1, 1]`),e.Zero;let a=n[0]*n[1]*n[2],o=r[0],s=r[1],c=r[2],l=n[0],u=n[1],d=n[2],f=Math.cos(s),p=(Math.cos(o)-Math.cos(s)*Math.cos(c))/Math.sin(c),m=Math.sqrt(1-f*f-p*p),h=[l,0,0],g=[Math.cos(c)*u,Math.sin(c)*u,0],_=[f*d,p*d,m*d],v=z.ofRows([[h[0],g[0],_[0],0],[0,g[1],_[1],0],[0,0,_[2],0],[0,0,0,1]]);return{index:i,size:n,volume:a,anglesInRadians:r,toFractional:z.invert(z.zero(),v),fromFractional:v}}e.create=n})(oA||={});var sA;(function(e){e.ZeroP1=t(oA.Zero);function t(e){let t=Kbe[e.index].map(e=>d(Gbe[e]));return{name:aA[e.index],num:Ybe[e.index],cell:e,operators:t}}e.create=t;let n=B(),r=z();function i(e,t,i,a,o,s){return B.set(n,i,a,o),z.fromTranslation(r,n),z.mul(s,z.mul(s,z.mul(s,e.cell.fromFractional,r),e.operators[t]),e.cell.toFractional)}e.setOperatorMatrix=i;function a(e,t,n,r,a){let o=i(e,t,n,r,a,z.zero());return tA.create(tA.getSymmetryOperatorName(t,n,r,a),o,{hkl:B.create(n,r,a),spgrOp:t})}e.getSymmetryOperator=a;let o=B(),s=B(),c=B(),l=B();function u(e,t,r,i,a,u){let d=z.zero();B.set(n,r,i,a),B.floor(o,u),z.copy(d,e.operators[t]),B.floor(s,B.transformMat4(s,u,d)),z.getTranslation(l,d),B.sub(l,l,s),B.add(l,l,o),B.add(l,l,n),z.setTranslation(d,l),z.mul(d,e.cell.fromFractional,d),z.mul(d,d,e.cell.toFractional),B.sub(c,s,o);let f=r-c[0],p=i-c[1],m=a-c[2];return tA.create(tA.getSymmetryOperatorName(t,f,p,m),d,{hkl:B.create(f,p,m),spgrOp:t})}e.getSymmetryOperatorRef=u;function d(e){let t=rA[e[0]],n=rA[e[1]],r=rA[e[2]];return z.ofRows([t,n,r,[0,0,0,1]])}function f(e){return[h(p(e[0],e[4],e[8]),m(e[12])),h(p(e[1],e[5],e[9]),m(e[13])),h(p(e[2],e[6],e[10]),m(e[14]))].join(`,`)}e.getOperatorXyz=f;function p(e,t,n){let r=[];if(e>0?r.push(`+X`):e<0&&r.push(`-X`),t>0?r.push(`+Y`):t<0&&r.push(`-Y`),n>0?r.push(`+Z`):n<0&&r.push(`-Z`),r.length===1)return r[0].charAt(0)===`+`?r[0].substr(1):r[0];if(r.length===2){let e=r[0].charAt(0),t=r[1].charAt(0);if(e===`+`)return`${r[0].substr(1)}${r[1]}`;if(t===`+`)return`${r[1].substr(1)}${r[0]}`}throw Error(`unknown rotation '${r}', ${e} ${t} ${n}`)}function m(e){switch(e){case 1/2:return`1/2`;case 1/4:return`1/4`;case 3/4:return`3/4`;case 1/3:return`1/3`;case 2/3:return`2/3`;case 1/6:return`1/6`;case 5/6:return`5/6`}return``}function h(e,t){return t===``?e:e.length>2?`${e}+${t}`:e.charAt(0)===`-`?`${t}${e}`:`${t}+${e}`}})(sA||={});var cA;(function(e){function t(e,t,n){e.squaredDistances[e.count]=n,e.indices[e.count++]=t}e.add=t;function n(e){e.count=0}e.reset=n;function r(){return{count:0,indices:[],squaredDistances:[]}}e.create=r;function i(e,t){for(let n=0;n<t.count;++n)e.indices[n]=t.indices[n],e.squaredDistances[n]=t.squaredDistances[n];return e.count=t.count,e}e.copy=i})(cA||={});function lA(e){let t=Vk.ofSortedArray(e),n=Vk.max(t),r=new Int32Array(n);for(let t=0,n=e.length-1;t<n;t++)for(let n=e[t],i=e[t+1];n<i;n++)r[n]=t;return{offsets:t,index:r,count:e.length-1}}function Zbe(e,t){let n=G.start(t),r=new Int32Array(e.length+1);for(let t=0,i=e.length;t<i;t++)r[t]=e[t]-n;return r[e.length]=G.end(t)-n,lA(r)}function Qbe({count:e}){return e}function $be({index:e},t){return e[t]}function exe({offsets:e},t,n){let r=n>=K.max(e)?-1:K.findPredecessorIndex(e,n-1);return K.findRange(t,K.getAt(e,r),K.getAt(e,r+1)-1)}var txe=class{move(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&G.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value}updateValue(){let e=this.segments[this.segmentMin+1],t=K.findPredecessorIndexInInterval(this.set,e,this.setRange);return this.value.start=G.start(this.setRange),this.value.end=t,this.setRange=G.ofBounds(t,G.end(this.setRange)),t>this.value.start}updateSegmentRange(){let e=G.min(this.setRange),t=G.max(this.setRange);if(t<e){this.hasNext=!1;return}this.segmentMin=this.segmentMap[K.getAt(this.set,e)],this.segmentMax=this.segmentMap[K.getAt(this.set,t)],this.hasNext=this.segmentMax>=this.segmentMin}setSegment(e){this.setRange=G.ofBounds(e.start,e.end),this.updateSegmentRange()}constructor(e,t,n,r){this.segments=e,this.segmentMap=t,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=G.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=r,this.updateSegmentRange()}};function nxe(e,t,n){let r=n===void 0?G.ofBounds(0,K.size(t)):G.ofBounds(n.start,n.end);return new txe(e.offsets,e.index,t,r)}var uA;(function(e){e.create=lA,e.ofOffsets=Zbe,e.count=Qbe,e.getSegment=$be,e.projectValue=exe,e.transientSegments=nxe})(uA||={});function rxe(e){return new ixe(e)}var ixe=class{remove(e){let{prev:t,next:n}=this,r=t[e],i=n[e];r>=0&&(n[r]=i,t[e]=-1),i>=0&&(t[i]=r,n[e]=-1),e===this.head&&(r<0?this.head=i:this.head=r)}has(e){return this.prev[e]>=0||this.next[e]>=0||this.head===e}constructor(e){this.head=e>0?0:-1,this.prev=new Int32Array(e),this.next=new Int32Array(e);for(let t=0;t<e;t++)this.next[t]=t+1,this.prev[t]=t-1;this.prev[0]=-1,this.next[e-1]=-1}},dA;(function(e){e.Empty=new Map;function t(e){return mx(e.keys())}e.keyArray=t;function n(){return new Map}e.Mutable=n;function r(e){return e}e.asImmutable=r;function i(e){let t=n(),r=e.keys();for(;;){let{done:n,value:i}=r.next();if(n)break;t.set(i,e.get(i))}return t}e.copy=i;function a(e,t){let n=t.keys();for(;;){let{done:r,value:i}=n.next();if(r)break;e.set(i,t.get(i))}return e}e.addFrom=a})(dA||={});var axe=class{move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}constructor(e){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=e.length,this.hasNext=e.length>0,this.xs=e,this.index=-1,this.lastValue=e.length>0?e[0]:void 0}},fA=class{move(){return++this.value,this.hasNext=this.value<this.max,this.value}constructor(e,t){this.max=t,this.value=0,this.hasNext=!1,this.value=e-1,this.hasNext=t>=e}},oxe=class{move(){return this.hasNext=!1,this.value}constructor(e){this.value=e,this.hasNext=!0}},sxe=class{move(){let e=this.f(this.base.move());return this.hasNext=this.base.hasNext,e}constructor(e,t){this.base=e,this.f=t,this.hasNext=!1,this.hasNext=e.hasNext}},cxe=class{move(){let e=this.next;return this.hasNext=this.findNext(),e}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}constructor(e,t){this.base=e,this.p=t,this.hasNext=this.findNext()}},pA;(function(e){e.Empty=new fA(0,-1);function t(e){return new axe(e)}e.Array=t;function n(e){return new oxe(e)}e.Value=n;function r(e,t){return new fA(e,t)}e.Range=r;function i(e,t){return new sxe(e,t)}e.map=i;function a(e,t){return new cxe(e,t)}e.filter=a;function o(e,t,n){for(;e.hasNext;)if(t(e.move(),n))return n;return n}e.forEach=o})(pA||={});var lxe=class{constructor(e,t){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=e,this.value=t,this.prev=this,this.next=this}},mA=new class{constructor(e){if(this._index=-1,this._items=[],this._len=0,e){let t=e,n=0;do this._items[n++]=t,t=t.next;while(e!==t);this._len=n}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(e){this._index=-1,this._len=0;let t=e,n=0;do this._items[n++]=t,t=t.next;while(e!==t);this._len=n}},hA=class{constructor(e){this._minNode=null,this._nodeCount=0,this._compare=e||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(e,t){if(!e)throw Error(`Cannot decrease key of non-existent node`);if(this._compare({key:t},{key:e.key})>0)throw Error(`New key is larger than old key`);e.key=t;let n=e.parent;n&&this._compare(e,n)<0&&(this._cut(e,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(e,this._minNode)<0&&(this._minNode=e)}delete(e){let t=e.parent;t&&(this._cut(e,t,this._minNode),this._cascadingCut(t,this._minNode)),this._minNode=e,this.extractMinimum()}extractMinimum(){let e=this._minNode;if(e){if(e.child){let t=e.child;do t.parent=null,t=t.next;while(t!==e.child)}let t=null;e.next!==e&&(t=e.next),this._removeNodeFromList(e),this._nodeCount--,this._minNode=this._mergeLists(t,e.child),this._minNode&&=this._consolidate(this._minNode)}return e}findMinimum(){return this._minNode}insert(e,t){let n=new lxe(e,t);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n}isEmpty(){return this._minNode===null}size(){return this._minNode===null?0:this._getNodeListSize(this._minNode)}union(e){this._minNode=this._mergeLists(this._minNode,e._minNode),this._nodeCount+=e._nodeCount}_defaultCompare(e,t){return e.key>t.key?1:e.key<t.key?-1:0}_cut(e,t,n){e.parent=null,t.degree--,e.next===e?t.child=null:t.child=e.next,this._removeNodeFromList(e);let r=this._mergeLists(n,e);return e.isMarked=!1,r}_cascadingCut(e,t){let n=e.parent;return n&&(e.isMarked?(t=this._cut(e,n,t),t=this._cascadingCut(n,t)):e.isMarked=!0),t}_consolidate(e){let t=[];for(mA.reset(e);mA.hasNext();){let e=mA.next(),n=t[e.degree];for(;n;){if(this._compare(e,n)>0){let t=e;e=n,n=t}this._linkHeaps(n,e),t[e.degree]=null,e.degree++,n=t[e.degree]}t[e.degree]=e}let n=null;for(let e=0;e<t.length;e++){let r=t[e];r&&(r.next=r,r.prev=r,n=this._mergeLists(n,r))}return n}_removeNodeFromList(e){let t=e.prev,n=e.next;t.next=n,n.prev=t,e.next=e,e.prev=e}_linkHeaps(e,t){this._removeNodeFromList(e),t.child=this._mergeLists(e,t.child),e.parent=t,e.isMarked=!1}_mergeLists(e,t){if(!e)return t||null;if(!t)return e;let n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,this._compare(e,t)<0?e:t}_getNodeListSize(e){let t=0,n=e;do t++,n.child&&(t+=this._getNodeListSize(n.child)),n=n.next;while(n!==e);return t}};function gA(e){let t,n;return(...r)=>{if(!t||t.length!==r.length)return t=r,n=e.apply(void 0,r),n;for(let i=0,a=r.length;i<a;i++)if(r[i]!==t[i])return t=r,n=e.apply(void 0,r),n;return n}}function _A(e){let t=new Map;return n=>{if(t.has(n))return t.get(n);let r=e(n);return t.set(n,r),r}}function vA(){return vA.create(B.create(0,0,0),B.create(1,0,0))}(function(e){function t(e,t){return{origin:e,direction:t}}e.create=t;function n(e,t){return B.copy(e.origin,t.origin),B.copy(e.direction,t.direction),e}e.copy=n;function r(t){return n(e(),t)}e.clone=r;function i(e,t,n){return B.copy(e.origin,t.origin),B.normalize(e.direction,B.sub(e.direction,n,t.origin)),e}e.targetTo=i;function a(e,t,n){return B.transformMat4(e.origin,t.origin,n),B.transformDirection(e.direction,t.direction,n),e}e.transform=a;let o=B();function s(e,t){let{center:n,radius:r}=t,{origin:i,direction:a}=e,s=B.sub(o,i,n),c=B.dot(a,a),l=2*B.dot(s,a),u=B.dot(s,s)-r*r,d=l*l-4*c*u;if(d<0)return-1;let f=(-l-Math.sqrt(d))/(2*c);return f<0?-1:f}function c(e,t,n){let r=s(t,n);return r<0?!1:(B.scaleAndAdd(e,t.origin,t.direction,r),!0)}e.intersectSphere3D=c;function l(e,t){return s(e,t)>=0}e.isIntersectingSphere3D=l;function u(e,t){return B.distance(e.origin,t.center)<t.radius}e.isInsideSphere3D=u;function d(e,t){let{origin:n,direction:r}=e,[i,a,o]=t.min,[s,c,l]=t.max,[u,d,f]=n,p=1/r[0],m=1/r[1],h=1/r[2],g,_,v,y,b,x;return p>=0?(g=(i-u)*p,_=(s-u)*p):(g=(s-u)*p,_=(i-u)*p),m>=0?(v=(a-d)*m,y=(c-d)*m):(v=(c-d)*m,y=(a-d)*m),g>y||v>_||(v>g&&(g=v),y<_&&(_=y),h>=0?(b=(o-f)*h,x=(l-f)*h):(b=(l-f)*h,x=(o-f)*h),g>x||b>_)?-1:(b>g&&(g=b),x<_&&(_=x),g>=0?g:-1)}function f(e,t,n){let r=d(t,n);return r<0?!1:(B.scaleAndAdd(e,t.origin,t.direction,r),!0)}e.intersectBox3D=f;function p(e,t){return d(e,t)>=0}e.isIntersectingBox3D=p})(vA||={});function yA(e,t,n){return new uxe(e,t,n)}var uxe=class{find(e,t,n,r,i){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!1;let a=i??this.result;return xA(this.ctx,a),a}nearest(e,t,n,r=1,i,a){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.k=r,this.ctx.stopIf=i;let o=a??this.result;return bxe(this.ctx,o),o}check(e,t,n,r){return this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!0,xA(this.ctx,this.result)}approxNearest(e,t,n,r,i){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!1;let a=i??this.result;return gxe(this.ctx,a),a}constructor(e,t,n){let r=fxe(e,t,n);this.ctx=pxe(r),this.boundary={box:r.boundingBox,sphere:r.boundingSphere},this.buckets={offset:r.bucketOffset,count:r.bucketCounts,array:r.bucketArray},this.result=cA.create()}};function dxe(e){let{expandedBox:t,size:[n,r,i],data:{x:a,y:o,z:s,radius:c,indices:l},elementCount:u,delta:d}=e,f=n*r*i,{min:[p,m,h]}=t,g=0,_=0,v=new Uint32Array(f),y=new Int32Array(u);for(let e=0;e<u;e++){let t=K.getAt(l,e),n=Math.floor((a[t]-p)/d[0]),c=Math.floor((o[t]-m)/d[1]),u=Math.floor((s[t]-h)/d[2]),f=(n*r+c)*i+u;(v[f]+=1)===1&&(_+=1),y[e]=f}if(c)for(let e=0;e<u;e++){let t=K.getAt(l,e);c[t]>g&&(g=c[t])}let b=new Int32Array(_);for(let e=0,t=0;e<f;e++){let n=v[e];n>0&&(v[e]=t+1,b[t]=n,t+=1)}let x=new Uint32Array(_);for(let e=1;e<_;++e)x[e]+=x[e-1]+b[e-1];let S=new Int32Array(_),C=new Int32Array(u);for(let e=0;e<u;e++){let t=v[y[e]];if(t>0){let n=t-1;C[x[n]+S[n]]=e,S[n]+=1}}return{size:e.size,bucketArray:C,bucketCounts:b,bucketOffset:x,grid:v,delta:d,min:e.expandedBox.min,data:e.data,maxRadius:g,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}var bA=2**24;function fxe(e,t,n){let r=$k.expand($k(),t.box,B.create(.5,.5,.5)),{indices:i}=e,a=$k.size(B(),r),o,s,c=K.size(i),l=typeof n==`number`?n:32,u=Array.isArray(n)&&n;if(u&&!B.isZero(u))s=[Math.ceil(a[0]/u[0]),Math.ceil(a[1]/u[1]),Math.ceil(a[2]/u[2])],o=u;else if(c>0){let e=(Math.ceil(c/l)/(a[0]*a[1]*a[2]))**(1/3);s=[Math.ceil(a[0]*e),Math.ceil(a[1]*e),Math.ceil(a[2]*e)],o=[a[0]/s[0],a[1]/s[1],a[2]/s[2]]}else o=a,s=[1,1,1];let d=s[0]*s[1]*s[2];if(d>bA){let e=Math.cbrt(d/bA);s=[Math.ceil(s[0]/e),Math.ceil(s[1]/e),Math.ceil(s[2]/e)],o=[a[0]/s[0],a[1]/s[1],a[2]/s[2]]}let f={x:e.x,y:e.y,z:e.z,indices:i,radius:e.radius};return dxe({size:s,data:f,expandedBox:r,boundingBox:t.box,boundingSphere:t.sphere,elementCount:c,delta:o})}function pxe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}function xA(e,t){let{min:n,size:[r,i,a],bucketOffset:o,bucketCounts:s,bucketArray:c,grid:l,data:{x:u,y:d,z:f,indices:p,radius:m},delta:h,maxRadius:g}=e.grid,{radius:_,isCheck:v,x:y,y:b,z:x}=e,S=_+g,C=S*S;cA.reset(t);let w=Math.max(0,Math.floor((y-S-n[0])/h[0])),T=Math.max(0,Math.floor((b-S-n[1])/h[1])),E=Math.max(0,Math.floor((x-S-n[2])/h[2])),D=Math.min(r-1,Math.floor((y+S-n[0])/h[0])),O=Math.min(i-1,Math.floor((b+S-n[1])/h[1])),k=Math.min(a-1,Math.floor((x+S-n[2])/h[2]));if(w>D||T>O||E>k)return!1;for(let e=w;e<=D;e++)for(let n=T;n<=O;n++)for(let r=E;r<=k;r++){let h=l[(e*i+n)*a+r];if(h===0)continue;let S=h-1,w=o[S],T=w+s[S];for(let e=w;e<T;e++){let n=K.getAt(p,c[e]),r=u[n]-y,i=d[n]-b,a=f[n]-x,o=r*r+i*i+a*a;if(o<=C){if(g>0&&Math.sqrt(o)-m[n]>_)continue;if(v)return!0;cA.add(t,c[e],o)}}}return t.count>0}function mxe(e){let t=[],n=e*2+1;for(let r=0;r<n;++r)for(let i=0;i<n;++i)for(let a=0;a<n;++a)t.push(B.create(r-e,i-e,a-e));return t.sort((e,t)=>B.squaredMagnitude(e)-B.squaredMagnitude(t)),t.flat()}var hxe=_A(mxe);function gxe(e,t){let{min:n,size:[r,i,a],bucketOffset:o,bucketCounts:s,bucketArray:c,grid:l,data:{x:u,y:d,z:f,indices:p},delta:m}=e.grid,{radius:h,x:g,y:_,z:v}=e,y=h*h;cA.reset(t);let b=Math.max(0,Math.floor((g-h-n[0])/m[0])),x=Math.max(0,Math.floor((_-h-n[1])/m[1])),S=Math.max(0,Math.floor((v-h-n[2])/m[2])),C=Math.min(r-1,Math.floor((g+h-n[0])/m[0])),w=Math.min(i-1,Math.floor((_+h-n[1])/m[1])),T=Math.min(a-1,Math.floor((v+h-n[2])/m[2]));if(b>C||x>w||S>T)return!1;let E=Math.floor((g-n[0])/m[0]),D=Math.floor((_-n[1])/m[1]),O=Math.floor((v-n[2])/m[2]),k=hxe(Math.max(C-b,w-x,T-S)+1);for(let e=0,n=k.length;e<n;e+=3){let n=E+k[e],r=D+k[e+1],m=O+k[e+2];if(n<b||n>C||r<x||r>w||m<S||m>T)continue;let h=l[(n*i+r)*a+m];if(h===0)continue;let A=h-1,j=o[A],M=j+s[A],N=Number.MAX_VALUE;for(let e=j;e<M;e++){let n=K.getAt(p,c[e]),r=u[n]-g,i=d[n]-_,a=f[n]-v,o=r*r+i*i+a*a;o<=y&&o<N&&(cA.add(t,c[e],o),N=o)}if(N!==Number.MAX_VALUE)return!0}return t.count>0}var SA=vA(),CA=new Set,wA=new Set,_xe=[.1],vxe=[.1],yxe=[.1],TA=new hA;function bxe(e,t){let{min:n,expandedBox:r,boundingSphere:{center:i},size:[a,o,s],bucketOffset:c,bucketCounts:l,bucketArray:u,grid:d,data:{x:f,y:p,z:m,indices:h,radius:g},delta:_,maxRadius:v}=e.grid,{x:y,y:b,z:x,k:S,stopIf:C}=e,w=K.size(h);if(cA.reset(t),w===0||S<=0)return!1;let T,E,D,O=!1,k=1,A=!0,j=0,M=_xe,N=vxe,ee=0,te=!0,P,ne=!1,re=yxe,ie=v*v;M.length=0,re.length=0,CA.clear(),TA.clear(),B.set(SA.origin,y,b,x),$k.containsVec3(r,SA.origin)?(T=Math.floor((y-n[0])/_[0]),E=Math.floor((b-n[1])/_[1]),D=Math.floor((x-n[2])/_[2])):(vA.targetTo(SA,SA,i),vA.intersectBox3D(SA.origin,SA,r),T=Math.max(0,Math.min(a-1,Math.floor((SA.origin[0]-n[0])/_[0]))),E=Math.max(0,Math.min(o-1,Math.floor((SA.origin[1]-n[1])/_[1]))),D=Math.max(0,Math.min(s-1,Math.floor((SA.origin[2]-n[2])/_[2]))));let ae=v===0?1:Math.max(1,Math.min(a-1,Math.ceil(v/_[0]))),oe=v===0?1:Math.max(1,Math.min(o-1,Math.ceil(v/_[1]))),se=v===0?1:Math.max(1,Math.min(s-1,Math.ceil(v/_[2])));for(M.push(T,E,D,(T*o+E)*s+D);t.count<w;){let e=k*4;for(let t=0;t<e;t+=4)if(P=M[t+3],!CA.has(P)){CA.add(P),ne=CA.size>=d.length;let e=d[P];if(e!==0){let t=ee,n=e-1,r=c[n],i=r+l[n];for(let e=r;e<i;e++){let t=u[e],n=K.getAt(h,t),r=f[n]-y,i=p[n]-b,a=m[n]-x,o=r*r+i*i+a*a;if(v!==0){let e=g[n];o-=e*e}te&&o>ee&&(ee=o),TA.insert(o,t)}t<ee&&(te=!1)}}N.length=0,j=0,wA.clear();for(let t=0;t<e;t+=4){T=M[t],E=M[t+1],D=M[t+2];for(let e=-ae;e<=ae;e++){let t=T+e;if(!(t<0||t>=a))for(let e=-oe;e<=oe;e++){let r=E+e;if(!(r<0||r>=o))for(let e=-se;e<=se;e++){let i=D+e;if(!(i<0||i>=s)&&(P=(t*o+r)*s+i,!wA.has(P)&&(wA.add(P),!CA.has(P)))){if(!A){let e=n[0]+t*_[0]-y,a=n[1]+r*_[1]-b,o=n[2]+i*_[2]-x;if(e*e+a*a+o*o-ie>ee){re.push(t,r,i,P);continue}}N.push(t,r,i,P),j++}}}}}if(A=!1,j===0){if(S===1){let e=TA.findMinimum();if(e){let{key:n,value:r}=e;return cA.add(t,r,n),!0}}else for(;!TA.isEmpty()&&(ne||TA.findMinimum().key<=ee)&&t.count<S;){let e=TA.extractMinimum(),n=e.key,r=e.value;cA.add(t,r,n),C&&!O&&(O=C(r,n))}if(t.count>=S||O||t.count>=w)return t.count>0;if(A=!0,te=!0,re.length>0){for(let e=0,t=re.length;e<t;e++)M.push(re[e]);re.length=0,k=M.length}}else{let e=M;M=N,N=e,k=j}}return t.count>0}function xxe(e,t){for(let n=0,r=t*3;n<r;n+=3){let t=e[n],r=e[n+1],i=e[n+2],a=1/Math.sqrt(t*t+r*r+i*i);e[n]=t*a,e[n+1]=r*a,e[n+2]=i*a}return e}var EA=B();function DA(e,t,n,r){for(let i=0,a=r*3;i<a;i+=3)B.fromArray(EA,t,n+i),B.transformMat4(EA,EA,e),B.toArray(EA,t,n+i)}function Sxe(e,t,n,r){for(let i=0,a=r*3;i<a;i+=3)B.fromArray(EA,t,n+i),B.transformMat3(EA,EA,e),B.toArray(EA,t,n+i)}function Cxe(e,t){for(let n=0,r=e.length;n<r;n+=3)B.fromArray(EA,e,n),B.normalize(EA,EA),B.scale(EA,EA,t),B.toArray(EA,e,n)}var OA=B(),kA=B(),AA=B(),jA=B(),MA=B();function NA(e,t,n,r,i){for(let r=0,a=i*3;r<a;r+=3){let i=t[r]*3,a=t[r+1]*3,o=t[r+2]*3;B.fromArray(OA,e,i),B.fromArray(kA,e,a),B.fromArray(AA,e,o),B.sub(jA,AA,kA),B.sub(MA,OA,kA),B.cross(jA,jA,MA),n[i]+=jA[0],n[i+1]+=jA[1],n[i+2]+=jA[2],n[a]+=jA[0],n[a+1]+=jA[1],n[a+2]+=jA[2],n[o]+=jA[0],n[o+1]+=jA[1],n[o+2]+=jA[2]}return xxe(n,r)}function PA(e,t,n=1){let r=bE(e),i=new Int32Array(r+2),a=new Int32Array(t),o=new Int32Array(t);for(let r=0,i=t*n;r<i;r+=n)++o[e[r]];let s=0;for(let e=0;e<t;e++)i[e]=s,s+=o[e];i[t]=s;let c=new Int32Array(s);for(let r=0,o=t*n;r<o;r+=n){let t=e[r],n=i[t]+a[t];c[n]=r,++a[t]}return{indices:c,offsets:i}}var wxe=B.add,Txe=B.squaredDistance,Exe=B.distance,FA=class{reset(){B.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(e){wxe(this.center,this.center,e),this.count++}finishedIncludeStep(){this.count!==0&&B.scale(this.center,this.center,1/this.count)}radiusStep(e){let t=Txe(e,this.center);t>this.radiusSq&&(this.radiusSq=t)}radiusSphereStep(e,t){let n=Exe(e,this.center)+t,r=n*n;r>this.radiusSq&&(this.radiusSq=r)}getSphere(e){return e||=q(),B.copy(e.center,this.center),e.radius=Math.sqrt(this.radiusSq),e}getCount(){return this.count}constructor(){this.count=0,this.center=B(),this.radiusSq=0}};(function(e){let t=new e,n=B(),r=B();function i({x:e,y:r,z:i},a){t.reset();let o=e.length;for(let a=0;a<o;a++)B.set(n,e[a],r[a],i[a]),t.includeStep(n);t.finishedIncludeStep();for(let a=0;a<o;a++)B.set(n,e[a],r[a],i[a]),t.radiusStep(n);return B.copy(a.center,t.center),a.radius=Math.sqrt(t.radiusSq),a}e.fromArrays=i;function a(e,r,i){t.reset();for(let i=0;i<e;i++)r(i,n),t.includeStep(n);t.finishedIncludeStep();for(let i=0;i<e;i++)r(i,n),t.radiusStep(n);return B.copy(i.center,t.center),i.radius=Math.sqrt(t.radiusSq),i}e.fromProvider=a;function o(e,i,a){t.reset();for(let a=0;a<e;a++)i(a,n,r),t.includeStep(n),t.includeStep(r);t.finishedIncludeStep();for(let a=0;a<e;a++)i(a,n,r),t.radiusStep(n),t.radiusStep(r);return B.copy(a.center,t.center),a.radius=Math.sqrt(t.radiusSq),a}e.fromPairProvider=o})(FA||={});var IA=B.dot,LA=B.copy,Dxe=B.scaleAndSub,Oxe=B.scaleAndAdd,RA=class{computeExtrema(e,t){let n=IA(this.dir[e],t);n<this.minDist[e]&&(this.minDist[e]=n,LA(this.extrema[e*2],t)),n>this.maxDist[e]&&(this.maxDist[e]=n,LA(this.extrema[e*2+1],t))}computeSphereExtrema(e,t,n){let r=this.dir[e],i=IA(r,t);i-n<this.minDist[e]&&(this.minDist[e]=i-n,Dxe(this.extrema[e*2],t,r,n)),i+n>this.maxDist[e]&&(this.maxDist[e]=i+n,Oxe(this.extrema[e*2+1],t,r,n))}includeSphere(e){if(q.hasExtrema(e)&&e.extrema.length>1)for(let t of e.extrema)this.includePosition(t);else this.includePositionRadius(e.center,e.radius)}includePosition(e){for(let t=0;t<this.dirLength;++t)this.computeExtrema(t,e)}includePositionRadius(e,t){for(let n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,e,t)}finishedIncludeStep(){for(let e=0;e<this.extrema.length;e++)this.centroidHelper.includeStep(this.extrema[e]);this.centroidHelper.finishedIncludeStep()}radiusSphere(e){if(q.hasExtrema(e)&&e.extrema.length>1)for(let t of e.extrema)this.radiusPosition(t);else this.radiusPositionRadius(e.center,e.radius)}radiusPosition(e){this.centroidHelper.radiusStep(e)}radiusPositionRadius(e,t){this.centroidHelper.radiusSphereStep(e,t)}getSphere(e){return q.setExtrema(this.centroidHelper.getSphere(e),this.extrema.slice())}getBox(e){return $k.fromVec3Array(e||$k(),this.extrema)}reset(){for(let e=0;e<this.dirLength;++e)this.minDist[e]=1/0,this.maxDist[e]=-1/0,this.extrema[e*2]=B(),this.extrema[e*2+1]=B();this.centroidHelper.reset()}constructor(e){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new FA,this.dir=kxe(e),this.dirLength=this.dir.length,this.reset()}};function kxe(e){let t;switch(e){case`6`:t=[...zA];break;case`14`:t=[...zA,...BA];break;case`26`:t=[...zA,...BA,...VA];break;case`98`:t=[...zA,...BA,...VA,...Axe,...jxe,...Mxe];break}return t.map(e=>{let t=B.create(e[0],e[1],e[2]);return B.normalize(t,t)})}var zA=[[1,0,0],[0,1,0],[0,0,1]],BA=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],VA=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],Axe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],jxe=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],Mxe=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],HA=B.fromArray,UA=B.transformMat4Offset;function Nxe(e,t){e=Math.max(e,2);let n=Math.sqrt(e),r=Math.ceil(n);r+=(t-r%t)%t;let i=r>0?Math.ceil(e/r):0;return{width:r,height:i,length:r*i*t}}function WA(e,t,n,r){let{length:i,width:a,height:o}=Nxe(e,t);return r=r&&r.length>=i?r:new n(i),{array:r,width:a,height:o}}var GA=B(),Pxe=new RA(`14`),Fxe=new RA(`98`);function KA(e){return e>1e5?Pxe:Fxe}function qA(e,t,n){let r=n*3,i=KA(t);i.reset();for(let n=0,a=t*3;n<a;n+=r)HA(GA,e,n),i.includePosition(GA);i.finishedIncludeStep();for(let n=0,a=t*3;n<a;n+=r)HA(GA,e,n),i.radiusPosition(GA);let a=i.getSphere();if(t<=14){let n=[];for(let i=0,a=t*3;i<a;i+=r)n.push(HA(B(),e,i));q.setExtrema(a,n)}return a}var JA=z();function YA(e,t,n,r){if(n===1){z.fromArray(JA,t,r);let n=q.clone(e);return z.isIdentity(JA)?n:q.transform(n,n,JA)}let i=KA(n);i.reset();let{center:a,radius:o,extrema:s}=e;if(s&&n<=14){for(let e=0,a=n;e<a;++e)for(let n of s)UA(GA,n,t,0,0,e*16+r),i.includePosition(GA);i.finishedIncludeStep();for(let e=0,a=n;e<a;++e)for(let n of s)UA(GA,n,t,0,0,e*16+r),i.radiusPosition(GA)}else{for(let e=0,s=n;e<s;++e)UA(GA,a,t,0,0,e*16+r),i.includePositionRadius(GA,o);i.finishedIncludeStep();for(let e=0,s=n;e<s;++e)UA(GA,a,t,0,0,e*16+r),i.radiusPositionRadius(GA,o)}return i.getSphere()}var XA=new Uint8Array(772);XA[1]=1,XA[2]=1,XA[3]=1,XA[256]=1,XA[512]=1,XA[768]=1,XA[257]=2,XA[513]=2,XA[769]=2,XA[258]=2,XA[514]=2,XA[770]=2,XA[259]=2,XA[515]=2,XA[771]=2;function ZA(e,t){if(t===0)return 0;let n=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),r=t-4>>2,i=4*r,a=0;if(r<0)for(let n=0;n<t;++n)a+=e[n]&&1;else{for(let e=0;e<r;++e){let t=n[e];a+=XA[t&65535]+XA[t>>16]}for(let n=i;n<t;++n)a+=e[n]&&1}return a/t}function QA(e,t,n){let r=WA(Math.max(1,e),1,Uint8Array,n&&n.tMarker.ref.value.array),i=ZA(r.array,e),a=i===0?0:-1;return n?(L.updateIfChanged(n.uMarker,0),L.update(n.tMarker,r),L.update(n.uMarkerTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.markerAverage,i),L.updateIfChanged(n.markerStatus,a),L.updateIfChanged(n.dMarkerType,t),n):{uMarker:L.create(0),tMarker:L.create(r),uMarkerTexDim:L.create(R.create(r.width,r.height)),markerAverage:L.create(i),markerStatus:L.create(a),dMarkerType:L.create(t)}}new Uint8Array(1);const $A={kind:`null-location`};function ej(e,t,n){return{kind:`data-location`,tag:e,data:t,element:n}}function tj(e,t,n,r,i=!1,a=()=>!1,o){if(e%n!==0)throw Error(`incompatible groupCount and stride`);let s={location:$A,location2:$A,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},c=s.groupIndex<e,l=!1,u=0,d=0,f=!1,p=!!o;return{get hasNext(){return c},get isNextNewInstance(){return l},groupCount:e,instanceCount:t,count:e*t,stride:n,nonInstanceable:i,hasLocation2:p,move(){return c&&=(s.groupIndex=u,s.instanceIndex=d,s.index=d*e+u,s.location=r(u,f?-1:d),p&&(s.location2=o(u,f?-1:d)),s.isSecondary=a(u,f?-1:d),u+=n,u===e?(++d,l=!0,d<t&&(u=0)):l=!1,u<e),s},reset(){s.location=$A,s.location2=$A,s.index=0,s.groupIndex=0,s.instanceIndex=0,s.isSecondary=!1,c=s.groupIndex<e,l=!1,u=0,d=0,f=!1},skipInstance(){c&&s.instanceIndex===d&&(++d,u=0,c=d<t)},voidInstances(){f=!0}}}const nj={get hasNext(){return!1},get isNextNewInstance(){return!1},groupCount:0,instanceCount:0,count:0,stride:0,nonInstanceable:!1,hasLocation2:!1,move(){return{location:$A,location2:$A,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1}},reset(){},skipInstance(){},voidInstances(){}};function rj(e,t){return{kind:`position-location`,position:e?B.clone(e):B(),normal:t?B.clone(t):B()}}function ij(e){return!!e&&e.kind===`position-location`}var aj=mb();function Ixe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return`complete`;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return`incomplete attachment`;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return`incomplete missing attachment`;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return`incomplete dimensions`;case e.FRAMEBUFFER_UNSUPPORTED:return`unsupported`}if(Bj(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return`incomplete multisample`;case e.RENDERBUFFER_SAMPLES:return`renderbuffer samples`}return`unknown error`}function oj(e,t){let n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE){let r=Ixe(e,n);throw Error(`Framebuffer status: ${r}${t?` (${t})`:``}`)}}function sj(e){let t=e.createFramebuffer();if(t===null)throw Error(`Could not create WebGL framebuffer`);return t}function Lxe(e){let t=sj(e),n=!1;return{id:aj(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=sj(e)},destroy:()=>{n||=(e.deleteFramebuffer(t),!0)}}}function Rxe(){return{id:aj(),bind:()=>{},reset:()=>{},destroy:()=>{}}}function cj(e){let t=_Ce(e);if(t===null)throw Error(`Could not find support for "instanced_arrays"`);let n=yCe(e);if(n===null)throw Error(`Could not find support for "element_index_uint"`);let r=vCe(e);if(r===null)throw Error(`Could not find support for "standard_derivatives"`);let i=xCe(e);Qy&&i===null&&console.log(`Could not find support for "texture_float"`);let a=SCe(e);Qy&&a===null&&console.log(`Could not find support for "texture_float_linear"`);let o=CCe(e);Qy&&o===null&&console.log(`Could not find support for "texture_half_float"`);let s=wCe(e);Qy&&s===null&&console.log(`Could not find support for "texture_half_float_linear"`);let c=MCe(e);Qy&&c===null&&console.log(`Could not find support for "depth_texture"`);let l=TCe(e);Qy&&l===null&&console.log(`Could not find support for "blend_minmax"`);let u=bCe(e);Qy&&u===null&&console.log(`Could not find support for "vertex_array_object"`);let d=ECe(e);Qy&&d===null&&console.log(`Could not find support for "frag_depth"`);let f=DCe(e);Qy&&f===null&&console.log(`Could not find support for "color_buffer_float"`);let p=OCe(e);Qy&&p===null&&console.log(`Could not find support for "color_buffer_half_float"`);let m=kCe(e);Qy&&m===null&&console.log(`Could not find support for "draw_buffers"`);let h=ACe(e);Qy&&h===null&&console.log(`Could not find support for "draw_buffers_indexed"`);let g=jCe(e);Qy&&g===null&&console.log(`Could not find support for "shader_texture_lod"`);let _=NCe(e);Qy&&_===null&&console.log(`Could not find support for "sRGB"`);let v=PCe(e);Qy&&v===null&&console.log(`Could not find support for "disjoint_timer_query"`);let y=FCe(e);Qy&&y===null&&console.log(`Could not find support for "multi_draw"`);let b=ICe(e);Qy&&b===null&&console.log(`Could not find support for "draw_instanced_base_vertex_base_instance"`);let x=LCe(e);Qy&&x===null&&console.log(`Could not find support for "multi_draw_instanced_base_vertex_base_instance"`);let S=RCe(e);Qy&&S===null&&console.log(`Could not find support for "parallel_shader_compile"`);let C=zCe(e);Qy&&C===null&&console.log(`Could not find support for "fbo_render_mipmap"`);let w=BCe(e);Qy&&w===null&&console.log(`Could not find support for "provoking_vertex"`);let T=VCe(e);Qy&&T===null&&console.log(`Could not find support for "clip_cull_distance"`);let E=HCe(e);Qy&&E===null&&console.log(`Could not find support for "conservative_depth"`);let D=UCe(e);Qy&&D===null&&console.log(`Could not find support for "stencil_texturing"`);let O=WCe(e);Qy&&O===null&&console.log(`Could not find support for "clip_control"`);let k=GCe(e);Qy&&k===null&&console.log(`Could not find support for "render_snorm"`);let A=KCe(e);Qy&&A===null&&console.log(`Could not find support for "render_shared_exponent"`);let j=qCe(e);Qy&&j===null&&console.log(`Could not find support for "texture_norm16"`);let M=JCe(e);Qy&&M===null&&console.log(`Could not find support for "depth_clamp"`);let N=YCe(e);return Qy&&N===null&&console.log(`Could not find support for "multiview2"`),{instancedArrays:t,standardDerivatives:r,elementIndexUint:n,textureFloat:i,textureFloatLinear:a,textureHalfFloat:o,textureHalfFloatLinear:s,depthTexture:c,blendMinMax:l,vertexArrayObject:u,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:m,drawBuffersIndexed:h,shaderTextureLod:g,sRGB:_,disjointTimerQuery:v,multiDraw:y,drawInstancedBaseVertexBaseInstance:b,multiDrawInstancedBaseVertexBaseInstance:x,parallelShaderCompile:S,fboRenderMipmap:C,provokingVertex:w,clipCullDistance:T,conservativeDepth:E,stencilTexturing:D,clipControl:O,renderSnorm:k,renderSharedExponent:A,textureNorm16:j,depthClamp:M,multiview2:N,noNonInstancedActiveAttribs:XCe(e)}}function zxe(e,t){let n=cj(e);WT(t,(e,r)=>{r===`noNonInstancedActiveAttribs`?t.noNonInstancedActiveAttribs=n.noNonInstancedActiveAttribs:e!==null&&(n[r]===null?t[r]=null:Object.assign(e,n[r]))})}function Bxe(e,t){let n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),c=e.getParameter(e.COLOR_WRITEMASK),l=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),_=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),y=e.getParameter(e.STENCIL_REF),b=e.getParameter(e.STENCIL_BACK_FUNC),x=e.getParameter(e.STENCIL_BACK_VALUE_MASK),S=e.getParameter(e.STENCIL_BACK_REF),C=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),D=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),O=e.getParameter(e.STENCIL_BACK_FAIL),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),A=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),M=[],N=e.getParameter(e.VIEWPORT),ee=e.getParameter(e.SCISSOR_BOX),te=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,P=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,ne=()=>{for(let e=0;e<j;++e)M[e]=0};return ne(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:t=>{n[t]!==!0&&(e.enable(t),n[t]=!0)},disable:t=>{n[t]!==!1&&(e.disable(t),n[t]=!1)},frontFace:t=>{t!==r&&(e.frontFace(t),r=t)},cullFace:t=>{t!==i&&(e.cullFace(t),i=t)},depthMask:t=>{t!==a&&(e.depthMask(t),a=t)},clearDepth:t=>{t!==o&&(e.clearDepth(t),o=t)},depthFunc:t=>{t!==s&&(e.depthFunc(t),s=t)},colorMask:(t,n,r,i)=>{(t!==c[0]||n!==c[1]||r!==c[2]||i!==c[3])&&(e.colorMask(t,n,r,i),c[0]=t,c[1]=n,c[2]=r,c[3]=i)},clearColor:(t,n,r,i)=>{(t!==l[0]||n!==l[1]||r!==l[2]||i!==l[3])&&(e.clearColor(t,n,r,i),l[0]=t,l[1]=n,l[2]=r,l[3]=i)},blendFunc:(t,n)=>{(t!==u||n!==d||t!==f||n!==p)&&(e.blendFunc(t,n),u=t,d=n,f=t,p=n)},blendFuncSeparate:(t,n,r,i)=>{(t!==u||n!==d||r!==f||i!==p)&&(e.blendFuncSeparate(t,n,r,i),u=t,d=n,f=r,p=i)},blendEquation:t=>{(t!==h||t!==g)&&(e.blendEquation(t),h=t,g=t)},blendEquationSeparate:(t,n)=>{(t!==h||n!==g)&&(e.blendEquationSeparate(t,n),h=t,g=n)},blendColor:(t,n,r,i)=>{(t!==m[0]||n!==m[1]||r!==m[2]||i!==m[3])&&(e.blendColor(t,n,r,i),m[0]=t,m[1]=n,m[2]=r,m[3]=i)},stencilFunc:(t,n,r)=>{(t!==_||n!==y||r!==v||t!==b||n!==S||r!==x)&&(e.stencilFunc(t,n,r),_=t,y=n,v=r,b=t,S=n,x=r)},stencilFuncSeparate:(t,n,r,i)=>{t===e.FRONT?(n!==_||r!==y||i!==v)&&(e.stencilFuncSeparate(t,n,r,i),_=n,y=r,v=i):t===e.BACK?(n!==b||r!==S||i!==x)&&(e.stencilFuncSeparate(t,n,r,i),b=n,S=r,x=i):t===e.FRONT_AND_BACK&&(n!==_||r!==y||i!==v||n!==b||r!==S||i!==x)&&(e.stencilFuncSeparate(t,n,r,i),_=n,y=r,v=i,b=n,S=r,x=i)},stencilMask:t=>{(t!==C||t!==w)&&(e.stencilMask(t),C=t,w=t)},stencilMaskSeparate:(t,n)=>{t===e.FRONT?n!==C&&(e.stencilMaskSeparate(t,n),C=n):t===e.BACK?n!==w&&(e.stencilMaskSeparate(t,n),w=n):t===e.FRONT_AND_BACK&&(n!==C||n!==w)&&(e.stencilMaskSeparate(t,n),C=n,w=n)},stencilOp:(t,n,r)=>{(t!==T||n!==D||r!==E||t!==O||n!==A||r!==k)&&(e.stencilOp(t,n,r),T=t,D=n,E=r,O=t,A=n,k=r)},stencilOpSeparate:(t,n,r,i)=>{t===e.FRONT?(n!==T||r!==D||i!==E)&&(e.stencilOpSeparate(t,n,r,i),T=n,D=r,E=i):t===e.BACK?(n!==O||r!==A||i!==k)&&(e.stencilOpSeparate(t,n,r,i),O=n,A=r,k=i):t===e.FRONT_AND_BACK&&(n!==T||r!==D||i!==E||n!==O||r!==A||i!==k)&&(e.stencilOpSeparate(t,n,r,i),T=n,D=r,E=i,O=n,A=r,k=i)},enableVertexAttrib:t=>{e.enableVertexAttribArray(t),M[t]=1},clearVertexAttribsState:ne,disableUnusedVertexAttribs:()=>{for(let t=0;t<j;++t)M[t]===0&&e.disableVertexAttribArray(t)},viewport:(t,n,r,i)=>{(t!==N[0]||n!==N[1]||r!==N[2]||i!==N[3])&&(e.viewport(t,n,r,i),N[0]=t,N[1]=n,N[2]=r,N[3]=i)},scissor:(t,n,r,i)=>{(t!==ee[0]||n!==ee[1]||r!==ee[2]||i!==ee[3])&&(e.scissor(t,n,r,i),ee[0]=t,ee[1]=n,ee[2]=r,ee[3]=i)},clipControl:t.clipControl?(e,n)=>{(e!==te||n!==P)&&(t.clipControl.clipControl(e,n),te=e,P=n)}:void 0,reset:()=>{n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),a=e.getParameter(e.DEPTH_WRITEMASK),o=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),c=e.getParameter(e.COLOR_WRITEMASK),l=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),_=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),y=e.getParameter(e.STENCIL_REF),b=e.getParameter(e.STENCIL_BACK_FUNC),x=e.getParameter(e.STENCIL_BACK_VALUE_MASK),S=e.getParameter(e.STENCIL_BACK_REF),C=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),D=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),O=e.getParameter(e.STENCIL_BACK_FAIL),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),A=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),j=e.getParameter(e.MAX_VERTEX_ATTRIBS),M.length=0;for(let e=0;e<j;++e)M[e]=0;N=e.getParameter(e.VIEWPORT),ee=e.getParameter(e.SCISSOR_BOX),te=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,P=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}var lj=mb(),Vxe={apply_fog:`
float preFogAlpha = gl_FragColor.a;
if (uFog) {
    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
    if (!uTransparentBackground) {
        if (gl_FragColor.a < 1.0) {
            // transparent objects are blended with background color
            gl_FragColor.a = fogAlpha;
        } else {
            // mix opaque objects with background color
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
        }
    } else {
        #if defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
            if (gl_FragColor.a < 1.0) {
                // transparent objects are blended with background color
                gl_FragColor.a = fogAlpha;
            } else {
                // opaque objects need to be pre-multiplied alpha
                gl_FragColor.rgb *= fogAlpha;
                gl_FragColor.a = fogAlpha;
            }
        #else
            // pre-multiplied alpha expected for transparent background
            gl_FragColor.rgb *= fogAlpha;
            gl_FragColor.a = fogAlpha;
        #endif
    }
} else if (uTransparentBackground) {
    #if !defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)
        // pre-multiplied alpha expected for transparent background
        gl_FragColor.rgb *= gl_FragColor.a;
    #endif
}
`,apply_interior_color:`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }

    #ifdef dTransparentBackfaces_opaque
        gl_FragColor.a = 1.0;
    #endif
}
`,apply_light_color:`
#if defined(dIgnoreLight)
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;
            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;
        }
    #endif

    #if defined(dRenderVariant_color)
        material.rgb += material.rgb * emissive;
    #endif

    gl_FragColor = material;
#else
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
        }
    #endif

    vec4 color = material;

    #if defined(dCelShaded)
        // clamp to avoid artifacts
        metalness = clamp(metalness, 0.0, 0.99);
        roughness = clamp(roughness, 0.05, 1.0);
    #endif

    GeometricContext geometry;
    geometry.position = -vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = normalize(vViewPosition);

    PhysicalMaterial physicalMaterial;
    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
    #ifdef enabledFragDepth
        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
    #else
        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
    #endif
    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
    physicalMaterial.specularF90 = 1.0;

    IncidentLight directLight;

    vec3 outgoingLight = vec3(0.0);

    #if defined(dCelShaded)
        float celDiffuse;
        float celSpecular;
        float celIntensity;

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light

            celDiffuse = RECIPROCAL_PI * max(dot(geometry.normal, directLight.direction), 0.0) * (1.0 - metalness);
            celSpecular = luminance(saturate(dot(geometry.normal, directLight.direction)) * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, physicalMaterial.specularColor, physicalMaterial.specularF90, roughness));

            celIntensity = celDiffuse + celSpecular;
            celIntensity = ceil(celIntensity * uCelSteps) / uCelSteps;

            outgoingLight += color.rgb * directLight.color * celIntensity;
        }
        #pragma unroll_loop_end

        outgoingLight += physicalMaterial.diffuseColor * luminance(uAmbientColor);
    #else
        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            directLight.direction = uLightDirection[i];
            directLight.color = uLightColor[i] * PI; // * PI for punctual light
            RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
        }
        #pragma unroll_loop_end

        vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
        RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

        // indirect specular only metals
        vec3 radiance = uAmbientColor * metalness;
        vec3 iblIrradiance = uAmbientColor * metalness;
        vec3 clearcoatRadiance = vec3(0.0);
        RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

        outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    #endif
    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background

    #if defined(dRenderVariant_color)
        outgoingLight += color.rgb * emissive;
    #endif

    gl_FragColor = vec4(outgoingLight, color.a);
#endif

gl_FragColor.rgb *= uExposure;
`,apply_marker_color:`

#if defined(dColorMarker)
    if (marker > 0.0) {
        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
        } else {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
        }
    } else if (uMarkerAverage > 0.0) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);
        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering
    }
#endif
`,assign_clipping_varying:`
#if dClipObjectCount != 0 && defined(dClipping)
    #if defined(dClippingType_instance)
        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
    #endif
#endif
`,assign_color_varying:`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_groupInstance)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + vertexId, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition / uModelScale - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / PALETTE_SCALE;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance)
            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);
        #elif defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + vertexId, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition / uModelScale - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
        vOverpaint *= uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance)
            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);
        #elif defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + vertexId, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition / uModelScale - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
        vSubstance *= uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #ifdef requiredDrawBuffers
        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);
        vInstance = vec4(packIntToRGB(aInstance), 1.0);
        vGroup = vec4(packIntToRGB(group), 1.0);
    #else
        if (uPickType == 1) {
            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            vColor = vec4(packIntToRGB(aInstance), 1.0);
        } else {
            vColor = vec4(packIntToRGB(group), 1.0);
        }
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance)
        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + vertexId, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition / uModelScale - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
    vTransparency *= uTransparencyStrength;
#endif
`,assign_group:`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, vertexId, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`,assign_marker_varying:`
#if defined(dNeedsMarker)
    #if defined(dMarkerType_instance)
        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
    #endif
#endif
`,assign_material_color:`
#if defined(dNeedsMarker)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts
        metalness = mix(metalness, vSubstance.r, sf);
        roughness = mix(roughness, vSubstance.g, sf);
        bumpiness = mix(bumpiness, vSubstance.b, sf);
    #endif

    #if defined(dXrayShaded)
        material.a = calcXrayShadedAlpha(material.a, normal);
    #endif
#elif defined(dRenderVariant_depth)
    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
        discard;
    }
    vec4 material;
    if (uRenderMask == MaskOpaque) {
        #if defined(dXrayShaded)
            discard;
        #endif
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            #if __VERSION__ == 100 || defined(dVaryingGroup)
                if (vTransparency < 0.1) dta = 1.0; // hard cutoff to avoid artifacts
            #endif

            if (uAlpha * dta < 1.0) {
                discard;
            }
        #else
            if (uAlpha < 1.0) {
                discard;
            }
        #endif
        material = packDepthToRGBA(fragmentDepth);
    } else if (uRenderMask == MaskTransparent) {
        float alpha = uAlpha;
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            alpha *= dta;
        #endif

        #ifdef dXrayShaded
            alpha = calcXrayShadedAlpha(alpha, normal);
        #else
            if (alpha == 1.0) {
                discard;
            }
        #endif
        material = packDepthWithAlphaToRGBA(fragmentDepth, alpha);
    }
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#elif defined(dRenderVariant_emissive)
    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif
    vec4 material = vec4(emissive);
#endif

// apply per-group transparency
#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
    float ta = 1.0 - vTransparency;
    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better

    #if defined(dRenderVariant_pick)
        if (ta * uAlpha < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #elif defined(dRenderVariant_emissive)
        if (ta < 1.0)
            discard; // emissive not supported with transparency
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        material.a *= ta;
    #endif
#endif
`,assign_position:`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, vertexId, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`,assign_size:`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`,check_picking_alpha:`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float fogAlpha = (1.0 - fogFactor) * uAlpha;
float alpha = uAlpha;
#ifdef dXrayShaded
    // add bias to make picking xray shaded elements easier
    alpha = calcXrayShadedAlpha(alpha, normal) + (0.3 * uPickingAlphaThreshold);
#endif
// if not opaque enough ignore so the element below can be picked
if (alpha < uPickingAlphaThreshold || fogAlpha < 0.1) {
    #ifdef dTransparentBackfaces_opaque
        if (!interior) discard;
    #else
        discard;
    #endif
}
`,check_transparency:`
#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dTransparentBackfaces_off)
        if (interior && material.a < 1.0) discard;
    #elif defined(dTransparentBackfaces_opaque)
        if (interior) material.a = 1.0;
    #endif

    #if !defined(dXrayShaded)
        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
            (uRenderMask == MaskTransparent && material.a == 1.0)
        ) {
            discard;
        }
    #endif
#endif

#if defined(dRenderVariant_depth)
    #if defined(dTransparentBackfaces_off)
        if (interior) discard;
    #endif
#endif
`,clip_instance:`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    vec3 mCenter = (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz;
    if (clipTest(mCenter / uModelScale)) {
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
    }
#endif
`,clip_pixel:`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    if (clipTest(vModelPosition / uModelScale))
        discard;
#endif
`,color_frag_params:`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dEmissive
        varying float vEmissive;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        varying float vEmissive;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat in vec4 vObject;
            flat in vec4 vInstance;
            flat in vec4 vGroup;
        #else
            flat in vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    varying float vTransparency;
#endif
`,color_vert_params:`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #elif defined(dColorType_direct)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
        uniform float uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
        uniform float uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat out vec4 vObject;
            flat out vec4 vInstance;
            flat out vec4 vGroup;
        #else
            flat out vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
    uniform float uTransparencyStrength;
#endif
`,common_clip:`
vec3 quaternionTransform(const in vec4 q, const in vec3 v) {
    vec3 t = 2.0 * cross(q.xyz, v);
    return v + q.w * t + cross(q.xyz, t);
}

vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {
    return vec4(normalize(normal), -dot(normal, inPoint));
}

float planeSD(const in vec4 plane, const in vec3 center) {
    return -dot(plane.xyz, center - plane.xyz * -plane.w);
}

float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    return (
        length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
    ) * min(min(size.x, size.y), size.z);
}

float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
    return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
}

float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
    return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
}

float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

    float q = length(t.xy);
    return dot(size.xy, vec2(q, t.z));
}

float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale, const in mat4 transform) {
    vec3 c = (transform * vec4(center, 1.0)).xyz;
    if (type == 1) {
        vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
        vec4 plane = computePlane(normal, position);
        return planeSD(plane, c);
    } else if (type == 2) {
        return sphereSD(position, rotation, scale * 0.5, c);
    } else if (type == 3) {
        return cubeSD(position, rotation, scale * 0.5, c);
    } else if (type == 4) {
        return cylinderSD(position, rotation, scale * 0.5, c);
    } else if (type == 5) {
        return infiniteConeSD(position, rotation, scale * 0.5, c);
    } else {
        return 0.1;
    }
}

#if __VERSION__ == 100
    // 8-bit
    int bitwiseAnd(in int a, in int b) {
        int d = 128;
        int result = 0;
        for (int i = 0; i < 8; ++i) {
            if (d <= 0) break;
            if (a >= d && b >= d) result += d;
            if (a >= d) a -= d;
            if (b >= d) b -= d;
            d /= 2;
        }
        return result;
    }

    bool hasBit(const in int mask, const in int bit) {
        return bitwiseAnd(mask, bit) == 0;
    }
#else
    bool hasBit(const in int mask, const in int bit) {
        return (mask & bit) == 0;
    }
#endif

#if dClipObjectCount != 0
    bool clipTest(const in vec3 center) {
        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
        #if defined(dClipping)
            int flag = int(floor(vClipping * 255.0 + 0.5));
        #else
            int flag = 0;
        #endif

        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                bool test = getSignedDistance(center, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i], uClipObjectTransform[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`,common_frag_params:`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

uniform vec4 uCameraPlane;
uniform vec4 uLod;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

#if defined(dRenderVariant_colorDpoit)
    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript
    uniform sampler2D tDpoitDepth;
    uniform sampler2D tDpoitFrontColor;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;
uniform float uModelScale;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform mat4 uProjection;

uniform int uRenderMask;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepthPacked(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);
    if (det == 0.0) return normal;

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}

#ifdef dXrayShaded
    float calcXrayShadedAlpha(in float alpha, const in vec3 normal) {
        #if defined(dXrayShaded_on)
            alpha *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #elif defined(dXrayShaded_inverted)
            alpha *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
        #endif
        return clamp(alpha, 0.001, 0.999);
    }
#endif
`,common_vert_params:`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;
uniform vec4 uCameraPlane;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;
uniform vec4 uLod;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform float uModelScale;

#if defined(noNonInstancedActiveAttribs)
    // int() is needed for some Safari versions
    // see https://bugs.webkit.org/show_bug.cgi?id=244152
    #define VertexID int(gl_VertexID)
#else
    attribute float aVertex;
    #define VertexID int(aVertex)
#endif

#if defined(enabledMultiDraw)
    #define DrawID gl_DrawID
#else
    #define DrawID uDrawId
#endif
`,common:`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

#if ((defined(dRenderVariant_color) || defined(dRenderVariant_tracing)) && defined(dColorMarker)) || defined(dRenderVariant_marking)
    #define dNeedsMarker
#endif

#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)
    #define dXrayShaded
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || ((defined(dRenderVariant_depth) || defined(dRenderVariant_pick)) && defined(dXrayShaded))
    #define dNeedsNormal
#endif

#define MaskAll 0
#define MaskOpaque 1
#define MaskTransparent 2

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6
#define ONE_MINUS_EPSILON 1.0 - EPSILON
#define TWO_PI 6.2831853
#define HALF_PI 1.570796325

#define PALETTE_SCALE 16777214.0 // (1 << 24) - 2

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

float pack2x4(vec2 v) {
    vec2 clamped_v = clamp(v, 0.0, 1.0);
    vec2 scaled_v = floor(clamped_v * 15.0 + 0.5); // round to 015
    float c = scaled_v.x + scaled_v.y * 16.0;
    return c / 255.0;
}

vec2 unpack2x4(float f) {
    float c = floor(f * 255.0 + 0.5);
    float lo = mod(c, 16.0);
    float hi = floor(c / 16.0);
    return vec2(lo, hi) / 15.0;
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 packDepthWithAlphaToRGBA(const in float depth, const in float alpha){
    vec3 r = vec3(fract(depth * PackFactors.yz), depth);
    r.yz -= r.xy * ShiftRight8; // tidy overflow
    return vec4(r * PackUpscale, alpha);
}
vec2 unpackRGBAToDepthWithAlpha(const in vec4 v) {
    return vec2(dot(v.xyz, UnpackFactors.yzw), v.w);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float luminance(vec3 c) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    return dot(c, W);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

// see https://github.com/graphitemaster/normals_revisited and https://www.shadertoy.com/view/3s33zj
mat3 adjoint(const in mat4 m) {
    return mat3(
        cross(m[1].xyz, m[2].xyz),
        cross(m[2].xyz, m[0].xyz),
        cross(m[0].xyz, m[1].xyz)
    );
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`,fade_lod:`
if (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
    float d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;
    float ta = min(
        smoothstep(uLod.x, uLod.x + uLod.z, d),
        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
    );

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        float at = 0.0;

        // shift by view-offset during multi-sample rendering to allow for blending
        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

        const mat4 thresholdMatrix = mat4(
            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
        );
        int ci = int(intMod(coord.x, 4.0));
        int ri = int(intMod(coord.y, 4.0));
        #if __VERSION__ == 100
            vec4 i = vec4(float(ci * 4 + ri));
            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
            at = v.x + v.y + v.z + v.w;
        #else
            at = thresholdMatrix[ci][ri];
        #endif

        if (ta < 0.99 && (ta < 0.01 || ta < at)) {
            discard;
        }
    #else
        if (ta < uPickingAlphaThreshold) {
            discard;
        }
    #endif
}
`,float_to_rgba:`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`,light_frag_params:`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disneys reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Agera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`,normal_frag_params:`
varying vec3 vNormal;
`,read_from_texture:`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`,rgba_to_float:`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`,size_vert_params:`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`,texture3d_from_1d_trilinear:`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`,texture3d_from_2d_linear:`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`,texture3d_from_2d_nearest:`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`,wboit_write:`
#if defined(dRenderVariant_colorWboit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`,dpoit_write:`
#if defined(dRenderVariant_colorDpoit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif

            // adapted from https://github.com/tsherif/webgl2examples
            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao

            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;
            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);

            vec4 fragColor = gl_FragColor;

            // depth value always increases
            // so we can use MAX blend equation
            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);

            // front color always increases
            // so we can use MAX blend equation
            gl_FragColor = lastFrontColor;

            // back color is separately blend afterwards each pass
            gl_FragData[1] = vec4(0.0);

            float nearestDepth = -lastDepth.x;
            float furthestDepth = lastDepth.y;
            float alphaMultiplier = 1.0 - lastFrontColor.a;

            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {
                // Skip this depth since it's been peeled.
                return;
            }

            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {
                // This needs to be peeled.
                // The ones remaining after MAX blended for
                // all need-to-peel will be peeled next pass.
                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);
                return;
            }

            // write to back and front color buffer
            if (fragmentDepth == nearestDepth) {
                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;
                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);
            } else {
                gl_FragData[1] += fragColor;
            }

        } else {
            discard;
        }
    }
#endif
`},Hxe=/^(?!\/\/)\s*#include\s+(\S+)/gm,Uxe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,Wxe=/[ \t]*\/\/.*\n/g,Gxe=/[ \t]*\/\*[\s\S]*?\*\//g,Kxe=/\n{2,}/g;function uj(e){return e.replace(Hxe,(e,t)=>{let n=Vxe[t];if(!n)throw Error(`empty chunk, '${t}'`);return n}).trim().replace(Wxe,`
`).replace(Gxe,`
`).replace(Kxe,`
`)}function qxe(e){return e.replace(Uxe,Jxe)}function Jxe(e,t,n,r){let i=``;for(let e=parseInt(t);e<parseInt(n);++e)i+=r.replace(/\[\s*i\s*\]/g,`[${e}]`).replace(/UNROLLED_LOOP_INDEX/g,`${e}`);return i}function Yxe(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}function dj(e,t){return qxe(Yxe(e,t))}function fj(e,t,n,r={},i={},a){return{id:lj(),name:e,vert:uj(t),frag:uj(n),extensions:r,outTypes:i,ignoreDefine:a}}function pj(e,t,n){if(t.startsWith(`color`)||t===`tracing`){if(e===`dLightCount`)return!!n.dIgnoreLight?.ref.value}else{let n=[`dColorType`,`dUsePalette`,`dOverpaintType`,`dOverpaint`,`dSubstanceType`,`dSubstance`,`dColorMarker`,`dCelShaded`,`dLightCount`];return t!==`depth`&&!t.startsWith(`pick`)&&n.push(`dXrayShaded`),t!==`emissive`&&n.push(`dEmissiveType`,`dEmissive`),n.includes(e)}return!1}function mj(e,t,n){return e===`dLightCount`?!0:pj(e,t,n)}const Xxe=fj(`points`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`,`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dPointStyle_fuzzy) && (defined(dRenderVariant_color) || defined(dRenderVariant_tracing))
        material.a *= fuzzyAlpha;
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{drawBuffers:`optional`},{},mj),Zxe=fj(`spheres`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;
uniform float uIsOrtho;
uniform bool uIsAsymmetricProjection;

uniform vec2 uTexDim;
uniform sampler2D tPositionGroup;

attribute mat4 aTransform;
attribute float aInstance;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

/**
 * Bounding rectangle of a clipped, perspective-projected 3D Sphere.
 * Michael Mara, Morgan McGuire. 2013
 *
 * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018
 * https://github.com/zeux/niagara
 *
 * Only works for for symmetric projections.
 */
void sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {
    vec3 pr = p * r;
    float pzr2 = p.z * p.z - r * r;

    float vx = sqrt(p.x * p.x + pzr2);
    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];
    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];

    float vy = sqrt(p.y * p.y + pzr2);
    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];
    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];

    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;
    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;
    gl_Position.xy *= gl_Position.w;
}

const mat4 D = mat4(
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, -1.0
);

/**
 * Compute point size and center using the technique described in:
 * "GPU-Based Ray-Casting of Quadratic Surfaces" http://dl.acm.org/citation.cfm?id=2386396
 * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.
 */
void quadraticProjection(const in vec3 position, const in float radius, const in vec2 mapping) {
    vec2 xbc, ybc;

    mat4 T = mat4(
        radius, 0.0, 0.0, 0.0,
        0.0, radius, 0.0, 0.0,
        0.0, 0.0, radius, 0.0,
        position.x, position.y, position.z, 1.0
    );

    mat4 R = transpose4(uProjection * uModelView * aTransform * T);
    float A = dot(R[3], D * R[3]);
    float B = -2.0 * dot(R[0], D * R[3]);
    float C = dot(R[0], D * R[0]);
    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sx = abs(xbc[0] - xbc[1]) * 0.5;

    A = dot(R[3], D * R[3]);
    B = -2.0 * dot(R[1], D * R[3]);
    C = dot(R[1], D * R[1]);
    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);
    float sy = abs(ybc[0] - ybc[1]) * 0.5;

    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));
    gl_Position.xy -= mapping * vec2(sx, sy);
    gl_Position.xy *= gl_Position.w;
}

void main(void){
    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5
    #if __VERSION__ == 100
        int m = imod(VertexID, 6);
    #else
        int m = VertexID % 6;
    #endif
    if (m == 0) {
        mapping = vec2(-1.0, 1.0);
    } else if (m == 1 || m == 3) {
        mapping = vec2(-1.0, -1.0);
    } else if (m == 4) {
        mapping = vec2(1.0, -1.0);
    }

    int vertexId = VertexID / 6;

    vec4 positionGroup = readFromTexture(tPositionGroup, vertexId, uTexDim);
    vec3 position = positionGroup.rgb;
    float group = positionGroup.a;

    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * uModelScale;

    vec4 position4 = vec4(position, 1.0);
    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    float d;
    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        if (uModelScale != 1.0) {
            vRadius *= uLod.w;
        } else {
            d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;
            float f = min(
                smoothstep(uLod.x, uLod.x + uLod.z, d),
                1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
            ) * uLod.w;
            vRadius *= f;
        }
    }

    vec4 mvPosition = uModelView * aTransform * position4;

    #ifdef dApproximate
        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
        mvCorner.xy += mapping * vRadius;
        gl_Position = uProjection * mvCorner;
    #else
        if (uIsOrtho == 1.0) {
            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
            mvCorner.xy += mapping * vRadius;
            gl_Position = uProjection * mvCorner;
        } else if (uIsAsymmetricProjection) {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            quadraticProjection(position, vRadius / uModelScale, mapping);
        } else {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            sphereProjection(mvPosition.xyz, vRadius, mapping);
        }
    #endif

    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * vRadius; // avoid clipping
        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;
    }

    if (uModelScale == 1.0) {
        if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
            if (d < uLod.x || d > uLod.y) {
                // move out of [ -w, +w ] to 'discard' in vert shader
                gl_Position.z = 2.0 * gl_Position.w;
            }
        }
    }

    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0
        if (clipTest(vModelPosition / uModelScale)) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    #else
        #include clip_instance
    #endif
}
`,`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;
uniform float uAlphaThickness;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

bool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){
    vec3 cameraSpherePos = -vPointViewPosition;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0) return false;

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;
    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
    fragmentDepth = calcDepth(cameraPos);

    bool objectClipped = false;

    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        if (clipTest(modelPos)) {
            objectClipped = true;
            fragmentDepth = -1.0;
        }
    #endif

    if (fragmentDepth > 0.0) {
        cameraNormal = normalize(cameraPos - cameraSpherePos);
        interior = false;
        return true;
    } else if (uDoubleSided || solidInterior) {
        cameraPos = rayDirection * posT + rayOrigin;
        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
        fragmentDepth = calcDepth(cameraPos);
        cameraNormal = -normalize(cameraPos - cameraSpherePos);
        interior = true;
        if (fragmentDepth > 0.0) {
            #ifdef dSolidInterior
                if (!objectClipped) {
                    fragmentDepth = 0.0 + (0.0000001 / vRadius);
                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, -1.0), uIsOrtho);
                }
            #endif
            return true;
        }
    }

    return false;
}

void main(void){
    vec3 cameraNormal;
    float fragmentDepth;

    #ifdef dApproximate
        vec3 pointDir = -vPointViewPosition - vPoint;
        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;
        vec3 vViewPosition = -vPointViewPosition;
        fragmentDepth = gl_FragCoord.z;
        #if !defined(dIgnoreLight) || defined(dXrayShaded) || defined(dRenderVariant_tracing)
            pointDir.z -= cos(length(pointDir)) * vRadius * 0.5;
            cameraNormal = -normalize(pointDir);
        #endif
        interior = false;
    #else
        vec3 modelPos;
        vec3 cameraPos;
        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);
        if (!hit) discard;

        if (fragmentDepth < 0.0) discard;
        if (fragmentDepth > 1.0) discard;

        gl_FragDepthEXT = fragmentDepth;

        vec3 vModelPosition = modelPos;
        vec3 vViewPosition = cameraPos;
    #endif

    #include fade_lod
    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        #include clip_pixel
    #endif

    #ifdef dNeedsNormal
        vec3 normal = -cameraNormal;
    #endif

    #include assign_material_color

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {
            material.a *= min(1.0, vRadius / (uAlphaThickness * uModelScale));
        }
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{fragDepth:`required`,drawBuffers:`optional`},{},pj),Qxe=fj(`cylinders`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;
attribute float aColorMode;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = modelTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale * uModelScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    float f = aMapping.x > 0.0 ? 1.0 : 0.0;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) {
        dir = -dir;
        f = 1.0 - f;
    }

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping
        gl_Position.z = (uProjection * mvPosition).z;
    }

    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))
        // dual-color mixing
        // - for aColorMode between 0 and 1 use aColorMode to interpolate
        // - for aColorMode == 2 do nothing, i.e., use vColor
        // - for aColorMode == 3 use position on cylinder axis to interpolate
        if (aColorMode <= 1.0){
            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);
        } else if (aColorMode == 3.0) {
            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));
        }
    #endif

    #include clip_instance
}
`,`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec3 cameraNormal, out bool interior,
    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard * bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    #ifdef dSolidInterior
        bool topInterior = !topCap;
        bool bottomInterior = !bottomCap;
        topCap = true;
        bottomCap = true;
    #else
        bool topInterior = false;
        bool bottomInterior = false;
    #endif

    bool clipped = false;
    bool objectClipped = false;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;
        modelPosition = rayOrigin + t * rayDir;
        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
        fragmentDepth = calcDepth(viewPosition);
        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            if (clipTest(modelPosition)) {
                objectClipped = true;
                fragmentDepth = -1.0;
                #ifdef dSolidInterior
                    topCap = !topInterior;
                    bottomCap = !bottomInterior;
                #endif
            }
        #endif
        if (fragmentDepth > 0.0) return true;
        clipped = true;
    }

    if (!clipped) {
        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = topInterior;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = bottomInterior;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(modelPosition)) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                        return true;
                    #else
                        return !interior;
                    #endif
                }
            }
        }
    }

    if (uDoubleSided || solidInterior) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;
            modelPosition = rayOrigin + t * rayDir;
            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
            fragmentDepth = calcDepth(viewPosition);
            if (fragmentDepth > 0.0) {
                #ifdef dSolidInterior
                    if (!objectClipped) {
                        fragmentDepth = 0.0 + (0.0000002 / vSize);
                        cameraNormal = -rayDir;
                    }
                #endif
                return true;
            }
        }

        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        }
    }

    return false;
}

void main() {
    vec3 rayOrigin = vModelPosition;
    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec3 cameraNormal;
    vec3 modelPosition;
    vec3 viewPosition;
    float fragmentDepth;
    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);
    if (!hit) discard;

    if (fragmentDepth < 0.0) discard;
    if (fragmentDepth > 1.0) discard;

    gl_FragDepthEXT = fragmentDepth;

    vec3 vViewPosition = viewPosition;
    vec3 vModelPosition = modelPosition;

    #include fade_lod
    #include clip_pixel

    #ifdef dNeedsNormal
        mat3 normalMatrix = adjoint(uView);
        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{fragDepth:`required`,drawBuffers:`optional`},{},pj),$xe=fj(`text`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

uniform float uIsOrtho;
uniform float uPixelRatio;
uniform vec4 uViewport;
uniform mat4 uInvHeadRotation;
uniform bool uHasHeadRotation;
uniform mat4 uModelViewEye;
uniform mat4 uInvModelViewEye;
uniform bool uHasEyeCamera;

varying vec2 vTexCoord;

void main(void){
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = uModelScale;

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uHasEyeCamera
         ? uModelViewEye * aTransform * position4
         : uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    vec3 cornerOffset = vec3(0.0);
    cornerOffset.xy += aMapping * size * scale;
    cornerOffset.x += offsetX;
    cornerOffset.y += offsetY;

    if (uHasHeadRotation) {
        mvCorner.xyz += (uInvHeadRotation * vec4(cornerOffset, 1.0)).xyz;
    } else {
        mvCorner.xyz += cornerOffset;
    }

    if (!uHasEyeCamera) {
        if (uIsOrtho == 1.0) {
            mvCorner.z += offsetZ;
        } else {
            mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
        }
    }

    if (uHasEyeCamera) {
        mvCorner = uModelView * uInvModelViewEye * mvCorner;
    }

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`,`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
        #endif
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        if (sdf < 0.5) discard;

        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            // add border
            float t = 0.5 + uBorderWidth;
            if (uBorderWidth > 0.0 && sdf < t) {
                material.xyz = uBorderColor;
            }
        #endif
    }

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(-normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{drawBuffers:`optional`},{},mj),eSe=fj(`lines`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;
    int vertexId = VertexID;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`,`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{drawBuffers:`optional`},{},mj),hj=fj(`mesh`,`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    int vertexId = VertexID;

    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, vertexId, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = adjoint(modelView);
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`,`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

void main() {
    #include fade_lod
    #include clip_pixel

    #if defined(dFlipSided)
        interior = gl_FrontFacing;
    #else
        interior = !gl_FrontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;

    #ifdef dNeedsNormal
        #if defined(dFlatShaded)
            vec3 fdx = dFdx(vViewPosition);
            vec3 fdy = dFdy(vViewPosition);
            vec3 normal = -normalize(cross(fdx,fdy));
        #else
            vec3 normal = -normalize(vNormal);
            if (uDoubleSided) normal *= float(gl_FrontFacing) * 2.0 - 1.0;
        #endif
    #endif

    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #include apply_light_color
        #include apply_interior_color
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normal, emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{drawBuffers:`optional`},{},pj),tSe=fj(`direct-volume`,`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModel;
uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;
uniform float uModelScale;

varying vec3 vModelPosition;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vModelPosition = (uModel * aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uModelScale * uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`,`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
    uniform mat4 uClipObjectTransform[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;
uniform float uModelScale;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vModelPosition;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;

    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
#endif

uniform float uMetalness;
uniform float uRoughness;
uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;
uniform float uCelSteps;
uniform float uExposure;

uniform int uRenderMask;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform vec2 uPaletteDomain;
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    mat3 normalMatrix = adjoint(uModelView * vTransform);
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;
    float emissive = uEmissive;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos / uModelScale, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos / uModelScale, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 modelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(modelPosition)) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            float paletteValue = (value - uPaletteDomain[0]) / (uPaletteDomain[1] - uPaletteDomain[0]);
            material.rgb = texture2D(tPalette, vec2(clamp(paletteValue, 0.0, 1.0), 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        #if defined(dIgnoreLight)
            gl_FragColor.rgb = material.rgb;
        #else
            if (material.a >= 0.01) {
                #ifdef dPackedGroup
                    // compute gradient by central differences
                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                #else
                    gradient = cell.xyz * 2.0 - 1.0;
                #endif
                vec3 normal = -normalize(normalMatrix * normalize(gradient));
                #include apply_light_color
            } else {
                gl_FragColor.rgb = material.rgb;
            }
        #endif

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        #if defined(dColorMarker)
            float marker = uMarker;
            if (uMarker == -1.0) {
                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
            }
        #endif
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground || !uFog) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    #if defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        discard;
    #else
        if (gl_FrontFacing)
            discard;

        vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
        vec3 step = rayDir * uStepScale * uModelScale;

        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vModelPosition, uCameraPosition), uIsOrtho);
        vec3 start = mix(uCameraPosition, vModelPosition, uIsOrtho) + (d * rayDir);
        gl_FragColor = raymarch(start, step, rayDir);

        float fragmentDepth = calcDepth((uView * vec4(start, 1.0)).xyz);
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        #include wboit_write
    #endif
}
`,{fragDepth:`optional`,drawBuffers:`optional`},{},pj),nSe=fj(`image`,`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    int vertexId = VertexID;

    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`,`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform float uEmissive;

// Density value to estimate object thickness
uniform float uDensity;

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #endif
        uniform float uOverpaintStrength;
    #endif
#endif

#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #endif
        uniform float uEmissiveStrength;
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #endif
    uniform float uTransparencyStrength;
#endif

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;
uniform sampler2D tValueTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#ifdef dUsePalette
    uniform sampler2D tPalette;
    uniform vec3 uPaletteDefault;
#endif

uniform int uTrimType;
uniform vec3 uTrimCenter;
uniform vec4 uTrimRotation;
uniform vec3 uTrimScale;
uniform mat4 uTrimTransform;

uniform float uIsoLevel;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    if (uTrimType != 0 && getSignedDistance(vModelPosition, uTrimType, uTrimCenter, uTrimRotation, uTrimScale, uTrimTransform) > 0.0) discard;

    #include fade_lod
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        #ifdef dUsePalette
            vec4 material = texture2D(tImageTex, vUv);
            if (material.rgb != vec3(1.0)) {
                material = biCubic(tImageTex, vUv);
            }
        #else
            vec4 material = biCubic(tImageTex, vUv);
        #endif
    #else
        vec4 material = texture2D(tImageTex, vUv);
    #endif

    if (uIsoLevel >= 0.0) {
        if (texture2D(tValueTex, vUv).r < uIsoLevel) discard;

        material.a = uAlpha;
    } else {
        if (material.a == 0.0) discard;

        material.a *= uAlpha;
    }

    float fragmentDepth = gl_FragCoord.z;

    vec3 packedGroup = texture2D(tGroupTex, vUv).rgb;
    float group = packedGroup == vec3(0.0) ? -1.0 : unpackRGBToInt(packedGroup);

    // apply per-group transparency
    #if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))
        float transparency = 0.0;
        #if defined(dTransparencyType_instance)
            transparency = readFromTexture(tTransparency, vInstance, uTransparencyTexDim).a;
        #elif defined(dTransparencyType_groupInstance)
            transparency = readFromTexture(tTransparency, vInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
        #endif
        transparency *= uTransparencyStrength;

        float ta = 1.0 - transparency;
        if (transparency < 0.09) ta = 1.0; // hard cutoff looks better

        #if defined(dRenderVariant_pick)
            if (ta * uAlpha < uPickingAlphaThreshold)
                discard; // ignore so the element below can be picked
        #elif defined(dRenderVariant_emissive)
            if (ta < 1.0)
                discard; // emissive not supported with transparency
        #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
            material.a *= ta;
        #endif
    #endif

    if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
        (uRenderMask == MaskTransparent && material.a == 1.0)
    ) {
        discard;
    }

    #if defined(dNeedsMarker)
        float marker = uMarker;
        if (group == -1.0) {
            marker = 0.0;
        } else if (uMarker == -1.0) {
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
    #endif

    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)
        float emissive = uEmissive;
        if (group == -1.0) {
            emissive = 0.0;
        } else {
            #ifdef dEmissive
                #if defined(dEmissiveType_instance)
                    emissive += readFromTexture(tEmissive, vInstance, uEmissiveTexDim).a * uEmissiveStrength;
                #elif defined(dEmissiveType_groupInstance)
                    emissive += readFromTexture(tEmissive, vInstance * float(uGroupCount) + group, uEmissiveTexDim).a * uEmissiveStrength;
                #endif
            #endif
        }
    #endif

    #if defined(dRenderVariant_pick)
        if (group == -1.0) discard;

        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);
            gl_FragData[2] = vec4(packIntToRGB(group), 1.0);
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
            if (uPickType == 1) {
                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            } else if (uPickType == 2) {
                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
            } else {
                gl_FragColor = vec4(packIntToRGB(group), 1.0);
            }
        #endif
    #elif defined(dRenderVariant_depth)
        if (uRenderMask == MaskOpaque) {
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else if (uRenderMask == MaskTransparent) {
            gl_FragColor = packDepthWithAlphaToRGBA(fragmentDepth, material.a);
        }
    #elif defined(dRenderVariant_marking)
        if (uMarkingType == 1) {
            if (marker > 0.0)
                discard;
            gl_FragColor = packDepthToRGBA(fragmentDepth);
        } else {
            if (marker == 0.0)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
            float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
            if (fogFactor == 1.0)
                discard;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
        }
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = vec4(emissive);
    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)
        #ifdef dUsePalette
            if (material.rgb == vec3(1.0)) {
                material.rgb = uPaletteDefault;
            } else {
                float v = ((material.r * 256.0 * 256.0 * 255.0 + material.g * 256.0 * 255.0 + material.b * 255.0) - 1.0) / PALETTE_SCALE;
                material.rgb = texture2D(tPalette, vec2(v, 0.0)).rgb;
            }
        #endif

        // mix material with overpaint
        #if defined(dOverpaint)
            vec4 overpaint = vec4(0.0);
            if (group != -1.0) {
                #if defined(dOverpaintType_instance)
                    overpaint = readFromTexture(tOverpaint, vInstance, uOverpaintTexDim);
                #elif defined(dOverpaintType_groupInstance)
                    overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
                #endif
                overpaint *= uOverpaintStrength;
            }
            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        gl_FragColor = material;
        #include apply_marker_color

        #if defined(dRenderVariant_color)
            #include apply_fog
            #include wboit_write
            #include dpoit_write
        #elif defined(dRenderVariant_tracing)
            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);
            gl_FragData[2] = vec4(material.rgb, uDensity);
        #endif
    #endif
}
`,{drawBuffers:`optional`},{},mj);function gj(e,t){if(e===void 0)return``;let n=e.dRenderVariant?.ref.value||``,r=[];for(let i in e){if(t?.(i,n,e))continue;let a=e[i].ref.value;a!==void 0&&(typeof a==`string`?r.push(`#define ${i}_${a}`):typeof a==`number`?r.push(`#define ${i} ${a}`):typeof a==`boolean`?a&&r.push(`#define ${i}`):Lb(a))}return r.join(`
`)+`
`}function rSe(e,t){let n=[];if(t.drawBuffers){if(e.drawBuffers)n.push(`#define requiredDrawBuffers`);else if(t.drawBuffers===`required`)throw Error(`required 'GL_EXT_draw_buffers' extension not available`)}if(t.multiDraw){if(e.multiDraw)n.push(`#extension GL_ANGLE_multi_draw : require`),n.push(`#define enabledMultiDraw`);else if(t.multiDraw===`required`)throw Error(`required 'GL_ANGLE_multi_draw' extension not available`)}return n.join(`
`)+`
`}function iSe(e,t){let n=[`#extension GL_OES_standard_derivatives : enable`];if(t.fragDepth){if(e.fragDepth)n.push(`#extension GL_EXT_frag_depth : enable`),n.push(`#define enabledFragDepth`);else if(t.fragDepth===`required`)throw Error(`required 'GL_EXT_frag_depth' extension not available`)}if(t.drawBuffers){if(e.drawBuffers)n.push(`#extension GL_EXT_draw_buffers : require`),n.push(`#define requiredDrawBuffers`),n.push(`#define gl_FragColor gl_FragData[0]`);else if(t.drawBuffers===`required`)throw Error(`required 'GL_EXT_draw_buffers' extension not available`)}if(t.shaderTextureLod){if(e.shaderTextureLod)n.push(`#extension GL_EXT_shader_texture_lod : enable`),n.push(`#define enabledShaderTextureLod`);else if(t.shaderTextureLod===`required`)throw Error(`required 'GL_EXT_shader_texture_lod' extension not available`)}return e.depthTexture&&n.push(`#define depthTextureSupport`),n.join(`
`)+`
`}var aSe=`
#define attribute in
#define varying out
#define texture2D texture
`,oSe=`
#define varying in
#define texture2D texture
#define textureCube texture
#define texture2DLodEXT textureLod
#define textureCubeLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth
`;function sSe(e,t){let n=[`#version 300 es`];if(t.drawBuffers&&e.drawBuffers&&n.push(`#define requiredDrawBuffers`),t.multiDraw){if(e.multiDraw)n.push(`#extension GL_ANGLE_multi_draw : require`),n.push(`#define enabledMultiDraw`);else if(t.multiDraw===`required`)throw Error(`required 'GL_ANGLE_multi_draw' extension not available`)}if(t.clipCullDistance){if(e.clipCullDistance)n.push(`#extension GL_ANGLE_clip_cull_distance : enable`),n.push(`#define enabledClipCullDistance`);else if(t.clipCullDistance===`required`)throw Error(`required 'GL_ANGLE_clip_cull_distance' extension not available`)}if(t.conservativeDepth){if(e.conservativeDepth)n.push(`#extension GL_EXT_conservative_depth : enable`),n.push(`#define enabledConservativeDepth`);else if(t.conservativeDepth===`required`)throw Error(`required 'GL_EXT_conservative_depth' extension not available`)}if(t.multiview2){if(e.multiview2)n.push(`#extension GL_OVR_multiview2 : require`),n.push(`#define enabledMultiview2`);else if(t.multiview2===`required`)throw Error(`required 'GL_OVR_multiview2' extension not available`)}return e.noNonInstancedActiveAttribs&&n.push(`#define noNonInstancedActiveAttribs`),n.push(aSe),n.join(`
`)+`
`}function cSe(e,t,n,r){let i=[`#version 300 es`,`layout(location = 0) out highp ${r[0]||`vec4`} out_FragData0;`];if(n.fragDepth&&e.fragDepth&&i.push(`#define enabledFragDepth`),n.drawBuffers&&e.drawBuffers){i.push(`#define requiredDrawBuffers`);for(let e=1,n=t.maxDrawBuffers;e<n;++e)i.push(`layout(location = ${e}) out highp ${r[e]||`vec4`} out_FragData${e};`)}return n.shaderTextureLod&&e.shaderTextureLod&&i.push(`#define enabledShaderTextureLod`),e.depthTexture&&i.push(`#define depthTextureSupport`),i.push(oSe),i.join(`
`)+`
`}function lSe(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,`out_FragData$1`)}function uSe(e,t,n,r,i){let a=gj(r,i.ignoreDefine),o=gj(r,i.ignoreDefine),s=Bj(e)?sSe(t,i.extensions):rSe(t,i.extensions),c=Bj(e)?cSe(t,n,i.extensions,i.outTypes):iSe(t,i.extensions),l=Bj(e)?lSe(i.frag):i.frag;return{id:lj(),name:i.name,vert:`${s}${a}${dj(i.vert,r)}`,frag:`${c}${o}${dj(l,r)}`,extensions:i.extensions,outTypes:i.outTypes}}function dSe(e,t){switch(t){case`b`:case`b[]`:return e.BOOL;case`f`:case`f[]`:return e.FLOAT;case`i`:case`i[]`:return e.INT;case`v2`:case`v2[]`:return e.FLOAT_VEC2;case`v3`:case`v3[]`:return e.FLOAT_VEC3;case`v4`:case`v4[]`:return e.FLOAT_VEC4;case`q`:case`q[]`:return e.FLOAT_VEC4;case`iv2`:case`iv2[]`:return e.INT_VEC2;case`iv3`:case`iv3[]`:return e.INT_VEC3;case`iv4`:case`iv4[]`:return e.INT_VEC4;case`m3`:case`m3[]`:return e.FLOAT_MAT3;case`m4`:case`m4[]`:return e.FLOAT_MAT4;default:console.error(`unknown uniform kind '${t}'`)}}function fSe(e){return e.endsWith(`[]`)}function pSe(e,t,n){e.uniform1f(t,n)}function mSe(e,t,n){e.uniform1fv(t,n)}function hSe(e,t,n){e.uniform1i(t,n)}function gSe(e,t,n){e.uniform1iv(t,n)}function _Se(e,t,n){e.uniform2fv(t,n)}function vSe(e,t,n){e.uniform3fv(t,n)}function _j(e,t,n){e.uniform4fv(t,n)}function ySe(e,t,n){e.uniform2iv(t,n)}function bSe(e,t,n){e.uniform3iv(t,n)}function xSe(e,t,n){e.uniform4iv(t,n)}function SSe(e,t,n){e.uniformMatrix3fv(t,!1,n)}function CSe(e,t,n){e.uniformMatrix4fv(t,!1,n)}function vj(e){switch(e){case`f`:return pSe;case`f[]`:return mSe;case`i`:case`t`:case`b`:return hSe;case`i[]`:case`t[]`:case`b[]`:return gSe;case`v2`:case`v2[]`:return _Se;case`v3`:case`v3[]`:return vSe;case`v4`:case`v4[]`:return _j;case`q`:case`q[]`:return _j;case`iv2`:case`iv2[]`:return ySe;case`iv3`:case`iv3[]`:return bSe;case`iv4`:case`iv4[]`:return xSe;case`m3`:case`m3[]`:return SSe;case`m4`:case`m4[]`:return CSe}}function wSe(e){let t={};return Object.keys(e).forEach(n=>{let r=e[n];r.type===`uniform`?t[n]=vj(r.kind):r.type===`texture`&&(t[n]=vj(`t`))}),t}function TSe(e){let t={};return Object.keys(e).forEach(n=>{t[n]=L.create(UT(e[n].ref.value))}),t}var yj=mb();function ESe(e,t){switch(t){case`static`:return e.STATIC_DRAW;case`dynamic`:return e.DYNAMIC_DRAW;case`stream`:return e.STREAM_DRAW;default:Lb(t)}}function DSe(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;Lb(t)}function OSe(e,t){switch(t){case`attribute`:return e.ARRAY_BUFFER;case`elements`:return e.ELEMENT_ARRAY_BUFFER;case`uniform`:if(Bj(e))return e.UNIFORM_BUFFER;throw Error(`WebGL2 is required for uniform buffers`);case`pixel-pack`:if(Bj(e))return e.PIXEL_PACK_BUFFER;throw Error(`WebGL2 is required for pixel-pack buffers`)}}function bj(e){let t=e.createBuffer();if(t===null)throw Error(`Could not create WebGL buffer`);return t}function xj(e,t,n,r){let i=bj(e),a=ESe(e,n),o=OSe(e,r),s=DSe(e,t),c=t.BYTES_PER_ELEMENT,l=t.length;function u(t){e.bindBuffer(o,i),e.bufferData(o,t,a)}u(t);let d=!1;return{id:yj(),_usageHint:a,_bufferType:o,_dataType:s,_bpe:c,length:l,getByteCount:()=>c*l,getBuffer:()=>i,updateData:u,updateSubData:(t,n,r)=>{e.bindBuffer(o,i),r-n===t.length?e.bufferSubData(o,0,t):e.bufferSubData(o,n*c,t.subarray(n,n+r))},reset:()=>{i=bj(e),u(t)},destroy:()=>{d||=(e.deleteBuffer(i),!0)}}}function kSe(e,t,n){switch(t){case`float32`:switch(n){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}default:Lb(t)}}function ASe(e,t,n,r,i,a,o=`static`){let{instancedArrays:s}=n,c=xj(e,r,o,`attribute`),{_bufferType:l,_dataType:u,_bpe:d}=c;return{...c,divisor:a,bind:n=>{if(e.bindBuffer(l,c.getBuffer()),i===16)for(let r=0;r<4;++r)t.enableVertexAttrib(n+r),e.vertexAttribPointer(n+r,4,u,!1,16*d,r*4*d),s.vertexAttribDivisor(n+r,a);else t.enableVertexAttrib(n),e.vertexAttribPointer(n,i,u,!1,0,0),s.vertexAttribDivisor(n,a)},changeOffset:(t,n)=>{let r=n*d*i;if(e.bindBuffer(l,c.getBuffer()),i===16)for(let n=0;n<4;++n)e.vertexAttribPointer(t+n,4,u,!1,16*d,n*4*d+r);else e.vertexAttribPointer(t,i,u,!1,0,r)}}}function jSe(e,t,n){let r=[];return Object.keys(t).forEach(i=>{let a=t[i];a.type===`attribute`&&(r[r.length]=[i,e.resources.attribute(n[i].ref.value,a.itemSize,a.divisor)])}),r}function MSe(e,t,n=`static`){let r=xj(e,t,n,`elements`);return{...r,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.getBuffer())}}}function NSe(e,t,n,r){let i=bj(e),a=Kj(e,t,r),o=Uj(e,n,r),s=Gj(n,r),c=0,l=0;function u(t,n,r,u){c=r,l=u,e.bindBuffer(e.PIXEL_PACK_BUFFER,i),e.bufferData(e.PIXEL_PACK_BUFFER,r*u*s,e.STREAM_READ),e.readPixels(t,n,r,u,o,a,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}function d(t){e.bindBuffer(e.PIXEL_PACK_BUFFER,i),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,t),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}let f=!1;return{id:yj(),_type:a,_format:o,_bpe:s,getByteCount:()=>s*c*l,read:u,getSubData:d,reset:()=>{i=bj(e)},destroy:()=>{f||=(e.deleteBuffer(i),!0)}}}var PSe=mb();function FSe(e,t,n){let r={};return Object.keys(n).forEach(i=>{let a=n[i];if(a.type===`attribute`)r[i]=e.getAttribLocation(t,i);else if(a.type===`uniform`){let n=e.getUniformLocation(t,i);n===null&&fSe(a.kind)&&(n=e.getUniformLocation(t,i+`[0]`)),r[i]=n}else a.type===`texture`&&(r[i]=e.getUniformLocation(t,i))}),r}function ISe(e,t,n){let r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;++i){let r=e.getActiveAttrib(t,i);if(r){let{name:t,type:i}=r;if(t.startsWith(`__activeAttribute`)||t===`gl_InstanceID`||t===`gl_VertexID`||t===`gl_DrawID`||t===`gl_ViewID_OVR`)continue;let a=n[t];if(a===void 0)throw Error(`missing 'uniform' or 'texture' with name '${t}' in schema`);if(a.type!==`attribute`)throw Error(`'${t}' must be of type 'attribute' but is '${a.type}'`);let o=kSe(e,a.kind,a.itemSize);if(o!==i)throw Error(`unexpected attribute type '${o}' for ${t}, expected '${i}'`)}}}function LSe(e,t,n){let r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){let r=e.getActiveUniform(t,i);if(r){let{name:t,type:i}=r;if(t.startsWith(`__activeUniform`)||t===`gl_InstanceID`||t===`gl_VertexID`||t===`gl_DrawID`||t===`gl_ViewID_OVR`)continue;let a=n[t.replace(/[[0-9]+\]$/,``)];if(a===void 0)throw Error(`missing 'uniform' or 'texture' with name '${t}' in schema`);if(a.type===`uniform`){if(dSe(e,a.kind)!==i)throw Error(`unexpected uniform type for ${t}`)}else if(a.type===`texture`){if(a.kind===`image-float32`||a.kind===`image-uint8`){if(i!==e.SAMPLER_2D)throw Error(`unexpected sampler type for '${t}'`)}else if(a.kind===`volume-float32`||a.kind===`volume-uint8`)if(Bj(e)){if(i!==e.SAMPLER_3D)throw Error(`unexpected sampler type for '${t}'`)}else throw Error(`WebGL2 is required to use SAMPLER_3D`)}else throw Error(`'${t}' must be of type 'uniform' or 'texture' but is '${a.type}'`)}}}function RSe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw Error(`Could not compile WebGL program. \n\n${e.getProgramInfoLog(t)}`)}function Sj(e){let t=e.createProgram();if(t===null)throw Error(`Could not create WebGL program`);return t}function zSe(e){if(typeof e!=`string`)throw Error(`unknown program variant: ${e}`);return e.startsWith(`color`)?`color`:e.startsWith(`pick`)?`pick`:e}function BSe(e,t,n,r,i,a){let{defineValues:o,shaderCode:s,schema:c}=a,l=Sj(e),u=PSe(),d=zSe(o.dRenderVariant.ref.value),f=uSe(e,n,r,o,s),p=i(`vert`,f.vert),m=i(`frag`,f.frag),h,g,_=!1,v=!1,y=!1;function b(){p.attach(l),m.attach(l),e.linkProgram(l),Qy&&RSe(e,l),_=!0}d===`compute`&&b();function x(){h=FSe(e,l,c),g=wSe(c),Qy&&(ISe(e,l,c),LSe(e,l,c)),v=!0}return{id:u,variant:d,isReady:()=>v,link:()=>{_||b()},finalize(t){return _||b(),!v&&(t||!n.parallelShaderCompile||e.getProgramParameter(l,n.parallelShaderCompile.COMPLETION_STATUS))&&x(),v},use:()=>{if(Qy&&!v)throw Error(`program not finalized`);t.currentProgramId=u,e.useProgram(l)},setUniforms:t=>{for(let n=0,r=t.length;n<r;++n){let[r,i]=t[n];if(i){let t=h[r];t!==null&&g[r](e,t,i.ref.value)}}},uniform:(t,n)=>{let r=h[t];r!==null&&g[t](e,r,n)},bindAttributes:e=>{t.clearVertexAttribsState();for(let t=0,n=e.length;t<n;++t){let[n,r]=e[t],i=h[n];i!==-1&&r.bind(i)}t.disableUnusedVertexAttribs()},offsetAttributes:(e,t)=>{for(let n=0,r=e.length;n<r;++n){let[r,i]=e[n],a=h[r];a!==-1&&i.changeOffset(a,t)}},bindTextures:(t,n)=>{for(let r=0,i=t.length;r<i;++r){let[i,a]=t[r],o=h[i];o!=null&&(a.bind(r+n),g[i](e,o,r+n))}},reset:()=>{l=Sj(e),_&&b(),v&&x()},destroy:()=>{y||=(p.destroy(),m.destroy(),e.deleteProgram(l),!0)}}}var VSe=mb();function HSe(e){let t=e.split(`
`);for(let e=0;e<t.length;++e)t[e]=e+1+`: `+t[e];return t.join(`
`)}function Cj(e,t){let{type:n,source:r}=t,i=e.createShader(n===`vert`?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(i===null)throw Error(`Error creating ${n} shader`);if(e.shaderSource(i,r),e.compileShader(i),Qy&&e.getShaderParameter(i,e.COMPILE_STATUS)===!1)throw console.warn(`'${n}' shader info log '${e.getShaderInfoLog(i)}'\n${HSe(r)}`),Error(`Error compiling ${n} shader`);return i}function USe(e,t){let n=Cj(e,t);return{id:VSe(),attach:t=>{e.attachShader(t,n)},reset:()=>{n=Cj(e,t)},destroy:()=>{e.deleteShader(n)}}}function WSe(e,t=0){return{value:e,usageCount:t}}function GSe(e){return{free:()=>{--e.usageCount},value:e.value}}function wj(e,t,n){let r=new Map,i=[];return{get:n=>{let a=e(n),o=r.get(a);return o||(o=WSe(t(n)),r.set(a,o),i.push(o.value)),o.usageCount+=1,GSe(o)},clear:()=>{r.forEach((e,t)=>{e.usageCount<=0&&(e.usageCount<0&&console.warn(`Reference usageCount below zero.`),n(e.value),r.delete(t),EE(i,e.value))})},get count(){return r.size},values:i,dispose:()=>{r.forEach(e=>n(e.value)),r.clear(),i.length=0}}}var KSe=mb();function qSe(e,t){switch(t){case`depth16`:return e.DEPTH_COMPONENT16;case`stencil8`:return e.STENCIL_INDEX8;case`rgba4`:return e.RGBA4;case`depth-stencil`:return e.DEPTH_STENCIL;case`depth24`:if(Bj(e))return e.DEPTH_COMPONENT24;throw Error("WebGL2 needed for `depth24` renderbuffer format");case`depth32f`:if(Bj(e))return e.DEPTH_COMPONENT32F;throw Error("WebGL2 needed for `depth32f` renderbuffer format");case`depth24-stencil8`:if(Bj(e))return e.DEPTH24_STENCIL8;throw Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case`depth32f-stencil8`:if(Bj(e))return e.DEPTH32F_STENCIL8;throw Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}function JSe(e){switch(e){case`depth16`:return 4;case`stencil8`:return 2;case`rgba4`:return 4;case`depth-stencil`:return 4;case`depth24`:return 3;case`depth32f`:return 4;case`depth24-stencil8`:return 4;case`depth32f-stencil8`:return 5}}function YSe(e,t){switch(t){case`depth`:return e.DEPTH_ATTACHMENT;case`stencil`:return e.STENCIL_ATTACHMENT;case`depth-stencil`:return e.DEPTH_STENCIL_ATTACHMENT;case`color0`:return e.COLOR_ATTACHMENT0}}function Tj(e){let t=e.createRenderbuffer();if(t===null)throw Error(`Could not create WebGL renderbuffer`);return t}function XSe(e,t,n,r,i){let a=Tj(e),o=()=>e.bindRenderbuffer(e.RENDERBUFFER,a),s=qSe(e,t),c=YSe(e,n);function l(){o(),e.renderbufferStorage(e.RENDERBUFFER,s,r,i)}l();let u=!1;return{id:KSe(),getByteCount:()=>JSe(t)*r*i,bind:o,attachFramebuffer:t=>{t.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,c,e.RENDERBUFFER,a),Qy&&oj(e)},detachFramebuffer:t=>{t.bind(),o(),e.framebufferRenderbuffer(e.FRAMEBUFFER,c,e.RENDERBUFFER,null),Qy&&oj(e)},setSize:(e,t)=>{r=e,i=t,l()},reset:()=>{a=Tj(e),l()},destroy:()=>{u||=(e.deleteRenderbuffer(a),!0)}}}var ZSe=mb();function Ej(e){let{vertexArrayObject:t}=e;if(!t)throw Error(`VertexArrayObject not supported`);let n=t.createVertexArray();if(!n)throw Error(`Could not create WebGL vertex array`);return n}function Dj(e){let{vertexArrayObject:t}=e;if(t===null)throw Error(`VertexArrayObject not supported`);return t}function QSe(e,t,n,r,i){let a=ZSe(),o=Ej(t),s=Dj(t);function c(){s.bindVertexArray(o),i&&i.bind(),n.bindAttributes(r),s.bindVertexArray(null),l=!0}let l=!1,u=!1;return{id:a,bind:()=>{l||c(),s.bindVertexArray(o)},update:c,reset:()=>{o=Ej(t),s=Dj(t),l=!1},destroy:()=>{u||=(i&&(s.bindVertexArray(o),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(o),!0)}}}function $Se(e){return typeof e==`boolean`?e?1:0:typeof e==`number`?e*1e4:fE(e)}function Oj(e){return{...e.value,destroy:()=>{e.free()}}}function eCe(e,t,n,r,i){let a={attribute:new Set,elements:new Set,pixelPack:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function o(e,t){return a[e].add(t),n.resourceCounts[e]+=1,{...t,destroy:()=>{t.destroy(),a[e].delete(t),--n.resourceCounts[e]}}}let s=wj(e=>JSON.stringify(e),t=>o(`shader`,USe(e,t)),e=>{e.destroy()});function c(e,t){return Oj(s.get({type:e,source:t}))}let l=new Set,u=wj(e=>{let t=[e.shaderCode.id],n=e.defineValues.dRenderVariant?.ref.value||``;return Object.keys(e.defineValues).forEach(r=>{var i;(i=e.shaderCode).ignoreDefine?.call(i,r,n,e.defineValues)||t.push(fE(r),$Se(e.defineValues[r].ref.value))}),gE(t).toString()},n=>{let a=BSe(e,t,r,i,c,n);return a.variant!==`compute`&&l.add(a),o(`program`,a)},e=>{l.delete(e),e.destroy()});return{attribute:(n,i,a,s)=>o(`attribute`,ASe(e,t,r,n,i,a,s)),elements:(t,n)=>o(`elements`,MSe(e,t,n)),pixelPack:(t,n)=>{if(!Bj(e))throw Error(`WebGL2 is required for pixel-pack buffers`);return o(`pixelPack`,NSe(e,r,t,n))},framebuffer:()=>o(`framebuffer`,Lxe(e)),program:(e,t,n)=>Oj(u.get({defineValues:e,shaderCode:t,schema:n})),renderbuffer:(t,n,r,i)=>o(`renderbuffer`,XSe(e,t,n,r,i)),shader:c,texture:(t,n,i,a)=>o(`texture`,awe(e,r,t,n,i,a)),cubeTexture:(t,n,r)=>o(`cubeTexture`,swe(e,t,n,r)),vertexArray:(t,n,i)=>o(`vertexArray`,QSe(e,r,t,n,i)),getByteCounts:()=>{let e=0;a.texture.forEach(t=>{e+=t.getByteCount()});let t=0;a.cubeTexture.forEach(e=>{t+=e.getByteCount()});let n=0;a.attribute.forEach(e=>{n+=e.getByteCount()});let r=0;a.elements.forEach(e=>{r+=e.getByteCount()});let i=0;a.pixelPack.forEach(e=>{i+=e.getByteCount()});let o=0;return a.renderbuffer.forEach(e=>{o+=e.getByteCount()}),{texture:e,cubeTexture:t,attribute:n,elements:r,pixelPack:i,renderbuffer:o}},linkPrograms:e=>{for(let t of l)e&&!e.includes(t.variant)||t.link()},finalizePrograms:(e,t)=>{let n=!0,r=0;for(let t of l)t.isReady()&&l.delete(t),(!e||e.includes(t.variant))&&(n=!1,r+=1);if(n)return!0;let i=!0,a=0,o=Ly();for(let n of l)if(!(e&&!e.includes(n.variant))&&(n.finalize(t)?(l.delete(n),a+=1):i=!1,!t&&Ly()-o>16)){i=!1;break}return $y&&console.log(`Finalized ${a} of ${r} programs (${e?e.join(`, `):`all`}) in ${(Ly()-o).toFixed(2)} ms`),i},reset:()=>{a.attribute.forEach(e=>e.reset()),a.elements.forEach(e=>e.reset()),a.pixelPack.forEach(e=>e.reset()),a.framebuffer.forEach(e=>e.reset()),a.renderbuffer.forEach(e=>e.reset()),a.shader.forEach(e=>e.reset()),a.program.forEach(e=>e.reset()),a.vertexArray.forEach(e=>e.reset()),a.texture.forEach(e=>e.reset()),a.cubeTexture.forEach(e=>e.reset())},destroy:()=>{a.attribute.forEach(e=>e.destroy()),a.elements.forEach(e=>e.destroy()),a.pixelPack.forEach(e=>e.destroy()),a.framebuffer.forEach(e=>e.destroy()),a.renderbuffer.forEach(e=>e.destroy()),a.shader.forEach(e=>e.destroy()),a.program.forEach(e=>e.destroy()),a.vertexArray.forEach(e=>e.destroy()),a.texture.forEach(e=>e.destroy()),a.cubeTexture.forEach(e=>e.destroy()),s.clear(),u.clear(),l.clear()}}}var tCe=mb();function nCe(e,t,n,r,i=!0,a=`uint8`,o=`nearest`,s=`rgba`){if(s===`alpha`&&!Bj(e))throw Error(`cannot render to alpha format in webgl1`);let c=t.framebuffer(),l=a===`fp16`?t.texture(`image-float16`,s,`fp16`,o):a===`float32`?t.texture(`image-float32`,s,`float`,o):t.texture(`image-uint8`,s,`ubyte`,o),u=i?Bj(e)?t.renderbuffer(`depth32f`,`depth`,n,r):t.renderbuffer(`depth16`,`depth`,n,r):null;function d(){l.define(n,r),l.attachFramebuffer(c,`color0`),u&&u.attachFramebuffer(c)}d();let f=!1;return{id:tCe(),texture:l,framebuffer:c,depthRenderbuffer:u,getByteCount:()=>l.getByteCount()+(u?u.getByteCount():0),getWidth:()=>n,getHeight:()=>r,bind:()=>{c.bind()},setSize:(e,t)=>{n===e&&r===t||(n=e,r=t,l.define(n,r),u&&u.setSize(n,r))},reset:()=>{d()},destroy:()=>{f||=(l.destroy(),c.destroy(),u&&u.destroy(),!0)}}}function rCe(e,t,n){return e-=e/n,e+=t/n,e}var kj=class{add(e,t){let n=this.avgs.get(e)||t;return n=rCe(n,t,this.count),this.avgs.set(e,n),n}get(e){return this.avgs.get(e)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}constructor(e){this.count=e,this.avgs=new Map}};function iCe(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0}function aCe(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}function oCe(e,t,n,r){let i=t.disjointTimerQuery,a=r?.avgCount??30,o=new Map,s=new Map,c=[],l=new kj(a),u=new kj(a),d=[],f=null,p=!1,m=()=>{s.clear(),c.length=0,l.clear(),u.clear(),d=[],f=null,p=!1,i&&o.forEach((e,t)=>{i.deleteQuery(t)}),o.clear()},h=()=>{if(!i)return;let e=aCe(t);e&&(i.beginQuery(i.TIME_ELAPSED,e),s.forEach((t,n)=>{t.queries.push(e)}),o.set(e,{refCount:s.size}),f=e)};return{resolve:()=>{let t=[];if(!i||!d.length||p)return t;o.forEach((t,n)=>{if(t.timeElapsed!==void 0)return;let r=i.getQueryParameter(n,i.QUERY_RESULT_AVAILABLE),a=e.getParameter(i.GPU_DISJOINT);r&&!a&&(t.timeElapsed=i.getQueryParameter(n,i.QUERY_RESULT)),(r||a)&&i.deleteQuery(n)});let n=[];for(let e of d)if(e.queries.every(e=>o.get(e)?.timeElapsed!==void 0)){let n=0;for(let t of e.queries){let e=o.get(t);n+=e.timeElapsed,--e.refCount}if(e.timeElapsed=n,e.root){let r=[],i=(e,t)=>{for(let n of e){let e=n.timeElapsed,r=n.cpu.end-n.cpu.start,a={label:n.label,gpuElapsed:e,gpuAvg:l.add(n.label,e),cpuElapsed:r,cpuAvg:u.add(n.label,r),children:[],calls:n.calls,note:n.note};t.push(a),i(n.children,a.children)}};i(e.children,r);let a=e.cpu.end-e.cpu.start;t.push({label:e.label,gpuElapsed:n,gpuAvg:l.add(e.label,n),cpuElapsed:a,cpuAvg:u.add(e.label,a),children:r,calls:e.calls,note:e.note})}}else n.push(e);return d=n,o.forEach((e,t)=>{e.refCount===0&&o.delete(t)}),t},mark:(e,t)=>{if(!i)return;if(s.has(e))throw Error(`Timer mark for '${e}' already exists`);let r=t?.captureStats??!1;f!==null&&i.endQuery(i.TIME_ELAPSED);let a={label:e,queries:[],children:[],root:f===null,cpu:{start:Ly(),end:-1},captureStats:r};if(t?.note&&(a.note=t.note),s.set(e,a),c.length&&c[c.length-1].children.push(a),c.push(a),r){if(p)throw Error(`Already capturing stats`);iCe(n),p=!0}h()},markEnd:e=>{if(!i)return;let t=s.get(e);if(!t)throw Error(`Timer mark for '${e}' does not exist`);if(c.pop()?.label!==e)throw Error(`Timer mark for '${e}' has pending nested mark`);i.endQuery(i.TIME_ELAPSED),s.delete(e),t.cpu.end=Ly(),t.captureStats&&(t.calls={...n.calls},p=!1),d.push(t),s.size>0?h():f=null},stats:()=>({gpu:l.stats(),cpu:u.stats()}),formatedStats:()=>{let e={},t=l.stats(),n=u.stats();for(let r of Object.keys(t))e[r]=`${`${(t[r]/1e3/1e3).toFixed(2)}`} ms | CPU: ${`${n[r].toFixed(2)}`} ms`;return e},clear:m,destroy:()=>{m()}}}function sCe(e){let t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,n=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,r=`${e.cpuElapsed.toFixed(2)}`,i=`${e.cpuAvg.toFixed(2)}`;return`${e.label} ${t} ms (avg. ${n} ms) | CPU: ${r} ms (avg. ${i} ms)`}function Aj(e){e.map(e=>{let t=sCe(e);e.children.length||e.calls||e.note?(console.groupCollapsed(t),e.calls&&console.log(e.calls),e.note&&console.log(e.note),Aj(e.children),console.groupEnd()):console.log(t)})}function cCe(e,t){function n(n){try{return e.getContext(n,t)}catch{return null}}let r=(t?.preferWebGl1?null:n(`webgl2`))||n(`webgl`)||n(`experimental-webgl`);return Qy&&console.log(`isWebgl2: ${Bj(r)}`),r}function jj(e,t){switch(t){case e.NO_ERROR:return`no error`;case e.INVALID_ENUM:return`invalid enum`;case e.INVALID_VALUE:return`invalid value`;case e.INVALID_OPERATION:return`invalid operation`;case e.INVALID_FRAMEBUFFER_OPERATION:return`invalid framebuffer operation`;case e.OUT_OF_MEMORY:return`out of memory`;case e.CONTEXT_LOST_WEBGL:return`context lost`}return`unknown error`}function Mj(e,t){let n=e.getError();n!==e.NO_ERROR&&console.log(`WebGL error: '${jj(e,n)}'${t?` (${t})`:``}`)}function lCe(e){let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<t;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Bj(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));let n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);let r=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let t=0;t<r;++t)e.vertexAttribPointer(t,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),Bj(e)&&(e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null))}var Nj=new Uint8Array(4);function Pj(e,t,n){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),n()):Xy.setImmediate(Pj,e,t,n)}function uCe(e,t){let n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);n?Xy.setImmediate(Pj,e,n,t):(console.warn(`Could not create a WebGLSync object`),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Nj),t())}var dCe=!1;function fCe(e){return new Promise(t=>{Bj(e)?uCe(e,t):(dCe||=(console.info(`Sync object not supported in WebGL`),!0),Fj(e),t())})}function Fj(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,Nj)}function pCe(e,t,n,r,i,a){if(Qy&&oj(e),a instanceof Uint8Array)e.readPixels(t,n,r,i,e.RGBA,e.UNSIGNED_BYTE,a);else if(a instanceof Float32Array)e.readPixels(t,n,r,i,e.RGBA,e.FLOAT,a);else if(a instanceof Int32Array&&Bj(e))e.readPixels(t,n,r,i,e.RGBA_INTEGER,e.INT,a);else throw Error(`unsupported readPixels buffer type`);Qy&&Mj(e)}function Ij(e,t){t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}function Lj(e,t,n){let r=t?.framebufferWidth??e.drawingBufferWidth;n===`screen-space`&&(r*=2);let i=t?.framebufferHeight??e.drawingBufferHeight;return{width:r,height:i}}function Rj(e,t,n,r){let i=t===`vertex`?e.VERTEX_SHADER:e.FRAGMENT_SHADER,a=e[`${n.toUpperCase()}_${r.toUpperCase()}`];return e.getShaderPrecisionFormat(i,a)}function zj(e,t){return{lowFloat:Rj(e,t,`low`,`float`),mediumFloat:Rj(e,t,`medium`,`float`),highFloat:Rj(e,t,`high`,`float`),lowInt:Rj(e,t,`low`,`int`),mediumInt:Rj(e,t,`medium`,`int`),highInt:Rj(e,t,`high`,`int`)}}function mCe(){return{resourceCounts:{attribute:0,elements:0,pixelPack:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}}}function hCe(e,t){return{maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Bj(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:t.drawBuffers?e.getParameter(t.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}}function gCe(e,t={}){let n=cj(e),r=Bxe(e,n),i=mCe(),a=hCe(e,n),o=eCe(e,r,i,n,a),s=oCe(e,n,i);if(a.maxVertexTextureImageUnits<8)throw Error(`Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8`);let c={vertex:zj(e,`vertex`),fragment:zj(e,`fragment`)};Qy&&console.log({parameters:a,shaderPrecisionFormats:c});let l=n.provokingVertex;l?.provokingVertex(l.FIRST_VERTEX_CONVENTION);let u=!1,d=new sD,f=t.pixelScale||1,p={session:void 0,layer:void 0,changed:new sD,clear:()=>{p.layer=void 0,p.session=void 0,p.changed.next()}},m=new Set;return{gl:e,isWebGL2:Bj(e),get pixelRatio(){return(typeof window<`u`&&window.devicePixelRatio||1)*(f||1)},extensions:n,state:r,stats:i,resources:o,timer:s,get maxTextureSize(){return a.maxTextureSize},get max3dTextureSize(){return a.max3dTextureSize},get maxRenderbufferSize(){return a.maxRenderbufferSize},get maxDrawBuffers(){return a.maxDrawBuffers},get maxTextureImageUnits(){return a.maxTextureImageUnits},get shaderPrecisionFormats(){return c},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return u||e.isContextLost()},contextRestored:d,setContextLost:()=>{u=!0,s.clear()},handleContextRestored:t=>{zxe(e,n),r.reset(),r.currentMaterialId=-1,r.currentProgramId=-1,r.currentRenderItemId=-1,o.reset(),m.forEach(e=>e.reset()),t?.(),u=!1,d.next(Ly())},xr:{get session(){return p.session},changed:p.changed,set:async(t,n)=>{if(p.session!==t&&(await p.session?.end(),t!==void 0))try{await e.makeXRCompatible(),p.session=t,p.layer=new XRWebGLLayer(p.session,e,{antialias:!0,alpha:!0,depth:!0,framebufferScaleFactor:f*(n?.resolutionScale??1)}),await p.session.updateRenderState({baseLayer:p.layer}),p.session.addEventListener(`end`,p.clear),p.changed.next()}catch(e){throw t?await t.end():(p.layer=void 0,p.session=void 0),e}},end:async()=>p.session?.end()},setPixelScale:e=>{f=e},createRenderTarget:(t,n,r,i,a,s)=>{let c=nCe(e,o,t,n,r,i,a,s);return m.add(c),{...c,destroy:()=>{c.destroy(),m.delete(c)}}},createDrawTarget:()=>({id:-1,texture:tM(e),framebuffer:Rxe(),depthRenderbuffer:null,getByteCount:()=>0,getWidth:()=>Lj(e,p.layer,p.session?.interactionMode).width,getHeight:()=>Lj(e,p.layer,p.session?.interactionMode).height,bind:()=>{Ij(e,p.layer)},setSize:()=>{},reset:()=>{},destroy:()=>{}}),bindDrawingBuffer:()=>Ij(e,p.layer),getDrawingBufferSize:()=>Lj(e,p.layer,p.session?.interactionMode),readPixels:(t,n,r,i,a)=>{pCe(e,t,n,r,i,a)},waitForGpuCommandsComplete:()=>fCe(e),waitForGpuCommandsCompleteSync:()=>Fj(e),getFenceSync:()=>Bj(e)?e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0):null,checkSyncStatus:t=>Bj(e)?e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),!0):!1:!0,deleteSync:t=>{Bj(e)&&e.deleteSync(t)},clear:(t,n,i,a)=>{let o=Lj(e,p.layer);Ij(e,p.layer),r.enable(e.SCISSOR_TEST),r.depthMask(!0),r.colorMask(!0,!0,!0,!0),r.clearColor(t,n,i,a),r.viewport(0,0,o.width,o.height),r.scissor(0,0,o.width,o.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},checkError:t=>{Mj(e,t)},checkFramebufferStatus:t=>{oj(e,t)},destroy:t=>{var n,r,i,a;o.destroy(),lCe(e),(n=p.session)==null||n.removeEventListener(`end`,p.clear),(r=p.session)==null||r.end(),d.complete(),p.changed.complete(),t?.doNotForceWebGLContextLoss||((i=e.getExtension(`WEBGL_lose_context`))==null||i.loseContext(),(a=e.getExtension(`STACKGL_destroy_context`))==null||a.destroy())}}}function Bj(e){return typeof WebGL2RenderingContext<`u`&&e instanceof WebGL2RenderingContext}function _Ce(e){if(Bj(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};{let t=e.getExtension(`ANGLE_instanced_arrays`);return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function vCe(e){if(Bj(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};{let t=e.getExtension(`OES_standard_derivatives`);return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function yCe(e){return Bj(e)?{}:e.getExtension(`OES_element_index_uint`)}function bCe(e){if(Bj(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};{let t=e.getExtension(`OES_vertex_array_object`);return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}function xCe(e){return Bj(e)?{}:e.getExtension(`OES_texture_float`)}function SCe(e){return e.getExtension(`OES_texture_float_linear`)}function CCe(e){if(Bj(e))return{HALF_FLOAT:e.HALF_FLOAT};{let t=e.getExtension(`OES_texture_half_float`);return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}function wCe(e){return e.getExtension(`OES_texture_half_float_linear`)}function TCe(e){if(Bj(e))return{MIN:e.MIN,MAX:e.MAX};{let t=e.getExtension(`EXT_blend_minmax`);return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}function ECe(e){return Bj(e)?{}:e.getExtension(`EXT_frag_depth`)}function DCe(e){if(Bj(e))return e.getExtension(`EXT_color_buffer_float`)===null?null:(e.getExtension(`EXT_float_blend`),{RGBA32F:e.RGBA32F});{let t=e.getExtension(`WEBGL_color_buffer_float`);return t===null?(e.getExtension(`OES_texture_float`),Vj(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension(`EXT_float_blend`),{RGBA32F:t.RGBA32F_EXT})}}function OCe(e){if(Bj(e))return e.getExtension(`EXT_color_buffer_half_float`)===null?null:(e.getExtension(`EXT_float_blend`),{RGBA16F:e.RGBA16F});{let t=e.getExtension(`EXT_color_buffer_half_float`);return t===null?(e.getExtension(`OES_texture_half_float`),Vj(e,36193)?{RGBA16F:34842}:null):(e.getExtension(`EXT_float_blend`),{RGBA16F:t.RGBA16F_EXT})}}function kCe(e){if(Bj(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};{let t=e.getExtension(`WEBGL_draw_buffers`);return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}function ACe(e){let t=e.getExtension(`OES_draw_buffers_indexed`);return t===null?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}function jCe(e){return Bj(e)?{}:e.getExtension(`EXT_shader_texture_lod`)}function MCe(e){if(Bj(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};{let t=e.getExtension(`WEBGL_depth_texture`);return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}function NCe(e){if(Bj(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};{let t=e.getExtension(`EXT_sRGB`);return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}function PCe(e){if(Bj(e)){let t=e.getExtension(`EXT_disjoint_timer_query_webgl2`)||e.getExtension(`EXT_disjoint_timer_query`);return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}else{let t=e.getExtension(`EXT_disjoint_timer_query`);return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}function FCe(e){let t=e.getExtension(`WEBGL_multi_draw`);return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}function ICe(e){let t=e.getExtension(`WEBGL_draw_instanced_base_vertex_base_instance`);return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function LCe(e){let t=e.getExtension(`WEBGL_multi_draw_instanced_base_vertex_base_instance`);return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function RCe(e){let t=e.getExtension(`KHR_parallel_shader_compile`);return t===null?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}function zCe(e){return Bj(e)?{}:e.getExtension(`OES_fbo_render_mipmap`)}function BCe(e){if(Bj(e)){let t=e.getExtension(`WEBGL_provoking_vertex`);if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}function VCe(e){if(Bj(e)){let t=e.getExtension(`WEBGL_clip_cull_distance`);if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}function HCe(e){return Bj(e)&&e.getExtension(`EXT_conservative_depth`)?{}:null}function UCe(e){if(Bj(e)){let t=e.getExtension(`WEBGL_stencil_texturing`);if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}function WCe(e){let t=e.getExtension(`EXT_clip_control`);return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}function GCe(e){return Bj(e)&&e.getExtension(`EXT_render_snorm`)?{}:null}function KCe(e){return Bj(e)&&e.getExtension(`WEBGL_render_shared_exponent`)?{}:null}function qCe(e){let t=e.getExtension(`EXT_texture_norm16`);return t?{R16:t.R16_EXT,RG16:t.RG16_EXT,RGB16:t.RGB16_EXT,RGBA16:t.RGBA16_EXT,R16_SNORM:t.R16_SNORM_EXT,RG16_SNORM:t.RG16_SNORM_EXT,RGB16_SNORM:t.RGB16_SNORM_EXT,RGBA16_SNORM:t.RGBA16_SNORM_EXT}:null}function JCe(e){let t=e.getExtension(`EXT_depth_clamp`);return t?{DEPTH_CLAMP:t.DEPTH_CLAMP_EXT}:null}function YCe(e){if(Bj(e)){let t=e.getExtension(`OVR_multiview2`);if(t)return{FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS_OVR,FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX_OVR,MAX_VIEWS:t.MAX_VIEWS_OVR,FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS:t.FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS_OVR,framebufferTextureMultiview:t.framebufferTextureMultiviewOVR.bind(t)}}return null}function XCe(e){if(!Bj(e))return!1;if(typeof navigator<`u`){let e=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return e?parseInt(e[1])>=85:!0}return!1}var ZCe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,QCe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,$Ce=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Vj(e,t){let n=Cj(e,{type:`vert`,source:ZCe}),r=Cj(e,{type:`frag`,source:QCe});if(!n||!r)return!1;let i=Sj(e);e.attachShader(i,n),e.attachShader(i,r),e.linkProgram(i),e.useProgram(i);let a=e.getAttribLocation(i,`aPosition`),o=e.getUniformLocation(i,`uColor`);if(!o)return Qy&&console.log(`error getting 'uColor' uniform location`),!1;let s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,$Ce,e.STATIC_DRAW),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0);let c=e.createTexture(),l=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,l);let u=e.createTexture();e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);let d=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return Qy&&console.log(`error creating framebuffer for '${t}'`),!1;e.bindTexture(e.TEXTURE_2D,c),e.uniform4fv(o,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,u),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(o,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);let f=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,f),f[0]!==0||f[1]<248||f[2]<248||f[3]<254)return Qy&&console.log(`not able to actually render to '${t}' texture`),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);let t=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,t);let n=e.getError();if(n)return Qy&&console.log(`error reading float pixels: '${jj(e,n)}'`),!1}return!0}var Hj=mb();function ewe(e,t){switch(t){case`image-uint8`:return e.TEXTURE_2D;case`image-float32`:return e.TEXTURE_2D;case`image-float16`:return e.TEXTURE_2D;case`image-depth`:return e.TEXTURE_2D}if(Bj(e))switch(t){case`image-int32`:return e.TEXTURE_2D;case`volume-uint8`:return e.TEXTURE_3D;case`volume-float32`:return e.TEXTURE_3D;case`volume-float16`:return e.TEXTURE_3D}throw Error(`unknown texture kind '${t}'`)}function Uj(e,t,n){switch(t){case`alpha`:return Bj(e)&&(n===`float`||n===`fp16`)?e.RED:Bj(e)&&n===`int`?e.RED_INTEGER:e.ALPHA;case`rgb`:return Bj(e)&&n===`int`?e.RGB_INTEGER:e.RGB;case`rg`:if(Bj(e)&&(n===`float`||n===`fp16`))return e.RG;if(Bj(e)&&n===`int`)return e.RG_INTEGER;throw Error(`texture format "rg" requires webgl2 and type "float" or int"`);case`rgba`:return Bj(e)&&n===`int`?e.RGBA_INTEGER:e.RGBA;case`depth`:return e.DEPTH_COMPONENT}}function twe(e,t,n){if(Bj(e))switch(t){case`alpha`:switch(n){case`ubyte`:return e.ALPHA;case`float`:return e.R32F;case`fp16`:return e.R16F;case`int`:return e.R32I}case`rg`:switch(n){case`ubyte`:return e.RG;case`float`:return e.RG32F;case`fp16`:return e.RG16F;case`int`:return e.RG32I}case`rgb`:switch(n){case`ubyte`:return e.RGB;case`float`:return e.RGB32F;case`fp16`:return e.RGB16F;case`int`:return e.RGB32I}case`rgba`:switch(n){case`ubyte`:return e.RGBA;case`float`:return e.RGBA32F;case`fp16`:return e.RGBA16F;case`int`:return e.RGBA32I}case`depth`:switch(n){case`ushort`:return e.DEPTH_COMPONENT16;case`float`:return e.DEPTH_COMPONENT32F}}return Uj(e,t,n)}function Wj(e,t,n,r,i){return Gj(e,t)*n*r*(i||1)}function Gj(e,t){return nwe(e)*rwe(t)}function nwe(e){switch(e){case`alpha`:return 1;case`rg`:return 2;case`rgb`:return 3;case`rgba`:return 4;case`depth`:return 4}}function rwe(e){switch(e){case`ubyte`:return 1;case`ushort`:return 2;case`float`:return 4;case`fp16`:return 2;case`int`:return 4}}function Kj(e,t,n){switch(n){case`ubyte`:return e.UNSIGNED_BYTE;case`ushort`:return e.UNSIGNED_SHORT;case`float`:return e.FLOAT;case`fp16`:if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw Error(`extension "texture_half_float" unavailable`);case`int`:if(Bj(e))return e.INT;throw Error(`texture type "int" requires webgl2`)}}function qj(e,t){switch(t){case`nearest`:return e.NEAREST;case`linear`:return e.LINEAR}}function Jj(e,t,n){switch(n){case`depth`:return e.DEPTH_ATTACHMENT;case`stencil`:return e.STENCIL_ATTACHMENT;case`color0`:case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(n){case`color1`:case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case`color2`:case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case`color3`:case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case`color4`:case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case`color5`:case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case`color6`:case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case`color7`:case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw Error(`unknown texture attachment`)}function Yj(e){return typeof HTMLImageElement<`u`&&e instanceof HTMLImageElement}function iwe(e,t,n){return t===n.TEXTURE_2D}function Xj(e,t,n){return t===n.TEXTURE_3D}function Zj(e){let t=e.createTexture();if(t===null)throw Error(`Could not create WebGL texture`);return t}function awe(e,t,n,r,i,a){let o=Hj(),s=Zj(e);if(n.endsWith(`float32`)&&i!==`float`||n.endsWith(`float16`)&&i!==`fp16`||n.endsWith(`uint8`)&&i!==`ubyte`||n.endsWith(`int32`)&&i!==`int`||n.endsWith(`depth`)&&i!==`ushort`&&i!==`float`)throw Error(`texture kind '${n}' and type '${i}' are incompatible`);if(!t.depthTexture&&r===`depth`)throw Error(`extension 'WEBGL_depth_texture' needed for 'depth' texture format`);let c=ewe(e,n),l=qj(e,a),u=Uj(e,r,i),d=twe(e,r,i),f=Kj(e,t,i);function p(){e.bindTexture(c,s),e.texParameteri(c,e.TEXTURE_MAG_FILTER,l),e.texParameteri(c,e.TEXTURE_MIN_FILTER,l),e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(c,null)}p();let m=0,h=0,g=0,_,v=!1,y=!1;function b(t,n,r){if(t===0||n===0||Bj(e)&&c===e.TEXTURE_3D&&r===0)throw Error(`empty textures are not allowed`);if(!(m===t&&h===n&&g===(r||0)))if(m=t,h=n,g=r||0,e.bindTexture(c,s),c===e.TEXTURE_2D)e.texImage2D(c,0,d,m,h,0,u,f,null);else if(Bj(e)&&c===e.TEXTURE_3D&&g!==void 0)e.texImage3D(c,0,d,m,h,g,0,u,f,null);else throw Error(`unknown texture target`)}b(1,1,Bj(e)&&c===e.TEXTURE_3D?1:0);function x(t,n=!1){if(t.width===0||t.height===0||!Yj(t)&&Bj(e)&&Xj(t,c,e)&&t.depth===0)throw Error(`empty textures are not allowed`);if(e.bindTexture(c,s),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),Yj(t))m=t.width,h=t.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,d,u,f,t);else if(iwe(t,c,e)){let r=t.filter?qj(e,t.filter):l;e.texParameteri(c,e.TEXTURE_MAG_FILTER,r),e.texParameteri(c,e.TEXTURE_MIN_FILTER,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!t.flipY),n?e.texSubImage2D(c,0,0,0,t.width,t.height,u,f,t.array):(m=t.width,h=t.height,e.texImage2D(c,0,d,m,h,0,u,f,t.array))}else if(Bj(e)&&Xj(t,c,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),n?e.texSubImage3D(c,0,0,0,0,t.width,t.height,t.depth,u,f,t.array):(m=t.width,h=t.height,g=t.depth,e.texImage3D(c,0,d,m,h,g,0,u,f,t.array));else throw Error(`unknown texture target`);e.bindTexture(c,null),_=t}function S(){if(c!==e.TEXTURE_2D)throw Error(`mipmap only supported for 2d textures`);if(Bj(e)||LT(m)&&LT(h))e.bindTexture(c,s),e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(c),e.bindTexture(c,null),v=!0;else throw Error(`mipmap unsupported for non-power-of-two textures and webgl1`)}function C(n,r,i){if(n.bind(),c===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Jj(e,t,r),e.TEXTURE_2D,s,0);else if(Bj(e)&&c===e.TEXTURE_3D){if(i===void 0)throw Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,Jj(e,t,r),s,0,i)}else throw Error(`unknown/unsupported texture target`)}return{id:o,target:c,format:u,internalFormat:d,type:f,filter:l,getWidth:()=>m,getHeight:()=>h,getDepth:()=>g,getByteCount:()=>Wj(r,i,m,h,g),define:b,load:x,mipmap:S,bind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(c,s)},unbind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(c,null)},attachFramebuffer:C,detachFramebuffer:(n,r)=>{if(n.bind(),c===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,Jj(e,t,r),e.TEXTURE_2D,null,0);else if(Bj(e)&&c===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,Jj(e,t,r),null,0,0);else throw Error(`unknown texture target`)},reset:()=>{s=Zj(e),p();let[t,n,r]=[m,h,g];m=0,h=0,g=0,b(t,n,r),_&&x(_),v&&S()},destroy:()=>{y||=(e.deleteTexture(s),!0)}}}function Qj(e,t,n){let{resources:r}=e,i=[];return Object.keys(t).forEach(e=>{let a=t[e];if(a.type===`texture`){let t=n[e];if(t)if(a.kind===`texture`)i[i.length]=[e,t.ref.value];else{let n=r.texture(a.kind,a.format,a.dataType,a.filter);n.load(t.ref.value),i[i.length]=[e,n]}}}),i}function $j(e,t,n){let r=new Image;r.onload=function(){n.load(r),L.update(t,n)},r.src=e}function owe(e,t){switch(t){case`nx`:return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case`ny`:return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case`nz`:return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case`px`:return e.TEXTURE_CUBE_MAP_POSITIVE_X;case`py`:return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case`pz`:return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}function swe(e,t,n,r){let i=e.TEXTURE_CUBE_MAP,a=e.LINEAR,o=e.RGBA,s=e.RGBA,c=e.UNSIGNED_BYTE,l=0,u=e.createTexture();e.bindTexture(i,u);function d(t,d,f,h){l===0&&(l=f.width),e.bindTexture(i,u),e.texImage2D(t,d,o,l,l,0,s,c,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(i,u),e.texImage2D(t,d,o,s,c,f),p+=1,p===6&&(m||(n?(e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(i)):e.texParameteri(i,e.TEXTURE_MIN_FILTER,a),e.texParameteri(i,e.TEXTURE_MAG_FILTER,a)),h||r?.(m))}let f=[],p=0;WT(t,(t,n)=>{if(!t)return;let i=owe(e,n),a=new Image;t instanceof File?a.src=URL.createObjectURL(t):Rb(t)?t.then(e=>{a.src=URL.createObjectURL(e)}):a.src=t,f.push({cubeTarget:i,level:0,image:a}),a.addEventListener(`load`,()=>{d(i,0,a,!1)}),a.addEventListener(`error`,()=>{r?.(!0)})});let m=!1;return{id:Hj(),target:i,format:s,internalFormat:o,type:c,filter:a,getWidth:()=>l,getHeight:()=>l,getDepth:()=>0,getByteCount:()=>Wj(`rgba`,`ubyte`,l,l,0)*6*(n?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(i,u)},unbind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(i,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{u=Zj(e),e.bindTexture(i,u),p=0;for(let{cubeTarget:e,level:t,image:n}of f)d(e,t,n,!0)},destroy:()=>{m||=(e.deleteTexture(u),!0)}}}var eM=-1;function cwe(e){return e.format===eM}function tM(e){let t=e?.TEXTURE_2D??3553;return{id:Hj(),target:t,format:eM,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:n=>{e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(t,null))},unbind:n=>{e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(t,null))},attachFramebuffer:()=>{throw Error(`cannot attach null-texture to a framebuffer`)},detachFramebuffer:()=>{throw Error(`cannot detach null-texture from a framebuffer`)},reset:()=>{},destroy:()=>{}}}function nM(e,t,n,r){let i=lwe(e,t,n,r);if(n.palette){L.updateIfChanged(i.dUsePalette,!0);let[e,t]=n.palette.domain||[0,1];L.update(i.uPaletteDomain,R.set(i.uPaletteDomain.ref.value,e,t)),L.update(i.uPaletteDefault,tE.toVec3Normalized(i.uPaletteDefault.ref.value,n.palette.defaultColor??tE(13421772))),uwe(n.palette,i.tPalette)}else L.updateIfChanged(i.dUsePalette,!1);return i}function lwe(e,t,n,r){switch(n.granularity){case`uniform`:return fwe(e,n.color,r);case`instance`:return e.nonInstanceable?iM(e,n.color,r):pwe(e,n.color,r);case`group`:return iM(e,n.color,r);case`groupInstance`:return mwe(e,n.color,r);case`vertex`:return hwe(t,n.color,r);case`vertexInstance`:return gwe(t,n.color,r);case`volume`:return aM(n.grid,`volume`,r);case`volumeInstance`:return aM(n.grid,`volumeInstance`,r);case`direct`:return _we(r)}}function uwe(e,t){let n=!0,r=t.ref.value;if(e.colors.length!==r.width||r.filter!==e.filter)n=!1;else{let t=r.array,i=0;for(let r of e.colors){let[e,a,o]=tE.toRgb(r);if(t[i++]!==e||t[i++]!==a||t[i++]!==o){n=!1;break}}}if(n)return;let i=new Uint8Array(e.colors.length*3),a=0;for(let t of e.colors){let[e,n,r]=tE.toRgb(t);i[a++]=e,i[a++]=n,i[a++]=r}L.update(t,{array:i,height:1,width:e.colors.length,filter:e.filter})}function dwe(e,t){return t?(L.update(t.uColor,tE.toVec3Normalized(t.uColor.ref.value,e)),L.updateIfChanged(t.dColorType,`uniform`),t):{uColor:L.create(tE.toVec3Normalized(B(),e)),tColor:L.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:L.create(tM()),uPaletteDomain:L.create(R.create(0,1)),uPaletteDefault:L.create(B()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(R.create(1,1)),uColorGridDim:L.create(B.create(1,1,1)),uColorGridTransform:L.create(AO.create(0,0,0,1)),dColorType:L.create(`uniform`),dUsePalette:L.create(!1)}}function fwe(e,t,n){e.reset();let r=e.hasNext?e.move():{location:$A,isSecondary:!1};return dwe(t(r.location,r.isSecondary),n)}function rM(e,t,n){return n?(L.update(n.tColor,e),L.update(n.uColorTexDim,R.create(e.width,e.height)),L.updateIfChanged(n.dColorType,t),n):{uColor:L.create(B()),tColor:L.create(e),tColorGrid:L.create(tM()),uPaletteDomain:L.create(R.create(0,1)),uPaletteDefault:L.create(B()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(R.create(e.width,e.height)),uColorGridDim:L.create(B.create(1,1,1)),uColorGridTransform:L.create(AO.create(0,0,0,1)),dColorType:L.create(t),dUsePalette:L.create(!1)}}function pwe(e,t,n){let{instanceCount:r}=e,i=WA(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:n,isSecondary:r,instanceIndex:a}=e.move();tE.toArray(t(n,r),i.array,a*3),e.skipInstance()}return rM(i,`instance`,n)}function iM(e,t,n){let{groupCount:r,hasLocation2:i}=e,a=WA(Math.max(1,r*(i?2:1)),3,Uint8Array,n&&n.tColor.ref.value.array);e.reset();let o=i?6:3;for(;e.hasNext&&!e.isNextNewInstance;){let{location:n,location2:r,isSecondary:s,groupIndex:c}=e.move();tE.toArray(t(n,s),a.array,c*o),i&&tE.toArray(t(r,s),a.array,c*o+3)}return rM(a,`group`,n)}function mwe(e,t,n){let{groupCount:r,instanceCount:i,hasLocation2:a}=e,o=i*r*(a?2:1),s=WA(Math.max(1,o),3,Uint8Array,n&&n.tColor.ref.value.array);e.reset();let c=a?6:3;for(;e.hasNext;){let{location:n,location2:r,isSecondary:i,index:o}=e.move();tE.toArray(t(n,i),s.array,o*c),a&&tE.toArray(t(r,i),s.array,o*c+3)}return rM(s,`groupInstance`,n)}function hwe(e,t,n){let{groupCount:r,stride:i}=e,a=WA(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){let{location:n,isSecondary:r,groupIndex:o}=e.move(),s=t(n,r);for(let e=0;e<i;++e)tE.toArray(s,a.array,(o+e)*3)}return rM(a,`vertex`,n)}function gwe(e,t,n){let{groupCount:r,instanceCount:i,stride:a}=e,o=i*r,s=WA(Math.max(1,o),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:n,isSecondary:r,index:i}=e.move(),o=t(n,r);for(let e=0;e<a;++e)tE.toArray(o,s.array,(i+e)*3)}return rM(s,`vertexInstance`,n)}function aM(e,t,n){let{colors:r,dimension:i,transform:a}=e,o=r.getWidth(),s=r.getHeight();return n?(L.update(n.tColorGrid,r),L.update(n.uColorTexDim,R.create(o,s)),L.update(n.uColorGridDim,B.clone(i)),L.update(n.uColorGridTransform,AO.clone(a)),L.updateIfChanged(n.dColorType,t),n):{uColor:L.create(B()),tColor:L.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:L.create(r),uPaletteDomain:L.create(R.create(0,1)),uPaletteDefault:L.create(B()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(R.create(o,s)),uColorGridDim:L.create(B.clone(i)),uColorGridTransform:L.create(AO.clone(a)),dColorType:L.create(t),dUsePalette:L.create(!1)}}function _we(e){return e?(L.updateIfChanged(e.dColorType,`direct`),e):{uColor:L.create(B()),tColor:L.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:L.create(tM()),uPaletteDomain:L.create(R.create(0,1)),uPaletteDefault:L.create(B()),tPalette:L.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:L.create(R.create(1,1)),uColorGridDim:L.create(B.create(1,1,1)),uColorGridTransform:L.create(AO.create(0,0,0,1)),dColorType:L.create(`direct`),dUsePalette:L.create(!1)}}var oM=B.transformMat4Offset,vwe=B.fromArray,sM=$k.add;function ywe(){return{cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array}}function bwe(e,t,n){let r=xwe(e,t),i=Swe(r,n),a=new Uint32Array(r.cellOffsets.length),o=new Float32Array(r.cellSpheres.length),s=new Float32Array(r.cellInstance.length),c=0;for(let t=0,n=i.batchCell.length;t<n;++t){let n=i.batchCell[t],l=r.cellOffsets[n],u=r.cellOffsets[n+1]-l;a[t+1]=a[t]+u;for(let e=0;e<4;++e)o[t*4+e]=r.cellSpheres[n*4+e];for(let t=0;t<u;++t){let n=l+t,i=r.cellInstance[n];for(let t=0;t<16;++t)r.cellTransform[c*16+t]=e.transform[i*16+t];s[c]=i,c+=1}}return{cellSize:r.cellSize,cellCount:r.cellCount,cellOffsets:a,cellSpheres:o,cellTransform:r.cellTransform,cellInstance:s,batchSize:i.batchSize,batchCount:i.batchCount,batchOffsets:i.batchOffsets,batchSpheres:i.batchSpheres,batchCell:TE(i.batchCell)}}function xwe(e,t){let{instanceCount:n,instance:r,transform:i,invariantBoundingSphere:a}=e,o=new Float32Array(n),s=new Float32Array(n),c=new Float32Array(n),l=K.ofBounds(0,n),u=$k.setEmpty($k()),{center:d,radius:f}=a,p=B.create(f,f,f),m=B();for(let e=0;e<n;++e)oM(m,d,i,0,0,e*16),o[e]=m[0],s[e]=m[1],c[e]=m[2],sM(u,m);$k.expand(u,u,p);let{array:h,offset:g,count:_}=yA({x:o,y:s,z:c,indices:l},{box:u,sphere:q.fromBox3D(q(),u)},B.create(t,t,t)).buckets,v=g.length,y=new Uint32Array(v+1),b=new Float32Array(v*4),x=new Float32Array(n*16),S=new Float32Array(n),C=$k(),w=q(),T=0;for(let e=0;e<v;++e){let t=g[e],n=_[e];y[e]=t;let a=T;for(let e=t,a=t+n;e<a;++e){let t=h[e];S[T]=r[t];for(let e=0;e<16;++e)x[T*16+e]=i[t*16+e];T+=1}if(n===1)oM(b,d,x,e*4,0,a*16),b[e*4+3]=f;else{$k.setEmpty(C);let t=a*16;for(let e=0;e<n;++e)oM(m,d,x,0,0,e*16+t),sM(C,m);$k.expand(C,C,p),q.fromBox3D(w,C),q.toArray(w,b,e*4)}}return y[v]=g[v-1]+_[v-1],{cellSize:t,cellCount:v,cellOffsets:y,cellSpheres:b,cellTransform:x,cellInstance:S}}function Swe(e,t){let{cellCount:n,cellSpheres:r}=e,i=new Float32Array(n),a=new Float32Array(n),o=new Float32Array(n),s=K.ofBounds(0,n),c=$k.setEmpty($k()),l=B(),u=0;for(let e=0;e<n;++e){let t=e*4;vwe(l,r,t),i[e]=l[0],a[e]=l[1],o[e]=l[2],sM(c,l),u=Math.max(u,r[t+3])}let d=B.create(u,u,u);$k.expand(c,c,d);let{array:f,offset:p,count:m}=yA({x:i,y:a,z:o,indices:s},{box:c,sphere:q.fromBox3D(q(),c)},B.create(t,t,t)).buckets,h=p.length,g=new Uint32Array(h+1),_=new Float32Array(h*4),v=new Uint32Array(n),y=$k(),b=q(),x=0;for(let e=0;e<h;++e){let t=p[e],n=m[e];g[e]=t;for(let e=t,r=t+n;e<r;++e)v[x]=f[e],x+=1;if(n===1){let n=f[t];_[e*4]=r[n*4],_[e*4+1]=r[n*4+1],_[e*4+2]=r[n*4+2],_[e*4+3]=r[n*4+3]}else{$k.setEmpty(y),u=0;for(let e=t,i=t+n;e<i;++e){let t=f[e];l[0]=r[t*4],l[1]=r[t*4+1],l[2]=r[t*4+2],sM(y,l),u=Math.max(u,r[t*4+3])}B.set(d,u,u,u),$k.expand(y,y,d),q.fromBox3D(b,y),q.toArray(b,_,e*4)}}return g[h]=p[h-1]+m[h-1],{batchSize:t,batchCount:h,batchOffsets:g,batchSpheres:_,batchCell:v}}var cM=TT(),Cwe=z();function wwe(e,t){for(let n=0;n<t;n++)if(TT.fromMat4(cM,z.fromArray(Cwe,e,n*16)),TT.determinant(cM)<0)return!0;return!1}function lM(e,t,n,r,i,a){let o=wwe(e,t);if(a){L.update(a.matrix,a.matrix.ref.value);let n=a.transform.ref.value.length>=t*16?a.transform.ref.value:new Float32Array(t*16);n.set(e),L.update(a.transform,n),L.updateIfChanged(a.uInstanceCount,t),L.updateIfChanged(a.instanceCount,t);let r=a.aTransform.ref.value.length>=t*16?a.aTransform.ref.value:new Float32Array(t*16);L.update(a.aTransform,r);let i=a.extraTransform.ref.value.length>=t*16?a.extraTransform.ref.value:new Float32Array(t*16);L.update(a.extraTransform,fM(i,t));let s=a.aInstance.ref.value.length>=t?a.aInstance.ref.value:new Float32Array(t);L.update(a.aInstance,TE(s,t)),L.update(a.hasReflection,o)}else a={aTransform:L.create(new Float32Array(t*16)),matrix:L.create(z.identity()),transform:L.create(new Float32Array(e)),extraTransform:L.create(fM(new Float32Array(t*16),t)),uInstanceCount:L.create(t),instanceCount:L.create(t),aInstance:L.create(TE(new Float32Array(t))),hasReflection:L.create(o),instanceGrid:L.create(ywe())};return pM(a,n,r,i),a}var uM=new Float32Array(16);z.toArray(z.identity(),uM,0);function dM(e){return lM(new Float32Array(uM),1,void 0,0,0,e)}function fM(e,t){for(let n=0;n<t;n++)e.set(uM,n*16);return e}function pM(e,t,n,r){let i=e.aTransform.ref.value,a=e.aInstance.ref.value,o=e.instanceCount.ref.value,s=e.matrix.ref.value,c=e.transform.ref.value,l=e.extraTransform.ref.value;for(let e=0;e<o;e++){let t=e*16;z.mulOffset(i,l,c,t,t,t),z.mulOffset(i,s,i,t,0,t),a[e]=e}if(t&&o>0){let s=bwe({instanceCount:o,instance:a,transform:i,invariantBoundingSphere:t},n,r);L.update(e.instanceGrid,s),L.update(e.aInstance,s.cellInstance),L.update(e.aTransform,s.cellTransform)}else L.update(e.aInstance,a),L.update(e.aTransform,i)}const mM={Atom:`Atom Property`,Chain:`Chain Property`,Residue:`Residue Property`,Symmetry:`Symmetry`,Validation:`Validation`,Misc:`Miscellaneous`};var hM=tE(13421772),Twe=`Gives everything the same, uniform color.`;const gM={value:V.Color(hM),saturation:V.Numeric(0,{min:-6,max:6,step:.1}),lightness:V.Numeric(0,{min:-6,max:6,step:.1})};function Ewe(e){return gM}function _M(e,t){let n=Ox(t.value,hM);return n=tE.saturate(n,t.saturation),n=tE.lighten(n,t.lightness),{factory:_M,granularity:`uniform`,color:()=>n,props:t,description:Twe,legend:wk([[`uniform`,n]])}}const Dwe={name:`uniform`,label:`Uniform`,category:mM.Misc,factory:_M,getParams:Ewe,defaultValues:V.getDefaultValues(gM),isApplicable:e=>!0};var Owe=`Gives everything the same, uniform size.`;const vM={value:V.Numeric(1,{min:0,max:20,step:.1})};function kwe(e){return vM}function yM(e,t){let n=t.value;return{factory:yM,granularity:`uniform`,size:()=>n,props:t,description:Owe}}const Awe={name:`uniform`,label:`Uniform`,category:``,factory:yM,getParams:kwe,defaultValues:V.getDefaultValues(vM),isApplicable:e=>!0};function bM(e){return{...bM.Zero,...e}}(function(e){e.Zero={metalness:0,roughness:0,bumpiness:0};function t(e,t,n){return t[n]=e.metalness*255,t[n+1]=e.roughness*255,t[n+2]=e.bumpiness*255,t}e.toArray=t;function n({metalness:e,roughness:t,bumpiness:n}){return`M ${e.toFixed(2)} | R ${t.toFixed(2)} | B ${n.toFixed(2)}`}e.toString=n;function r(e){return V.Group({metalness:V.Numeric(0,{min:0,max:1,step:.01}),roughness:V.Numeric(1,{min:0,max:1,step:.01}),bumpiness:V.Numeric(0,{min:0,max:1,step:.01})},{...e,presets:[[{metalness:0,roughness:1,bumpiness:0},`Matte`],[{metalness:0,roughness:.2,bumpiness:0},`Plastic`],[{metalness:0,roughness:.6,bumpiness:0},`Glossy`],[{metalness:1,roughness:.6,bumpiness:0},`Metallic`]]})}e.getParam=r})(bM||={});function xM(){}(function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:V.Select(`pixel`,V.arrayToOptions([`instance`,`pixel`])),objects:V.ObjectList({type:V.Select(`plane`,V.objectToOptions(e.Type,e=>JT(e))),invert:V.Boolean(!1),position:V.Vec3(B()),rotation:V.Group({axis:V.Vec3(B.create(1,0,0)),angle:V.Numeric(0,{min:-180,max:180,step:1},{description:`Angle in Degrees`})},{isExpanded:!0}),scale:V.Vec3(B.create(1,1,1)),transform:V.Mat4(z.identity())},e=>JT(e.type))};function t(e){return{count:0,type:Array(e).fill(1),invert:Array(e).fill(!1),position:Array(e*3).fill(0),rotation:Array(e*4).fill(0),scale:Array(e*3).fill(1),transform:Array(e*16).fill(0)}}let n=MT(),r=MT(),i=B(),a=B(),o=z(),s=z();function c(r,i){let a=r.objects.length,{type:o,invert:s,position:c,rotation:l,scale:u,transform:d}=i?.objects||t(a);for(let t=0;t<a;++t){let i=r.objects[t];o[t]=e.Type[i.type],s[t]=i.invert,B.toArray(i.position,c,t*3),MT.toArray(MT.setAxisAngle(n,i.rotation.axis,FT(i.rotation.angle)),l,t*4),B.toArray(i.scale,u,t*3),z.toArray(i.transform,d,t*16)}return{variant:r.variant,objects:{count:a,type:o,invert:s,position:c,rotation:l,scale:u,transform:d}}}e.getClip=c;function l(e,t){if(e.variant!==t.variant||e.objects.count!==t.objects.count)return!1;let c=e.objects,l=t.objects;for(let e=0,t=c.count;e<t;++e)if(c.invert[e]!==l.invert[e]||c.type[e]!==l.type[e]||(B.fromArray(i,c.position,e*3),B.fromArray(a,l.position,e*3),!B.equals(i,a))||(B.fromArray(i,c.scale,e*3),B.fromArray(a,l.scale,e*3),!B.equals(i,a))||(MT.fromArray(n,c.rotation,e*4),MT.fromArray(r,l.rotation,e*4),!MT.equals(n,r))||(z.fromArray(o,c.transform,e*16),z.fromArray(s,l.transform,e*16),!z.areEqual(o,s,1e-6)))return!1;return!0}e.areEqual=l})(xM||={});const jwe=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),SM=V.arrayToOptions(jwe),CM={smoothColors:V.MappedStatic(`auto`,{auto:V.Group({}),on:V.Group({resolutionFactor:V.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:V.Numeric(3,{min:1,max:12,step:1})}),off:V.Group({})})};function wM(e){return!!e.smoothColors}function TM(e,t,n){if((e.name===`on`||e.name===`auto`&&t)&&n&&n<3){let t=3;return e.name===`on`?(n*=e.params.resolutionFactor,t=e.params.sampleStride):(n*=2-jT(0,1.1,n),n=Math.max(.5,n),n>1.2&&(t=2)),{resolution:n,stride:t}}}var EM;(function(e){e.MaterialCategory={category:`Material`},e.ShadingCategory={category:`Shading`},e.CullingLodCategory={category:`Culling & LOD`},e.CustomQualityParamInfo={category:`Custom Quality`,hideIf:e=>e.quality!==void 0&&e.quality!==`custom`},e.Params={alpha:V.Numeric(1,{min:0,max:1,step:.01},{label:`Opacity`,isEssential:!0,description:`How opaque/transparent the representation is rendered.`}),quality:V.Select(`auto`,SM,{isEssential:!0,description:`Visual/rendering quality of the representation.`}),material:bM.getParam(),clip:V.Group(xM.Params),emissive:V.Numeric(0,{min:0,max:1,step:.01}),density:V.Numeric(.2,{min:0,max:1,step:.01},{description:`Density value to estimate object thickness.`}),instanceGranularity:V.Boolean(!1,{description:`Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory.`}),lod:V.Vec3(B(),void 0,{...e.CullingLodCategory,description:`Level of detail.`,fieldLabels:{x:`Min Distance`,y:`Max Distance`,z:`Overlap (Shader)`}}),cellSize:V.Numeric(200,{min:0,max:5e3,step:100},{...e.CullingLodCategory,description:`Instance grid cell size.`}),batchSize:V.Numeric(2e3,{min:0,max:5e4,step:500},{...e.CullingLodCategory,description:`Instance grid batch size.`})};function t(e=gk.grey,t=1,n){n||=dM();let r=tj(1,n.instanceCount.ref.value,1,()=>$A,!1,()=>!1),i={color:_M({},{value:e,lightness:0,saturation:0}),size:yM({},{value:t})};return{transform:n,locationIterator:r,theme:i}}e.createSimple=t;function n(e,t){let n=xM.getClip(e.clip);return{alpha:L.create(e.alpha),uAlpha:L.create(e.alpha),uVertexCount:L.create(t.vertexCount),uGroupCount:L.create(t.groupCount),drawCount:L.create(t.drawCount),uMetalness:L.create(e.material.metalness),uRoughness:L.create(e.material.roughness),uBumpiness:L.create(e.material.bumpiness),uEmissive:L.create(e.emissive),uDensity:L.create(e.density),dClipObjectCount:L.create(n.objects.count),dClipVariant:L.create(n.variant),uClipObjectType:L.create(n.objects.type),uClipObjectInvert:L.create(n.objects.invert),uClipObjectPosition:L.create(n.objects.position),uClipObjectRotation:L.create(n.objects.rotation),uClipObjectScale:L.create(n.objects.scale),uClipObjectTransform:L.create(n.objects.transform),instanceGranularity:L.create(e.instanceGranularity),uLod:L.create(AO.create(e.lod[0],e.lod[1],e.lod[2],0))}}e.createValues=n;function r(e,t){L.updateIfChanged(e.alpha,t.alpha),L.updateIfChanged(e.uMetalness,t.material.metalness),L.updateIfChanged(e.uRoughness,t.material.roughness),L.updateIfChanged(e.uBumpiness,t.material.bumpiness),L.updateIfChanged(e.uEmissive,t.emissive),L.updateIfChanged(e.uDensity,t.density);let n=xM.getClip(t.clip);L.updateIfChanged(e.dClipObjectCount,n.objects.count),L.updateIfChanged(e.dClipVariant,n.variant),L.update(e.uClipObjectType,n.objects.type),L.update(e.uClipObjectInvert,n.objects.invert),L.update(e.uClipObjectPosition,n.objects.position),L.update(e.uClipObjectRotation,n.objects.rotation),L.update(e.uClipObjectScale,n.objects.scale),L.update(e.uClipObjectTransform,n.objects.transform),L.updateIfChanged(e.instanceGranularity,t.instanceGranularity),L.update(e.uLod,AO.set(e.uLod.ref.value,t.lod[0],t.lod[1],t.lod[2],0))}e.updateValues=r;function i(e={}){let t=e.alpha===void 0?!0:e.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:t,writeDepth:t}}e.createRenderableState=i;function a(e,t){e.opaque=t.alpha*e.alphaFactor>=1,e.writeDepth=e.opaque}e.updateRenderableState=a})(EM||={});function Mwe(e,t,n,r){for(let i=t;i<n;++i)tE.toArray(r,e,i*4),e[i*4+3]=255;return!0}function DM(e,t,n){return e.fill(0,t*4,n*4),!0}function Nwe(e,t,n){let r=WA(Math.max(1,e),4,Uint8Array,n&&n.tOverpaint.ref.value.array);return n?(L.update(n.tOverpaint,r),L.update(n.uOverpaintTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.dOverpaint,e>0),L.updateIfChanged(n.dOverpaintType,t),n):{tOverpaint:L.create(r),uOverpaintTexDim:L.create(R.create(r.width,r.height)),dOverpaint:L.create(e>0),tOverpaintGrid:L.create(tM()),uOverpaintGridDim:L.create(B.create(1,1,1)),uOverpaintGridTransform:L.create(AO.create(0,0,0,1)),dOverpaintType:L.create(t),uOverpaintStrength:L.create(1)}}var OM={array:new Uint8Array(4),width:1,height:1};function kM(e){return e?(L.update(e.tOverpaint,OM),L.update(e.uOverpaintTexDim,R.create(1,1)),e):{tOverpaint:L.create(OM),uOverpaintTexDim:L.create(R.create(1,1)),dOverpaint:L.create(!1),tOverpaintGrid:L.create(tM()),uOverpaintGridDim:L.create(B.create(1,1,1)),uOverpaintGridTransform:L.create(AO.create(0,0,0,1)),dOverpaintType:L.create(`groupInstance`),uOverpaintStrength:L.create(1)}}function Pwe(e,t,n,r){for(let i=t;i<n;++i)e[i]=r*255;return!0}function AM(e,t){if(t===0||e.length<t)return 0;let n=0;for(let r=0;r<t;++r)n+=e[r];return n/(255*t)}function jM(e,t){if(t===0||e.length<t)return 1;let n=255;for(let r=0;r<t;++r)e[r]>0&&e[r]<n&&(n=e[r]);return n/255}function Fwe(e,t,n){e.fill(0,t,n)}function Iwe(e,t,n){let r=WA(Math.max(1,e),1,Uint8Array,n&&n.tTransparency.ref.value.array);return n?(L.update(n.tTransparency,r),L.update(n.uTransparencyTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.dTransparency,e>0),L.updateIfChanged(n.transparencyAverage,AM(r.array,e)),L.updateIfChanged(n.transparencyMin,jM(r.array,e)),L.updateIfChanged(n.dTransparencyType,t),n):{tTransparency:L.create(r),uTransparencyTexDim:L.create(R.create(r.width,r.height)),dTransparency:L.create(e>0),transparencyAverage:L.create(0),transparencyMin:L.create(1),tTransparencyGrid:L.create(tM()),uTransparencyGridDim:L.create(B.create(1,1,1)),uTransparencyGridTransform:L.create(AO.create(0,0,0,1)),dTransparencyType:L.create(t),uTransparencyStrength:L.create(1)}}var MM={array:new Uint8Array(1),width:1,height:1};function NM(e){return e?(L.update(e.tTransparency,MM),L.update(e.uTransparencyTexDim,R.create(1,1)),e):{tTransparency:L.create(MM),uTransparencyTexDim:L.create(R.create(1,1)),dTransparency:L.create(!1),transparencyAverage:L.create(0),transparencyMin:L.create(1),tTransparencyGrid:L.create(tM()),uTransparencyGridDim:L.create(B.create(1,1,1)),uTransparencyGridTransform:L.create(AO.create(0,0,0,1)),dTransparencyType:L.create(`groupInstance`),uTransparencyStrength:L.create(1)}}function Lwe(e,t,n,r){return e.fill(r,t,n),!0}function Rwe(e,t,n){e.fill(0,t,n)}function zwe(e,t,n){let r=WA(Math.max(1,e),1,Uint8Array,n&&n.tClipping.ref.value.array);return n?(L.update(n.tClipping,r),L.update(n.uClippingTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.dClipping,e>0),L.updateIfChanged(n.dClippingType,t),n):{tClipping:L.create(r),uClippingTexDim:L.create(R.create(r.width,r.height)),dClipping:L.create(e>0),dClippingType:L.create(t)}}var PM={array:new Uint8Array(1),width:1,height:1};function FM(e){return e?(L.update(e.tClipping,PM),L.update(e.uClippingTexDim,R.create(1,1)),L.updateIfChanged(e.dClipping,!1),e):{tClipping:L.create(PM),uClippingTexDim:L.create(R.create(1,1)),dClipping:L.create(!1),dClippingType:L.create(`groupInstance`)}}function Bwe(e,t,n,r){for(let i=t;i<n;++i)bM.toArray(r,e,i*4),e[i*4+3]=255;return!0}function IM(e,t,n){return e.fill(0,t*4,n*4),!0}function Vwe(e,t,n){let r=WA(Math.max(1,e),4,Uint8Array,n&&n.tSubstance.ref.value.array);return n?(L.update(n.tSubstance,r),L.update(n.uSubstanceTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.dSubstance,e>0),L.updateIfChanged(n.dSubstanceType,t),n):{tSubstance:L.create(r),uSubstanceTexDim:L.create(R.create(r.width,r.height)),dSubstance:L.create(e>0),tSubstanceGrid:L.create(tM()),uSubstanceGridDim:L.create(B.create(1,1,1)),uSubstanceGridTransform:L.create(AO.create(0,0,0,1)),dSubstanceType:L.create(t),uSubstanceStrength:L.create(1)}}var LM={array:new Uint8Array(4),width:1,height:1};function RM(e){return e?(L.update(e.tSubstance,LM),L.update(e.uSubstanceTexDim,R.create(1,1)),e):{tSubstance:L.create(LM),uSubstanceTexDim:L.create(R.create(1,1)),dSubstance:L.create(!1),tSubstanceGrid:L.create(tM()),uSubstanceGridDim:L.create(B.create(1,1,1)),uSubstanceGridTransform:L.create(AO.create(0,0,0,1)),dSubstanceType:L.create(`groupInstance`),uSubstanceStrength:L.create(1)}}function Hwe(e,t,n,r){for(let i=t;i<n;++i)e[i]=r*255;return!0}function zM(e,t){if(t===0||e.length<t)return 0;let n=0;for(let r=0;r<t;++r)n+=e[r];return n/(255*t)}function Uwe(e,t,n){e.fill(0,t,n)}function Wwe(e,t,n){let r=WA(Math.max(1,e),1,Uint8Array,n&&n.tEmissive.ref.value.array);return n?(L.update(n.tEmissive,r),L.update(n.uEmissiveTexDim,R.create(r.width,r.height)),L.updateIfChanged(n.dEmissive,e>0),L.updateIfChanged(n.emissiveAverage,zM(r.array,e)),L.updateIfChanged(n.dEmissiveType,t),n):{tEmissive:L.create(r),uEmissiveTexDim:L.create(R.create(r.width,r.height)),dEmissive:L.create(e>0),emissiveAverage:L.create(0),tEmissiveGrid:L.create(tM()),uEmissiveGridDim:L.create(B.create(1,1,1)),uEmissiveGridTransform:L.create(AO.create(0,0,0,1)),dEmissiveType:L.create(t),uEmissiveStrength:L.create(1)}}var BM={array:new Uint8Array(1),width:1,height:1};function VM(e){return e?(L.update(e.tEmissive,BM),L.update(e.uEmissiveTexDim,R.create(1,1)),e):{tEmissive:L.create(BM),uEmissiveTexDim:L.create(R.create(1,1)),dEmissive:L.create(!1),emissiveAverage:L.create(0),tEmissiveGrid:L.create(tM()),uEmissiveGridDim:L.create(B.create(1,1,1)),uEmissiveGridTransform:L.create(AO.create(0,0,0,1)),dEmissiveType:L.create(`groupInstance`),uEmissiveStrength:L.create(1)}}var HM;(function(e){function t(e,t,n,r,o,s,c){return c?a(e,t,n,r,o,s,c):i(e,t,n,r,o,s)}e.create=t;function n(e){return t(e?e.vertexBuffer.ref.value:new Float32Array,e?e.indexBuffer.ref.value:new Uint32Array,e?e.normalBuffer.ref.value:new Float32Array,e?e.groupBuffer.ref.value:new Float32Array,0,0,e)}e.createEmpty=n;function r(e){return gE([e.vertexCount,e.triangleCount,e.vertexBuffer.ref.version,e.indexBuffer.ref.version,e.normalBuffer.ref.version,e.groupBuffer.ref.version])}function i(e,t,n,i,a,o){let s=q(),c,l=-1,u=-1,d={kind:`mesh`,vertexCount:a,triangleCount:o,vertexBuffer:L.create(e),indexBuffer:L.create(t),normalBuffer:L.create(n),groupBuffer:L.create(i),varyingGroup:L.create(!1),get boundingSphere(){let e=r(d);if(e!==l){let t=qA(d.vertexBuffer.ref.value,d.vertexCount,1);q.copy(s,t),l=e}return s},get groupMapping(){return d.groupBuffer.ref.version!==u&&(c=PA(d.groupBuffer.ref.value,d.vertexCount),u=d.groupBuffer.ref.version),c},setBoundingSphere(e){q.copy(s,e),l=r(d)},meta:{}};return d}function a(e,t,n,r,i,a,o){return o.vertexCount=i,o.triangleCount=a,L.update(o.vertexBuffer,e),L.update(o.indexBuffer,t),L.update(o.normalBuffer,n),L.update(o.groupBuffer,r),o}function o(e){let{vertexCount:t,triangleCount:n}=e,r=e.vertexBuffer.ref.value,i=e.indexBuffer.ref.value,a=e.normalBuffer.ref.value.length>=t*3?e.normalBuffer.ref.value:new Float32Array(t*3);a===e.normalBuffer.ref.value&&a.fill(0,0,t*3),NA(r,i,a,t,n),L.update(e.normalBuffer,a)}e.computeNormals=o;function s(e,t=3){let n=e.vertexBuffer.ref.value,r=new Map,i=(e,t)=>`${e[0].toFixed(t)}|${e[1].toFixed(t)}|${e[2].toFixed(t)}`,a=0,o=B();for(let s=0,c=e.vertexCount;s<c;++s){B.fromArray(o,n,s*3);let e=i(o,t),c=r.get(e);c===void 0?r.set(e,1):(a+=1,r.set(e,c+1))}return a}e.checkForDuplicateVertices=s;let c=TT();function l(e,t){let n=e.vertexBuffer.ref.value;DA(t,n,0,e.vertexCount),z.isTranslationAndUniformScaling(t)||Sxe(TT.directionTransform(c,t),e.normalBuffer.ref.value,0,e.vertexCount),L.update(e.vertexBuffer,n)}e.transform=l;function u(e){let{originalData:t}=`kind`in e?e.meta:e.meta.ref.value;return t}e.getOriginalData=u;function d(e,t=!0){let{indexBuffer:n,vertexBuffer:r,groupBuffer:i,normalBuffer:a,triangleCount:o,vertexCount:s}=e,c=n.ref.value,l=r.ref.value,u=i.ref.value,d=a.ref.value,f=_O.create(Uint32Array,3,1024,o),p=_O.create(Float32Array,3,1024,l);p.currentIndex=s*3,p.elementCount=s;let m=_O.create(Float32Array,3,1024,d);m.currentIndex=s*3,m.elementCount=s;let h=_O.create(Float32Array,1,1024,u);h.currentIndex=s,h.elementCount=s;let g=B(),_=B(),v=B(),y=B(),b=B(),x=B();function S(e){B.fromArray(g,l,e*3),B.fromArray(y,d,e*3),_O.add3(p,g[0],g[1],g[2]),_O.add3(m,y[0],y[1],y[2])}function C(e,t){B.fromArray(g,l,e*3),B.fromArray(_,l,t*3),B.scale(g,B.add(g,g,_),.5),B.fromArray(y,d,e*3),B.fromArray(b,d,t*3),B.scale(y,B.add(y,y,b),.5),_O.add3(p,g[0],g[1],g[2]),_O.add3(m,y[0],y[1],y[2])}function w(e,t,n){B.fromArray(g,l,e*3),B.fromArray(_,l,t*3),B.fromArray(v,l,n*3),B.scale(g,B.add(g,B.add(g,g,_),v),1/3),B.fromArray(y,d,e*3),B.fromArray(b,d,t*3),B.fromArray(x,d,n*3),B.scale(y,B.add(y,B.add(y,y,b),x),1/3),_O.add3(p,g[0],g[1],g[2]),_O.add3(m,y[0],y[1],y[2])}function T(e,t,n,r,i){++D,S(e),C(e,t),C(e,n),_O.add3(f,E,E+1,E+2);for(let e=0;e<3;++e)_O.add(h,r);E+=3,D+=2,S(t),S(n),C(e,t),C(e,n),_O.add3(f,E,E+1,E+3),_O.add3(f,E,E+3,E+2);for(let e=0;e<4;++e)_O.add(h,i);E+=4}let E=s,D=0;if(t)for(let e=0,t=o;e<t;++e){let t=c[e*3],n=c[e*3+1],r=c[e*3+2],i=u[t],a=u[n],o=u[r];if(i===a&&i===o)++D,_O.add3(f,t,n,r);else if(i===a)T(r,t,n,o,i);else if(i===o)T(n,r,t,a,o);else if(a===o)T(t,n,r,i,a);else{D+=2,S(t),C(t,n),C(t,r),w(t,n,r),_O.add3(f,E,E+1,E+3),_O.add3(f,E,E+3,E+2);for(let e=0;e<4;++e)_O.add(h,i);E+=4,D+=2,S(n),C(n,r),C(n,t),w(t,n,r),_O.add3(f,E,E+1,E+3),_O.add3(f,E,E+3,E+2);for(let e=0;e<4;++e)_O.add(h,a);E+=4,D+=2,S(r),C(r,n),C(r,t),w(t,n,r),_O.add3(f,E+3,E+1,E),_O.add3(f,E+2,E+3,E);for(let e=0;e<4;++e)_O.add(h,o);E+=4}}else for(let e=0,t=o;e<t;++e){let t=c[e*3],n=c[e*3+1],r=c[e*3+2],i=u[t],a=u[n],o=u[r];if(i!==a||i!==o){++D,S(t),S(n),S(r),_O.add3(f,E,E+1,E+2);let e=a===o?a:i;for(let t=0;t<3;++t)_O.add(h,e);E+=3}else ++D,_O.add3(f,t,n,r)}let O=_O.compact(f),k=_O.compact(p),A=_O.compact(m),j=_O.compact(h);return e.vertexCount=E,e.triangleCount=D,L.update(r,k),L.update(i,j),L.update(n,O),L.update(a,A),e.meta.originalData={indexBuffer:c,vertexCount:s,triangleCount:o},e}e.uniformTriangleGroup=d;function f(e){let{vertexCount:t,triangleCount:n}=e,r=e.indexBuffer.ref.value,i=[];for(let e=0;e<t;++e)i[e]=[];for(let e=0;e<n;++e){let t=r[e*3],n=r[e*3+1],a=r[e*3+2];OE(i[t],n),OE(i[t],a),OE(i[n],t),OE(i[n],a),OE(i[a],t),OE(i[a],n)}return i}function p(e){let{triangleCount:t}=e,n=e.indexBuffer.ref.value,r=new Map,i=(e,t)=>{let n=mE(e,t),i=r.get(n)||0;r.set(n,i+1)};for(let e=0;e<t;++e){let t=n[e*3],r=n[e*3+1],a=n[e*3+2];i(t,r),i(t,a),i(r,a)}return r}function m(e){let t=new Set,n=[0,0];return e.forEach((e,r)=>{e===1&&(hE(n,r),t.add(n[0]),t.add(n[1]))}),t}function h(e,t,n){let r=new Map,i=(e,t)=>{r.has(e)?OE(r.get(e),t):r.set(e,[t])};return t.forEach(r=>{let a=e[r];for(let e of a)t.has(e)&&n.get(mE(r,e))===1&&i(r,e)}),r}function g(e,t){let{indexBuffer:n,triangleCount:r}=e,i=n.ref.value,a=_O.create(Uint32Array,3,1024,r),o=0;for(let e=0;e<r;++e){let n=i[e*3],r=i[e*3+1],s=i[e*3+2];t[n].length===2||t[r].length===2||t[s].length===2||(_O.add3(a,n,r,s),o+=1)}let s=_O.compact(a);return e.triangleCount=o,L.update(n,s),e}function _(e,t,n,r){let{vertexBuffer:i,indexBuffer:a,normalBuffer:o,triangleCount:s}=e,c=i.ref.value,l=a.ref.value,u=o.ref.value,d=_O.create(Uint32Array,3,1024,s),f=0;for(let e=0;e<s;++e)_O.add3(d,l[e*3],l[e*3+1],l[e*3+2]),f+=1;let p=B(),m=B(),h=B(),g=B(),_=B(),v=B(),y=B(),b=B(),x=B(),S=B(),C=FT(120),w=new Set,T=Array.from(n.keys()).filter(e=>n.get(e).length<2).map(e=>{let t=n.get(e);return B.fromArray(p,c,e*3),B.fromArray(m,c,t[0]*3),B.fromArray(h,c,t[1]*3),B.sub(_,m,p),B.sub(v,h,p),[e,B.angle(_,v)]});T.sort(([,e],[,t])=>e-t);for(let[e,i]of T){if(w.has(e)||i>C)continue;let a=n.get(e);if(t[a[0]].includes(a[1])&&!n.get(a[0])?.includes(a[1])||(B.fromArray(p,c,e*3),B.fromArray(m,c,a[0]*3),B.fromArray(h,c,a[1]*3),B.sub(_,m,p),B.sub(v,h,p),B.add(b,_,v),B.squaredDistance(p,m)>=r))continue;let o=!1;for(let n of t[e])if(!a.includes(n)&&(B.fromArray(g,c,n*3),B.sub(y,g,p),B.dot(b,y)<0)){o=!0;break}o&&(B.fromArray(x,u,e*3),B.triangleNormal(S,p,m,h),B.dot(S,x)>0?_O.add3(d,e,a[0],a[1]):_O.add3(d,a[1],a[0],e),w.add(e),w.add(a[0]),w.add(a[1]),f+=1)}let E=_O.compact(d);return e.triangleCount=f,L.update(a,E),e}function v(e,t,n){let{iterations:r,lambda:i}=n,a=B(),o=B(),s=B(),c=B(),l=-i,u=new Float32Array(e.vertexBuffer.ref.value.length),d=n=>{let r=e.vertexBuffer.ref.value;u.set(r),t.forEach((e,t)=>{if(e.length!==2)return;B.fromArray(a,r,t*3),B.fromArray(o,r,e[0]*3),B.fromArray(s,r,e[1]*3);let i=1/B.distance(a,o),l=1/B.distance(a,s);B.scale(o,o,i),B.scale(s,s,l),B.add(c,o,s),B.scale(c,c,1/(i+l)),B.sub(c,c,a),B.scale(c,c,n),B.add(c,a,c),B.toArray(c,u,t*3)});let i=e.vertexBuffer.ref.value;L.update(e.vertexBuffer,u),u=i};for(let e=0;e<r;++e)d(i),d(l)}function y(e,t){g(e,f(e));for(let n=0;n<10;++n){let n=e.triangleCount,r=p(e),i=f(e);if(_(e,i,h(i,m(r),r),t.maxNewEdgeLength*t.maxNewEdgeLength),e.triangleCount===n)break}let n=p(e);return v(e,h(f(e),m(n),n),{iterations:t.iterations,lambda:.5}),e}e.smoothEdges=y,e.Params={...EM.Params,doubleSided:V.Boolean(!1,EM.CustomQualityParamInfo),flipSided:V.Boolean(!1,EM.ShadingCategory),flatShaded:V.Boolean(!1,EM.ShadingCategory),ignoreLight:V.Boolean(!1,EM.ShadingCategory),celShaded:V.Boolean(!1,EM.ShadingCategory),xrayShaded:V.Select(!1,[[!1,`Off`],[!0,`On`],[`inverted`,`Inverted`]],EM.ShadingCategory),transparentBackfaces:V.Select(`off`,V.arrayToOptions([`off`,`on`,`opaque`]),EM.ShadingCategory),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),bumpAmplitude:V.Numeric(1,{min:0,max:5,step:.1},EM.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:x,createValuesSimple:S,updateValues:C,updateBoundingSphere:w,createRenderableState:T,updateRenderableState:E,createPositionIterator:b};function b(e,t){let n=e.vertexCount,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=i.normal,s=e.vertexBuffer.ref.value,c=e.normalBuffer.ref.value,l=t.aTransform.ref.value;return tj(n,r,1,(e,t)=>(t<0?(B.fromArray(a,s,e*3),B.fromArray(o,c,e*3)):(B.transformMat4Offset(a,s,l,0,e*3,t*16),B.transformDirectionOffset(o,c,l,0,e*3,t*16)),i))}function x(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,s=nM(n,b(e,t),r.color),c=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),l=kM(),u=NM(),d=VM(),f=RM(),p=FM(),m={drawCount:e.triangleCount*3,vertexCount:e.vertexCount,groupCount:o,instanceCount:a},h=q.clone(e.boundingSphere),g=YA(h,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`mesh`),aPosition:e.vertexBuffer,aNormal:e.normalBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,dVaryingGroup:e.varyingGroup,boundingSphere:L.create(g),invariantBoundingSphere:L.create(h),uInvariantBoundingSphere:L.create(AO.ofSphere(h)),...s,...c,...l,...u,...d,...f,...p,...t,...EM.createValues(i,m),uDoubleSided:L.create(i.doubleSided),dFlatShaded:L.create(i.flatShaded),dFlipSided:L.create(i.flipSided),dIgnoreLight:L.create(i.ignoreLight),dCelShaded:L.create(i.celShaded),dXrayShaded:L.create(i.xrayShaded===`inverted`?`inverted`:i.xrayShaded===!0?`on`:`off`),dTransparentBackfaces:L.create(i.transparentBackfaces),uBumpFrequency:L.create(i.bumpFrequency),uBumpAmplitude:L.create(i.bumpAmplitude),meta:L.create(e.meta)}}function S(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return x(t,o.transform,o.locationIterator,o.theme,s)}function C(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uDoubleSided,t.doubleSided),L.updateIfChanged(e.dFlatShaded,t.flatShaded),L.updateIfChanged(e.dFlipSided,t.flipSided),L.updateIfChanged(e.dIgnoreLight,t.ignoreLight),L.updateIfChanged(e.dCelShaded,t.celShaded),L.updateIfChanged(e.dXrayShaded,t.xrayShaded===`inverted`?`inverted`:t.xrayShaded===!0?`on`:`off`),L.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),L.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),L.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude)}function w(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function T(e){let t=EM.createRenderableState(e);return E(t,e),t}function E(e,t){EM.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}})(HM||={});const Gwe={radius:1,detail:0};function Kwe(e,t,n){let{radius:r,detail:i}={...Gwe,...n},a=qwe(),{vertices:o,indices:s}=a;l(i),Cxe(o,r);let c=new Float32Array(o.length);return NA(o,s,c,o.length/3,s.length/3),{vertices:new Float32Array(o),normals:new Float32Array(c),indices:new Uint32Array(s)};function l(n){let r=B(),i=B(),a=B();for(let o=0;o<t.length;o+=3)B.fromArray(r,e,t[o+0]*3),B.fromArray(i,e,t[o+1]*3),B.fromArray(a,e,t[o+2]*3),u(r,i,a,n)}function u(e,t,n,r){let i=2**r,o=[];for(let r=0;r<=i;++r){o[r]=[];let a=B();B.lerp(a,e,n,r/i);let s=B();B.lerp(s,t,n,r/i);let c=i-r;for(let e=0;e<=c;++e)if(e===0&&r===i)o[r][e]=a;else{let t=B();B.lerp(t,a,s,e/c),o[r][e]=t}}for(let e=0;e<i;++e)for(let t=0;t<2*(i-e)-1;++t){let n=Math.floor(t/2);t%2==0?a.add(o[e][n+1],o[e+1][n],o[e][n]):a.add(o[e][n+1],o[e+1][n+1],o[e+1][n])}}}function qwe(){let e=[],t=[],n=new Map;function r(t){let r=`${t[0].toFixed(5)}|${t[1].toFixed(5)}|${t[2].toFixed(5)}`,i=n.get(r);return i===void 0&&(i=e.length/3,n.set(r,i),e.push(...t)),i}return{vertices:e,indices:t,add:(e,n,i)=>{t.push(r(e),r(n),r(i))}}}var UM=B(),WM=B(),GM=B();function KM(e,t){let n=t.length,r=JM(n/3);for(let i=0;i<n;i+=3)B.fromArray(UM,e,t[i]*3),B.fromArray(WM,e,t[i+1]*3),B.fromArray(GM,e,t[i+2]*3),r.add(UM,WM,GM);return r.getPrimitive()}var qM=B();function JM(e,t){t===void 0&&(t=e*3);let n=new Float32Array(t*3),r=new Float32Array(t*3),i=new Uint32Array(e*3),a=0,o=0;return{add:(e,t,s)=>{B.toArray(e,n,a),B.toArray(t,n,a+3),B.toArray(s,n,a+6),B.triangleNormal(qM,e,t,s);for(let e=0;e<3;++e)B.toArray(qM,r,a+3*e),i[o+e]=a/3+e;a+=9,o+=3},addQuad:(e,t,s,c)=>{B.toArray(e,n,a),B.toArray(t,n,a+3),B.toArray(s,n,a+6),B.toArray(c,n,a+9),B.triangleNormal(qM,e,t,s);for(let e=0;e<4;++e)B.toArray(qM,r,a+3*e);let l=a/3;i[o]=l,i[o+1]=l+1,i[o+2]=l+2,i[o+3]=l+2,i[o+4]=l+3,i[o+5]=l,a+=12,o+=6},getPrimitive:()=>({vertices:n,normals:r,indices:i})}}var YM=B(),Jwe=TT();function XM(e,t){let{vertices:n,normals:r}=e,i=TT.directionTransform(Jwe,t);for(let e=0,a=n.length;e<a;e+=3)B.transformMat4(YM,B.fromArray(YM,n,e),t),B.toArray(YM,n,e),B.transformMat3(YM,B.fromArray(YM,r,e),i),B.toArray(YM,r,e);return e}function ZM(e,t){return{vertices:e,edges:t}}function QM(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var $M=B.zero();function eN(e,t){let{vertices:n}=e;for(let e=0,r=n.length;e<r;e+=3)B.transformMat4($M,B.fromArray($M,n,e),t),B.toArray($M,n,e);return e}var tN=(1+Math.sqrt(5))/2,Ywe=[-1,tN,0,1,tN,0,-1,-tN,0,1,-tN,0,0,-1,tN,0,1,tN,0,-1,-tN,0,1,-tN,tN,0,-1,tN,0,1,-tN,0,-1,-tN,0,1],Xwe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],nN;function Zwe(){return nN||=KM(Ywe,Xwe),nN}var{vertices:Qwe,indices:$we}=Zwe();function rN(e){return 10*(2**e)**2+2}function eTe(e){return Kwe(Qwe,$we,{detail:e,radius:1})}var iN=new Map,tTe=z.identity();function nTe(e,t,n){return z.scaleUniformly(e,z.fromTranslation(e,t),n)}function aN(e){let t=iN.get(e);return t===void 0&&(t=eTe(e),iN.set(e,t)),t}function oN(e,t,n,r){YN.addPrimitive(e,nTe(tTe,t,n),aN(r))}const sN={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function rTe(e){let{radiusTop:t,radiusBottom:n,height:r,radialSegments:i,heightSegments:a,topCap:o,bottomCap:s,thetaStart:c,thetaLength:l}={...sN,...e},u=[],d=[],f=[],p=0,m=[],h=r/2;return g(),o&&t>0&&_(!0),s&&n>0&&_(!1),{vertices:new Float32Array(d),normals:new Float32Array(f),indices:new Uint32Array(u)};function g(){let e=B.zero(),o=(n-t)/r;for(let s=0;s<=a;++s){let u=[],g=s/a,_=g*(n-t)+t;for(let t=0;t<=i;++t){let n=t/i*l+c,a=Math.sin(n),s=Math.cos(n);d.push(_*a,-g*r+h,_*s),B.normalize(e,B.set(e,a,o,s)),f.push(...e),u.push(p++)}m.push(u)}for(let e=0;e<i;++e)for(let t=0;t<a;++t){let n=m[t][e],r=m[t+1][e],i=m[t+1][e+1],a=m[t][e+1];u.push(n,r,a),u.push(r,i,a)}}function _(e){let r=e===!0?t:n,a=e===!0?1:-1,o=p;for(let e=1;e<=i;++e)d.push(0,h*a,0),f.push(0,a,0),++p;let s=p;for(let e=0;e<=i;++e){let t=e/i*l+c,n=Math.cos(t),o=Math.sin(t);d.push(r*o,h*a,r*n),f.push(0,a,0),++p}for(let t=0;t<i;++t){let n=o+t,r=s+t;e===!0?u.push(r,r+1,n):u.push(r+1,r,n)}}}function cN(e,t,n=-1){let r=new Float32Array(e*3),i=n===-1?e<=4?Math.sqrt(2)/2:.6:n,a=t?1:0;for(let t=0,n=e;t<n;++t){let n=(t*2+a)/e*Math.PI;r[t*3]=Math.cos(n)*i,r[t*3+1]=Math.sin(n)*i,r[t*3+2]=0}return r}var lN=B(),uN=B(),dN=B(),fN=B(),pN=B(),mN=B();const iTe={height:1,topCap:!0,bottomCap:!0};function hN(e,t){let n=e.length/3;if(n<3)throw Error(`need at least 3 points to build a prism`);let{height:r,topCap:i,bottomCap:a}={...iTe,...t},o=n*2,s=n*4,c=(i?1:0)+(a?1:0);n===3?(o+=c,s+=c*3):n===4?(o+=c*2,s+=c*4):(o+=c*n,s+=c*n*3);let l=JM(o,s),u=r*.5;B.set(lN,0,0,-u),B.set(uN,0,0,u);for(let t=0;t<n;++t){let r=(t+1)%n;B.set(dN,e[t*3],e[t*3+1],-u),B.set(fN,e[r*3],e[r*3+1],-u),B.set(pN,e[r*3],e[r*3+1],u),B.set(mN,e[t*3],e[t*3+1],u),l.addQuad(dN,fN,pN,mN)}if(n===3)i&&(B.set(dN,e[0],e[1],-u),B.set(fN,e[3],e[4],-u),B.set(pN,e[6],e[7],-u),l.add(pN,fN,dN)),a&&(B.set(dN,e[0],e[1],u),B.set(fN,e[3],e[4],u),B.set(pN,e[6],e[7],u),l.add(dN,fN,pN));else if(n===4)i&&(B.set(dN,e[0],e[1],-u),B.set(fN,e[3],e[4],-u),B.set(pN,e[6],e[7],-u),B.set(mN,e[9],e[10],-u),l.addQuad(mN,pN,fN,dN)),a&&(B.set(dN,e[0],e[1],u),B.set(fN,e[3],e[4],u),B.set(pN,e[6],e[7],u),B.set(mN,e[9],e[10],u),l.addQuad(dN,fN,pN,mN));else for(let t=0;t<n;++t){let r=(t+1)%n;i&&(B.set(dN,e[t*3],e[t*3+1],-u),B.set(fN,e[r*3],e[r*3+1],-u),l.add(lN,fN,dN)),a&&(B.set(dN,e[t*3],e[t*3+1],u),B.set(fN,e[r*3],e[r*3+1],u),l.add(dN,fN,uN))}return l.getPrimitive()}var gN;function aTe(){return gN||=hN(cN(4,!1)),gN}var _N;function oTe(){return _N||=hN(cN(5,!1)),_N}var vN;function sTe(){return vN||=hN(cN(6,!1)),vN}var yN;function cTe(){return yN||=hN(cN(6,!0)),yN}var bN;function lTe(){return bN||=hN(cN(7,!1)),bN}var xN=new Map,SN=B.create(0,1,0),CN=B(),wN=B(),TN=B(),EN=z(),DN=z(),ON=B(),kN=B(),AN=B();function jN(e,t,n,r,i){return B.setMagnitude(wN,n,r/2),B.add(TN,t,wN),i?B.matchDirection(AN,SN,wN):B.copy(AN,SN),B.set(ON,1,r,1),B.makeRotation(DN,AN,wN),z.scale(e,DN,ON),z.setTranslation(e,TN)}var MN=new Int32Array(9);function uTe(e){return MN[0]=Math.round(1e3*(e.radiusTop??sN.radiusTop)),MN[1]=Math.round(1e3*(e.radiusBottom??sN.radiusBottom)),MN[2]=Math.round(1e3*(e.height??sN.height)),MN[3]=e.radialSegments??sN.radialSegments,MN[4]=e.heightSegments??sN.heightSegments,MN[5]=e.topCap??sN.topCap?1:0,MN[6]=e.bottomCap??sN.bottomCap?1:0,MN[7]=Math.round(1e3*(e.thetaStart??sN.thetaStart)),MN[8]=Math.round(1e3*(e.thetaLength??sN.thetaLength)),gE(MN)}function NN(e){let t=uTe(e),n=xN.get(t);return n===void 0&&(n=e.radialSegments&&e.radialSegments<=4?XM(hN(cN(Math.max(3,e.radialSegments),!0,e.radiusTop),e),z.rotX90):rTe(e),xN.set(t,n)),n}function dTe(e,t,n,r){jN(EN,t.origin,t.direction,n,!1),YN.addPrimitive(e,EN,NN(r))}function PN(e,t,n,r,i){let a=B.distance(t,n)*r;B.sub(CN,n,t),jN(EN,t,CN,a,!0),YN.addPrimitive(e,EN,NN(i))}function fTe(e,t,n,r,i,a){let o=B.distance(t,n)*r,s=NN(a);B.sub(CN,n,t),B.add(kN,t,i),jN(EN,kN,CN,o,!0),YN.addPrimitive(e,EN,s),B.sub(kN,t,i),jN(EN,kN,CN,o,!0),YN.addPrimitive(e,EN,s)}function FN(e,t,n,r,i,a,o){let s=B.distance(t,n)*r,c=i%2!=0,l=Math.floor((i+1)/2),u=s/(i+.5),d=NN(o);B.setMagnitude(CN,B.sub(CN,n,t),u),B.copy(kN,t);for(let t=0;t<l;++t)B.add(kN,kN,CN),c&&t===l-1&&(!a&&o.topCap&&(o.topCap=!1,d=NN(o)),u/=2),jN(EN,kN,CN,u,!1),YN.addPrimitive(e,EN,d),B.add(kN,kN,CN)}var IN=B(),LN=TT(),RN=B(),zN=B(),BN=B(),VN=B(),HN=B.fromArray,pTe=B.triangleNormal,UN=B.copy,WN=B.transformMat4,GN=B.transformMat3,KN=TT.directionTransform,qN=_O.add3,JN=_O.add,YN;(function(e){function t(e=2048,t=1024,n){return{currentGroup:-1,vertices:_O.create(Float32Array,3,t,n?n.vertexBuffer.ref.value:e),normals:_O.create(Float32Array,3,t,n?n.normalBuffer.ref.value:e),indices:_O.create(Uint32Array,3,t*3,n?n.indexBuffer.ref.value:e*3),groups:_O.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),mesh:n}}e.createState=t;function n(e,t,n,r){let{vertices:i,normals:a,indices:o,groups:s,currentGroup:c}=e,l=i.elementCount;qN(i,t[0],t[1],t[2]),qN(i,n[0],n[1],n[2]),qN(i,r[0],r[1],r[2]),pTe(IN,t,n,r);for(let e=0;e<3;++e)qN(a,IN[0],IN[1],IN[2]),JN(s,c);qN(o,l,l+1,l+2)}e.addTriangle=n;function r(e,t,n,r,i){let{vertices:a,normals:o,indices:s,groups:c,currentGroup:l}=e,u=a.elementCount;qN(a,t[0],t[1],t[2]),qN(a,n[0],n[1],n[2]),qN(a,r[0],r[1],r[2]);for(let e=0;e<3;++e)qN(o,i[0],i[1],i[2]),JN(c,l);qN(s,u,u+1,u+2)}e.addTriangleWithNormal=r;function i(e,t,r){HN(BN,t,r[0]*3),HN(VN,t,r[1]*3);for(let i=2,a=r.length;i<a;i+=2)UN(RN,BN),UN(zN,VN),HN(BN,t,r[i]*3),HN(VN,t,r[i+1]*3),n(e,RN,zN,BN),n(e,zN,VN,BN)}e.addTriangleStrip=i;function a(e,t,r){HN(RN,t,r[0]*3);for(let i=2,a=r.length;i<a;++i)HN(zN,t,r[i-1]*3),HN(BN,t,r[i]*3),n(e,RN,BN,zN)}e.addTriangleFan=a;function o(e,t,n,i){HN(RN,t,n[0]*3);for(let a=2,o=n.length;a<o;++a)HN(zN,t,n[a-1]*3),HN(BN,t,n[a]*3),r(e,RN,BN,zN,i)}e.addTriangleFanWithNormal=o;function s(e,t,n){let{vertices:r,normals:i,indices:a}=n,{vertices:o,normals:s,indices:c,groups:l,currentGroup:u}=e,d=o.elementCount,f=KN(LN,t);for(let e=0,n=r.length;e<n;e+=3)WN(IN,HN(IN,r,e),t),qN(o,IN[0],IN[1],IN[2]),GN(IN,HN(IN,i,e),f),qN(s,IN[0],IN[1],IN[2]),JN(l,u);for(let e=0,t=a.length;e<t;e+=3)qN(c,a[e]+d,a[e+1]+d,a[e+2]+d)}e.addPrimitive=s;function c(e,t,n){let{vertices:r,normals:i,indices:a}=n,{vertices:o,normals:s,indices:c,groups:l,currentGroup:u}=e,d=o.elementCount,f=KN(LN,t);for(let e=0,n=r.length;e<n;e+=3)WN(IN,HN(IN,r,e),t),qN(o,IN[0],IN[1],IN[2]),GN(IN,HN(IN,i,e),f),qN(s,-IN[0],-IN[1],-IN[2]),JN(l,u);for(let e=0,t=a.length;e<t;e+=3)qN(c,a[e+2]+d,a[e+1]+d,a[e]+d)}e.addPrimitiveFlipped=c;function l(e,t,n,r,i,a){let{vertices:o,edges:s}=n,c={radiusTop:r,radiusBottom:r,radialSegments:a};for(let n=0,a=s.length;n<a;n+=2)HN(RN,o,s[n]*3),HN(zN,o,s[n+1]*3),WN(RN,RN,t),WN(zN,zN,t),oN(e,RN,r,i),oN(e,zN,r,i),PN(e,RN,zN,1,c)}e.addCage=l;function u(e,t,n){s(e,t,{vertices:n.vertexBuffer.ref.value.subarray(0,n.vertexCount*3),normals:n.normalBuffer.ref.value.subarray(0,n.vertexCount*3),indices:n.indexBuffer.ref.value.subarray(0,n.triangleCount*3)})}e.addMesh=u;function d(e){let{vertices:t,normals:n,indices:r,groups:i,mesh:a}=e,o=_O.compact(t,!0),s=_O.compact(r,!0),c=_O.compact(n,!0),l=_O.compact(i,!0);return HM.create(o,s,c,l,e.vertices.elementCount,e.indices.elementCount,a)}e.getMesh=d})(YN||={});function XN(e,t,n){return e=DT(Math.round(e),0,16777215)+1,t[n+2]=e%256,e=Math.floor(e/256),t[n+1]=e%256,e=Math.floor(e/256),t[n]=e%256,t}function ZN(e,t,n){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(n)-1}var QN=255/256,$N=B.create(256*256*256,256*256,256),mTe=AO.create(QN/$N[0],QN/$N[1],QN/$N[2],QN/1),eP=AO();function hTe(e,t,n,r){return AO.set(eP,e/255,t/255,n/255,r/255),AO.dot(eP,mTe)}function gTe(e,t){let n=-1/0;for(let r=0,i=e.length;r<i;r+=t){let t=ZN(e[r],e[r+1],e[r+2]);t>n&&(n=t)}return n}function tP(e,t,n){switch(wF.getGranularity(e,t.granularity)){case`uniform`:return bTe(e,t.size,n);case`group`:return STe(e,t.size,n);case`groupInstance`:return CTe(e,t.size,n);case`instance`:return xTe(e,t.size,n)}}function nP(e){switch(e.dSizeType.ref.value){case`uniform`:return e.uSize.ref.value;case`instance`:case`group`:case`groupInstance`:let t=0,n=e.tSize.ref.value.array;for(let e=0,r=n.length;e<r;e+=3){let r=ZN(n[e],n[e+1],n[e+2]);t<r&&(t=r)}return t/100}}var _Te={array:new Uint8Array(3),width:1,height:1};function vTe(){return{tSize:L.create(_Te),uSizeTexDim:L.create(R.create(1,1))}}function yTe(e,t){return t?(L.update(t.uSize,e),L.updateIfChanged(t.dSizeType,`uniform`),t):{uSize:L.create(e),...vTe(),dSizeType:L.create(`uniform`)}}function bTe(e,t,n){return e.reset(),yTe(t(e.hasNext?e.move().location:$A),n)}function rP(e,t,n){return n?(L.update(n.tSize,e),L.update(n.uSizeTexDim,R.create(e.width,e.height)),L.updateIfChanged(n.dSizeType,t),n):{uSize:L.create(0),tSize:L.create(e),uSizeTexDim:L.create(R.create(e.width,e.height)),dSizeType:L.create(t)}}function xTe(e,t,n){let{instanceCount:r}=e,i=WA(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let n=e.move();XN(t(n.location)*100,i.array,n.instanceIndex*3),e.skipInstance()}return rP(i,`instance`,n)}function STe(e,t,n){let{groupCount:r}=e,i=WA(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let n=e.move();XN(t(n.location)*100,i.array,n.groupIndex*3)}return rP(i,`group`,n)}function CTe(e,t,n){let{groupCount:r,instanceCount:i}=e,a=i*r,o=WA(Math.max(1,a),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext;){let n=e.move();XN(t(n.location)*100,o.array,n.index*3)}return rP(o,`groupInstance`,n)}var iP;(function(e){function t(e,t,n,r){return r?a(e,t,n,r):i(e,t,n)}e.create=t;function n(e){return t(e?e.centerBuffer.ref.value:new Float32Array,e?e.groupBuffer.ref.value:new Float32Array,0,e)}e.createEmpty=n;function r(e){return gE([e.pointCount,e.centerBuffer.ref.version,e.groupBuffer.ref.version])}function i(e,t,n){let i=q(),a,o=-1,s=-1,c={kind:`points`,pointCount:n,centerBuffer:L.create(e),groupBuffer:L.create(t),get boundingSphere(){let e=r(c);if(e!==o){let t=qA(c.centerBuffer.ref.value,c.pointCount,1);q.copy(i,t),o=e}return i},get groupMapping(){return c.groupBuffer.ref.version!==s&&(a=PA(c.groupBuffer.ref.value,c.pointCount),s=c.groupBuffer.ref.version),a},setBoundingSphere(e){q.copy(i,e),o=r(c)}};return c}function a(e,t,n,r){return r.pointCount=n,L.update(r.centerBuffer,e),L.update(r.groupBuffer,t),r}function o(e,t){let n=e.centerBuffer.ref.value;DA(t,n,0,e.pointCount),L.update(e.centerBuffer,n)}e.transform=o,e.StyleTypes={square:`Square`,circle:`Circle`,fuzzy:`Fuzzy`},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params={...EM.Params,sizeFactor:V.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:V.Boolean(!1),pointStyle:V.Select(`square`,V.objectToOptions(e.StyleTypes))},e.Utils={Params:e.Params,createEmpty:n,createValues:c,createValuesSimple:l,updateValues:u,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(e,t){let n=e.pointCount,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=e.centerBuffer.ref.value,s=t.aTransform.ref.value;return tj(n,r,1,(e,t)=>(t<0?B.fromArray(a,o,e*3):B.transformMat4Offset(a,o,s,0,e*3,t*16),i))}function c(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,c=nM(n,s(e,t),r.color),l=tP(n,r.size),u=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),d=kM(),f=NM(),p=VM(),m=RM(),h=FM(),g={drawCount:e.pointCount,vertexCount:e.pointCount,groupCount:o,instanceCount:a},_=q.clone(e.boundingSphere),v=YA(_,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`points`),aPosition:e.centerBuffer,aGroup:e.groupBuffer,boundingSphere:L.create(v),invariantBoundingSphere:L.create(_),uInvariantBoundingSphere:L.create(AO.ofSphere(_)),...c,...l,...u,...d,...f,...p,...m,...h,...t,...EM.createValues(i,g),uSizeFactor:L.create(i.sizeFactor),dPointSizeAttenuation:L.create(i.pointSizeAttenuation),dPointStyle:L.create(i.pointStyle)}}function l(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return c(t,o.transform,o.locationIterator,o.theme,s)}function u(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uSizeFactor,t.sizeFactor),L.updateIfChanged(e.dPointSizeAttenuation,t.pointSizeAttenuation),L.updateIfChanged(e.dPointStyle,t.pointStyle)}function d(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function f(e){let t=EM.createRenderableState(e);return p(t,e),t}function p(e,t){EM.updateRenderableState(e,t),e.opaque=e.opaque&&t.pointStyle!==`fuzzy`,e.writeDepth=e.opaque}})(iP||={});function aP(e,t,n,r,i,a,o){for(let s=0;s<t;s++){for(let i=0;i<n;i++)r[i]=e[i*t+s];oP(r,i,a,o,n);for(let r=0;r<n;r++)e[r*t+s]=i[r]}for(let s=0;s<n;s++){for(let n=0;n<t;n++)r[n]=e[s*t+n];oP(r,i,a,o,t);for(let n=0;n<t;n++)e[s*t+n]=Math.sqrt(i[n])}}function oP(e,t,n,r,i){n[0]=0,r[0]=-(2**53-1),r[1]=2**53-1;for(let t=1,a=0;t<i;t++){let i=(e[t]+t*t-(e[n[a]]+n[a]*n[a]))/(2*t-2*n[a]);for(;i<=r[a];)a--,i=(e[t]+t*t-(e[n[a]]+n[a]*n[a]))/(2*t-2*n[a]);a++,n[a]=t,r[a]=i,r[a+1]=2**53-1}for(let a=0,o=0;a<i;a++){for(;r[o+1]<a;)o++;t[a]=(a-n[o])*(a-n[o])+e[n[o]]}}var sP={};function wTe(e){let t=JSON.stringify(e);return sP[t]===void 0&&(sP[t]=new TTe(e)),sP[t]}const cP={fontFamily:V.Select(`sans-serif`,[[`sans-serif`,`Sans Serif`],[`monospace`,`Monospace`],[`serif`,`Serif`],[`cursive`,`Cursive`]]),fontQuality:V.Select(3,[[0,`lower`],[1,`low`],[2,`medium`],[3,`high`],[4,`higher`]]),fontStyle:V.Select(`normal`,[[`normal`,`Normal`],[`italic`,`Italic`],[`oblique`,`Oblique`]]),fontVariant:V.Select(`normal`,[[`normal`,`Normal`],[`small-caps`,`Small Caps`]]),fontWeight:V.Select(`normal`,[[`normal`,`Normal`],[`bold`,`Bold`]])};var TTe=class{constructor(e={}){this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;let t={...V.getDefaultValues(cP),...e};this.props=t;let n=32*(t.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=WA(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=DTe(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${n}px ${t.fontFamily}`,this.scratchContext.fillStyle=`black`,this.scratchContext.textBaseline=`middle`,this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(``)}get(e){if(this.mapped[e]===void 0){this.draw(e);let{array:t,width:n,height:r}=this.texture,i=this.scratchData;if(this.currentX+this.scratchW>n&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>r)return console.warn(`canvas to small`),this.placeholder;this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let e=0;e<this.scratchH;++e)for(let r=0;r<this.scratchW;++r)t[n*(this.currentY+e)+this.currentX+r]=i[e*this.scratchW+r];this.currentX+=this.scratchW}return this.mapped[e]}draw(e){let t=this.lineHeight,n=this.scratchContext,r=this.scratchData,i=n.measureText(e),a=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),o=a*t;n.clearRect(0,0,a,t),n.fillText(e,this.buffer,this.middle);let s=n.getImageData(0,0,a,t);for(let e=0;e<o;e++){let t=s.data[e*4+3]/255;this.gridOuter[e]=t===1?0:t===0?2**53-1:Math.max(0,.5-t)**2,this.gridInner[e]=t===1?2**53-1:t===0?0:Math.max(0,t-.5)**2}aP(this.gridOuter,a,t,this.f,this.d,this.v,this.z),aP(this.gridInner,a,t,this.f,this.d,this.v,this.z);for(let e=0;e<o;e++){let t=this.gridOuter[e]-this.gridInner[e];r[e]=Math.max(0,Math.min(255,Math.round(255-255*(t/this.radius+this.cutoff))))}this.scratchW=a,this.scratchH=t}},lP;function ETe(){if(!lP)throw Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.");return lP}function DTe(e,t,n){if(_b)return ETe().createCanvas(e,t).getContext(`2d`,n);{let r=document.createElement(`canvas`);return r.width=e,r.height=t,r.getContext(`2d`,n)}}var uP;(function(e){function t(e,t,n,r,o,s,c,l,u){return u?a(e,t,n,r,o,s,c,l,u):i(e,t,n,r,o,s,c,l)}e.create=t;function n(e){return t(e?e.fontTexture.ref.value:WA(0,1,Uint8Array),e?e.centerBuffer.ref.value:new Float32Array,e?e.mappingBuffer.ref.value:new Float32Array,e?e.depthBuffer.ref.value:new Float32Array,e?e.indexBuffer.ref.value:new Uint32Array,e?e.groupBuffer.ref.value:new Float32Array,e?e.tcoordBuffer.ref.value:new Float32Array,0,e)}e.createEmpty=n;function r(e){return gE([e.charCount,e.fontTexture.ref.version,e.centerBuffer.ref.version,e.mappingBuffer.ref.version,e.depthBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.tcoordBuffer.ref.version])}function i(e,t,n,i,a,o,s,c){let l=q(),u,d=-1,f=-1,p={kind:`text`,charCount:c,fontTexture:L.create(e),centerBuffer:L.create(t),mappingBuffer:L.create(n),depthBuffer:L.create(i),indexBuffer:L.create(a),groupBuffer:L.create(o),tcoordBuffer:L.create(s),get boundingSphere(){let e=r(p);if(e!==d){let t=qA(p.centerBuffer.ref.value,p.charCount*4,4);q.copy(l,t),d=e}return l},get groupMapping(){return p.groupBuffer.ref.version!==f&&(u=PA(p.groupBuffer.ref.value,p.charCount,4),f=p.groupBuffer.ref.version),u},setBoundingSphere(e){q.copy(l,e),d=r(p)}};return p}function a(e,t,n,r,i,a,o,s,c){return c.charCount=s,L.update(c.fontTexture,e),L.update(c.centerBuffer,t),L.update(c.mappingBuffer,n),L.update(c.depthBuffer,r),L.update(c.indexBuffer,i),L.update(c.groupBuffer,a),L.update(c.tcoordBuffer,o),c}e.Params={...EM.Params,...cP,sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),borderWidth:V.Numeric(0,{min:0,max:.5,step:.01}),borderColor:V.Color(gk.grey),offsetX:V.Numeric(0,{min:0,max:10,step:.1}),offsetY:V.Numeric(0,{min:0,max:10,step:.1}),offsetZ:V.Numeric(0,{min:0,max:10,step:.1}),background:V.Boolean(!1),backgroundMargin:V.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:V.Color(gk.grey),backgroundOpacity:V.Numeric(1,{min:0,max:1,step:.01}),tether:V.Boolean(!1),tetherLength:V.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:V.Numeric(.3,{min:0,max:1,step:.01}),attachment:V.Select(`middle-center`,[[`bottom-left`,`bottom-left`],[`bottom-center`,`bottom-center`],[`bottom-right`,`bottom-right`],[`middle-left`,`middle-left`],[`middle-center`,`middle-center`],[`middle-right`,`middle-right`],[`top-left`,`top-left`],[`top-center`,`top-center`],[`top-right`,`top-right`]])},e.Utils={Params:e.Params,createEmpty:n,createValues:s,createValuesSimple:c,updateValues:l,updateBoundingSphere:u,createRenderableState:d,updateRenderableState:f,createPositionIterator:o};function o(e,t){let n=e.charCount*4,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=e.centerBuffer.ref.value,s=t.aTransform.ref.value;return tj(n,r,4,(e,t)=>(t<0?B.fromArray(a,o,e*3):B.transformMat4Offset(a,o,s,0,e*3,t*16),i))}function s(e,t,n,r,i){let{instanceCount:a,groupCount:s}=n,c=nM(n,o(e,t),r.color),l=tP(n,r.size),u=i.instanceGranularity?QA(a,`instance`):QA(a*s,`groupInstance`),d=kM(),f=NM(),p=VM(),m=RM(),h=FM(),g={drawCount:e.charCount*2*3,vertexCount:e.charCount*4,groupCount:s,instanceCount:a},_=nP(l)*i.sizeFactor,v=dP(e.mappingBuffer.ref.value,e.depthBuffer.ref.value,e.charCount,_),y=q.expand(q(),e.boundingSphere,v),b=YA(y,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`text`),aPosition:e.centerBuffer,aMapping:e.mappingBuffer,aDepth:e.depthBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,boundingSphere:L.create(b),invariantBoundingSphere:L.create(y),uInvariantBoundingSphere:L.create(AO.ofSphere(y)),...c,...l,...u,...d,...f,...p,...m,...h,...t,aTexCoord:e.tcoordBuffer,tFont:e.fontTexture,padding:L.create(v),...EM.createValues(i,g),uSizeFactor:L.create(i.sizeFactor),uBorderWidth:L.create(DT(i.borderWidth,0,.5)),uBorderColor:L.create(tE.toArrayNormalized(i.borderColor,B.zero(),0)),uOffsetX:L.create(i.offsetX),uOffsetY:L.create(i.offsetY),uOffsetZ:L.create(i.offsetZ),uBackgroundColor:L.create(tE.toArrayNormalized(i.backgroundColor,B.zero(),0)),uBackgroundOpacity:L.create(i.backgroundOpacity)}}function c(t,n,r,i,a){let o=EM.createSimple(r,i,a),c={...V.getDefaultValues(e.Params),...n};return s(t,o.transform,o.locationIterator,o.theme,c)}function l(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uSizeFactor,t.sizeFactor),L.updateIfChanged(e.uBorderWidth,t.borderWidth),tE.fromNormalizedArray(e.uBorderColor.ref.value,0)!==t.borderColor&&(tE.toArrayNormalized(t.borderColor,e.uBorderColor.ref.value,0),L.update(e.uBorderColor,e.uBorderColor.ref.value)),L.updateIfChanged(e.uOffsetX,t.offsetX),L.updateIfChanged(e.uOffsetY,t.offsetY),L.updateIfChanged(e.uOffsetZ,t.offsetZ),tE.fromNormalizedArray(e.uBackgroundColor.ref.value,0)!==t.backgroundColor&&(tE.toArrayNormalized(t.backgroundColor,e.uBackgroundColor.ref.value,0),L.update(e.uBackgroundColor,e.uBackgroundColor.ref.value)),L.updateIfChanged(e.uBackgroundOpacity,t.backgroundOpacity)}function u(e,t){let n=nP(e)*e.uSizeFactor.ref.value,r=dP(e.aMapping.ref.value,e.aDepth.ref.value,t.charCount,n),i=q.expand(q(),t.boundingSphere,r),a=YA(i,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(a,e.boundingSphere.ref.value)||L.update(e.boundingSphere,a),q.equals(i,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,i),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,i))),L.update(e.padding,r)}function d(e){let t=EM.createRenderableState(e);return f(t,e),t}function f(e,t){EM.updateRenderableState(e,t),e.pickable=!1,e.opaque=!1,e.writeDepth=!0}})(uP||={});function dP(e,t,n,r){let i=0,a=0;for(let r=0,o=n*4;r<o;++r){let n=2*r,o=Math.abs(e[n]);o>i&&(i=o);let s=Math.abs(e[n+1]);s>i&&(i=s);let c=Math.abs(t[r]);c>a&&(a=c)}return Math.max(a,r*i)}var fP=B(),pP=B(),mP=B(),hP=_O.add,gP=_O.add3,_P;(function(e){function t(e=2048,t=1024,n){let r=_O.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),i=_O.create(Float32Array,3,t,n?n.startBuffer.ref.value:e),a=_O.create(Float32Array,3,t,n?n.endBuffer.ref.value:e),o=(e,t,n,o,s,c,l)=>{for(let u=0;u<4;++u)gP(i,e,t,n),gP(a,o,s,c),hP(r,l)},s=(e,t,n)=>{for(let o=0;o<4;++o)gP(i,e[0],e[1],e[2]),gP(a,t[0],t[1],t[2]),hP(r,n)},c=(e,t,n,r)=>{let i=B.distance(e,t),a=n%2!=0,s=Math.floor((n+1)/2),c=i/(n+.5);B.setMagnitude(mP,B.sub(mP,t,e),c),B.copy(fP,e);for(let e=0;e<s;++e)B.add(fP,fP,mP),a&&e===s-1?B.copy(pP,t):B.add(pP,fP,mP),o(fP[0],fP[1],fP[2],pP[0],pP[1],pP[2],r),B.add(fP,fP,mP)};return{add:o,addVec:s,addFixedCountDashes:c,addFixedLengthDashes:(e,t,n,r)=>{c(e,t,B.distance(e,t)/n,r)},addCage:(e,t,n)=>{let{vertices:r,edges:i}=t;for(let t=0,a=i.length;t<a;t+=2)B.fromArray(fP,r,i[t]*3),B.fromArray(pP,r,i[t+1]*3),B.transformMat4(fP,fP,e),B.transformMat4(pP,pP,e),o(fP[0],fP[1],fP[2],pP[0],pP[1],pP[2],n)},getLines:()=>{let e=r.elementCount/4,t=_O.compact(r,!0),o=_O.compact(i,!0),s=_O.compact(a,!0),c=n&&e<=n.lineCount?n.mappingBuffer.ref.value:new Float32Array(e*8),l=n&&e<=n.lineCount?n.indexBuffer.ref.value:new Uint32Array(e*6);return(!n||e>n.lineCount)&&OTe(e,c,l),vP.create(c,l,t,o,s,e,n)}}}e.create=t})(_P||={});function OTe(e,t,n){for(let n=0;n<e;++n){let e=n*8;t[e]=-1,t[e+1]=-1,t[e+2]=1,t[e+3]=-1,t[e+4]=-1,t[e+5]=1,t[e+6]=1,t[e+7]=1}for(let t=0;t<e;++t){let e=t*4,r=t*6;n[r]=e,n[r+1]=e+1,n[r+2]=e+2,n[r+3]=e+1,n[r+4]=e+3,n[r+5]=e+2}}var vP;(function(e){function t(e,t,n,r,i,s,c){return c?o(e,t,n,r,i,s,c):a(e,t,n,r,i,s)}e.create=t;function n(e){return t(e?e.mappingBuffer.ref.value:new Float32Array,e?e.indexBuffer.ref.value:new Uint32Array,e?e.groupBuffer.ref.value:new Float32Array,e?e.startBuffer.ref.value:new Float32Array,e?e.endBuffer.ref.value:new Float32Array,0,e)}e.createEmpty=n;function r(e,t){let n=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value,i=e.groupBuffer.ref.value,a=_P.create(e.triangleCount*3,e.triangleCount/10,t);for(let t=0,o=e.triangleCount*3;t<o;t+=3){let e=r[t],o=r[t+1],s=r[t+2],c=n[e*3],l=n[e*3+1],u=n[e*3+2],d=n[o*3],f=n[o*3+1],p=n[o*3+2],m=n[s*3],h=n[s*3+1],g=n[s*3+2];a.add(c,l,u,d,f,p,i[e]),a.add(c,l,u,m,h,g,i[e]),a.add(d,f,p,m,h,g,i[o])}return a.getLines()}e.fromMesh=r;function i(e){return gE([e.lineCount,e.mappingBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.startBuffer.ref.version,e.endBuffer.ref.version])}function a(e,t,n,r,a,o){let s=q(),c,l=-1,u=-1,d={kind:`lines`,lineCount:o,mappingBuffer:L.create(e),indexBuffer:L.create(t),groupBuffer:L.create(n),startBuffer:L.create(r),endBuffer:L.create(a),get boundingSphere(){let e=i(d);if(e!==l){let t=qA(d.startBuffer.ref.value,d.lineCount*4,4),n=qA(d.endBuffer.ref.value,d.lineCount*4,4);q.expandBySphere(s,t,n),l=e}return s},get groupMapping(){return d.groupBuffer.ref.version!==u&&(c=PA(d.groupBuffer.ref.value,d.lineCount,4),u=d.groupBuffer.ref.version),c},setBoundingSphere(e){q.copy(s,e),l=i(d)}};return d}function o(e,t,n,r,i,a,o){return a>o.lineCount&&(L.update(o.mappingBuffer,e),L.update(o.indexBuffer,t)),o.lineCount=a,L.update(o.groupBuffer,n),L.update(o.startBuffer,r),L.update(o.endBuffer,i),o}function s(e,t){let n=e.startBuffer.ref.value;DA(t,n,0,e.lineCount*4),L.update(e.startBuffer,n);let r=e.endBuffer.ref.value;DA(t,r,0,e.lineCount*4),L.update(e.endBuffer,r)}e.transform=s,e.Params={...EM.Params,sizeFactor:V.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:V.Boolean(!1)},e.Utils={Params:e.Params,createEmpty:n,createValues:l,createValuesSimple:u,updateValues:d,updateBoundingSphere:f,createRenderableState:EM.createRenderableState,updateRenderableState:EM.updateRenderableState,createPositionIterator:c};function c(e,t){let n=e.lineCount*4,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=e.startBuffer.ref.value,s=e.endBuffer.ref.value,c=t.aTransform.ref.value;return tj(n,r,2,(e,t)=>{let n=e%4==0?o:s;return t<0?B.fromArray(a,n,e*3):B.transformMat4Offset(a,n,c,0,e*3,t*16),i})}function l(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,s=nM(n,c(e,t),r.color),l=tP(n,r.size),u=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),d=kM(),f=NM(),p=VM(),m=RM(),h=FM(),g={drawCount:e.lineCount*2*3,vertexCount:e.lineCount*4,groupCount:o,instanceCount:a},_=q.clone(e.boundingSphere),v=YA(_,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`lines`),aMapping:e.mappingBuffer,aGroup:e.groupBuffer,aStart:e.startBuffer,aEnd:e.endBuffer,elements:e.indexBuffer,boundingSphere:L.create(v),invariantBoundingSphere:L.create(_),uInvariantBoundingSphere:L.create(AO.ofSphere(_)),...s,...l,...u,...d,...f,...p,...m,...h,...t,...EM.createValues(i,g),uSizeFactor:L.create(i.sizeFactor),dLineSizeAttenuation:L.create(i.lineSizeAttenuation),uDoubleSided:L.create(!0),dFlipSided:L.create(!1)}}function u(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return l(t,o.transform,o.locationIterator,o.theme,s)}function d(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uSizeFactor,t.sizeFactor),L.updateIfChanged(e.dLineSizeAttenuation,t.lineSizeAttenuation)}function f(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}})(vP||={});var yP=B(),bP=B(),xP=B(),SP=B(),CP=cN(4,!0);function wP(e){let t=JM(12,e?36:24);for(let n=0;n<4;++n){let r=(n+1)%4;B.set(yP,CP[n*3],CP[n*3+1],-.5),B.set(bP,CP[r*3],CP[r*3+1],-.5),B.set(xP,CP[r*3],CP[r*3+1],.5),B.set(SP,CP[n*3],CP[n*3+1],.5),e?t.add(yP,bP,xP):t.addQuad(yP,bP,xP,SP)}return B.set(yP,CP[0],CP[1],-.5),B.set(bP,CP[3],CP[4],-.5),B.set(xP,CP[6],CP[7],-.5),B.set(SP,CP[9],CP[10],-.5),e?t.add(xP,bP,yP):t.addQuad(SP,xP,bP,yP),B.set(yP,CP[0],CP[1],.5),B.set(bP,CP[3],CP[4],.5),B.set(xP,CP[6],CP[7],.5),B.set(SP,CP[9],CP[10],.5),e?t.add(yP,bP,xP):t.addQuad(yP,bP,xP,SP),t.getPrimitive()}var TP;function EP(){return TP||=wP(!1),TP}var DP;function kTe(){return DP||=wP(!0),DP}var OP;function kP(){return OP||=ZM([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4]),OP}function AP(e){return e.map(e=>({x:e[0],alpha:e[1]}))}function jP(e,t){let n=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],r=t?t.ref.value.array:new Uint8Array(256),i=0,a,o,s,c,l,u,d=e.length+1;for(let e=0;e<d;++e){a=n[e+1].x,o=n[e+2].x,s=n[e].alpha,c=n[e+1].alpha,l=n[e+2].alpha,u=n[e+3].alpha;let t=Math.round((o-a)*256);for(let e=0;e<t;++e){let n=e/t;r[i]=Math.max(0,kT(s,c,l,u,n,.5)*255),++i}}let f={array:r,width:256,height:1};return t?(L.update(t,f),t):L.create(f)}function ATe(e,t,n){if(n)return MP(e,t,n.min,n.max);{let[n,r]=SE(e);return MP(e,t,n,r)}}function MP(e,t,n,r){let i=(r-n)/t;i===0&&(i=1);let a=new Int32Array(t);for(let r=0,o=e.length;r<o;r++){let o=Math.floor((e[r]-n)/i);o>=t?o=t-1:o<0&&(o=0),a[o]++}return{min:n,max:r,binWidth:i,counts:a}}var NP;(function(e){e.One={transform:{kind:`matrix`,matrix:z.identity()},cells:BD.create(BD.Space([1,1,1],[0,1,2]),BD.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};let t=z(),n=z();function r(e){if(e.transform.kind===`matrix`)return z.copy(z(),e.transform.matrix);if(e.transform.kind===`spacegroup`){let{cells:{space:r}}=e,i=z.fromScaling(t,B.div(B(),$k.size(B(),e.transform.fractionalBox),B.ofArray(r.dimensions))),a=z.fromTranslation(n,e.transform.fractionalBox.min);return z.mul3(z(),e.transform.cell.fromFractional,a,i)}return z.identity()}e.getGridToCartesianTransform=r;function i(e,t){return e===t}e.areEquivalent=i;function a(e){return e.cells.data.length===0}e.isEmpty=a;function o(t,n){n||=q();let r=t.cells.space.dimensions,i=e.getGridToCartesianTransform(t);return q.fromDimensionsAndTransform(n,r,i)}e.getBoundingSphere=o;function s(e,t){let n=e._historams;return n||=e._historams={},n[t]||(n[t]=ATe(e.cells.data,t,{min:e.stats.min,max:e.stats.max})),n[t]}e.getHistogram=s;function c(t,n){let r=e.getGridToCartesianTransform(t);z.invert(r,r);let i=B(),{stats:a}=t,{dimensions:o,get:s}=t.cells.space,c=t.cells.data,[l,u,d]=o;return function(e){B.copy(i,e),B.transformMat4(i,i,r);let t=Math.trunc(i[0]),o=Math.trunc(i[1]),f=Math.trunc(i[2]);if(t<0||t>=l||o<0||o>=u||f<0||f>=d)return NaN;let p=i[0]-t,m=i[1]-o,h=i[2]-f,g=Math.min(t+1,l-1),_=Math.min(o+1,u-1),v=Math.min(f+1,d-1),y=s(c,t,o,f),b=s(c,g,o,f),x=s(c,t,_,f),S=s(c,g,_,f),C=OT(OT(y,b,p),OT(x,S,p),m);y=s(c,t,o,v),b=s(c,g,o,v),x=s(c,t,_,v),S=s(c,g,_,v);let w=OT(C,OT(OT(y,b,p),OT(x,S,p),m),h);return n===`relative`?(w-a.mean)/a.sigma:w}}e.makeGetTrilinearlyInterpolated=c})(NP||={});function PP(e){return e}(function(e){function t(e){return e.__key||=zy.create22(),e.__key}e.getUUID=t})(PP||={});var FP=class{constructor(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}get all(){return this._list}add(e){this._set.has(e)||(this._list.push(e),this._set.add(e))}reference(e,t){let n=this._refs.get(e)||0;n+=t?1:-1,this._refs.set(e,Math.max(n,0))}hasReference(e){return(this._refs.get(e)||0)>0}has(e){return this._set.has(e)}assets(e,t){let n=this._assets.get(e);if(n)for(let e of n)e.dispose();t?this._assets.set(e,t):this._assets.delete(e)}dispose(){this._assets.forEach(e=>{for(let t of e)t.dispose()})}};function jTe(e,t){return hb.create(`Create Volume`,async()=>{let{header:n,values:r}=e,i=BD.Space(n.dim,[0,1,2],Float64Array),a;if(n.dataSetIds.length===0)a=r;else{let[e,i,o]=n.dim,s=(t?.dataIndex||0)+1,c=0,l=0;a=new Float64Array(e*i*o);for(let t=0;t<e;t++)for(let e=0;e<i;e++)for(let e=0;e<o;e++)a[c++]=r[l],l+=s}let o=BD.create(i,BD.Data1(a)),s=z.fromTranslation(z(),n.origin),c=z.fromBasis(z(),n.basisX,n.basisY,n.basisZ);return z.mul(s,s,c),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:`matrix`,matrix:s},cells:o,stats:{min:xE(a),max:bE(a),mean:CE(a),sigma:wE(a)}},instances:[{transform:z.identity()}],sourceData:IP.create(e),customProperties:new FP,_propertyData:Object.create(null)}})}var IP;(function(e){function t(e){return e?.kind===`cube`}e.is=t;function n(e){return{kind:`cube`,name:e.name,data:e}}e.create=n})(IP||={});function LP(e,t){return hb.create(`Create Volume`,async n=>{let{volume_data_3d_info:r,volume_data_3d:i}=e,a=oA.create(r.spacegroup_number.value(0)||`P 1`,B.ofArray(r.spacegroup_cell_size.value(0)),B.scale(B.zero(),B.ofArray(r.spacegroup_cell_angles.value(0)),Math.PI/180)),o=r.axis_order.value(0),s=BD.convertToCanonicalAxisIndicesFastToSlow(o),c=s(r.sample_count.value(0)),l=BD.Space(c,BD.invertAxisOrder(o),Float32Array),u=BD.create(l,BD.Data1(i.values.toArray({array:Float32Array}))),d=B.ofArray(s(r.origin.value(0))),f=B.ofArray(s(r.dimensions.value(0)));return{label:t?.label,entryId:t?.entryId,periodicity:B.isInteger(f)?`xyz`:`none`,grid:{transform:{kind:`spacegroup`,cell:a,fractionalBox:$k.create(d,B.add(B.zero(),d,f))},cells:u,stats:{min:r.min_sampled.value(0),max:r.max_sampled.value(0),mean:r.mean_sampled.value(0),sigma:r.sigma_sampled.value(0)}},instances:[{transform:z.identity()}],sourceData:RP.create(e),customProperties:new FP,_propertyData:Object.create(null)}})}var RP;(function(e){function t(e){return e?.kind===`dscif`}e.is=t;function n(e){return{kind:`dscif`,name:e._name,data:e}}e.create=n})(RP||={});var zP;(function(e){function t(e){return e?.grid?.cells?.space?.dimensions?.length&&e?.sourceData&&e?.customProperties&&e?._propertyData}e.is=t;let n;(function(e){function t(e,t,n){return wT(o(e,n).absoluteValue,o(t,n).absoluteValue,n.sigma/100)}e.areSame=t;function n(e){return{kind:`absolute`,absoluteValue:e}}e.absolute=n;function r(e){return{kind:`relative`,relativeValue:e}}e.relative=r;function i(e,t){return t*e.sigma+e.mean}e.calcAbsolute=i;function a(e,t){return e.sigma===0?0:(t-e.mean)/e.sigma}e.calcRelative=a;function o(t,n){return t.kind===`absolute`?t:{kind:`absolute`,absoluteValue:e.calcAbsolute(n,t.relativeValue)}}e.toAbsolute=o;function s(t,n){return t.kind===`relative`?t:{kind:`relative`,relativeValue:e.calcRelative(n,t.absoluteValue)}}e.toRelative=s;function c(e){return e.kind===`relative`?`${e.relativeValue.toFixed(2)} `:`${e.absoluteValue.toPrecision(4)}`}e.toString=c})(n=e.IsoValue||={});function r(t,r,i){if(i===`relative`)return n.relative(r);let a=n.absolute(r);if(RP.is(t.sourceData)){let n={min:t.sourceData.data.volume_data_3d_info.min_source.value(0),max:t.sourceData.data.volume_data_3d_info.max_source.value(0),mean:t.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:t.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(a,n)}return a}e.adjustedIsoValue=r;let i={min:-1,max:1,mean:0,sigma:.1};function a(t,n){let r=n||i,{min:a,max:o,mean:s,sigma:c}=r,l=(a-s)/c,u=(o-s)/c,d=t;return t.kind===`absolute`?t.absoluteValue<a?d=e.IsoValue.absolute(a):t.absoluteValue>o&&(d=e.IsoValue.absolute(o)):t.relativeValue<l?d=e.IsoValue.relative(l):t.relativeValue>u&&(d=e.IsoValue.relative(u)),V.Conditioned(d,{absolute:V.Converted(t=>e.IsoValue.toAbsolute(t,NP.One.stats).absoluteValue,t=>e.IsoValue.absolute(t),V.Numeric(s,{min:a,max:o,step:bO(c/100,2)},{immediateUpdate:!0})),relative:V.Converted(t=>e.IsoValue.toRelative(t,NP.One.stats).relativeValue,t=>e.IsoValue.relative(t),V.Numeric(Math.min(1,u),{min:l,max:u,step:bO(Math.round((o-a)/c)/100,2)},{immediateUpdate:!0}))},e=>e.kind===`absolute`?`absolute`:`relative`,(t,n)=>n===`absolute`?e.IsoValue.toAbsolute(t,r):e.IsoValue.toRelative(t,r),{isEssential:!0})}e.createIsoValueParam=a,e.IsoValueParam=a(e.IsoValue.relative(2)),e.One={label:``,grid:NP.One,instances:[],sourceData:{kind:``,name:``,data:{}},customProperties:new FP,_propertyData:Object.create(null)};function o(e,t){return NP.areEquivalent(e.grid,t.grid)&&s(e,t)}e.areEquivalent=o;function s(e,t){if(e.instances.length!==t.instances.length)return!1;for(let n=0,r=e.instances.length;n<r;++n)if(!z.areEqual(e.instances[n].transform,t.instances[n].transform,1e-6))return!1;return!0}e.areInstanceTransformsEqual=s;function c(e){return NP.isEmpty(e.grid)||e.instances.length===0}e.isEmpty=c;function l(e){return IP.is(e.sourceData)?e.sourceData.data.header.orbitals:!1}e.isOrbitals=l;function u(e,t){return{kind:`volume-loci`,volume:e,instances:t}}e.Loci=u;function d(e){return!!e&&e.kind===`volume-loci`}e.isLoci=d;function f(e,t){return e.volume===t.volume&&K.areEqual(e.instances,t.instances)}e.areLociEqual=f;function p(e){return c(e.volume)||K.isEmpty(e.instances)}e.isLociEmpty=p;function m(e,t){return NP.getBoundingSphere(e.grid,t)}e.getBoundingSphere=m,(function(t){function n(e,t,n){return{kind:`isosurface-loci`,volume:e,isoValue:t,instances:n}}t.Loci=n;function r(e){return!!e&&e.kind===`isosurface-loci`}t.isLoci=r;function i(t,n){return t.volume===n.volume&&e.IsoValue.areSame(t.isoValue,n.isoValue,t.volume.grid.stats)&&K.areEqual(t.instances,n.instances)}t.areLociEqual=i;function a(e){return c(e.volume)||K.isEmpty(e.instances)}t.isLociEmpty=a;let o=$k();function s(t,n,r){let i=e.IsoValue.toAbsolute(n,t.grid.stats).absoluteValue,a=i<0,s=[0,0,0],c=t.grid.cells.space.getCoords,l=t.grid.cells.data,[u,d,f]=t.grid.cells.space.dimensions,p=u-1,m=d-1,h=f-1,g=0,_=0,v=0;for(let e=0,t=l.length;e<t;++e)(a&&l[e]<=i||!a&&l[e]>=i)&&(c(e,s),s[0]<p&&(p=s[0]),s[1]<m&&(m=s[1]),s[2]<h&&(h=s[2]),s[0]>g&&(g=s[0]),s[1]>_&&(_=s[1]),s[2]>v&&(v=s[2]));B.set(o.min,p-1,m-1,h-1),B.set(o.max,g+1,_+1,v+1);let y=NP.getGridToCartesianTransform(t.grid);return $k.transform(o,o,y),q.fromBox3D(r||q(),o)}t.getBoundingSphere=s})(e.Isosurface||={}),(function(e){function t(e,t){return{kind:`cell-loci`,volume:e,elements:t}}e.Loci=t;function n(e){return!!e&&e.kind===`cell-loci`}e.isLoci=n;function r(e,t){if(e.volume!==t.volume||e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n){let r=e.elements[n],i=t.elements[n];if(!K.areEqual(r.instances,i.instances)||!K.areEqual(r.indices,i.indices))return!1}return!0}e.areLociEqual=r;function i(e){for(let{indices:t,instances:n}of e.elements)if(!K.isEmpty(n)||!K.isEmpty(t))return!1;return!0}e.isLociEmpty=i;function a(e){let t=0;for(let{indices:n,instances:r}of e.elements)t+=K.size(n)*K.size(r);return t}e.getLociSize=a;function o(e,t,n){return{kind:`cell-location`,volume:e,cell:t,instance:n}}e.Location=o;function s(e){return!!e&&e.kind===`cell-location`}e.isLocation=s;let c=new RA(`98`),l=B(),u=B();function d(e,t,n){c.reset();let r=NP.getGridToCartesianTransform(e.grid),{getCoords:i}=e.grid.cells.space;for(let{indices:n,instances:a}of t)for(let t=0,o=K.size(n);t<o;t++){i(K.getAt(n,t),l),B.transformMat4(l,l,r);for(let t=0,n=K.size(a);t<n;t++){let n=e.instances[K.getAt(a,t)];B.transformMat4(u,l,n.transform),c.includePosition(u)}}c.finishedIncludeStep();for(let{indices:n,instances:a}of t)for(let t=0,o=K.size(n);t<o;t++){i(K.getAt(n,t),l),B.transformMat4(l,l,r);for(let t=0,n=K.size(a);t<n;t++){let n=e.instances[K.getAt(a,t)];B.transformMat4(u,l,n.transform),c.radiusPosition(u)}}let a=c.getSphere(n);return q.expand(a,a,z.getMaxScaleOnAxis(r)*10)}e.getBoundingSphere=d})(e.Cell||={}),(function(t){function n(e,t){return{kind:`segment-loci`,volume:e,elements:t}}t.Loci=n;function r(e){return!!e&&e.kind===`segment-loci`}t.isLoci=r;function i(e,t){if(e.volume!==t.volume||e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n){let r=e.elements[n],i=t.elements[n];if(!K.areEqual(r.instances,i.instances)||!K.areEqual(r.segments,i.segments))return!1}return!0}t.areLociEqual=i;function a(e){for(let{segments:t,instances:n}of e.elements)if(!K.isEmpty(n)||!K.isEmpty(t))return!1;return!0}t.isLociEmpty=a;function o(e){let t=0;for(let{segments:n,instances:r}of e.elements)t+=K.size(n)*K.size(r);return t}t.getLociSize=o;let s=$k(),c=$k(),l=$k();function u(t,n,r){let i=e.Segmentation.get(t);if(i){$k.setEmpty(s);let e=NP.getGridToCartesianTransform(t.grid);for(let{segments:r,instances:a}of n){$k.setEmpty(c);for(let e=0,t=K.size(r);e<t;e++){let t=K.getAt(r,e),n=i.bounds[t];$k.add(c,n.min),$k.add(c,n.max)}$k.transform(c,c,e);for(let e=0,n=K.size(a);e<n;e++){let n=t.instances[K.getAt(a,e)];$k.transform(l,c,n.transform),$k.addBox3D(s,l)}}return q.fromBox3D(r||q(),s)}else return e.getBoundingSphere(t,r)}t.getBoundingSphere=u;function d(e,t,n){return{kind:`segment-location`,volume:e,segment:t,instance:n}}t.Location=d;function f(e){return!!e&&e.kind===`segment-location`}t.isLocation=f})(e.Segment||={}),e.PickingGranularity={set(e,t){e._propertyData.__picking_granularity__=t},get(e){return e._propertyData.__picking_granularity__??`voxel`}},e.Segmentation={set(e,t){e._propertyData.__segmentation__=t},get(e){return e._propertyData.__segmentation__}}})(zP||={});var BP=EP(),VP;(function(e){function t(e,t,n,a,o,s,c,l,u,d,f){return f?i(e,t,n,a,o,s,c,l,u,d,f):r(e,t,n,a,o,s,c,l,u,d)}e.create=t;function n(e){return gE([e.bboxSize.ref.version,e.gridDimension.ref.version,e.gridTexture.ref.version,e.transform.ref.version,e.gridStats.ref.version])}function r(e,t,r,i,a,o,s,c,l,u){let d=q(),f=-1,p=o.getWidth(),m=o.getHeight(),h=o.getDepth(),g={kind:`direct-volume`,gridDimension:L.create(t),gridTexture:L.create(o),gridTextureDim:L.create(B.create(p,m,h)),gridStats:L.create(AO.create(s.min,s.max,s.mean,s.sigma)),bboxMin:L.create(e.min),bboxMax:L.create(e.max),bboxSize:L.create(B.sub(B(),e.max,e.min)),transform:L.create(r),cellDim:L.create(a),unitToCartn:L.create(i),cartnToUnit:L.create(z.invert(z(),i)),get boundingSphere(){let e=n(g);if(e!==f){let t=MTe(g.gridDimension.ref.value,g.transform.ref.value);q.copy(d,t),f=e}return d},packedGroup:L.create(c),axisOrder:L.create(l),dataType:L.create(u),setBoundingSphere(e){q.copy(d,e),f=n(g)},meta:{}};return g}function i(e,t,n,r,i,a,o,s,c,l,u){let d=a.getWidth(),f=a.getHeight(),p=a.getDepth();return L.update(u.gridDimension,t),L.update(u.gridTexture,a),L.update(u.gridTextureDim,B.set(u.gridTextureDim.ref.value,d,f,p)),L.update(u.gridStats,AO.set(u.gridStats.ref.value,o.min,o.max,o.mean,o.sigma)),L.update(u.bboxMin,e.min),L.update(u.bboxMax,e.max),L.update(u.bboxSize,B.sub(u.bboxSize.ref.value,e.max,e.min)),L.update(u.transform,n),L.update(u.cellDim,i),L.update(u.unitToCartn,r),L.update(u.cartnToUnit,z.invert(z(),r)),L.updateIfChanged(u.packedGroup,s),L.updateIfChanged(u.axisOrder,B.fromArray(u.axisOrder.ref.value,c,0)),L.updateIfChanged(u.dataType,l),u}function a(e){let n=$k(),r=B(),i=z.identity(),a=z.identity(),o=B(),s=tM(),c=NP.One.stats;return t(n,r,i,a,o,s,c,!1,B.create(0,1,2),`byte`,e)}e.createEmpty=a,e.Params={...EM.Params,ignoreLight:V.Boolean(!1,EM.ShadingCategory),celShaded:V.Boolean(!1,EM.ShadingCategory),xrayShaded:V.Select(!1,[[!1,`Off`],[!0,`On`],[`inverted`,`Inverted`]],EM.ShadingCategory),controlPoints:V.LineGraph([R.create(.19,0),R.create(.2,.05),R.create(.25,.05),R.create(.26,0),R.create(.79,0),R.create(.8,.05),R.create(.85,.05),R.create(.86,0)],{isEssential:!0}),stepsPerCell:V.Numeric(3,{min:1,max:10,step:1}),jumpLength:V.Numeric(0,{min:0,max:20,step:.1})},e.Utils={Params:e.Params,createEmpty:a,createValues:u,createValuesSimple:d,updateValues:f,updateBoundingSphere:p,createRenderableState:m,updateRenderableState:h,createPositionIterator:o};function o(e,t){let n=e.transform.ref.value,[r,i,a]=e.gridDimension.ref.value,o=r*i*a,s=t.instanceCount.ref.value,c=rj(),l=c.position,u=t.aTransform.ref.value;return tj(o,s,1,(e,t)=>{let r=Math.floor(e/a);return l[0]=Math.floor(r/i),l[1]=r%i,l[2]=e%a,B.transformMat4(l,l,n),t>=0&&B.transformMat4Offset(l,l,u,0,0,t*16),c})}function s(e,t){return Math.ceil(B.magnitude(e)*t)}function c(e,t){return Math.min(...e)*(1/t)}function l(e){return 1/e}function u(e,t,n,r,i){let{gridTexture:a,gridTextureDim:u,gridStats:d}=e,{bboxSize:f,bboxMin:p,bboxMax:m,gridDimension:h,transform:g}=e,{instanceCount:_,groupCount:v}=n,y=nM(n,o(e,t),r.color),b=i.instanceGranularity?QA(_,`instance`):QA(_*v,`groupInstance`),x=kM(),S=NM(),C=VM(),w=RM(),T=FM(),[E,D,O]=h.ref.value,k={drawCount:BP.indices.length,vertexCount:E*D*O,groupCount:v,instanceCount:_},A=q.clone(e.boundingSphere),j=YA(A,t.aTransform.ref.value,_,0),M=jP(AP(i.controlPoints));return{dGeometryType:L.create(`directVolume`),...y,...b,...x,...S,...C,...w,...T,...t,...EM.createValues(i,k),aPosition:L.create(BP.vertices),elements:L.create(BP.indices),boundingSphere:L.create(j),invariantBoundingSphere:L.create(A),uInvariantBoundingSphere:L.create(AO.ofSphere(A)),uBboxMin:p,uBboxMax:m,uBboxSize:f,uMaxSteps:L.create(s(h.ref.value,i.stepsPerCell)),uStepScale:L.create(c(e.cellDim.ref.value,i.stepsPerCell)),uJumpLength:L.create(i.jumpLength),uTransform:g,uGridDim:h,tTransferTex:M,uTransferScale:L.create(l(i.stepsPerCell)),dGridTexType:L.create(a.ref.value.getDepth()>0?`3d`:`2d`),uGridTexDim:u,tGridTex:a,uGridStats:d,uCellDim:e.cellDim,uCartnToUnit:e.cartnToUnit,uUnitToCartn:e.unitToCartn,dPackedGroup:e.packedGroup,dAxisOrder:L.create(e.axisOrder.ref.value.join(``)),dIgnoreLight:L.create(i.ignoreLight),dCelShaded:L.create(i.celShaded),dXrayShaded:L.create(i.xrayShaded===`inverted`?`inverted`:i.xrayShaded===!0?`on`:`off`),meta:L.create(e.meta)}}function d(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return u(t,o.transform,o.locationIterator,o.theme,s)}function f(e,t){EM.updateValues(e,t),L.updateIfChanged(e.dIgnoreLight,t.ignoreLight),L.updateIfChanged(e.dCelShaded,t.celShaded),L.updateIfChanged(e.dXrayShaded,t.xrayShaded===`inverted`?`inverted`:t.xrayShaded===!0?`on`:`off`),jP(AP(t.controlPoints),e.tTransferTex),L.updateIfChanged(e.uMaxSteps,s(e.uGridDim.ref.value,t.stepsPerCell)),L.updateIfChanged(e.uStepScale,c(e.uCellDim.ref.value,t.stepsPerCell)),L.updateIfChanged(e.uTransferScale,l(t.stepsPerCell)),L.updateIfChanged(e.uJumpLength,t.jumpLength)}function p(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function m(e){let t=EM.createRenderableState(e);return t.opaque=!1,t.writeDepth=!1,t}function h(e,t){EM.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!1}})(VP||={});function MTe(e,t){return q.fromDimensionsAndTransform(q(),e,t)}var HP;(function(e){function t(e,t,n,r){return r?a(e,t,n,r):i(e,t,n)}e.create=t;function n(e){return t(e?e.centerBuffer.ref.value:new Float32Array,e?e.groupBuffer.ref.value:new Float32Array,0,e)}e.createEmpty=n;function r(e){return gE([e.sphereCount,e.centerBuffer.ref.version,e.groupBuffer.ref.version])}function i(e,t,n){let i=q(),a,s=-1,u=-1,f=L.create(WA(1,4,Float32Array)),p=L.create(R.create(0,0)),m=L.create([]),h=L.create(0),g={kind:`spheres`,sphereCount:n,centerBuffer:L.create(e),groupBuffer:L.create(t),get boundingSphere(){let e=r(g);if(e!==s){let t=qA(g.centerBuffer.ref.value,g.sphereCount,1);q.copy(i,t),s=e}return i},get groupMapping(){return g.groupBuffer.ref.version!==u&&(a=PA(g.groupBuffer.ref.value,g.sphereCount),u=g.groupBuffer.ref.version),a},setBoundingSphere(e){q.copy(i,e),s=r(g)},shaderData:{positionGroup:f,texDim:p,lodLevels:m,sizeFactor:h,update(e){let t=e?.lodLevels??l(m.ref.value),n=e?.sizeFactor??h.ref.value,r=d(t,n),i=WA(g.sphereCount,4,Float32Array,f.ref.value.array),a=o(i,g.centerBuffer.ref.value,g.groupBuffer.ref.value,g.sphereCount,r),s=a?c(t,n,a,g.sphereCount):[];L.update(f,i),L.update(p,R.set(p.ref.value,i.width,i.height)),L.update(m,s),L.update(h,n)}}};return g.shaderData.update(),g}function a(e,t,n,r){return r.sphereCount=n,L.update(r.centerBuffer,e),L.update(r.groupBuffer,t),r.shaderData.update(),r}function o(e,t,n,r,i){let{array:a}=e;if(i.length===0){for(let e=0;e<r;++e)a[e*4+0]=t[e*3+0],a[e*4+1]=t[e*3+1],a[e*4+2]=t[e*3+2],a[e*4+3]=n[e];return}let o=[0],s=0;for(let e=0,c=i.length;e<c;++e){let c=i[e];for(let o=0;o<r;++o){let r=!1;for(let t=0;t<e;++t)if(o%i[t]===0){r=!0;break}!r&&o%c===0&&(a[s*4+0]=t[o*3+0],a[s*4+1]=t[o*3+1],a[s*4+2]=t[o*3+2],a[s*4+3]=n[o],s+=1)}o.push(s*6)}return o}function s(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n].maxDistance!==t[n].maxDistance||e[n].minDistance!==t[n].minDistance||e[n].overlap!==t[n].overlap||e[n].stride!==t[n].stride||e[n].scaleBias!==t[n].scaleBias)return!1;return!0}function c(e,t,n,r){return e.map((e,i)=>{let a=u(e,t);return[e.minDistance,e.maxDistance,e.overlap,n[n.length-1-i],Math.min(r,a)**(1/e.scaleBias),e.stride,e.scaleBias]})}function l(e){return e.map(e=>({minDistance:e[0],maxDistance:e[1],overlap:e[2],stride:e[5],scaleBias:e[6]}))}function u(e,t){return Math.max(1,Math.round(e.stride/t**+e.scaleBias))}function d(e,t){return e.map(e=>u(e,t)).reverse()}e.Params={...EM.Params,sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),doubleSided:V.Boolean(!1,EM.CustomQualityParamInfo),ignoreLight:V.Boolean(!1,EM.ShadingCategory),celShaded:V.Boolean(!1,EM.ShadingCategory),xrayShaded:V.Select(!1,[[!1,`Off`],[!0,`On`],[`inverted`,`Inverted`]],EM.ShadingCategory),transparentBackfaces:V.Select(`off`,V.arrayToOptions([`off`,`on`,`opaque`]),EM.ShadingCategory),solidInterior:V.Boolean(!0,EM.ShadingCategory),clipPrimitive:V.Boolean(!1,{...EM.ShadingCategory,description:`Clip whole sphere instead of cutting it.`}),approximate:V.Boolean(!1,{...EM.ShadingCategory,description:`Faster rendering, but has artifacts.`}),alphaThickness:V.Numeric(0,{min:0,max:20,step:1},{...EM.ShadingCategory,description:`If not zero, adjusts alpha for radius.`}),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),bumpAmplitude:V.Numeric(1,{min:0,max:5,step:.1},EM.ShadingCategory),lodLevels:V.ObjectList({minDistance:V.Numeric(0),maxDistance:V.Numeric(0),overlap:V.Numeric(0),stride:V.Numeric(0),scaleBias:V.Numeric(3,{min:.1,max:10,step:.1})},e=>`${e.stride}`,{...EM.CullingLodCategory,defaultValue:[]})},e.Utils={Params:e.Params,createEmpty:n,createValues:p,createValuesSimple:m,updateValues:h,updateBoundingSphere:g,createRenderableState:_,updateRenderableState:v,createPositionIterator:f};function f(e,t){let n=e.sphereCount,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=e.centerBuffer.ref.value,s=t.aTransform.ref.value;return tj(n,r,1,(e,t)=>(t<0?B.fromArray(a,o,e*3):B.transformMat4Offset(a,o,s,0,e*3,t*16),i))}function p(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,s=nM(n,f(e,t),r.color),c=tP(n,r.size),l=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),u=kM(),d=NM(),p=VM(),m=RM(),h=FM(),g={drawCount:e.sphereCount*2*3,vertexCount:e.sphereCount*6,groupCount:o,instanceCount:a},_=e.boundingSphere.radius?nP(c)*i.sizeFactor:0,v=q.expand(q(),e.boundingSphere,_),y=YA(v,t.aTransform.ref.value,a,0);return e.shaderData.update({lodLevels:i.lodLevels,sizeFactor:i.sizeFactor}),{dGeometryType:L.create(`spheres`),uTexDim:e.shaderData.texDim,tPositionGroup:e.shaderData.positionGroup,boundingSphere:L.create(y),invariantBoundingSphere:L.create(v),uInvariantBoundingSphere:L.create(AO.ofSphere(v)),...s,...c,...l,...u,...d,...p,...m,...h,...t,padding:L.create(_),...EM.createValues(i,g),uSizeFactor:e.shaderData.sizeFactor,uDoubleSided:L.create(i.doubleSided),dIgnoreLight:L.create(i.ignoreLight),dCelShaded:L.create(i.celShaded),dXrayShaded:L.create(i.xrayShaded===`inverted`?`inverted`:i.xrayShaded===!0?`on`:`off`),dTransparentBackfaces:L.create(i.transparentBackfaces),dSolidInterior:L.create(i.solidInterior),dClipPrimitive:L.create(i.clipPrimitive),dApproximate:L.create(i.approximate),uAlphaThickness:L.create(i.alphaThickness),uBumpFrequency:L.create(i.bumpFrequency),uBumpAmplitude:L.create(i.bumpAmplitude),lodLevels:e.shaderData.lodLevels,centerBuffer:e.centerBuffer,groupBuffer:e.groupBuffer}}function m(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return p(t,o.transform,o.locationIterator,o.theme,s)}function h(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uSizeFactor,t.sizeFactor),L.updateIfChanged(e.uDoubleSided,t.doubleSided),L.updateIfChanged(e.dIgnoreLight,t.ignoreLight),L.updateIfChanged(e.dCelShaded,t.celShaded),L.updateIfChanged(e.dXrayShaded,t.xrayShaded===`inverted`?`inverted`:t.xrayShaded===!0?`on`:`off`),L.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),L.updateIfChanged(e.dSolidInterior,t.solidInterior),L.updateIfChanged(e.dClipPrimitive,t.clipPrimitive),L.updateIfChanged(e.dApproximate,t.approximate),L.updateIfChanged(e.uAlphaThickness,t.alphaThickness),L.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),L.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude);let n=l(e.lodLevels.ref.value);if(!s(t.lodLevels,n)){let n=e.uVertexCount.ref.value/6,r=d(t.lodLevels,t.sizeFactor),i=o(e.tPositionGroup.ref.value,e.centerBuffer.ref.value,e.groupBuffer.ref.value,n,r),a=i?c(t.lodLevels,t.sizeFactor,i,n):[];L.update(e.tPositionGroup,e.tPositionGroup.ref.value),L.update(e.lodLevels,a)}}function g(e,t){let n=t.boundingSphere.radius?nP(e)*e.uSizeFactor.ref.value:0,r=q.expand(q(),t.boundingSphere,n),i=YA(r,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(i,e.boundingSphere.ref.value)||L.update(e.boundingSphere,i),q.equals(r,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,r),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,r))),L.update(e.padding,n)}function _(e){let t=EM.createRenderableState(e);return v(t,e),t}function v(e,t){EM.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}})(HP||={});var UP;(function(e){class t{constructor(){this.index=0,this.textures=[]}get(){return this.textures[this.index]}set(e,t,n){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:e,group:t,normal:n}),this.index=(this.index+1)%2}destroy(){for(let e of this.textures)e.vertex.destroy(),e.group.destroy(),e.normal.destroy()}}e.DoubleBuffer=t;function n(e,n,r,i,a,o,s){let c=r.getWidth(),l=r.getHeight();return s?(s.vertexCount=e,s.groupCount=n,L.update(s.geoTextureDim,R.set(s.geoTextureDim.ref.value,c,l)),L.update(s.vertexTexture,r),L.update(s.groupTexture,i),L.update(s.normalTexture,a),s.doubleBuffer.set(r,i,a),q.copy(s.boundingSphere,o),s):{kind:`texture-mesh`,vertexCount:e,groupCount:n,geoTextureDim:L.create(R.create(c,l)),vertexTexture:L.create(r),groupTexture:L.create(i),normalTexture:L.create(a),varyingGroup:L.create(!1),doubleBuffer:new t,boundingSphere:q.clone(o),meta:{}}}e.create=n;function r(e){return n(0,0,e?e.vertexTexture.ref.value:tM(),e?e.groupTexture.ref.value:tM(),e?e.normalTexture.ref.value:tM(),e?e.boundingSphere:q(),e)}e.createEmpty=r,e.Params={...EM.Params,doubleSided:V.Boolean(!1,EM.CustomQualityParamInfo),flipSided:V.Boolean(!1,EM.ShadingCategory),flatShaded:V.Boolean(!1,EM.ShadingCategory),ignoreLight:V.Boolean(!1,EM.ShadingCategory),celShaded:V.Boolean(!1,EM.ShadingCategory),xrayShaded:V.Select(!1,[[!1,`Off`],[!0,`On`],[`inverted`,`Inverted`]],EM.ShadingCategory),transparentBackfaces:V.Select(`off`,V.arrayToOptions([`off`,`on`,`opaque`]),EM.ShadingCategory),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),bumpAmplitude:V.Numeric(1,{min:0,max:5,step:.1},EM.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:r,createValues:o,createValuesSimple:s,updateValues:c,updateBoundingSphere:l,createRenderableState:u,updateRenderableState:d,createPositionIterator:a};let i=`texture-mesh`;function a(e,t){let n=e.meta.webgl;if(!n)return tj(1,1,1,()=>$A);n.namedFramebuffers[i]||(n.namedFramebuffers[i]=n.resources.framebuffer());let r=n.namedFramebuffers[i],[a,o]=e.geoTextureDim.ref.value,s,c=()=>{if(!s){let t=new Float32Array(a*o*4);r.bind(),e.vertexTexture.ref.value.attachFramebuffer(r,0),n.readPixels(0,0,a,o,t);let i=new Float32Array(a*o*4);r.bind(),e.normalTexture.ref.value.attachFramebuffer(r,0),n.readPixels(0,0,a,o,i),s={vertices:t,normals:i}}return s},l=e.vertexCount,u=t.instanceCount.ref.value,d=rj(),f=d.position,p=d.normal,m=t.aTransform.ref.value;return tj(l,u,1,(e,t)=>{let{vertices:n,normals:r}=c();return t<0?(B.fromArray(f,n,e*4),B.fromArray(p,r,e*4)):(B.transformMat4Offset(f,n,m,0,e*4,t*16),B.transformDirectionOffset(p,r,m,0,e*4,t*16)),d})}function o(t,n,r,i,a){let{instanceCount:o,groupCount:s}=r,c=nM(r,e.Utils.createPositionIterator(t,n),i.color),l=a.instanceGranularity?QA(o,`instance`):QA(o*s,`groupInstance`),u=kM(),d=NM(),f=VM(),p=RM(),m=FM(),h={drawCount:t.vertexCount,vertexCount:t.vertexCount,groupCount:s,instanceCount:o},g=q.clone(t.boundingSphere),_=YA(g,n.aTransform.ref.value,o,0);return{dGeometryType:L.create(`textureMesh`),uGeoTexDim:t.geoTextureDim,tPosition:t.vertexTexture,tGroup:t.groupTexture,tNormal:t.normalTexture,dVaryingGroup:t.varyingGroup,boundingSphere:L.create(_),invariantBoundingSphere:L.create(g),uInvariantBoundingSphere:L.create(AO.ofSphere(g)),...c,...l,...u,...d,...f,...p,...m,...n,...EM.createValues(a,h),uDoubleSided:L.create(a.doubleSided),dFlatShaded:L.create(a.flatShaded),dFlipSided:L.create(a.flipSided),dIgnoreLight:L.create(a.ignoreLight),dCelShaded:L.create(a.celShaded),dXrayShaded:L.create(a.xrayShaded===`inverted`?`inverted`:a.xrayShaded===!0?`on`:`off`),dTransparentBackfaces:L.create(a.transparentBackfaces),uBumpFrequency:L.create(a.bumpFrequency),uBumpAmplitude:L.create(a.bumpAmplitude),meta:L.create(t.meta)}}function s(t,n,r,i,a){let s=EM.createSimple(r,i,a),c={...V.getDefaultValues(e.Params),...n};return o(t,s.transform,s.locationIterator,s.theme,c)}function c(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uDoubleSided,t.doubleSided),L.updateIfChanged(e.dFlatShaded,t.flatShaded),L.updateIfChanged(e.dFlipSided,t.flipSided),L.updateIfChanged(e.dIgnoreLight,t.ignoreLight),L.updateIfChanged(e.dCelShaded,t.celShaded),L.updateIfChanged(e.dXrayShaded,t.xrayShaded===`inverted`?`inverted`:t.xrayShaded===!0?`on`:`off`),L.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),L.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),L.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude)}function l(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function u(e){let t=EM.createRenderableState(e);return d(t,e),t}function d(e,t){EM.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}})(UP||={});function NTe(e,t){let n={},r={},i={},a={},o={},s={},c={};return Object.keys(e).forEach(l=>{let u=e[l];u.type===`attribute`&&(n[l]=t[l]),u.type===`define`&&(r[l]=t[l]),u.type===`texture`&&t[l]!==void 0&&(u.variant===`material`?a[l]=t[l]:i[l]=t[l]),u.type===`uniform`&&t[l]!==void 0&&(u.variant===`material`?s[l]=t[l]:u.variant===`buffered`?c[l]=t[l]:o[l]=t[l])}),{attributeValues:n,defineValues:r,textureValues:i,materialTextureValues:a,uniformValues:o,materialUniformValues:s,bufferedUniformValues:c}}function PTe(e){let t={};return Object.keys(e).forEach(n=>{t[n]=e[n].ref.version}),t}function WP(e,t,n){return{type:`attribute`,kind:e,itemSize:t,divisor:n}}function J(e,t){return{type:`uniform`,kind:e,variant:t}}function GP(e,t,n,r,i){return{type:`texture`,kind:e,format:t,dataType:n,filter:r,variant:i}}function KP(e){return{type:`elements`,kind:e}}function qP(e,t){return{type:`define`,kind:e,options:t}}function JP(e){return{type:`value`,kind:e}}const YP={uDrawId:J(`i`),uModel:J(`m4`),uView:J(`m4`),uInvView:J(`m4`),uModelView:J(`m4`),uInvModelView:J(`m4`),uProjection:J(`m4`),uInvProjection:J(`m4`),uModelViewProjection:J(`m4`),uInvModelViewProjection:J(`m4`),uHasHeadRotation:J(`b`),uInvHeadRotation:J(`m4`),uIsAsymmetricProjection:J(`b`),uHasEyeCamera:J(`b`),uModelViewEye:J(`m4`),uInvModelViewEye:J(`m4`),uIsOrtho:J(`f`),uPixelRatio:J(`f`),uViewport:J(`v4`),uViewOffset:J(`v2`),uModelScale:J(`f`),uDrawingBufferSize:J(`v2`),uCameraPosition:J(`v3`),uCameraDir:J(`v3`),uCameraPlane:J(`v4`),uNear:J(`f`),uFar:J(`f`),uFog:J(`b`),uFogNear:J(`f`),uFogFar:J(`f`),uFogColor:J(`v3`),uTransparentBackground:J(`b`),uLightDirection:J(`v3[]`),uLightColor:J(`v3[]`),uAmbientColor:J(`v3`),uPickingAlphaThreshold:J(`f`),uInteriorDarkening:J(`f`),uInteriorColorFlag:J(`b`),uInteriorColor:J(`v3`),uHighlightColor:J(`v3`),uSelectColor:J(`v3`),uDimColor:J(`v3`),uHighlightStrength:J(`f`),uSelectStrength:J(`f`),uDimStrength:J(`f`),uMarkerPriority:J(`i`),uMarkerAverage:J(`f`),uXrayEdgeFalloff:J(`f`),uCelSteps:J(`f`),uExposure:J(`f`),uRenderMask:J(`i`),uMarkingDepthTest:J(`b`),uMarkingType:J(`i`),uPickType:J(`i`)},XP={tDepth:GP(`texture`,`depth`,`ushort`,`nearest`),tDpoitDepth:GP(`texture`,`rg`,`float`,`nearest`),tDpoitFrontColor:GP(`texture`,`rgba`,`float`,`nearest`),tDpoitBackColor:GP(`texture`,`rgba`,`float`,`nearest`)},ZP={dLightCount:qP(`number`),dColorMarker:qP(`boolean`)},QP={uObjectId:J(`i`)},FTe={uColor:J(`v3`,`material`),uColorTexDim:J(`v2`),uColorGridDim:J(`v3`),uColorGridTransform:J(`v4`),uPaletteDomain:J(`v2`),uPaletteDefault:J(`v3`),tColor:GP(`image-uint8`,`rgb`,`ubyte`,`nearest`),tPalette:GP(`image-uint8`,`rgb`,`ubyte`,`nearest`),tColorGrid:GP(`texture`,`rgb`,`ubyte`,`linear`),dColorType:qP(`string`,[`uniform`,`attribute`,`instance`,`group`,`groupInstance`,`vertex`,`vertexInstance`,`volume`,`volumeInstance`,`direct`]),dUsePalette:qP(`boolean`)},$P={uSize:J(`f`,`material`),uSizeTexDim:J(`v2`),tSize:GP(`image-uint8`,`rgb`,`ubyte`,`nearest`),dSizeType:qP(`string`,[`uniform`,`attribute`,`instance`,`group`,`groupInstance`]),uSizeFactor:J(`f`,`material`)},ITe={uMarker:J(`f`),uMarkerTexDim:J(`v2`),tMarker:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),markerAverage:JP(`number`),markerStatus:JP(`number`),dMarkerType:qP(`string`,[`instance`,`groupInstance`])},LTe={uOverpaintTexDim:J(`v2`),tOverpaint:GP(`image-uint8`,`rgba`,`ubyte`,`nearest`),dOverpaint:qP(`boolean`),uOverpaintGridDim:J(`v3`),uOverpaintGridTransform:J(`v4`),tOverpaintGrid:GP(`texture`,`rgba`,`ubyte`,`linear`),dOverpaintType:qP(`string`,[`instance`,`groupInstance`,`volumeInstance`]),uOverpaintStrength:J(`f`,`material`)},RTe={uTransparencyTexDim:J(`v2`),tTransparency:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),dTransparency:qP(`boolean`),transparencyAverage:JP(`number`),transparencyMin:JP(`number`),uTransparencyGridDim:J(`v3`),uTransparencyGridTransform:J(`v4`),tTransparencyGrid:GP(`texture`,`alpha`,`ubyte`,`linear`),dTransparencyType:qP(`string`,[`instance`,`groupInstance`,`volumeInstance`]),uTransparencyStrength:J(`f`,`material`)},zTe={uEmissiveTexDim:J(`v2`),tEmissive:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),dEmissive:qP(`boolean`),emissiveAverage:JP(`number`),uEmissiveGridDim:J(`v3`),uEmissiveGridTransform:J(`v4`),tEmissiveGrid:GP(`texture`,`alpha`,`ubyte`,`linear`),dEmissiveType:qP(`string`,[`instance`,`groupInstance`,`volumeInstance`]),uEmissiveStrength:J(`f`,`material`)},BTe={uSubstanceTexDim:J(`v2`),tSubstance:GP(`image-uint8`,`rgba`,`ubyte`,`nearest`),dSubstance:qP(`boolean`),uSubstanceGridDim:J(`v3`),uSubstanceGridTransform:J(`v4`),tSubstanceGrid:GP(`texture`,`rgba`,`ubyte`,`linear`),dSubstanceType:qP(`string`,[`instance`,`groupInstance`,`volumeInstance`]),uSubstanceStrength:J(`f`,`material`)},VTe={uClippingTexDim:J(`v2`),tClipping:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),dClipping:qP(`boolean`),dClippingType:qP(`string`,[`instance`,`groupInstance`])},eF={dGeometryType:qP(`string`,[`cylinders`,`directVolume`,`image`,`lines`,`mesh`,`points`,`spheres`,`text`,`textureMesh`]),...FTe,...ITe,...LTe,...RTe,...zTe,...BTe,...VTe,dClipObjectCount:qP(`number`),dClipVariant:qP(`string`,[`instance`,`pixel`]),uClipObjectType:J(`i[]`,`material`),uClipObjectInvert:J(`b[]`,`material`),uClipObjectPosition:J(`v3[]`,`material`),uClipObjectRotation:J(`v4[]`,`material`),uClipObjectScale:J(`v3[]`,`material`),uClipObjectTransform:J(`m4[]`,`material`),aInstance:WP(`float32`,1,1),aTransform:WP(`float32`,16,1),uAlpha:J(`f`,`material`),uMetalness:J(`f`,`material`),uRoughness:J(`f`,`material`),uBumpiness:J(`f`,`material`),uEmissive:J(`f`,`material`),uDensity:J(`f`,`material`),uVertexCount:J(`i`),uInstanceCount:J(`i`),uGroupCount:J(`i`),uInvariantBoundingSphere:J(`v4`),uLod:J(`v4`),drawCount:JP(`number`),instanceCount:JP(`number`),alpha:JP(`number`),matrix:JP(`m4`),transform:JP(`float32`),extraTransform:JP(`float32`),hasReflection:JP(`boolean`),instanceGranularity:JP(`boolean`),boundingSphere:JP(`sphere`),invariantBoundingSphere:JP(`sphere`),instanceGrid:JP(`instanceGrid`)},tF=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var HTe=3e7,UTe=mb();function WTe(e,t){let{gl:n}=e;switch(t){case`points`:return n.POINTS;case`lines`:return n.LINES;case`line-strip`:return n.LINE_STRIP;case`line-loop`:return n.LINE_LOOP;case`triangles`:return n.TRIANGLES;case`triangle-strip`:return n.TRIANGLE_STRIP;case`triangle-fan`:return n.TRIANGLE_FAN}}const GTe=Object.keys({color:``,pick:``,depth:``,marking:``,emissive:``,tracing:``}),KTe=Object.keys({compute:``});function nF(e,t,n,r,i){return n={...n,dRenderVariant:L.create(t)},i.dRenderVariant===void 0&&Object.defineProperty(i,`dRenderVariant`,{value:qP(`string`)}),e.resources.program(n,r,i)}function qTe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function JTe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function rF(e,t){if(e===`color`)switch(t){case`blended`:return`colorBlended`;case`wboit`:return`colorWboit`;case`dpoit`:return`colorDpoit`}return e}function iF(e,t,n,r,i,a,o){return oF(e,t,n,r,i,a,GTe,o)}function aF(e,t,n,r,i,a=-1){return oF(e,t,n,r,i,a,KTe,void 0)}function oF(e,t,n,r,i,a,o,s){let c=UTe(),{stats:l,state:u,resources:d}=e,{instancedArrays:f,vertexArrayObject:p,multiDrawInstancedBaseVertexBaseInstance:m,drawInstancedBaseVertexBaseInstance:h}=e.extensions;if(o=o.filter(t=>t===`tracing`?!!e.extensions.drawBuffers:!0),i.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs){let e=i.uVertexCount.ref.value;i.aVertex=L.create(TE(new Float32Array(e))),r.aVertex=WP(`float32`,1,0)}let{attributeValues:g,defineValues:_,textureValues:v,materialTextureValues:y,uniformValues:b,materialUniformValues:x,bufferedUniformValues:S}=NTe(r,i),C=Object.entries(b),w=Object.entries(x),T=Object.entries(S),E=Object.entries(TSe(S)),D=Object.entries(_),O=PTe(i),k=WTe(e,t),A={};for(let t of o)A[t]=nF(e,rF(t,s),_,n,r);let j=Qj(e,r,v),M=Qj(e,r,y),N=jSe(e,r,g),ee=[];for(let e=0,t=N.length;e<t;++e){let t=N[e];t[1].divisor===1&&ee.push(t)}let te,P=i.elements;P&&P.ref.value&&(te=d.elements(P.ref.value));let ne={};for(let e of o)ne[e]=p?d.vertexArray(A[e],N,te):null;let re=i.drawCount.ref.value,ie=i.instanceCount.ref.value;l.drawCount+=re,l.instanceCount+=ie,l.instancedDrawCount+=ie*re;let ae=qTe(),oe=!1,se=-1;return{id:c,materialId:a,getByteCount(){let e=0;for(let t=0,n=N.length;t<n;++t)e+=N[t][1].getByteCount();te&&(e+=te.getByteCount());for(let t=0,n=j.length;t<n;++t)e+=j[t][1].getByteCount();for(let t=0,n=M.length;t<n;++t)e+=M[t][1].getByteCount();return e},getProgram:e=>A[e],setTransparency:t=>{if(t!==s){s=t;for(let t of o)A[t].destroy(),A[t]=nF(e,rF(t,s),_,n,r)}},render:(t,n,r)=>{if(re===0||ie===0)return;let i=A[t];if(i.id===se&&u.currentRenderItemId===c)i.setUniforms(C),i.bindTextures(j,n);else{let e=ne[t];(i.id!==u.currentProgramId||i.id!==se||a===-1||a!==u.currentMaterialId)&&(i.id!==u.currentProgramId&&i.use(),i.setUniforms(w),i.bindTextures(M,n+j.length),u.currentMaterialId=a,se=i.id),i.setUniforms(C),i.setUniforms(E),i.bindTextures(j,n),e?(e.bind(),te&&te.bind()):(te&&te.bind(),i.bindAttributes(N)),u.currentRenderItemId=c}if(Qy&&e.checkFramebufferStatus(`Framebuffer error rendering item id ${c}`),r){for(let e of r)if(e.count!==0){if(i.setUniforms(e.uniforms),m)te?m.multiDrawElementsInstancedBaseVertexBaseInstance(k,e.counts,0,te._dataType,e.offsets,0,e.instanceCounts,0,e.baseVertices,0,e.baseInstances,0,e.count):m.multiDrawArraysInstancedBaseInstance(k,e.firsts,0,e.counts,0,e.instanceCounts,0,e.baseInstances,0,e.count);else if(h)if(te)for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform(`uDrawId`,t),h.drawElementsInstancedBaseVertexBaseInstance(k,e.counts[t],te._dataType,e.offsets[t],e.instanceCounts[t],e.baseVertices[t],e.baseInstances[t]));else for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform(`uDrawId`,t),h.drawArraysInstancedBaseInstance(k,e.firsts[t],e.counts[t],e.instanceCounts[t],e.baseInstances[t]));else if(te)for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform(`uDrawId`,t),i.offsetAttributes(ee,e.baseInstances[t]),f.drawElementsInstanced(k,e.counts[t],te._dataType,e.offsets[t],e.instanceCounts[t]));else for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform(`uDrawId`,t),i.offsetAttributes(ee,e.baseInstances[t]),f.drawArraysInstanced(k,0,e.counts[t],e.instanceCounts[t]));if($y){m?l.calls.multiDrawInstancedBase+=1:h?l.calls.drawInstancedBase+=e.count:l.calls.drawInstanced+=e.count;for(let t=0;t<e.count;++t)l.calls.counts+=e.instanceCounts[t]}}}else{let e=0;for(;;){let t=Math.min(re-e,HTe);if(te?f.drawElementsInstanced(k,t,te._dataType,e*te._bpe,ie):f.drawArraysInstanced(k,e,t,ie),e+=t,e>=re)break}$y&&(l.calls.drawInstanced+=1,l.calls.counts+=ie)}Qy&&e.checkError(`Draw error rendering item id ${c}`)},update:()=>{if(JTe(ae),i.aVertex){let e=i.uVertexCount.ref.value;i.aVertex.ref.value.length<e&&L.update(i.aVertex,TE(new Float32Array(e)))}for(let e=0,t=D.length;e<t;++e){let[t,n]=D[e];n.ref.version!==O[t]&&(ae.defines=!0,O[t]=n.ref.version)}if(ae.defines)for(let t of o)A[t].destroy(),A[t]=nF(e,rF(t,s),_,n,r);i.drawCount.ref.version!==O.drawCount&&(l.drawCount+=i.drawCount.ref.value-re,l.instancedDrawCount+=ie*i.drawCount.ref.value-ie*re,re=i.drawCount.ref.value,O.drawCount=i.drawCount.ref.version),i.instanceCount.ref.version!==O.instanceCount&&(l.instanceCount+=i.instanceCount.ref.value-ie,l.instancedDrawCount+=i.instanceCount.ref.value*re-ie*re,ie=i.instanceCount.ref.value,O.instanceCount=i.instanceCount.ref.version);for(let e=0,t=N.length;e<t;++e){let[t,n]=N[e],i=g[t];if(i.ref.version!==O[t]){if(n.length>=i.ref.value.length)n.updateSubData(i.ref.value,0,n.length);else{n.destroy();let{itemSize:a,divisor:o}=r[t];N[e][1]=d.attribute(i.ref.value,a,o),ae.attributes=!0}O[t]=i.ref.version}}if(te&&i.elements.ref.version!==O.elements&&(te.length>=i.elements.ref.value.length?te.updateSubData(i.elements.ref.value,0,te.length):(te.destroy(),te=d.elements(i.elements.ref.value),ae.elements=!0),O.elements=i.elements.ref.version),ae.attributes||ae.defines||ae.elements)for(let e of o){let t=ne[e];t&&t.destroy(),ne[e]=p?d.vertexArray(A[e],N,te):null}for(let e=0,t=j.length;e<t;++e){let[t,n]=j[e],i=v[t];i.ref.version!==O[t]&&(r[t].kind===`texture`?j[e][1]=i.ref.value:(n.load(i.ref.value),ae.textures=!0),O[t]=i.ref.version)}for(let e=0,t=M.length;e<t;++e){let[t,n]=M[e],i=y[t];i.ref.version!==O[t]&&(r[t].kind===`texture`?M[e][1]=i.ref.value:(n.load(i.ref.value),ae.textures=!0),O[t]=i.ref.version)}for(let e=0,t=T.length;e<t;++e){let[t,n]=T[e];n.ref.version!==O[t]&&(L.update(E[e][1],UT(n.ref.value)),O[t]=n.ref.version)}},destroy:()=>{if(!oe){for(let e of o){A[e].destroy();let t=ne[e];t&&t.destroy()}j.forEach(([e,t])=>{r[e].kind!==`texture`&&t.destroy()}),M.forEach(([e,t])=>{r[e].kind!==`texture`&&t.destroy()}),N.forEach(([e,t])=>t.destroy()),te&&te.destroy(),l.drawCount-=re,l.instanceCount-=ie,l.instancedDrawCount-=ie*re,oe=!0}}}}function sF(){return sF.create(B.create(1,0,0),0)}(function(e){function t(e,t){return{normal:e,constant:t}}e.create=t;function n(e,t){return B.copy(e.normal,t.normal),e.constant=t.constant,e}e.copy=n;function r(t){return n(e(),t)}e.clone=r;function i(e,t){let n=1/B.magnitude(t.normal);return B.scale(e.normal,t.normal,n),e.constant=t.constant*n,e}e.normalize=i;function a(e,t){return B.negate(e.normal,t.normal),e.constant=-t.constant,e}e.negate=a;function o(e,t,n){return B.toArray(e.normal,t,n),t[n+3]=e.constant,t}e.toArray=o;function s(e,t,n){return B.fromArray(e.normal,t,n),e.constant=t[n+3],e}e.fromArray=s;function c(e,t,n){return B.copy(e.normal,t),e.constant=-B.dot(e.normal,n),e}e.fromNormalAndCoplanarPoint=c;function l(e,t,n,r){return c(e,B.triangleNormal(B(),t,n,r),t),e}e.fromCoplanarPoints=l;let u=B();function d(e,t,n,r,i){B.set(u,t,n,r);let a=1/B.magnitude(u);return B.scale(e.normal,u,a),e.constant=i*a,e}e.setUnnormalized=d;function f(e,t){return B.dot(e.normal,t)+e.constant}e.distanceToPoint=f;function p(e,t){return f(e,t.center)-t.radius}e.distanceToSphere3D=p;function m(e,t,n){return B.scaleAndAdd(e,n,t.normal,-f(t,n))}e.projectPoint=m;function h(e,t,n){let r=B.dot(t.normal,n.direction);if(r===0)return!1;let i=-(B.dot(t.normal,n.origin)+t.constant)/r;return i<0?!1:(B.scaleAndAdd(e,n.origin,n.direction,i),!0)}e.intersectRay3D=h})(sF||={});function cF(){return cF.create(sF(),sF(),sF(),sF(),sF(),sF())}(function(e){(function(e){e[e.Right=0]=`Right`,e[e.Left=1]=`Left`,e[e.Bottom=2]=`Bottom`,e[e.Top=3]=`Top`,e[e.Far=4]=`Far`,e[e.Near=5]=`Near`})(e.PlaneIndex||={});function t(e,t,n,r,i,a){return[e,t,n,r,i,a]}e.create=t;function n(e,t){for(let n=0;n<6;++n)sF.copy(e[n],t[n]);return e}e.copy=n;function r(t){return n(e(),t)}e.clone=r;function i(e,t){let n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],h=t[13],g=t[14],_=t[15];return sF.setUnnormalized(e[0],a-n,l-o,p-u,_-m),sF.setUnnormalized(e[1],a+n,l+o,p+u,_+m),sF.setUnnormalized(e[2],a+r,l+s,p+d,_+h),sF.setUnnormalized(e[3],a-r,l-s,p-d,_-h),sF.setUnnormalized(e[4],a-i,l-c,p-f,_-g),sF.setUnnormalized(e[5],a+i,l+c,p+f,_+g),e}e.fromProjectionMatrix=i;function a(e,t){let n=t.center,r=-t.radius;for(let t=0;t<6;++t)if(sF.distanceToPoint(e[t],n)<r)return!1;return!0}e.intersectsSphere3D=a;let o=B();function s(e,t){for(let n=0;n<6;++n){let r=e[n];if(o[0]=r.normal[0]>0?t.max[0]:t.min[0],o[1]=r.normal[1]>0?t.max[1]:t.min[1],o[2]=r.normal[2]>0?t.max[2]:t.min[2],sF.distanceToPoint(r,o)<0)return!1}return!0}e.intersectsBox3D=s;function c(e,t){for(let n=0;n<6;++n)if(sF.distanceToPoint(e[n],t)<0)return!1;return!0}e.containsPoint=c})(cF||={});var lF=sF.distanceToPoint,uF=cF.intersectsSphere3D,dF=q.fromArray,fF=mb();function pF(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function mF(e,t,n){let r=fF(),i=pF(0),a=[],o=!1,s=-1,c=q(),l=()=>{let e=t.lodLevels?.ref.value;if(e&&e.length>0){let{cellCount:n}=t.instanceGrid.ref.value;a.length=e.length;for(let t=0,r=e.length;t<r;++t)a[t]=pF(n,a[t]),a[t].count=0;if(t.lodLevels.ref.version!==s){for(let t=0,n=e.length;t<n;++t)a[t].uniforms.length!==1&&(a[t].uniforms.length=1,a[t].uniforms[0]=[`uLod`,L.create(AO())]),L.update(a[t].uniforms[0][1],AO.set(a[t].uniforms[0][1].ref.value,e[t][0],e[t][1],e[t][2],e[t][4]));s=t.lodLevels.ref.version}}};return l(),{id:r,materialId:e.materialId,values:t,state:n,cull:(e,n,r,u)=>{if(o=!1,t.drawCount.ref.value===0||t.instanceCount.ref.value===0||t.instanceGrid.ref.value.cellSize<=1)return;let{cellOffsets:d,cellSpheres:f,cellCount:p,batchOffsets:m,batchSpheres:h,batchCount:g,batchCell:_,batchSize:v}=t.instanceGrid.ref.value,[y,b]=t.uLod.ref.value,x=y!==0||b!==0,S=2*v,C=t.lodLevels?.ref.value;if(C&&C.length>0){if(t.lodLevels?.ref.version!==s)l();else for(let e=0,t=C.length;e<t;++e)a[e].count=0;for(let t=0;t<g;++t){let i=m[t],o=m[t+1];if(o-i===0)continue;dF(c,h,t*4);let s=lF(e,c.center);if(x&&(s+c.radius<y||s-c.radius>b)){$y&&(u.culled.lod+=d[_[o-1]+1]-d[_[i]]);continue}if(!uF(n,c)){$y&&(u.culled.frustum+=d[_[o-1]+1]-d[_[i]]);continue}if(r!==null&&r(c)){$y&&(u.culled.occlusion+=d[_[o-1]+1]-d[_[i]]);continue}for(let t=i;t<o;++t){let i=_[t],o=d[i],s=d[i+1]-o;if(s===0)continue;dF(c,f,i*4);let l=lF(e,c.center);if(x&&(l+c.radius<y||l-c.radius>b)){$y&&(u.culled.lod+=s);continue}if(!uF(n,c)){$y&&(u.culled.frustum+=s);continue}if(r!==null&&l-c.radius<S&&r(c)){$y&&(u.culled.occlusion+=s);continue}for(let e=0,t=C.length;e<t;++e){if(l+c.radius<C[e][0]||l-c.radius>C[e][1])continue;let t=a[e],n=t.count;n>0&&t.baseInstances[n-1]+t.instanceCounts[n-1]===o&&t.counts[n-1]===C[e][3]?t.instanceCounts[n-1]+=s:(t.counts[n]=C[e][3],t.instanceCounts[n]=s,t.baseInstances[n]=o,t.count+=1)}}}}else{i=pF(p,i);let{baseInstances:o,instanceCounts:s,counts:l}=i,v=0;for(let i=0;i<g;++i){let a=m[i],p=m[i+1];if(p-a!==0){if(dF(c,h,i*4),x){let t=lF(e,c.center);if(t+c.radius<y||t-c.radius>b){$y&&(u.culled.lod+=d[_[p-1]+1]-d[_[a]]);continue}}if(!uF(n,c)){$y&&(u.culled.frustum+=d[_[p-1]+1]-d[_[a]]);continue}if(r!==null&&r(c)){$y&&(u.culled.occlusion+=d[_[p-1]+1]-d[_[a]]);continue}for(let i=a;i<p;++i){let a=_[i],p=d[a],m=d[a+1]-p;if(m===0)continue;dF(c,f,a*4);let h=lF(e,c.center);if(x&&(h+c.radius<y||h-c.radius>b)){$y&&(u.culled.lod+=m);continue}if(!uF(n,c)){$y&&(u.culled.frustum+=m);continue}if(r!==null&&h-c.radius<S&&r(c)){$y&&(u.culled.occlusion+=m);continue}v>0&&o[v-1]+s[v-1]===p?s[v-1]+=m:(l[v]=t.drawCount.ref.value,s[v]=m,o[v]=p,v+=1)}}}i.count=v,a.length=1,a[0]=i,a[0].uniforms.length=0}o=!0},uncull:()=>{o=!1},cullSimple:(e,n,r)=>{let i=t.lodLevels?.ref.value;if(!(!i||i.length===0)){if(t.lodLevels?.ref.version!==s)l();else for(let e=0,t=i.length;e<t;++e)a[e].count=0;for(let o=0,s=i.length;o<s;++o)if(e+n<i[o][1]*r){let e=a[o],n=e.count;e.counts[n]=i[o][3],e.instanceCounts[n]=t.instanceCount.ref.value,e.baseInstances[n]=0,e.count+=1;break}o=!0}},render:(r,i)=>{t.uAlpha&&t.alpha&&L.updateIfChanged(t.uAlpha,DT(t.alpha.ref.value*n.alphaFactor,0,1)),e.render(r,i,o?a:void 0)},getByteCount:()=>e.getByteCount(),getProgram:t=>e.getProgram(t),setTransparency:t=>e.setTransparency(t),update:()=>{e.update(),l()},dispose:()=>e.destroy()}}function hF(e,t){return{id:fF(),values:t,render:()=>{e.getProgram(`compute`).finalize(!0),e.render(`compute`,0)},update:()=>e.update(),dispose:()=>e.destroy()}}const gF=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),_F={drawCount:JP(`number`),instanceCount:JP(`number`),aPosition:WP(`float32`,2,0),uQuadScale:J(`v2`)},vF={drawCount:L.create(6),instanceCount:L.create(1),aPosition:L.create(gF),uQuadScale:L.create(R.create(1,1))};var YTe={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`)},XTe=fj(`copy`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`);function yF(e,t){let n={...vF,tColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight()))};return hF(aF(e,`triangles`,XTe,{...YTe},n),n)}var bF=new Uint32Array([0,1,2,1,3,2]),ZTe=new Float32Array([0,1,0,0,1,1,1,0]);const xF={nearest:`Nearest`,catmulrom:`Catmulrom (Cubic)`,mitchell:`Mitchell (Cubic)`,bspline:`B-Spline (Cubic)`};var SF;(function(e){function t(){return{type:0,center:B(),rotation:MT(),scale:B(),transform:z()}}e.createEmptyTrim=t;function n(e,t,n,r,o,s,c){return c?a(e,t,n,r,o,s,c):i(e,t,n,r,o,s)}e.create=n;function r(e){return gE([e.cornerBuffer.ref.version])}function i(e,t,n,i,a,o){let s=q(),c=-1,l=e.width,u=e.height,d={kind:`image`,imageTexture:L.create(e),imageTextureDim:L.create(R.create(l,u)),cornerBuffer:L.create(t),groupTexture:L.create(n),valueTexture:L.create(i),trimType:L.create(a.type),trimCenter:L.create(a.center),trimRotation:L.create(a.rotation),trimScale:L.create(a.scale),trimTransform:L.create(a.transform),isoLevel:L.create(o),get boundingSphere(){let e=r(d);if(e!==c){let t=QTe(d.cornerBuffer.ref.value);q.copy(s,t),c=e}return s},setBoundingSphere(e){q.copy(s,e),c=r(d)}};return d}function a(e,t,n,r,i,a,o){let s=e.width,c=e.height;return L.update(o.imageTexture,e),L.update(o.imageTextureDim,R.set(o.imageTextureDim.ref.value,s,c)),L.update(o.cornerBuffer,t),L.update(o.groupTexture,n),L.update(o.valueTexture,r),L.updateIfChanged(o.trimType,i.type),L.update(o.trimCenter,B.copy(o.trimCenter.ref.value,i.center)),L.update(o.trimRotation,MT.copy(o.trimRotation.ref.value,i.rotation)),L.update(o.trimScale,B.copy(o.trimScale.ref.value,i.scale)),L.update(o.trimTransform,z.copy(o.trimTransform.ref.value,i.transform)),L.updateIfChanged(o.isoLevel,a),o}function o(e){return n(WA(0,4,Uint8Array),e?e.cornerBuffer.ref.value:new Float32Array(24),WA(0,4,Uint8Array),WA(0,1,Float32Array),t(),-1,e)}e.createEmpty=o,e.Params={...EM.Params,interpolation:V.Select(`bspline`,V.objectToOptions(xF))},e.Utils={Params:e.Params,createEmpty:o,createValues:c,createValuesSimple:l,updateValues:u,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(e,t){return tj(1,1,1,()=>$A)}function c(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,c=nM(n,s(e,t),r.color),l=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),u=kM(),d=NM(),f=VM(),p=RM(),m=FM(),h={drawCount:bF.length,vertexCount:gF.length/3,groupCount:o,instanceCount:a},g=q.clone(e.boundingSphere),_=YA(g,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`image`),...c,...l,...u,...d,...f,...p,...m,...t,...EM.createValues(i,h),aPosition:e.cornerBuffer,aUv:L.create(ZTe),elements:L.create(bF),aGroup:L.create(TE(new Float32Array(4))),boundingSphere:L.create(_),invariantBoundingSphere:L.create(g),uInvariantBoundingSphere:L.create(AO.ofSphere(g)),dInterpolation:L.create(i.interpolation),uImageTexDim:e.imageTextureDim,tImageTex:e.imageTexture,tGroupTex:e.groupTexture,tValueTex:e.valueTexture,uTrimType:e.trimType,uTrimCenter:e.trimCenter,uTrimRotation:e.trimRotation,uTrimScale:e.trimScale,uTrimTransform:e.trimTransform,uIsoLevel:e.isoLevel}}function l(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return c(t,o.transform,o.locationIterator,o.theme,s)}function u(e,t){EM.updateValues(e,t),L.updateIfChanged(e.dInterpolation,t.interpolation)}function d(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function f(e){let t=EM.createRenderableState(e);return t.opaque=!1,t}function p(e,t){EM.updateRenderableState(e,t),e.opaque=!1}})(SF||={});function QTe(e){let t=B(),n=[];for(let r=0,i=e.length;r<i;r+=3){let i=B.fromArray(B(),e,r);n.push(i),B.add(t,t,i)}B.scale(t,t,1/(e.length/3));let r=0;for(let e of n){let n=B.distance(t,e);n>r&&(r=n)}let i=q.create(t,r);return q.setExtrema(i,n),i}var CF;(function(e){function t(e,t,n,r,o,s,c,l,u,d){return d?a(e,t,n,r,o,s,c,l,u,d):i(e,t,n,r,o,s,c,l,u)}e.create=t;function n(e){return t(e?e.mappingBuffer.ref.value:new Float32Array,e?e.indexBuffer.ref.value:new Uint32Array,e?e.groupBuffer.ref.value:new Float32Array,e?e.startBuffer.ref.value:new Float32Array,e?e.endBuffer.ref.value:new Float32Array,e?e.scaleBuffer.ref.value:new Float32Array,e?e.capBuffer.ref.value:new Float32Array,e?e.colorModeBuffer.ref.value:new Float32Array,0,e)}e.createEmpty=n;function r(e){return gE([e.cylinderCount,e.mappingBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.startBuffer.ref.version,e.endBuffer.ref.version,e.scaleBuffer.ref.version,e.capBuffer.ref.version,e.colorModeBuffer.ref.version])}function i(e,t,n,i,a,o,s,c,l){let u=q(),d,f=-1,p=-1,m={kind:`cylinders`,cylinderCount:l,mappingBuffer:L.create(e),indexBuffer:L.create(t),groupBuffer:L.create(n),startBuffer:L.create(i),endBuffer:L.create(a),scaleBuffer:L.create(o),capBuffer:L.create(s),colorModeBuffer:L.create(c),get boundingSphere(){let e=r(m);if(e!==f){let t=qA(m.startBuffer.ref.value,m.cylinderCount*6,6),n=qA(m.endBuffer.ref.value,m.cylinderCount*6,6);q.expandBySphere(u,t,n),f=e}return u},get groupMapping(){return m.groupBuffer.ref.version!==p&&(d=PA(m.groupBuffer.ref.value,m.cylinderCount,6),p=m.groupBuffer.ref.version),d},setBoundingSphere(e){q.copy(u,e),f=r(m)}};return m}function a(e,t,n,r,i,a,o,s,c,l){return c>l.cylinderCount&&(L.update(l.mappingBuffer,e),L.update(l.indexBuffer,t)),l.cylinderCount=c,L.update(l.groupBuffer,n),L.update(l.startBuffer,r),L.update(l.endBuffer,i),L.update(l.scaleBuffer,a),L.update(l.capBuffer,o),L.update(l.colorModeBuffer,s),l}function o(e,t){let n=e.startBuffer.ref.value;DA(t,n,0,e.cylinderCount*6),L.update(e.startBuffer,n);let r=e.endBuffer.ref.value;DA(t,r,0,e.cylinderCount*6),L.update(e.endBuffer,r)}e.transform=o,e.Params={...EM.Params,sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:V.Numeric(1,{min:0,max:3,step:.01}),doubleSided:V.Boolean(!1,EM.CustomQualityParamInfo),ignoreLight:V.Boolean(!1,EM.ShadingCategory),celShaded:V.Boolean(!1,EM.ShadingCategory),xrayShaded:V.Select(!1,[[!1,`Off`],[!0,`On`],[`inverted`,`Inverted`]],EM.ShadingCategory),transparentBackfaces:V.Select(`off`,V.arrayToOptions([`off`,`on`,`opaque`]),EM.ShadingCategory),solidInterior:V.Boolean(!0,EM.ShadingCategory),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),bumpAmplitude:V.Numeric(1,{min:0,max:5,step:.1},EM.ShadingCategory),colorMode:V.Select(`default`,V.arrayToOptions([`default`,`interpolate`]),EM.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:c,createValuesSimple:l,updateValues:u,updateBoundingSphere:d,createRenderableState:f,updateRenderableState:p,createPositionIterator:s};function s(e,t){let n=e.cylinderCount*6,r=t.instanceCount.ref.value,i=rj(),a=i.position,o=e.startBuffer.ref.value,s=e.endBuffer.ref.value,c=t.aTransform.ref.value;return tj(n,r,2,(e,t)=>{let n=e%6==0?o:s;return t<0?B.fromArray(a,n,e*3):B.transformMat4Offset(a,n,c,0,e*3,t*16),i})}function c(e,t,n,r,i){let{instanceCount:a,groupCount:o}=n,c=nM(n,s(e,t),r.color),l=tP(n,r.size),u=i.instanceGranularity?QA(a,`instance`):QA(a*o,`groupInstance`),d=kM(),f=NM(),p=VM(),m=RM(),h=FM(),g={drawCount:e.cylinderCount*4*3,vertexCount:e.cylinderCount*6,groupCount:o,instanceCount:a},_=nP(l)*i.sizeFactor,v=q.clone(e.boundingSphere),y=YA(v,t.aTransform.ref.value,a,0);return{dGeometryType:L.create(`cylinders`),aMapping:e.mappingBuffer,aGroup:e.groupBuffer,aStart:e.startBuffer,aEnd:e.endBuffer,aScale:e.scaleBuffer,aCap:e.capBuffer,aColorMode:e.colorModeBuffer,elements:e.indexBuffer,boundingSphere:L.create(y),invariantBoundingSphere:L.create(v),uInvariantBoundingSphere:L.create(AO.ofSphere(v)),...c,...l,...u,...d,...f,...p,...m,...h,...t,padding:L.create(_),...EM.createValues(i,g),uSizeFactor:L.create(i.sizeFactor*i.sizeAspectRatio),uDoubleSided:L.create(i.doubleSided),dIgnoreLight:L.create(i.ignoreLight),dCelShaded:L.create(i.celShaded),dXrayShaded:L.create(i.xrayShaded===`inverted`?`inverted`:i.xrayShaded===!0?`on`:`off`),dTransparentBackfaces:L.create(i.transparentBackfaces),dSolidInterior:L.create(i.solidInterior),uBumpFrequency:L.create(i.bumpFrequency),uBumpAmplitude:L.create(i.bumpAmplitude),dDualColor:L.create(i.colorMode===`interpolate`)}}function l(t,n,r,i,a){let o=EM.createSimple(r,i,a),s={...V.getDefaultValues(e.Params),...n};return c(t,o.transform,o.locationIterator,o.theme,s)}function u(e,t){EM.updateValues(e,t),L.updateIfChanged(e.uSizeFactor,t.sizeFactor*t.sizeAspectRatio),L.updateIfChanged(e.uDoubleSided,t.doubleSided),L.updateIfChanged(e.dIgnoreLight,t.ignoreLight),L.updateIfChanged(e.dCelShaded,t.celShaded),L.updateIfChanged(e.dXrayShaded,t.xrayShaded===`inverted`?`inverted`:t.xrayShaded===!0?`on`:`off`),L.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),L.updateIfChanged(e.dSolidInterior,t.solidInterior),L.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),L.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude),L.updateIfChanged(e.dDualColor,t.colorMode===`interpolate`)}function d(e,t){let n=q.clone(t.boundingSphere),r=YA(n,e.aTransform.ref.value,e.instanceCount.ref.value,0);q.equals(r,e.boundingSphere.ref.value)||L.update(e.boundingSphere,r),q.equals(n,e.invariantBoundingSphere.ref.value)||(L.update(e.invariantBoundingSphere,n),L.update(e.uInvariantBoundingSphere,AO.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))}function f(e){let t=EM.createRenderableState(e);return p(t,e),t}function p(e,t){EM.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}})(CF||={});var wF;(function(e){function t(e){switch(e.kind){case`mesh`:return e.triangleCount*3;case`points`:return e.pointCount;case`spheres`:return e.sphereCount*2*3;case`cylinders`:return e.cylinderCount*4*3;case`text`:return e.charCount*2*3;case`lines`:return e.lineCount*2*3;case`direct-volume`:return 36;case`image`:return 6;case`texture-mesh`:return e.vertexCount}}e.getDrawCount=t;function n(e){switch(e.kind){case`mesh`:return e.vertexCount;case`points`:return e.pointCount;case`spheres`:return e.sphereCount*6;case`cylinders`:return e.cylinderCount*6;case`text`:return e.charCount*4;case`lines`:return e.lineCount*4;case`direct-volume`:let[t,n,r]=e.gridDimension.ref.value;return t*n*r;case`image`:return 4;case`texture-mesh`:return e.vertexCount}}e.getVertexCount=n;function r(e){switch(e.kind){case`mesh`:case`points`:case`spheres`:case`cylinders`:case`text`:case`lines`:return t(e)===0?0:bE(e.groupBuffer.ref.value)+1;case`direct-volume`:return 1;case`image`:return gTe(e.groupTexture.ref.value.array,4)+1;case`texture-mesh`:return e.groupCount}}e.getGroupCount=r;function i(e){switch(e.kind){case`mesh`:return HM.Utils;case`points`:return iP.Utils;case`spheres`:return HP.Utils;case`cylinders`:return CF.Utils;case`text`:return uP.Utils;case`lines`:return vP.Utils;case`direct-volume`:return VP.Utils;case`image`:return SF.Utils;case`texture-mesh`:return UP.Utils}}e.getUtils=i;function a(e,t){return t===`instance`&&e.nonInstanceable?`group`:t}e.getGranularity=a})(wF||={});var $Te=1,eEe=`Assigns sizes as defined by the shape object.`;const TF={};function tEe(e){return TF}function EF(e,t){return{factory:EF,granularity:`groupInstance`,size:e=>MF.isLocation(e)?e.shape.getSize(e.group,e.instance):$Te,props:t,description:eEe}}const nEe={name:`shape-group`,label:`Shape Group`,category:``,factory:EF,getParams:tEe,defaultValues:V.getDefaultValues(TF),isApplicable:e=>!!e.shape};var rEe=tE(13421772),iEe=`Assigns colors as defined by the shape object.`;const DF={};function aEe(e){return DF}function OF(e,t){return{factory:OF,granularity:`groupInstance`,color:e=>MF.isLocation(e)?e.shape.getColor(e.group,e.instance):rEe,props:t,description:iEe}}const oEe={name:`shape-group`,label:`Shape Group`,category:mM.Misc,factory:OF,getParams:aEe,defaultValues:V.getDefaultValues(DF),isApplicable:e=>!!e.shape},sEe={...eF,aPosition:WP(`float32`,3,0),elements:KP(`uint32`),uBboxMin:J(`v3`),uBboxMax:J(`v3`),uBboxSize:J(`v3`),uMaxSteps:J(`i`),uStepScale:J(`f`),uJumpLength:J(`f`),uTransform:J(`m4`),uGridDim:J(`v3`),tTransferTex:GP(`image-uint8`,`alpha`,`ubyte`,`linear`),uTransferScale:J(`f`,`material`),dGridTexType:qP(`string`,[`2d`,`3d`]),uGridTexDim:J(`v3`),tGridTex:GP(`texture`,`rgba`,`ubyte`,`linear`),uGridStats:J(`v4`),uCellDim:J(`v3`),uCartnToUnit:J(`m4`),uUnitToCartn:J(`m4`),dPackedGroup:qP(`boolean`),dAxisOrder:qP(`string`,[`012`,`021`,`102`,`120`,`201`,`210`]),dIgnoreLight:qP(`boolean`),dCelShaded:qP(`boolean`),dXrayShaded:qP(`string`,[`off`,`on`,`inverted`]),meta:JP(`unknown`)};function cEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...sEe};e.isWebGL2||(s.uMaxSteps=qP(`number`));let c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,tSe,s,c,i,a),c,r)}const lEe={...eF,aGroup:WP(`float32`,1,0),aPosition:WP(`float32`,3,0),aNormal:WP(`float32`,3,0),elements:KP(`uint32`),dVaryingGroup:qP(`boolean`),dFlatShaded:qP(`boolean`),uDoubleSided:J(`b`,`material`),dFlipSided:qP(`boolean`),dIgnoreLight:qP(`boolean`),dCelShaded:qP(`boolean`),dXrayShaded:qP(`string`,[`off`,`on`,`inverted`]),dTransparentBackfaces:qP(`string`,[`off`,`on`,`opaque`]),uBumpFrequency:J(`f`,`material`),uBumpAmplitude:J(`f`,`material`),meta:JP(`unknown`)};function uEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...lEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,hj,s,c,i,a),c,r)}const dEe={...eF,...$P,aGroup:WP(`float32`,1,0),aPosition:WP(`float32`,3,0),dPointSizeAttenuation:qP(`boolean`),dPointStyle:qP(`string`,[`square`,`circle`,`fuzzy`])};function fEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...dEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`points`,Xxe,s,c,i,a),c,r)}const pEe={...eF,...$P,aGroup:WP(`float32`,1,0),aMapping:WP(`float32`,2,0),aStart:WP(`float32`,3,0),aEnd:WP(`float32`,3,0),elements:KP(`uint32`),dLineSizeAttenuation:qP(`boolean`),uDoubleSided:J(`b`,`material`),dFlipSided:qP(`boolean`)};function mEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...pEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,eSe,s,c,i,a),c,r)}const hEe={...eF,...$P,uTexDim:J(`v2`),tPositionGroup:GP(`image-float32`,`rgba`,`float`,`nearest`),padding:JP(`number`),uDoubleSided:J(`b`,`material`),dIgnoreLight:qP(`boolean`),dCelShaded:qP(`boolean`),dXrayShaded:qP(`string`,[`off`,`on`,`inverted`]),dTransparentBackfaces:qP(`string`,[`off`,`on`,`opaque`]),dSolidInterior:qP(`boolean`),dClipPrimitive:qP(`boolean`),dApproximate:qP(`boolean`),uAlphaThickness:J(`f`),uBumpFrequency:J(`f`,`material`),uBumpAmplitude:J(`f`,`material`),lodLevels:JP(`unknown`),centerBuffer:JP(`float32`),groupBuffer:JP(`float32`)};function gEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...hEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,Zxe,s,c,i,a),c,r)}const _Ee={...eF,...$P,aGroup:WP(`float32`,1,0),aPosition:WP(`float32`,3,0),aMapping:WP(`float32`,2,0),aDepth:WP(`float32`,1,0),elements:KP(`uint32`),aTexCoord:WP(`float32`,2,0),tFont:GP(`image-uint8`,`alpha`,`ubyte`,`linear`),padding:JP(`number`),uBorderWidth:J(`f`,`material`),uBorderColor:J(`v3`,`material`),uOffsetX:J(`f`,`material`),uOffsetY:J(`f`,`material`),uOffsetZ:J(`f`,`material`),uBackgroundColor:J(`v3`,`material`),uBackgroundOpacity:J(`f`,`material`)};function vEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,..._Ee},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,$xe,s,c,i,a),c,r)}const yEe={...eF,uGeoTexDim:J(`v2`,`buffered`),tPosition:GP(`texture`,`rgb`,`float`,`nearest`),tGroup:GP(`texture`,`alpha`,`float`,`nearest`),tNormal:GP(`texture`,`rgb`,`float`,`nearest`),dVaryingGroup:qP(`boolean`),dFlatShaded:qP(`boolean`),uDoubleSided:J(`b`,`material`),dFlipSided:qP(`boolean`),dIgnoreLight:qP(`boolean`),dCelShaded:qP(`boolean`),dXrayShaded:qP(`string`,[`off`,`on`,`inverted`]),dTransparentBackfaces:qP(`string`,[`off`,`on`,`opaque`]),uBumpFrequency:J(`f`,`material`),uBumpAmplitude:J(`f`,`material`),meta:JP(`unknown`)};function bEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...yEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,hj,s,c,i,a),c,r)}const xEe={...eF,aGroup:WP(`float32`,1,0),aPosition:WP(`float32`,3,0),aUv:WP(`float32`,2,0),elements:KP(`uint32`),uImageTexDim:J(`v2`),tImageTex:GP(`image-uint8`,`rgba`,`ubyte`,`nearest`),tGroupTex:GP(`image-uint8`,`rgba`,`ubyte`,`nearest`),tValueTex:GP(`image-float32`,`alpha`,`float`,`linear`),uTrimType:J(`i`),uTrimCenter:J(`v3`),uTrimRotation:J(`q`),uTrimScale:J(`v3`),uTrimTransform:J(`m4`),uIsoLevel:J(`f`),dInterpolation:qP(`string`,[`nearest`,`catmulrom`,`mitchell`,`bspline`])};function SEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...xEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,nSe,s,c,i,a),c,r)}const CEe={...eF,...$P,aGroup:WP(`float32`,1,0),aStart:WP(`float32`,3,0),aEnd:WP(`float32`,3,0),aMapping:WP(`float32`,3,0),aScale:WP(`float32`,1,0),aCap:WP(`float32`,1,0),aColorMode:WP(`float32`,1,0),elements:KP(`uint32`),padding:JP(`number`),uDoubleSided:J(`b`,`material`),dIgnoreLight:qP(`boolean`),dCelShaded:qP(`boolean`),dXrayShaded:qP(`string`,[`off`,`on`,`inverted`]),dTransparentBackfaces:qP(`string`,[`off`,`on`,`opaque`]),dSolidInterior:qP(`boolean`),uBumpFrequency:J(`f`,`material`),uBumpAmplitude:J(`f`,`material`),dDualColor:qP(`boolean`)};function wEe(e,t,n,r,i,a,o){let s={...YP,...XP,...ZP,...QP,...CEe},c={...n,uObjectId:L.create(t),dLightCount:L.create(o.dLightCount),dColorMarker:L.create(o.dColorMarker)};return mF(iF(e,`triangles`,Qxe,s,c,i,a),c,r)}var TEe=mb(0,2147483647);const kF=mb(0,2147483647);function AF(e,t,n,r){return{id:TEe(),type:e,values:t,state:n,materialId:r}}function EEe(e,t,n,r){switch(t.type){case`mesh`:return uEe(e,t.id,t.values,t.state,t.materialId,n,r);case`points`:return fEe(e,t.id,t.values,t.state,t.materialId,n,r);case`spheres`:return gEe(e,t.id,t.values,t.state,t.materialId,n,r);case`cylinders`:return wEe(e,t.id,t.values,t.state,t.materialId,n,r);case`text`:return vEe(e,t.id,t.values,t.state,t.materialId,n,r);case`lines`:return mEe(e,t.id,t.values,t.state,t.materialId,n,r);case`direct-volume`:return cEe(e,t.id,t.values,t.state,t.materialId,n,r);case`image`:return SEe(e,t.id,t.values,t.state,t.materialId,n,r);case`texture-mesh`:return bEe(e,t.id,t.values,t.state,t.materialId,n,r)}Lb(t.type)}var jF;(function(e){function t(e,t,n,r,i,a,o,s){return{id:zy.create22(),name:e,sourceData:t,geometry:n,transforms:o||[z.identity()],get groupCount(){return s??wF.getGroupCount(n)},getColor:r,getSize:i,getLabel:a}}e.create=t;function n(e){return{color:OF({shape:e},{}),size:EF({shape:e},{})}}e.getTheme=n;function r(e){let t=e.transforms.length,n=MF.Location(e);return tj(e.groupCount,t,1,(e,t)=>(n.group=e,n.instance=t,n))}e.groupIterator=r;function i(e,t,n,r,i){let a=i&&i.aTransform.ref.value.length>=e.length*16?i.aTransform.ref.value:new Float32Array(e.length*16);for(let t=0,n=e.length;t<n;++t)z.toArray(e[t],a,t*16);return lM(a,e.length,t,n,r,i)}e.createTransform=i;function a(e,t){let a=n(e),o=wF.getUtils(e.geometry),s=kF(),c=r(e),l=i(e.transforms,e.geometry.boundingSphere,t.cellSize,t.batchSize),u=o.createValues(e.geometry,l,c,a,t),d=o.createRenderableState(t);return AF(e.geometry.kind,u,d,s)}e.createRenderObject=a;function o(e){return{kind:`shape-loci`,shape:e}}e.Loci=o;function s(e){return!!e&&e.kind===`shape-loci`}e.isLoci=s;function c(e,t){return e.shape===t.shape}e.areLociEqual=c;function l(e){return e.shape.groupCount===0}e.isLociEmpty=l})(jF||={});var MF;(function(e){function t(e,t=0,n=0){return{kind:`group-location`,shape:e,group:t,instance:n}}e.Location=t;function n(e){return!!e&&e.kind===`group-location`}e.isLocation=n;function r(e,t){return{kind:`group-loci`,shape:e,groups:t}}e.Loci=r;function i(e){return!!e&&e.kind===`group-loci`}e.isLoci=i;function a(e,t){if(e.shape!==t.shape||e.groups.length!==t.groups.length)return!1;for(let n=0,r=e.groups.length;n<r;++n){let{ids:r,instance:i}=e.groups[n],{ids:a,instance:o}=t.groups[n];if(i!==o||!K.areEqual(r,a))return!1}return!0}e.areLociEqual=a;function o(e){return s(e)===0}e.isLociEmpty=o;function s(e){let t=0;for(let n of e.groups)t+=K.size(n.ids);return t}e.size=s;let c=new FA,l=B.zero();function u(e,t,n,r){let{indices:i,offsets:a}=t;for(let{ids:t,instance:o}of e)K.forEach(t,e=>{for(let t=a[e],s=a[e+1];t<s;++t)B.fromArray(l,n,i[t]*3),B.transformMat4(l,l,r[o]),c.includeStep(l)})}function d(e,t,n,r){let{indices:i,offsets:a}=t;for(let{ids:t,instance:o}of e)K.forEach(t,e=>{for(let t=a[e],s=a[e+1];t<s;++t)B.fromArray(l,n,i[t]*3),B.transformMat4(l,l,r[o]),c.radiusStep(l)})}function f(e,t){t||=q(),c.reset();let n=0,{geometry:r,transforms:i}=e.shape;if(r.kind===`mesh`||r.kind===`points`){let t=r.kind===`mesh`?r.vertexBuffer.ref.value:r.centerBuffer.ref.value;u(e.groups,r.groupMapping,t,i),c.finishedIncludeStep(),d(e.groups,r.groupMapping,t,i)}else if(r.kind===`lines`){let t=r.startBuffer.ref.value,n=r.endBuffer.ref.value;u(e.groups,r.groupMapping,t,i),u(e.groups,r.groupMapping,n,i),c.finishedIncludeStep(),d(e.groups,r.groupMapping,t,i),d(e.groups,r.groupMapping,n,i)}else if(r.kind===`spheres`||r.kind===`text`){let t=r.centerBuffer.ref.value;u(e.groups,r.groupMapping,t,i),c.finishedIncludeStep(),d(e.groups,r.groupMapping,t,i);for(let{ids:t,instance:r}of e.groups)K.forEach(t,t=>{let i=e.shape.getSize(t,r);n<i&&(n=i)})}else return q.copy(t,r.boundingSphere);return B.copy(t.center,c.center),t.radius=Math.sqrt(c.radiusSq),q.expand(t,t,n),t}e.getBoundingSphere=f})(MF||={});function NF(e){let t=e&&e.getElement(`vertex`),n=e&&e.getElement(`material`),r={group:``,vRed:``,vGreen:``,vBlue:``,mRed:``,mGreen:``,mBlue:``},i=[[``,``]],a=[[``,``]];if(t){for(let e=0,n=t.propertyNames.length;e<n;++e){let n=t.propertyNames[e],r=t.propertyTypes[e];(r===`uchar`||r===`uint8`||r===`ushort`||r===`uint16`||r===`uint`||r===`uint32`||r===`int`)&&i.push([n,n]),(r===`uchar`||r===`uint8`)&&a.push([n,n])}t.propertyNames.includes(`atomid`)?r.group=`atomid`:t.propertyNames.includes(`material_index`)&&(r.group=`material_index`),t.propertyNames.includes(`red`)&&(r.vRed=`red`),t.propertyNames.includes(`green`)&&(r.vGreen=`green`),t.propertyNames.includes(`blue`)&&(r.vBlue=`blue`)}let o=[[``,``]];if(n){for(let e=0,t=n.propertyNames.length;e<t;++e){let t=n.propertyNames[e],r=n.propertyTypes[e];(r===`uchar`||r===`uint8`)&&o.push([t,t])}n.propertyNames.includes(`red`)&&(r.mRed=`red`),n.propertyNames.includes(`green`)&&(r.mGreen=`green`),n.propertyNames.includes(`blue`)&&(r.mBlue=`blue`)}let s=r.vRed&&r.vGreen&&r.vBlue?`vertex`:r.mRed&&r.mGreen&&r.mBlue?`material`:`uniform`;return{...HM.Params,coloring:V.MappedStatic(s,{vertex:V.Group({red:V.Select(r.vRed,a,{label:`Red Property`}),green:V.Select(r.vGreen,a,{label:`Green Property`}),blue:V.Select(r.vBlue,a,{label:`Blue Property`})},{isFlat:!0}),material:V.Group({red:V.Select(r.mRed,o,{label:`Red Property`}),green:V.Select(r.mGreen,o,{label:`Green Property`}),blue:V.Select(r.mBlue,o,{label:`Blue Property`})},{isFlat:!0}),uniform:V.Group({color:V.Color(gk.grey),saturation:V.Numeric(0,{min:-6,max:6,step:.1}),lightness:V.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:V.MappedStatic(r.group?`vertex`:`none`,{vertex:V.Group({group:V.Select(r.group,i,{label:`Group Property`})},{isFlat:!0}),none:V.Group({})})}}const PF=NF();function DEe(e,t,n,r,i){let{vertices:a,normals:o,groups:s}=n,c=r.getProperty(`x`),l=r.getProperty(`y`),u=r.getProperty(`z`);if(!c||!l||!u)throw Error(`missing coordinate properties`);let d=r.getProperty(`nx`),f=r.getProperty(`ny`),p=r.getProperty(`nz`),m=!!d&&!!f&&!!p;for(let n=e;n<t;++n)_O.add3(a,c.value(n),l.value(n),u.value(n)),m&&_O.add3(o,d.value(n),f.value(n),p.value(n)),_O.add(s,i[n])}function OEe(e,t,n,r){let{indices:i}=n;for(let n=e;n<t;++n){let{entries:e,count:t}=r.value(n);t===3?_O.add3(i,e[0],e[1],e[2]):t===4&&(_O.add3(i,e[2],e[1],e[0]),_O.add3(i,e[2],e[0],e[3]))}}async function kEe(e,t,n,r,i){let a=YN.createState(t.rowCount,t.rowCount/4,i),o=t.getProperty(`x`),s=t.getProperty(`y`),c=t.getProperty(`z`);if(!o||!s||!c)throw Error(`missing coordinate properties`);let l=t.getProperty(`nx`),u=t.getProperty(`ny`),d=t.getProperty(`nz`),f=!!l&&!!u&&!!d,p=1e5;for(let n=0,i=t.rowCount;n<i;n+=p)DEe(n,Math.min(n+p,i),a,t,r),e.shouldUpdate&&await e.update({message:`adding ply mesh vertices`,current:n,max:i});for(let t=0,r=n.rowCount;t<r;t+=p)OEe(t,Math.min(t+p,r),a,n),e.shouldUpdate&&await e.update({message:`adding ply mesh faces`,current:t,max:r});let m=YN.getMesh(a);return f||HM.computeNormals(m),L.updateIfChanged(m.varyingGroup,!0),m}var FF=U.Schema.int;function AEe(e,t){let{grouping:n}=t,{rowCount:r}=e,i=n.name===`vertex`?e.getProperty(n.params.group):void 0,a=n.name===`vertex`?JT(n.params.group):`Vertex`,o=i?i.toArray({array:Uint32Array}):TE(new Uint32Array(r)),s=i?bE(o):r-1,c=new Uint32Array(s+1);for(let e=0,t=o.length;e<t;++e)c[o[e]]=e;return{ids:o,map:c,label:a}}function IF(e,t,n){let{coloring:r}=n,{rowCount:i}=e,a,o,s;if(r.name===`vertex`)a=e.getProperty(r.params.red)||U.ofConst(127,i,FF),o=e.getProperty(r.params.green)||U.ofConst(127,i,FF),s=e.getProperty(r.params.blue)||U.ofConst(127,i,FF);else if(r.name===`material`)a=t&&t.getProperty(r.params.red)||U.ofConst(127,i,FF),o=t&&t.getProperty(r.params.green)||U.ofConst(127,i,FF),s=t&&t.getProperty(r.params.blue)||U.ofConst(127,i,FF);else{let e=r.params.color;e=tE.saturate(e,r.params.saturation),e=tE.lighten(e,r.params.lightness);let[t,n,c]=tE.toRgb(e);a=U.ofConst(t,i,FF),o=U.ofConst(n,i,FF),s=U.ofConst(c,i,FF)}return{kind:r.name,red:a,green:o,blue:s}}function LF(e,t,n,r){let{kind:i,red:a,green:o,blue:s}=n,{ids:c,map:l,label:u}=r,{source:d,transforms:f}=e;return jF.create(`ply-mesh`,d,t,e=>{let t=i===`material`?e:l[e];return tE.fromRgb(a.value(t),o.value(t),s.value(t))},()=>1,e=>`${u} ${c[e]}`,f)}function jEe(){let e,t,n,r,i,a;return async(o,s,c,l)=>{let u=s.source.getElement(`vertex`);if(!u)throw Error(`missing vertex element`);let d=s.source.getElement(`face`);if(!d)throw Error(`missing face element`);let f=s.source.getElement(`material`),p=!1,m=!1;return(!e||e!==s)&&(p=!0),(!t||!V.isParamEqual(PF.grouping,t.grouping,c.grouping))&&(p=!0),(!t||!V.isParamEqual(PF.coloring,t.coloring,c.coloring))&&(m=!0),p?(i=IF(u,f,c),a=AEe(u,c),r=await kEe(o,u,d,a.ids,l&&l.geometry),n=LF(s,r,i,a)):m&&(i=IF(u,f,c),n=LF(s,r,i,a)),e=s,t=UT(c),n}}function MEe(e,t){return hb.create(`Shape Provider`,async n=>({label:`Mesh`,data:{source:e,transforms:t?.transforms},params:NF(e),getShape:jEe(),geometryUtils:HM.Utils}))}function RF(e,t){return{value:e,unit:t}}var zF;(function(e){function t(e,t,n){let r=!!e[0].cell,i=!!e[0].velocities,a=!!e[0].forces;return{id:zy.create22(),frames:e,hasCell:r,hasVelocities:i,hasForces:a,deltaTime:t,timeOffset:n}}e.create=t;function n(e,t,n){let{x:r,y:c,z:l}=e;return e.xyzOrdering.frozen?n?e.xyzOrdering.isIdentity?(r=o(r,n),c=o(c,n),l=o(l,n)):Cx(e.xyzOrdering.index,n)||(r=a(r,e.xyzOrdering.index,n),c=a(c,e.xyzOrdering.index,n),l=a(l,e.xyzOrdering.index,n)):e.xyzOrdering.isIdentity||(r=s(r,e.xyzOrdering.index),c=s(c,e.xyzOrdering.index),l=s(l,e.xyzOrdering.index)):n&&(e.xyzOrdering.isIdentity?(e.xyzOrdering.isIdentity=!1,e.xyzOrdering.index=n,i(r,n),i(c,n),i(l,n)):Cx(e.xyzOrdering.index,n)||(r=a(r,e.xyzOrdering.index,n),c=a(c,e.xyzOrdering.index,n),l=a(l,e.xyzOrdering.index,n))),e.xyzOrdering.frozen=!0,{id:zy.create22(),atomId:t.atomId,occupancy:t.occupancy??U.ofConst(1,e.elementCount,U.Schema.int),B_iso_or_equiv:t.B_iso_or_equiv??U.ofConst(0,e.elementCount,U.Schema.float),xyzDefined:!0,x:r,y:c,z:l}}e.getAtomicConformation=n;let r=[.123];function i(e,t){let n=r;for(let r=0,i=e.length;r<i;r++)n[r]=e[t[r]];for(let t=0,r=e.length;t<r;t++)e[t]=n[t]}function a(e,t,n){let r=new Float32Array(e.length);for(let i=0,a=e.length;i<a;i++)r[i]=e[t[n[i]]];return r}function o(e,t){let n=new Float32Array(e.length);for(let r=0,i=e.length;r<i;r++)n[r]=e[t[r]];return n}function s(e,t){let n=new Float32Array(e.length);for(let r=0,i=e.length;r<i;r++)n[t[r]]=e[r];return n}})(zF||={});function BF(){return BF.empty()}(function(e){function t(e,t){return{size:e,anglesInRadians:t}}e.create=t;function n(){return t(B(),B())}e.empty=n;function r(e,r,i){let a=B.magnitude(e),o=B.magnitude(r),s=B.magnitude(i),c=Math.acos(B.dot(r,i)/(o*s)),l=Math.acos(B.dot(e,i)/(a*s)),u=Math.acos(B.dot(e,r)/(a*o));return a<=0||o<=0||s<=0||c>=Math.PI||l>=Math.PI||u>=Math.PI?n():t(B.create(a,o,s),B.create(c,l,u))}e.fromBasis=r})(BF||={});var NEe=20.45482949774598;function PEe(e){return hb.create(`Parse DCD`,async t=>{await t.update(`Converting to coordinates`);let{header:n}=e,r=n.DELTA?RF(n.DELTA*NEe,`ps`):RF(1,`step`),i=n.ISTART>=1?RF((n.ISTART-1)*r.value,r.unit):RF(0,r.unit),a=[];for(let t=0,n=e.frames.length;t<n;++t){let n=e.frames[t],o={elementCount:n.elementCount,time:RF(i.value+r.value*t,r.unit),x:n.x,y:n.y,z:n.z,xyzOrdering:{isIdentity:!0}};if(n.cell){let e=n.cell;e[1]>=-1&&e[1]<=1&&e[3]>=-1&&e[3]<=1&&e[4]>=-1&&e[4]<=1?o.cell=BF.create(B.create(e[0],e[2],e[5]),B.create(FT(90-Math.asin(e[1])*90/NT),FT(90-Math.asin(e[3])*90/NT),FT(90-Math.asin(e[4])*90/NT))):e[0]<0||e[1]<0||e[2]<0||e[3]<0||e[4]<0||e[5]<0||e[3]>180||e[4]>180||e[5]>180?o.cell=BF.fromBasis(B.create(e[0],e[1],e[3]),B.create(e[1],e[2],e[4]),B.create(e[3],e[4],e[5])):o.cell=BF.create(B.create(e[0],e[2],e[5]),B.create(FT(wT(e[1],0,1e-6)?90:e[1]),FT(wT(e[3],0,1e-6)?90:e[3]),FT(wT(e[4],0,1e-6)?90:e[4])))}a.push(o)}return zF.create(a,r,i)})}function VF(e,t,n,r){let i=n,a=r-1,o=t.charCodeAt(i);for(;(o===32||o>=48&&o<=57)&&i<=a;)o=t.charCodeAt(++i);for(o=t.charCodeAt(a);(o===32||o>=48&&o<=57)&&a>=i;)o=t.charCodeAt(--a);if(++a,i===a||i+1===a)return aO.add(e,i,a);if(o=t.charCodeAt(i),i+2===a){let n=t.charCodeAt(i+1);if((o===78||o===110)&&(n===65||n===97)||(o===67||o===99)&&(n===76||n===108)||(o===70||o===102)&&(n===69||n===101)||(o===83||o===115)&&(n===73||n===105)||(o===66||o===98)&&(n===82||n===114)||(o===65||o===97)&&(n===83||n===115))return aO.add(e,i,i+2)}if(o===67||o===99||o===72||o===104||o===78||o===110||o===79||o===111||o===80||o===112||o===83||o===115)return aO.add(e,i,i+1);aO.add(e,i,i)}var FEe=new Set([`NA`,`CL`,`FE`,`SI`,`BR`,`AS`,`LI`]),IEe=new Set([`C`,`H`,`N`,`O`,`P`,`S`,`F`,`B`]),LEe=/^[\s\d]+|[\s\d]+$/g;function HF(e,t){e=e.replace(LEe,``).toUpperCase();let n=e.length;if(n===0||n===1||FEe.has(e))return e;if(n===3&&t===e){if(e===`SOD`)return`NA`;if(e===`POT`)return`K`;if(e===`CES`)return`CS`;if(e===`CAL`)return`CA`;if(e===`CLA`)return`CL`}return IEe.has(e[0])?e[0]:``}const UF=new Set(`145.147.149.289.291.293.445.475.491.510.604.045.05L.07E.07Y.08U.09X.0AT.0BD.0H0.0HX.0LP.0MK.0NZ.0TS.0UB.0V4.0WK.0XY.0YT.10M.12E.14T.15L.16F.16G.16O.17T.18D.18O.18T.1AR.1BW.1CF.1FT.1GL.1GN.1JB.1LL.1NA.1S3.1S4.1SD.1X4.20S.20X.22O.22S.23V.24S.25E.26M.26O.26Q.26R.26V.26W.26Y.27C.2DG.2DR.2F8.2FG.2FL.2FP.2GL.2GS.2H5.2HA.2M4.2M5.2M8.2OS.2SI.2WP.2WS.32O.34V.38J.3BU.3CM.3DO.3DY.3FM.3GR.3HD.3J3.3J4.3LJ.3LR.3MF.3MG.3MK.3R3.3S6.3SA.3YW.40J.42D.44S.46D.46M.46Z.48Z.49A.49S.49T.49V.4AM.4CQ.4GC.4GL.4GP.4JA.4N2.4NN.4QY.4R1.4RS.4SG.4U0.4U1.4U2.4UZ.4V5.50A.51N.56N.57S.5DI.5GF.5GO.5II.5KQ.5KS.5KT.5KV.5L2.5L3.5LS.5LT.5MM.5N6.5QP.5RP.5SA.5SP.5TH.5TJ.5TK.5TM.61J.62I.64K.66O.6BG.6C2.6DM.6GB.6GP.6GR.6K3.6KH.6KL.6KS.6KU.6KW.6LA.6LS.6LW.6MJ.6MN.6PG.6PY.6PZ.6S2.6SA.6UD.6Y6.6YR.6ZC.73E.79J.7CV.7D1.7GP.7JZ.7K2.7K3.7NU.7SA.83Y.89Y.8B7.8B9.8EX.8GA.8GG.8GP.8I4.8LM.8LR.8OQ.8PK.8S0.8YV.95Z.96O.98U.9AM.9C1.9CD.9GP.9KJ.9MR.9OK.9PG.9QG.9QZ.9RN.9S7.9SG.9SJ.9SM.9SP.9T1.9T7.9VP.9WJ.9WN.9WZ.9YW.A0K.A1AIO.A1APB.A1APC.A1APD.A1CCV.A1CCW.A1EAX.A1EFW.A1EGT.A1EGV.A1EGW.A1EGX.A1EGY.A1EJ0.A1EJ2.A1EKO.A1EN6.A1H03.A1H0P.A1H0Z.A1H10.A1H1B.A1H1F.A1H1V.A1I9U.A1ID6.A1IH4.A1IZL.A1JAQ.A1L1P.A1Q.A2G.A5C.A6P.AAL.AAO.ABC.ABD.ABE.ABF.ABL.AC1.ACG.ACR.ACX.ADA.ADG.ADR.AF1.AFD.AFL.AFO.AFP.AFR.AGC.AGH.AGL.AGR.AH2.AH8.AHG.AHM.AHR.AIG.ALL.ALX.AMG.AMN.AMU.AMV.ANA.AOG.AOS.AQA.ARA.ARB.ARE.ARI.ARW.ASC.ASG.ASO.AXP.AXR.AY9.AZC.B0D.B16.B1H.B1N.B2G.B4G.B6D.B7G.B8D.B9D.BBK.BBV.BCD.BCW.BDF.BDG.BDP.BDR.BDZ.BEM.BFN.BFP.BG6.BG8.BGC.BGL.BGN.BGP.BGS.BHG.BM3.BM7.BMA.BMX.BND.BNG.BNX.BO1.BOG.BQY.BRI.BS7.BTG.BTU.BW3.BWG.BXF.BXP.BXX.BXY.BZD.C3B.C3G.C3X.C4B.C4W.C4X.C5X.CAP.CBF.CBI.CBK.CDR.CE5.CE6.CE8.CEG.CEX.CEY.CEZ.CGF.CJB.CKB.CKP.CNP.CR1.CR6.CRA.CT3.CTO.CTR.CTT.D0N.D1M.D5E.D6G.DAF.DAG.DAN.DDA.DDB.DDL.DEG.DEL.DFR.DFX.DG0.DGC.DGD.DGM.DGO.DGS.DGU.DIG.DJB.DJE.DK4.DKX.DKZ.DL6.DLD.DLF.DLG.DMU.DNO.DO8.DOM.DP5.DPC.DQQ.DQR.DR2.DR3.DR4.DR5.DRI.DSR.DT6.DVC.DYM.E3M.E4P.E5G.EAG.EBG.EBQ.ED6.EEN.EEQ.EGA.EJT.EMP.EMZ.EPG.EQP.EQV.ERE.ERI.ETT.EUS.F1P.F1X.F55.F58.F6P.F8X.FBP.FCA.FCB.FCT.FDP.FDQ.FFC.FFX.FIF.FIX.FK9.FKD.FMF.FMO.FNG.FNY.FRU.FSA.FSI.FSM.FSR.FSW.FU4.FUB.FUC.FUD.FUF.FUL.FUY.FVQ.FX1.FYJ.G0S.G16.G1P.G20.G28.G2F.G3F.G3I.G4D.G4S.G6D.G6P.G6S.G7P.G8Z.GAA.GAC.GAD.GAF.GAL.GAT.GBH.GC1.GC4.GC9.GCB.GCD.GCN.GCO.GCS.GCT.GCU.GCV.GCW.GDA.GDL.GE1.GE3.GFP.GIV.GL0.GL1.GL2.GL4.GL5.GL6.GL7.GL9.GLA.GLB.GLC.GLD.GLF.GLG.GLO.GLP.GLS.GLT.GLW.GM0.GMB.GMH.GMT.GMZ.GN1.GN4.GNS.GNX.GP0.GP1.GP4.GPH.GPK.GPM.GPO.GPQ.GPU.GPV.GPW.GQ1.GRF.GRX.GS1.GS4.GS9.GSA.GSD.GTE.GTH.GTK.GTM.GTR.GU0.GU1.GU2.GU3.GU4.GU5.GU6.GU8.GU9.GUF.GUL.GUP.GUZ.GXL.GXV.GYE.GYG.GYP.GYU.GYV.GZL.H1M.H1S.H2P.H3S.H53.H6Q.H6Z.HBZ.HD4.HDL.HLA.HMS.HNV.HNW.HSG.HSH.HSJ.HSQ.HSR.HSU.HSX.HSY.HSZ.HTG.HTM.HVC.I57.IAB.IDC.IDF.IDG.IDR.IDS.IDT.IDU.IDX.IDY.IEM.IN1.IPT.ISD.ISL.ISX.IVG.IXD.J5B.JFZ.JHM.JLT.JRV.JS2.JSV.JV4.JVA.JVS.JZR.K5B.K99.KBA.KBG.KD5.KDA.KDB.KDD.KDE.KDF.KDM.KDN.KDO.KDR.KFN.KG1.KGM.KHP.KME.KO1.KO2.KOT.KQC.KTU.L1L.L6N.L6S.L6T.LAG.LAH.LAI.LAK.LAO.LAT.LB2.LBS.LBT.LCN.LDY.LEC.LER.LFC.LFR.LGC.LGU.LKA.LKS.LM2.LMO.LMT.LMU.LNV.LOG.LOX.LPK.LRH.LSM.LTG.LTM.LVO.LVZ.LXB.LXC.LXZ.LZ0.M1F.M1P.M2F.M3M.M3N.M55.M6D.M6P.M7B.M7P.M8C.MA1.MA2.MA3.MA8.MAB.MAF.MAG.MAL.MAN.MAT.MAV.MAW.MBE.MBF.MBG.MCU.MDA.MDP.MFA.MFB.MFU.MG5.MGA.MGC.MGL.MGS.MJJ.MLB.MLR.MMA.MMN.MN0.MNA.MQG.MQT.MRH.MRP.MSX.MTT.MUB.MUG.MUR.MVP.MXY.MXZ.MYG.N1L.N3U.N9S.NA1.NAA.NAG.NBG.NBX.NBY.NDG.NED.NFG.NG1.NG6.NGA.NGB.NGC.NGE.NGF.NGK.NGL.NGR.NGS.NGY.NGZ.NHF.NLC.NM6.NM9.NNG.NOJ.NPF.NSQ.NT1.NTF.NTO.NTP.NXD.NYT.O1G.OAK.OEL.OI7.OPM.ORP.OSU.OTG.OTN.OTU.OX2.P53.P6P.P8E.PA1.PA5.PAV.PDX.PH5.PKM.PNA.PNG.PNJ.PNW.PPC.PRP.PSG.PSJ.PSV.PTQ.PUF.PZU.QDK.QIF.QKH.QPS.QV4.R1P.R1X.R2B.R2G.R5P.RAA.RAE.RAF.RAM.RAO.RAT.RB5.RBL.RCD.RDP.REL.RER.RF5.RG1.RGG.RHA.RHC.RI2.RIB.RIP.RM4.RNS.RNT.ROB.ROR.RP3.RP5.RP6.RPA.RR7.RRJ.RRY.RST.RTG.RTV.RUB.RUG.RUU.RV7.RVG.RVM.RWI.RY7.RZM.S6P.S7P.S81.SA0.SCG.SCR.SDD.SDY.SEJ.SF6.SF9.SFJ.SFU.SG4.SG5.SG6.SG7.SGA.SGC.SGD.SGN.SGS.SHB.SHD.SHG.SI3.SIA.SID.SIO.SIZ.SLB.SLM.SLT.SMD.SN5.SNG.SOE.SOG.SOL.SOR.SR1.SSG.SSH.STW.STZ.SUC.SUP.SUS.SWE.SZZ.T68.T6D.T6P.T6T.TA6.TAG.TCB.TCG.TDG.TEU.TF0.TFU.TGA.TGK.TGR.TGY.TH1.TM5.TM6.TM9.TMR.TMX.TNX.TOA.TOC.TQY.TRE.TRV.TS8.TT7.TTV.TTZ.TU4.TUG.TUJ.TUP.TUR.TVD.TVG.TVM.TVS.TVV.TVY.TW7.TWA.TWD.TWG.TWJ.TWY.TXB.TY6.TYV.U1Y.U2A.U2D.U63.U8V.U97.U9A.U9D.U9G.U9J.U9M.UAP.UBH.UBO.UCD.UDC.UEA.V3M.V3P.V71.VDF.VG1.VJ1.VJ4.VKN.VTB.W9T.WIA.WKO.WKT.WOO.WT8.WUN.WZ1.WZ2.WZ4.X0X.X1P.X1X.X2F.X2Y.X34.X4S.X5S.X6N.X6X.X6Y.X6Z.XBP.XDP.XDX.XGP.XIL.XIQ.XKJ.XLF.XLS.XMM.XS2.XUL.XXM.XXR.XXX.XY6.XY9.XYB.XYF.XYL.XYP.XYS.XYT.XYZ.YDR.YIO.YJM.YKR.YO5.YX0.YX1.YYB.YYD.YYH.YYJ.YYK.YYM.YYQ.YYR.YZ0.YZT.Z0F.Z15.Z16.Z2D.Z2T.Z3K.Z3L.Z3Q.Z3U.Z4K.Z4R.Z4S.Z4U.Z4V.Z4W.Z4Y.Z57.Z5J.Z5L.Z61.Z6G.Z6H.Z6J.Z6W.Z8H.Z8T.Z9D.Z9E.Z9H.Z9K.Z9L.Z9M.Z9N.Z9W.ZB0.ZB1.ZB2.ZB3.ZCD.ZCZ.ZD0.ZDC.ZDM.ZDO.ZEE.ZEL.ZGE.ZMR.UMQ.SQD`.split(`.`));var WF;(function(e){e[e.FilledSphere=0]=`FilledSphere`,e[e.FilledCube=1]=`FilledCube`,e[e.CrossedCube=2]=`CrossedCube`,e[e.DividedDiamond=3]=`DividedDiamond`,e[e.FilledCone=4]=`FilledCone`,e[e.DevidedCone=5]=`DevidedCone`,e[e.FlatBox=6]=`FlatBox`,e[e.FilledStar=7]=`FilledStar`,e[e.FilledDiamond=8]=`FilledDiamond`,e[e.FlatDiamond=9]=`FlatDiamond`,e[e.FlatHexagon=10]=`FlatHexagon`,e[e.Pentagon=11]=`Pentagon`,e[e.DiamondPrism=12]=`DiamondPrism`,e[e.PentagonalPrism=13]=`PentagonalPrism`,e[e.HexagonalPrism=14]=`HexagonalPrism`,e[e.HeptagonalPrism=15]=`HeptagonalPrism`})(WF||={});const GF=rE({Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817});var KF;(function(e){e[e.Hexose=0]=`Hexose`,e[e.HexNAc=1]=`HexNAc`,e[e.Hexosamine=2]=`Hexosamine`,e[e.Hexuronate=3]=`Hexuronate`,e[e.Deoxyhexose=4]=`Deoxyhexose`,e[e.DeoxyhexNAc=5]=`DeoxyhexNAc`,e[e.DiDeoxyhexose=6]=`DiDeoxyhexose`,e[e.Pentose=7]=`Pentose`,e[e.Deoxynonulosonate=8]=`Deoxynonulosonate`,e[e.DiDeoxynonulosonate=9]=`DiDeoxynonulosonate`,e[e.Unknown=10]=`Unknown`,e[e.Assigned=11]=`Assigned`})(KF||={}),KF.Hexose,KF.HexNAc,KF.Hexosamine,KF.Hexuronate,KF.Deoxyhexose,KF.DeoxyhexNAc,KF.DiDeoxyhexose,KF.Pentose,KF.Deoxynonulosonate,KF.DiDeoxynonulosonate,KF.Unknown,KF.Assigned;var REe={[KF.Hexose]:WF.FilledSphere,[KF.HexNAc]:WF.FilledCube,[KF.Hexosamine]:WF.CrossedCube,[KF.Hexuronate]:WF.DividedDiamond,[KF.Deoxyhexose]:WF.FilledCone,[KF.DeoxyhexNAc]:WF.DevidedCone,[KF.DiDeoxyhexose]:WF.FlatBox,[KF.Pentose]:WF.FilledStar,[KF.Deoxynonulosonate]:WF.FilledDiamond,[KF.DiDeoxynonulosonate]:WF.FlatDiamond,[KF.Unknown]:WF.FlatHexagon,[KF.Assigned]:WF.Pentagon};function zEe(e,t){return e===KF.Unknown?t===4?WF.DiamondPrism:t===5?WF.PentagonalPrism:t===6?WF.HexagonalPrism:t===7?WF.HeptagonalPrism:WF.FlatHexagon:REe[e]}const qF={abbr:`Unk`,name:`Unknown`,color:GF.Secondary,type:KF.Unknown};var JF=[{abbr:`Glc`,name:`Glucose`,color:GF.Blue,type:KF.Hexose},{abbr:`Man`,name:`Mannose`,color:GF.Green,type:KF.Hexose},{abbr:`Gal`,name:`Galactose`,color:GF.Yellow,type:KF.Hexose},{abbr:`Gul`,name:`Gulose`,color:GF.Orange,type:KF.Hexose},{abbr:`Alt`,name:`Altrose`,color:GF.Pink,type:KF.Hexose},{abbr:`All`,name:`Allose`,color:GF.Purple,type:KF.Hexose},{abbr:`Tal`,name:`Talose`,color:GF.LightBlue,type:KF.Hexose},{abbr:`Ido`,name:`Idose`,color:GF.Brown,type:KF.Hexose},{abbr:`GlcNAc`,name:`N-Acetyl Glucosamine`,color:GF.Blue,type:KF.HexNAc},{abbr:`ManNAc`,name:`N-Acetyl Mannosamine`,color:GF.Green,type:KF.HexNAc},{abbr:`GalNAc`,name:`N-Acetyl Galactosamine`,color:GF.Yellow,type:KF.HexNAc},{abbr:`GulNAc`,name:`N-Acetyl Gulosamine`,color:GF.Orange,type:KF.HexNAc},{abbr:`AltNAc`,name:`N-Acetyl Altrosamine`,color:GF.Pink,type:KF.HexNAc},{abbr:`AllNAc`,name:`N-Acetyl Allosamine`,color:GF.Purple,type:KF.HexNAc},{abbr:`TalNAc`,name:`N-Acetyl Talosamine`,color:GF.LightBlue,type:KF.HexNAc},{abbr:`IdoNAc`,name:`N-Acetyl Idosamine`,color:GF.Brown,type:KF.HexNAc},{abbr:`GlcN`,name:`Glucosamine`,color:GF.Blue,type:KF.Hexosamine},{abbr:`ManN`,name:`Mannosamine`,color:GF.Green,type:KF.Hexosamine},{abbr:`GalN`,name:`Galactosamine`,color:GF.Yellow,type:KF.Hexosamine},{abbr:`GulN`,name:`Gulosamine`,color:GF.Orange,type:KF.Hexosamine},{abbr:`AltN`,name:`Altrosamine`,color:GF.Pink,type:KF.Hexosamine},{abbr:`AllN`,name:`Allosamine`,color:GF.Purple,type:KF.Hexosamine},{abbr:`TalN`,name:`Talosamine`,color:GF.LightBlue,type:KF.Hexosamine},{abbr:`IdoN`,name:`Idosamine`,color:GF.Brown,type:KF.Hexosamine},{abbr:`GlcNS`,name:`N-sulfo Glucosamine`,color:GF.Blue,type:KF.Hexosamine},{abbr:`GlcA`,name:`Glucuronic Acid`,color:GF.Blue,type:KF.Hexuronate},{abbr:`ManA`,name:`Mannuronic Acid`,color:GF.Green,type:KF.Hexuronate},{abbr:`GalA`,name:`Galacturonic Acid`,color:GF.Yellow,type:KF.Hexuronate},{abbr:`GulA`,name:`Guluronic Acid`,color:GF.Orange,type:KF.Hexuronate},{abbr:`AltA`,name:`Altruronic Acid`,color:GF.Pink,type:KF.Hexuronate},{abbr:`AllA`,name:`Alluronic Acid`,color:GF.Purple,type:KF.Hexuronate},{abbr:`TalA`,name:`Taluronic Acid`,color:GF.LightBlue,type:KF.Hexuronate},{abbr:`IdoA`,name:`Iduronic Acid`,color:GF.Brown,type:KF.Hexuronate},{abbr:`Qui`,name:`Quinovose`,color:GF.Blue,type:KF.Deoxyhexose},{abbr:`Rha`,name:`Rhamnose`,color:GF.Green,type:KF.Deoxyhexose},{abbr:`6dGul`,name:`6-Deoxy Gulose`,color:GF.Orange,type:KF.Deoxyhexose},{abbr:`6dAlt`,name:`6-Deoxy Altrose`,color:GF.Pink,type:KF.Deoxyhexose},{abbr:`6dTal`,name:`6-Deoxy Talose`,color:GF.LightBlue,type:KF.Deoxyhexose},{abbr:`Fuc`,name:`Fucose`,color:GF.Red,type:KF.Deoxyhexose},{abbr:`QuiNAc`,name:`N-Acetyl Quinovosamine`,color:GF.Blue,type:KF.DeoxyhexNAc},{abbr:`RhaNAc`,name:`N-Acetyl Rhamnosamine`,color:GF.Green,type:KF.DeoxyhexNAc},{abbr:`6dAltNAc`,name:`N-Acetyl 6-Deoxy Altrosamine`,color:GF.Pink,type:KF.DeoxyhexNAc},{abbr:`6dTalNAc`,name:`N-Acetyl 6-Deoxy Talosamine`,color:GF.LightBlue,type:KF.DeoxyhexNAc},{abbr:`FucNAc`,name:`N-Acetyl Fucosamine`,color:GF.Red,type:KF.DeoxyhexNAc},{abbr:`AAT`,name:`AAT`,color:GF.Red,type:KF.DeoxyhexNAc},{abbr:`Oli`,name:`Olivose`,color:GF.Blue,type:KF.DiDeoxyhexose},{abbr:`Tyv`,name:`Tyvelose`,color:GF.Green,type:KF.DiDeoxyhexose},{abbr:`Abe`,name:`Abequose`,color:GF.Orange,type:KF.DiDeoxyhexose},{abbr:`Par`,name:`Paratose`,color:GF.Pink,type:KF.DiDeoxyhexose},{abbr:`Dig`,name:`Digitoxose`,color:GF.Purple,type:KF.DiDeoxyhexose},{abbr:`Col`,name:`Colitose`,color:GF.LightBlue,type:KF.DiDeoxyhexose},{abbr:`Ara`,name:`Arabinose`,color:GF.Green,type:KF.Pentose},{abbr:`Lyx`,name:`Lyxose`,color:GF.Yellow,type:KF.Pentose},{abbr:`Xyl`,name:`Xylose`,color:GF.Orange,type:KF.Pentose},{abbr:`Rib`,name:`Ribose`,color:GF.Pink,type:KF.Pentose},{abbr:`Kdn`,name:`Keto-Deoxy Nonulonic Acid`,color:GF.Green,type:KF.Deoxynonulosonate},{abbr:`Neu5Ac`,name:`N-Acetyl Neuraminic Acid`,color:GF.Purple,type:KF.Deoxynonulosonate},{abbr:`Neu5Gc`,name:`N-Glycolyl Neuraminic Acid`,color:GF.LightBlue,type:KF.Deoxynonulosonate},{abbr:`Neu`,name:`Neuraminic Acid`,color:GF.Brown,type:KF.Deoxynonulosonate},{abbr:`Sia`,name:`Sialic acid`,color:GF.Red,type:KF.Deoxynonulosonate},{abbr:`Pse`,name:`Pseudaminic Acid`,color:GF.Green,type:KF.DiDeoxynonulosonate},{abbr:`Leg`,name:`Legionaminic Acid`,color:GF.Yellow,type:KF.DiDeoxynonulosonate},{abbr:`Aci`,name:`Acinetaminic Acid`,color:GF.Pink,type:KF.DiDeoxynonulosonate},{abbr:`4eLeg`,name:`4-Epilegionaminic Acid`,color:GF.LightBlue,type:KF.DiDeoxynonulosonate},{abbr:`Bac`,name:`Bacillosamine`,color:GF.Blue,type:KF.Unknown},{abbr:`LDmanHep`,name:`L-Glycero-D-Manno Heptose`,color:GF.Green,type:KF.Unknown},{abbr:`Kdo`,name:`Keto-Deoxy Octulonic Acid`,color:GF.Yellow,type:KF.Unknown},{abbr:`Dha`,name:`3-Deoxy Lyxo-Heptulosaric Acid`,color:GF.Orange,type:KF.Unknown},{abbr:`DDmanHep`,name:`D-Glycero-D-Manno-Heptose`,color:GF.Pink,type:KF.Unknown},{abbr:`MurNAc`,name:`N-Acetyl Muramic Acid`,color:GF.Purple,type:KF.Unknown},{abbr:`MurNGc`,name:`N-Glycolyl Muramic Acid`,color:GF.LightBlue,type:KF.Unknown},{abbr:`Mur`,name:`Muramic Acid`,color:GF.Brown,type:KF.Unknown},{abbr:`K3O`,name:`D-glycero-a-D-talo-oct-2-Ulosonic Acid`,color:GF.Red,type:KF.Unknown},{abbr:`dUA`,name:`4-deoxy-4,5-didehydro iduronic acid`,color:GF.Secondary,type:KF.Unknown},{abbr:`Api`,name:`Apicose`,color:GF.Green,type:KF.Assigned},{abbr:`Fru`,name:`Fructose`,color:GF.Green,type:KF.Assigned},{abbr:`Tag`,name:`Tagatose`,color:GF.Yellow,type:KF.Assigned},{abbr:`Sor`,name:`Sorbose`,color:GF.Orange,type:KF.Assigned},{abbr:`Psi`,name:`Psicose`,color:GF.Pink,type:KF.Assigned}];const BEe=(function(){let e=new Map;for(let t=0,n=JF.length;t<n;++t){let n=JF[t];e.set(n.abbr,n)}return e})(),VEe=[[`Glc-family`,GF.Blue],[`Man-family`,GF.Green],[`Gal-family`,GF.Yellow],[`Gul-family`,GF.Orange],[`Alt-family`,GF.Pink],[`All-family`,GF.Purple],[`Tal-family`,GF.LightBlue],[`Ido-family`,GF.Brown],[`Fuc-family`,GF.Red],[`Generic/Unknown/Secondary`,GF.Secondary]];var YF={Glc:[`GLC`,`BGC`,`Z8T`,`TRE`,`MLR`],Man:[`MAN`,`BMA`],Gal:[`GLA`,`GAL`,`GZL`,`GXL`,`GIV`],Gul:[`4GL`,`GL0`,`GUP`,`Z8H`],Alt:[`Z6H`,`3MK`,`SHD`],All:[`AFD`,`ALL`,`WOO`,`Z2D`],Tal:[`ZEE`,`A5C`,`SDY`],Ido:[`ZCD`,`Z0F`,`4N2`],GlcNAc:[`NDG`,`NAG`,`NGZ`],ManNAc:[`BM3`,`BM7`],GalNAc:[`A2G`,`NGA`,`YYQ`],GulNAc:[`LXB`],AltNAc:[],AllNAc:[`NAA`],TalNAc:[],IdoNAc:[`LXZ`,`HSQ`],GlcN:[`PA1`,`GCS`],ManN:[`95Z`],GalN:[`X6X`,`1GN`],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:[`GCU`,`BDP`],ManA:[`MAV`,`BEM`],GalA:[`ADA`,`GTR`,`GTK`],GulA:[`LGU`],AltA:[],AllA:[],TalA:[`X1X`,`X0X`],IdoA:[`IDR`],Qui:[`G6D`,`YYK`],Rha:[`RAM`,`RM4`,`XXR`],"6dGul":[`66O`],"6dAlt":[],"6dTal":[],Fuc:[`FUC`,`FUL`,`FCA`,`FCB`,`GYE`],QuiNAc:[`Z9W`],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:[`49T`],Oli:[`DDA`,`RAE`,`Z5J`],Tyv:[`TYV`],Abe:[`ABE`],Par:[`PZU`],Dig:[`Z3U`],Col:[],Ara:[`64K`,`ARA`,`ARB`,`AHR`,`FUB`,`BXY`,`BXX`,`SEJ`],Lyx:[`LDY`,`Z4W`],Xyl:[`XYS`,`XYP`,`XYZ`,`HSY`,`LXC`],Rib:[`YYM`,`RIP`,`RIB`,`BDR`,`0MK`,`Z6J`,`32O`],Kdn:[`KDM`,`KDN`],Neu5Ac:[`SIA`,`SLB`],Neu5Gc:[`NGC`,`NGE`],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:[`GMH`],Kdo:[`KDO`],Dha:[],DDmanHep:[`289`],MurNAc:[`MUB`,`AMU`],MurNGc:[],Mur:[`1S4`,`MUR`],Api:[`XXM`],Fru:[`BDF`,`Z9N`,`FRU`,`LFR`],Tag:[`T6T`],Sor:[`SOE`,`UEA`],Psi:[`PSV`,`SF6`,`SF9`,`TTV`]},XF={Glc:[`AGLC`,`BGLC`],GlcNAc:[`AGLCNA`,`BGLCNA`,`BGLCN0`],GlcA:[`AGLCA`,`BGLCA`,`BGLCA0`],Man:[`AMAN`,`BMAN`],Rha:[`ARHM`,`BRHM`],Ara:[`AARB`,`BARB`],Gal:[`AGAL`,`BGAL`],GalNAc:[`AGALNA`,`BGALNA`],Gul:[`AGUL`,`BGUL`],Alt:[`AALT`,`BALT`],All:[`AALL`,`BALL`],Tal:[`ATAL`,`BTAL`],Ido:[`AIDO`,`BIDO`],IdoA:[`AIDOA`,`BIDOA`],Fuc:[`AFUC`,`BFUC`],Lyx:[`ALYF`,`BLYF`],Xyl:[`AXYL`,`BXYL`,`AXYF`,`BXYF`],Rib:[`ARIB`,`BRIB`],Fru:[`AFRU`,`BFRU`],Neu5Ac:[`ANE5AC`,`BNE5AC`]},HEe={Glc:`0GA.0GB.1GA.1GB.2GA.2GB.3GA.3GB.4GA.4GB.6GA.6GB.ZGA.ZGB.YGA.YGB.XGA.XGB.WGA.WGB.VGA.VGB.UGA.UGB.TGA.TGB.SGA.SGB.RGA.RGB.QGA.QGB.PGA.PGB.0gA.0gB.1gA.1gB.2gA.2gB.3gA.3gB.4gA.4gB.6gA.6gB.ZgA.ZgB.YgA.YgB.XgA.XgB.WgA.WgB.VgA.VgB.UgA.UgB.TgA.TgB.SgA.SgB.RgA.RgB.QgA.QgB.PgA.PgB`.split(`.`),GlcNAc:`0YA.0YB.1YA.1YB.3YA.3YB.4YA.4YB.6YA.6YB.WYA.WYB.VYA.VYB.UYA.UYB.QYA.QYB.0yA.0yB.1yA.1yB.3yA.3yB.4yA.4yB.6yA.6yB.WyA.WyB.VyA.VyB.UyA.UyB.QyA.QyB.0YS.0Ys.3YS.3Ys.4YS.4Ys.6YS.6Ys.QYS.QYs.UYS.UYs.VYS.VYs.WYS.WYs.0yS.0ys.3yS.3ys.4yS.4ys`.split(`.`),GlcA:`0ZA.0ZB.1ZA.1ZB.2ZA.2ZB.3ZA.3ZB.4ZA.4ZB.ZZA.ZZB.YZA.YZB.WZA.WZB.TZA.TZB.0zA.0zB.1zA.1zB.2zA.2zB.3zA.3zB.4zA.4zB.ZzA.ZzB.YzA.YzB.WzA.WzB.TzA.TzB.TZBP.WZBP.YZBP.4ZBP.ZZBP.3ZBP.2ZBP.1ZBP.0ZBP.0ZF.1ZF.4ZF.0Zf.1Zf.4Zf`.split(`.`),GlcN:`0YN.3YN.4YN.6YN.WYN.VYN.UYN.QYN.3Yn.4Yn.WYn.0Yn.0YP.3YP.4YP.6YP.WYP.VYP.UYP.QYP.0Yp.3Yp.4Yp.WYp.QYN.WYN.VYN.3YN.UYN.4YN.6YN.1YN.0YN.QYn.VYn.WYn.3Yn.UYn.6Yn.4Yn.1Yn.0Yn.QYNP.WYNP.VYNP.3YNP.UYNP.4YNP.6YNP.1YNP.0YNP.QYnP.UYnP.VYnP.6YnP.WYnP.4YnP.3YnP.1YnP.0YnP`.split(`.`),Man:`0MA.0MB.1MA.1MB.2MA.2MB.3MA.3MB.4MA.4MB.6MA.6MB.ZMA.ZMB.YMA.YMB.XMA.XMB.WMA.WMB.VMA.VMB.UMA.UMB.TMA.TMB.SMA.SMB.RMA.RMB.QMA.QMB.PMA.PMB.0mA.0mB.1mA.1mB.2mA.2mB.3mA.3mB.4mA.4mB.6mA.6mB.ZmA.ZmB.YmA.YmB.XmA.XmB.WmA.WmB.VmA.VmB.UmA.UmB.TmA.TmB.SmA.SmB.RmA.RmB.QmA.QmB.PmA.PmB`.split(`.`),ManNAc:`0WA.0WB.1WA.1WB.3WA.3WB.4WA.4WB.6WA.6WB.WWA.WWB.VWA.VWB.UWA.UWB.QWA.QWB.0wA.0wB.1wA.1wB.3wA.3wB.4wA.4wB.6wA.6wB.WwA.WwB.VwA.VwB.UwA.UwB.QwA.QwB`.split(`.`),Ara:`0AA.0AB.1AA.1AB.2AA.2AB.3AA.3AB.4AA.4AB.ZAA.ZAB.YAA.YAB.WAA.WAB.TAA.TAB.0AD.0AU.1AD.1AU.2AD.2AU.3AD.3AU.5AD.5AU.ZAD.ZAU.0aA.0aB.1aA.1aB.2aA.2aB.3aA.3aB.4aA.4aB.ZaA.ZaB.YaA.YaB.WaA.WaB.TaA.TaB.0aD.0aU.1aD.1aU.2aD.2aU.3aD.3aU.5aD.5aU.ZaD.ZaU`.split(`.`),Gal:`0LA.0LB.1LA.1LB.2LA.2LB.3LA.3LB.4LA.4LB.6LA.6LB.ZLA.ZLB.YLA.YLB.XLA.XLB.WLA.WLB.VLA.VLB.ULA.ULB.TLA.TLB.SLA.SLB.RLA.RLB.QLA.QLB.PLA.PLB.0lA.0lB.1lA.1lB.2lA.2lB.3lA.3lB.4lA.4lB.6lA.6lB.ZlA.ZlB.YlA.YlB.XlA.XlB.WlA.WlB.VlA.VlB.UlA.UlB.TlA.TlB.SlA.SlB.RlA.RlB.QlA.QlB.PlA.PlB`.split(`.`),GalNAc:`0VA.0VB.1VA.1VB.3VA.3VB.4VA.4VB.6VA.6VB.WVA.WVB.VVA.VVB.UVA.UVB.QVA.QVB.0vA.0vB.1vA.1vB.3vA.3vB.4vA.4vB.6vA.6vB.WvA.WvB.VvA.VvB.UvA.UvB.QvA.QvB`.split(`.`),GalA:`0OA.0OB.1OA.1OB.2OA.2OB.3OA.3OB.4OA.4OB.ZOA.ZOB.YOA.YOB.WOA.WOB.TOA.TOB.0oA.0oB.1oA.1oB.2oA.2oB.3oA.3oB.4oA.4oB.ZoA.ZoB.YoA.YoB.WoA.WoB.ToA.ToB`.split(`.`),Gul:`0KA.0KB.1KA.1KB.2KA.2KB.3KA.3KB.4KA.4KB.6KA.6KB.ZKA.ZKB.YKA.YKB.XKA.XKB.WKA.WKB.VKA.VKB.UKA.UKB.TKA.TKB.SKA.SKB.RKA.RKB.QKA.QKB.PKA.PKB.0kA.0kB.1kA.1kB.2kA.2kB.3kA.3kB.4kA.4kB.6kA.6kB.ZkA.ZkB.YkA.YkB.XkA.XkB.WkA.WkB.VkA.VkB.UkA.UkB.TkA.TkB.SkA.SkB.RkA.RkB.QkA.QkB.PkA.PkB`.split(`.`),Alt:`0EA.0EB.1EA.1EB.2EA.2EB.3EA.3EB.4EA.4EB.6EA.6EB.ZEA.ZEB.YEA.YEB.XEA.XEB.WEA.WEB.VEA.VEB.UEA.UEB.TEA.TEB.SEA.SEB.REA.REB.QEA.QEB.PEA.PEB.0eA.0eB.1eA.1eB.2eA.2eB.3eA.3eB.4eA.4eB.6eA.6eB.ZeA.ZeB.YeA.YeB.XeA.XeB.WeA.WeB.VeA.VeB.UeA.UeB.TeA.TeB.SeA.SeB.ReA.ReB.QeA.QeB.PeA.PeB`.split(`.`),All:`0NA.0NB.1NA.1NB.2NA.2NB.3NA.3NB.4NA.4NB.6NA.6NB.ZNA.ZNB.YNA.YNB.XNA.XNB.WNA.WNB.VNA.VNB.UNA.UNB.TNA.TNB.SNA.SNB.RNA.RNB.QNA.QNB.PNA.PNB.0nA.0nB.1nA.1nB.2nA.2nB.3nA.3nB.4nA.4nB.6nA.6nB.ZnA.ZnB.YnA.YnB.XnA.XnB.WnA.WnB.VnA.VnB.UnA.UnB.TnA.TnB.SnA.SnB.RnA.RnB.QnA.QnB.PnA.PnB`.split(`.`),Tal:`0TA.0TB.1TA.1TB.2TA.2TB.3TA.3TB.4TA.4TB.6TA.6TB.ZTA.ZTB.YTA.YTB.XTA.XTB.WTA.WTB.VTA.VTB.UTA.UTB.TTA.TTB.STA.STB.RTA.RTB.QTA.QTB.PTA.PTB.0tA.0tB.1tA.1tB.2tA.2tB.3tA.3tB.4tA.4tB.6tA.6tB.ZtA.ZtB.YtA.YtB.XtA.XtB.WtA.WtB.VtA.VtB.UtA.UtB.TtA.TtB.StA.StB.RtA.RtB.QtA.QtB.PtA.PtB`.split(`.`),Ido:`0IA.0IB.1IA.1IB.2IA.2IB.3IA.3IB.4IA.4IB.6IA.6IB.ZIA.ZIB.YIA.YIB.XIA.XIB.WIA.WIB.VIA.VIB.UIA.UIB.TIA.TIB.SIA.SIB.RIA.RIB.QIA.QIB.PIA.PIB.0iA.0iB.1iA.1iB.2iA.2iB.3iA.3iB.4iA.4iB.6iA.6iB.ZiA.ZiB.YiA.YiB.XiA.XiB.WiA.WiB.ViA.ViB.UiA.UiB.TiA.TiB.SiA.SiB.RiA.RiB.QiA.QiB.PiA.PiB`.split(`.`),IdoA:`0UA.0UB.1UA.1UB.2UA.2UB.3UA.3UB.4UA.4UB.ZUA.ZUB.YUA.YUB.WUA.WUB.TUA.TUB.0uA.0uB.1uA.1uB.2uA.2uB.3uA.3uB.4uA.4uB.ZuA.ZuB.YuA.YuB.WuA.WuB.TuA.TuB.YuAP`.split(`.`),Fuc:`0FA.0FB.1FA.1FB.2FA.2FB.3FA.3FB.4FA.4FB.ZFA.ZFB.YFA.YFB.WFA.WFB.TFA.TFB.0fA.0fB.1fA.1fB.2fA.2fB.3fA.3fB.4fA.4fB.ZfA.ZfB.YfA.YfB.WfA.WfB.TfA.TfB`.split(`.`),Rha:`0HA.0HB.1HA.1HB.2HA.2HB.3HA.3HB.4HA.4HB.ZHA.ZHB.YHA.YHB.WHA.WHB.THA.THB.0hA.0hB.1hA.1hB.2hA.2hB.3hA.3hB.4hA.4hB.ZhA.ZhB.YhA.YhB.WhA.WhB.ThA.ThB`.split(`.`),Qui:`0QA.0QB.1QA.1QB.2QA.2QB.3QA.3QB.4QA.4QB.ZQA.ZQB.YQA.YQB.WQA.WQB.TQA.TQB.0qA.0qB.1qA.1qB.2qA.2qB.3qA.3qB.4qA.4qB.ZqA.ZqB.YqA.YqB.WqA.WqB.TqA.TqB`.split(`.`),Lyx:`0DA.0DB.1DA.1DB.2DA.2DB.3DA.3DB.4DA.4DB.ZDA.ZDB.YDA.YDB.WDA.WDB.TDA.TDB.0DD.0DU.1DD.1DU.2DD.2DU.3DD.3DU.5DD.5DU.ZDD.ZDU.0dA.0dB.1dA.1dB.2dA.2dB.3dA.3dB.4dA.4dB.ZdA.ZdB.YdA.YdB.WdA.WdB.TdA.TdB.0dD.0dU.1dD.1dU.2dD.2dU.3dD.3dU.5dD.5dU.ZdD.ZdU`.split(`.`),Xyl:`0XA.0XB.1XA.1XB.2XA.2XB.3XA.3XB.4XA.4XB.ZXA.ZXB.YXA.YXB.WXA.WXB.TXA.TXB.0XD.0XU.1XD.1XU.2XD.2XU.3XD.3XU.5XD.5XU.ZXD.ZXU.0xA.0xB.1xA.1xB.2xA.2xB.3xA.3xB.4xA.4xB.ZxA.ZxB.YxA.YxB.WxA.WxB.TxA.TxB.0xD.0xU.1xD.1xU.2xD.2xU.3xD.3xU.5xD.5xU.ZxD.ZxU`.split(`.`),Rib:`0RA.0RB.1RA.1RB.2RA.2RB.3RA.3RB.4RA.4RB.ZRA.ZRB.YRA.YRB.WRA.WRB.TRA.TRB.0RD.0RU.1RD.1RU.2RD.2RU.3RD.3RU.5RD.5RU.ZRD.ZRU.0rA.0rB.1rA.1rB.2rA.2rB.3rA.3rB.4rA.4rB.ZrA.ZrB.YrA.YrB.WrA.WrB.TrA.TrB.0rD.0rU.1rD.1rU.2rD.2rU.3rD.3rU.5rD.5rU.ZrD.ZrU`.split(`.`),Fru:`0CA.0CB.1CA.1CB.2CA.2CB.3CA.3CB.4CA.4CB.5CA.5CB.WCA.WCB.0CD.0CU.1CD.1CU.2CD.2CU.3CD.3CU.4CD.4CU.6CD.6CU.WCD.WCU.VCD.VCU.UCD.UCU.QCD.QCU.0cA.0cB.1cA.1cB.2cA.2cB.3cA.3cB.4cA.4cB.5cA.5cB.WcA.WcB.0cD.0cU.1cD.1cU.2cD.2cU.3cD.3cU.4cD.4cU.6cD.6cU.WcD.WcU.VcD.VcU.UcD.UcU.QcD.QcU`.split(`.`),Tag:`0JA.0JB.1JA.1JB.2JA.2JB.3JA.3JB.4JA.4JB.5JA.5JB.WJA.WJB.0JD.0JU.1JD.1JU.2JD.2JU.3JD.3JU.4JD.4JU.6JD.6JU.WJD.WJU.VJD.VJU.UJD.UJU.QJD.QJU.0jA.0jB.1jA.1jB.2jA.2jB.3jA.3jB.4jA.4jB.5jA.5jB.WjA.WjB.0jD.0jU.1jD.1jU.2jD.2jU.3jD.3jU.4jD.4jU.6jD.6jU.WjD.WjU.VjD.VjU.UjD.UjU.QjD.QjU`.split(`.`),Sor:`0BA.0BB.1BA.1BB.2BA.2BB.3BA.3BB.4BA.4BB.5BA.5BB.WBA.WBB.0BD.0BU.1BD.1BU.2BD.2BU.3BD.3BU.4BD.4BU.6BD.6BU.WBD.WBU.VBD.VBU.UBD.UBU.QBD.QBU.0bA.0bB.1bA.1bB.2bA.2bB.3bA.3bB.4bA.4bB.5bA.5bB.WbA.WbB.0bD.0bU.1bD.1bU.2bD.2bU.3bD.3bU.4bD.4bU.6bD.6bU.WbD.WbU.VbD.VbU.UbD.UbU.QbD.QbU`.split(`.`),Psi:`0PA.0PB.1PA.1PB.2PA.2PB.3PA.3PB.4PA.4PB.5PA.5PB.WPA.WPB.0PD.0PU.1PD.1PU.2PD.2PU.3PD.3PU.4PD.4PU.6PD.6PU.WPD.WPU.VPD.VPU.UPD.UPU.QPD.QPU.0pA.0pB.1pA.1pB.2pA.2pB.3pA.3pB.4pA.4pB.5pA.5pB.WpA.WpB.0pD.0pU.1pD.1pU.2pD.2pU.3pD.3pU.4pD.4pU.6pD.6pU.WpD.WpU.VpD.VpU.UpD.UpU.QpD.QpU`.split(`.`),Neu5Ac:`0SA.0SB.4SA.4SB.7SA.7SB.8SA.8SB.9SA.9SB.ASA.ASB.BSA.BSB.CSA.CSB.DSA.DSB.ESA.ESB.FSA.FSB.GSA.GSB.HSA.HSB.ISA.ISB.JSA.JSB.KSA.KSB.0sA.0sB.4sA.4sB.7sA.7sB.8sA.8sB.9sA.9sB.AsA.AsB.BsA.BsB.CsA.CsB.DsA.DsB.EsA.EsB.FsA.FsB.GsA.GsB.HsA.HsB.IsA.IsB.JsA.JsB.KsA.KsB`.split(`.`),Neu5Gc:`0GL.4GL.7GL.8GL.9GL.CGL.DGL.EGL.FGL.GGL.HGL.IGL.JGL.KGL.0gL.4gL.7gL.8gL.9gL.AgL.BgL.CgL.DgL.EgL.FgL.GgL.HgL.IgL.JgL.KgL`.split(`.`),Tyv:[`YTV`,`4TV`,`2TV`,`1TV`,`0TV`,`YTv`,`4Tv`,`2Tv`,`1Tv`,`0Tv`],Abe:[`YAE`,`2AE`,`4AE`,`1AE`,`0AE`,`YAe`,`4Ae`,`2Ae`,`1Ae`,`0Ae`],Bac:[`0BC`,`1BC`,`3BC`,`0bC`,`1bC`,`3bC`],Kdn:`0KN.4KN.5KN.7KN.8KN.9KN.AKN.BKN.CKN.DKN.EKN.FKN.GKN.HKN.IKN.JKN.KKN.LKN.MKN.NKN.OKN.PKN.QKN.RKN.SKN.TKN.UKN.VKN.WKN.XKN.YKN.0Kn.4Kn.5Kn.7Kn.8Kn.9Kn.AKn.BKn.CKn.DKn.EKn.FKn.GKn.HKn.IKn.JKn.KKn.LKn.MKn.NKn.OKn.PKn.QKn.RKn.SKn.TKn.UKn.VKn.WKn.XKn.YKn`.split(`.`),Kdo:`0KO.4KO.5KO.7KO.8KO.AKO.BKO.CKO.DKO.EKO.FKO.GKO.HKO.IKO.JKO.KKO.0Ko.4Ko.5Ko.7Ko.8Ko.AKo.BKo.CKo.DKo.EKo.FKo.GKo.HKo.IKo.JKo.KKo`.split(`.`),QuiNAc:[`0QF`,`1QF`,`3QF`,`0Qf`,`1Qf`,`3Qf`],AAT:[`0FC`,`1FC`,`3FC`,`0Fc`,`1Fc`,`3Fc`],Ara4N:[`ZaN`,`3aN`,`2aN`,`1aN`,`0aN`,`Zan`,`3an`,`2an`,`1an`,`0an`],Aci:[`JeC`,`8eC`,`4eC`,`2eC`,`0eC`,`Jec`,`8ec`,`4ec`,`2ec`,`0ec`],Leg:[`JLG`,`8LG`,`4LG`,`2LG`,`0LG`,`JLg`,`8Lg`,`4Lg`,`2Lg`,`0Lg`],Pse:[`JmP`,`8mP`,`4mP`,`2mP`,`0mP`,`Jmp`,`8mp`,`4mp`,`2mp`,`0mp`],Fus:[`EgF`,`HgF`,`JgF`,`8gF`,`KgF`,`7gF`,`4gF`,`2gF`,`0gF`,`Egf`,`Hgf`,`Jgf`,`8gf`,`Kgf`,`7gf`,`4gf`,`2gf`,`0gf`],DDmanpHep:`ODH.NDH.LDH.MDH.KDH.7DH.PDH.SDH.RDH.XDH.QDH.VDH.UDH.6DH.TDH.ZDH.YDH.2DH.WDH.3DH.4DH.1DH.ODh.NDh.LDh.MDh.KDh.7Dh.PDh.SDh.RDh.XDh.QDh.VDh.UDh.6Dh.TDh.ZDh.YDh.2Dh.WDh.3Dh.4Dh.1Dh`.split(`.`),LDmanpHep:`OLH.NLH.LLH.MLH.KLH.7LH.PLH.SLH.RLH.XLH.QLH.VLH.ULH.6LH.TLH.ZLH.YLH.2LH.WLH.3LH.4LH.1LH.OLh.NLh.LLh.MLh.KLh.7Lh.PLh.SLh.RLh.XLh.QLh.VLh.ULh.6Lh.TLh.ZLh.YLh.2Lh.WLh.3Lh.4Lh.1Lh`.split(`.`),K3O:`dKX.EKX.hKX.HKX.jKX.JKX.pKX.8KX.MKX.kKX.KKX.qKX.7KX.xKX.WKX.tKX.3KX.sKX.4KX.5KX.2KX.0KX.dKx.EKx.hKx.HKx.jKx.JKx.pKx.8Kx.MKx.kKx.KKx.qKx.7Kx.xKx.WKx.tKx.3Kx.sKx.4Kx.5Kx.2Kx.0Kx`.split(`.`),MurNAc:[`UMR`,`4MR`,`6MR`,`1MR`,`0MR`,`UMr`,`4Mr`,`6Mr`,`1Mr`,`0Mr`],Oli:[`WdR`,`4dR`,`3dR`,`1dR`,`0dR`],dUA:[`Z45`,`345`,`245`,`145`,`045`],GlcNS:`QYS.UYS.VYS.6YS.WYS.4YS.3YS.1YS.0YS.QYs.UYs.VYs.6Ys.WYs.4Ys.3Ys.1Ys.0Ys.QyS.UyS.VyS.6yS.WyS.4yS.3yS.1yS.0yS.Qys.Uys.Vys.6ys.Wys.4ys.3ys.1ys.0ys`.split(`.`)},ZF=(function(){let e=new Map;for(let t=0,n=JF.length;t<n;++t){let n=JF[t],r=YF[n.abbr];if(r)for(let t=0,i=r.length;t<i;++t)e.set(r[t],n);let i=XF[n.abbr];if(i)for(let t=0,r=i.length;t<r;++t)e.set(i[t],n)}return UF.forEach(t=>{e.has(t)||e.set(t,qF)}),e})(),UEe=(function(){let e=new Map;for(let t=0,n=JF.length;t<n;++t){let n=JF[t],r=YF[n.abbr];if(r)for(let t=0,i=r.length;t<i;++t)e.set(r[t],n);let i=XF[n.abbr];if(i)for(let t=0,r=i.length;t<r;++t)e.set(i[t],n);let a=HEe[n.abbr];if(a)for(let t=0,r=a.length;t<r;++t)e.has(a[t])||e.set(a[t],n)}return UF.forEach(t=>{e.has(t)||e.set(t,qF)}),e})();function WEe(e){QF=e===`default`?ZF:UEe}let QF=ZF;var $F;(function(e){function t(e){return Array.from(e.values())}e.toArray=t;function n(e,t){if(e===t)return!0;if(e.size<t.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}e.isSuperset=n;function r(e,...t){for(let n=0;n<t.length;n++)for(let r of t[n])e.add(r);return e}e.add=r;function i(e,t){let n=new Set(e);if(e===t)return n;for(let e of t)n.add(e);return n}e.union=i;function a(...e){if(e.length===0)return new Set;let t=new Set(e[0]);for(let n=1,r=e.length;n<r;n++)for(let r of e[n])t.add(r);return t}e.unionMany=a;function o(e){if(e.length===0)return new Set;let t=new Set(e[0]);for(let n=1;n<e.length;n++)for(let r of e[n])t.add(r);return t}e.unionManyArrays=o;function s(e,t){if(e===t)return new Set(e);let n=new Set;for(let r of t)e.has(r)&&n.add(r);return n}e.intersection=s;function c(e,t){if(e===t)return e.size>0;e.size<t.size&&([e,t]=[t,e]);for(let n of t)if(e.has(n))return!0;return!1}e.areIntersecting=c;function l(e,t){if(e===t)return e.size;e.size<t.size&&([e,t]=[t,e]);let n=0;for(let r of t)e.has(r)&&(n+=1);return n}e.intersectionSize=l;function u(e,t){if(e===t)return new Set;let n=new Set(e);for(let e of t)n.delete(e);return n}e.difference=u;function d(e,t){if(e===t)return 0;let n=e.size;for(let r of e)t.has(r)&&--n;return n}e.differenceSize=d;function f(e,t){if(e===t)return!0;if(e.size!==t.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}e.areEqual=f})($F||={});const eI=new Set(`DAPC.DBPC.DFPC.DGPC.DIPC.DLPC.DNPC.DOPC.DPPC.DRPC.DTPC.DVPC.DXPC.DYPC.LPPC.PAPC.PEPC.PGPC.PIPC.POPC.PRPC.PUPC.DAPE.DBPE.DFPE.DGPE.DIPE.DLPE.DNPE.DOPE.DPPE.DRPE.DTPE.DUPE.DVPE.DXPE.DYPE.LPPE.PAPE.PGPE.PIPE.POPE.PQPE.PRPE.PUPE.DAPS.DBPS.DFPS.DGPS.DIPS.DLPS.DNPS.DOPS.DPPS.DRPS.DTPS.DUPS.DVPS.DXPS.DYPS.LPPS.PAPS.PGPS.PIPS.POPS.PQPS.PRPS.PUPS.DAPA.DBPA.DFPA.DGPA.DIPA.DLPA.DNPA.DOPA.DPPA.DRPA.DTPA.DVPA.DXPA.DYPA.LPPA.PAPA.PGPA.PIPA.POPA.PRPA.PUPA.DAPG.DBPG.DFPG.DGPG.DIPG.DLPG.DNPG.DOPG.DPPG.DRPG.DTPG.DVPG.DXPG.DYPG.LPPG.PAPG.PGPG.PIPG.POPG.PRPG.DMPC.DPP.DPPI.PAPI.PIPI.POP.POPI.PUPI.PVP.PVPI.PADG.PIDG.PODG.PUDG.PVDG.APC.CPC.IPC.LPC.OPC.PPC.TPC.UPC.VPC.BNSM.DBSM.DPSM.DXSM.PGSM.PNSM.POSM.PVSM.XNSM.DPCE.DXCE.PNCE.XNCE`.split(`.`)),tI=new Set(`118.119.543.1AL.1CU.2FK.2HP.2OF.3CO.3MT.3NI.3OF.3P8.4MO.4PU.4TI.6MO.ACT.AG.AL.ALF.AM.ATH.AU.AU3.AUC.AZI.BA.BCT.BEF.BF4.BO4.BR.BS3.BSY.CA.CAC.CD.CD1.CD3.CD5.CE.CF.CHT.CL.CO.CO3.CO5.CON.CR.CS.CSB.CU.CU1.CU3.CUA.CUZ.CYN.DME.DMI.DSC.DTI.DY.E4N.EDR.EMC.ER3.EU.EU3.F.FE.FE2.FPO.GA.GD3.GEP.HAI.HG.HGC.IN.IOD.IR.IR3.IRI.IUM.K.KO4.LA.LCO.LCP.LI.LU.MAC.MG.MH2.MH3.MLI.MMC.MN.MN3.MN5.MN6.MO1.MO2.MO3.MO4.MO5.MO6.MOO.MOS.MOW.MW1.MW2.MW3.NA.NA2.NA5.NA6.NAO.NAW.ND.NET.NH4.NI.NI1.NI2.NI3.NO2.NO3.NRU.NT3.O4M.OAA.OC1.OC2.OC3.OC4.OC5.OC6.OC7.OC8.OCL.OCM.OCN.OCO.OF1.OF2.OF3.OH.OS.OS4.OXL.PB.PBM.PD.PDV.PER.PI.PO3.PO4.PR.PT.PT4.PTN.RB.RH3.RHD.RHF.RU.SB.SCN.SE4.SEK.SM.SMO.SO3.SO4.SR.T1A.TB.TBA.TCN.TEA.TH.THE.TL.TMA.TRA.UNX.V.VN3.VO4.W.WO5.Y1.YB.YB2.YH.YT3.ZCM.ZN.ZN2.ZN3.ZNO.ZO3.ZR.ZTM.NCO.OHX`.split(`.`));var GEe=function(){let e=Object.create(null),t=[];for(let e=65;e<=90;e++)t[t.length]=String.fromCharCode(e);for(let e=97;e<=122;e++)t[t.length]=String.fromCharCode(e);for(let e=48;e<=57;e++)t[t.length]=String.fromCharCode(e);for(let n of t){e[n]=n.toUpperCase();for(let r of t){e[n+r]=(n+r).toUpperCase();for(let i of t)e[n+r+i]=(n+r+i).toUpperCase()}}return e}();function nI(e){return GEe[e]||e.toUpperCase()}var rI=new Map([[1,`H`],[2,`He`],[3,`Li`],[4,`Be`],[5,`B`],[6,`C`],[7,`N`],[8,`O`],[9,`F`],[10,`Ne`],[11,`Na`],[12,`Mg`],[13,`Al`],[14,`Si`],[15,`P`],[16,`S`],[17,`Cl`],[18,`Ar`],[19,`K`],[20,`Ca`],[21,`Sc`],[22,`Ti`],[23,`V`],[24,`Cr`],[25,`Mn`],[26,`Fe`],[27,`Co`],[28,`Ni`],[29,`Cu`],[30,`Zn`],[31,`Ga`],[32,`Ge`],[33,`As`],[34,`Se`],[35,`Br`],[36,`Kr`],[37,`Rb`],[38,`Sr`],[39,`Y`],[40,`Zr`],[41,`Nb`],[42,`Mo`],[43,`Tc`],[44,`Ru`],[45,`Rh`],[46,`Pd`],[47,`Ag`],[48,`Cd`],[49,`In`],[50,`Sn`],[51,`Sb`],[52,`Te`],[53,`I`],[54,`Xe`],[55,`Cs`],[56,`Ba`],[57,`La`],[58,`Ce`],[59,`Pr`],[60,`Nd`],[61,`Pm`],[62,`Sm`],[63,`Eu`],[64,`Gd`],[65,`Tb`],[66,`Dy`],[67,`Ho`],[68,`Er`],[69,`Tm`],[70,`Yb`],[71,`Lu`],[72,`Hf`],[73,`Ta`],[74,`W`],[75,`Re`],[76,`Os`],[77,`Ir`],[78,`Pt`],[79,`Au`],[80,`Hg`],[81,`Tl`],[82,`Pb`],[83,`Bi`],[84,`Po`],[85,`At`],[86,`Rn`],[87,`Fr`],[88,`Ra`],[89,`Ac`],[90,`Th`],[91,`Pa`],[92,`U`],[93,`Np`],[94,`Pu`],[95,`Am`],[96,`Cm`],[97,`Bk`],[98,`Cf`],[99,`Es`],[100,`Fm`],[101,`Md`],[102,`No`],[103,`Lr`],[104,`Rf`],[105,`Db`],[106,`Sg`],[107,`Bh`],[108,`Hs`],[109,`Mt`],[110,`Ds`],[111,`Rg`],[112,`Cn`],[113,`Uut`],[114,`Fl`],[115,`Uup`],[116,`Lv`],[117,`Uus`],[118,`Uuo`]].map(e=>[e[0],nI(e[1])]));function KEe(e){return rI.has(e)?rI.get(e):nI(`H`)}var qEe;(function(e){e[e.unknown=0]=`unknown`,e[e.polymer=1]=`polymer`,e[e[`non-polymer`]=2]=`non-polymer`,e[e.macrolide=3]=`macrolide`,e[e.water=4]=`water`,e[e.branched=5]=`branched`})(qEe||={});var iI;(function(e){e[e.Unknown=0]=`Unknown`,e[e.Other=1]=`Other`,e[e.Water=2]=`Water`,e[e.Ion=3]=`Ion`,e[e.Lipid=4]=`Lipid`,e[e.Protein=5]=`Protein`,e[e.RNA=6]=`RNA`,e[e.DNA=7]=`DNA`,e[e.PNA=8]=`PNA`,e[e.Saccharide=9]=`Saccharide`})(iI||={});var aI;(function(e){e[e.NA=0]=`NA`,e[e.Protein=1]=`Protein`,e[e.GammaProtein=2]=`GammaProtein`,e[e.BetaProtein=3]=`BetaProtein`,e[e.RNA=4]=`RNA`,e[e.DNA=5]=`DNA`,e[e.PNA=6]=`PNA`})(aI||={});const JEe={[aI.NA]:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},[aI.Protein]:{trace:new Set([`CA`]),directionFrom:new Set([`C`]),directionTo:new Set([`O`,`OC1`,`O1`,`OX1`,`OXT`,`OT1`]),backboneStart:new Set([`N`]),backboneEnd:new Set([`C`]),coarseBackbone:new Set([`CA`,`CA1`,`BB`,`BAS`])},[aI.GammaProtein]:{trace:new Set([`CA`]),directionFrom:new Set([`C`]),directionTo:new Set([`O`]),backboneStart:new Set([`N`]),backboneEnd:new Set([`CD`]),coarseBackbone:new Set([`CA`])},[aI.BetaProtein]:{trace:new Set([`CA`]),directionFrom:new Set([`C`]),directionTo:new Set([`O`]),backboneStart:new Set([`N`]),backboneEnd:new Set([`CG`]),coarseBackbone:new Set([`CA`])},[aI.RNA]:{trace:new Set([`O3'`,`O3*`]),directionFrom:new Set([`C4'`,`C4*`]),directionTo:new Set([`C3'`,`C3*`]),backboneStart:new Set([`P`]),backboneEnd:new Set([`O3'`,`O3*`]),coarseBackbone:new Set([`P`])},[aI.DNA]:{trace:new Set([`O3'`,`O3*`]),directionFrom:new Set([`C3'`,`C3*`]),directionTo:new Set([`C1'`,`C1*`]),backboneStart:new Set([`P`]),backboneEnd:new Set([`O3'`,`O3*`]),coarseBackbone:new Set([`P`])},[aI.PNA]:{trace:new Set([`N4'`,`N4*`]),directionFrom:new Set([`N4'`,`N4*`]),directionTo:new Set([`C7'`,`C7*`]),backboneStart:new Set([`N1'`,`N1*`]),backboneEnd:new Set([`C'`,`C*`]),coarseBackbone:new Set([`P`])}},oI=new Set([`CA`,`C`,`N`,`O`,`O1`,`O2`,`OC1`,`OC2`,`OT1`,`OT2`,`OX1`,`OXT`,`H`,`H1`,`H2`,`H3`,`HA`,`HN`,`HXT`,`BB`]),sI=new Set(`P.OP1.OP2.HOP2.HOP3.O2'.O3'.O4'.O5'.C1'.C2'.C3'.C4'.C5'.H1'.H2'.H2''.HO2'.H3'.H4'.H5'.H5''.HO3'.HO5'.O2*.O3*.O4*.O5*.C1*.C2*.C3*.C4*.C5*`.split(`.`)),cI=new Set([`d-peptide linking`,`d-peptide nh3 amino terminus`,`d-peptide cooh carboxy terminus`,`d-gamma-peptide, c-delta linking`,`d-beta-peptide, c-gamma linking`]),lI=new Set([`l-peptide linking`,`l-peptide nh3 amino terminus`,`l-peptide cooh carboxy terminus`,`l-gamma-peptide, c-delta linking`,`l-beta-peptide, c-gamma linking`]),YEe=new Set([`d-gamma-peptide, c-delta linking`,`l-gamma-peptide, c-delta linking`]),XEe=new Set([`d-beta-peptide, c-gamma linking`,`l-beta-peptide, c-gamma linking`]),ZEe=new Set([`d-peptide nh3 amino terminus`,`d-peptide cooh carboxy terminus`,`l-peptide nh3 amino terminus`,`l-peptide cooh carboxy terminus`]),uI=new Set([`peptide linking`,`peptide-like`]),QEe=$F.unionMany(cI,lI,uI),dI=new Set([`dna linking`,`l-dna linking`,`dna oh 5 prime terminus`,`dna oh 3 prime terminus`]),fI=new Set([`rna linking`,`l-rna linking`,`rna oh 5 prime terminus`,`rna oh 3 prime terminus`]),pI=$F.unionMany(new Set([`d-saccharide, beta linking`,`l-saccharide, beta linking`,`d-saccharide, alpha linking`,`l-saccharide, alpha linking`,`l-saccharide`,`d-saccharide`,`saccharide`]),new Set([`d-saccharide 1,4 and 1,4 linking`,`l-saccharide 1,4 and 1,4 linking`,`d-saccharide 1,4 and 1,6 linking`,`l-saccharide 1,4 and 1,6 linking`])),$Ee=new Set([`non-polymer`,`other`]),eDe=new Set([`ion`]),tDe=new Set([`lipid`]),mI=new Set([`SOL`,`WAT`,`HOH`,`H2O`,`W`,`DOD`,`D3O`,`TIP`,`TIP3`,`TIP4`,`SPC`]),hI=new Set(`HIS.ARG.LYS.ILE.PHE.LEU.TRP.ALA.MET.PRO.CYS.ASN.VAL.GLY.SER.GLN.TYR.ASP.GLU.THR.SEC.PYL.UNK.MSE.SEP.TPO.PTR.PCA.HYP.HSD.HSE.HSP.LSN.ASPP.GLUP.HID.HIE.HIP.LYN.ASH.GLH`.split(`.`)),gI=new Set([`DAL`,`DAR`,`DSG`,`DAS`,`DCY`,`DGL`,`DGN`,`DHI`,`DIL`,`DLE`,`DLY`,`MED`,`DPN`,`DPR`,`DSN`,`DTH`,`DTR`,`DTY`,`DVA`,`DNE`]),_I=$F.unionMany(hI,gI),nDe=new Set([`NME`,`ACE`,`NH2`,`FOR`,`FMT`]),vI=new Set([`A`,`C`,`T`,`G`,`I`,`U`,`N`]),yI=new Set([`DA`,`DC`,`DT`,`DG`,`DI`,`DU`,`DN`]),bI=new Set([`APN`,`CPN`,`TPN`,`GPN`]),rDe=new Set([`A`,`G`,`I`,`DA`,`DG`,`DI`,`APN`,`GPN`]),iDe=new Set([`C`,`T`,`U`,`DC`,`DT`,`DU`,`CPN`,`TPN`]),xI=$F.unionMany(vI,yI,bI),aDe=e=>rDe.has(e.toUpperCase()),oDe=e=>iDe.has(e.toUpperCase()),SI=$F.unionMany(_I,xI);function CI(e,t){return t=t.toUpperCase(),bI.has(t)?iI.PNA:QEe.has(e)?iI.Protein:fI.has(e)?iI.RNA:dI.has(e)?iI.DNA:pI.has(e)?iI.Saccharide:mI.has(t)?iI.Water:tI.has(t)?iI.Ion:eI.has(t)?iI.Lipid:$Ee.has(e)?QF.has(t)?iI.Saccharide:_I.has(t)?iI.Protein:vI.has(t)?iI.RNA:yI.has(t)?iI.DNA:iI.Other:iI.Unknown}function sDe(e,t){return t===iI.Protein?YEe.has(e)?aI.GammaProtein:XEe.has(e)?aI.BetaProtein:ZEe.has(e)?aI.NA:aI.Protein:t===iI.RNA?aI.RNA:t===iI.DNA?aI.DNA:t===iI.PNA?aI.PNA:aI.NA}function wI(e){return e=e.toUpperCase(),_I.has(e)?`peptide linking`:vI.has(e)?`rna linking`:yI.has(e)?`dna linking`:QF.has(e)?`saccharide`:`other`}function cDe(e){return{formula:``,formula_weight:0,id:e,name:e,mon_nstd_flag:SI.has(e)?`y`:`n`,pdbx_synonyms:[],type:wI(e)}}function lDe(e){return e=e.toUpperCase(),mI.has(e)?`water`:SI.has(e)?`polymer`:QF.has(e)?`branched`:`non-polymer`}function uDe(e,t){return e=e.toUpperCase(),lI.has(t)?`polypeptide(L)`:cI.has(t)?`polypeptide(D)`:fI.has(t)?`polyribonucleotide`:dI.has(t)?`polydeoxyribonucleotide`:pI.has(t)||QF.has(e)?`oligosaccharide`:bI.has(e)?`peptide nucleic acid`:hI.has(e)?`polypeptide(L)`:gI.has(e)?`polypeptide(D)`:vI.has(e)?`polyribonucleotide`:yI.has(e)?`polydeoxyribonucleotide`:eDe.has(t)||tI.has(e)?`ion`:tDe.has(t)||eI.has(e)?`lipid`:uI.has(t)?`peptide-like`:`other`}function TI(e){return EI(e)||DI(e)}function EI(e){return e===iI.DNA||e===iI.RNA||e===iI.PNA}function DI(e){return e===iI.Protein}var OI;(function(e){e.is=_x.has,e.create=_x.create;let t;(function(e){e[e.None=0]=`None`,e[e.DoubleHelix=1]=`DoubleHelix`,e[e.Helix=2]=`Helix`,e[e.Beta=4]=`Beta`,e[e.Bend=8]=`Bend`,e[e.Turn=16]=`Turn`,e[e.LeftHanded=32]=`LeftHanded`,e[e.RightHanded=64]=`RightHanded`,e[e.ClassicTurn=128]=`ClassicTurn`,e[e.InverseTurn=256]=`InverseTurn`,e[e.HelixOther=512]=`HelixOther`,e[e.Helix27=1024]=`Helix27`,e[e.Helix3Ten=2048]=`Helix3Ten`,e[e.HelixAlpha=4096]=`HelixAlpha`,e[e.HelixGamma=8192]=`HelixGamma`,e[e.HelixOmega=16384]=`HelixOmega`,e[e.HelixPi=32768]=`HelixPi`,e[e.HelixPolyproline=65536]=`HelixPolyproline`,e[e.DoubleHelixOther=131072]=`DoubleHelixOther`,e[e.DoubleHelixZ=262144]=`DoubleHelixZ`,e[e.DoubleHelixA=524288]=`DoubleHelixA`,e[e.DoubleHelixB=1048576]=`DoubleHelixB`,e[e.BetaOther=2097152]=`BetaOther`,e[e.BetaStrand=4194304]=`BetaStrand`,e[e.BetaSheet=8388608]=`BetaSheet`,e[e.BetaBarell=16777216]=`BetaBarell`,e[e.TurnOther=33554432]=`TurnOther`,e[e.Turn1=67108864]=`Turn1`,e[e.Turn2=134217728]=`Turn2`,e[e.Turn3=268435456]=`Turn3`,e[e.NA=536870912]=`NA`})(t=e.Flag||={}),e.SecondaryStructureMmcif={helx_lh_27_p:t.Helix|t.LeftHanded|t.Helix27,helx_lh_3t_p:t.Helix|t.LeftHanded|t.Helix3Ten,helx_lh_al_p:t.Helix|t.LeftHanded|t.HelixAlpha,helx_lh_a_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixA,helx_lh_b_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixB,helx_lh_ga_p:t.Helix|t.LeftHanded|t.HelixGamma,helx_lh_n:t.DoubleHelix|t.LeftHanded,helx_lh_om_p:t.Helix|t.LeftHanded|t.HelixOmega,helx_lh_ot_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixOther,helx_lh_ot_p:t.Helix|t.LeftHanded|t.HelixOther,helx_lh_p:t.Helix|t.LeftHanded,helx_lh_pi_p:t.Helix|t.LeftHanded|t.HelixPi,helx_lh_pp_p:t.Helix|t.LeftHanded|t.HelixPolyproline,helx_lh_z_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixZ,helx_n:t.DoubleHelix,helx_ot_n:t.DoubleHelix,helx_ot_p:t.Helix,helx_p:t.Helix,helx_rh_27_p:t.Helix|t.RightHanded|t.Helix27,helx_rh_3t_p:t.Helix|t.RightHanded|t.Helix3Ten,helx_rh_al_p:t.Helix|t.RightHanded|t.HelixAlpha,helx_rh_a_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixA,helx_rh_b_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixB,helx_rh_ga_p:t.Helix|t.RightHanded|t.HelixGamma,helx_rh_n:t.DoubleHelix|t.RightHanded,helx_rh_om_p:t.Helix|t.RightHanded|t.HelixOmega,helx_rh_ot_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixOther,helx_rh_ot_p:t.Helix|t.RightHanded|t.HelixOther,helx_rh_p:t.Helix|t.RightHanded,helx_rh_pi_p:t.Helix|t.RightHanded|t.HelixPi,helx_rh_pp_p:t.Helix|t.RightHanded|t.HelixPolyproline,helx_rh_z_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixZ,strn:t.Beta|t.BetaStrand,turn_ot_p:t.Turn|t.TurnOther,turn_p:t.Turn,turn_ty1p_p:t.Turn|t.InverseTurn|t.Turn1,turn_ty1_p:t.Turn|t.ClassicTurn|t.Turn1,turn_ty2p_p:t.Turn|t.InverseTurn|t.Turn2,turn_ty2_p:t.Turn|t.ClassicTurn|t.Turn2,turn_ty3p_p:t.Turn|t.InverseTurn|t.Turn3,turn_ty3_p:t.Turn|t.ClassicTurn|t.Turn3,bend:t.Bend,other:t.None},e.SecondaryStructurePdb={1:t.Helix|t.RightHanded|t.HelixAlpha,2:t.Helix|t.RightHanded|t.HelixOmega,3:t.Helix|t.RightHanded|t.HelixPi,4:t.Helix|t.RightHanded|t.HelixGamma,5:t.Helix|t.RightHanded|t.Helix3Ten,6:t.Helix|t.LeftHanded|t.HelixAlpha,7:t.Helix|t.LeftHanded|t.HelixOmega,8:t.Helix|t.LeftHanded|t.HelixGamma,9:t.Helix|t.Helix27,10:t.Helix|t.HelixPolyproline},e.SecondaryStructureStride={H:t.Helix|t.HelixAlpha,G:t.Helix|t.Helix3Ten,I:t.Helix|t.HelixPi,E:t.Beta|t.BetaSheet,B:t.Beta|t.BetaStrand,T:t.Turn,C:t.NA},e.SecondaryStructureDssp={H:t.Helix|t.HelixAlpha,B:t.Beta|t.BetaStrand,E:t.Beta|t.BetaSheet,G:t.Helix|t.Helix3Ten,I:t.Helix|t.HelixPi,T:t.Turn,S:t.Bend}})(OI||={});var kI;(function(e){e.is=_x.has;let t;(function(e){e[e.None=0]=`None`,e[e.Covalent=1]=`Covalent`,e[e.MetallicCoordination=2]=`MetallicCoordination`,e[e.HydrogenBond=4]=`HydrogenBond`,e[e.Disulfide=8]=`Disulfide`,e[e.Aromatic=16]=`Aromatic`,e[e.Computed=32]=`Computed`})(t=e.Flag||={});function n(e){return _x.create(e)}e.create=n;function r(t){return(t&e.Flag.Covalent)!==0}e.isCovalent=r;function i(e){return e===2**6-1}e.isAll=i,e.Names={covalent:t.Covalent,"metal-coordination":t.MetallicCoordination,"hydrogen-bond":t.HydrogenBond,disulfide:t.Disulfide,aromatic:t.Aromatic,computed:t.Computed};function a(t){return t in e.Names}e.isName=a;function o(e){switch(e){case`covalent`:return t.Covalent;case`metal-coordination`:return t.MetallicCoordination;case`hydrogen-bond`:return t.HydrogenBond;case`disulfide`:return t.Disulfide;case`aromatic`:return t.Aromatic;case`computed`:return t.Computed}}e.fromName=o;function s(e){let n=t.None;for(let t=0,r=e.length;t<r;++t)n|=o(e[t]);return n}e.fromNames=s})(kI||={});const AI={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};HO.atom_site.label_comp_id,HO.atom_site.label_seq_id,HO.atom_site.pdbx_PDB_ins_code,HO.atom_site.label_asym_id,HO.atom_site.label_entity_id,HO.atom_site.auth_atom_id,HO.atom_site.auth_seq_id,HO.atom_site.auth_asym_id,{...HO.chem_comp_bond},U.Schema.Str();const dDe={...HO.chem_comp,type:U.Schema.Aliased(U.Schema.str)};function fDe(e,t){let{ihm_model_group:n,ihm_model_group_link:r}=t,i=QD.pickRow(r,t=>r.model_id.value(t)===e);if(i){let e=QD.pickRow(n,e=>n.id.value(e)===i.group_id);if(e)return e.name}return``}function jI(e){for(let t=0,n=e.rowCount;t<n;t++)if(e.valueKind(t)===U.ValueKinds.Present)return!0;return!1}function MI(e,t,n){(!e[t].isDefined||!jI(e[t]))&&(e[t]=e[n]),(!e[n].isDefined||!jI(e[n]))&&(e[n]=e[t])}function pDe(e){let t=QD.ofColumns(e._schema,e);return MI(t,`label_atom_id`,`auth_atom_id`),MI(t,`label_comp_id`,`auth_comp_id`),MI(t,`label_seq_id`,`auth_seq_id`),MI(t,`label_asym_id`,`auth_asym_id`),MI(t,`label_entity_id`,`label_asym_id`),t}const NI={entry:HO.entry,struct:HO.struct,struct_asym:HO.struct_asym,ihm_model_list:HO.ihm_model_list,ihm_model_group:HO.ihm_model_group,ihm_model_group_link:HO.ihm_model_group_link,entity:HO.entity,entity_poly:HO.entity_poly,entity_poly_seq:HO.entity_poly_seq,pdbx_entity_branch:HO.pdbx_entity_branch,chem_comp:dDe,pdbx_chem_comp_identifier:HO.pdbx_chem_comp_identifier,atom_site:HO.atom_site,ihm_sphere_obj_site:HO.ihm_sphere_obj_site,ihm_gaussian_obj_site:HO.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:HO.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:HO.pdbx_molecule};function PI(e,t=!1){let n=Object.create(null);for(let t of Object.keys(NI))t in e?n[t]=e[t]:n[t]=QD.ofUndefinedColumns(NI[t],0);return t&&(n.atom_site=pDe(n.atom_site)),n}var mDe=[new Set([`CA`]),new Set([`C`]),new Set([`N`])],hDe=[new Set([`P`,`O3'`,`O3*`]),new Set([`C4'`,`C4*`]),new Set([`O2'`,`O2*`,`F2'`,`F2*`])],gDe=[new Set([`P`,`O3'`,`O3*`]),new Set([`C3'`,`C3*`]),new Set([`O2'`,`O2*`,`F2'`,`F2*`])],_De=new Set([`FMN`,`NCN`,`FNS`,`FMA`,`ATP`,`ADP`,`AMP`,`GTP`,`GDP`,`GMP`,`LIG`]),FI=(function(){let e=new Map;return[{id:`HIS`,name:`HISTIDINE`,type:`l-peptide linking`},{id:`ARG`,name:`ARGININE`,type:`l-peptide linking`},{id:`LYS`,name:`LYSINE`,type:`l-peptide linking`},{id:`ILE`,name:`ISOLEUCINE`,type:`l-peptide linking`},{id:`PHE`,name:`PHENYLALANINE`,type:`l-peptide linking`},{id:`LEU`,name:`LEUCINE`,type:`l-peptide linking`},{id:`TRP`,name:`TRYPTOPHAN`,type:`l-peptide linking`},{id:`ALA`,name:`ALANINE`,type:`l-peptide linking`},{id:`MET`,name:`METHIONINE`,type:`l-peptide linking`},{id:`CYS`,name:`CYSTEINE`,type:`l-peptide linking`},{id:`ASN`,name:`ASPARAGINE`,type:`l-peptide linking`},{id:`VAL`,name:`VALINE`,type:`l-peptide linking`},{id:`GLY`,name:`GLYCINE`,type:`peptide linking`},{id:`SER`,name:`SERINE`,type:`l-peptide linking`},{id:`GLN`,name:`GLUTAMINE`,type:`l-peptide linking`},{id:`TYR`,name:`TYROSINE`,type:`l-peptide linking`},{id:`ASP`,name:`ASPARTIC ACID`,type:`l-peptide linking`},{id:`GLU`,name:`GLUTAMIC ACID`,type:`l-peptide linking`},{id:`THR`,name:`THREONINE`,type:`l-peptide linking`},{id:`PRO`,name:`PROLINE`,type:`l-peptide linking`},{id:`SEC`,name:`SELENOCYSTEINE`,type:`l-peptide linking`},{id:`PYL`,name:`PYRROLYSINE`,type:`l-peptide linking`},{id:`MSE`,name:`SELENOMETHIONINE`,type:`l-peptide linking`},{id:`SEP`,name:`PHOSPHOSERINE`,type:`l-peptide linking`},{id:`TPO`,name:`PHOSPHOTHREONINE`,type:`l-peptide linking`},{id:`PTR`,name:`O-PHOSPHOTYROSINE`,type:`l-peptide linking`},{id:`PCA`,name:`PYROGLUTAMIC ACID`,type:`l-peptide linking`},{id:`A`,name:`ADENOSINE-5'-MONOPHOSPHATE`,type:`rna linking`},{id:`C`,name:`CYTIDINE-5'-MONOPHOSPHATE`,type:`rna linking`},{id:`T`,name:`THYMIDINE-5'-MONOPHOSPHATE`,type:`rna linking`},{id:`G`,name:`GUANOSINE-5'-MONOPHOSPHATE`,type:`rna linking`},{id:`I`,name:`INOSINIC ACID`,type:`rna linking`},{id:`U`,name:`URIDINE-5'-MONOPHOSPHATE`,type:`rna linking`},{id:`DA`,name:`2'-DEOXYADENOSINE-5'-MONOPHOSPHATE`,type:`dna linking`},{id:`DC`,name:`2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE`,type:`dna linking`},{id:`DT`,name:`THYMIDINE-5'-MONOPHOSPHATE`,type:`dna linking`},{id:`DG`,name:`2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE`,type:`dna linking`},{id:`DI`,name:`2'-DEOXYINOSINE-5'-MONOPHOSPHATE`,type:`dna linking`},{id:`DU`,name:`2'-DEOXYURIDINE-5'-MONOPHOSPHATE`,type:`dna linking`}].forEach(t=>e.set(t.id,t)),e})(),II=(function(){let e=new Map;return[{id:`ZN2`,name:`ZINC ION`,type:`ion`},{id:`SOD`,name:`SODIUM ION`,type:`ion`},{id:`CES`,name:`CESIUM ION`,type:`ion`},{id:`CLA`,name:`CHLORIDE ION`,type:`ion`},{id:`CAL`,name:`CALCIUM ION`,type:`ion`},{id:`POT`,name:`POTASSIUM ION`,type:`ion`}].forEach(t=>e.set(t.id,t)),e})(),LI=class{set(e){this.comps.set(e.id,e),this.ids.push(e.id),this.names.push(e.name),this.types.push(e.type),this.mon_nstd_flags.push(SI.has(e.id)?`y`:`n`)}getAtomIds(e){let t=new Set,n=this.seqId.value(e);for(;e<this.seqId.rowCount;){let r=this.seqId.value(e);if(r!==n)break;t.add(this.atomId.value(e)),n-r,e+=1}return t}hasAtomIds(e,t){for(let n=0,r=t.length;n<r;++n)if(!$F.areIntersecting(e,t[n]))return!1;return!0}getType(e){return this.hasAtomIds(e,mDe)?`peptide linking`:this.hasAtomIds(e,hDe)?`rna linking`:this.hasAtomIds(e,gDe)?`dna linking`:`other`}has(e){return this.comps.has(e)}get(e){return this.comps.get(e)}add(e,t){if(!this.has(e))if(FI.has(e))this.set(FI.get(e));else if(mI.has(e))this.set({id:e,name:`WATER`,type:`non-polymer`});else if(_De.has(e.toUpperCase()))this.set({id:e,name:this.namesMap.get(e)||e,type:`non-polymer`});else if(QF.has(e.toUpperCase()))this.set({id:e,name:this.namesMap.get(e)||e,type:`saccharide`});else{let n=this.getAtomIds(t);if(n.size===1&&II.has(e))this.set(II.get(e));else{let t=this.getType(n);this.set({id:e,name:this.namesMap.get(e)||e,type:t})}}return this.get(e)}getChemCompTable(){return QD.ofPartialColumns(NI.chem_comp,{id:U.ofStringArray(this.ids),name:U.ofStringArray(this.names),type:U.ofStringAliasArray(this.types),mon_nstd_flag:U.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(e){e.forEach(e=>this.namesMap.set(e[0],e[1]))}constructor(e,t){this.seqId=e,this.atomId=t,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}},RI=`ABCDEFGHIJKLMNOPQRSTUVWXYZ`;function vDe(e){let t=e,n=0,r=RI[t%26];for(;t>=26;)t=Math.floor(t/26),r+=RI[t%26],n+=1;return n>=5&&console.warn(`getChainId overflow`),r}const zI=_A(vDe);var BI=class{constructor(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}set(e,t){this.count+=1,this.ids.push(`${this.count}`),this.types.push(e),this.descriptions.push([t])}getEntityId(e,t,n,r){return t===iI.Water?(this.waterId===void 0&&(this.set(`water`,r?.customName||`Water`),this.waterId=`${this.count}`),this.waterId):TI(t)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set(`polymer`,r?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(n,`${this.count}`)),this.chainMap.get(n)):(this.heteroMap.has(e)||(this.set(`non-polymer`,r?.customName||this.namesMap.get(e)||e),this.heteroMap.set(e,`${this.count}`)),this.heteroMap.get(e))}getEntityTable(){return QD.ofPartialColumns(NI.entity,{id:U.ofStringArray(this.ids),type:U.ofStringAliasArray(this.types),pdbx_description:U.ofStringListArray(this.descriptions)},this.count)}setCompounds(e){for(let t=0,n=e.length;t<n;++t){let{chains:n,description:r}=e[t];this.set(`polymer`,r);for(let e=0,t=n.length;e<t;++e)this.compoundsMap.set(n[e],`${this.count}`)}}setNames(e){e.forEach(e=>this.namesMap.set(e[0],e[1]))}};const yDe={type_symbol:U.Schema.Aliased(HO.atom_site.type_symbol),label_atom_id:HO.atom_site.label_atom_id,auth_atom_id:HO.atom_site.auth_atom_id,label_alt_id:HO.atom_site.label_alt_id,label_comp_id:HO.atom_site.label_comp_id,auth_comp_id:HO.atom_site.auth_comp_id,pdbx_formal_charge:HO.atom_site.pdbx_formal_charge},bDe={group_PDB:HO.atom_site.group_PDB,label_seq_id:HO.atom_site.label_seq_id,auth_seq_id:HO.atom_site.auth_seq_id,pdbx_PDB_ins_code:HO.atom_site.pdbx_PDB_ins_code},xDe={label_asym_id:HO.atom_site.label_asym_id,auth_asym_id:HO.atom_site.auth_asym_id,label_entity_id:HO.atom_site.label_entity_id};var VI;(function(e){function t(){return{label_entity_id:``,label_asym_id:``,auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(VI||={});var HI;(function(e){function t(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t]]}e.chainStartResidueIndex=t;function n(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t+1]-1]+1}e.chainEndResidueIndexExcl=n;function r(e,r){return n(e,r)-t(e,r)}e.chainResidueCount=r;function i(e,t){return e.residueAtomSegments.offsets[t]}e.residueFirstAtomIndex=i;function a(e,t){return e.chainAtomSegments.index[t]}e.atomChainIndex=a;function o(e,t){return e.chainAtomSegments.index[e.residueAtomSegments.offsets[t]]}e.residueChainIndex=o})(HI||={});const UI={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},SDe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},CDe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156};function WI(e){let t=UI[e];return t===void 0?1.7:SDe[t]}function wDe(e){let t=UI[e];return t===void 0?10.81:CDe[t]}function GI(e){let t=UI[e];return t===void 0?0:t}function TDe(e,t){let n=[],r=[],i=[];e.x.length&&(n.push(...SE(e.x)),r.push(...SE(e.y)),i.push(...SE(e.z))),t&&(t.spheres.x.length&&(n.push(...SE(t.spheres.x)),r.push(...SE(t.spheres.y)),i.push(...SE(t.spheres.z))),t.gaussians.x.length&&(n.push(...SE(t.gaussians.x)),r.push(...SE(t.gaussians.y)),i.push(...SE(t.gaussians.z))));let[a,o]=SE(n),[s,c]=SE(r),[l,u]=SE(i),d=a+(o-a)/2,f=s+(c-s)/2,p=l+(u-l)/2;return B.create(d,f,p)}function EDe(e){let t=new Set,n=new Set;return e.properties.structAsymMap.forEach(({auth_id:e},r)=>{t.add(e),n.add(r)}),{auth:t.size,label:n.size}}var KI;(function(e){function t(e,t){if(e===t)return!0;if(e.vertexCount!==t.vertexCount||e.edgeCount!==t.edgeCount)return!1;let{a:n,b:r,offset:i}=e,{a,b:o,offset:s}=t;for(let t=0,r=e.a.length;t<r;t++)if(n[t]!==a[t])return!1;for(let t=0,n=e.b.length;t<n;t++)if(r[t]!==o[t])return!1;for(let t=0,n=e.offset.length;t<n;t++)if(i[t]!==s[t])return!1;for(let n of Object.keys(e.edgeProps)){let r=e.edgeProps[n],i=t.edgeProps[n];if(!i)return!1;for(let e=0,t=r.length;e<t;e++)if(r[e]!==i[e])return!1}return!0}e.areEqual=t;class n{getEdgeIndex(e,t){let n,r;e<t?(n=e,r=t):(n=t,r=e);for(let e=this.offset[n],t=this.offset[n+1];e<t;e++)if(this.b[e]===r)return e;return-1}getDirectedEdgeIndex(e,t){for(let n=this.offset[e],r=this.offset[e+1];n<r;n++)if(this.b[n]===t)return n;return-1}getVertexEdgeCount(e){return this.offset[e+1]-this.offset[e]}constructor(e,t,n,r,i,a){this.offset=e,this.a=t,this.b=n,this.edgeCount=r,this.props=a,this.vertexCount=e.length-1,this.edgeProps=i||{}}}function r(e,t,r,i,a,o){return new n(e,t,r,i,a,o)}e.create=r;class i{createGraph(e,t){return r(this.offsets,this.a,this.b,this.edgeCount,e,t)}addNextEdge(){let e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e];this.a[n]=e,this.b[n]=t,this.bucketFill[e]++;let r=this.offsets[t]+this.bucketFill[t];this.a[r]=t,this.b[r]=e,this.bucketFill[t]++,this.current++,this.curA=n,this.curB=r}addAllEdges(){for(let e=0;e<this.edgeCount;e++)this.addNextEdge()}assignProperty(e,t){e[this.curA]=t,e[this.curB]=t}assignDirectedProperty(e,t,n,r){e[this.curA]=t,e[this.curB]=r,n[this.curB]=t,n[this.curA]=r}constructor(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.curB=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let r=new Int32Array(this.vertexCount);for(let e=0,t=this.xs.length;e<t;e++)r[this.xs[e]]++;for(let e=0,t=this.ys.length;e<t;e++)r[this.ys[e]]++;let i=0;for(let e=0;e<this.vertexCount;e++)this.offsets[e]=i,i+=r[e];this.offsets[this.vertexCount]=i,this.slotCount=i,this.a=new Int32Array(i),this.b=new Int32Array(i)}}e.EdgeBuilder=i;class a{createGraph(e,t){return r(this.offsets,this.a,this.b,this.edgeCount,e,t)}addNextEdge(){let e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e];this.a[n]=e,this.b[n]=t,this.bucketFill[e]++,this.current++,this.curA=n}addAllEdges(){for(let e=0;e<this.edgeCount;e++)this.addNextEdge()}assignProperty(e,t){e[this.curA]=t}constructor(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let r=new Int32Array(this.vertexCount);for(let e=0,t=this.xs.length;e<t;e++)r[this.xs[e]]++;let i=0;for(let e=0;e<this.vertexCount;e++)this.offsets[e]=i,i+=r[e];this.offsets[this.vertexCount]=i,this.slotCount=i,this.a=new Int32Array(i),this.b=new Int32Array(i)}}e.DirectedEdgeBuilder=a;class o{addEdge(e,t){let n=e,r=t;e>t&&(n=t,r=e);let i=pE(n,r);return this.included.has(i)?!1:(this.included.add(i),this.xs[this.xs.length]=n,this.ys[this.ys.length]=r,!0)}getGraph(){return s(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new i(this.vertexCount,this.xs,this.ys)}constructor(e){this.vertexCount=e,this.xs=[],this.ys=[],this.included=new Set}}e.UniqueEdgeBuilder=o;function s(t,n,r){let i=new e.EdgeBuilder(t,n,r);return i.addAllEdges(),i.createGraph({})}e.fromVertexPairs=s;function c(e,t,n){let{b:i,offset:a,vertexCount:o,edgeProps:s}=e,c=new Int32Array(o);for(let e=0,n=t.length;e<n;e++)c[t[e]]=e+1;let l=0;for(let e=0;e<o;e++)if(c[e]!==0)for(let t=a[e],n=a[e+1];t<n;t++)i[t]>e&&c[i[t]]!==0&&l++;let u=new Int32Array(t.length+1),d=new Int32Array(2*l),f=new Int32Array(2*l),p=new Int32Array(2*l),m=0,h=0;for(let e=0;e<o;e++){if(c[e]===0)continue;let t=c[e]-1;for(let n=a[e],r=a[e+1];n<r;n++){let e=c[i[n]];e!==0&&(f[m]=t,p[m]=e-1,d[m]=n,m++)}u[++h]=m}let g={};for(let e of Object.keys(s))g[e]=fde(s[e],d);return r(u,f,p,l,g,n)}e.induceByVertices=c;function l(e){let t=e.vertexCount;if(t===0)return{componentCount:0,componentIndex:new Int32Array};if(e.edgeCount===0){let e=new Int32Array(t);for(let n=0,r=t;n<r;n++)e[n]=n;return{componentCount:t,componentIndex:e}}let n=new Int32Array(t);for(let e=0,r=t;e<r;e++)n[e]=-1;let r=0;n[0]=r;let{offset:i,b:a}=e,o=[0],s=rxe(t);for(s.remove(0);o.length>0;){let e=o.pop(),t=n[e];for(let r=i[e],c=i[e+1];r<c;r++){let e=a[r];s.has(e)&&(s.remove(e),o.push(e),n[e]=t)}o.length===0&&s.head>=0&&(o.push(s.head),n[s.head]=++r,s.remove(s.head))}return{componentCount:t,componentIndex:n}}e.connectedComponents=l;function u(e,t,n,r){if(Vk.areIntersecting(t,n))return!0;if(r<1)return!1;let i=new Set;for(let e=0,n=t.length;e<n;++e)i.add(t[e]);return qI(e,t,n,r,i)}e.areVertexSetsConnected=u})(KI||={});function qI(e,t,n,r,i){let{b:a,offset:o}=e,s=[];for(let e=0,r=t.length;e<r;++e){let r=t[e];for(let e=o[r],t=o[r+1];e<t;++e){let t=a[e];if(!i.has(t)){if(Vk.has(n,t))return!0;i.add(t),s[s.length]=t}}}return r>1?qI(e,s,n,r-1,i):!1}var DDe=class{constructor(){this.map=new Map,this.applicable=new Map}add(e,t,n){this.map.set(e,t),n&&this.applicable.set(e,n)}remove(e){this.map.delete(e),this.applicable.delete(e)}get(e){return this.map.get(e)}isApplicable(e){if(!this.map.has(e.sourceData.kind))return!1;let t=this.applicable.get(e.sourceData.kind);return t?t(e):!0}},JI;(function(e){function t(e,t){let{name:n}=e,r=new DDe;return{descriptor:e,formatRegistry:r,isApplicable(e){return r.isApplicable(e)},get(i){let a=t?.asDynamic?i._dynamicPropertyData:i._staticPropertyData;if(a[n])return a[n];if(i.customProperties.has(e))return;let o=r.get(i.sourceData.kind);if(o)return a[n]=o(i),i.customProperties.add(e),a[n]},set(e,r){t?.asDynamic?e._dynamicPropertyData[n]=r:e._staticPropertyData[n]=r},delete(e){t?.asDynamic?delete e._dynamicPropertyData[n]:delete e._staticPropertyData[n]}}}e.create=t})(JI||={});function ODe(e,t,n,r){let i=new KI.EdgeBuilder(r,e,t),a=new Int32Array(i.slotCount),o=Array(i.slotCount),s=Array(i.slotCount),c=new Int8Array(i.slotCount),l=Array(i.slotCount),u=Array(i.slotCount);for(let e=0,t=i.edgeCount;e<t;e++)i.addNextEdge(),i.assignProperty(a,n.key?n.key[e]:-1),i.assignDirectedProperty(o,n.operatorA?n.operatorA[e]:-1,s,n.operatorB?n.operatorB[e]:-1),i.assignProperty(c,n.order?n.order[e]:1),i.assignProperty(l,n.distance?n.distance[e]:-1),i.assignProperty(u,n.flag?n.flag[e]:kI.Flag.Covalent);return i.createGraph({key:a,operatorA:o,operatorB:s,order:c,distance:l,flag:u})}var YI;(function(e){e.Descriptor={name:`index_pair_bonds`},e.Provider=JI.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1,cacheable:!0};function t(t,n={}){let r={...e.DefaultProps,...n},{pairs:i,count:a}=t,o=i.indexA.toArray(),s=i.indexB.toArray(),c=i.key&&i.key.toArray(),l=i.operatorA&&i.operatorA.toArray(),u=i.operatorB&&i.operatorB.toArray(),d=i.order&&i.order.toArray(),f=i.distance&&i.distance.toArray(),p=i.flag&&i.flag.toArray(),m=!1;if(l&&u){m=!0;for(let e=0,t=l.length;e<t;++e)if(l[e]===-1||u[e]===-1){m=!1;break}}let h=ODe(o,s,{key:c,operatorA:l,operatorB:u,order:d,distance:f,flag:p},a),g=new Map;if(m){let{operatorA:e,operatorB:t}=h.edgeProps;for(let n=0,r=e.length;n<r;++n)if(e[n]===t[n]){let t=e[n];g.has(t)?g.get(t).push(n):g.set(t,[n])}}return{bonds:h,maxDistance:r.maxDistance,cacheable:r.cacheable,hasOperators:m,bySameOperator:g}}e.fromData=t;function n(e,t,n,r,i){let a,o,s,c;t<n?(a=t,o=n,s=r,c=i):(a=n,o=t,s=i,c=r);for(let t=e.offset[a],n=e.offset[a+1];t<n;t++)if(e.b[t]===o&&e.edgeProps.operatorA[t]===s&&e.edgeProps.operatorB[t]===c)return t;return-1}e.getEdgeIndexForOperators=n})(YI||={});var XI=class{get operatorGroups(){return this._operators||=this.operatorsProvider(),this._operators}constructor(e,t,n){this.operatorsProvider=n,this.id=e,this.details=t}};(function(e){function t(t,n,r){return new e(t,n,r)}e.create=t})(XI||={});var ZI;(function(e){e.Default={assemblies:[],spacegroup:sA.ZeroP1,isNonStandardCrystalFrame:!1};function t(e,t){let n=t.toLocaleLowerCase(),r=bB.Provider.get(e);return r?px(r.assemblies,e=>e.id.toLowerCase()===n):void 0}e.findAssembly=t;function n(e){let{cell:t,name:n,num:r}=e.spacegroup,{size:i,anglesInRadians:a}=t,o=i[0].toFixed(2),s=i[1].toFixed(2),c=i[2].toFixed(2),l=IT(a[0]).toFixed(2),u=IT(a[1]).toFixed(2),d=IT(a[2]).toFixed(2),f=[];return f.push(`Unit Cell <b>${n}</b> #${r}`),f.push(`${o}\u00D7${s}\u00D7${c} \u212B`),f.push(`\u03b1=${l}\u00B0 \u03b2=${u}\u00B0 \u03b3=${d}\u00B0`),f.join(` | `)}e.getUnitcellLabel=n})(ZI||={});var QI;(function(e){function t(e,t,n,r){return{id:zy.create22(),label:e,basic:t,sourceData:r,bonds:n}}e.create=t})(QI||={});var kDe={HIS:`H`,ARG:`R`,LYS:`K`,ILE:`I`,PHE:`F`,LEU:`L`,TRP:`W`,ALA:`A`,MET:`M`,PRO:`P`,CYS:`C`,ASN:`N`,VAL:`V`,GLY:`G`,SER:`S`,GLN:`Q`,TYR:`Y`,ASP:`D`,GLU:`E`,THR:`T`,SEC:`U`,PYL:`O`,HSD:`H`,HSE:`H`,HSP:`H`,LSN:`K`,ASPP:`D`,GLUP:`E`,HID:`H`,HIE:`H`,HIP:`H`,LYN:`K`,ASH:`D`,GLH:`E`},ADe={DA:`A`,DC:`C`,DG:`G`,DT:`T`,DU:`U`},jDe={A:`A`,C:`C`,G:`G`,T:`T`,U:`U`};function $I(e){return kDe[e]||`X`}function eL(e){return jDe[e]||`X`}function tL(e){return ADe[e]||`X`}var nL;(function(e){let t;(function(e){e.Protein=`protein`,e.RNA=`RNA`,e.DNA=`DNA`,e.Generic=`generic`})(t=e.Kind||={});function n(e){let t=e.code.toArray();return(t instanceof Array?t:Array.from(t)).join(``)}e.getSequenceString=n;function r(e){for(let n=0,r=Math.min(e.rowCount,10);n<r;n++){let r=e.value(n)||``;if($I(r)!==`X`)return t.Protein;if(eL(r)!==`X`)return t.RNA;if(tL(r)!==`X`)return t.DNA}return t.Generic}function i(e,n){let r;switch(e){case t.Protein:r=$I;break;case t.DNA:r=tL;break;case t.RNA:r=eL;break;case t.Generic:r=()=>`X`;break;default:Lb(e)}return n&&n.size>0?e=>{let t=r(e);return t!==`X`||!n.has(e)?t:r(n.get(e))}:r}function a(e,t){if(t.rowCount===0)throw Error(`cannot be empty`);return new o(r(e),e,t)}e.ofResidueNames=a;class o{index(e){return this.indexMap.get(e)}constructor(e,t,n){this.kind=e,this.microHet=new Map;let r=i(e),a=[],o=[],s=[],c=new Map,l=0,u=new Map;for(let e=0,i=n.rowCount;e<i;++e){let i=n.value(e);if(u.has(i))c.has(i)?c.get(i).push(t.value(e)):c.set(i,[o[u.get(i)],t.value(e)]);else{u.set(i,l);let n=t.value(e);o[l]=n,s[l]=i,a[l]=r(n),l+=1}}let d=[];for(let e=0,t=l;e<t;++e){let t=c.get(s[e]);t?d[e]=`(${t.map(e=>{let t=r(e);return t===`X`?e:t}).join(`|`)})`:d[e]=a[e]===`X`?o[e]:a[e]}this.length=l,this.code=U.ofStringArray(a),this.compId=U.ofStringArray(o),this.seqId=U.ofIntArray(s),this.label=U.ofStringArray(d),this.microHet=c,this.indexMap=u}}function s(e,n){let r=t.Generic;return new c(r,e,n)}e.ofSequenceRanges=s;class c{index(e){return e-this.minSeqId}constructor(e,t,n){this.kind=e,this.seqIdStart=t,this.seqIdEnd=n,this.microHet=new Map;let r=0,i=2**53-1;for(let e=0,t=this.seqIdStart.rowCount;e<t;e++){let t=this.seqIdStart.value(e),n=this.seqIdEnd.value(e);t<i&&(i=t),r<n&&(r=n)}let a=r-i+1;this.code=U.ofConst(`X`,a,U.Schema.str),this.label=U.ofConst(``,a,U.Schema.str),this.seqId=U.ofLambda({value:e=>e+i+1,rowCount:a,schema:U.Schema.int}),this.compId=U.ofConst(``,a,U.Schema.str),this.length=a,this.minSeqId=i}}})(nL||={});var rL;(function(e){let t={byEntityKey:{},sequences:[]};function n(...e){let t=[],n={};for(let r=0,i=e.length;r<i;++r)t.push(...e[r].sequences),Object.assign(n,e[r].byEntityKey);return{sequences:t,byEntityKey:n}}function r(e,r,o){return n(i(e,r),o.isDefined?a(e,o):t)}e.fromHierarchy=r;function i(e,t){let{label_comp_id:n}=t.atoms,{label_seq_id:r}=t.residues,{chainAtomSegments:i,residueAtomSegments:a}=t,{count:o,offsets:s}=i,c={},l=[];if(o===1&&s[0]===0&&s[1]===0)return{byEntityKey:c,sequences:l};for(let i=0,o=t.chains._rowCount;i<o;i++){let u=t.index.getEntityFromChain(i);if(c[u]!==void 0||e.data.type.value(u)!==`polymer`)continue;let d=i;for(i++;i<o&&u===t.index.getEntityFromChain(i)&&e.data.type.value(u)!==`polymer`;)i++;i--;let f=a.index[s[d]],p=a.index[s[i+1]-1]+1,m=U.window(r,f,p),h=[];for(let e=f;e<p;++e)h.push(n.value(a.offsets[e]));let g=U.ofStringArray(h);c[u]={entityId:e.data.id.value(u),sequence:nL.ofResidueNames(g,m)},l.push(c[u])}return{byEntityKey:c,sequences:l}}e.fromAtomicHierarchy=i;function a(e,t){return n(o(e,t.spheres),o(e,t.gaussians))}e.fromCoarseHierarchy=a;function o(e,t){let{chainElementSegments:n,seq_id_begin:r,seq_id_end:i}=t,{count:a,offsets:o}=n,s={},c=[];if(a===1&&o[0]===0&&o[1]===0)return{byEntityKey:s,sequences:c};for(let n=0,l=a;n<l;n++){let a=t.getEntityFromChain(n);if(s[a]!==void 0)continue;let u=n;for(n++;n<l&&a===t.getEntityFromChain(n);)n++;n--;let d=o[u],f=o[n+1]-1,p=U.window(r,d,f),m=U.window(i,d,f);s[a]={entityId:e.data.id.value(a),sequence:nL.ofSequenceRanges(p,m)},c.push(s[a])}return{byEntityKey:s,sequences:c}}e.fromCoarseElements=o})(rL||={});var iL;(function(e){function t(e,t,n){return{kind:`element-location`,structure:e,unit:t,element:n||0}}e.create=t;function n(e){return t(e.structure,e.unit,e.element)}e.clone=n;function r(e,t,n,r){return t&&(e.structure=t),n&&(e.unit=n),r!==void 0&&(e.element=r),e}e.set=r;function i(e,t){return e.unit=t.unit,e.element=t.element,e}e.copy=i;function a(e){return!!e&&e.kind===`element-location`}e.is=a;function o(e,t){return e.unit===t.unit&&e.element===t.element}e.areEqual=o;let s=B(),c=B();function l(e,t){return e.unit.conformation.position(e.element,s),t.unit.conformation.position(t.element,c),B.distance(s,c)}e.distance=l;function u(e,t){return t.unit.conformation.position(t.element,e)}e.position=u;function d(e){return e.unit.model.atomicHierarchy.residueAtomSegments.index[e.element]}e.residueIndex=d;function f(e){return e.unit.model.atomicHierarchy.chainAtomSegments.index[e.element]}e.chainIndex=f})(iL||={});var MDe=class{add(e){let t=this.getHash(e);if(this.byHash.has(t)){let n=this.byHash.get(t);for(let t=0,r=n.length;t<r;t++)if(this.areEqual(e,n[t]))return!1;return n[n.length]=e,this.size++,!0}else return this.byHash.set(t,[e]),this.size++,!0}has(e){let t=this.getHash(e);if(!this.byHash.has(t))return!1;let n=this.byHash.get(t);for(let t=0,r=n.length;t<r;t++)if(this.areEqual(e,n[t]))return!0;return!1}constructor(e,t){this.getHash=e,this.areEqual=t,this.size=0,this.byHash=new Map}};function aL(e,t){return new MDe(e,t)}function oL(){return new NDe}function sL(e){return{previous:null,next:null,inList:!0,value:e}}var NDe=class{constructor(){this.count=0,this.first=null,this.last=null}addFirst(e){let t=sL(e);return t.inList=!0,this.first&&(this.first.previous=t),t.next=this.first,this.first=t,this.count++,this.last||=t,t}addLast(e){let t=sL(e);return this.last!==null&&(this.last.next=t),t.previous=this.last,this.last=t,this.first===null&&(this.first=t),t.inList=!0,this.count++,t}removeFirst(){let e=this.first;if(e)return this.remove(e),e.value}removeLast(){let e=this.last;if(e)return this.remove(e),e.value}remove(e){e.inList&&(e.inList=!1,e.previous===null?e.previous===null&&(this.first=e.next):e.previous.next=e.next,e.next===null?e.next===null&&(this.last=e.previous):e.next.previous=e.previous,e.next=null,e.previous=null,this.count--)}find(e){let t=this.first;for(;t!==null;){if(t.value===e)return t;t=t.next}}},Y;(function(e){function t(e,t,n){return{kind:`variable`,name:e,type:t,isConstraint:n}}e.Variable=t;function n(e,t,n){return{kind:`value`,namespace:e,name:t,parent:n}}e.Value=n;function r(e,t,n,r){return{kind:`container`,namespace:e,name:t,child:n,alias:r}}e.Container=r;function i(e){return{kind:`union`,types:e}}e.Union=i;function a(e,t,n,r){let i=Object.create(null);for(let e of r)i[e]=!0;return{kind:`oneof`,namespace:e,name:t,type:n,values:i}}e.OneOf=a,e.Any={kind:`any`},e.AnyValue={kind:`any-value`},e.Num=n(``,`Number`),e.Str=n(``,`String`),e.Bool=a(``,`Bool`,e.Str,[`true`,`false`]);function o({values:e}){return Object.keys(e).sort()}e.oneOfValues=o})(Y||={});var cL;(function(e){function t(e){return{name:e}}e.Symbol=t;function n(e,t){return t?{head:e,args:t}:{head:e}}e.Apply=n;function r(e){return!!e&&Array.isArray(e)}e.isArgumentsArray=r;function i(e){return!!e&&!Array.isArray(e)}e.isArgumentsMap=i;function a(e){return!o(e)&&!s(e)}e.isLiteral=a;function o(e){return!!e&&!!e.head&&typeof e==`object`}e.isApply=o;function s(e){return!!e&&typeof e.name==`string`}e.isSymbol=s})(cL||={});function lL(e,t){let{description:n=void 0,isOptional:r=!1,isRest:i=!1,defaultValue:a=void 0}=t||{};return{type:e,isOptional:r,isRest:i,defaultValue:a,description:n}}var uL;(function(e){e.None=t({});function t(e){return{kind:`dictionary`,map:e,"@type":0}}e.Dictionary=t;function n(e,t){let{nonEmpty:n=!1}=t||{};return{kind:`list`,type:e,nonEmpty:n,"@type":0}}e.List=n})(uL||={});function dL(e,t,n,r){let i=function(e){return cL.Apply(cL.Symbol(i.id),e)};return i.info={namespace:``,name:e,description:r},i.id=``,i.args=t,i.type=n,i}function fL(e,t,n,r){let i=function(e){return cL.Apply(cL.Symbol(i.id),e)};return i.info={namespace:e,name:t,description:r},i.id=`${e}.${t}`,i.args=uL.None,i.type=n,i}function pL(e){let t=e;return typeof t==`function`&&!!t.info&&!!t.args&&typeof t.info.namespace==`string`&&!!t.type}function mL(e,t,n){return dL(``,e,t,n)}function hL(e){vL(``,``,e)}function gL(e){let t=[];return yL(e,t),t}function _L(e){let t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,(e,t,n,r)=>`${t}-${n.toLocaleLowerCase()}${r}`).replace(t,(e,t,n,r)=>`${t}-${n.toLocaleLowerCase()}${r}`)}function vL(e,t,n){if(pL(n)){n.info.namespace=e,n.info.name=n.info.name||_L(t),n.id=`${n.info.namespace}.${n.info.name}`;return}let r=`${n[`@namespace`]||_L(t)}`,i=e?`${e}.${r}`:r;for(let e of Object.keys(n))typeof n[e]!=`object`&&!pL(n[e])||vL(i,e,n[e])}function yL(e,t){if(pL(e)){t.push(e);return}for(let n of Object.keys(e))typeof e[n]!=`object`&&!pL(e[n])||yL(e[n],t)}var bL;(function(e){e.AnyVar=Y.Variable(`a`,Y.Any),e.AnyValueVar=Y.Variable(`a`,Y.Any),e.ConstrainedVar=Y.Variable(`a`,Y.Any,!0),e.Regex=Y.Value(`Core`,`Regex`),e.Set=t=>Y.Container(`Core`,`Set`,t||e.AnyValueVar),e.List=t=>Y.Container(`Core`,`List`,t||e.AnyVar),e.Fn=(t,n)=>Y.Container(`Core`,`Fn`,t||e.AnyVar,n),e.Flags=(e,t)=>Y.Container(`Core`,`Flags`,e,t),e.BitFlags=e.Flags(Y.Num,`BitFlags`)})(bL||={});function xL(e,t){return mL(uL.Dictionary({0:lL(e)}),e,t)}function SL(e,t){return mL(uL.List(e,{nonEmpty:!0}),e,t)}function CL(e,t,n){return mL(uL.Dictionary({0:lL(e),1:lL(e)}),t,n)}uL.Dictionary({0:lL(Y.Num),1:lL(Y.Num)});var PDe={"@header":`Types`,bool:mL(uL.Dictionary({0:lL(Y.AnyValue)}),Y.Bool,`Convert a value to boolean.`),num:mL(uL.Dictionary({0:lL(Y.AnyValue)}),Y.Num,`Convert a value to number.`),str:mL(uL.Dictionary({0:lL(Y.AnyValue)}),Y.Str,`Convert a value to string.`),regex:mL(uL.Dictionary({0:lL(Y.Str,{description:`Expression`}),1:lL(Y.Str,{isOptional:!0,description:`Flags, e.g. 'i' for ignore case`})}),bL.Regex,`Creates a regular expression from a string using the ECMAscript syntax.`),list:mL(uL.List(bL.AnyVar),bL.List()),set:mL(uL.List(bL.AnyValueVar),bL.Set()),bitflags:mL(uL.Dictionary({0:lL(Y.Num)}),bL.BitFlags,`Interpret a number as bitflags.`),compositeKey:mL(uL.List(Y.AnyValue),Y.AnyValue)},FDe={"@header":`Logic`,not:xL(Y.Bool),and:SL(Y.Bool),or:SL(Y.Bool)},IDe={"@header":`Control`,eval:mL(uL.Dictionary({0:lL(bL.Fn(bL.AnyVar))}),bL.AnyVar,`Evaluate a function.`),fn:mL(uL.Dictionary({0:lL(bL.AnyVar)}),bL.Fn(bL.AnyVar),`Wrap an expression to a "lazy" function.`),if:mL(uL.Dictionary({0:lL(Y.Bool,{description:`Condition`}),1:lL(Y.Variable(`a`,Y.Any),{description:`If true`}),2:lL(Y.Variable(`b`,Y.Any),{description:`If false`})}),Y.Union([Y.Variable(`a`,Y.Any),Y.Variable(`b`,Y.Any)])),assoc:mL(uL.Dictionary({0:lL(Y.Str,{description:`Name`}),1:lL(Y.Variable(`a`,Y.Any),{description:`Value to assign`})}),Y.Variable(`a`,Y.Any))},LDe={"@header":`Relational`,eq:CL(Y.Variable(`a`,Y.AnyValue,!0),Y.Bool),neq:CL(Y.Variable(`a`,Y.AnyValue,!0),Y.Bool),lt:CL(Y.Num,Y.Bool),lte:CL(Y.Num,Y.Bool),gr:CL(Y.Num,Y.Bool),gre:CL(Y.Num,Y.Bool),inRange:mL(uL.Dictionary({0:lL(Y.Num,{description:`Value to test`}),1:lL(Y.Num,{description:`Minimum value`}),2:lL(Y.Num,{description:`Maximum value`})}),Y.Bool,`Check if the value of the 1st argument is >= 2nd and <= 3rd.`)},RDe={"@header":`Math`,add:SL(Y.Num),sub:SL(Y.Num),mult:SL(Y.Num),div:CL(Y.Num,Y.Num),pow:CL(Y.Num,Y.Num),mod:CL(Y.Num,Y.Num),min:SL(Y.Num),max:SL(Y.Num),cantorPairing:CL(Y.Num,Y.Num),sortedCantorPairing:CL(Y.Num,Y.Num),invertCantorPairing:mL(uL.Dictionary({0:lL(Y.Num)}),bL.List(Y.Num)),floor:xL(Y.Num),ceil:xL(Y.Num),roundInt:xL(Y.Num),trunc:xL(Y.Num),abs:xL(Y.Num),sign:xL(Y.Num),sqrt:xL(Y.Num),cbrt:xL(Y.Num),sin:xL(Y.Num),cos:xL(Y.Num),tan:xL(Y.Num),asin:xL(Y.Num),acos:xL(Y.Num),atan:xL(Y.Num),sinh:xL(Y.Num),cosh:xL(Y.Num),tanh:xL(Y.Num),exp:xL(Y.Num),log:xL(Y.Num),log10:xL(Y.Num),atan2:CL(Y.Num,Y.Num)},zDe={"@header":`Strings`,concat:SL(Y.Str),match:mL(uL.Dictionary({0:lL(bL.Regex),1:lL(Y.Str)}),Y.Bool)},BDe={"@header":`Lists`,getAt:mL(uL.Dictionary({0:lL(bL.List()),1:lL(Y.Num)}),bL.AnyVar),equal:mL(uL.Dictionary({0:lL(bL.List()),1:lL(bL.List())}),Y.Bool)},VDe={"@header":`Sets`,has:mL(uL.Dictionary({0:lL(bL.Set(bL.ConstrainedVar)),1:lL(bL.ConstrainedVar)}),Y.Bool,`Check if the the 1st argument includes the value of the 2nd.`),isSubset:mL(uL.Dictionary({0:lL(bL.Set(bL.ConstrainedVar)),1:lL(bL.Set(bL.ConstrainedVar))}),Y.Bool,`Check if the the 1st argument is a subset of the 2nd.`)},HDe={"@header":`Flags`,hasAny:mL(uL.Dictionary({0:lL(bL.Flags(bL.ConstrainedVar)),1:lL(bL.Flags(bL.ConstrainedVar))}),Y.Bool,`Check if the the 1st argument has at least one of the 2nd one's flags.`),hasAll:mL(uL.Dictionary({0:lL(bL.Flags(bL.ConstrainedVar)),1:lL(bL.Flags(bL.ConstrainedVar))}),Y.Bool,`Check if the the 1st argument has all 2nd one's flags.`)};const wL={"@header":`Language Primitives`,type:PDe,logic:FDe,ctrl:IDe,rel:LDe,math:RDe,str:zDe,list:BDe,set:VDe,flags:HDe};hL(wL);const UDe=gL(wL);(function(){let e=Object.create(null);for(let t of UDe)e[t.id]=t;return e})();var TL;(function(e){e.ElementSymbol=Y.Value(`Structure`,`ElementSymbol`),e.AtomName=Y.Value(`Structure`,`AtomName`),e.BondFlag=Y.OneOf(`Structure`,`BondFlag`,Y.Str,[`covalent`,`metallic`,`ion`,`hydrogen`,`sulfide`,`computed`,`aromatic`]),e.BondFlags=bL.Flags(e.BondFlag,`BondFlags`),e.SecondaryStructureFlag=Y.OneOf(`Structure`,`SecondaryStructureFlag`,Y.Str,[`alpha`,`beta`,`3-10`,`pi`,`sheet`,`strand`,`helix`,`turn`,`none`]),e.SecondaryStructureFlags=bL.Flags(e.SecondaryStructureFlag,`SecondaryStructureFlag`),e.RingFingerprint=Y.Value(`Structure`,`RingFingerprint`),e.EntityType=Y.OneOf(`Structure`,`EntityType`,Y.Str,[`polymer`,`non-polymer`,`water`,`branched`]),e.EntitySubtype=Y.OneOf(`Structure`,`EntitySubtype`,Y.Str,[`other`,`polypeptide(D)`,`polypeptide(L)`,`polydeoxyribonucleotide`,`polyribonucleotide`,`polydeoxyribonucleotide/polyribonucleotide hybrid`,`cyclic-pseudo-peptide`,`peptide nucleic acid`,`oligosaccharide`]),e.ObjectPrimitive=Y.OneOf(`Structure`,`ObjectPrimitive`,Y.Str,[`atomistic`,`sphere`,`gaussian`,`other`]),e.ResidueId=Y.Value(`Structure`,`ResidueId`),e.ElementSet=Y.Value(`Structure`,`ElementSet`),e.ElementSelection=Y.Value(`Structure`,`ElementSelection`),e.ElementReference=Y.Value(`Structure`,`ElementReference`),e.ElementSelectionQuery=bL.Fn(e.ElementSelection,`ElementSelectionQuery`)})(TL||={});var WDe={"@header":`Types`,elementSymbol:mL(uL.Dictionary({0:lL(Y.Str)}),TL.ElementSymbol,`Create element symbol representation from a string value.`),atomName:mL(uL.Dictionary({0:lL(Y.AnyValue)}),TL.AtomName,`Convert a value to an atom name.`),entityType:mL(uL.Dictionary({0:lL(TL.EntityType)}),TL.EntityType,`Create normalized representation of entity type: ${Y.oneOfValues(TL.EntityType).join(`, `)}.`),bondFlags:mL(uL.List(TL.BondFlag),TL.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${Y.oneOfValues(TL.BondFlag).join(`, `)}.`),ringFingerprint:mL(uL.List(TL.ElementSymbol,{nonEmpty:!0}),TL.RingFingerprint,`Create ring fingerprint from the supplied atom element list.`),secondaryStructureFlags:mL(uL.List(TL.SecondaryStructureFlag),TL.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${Y.oneOfValues(TL.SecondaryStructureFlag).join(`, `)}.`),authResidueId:mL(uL.Dictionary({0:lL(Y.Str,{description:`auth_asym_id`}),1:lL(Y.Num,{description:`auth_seq_id`}),2:lL(Y.Str,{description:`pdbx_PDB_ins_code`,isOptional:!0})}),TL.ResidueId,`Residue identifier based on "auth_" annotation.`),labelResidueId:mL(uL.Dictionary({0:lL(Y.Str,{description:`label_entity_id`}),1:lL(Y.Str,{description:`label_asym_id`}),2:lL(Y.Num,{description:`label_seq_id`}),3:lL(Y.Str,{description:`pdbx_PDB_ins_code`,isOptional:!0})}),TL.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},GDe={"@header":`Iteration Slots`,element:mL(uL.None,TL.ElementReference,`A reference to the current element.`),elementSetReduce:mL(uL.None,Y.Variable(`a`,Y.AnyValue,!0),`Current value of the element set reducer.`)},KDe={"@header":`Generators`,all:mL(uL.None,TL.ElementSelectionQuery,`The entire structure.`),atomGroups:mL(uL.Dictionary({"entity-test":lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test for the 1st atom of every entity`}),"chain-test":lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test for the 1st atom of every chain`}),"residue-test":lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test for the 1st atom every residue`}),"atom-test":lL(Y.Bool,{isOptional:!0,defaultValue:!0}),"group-by":lL(Y.Any,{isOptional:!0,defaultValue:`atom-key`,description:`Group atoms to sets based on this property. Default: each atom has its own set`})}),TL.ElementSelectionQuery,`Return all atoms for which the tests are satisfied, grouped into sets.`),bondedAtomicPairs:mL(uL.Dictionary({0:lL(Y.Bool,{isOptional:!0,defaultValue:`true for covalent bonds`,description:`Test each bond with this predicate. Each bond is visited twice with swapped atom order.`})}),TL.ElementSelectionQuery,`Return all pairs of atoms for which the test is satisfied.`),rings:mL(uL.Dictionary({fingerprint:lL(TL.RingFingerprint,{isOptional:!0}),"only-aromatic":lL(Y.Bool,{isOptional:!0,defaultValue:!1})}),TL.ElementSelectionQuery,`Return all rings or those with the specified fingerprint and/or only aromatic rings.`),queryInSelection:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),query:lL(TL.ElementSelectionQuery),"in-complement":lL(Y.Bool,{isOptional:!0,defaultValue:!1})}),TL.ElementSelectionQuery,`Executes query only on atoms that are in the source selection.`),empty:mL(uL.None,TL.ElementSelectionQuery,`Nada.`)},qDe={"@header":`Selection Modifications`,queryEach:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),query:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Query every atom set in the input selection separately.`),intersectBy:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),by:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Intersect each atom set from the first sequence from atoms in the second one.`),exceptBy:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),by:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Remove all atoms from 'selection' that occur in 'by'.`),unionBy:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),by:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A.`),union:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Collects all atom sets in the sequence into a single atom set.`),cluster:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),"min-distance":lL(Y.Num,{isOptional:!0,defaultValue:0}),"max-distance":lL(Y.Num),"min-size":lL(Y.Num,{description:`Minimal number of sets to merge, must be at least 2`,isOptional:!0,defaultValue:2}),"max-size":lL(Y.Num,{description:`Maximal number of sets to merge, if not set, no limit`,isOptional:!0})}),TL.ElementSelectionQuery,`Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined.`),includeSurroundings:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),radius:lL(Y.Num),"atom-radius":lL(Y.Num,{isOptional:!0,defaultValue:0,description:`Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding.`}),"as-whole-residues":lL(Y.Bool,{isOptional:!0})}),TL.ElementSelectionQuery,`For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius.`),surroundingLigands:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),radius:lL(Y.Num),"include-water":lL(Y.Bool,{isOptional:!0,defaultValue:!0})}),TL.ElementSelectionQuery,`Find all ligands components around the source query.`),includeConnected:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),"bond-test":lL(Y.Bool,{isOptional:!0,defaultValue:`true for covalent bonds`}),"layer-count":lL(Y.Num,{isOptional:!0,defaultValue:1,description:`Number of bonded layers to include.`}),"fixed-point":lL(Y.Bool,{isOptional:!0,defaultValue:!1,description:`Continue adding layers as long as new connections exist.`}),"as-whole-residues":lL(Y.Bool,{isOptional:!0})}),TL.ElementSelectionQuery,`Pick all atom sets that are connected to the target.`),wholeResidues:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Expand the selection to whole residues.`),expandProperty:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),property:lL(Y.AnyValue)}),TL.ElementSelectionQuery,`To each atom set in the selection, add all atoms that have the same property value that was already present in the set.`)},JDe={"@header":`Selection Filters`,pick:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),test:lL(Y.Bool)}),TL.ElementSelectionQuery,`Pick all atom sets that satisfy the test.`),first:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Take the 1st atom set in the sequence.`),withSameAtomProperties:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),source:lL(TL.ElementSelectionQuery),property:lL(Y.Any)}),TL.ElementSelectionQuery,`Pick all atom sets for which the set of given atom properties is a subset of the source properties.`),intersectedBy:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),by:lL(TL.ElementSelectionQuery)}),TL.ElementSelectionQuery,`Pick all atom sets that have non-zero intersection with the target.`),within:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),target:lL(TL.ElementSelectionQuery),"min-radius":lL(Y.Num,{isOptional:!0,defaultValue:0}),"max-radius":lL(Y.Num),"atom-radius":lL(Y.Num,{isOptional:!0,defaultValue:0,description:`Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding.`}),invert:lL(Y.Bool,{isOptional:!0,defaultValue:!1,description:`If true, pick only atom sets that are further than the specified radius.`})}),TL.ElementSelectionQuery,`Pick all atom sets from selection that have any atom within the radius of any atom from target.`),isConnectedTo:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery),target:lL(TL.ElementSelectionQuery),"bond-test":lL(Y.Bool,{isOptional:!0,defaultValue:`true for covalent bonds`}),disjunct:lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`If true, there must exist a bond to an atom that lies outside the given atom set to pass test.`}),invert:lL(Y.Bool,{isOptional:!0,defaultValue:!1,description:`If true, return atom sets that are not connected.`})}),TL.ElementSelectionQuery,`Pick all atom sets that are connected to the target.`)},YDe={"@header":`Selection Combinators`,intersect:mL(uL.List(TL.ElementSelectionQuery),TL.ElementSelectionQuery,`Return all unique atom sets that appear in all of the source selections.`),merge:mL(uL.List(TL.ElementSelectionQuery),TL.ElementSelectionQuery,`Merges multiple selections into a single one. Only unique atom sets are kept.`),distanceCluster:mL(uL.Dictionary({matrix:lL(bL.List(bL.List(Y.Num)),{description:`Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance.`}),selections:lL(bL.List(TL.ElementSelectionQuery),{description:`A list of held selections.`})}),TL.ElementSelectionQuery,`Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.`)},XDe={"@header":`Atom Sets`,atomCount:mL(uL.None,Y.Num),countQuery:mL(uL.Dictionary({0:lL(TL.ElementSelectionQuery)}),Y.Num,`Counts the number of occurences of a specific query inside the current atom set.`),reduce:mL(uL.Dictionary({initial:lL(Y.Variable(`a`,Y.AnyValue,!0),{description:`Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this.`}),value:lL(Y.Variable(`a`,Y.AnyValue,!0),{description:`Expression executed for each atom in the set`})}),Y.Variable(`a`,Y.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:mL(uL.Dictionary({0:lL(bL.ConstrainedVar)}),bL.Set(bL.ConstrainedVar),`Returns a set with all values of the given property in the current atom set.`)},ZDe={"@header":`Atom Properties`,core:{"@header":`Core Properties`,elementSymbol:EL(TL.ElementSymbol),vdw:EL(Y.Num,`Van der Waals radius`),mass:EL(Y.Num,`Atomic weight`),atomicNumber:EL(Y.Num,`Atomic number`),x:EL(Y.Num,`Cartesian X coordinate`),y:EL(Y.Num,`Cartesian Y coordinate`),z:EL(Y.Num,`Cartesian Z coordinate`),atomKey:EL(Y.AnyValue,`Unique value for each atom. Main use case is grouping of atoms.`),bondCount:mL(uL.Dictionary({0:lL(TL.ElementReference,{isOptional:!0,defaultValue:`slot.current-atom`}),flags:lL(TL.BondFlags,{isOptional:!0,defaultValue:`covalent`})}),Y.Num,`Number of bonds (by default only covalent bonds are counted).`),sourceIndex:EL(Y.Num,`Index of the atom/element in the input file.`),operatorName:EL(Y.Str,`Name of the symmetry operator applied to this element.`),instanceId:EL(Y.Str,`Canonical name of the symmetry operator applied to this element.`),operatorKey:EL(Y.Num,`Key of the symmetry operator applied to this element.`),modelIndex:EL(Y.Num,`Index of the model in the input file.`),modelLabel:EL(Y.Str,`Label/header of the model in the input file.`),modelEntryId:EL(Y.Str,`Entry ID of the model (e.g., PDB ID).`)},topology:{connectedComponentKey:EL(Y.AnyValue,`Unique value for each connected component.`)},macromolecular:{"@header":`Macromolecular Properties (derived from the mmCIF format)`,authResidueId:EL(TL.ResidueId,`type.auth-residue-id symbol executed on current atom's residue`),labelResidueId:EL(TL.ResidueId,`type.label-residue-id symbol executed on current atom's residue`),residueKey:EL(Y.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:EL(Y.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:EL(Y.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:EL(Y.Bool,`Equivalent to atom_site.group_PDB !== ATOM`),id:EL(Y.Num,`_atom_site.id`),label_atom_id:EL(TL.AtomName),label_alt_id:EL(Y.Str),label_comp_id:EL(Y.Str),label_asym_id:EL(Y.Str),label_entity_id:EL(Y.Str),label_seq_id:EL(Y.Num),auth_atom_id:EL(TL.AtomName),auth_comp_id:EL(Y.Str),auth_asym_id:EL(Y.Str),auth_seq_id:EL(Y.Num),residueSourceIndex:EL(Y.Num),pdbx_PDB_ins_code:EL(Y.Str),pdbx_formal_charge:EL(Y.Num),occupancy:EL(Y.Num),B_iso_or_equiv:EL(Y.Num),entityType:EL(TL.EntityType,`Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)`),entitySubtype:EL(TL.EntitySubtype,`Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)`),entityPrdId:EL(Y.Str,`The PRD ID of the entity.`),entityDescription:EL(bL.List(Y.Str)),objectPrimitive:EL(TL.ObjectPrimitive,`Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)`),secondaryStructureKey:EL(Y.AnyValue,`Unique value for each secondary structure element.`),secondaryStructureFlags:EL(TL.SecondaryStructureFlags),isModified:EL(Y.Bool,`True if the atom belongs to modification of a standard residue.`),modifiedParentName:EL(Y.Str,`'3-letter' code of the modifed parent residue.`),isNonStandard:EL(Y.Bool,`True if this is a non-standard residue.`),chemCompType:EL(Y.Str,`Type of the chemical component as defined in mmCIF.`)},ihm:{hasSeqId:mL(uL.Dictionary({0:lL(Y.Num)}),Y.Bool,`Checks if the current element represents a given sequence id`),overlapsSeqIdRange:mL(uL.Dictionary({beg:lL(Y.Num),end:lL(Y.Num)}),Y.Bool,`Checks if the current element overlaps with the specified residue range`)}},QDe={"@header":`Bond Properties`,flags:DL(TL.BondFlags),order:DL(Y.Num),key:DL(Y.Num),length:DL(Y.Num),atomA:DL(TL.ElementReference),atomB:DL(TL.ElementReference)};function EL(e,t){return mL(uL.Dictionary({0:lL(TL.ElementReference,{isOptional:!0,defaultValue:`slot.current-atom`})}),e,t)}function DL(e,t){return mL(uL.None,e,t)}const $De={"@header":`Structure Queries`,type:WDe,slot:GDe,generator:KDe,modifier:qDe,filter:JDe,combinator:YDe,atomSet:XDe,atomProperty:ZDe,bondProperty:QDe};var eOe={"@header":`Generators`,bundleElement:mL(uL.Dictionary({groupedUnits:lL(Y.Any),set:lL(Y.Any),ranges:lL(Y.Any)}),Y.Any),bundle:mL(uL.Dictionary({elements:lL(Y.Any)}),TL.ElementSelectionQuery,`A selection with single structure containing represented by the bundle.`),current:mL(uL.None,TL.ElementSelectionQuery,`Current selection provided by the query context. Avoid using this in State Transforms.`)},X={core:wL,structureQuery:$De,internal:{"@header":`Internal Queries`,generator:eOe}};hL(X);const tOe=gL(X);(function(){let e=Object.create(null);for(let t of tOe)e[t.id]=t;return e})();var Z;(function(e){e.core=X.core,e.struct=X.structureQuery,e.internal=X.internal;function t(t){return e.struct.type.atomName([t])}e.atomName=t;function n(t){return e.struct.type.elementSymbol([t])}e.es=n;function r(...t){return e.core.type.list(t)}e.list=r;function i(...t){return e.core.type.set(t)}e.set=i;function a(t,n){return e.core.type.regex([t,n])}e.re=a;function o(t){return e.core.ctrl.fn([t])}e.fn=o;function s(t){return e.core.ctrl.eval([t])}e.evaluate=s;let c=e.struct.atomProperty.core,l=e.struct.atomProperty.macromolecular,u=e.struct.atomProperty.topology;function d(e){return c[e]()}e.acp=d;function f(e){return u[e]()}e.atp=f;function p(e){return l[e]()}e.ammp=p;let m=e.struct.atomSet.propertySet;function h(e){return m([d(e)])}e.acpSet=h;function g(e){return m([f(e)])}e.atpSet=g;function _(e){return m([p(e)])}e.ammpSet=_})(Z||={});var OL=class e{getConnectedUnits(e){return this.map.has(e)?this.map.get(e):kL}getEdgeIndex(t,n,r,i){let a=this.edgeKeyIndex.get(e.getEdgeUnitKey(n,i));if(a===void 0)return-1;let o=a.get(e.getEdgeIndexKey(t,r));return o===void 0?-1:o}hasEdge(e,t,n,r){return this.getEdgeIndex(e,t,n,r)!==-1}getEdge(e,t,n,r){let i=this.getEdgeIndex(e,t,n,r);return i===-1?void 0:this.edges[i]}getEdgeIndices(t,n){return this.vertexKeyIndex.get(e.getVertexKey(t,n))||[]}constructor(t){this.map=t;let n=0,r=[],i=new Map,a=new Map;this.map.forEach(t=>{t.forEach(t=>{n+=t.edgeCount,t.connectedIndices.forEach(n=>{t.getEdges(n).forEach(o=>{let{unitA:s,unitB:c}=t,l=e.getEdgeIndexKey(s,c),u=e.getEdgeIndexKey(n,o.indexB),d=i.get(l);d===void 0?i.set(l,new Map([[u,r.length]])):d.set(u,r.length);let f=e.getVertexKey(n,s),p=a.get(f);p===void 0?a.set(f,[r.length]):p.push(r.length),r.push({...o,indexA:n,unitA:s,unitB:c})})})})}),this.edgeCount=n,this.edges=r,this.edgeKeyIndex=i,this.vertexKeyIndex=a}};(function(e){class t{hasEdges(e){return this.edgeMap.has(e)}getEdges(e){return this.edgeMap.has(e)?this.edgeMap.get(e):kL}get areUnitsOrdered(){return this.unitA<this.unitB}constructor(e,t,n,r,i){this.unitA=e,this.unitB=t,this.edgeCount=n,this.connectedIndices=r,this.edgeMap=i}}e.UnitPairEdges=t;function n(e,t){return pE(e,t)}e.getEdgeUnitKey=n;function r(e,t){return pE(e,t)}e.getEdgeIndexKey=r;function i(e,t){return pE(e,t)}e.getVertexKey=i;function a(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])}class o{constructor(){this.map=new Map}startUnitPair(e,t){this.uA=e,this.uB=t,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=CD.create(),this.linkedB=CD.create(),this.linkCount=0}finishUnitPair(){this.linkCount!==0&&(a(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),a(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(e,t,n){a(this.mapAB,e,{indexB:t,props:n}),a(this.mapBA,t,{indexB:e,props:n}),CD.add(this.linkedA,e,e),CD.add(this.linkedB,t,t),this.linkCount+=1}getMap(){return this.map}}e.Builder=o})(OL||={});var kL=[],AL;(function(e){e.Empty=KI.create([],[],[],0,{flags:[],order:[],key:[]})})(AL||={});var jL=class extends OL{getBondFromLocation(e){return Q.isAtomic(e.aUnit)&&Q.isAtomic(e.bUnit)?this.getEdge(e.aIndex,e.aUnit.id,e.bIndex,e.bUnit.id):void 0}getBondIndexFromLocation(e){return Q.isAtomic(e.aUnit)&&Q.isAtomic(e.bUnit)?this.getEdgeIndex(e.aIndex,e.aUnit.id,e.bIndex,e.bUnit.id):-1}};(function(e){class t extends OL.UnitPairEdges{}e.UnitPairBonds=t})(jL||={});const ML={forceCompute:!1,noCompute:!1,maxRadius:4};var NL={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},nOe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},rOe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},PL=2.001;const FL=(function(){let e=`LI.NA.K.RB.CS.FR.BE.MG.CA.SR.BA.RA.AL.GA.IN.SN.TL.PB.BI.SC.TI.V.CR.MN.FE.CO.NI.CU.ZN.Y.ZR.NB.MO.TC.RU.RH.PD.AG.CD.LA.HF.TA.W.RE.OS.IR.PT.AU.HG.AC.RF.DB.SG.BH.HS.MT.CE.PR.ND.PM.SM.EU.GD.TB.DY.HO.ER.TM.YB.LU.TH.PA.U.NP.PU.AM.CM.BK.CF.ES.FM.MD.NO.LR`.split(`.`),t=new Set;for(let n of e)t.add(NL[n]);return t})();function iOe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function IL(e){let t=NL[e];return t===void 0?-1:t}function aOe(e,t){if(e<0||t<0)return-1;let n=rOe[iOe(e,t)];return n===void 0?-1:n}function LL(e){if(e<0)return PL;let t=nOe[e];return t===void 0?PL:t}function RL(e,t,n,r){let i=aOe(e,t);return i>0?i:t<0?n:(n+r)/1.95}var oOe=NL.H;function zL(e){return e===oOe}var sOe=new Map([[`HIS|CD2|CG`,2],[`HIS|CE1|ND1`,2],[`ARG|CZ|NH2`,2],[`PHE|CE1|CZ`,2],[`PHE|CD2|CE2`,2],[`PHE|CD1|CG`,2],[`TRP|CD1|CG`,2],[`TRP|CD2|CE2`,2],[`TRP|CE3|CZ3`,2],[`TRP|CH2|CZ2`,2],[`ASN|CG|OD1`,2],[`GLN|CD|OE1`,2],[`TYR|CD1|CG`,2],[`TYR|CD2|CE2`,2],[`TYR|CE1|CZ`,2],[`ASP|CG|OD1`,2],[`GLU|CD|OE1`,2],[`G|C8|N7`,2],[`G|C4|C5`,2],[`G|C2|N3`,2],[`G|C6|O6`,2],[`C|C4|N3`,2],[`C|C5|C6`,2],[`C|C2|O2`,2],[`A|C2|N3`,2],[`A|C6|N1`,2],[`A|C4|C5`,2],[`A|C8|N7`,2],[`U|C5|C6`,2],[`U|C2|O2`,2],[`U|C4|O4`,2],[`DG|C8|N7`,2],[`DG|C4|C5`,2],[`DG|C2|N3`,2],[`DG|C6|O6`,2],[`DC|C4|N3`,2],[`DC|C5|C6`,2],[`DC|C2|O2`,2],[`DA|C2|N3`,2],[`DA|C6|N1`,2],[`DA|C4|C5`,2],[`DA|C8|N7`,2],[`DT|C5|C6`,2],[`DT|C2|O2`,2],[`DT|C4|O4`,2]]);function cOe(e,t,n){return[t,n]=t<n?[t,n]:[n,t],_I.has(e)&&t===`C`&&n===`O`||xI.has(e)&&t===`OP1`&&n===`P`?2:sOe.get(`${e}|${t}|${n}`)||1}var lOe=new Map([[`LYS|NZ|RET|C15`,2]]);function BL(e,t,n,r){return e>n&&([e,n]=[n,e],[t,r]=[r,t]),lOe.get(`${e}|${t}|${n}|${r}`)||1}var VL;(function(e){let t;(function(e){e[e.Str=0]=`Str`,e[e.Int=1]=`Int`,e[e.Float=2]=`Float`})(t=e.Type||={});function n(e,n,r){return{name:e,type:t.Str,value:n,valueKind:r&&r.valueKind,defaultFormat:r&&r.encoder?{encoder:r.encoder}:void 0,shouldInclude:r&&r.shouldInclude}}e.str=n;function r(e,n,r){return{name:e,type:t.Int,value:n,valueKind:r&&r.valueKind,defaultFormat:r?{encoder:r.encoder,typedArray:r.typedArray}:void 0,shouldInclude:r&&r.shouldInclude}}e.int=r;function i(e,n,r){return{name:e,type:t.Float,value:n,valueKind:r&&r.valueKind,defaultFormat:r?{encoder:r.encoder,typedArray:r.typedArray,digitCount:r.digitCount===void 0?void 0:r.digitCount}:void 0,shouldInclude:r&&r.shouldInclude}}e.float=i;function a(e){return r(e,(e,t,n)=>n+1,{typedArray:Int32Array,encoder:wO.by(wO.delta).and(wO.runLength).and(wO.integerPacking)})}e.index=a;class o{constructor(){this.fields=[]}index(t){return this.fields.push(e.index(t)),this}str(t,n,r){return this.fields.push(e.str(t,n,r)),this}int(t,n,r){return this.fields.push(e.int(t,n,r)),this}vec(t,n,r){for(let i=0;i<n.length;i++)this.fields.push(e.int(`${t}[${i+1}]`,n[i],r));return this}float(t,n,r){return this.fields.push(e.float(t,n,r)),this}many(e){for(let t=0;t<e.length;t++)this.fields.push(e[t]);return this}add(e){return this.fields.push(e),this}getFields(){return this.fields}}e.Builder=o;function s(){return new o}e.build=s})(VL||={});var HL;(function(e){e.Empty={fields:[],source:[]};function t(e){let t=[],n=[],r=[],i=[];for(let a of e.split(/[\r\n]+/)){if(a=a.trim(),a.length===0)continue;let e=/^!/.test(a);e&&(a=a.substr(1));let o=a.split(/\./),s=o[1],c=e?s?i:n:s?r:t;c[c.length]=a,s&&!t.includes(o[0])&&(t[t.length]=o[0])}let a=r.map(e=>e.split(`.`)[0]);return{includeCategory(e){return n.includes(e)?!1:t.length<=0||t.indexOf(e)!==-1},includeField(e,t){let n=e+`.`+t;return i.includes(n)?!1:!a.includes(e)||r.includes(n)}}}e.filterOf=t,e.DefaultFilter={includeCategory(e){return!0},includeField(e,t){return!0}},e.DefaultFormatter={getFormat(e,t){}};function n(e,t){return t?{fields:qL(e._schema),source:[{data:e,rowCount:t.length,keys:()=>pA.Array(t)}]}:{fields:qL(e._schema),source:[{data:e,rowCount:e._rowCount}]}}e.ofTable=n})(HL||={});var UL;(function(e){function t(e,t,n){e.startDataBlock(t);for(let t of n._tableNames)e.writeCategory({name:t,instance:()=>HL.ofTable(n[t])})}e.writeDatabase=t;function n(e,n){for(let r of Object.keys(n))t(e,r,n[r])}e.writeDatabaseCollection=n})(UL||={});function WL(e){return(t,n)=>n[e].value(t)}function uOe(e){return(t,n)=>n[e].value(t).join(n[e].schema.separator)}function GL(e,...t){return(n,r)=>r[e].schema.space.get(r[e].value(n),...t)}function KL(e){return(t,n)=>n[e].valueKind(t)}function dOe(e,t){let n=[],r=VL.Type.Float,i=KL(e);if(t.rank===1){let a=t.dimensions[0];for(let t=0;t<a;t++){let a=`${e}[${t+1}]`;n.push({name:a,type:r,value:GL(e,t),valueKind:i})}}else if(t.rank===2){let a=t.dimensions[0],o=t.dimensions[1];for(let t=0;t<a;t++)for(let a=0;a<o;a++){let o=`${e}[${t+1}][${a+1}]`;n.push({name:o,type:r,value:GL(e,t,a),valueKind:i})}}else if(t.rank===3){let a=t.dimensions[0],o=t.dimensions[1],s=t.dimensions[2];for(let t=0;t<a;t++)for(let a=0;a<o;a++)for(let o=0;o<s;o++){let s=`${e}[${t+1}][${a+1}][${o+1}]`;n.push({name:s,type:r,value:GL(e,t,a,o),valueKind:i})}}else throw Error(`Tensors with rank > 3 or rank 0 are currently not supported.`);return n}function qL(e){let t=[];for(let n of Object.keys(e)){let r=e[n];r.valueType===`int`?t.push({name:n,type:VL.Type.Int,value:WL(n),valueKind:KL(n)}):r.valueType===`float`?t.push({name:n,type:VL.Type.Float,value:WL(n),valueKind:KL(n)}):r.valueType===`str`?t.push({name:n,type:VL.Type.Str,value:WL(n),valueKind:KL(n)}):r.valueType===`list`?t.push({name:n,type:VL.Type.Str,value:uOe(n),valueKind:KL(n)}):r.valueType===`tensor`?t.push(...dOe(n,r.space)):Lb(r.valueType)}return t}function fOe(e){return e.defaultFormat&&e.defaultFormat.digitCount!==void 0?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function JL(e){return e.fields.some(e=>!!e.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(e=>t.shouldInclude(e.data))):e.fields}function YL(e,t){let n=e.instance(t),r=n.source.filter(e=>e.rowCount>0);return r.length?{instance:n,rowCount:r.reduce((e,t)=>e+t.rowCount,0),source:r.map(e=>({data:e.data,keys:()=>e.keys?e.keys():pA.Range(0,e.rowCount-1),rowCount:e.rowCount}))}:{instance:n,rowCount:0,source:[]}}var pOe=class{constructor(){this.builder=vx.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=HL.DefaultFilter,this.formatter=HL.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}setFilter(e){this.filter=e||HL.DefaultFilter}isCategoryIncluded(e){return this.filter.includeCategory(e)}setFormatter(e){this.formatter=e||HL.DefaultFormatter}startDataBlock(e){this.dataBlockCreated=!0,vx.write(this.builder,`data_${(e||``).replace(/[ \n\t]/g,``).toUpperCase()}\n#\n`)}writeCategory(e,t,n){if(this.encoded)throw Error(`The writer contents have already been encoded, no more writing.`);if(!this.dataBlockCreated)throw Error(`No data block created.`);if(!n?.ignoreFilter&&!this.filter.includeCategory(e.name))return;let{instance:r,rowCount:i,source:a}=YL(e,t);i&&(i===1?mOe(e,r,a,this.builder,this.filter,this.formatter):hOe(e,r,a,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(e){let t=vx.getChunks(this.builder);for(let n=0,r=t.length;n<r;n++)e.writeString(t[n])}getSize(){return vx.getSize(this.builder)}getData(){return vx.getString(this.builder)}};function XL(e,t,n,r,i,a){let o=r.valueKind,s=o?o(n,t):U.ValueKinds.Present;if(s!==U.ValueKinds.Present)s===U.ValueKinds.NotPresent?yOe(e):bOe(e);else{let o=r.value(n,t,a),s=r.type;if(s===VL.Type.Str)return gOe(o)?($L(e,o),!0):xOe(e,o);s===VL.Type.Int?_Oe(e,o):vOe(e,o,i)}return!1}function ZL(e,t,n){let r=[];for(let i of t){let t=n.getFormat(e,i.name);t&&t.digitCount!==void 0?r[r.length]=i.type===VL.Type.Float?10**Math.max(0,Math.min(t.digitCount,15)):0:r[r.length]=i.type===VL.Type.Float?10**fOe(i):0}return r}function mOe(e,t,n,r,i,a){let o=JL(t),s=n[0],c=s.data,l=o.reduce((t,n)=>i.includeField(e.name,n.name)?Math.max(t,n.name.length):0,0);if(l===0)return;l+=e.name.length+6;let u=s.keys().move(),d=ZL(e.name,t.fields,a);for(let t=0;t<o.length;t++){let n=o[t];i.includeField(e.name,n.name)&&(vx.writePadRight(r,`_${e.name}.${n.name}`,l),XL(r,c,u,n,d[t],0)||vx.newline(r))}vx.write(r,`#
`)}function hOe(e,t,n,r,i,a){let o=JL(t),s=i===HL.DefaultFilter?o:o.filter(t=>i.includeField(e.name,t.name)),c=s.length;if(c===0)return;let l=ZL(e.name,s,a);QL(r,`loop_`);for(let t=0;t<c;t++)QL(r,`_${e.name}.${s[t].name}`);let u=0;for(let e=0;e<n.length;e++){let t=n[e],i=t.data;if(t.rowCount===0)continue;let a=t.keys();for(;a.hasNext;){let e=a.move(),t=!1;for(let n=0;n<c;n++)t=XL(r,i,e,s[n],l[n],u);t||vx.newline(r),u++}}vx.write(r,`#
`)}function gOe(e){return typeof e==`string`&&e.indexOf(`
`)>=0}function QL(e,t){vx.write(e,t),vx.newline(e)}function _Oe(e,t){vx.writeInteger(e,t),vx.whitespace1(e)}function vOe(e,t,n){vx.writeFloat(e,t,n),vx.whitespace1(e)}function yOe(e){vx.writeSafe(e,`. `)}function bOe(e){vx.writeSafe(e,`? `)}function xOe(e,t){if(!t)return vx.writeSafe(e,`. `),!1;let n=t.charCodeAt(0),r=!1,i=0,a=!1,o=!1;for(let n=0,s=t.length-1;n<=s;n++)switch(t.charCodeAt(n)){case 9:r=!0;break;case 10:return $L(e,t),!0;case 32:r=!0;break;case 34:if(n&&n===s)break;if(a)return $L(e,t),!0;o=!0,r=!0,i=0;break;case 39:if(n&&n===s)break;if(o)return $L(e,t),!0;a=!0,r=!0,i=1;break}return!r&&(n===35||n===36||n===59||n===91||n===93||n===95)&&(r=!0),r?(vx.writeSafe(e,i?`"`:`'`),vx.writeSafe(e,t),vx.writeSafe(e,i?`" `:`' `)):(vx.writeSafe(e,t),vx.writeSafe(e,` `)),!1}function $L(e,t){vx.writeSafe(e,`
;`+t),vx.writeSafe(e,`
;
`)}function SOe(e){let t=new ArrayBuffer(eR(e)),n=new DataView(t),r=new Uint8Array(t);return tR(e,n,r,0),r}function eR(e){let t=typeof e;if(t===`string`){let t=Jy(e);if(t<32)return 1+t;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if(e instanceof Uint8Array){let t=e.byteLength;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if(t===`number`){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw Error(`Number too big 0x`+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw Error(`Number too small -0x`+e.toString(16).substr(1))}if(t===`boolean`||e==null)return 1;if(t===`object`){let t,n=0;if(Array.isArray(e)){t=e.length;for(let r=0;r<t;r++)n+=eR(e[r])}else{let r=Object.keys(e);t=r.length;for(let i=0;i<t;i++){let t=r[i];n+=eR(t)+eR(e[t])}}if(t<16)return 1+n;if(t<65536)return 3+n;if(t<4294967296)return 5+n;throw Error(`Array or object too long 0x`+t.toString(16))}throw Error(`Unknown type `+t)}function tR(e,t,n,r){let i=typeof e;if(i===`string`){let i=Jy(e);if(i<32)return t.setUint8(r,i|160),Uy(n,r+1,e),1+i;if(i<256)return t.setUint8(r,217),t.setUint8(r+1,i),Uy(n,r+2,e),2+i;if(i<65536)return t.setUint8(r,218),t.setUint16(r+1,i),Uy(n,r+3,e),3+i;if(i<4294967296)return t.setUint8(r,219),t.setUint32(r+1,i),Uy(n,r+5,e),5+i}if(e instanceof Uint8Array){let n=e.byteLength,i=new Uint8Array(t.buffer);if(n<256)return t.setUint8(r,196),t.setUint8(r+1,n),i.set(e,r+2),2+n;if(n<65536)return t.setUint8(r,197),t.setUint16(r+1,n),i.set(e,r+3),3+n;if(n<4294967296)return t.setUint8(r,198),t.setUint32(r+1,n),i.set(e,r+5),5+n}if(i===`number`){if(!isFinite(e))throw Error(`Number not finite: `+e);if(Math.floor(e)!==e)return t.setUint8(r,203),t.setFloat64(r+1,e),9;if(e>=0){if(e<128)return t.setUint8(r,e),1;if(e<256)return t.setUint8(r,204),t.setUint8(r+1,e),2;if(e<65536)return t.setUint8(r,205),t.setUint16(r+1,e),3;if(e<4294967296)return t.setUint8(r,206),t.setUint32(r+1,e),5;throw Error(`Number too big 0x`+e.toString(16))}if(e>=-32)return t.setInt8(r,e),1;if(e>=-128)return t.setUint8(r,208),t.setInt8(r+1,e),2;if(e>=-32768)return t.setUint8(r,209),t.setInt16(r+1,e),3;if(e>=-2147483648)return t.setUint8(r,210),t.setInt32(r+1,e),5;throw Error(`Number too small -0x`+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(r,192),1;if(i===`boolean`)return t.setUint8(r,e?195:194),1;if(i===`object`){let i,a=0,o=Array.isArray(e),s;if(o?i=e.length:(s=Object.keys(e),i=s.length),i<16?(t.setUint8(r,i|(o?144:128)),a=1):i<65536?(t.setUint8(r,o?220:222),t.setUint16(r+1,i),a=3):i<4294967296&&(t.setUint8(r,o?221:223),t.setUint32(r+1,i),a=5),o)for(let o=0;o<i;o++)a+=tR(e[o],t,n,r+a);else for(let i=0,o=s.length;i<o;i++){let o=s[i];a+=tR(o,t,n,r+a),a+=tR(e[o],t,n,r+a)}return a}throw Error(`Unknown type `+i)}var COe=class{setFilter(e){this.filter=e||HL.DefaultFilter}isCategoryIncluded(e){return this.filter.includeCategory(e)}setFormatter(e){this.formatter=e||HL.DefaultFormatter}startDataBlock(e){this.dataBlocks.push({header:(e||``).replace(/[ \n\t]/g,``).toUpperCase(),categories:[]})}writeCategory(e,t,n){if(!this.data)throw Error(`The writer contents have already been encoded, no more writing.`);if(!this.dataBlocks.length)throw Error(`No data block created.`);if(!n?.ignoreFilter&&!this.filter.includeCategory(e.name))return;let{instance:r,rowCount:i,source:a}=YL(e,t);if(!i)return;let o={name:`_`+e.name,columns:[],rowCount:i},s=JL(r);for(let t of s){if(!this.filter.includeField(e.name,t.name))continue;let n=this.formatter.getFormat(e.name,t.name);o.columns.push(OOe(e.name,t,a,i,n,this.binaryEncodingProvider,this.autoClassify))}o.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(o)}encode(){this.encodedData||(this.encodedData=SOe(this.data),this.data=null,this.dataBlocks=null)}writeTo(e){e.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}constructor(e,t,n){this.autoClassify=n,this.dataBlocks=[],this.filter=HL.DefaultFilter,this.formatter=HL.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=t,this.data={encoder:e,version:`0.3.0`,dataBlocks:this.dataBlocks}}};function wOe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===VL.Type.Str?Array:e.type===VL.Type.Int?Int32Array:Float64Array}function TOe(e){return e===VL.Type.Str?CO.by(wO.stringArray):CO.by(wO.byteArray)}function EOe(e,t,n,r){if(n&&n.encoder)return n.encoder;if(t.defaultFormat&&t.defaultFormat.encoder)return t.defaultFormat.encoder;if(r)return r.get(e,t.name)}function DOe(e,t){return e===VL.Type.Str?CO.by(wO.stringArray):e===VL.Type.Int?xO(t):Hge(t)}function OOe(e,t,n,r,i,a,o){let{array:s,allPresent:c,mask:l}=kOe(t,wOe(t,i),r,n),u;u=t.type===VL.Type.Str?CO.by(wO.stringArray):EOe(e,t,i,a),u||=o?DOe(t.type,s):TOe(t.type);let d=u.encode(s),f;if(!c){let e=CO.by(wO.runLength).and(wO.byteArray).encode(l);f=e.data.length<l.length?e:CO.by(wO.byteArray).encode(l)}return{name:t.name,data:d,mask:f}}function kOe(e,t,n,r){let i=e.type===VL.Type.Str,a=new t(n),o=new Uint8Array(n),s=e.valueKind,c=e.value,l=!0,u=0;for(let e=0;e<r.length;e++){let t=r[e].data,n=r[e].keys();for(;n.hasNext;){let e=n.move(),r=s?s(e,t):U.ValueKinds.Present;if(r!==U.ValueKinds.Present)o[u]=r,i&&(a[u]=``),l=!1;else{let n=c(e,t,u);typeof n==`string`&&!n?(o[u]=U.ValueKinds.NotPresent,l=!1):o[u]=U.ValueKinds.Present,a[u]=n}u++}}return{array:a,allPresent:l,mask:o}}var nR;(function(e){e.Encoder=UL,e.Category=HL,e.Field=VL,e.Encoding=wO;function t(e){let{binary:t=!1,encoderName:n=`mol*`}=e||{};return t?new COe(n,e?e.binaryEncodingPovider:void 0,e?!!e.binaryAutoClassifyEncoding:!1):new pOe}e.createEncoder=t;function n(){return e.Field.build()}e.fields=n;var r=e.Encoding;e.Encodings={deltaRLE:r.by(r.delta).and(r.runLength).and(r.integerPacking),fixedPoint2:r.by(r.fixedPoint(100)).and(r.delta).and(r.integerPacking),fixedPoint3:r.by(r.fixedPoint(1e3)).and(r.delta).and(r.integerPacking)};function i(e,t){return{fields:e,source:[t]}}e.categoryInstance=i;function a(e){return{get(t,n){let r=e.categories[t];if(!r)return;let i=r.getField(n);return i&&i.binaryEncoding?CO.fromEncoding(i.binaryEncoding):void 0}}}e.createEncodingProviderFromCifFrame=a;function o(e){return{get(t,n){for(let r=0;r<e.length;r++){let i=e[r];if(i.categoryName===t&&i.columnName===n)return s(i)}}}}e.createEncodingProviderFromJsonConfig=o;function s(e){let t=e.precision;if(t!==void 0){let n=10**t,i=r.by(r.fixedPoint(n));switch(e.encoding){case`pack`:return i.and(r.integerPacking);case`rle`:return i.and(r.runLength).and(r.integerPacking);case`delta`:return i.and(r.delta).and(r.integerPacking);case`delta-rle`:return i.and(r.delta).and(r.runLength).and(r.integerPacking)}}else switch(e.encoding){case`pack`:return r.by(r.integerPacking);case`rle`:return r.by(r.runLength).and(r.integerPacking);case`delta`:return r.by(r.delta).and(r.integerPacking);case`delta-rle`:return r.by(r.delta).and(r.runLength).and(r.integerPacking)}throw Error(`cannot be reached`)}})(nR||={});var rR;(function(e){e.Descriptor={name:`chem_comp_bond`,cifExport:{prefix:``,categories:[{name:`chem_comp_bond`,instance(t){let n=e.Provider.get(t.firstModel);if(!n)return nR.Category.Empty;let r=n.data;if(!r)return nR.Category.Empty;let i=t.structures[0].uniqueResidueNames,{comp_id:a,_rowCount:o}=r,s=[];for(let e=0;e<o;e++)i.has(a.value(e))&&(s[s.length]=e);return nR.Category.ofTable(r,s)}}]}},e.Provider=JI.create(e.Descriptor);function t(e,t){return QD.pick(t,HO.chem_comp_bond,n=>e.properties.chemicalComponentMap.has(t.comp_id.value(n)))}e.chemCompBondFromTable=t;function n(e){let t=new Map;function n(e){if(t.has(e))return t.get(e);let n=new r(e);return t.set(e,n),n}let{comp_id:i,atom_id_1:a,atom_id_2:o,value_order:s,pdbx_aromatic_flag:c,_rowCount:l,pdbx_ordinal:u}=e,d=n(i.value(0));for(let e=0;e<l;e++){let t=i.value(e),r=a.value(e),l=o.value(e),f=s.value(e),p=c.value(e)===`y`,m=u.value(e);d.id!==t&&(d=n(t));let h=kI.Flag.Covalent,g=1;switch(p&&(h|=kI.Flag.Aromatic),f.toLowerCase()){case`delo`:h|=kI.Flag.Aromatic;break;case`doub`:g=2;break;case`trip`:g=3;break;case`quad`:g=4;break}d.add(r,l,g,h,m)}return t}e.getEntriesFromChemCompBond=n;class r{add(e,t,n,r,i,a=!0){let o=this.map.get(e);if(o!==void 0)o.get(t)===void 0&&o.set(t,{order:n,flags:r,key:i});else{let a=new Map;a.set(t,{order:n,flags:r,key:i}),this.map.set(e,a)}a&&this.add(t,e,n,r,i,!1)}constructor(e){this.id=e,this.map=new Map}}e.Entry=r})(rR||={});var iR;(function(e){e.Descriptor={name:`struct_conn`,cifExport:{prefix:``,categories:[{name:`struct_conn`,instance(t){let r=e.Provider.get(t.firstModel);if(!r||r.entries.length===0)return nR.Category.Empty;let i=t.structures[0],a=[];for(let e of r.entries)n(i,e.partnerA.atomIndex)&&n(i,e.partnerB.atomIndex)&&(a[a.length]=e.rowIndex);return nR.Category.ofTable(r.data,a)}}]}},e.Provider=JI.create(e.Descriptor);function t(t){let n=e.Provider.get(t);return!!n&&n.entries.length/t.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function n({units:e},t){for(let n=0,r=e.length;n<r;n++)if(Vk.indexOf(e[n].elements,t)>=0)return!0;return!1}function r(e){let t=new Map;for(let n of e){let{partnerA:{atomIndex:e},partnerB:{atomIndex:r}}=n;t.has(e)?t.get(e).push(n):t.set(e,[n]),t.has(r)?t.get(r).push(n):t.set(r,[n])}return t}e.getAtomIndexFromEntries=r;function i(e,t){let{conn_type_id:n,pdbx_dist_value:r,pdbx_value_order:i}=e,a={label_asym_id:e.ptnr1_label_asym_id,label_seq_id:e.ptnr1_label_seq_id,auth_seq_id:e.ptnr1_auth_seq_id,label_atom_id:e.ptnr1_label_atom_id,label_alt_id:e.pdbx_ptnr1_label_alt_id,ins_code:e.pdbx_ptnr1_PDB_ins_code,symmetry:e.ptnr1_symmetry},o={label_asym_id:e.ptnr2_label_asym_id,label_seq_id:e.ptnr2_label_seq_id,auth_seq_id:e.ptnr2_auth_seq_id,label_atom_id:e.ptnr2_label_atom_id,label_alt_id:e.pdbx_ptnr2_label_alt_id,ins_code:e.pdbx_ptnr2_PDB_ins_code,symmetry:e.ptnr2_symmetry},s=Array.from(t.entities.data.id.toArray()),c=(e,n)=>{if(n.label_asym_id.valueKind(e)!==U.ValueKinds.Present)return;let r=n.label_asym_id.value(e),i=n.label_atom_id.value(e);if(!i)return;let a=n.auth_seq_id.valueKind(e)===U.ValueKind.Present?n.auth_seq_id.value(e):n.label_seq_id.value(e),o=n.ins_code.value(e),c=n.label_alt_id.value(e);for(let l of s){let s=t.atomicHierarchy.index.findResidue(l,r,a,o);if(s<0)continue;let u=t.atomicHierarchy.index.findAtomOnResidue(s,i,c);if(!(u<0))return{residueIndex:s,atomIndex:u,symmetry:n.symmetry.value(e)}}},l=[];for(let t=0;t<e._rowCount;t++){let s=c(t,a),u=c(t,o);if(s===void 0||u===void 0)continue;let d=n.value(t),f=i.value(t)||``,p=kI.Flag.None,m=1;switch(f){case`sing`:m=1;break;case`doub`:m=2;break;case`trip`:m=3;break;case`quad`:m=4;break;default:m=BL(e.ptnr1_label_comp_id.value(t),e.ptnr1_label_atom_id.value(t),e.ptnr2_label_comp_id.value(t),e.ptnr2_label_atom_id.value(t))}switch(d){case`covale`:p=kI.Flag.Covalent;break;case`disulf`:p=kI.Flag.Covalent|kI.Flag.Disulfide;break;case`hydrog`:p=kI.Flag.HydrogenBond;break;case`metalc`:p=kI.Flag.MetallicCoordination;break}l.push({rowIndex:t,flags:p,order:m,distance:r.value(t),partnerA:s,partnerB:u})}return l}e.getEntriesFromStructConn=i})(iR||={});var AOe=B.distance,jOe=6,MOe=5.5,NOe=3.9;function aR(e,t,n,r,i,a,o){let s=new KI.EdgeBuilder(a,e,t),c=new Uint16Array(s.slotCount),l=new Int8Array(s.slotCount),u=new Uint32Array(s.slotCount);for(let e=0,t=s.edgeCount;e<t;e++)s.addNextEdge(),s.assignProperty(c,r[e]),s.assignProperty(l,n[e]),s.assignProperty(u,i[e]);return s.createGraph({flags:c,order:l,key:u},o)}var oR=B(),sR=B();function POe(e,t,n){return e.conformation.position(t,oR),e.conformation.position(n,sR),AOe(oR,sR)}var FOe=new Set;function IOe(e){let t=YI.Provider.get(e.model),{elements:n}=e,{type_symbol:r}=e.model.atomicHierarchy.atoms,i=e.elements.length,{maxDistance:a}=t,{offset:o,b:s,edgeProps:{order:c,distance:l,flag:u,key:d,operatorA:f,operatorB:p}}=t.bonds,{atomSourceIndex:m}=e.model.atomicHierarchy,{invertedIndex:h}=DB.getInvertedAtomSourceIndex(e.model),g=[],_=[],v=[],y=[],b=[],x=e.conformation.operator.key;for(let t=0;t<i;t++){let i=n[t],S=IL(r.value(i)),C=zL(S),w=m.value(i);for(let n=o[w],m=o[w+1];n<m;++n){let o=h[s[n]];if(i>=o)continue;let m=Vk.indexOf(e.elements,o);if(m<0)continue;let w=f[n],T=p[n];if(w>=0&&w!==x||T>=0&&T!==x)continue;let E=IL(r.value(o)),D=l[n],O=POe(e,i,o),k=!1;D>=0?k=wT(O,D,.3):a>=0?k=O<a:(k=O<RL(S,E,LL(S),LL(E)),C&&zL(E)&&(k=!1)),k&&(g[g.length]=t,_[_.length]=m,y[y.length]=c[n],v[v.length]=u[n],b[b.length]=d[n])}}return aR(g,_,y,v,b,i,{canRemap:!1,cacheable:t.cacheable})}function LOe(e,t){let n=DB.isCoarseGrained(e.model),r=n?jOe:t.maxRadius,{x:i,y:a,z:o}=e.model.atomicConformation,s=e.elements.length,{elements:c,residueIndex:l,chainIndex:u}=e,{type_symbol:d,label_atom_id:f,label_alt_id:p,label_comp_id:m}=e.model.atomicHierarchy.atoms,{label_seq_id:h}=e.model.atomicHierarchy.residues,{traceElementIndex:g}=e.model.atomicHierarchy.derived.residue,{index:_}=e.model.atomicHierarchy,{byEntityKey:v}=e.model.sequence,y=e.lookup3d,b=iR.Provider.get(e.model),x=rR.Provider.get(e.model),S=iR.isExhaustive(e.model),C=[],w=[],T=[],E=[],D=[],O=-1,k,A=!0,j=!0,M=!0,N=FOe,ee=!!b?.residueCantorPairs.size;for(let te=0;te<s;te++){let s=c[te],P=d.value(s);A&&P!==`H`&&P!==`O`&&(A=!1);let ne=t.forceCompute?void 0:b&&b.byAtomIndex.get(s),re=!1;if(ne)for(let t of ne){let{partnerA:n,partnerB:r}=t;if(n.symmetry!==r.symmetry)continue;let i=n.atomIndex===s?r:n,a=Vk.indexOf(e.elements,i.atomIndex);a<0||c[a]<s||(C[C.length]=te,w[w.length]=a,T[T.length]=t.flags,E[E.length]=t.order,D[D.length]=t.rowIndex,re||N.clear(),re=!0,N.add(a))}if(S)continue;let ie=l[s],ae=h.value(ie),oe=m.value(s);if(!t.forceCompute&&ie!==O)if(x&&x.entries.has(oe)){let e=v[_.getEntityFromChain(u[s])];k=e&&e.sequence.microHet.has(ae)?void 0:x.entries.get(oe).map}else k=void 0;O=ie;let se=IL(P),ce=f.value(s),le=k?k.get(ce):void 0,{indices:ue,count:de,squaredDistances:fe}=y.find(i[s],a[s],o[s],r),pe=zL(se),me=LL(se),he=p.value(s),ge=FL.has(se);for(let e=0;e<de;e++){let t=ue[e];if(re&&N.has(t))continue;let r=c[t];if(r<=s)continue;let i=p.value(r);if(he&&i&&he!==i)continue;if(ee){let e=mE(l[s],l[r]);if(b.residueCantorPairs.has(e))continue}let a=IL(d.value(r)),o=zL(a);if(pe&&o)continue;let u=(ge||FL.has(a))&&!(pe||o),m=l[r];if(ie===m&&le){let e=le.get(f.value(r));if(e){C[C.length]=te,w[w.length]=t,E[E.length]=e.order;let n=e.flags;u&&(n|kI.Flag.Covalent&&(n^=kI.Flag.Covalent),n|=kI.Flag.MetallicCoordination),T[T.length]=n,D[D.length]=e.key}continue}let _=Math.sqrt(fe[e]);if(_===0)continue;let v=!1;if(v=n?ie===m?_<=MOe:_<=NOe&&g[ie]===s&&g[m]===r:_<=RL(se,a,me,LL(a)),v){C[C.length]=te,w[w.length]=t,E[E.length]=cOe(oe,ce,f.value(r)),T[T.length]=(u?kI.Flag.MetallicCoordination:kI.Flag.Covalent)|kI.Flag.Computed,D[D.length]=-1;let e=h.value(m);ae===e&&(j=!1),Math.abs(ae-e)>1&&(M=!1)}}}return aR(C,w,E,T,D,s,{canRemap:A||j&&M})}function ROe(e){return e.conformation.operator.key===-1?!1:!!YI.Provider.get(e.model)?.hasOperators}function zOe(e){let t=YI.Provider.get(e.model),n=t.bySameOperator.get(e.conformation.operator.key);if(!n)return AL.Empty;let{a:r,b:i,edgeProps:{key:a,flag:o,order:s}}=t.bonds,{invertedIndex:c}=DB.getInvertedAtomSourceIndex(e.model),{elements:l}=e,u=[],d=[],f=[],p=[],m=[];for(let e=0,t=n.length;e<t;++e){let t=n[e];if(r[t]>=i[t])continue;let h=c[r[t]],g=Vk.indexOf(l,h);if(g<0)continue;let _=c[i[t]],v=Vk.indexOf(l,_);v<0||(u[u.length]=g,d[d.length]=v,f[f.length]=o[t],p[p.length]=s[t],m[m.length]=a[t])}return aR(u,d,p,f,m,l.length,{canRemap:!1,cacheable:t.cacheable})}function BOe(e,t){let n={...ML,...t};return n.noCompute||e.elements.length<=1?AL.Empty:!n.forceCompute&&YI.Provider.get(e.model)?ROe(e)?zOe(e):IOe(e):LOe(e,n)}var VOe=B.distance,HOe=B.set,UOe=B.squaredDistance,WOe=B.transformMat4,cR=B(),lR=B();function uR(e,t,n,r){return e.conformation.position(t,cR),n.conformation.position(r,lR),VOe(cR,lR)}var GOe=z(),dR=B();function KOe(e,t,n,r){let{maxRadius:i}=n,{elements:a,residueIndex:o}=e,{x:s,y:c,z:l}=e.model.atomicConformation,{elements:u,residueIndex:d}=t,f=e.elements.length,{type_symbol:p,label_alt_id:m,label_atom_id:h,label_comp_id:g}=e.model.atomicHierarchy.atoms,{type_symbol:_,label_alt_id:v,label_atom_id:y,label_comp_id:b}=t.model.atomicHierarchy.atoms,{auth_seq_id:x}=e.model.atomicHierarchy.residues,{auth_seq_id:S}=t.model.atomicHierarchy.residues,{occupancy:C}=e.model.atomicConformation,{occupancy:w}=t.model.atomicConformation,T=C.isDefined&&w.isDefined,E=e.model===t.model&&iR.Provider.get(e.model),D=!n.forceCompute&&e.model===t.model&&YI.Provider.get(e.model),{atomSourceIndex:O}=e.model.atomicHierarchy,{invertedIndex:k}=D?DB.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},A=e.model===t.model&&iR.isExhaustive(e.model),j=z.mul(GOe,t.conformation.operator.inverse,e.conformation.operator.matrix),M=!z.isIdentity(j),{center:N,radius:ee}=t.boundary.sphere,te=(ee+i)*(ee+i);r.startUnitPair(e.id,t.id);let P=e.conformation.operator.key,ne=t.conformation.operator.key;for(let ee=0;ee<f;ee++){let f=a[ee];if(HOe(dR,s[f],c[f],l[f]),M&&WOe(dR,dR,j),UOe(dR,N)>te)continue;if(!n.forceCompute&&D){let{maxDistance:n}=D,{offset:i,b:a,edgeProps:{order:o,distance:s,flag:c,key:l,operatorA:u,operatorB:d}}=D.bonds,m=O.value(f),h=IL(p.value(f));for(let g=i[m],_=i[m+1];g<_;++g){let i=k[a[g]],m=Vk.indexOf(t.elements,i);if(m<0)continue;let _=u[g],v=d[g];if(_>=0&&v>=0&&(_===v||_!==P||v!==ne))continue;let y=IL(p.value(i)),b=s[g],x=uR(e,f,t,i),S=!1;b>=0?S=wT(x,b,.3):n>=0?S=x<n:(S=x<RL(h,y,LL(h),LL(y)),zL(h)&&zL(y)&&(S=!1)),S&&r.add(ee,m,{order:o[g],flag:c[g],key:l[g]})}continue}let re=n.forceCompute?void 0:E&&E.byAtomIndex.get(f);if(re&&re.length){let n=!1;for(let a of re){let{partnerA:o,partnerB:s}=a,c=o.atomIndex===f?s:o,l=Vk.indexOf(t.elements,c.atomIndex);l<0||uR(e,f,t,c.atomIndex)>i||(r.add(ee,l,{order:a.order,flag:a.flags,key:a.rowIndex}),n=!0)}if(n)continue}if(A)continue;let ie=C.value(f),{lookup3d:ae}=t,{indices:oe,count:se,squaredDistances:ce}=ae.find(dR[0],dR[1],dR[2],i);if(se===0)continue;let le=IL(p.value(f)),ue=zL(le),de=LL(le),fe=m.value(f),pe=FL.has(le),me=h.value(f),he=g.value(o[f]);for(let n=0;n<se;n++){let i=oe[n],a=u[i],s=v.value(a);if(fe&&s&&fe!==s||T&&w.value(a)<1&&ie<1&&x.value(o[f])===S.value(d[a]))continue;if(E&&e.model===t.model){let e=mE(o[f],d[a]);if(E.residueCantorPairs.has(e))continue}let c=IL(_.value(a)),l=zL(c);if(ue&&l)continue;let p=(pe||FL.has(c))&&!(ue||l),m=Math.sqrt(ce[n]);if(m!==0&&m<=RL(le,c,de,LL(c))){let e=y.value(a),t=b.value(d[a]);r.add(ee,i,{order:BL(he,t,me,e),flag:(p?kI.Flag.MetallicCoordination:kI.Flag.Covalent)|kI.Flag.Computed,key:-1})}}}r.finishUnitPair()}function qOe(e){for(let t of e.models)if(!YI.Provider.get(t)?.hasOperators)return!1;for(let t of e.units)if(t.conformation.operator.key===-1)return!1;return!0}function JOe(e,t){let n=new Map;for(let t of e.units){let{key:e}=t.conformation.operator;n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))}for(let r of e.models){let i=YI.Provider.get(r),{a,b:o}=i.bonds,{order:s,flag:c,key:l,operatorA:u,operatorB:d}=i.bonds.edgeProps,{invertedIndex:f}=DB.getInvertedAtomSourceIndex(r),p=new Map;for(let t of e.units)if(t.model===r)for(let e=0,n=t.elements.length;e<n;++e){let n=t.elements[e];p.has(n)?p.get(n).add(t):p.set(n,new Set([t]))}let m=new Map;for(let e=0,t=u.length;e<t;++e){let t,r;if(u[e]===d[e]?(t=p.get(f[a[e]]),r=p.get(f[o[e]])):(t=n.get(u[e]),r=n.get(d[e])),!(!t||!r)){for(let n of t)if(u[e]===n.conformation.operator.key)for(let t of r){if(d[e]!==t.conformation.operator.key||n===t||!Q.isAtomic(n)||!Q.isAtomic(t)||n.id>t.id)continue;let r=pE(n.id,t.id);m.has(r)?m.get(r).add(e):m.set(r,new Set([e]))}}}let h=[-1,-1];m.forEach((n,r)=>{let[i,u]=hE(h,r),d=e.unitMap.get(i),p=e.unitMap.get(u);t.startUnitPair(i,u),n.forEach(e=>{let n=f[a[e]],r=Vk.indexOf(d.elements,n);if(r<0)return;let i=f[o[e]],u=Vk.indexOf(p.elements,i);u<0||t.add(r,u,{order:s[e],flag:c[e],key:l[e]})}),t.finishUnitPair()})}}var YOe={...ML,ignoreWater:!0,ignoreIon:!0};function XOe(e,t){let n=new OL.Builder,r=e.models.some(e=>YI.Provider.get(e)),i=e.models.some(e=>iR.isExhaustive(e));return t.noCompute||e.isCoarseGrained&&!r&&!i?new jL(n.getMap()):!t.forceCompute&&qOe(e)?(JOe(e,n),new jL(n.getMap())):(nB.eachUnitPair(e,(e,r)=>{KOe(e,r,t,n)},{maxRadius:t.maxRadius,validUnit:e=>t.validUnit(e),validUnitPair:(n,r)=>t.validUnitPair(e,n,r)}),new jL(n.getMap()))}function ZOe(e,t){let n={...YOe,...t};return XOe(e,{...n,validUnit:t&&t.validUnit||(e=>Q.isAtomic(e)),validUnitPair:t&&t.validUnitPair||((e,t,r)=>{if(!nB.validUnitPair(e,t,r))return!1;let i=t.model.atomicHierarchy.derived.residue.moleculeType,a=r.model.atomicHierarchy.derived.residue.moleculeType,o=(!Q.isAtomic(t)||i[t.residueIndex[t.elements[0]]]!==iI.Water)&&(!Q.isAtomic(r)||a[r.residueIndex[r.elements[0]]]!==iI.Water),s=!Q.isAtomic(t)||i[t.residueIndex[t.elements[0]]]!==iI.Ion,c=!Q.isAtomic(r)||a[r.residueIndex[r.elements[0]]]!==iI.Ion,l=s&&c;return(o||!n.ignoreWater)&&(l||!n.ignoreIon)?!0:QOe(t,r)})})}function QOe(e,t){if(e.model!==t.model||!Q.isAtomic(e)||!Q.isAtomic(t))return!1;let n=iR.Provider.get(e.model);if(!n)return!1;let r=e.elements.length<t.elements.length?e:t,i=e.elements.length>=t.elements.length?e:t,{elements:a}=r,{elements:o}=i,{indexOf:s}=Vk;for(let e=0,t=a.length;e<t;e++){let t=a[e],r=n.byAtomIndex.get(t);if(r?.length){for(let e of r)if(s(o,e.partnerA.atomIndex===t?e.partnerB.atomIndex:e.partnerA.atomIndex)>=0)return!0}}return!1}var fR;(function(e){function t(e,t,n,r,i,a){return{kind:`bond-location`,aStructure:e,aUnit:t,aIndex:n,bStructure:r,bUnit:i,bIndex:a}}e.Location=t;function n(e){return!!e&&e.kind===`bond-location`}e.isLocation=n;function r(e,t){return e.aStructure.label===t.aStructure.label&&e.bStructure.label===t.bStructure.label&&e.aIndex===t.aIndex&&e.bIndex===t.bIndex&&e.aUnit.id===t.aUnit.id&&e.bUnit.id===t.bUnit.id}e.areLocationsEqual=r;function i(e,t){return{kind:`bond-loci`,structure:e,bonds:t}}e.Loci=i;function a(e){return!!e&&e.kind===`bond-loci`}e.isLoci=a;function o(e,t){if(e.structure!==t.structure||e.bonds.length!==t.bonds.length)return!1;for(let n=0,i=e.bonds.length;n<i;++n)if(!r(e.bonds[n],t.bonds[n]))return!1;return!0}e.areLociEqual=o;function s(e){return e.bonds.length===0}e.isLociEmpty=s;function c(e,n){if(n===e.structure)return e;let r=[];return e.bonds.forEach(i=>{let a=n.unitMap.get(i.aUnit.id);if(!a)return;let o=n.unitMap.get(i.bUnit.id);if(!o)return;let s=i.aUnit.elements[i.aIndex],c=Vk.indexOf(a.elements,s);if(c===-1)return;let l=i.bUnit.elements[i.bIndex],u=Vk.indexOf(o.elements,l);u!==-1&&r.push(t(e.structure,a,c,e.structure,o,u))}),i(n,r)}e.remapLoci=c;function l(e){let t=[],n=new Map;for(let t of e.bonds){let{aIndex:e,aUnit:r,bIndex:i,bUnit:a}=t;r===a?n.has(r.id)?n.get(r.id).push(e,i):n.set(r.id,[e,i]):(n.has(r.id)?n.get(r.id).push(e):n.set(r.id,[e]),n.has(a.id)?n.get(a.id).push(i):n.set(a.id,[i]))}return n.forEach((n,r)=>{t.push({unit:e.structure.unitMap.get(r),indices:Vk.deduplicate(Vk.ofUnsortedArray(n))})}),$(e.structure,t)}e.toStructureElementLoci=l;function u(e){let{aUnit:t,aIndex:n}=e.bonds[0];return $(e.structure,[{unit:t,indices:K.ofSingleton(n)}])}e.toFirstStructureElementLoci=u;function d(e,t){if(t.aUnit===t.bUnit){let e=t.aUnit.bonds,n=e.getEdgeIndex(t.aIndex,t.bIndex);return n<0?kI.create(kI.Flag.None):kI.create(e.edgeProps.flags[n])}else{let n=e.interUnitBonds.getBondFromLocation(t);return n?kI.create(n.props.flag):kI.create(kI.Flag.None)}}e.getType=d;function f(e,t){if(t.aUnit===t.bUnit){let e=t.aUnit.bonds,n=e.getEdgeIndex(t.aIndex,t.bIndex);return n<0?0:e.edgeProps.order[n]}else{let n=e.interUnitBonds.getBondFromLocation(t);return n?n.props.order:0}}e.getOrder=f;function p(e){let t=0;for(let n of e.unitSymmetryGroups){let e=n.units[0];Q.isAtomic(e)&&(t+=e.bonds.edgeCount*n.units.length)}return t}e.getIntraUnitBondCount=p;class m{move(){return this.advance(),this.current}setElement(e,t,n){this.structure=e,this.unit=t,this.index=n,this.interBondIndices=e.interUnitBonds.getEdgeIndices(n,t.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=t.bonds.offset[n+1],this.intraBondIndex=t.bonds.offset[n],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){let e=this.structure.interUnitBonds.edges[this.interBondIndices[this.interBondIndex]];this.current.otherUnit=this.structure.unitMap.get(e.unitA===this.unit.id?e.unitB:e.unitA),this.current.otherIndex=e.indexA===this.index?e.indexB:e.indexA,this.current.type=e.props.flag,this.current.order=e.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}constructor(){this.current={},this.hasNext=!1}}e.ElementBondIterator=m;function h(e,t){return FA.fromPairProvider(e.bonds.length,(t,n,r)=>{let{aUnit:i,aIndex:a,bUnit:o,bIndex:s}=e.bonds[t];i.conformation.position(i.elements[a],n),o.conformation.position(o.elements[s],r)},t)}e.getBoundingSphere=h})(fR||={});function $Oe(e){let t=eke(e,tke(e)),n=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(;n.hasNext;){let e=n.move();nke(t,e.start,e.end)}return t.rings}var pR;(function(e){e[e.MaxDepth=5]=`MaxDepth`})(pR||={});function eke(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(pR.MaxDepth),right:new Int32Array(pR.MaxDepth),color:new Int32Array(t),currentColor:0,currentAltLoc:``,hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function mR(e){e.count=e.endVertex-e.startVertex;let{isRingAtom:t,pred:n,color:r,depth:i,marked:a}=e;for(let o=0;o<e.count;o++)t[o]=0,n[o]=-1,a[o]=-1,r[o]=0,i[o]=0;e.currentColor=0,e.currentAltLoc=``,e.hasAltLoc=!1}function hR(e){let{depth:t}=e;for(let n=0;n<e.count;n++)t[n]=e.count+1}function tke(e){let t=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),n=0;for(;t.hasNext;){let e=t.move();n=Math.max(n,e.end-e.start)}return n}function gR(e,t){let n=e.bonds.offset,r=e.startVertex+t,i=n[r],a=n[r+1]-i;return!(a<=1||e.isRingAtom[t]&&a===2)}function nke(e,t,n){if(e.startVertex=t,e.endVertex=n,e.endVertex-e.startVertex<3)return;e.currentRings=[];let{elements:r}=e.unit,i=[];for(let t=e.startVertex;t<e.endVertex;t++)OE(i,e.altLoc.value(r[t]));kE(i,``);let a=1;if(i.length===0){mR(e);for(let t=0;t<e.count;t++)gR(e,t)&&(hR(e),a=_R(e,t,a))}else for(let t=0;t<i.length;t++){mR(e),e.hasAltLoc=!0,e.currentAltLoc=i[t];for(let t=0;t<e.count;t++){if(!gR(e,t))continue;let n=e.altLoc.value(r[e.startVertex+t]);n&&n!==e.currentAltLoc||(hR(e),a=_R(e,t,a))}}for(let t=0,n=e.currentRings.length;t<n;t++)e.rings.push(e.currentRings[t])}function rke(e,t,n,r){if(n<t)return!1;let{pred:i,color:a,left:o,right:s}=e,c=++e.currentColor,l=t;for(let e=0;e<pR.MaxDepth&&(a[l]=c,l=i[l],!(l<0));e++);let u=0,d=0,f=!1,p=0;l=n;for(let e=0;e<pR.MaxDepth;e++){if(a[l]===c){p=l,f=!0;break}if(s[d++]=l,l=i[l],l<0)break}if(!f)return!1;l=t;for(let e=0;e<pR.MaxDepth&&(o[u++]=l,!(p===l||(l=i[l],l<0)));e++);let m=u+d;if(m<3)return!1;let h=new Int32Array(m),g=0;for(let t=0;t<u;t++)h[g++]=e.startVertex+o[t],r[o[t]]=1;for(let t=d-1;t>=0;t--)h[g++]=e.startVertex+s[t],r[s[t]]=1;ZD(h);for(let t=0,n=e.currentRings.length;t<n;t++){let n=e.currentRings[t];if(h.length===n.length){if(Vk.areEqual(h,n))return!1}else if(h.length>n.length&&Vk.isSubset(h,n))return!1}return e.currentRings.push(Vk.ofSortedArray(h)),!0}function _R(e,t,n){let{bonds:r,startVertex:i,endVertex:a,isRingAtom:o,marked:s,queue:c,pred:l,depth:u}=e,{elements:d}=e.unit,{b:f,edgeProps:{flags:p},offset:m}=r;s[t]=n,u[t]=0,c[0]=t;let h=0,g=1;for(;h<g;){let t=c[h++],r=u[t],_=i+t,v=m[_],y=m[_+1];for(let m=v;m<y;m++){let h=f[m];if(h<i||h>=a||!kI.isCovalent(p[m]))continue;if(e.hasAltLoc){let t=e.altLoc.value(d[h]);if(t&&e.currentAltLoc!==t)continue}let _=h-i;if(s[_]===n){if(l[_]!==t&&l[t]!==_&&rke(e,t,_,o))return n+1;continue}let v=Math.min(u[_],r+1);v>pR.MaxDepth||(u[_]=v,s[_]=n,c[g++]=_,l[_]=t)}}return n+1}function ike(e){let t=e.length,n=Array(t);for(let r=0;r<t;r++)n[r]=e[t-r-1];let r=vR(e),i=vR(n),a=!1;for(let o=0;o<t;o++){let s=e[(o+r)%t],c=n[(o+i)%t];if(s!==c){a=s<c;break}}return a?yR(e,r):yR(n,i)}function vR(e){let t=e.length,n=new Int32Array(t*2);for(let e=0;e<n.length;e++)n[e]=-1;let r=``,i=``,a=0;for(let o=1;o<n.length;o++){let s=n[o-a-1];for(;s!==-1&&(r=e[o%t],i=e[(a+s+1)%t],r!==i);)r<i&&(a=o-s-1),s=n[s];s===-1?(r=e[o%t],i=e[(a+s+1)%t],r===i?n[o-a]=s+1:(r<i&&(a=o),n[o-a]=-1)):n[o-a]=s+1}return a}function yR(e,t){let n=e.length,r=[],i;for(i=0;i<n-1;i++)r.push(e[(i+t)%n]),r.push(`-`);return r.push(e[(i+t)%n]),r.join(``)}function ake(e,t){let n=new Map,r=new Map;for(let t=0,r=e.length;t<r;t++){let r=e[t];for(let e=0,i=r.length;e<i;e++){let i=r[e];n.has(i)?n.get(i).push(t):n.set(i,[t])}}for(let n=0,i=t.length;n<i;n++){let i=t[n],a=e[i];for(let e=0,t=a.length;e<t;e++){let t=a[e];r.has(t)?r.get(t).push(i):r.set(t,[i])}}let i=new KI.UniqueEdgeBuilder(e.length);for(let t=0,r=e.length;t<r;t++){let r=e[t];for(let e=0,a=r.length;e<a;e++){let a=r[e],o=n.get(a);if(o.length!==1)for(let e=0,n=o.length;e<n;e++){let n=o[e];t>=n||i.addEdge(t,n)}}}let a=KI.connectedComponents(i.getGraph()),o=a.componentIndex,s=[];for(let e=0;e<a.componentCount;e++)s[e]=[];for(let t=0,n=e.length;t<n;t++)s[o[t]].push(t);return{elementRingIndices:n,elementAromaticRingIndices:r,ringComponentIndex:o,ringComponents:s}}var bR;(function(e){e.H=`H`,e.D=`D`,e.T=`T`,e.HE=`HE`,e.LI=`LI`,e.BE=`BE`,e.B=`B`,e.C=`C`,e.N=`N`,e.O=`O`,e.F=`F`,e.NE=`NE`,e.NA=`NA`,e.MG=`MG`,e.AL=`AL`,e.SI=`SI`,e.P=`P`,e.S=`S`,e.CL=`CL`,e.AR=`AR`,e.K=`K`,e.CA=`CA`,e.SC=`SC`,e.TI=`TI`,e.V=`V`,e.CR=`CR`,e.MN=`MN`,e.FE=`FE`,e.CO=`CO`,e.NI=`NI`,e.CU=`CU`,e.ZN=`ZN`,e.GA=`GA`,e.GE=`GE`,e.AS=`AS`,e.SE=`SE`,e.BR=`BR`,e.KR=`KR`,e.RB=`RB`,e.SR=`SR`,e.Y=`Y`,e.ZR=`ZR`,e.NB=`NB`,e.MO=`MO`,e.TC=`TC`,e.RU=`RU`,e.RH=`RH`,e.PD=`PD`,e.AG=`AG`,e.CD=`CD`,e.IN=`IN`,e.SN=`SN`,e.SB=`SB`,e.TE=`TE`,e.I=`I`,e.XE=`XE`,e.CS=`CS`,e.BA=`BA`,e.LA=`LA`,e.CE=`CE`,e.PR=`PR`,e.ND=`ND`,e.PM=`PM`,e.SM=`SM`,e.EU=`EU`,e.GD=`GD`,e.TB=`TB`,e.DY=`DY`,e.HO=`HO`,e.ER=`ER`,e.TM=`TM`,e.YB=`YB`,e.LU=`LU`,e.HF=`HF`,e.TA=`TA`,e.W=`W`,e.RE=`RE`,e.OS=`OS`,e.IR=`IR`,e.PT=`PT`,e.AU=`AU`,e.HG=`HG`,e.TL=`TL`,e.PB=`PB`,e.BI=`BI`,e.PO=`PO`,e.AT=`AT`,e.RN=`RN`,e.FR=`FR`,e.RA=`RA`,e.AC=`AC`,e.TH=`TH`,e.PA=`PA`,e.U=`U`,e.NP=`NP`,e.PU=`PU`,e.AM=`AM`,e.CM=`CM`,e.BK=`BK`,e.CF=`CF`,e.ES=`ES`,e.FM=`FM`,e.MD=`MD`,e.NO=`NO`,e.LR=`LR`,e.RF=`RF`,e.DB=`DB`,e.SG=`SG`,e.BH=`BH`,e.HS=`HS`,e.MT=`MT`,e.DS=`DS`,e.RG=`RG`,e.CN=`CN`,e.NH=`NH`,e.FL=`FL`,e.MC=`MC`,e.LV=`LV`,e.TS=`TS`,e.OG=`OG`})(bR||={});const oke={H:`Hydrogen`,HE:`Helium`,LI:`Lithium`,BE:`Beryllium`,B:`Boron`,C:`Carbon`,N:`Nitrogen`,O:`Oxygen`,F:`Fluorine`,NE:`Neon`,NA:`Sodium`,MG:`Magnesium`,AL:`Aluminum`,SI:`Silicon`,P:`Phosphorus`,S:`Sulfur`,CL:`Chlorine`,AR:`Argon`,K:`Potassium`,CA:`Calcium`,SC:`Scandium`,TI:`Titanium`,V:`Vanadium`,CR:`Chromium`,MN:`Manganese`,FE:`Iron`,CO:`Cobalt`,NI:`Nickel`,CU:`Copper`,ZN:`Zinc`,GA:`Gallium`,GE:`Germanium`,AS:`Arsenic`,SE:`Selenium`,BR:`Bromine`,KR:`Krypton`,RB:`Rubidium`,SR:`Strontium`,Y:`Yttrium`,ZR:`Zirconium`,NB:`Niobium`,MO:`Molybdenum`,TC:`Technetium`,RU:`Ruthenium`,RH:`Rhodium`,PD:`Palladium`,AG:`Silver`,CD:`Cadmium`,IN:`Indium`,SN:`Tin`,SB:`Antimony`,TE:`Tellurium`,I:`Iodine`,XE:`Xenon`,CS:`Cesium`,BA:`Barium`,LA:`Lanthanum`,CE:`Cerium`,PR:`Praseodymium`,ND:`Neodymium`,PM:`Promethium`,SM:`Samarium`,EU:`Europium`,GD:`Gadolinium`,TB:`Terbium`,DY:`Dysprosium`,HO:`Holmium`,ER:`Erbium`,TM:`Thulium`,YB:`Ytterbium`,LU:`Lutetium`,HF:`Hafnium`,TA:`Tantalum`,W:`Wolfram`,RE:`Rhenium`,OS:`Osmium`,IR:`Iridium`,PT:`Platinum`,AU:`Gold`,HG:`Mercury`,TL:`Thallium`,PB:`Lead`,BI:`Bismuth`,PO:`Polonium`,AT:`Astatine`,RN:`Radon`,FR:`Francium`,RA:`Radium`,AC:`Actinium`,TH:`Thorium`,PA:`Protactinium`,U:`Uranium`,NP:`Neptunium`,PU:`Plutonium`,AM:`Americium`,CM:`Curium`,BK:`Berkelium`,CF:`Californium`,ES:`Einsteinium`,FM:`Fermium`,MD:`Mendelevium`,NO:`Nobelium`,LR:`Lawrencium`,RF:`Rutherfordium`,DB:`Dubnium`,SG:`Seaborgium`,BH:`Bohrium`,HS:`Hassium`,MT:`Meitnerium`,DS:`Darmstadtium`,RG:`Roentgenium`,CN:`Copernicium`,NH:`Nihonium`,FL:`Flerovium`,MC:`Moscovium`,LV:`Livermorium`,TS:`Tennessine`,OG:`Oganesson`},ske=new Set([`LI`,`NA`,`K`,`RB`,`CS`,`FR`]);function cke(e){return ske.has(e)}const lke=new Set([`BE`,`MG`,`CA`,`SR`,`BA`,`RA`]);function uke(e){return lke.has(e)}const dke=new Set([`ZN`,`GA`,`CD`,`IN`,`SN`,`HG`,`TI`,`PB`,`BI`,`PO`,`CN`]);function fke(e){return dke.has(e)}const pke=new Set([`F`,`CL`,`BR`,`I`,`AT`]);function mke(e){return pke.has(e)}function xR(e){let t=GI(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function hke(e){let t=GI(e);return t>=57&&t<=71}function gke(e){let t=GI(e);return t>=89&&t<=103}function _ke(e){return cke(e)||uke(e)||hke(e)||gke(e)||xR(e)||fke(e)}function vke(e,t){let n=e.coarseElements.entityKey[t],r=e.model.sequence.byEntityKey[n].sequence,i=e.coarseElements.seq_id_begin.value(t);return r.compId.value(i-1)}function SR(e,t){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case Q.Kind.Spheres:case Q.Kind.Gaussians:let n=vke(e,t),r=e.model.properties.chemicalComponentMap.get(n);if(r)return CI(r.type,n)}return iI.Unknown}var yke=new Set;function CR(e,t){let n=JEe[e];if(n!==void 0){let e=n[t];if(e!==void 0)return e}return yke}var wR=B.zero();function TR(e,t){let n=e.conformation,r=new Float32Array(t.length*3),{elements:i}=e;for(let e=0,a=t.length;e<a;++e)n.position(i[t[e]],wR),B.toArray(wR,r,e*3);return r}var ER=class{get index(){return this._index||=ake(this.all,this.aromaticRings),this._index}get byFingerprint(){return this._byFingerprint||=bke(this.unit,this.all),this._byFingerprint}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings||=Cke(this.unit,this.all),this._aromaticRings}constructor(e,t){this.unit=t,this.all=e}},DR;(function(e){function t(e,t){let{elements:r}=e,{type_symbol:i}=e.model.atomicHierarchy.atoms,a=[];for(let e=0,n=t.length;e<n;e++)a[a.length]=i.value(r[t[e]]);return n(a)}e.fingerprint=t;function n(e){return ike(e)}e.elementFingerprint=n;let r=new Set([bR.B,bR.C,bR.N,bR.O,bR.SI,bR.P,bR.S,bR.GE,bR.AS,bR.SN,bR.SB,bR.BI]);function i(e,t){let{elements:n,bonds:{b:i,offset:a,edgeProps:{flags:o}}}=e,{type_symbol:s,label_comp_id:c}=e.model.atomicHierarchy.atoms;if(c.value(e.elements[t[0]])===`PRO`)return!1;let l=0,u=!1;for(let e=0,c=t.length;e<c;++e){let c=t[e];!u&&r.has(s.value(n[c]))&&(u=!0);for(let e=a[c],n=a[c+1];e<n;++e)kI.is(kI.Flag.Aromatic,o[e])&&Vk.has(t,i[e])&&(l+=1)}if(l===2*t.length)return!0;if(!u||t.length<5||l>0)return!1;let d=Qk.calculateMomentsAxes(TR(e,t));return B.magnitude(d.dirC)<.05}e.isAromatic=i;function a(e,t){let{label_alt_id:n}=e.model.atomicHierarchy.atoms,{elements:r}=e;for(let e=0,i=t.length;e<i;++e){let i=r[t[e]],a=n.value(i);if(a)return a}return``}e.getAltId=a})(DR||={}),(function(e){function t(t){return Q.Traits.is(t.traits,Q.Trait.Water)||Q.Traits.is(t.traits,Q.Trait.CoarseGrained)?new e([],t):new e($Oe(t),t)}e.create=t;function n(e,t){let n=new Map;for(let r=0,i=t.length;r<i;r++){let i=t[r];Ske(e,i,n)}return n}e.byFingerprintAndResidue=n})(ER||={});function bke(e,t){let n=new Map,r=0;for(let i=0,a=t.length;i<a;i++){let a=t[i],o=DR.fingerprint(e,a);n.has(o)?n.get(o).push(r):n.set(o,[r]),r++}return n}function xke(e,t){let{elements:n}=e,r=e.model.atomicHierarchy.residueAtomSegments.index,i=r[n[t[0]]];for(let e=1,a=t.length;e<a;e++)if(i!==r[n[t[e]]])return-1;return i}function Ske(e,t,n){let r=e.byFingerprint.get(t);if(r)for(let t=0,i=r.length;t<i;t++){let i=r[t],a=xke(e.unit,e.all[i]);a>=0&&(n.has(a)?n.get(a).push(i):n.set(a,[i]))}}function Cke(e,t){let n=[];for(let r=0,i=t.length;r<i;++r)DR.isAromatic(e,t[r])&&n.push(r);return n}var OR;(function(e){function t(e){return Vk.ofSortedArray(e)}e.ofSortedRanges=t;function n(e){return e[0]}e.start=n;function r(e){return e[e.length-1]+1}e.end=r;function i(e){return e[0]}e.min=i;function a(e){return e[e.length-1]}e.max=a;function o(e){let t=0;for(let n=0,r=e.length;n<r;n+=2)t+=e[n+1]-e[n]+1;return t}e.size=o;function s(e){return e.length/2}e.count=s;function c(e,t){return e[t*2]}e.startAt=c;function l(e,t){return e[t*2+1]+1}e.endAt=l;function u(e,t){return e[t*2]}e.minAt=u;function d(e,t){return e[t*2+1]}e.maxAt=d;function f(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}e.areEqual=f;function p(e,t){let n=0;for(let r=0,i=e.length;r<i;r+=2)for(let i=e[r],a=e[r+1];i<=a;++i)t(i,n),++n}e.forEach=p;function m(e,t){return g(e,t)!==-1}e.has=m;function h(e,t,n){return _(e,t,n)!==-1}e.hasFrom=h;function g(e,t){return _(e,t,0)}e.firstIntersectionIndex=g;function _(e,t,n){if(u(e,n)>K.max(t)||a(e)<K.min(t))return-1;for(let r=n,i=s(e);r<i;++r){let n=G.ofRange(u(e,r),d(e,r));if(K.areIntersecting(n,t))return r}return-1}e.firstIntersectionIndexFrom=_;function v(e,t){return new y(e,t)}e.transientSegments=v;class y{updateValue(){this.value.index=this.curIndex,this.value.start=K.findPredecessorIndex(this.set,c(this.ranges,this.curIndex)),this.value.end=K.findPredecessorIndex(this.set,l(this.ranges,this.curIndex))}move(){return this.hasNext&&=(this.updateValue(),this.curIndex=_(this.ranges,this.set,this.curIndex+1),this.curIndex!==-1),this.value}constructor(e,t){this.ranges=e,this.set=t,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=g(e,t),this.hasNext=this.curIndex!==-1}}e.Iterator=y})(OR||={});function wke(e){let t=[],{elements:n,model:r}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:a}=r.atomicHierarchy.derived.residue,o=OR.transientSegments(e.model.atomicRanges.polymerRanges,n),s=uA.transientSegments(i,n);for(;o.hasNext;){let e=o.move();for(s.setSegment(e);s.hasNext;){let{start:e,end:r,index:o}=s.move();if(K.areIntersecting(G.ofRange(n[e],n[r-1]),n)){let e=a[o];t.push(e===-1?i.offsets[o]:e)}}}return Vk.ofSortedArray(t)}function Tke(e){let t=[],{elements:n,model:r}=e,{spheres:i,gaussians:a}=r.coarseHierarchy,o=Q.isSpheres(e)?i.polymerRanges:a.polymerRanges,s=OR.transientSegments(o,n);for(;s.hasNext;){let{start:e,end:r}=s.move();for(let i=e;i<r;++i)t.push(n[i])}return Vk.ofSortedArray(t)}function Eke(e){let t=[],{elements:n,model:r,residueIndex:i}=e,{residueAtomSegments:a}=e.model.atomicHierarchy,{traceElementIndex:o}=r.atomicHierarchy.derived.residue,s=OR.transientSegments(e.model.atomicRanges.gapRanges,e.elements);for(;s.hasNext;){let e=s.move(),r=i[n[e.start]],c=i[n[e.end-1]],l=o[r],u=o[c];t.push(l===-1?a.offsets[r]:l),t.push(u===-1?a.offsets[c]:u)}return Vk.ofSortedArray(t)}function Dke(e){let t=[],{elements:n,model:r}=e,{spheres:i,gaussians:a}=r.coarseHierarchy,o=Q.isSpheres(e)?i.gapRanges:a.gapRanges,s=OR.transientSegments(o,n);for(;s.hasNext;){let{start:e,end:r}=s.move();t.push(n[e],n[r-1])}return Vk.ofSortedArray(t)}function Oke(e){let t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:a}=r.atomicHierarchy,{moleculeType:o,traceElementIndex:s}=r.atomicHierarchy.derived.residue,c=uA.transientSegments(i,n),l=uA.transientSegments(a,n);for(;c.hasNext;)for(l.setSegment(c.move());l.hasNext;){let{index:e}=l.move();if(EI(o[e])){let n=s[e];t.push(n===-1?a.offsets[e]:n)}}return Vk.ofSortedArray(t)}function kke(e){let t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:a}=r.atomicHierarchy,{moleculeType:o,traceElementIndex:s}=r.atomicHierarchy.derived.residue,c=uA.transientSegments(i,n),l=uA.transientSegments(a,n);for(;c.hasNext;)for(l.setSegment(c.move());l.hasNext;){let{index:e}=l.move();if(DI(o[e])){let n=s[e];t.push(n===-1?a.offsets[e]:n)}}return Vk.ofSortedArray(t)}var kR=B();function Ake(e){let{elements:t,conformation:n}=e,r=new Float32Array(t.length*3);for(let e=0,i=t.length;e<i;e++)n.invariantPosition(t[e],kR),B.toArray(kR,r,e*3);return r}function AR(e){let t=Ake(e);return Qk.ofPositions(t)}var jR=B.set,jke=new RA(`14`),Mke=new RA(`98`);function Nke(e){return e>1e4?jke:Mke}function MR(e){let t=$k.computeBounding(e);return{box:t,sphere:q.fromBox3D(q(),t)}}var NR=B();function PR(e){let{x:t,y:n,z:r,radius:i,indices:a}=e,o=K.size(a);if(o>25e4)return MR(e);let s=Nke(o);s.reset();for(let e=0;e<o;e++){let o=K.getAt(a,e);jR(NR,t[o],n[o],r[o]),s.includePositionRadius(NR,i&&i[o]||0)}s.finishedIncludeStep();for(let e=0;e<o;e++){let o=K.getAt(a,e);jR(NR,t[o],n[o],r[o]),s.radiusPositionRadius(NR,i&&i[o]||0)}let c=s.getSphere();if(!i&&q.hasExtrema(c)&&o<=c.extrema.length){let e=[];for(let i=0;i<o;i++){let o=K.getAt(a,i);e.push(B.create(t[o],n[o],r[o]))}q.setExtrema(c,e)}return{box:s.getBox(),sphere:c}}var Pke=class e{constructor(){this.data=new Map}get(e){let t=Vk.hashCode(e);if(this.data.has(t)){for(let[n,r]of this.data.get(t))if(Vk.areEqual(e,n))return r}}set(e,t){let n=Vk.hashCode(e);if(this.data.has(n)){let r=this.data.get(n);for(let n of r)if(Vk.areEqual(e,n[0])){n[1]=t;return}r.push([e,t])}else this.data.set(n,[[e,t]])}static get(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache}},Fke={delocalizedTriplets:{getThirdElement:()=>void 0,getTripletIndices:()=>void 0,triplets:[]}};function Ike(e){return Q.Traits.is(e.traits,Q.Trait.Water)||Q.Traits.is(e.traits,Q.Trait.CoarseGrained)?Fke:{delocalizedTriplets:Lke(e)}}function Lke(e){let{b:t,edgeProps:n,offset:r}=e.bonds,{order:i,flags:a}=n,{elementAromaticRingIndices:o}=e.rings,s=[],c=new Map,l=new Map,u=(e,t,n)=>{let r=s.length;s.push(Vk.ofUnsortedArray([e,t,n])),c.set(mE(e,t),n),l.has(e)?l.get(e).push(r):l.set(e,[r])};for(let n=0;n<e.elements.length;n++){if(o.has(n)||r[n+1]-r[n]+1<2)continue;let e=[];for(let i=r[n],o=r[n+1];i<o;i++){let n=a[i];kI.is(n,kI.Flag.Aromatic)&&e.push(t[i])}if(e.length>=2){u(n,e[0],e[1]);for(let t=1,r=e.length;t<r;t++)u(n,e[t],e[0])}}return{getThirdElement:(e,t)=>c.get(mE(e,t)),getTripletIndices:e=>l.get(e),triplets:s}}var Q;(function(e){let t;(function(e){e[e.Atomic=0]=`Atomic`,e[e.Spheres=1]=`Spheres`,e[e.Gaussians=2]=`Gaussians`})(t=e.Kind||={}),(function(e){e[e.Atomic=0]=`Atomic`,e[e.Spheres=1]=`Spheres`,e[e.Gaussians=2]=`Gaussians`})(e.Kinds||={});function n(e){return e.kind===t.Atomic}e.isAtomic=n;function r(e){return e.kind===t.Spheres||e.kind===t.Gaussians}e.isCoarse=r;function i(e){return e.kind===t.Spheres}e.isSpheres=i;function a(e){return e.kind===t.Gaussians}e.isGaussians=a;function o(e,n,r,i,a,o,s,c,l){switch(a){case t.Atomic:return new v(e,n,r,i,o,c,tA.createMapping(s,o.atomicConformation,h(o)),l??y());case t.Spheres:return E(e,n,r,i,o,t.Spheres,c,tA.createMapping(s,o.coarseConformation.spheres,g(o)),l??C());case t.Gaussians:return E(e,n,r,i,o,t.Gaussians,c,tA.createMapping(s,o.coarseConformation.gaussians,_(o)),l??C())}}e.create=o;function s(e){let t=dA.Mutable();for(let n=0,r=e.length;n<r;n++)t.set(e[n].id,n);return t}function c(e){let t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n].id);return gE(t)}function l(e){let t={};return{elements:e[0].elements,units:e,get unitIndexMap(){return t.unitIndexMap||=s(e),t.unitIndexMap},hashCode:d(e[0]),transformHash:c(e)}}e.SymmetryGroup=l,(function(e){function t(e,t){return e.hashCode===t.hashCode?Vk.areEqual(e.elements,t.elements):!1}e.areInvariantElementsEqual=t;function n(e){let t=dA.Mutable();for(let n=0,r=e.length;n<r;++n){let r=e[n];for(let e=0,i=r.units.length;e<i;++e)t.set(r.units[e].id,n)}return t}e.getUnitSymmetryGroupsIndexMap=n})(l=e.SymmetryGroup||={});function u(t){return e.isAtomic(t)?t.model.atomicConformation.id:t.model.coarseConformation.id}e.conformationId=u;function d(e){return dE(e.invariantId,Vk.hashCode(e.elements))}e.hashUnit=d;let f;(function(e){e[e.None=0]=`None`,e[e.MultiChain=1]=`MultiChain`,e[e.Partitioned=2]=`Partitioned`,e[e.FastBoundary=4]=`FastBoundary`,e[e.Water=8]=`Water`,e[e.CoarseGrained=16]=`CoarseGrained`})(f=e.Trait||={});let p;(function(e){e.is=_x.has,e.create=_x.create})(p=e.Traits||={});function m(){return{}}function h(e){let t=e.atomicHierarchy.atoms.type_symbol.value;return e=>WI(t(e))}function g(e){let t=e.coarseConformation.spheres.radius;return e=>t[e]}function _(e){return e=>0}class v{get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(e){return e.length===this.elements.length?this:new v(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,e,this.conformation,y())}getCopy(e,t,n,r){let i=new v(e,t,n,this.traits,this.model,this.elements,this.conformation,this.props);return r?.propagateTransientCache&&(i._transientCache=this._transientCache),i}applyOperator(e,t,n=!1){let r=n?t:tA.compose(this.conformation.operator,t);return new v(e,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,tA.createMapping(r,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(t,n,r){r||(r={...this.props,bonds:n&&!this.props.bonds?.props?.canRemap?void 0:A(this,this.props.bonds,t,n)},e.isSameConformation(this,t)||(r.boundary=void 0,r.lookup3d=void 0,r.principalAxes=void 0));let i=this.conformation.operator,a=bB.Provider.get(t);if(i.spgrOp!==-1&&a&&a!==bB.Provider.get(this.model)){let[e,n,r]=i.hkl,{toFractional:o}=a.spacegroup.cell,s=B.transformMat4(B(),DB.getCenter(t),o);i=sA.getSymmetryOperatorRef(a.spacegroup,i.spgrOp,e,n,r,s)}let o=this.model.atomicConformation!==t.atomicConformation||i!==this.conformation.operator?tA.createMapping(i,t.atomicConformation,h(t)):this.conformation;return new v(this.id,this.invariantId,this.chainGroupId,this.traits,t,this.elements,o,r)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:e,y:t,z:n}=this.model.atomicConformation,r=DB.getAtomicRadii(this.model);return this.props.boundary=p.is(this.traits,f.FastBoundary)?MR({x:e,y:t,z:n,radius:r,indices:this.elements}):PR({x:e,y:t,z:n,radius:r,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:e,y:t,z:n}=this.model.atomicConformation;return this.props.lookup3d=yA({x:e,y:t,z:n,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=AR(this)),this.props.principalAxes}get bonds(){if(this.props.bonds)return this.props.bonds;let e=Pke.get(this.model),t=e.get(this.elements);return t||(t=BOe(this),t.props?.cacheable&&e.set(this.elements,t)),this.props.bonds=t,this.props.bonds}get rings(){return this.props.rings||(this.props.rings=ER.create(this)),this.props.rings}get resonance(){return this.props.resonance||(this.props.resonance=Ike(this)),this.props.resonance}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=wke(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=Eke(this)),this.props.gapElements}get nucleotideElements(){return this.props.nucleotideElements||(this.props.nucleotideElements=Oke(this)),this.props.nucleotideElements}get proteinElements(){return this.props.proteinElements||(this.props.proteinElements=kke(this)),this.props.proteinElements}get residueCount(){if(this.props.residueCount!==void 0)return this.props.residueCount;let e=0,t=uA.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;t.hasNext;)t.move(),e+=1;return this.props.residueCount=e,this.props.residueCount}getResidueIndex(e){return this.residueIndex[this.elements[e]]}constructor(e,n,r,i,a,o,s,c){this.kind=t.Atomic,this.objectPrimitive=`atomistic`,this._transientCache=void 0,this.id=e,this.invariantId=n,this.chainGroupId=r,this.traits=i,this.model=a,this.elements=o,this.conformation=s,this.residueIndex=a.atomicHierarchy.residueAtomSegments.index,this.chainIndex=a.atomicHierarchy.chainAtomSegments.index,this.props=c}}e.Atomic=v;function y(){return m()}class b{get transientCache(){return this._transientCache===void 0&&(this._transientCache=new Map),this._transientCache}getChild(e){return e.length===this.elements.length?this:E(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,e,this.conformation,C())}getCopy(e,t,n,r){let i=E(e,t,n,this.traits,this.model,this.kind,this.elements,this.conformation,this.props);return r?.propagateTransientCache&&(i._transientCache=this._transientCache),i}applyOperator(e,t,n=!1){let r=n?t:tA.compose(this.conformation.operator,t);return E(e,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,tA.createMapping(r,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(t,n,r){let i=this.getCoarseConformation(),a=x(this.kind,t);r||(r={...this.props},e.isSameConformation(this,t)||(r.boundary=void 0,r.lookup3d=void 0,r.principalAxes=void 0));let o=i===a?this.conformation:tA.createMapping(this.conformation.operator,a,this.kind===e.Kind.Spheres?g(t):_(t));return new b(this.id,this.invariantId,this.chainGroupId,this.traits,t,this.kind,this.elements,o,r)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:e,y:t,z:n}=this.getCoarseConformation(),r=this.getCoarseRadii();return this.props.boundary=p.is(this.traits,f.FastBoundary)?MR({x:e,y:t,z:n,radius:r,indices:this.elements}):PR({x:e,y:t,z:n,radius:r,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:e,y:t,z:n}=this.getCoarseConformation();return this.props.lookup3d=yA({x:e,y:t,z:n,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=AR(this)),this.props.principalAxes}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=Tke(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=Dke(this)),this.props.gapElements}getCoarseConformation(){return x(this.kind,this.model)}getCoarseRadii(){return S(this.kind,this.model)}constructor(e,n,r,i,a,o,s,c,l){this._transientCache=void 0,this.kind=o,this.objectPrimitive=o===t.Spheres?`sphere`:`gaussian`,this.id=e,this.invariantId=n,this.chainGroupId=r,this.traits=i,this.model=a,this.elements=s,this.conformation=c,this.coarseElements=o===t.Spheres?a.coarseHierarchy.spheres:a.coarseHierarchy.gaussians,this.coarseConformation=o===t.Spheres?a.coarseConformation.spheres:a.coarseConformation.gaussians,this.props=l}}function x(e,n){return e===t.Spheres?n.coarseConformation.spheres:n.coarseConformation.gaussians}function S(e,n){return e===t.Spheres?n.coarseConformation.spheres.radius:void 0}function C(){return m()}class w extends b{}e.Spheres=w;class T extends b{}e.Gaussians=T;function E(e,t,n,r,i,a,o,s,c){return new b(e,t,n,r,i,a,o,s,c)}function D(e,t){return e.chainGroupId===t.chainGroupId&&e.conformation.operator.name===t.conformation.operator.name}e.areSameChainOperatorGroup=D;function O(e,t){return z.areEqual(e.conformation.operator.matrix,t.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=O;function k(e,t){return e===t?!0:Vk.areEqual(e.elements,t.elements)?j(e,t.model):!1}e.areConformationsEqual=k;function A(e,t,n,r){if(!t)return;if(e.model.atomicConformation.id===n.atomicConformation.id)return t;let i=YI.Provider.get(e.model);if(i){let e=YI.Provider.get(n);return!e||i===e?t:void 0}return t.props?.canRemap||!r||j(e,n)?t:void 0}function j(e,t){let n=DB.CoordinatesHistory.get(DB.getRoot(t));if(n)return n.areEqual(e.elements,e.kind,t);let r=e.elements,{x:i,y:a,z:o}=e.conformation.coordinates,{x:s,y:c,z:l}=M(e.kind,t);for(let e=0,t=r.length;e<t;e++){let t=r[e];if(i[t]!==s[t]||a[t]!==c[t]||o[t]!==l[t])return!1}return!0}e.isSameConformation=j;function M(e,n){return e===t.Atomic?n.atomicConformation:e===t.Spheres?n.coarseConformation.spheres:n.coarseConformation.gaussians}e.getModelConformationOfKind=M;function N(e){return M(e.kind,e.model)}e.getConformation=N;function ee(e,n){return e===t.Atomic?n.atomicHierarchy:e===t.Spheres?n.coarseHierarchy.spheres:n.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=ee;function te(e){return ee(e.kind,e.model)}e.getHierarchy=te})(Q||={});var FR;(function(e){function t(e,t,n,r){e.indices[e.count]=n,e.units[e.count]=t,e.squaredDistances[e.count]=r,e.count++}e.add=t;function n(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=n;function r(e,t){for(let n=0;n<t.count;++n)e.indices[n]=t.indices[n],e.units[n]=t.units[n],e.squaredDistances[n]=t.squaredDistances[n];return e.count=t.count,e}e.copy=r})(FR||={});function IR(){return{result:FR.create(),closeUnitsResult:cA.create(),unitGroupResult:cA.create()}}var Rke=class{findUnitIndices(e,t,n,r){return this.unitLookup.find(e,t,n,r)}find(e,t,n,r,i){return this._find(e,t,n,r,i??this.findContext)}_find(e,t,n,r,i){cA.reset(i.result);let{units:a}=this.structure,o=this.unitLookup.find(e,t,n,r,i.closeUnitsResult);if(o.count===0)return i.result;for(let s=0,c=o.count;s<c;s++){let c=a[o.indices[s]];B.set(this.pivot,e,t,n),c.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let l=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r,i.unitGroupResult);for(let e=0,t=l.count;e<t;e++)FR.add(i.result,c,l.indices[e],l.squaredDistances[e])}return i.result}nearest(e,t,n,r=1,i){return this._nearest(e,t,n,r,i??this.findContext)}_nearest(e,t,n,r,i){let a=i.result,o=this.heap;cA.reset(a),o.clear();let{units:s}=this.structure,c=0,l=this.unitLookup.nearest(e,t,n,s.length,e=>(c+=s[e].elements.length)>=r,i.closeUnitsResult);if(l.count===0)return a;let u=0,d=-Number.MAX_VALUE;for(let a=0,c=l.count;a<c;a++){let c=l.squaredDistances[a];if(u>=r&&d<c)break;B.set(this.pivot,e,t,n);let f=s[l.indices[a]];f.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);let p=f.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],r,void 0,i.unitGroupResult);if(p.count!==0){u+=p.count,d=Math.max(d,p.squaredDistances[p.count-1]);for(let e=0,t=p.count;e<t;e++)o.insert(p.squaredDistances[e],{index:p.indices[e],unit:f})}}if(r===1){let e=o.findMinimum();if(e){let{key:t}=e,{unit:n,index:r}=e.value;FR.add(a,n,r,t)}}else for(;!o.isEmpty()&&a.count<r;){let e=o.extractMinimum(),{key:t}=e,{unit:n,index:r}=e.value;FR.add(a,n,r,t)}return a}findIntoBuilder(e,t,n,r,i){let{units:a}=this.structure,o=this.unitLookup.find(e,t,n,r);if(o.count!==0)for(let s=0,c=o.count;s<c;s++){let c=a[o.indices[s]];B.set(this.pivot,e,t,n),c.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse);let l=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r);if(l.count===0)continue;let u=c.elements;i.beginUnit(c.id);for(let e=0,t=l.count;e<t;e++)i.addElement(u[l.indices[e]]);i.commitUnit()}}findIntoBuilderIf(e,t,n,r,i,a){let{units:o}=this.structure,s=this.unitLookup.find(e,t,n,r);if(s.count===0)return;let c=iL.create(this.structure);for(let l=0,u=s.count;l<u;l++){let u=o[s.indices[l]];B.set(this.pivot,e,t,n),u.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse);let d=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r);if(d.count===0)continue;let f=u.elements;c.unit=u,i.beginUnit(u.id);for(let e=0,t=d.count;e<t;e++)c.element=f[d.indices[e]],a(c)&&i.addElement(c.element);i.commitUnit()}}findIntoBuilderWithRadius(e,t,n,r,i,a,o,s){let{units:c}=this.structure,l=this.unitLookup.find(e,t,n,a);if(l.count===0)return;let u=iL.create(this.structure),d=r+i+a;for(let i=0,f=l.count;i<f;i++){let f=c[l.indices[i]];B.set(this.pivot,e,t,n),f.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);let p=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],d);if(p.count===0)continue;let m=f.elements;u.unit=f,s.beginUnit(f.id);for(let e=0,t=p.count;e<t;e++){u.element=m[p.indices[e]];let t=o(u);Math.sqrt(p.squaredDistances[e])-r-t>a||s.addElement(m[p.indices[e]])}s.commitUnit()}}check(e,t,n,r){let{units:i}=this.structure,a=this.unitLookup.find(e,t,n,r);if(a.count===0)return!1;for(let o=0,s=a.count;o<s;o++){let s=i[a.indices[o]];if(B.set(this.pivot,e,t,n),s.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,s.conformation.operator.inverse),s.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],r))return!0}return!1}approxNearest(e,t,n,r,i){return this._approxNearest(e,t,n,r,i??this.findContext)}_approxNearest(e,t,n,r,i){cA.reset(i.result);let{units:a}=this.structure,o=this.unitLookup.find(e,t,n,r,i.closeUnitsResult);if(o.count===0)return i.result;let s=Number.MAX_VALUE;for(let c=0,l=o.count;c<l;c++){let l=a[o.indices[c]];B.set(this.pivot,e,t,n),l.conformation.operator.isIdentity||B.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse);let u=l.lookup3d.approxNearest(this.pivot[0],this.pivot[1],this.pivot[2],r,i.unitGroupResult);for(let e=0,t=u.count;e<t;e++)u.squaredDistances[e]<s&&(FR.add(i.result,l,u.indices[e],u.squaredDistances[e]),s=u.squaredDistances[e])}return i.result}get boundary(){return this.structure.boundary}constructor(e){this.structure=e,this.pivot=B(),this.heap=new hA,this.findContext=IR();let{units:t,boundary:n}=e,r=t.length,i=new Float32Array(r),a=new Float32Array(r),o=new Float32Array(r),s=new Float32Array(r),c=B();for(let e=0;e<r;e++){let n=t[e],r=n.boundary.sphere;B.transformMat4(c,r.center,n.conformation.operator.matrix),i[e]=c[0],a[e]=c[1],o[e]=c[2],s[e]=r.radius}this.unitLookup=yA({x:i,y:a,z:o,radius:s,indices:K.ofBounds(0,r)},n)}};function LR(e,t){if(t.length===0)return nB.Empty;if(t.length===1)return t[0];let n=new Map,r=new Set;for(let{units:i}of t)for(let t=0,a=i.length;t<a;t++){let a=i[t];if(n.has(a.id)){if(r.has(a.id))continue;let t=Vk.union(n.get(a.id),a.elements);n.set(a.id,t),t.length===e.unitMap.get(a.id).elements.length&&r.add(a.id)}else n.set(a.id,a.elements),a.elements.length===e.unitMap.get(a.id).elements.length&&r.add(a.id)}let i=e.subsetBuilder(!0);return n.forEach(zke,i),i.getStructure()}function zke(e,t){this.setUnit(t,e)}function Bke(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;let n=e.units,r=t.unitMap;for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!r.has(t.id))return!1;let i=r.get(t.id);if(!Vk.areEqual(t.elements,i.elements))return!1}return!0}function RR(e,t){if(e===t)return!0;let n,r;e.units.length<t.units.length?(n=e,r=t):(n=t,r=e);let i=n.units,a=r.unitMap;for(let e=0,t=i.length;e<t;e++){let t=i[e];if(!a.has(t.id))continue;let n=a.get(t.id);if(Vk.areIntersecting(t.elements,n.elements))return!0}return!1}function zR(e,t){if(e===t)return e;if(!RR(e,t))return nB.Empty;let n,r;e.units.length<t.units.length?(n=e,r=t):(n=t,r=e);let i=n.units,a=r.unitMap,o=[];for(let e=0,t=i.length;e<t;e++){let t=i[e];if(!a.has(t.id))continue;let n=a.get(t.id);if(Vk.areIntersecting(t.elements,n.elements)){let e=Vk.intersect(t.elements,n.elements);o[o.length]=t.getChild(e)}}return nB.create(o,{parent:e.parent||t.parent})}function BR(e,t){if(e===t)return nB.Empty;if(!RR(e,t))return e;let n=e.units,r=t.unitMap,i=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!r.has(t.id)){i[i.length]=t;continue}let a=r.get(t.id),o=Vk.subtract(t.elements,a.elements);o.length>0&&(i[i.length]=t.getChild(o))}return nB.create(i,{parent:e.parent||t.parent})}var VR;(function(e){function t(e,t){return{kind:`singletons`,source:e,structure:t}}e.Singletons=t;function n(e,t){return{kind:`sequence`,source:e,structures:t}}e.Sequence=n;function r(e){return t(e,nB.Empty)}e.Empty=r;function i(e){return e.kind===`singletons`}e.isSingleton=i;function a(e){return i(e)?e.structure.units.length===0:e.structures.length===0}e.isEmpty=a;function o(e){return i(e)?e.structure.elementCount:e.structures.length}e.structureCount=o;function s(e){return a(e)?nB.Empty:i(e)?e.structure:LR(e.source,e.structures)}e.unionStructure=s;function c(e){let t=[],{unitMap:n}=e.source;for(let r of s(e).units)r===n.get(r.id)?t[t.length]={unit:r,indices:K.ofBounds(0,r.elements.length)}:t[t.length]={unit:r,indices:K.ofSortedArray(Vk.indicesOf(n.get(r.id).elements,r.elements))};return $(e.source,t)}e.toLociWithCurrentUnits=c;function l(e){let t=[],{unitMap:n}=e.source;for(let r of s(e).units){let e=n.get(r.id);e===r?t[t.length]={unit:e,indices:K.ofBounds(0,e.elements.length)}:t[t.length]={unit:e,indices:K.ofSortedArray(Vk.indicesOf(e.elements,r.elements))}}return $(e.source,t)}e.toLociWithSourceUnits=l;function u(e,i,a){return i.length===0?r(e):a?t(e,LR(e,i)):n(e,i)}class d{add(e){let t=e.elementCount;t!==0&&(this.structures[this.structures.length]=e,t!==1&&(this.allSingletons=!1))}getSelection(){return u(this.source,this.structures,this.allSingletons)}constructor(e){this.source=e,this.structures=[],this.allSingletons=!0}}class f{add(e){let t=e.elementCount;t===0||!this.uniqueSets.add(e)||(this.structures[this.structures.length]=e,t!==1&&(this.allSingletons=!1))}getSelection(){return u(this.structure,this.structures,this.allSingletons)}constructor(e){this.structure=e,this.structures=[],this.allSingletons=!0,this.uniqueSets=aL(nB.hashCode,nB.areUnitIdsAndIndicesEqual)}}function p(e){return new d(e)}e.LinearBuilder=p;function m(e){return new f(e)}e.UniqueBuilder=m;function h(t,n){let r=0;if(e.isSingleton(t))for(let e of t.structure.units){let{elements:i}=e;for(let a=0,o=i.length;a<o;a++)n(nB.create([e.getChild(Vk.ofSingleton(i[a]))],{parent:t.source}),r++)}else for(let e of t.structures)n(e,r++)}e.forEach=h;function g(e,r){return i(e)?t(r,e.structure):n(r,e.structures)}e.withInputStructure=g})(VR||={});function Vke(e){return!!e.items}function Hke(e){let{and:t}=Z.core.logic,{eq:n,gre:r,lte:i}=Z.core.rel,{macromolecular:a,ihm:o,core:s}=Z.struct.atomProperty,c={};UR(e.label_entity_id)&&(c[`entity-test`]=n([a.label_entity_id(),e.label_entity_id]));let l=[];UR(e.operator_name)&&l.push(n([s.operatorName(),e.operator_name])),UR(e.instance_id)&&l.push(n([s.instanceId(),e.instance_id])),UR(e.label_asym_id)&&l.push(n([a.label_asym_id(),e.label_asym_id])),UR(e.auth_asym_id)&&l.push(n([a.auth_asym_id(),e.auth_asym_id])),l.length===1?c[`chain-test`]=l[0]:l.length>1&&(c[`chain-test`]=t(l));let u=[];UR(e.label_seq_id)&&u.push(o.hasSeqId({0:e.label_seq_id})),UR(e.auth_seq_id)&&u.push(n([a.auth_seq_id(),e.auth_seq_id])),UR(e.residue_index)&&u.push(n([a.residueSourceIndex(),e.residue_index])),UR(e.pdbx_PDB_ins_code)&&u.push(n([a.pdbx_PDB_ins_code(),e.pdbx_PDB_ins_code])),(UR(e.beg_label_seq_id)||UR(e.end_label_seq_id))&&u.push(o.overlapsSeqIdRange({beg:e.beg_label_seq_id,end:e.end_label_seq_id})),UR(e.beg_auth_seq_id)&&u.push(r([a.auth_seq_id(),e.beg_auth_seq_id])),UR(e.end_auth_seq_id)&&u.push(i([a.auth_seq_id(),e.end_auth_seq_id])),u.length===1?c[`residue-test`]=u[0]:u.length>1&&(c[`residue-test`]=t(u));let d=[];return UR(e.label_comp_id)&&d.push(n([a.label_comp_id(),e.label_comp_id])),UR(e.auth_comp_id)&&d.push(n([a.auth_comp_id(),e.auth_comp_id])),UR(e.atom_id)&&d.push(n([a.id(),e.atom_id])),UR(e.atom_index)&&d.push(n([Z.struct.atomProperty.core.sourceIndex(),e.atom_index])),UR(e.label_atom_id)&&d.push(n([a.label_atom_id(),e.label_atom_id])),UR(e.auth_atom_id)&&d.push(n([a.auth_atom_id(),e.auth_atom_id])),UR(e.type_symbol)&&d.push(n([Z.struct.atomProperty.core.elementSymbol(),e.type_symbol.toUpperCase()])),d.length===1?c[`atom-test`]=d[0]:d.length>1&&(c[`atom-test`]=t(d)),Z.struct.generator.atomGroups(c)}function HR(e){let t=[];return WR(e,e=>t.push(Hke(e))),t.length===1?t[0]:Uke(t)}function Uke(e){return Z.struct.combinator.merge(e.map(e=>Z.struct.modifier.union([e])))}function UR(e){return e!=null}function WR(e,t){if(Vke(e))if(Array.isArray(e.items))if(e.prefix)for(let n of e.items)t(Object.assign({},e.prefix,n));else for(let n of e.items)t(n);else{let n={...e.prefix},r=Object.keys(e.items),i=e.items[r[0]].length;for(let a=0;a<i;a++){for(let t of r)n[t]=e.items[t][a];t(n)}}else t(e)}function GR(e,t,n){let r=HR(t);return $.fromExpression(e,r,n)}function Wke(e,t,n){let r=GR(e,t,n);return qR.fromLoci(r)}const KR={forEachItem:WR,toExpression:HR,toLoci:GR,toBundle:Wke};var qR;(function(e){e.Empty={hash:-1,elements:[]};function t(e,t){return o(VR.toLociWithSourceUnits(VR.Singletons(e,t)))}e.fromSubStructure=t;function n(e){return o(VR.toLociWithSourceUnits(e))}e.fromSelection=n;function r(e,t,n){return o($.fromExpression(e,t,n))}e.fromExpression=r;function i(e,t,n){return o($.fromQuery(e,t,n))}e.fromQuery=i;function a(e,t,n){return KR.toBundle(e,t,n)}e.fromSchema=a;function o(e){let t=[];for(let n of e.elements){let{unit:e,indices:r}=n;if(K.size(r)===0)continue;let i=[],a=[];if(K.isInterval(r))K.size(r)===1?a.push(G.min(r)):i.push(G.min(r),G.max(r));else{let e=0,t=r.length;for(;e<t;){let n=e;for(e++;e<t&&r[e-1]+1===r[e];)e++;let o=e;if(o-n>2)i.push(r[n],r[o-1]);else for(let e=n;e<o;e++)a[a.length]=r[e]}}t.push({unit:e,set:Vk.ofSortedArray(a),ranges:OR.ofSortedRanges(i)})}let n=new Map;for(let e=0,r=t.length;e<r;++e){let r=t[e],i=dE(gE(r.ranges),gE(r.set));if(n.has(i)){let{groupedUnits:e}=n.get(i);e.has(r.unit.invariantId)?e.get(r.unit.invariantId).push(r.unit.id):e.set(r.unit.invariantId,[r.unit.id])}else{let e=new Map;e.set(r.unit.invariantId,[r.unit.id]),n.set(i,{groupedUnits:e,set:r.set,ranges:r.ranges})}}let r=[];return n.forEach(e=>{let t=[];e.groupedUnits.forEach(e=>t.push(Vk.ofUnsortedArray(e))),t.sort((e,t)=>e[0]-t[0]),r.push({groupedUnits:t,set:e.set,ranges:e.ranges})}),{hash:e.structure.hashCode,elements:r}}e.fromLoci=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let i=e[r];t.unitMap.has(i)&&n.push(t.unitMap.get(i))}return n}function c(e,t){e.hash!==-1&&(e.hash,t.hashCode);let n=[];for(let r of e.elements)for(let e of r.groupedUnits){let i=s(e,t);if(i.length===0)continue;let a;if(r.ranges.length===0)a=r.set;else if(r.set.length===0)if(r.ranges.length===2)a=G.ofRange(r.ranges[0],r.ranges[1]);else{let e=new Int32Array(OR.size(r.ranges));OR.forEach(r.ranges,(t,n)=>e[n]=t),a=Vk.ofSortedArray(e)}else{let e=OR.size(r.ranges),t=new Int32Array(r.set.length+e);OR.forEach(r.ranges,(e,n)=>t[n]=e),t.set(r.set,e),a=Vk.ofUnsortedArray(t)}for(let e of i)n.push({unit:e,indices:a})}return $(t,n)}e.toLoci=c;function l(e,t){e.hash!==-1&&(e.hash,t.hashCode);let n=[];for(let r of e.elements)for(let e of r.groupedUnits){let i=s(e,t);if(i.length===0)continue;let a=i[0].elements,o=OR.size(r.ranges),c=r.set.length,l=new Int32Array(c+o),u;if(o===0){for(let e=0,t=c;e<t;++e)l[e]=a[r.set[e]];u=Vk.ofSortedArray(l)}else if(c===0)OR.forEach(r.ranges,(e,t)=>l[t]=a[e]),u=Vk.ofSortedArray(l);else if(Vk.min(r.set)>OR.max(r.ranges)){OR.forEach(r.ranges,(e,t)=>l[t]=a[e]);for(let e=0,t=c;e<t;++e)l[e+o]=a[r.set[e]];u=Vk.ofSortedArray(l)}else if(OR.min(r.ranges)>Vk.max(r.set)){for(let e=0,t=c;e<t;++e)l[e]=a[r.set[e]];OR.forEach(r.ranges,(e,t)=>l[t+c]=a[e]),u=Vk.ofSortedArray(l)}else{OR.forEach(r.ranges,(e,t)=>l[t]=a[e]);for(let e=0,t=c;e<t;++e)l[e+o]=a[r.set[e]];u=Vk.ofUnsortedArray(l)}for(let e of i)n.push(e.getChild(u))}return nB.create(n,{parent:t})}e.toStructure=l;function u(e){return Z.internal.generator.bundleElement({groupedUnits:Z.core.type.list(e.groupedUnits.map(e=>Z.core.type.list(e))),ranges:Z.core.type.list(e.ranges),set:Z.core.type.list(e.set)})}function d(e){return Z.internal.generator.bundle({elements:Z.core.type.list(e.elements.map(u))})}e.toExpression=d;function f(e,t){if(e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n){let r=e.elements[n],i=t.elements[n];if(r.groupedUnits.length!==i.groupedUnits.length)return!1;for(let e=0,t=i.groupedUnits.length;e<t;++e)if(!Vk.areEqual(r.groupedUnits[e],i.groupedUnits[e]))return!1;if(!Vk.areEqual(r.set,i.set)||!OR.areEqual(r.ranges,i.ranges))return!1}return!0}e.areEqual=f})(qR||={});var Gke=s({atomicHet:()=>Jke,atomicSequence:()=>Kke,bundleElementImpl:()=>YR,bundleGenerator:()=>XR,defaultBondTest:()=>JR,spheres:()=>Yke,water:()=>qke});function JR(e){return kI.isCovalent(e.atomicBond.type)}function Kke(){return function(e){let{inputStructure:t}=e,n=iL.create(t),r=[];for(let e of t.units){if(e.kind!==Q.Kind.Atomic)continue;n.unit=e;let t=e.elements;if(n.element=t[0],Pz.entity.type(n)!==`polymer`)continue;let i=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t),a=0;for(;i.hasNext;)a++,i.move();a<8||r.push(e)}return VR.Singletons(t,nB.create(r,{parent:t}))}}function qke(){return function(e){let{inputStructure:t}=e,n=iL.create(t),r=[];for(let e of t.units)e.kind===Q.Kind.Atomic&&(n.unit=e,n.element=e.elements[0],Pz.entity.type(n)===`water`&&r.push(e));return VR.Singletons(t,nB.create(r,{parent:t}))}}function Jke(){return function(e){let{inputStructure:t}=e,n=iL.create(t),r=[];for(let e of t.units){if(e.kind!==Q.Kind.Atomic)continue;n.unit=e;let t=e.elements;if(n.element=t[0],Pz.entity.type(n)!==`water`){if(Pz.entity.type(n)===`polymer`){let n=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t),r=0;for(;n.hasNext;)r++,n.move();if(r>=8)continue}r.push(e)}}return VR.Singletons(t,nB.create(r,{parent:t}))}}function Yke(){return function(e){let{inputStructure:t}=e,n=[];for(let e of t.units)e.kind===Q.Kind.Spheres&&n.push(e);return VR.Singletons(t,nB.create(n,{parent:t}))}}function YR(e,t,n){return{groupedUnits:e,ranges:t,set:n}}function XR(e){return function(t){let n={hash:t.inputStructure.hashCode,elements:e};return VR.Sequence(t.inputStructure,[qR.toStructure(n,t.inputStructure)])}}var ZR=class{pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=iL.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new QR,this.atomicBond}popCurrentBond(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0}pushInputStructure(e){this.inputStructureStack.push(this.inputStructure),this.inputStructure=e}popInputStructure(){if(this.inputStructureStack.length===0)throw Error(`Must push before pop.`);this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(this.timeoutMs!==0&&Ly()-this.timeCreated>this.timeoutMs)throw Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw Error(`The current selection is not assigned.`);return this.currentSelection}constructor(e,t){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Ly(),this.element=iL.create(void 0),this.currentStructure=void 0,this.atomicBond=new QR,this.currentSelection=void 0,this.inputStructure=e,this.timeoutMs=t&&t.timeoutMs||0,this.currentSelection=t&&t.currentSelection}},QR=class{constructor(){this.a=iL.create(void 0),this.aIndex=0,this.b=iL.create(void 0),this.bIndex=0,this.type=kI.Flag.None,this.order=0,this.key=-1,this.testFn=JR}setStructure(e){this.a.structure=e,this.b.structure=e}setTestFn(e){this.testFn=e||JR}test(e,t){return this.testFn(e)?!0:t?(this.swap(),this.testFn(e)):!1}swap(){let e=this.aIndex;this.aIndex=this.bIndex,this.bIndex=e;let t=this.a.unit;this.a.unit=this.b.unit,this.b.unit=t;let n=this.a.element;this.a.element=this.b.element,this.b.element=n}get length(){return iL.distance(this.a,this.b)}},$R;(function(e){function t(e,t,n){return e(new ZR(t,n))}e.run=t;function n(e,t,n){let r=e(new ZR(t,n));return VR.toLociWithSourceUnits(r)}e.loci=n})($R||={});var ez=class{add(e){e.elementCount&&(e.elementCount!==1&&(this.allSingletons=!1),this.set.add(e)&&(this.structures[this.structures.length]=e))}getSelection(){return this.allSingletons?VR.Singletons(this.source,LR(this.source,this.structures)):VR.Sequence(this.source,this.structures)}constructor(e){this.source=e,this.set=aL(nB.hashCode,nB.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}},Xke=class{add(e,t,n){let r=this.builderMap.get(e);r||(r=this.source.subsetBuilder(!0),this.builders[this.builders.length]=r,this.builderMap.set(e,r)),r.addToUnit(t,n)}allSingletons(){for(let e=0,t=this.builders.length;e<t;e++)if(this.builders[e].elementCount>1)return!1;return!0}singletonSelection(){let e=this.source.subsetBuilder(!0),t=iL.create(this.source);for(let n=0,r=this.builders.length;n<r;n++)this.builders[n].setSingletonLocation(t),e.addToUnit(t.unit.id,t.element);return VR.Singletons(this.source,e.getStructure())}fullSelection(){let e=Array(this.builders.length);for(let t=0,n=this.builders.length;t<n;t++)e[t]=this.builders[t].getStructure();return VR.Sequence(this.source,e)}getSelection(){return this.builders.length===0?VR.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}constructor(e){this.source=e,this.builders=[],this.builderMap=new Map}},Zke=s({all:()=>nz,atoms:()=>iz,bondedAtomicPairs:()=>oAe,chains:()=>$ke,none:()=>tz,querySelection:()=>aAe,residues:()=>Qke,rings:()=>iAe});const tz=e=>VR.Sequence(e.inputStructure,[]),nz=e=>VR.Singletons(e.inputStructure,e.inputStructure);function Qke(e){return iz({...e,groupBy:e=>Pz.residue.key(e.element)})}function $ke(e){return iz({...e,groupBy:e=>Pz.chain.key(e.element)})}function rz(e){return!0}function eAe(e){return 0}function iz(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return nz;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return tAe(e.atomTest);let t={unitTest:e.unitTest||rz,entityTest:e.entityTest||rz,chainTest:e.chainTest||rz,residueTest:e.residueTest||rz,atomTest:e.atomTest||rz,groupBy:e.groupBy||eAe};return e.groupBy?rAe(t):nAe(t)}function tAe(e){return function(t){let{inputStructure:n}=t,{units:r}=n,i=t.pushCurrentElement(),a=n.subsetBuilder(!0);i.structure=n;for(let n of r){i.unit=n;let r=n.elements;a.beginUnit(n.id);for(let n=0,o=r.length;n<o;n++)i.element=r[n],e(t)&&a.addElement(i.element);a.commitUnit(),t.throwIfTimedOut()}return t.popCurrentElement(),VR.Singletons(n,a.getStructure())}}function nAe({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i}){return function(a){let{inputStructure:o}=a,{units:s}=o,c=a.pushCurrentElement(),l=o.subsetBuilder(!0),u=r===rz&&i===rz,d=i===rz;c.structure=o;for(let o of s){if(c.unit=o,!e(a))continue;let{elements:s,model:f}=o;if(l.beginUnit(o.id),o.kind===Q.Kind.Atomic){let e=uA.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s),f=uA.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);for(;e.hasNext;){let o=e.move();if(c.element=s[o.start],!(!t(a)||!n(a))){if(u){l.addElementRange(s,o.start,o.end);continue}for(f.setSegment(o);f.hasNext;){let e=f.move();if(c.element=s[e.start],r(a)){if(d){l.addElementRange(s,e.start,e.end);continue}for(let t=e.start,n=e.end;t<n;t++)c.element=s[t],i(a)&&l.addElement(c.element)}}}}}else{let{chainElementSegments:e}=o.kind===Q.Kind.Spheres?f.coarseHierarchy.spheres:f.coarseHierarchy.gaussians,i=uA.transientSegments(e,s);for(;i.hasNext;){let e=i.move();if(c.element=s[e.start],!(!t(a)||!n(a))){if(u){l.addElementRange(s,e.start,e.end);continue}for(let t=e.start,n=e.end;t<n;t++)c.element=s[t],r(a)&&l.addElement(c.element)}}}l.commitUnit(),a.throwIfTimedOut()}return a.popCurrentElement(),VR.Singletons(o,l.getStructure())}}function rAe({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i,groupBy:a}){return function(o){let{inputStructure:s}=o,{units:c}=s,l=o.pushCurrentElement(),u=new Xke(s);l.structure=s;for(let s of c){if(l.unit=s,!e(o))continue;let{elements:c,model:d}=s;if(s.kind===Q.Kind.Atomic){let e=uA.transientSegments(d.atomicHierarchy.chainAtomSegments,c),f=uA.transientSegments(d.atomicHierarchy.residueAtomSegments,c);for(;e.hasNext;){let d=e.move();if(l.element=c[d.start],!(!t(o)||!n(o)))for(f.setSegment(d);f.hasNext;){let e=f.move();if(l.element=c[e.start],r(o))for(let t=e.start,n=e.end;t<n;t++)l.element=c[t],i(o)&&u.add(a(o),s.id,l.element)}}}else{let{chainElementSegments:e}=s.kind===Q.Kind.Spheres?d.coarseHierarchy.spheres:d.coarseHierarchy.gaussians,i=uA.transientSegments(e,c);for(;i.hasNext;){let e=i.move();if(l.element=c[e.start],!(!t(o)||!n(o)))for(let t=e.start,n=e.end;t<n;t++)l.element=c[t],r(o)&&u.add(a(o),s.id,l.element)}}o.throwIfTimedOut()}return o.popCurrentElement(),u.getSelection()}}function az(e,t,n){let r=new Int32Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=e.elements[t[n]];return nB.create([e.getChild(Vk.ofSortedArray(r))],{parent:n})}function iAe(e,t){return function(n){let{units:r}=n.inputStructure,i=VR.LinearBuilder(n.inputStructure);if(!e||e.length===0){for(let e of r)if(Q.isAtomic(e))if(t)for(let t of e.rings.aromaticRings)i.add(az(e,e.rings.all[t],n.inputStructure));else for(let t of e.rings.all)i.add(az(e,t,n.inputStructure))}else{let a=CD.create();for(let t=0;t<e.length;t++)CD.add(a,e[t],e[t]);for(let e of r){if(!Q.isAtomic(e))continue;let r=e.rings;for(let o of a.array)if(r.byFingerprint.has(o))for(let a of r.byFingerprint.get(o))t&&!r.aromaticRings.includes(a)||i.add(az(e,r.all[a],n.inputStructure))}}return i.getSelection()}}function aAe(e,t,n=!1){return function(r){let i=e(r);if(VR.structureCount(i)===0)return i;let a=n?BR(r.inputStructure,VR.unionStructure(i)):VR.unionStructure(i);if(a.elementCount===0)return VR.Empty(r.inputStructure);r.throwIfTimedOut(),r.pushInputStructure(a);let o=t(r);return r.popInputStructure(),VR.withInputStructure(o,r.inputStructure)}}function oAe(e){return function(t){let n=t.inputStructure,r=n.interUnitBonds,i=VR.UniqueBuilder(t.inputStructure);t.pushCurrentBond();let a=t.atomicBond;a.setTestFn(e),a.setStructure(n);for(let e of n.units){if(e.kind!==Q.Kind.Atomic)continue;let{offset:r,b:o,edgeProps:{flags:s,order:c,key:l}}=e.bonds;a.a.unit=e,a.b.unit=e;for(let u=0,d=e.elements.length;u<d;u++){a.aIndex=u,a.a.element=e.elements[u];for(let d=r[u],f=r[u+1];d<f;d++)if(a.bIndex=o[d],a.b.element=e.elements[o[d]],a.type=s[d],a.order=c[d],a.key=l[d],a.test(t,!1)){let t=n.subsetBuilder(!1);t.beginUnit(e.id),t.addElement(a.a.element),t.addElement(a.b.element),t.commitUnit(),i.add(t.getStructure())}}}for(let e of r.edges)if(a.a.unit=n.unitMap.get(e.unitA),a.a.element=a.a.unit.elements[e.indexA],a.aIndex=e.indexA,a.b.unit=n.unitMap.get(e.unitB),a.b.element=a.b.unit.elements[e.indexB],a.bIndex=e.indexB,a.order=e.props.order,a.type=e.props.flag,a.key=e.props.key,a.test(t,!1)){let e=n.subsetBuilder(!1);e.addToUnit(a.a.unit.id,a.a.element),e.addToUnit(a.b.unit.id,a.b.element),i.add(e.getStructure())}return t.popCurrentBond(),i.getSelection()}}var oz=class{addToUnit(e,t){let n=this.unitMap.get(e);if(n)CD.add(n,t,t)&&this.elementCount++;else{let n=CD.create();CD.add(n,t,t),this.unitMap.set(e,n),this.ids[this.ids.length]=e,this.elementCount++}}has(e,t){let n=this.unitMap.get(e);return n?CD.has(n,t):!1}beginUnit(e){this.parentId=e,this.unitMap.has(e)?this.currentUnit=this.unitMap.get(e):this.currentUnit=this.currentUnit.array.length>0?CD.create():this.currentUnit}addElement(e){CD.add(this.currentUnit,e,e)&&this.elementCount++}commitUnit(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return nB.Empty;let e=[];ZD(this.ids);let t=Gz.UnitEquivalenceBuilder();for(let n=0,r=this.ids.length;n<r;n++){let r=this.ids[n],i=this.parent.unitMap.get(r),a=this.unitMap.get(r).array,o=a.length;if(a.length===i.elements.length){e[e.length]=i,t.add(i.id,i);continue}o>1&&ZD(a);let s=i.getChild(Vk.ofSortedArray(a)),c=t.add(s.id,s);s!==c&&(s=c.applyOperator(s.id,s.conformation.operator,!0)),e[e.length]=s}return nB.create(e,{parent:this.parent})}get isEmpty(){return this.elementCount===0}constructor(e){this.parent=e,this.ids=[],this.unitMap=dA.Mutable(),this.parentId=-1,this.currentUnit=CD.create(),this.elementCount=0}};function sz(e,t,n,r){return{type:e,key:t,elements:n,getIndex:r}}var cz;(function(e){e.is=_x.has,e.create=_x.create,(function(e){e[e._=0]=`_`,e[e.H=1]=`H`,e[e.B=2]=`B`,e[e.E=4]=`E`,e[e.G=8]=`G`,e[e.I=16]=`I`,e[e.S=32]=`S`,e[e.T=64]=`T`,e[e.T3=128]=`T3`,e[e.T4=256]=`T4`,e[e.T5=512]=`T5`,e[e.T3S=1024]=`T3S`,e[e.T4S=2048]=`T4S`,e[e.T5S=4096]=`T5S`})(e.Flag||={})})(cz||={});var lz;(function(e){e[e.PARALLEL=0]=`PARALLEL`,e[e.ANTI_PARALLEL=1]=`ANTI_PARALLEL`})(lz||={});var uz=class{constructor(e,t,n){this.partner1=Math.min(e,t),this.partner2=Math.max(e,t),this.type=n}};function sAe(e){let{unit:t,flags:n,proteinInfo:r}=e,i=t.conformation,{traceElementIndex:a}=t.model.atomicHierarchy.derived.residue,{residueIndices:o,nIndices:s}=r,c=o.length,l=(e,t)=>e===-1?B.setNaN(t):i.position(e,t),u=B(),d=B(),f=B(),p=B(),m=B(),h=B(),g=B();f1:for(let e=2;e<c-2;e++){for(let t=0;t<4;t++){let n=e+t-2;if(l(a[n],p),l(s[n+1],m),B.squaredDistance(p,m)>6.25)continue f1}let t=o[e-2],r=o[e],i=o[e+2],c=a[t],_=a[r],v=a[i];l(c,u),l(_,d),l(v,f),B.sub(h,u,d),B.sub(g,d,f);let y=IT(B.angle(h,g));y&&y>70&&(n[e]|=cz.Flag.S)}}var cAe=9,dz=-27.888,lAe=-.5,fz=-9.9;function uAe(e,t,n,r){let i=B.distance(e,r),a=B.distance(t,r),o=B.distance(t,n),s=B.distance(e,n),c=dz/i-dz/a+(dz/o-dz/s);return c<fz?fz:c}function dAe(e,t,n){let{residueIndices:r,cIndices:i,hIndices:a,nIndices:o,oIndices:s}=t,{index:c}=e.model.atomicHierarchy,l=e.conformation,{traceElementIndex:u}=e.model.atomicHierarchy.derived.residue,d=r.length,f=[],p=[],m=[],h=B(),g=B(),_=B(),v=B(),y=B(),b=B(),x=B();for(let e=0,t=r.length;e<t;++e){let t=e,d=r[e],S=s[t],C=i[t],w=u[d];if(S===-1||C===-1||c.findAtomOnResidue(d,`OXT`)!==-1)continue;l.invariantPosition(S,h),l.invariantPosition(C,g),l.invariantPosition(w,_);let{indices:T,count:E}=n.find(_[0],_[1],_[2],cAe);for(let e=0;e<E;++e){let n=T[e];if(n===t||n-1===t||n+1===t)continue;let r=o[n];if(r===-1)continue;l.invariantPosition(r,v);let c=a[n];if(c===-1){if(n===0)continue;let e=n-1,t=s[e],r=i[e];if(t===-1||r===-1)continue;l.invariantPosition(t,x),l.invariantPosition(r,b),B.sub(y,b,x);let a=B.distance(x,b);B.scaleAndAdd(y,v,y,1/a)}else l.invariantPosition(c,y);let u=uAe(h,g,v,y);u>lAe||(f[f.length]=t,p[p.length]=n,m[m.length]=u)}}return fAe(d,f,p,m)}function fAe(e,t,n,r){let i=new KI.DirectedEdgeBuilder(e,t,n),a=new Float32Array(i.slotCount);for(let e=0,t=i.edgeCount;e<t;e++)i.addNextEdge(),i.assignProperty(a,r[e]);return i.createGraph({energies:r})}function pAe(e){let{proteinInfo:t,hbonds:n,flags:r}=e,i=[cz.Flag.T3S,cz.Flag.T4S,cz.Flag.T5S,cz.Flag.T3,cz.Flag.T4,cz.Flag.T5];for(let a=0;a<3;a++)for(let o=0,s=t.residueIndices.length-1;o<s;++o)if(n.getDirectedEdgeIndex(o,o+a+3)!==-1)if(r[o]|=i[a+3]|i[a],e.params.oldDefinition)for(let e=1;e<a+3;++e)r[o+e]|=i[a+3]|cz.Flag.T;else for(let e=0;e<=a+3;++e)r[o+e]|=i[a+3]|cz.Flag.T}function mAe(e){let{proteinInfo:t,flags:n}=e,r=t.residueIndices.length,i=[cz.Flag.T3S,cz.Flag.T4S,cz.Flag.T5S,cz.Flag.T3,cz.Flag.T4,cz.Flag.T5],a=[0,0,0,cz.Flag.G,cz.Flag.H,cz.Flag.I],o=e.params.oldOrdering?[4,3,5]:[3,4,5];for(let t=0;t<o.length;t++){let s=o[t];for(let t=1,o=r-s;t<o;t++){let r=cz.create(n[t]),o=cz.create(n[t-1]),c=cz.create(n[t+1]);if(e.params.oldOrdering){if(s===3&&(cz.is(r,cz.Flag.H)||cz.is(c,cz.Flag.H))||s===5&&(cz.is(r,cz.Flag.H)||cz.is(r,cz.Flag.G)||cz.is(c,cz.Flag.H)||cz.is(c,cz.Flag.G)))continue}else if(s===4&&(cz.is(r,cz.Flag.G)||cz.is(c,cz.Flag.G))||s===5&&(cz.is(r,cz.Flag.H)||cz.is(r,cz.Flag.G)||cz.is(c,cz.Flag.H)||cz.is(c,cz.Flag.G)))continue;if(cz.is(r,i[s])&&cz.is(r,i[s-3])&&cz.is(o,i[s])&&cz.is(o,i[s-3]))if(e.params.oldDefinition)for(let e=0;e<s;e++)n[t+e]|=a[s];else for(let e=-1;e<=s;e++)n[t+e]|=a[s]}}}function hAe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===lz.PARALLEL){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function gAe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===lz.PARALLEL?pz(e,t):pz(t,e):!1}function pz(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function _Ae(e){let{bridges:t,ladders:n}=e;for(let e=0;e<t.length;e++){let r=t[e],i=!1;for(let e=0;e<n.length;e++){let t=n[e];hAe(t,r)&&(i=!0,t.firstEnd++,r.type===lz.PARALLEL?t.secondEnd++:t.secondStart--)}i||(n[n.length]={previousLadder:0,nextLadder:0,firstStart:r.partner1,firstEnd:r.partner1,secondStart:r.partner2,secondEnd:r.partner2,type:r.type})}for(let e=0;e<n.length;e++){let t=n[e];for(let r=e;r<n.length;r++){let i=n[r];gAe(t,i)&&(t.nextLadder=r,i.previousLadder=e)}}}function vAe(e){let{proteinInfo:t,hbonds:n,flags:r,bridges:i}=e,{offset:a,b:o}=n,s,c;for(let e=0,l=t.residueIndices.length;e<l;++e)for(let t=a[e],l=a[e+1];t<l;t++){let a=o[t];e>a||(s=e+1,c=a,s!==c&&n.getDirectedEdgeIndex(c,s+1)!==-1&&(r[s]|=cz.Flag.B,r[c]|=cz.Flag.B,i[i.length]=new uz(s,c,lz.PARALLEL)),s=e,c=a-1,s!==c&&n.getDirectedEdgeIndex(c-1,s)!==-1&&(r[s]|=cz.Flag.B,r[c]|=cz.Flag.B,i[i.length]=new uz(c,s,lz.PARALLEL)),s=e,c=a,s!==c&&n.getDirectedEdgeIndex(c,s)!==-1&&(r[s]|=cz.Flag.B,r[c]|=cz.Flag.B,i[i.length]=new uz(c,s,lz.ANTI_PARALLEL)),s=e+1,c=a-1,s!==c&&n.getDirectedEdgeIndex(c-1,s+1)!==-1&&(r[s]|=cz.Flag.B,r[c]|=cz.Flag.B,i[i.length]=new uz(c,s,lz.ANTI_PARALLEL)))}i.sort((e,t)=>e.partner1>t.partner1?1:e.partner1<t.partner1?-1:0)}function mz(e){return cz.is(e,cz.Flag.G)||cz.is(e,cz.Flag.H)||cz.is(e,cz.Flag.I)}function yAe(e){let{ladders:t,flags:n}=e;for(let e=0;e<t.length;e++){let r=t[e];for(let e=r.firstStart;e<=r.firstEnd;e++){let t=r.firstStart-e,i=r.secondStart-t;r.firstStart===r.firstEnd?(!mz(n[e])&&cz.is(n[e],cz.Flag.E)&&(n[e]|=cz.Flag.B),!mz(n[i])&&cz.is(n[i],cz.Flag.E)&&(n[i]|=cz.Flag.B)):(n[e]|=cz.Flag.E,n[i]|=cz.Flag.E)}if(r.nextLadder===0)continue;let i=t[r.nextLadder];for(let e=r.firstStart;e<=i.firstEnd;e++)n[e]|=cz.Flag.E;if(r.type===lz.PARALLEL)for(let e=r.secondStart;e<=i.secondEnd;e++)n[e]|=cz.Flag.E;else for(let e=i.secondEnd;e<=r.secondStart;e++)n[e]|=cz.Flag.E}}function bAe(e,t){let{cIndices:n,nIndices:r,residueIndices:i}=t,a=e.conformation,{index:o}=e.model.atomicHierarchy,{traceElementIndex:s}=e.model.atomicHierarchy.derived.residue,c=i.length,l=(e,t)=>e===-1?B.setNaN(t):a.position(e,t),u=B(),d=B(),f=B(),p=B(),m=B(),h=B(),g=B(),_=B(),v=B();if(c===0)return{phi:new Float32Array,psi:new Float32Array};let y=new Float32Array(c-1),b=new Float32Array(c-1);l(-1,u),l(-1,d),l(-1,f),l(n[0],p),l(s[i[0]],m),l(r[0],h),l(n[1],g),l(s[i[1]],_),l(r[1],v);for(let e=0;e<c-1;++e)o.findAtomOnResidue(i[e],`OXT`)===-1&&(y[e]=IT(B.dihedralAngle(u,h,m,p)),b[e]=IT(B.dihedralAngle(h,m,p,v)),u=p,d=m,f=h,p=g,m=_,h=v,l(n[e+1],g),l(s[i[e+1]],_),l(r[e+1],v));return{phi:y,psi:b}}function xAe(e,t){let{x:n,y:r,z:i}=e.model.atomicConformation,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue,o=new Uint32Array(t.length);for(let e=0,n=t.length;e<n;++e)o[e]=a[t[e]];let s={x:n,y:r,z:i,indices:Vk.ofSortedArray(o)};return yA(s,PR(s))}function SAe(e){let{index:t}=e.model.atomicHierarchy,{proteinElements:n,residueIndex:r}=e,i=n.length,a=new Uint32Array(i),o=new Int32Array(i),s=new Int32Array(i),c=new Int32Array(i),l=new Int32Array(i);for(let e=0;e<i;++e){let i=r[n[e]];a[e]=i,o[e]=t.findAtomOnResidue(i,`C`),s[e]=t.findAtomOnResidue(i,`H`),c[e]=t.findAtomOnResidue(i,`O`),l[e]=t.findAtomOnResidue(i,`N`)}return{residueIndices:Vk.ofSortedArray(a),cIndices:o,hIndices:s,oIndices:c,nIndices:l}}const hz={oldDefinition:V.Boolean(!0,{description:`Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter`}),oldOrdering:V.Boolean(!0,{description:`Alpha-helices are preferred over 3-10 helices`})},CAe=V.getDefaultValues(hz);async function gz(e,t){let n=SAe(e),{residueIndices:r}=n,i=dAe(e,n,xAe(e,r)),a=r.length,o=new Uint32Array(a),s=bAe(e,n),c=[],l=[],u=t.oldDefinition?EAe:OAe,d={params:t,getResidueFlag:u,getFlagName:t.oldOrdering?DAe:kAe,unit:e,proteinInfo:n,flags:o,hbonds:i,torsionAngles:s,ladders:c,bridges:l};pAe(d),mAe(d),sAe(d),vAe(d),_Ae(d),yAe(d);let f=AAe(o,u),p=new Uint32Array(a),m=[],h=[],g=e=>Vk.indexOf(r,e);for(let e=0,t=r.length;e<t;++e){let t=f[e];p[e]=t;let n=u(o[e]);(h.length===0||n!==h[h.length-1].flags)&&(h[h.length]=wAe(TAe(t),o[e],u)),m[e]=h.length-1}return sz(p,m,h,g)}function wAe(e,t,n){return e===`helix`?{kind:`helix`,flags:n(t)}:e===`sheet`?{kind:`sheet`,flags:n(t)}:e===`turn`||e===`bend`?{kind:`turn`,flags:n(t)}:{kind:`none`}}function TAe(e){return e===OI.SecondaryStructureDssp.H||e===OI.SecondaryStructureDssp.G||e===OI.SecondaryStructureDssp.I?`helix`:e===OI.SecondaryStructureDssp.B||e===OI.SecondaryStructureDssp.E?`sheet`:e===OI.SecondaryStructureDssp.T?`turn`:e===OI.SecondaryStructureDssp.S?`bend`:`none`}function EAe(e){return cz.is(e,cz.Flag.H)?OI.SecondaryStructureDssp.H:cz.is(e,cz.Flag.E)?OI.SecondaryStructureDssp.E:cz.is(e,cz.Flag.B)?OI.SecondaryStructureDssp.B:cz.is(e,cz.Flag.G)?OI.SecondaryStructureDssp.G:cz.is(e,cz.Flag.I)?OI.SecondaryStructureDssp.I:cz.is(e,cz.Flag.T)?OI.SecondaryStructureDssp.T:cz.is(e,cz.Flag.S)?OI.SecondaryStructureDssp.S:OI.Flag.None}function DAe(e){return cz.is(e,cz.Flag.H)?`H`:cz.is(e,cz.Flag.E)?`E`:cz.is(e,cz.Flag.B)?`B`:cz.is(e,cz.Flag.G)?`G`:cz.is(e,cz.Flag.I)?`I`:cz.is(e,cz.Flag.T)?`T`:cz.is(e,cz.Flag.S)?`S`:`-`}function OAe(e){return cz.is(e,cz.Flag.I)?OI.SecondaryStructureDssp.I:cz.is(e,cz.Flag.H)?OI.SecondaryStructureDssp.H:cz.is(e,cz.Flag.E)?OI.SecondaryStructureDssp.E:cz.is(e,cz.Flag.B)?OI.SecondaryStructureDssp.B:cz.is(e,cz.Flag.G)?OI.SecondaryStructureDssp.G:cz.is(e,cz.Flag.T)?OI.SecondaryStructureDssp.T:cz.is(e,cz.Flag.S)?OI.SecondaryStructureDssp.S:OI.Flag.None}function kAe(e){return cz.is(e,cz.Flag.I)?`I`:cz.is(e,cz.Flag.H)?`H`:cz.is(e,cz.Flag.E)?`E`:cz.is(e,cz.Flag.B)?`B`:cz.is(e,cz.Flag.G)?`G`:cz.is(e,cz.Flag.T)?`T`:cz.is(e,cz.Flag.S)?`S`:`-`}function AAe(e,t){let n=new Uint32Array(e.length);for(let r=0,i=e.length;r<i;++r)n[r]=t(cz.create(e[r]));return n}var _z;(function(e){function t(e){let t=e.descriptor.name,n=e.type===`root`?`inheritedPropertyData`:`currentPropertyData`,r=r=>(t in r[n]||(r[n][t]={props:{...V.getDefaultValues(e.getParams(r))},data:bx.create(void 0)}),r[n][t]),i=(e,i,a)=>{let o=r(e);e[n][t]={props:i,data:bx.withValue(o.data,a)}};return{label:e.label,descriptor:e.descriptor,isHidden:e.isHidden,getParams:t=>{let n=V.clone(e.getParams(t));return V.setDefaultValues(n,r(t).props),n},defaultParams:e.defaultParams,isApplicable:e.isApplicable,attach:async(t,n,a={},o)=>{o&&n.customPropertyDescriptors.reference(e.descriptor,!0),e.type===`root`&&(n=n.root);let s=r(n.root).props,c=r(n),l=V.merge(e.defaultParams,s,a);if(c.data.value&&V.areEqual(e.defaultParams,c.props,l))return;let{value:u,assets:d}=await e.obtain(t,n,l);n.customPropertyDescriptors.add(e.descriptor),n.customPropertyDescriptors.assets(e.descriptor,d),i(n,l,u)},ref:(t,n)=>t.customPropertyDescriptors.reference(e.descriptor,n),get:e=>r(e).data,set:(t,n={},a)=>{e.type===`root`&&(t=t.root);let o=r(t),s=V.merge(e.defaultParams,o.props,n);V.areEqual(e.defaultParams,o.props,s)||(i(t,s,a),t.customPropertyDescriptors.assets(e.descriptor))},props:e=>r(e).props}}e.createProvider=t;function n(e,n,r){let i={value:V.Value(r,{isHidden:!0})};return t({label:JT(e),descriptor:PP({name:e}),isHidden:!0,type:n,defaultParams:i,getParams:()=>({value:V.Value(r,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(e,t,n)=>({...V.getDefaultValues(i),...n})})}e.createSimple=n})(_z||={});var vz;(function(e){e.Descriptor={name:`model_secondary_structure`},e.Provider=JI.create(e.Descriptor);function t(e,t,n){let r=new Map,i=[{kind:`none`}],a=jAe(e,t);MAe(e,a,r,i),NAe(t,a,r,e._rowCount,i);let o=n.residues._rowCount,s=e=>e,c={type:new Int32Array(o),key:new Int32Array(o),elements:i};return r.size>0&&FAe(n,a,r,c),sz(c.type,c.key,c.elements,s)}e.fromStruct=t})(vz||={});function jAe(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==U.ValueKinds.Present||e.end_label_seq_id.valueKind(0)!==U.ValueKinds.Present)return`auth`}else if(t&&(t.beg_label_seq_id.valueKind(0)!==U.ValueKinds.Present||t.end_label_seq_id.valueKind(0)!==U.ValueKinds.Present))return`auth`;return`label`}function MAe(e,t,n,r){if(!e._rowCount)return;let{beg_label_asym_id:i,beg_label_seq_id:a,beg_auth_seq_id:o,pdbx_beg_PDB_ins_code:s}=e,{end_label_seq_id:c,end_auth_seq_id:l,pdbx_end_PDB_ins_code:u}=e,{pdbx_PDB_helix_class:d,conf_type_id:f,details:p}=e,m=t===`label`?a:o,h=t===`label`?c:l;for(let t=0,a=e._rowCount;t<a;t++){let e=OI.create(d.valueKind(t)===U.ValueKinds.Present?OI.SecondaryStructurePdb[d.value(t)]:f.valueKind(t)===U.ValueKinds.Present?OI.SecondaryStructureMmcif[f.value(t)]:OI.Flag.NA),a={kind:`helix`,flags:e,type_id:f.valueKind(t)===U.ValueKinds.Present?f.value(t):`helx_p`,helix_class:d.value(t),details:p.valueKind(t)===U.ValueKinds.Present?p.value(t):void 0},o={startSeqId:m.value(t),startInsCode:s.value(t),endSeqId:h.value(t),endInsCode:u.value(t),type:e,key:r.length};r[r.length]=a;let c=i.value(t);if(n.has(c)){let e=n.get(c);e.has(o.startSeqId)?e.get(o.startSeqId).push(o):e.set(o.startSeqId,[o])}else n.set(c,new Map([[o.startSeqId,[o]]]))}}function NAe(e,t,n,r,i){if(!e._rowCount)return;let{beg_label_asym_id:a,beg_label_seq_id:o,beg_auth_seq_id:s,pdbx_beg_PDB_ins_code:c}=e,{end_label_seq_id:l,end_auth_seq_id:u,pdbx_end_PDB_ins_code:d}=e,{sheet_id:f}=e,p=t===`label`?o:s,m=t===`label`?l:u,h=new Map,g=r+1;for(let t=0,r=e._rowCount;t<r;t++){let e=f.value(t),r;h.has(e)?r=h.get(e):(r=g++,h.set(e,r));let o=OI.create(OI.Flag.Beta|OI.Flag.BetaSheet),s={kind:`sheet`,flags:o,sheet_id:e,symmetry:void 0},l={startSeqId:p.value(t),startInsCode:c.value(t),endSeqId:m.value(t),endInsCode:d.value(t),type:o,key:i.length};i[i.length]=s;let u=a.value(t);if(n.has(u)){let e=n.get(u);e.has(l.startSeqId)?e.get(l.startSeqId).push(l):e.set(l.startSeqId,[l])}else n.set(u,new Map([[l.startSeqId,[l]]]))}}function PAe(e,t,n,r,i,a){let{auth_seq_id:o,label_seq_id:s,pdbx_PDB_ins_code:c}=e.residues,{endSeqId:l,endInsCode:u,key:d,type:f}=n,p=t===`label`?s:o,m=r;for(;m<i;){let e=p.value(m);if(a.type[m]=f,a.key[m]=d,e>l||e===l&&c.value(m)===u)break;m++}}function FAe(e,t,n,r){let{count:i}=e.chainAtomSegments,{label_asym_id:a}=e.chains,{auth_seq_id:o,label_seq_id:s,pdbx_PDB_ins_code:c}=e.residues,l=t===`label`?s:o;for(let o=0;o<i;o++){let i=HI.chainStartResidueIndex(e,o),s=HI.chainEndResidueIndexExcl(e,o),u=a.value(o);if(n.has(u)){let a=n.get(u);for(let n=i;n<s;n++){let i=l.value(n);if(a.has(i)){let o=a.get(i);for(let i of o){let a=c.value(n);i.startInsCode===a&&PAe(e,t,i,n,s,r)}}}}}}var IAe=[5.45,5.18,6.37],LAe=2.1,RAe=[6.1,10.4,13],zAe=1.42,yz=B(),bz=B();function xz(e,t,n,r,i){let a=e.conformation,{traceElementIndex:o}=e.model.atomicHierarchy.derived.residue;for(let e=Math.max(0,n-2);e<=n;++e)for(let n=2;n<5;++n){if(e+n>=t.length)return!1;let s=t[e],c=t[e+n],l=o[s],u=o[c];if(l===-1||u===-1)return!1;a.invariantPosition(l,yz),a.invariantPosition(u,bz);let d=B.distance(yz,bz);if(Math.abs(d-r[n-2])>=i)return!1}return!0}async function Sz(e){let t=e.proteinElements.length,n=new Uint32Array(t),r=[],i=[],{proteinElements:a,residueIndex:o}=e,s=a.length,c=new Uint32Array(s);for(let e=0;e<s;++e)c[e]=o[a[e]];let l=Vk.ofSortedArray(c),u=e=>Vk.indexOf(l,e);for(let t=0,a=l.length;t<a;++t){let a=OI.Flag.None;xz(e,l,t,IAe,LAe)?a=OI.Flag.Helix:xz(e,l,t,RAe,zAe)&&(a=OI.Flag.Beta),n[t]=a,(i.length===0||a!==HAe(i[i.length-1]))&&(i[i.length]=BAe(VAe(a),a)),r[t]=i.length-1}return sz(n,r,i,u)}function BAe(e,t){return e===`helix`?{kind:`helix`,flags:t}:e===`sheet`?{kind:`sheet`,flags:t}:{kind:`none`}}function VAe(e){return e===OI.Flag.Helix?`helix`:e===OI.Flag.Beta?`sheet`:`none`}function HAe(e){return e.kind===`helix`||e.kind===`sheet`?e.flags:OI.Flag.None}function Cz(e){return{type:V.MappedStatic(`auto`,{auto:V.EmptyGroup({label:`Automatic`}),model:V.EmptyGroup({label:`Model`}),dssp:V.Group(hz,{label:`DSSP`,isFlat:!0}),"zhang-skolnick":V.EmptyGroup({label:`Zhang-Skolnick`})},{options:[[`auto`,`Automatic`],[`model`,`Model`],[`dssp`,`DSSP`],[`zhang-skolnick`,`Zhang-Skolnick`]]})}}const wz=Cz(),Tz=_z.createProvider({label:`Secondary Structure`,descriptor:PP({name:`molstar_computed_secondary_structure`}),type:`root`,defaultParams:wz,getParams:Cz,isApplicable:e=>!0,obtain:async(e,t,n)=>{let r={...V.getDefaultValues(wz),...n};switch(r.type.name){case`auto`:return{value:await UAe(t)};case`dssp`:return{value:await WAe(t,r.type.params)};case`model`:return{value:await KAe(t)};case`zhang-skolnick`:return{value:await GAe(t)}}}});async function UAe(e){let t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){let r=e.unitSymmetryGroups[n].units[0],i=r.model;if(DB.isFromPdbArchive(i)&&DB.isExperimental(i)&&!DB.isCoarseGrained(i)||DB.hasSecondaryStructure(i)){let e=vz.Provider.get(i);e&&t.set(r.invariantId,e)}else if(Q.isAtomic(r)&&!DB.isCoarseGrained(i)){let e=await gz(r,CAe);t.set(r.invariantId,e)}else if(Q.isAtomic(r)){let e=await Sz(r);t.set(r.invariantId,e)}}return t}async function WAe(e,t){let n=new Map;for(let r=0,i=e.unitSymmetryGroups.length;r<i;++r){let i=e.unitSymmetryGroups[r].units[0];if(Q.isAtomic(i)&&!DB.isCoarseGrained(i.model)){let e=await gz(i,t);n.set(i.invariantId,e)}}return n}async function GAe(e){let t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){let r=e.unitSymmetryGroups[n].units[0];if(Q.isAtomic(r)){let e=await Sz(r);t.set(r.invariantId,e)}}return t}async function KAe(e){let t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){let r=e.unitSymmetryGroups[n].units[0];if(Q.isAtomic(r)){let e=vz.Provider.get(r.model);e&&t.set(r.invariantId,e)}}return t}function Ez(e){return e}var qAe={true:Ez(e=>!0),false:Ez(e=>!1),zero:Ez(e=>0)};function Dz(){throw Error(`Property only available for atomic models.`)}function Oz(e){throw e?Error(`Property only available for coarse models (${e}).`):Error(`Property only available for coarse models.`)}var kz={key:Ez(e=>e.element),x:Ez(e=>e.unit.conformation.x(e.element)),y:Ez(e=>e.unit.conformation.y(e.element)),z:Ez(e=>e.unit.conformation.z(e.element)),id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Dz()),occupancy:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Dz()),B_iso_or_equiv:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Dz()),sourceIndex:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element),type_symbol:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Dz()),label_atom_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Dz()),auth_atom_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Dz()),label_alt_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Dz()),label_comp_id:Ez(Az),auth_comp_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Dz()),pdbx_formal_charge:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Dz()),vdw_radius:Ez(e=>Q.isAtomic(e.unit)?WI(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Dz())};function Az(e){return Q.isAtomic(e.unit)||Dz(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function jz(e){return Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Dz()}function JAe(e){Q.isAtomic(e.unit)||Dz();let t=e.unit.model.sequence.byEntityKey[Nz(e)];return t&&t.sequence.microHet.has(jz(e))}function Mz(e){Q.isAtomic(e.unit)||Dz();let t=e.unit.model.sequence.byEntityKey[Nz(e)];return t&&t.sequence.microHet.get(jz(e))||[Az(e)]}var YAe={key:Ez(e=>Q.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Dz()),group_PDB:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Dz()),label_seq_id:Ez(jz),auth_seq_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Dz()),pdbx_PDB_ins_code:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Dz()),isNonStandard:Ez(e=>Q.isAtomic(e.unit)?Mz(e).some(t=>e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]===`n`):Dz()),hasMicroheterogeneity:Ez(JAe),microheterogeneityCompIds:Ez(Mz),secondary_structure_type:Ez(e=>{Q.isAtomic(e.unit)||Dz();let t=Tz.get(e.structure).value?.get(e.unit.invariantId);return t?t.type[t.getIndex(e.unit.residueIndex[e.element])]:OI.Flag.NA}),secondary_structure_key:Ez(e=>{Q.isAtomic(e.unit)||Dz();let t=Tz.get(e.structure).value?.get(e.unit.invariantId);return t?t.key[t.getIndex(e.unit.residueIndex[e.element])]:-1}),chem_comp_type:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(Az(e)).type:Dz()),residueSourceIndex:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residueSourceIndex.value(e.unit.residueIndex[e.element]):Dz())},XAe={key:Ez(e=>Q.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Dz()),label_asym_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.asym_id.value(e.element)),auth_asym_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Dz()),label_entity_id:Ez(e=>Q.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.entity_id.value(e.element))},ZAe={key:kz.key,entityKey:Ez(e=>Q.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:Oz()),x:kz.x,y:kz.y,z:kz.z,asym_id:Ez(e=>Q.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):Oz()),entity_id:Ez(e=>Q.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):Oz()),seq_id_begin:Ez(e=>Q.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):Oz()),seq_id_end:Ez(e=>Q.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):Oz()),sphere_radius:Ez(e=>Q.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:Oz(`spheres`)),sphere_rmsf:Ez(e=>Q.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:Oz(`spheres`)),gaussian_weight:Ez(e=>Q.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:Oz(`gaussians`)),gaussian_covariance_matrix:Ez(e=>Q.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:Oz(`gaussians`))};function Nz(e){switch(e.unit.kind){case Q.Kind.Atomic:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case Q.Kind.Spheres:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case Q.Kind.Gaussians:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var QAe={key:Ez(Nz),id:Ez(e=>e.unit.model.entities.data.id.value(Nz(e))),type:Ez(e=>e.unit.model.entities.data.type.value(Nz(e))),src_method:Ez(e=>e.unit.model.entities.data.src_method.value(Nz(e))),pdbx_description:Ez(e=>e.unit.model.entities.data.pdbx_description.value(Nz(e))),formula_weight:Ez(e=>e.unit.model.entities.data.formula_weight.value(Nz(e))),pdbx_number_of_molecules:Ez(e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(Nz(e))),details:Ez(e=>e.unit.model.entities.data.details.value(Nz(e))),pdbx_mutation:Ez(e=>e.unit.model.entities.data.pdbx_mutation.value(Nz(e))),pdbx_fragment:Ez(e=>e.unit.model.entities.data.pdbx_fragment.value(Nz(e))),pdbx_ec:Ez(e=>e.unit.model.entities.data.pdbx_ec.value(Nz(e))),pdbx_parent_entity_id:Ez(e=>e.unit.model.entities.data.pdbx_parent_entity_id.value(Nz(e))),subtype:Ez(e=>e.unit.model.entities.subtype.value(Nz(e))),prd_id:Ez(e=>e.unit.model.entities.prd_id?.value(Nz(e))??``)},$Ae=[],Pz={constant:qAe,atom:kz,residue:YAe,chain:XAe,entity:QAe,unit:{id:Ez(e=>e.unit.id),chainGroupId:Ez(e=>e.unit.chainGroupId),multiChain:Ez(e=>Q.Traits.is(e.unit.traits,Q.Trait.MultiChain)),object_primitive:Ez(e=>e.unit.objectPrimitive),operator_name:Ez(e=>e.unit.conformation.operator.name),instance_id:Ez(e=>e.unit.conformation.operator.instanceId),operator_key:Ez(e=>e.unit.conformation.operator.key),model_index:Ez(e=>e.unit.model.modelNum),model_label:Ez(e=>e.unit.model.label),model_entry_id:Ez(e=>e.unit.model.entryId),hkl:Ez(e=>e.unit.conformation.operator.hkl),spgrOp:Ez(e=>e.unit.conformation.operator.spgrOp),model_num:Ez(e=>e.unit.model.modelNum),pdbx_struct_assembly_id:Ez(e=>e.unit.conformation.operator.assembly?.id||tA.DefaultName),pdbx_struct_oper_list_ids:Ez(e=>e.unit.conformation.operator.assembly?.operList||$Ae),struct_ncs_oper_id:Ez(e=>e.unit.conformation.operator.ncsId)},coarse:ZAe},Fz=class{add(e){let t=this.index.get(e.label_asym_id);t||(t=new Map,this.index.set(e.label_asym_id,t));let n=t.get(e.label_seq_id);return n||(n=[],t.set(e.label_seq_id,n)),this._find(e,n)?!1:(n.push(e),!0)}hasLabelAsymId(e){return this.index.has(e)}has(e){let t=this._asym_id(e);if(!this.index.has(t))return;let n=this.index.get(t),r=this._seq_id(e);if(!n.has(r))return;let i=n.get(r),a=this._comp_id(e),o=this._alt_id(e),s=this._ins_code(e),c=this._op_name(e)??`1_555`;for(let e of i)if(!(e.label_comp_id!==a||e.label_alt_id!==o||e.ins_code!==s)&&!(this.checkOperator&&(e.operator_name??`1_555`)!==c))return e}static getLabel(e,t=!1){return`${e.label_asym_id} ${e.label_comp_id} ${e.label_seq_id}:${e.ins_code}:${e.label_alt_id}${t?` `+(e.operator_name??`1_555`):``}`}static getEntryFromLocation(e){return{label_asym_id:Pz.chain.label_asym_id(e),label_comp_id:Pz.atom.label_comp_id(e),label_seq_id:Pz.residue.label_seq_id(e),label_alt_id:Pz.atom.label_alt_id(e),ins_code:Pz.residue.pdbx_PDB_ins_code(e),operator_name:Pz.unit.operator_name(e)??`1_555`}}_find(e,t){for(let n of t)if(!(n.label_comp_id!==e.label_comp_id||n.label_alt_id!==e.label_alt_id||n.ins_code!==e.ins_code)&&!(this.checkOperator&&(n.operator_name??`1_555`)!==(e.operator_name??`1_555`)))return!0;return!1}constructor(e){this.index=new Map,this.checkOperator=!1,this._asym_id=Pz.chain.label_asym_id,this._seq_id=Pz.residue.label_seq_id,this._comp_id=Pz.atom.label_comp_id,this._alt_id=Pz.atom.label_alt_id,this._ins_code=Pz.residue.pdbx_PDB_ins_code,this._op_name=Pz.unit.operator_name,this.checkOperator=e?.checkOperator??!1}},eje=s({exceptBy:()=>sje,expandProperty:()=>lje,includeConnected:()=>uje,includeSurroundings:()=>ije,intersectBy:()=>oje,querySelection:()=>aje,surroundingLigands:()=>fje,union:()=>cje,wholeResidues:()=>tje});function Iz(e,t,n){let r=t.subsetBuilder(!0);for(let i of n.units){if(i.kind!==Q.Kind.Atomic){r.setUnit(i.id,i.elements);continue}let{residueAtomSegments:n}=i.model.atomicHierarchy,a=t.unitMap.get(i.id).elements,o=i.elements;r.beginUnit(i.id);let s=uA.transientSegments(n,o);for(;s.hasNext;){let e=s.move().index;for(let t=n.offsets[e],i=n.offsets[e+1];t<i;t++)Vk.has(a,t)&&r.addElement(t)}r.commitUnit(),e.throwIfTimedOut()}return r.getStructure()}function tje(e){return function(t){let n=e(t);if(VR.isSingleton(n))return VR.Singletons(t.inputStructure,Iz(t,t.inputStructure,n.structure));{let e=new ez(t.inputStructure);for(let r of n.structures)e.add(Iz(t,t.inputStructure,r));return e.getSelection()}}}function Lz(e,t,n,r){let i=new oz(t),a=t.lookup3d,o=r.radius;for(let t of n.units){let n=t.conformation,r=t.elements;for(let e=0,t=r.length;e<t;e++){let t=r[e];a.findIntoBuilder(n.x(t),n.y(t),n.z(t),o,i)}e.throwIfTimedOut()}return r.wholeResidues?Iz(e,t,i.getStructure()):i.getStructure()}function Rz(e,t,n,r){let i=new oz(t),a=t.lookup3d,{elementRadius:o,elementRadiusClosure:s,sourceMaxRadius:c,radius:l}=r;e.pushCurrentElement(),e.element.structure=n;for(let t of n.units){e.element.unit=t;let n=t.conformation,r=t.elements;for(let t=0,u=r.length;t<u;t++){let u=r[t];e.element.element=u;let d=o(e);a.findIntoBuilderWithRadius(n.x(u),n.y(u),n.z(u),d,c,l,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),r.wholeResidues?Iz(e,t,i.getStructure()):i.getStructure()}function nje(e,t){return n=>(e.element.structure=n.structure,e.element.unit=n.unit,e.element.element=n.element,t(e))}function rje(e,t){let n=0;e.element.structure=e.inputStructure;for(let r of e.inputStructure.units){e.element.unit=r;let i=r.elements;for(let r=0,a=i.length;r<a;r++){let a=i[r];e.element.element=a;let o=t(e);o>n&&(n=o)}}return e.throwIfTimedOut(),n}function ije(e,t){return function(n){let r=e(n);if(t.elementRadius){let e={...t,elementRadius:t.elementRadius,elementRadiusClosure:nje(n,t.elementRadius),sourceMaxRadius:rje(n,t.elementRadius)};if(VR.isSingleton(r)){let t=Rz(n,n.inputStructure,r.structure,e);return VR.Singletons(n.inputStructure,t)}else{let t=new ez(n.inputStructure);for(let i of r.structures)t.add(Rz(n,n.inputStructure,i,e));return t.getSelection()}}if(VR.isSingleton(r)){let e=Lz(n,n.inputStructure,r.structure,t);return VR.Singletons(n.inputStructure,e)}else{let e=new ez(n.inputStructure);for(let i of r.structures)e.add(Lz(n,n.inputStructure,i,t));return e.getSelection()}}}function aje(e,t){return function(n){let r=e(n);if(VR.structureCount(r)===0)return r;let i=VR.UniqueBuilder(n.inputStructure),a=e=>i.add(e);return VR.forEach(r,(e,r)=>{n.pushInputStructure(e),VR.forEach(t(n),a),n.popInputStructure(),r%10==0&&n.throwIfTimedOut()}),i.getSelection()}}function oje(e,t){return function(n){let r=e(n);if(VR.structureCount(r)===0)return r;let i=t(n);if(VR.structureCount(i)===0)return VR.Empty(n.inputStructure);let a=VR.unionStructure(i),o=VR.UniqueBuilder(n.inputStructure);return VR.forEach(r,(e,t)=>{let r=zR(a,e);r.elementCount!==0&&o.add(r),t%50==0&&n.throwIfTimedOut()}),o.getSelection()}}function sje(e,t){return function(n){let r=e(n);if(VR.structureCount(r)===0)return r;let i=t(n);if(VR.structureCount(i)===0)return r;let a=VR.unionStructure(i),o=VR.UniqueBuilder(n.inputStructure);return VR.forEach(r,(e,t)=>{let r=BR(e,a);r.elementCount!==0&&o.add(r),t%50==0&&n.throwIfTimedOut()}),o.getSelection()}}function cje(e){return function(t){let n=VR.LinearBuilder(t.inputStructure);return n.add(VR.unionStructure(e(t))),n.getSelection()}}function lje(e,t){return function(n){let r=e(n),i=new Map,a=[];n.pushCurrentElement(),VR.forEach(r,(e,r)=>{n.element.structure=e;for(let a of e.units){n.element.unit=a;let e=a.elements;for(let a=0,o=e.length;a<o;a++){n.element.element=e[a];let o=t(n),s;i.has(o)?s=i.get(o):(s=CD.create(),i.set(o,s)),CD.add(s,r,r)}}a[r]=n.inputStructure.subsetBuilder(!0),r%10==0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(let e of n.inputStructure.units){n.element.unit=e;let r=e.elements;for(let o=0,s=r.length;o<s;o++){n.element.element=r[o];let s=t(n);if(!i.has(s))continue;let c=i.get(s).array;for(let t=0,n=c.length;t<n;t++)a[c[t]].addToUnit(e.id,r[o])}}n.popCurrentElement();let o=VR.UniqueBuilder(n.inputStructure);for(let e of a)o.add(e.getStructure());return o.getSelection()}}function uje({query:e,layerCount:t,wholeResidues:n,bondTest:r,fixedPoint:i}){let a=Math.max(t,0);return function(t){let o=VR.UniqueBuilder(t.inputStructure),s=e(t);return t.pushCurrentBond(),t.atomicBond.setTestFn(r),VR.forEach(s,(e,r)=>{let s=e;if(i)for(;;){let e=s.elementCount;if(s=zz(t,n,s),s.elementCount===e)break}else for(let e=0;e<a;e++)s=zz(t,n,s);o.add(s),r%10==0&&t.throwIfTimedOut()}),t.popCurrentBond(),o.getSelection()}}function zz(e,t,n){let r=dje(e,n);return t?Iz(e,e.inputStructure,r):r}function dje(e,t){let n=e.inputStructure,r=n.interUnitBonds,i=new oz(n),a=e.atomicBond;for(let o of t.units){if(o.kind!==Q.Kind.Atomic){i.beginUnit(o.id);for(let e=0,t=o.elements.length;e<t;e++)i.addElement(o.elements[e]);i.commitUnit();continue}let s=n.unitMap.get(o.id),{offset:c,b:l,edgeProps:{flags:u,order:d,key:f}}=s.bonds;a.setStructure(n),a.a.unit=s,a.b.unit=s;for(let t=0,n=o.elements.length;t<n;t++){i.addToUnit(o.id,o.elements[t]);let n=Vk.indexOf(s.elements,o.elements[t]);for(let r=c[n],p=c[n+1];r<p;r++){let c=l[r],p=s.elements[c];Vk.has(o.elements,p)||i.has(o.id,p)||(a.aIndex=n,a.a.element=o.elements[t],a.bIndex=c,a.b.element=p,a.type=u[r],a.order=d[r],a.key=f[r],a.test(e,!0)&&i.addToUnit(o.id,p))}}for(let c of r.getConnectedUnits(s.id)){let r=t.unitMap.get(c.unitB),l=n.unitMap.get(c.unitB);for(let t of c.connectedIndices)if(Vk.has(o.elements,s.elements[t]))for(let n of c.getEdges(t)){let o=l.elements[n.indexB];r&&Vk.has(r.elements,o)||i.has(c.unitB,o)||(a.a.unit=s,a.aIndex=t,a.a.element=s.elements[t],a.b.unit=l,a.bIndex=n.indexB,a.b.element=o,a.type=n.props.flag,a.order=n.props.order,a.key=n.props.key,a.test(e,!0)&&i.addToUnit(c.unitB,o))}}}return i.getStructure()}function fje({query:e,radius:t,includeWater:n}){let r=Pz.entity.type;function i(e){return r(e)===`water`}return function(r){let a=VR.unionStructure(e(r)),o=Iz(r,r.inputStructure,Lz(r,r.inputStructure,a,{radius:t})),s=pje(r.inputStructure),c=mje(r.inputStructure),l=iL.create(o),u=new Map,d=new Fz({checkOperator:!0});for(let e of o.units){if(e.kind!==Q.Kind.Atomic)continue;l.unit=e;let{elements:t}=e,n=uA.transientSegments(e.model.atomicHierarchy.chainAtomSegments,t),i=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t);for(;n.hasNext;){let e=n.move();l.element=t[e.start];let r=Pz.chain.label_asym_id(l),a=Pz.unit.operator_name(l);if(s.has(r)){u.has(r)?OE(u.get(r),a):u.set(r,[a]);continue}let o=Pz.entity.type(l);if(!(o===`water`||o===`polymer`))for(i.setSegment(e);i.hasNext;)l.element=t[i.move().start],c.addComponent(Fz.getEntryFromLocation(l),d)}r.throwIfTimedOut()}let f=r.inputStructure.subsetBuilder(!0);for(let e of r.inputStructure.units){if(e.kind!==Q.Kind.Atomic)continue;l.unit=e;let{elements:t}=e,n=uA.transientSegments(e.model.atomicHierarchy.chainAtomSegments,t),i=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t);for(f.beginUnit(e.id);n.hasNext;){let e=n.move();l.element=t[e.start];let r=Pz.chain.label_asym_id(l),a=Pz.unit.operator_name(l);if(u.has(r)&&u.get(r).indexOf(a)>=0){f.addElementRange(t,e.start,e.end);continue}if(d.hasLabelAsymId(r))for(i.setSegment(e);i.hasNext;){let e=i.move();l.element=t[e.start],d.has(l)&&f.addElementRange(t,e.start,e.end)}}f.commitUnit(),r.throwIfTimedOut()}let p=LR(r.inputStructure,[f.getStructure(),a]);if(n){let e=new oz(r.inputStructure),n=r.inputStructure.lookup3d;for(let a of p.units){let o=a.conformation,s=a.elements;for(let r=0,c=s.length;r<c;r++){let c=s[r];n.findIntoBuilderIf(o.x(c),o.y(c),o.z(c),t,e,i),e.addToUnit(a.id,c)}r.throwIfTimedOut()}return VR.Sequence(r.inputStructure,[e.getStructure()])}else return VR.Sequence(r.inputStructure,[p])}}function pje(e){let t=e.models[0],n=new Set;if(t.sourceData?.kind!==`mmCIF`)return n;let{_rowCount:r,asym_id:i}=t.sourceData.data.db.pdbx_molecule;for(let e=0;e<r;e++)n.add(i.value(e));return n}function mje(e){let t=e.models[0],n=new hje;if(t.sourceData?.kind!==`mmCIF`)return n;let r=t.sourceData.data.db.struct_conn,{conn_type_id:i}=r,{ptnr1_label_asym_id:a,ptnr1_label_comp_id:o,ptnr1_label_seq_id:s,ptnr1_symmetry:c,pdbx_ptnr1_label_alt_id:l,pdbx_ptnr1_PDB_ins_code:u}=r,{ptnr2_label_asym_id:d,ptnr2_label_comp_id:f,ptnr2_label_seq_id:p,ptnr2_symmetry:m,pdbx_ptnr2_label_alt_id:h,pdbx_ptnr2_PDB_ins_code:g}=r;for(let e=0;e<r._rowCount;e++){let t=i.value(e);if(t!==`covale`&&t!==`metalc`)continue;let r={label_asym_id:a.value(e),label_comp_id:o.value(e),label_seq_id:s.value(e),label_alt_id:l.value(e),ins_code:u.value(e),operator_name:c.value(e)??`1_555`},_={label_asym_id:d.value(e),label_comp_id:f.value(e),label_seq_id:p.value(e),label_alt_id:h.value(e),ins_code:g.value(e),operator_name:m.value(e)??`1_555`};n.addEdge(r,_)}return n}var hje=class{constructor(){this.vertices=new Map,this.edges=new Map}addVertex(e,t){this.vertices.has(t)||(this.vertices.set(t,e),this.edges.set(t,[]))}addEdge(e,t){let n=Fz.getLabel(e),r=Fz.getLabel(t);this.addVertex(e,n),this.addVertex(t,r),OE(this.edges.get(n),r),OE(this.edges.get(r),n)}addComponent(e,t){let n=Fz.getLabel(e);if(!this.vertices.has(n)){t.add(e);return}let r=new Set,i=new Set,a=[n];for(i.add(n),t.add(e);a.length>0;){let n=a.pop();r.add(n);let o=this.vertices.get(n);for(let s of this.edges.get(n)){if(r.has(s)||(a.push(s),i.has(s)))continue;i.add(s);let n=this.vertices.get(s);o.operator_name===n.operator_name?t.add({...n,operator_name:e.operator_name}):t.add(n)}}}};function gje(e,t,n,r,i,a){return t.elementCount===0||n.elementCount===0?!0:t.elementCount<=n.elementCount?Bz.check(e,t,n,r,i,a):Bz.check(e,n,t,r,i,a)}function _je(e,t,n,r,i){return t.elementCount===0||n.elementCount===0?!0:t.elementCount<=n.elementCount?Vz.check(e,t,n,r,i):Vz.check(e,n,t,r,i)}var Bz;(function(e){let t;(function(e){e[e.BelowMin=0]=`BelowMin`,e[e.WithinMax=1]=`WithinMax`,e[e.Miss=2]=`Miss`})(t||={});let n=B();function r(e,r,i,a,o,s,c){let{elements:l,conformation:u}=r,d=n;e.element.unit=r;let f=!1;for(let n=0,r=l.length;n<r;n++){let r=l[n];e.element.element=r;let p=Math.max(0,B.distance(i,u.position(r,d))-a-c(e));if(p<o)return t.BelowMin;p<s&&(f=!0)}return f?t.WithinMax:t.Miss}function i(e,n,i,a,o,s,c){let{units:l}=n,u=!1;for(let n=0,d=l.length;n<d;n++){let d=r(e,l[n],i,a,o,s,c);if(d===t.BelowMin)return t.BelowMin;d===t.WithinMax&&(u=!0)}return u?t.WithinMax:t.Miss}let a=B();function o(e,n,r,o,s,c){if(n.elementCount===0||r.elementCount===0)return 0;let{units:l}=n,u=!1;e.element.structure=n;for(let n=0,d=l.length;n<d;n++){let d=l[n],{elements:f,conformation:p}=d;e.element.unit=d;for(let n=0,l=f.length;n<l;n++){let l=f[n];e.element.element=l;let d=i(e,r,p.position(l,a),c(e),o,s,c);if(d===t.BelowMin)return!1;d===t.WithinMax&&(u=!0)}}return u}e.check=o})(Bz||={});var Vz;(function(e){let t=B();function n(e,n,r,i,a,o){let{elements:s,conformation:c}=n,l=t;e.element.unit=n;for(let t=0,n=s.length;t<n;t++){let n=s[t];if(e.element.element=n,Math.max(0,B.distance(r,c.position(n,l))-i-o(e))<=a)return!0}return!1}function r(e,t,r,i,a,o){let{units:s}=t;for(let t=0,c=s.length;t<c;t++)if(n(e,s[t],r,i,a,o))return!0;return!1}let i=B();function a(e,t,n,a,o){if(t.elementCount===0||n.elementCount===0)return 0;let{units:s}=t;e.element.structure=t;for(let t=0,c=s.length;t<c;t++){let c=s[t];e.element.unit=c;let{elements:l,conformation:u}=c;for(let t=0,s=l.length;t<s;t++){let s=l[t];if(e.element.element=s,r(e,n,u.position(s,i),o(e),a,o))return!0}}return!1}e.check=a})(Vz||={});var vje=s({areIntersectedBy:()=>Cje,first:()=>bje,getCurrentStructureProperties:()=>Hz,isConnectedTo:()=>kje,pick:()=>yje,withSameAtomProperties:()=>Sje,within:()=>wje});function yje(e,t){return n=>{let r=e(n),i=VR.LinearBuilder(n.inputStructure);return n.pushCurrentElement(),VR.forEach(r,(e,r)=>{n.currentStructure=e,t(n)&&i.add(e),r%100&&n.throwIfTimedOut()}),n.popCurrentStructure(),i.getSelection()}}function bje(e){return t=>{let n=e(t),r=VR.LinearBuilder(t.inputStructure);if(n.kind===`singletons`){if(n.structure.elementCount>0){let e=n.structure.units[0],i=nB.create([e.getChild(Vk.ofSingleton(e.elements[0]))],{parent:t.inputStructure});r.add(i)}}else n.structures.length>0&&r.add(n.structures[0]);return r.getSelection()}}function Hz(e,t,n){let{units:r}=e.currentStructure,i=e.pushCurrentElement();i.structure=e.currentStructure;for(let a of r){i.unit=a;let r=a.elements,o=t;if(o){for(let t=0,a=r.length;t<a;t++)i.element=r[t],n.add(o(e));e.throwIfTimedOut()}}return e.popCurrentElement(),n}function xje(e,t,n){let r=new Set,i=t(e);return e.pushCurrentElement(),VR.forEach(i,(t,i)=>{e.currentStructure=t,Hz(e,n,r),i%10&&e.throwIfTimedOut()}),e.popCurrentElement(),r}function Sje(e,t,n){return r=>{let i=e(r),a=xje(r,t,n),o=VR.LinearBuilder(r.inputStructure);return r.pushCurrentStructure(),VR.forEach(i,(e,t)=>{r.currentStructure=e;let i=Hz(r,n,new Set);$F.isSuperset(a,i)&&o.add(e),t%10&&r.throwIfTimedOut()}),r.popCurrentStructure(),o.getSelection()}}function Cje(e,t){return n=>{let r=VR.unionStructure(t(n)),i=VR.LinearBuilder(n.inputStructure);return VR.forEach(e(n),(e,t)=>{RR(r,e)&&i.add(e),t%10&&n.throwIfTimedOut()}),i.getSelection()}}function wje(e){return t=>{let n={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return n.minRadius===0&&e.minRadius===void 0?Tje(n):n.minRadius===0?Eje(n):Dje(n)}}function Tje({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i}){let a=VR.unionStructure(n).lookup3d,o=VR.LinearBuilder(e.inputStructure),s=B.zero();return VR.forEach(t,(t,n)=>{let{units:c}=t,l=!1;for(let e=0,t=c.length;e<t;e++){let{elements:t,conformation:n}=c[e];for(let e=0,i=t.length;e<i;e++){let i=t[e];if(n.position(i,s),a.check(s[0],s[1],s[2],r+n.r(i))){l=!0;break}}if(l)break}i&&(l=!l),l&&o.add(t),n%10==0&&e.throwIfTimedOut()}),o.getSelection()}function Eje({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i,elementRadius:a}){let o=VR.unionStructure(n),s=VR.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),VR.forEach(t,(t,n)=>{let c=_je(e,o,t,r,a);i&&(c=!c),c&&s.add(t),n%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),s.getSelection()}function Dje({queryCtx:e,selection:t,target:n,minRadius:r,maxRadius:i,invert:a,elementRadius:o}){let s=VR.unionStructure(n),c=VR.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),VR.forEach(t,(t,n)=>{let l=gje(e,s,t,r,i,o);a&&(l=!l),l&&c.add(t),n%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),c.getSelection()}function Oje(e,t){let{queryCtx:n,input:r,target:i,disjunct:a}=e,o=n.atomicBond,s=r.interUnitBonds;o.setStructure(r);for(let e of t.units){if(!Q.isAtomic(e))continue;let c=r.unitMap.get(e.id),{offset:l,b:u,edgeProps:{flags:d,order:f,key:p}}=c.bonds,m=s.getConnectedUnits(e.id),h=m.length,g=e.elements,_=c.elements;for(let s=0,v=g.length;s<v;s++){let v=Vk.indexOf(_,g[s]);o.a.unit=c,o.b.unit=c;for(let t=l[v],r=l[v+1];t<r;t++)if(o.b.element=c.elements[u[t]],!(a&&Vk.has(e.elements,o.b.element))&&i.hasElement(o.b)&&(o.aIndex=v,o.a.element=g[s],o.bIndex=u[t],o.type=d[t],o.order=f[t],o.key=p[t],o.test(n,!0)))return!0;for(let e=0;e<h;e++){let l=m[e],u=r.unitMap.get(l.unitB),d=u.elements,f=l.getEdges(v);for(let e=0,r=f.length;e<r;e++){let r=f[e];if(o.b.unit=u,o.b.element=d[r.indexB],i.hasElement(o.b)&&!(a&&t.hasElement(o.b))&&(o.a.unit=c,o.aIndex=v,o.a.element=g[s],o.bIndex=r.indexB,o.type=r.props.flag,o.order=r.props.order,o.key=r.props.key,o.test(n,!0)))return!0}}}}return!1}function kje({query:e,target:t,disjunct:n,invert:r,bondTest:i}){return a=>{let o=t(a);if(VR.isEmpty(o))return o;let s=e(a);if(VR.isEmpty(s))return s;let c={queryCtx:a,input:a.inputStructure,disjunct:n,target:VR.unionStructure(o)},l=VR.LinearBuilder(a.inputStructure);return a.pushCurrentBond(),a.atomicBond.setTestFn(i),VR.forEach(s,(e,t)=>{(Oje(c,e)||r)&&l.add(e),t%5==0&&a.throwIfTimedOut()}),a.popCurrentBond(),l.getSelection()}}var Aje=s({intersect:()=>Mje,merge:()=>jje});function jje(e){return e.length===0?tz:e.length===1?e[0]:t=>{let n=VR.UniqueBuilder(t.inputStructure);for(let r=0;r<e.length;r++)VR.forEach(e[r](t),(e,i)=>{n.add(e),r%100&&t.throwIfTimedOut()});return n.getSelection()}}function Mje(e){return e.length===0?tz:e.length===1?e[0]:t=>{let n=[];for(let r=0;r<e.length;r++)n.push(e[r](t));let r=0,i=VR.structureCount(n[0]);for(let e=1;e<n.length;e++){let t=VR.structureCount(n[e]);t<i&&(r=e,i=t)}t.throwIfTimedOut();let a=aL(e=>e.hashCode,nB.areUnitIdsAndIndicesEqual);VR.forEach(n[r],e=>a.add(e));let o=VR.UniqueBuilder(t.inputStructure);for(let e=0;e<n.length;e++)e!==r&&(VR.forEach(n[e],e=>{a.has(e)&&o.add(e)}),t.throwIfTimedOut());return o.getSelection()}}var Nje=s({atomCount:()=>Pje,countQuery:()=>Fje,propertySet:()=>Ije});function Pje(e){return e.currentStructure.elementCount}function Fje(e){return t=>{let n=e(t);return VR.structureCount(n)}}function Ije(e){return t=>Hz(t,e,new Set)}var Uz;(function(e){function t(e){return!!e&&!!e.has}function n(e,t){return n=>e(n)===t}e.eq=n;function r(e,t){return n=>e(n)<t}e.lt=r;function i(e,t){return n=>e(n)<=t}e.lte=i;function a(e,t){return n=>e(n)>t}e.gt=a;function o(e,t){return n=>e(n)>=t}e.gte=o;function s(e){return!0}function c(e){return!1}function l(e,n){if(t(n))return t=>n.has(e(t));{if(n.length===0)return c;let t=new Set;for(let e=0;e<n.length;e++)t.add(n[e]);return n=>t.has(e(n))}}e.inSet=l;function u(...e){switch(e.length){case 0:return s;case 1:return e[0];case 2:{let t=e[0],n=e[1];return e=>t(e)&&n(e)}case 3:{let t=e[0],n=e[1],r=e[2];return e=>t(e)&&n(e)&&r(e)}case 4:{let t=e[0],n=e[1],r=e[2],i=e[3];return e=>t(e)&&n(e)&&r(e)&&i(e)}case 5:{let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4];return e=>t(e)&&n(e)&&r(e)&&i(e)&&a(e)}case 6:{let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5];return e=>t(e)&&n(e)&&r(e)&&i(e)&&a(e)&&o(e)}default:{let t=e.length;return n=>{for(let n=0;n<t;n++)if(!e[n])return!1;return!0}}}}e.and=u;function d(...e){switch(e.length){case 0:return c;case 1:return e[0];case 2:{let t=e[0],n=e[1];return e=>t(e)||n(e)}case 3:{let t=e[0],n=e[1],r=e[2];return e=>t(e)||n(e)||r(e)}case 4:{let t=e[0],n=e[1],r=e[2],i=e[3];return e=>t(e)||n(e)||r(e)||i(e)}case 5:{let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4];return e=>t(e)||n(e)||r(e)||i(e)||a(e)}case 6:{let t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5];return e=>t(e)||n(e)||r(e)||i(e)||a(e)||o(e)}default:{let t=e.length;return n=>{for(let n=0;n<t;n++)if(e[n])return!0;return!1}}}}e.or=d})(Uz||={});const Wz={generators:Zke,filters:vje,modifiers:eje,combinators:Aje,pred:Uz,internal:Gke,atomset:Nje};var Gz;(function(e){function t(e,t){return hb.create(`Build Assembly`,async n=>{let r=e.models;if(r.length!==1)throw Error(`Can only build assemblies from structures based on 1 model.`);let i=ZI.findAssembly(r[0],t);if(!i)throw Error(`Assembly '${t}' is not defined.`);let a=tA.create(i.id,z.identity(),{assembly:{id:i.id,operId:0,operList:[]}}),o=nB.Builder({coordinateSystem:a,label:e.label,dynamicBonds:e.dynamicBonds}),s=new ZR(e);for(let e of i.operatorGroups){let t=e.selector(s);if(VR.structureCount(t)===0)continue;let{units:n}=VR.unionStructure(t);for(let t of e.operators)for(let e of n)o.addWithOperator(e,t)}return o.getStructure()})}e.buildAssembly=t;function n(e,t,n){return hb.create(`Build Symmetry Assembly`,async r=>{let i=e.models;if(i.length!==1)throw Error(`Can only build symmetry assemblies from structures based on 1 model.`);let a=B(),o=nB.Builder({label:e.label,representativeModel:i[0],dynamicBonds:e.dynamicBonds}),s=new ZR(e);for(let e of t){let t=Lje(e.asymIds)(s);if(VR.structureCount(t)===0)continue;let{units:r}=VR.unionStructure(t);for(let{index:t,shift:[i,s,c]}of e.operators){let e=Kz(n,t,i,s,c,a);for(let t of r)for(let n of e)o.addWithOperator(t,n)}}return o.getStructure()})}e.buildSymmetryAssembly=n;function r(e,t){return hb.create(`Find Symmetry Mates`,n=>Vje(n,e,t))}e.builderSymmetryMates=r;function i(e,t,n){return hb.create(`Build Symmetry`,r=>Bje(r,e,t,n))}e.buildSymmetryRange=i;function a(e){return hb.create(`Build NCS`,t=>zje(t,e))}e.buildNcs=a;function o(e,t){return e.invariantId===t.invariantId&&e.model.id===t.model.id&&Vk.areEqual(e.elements,t.elements)}e.areUnitsEquivalent=o;function s(){return Ige(Q.hashUnit,o)}e.UnitEquivalenceBuilder=s;function c(e){let t=s();for(let n of e.units)t.add(n.id,n);let n=[];for(let r of t.groups)n.push(Q.SymmetryGroup(r.map(t=>e.unitMap.get(t))));return n}e.computeTransformGroups=c;function l(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n){let r=e[n].units,i=t[n].units;if(r.length!==i.length||e[n].hashCode!==t[n].hashCode)return!1;for(let e=0,t=r.length;e<t;e++)if(r[e].conformation!==i[e].conformation)return!1}return!0}e.areTransformGroupsEquivalent=l})(Gz||={});function Lje(e){return Wz.generators.atoms({chainTest:Wz.pred.and(Wz.pred.eq(e=>Pz.unit.operator_name(e.element),tA.DefaultName),Wz.pred.inSet(e=>Pz.chain.label_asym_id(e.element),e))})}function Kz(e,t,n,r,i,a){let{spacegroup:o,ncsOperators:s}=e,c=[],{toFractional:l}=o.cell,u=B.transformMat4(B(),a,l),d=sA.getSymmetryOperatorRef(o,t,n,r,i,u);if(s&&s.length)for(let e=0,t=s.length;e<t;++e){let t=s[e],n=z.mul(z(),d.matrix,t.matrix),r=tA.create(`${d.name} ${t.name}`,n,{assembly:d.assembly,ncsId:t.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});c.push(r)}else c.push(d);return c}function qz(e,t,n,r){let{spacegroup:i,ncsOperators:a}=e,o=a&&a.length||0,s=[];!o&&t[0]<=0&&n[0]>=0&&t[1]<=0&&n[1]>=0&&t[2]<=0&&n[2]>=0&&(s[0]=sA.getSymmetryOperator(i,0,0,0,0));for(let a=0;a<i.operators.length;a++)for(let i=t[0];i<=n[0];i++)for(let c=t[1];c<=n[1];c++)for(let l=t[2];l<=n[2];l++)!o&&a===0&&i===0&&c===0&&l===0||s.push(...Kz(e,a,i,c,l,r));return s}function Rje(e,t){return e._operators_333&&B.equals(t,e._operators_333.ref)||(e._operators_333={ref:B.clone(t),operators:qz(e,B.create(-3,-3,-3),B.create(3,3,3),t)}),e._operators_333.operators}function Jz(e,t){let n=nB.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:r}=e;for(let e of t)for(let t of r)n.addWithOperator(t,e);return n.getStructure()}async function zje(e,t){let n=t.models;if(n.length!==1)throw Error(`Can only build NCS from structures based on 1 model.`);let r=bB.Provider.get(n[0]);if(!r)return t;let i=r.ncsOperators;return!i||!i.length?t:Jz(t,i)}async function Bje(e,t,n,r){let i=t.models;if(i.length!==1)throw Error(`Can only build symmetries from structures based on 1 model.`);let a=bB.Provider.get(i[0]);if(!a)return t;let{spacegroup:o}=a;return oA.isZero(o.cell)?t:Jz(t,qz(a,n,r,DB.getCenter(i[0])))}async function Vje(e,t,n){let r=t.models;if(r.length!==1)throw Error(`Can only build symmetries from structures based on 1 model.`);let i=bB.Provider.get(r[0]);if(!i)return t;let{spacegroup:a}=i;if(oA.isZero(a.cell))return t;e.shouldUpdate&&await e.update(`Initialing...`);let o=Rje(i,DB.getCenter(r[0])),s=t.lookup3d,c=new Set;function l(e,t){return`${e.invariantId}|${t.name}`}let u=nB.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:d}=t,f=B.zero();for(let t of o){for(let e of d){let r=e.lookup3d.boundary.sphere;B.transformMat4(f,r.center,t.matrix);let i=s.findUnitIndices(f[0],f[1],f[2],r.radius+n);for(let a=0,o=i.count;a<o;a++){if(!d[i.indices[a]].lookup3d.check(f[0],f[1],f[2],r.radius+n))continue;let o=l(e,t);c.has(o)||(u.addWithOperator(e,t),c.add(o))}}e.shouldUpdate&&await e.update(`Building symmetry...`)}return u.getStructure()}var Hje=class{addToUnit(e,t){let n=this.unitMap.get(e);n?n[n.length]=t:(this.unitMap.set(e,[t]),this.ids[this.ids.length]=e),this.elementCount++}beginUnit(e){this.parentId=e,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(e){this.currentUnit[this.currentUnit.length]=e,this.elementCount++}addElementRange(e,t,n){for(let r=t;r<n;r++)this.currentUnit[this.currentUnit.length]=e[r],this.elementCount++}commitUnit(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(e,t){this.ids[this.ids.length]=e,this.unitMap.set(e,t),this.elementCount+=t.length}_getStructure(e){if(this.isEmpty)return nB.Empty;let t=[];ZD(this.ids);let n=Gz.UnitEquivalenceBuilder();for(let r=0,i=this.ids.length;r<i;r++){let i=this.ids[r],a=this.parent.unitMap.get(i),o=this.unitMap.get(i),s=!1;e&&(this.isSorted||ZD(o),o=Vk.deduplicate(Vk.ofSortedArray(this.currentUnit)),s=!0);let c=o.length;if(o.length===a.elements.length){t[t.length]=a,n.add(a.id,a);continue}!this.isSorted&&!s&&c>1&&ZD(o);let l=a.getChild(Vk.ofSortedArray(o)),u=n.add(l.id,l);l!==u&&(l=u.applyOperator(l.id,l.conformation.operator,!0)),t[t.length]=l}return nB.create(t,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(e){let t=this.ids[0];e.unit=this.parent.unitMap.get(t),e.element=this.unitMap.get(t)[0]}get isEmpty(){return this.elementCount===0}constructor(e,t){this.parent=e,this.isSorted=t,this.ids=[],this.unitMap=dA.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}};function Yz(e,t){let n=1;for(;t--;)n*=e--;return n}function Uje(e,t){return t>e?0:Yz(e,t)/Yz(t,t)}function Wje(e){let t=e&-e,n=e+t;return n|((n&-n)/t>>1)-1}var Gje=class{move(){if(this.hasNext){let e=0,t=0,n=this.index;for(;n;n>>>=1,e++)n&1&&(this.value[t++]=this.array[e]);this.index=Wje(this.index),this.hasNext=this.index<this.maxIndex}return this.value}constructor(e,t){this.array=e,this.hasNext=!1,this.index=(1<<t)-1,this.size=Uje(e.length,t),this.maxIndex=1<<e.length,this.value=Array(t),this.hasNext=t>0&&t<=e.length}};function Xz(e,t){let n=[],r=new Gje(e,t);for(;r.hasNext;)n.push(r.move().slice());return n}var Zz=[];const Kje={links:Zz,terminalLinks:Zz,elements:Zz,partialElements:Zz,getElementIndices:()=>Zz,getLinkIndices:()=>Zz,getTerminalLinkIndices:()=>Zz};var Qz=nI(`C`),$z=nI(`O`),qje=[DR.elementFingerprint([Qz,Qz,Qz,$z]),DR.elementFingerprint([Qz,Qz,Qz,Qz,$z]),DR.elementFingerprint([Qz,Qz,Qz,Qz,Qz,$z]),DR.elementFingerprint([Qz,Qz,Qz,Qz,Qz,Qz,$z])];function Jje(e,t){let n=-1,r=-1,i=-1,a=-1,{elements:o}=e,{type_symbol:s,label_atom_id:c}=e.model.atomicHierarchy.atoms,{b:l,offset:u}=e.bonds;for(let e=0,d=t.length;e<d;++e){let d=o[t[e]];if(s.value(d)!==Qz)continue;let f=0,p=0;for(let n=u[t[e]],r=u[t[e]+1];n<r;++n){let e=o[l[n]],t=s.value(e);t===$z?++f:t===Qz&&++p}if(f===2){n=d;break}else f===1&&p===1?r=d:c.value(d).startsWith(`C1`)?i=d:a=d}return n===-1?r===-1?i===-1?a===-1?o[t[0]]:a:i:r:n}function Yje(e,t){let{elements:n}=e,{label_alt_id:r}=e.model.atomicHierarchy.atoms;return r.value(n[t])}function Xje(e,t,n,r){let i=t.conformation;return B.normalize(e,B.sub(e,r,i.position(n,e))),e}function eB(e,t){let{elements:n}=e,{label_atom_id:r}=e.model.atomicHierarchy.atoms;return r.value(n[t])}function Zje(e,t){if(!t||!t.length)return;let{unit:n,all:r}=e,i=new Set,a=Xz(TE(Array(t.length)),2);for(let e=0,o=a.length;e<o;++e){let o=a[e],s=r[t[o[0]]],c=r[t[o[1]]];Vk.areIntersecting(s,c)&&DR.getAltId(n,s)===DR.getAltId(n,c)&&(i.add(t[o[0]]),i.add(t[o[1]]))}if(i.size){let e=[];for(let n=0,r=t.length;n<r;++n)i.has(t[n])||e.push(t[n]);return e}else return t}function Qje(e,t){return t.properties.saccharideComponentMap.get(e)}function $je(e){if(e.models.reduce((e,t)=>e+t.properties.saccharideComponentMap.size,0)===0)return Kje;let t=[],n=[],r=[],i=[],a=new Map;function o(e,t,n){return`${e}|${t}|${n}`}function s(e,t){a.has(e)?a.get(e).push(t):a.set(e,[t])}function c(e,t){B.sub(r[e].geometry.direction,r[t].geometry.center,r[e].geometry.center),B.normalize(r[e].geometry.direction,r[e].geometry.direction)}let l=B();function u(e,t,n){let i=n.conformation,a=r[e].geometry;B.sub(a.direction,i.position(n.elements[t],l),a.center),B.normalize(a.direction,a.direction)}for(let n=0,a=e.units.length;n<a;++n){let a=e.units[n];if(!Q.isAtomic(a))continue;let{model:l,rings:u}=a,{chainAtomSegments:d,residueAtomSegments:f,atoms:p}=l.atomicHierarchy,{label_comp_id:m}=p,h=uA.transientSegments(d,a.elements),g=uA.transientSegments(f,a.elements),_;for(;h.hasNext;)for(g.setSegment(h.move());g.hasNext;){let{index:e}=g.move(),n=Qje(m.value(f.offsets[e]),l);if(!n)continue;_||=ER.byFingerprintAndResidue(u,qje);let d=Zje(u,_.get(e));if(!d||!d.length){i.push({unit:a,residueIndex:e,component:n});continue}let p=[];for(let t=0,i=d.length;t<i;++t){let i=u.all[d[t]],c=Jje(a,i),l=Qk.calculateMomentsAxes(TR(a,i)),f=Qk.calculateNormalizedAxes(l),m=B.copy(B(),f.origin),h=B.copy(B(),f.dirC),g=Xje(B(),a,c,m);B.orthogonalize(g,h,g);let _=DR.getAltId(a,i),v=r.length;p.push(v),s(o(e,a.id,_),v),_&&s(o(e,a.id,``),v),r.push({geometry:{center:m,normal:h,direction:g},component:n,ringIndex:d[t],altId:_,unit:a,residueIndex:e})}let h=Xz(TE(Array(d.length)),2);for(let e=0,n=h.length;e<n;++e){let n=h[e],i=u.all[d[n[0]]],o=u.all[d[n[1]]];if(KI.areVertexSetsConnected(a.bonds,i,o,3)){let e=p[n[0]],i=p[n[1]];r[e].altId===r[i].altId&&(c(e,i),c(i,e),t.push({carbohydrateIndexA:e,carbohydrateIndexB:i}),t.push({carbohydrateIndexA:i,carbohydrateIndexB:e}))}}}}function d(e,t){return a.get(o(e.getResidueIndex(t),e.id,Yje(e,t)))||[]}for(let e=0,n=r.length;e<n;++e){let i=r[e],{unit:a}=i;for(let o=e+1;o<n;++o){let n=r[o];if(a!==n.unit||i.residueIndex===n.residueIndex)continue;let s=a.rings.all[i.ringIndex],l=a.rings.all[n.ringIndex];KI.areVertexSetsConnected(a.bonds,s,l,3)&&(c(e,o),c(o,e),t.push({carbohydrateIndexA:e,carbohydrateIndexB:o}),t.push({carbohydrateIndexA:o,carbohydrateIndexB:e}))}}for(let r=0,i=e.units.length;r<i;++r){let i=e.units[r];Q.isAtomic(i)&&e.interUnitBonds.getConnectedUnits(i.id).forEach(r=>{r.connectedIndices.forEach(i=>{r.getEdges(i).forEach(({props:a,indexB:o})=>{if(!kI.isCovalent(a.flag))return;let s=e.unitMap.get(r.unitA),l=e.unitMap.get(r.unitB),f=d(s,i),p=d(l,o);if(f.length>0&&p.length>0){let e=f.length,n=p.length;for(let r=0,a=Math.max(e,n);r<a;++r){let a=f[Math.min(r,e-1)],o=p[Math.min(r,n-1)],l=eB(s,i);(l.startsWith(`O1`)||l.startsWith(`C1`))&&c(a,o),t.push({carbohydrateIndexA:a,carbohydrateIndexB:o})}}else if(p.length===0)for(let e of f){let t=eB(s,i);(t.startsWith(`O1`)||t.startsWith(`C1`))&&u(e,o,l),n.push({carbohydrateIndex:e,elementIndex:o,elementUnit:l,fromCarbohydrate:!0})}else if(f.length===0)for(let e of p)n.push({carbohydrateIndex:e,elementIndex:i,elementUnit:s,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:n,elements:r,partialElements:i,...eMe(r,t,n)}}function eMe(e,t,n){function r(e,t){return pE(e.id,t)}function i(e,t,n){let i=[],a=e.get(r(t,n));if(a!==void 0)for(let e of a)OE(i,e);return i}let a=new Map;for(let t=0,n=e.length;t<n;++t){let{unit:n,ringIndex:i}=e[t],o=n.rings.all[i];for(let e=0,i=o.length;e<i;++e){let i=r(n,n.elements[o[e]]),s=a.get(i);s===void 0?a.set(i,[t]):s.push(t)}}function o(e,t){return i(a,e,t)}let s=new Map;for(let n=0,i=t.length;n<i;++n){let{unit:i,ringIndex:a}=e[t[n].carbohydrateIndexA],o=i.rings.all[a];for(let e=0,t=o.length;e<t;++e){let t=r(i,i.elements[o[e]]),a=s.get(t);a===void 0?s.set(t,[n]):a.push(n)}}function c(e,t){return i(s,e,t)}let l=new Map;for(let t=0,i=n.length;t<i;++t){let{fromCarbohydrate:i,carbohydrateIndex:a,elementUnit:o,elementIndex:s}=n[t];if(i){let{unit:n,ringIndex:i}=e[a],o=n.rings.all[i];for(let e=0,i=o.length;e<i;++e){let i=r(n,n.elements[o[e]]),a=l.get(i);a===void 0?l.set(i,[t]):a.push(t)}}else{let e=r(o,o.elements[s]),n=l.get(e);n===void 0?l.set(e,[t]):n.push(t)}}function u(e,t){return i(l,e,t)}return{getElementIndices:o,getLinkIndices:c,getTerminalLinkIndices:u}}var tB=q(),tMe=new RA(`14`),nMe=new RA(`98`);function rMe(e){return e>500?tMe:nMe}function iMe(e){let{units:t}=e,n=rMe(t.length);n.reset();for(let e=0,r=t.length;e<r;e++){let r=t[e],i=r.boundary,a=r.conformation.operator;a.isIdentity?n.includeSphere(i.sphere):(q.transform(tB,i.sphere,a.matrix),n.includeSphere(tB))}n.finishedIncludeStep();for(let e=0,r=t.length;e<r;e++){let r=t[e],i=r.boundary,a=r.conformation.operator;a.isIdentity?n.radiusSphere(i.sphere):(q.transform(tB,i.sphere,a.matrix),n.radiusSphere(tB))}return{box:n.getBox(),sphere:n.getSphere()}}function aMe(e){let{units:t,elementCount:n,unitIndexMap:r}=e,i=new Uint32Array(t.length),a=new Uint32Array(n),o=new Uint32Array(n);for(let e=0,n=0,r=t.length;e<r;++e){i[e]=n;let{elements:r}=t[e];for(let t=0,i=r.length;t<i;++t){let i=n+t;a[i]=e,o[i]=r[t]}n+=r.length}return{cumulativeUnitElementCount:i,unitIndices:a,elementIndices:o,getSerialIndex:(e,t)=>i[r.get(e.id)]+K.indexOf(e.elements,t)}}function oMe(e){let t=0,n=[];for(let r of e.unitSymmetryGroups){n.push(t);let e=r.units[0];Q.isAtomic(e)&&(t+=e.bonds.edgeCount*2*r.units.length)}let r=new Uint32Array(t),i=new Uint32Array(t),a=new Uint32Array(t),o=0,s=0;for(let t of e.unitSymmetryGroups){let e=t.units[0];if(Q.isAtomic(e)){let n=e.bonds.edgeCount*2;for(let e=0,c=t.units.length;e<c;++e)for(let t=0,c=n;t<c;++t)r[o]=s,i[o]=t,a[o]=e,o+=1}s+=1}return{bondCount:t,unitIndex:r,unitEdgeIndex:i,unitGroupIndex:a,unitGroupOffset:n}}var nB=class e{subsetBuilder(e){return new Hje(this,e)}get elementCount(){return this.state.elementCount}get bondCount(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount/2+fR.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new FP),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=mMe(this)),this.state.polymerResidueCount}get polymerGapCount(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=hMe(this)),this.state.polymerGapCount}get polymerUnitCount(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=gMe(this)),this.state.polymerUnitCount}get uniqueElementCount(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=pMe(this)),this.state.uniqueElementCount}get atomicResidueCount(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=_Me(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(e=>DB.isCoarseGrained(e))}get isEmpty(){return this.units.length===0}get hashCode(){return this.state.hashCode===-1?this.computeHash():this.state.hashCode}get transformHash(){return this.state.transformHash===-1&&(this.state.transformHash=gE(this.units.map(e=>e.id))),this.state.transformHash}computeHash(){let e=23;for(let t=0,n=this.units.length;t<n;t++){let n=this.units[t];e=31*e+n.id|0,e=31*e+Vk.hashCode(n.elements)|0}return e=31*e+this.elementCount|0,e=uE(e),e===-1&&(e=0),this.state.hashCode=e,e}elementLocations(){return new e.ElementLocationIterator(this)}get root(){return this.state.parent??this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary||(this.state.boundary=iMe(this)),this.state.boundary}get lookup3d(){return this.state.lookup3d||(this.state.lookup3d=new Rke(this)),this.state.lookup3d}get interUnitBonds(){return this.state.interUnitBonds||(this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&this.parent.state.interUnitBonds.edgeCount===0?this.state.interUnitBonds=new jL(new Map):this.state.interUnitBonds=ZOe(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=Gz.computeTransformGroups(this)),this.state.unitSymmetryGroups}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=Q.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap}get carbohydrates(){return this.state.carbohydrates||(this.state.carbohydrates=$je(this)),this.state.carbohydrates}get models(){return this.state.models||(this.state.models=cMe(this)),this.state.models}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=lMe(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=uMe(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=dMe(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=fMe(this))}get isAtomic(){for(let e of this.units)if(!Q.isAtomic(e))return!1;return!0}get hasAtomic(){for(let e of this.units)if(Q.isAtomic(e))return!0;return!1}get isCoarse(){for(let e of this.units)if(!Q.isCoarse(e))return!1;return!0}get hasCoarse(){for(let e of this.units)if(Q.isCoarse(e))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=aMe(this))}get intraUnitBondMapping(){return this.state.intraUnitBondMapping||(this.state.intraUnitBondMapping=oMe(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;let e=this.models;if(e.length>1)throw Error(`The structure is based on multiple models and has neither a master- nor a representative-model.`);return this.state.model=e[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(e){return this.unitMap.has(e.unit.id)?Vk.has(this.unitMap.get(e.unit.id).elements,e.element):!1}getModelIndex(e){return this.models.indexOf(e)}remapModel(t){let{dynamicBonds:n,interUnitBonds:r,parent:i}=this.state,a=[];for(let e of this.unitSymmetryGroups){let r=e.units[0].remapModel(t,n);a.push(r);for(let i=1,o=e.units.length;i<o;++i){let o=e.units[i];a.push(o.remapModel(t,n,r.props))}}return e.create(a,{parent:i?.remapModel(t),label:this.label,interUnitBonds:n?void 0:r,dynamicBonds:n,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){let t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),n=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(n.units,n.unitMap,n.unitIndexMap,{...n.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){return this._target??this}constructor(e,t,n,r,i){this.units=e,this.unitMap=t,this.unitIndexMap=n,this.state=r,this._child=i?.child,this._target=i?.target,this._proxy=void 0}};function sMe(e,t,n){return e[t].id-e[n].id}function cMe(e){let{units:t}=e,n=CD.create();for(let e of t)CD.add(n,e.model.id,e.model);return n.array}function lMe(e){let{microheterogeneityCompIds:t}=Pz.residue,n=new Set,r=iL.create(e);for(let i of e.unitSymmetryGroups){let e=i.units[0];if(!Q.isAtomic(e))continue;let a=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(r.unit=e;a.hasNext;){let i=a.move();r.element=e.elements[i.start];let o=t(r);for(let e of o)n.add(e)}}return n}function uMe(e){let t=Pz.atom.type_symbol,n=new Set,r=iL.create(e);for(let i of e.unitSymmetryGroups){let e=i.units[0];if(Q.isAtomic(e)){r.unit=e;for(let i=0,a=e.elements.length;i<a;++i)r.element=e.elements[i],n.add(t(r))}}return n}function dMe(e){let{units:t}=e,n=iL.create(e),r=CD.create();for(let e of t){let t=e.kind===Q.Kind.Atomic?Pz.entity.key:Pz.coarse.entityKey;n.unit=e;let i=e.elements,a=uA.transientSegments(e.model.atomicHierarchy.chainAtomSegments,i);for(;a.hasNext;){n.element=i[a.move().start];let e=t(n);CD.add(r,e,e)}}return ZD(r.array),r.array}function fMe(e){let t=new Map,n=[],r=e.unitSymmetryGroups;for(let e of r){let r=e.units[0];if(!Q.isAtomic(r))continue;let i;t.has(r.model.id)?i=t.get(r.model.id):(i=CD.create(),n.push(r.model.id),t.set(r.model.id,i));let a=uA.transientSegments(r.model.atomicHierarchy.residueAtomSegments,r.elements);for(;a.hasNext;){let e=a.move();CD.add(i,e.index,e.index)}}let i=new Map;for(let e of n){let n=t.get(e).array;ZD(n),i.set(e,n)}return i}function pMe(e){let{unitSymmetryGroups:t}=e,n=0;for(let e=0,r=t.length;e<r;e++)n+=t[e].elements.length;return n}function mMe(e){let{units:t}=e,n=0;for(let e=0,r=t.length;e<r;e++)n+=t[e].polymerElements.length;return n}function hMe(e){let{units:t}=e,n=0;for(let e=0,r=t.length;e<r;e++)n+=t[e].gapElements.length/2;return n}function gMe(e){let{units:t}=e,n=0;for(let e=0,r=t.length;e<r;e++)t[e].polymerElements.length>0&&(n+=1);return n}function _Me(e){let{units:t}=e,n=0;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(!Q.isAtomic(r))continue;let{elements:i,residueIndex:a}=r,o=-1,s=-1;for(let e=0,t=i.length;e<t;++e)o=a[i[e]],o!==s&&(n+=1,s=o)}return n}(function(e){e.Empty=c([]);function t(e){return{kind:`structure-loci`,structure:e}}e.Loci=t;function n(e){let t=[];for(let n of e.units)t.push({unit:n,indices:G.ofBounds(0,n.elements.length)});return $(e,t)}e.toStructureElementLoci=n;function r(e,t){return VR.toLociWithSourceUnits(VR.Singletons(e,t))}e.toSubStructureElementLoci=r;function i(e){return!!e&&e.kind===`structure-loci`}e.isLoci=i;function a(e,t){return e.structure===t.structure}e.areLociEqual=a;function o(e){return e.structure.isEmpty}e.isLociEmpty=o;function s(e,n){return n===e.structure?e:t(n)}e.remapLoci=s;function c(t,n={}){let r=dA.Mutable(),i=dA.Mutable(),a=0,o=!0,s=t.length>0?t[0].id:0;for(let e=0,n=t.length;e<n;e++){let n=t[e];r.set(n.id,n),a+=n.elements.length,n.id<s&&(o=!1),s=n.id}o||Ahe(t,0,t.length,sMe,JD);for(let e=0,n=t.length;e<n;e++)i.set(t[e].id,e);let c={hashCode:-1,transformHash:-1,elementCount:a,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:tA.Default,label:``};return n.parent&&(c.parent=n.parent.parent||n.parent),n.interUnitBonds&&(c.interUnitBonds=n.interUnitBonds),n.interBondsValidUnit?c.interBondsValidUnit=n.interBondsValidUnit:n.parent&&(c.interBondsValidUnit=n.parent.interBondsValidUnit),n.interBondsValidUnitPair?c.interBondsValidUnitPair=n.interBondsValidUnitPair:n.parent&&(c.interBondsValidUnitPair=n.parent.interBondsValidUnitPair),n.dynamicBonds?c.dynamicBonds=n.dynamicBonds:n.parent&&(c.dynamicBonds=n.parent.dynamicBonds),n.coordinateSystem?c.coordinateSystem=n.coordinateSystem:n.parent&&(c.coordinateSystem=n.parent.coordinateSystem),n.label?c.label=n.label:n.parent&&(c.label=n.parent.label),n.masterModel?c.masterModel=n.masterModel:n.parent&&(c.masterModel=n.parent.masterModel),n.representativeModel?c.representativeModel=n.representativeModel:n.parent&&(c.representativeModel=n.parent.representativeModel),new e(t,r,i,c)}e.create=c;async function l(t,n){if(t.frameCount===0)return e.Empty;let r=[],i,a=0;for(let e=0,o=t.frameCount;e<o;++e){let o=await hb.resolveInContext(t.getFrameAtIndex(e),n);i||=o;let s=u(o);for(let e=0,t=s.units.length;e<t;++e){let t=s.units[e],n=t.invariantId+a,i=t.chainGroupId+a,o=Q.create(r.length,n,i,t.traits,t.kind,t.model,t.conformation.operator,t.elements);r.push(o)}a=r.length}return c(r,{representativeModel:i,label:i.label})}e.ofTrajectory=l;function u(e,t={}){let n=e.atomicHierarchy.chainAtomSegments,{index:r}=e.atomicHierarchy,{auth_asym_id:i}=e.atomicHierarchy.chains,{atomicChainOperatorMappinng:a}=e,o=new h({label:e.label,...t});for(let t=0;t<n.count;t++){let s=a.get(t)||tA.Default,c=n.offsets[t],l=!1,u=!1;if(d(e,t))for(u=!0;t+1<n.count&&d(e,t+1)&&a.get(t)===a.get(t+1);)l=!0,t++;else for(;t+1<n.count&&n.offsets[t+1]-n.offsets[t]===1&&n.offsets[t+2]-n.offsets[t+1]===1&&!(r.getEntityFromChain(t)!==r.getEntityFromChain(t+1)||i.value(t)!==i.value(t+1)||a.get(t)!==a.get(t+1));)l=!0,t++;let f=Vk.ofBounds(c,n.offsets[t+1]),p=Q.Trait.None;l&&(p|=Q.Trait.MultiChain),u&&(p|=Q.Trait.Water),DB.isCoarseGrained(e)&&(p|=Q.Trait.CoarseGrained),o.addUnit(Q.Kind.Atomic,e,s,f,p)}let s=e.coarseHierarchy;return s.isDefined&&(s.spheres.count>0&&f(o,e,e.coarseHierarchy.spheres,Q.Kind.Spheres),s.gaussians.count>0&&f(o,e,e.coarseHierarchy.gaussians,Q.Kind.Gaussians)),o.getStructure()}e.ofModel=u;function d(e,t){let n=e.atomicHierarchy.index.getEntityFromChain(t);return e.entities.data.type.value(n)===`water`}function f(e,t,n,r){let{chainElementSegments:i}=n;for(let n=0;n<i.count;n++){let a=Vk.ofBounds(i.offsets[n],i.offsets[n+1]);e.addUnit(r,t,tA.Default,a,Q.Trait.None)}}function p(e,t){if(z.isIdentity(t))return e;if(!z.isRotationAndTranslation(t,tA.RotationTranslationEpsilon))throw Error(`Only rotation/translation combination can be applied.`);let n=[];for(let r of e.units){let e=r.conformation.operator,i=tA.create(e.name,t,e);n.push(r.applyOperator(r.id,i))}let r=e.coordinateSystem;return c(n,{parent:e,coordinateSystem:tA.compose(tA.create(r.name,t,r),r)})}e.transform=p;function m(e,t){for(let e of t)if(!z.isRotationAndTranslation(e,tA.RotationTranslationEpsilon))throw Error(`Only rotation/translation combination can be applied.`);let n=[],r=0;for(let i of e.units){let e=i.conformation.operator;for(let a of t){if(z.isIdentity(a)){n.push(i);continue}let t=tA.create(e.name,a,e);n.push(i.applyOperator(r++,t))}}return c(n,{parent:e})}e.instances=m;class h{beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(e,t,n,r,i,a){a===void 0&&(a=this.invariantId());let o=this.inChainGroup?this.chainGroupId:++this.chainGroupId,s=Q.create(this.units.length,a,o,i,e,t,n,r);return this.add(s)}copyUnit(e,t){let n=t?.invariantId;n===void 0&&(n=this.invariantId());let r=this.inChainGroup?this.chainGroupId:++this.chainGroupId,i=e.getCopy(this.units.length,n,r,t);return this.add(i)}add(e){if(e.elements.length===1){e.conformation.position(e.elements[0],this.p);let t=[e.invariantId,this.p[0],this.p[1],this.p[2]].join(`|`);if(this.singleElementUnits.has(t))return this.singleElementUnits.get(t);this.singleElementUnits.set(t,e)}return this.units.push(e),e}addWithOperator(e,t,n=!1){return this.add(e.applyOperator(this.units.length,t,n))}getStructure(){return c(this.units,this.props)}get isEmpty(){return this.units.length===0}constructor(e={}){this.props=e,this.units=[],this.invariantId=mb(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=B(),this.singleElementUnits=new Map}}e.StructureBuilder=h;function g(e={}){return new h(e)}e.Builder=g;function _(e){return e.hashCode}e.hashCode=_;function v(e){return fE(e.units.map(e=>Q.conformationId(e)).join(`|`))}e.conformationHash=v;function y(e,t){if(e===t)return!0;if(e.elementCount!==t.elementCount)return!1;let n=e.units.length;if(n!==t.units.length)return!1;for(let r=0;r<n;r++)if(e.units[r].id!==t.units[r].id)return!1;return!0}e.areUnitIdsEqual=y;function b(e,t){if(e===t)return!0;if(!y(e,t))return!1;for(let n=0,r=e.units.length;n<r;n++)if(!Vk.areEqual(e.units[n].elements,t.units[n].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=b;function x(e,t){if(e.hashCode!==t.hashCode)return!1;let n=e.models.length;if(n!==t.models.length)return!1;for(let r=0;r<n;r++)if(!DB.areHierarchiesEqual(e.models[r],t.models[r]))return!1;return!0}e.areHierarchiesEqual=x;function S(e,t){return e===t||e.hashCode===t.hashCode&&Gz.areTransformGroupsEquivalent(e.unitSymmetryGroups,t.unitSymmetryGroups)}e.areEquivalent=S;function C(e,t){return S(e.root,t.root)}e.areRootsEquivalent=C;function w(e,t){return e.root===t.root}e.areRootsEqual=w;class T{move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)}constructor(e){this.structure=e,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=iL.create(e),this.hasNext=e.elementCount>0,this.hasNext&&(this.elements=e.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=e.units[0])}}e.ElementLocationIterator=T;let E=B();function D(e,t,n){let{elements:r,conformation:i}=e,a=E,o=Number.MAX_VALUE;for(let e=0,s=r.length;e<s;e++){let s=r[e],c=B.distance(t,i.position(s,a))-n-i.r(s);c<o&&(o=c)}return o}function O(e,t,n){let{units:r}=e,i=Number.MAX_VALUE;for(let e=0,a=r.length;e<a;e++){let a=r[e],o=D(a,t,n);o<i&&(i=o)}return i}e.minDistanceToPoint=O;let k=B();function A(e,t){if(e.elementCount===0||t.elementCount===0)return 0;let{units:n}=e,r=Number.MAX_VALUE;for(let e=0,i=n.length;e<i;e++){let{elements:i,conformation:a}=n[e];for(let e=0,n=i.length;e<n;e++){let n=i[e],o=O(t,a.position(n,k),a.r(n));o<r&&(r=o)}}return r}e.distance=A;function j(e){return e.elementCount===1?`1 element`:`${e.elementCount} elements`}e.elementDescription=j;function M(e,t,n){return e.masterModel?t.model===n.model||t.model===e.masterModel||n.model===e.masterModel:t.model===n.model}e.validUnitPair=M;function N(e,t,n){let{maxRadius:r,validUnit:i,validUnitPair:a}=n;if(!e.units.some(e=>i(e)))return;let o=e.lookup3d,s=B();for(let n of e.units){if(!i(n))continue;let c=n.boundary.sphere;B.transformMat4(s,c.center,n.conformation.operator.matrix);let l=o.findUnitIndices(s[0],s[1],s[2],c.radius+r);for(let r=0;r<l.count;r++){let o=e.units[l.indices[r]];n.id>=o.id||!i(o)||!a(n,o)||(o.elements.length>=n.elements.length?t(n,o):t(o,n))}}}e.eachUnitPair=N;function ee(e,{chain:t,residue:n,atom:r}){let i=iL.create(e);for(let a of e.units){if(a.kind!==Q.Kind.Atomic)continue;i.unit=a;let{elements:e}=a,o=uA.transientSegments(a.model.atomicHierarchy.chainAtomSegments,e),s=uA.transientSegments(a.model.atomicHierarchy.residueAtomSegments,e);for(;o.hasNext;){let a=o.move();if(t&&(i.element=e[a.start],t(i)),!(!n&&!r))for(s.setSegment(a);s.hasNext;){let t=s.move();if(n&&(i.element=e[t.start],n(i)),r)for(let n=t.start,a=t.end;n<a;n++)i.element=e[n],r(i)}}}}e.eachAtomicHierarchyElement=ee,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function te(e){return e.unitSymmetryGroups.filter(e=>e.units[0].polymerElements.length>0)}function P(e,t){let n=te(e);return n.length===1&&n[0].units.length>2&&n[0].units[0].polymerElements.length<t.fiberResidueCount}function ne(e,t){let n=te(e);return n.length>=1&&n[0].units.length>t.highSymmetryUnitCount}let re;(function(e){e[e.Small=0]=`Small`,e[e.Medium=1]=`Medium`,e[e.Large=2]=`Large`,e[e.Huge=3]=`Huge`,e[e.Gigantic=4]=`Gigantic`})(re=e.Size||={});function ie(t,n={},r=1){let i={...e.DefaultSizeThresholds,...n};return t.polymerResidueCount>=i.largeResidueCount*r?ne(t,i)?re.Huge:re.Gigantic:P(t,i)||t.polymerResidueCount<i.smallResidueCount*r?re.Small:t.polymerResidueCount<i.mediumResidueCount*r?re.Medium:re.Large}e.getSize=ie,e.Index=_z.createSimple(`index`,`root`),e.MaxIndex=_z.createSimple(`max_index`,`root`);let ae=`__PrincipalAxes__`;function oe(t){if(t.currentPropertyData[ae])return t.currentPropertyData[ae];let n=$.getPrincipalAxes(e.toStructureElementLoci(t));return t.currentPropertyData[ae]=n,n}e.getPrincipalAxes=oe})(nB||={});const rB=new class{constructor(){this.map=new Map}removeSymbol(e){this.map.delete(e.symbol.id)}addSymbol(e){this.map.has(e.symbol.id)&&console.warn(`Symbol '${e.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(e.symbol.id,e)}addCustomProp(e){if(e.symbols)for(let t of Object.keys(e.symbols))this.addSymbol(e.symbols[t])}removeCustomProp(e){if(e.symbols)for(let t of Object.keys(e.symbols))this.removeSymbol(e.symbols[t])}getRuntime(e){return this.map.get(e)}};var vMe=class{constructor(e){this.table=e,this.constQueryContext=new ZR(nB.Empty)}},yMe;(function(e){function t(e){return{kind:`const`,value:e}}e.Const=t;function n(e){return{kind:`dynamic`,runtime:e}}e.Dynamic=n})(yMe||={});var iB;(function(e){function t(e){return{isConst:!0,fn:function(t){return e}}}e.Const=t;function n(e){return{isConst:!1,fn:e}}e.Dynamic=n})(iB||={});var aB;(function(e){function t(e,t,n,r){if(typeof e.length==`number`)for(let i=0,a=e.length;i<a;i++)n(e[i](t),i,r);else{let i=0;for(let a of Object.keys(e))n(e[a](t),i++,r)}return r}e.forEachEval=t})(aB||={});var oB;(function(e){function t(e,t){return new sB(e,t,!0)}e.Const=t;function n(e,t){return new sB(e,t,!1)}e.Dynamic=n})(oB||={});var sB=class{compile(e,t){let n,r=!1;if(!t)n=void 0,r=!0;else if(cL.isArgumentsArray(t)){n=[],r=!0;for(let i of t){let t=cB(e,i);r&&=t.isConst,n.push(t.fn)}}else{n=Object.create(null),r=!0;for(let i of Object.keys(t)){let a=cB(e,t[i]);r&&=a.isConst,n[i]=a.fn}}return this.isConst&&this.isConst&&r?iB.Const(this.fn(e.constQueryContext,n)):iB.Dynamic(bMe(this.fn,n))}constructor(e,t,n){this.symbol=e,this.fn=t,this.isConst=n}};function bMe(e,t){return function(n){return e(n,t)}}function cB(e,t){if(cL.isLiteral(t))return iB.Const(t);if(cL.isSymbol(t)){let n=e.table.getRuntime(t.name);return n?n.compile(e):iB.Const(t.name)}if(!cL.isSymbol(t.head))throw Error(`Can only apply symbols.`);let n=e.table.getRuntime(t.head.name);if(!n)throw Error(`Symbol '${t.head.name}' is not implemented.`);return n.compile(e,t.args)}function lB(e){return cB(new vMe(rB),e).fn}var xMe=Tk.diff;function $(e,t){return{kind:`element-loci`,structure:e,elements:t}}(function(e){function t(e){return!!e&&e.kind===`element-loci`}e.is=t;function n(e,t){if(e.structure!==t.structure||e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n){let r=e.elements[n],i=t.elements[n];if(r.unit.id!==i.unit.id||!K.areEqual(r.indices,i.indices))return!1}return!0}e.areEqual=n;function r(e){for(let t of e.elements)if(K.size(t.indices)>0)return!1;return!0}e.isEmpty=r;function i(e){return a(e)===e.structure.elementCount}e.isWholeStructure=i;function a(e){let t=0;for(let{indices:n}of e.elements)typeof n==`number`?t+=xMe(n):t+=n.length;return t}e.size=a;function o(t){return e(t,t.units.map(e=>({unit:e,indices:K.ofBounds(0,e.elements.length)})))}e.all=o;function s(t){return e(t,[])}e.none=s;function c(e,t,n){let r;r=typeof t==`function`?t(Z):t;let i=lB(r)(n??new ZR(e));return VR.toLociWithSourceUnits(i)}e.fromExpression=c;function l(e,t,n){let r=t(n??new ZR(e));return VR.toLociWithSourceUnits(r)}e.fromQuery=l;function u(e,t,n){return KR.toLoci(e,t,n)}e.fromSchema=u;function d(e,t){if(r(e))return;let n=e.elements[0].unit,i=n.elements[K.getAt(e.elements[0].indices,0)];return t?(t.structure=e.structure,t.unit=e.elements[0].unit,t.element=i,t):iL.create(e.structure,n,i)}e.getFirstLocation=d;function f(t){return r(t)?t:e(t.structure,[{unit:t.elements[0].unit,indices:K.ofSingleton(K.start(t.elements[0].indices))}])}e.firstElement=f;function p(e){return r(e)?e:w(f(e))}e.firstResidue=p;function m(e){return r(e)?e:k(f(e))}e.firstChain=m;function h(e){let t=[];for(let n of e.elements){let{unit:e,indices:r}=n,i=new Int32Array(K.size(r));K.forEach(r,(t,n)=>i[n]=e.elements[t]),t.push(e.getChild(Vk.ofSortedArray(i)))}return nB.create(t,{parent:e.structure.parent})}e.toStructure=h;function g(t,n,r){if(e.isEmpty(t))return;let i=r||iL.create(t.structure);i.structure=t.structure;for(let e of t.elements){let{unit:t,indices:r}=e;i.unit=t;let{elements:a}=e.unit;for(let e=0,t=K.size(r);e<t;e++)i.element=a[K.getAt(r,e)],n(i)}}e.forEachLocation=g;function _(t,n){if(n===t.structure)return t;let r=[];return t.elements.forEach(e=>{if(!n.unitMap.has(e.unit.id))return;let t=n.unitMap.get(e.unit.id),i=K.indexedIntersect(e.indices,e.unit.elements,t.elements);K.size(i)>0&&r.push({unit:t,indices:i})}),e(n,r)}e.remap=_;function v(t,n){if(t.elements.length>n.elements.length)return v(n,t);if(e.isEmpty(t))return n;let r=new Map;for(let e of t.elements)r.set(e.unit.id,e.indices);let i=[];for(let e of n.elements)r.has(e.unit.id)?(i[i.length]={unit:e.unit,indices:K.union(r.get(e.unit.id),e.indices)},r.delete(e.unit.id)):i[i.length]=e;return r.forEach((e,n)=>{i[i.length]={unit:t.structure.unitMap.get(n),indices:e}}),e(t.structure,i)}e.union=v;function y(t,n){let r=new Map;for(let e of n.elements)r.set(e.unit.id,e.indices);let i=[];for(let e of t.elements)if(r.has(e.unit.id)){let t=K.subtract(e.indices,r.get(e.unit.id));if(K.size(t)===0)continue;i[i.length]={unit:e.unit,indices:t}}else i[i.length]=e;return e(t.structure,i)}e.subtract=y;function b(t,n){let r=new Map;for(let e of t.elements)r.set(e.unit.id,e.indices);let i=[];for(let e of n.elements){if(!r.has(e.unit.id))continue;let t=K.intersect(r.get(e.unit.id),e.indices);K.size(t)!==0&&(i[i.length]={unit:e.unit,indices:t})}return e(t.structure,i)}e.intersect=b;function x(t,n){if(t.elements.length>n.elements.length)return x(n,t);if(e.isEmpty(t))return e.isEmpty(n);let r=new Map;for(let e of t.elements)r.set(e.unit.id,e.indices);for(let e of n.elements)if(r.has(e.unit.id)&&K.areIntersecting(r.get(e.unit.id),e.indices))return!0;return!1}e.areIntersecting=x;function S(t,n){if(e.isEmpty(t))return e.isEmpty(n);let r=new Map;for(let e of t.elements)r.set(e.unit.id,e.indices);let i=!1;for(let e of n.elements){if(!r.has(e.unit.id))return!1;if(K.isSubset(r.get(e.unit.id),e.indices))i=!0;else return!1}return i}e.isSubset=S;function C(e){return e.length>3&&Vk.isRange(e)?G.ofRange(e[0],e[e.length-1]):Vk.ofSortedArray(e)}function w(t,n){let r=[],i=new Set;for(let e of t.elements){if(E(e)){r[r.length]=e;continue}if(e.unit.kind===Q.Kind.Atomic){let t=e.unit.elements,a=e.unit.model.atomicHierarchy,{label_alt_id:o}=e.unit.model.atomicHierarchy.atoms,{index:s,offsets:c}=a.residueAtomSegments,l=[],u=e.indices,d=K.size(u),f=0;for(;f<d;){i.clear();let e=t[K.getAt(u,f)],r=s[e];for(i.add(o.value(e)),f++;f<d;){let e=t[K.getAt(u,f)];if(s[e]!==r)break;i.add(o.value(e)),f++}let a=i.has(``);for(let e=c[r],s=c[r+1];e<s;e++){let r=K.indexOf(t,e);if(r>=0){let t=o.value(e);(!n||a||!t||i.has(t))&&(l[l.length]=r)}}}r[r.length]={unit:e.unit,indices:C(l)}}else r[r.length]=e}return e(t.structure,r)}e.extendToWholeResidues=w;function T(e){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicHierarchy.chainAtomSegments;case Q.Kind.Spheres:return e.model.coarseHierarchy.spheres.chainElementSegments;case Q.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.chainElementSegments}}function E(e){return e.unit.elements.length===K.size(e.indices)}function D(e,t,n){let{index:r}=T(e),i=e.elements,a=0;for(let e=0,n=i.length;e<n;e++){let n=r[i[e]];t.has(n)&&a++}if(a===e.elements.length){n[n.length]={unit:e,indices:G.ofBounds(0,a)};return}let o=new Int32Array(a);a=0;for(let e=0,n=i.length;e<n;e++){let n=r[i[e]];t.has(n)&&(o[a++]=e)}o.length>0&&(n[n.length]={unit:e,indices:C(o)})}function O(e,t,n,r,i){let{index:a}=T(e.elements[0].unit),o=new Set;for(let r=t;r<n;r++){let t=e.elements[r],n=t.indices,i=t.unit.elements;for(let e=0,t=K.size(n);e<t;e++)o.add(a[i[K.getAt(n,e)]])}if(r){let t=e.elements[0].unit;for(let n of e.structure.units)Q.areSameChainOperatorGroup(n,t)&&D(n,o,i)}else for(let r=t;r<n;r++)D(e.elements[r].unit,o,i)}function k(t){let n=[];for(let e=0,r=t.elements.length;e<r;e++){let i=t.elements[e];if(Q.Traits.is(i.unit.traits,Q.Trait.Partitioned)){let a=e;for(;e<r&&Q.areSameChainOperatorGroup(t.elements[e].unit,i.unit);)e++;let o=e;e--,O(t,a,o,!0,n)}else E(i)?n[n.length]=i:O(t,e,e+1,!1,n)}return e(t.structure,n)}e.extendToWholeChains=k;function A(e){return`${e.unit.model.id}|${Pz.entity.id(e)}`}function j(t){let n=[],r=iL.create(t.structure),i=new Set,{units:a}=t.structure;for(let e=0,n=t.elements.length;e<n;e++){let n=t.elements[e];r.unit=n.unit,r.element=n.unit.elements[0],i.add(A(r))}for(let e=0,t=a.length;e<t;++e){let t=a[e];if(r.unit=t,r.element=t.elements[0],i.has(A(r))){let e=K.ofBounds(0,t.elements.length);n[n.length]={unit:t,indices:e}}}return e(t.structure,n)}e.extendToWholeEntities=j;function M(t){let n=[],r=new Set,{units:i}=t.structure;for(let e=0,n=t.elements.length;e<n;e++){let n=t.elements[e];r.add(n.unit.model.id)}for(let e=0,t=i.length;e<t;++e){let t=i[e];if(r.has(t.model.id)){let e=K.ofBounds(0,t.elements.length);n[n.length]={unit:t,indices:e}}}return e(t.structure,n)}e.extendToWholeModels=M;function N(e,t){let n=[];for(let r=0,i=K.size(t);r<i;++r)n.push(e[K.getAt(t,r)]);return Vk.ofSortedArray(n)}function ee(e,t){return Vk.isRange(e)&&Vk.areEqual(e,t)?G.ofLength(e.length):C(Vk.indicesOf(e,t))}function te(t){let n=[],r=new Map;for(let e=0,n=t.elements.length;e<n;e++){let n=t.elements[e],{model:i}=n.unit,a=N(n.unit.elements,n.indices);r.has(i)?r.set(i,Vk.union(a,r.get(i))):r.set(i,a)}for(let e=0,i=t.structure.units.length;e<i;++e){let i=t.structure.units[e],a=r.get(i.model);if(!a)continue;let o=ee(i.elements,a);K.size(o)&&(n[n.length]={unit:i,indices:o})}return e(t.structure,n)}e.extendToAllInstances=te;function P(t){let n=[],r=new Set,{units:i}=t.structure;for(let e=0,n=t.elements.length;e<n;e++){let n=t.elements[e];r.add(n.unit.conformation.operator.name)}for(let e=0,t=i.length;e<t;++e){let t=i[e];if(r.has(t.conformation.operator.name)){let e=K.ofBounds(0,t.elements.length);n[n.length]={unit:t,indices:e}}}return e(t.structure,n)}e.extendToWholeOperators=P;let ne=new RA(`98`),re=B();function ie(e,t,n){ne.reset();for(let n of e.elements){let{indices:e}=n,{elements:r,conformation:i}=n.unit;for(let n=0,a=K.size(e);n<a;n++){let a=r[K.getAt(e,n)];i.position(a,re),t&&B.transformMat4(re,re,t),ne.includePositionRadius(re,i.r(a))}}ne.finishedIncludeStep();for(let n of e.elements){let{indices:e}=n,{elements:r,conformation:i}=n.unit;for(let n=0,a=K.size(e);n<a;n++){let a=r[K.getAt(e,n)];i.position(a,re),t&&B.transformMat4(re,re,t),ne.radiusPositionRadius(re,i.r(a))}}return n?(n.box&&ne.getBox(n.box),n.sphere&&ne.getSphere(n.sphere),n):{box:ne.getBox(),sphere:ne.getSphere()}}e.getBoundary=ie;let ae=B();function oe(e,t,n=0){let r=n;for(let n of e.elements){let{indices:e}=n,{elements:i,conformation:a}=n.unit,o=K.size(e);for(let n=0;n<o;n++){let o=i[K.getAt(e,n)];a.position(o,ae),B.toArray(ae,t,r+n*3)}r+=o*3}return t}e.toPositionsArray=oe;function se(e){let t=a(e),n=oe(e,new Float32Array(3*t));return Qk.ofPositions(n)}e.getPrincipalAxes=se;function ce(e){let t=0;e.forEach(e=>{t+=a(e)});let n=new Float32Array(3*t),r=0;return e.forEach(e=>{oe(e,n,r),r+=a(e)*3}),Qk.ofPositions(n)}e.getPrincipalAxesMany=ce;function le(e,t){return Q.isAtomic(e)?e.model.atomicHierarchy.atomSourceIndex.value(t):t}function ue(t){if(e.isEmpty(t))return Z.struct.generator.empty();let n=t.structure.models,r=new Map;for(let e of t.elements){let{indices:t}=e,{elements:n}=e.unit,i=e.unit.conformation.operator.name,a;r.has(i)?a=r.get(i).xs:(a=CD.create(),r.set(i,{modelLabel:e.unit.model.label,modelIndex:e.unit.model.modelNum,xs:a}));for(let r=0,i=K.size(t);r<i;r++){let i=le(e.unit,n[K.getAt(t,r)]);CD.add(a,i,i)}}let i=[],a=r.keys();for(;;){let e=a.next();if(e.done)break;let t=r.get(e.value);i.push(de(e.value,t.xs.array,n.length>1,t.modelLabel,t.modelIndex))}let o=new Map;for(let e=0,t=i.length;e<t;++e){let t=i[e],n=`${dE(gE(t.atom.ranges),gE(t.atom.set))}|${t.entity?t.entity.modelLabel+t.entity.modelIndex:``}`;o.has(n)?o.get(n).chain.opName.push(...t.chain.opName):o.set(n,t)}let s=[];return o.forEach(e=>{let{ranges:t,set:n}=e.atom,{opName:r}=e.chain,i=Z.struct.atomProperty.core.operatorName(),a=Z.struct.atomProperty.core.sourceIndex(),o=[];n.length>0&&(o[o.length]=Z.core.set.has([Z.core.type.set(n),a]));for(let e=0,n=t.length/2;e<n;e++)o[o.length]=Z.core.rel.inRange([a,t[2*e],t[2*e+1]]);if(e.entity){let{modelLabel:t,modelIndex:n}=e.entity;s.push(Z.struct.generator.atomGroups({"atom-test":o.length>1?Z.core.logic.or(o):o[0],"chain-test":r.length>1?Z.core.set.has([Z.core.type.set(r),i]):Z.core.rel.eq([i,r[0]]),"entity-test":Z.core.logic.and([Z.core.rel.eq([Z.struct.atomProperty.core.modelLabel(),t]),Z.core.rel.eq([Z.struct.atomProperty.core.modelIndex(),n])])}))}else s.push(Z.struct.generator.atomGroups({"atom-test":o.length>1?Z.core.logic.or(o):o[0],"chain-test":r.length>1?Z.core.set.has([Z.core.type.set(r),i]):Z.core.rel.eq([i,r[0]])}))}),Z.struct.modifier.union([s.length===1?s[0]:Z.struct.combinator.merge(s.map(e=>Z.struct.modifier.union([e])))])}e.toExpression=ue;function de(e,t,n,r,i){ZD(t);let a=[],o=[],s=0,c=t.length;for(;s<c;){let e=s;for(s++;s<c&&t[s-1]+1===t[s];)s++;let n=s;if(n-e>12)a[a.length]=t[e],a[a.length]=t[n-1];else for(let r=e;r<n;r++)o[o.length]=t[r]}return n?{atom:{set:o,ranges:a},chain:{opName:[e]},entity:{modelLabel:r,modelIndex:i}}:{atom:{set:o,ranges:a},chain:{opName:[e]}}}})($||={});var uB;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:iL.create(void 0),firstConformationLoc:iL.create(void 0),firstResidueLoc:iL.create(void 0),firstChainLoc:iL.create(void 0),firstUnitLoc:iL.create(void 0),firstStructureLoc:iL.create(void 0)}}e.create=t;function n(e,t,n){let r=e.get(t)||0;e.set(t,r+n)}function r(e,t,r){let{indices:i,unit:a}=r,{elements:o}=a,s=K.size(i),c=new Map,l=new Map;if(s>0&&iL.set(e.firstElementLoc,t,a,o[K.start(i)]),s===o.length)e.unitCount+=1,e.unitCount===1&&iL.set(e.firstUnitLoc,t,a,o[K.start(i)]);else if(s===1){if(Q.Traits.is(a.traits,Q.Trait.MultiChain))return;e.elementCount+=1,e.elementCount===1&&iL.set(e.firstElementLoc,t,a,o[K.start(i)])}else if(Q.isAtomic(a)){let{index:r,offsets:u}=a.model.atomicHierarchy.residueAtomSegments,{label_alt_id:d}=a.model.atomicHierarchy.atoms,f=0;for(;f<s;){c.clear();let p=0,m=o[K.getAt(i,f)],h=r[m];for(n(c,d.value(m),1),++f,++p;f<s;){let e=o[K.getAt(i,f)];if(r[e]!==h)break;n(c,d.value(e),1),++f,++p}if(u[h+1]-u[h]===p)e.residueCount+=1,e.residueCount===1&&iL.set(e.firstResidueLoc,t,a,u[h]);else{l.clear();for(let e=u[h],t=u[h+1];e<t;++e)n(l,d.value(e),1);l.get(``)===c.get(``)&&c.forEach((n,r)=>{if(l.get(r)===n){if(r!==``&&(e.conformationCount+=1,e.conformationCount===1)){for(let n=u[h],i=u[h+1];n<i;++n)if(r===d.value(n)){iL.set(e.firstConformationLoc,t,a,n);break}}p-=n}}),e.elementCount+=p}}}else e.elementCount+=s,e.elementCount===1&&iL.set(e.firstElementLoc,t,a,o[K.start(i)])}function i(e,t,n){let{indices:r,unit:i}=n,a=K.size(r);if(a===0)return;let{elements:o}=i;if(!Q.Traits.is(i.traits,Q.Trait.MultiChain)){a===o.length&&(e.chainCount+=1,e.chainCount===1&&iL.set(e.firstChainLoc,t,i,o[K.start(r)]));return}let s=Q.isAtomic(i)?i.model.atomicHierarchy.chainAtomSegments:Q.isSpheres(i)?i.model.coarseHierarchy.spheres.chainElementSegments:Q.isGaussians(i)?i.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!s){console.warn(`StructureElement loci stats: unknown unit type`);return}let{index:c,offsets:l}=s,u=0;for(;u<a;){let n=0,s=o[K.getAt(r,u)],d=c[s];for(++u,++n;u<a&&c[o[K.getAt(r,u)]]===d;)++u,++n;l[d+1]-l[d]===n?(e.chainCount+=1,e.chainCount===1&&iL.set(e.firstChainLoc,t,i,l[d])):a===1&&(e.elementCount+=1,e.elementCount===1&&iL.set(e.firstElementLoc,t,i,s))}}function a(e,t,r,i,a){let o=r[i],s=Q.isAtomic(o.unit)?o.unit.model.atomicHierarchy.chainAtomSegments:Q.isSpheres(o.unit)?o.unit.model.coarseHierarchy.spheres.chainElementSegments:Q.isGaussians(o.unit)?o.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!s){console.warn(`StructureElement loci stats: unknown unit type`);return}let{index:c,offsets:l}=s,u=new Map;for(let e=i;e<a;e++){o=r[e];let{indices:t,unit:i}=o,a=K.size(t);if(a===0)continue;let{elements:s}=i;if(!Q.Traits.is(i.traits,Q.Trait.MultiChain)){let e=s[K.start(t)];n(u,c[e],s.length);continue}let l=0;for(;l<a;){let e=0,r=c[s[K.getAt(t,l)]];for(++l,++e;l<a&&c[s[K.getAt(t,l)]]===r;)++l,++e;n(u,r,e)}}let d=-1;if(u.forEach((t,n)=>{l[n+1]-l[n]===t&&(e.chainCount+=1,e.chainCount===1&&(d=n))}),!(d<0))for(let n=i;n<a;n++){o=r[n];let{indices:i,unit:a}=o,s=K.size(i);if(s===0)continue;let{elements:l}=a;for(;0<s;){let n=l[K.getAt(i,0)];if(c[n]===d){iL.set(e.firstChainLoc,t,a,n);return}}}}function o(e){let n=t();if($.isEmpty(e))return n;let o=!1;if($.isWholeStructure(e)){if(n.structureCount+=1,n.structureCount===1){let{unit:t,indices:r}=e.elements[0];iL.set(n.firstStructureLoc,e.structure,t,t.elements[K.min(r)])}}else for(let t of e.elements)r(n,e.structure,t),Q.Traits.is(t.unit.traits,Q.Trait.Partitioned)?o=!0:i(n,e.structure,t);if(o)for(let t=0,r=e.elements.length;t<r;t++){let o=e.elements[t];if(!Q.Traits.is(o.unit.traits,Q.Trait.Partitioned))continue;let s=t;for(;t<r&&Q.areSameChainOperatorGroup(e.elements[t].unit,o.unit);)t++;let c=t;t--,c-s===1?i(n,e.structure,o):a(n,e.structure,e.elements,s,c)}return n}e.ofLoci=o;function s(e,t,n){return t.elementCount===1&&n.elementCount===0?iL.copy(e.firstElementLoc,t.firstElementLoc):t.elementCount===0&&n.elementCount===1&&iL.copy(e.firstElementLoc,n.firstElementLoc),t.conformationCount===1&&n.conformationCount===0?iL.copy(e.firstConformationLoc,t.firstConformationLoc):t.conformationCount===0&&n.conformationCount===1&&iL.copy(e.firstConformationLoc,n.firstConformationLoc),t.residueCount===1&&n.residueCount===0?iL.copy(e.firstResidueLoc,t.firstResidueLoc):t.residueCount===0&&n.residueCount===1&&iL.copy(e.firstResidueLoc,n.firstResidueLoc),t.chainCount===1&&n.chainCount===0?iL.copy(e.firstChainLoc,t.firstChainLoc):t.chainCount===0&&n.chainCount===1&&iL.copy(e.firstChainLoc,n.firstChainLoc),t.unitCount===1&&n.unitCount===0?iL.copy(e.firstUnitLoc,t.firstUnitLoc):t.unitCount===0&&n.unitCount===1&&iL.copy(e.firstUnitLoc,n.firstUnitLoc),t.structureCount===1&&n.structureCount===0?iL.copy(e.firstStructureLoc,t.firstStructureLoc):t.structureCount===0&&n.structureCount===1&&iL.copy(e.firstStructureLoc,n.firstStructureLoc),e.elementCount=t.elementCount+n.elementCount,e.conformationCount=t.conformationCount+n.conformationCount,e.residueCount=t.residueCount+n.residueCount,e.chainCount=t.chainCount+n.chainCount,e.unitCount=t.unitCount+n.unitCount,e.structureCount=t.structureCount+n.structureCount,e}e.add=s})(uB||={});function SMe(e){return Q.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function CMe(e){return Q.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function wMe(e){return Pz.entity.key(e)}var dB;(function(e){function t(e){let t=e.descriptor.name,n=e.type===`static`?`_staticPropertyData`:`_dynamicPropertyData`,r=r=>(t in r[n]||(r[n][t]={props:{...V.getDefaultValues(e.getParams(r))},data:bx.create(void 0)}),r[n][t]),i=(e,i,a)=>{let o=r(e);e[n][t]={props:i,data:bx.withValue(o.data,a)}};return{label:e.label,descriptor:e.descriptor,isHidden:e.isHidden,getParams:t=>{let n=V.clone(e.getParams(t));return V.setDefaultValues(n,r(t).props),n},defaultParams:e.defaultParams,isApplicable:e.isApplicable,attach:async(t,n,a={},o)=>{o&&n.customProperties.reference(e.descriptor,!0);let s=r(n),c=V.merge(e.defaultParams,s.props,a);if(s.data.value&&V.areEqual(e.defaultParams,s.props,c))return;let{value:l,assets:u}=await e.obtain(t,n,c);n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,u),i(n,c,l)},ref:(t,n)=>t.customProperties.reference(e.descriptor,n),get:e=>r(e)?.data,set:(t,n={},a)=>{let o=r(t),s=V.merge(e.defaultParams,o.props,n);V.areEqual(e.defaultParams,o.props,s)||(i(t,s,a),t.customProperties.assets(e.descriptor))},props:e=>r(e).props}}e.createProvider=t;function n(e,n,r){let i={value:V.Value(r,{isHidden:!0})};return t({label:JT(e),descriptor:PP({name:e}),isHidden:!0,type:n,defaultParams:i,getParams:()=>({value:V.Value(r,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(e,t,n)=>({...V.getDefaultValues(i),...n})})}e.createSimple=n})(dB||={});var fB;(function(e){e.Provider=dB.createProvider({label:`SIFTS Mapping`,descriptor:PP({name:`sifts_sequence_mapping`}),type:`static`,defaultParams:{},getParams:()=>({}),isApplicable:e=>t(e),obtain:async(e,t)=>({value:i(t)})});function t(e){if(!CB.is(e.sourceData))return!1;let{pdbx_sifts_xref_db_name:t,pdbx_sifts_xref_db_acc:n,pdbx_sifts_xref_db_num:r,pdbx_sifts_xref_db_res:i}=e.sourceData.data.db.atom_site;return t.isDefined&&n.isDefined&&r.isDefined&&i.isDefined}e.isAvailable=t;function n(t){let n=t.unit.model,r=e.Provider.get(n).value;if(!r)return``;let i=n.atomicHierarchy.residueAtomSegments.index[t.element];return r.accession[i]}e.getKey=n;function r(t){let n=t.unit.model,r=e.Provider.get(n).value;if(!r)return;let i=n.atomicHierarchy.residueAtomSegments.index[t.element],a=r.dbName[i];if(a)return`${a} ${r.accession[i]} ${r.num[i]} ${r.residue[i]}`}e.getLabel=r;function i(e){if(!CB.is(e.sourceData))return;let{pdbx_sifts_xref_db_name:t,pdbx_sifts_xref_db_acc:n,pdbx_sifts_xref_db_num:r,pdbx_sifts_xref_db_res:i}=e.sourceData.data.db.atom_site;if(!t.isDefined||!n.isDefined||!r.isDefined||!i.isDefined)return;let{atomSourceIndex:a}=e.atomicHierarchy,{count:o,offsets:s}=e.atomicHierarchy.residueAtomSegments,c=Array(o),l=Array(o),u=Array(o),d=Array(o);for(let e=0;e<o;e++){let o=a.value(s[e]);if(t.valueKind(o)!==U.ValueKinds.Present){c[e]=``,l[e]=``,u[e]=``,d[e]=``;continue}c[e]=t.value(o),l[e]=n.value(o),u[e]=r.value(o),d[e]=i.value(o)}return{dbName:c,accession:l,num:u,residue:d}}})(fB||={}),nR.Field,nR.Encodings,nR.Field,nR.Category,nR.Category;const TMe={molstar_atom_site_operator_mapping:{label_asym_id:U.Schema.Str(),auth_asym_id:U.Schema.Str(),operator_name:U.Schema.Str(),suffix:U.Schema.Str(),assembly_id:U.Schema.Str(),assembly_operator_id:U.Schema.Int(),symmetry_operator_index:U.Schema.Int(),symmetry_hkl:U.Schema.Vector(3),ncs_id:U.Schema.Int()}};var pB=(e,t)=>t[e].operator.assembly===void 0?U.ValueKinds.NotPresent:U.ValueKinds.Present,mB=(e,t)=>t[e].operator.spgrOp===-1?U.ValueKinds.NotPresent:U.ValueKinds.Present;nR.fields().str(`label_asym_id`,(e,t)=>t[e].label_asym_id).str(`auth_asym_id`,(e,t)=>t[e].auth_asym_id).str(`operator_name`,(e,t)=>t[e].operator.name).str(`suffix`,(e,t)=>t[e].operator.suffix).str(`assembly_id`,(e,t)=>t[e].operator.assembly?.id||``,{valueKind:pB}).int(`assembly_operator_id`,(e,t)=>t[e].operator.assembly?.operId||0,{valueKind:pB}).int(`symmetry_operator_index`,(e,t)=>t[e].operator.spgrOp,{valueKind:mB}).vec(`symmetry_hkl`,[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:mB}).int(`ncs_id`,(e,t)=>t[e].operator.ncsId,{valueKind:mB}).getFields();const EMe={molstar_bond_site:{atom_id_1:U.Schema.int,atom_id_2:U.Schema.int,value_order:U.Schema.Aliased(U.Schema.lstr),type_id:U.Schema.Aliased(U.Schema.lstr)}};nR.fields().int(`atom_id_1`,(e,t)=>t[e].atom_id_1).int(`atom_id_2`,(e,t)=>t[e].atom_id_2).str(`value_order`,(e,t)=>t[e].value_order??``,{valueKind:(e,t)=>t[e].value_order===void 0?U.ValueKinds.NotPresent:U.ValueKinds.Present}).str(`type_id`,(e,t)=>t[e].type_id??``,{valueKind:(e,t)=>t[e].type_id===void 0?U.ValueKinds.NotPresent:U.ValueKinds.Present}).getFields(),nR.Category;var DMe;(function(e){function t(e){let t=Array.isArray(e)?e:[e];return{structures:t,firstModel:t[0].model,cache:Object.create(null)}}e.create=t})(DMe||={});var OMe;(function(e){e.AtomSitePositionsFieldNames=new Set([`id`,`Cartn_x`,`Cartn_y`,`Cartn_z`])})(OMe||={});var kMe;(function(e){function t(e,t,n){if(!t)return{rowCount:0};if(n&&n[t.id])return n[t.id];let r=t.getElements(e),i={data:r,rowCount:r.elements.length};return n&&(n[t.id]=i),i}e.getCifDataSource=t;function n(e){return new _B(e)}e.fromAtomMap=n;function r(e){return new _B(hB(e))}e.fromAtomArray=r;let i=e=>e.atomicHierarchy.residueAtomSegments;function a(e){return new gB(`residue`,e,i,Q.Kind.Atomic)}e.fromResidueMap=a;function o(e){return new gB(`residue`,hB(e),i,Q.Kind.Atomic)}e.fromResidueArray=o;let s=e=>e.atomicHierarchy.chainAtomSegments;function c(e){return new gB(`chain`,e,s,Q.Kind.Atomic)}e.fromChainMap=c;function l(e){return new gB(`chain`,hB(e),s,Q.Kind.Atomic)}e.fromChainArray=l;function u(e){return new AMe(e)}e.fromEntityMap=u})(kMe||={});function hB(e){let t=new Map;for(let n=0,r=e.length;n<r;n++)t.set(n,e[n]);return t}var gB=class{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){let t=e.models;if(t.length!==1)throw Error(`Only works on structures with a single model.`);let n=new Set,r=e.unitSymmetryGroups,i=[],a=this.segmentGetter(t[0]);for(let t of r){let r=t.units[0];if(r.kind!==this.kind)continue;let o=uA.transientSegments(a,r.elements);for(;o.hasNext;){let t=o.move();!this.has(t.index)||n.has(t.index)||(n.add(t.index),i[i.length]=iL.create(e,r,r.elements[t.start]))}}return i.sort((e,t)=>e.element-t.element),i}getElements(e){let t=this.segmentGetter(e.model).index,n=this.getStructureElements(e);return{elements:n,property:e=>this.get(t[n[e].element])}}constructor(e,t,n,r){this.level=e,this.map=t,this.segmentGetter=n,this.id=zy.create22(),this.kind=r}},_B=class{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){if(e.models.length!==1)throw Error(`Only works on structures with a single model.`);let t=new Set,n=e.unitSymmetryGroups,r=[];for(let i of n){let n=i.units[0];if(n.kind!==this.kind)continue;let a=n.elements;for(let i=0,o=a.length;i<o;i++){let o=a[i];!this.has(o)||t.has(o)||(t.add(a[i]),r[r.length]=iL.create(e,n,o))}}return r.sort((e,t)=>e.element-t.element),r}getElements(e){let t=this.getStructureElements(e);return{elements:t,property:e=>this.get(t[e].element)}}constructor(e){this.map=e,this.id=zy.create22(),this.level=`atom`,this.kind=Q.Kind.Atomic}},AMe=class{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){let t=e.models;if(t.length!==1)throw Error(`Only works on structures with a single model.`);let n=t[0].atomicHierarchy.index,r=new Set,i=e.unitSymmetryGroups,a=[],o=t[0].atomicHierarchy.chainAtomSegments;for(let t of i){let i=t.units[0];if(i.kind!==this.kind)continue;let s=uA.transientSegments(o,i.elements);for(;s.hasNext;){let t=s.move(),o=n.getEntityFromChain(t.index);!this.has(o)||r.has(o)||(r.add(o),a[a.length]=iL.create(e,i,i.elements[t.start]))}}return a.sort((e,t)=>e.element-t.element),a}getElements(e){let t=this.getStructureElements(e),n=e.model.atomicHierarchy.chainAtomSegments.index,r=e.model.atomicHierarchy.index;return{elements:t,property:e=>this.get(r.getEntityFromChain(n[t[e].element]))}}constructor(e){this.map=e,this.id=zy.create22(),this.level=`entity`,this.kind=Q.Kind.Atomic}},vB=class{getFrameAtIndex(e){return this.frames[e]}constructor(e){this.frames=e,this.frameCount=e.length,this.representative=e[0],this.duration=e.length}};function jMe(e,t,n){if(!e._rowCount)return[];let r=PMe(n),i=[];for(let n=0;n<e._rowCount;n++)i[i.length]=MMe(e,t,n,r);return i}function MMe(e,t,n,r){let i=e.id.value(n),a=e.details.value(n),o=[],{assembly_id:s,oper_expression:c,asym_id_list:l}=t;for(let e=0,n=t._rowCount;e<n;e++)s.value(e)===i&&(o[o.length]={assemblyId:i,expression:c.value(e),asymIds:l.value(e)});return XI.create(i,a,NMe(o,r))}function NMe(e,t){return()=>{let n=[],r=0;for(let i=0;i<e.length;i++){let a=e[i],o=IMe(t,FMe(LMe(a.expression)),r,a.assemblyId),s=Wz.generators.atoms({chainTest:Wz.pred.and(Wz.pred.eq(e=>Pz.unit.operator_name(e.element),tA.DefaultName),Wz.pred.inSet(e=>Pz.chain.label_asym_id(e.element),a.asymIds))});n[n.length]={selector:s,operators:o,asymIds:a.asymIds},r+=o.length}return n}}function PMe(e){let{id:t,matrix:n,vector:r,_schema:i}=e,a=new Map,o=B();for(let s=0,c=e._rowCount;s<c;s++){let e=BD.toMat4(z(),i.matrix.space,n.value(s));BD.toVec3(o,i.vector.space,r.value(s)),z.setTranslation(e,o),z.setValue(e,3,3,1),a.set(t.value(s),e)}return a}function FMe(e){let t=[],n=[];for(let t=0;t<e.length;t++)n[t]=``;return yB(e,t,e.length-1,n),t}function yB(e,t,n,r){if(n<0){t[t.length]=r.slice(0);return}let i=e[n],a=i.length;for(let o=0;o<a;o++)r[n]=i[o],yB(e,t,n-1,r)}function IMe(e,t,n,r){let i=[],a=n;for(let n of t){let t=z.identity();for(let r=0;r<n.length;r++)z.mul(t,t,e.get(n[r]));a++;let o=`ASM_${a}`,s=tA.getAssemblyOperatorName(n);i[i.length]=tA.create(o,t,{instanceId:s,assembly:{id:r,operId:a,operList:n}})}return i}function LMe(e){let t=/\(?([^\(\)]+)\)?]*/g,n=[],r=[],i;for(;i=t.exec(e);)n[n.length]=i[1];return n.forEach(e=>{let t=[];e.split(`,`).forEach(e=>{let n=e.indexOf(`-`);if(n>0){let r=parseInt(e.substring(0,n)),i=parseInt(e.substr(n+1));for(let e=r;e<=i;e++)t[t.length]=e.toString()}else t[t.length]=e.trim()}),r[r.length]=t}),r}var bB;(function(e){e.Descriptor={name:`model_symmetry`},e.Provider=JI.create(e.Descriptor);function t(e){let t=jMe(e.pdbx_struct_assembly,e.pdbx_struct_assembly_gen,e.pdbx_struct_oper_list),n=BMe(e.symmetry,e.cell);return{assemblies:t,spacegroup:n,isNonStandardCrystalFrame:RMe(e.atom_sites,n),ncsOperators:VMe(e.struct_ncs_oper)}}e.fromData=t;function n(e,t){let n=oA.create(`P 1`,e,t);return{assemblies:[],spacegroup:sA.create(n),isNonStandardCrystalFrame:!1}}e.fromCell=n})(bB||={});function RMe(e,t){return e._rowCount,!1}function zMe(e){let t=e.Int_Tables_number.value(0),n=e[`space_group_name_H-M`].value(0);return e.Int_Tables_number.isDefined?e[`space_group_name_H-M`].isDefined?n:t:n}function BMe(e,t){if(e._rowCount===0||t._rowCount===0)return sA.ZeroP1;let n=t.length_a.value(0),r=t.length_b.value(0),i=t.length_c.value(0);if(n===0||r===0||i===0)return sA.ZeroP1;let a=t.angle_alpha.value(0),o=t.angle_beta.value(0),s=t.angle_gamma.value(0);if(a===0||o===0||s===0)return sA.ZeroP1;let c=zMe(e),l=oA.create(c,B.create(n,r,i),B.scale(B(),B.create(a,o,s),Math.PI/180));return sA.create(l)}function VMe(e){if(e._rowCount===0)return;let{id:t,matrix:n,vector:r}=e,i=HO.struct_ncs_oper.matrix.space,a=HO.struct_ncs_oper.vector.space,o=[];for(let s=0;s<e._rowCount;s++){let c=BD.toMat3(TT(),i,n.value(s)),l=BD.toVec3(B(),a,r.value(s));if(!tA.checkIfRotationAndTranslation(c,l)||e.code.value(s)===`given`&&!TT.isIdentity(c)&&!B.isZero(l))continue;let u=t.value(s);o[o.length]=tA.ofRotationAndOffset(`ncs_${u}`,c,l,u)}return o}var HMe={U:HO.atom_site_anisotrop.U,U_esd:HO.atom_site_anisotrop.U_esd},xB;(function(e){e.Schema=HMe,e.Descriptor={name:`atom_site_anisotrop`,cifExport:{prefix:``,categories:[{name:`atom_site_anisotrop`,instance(t){return!e.Provider.get(t.firstModel)||!CB.is(t.firstModel.sourceData)?nR.Category.Empty:nR.Category.ofTable(t.firstModel.sourceData.data.db.atom_site_anisotrop)}}]}},e.Provider=JI.create(e.Descriptor);function t(e,t){let n=new Int32Array(e.rowCount);n.fill(-1);for(let t=0,r=e.rowCount;t<r;t++)n[e.value(t)]=t;let r=new Int32Array(e.rowCount);r.fill(-1);for(let e=0,i=t.rowCount;e<i;++e){let i=n[t.value(e)];i!==-1&&(r[i]=e)}return r}e.getElementToAnsiotrop=t;function n(e,t){let n={};for(let t=0,r=e.rowCount;t<r;t++)n[e.value(t)]=t;let r=new Int32Array(e.rowCount);r.fill(-1);for(let e=0,i=t.rowCount;e<i;++e){let i=n[t.value(e)];i!==void 0&&(r[i]=e)}return r}e.getElementToAnsiotropFromLabel=n})(xB||={});var SB;(function(e){let t=`molstar_global_model_transform_info`;e.Schema={[t]:{matrix:U.Schema.Matrix(4,4,U.Schema.float)}},e.Descriptor=PP({name:t,cifExport:{categories:[{name:t,instance(t){let n=r(t.firstModel);if(!n)return nR.Category.Empty;let i=QD.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:n}]);return nR.Category.ofTable(i)}}],prefix:`molstar`}}),e.Provider=JI.create(e.Descriptor);function n(t,n){t.customProperties.has(e.Descriptor)||t.customProperties.add(e.Descriptor),e.Provider.set(t,n)}e.attach=n;function r(t){return e.Provider.get(t)}e.get=r;function i(n){if(!CB.is(n.sourceData))return;let r=n.sourceData.data.frame.categories[t];if(!r)return;let i=Zge(e.Schema[t],r);if(i._rowCount!==0)return i.matrix.value(0)}e.fromMmCif=i;function a(e){if(!CB.is(e.sourceData))return!1;let n=e.sourceData.data.frame.categories[t];return!!n&&n.rowCount>0}e.hasData=a;function o(n,r){n.writeCategory({name:t,instance(){let t=QD.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:r}]);return nR.Category.ofTable(t)}})}e.writeMmCif=o})(SB||={});function UMe(e){if(CB.is(e.sourceData))return bB.fromData(e.sourceData.data.db)}bB.Provider.formatRegistry.add(`mmCIF`,UMe);function WMe(e){if(!CB.is(e.sourceData))return;let{struct_conf:t,struct_sheet_range:n}=e.sourceData.data.db;return vz.fromStruct(t,n,e.atomicHierarchy)}vz.Provider.formatRegistry.add(`mmCIF`,WMe);function GMe(e){if(!CB.is(e.sourceData))return;let{atom_site_anisotrop:t}=e.sourceData.data.db;return{data:QD.ofColumns(xB.Schema,t),elementToAnsiotrop:xB.getElementToAnsiotrop(e.atomicConformation.atomId,t.id)}}function KMe(e){return CB.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}xB.Provider.formatRegistry.add(`mmCIF`,GMe,KMe);function qMe(e){if(!CB.is(e.sourceData))return;let{chem_comp_bond:t}=e.sourceData.data.db;if(t._rowCount!==0)return{data:t,entries:rR.getEntriesFromChemCompBond(t)}}rR.Provider.formatRegistry.add(`mmCIF`,qMe);function JMe(e){if(!CB.is(e.sourceData))return;let{struct_conn:t}=e.sourceData.data.db;if(t._rowCount===0)return;let n=iR.getEntriesFromStructConn(t,e),r=new Set;for(let e of n)e.partnerA.residueIndex!==e.partnerB.residueIndex&&r.add(mE(e.partnerA.residueIndex,e.partnerB.residueIndex));return{data:t,byAtomIndex:iR.getAtomIndexFromEntries(n),residueCantorPairs:r,entries:n}}iR.Provider.formatRegistry.add(`mmCIF`,JMe);function YMe(e){if(!CB.is(e.sourceData))return;let{molstar_bond_site:t}=MO(EMe,e.sourceData.data.frame);if(t._rowCount===0)return;let n=new Map,{atomId:r}=e.atomicConformation;for(let e=0;e<r.rowCount;e++)n.set(r.value(e),e);let i=[],a=[],o=[],s=[],{atom_id_1:c,atom_id_2:l,value_order:u,type_id:d}=t;for(let e=0;e<t._rowCount;e++){i.push(n.get(c.value(e))),a.push(n.get(l.value(e)));let t=kI.Flag.None,r=1;switch(u.value(e)){case`sing`:r=1;break;case`doub`:r=2;break;case`trip`:r=3;break;case`quad`:r=4;break;case`arom`:r=1,t=kI.Flag.Aromatic;break;default:break}switch(d.value(e)){case`covale`:t|=kI.Flag.Covalent;break;case`disulf`:t|=kI.Flag.Covalent|kI.Flag.Disulfide;break;case`hydrog`:t|=kI.Flag.HydrogenBond;break;case`metalc`:t|=kI.Flag.MetallicCoordination;break}o.push(r),s.push(t)}return YI.fromData({pairs:{indexA:U.ofIntArray(i),indexB:U.ofIntArray(a),order:U.ofIntArray(o),flag:U.ofArray({array:s,schema:U.Schema.int})},count:e.atomicHierarchy.atoms._rowCount},{maxDistance:1/0})}YI.Provider.formatRegistry.add(`mmCIF`,YMe),SB.Provider.formatRegistry.add(`mmCIF`,SB.fromMmCif,SB.hasData);var CB;(function(e){function t(e){return e?.kind===`mmCIF`}e.is=t;function n(e,t,n,r){return t||=dk.schema.mmCIF(e),{kind:`mmCIF`,name:t._name,data:{db:t,file:r,frame:e,source:n}}}e.fromFrame=n})(CB||={});function wB(e,t){let n=CB.fromFrame(e,void 0,void 0,t),r=PI(n.data.db,!0);return hb.create(`Create mmCIF Model`,e=>JB(r,n,e))}var TB;(function(e){let t=`__CcdCoordinateType__`;e.CoordinateType={get(e){return e._staticPropertyData[t]},set(e,n){return e._staticPropertyData[t]=n}};function n(e){return e?.kind===`CCD`}e.is=n;function r(e,t){return t||=dk.schema.CCD(e),{kind:`CCD`,name:t._name,data:{db:t,frame:e}}}e.fromFrame=r})(TB||={});function XMe(e){let t=TB.fromFrame(e);return hb.create(`Create CCD Models`,n=>ZMe(t.data.db,TB.fromFrame(e),n))}async function ZMe(e,t,n){let r=await EB(e,t,{coordinateType:`ideal`,cartn_x:`pdbx_model_Cartn_x_ideal`,cartn_y:`pdbx_model_Cartn_y_ideal`,cartn_z:`pdbx_model_Cartn_z_ideal`},n),i=await EB(e,t,{coordinateType:`model`,cartn_x:`model_Cartn_x`,cartn_y:`model_Cartn_y`,cartn_z:`model_Cartn_z`},n),a=[];r&&a.push(r),i&&a.push(i);for(let e=0,t=a.length;e<t;++e)DB.TrajectoryInfo.set(a[e],{index:e,size:a.length});return new vB(a)}async function EB(e,t,n,r){let{chem_comp:i,chem_comp_atom:a,chem_comp_bond:o}=e,{coordinateType:s,cartn_x:c,cartn_y:l,cartn_z:u}=n,d=i.name.value(0),f=i.id.value(0),{atom_id:p,charge:m,comp_id:h,pdbx_ordinal:g,type_symbol:_}=a,v=a._rowCount,y=[];for(let e=0;e<v;e++)a[c].valueKind(e)>0||(y[y.length]=e);let b=y.length,x=U.ofConst(`A`,b,U.Schema.str),S=U.ofConst(1,b,U.Schema.int),C=U.ofConst(`1`,b,U.Schema.str),w=U.ofConst(1,b,U.Schema.float),T=U.ofConst(1,b,U.Schema.int),E=U.view(p,y),D=U.view(h,y),O=U.view(a[c],y),k=U.view(a[l],y),A=U.view(a[u],y),j=U.view(g,y),M=U.view(_,y),N=U.view(m,y),ee=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:x,auth_atom_id:E,auth_comp_id:D,auth_seq_id:S,Cartn_x:O,Cartn_y:k,Cartn_z:A,id:j,label_asym_id:x,label_atom_id:E,label_comp_id:D,label_seq_id:S,label_entity_id:C,occupancy:w,type_symbol:M,pdbx_PDB_model_num:T,pdbx_formal_charge:N},b),te=new BI;te.setNames([[f,`${d} (${s})`]]),te.getEntityId(f,iI.Unknown,`A`);let P=new LI(S,_);P.setNames([[f,`${d} (${s})`]]),P.add(f,0);let ne=await JB(PI({entity:te.getEntityTable(),chem_comp:P.getChemCompTable(),atom_site:ee}),t,r);if(!ne.representative)return;let re=ne.representative,ie=rR.getEntriesFromChemCompBond(o);return rR.Provider.set(re,{data:o,entries:ie}),TB.CoordinateType.set(re,s),ne.representative}var DB;(function(e){function t(t,r){let i=[],{frames:o}=r,s=n(t),c=y(t),l=t.atomicHierarchy.atoms._rowCount;for(let n=0,r=o.length;n<r;++n){let r=o[n];if(r.elementCount!==l)throw Error(`Frame element count mismatch, got ${r.elementCount} but expected ${l}.`);let s={...t,id:zy.create22(),modelNum:n,atomicConformation:a(t,r),customProperties:new FP,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(r.cell){let e=bB.fromCell(r.cell.size,r.cell.anglesInRadians);bB.Provider.set(s,e)}e.TrajectoryInfo.set(s,{index:n,size:o.length}),e.CoarseGrained.set(s,c),i.push(s)}return{trajectory:i,srcIndexArray:s}}function n(e){let t=e.atomicHierarchy.atomSourceIndex,n;return`__srcIndexArray__`in e._staticPropertyData?n=e._dynamicPropertyData.__srcIndexArray__:(n=U.isIdentity(t)?void 0:t.toArray({array:Int32Array}),e._dynamicPropertyData.__srcIndexArray__=n),n}function r(e,n){return new vB(t(e,n).trajectory)}e.trajectoryFromModelAndCoordinates=r;function i(n,r){return hb.create(`Create Trajectory`,async i=>{let a=await JB(n.basic,n.sourceData,i);if(a.frameCount===0)throw Error(`found no model`);let o=a.representative,{trajectory:s}=t(o,r),c={pairs:n.bonds,count:o.atomicHierarchy.atoms._rowCount},l=YI.fromData(c),u=y(o),d=0;for(let t of s)YI.Provider.set(t,l),e.TrajectoryInfo.set(t,{index:d++,size:s.length}),e.CoarseGrained.set(t,u);return new vB(s)})}e.trajectoryFromTopologyAndCoordinates=i;function a(e,t){return zF.getAtomicConformation(t,{atomId:e.atomicConformation.atomId,occupancy:e.atomicConformation.occupancy,B_iso_or_equiv:e.atomicConformation.B_iso_or_equiv},n(e))}e.getAtomicConformationFromFrame=a;let o=`__Center__`;function s(e){if(e._dynamicPropertyData[o])return e._dynamicPropertyData[o];let t=TDe(e.atomicConformation,e.coarseConformation);return e._dynamicPropertyData[o]=t,t}e.getCenter=s;let c=`__AtomicRadii__`;function l(e){if(e._dynamicPropertyData[c])return e._dynamicPropertyData[c];let t=e.atomicHierarchy.atoms._rowCount,n=e.atomicHierarchy.atoms.type_symbol.value,r=new Float32Array(t);for(let e=0;e<t;e++)r[e]=WI(n(e));return e._dynamicPropertyData[c]=r,r}e.getAtomicRadii=l;function u(e){let t=new Int32Array(e.rowCount),n=!1;for(let r=0,i=e.rowCount;r<i;r++){let i=e.value(r);i!==r&&(n=!1),t[i]=r}return{isIdentity:n,invertedIndex:t}}let d=`__InvertedAtomSrcIndex__`;function f(e){if(e._staticPropertyData[d])return e._staticPropertyData[d];let t=u(e.atomicHierarchy.atomSourceIndex);return e._staticPropertyData[d]=t,t}e.getInvertedAtomSourceIndex=f;let p=`__TrajectoryInfo__`;e.TrajectoryInfo={get(e){return e._dynamicPropertyData[p]||{index:0,size:1}},set(e,t){return e._dynamicPropertyData[p]=t}};let m=`__AsymIdCount__`;e.AsymIdCount={get(e){if(e._dynamicPropertyData[m])return e._dynamicPropertyData[m];let t=EDe(e);return e._dynamicPropertyData[m]=t,t}},e.AsymIdOffset=dB.createSimple(`asym_id_offset`,`static`),e.Index=dB.createSimple(`index`,`static`),e.MaxIndex=dB.createSimple(`max_index`,`static`);function h(e){return e.parent||e}e.getRoot=h;function g(e,t){return e.atomicHierarchy===t.atomicHierarchy&&e.coarseHierarchy===t.coarseHierarchy}e.areHierarchiesEqual=g;let _=`__CoordinatesHistory__`;e.CoordinatesHistory={get(e){return e._staticPropertyData[_]},set(e,t){return e._staticPropertyData[_]=t}};let v=`__CoarseGrained__`;e.CoarseGrained={get(e){return e._staticPropertyData[v]},set(e,t){return e._staticPropertyData[v]=t}};function y(t){let n=e.CoarseGrained.get(t);if(n===void 0){let r=0,i=0,{polymerType:a,directionToElementIndex:o}=t.atomicHierarchy.derived.residue;for(let e=0;e<a.length;++e)a[e]!==aI.NA&&(r+=1,o[e]!==-1&&(i+=1));let s=!1,c=!1,{label_atom_id:l,_rowCount:u}=t.atomicHierarchy.atoms;for(let e=0;e<u;++e){let t=l.value(e);if(!s&&t===`BB`&&(s=!0),!c&&t===`SC1`&&(c=!0),s&&c)break}n=!1,u>0&&r>0&&(s&&c||u/r<3||i===0)&&(n=!0),e.CoarseGrained.set(t,n)}return n}e.isCoarseGrained=y;function b(e){return e.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=b;function x(e){let{subtype:t}=e.entities;for(let e=0,n=t.rowCount;e<n;++e)if(t.value(e).startsWith(`polypeptide`))return!0;return!1}e.hasProtein=x;function S(e){let{subtype:t}=e.entities;for(let e=0,n=t.rowCount;e<n;++e){let n=t.value(e);if(n.endsWith(`ribonucleotide hybrid`)||n.endsWith(`ribonucleotide`))return!0}return!1}e.hasNucleic=S;function C(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0,n=t.database_2.database_id.rowCount;e<n;++e)if(t.database_2.database_id.value(e)===`pdb`)return!0;return!1}e.isFromPdbArchive=C;function w(e){return CB.is(e.sourceData)?e.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||e.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}e.hasPdbId=w;function T(e){if(CB.is(e.sourceData)){let{db:t}=e.sourceData.data;return t.struct_conf.id.isDefined||t.struct_sheet_range.id.isDefined}else return vz.Provider.isApplicable(e)}e.hasSecondaryStructure=T;let E=B.create(1.5707963,1.5707963,1.5707963),D=B.create(1,1,1);function O(e){let t=bB.Provider.get(e)?.spacegroup;return!!t&&!(t.num===1&&B.equals(t.cell.anglesInRadians,E)&&B.equals(t.cell.size,D))}e.hasCrystalSymmetry=O;function k(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.exptl.method.rowCount;e++)if(t.exptl.method.value(e).toUpperCase().indexOf(`DIFFRACTION`)>=0)return!0;return!1}e.isFromXray=k;function A(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.exptl.method.rowCount;e++)if(t.exptl.method.value(e).toUpperCase().indexOf(`MICROSCOPY`)>=0)return!0;return!1}e.isFromEm=A;function j(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.exptl.method.rowCount;e++)if(t.exptl.method.value(e).toUpperCase().indexOf(`NMR`)>=0)return!0;return!1}e.isFromNmr=j;function M(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.struct.pdbx_structure_determination_methodology.rowCount;e++)if(t.struct.pdbx_structure_determination_methodology.value(e).toLowerCase()===`experimental`)return!0;return!1}e.isExperimental=M;function N(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.struct.pdbx_structure_determination_methodology.rowCount;e++)if(t.struct.pdbx_structure_determination_methodology.value(e).toLowerCase()===`integrative`)return!0;return!1}e.isIntegrative=N;function ee(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data;for(let e=0;e<t.struct.pdbx_structure_determination_methodology.rowCount;e++)if(t.struct.pdbx_structure_determination_methodology.value(e).toLowerCase()===`computational`)return!0;return!1}e.isComputational=ee;function te(e){if(!CB.is(e.sourceData)||!k(e))return!1;let{db:t}=e.sourceData.data,{status_code_sf:n}=t.pdbx_database_status;return n.isDefined&&n.value(0)===`REL`}e.hasXrayMap=te;function P(e){if(!CB.is(e.sourceData))return!1;let{db:t}=e.sourceData.data,{db_name:n,content_type:r}=t.pdbx_database_related;for(let e=0,i=t.pdbx_database_related._rowCount;e<i;++e)if(n.value(e).toUpperCase()===`EMDB`&&r.value(e)===`associated EM volume`)return!0;return!1}e.hasEmMap=P;function ne(e){return CB.is(e.sourceData)?te(e)||P(e):!1}e.hasDensityMap=ne;function re(t){if(!CB.is(t.sourceData)||e.isIntegrative(t))return!1;let{db:n}=t.sourceData.data;return ne(t)||w(t)&&(!n.exptl.method.isDefined||k(t)&&(!n.pdbx_database_status.status_code_sf.isDefined||n.pdbx_database_status.status_code_sf.valueKind(0)===U.ValueKinds.Unknown)||A(t)&&!n.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=re})(DB||={});function QMe(e,t,n,r){let{label_comp_id:i,type_symbol:a,_rowCount:o}=e.atoms,{_rowCount:s}=e.residues,{offsets:c}=t.residueAtomSegments,l=new Uint8Array(o);for(let e=0;e<o;++e)l[e]=GI(a.value(e));let u=new Int32Array(s),d=new Int32Array(s),f=new Int32Array(s),p=new Uint8Array(s),m=new Uint8Array(s),h=new Map,g=new Map;for(let e=0;e<s;++e){let t=i.value(c[e]),a=r,o,s;if(h.has(t))o=h.get(t),s=g.get(t);else{let e;a.has(t)?e=a.get(t).type:(Zy||console.info(`chemComp not found`,t),e=wI(t)),o=CI(e,t),s=sDe(e,o),h.set(t,o),g.set(t,s)}p[e]=o,m[e]=s;let l=CR(s,`trace`),_=n.findAtomsOnResidue(e,l);if(_===-1){let t=CR(s,`coarseBackbone`);_=n.findAtomsOnResidue(e,t),_===-1&&TI(o)&&(_=n.findElementOnResidue(e,nI(`C`)))}u[e]=_;let v=CR(s,`directionFrom`);d[e]=n.findAtomsOnResidue(e,v);let y=CR(s,`directionTo`);f[e]=n.findAtomsOnResidue(e,y)}return{atom:{atomicNumber:l},residue:{traceElementIndex:u,directionFromElementIndex:d,directionToElementIndex:f,moleculeType:p,polymerType:m}}}function OB(e,t){return t?t.length===1?pE(t.charCodeAt(0),e):t.length===2?pE(t.charCodeAt(0),pE(t.charCodeAt(1),e)):`${e} ${t}`:e}function $Me(e,t,n,r){if(e.has(t)){let i=e.get(t);i.has(n)||i.set(n,r)}else{let i=new Map;e.set(t,i),i.set(n,r)}}function eNe(e){throw Error(`Missing entity entry for entity id '${e}'.`)}function tNe(e,t,n){return{entities:e,segments:n,label_seq_id:Vk.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var kB=VI.EmptyResidueKey(),nNe=class{getEntityFromChain(e){return this.map.chain_index_entity_index[e]}findEntity(e){let t=this.map.label_asym_id.get(e);return t===void 0?-1:t}findChainLabel(e){let t=this.entityIndex(e.label_entity_id);if(t<0||!this.map.entity_index_label_asym_id.has(t))return-1;let n=this.map.entity_index_label_asym_id.get(t);return n&&n.has(e.label_asym_id)?n.get(e.label_asym_id):-1}findChainAuth(e){if(!this.map.auth_asym_id_auth_seq_id.has(e.auth_asym_id))return-1;let t=this.map.auth_asym_id_auth_seq_id.get(e.auth_asym_id);return t.has(e.auth_seq_id)?t.get(e.auth_seq_id):-1}findResidue(e,t,n,r){let i;arguments.length===1?i=e:(kB.label_entity_id=e,kB.label_asym_id=t,kB.auth_seq_id=n,kB.pdbx_PDB_ins_code=r,i=kB);let a=this.findChainLabel(i);if(a<0)return-1;let o=this.map.chain_index_auth_seq_id.get(a),s=OB(i.auth_seq_id,i.pdbx_PDB_ins_code||``);return o.has(s)?o.get(s):-1}findResidueLabel(e){let t=this.findChainLabel(e);if(t<0)return-1;let n=this.map.chain_index_label_seq_id.get(t),r=OB(e.label_seq_id,e.pdbx_PDB_ins_code||``);return n.has(r)?n.get(r):-1}findResidueAuth(e){let t=this.findChainAuth(e);if(t<0)return-1;let n=this.map.chain_index_auth_seq_id.get(t),r=OB(e.auth_seq_id,e.pdbx_PDB_ins_code||``);return n.has(r)?n.get(r):-1}findResidueInsertion(e){let t=this.findChainLabel(e);if(t<0)return-1;let n=this.map.chain_index_label_seq_id.get(t),r=OB(e.label_seq_id,e.pdbx_PDB_ins_code||``);if(n.has(r))return n.get(r);let i=Vk.findPredecessorIndex(this.map.label_seq_id,e.label_seq_id),a=HI.chainStartResidueIndex(this.map.segments,t);if(i<a)return a;let o=HI.chainEndResidueIndexExcl(this.map.segments,t)-1;return i>=o?o:i}findAtom(e){let t=this.findResidue(e);return t<0?-1:e.label_alt_id===void 0?AB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,e.label_atom_id):jB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,e.label_atom_id,e.label_alt_id)}findAtomAuth(e){let t=this.findResidueAuth(e);return t<0?-1:e.label_alt_id===void 0?AB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,e.auth_atom_id):jB(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,this.map.label_alt_id,e.auth_atom_id,e.label_alt_id)}findAtomOnResidue(e,t,n){return n===void 0?AB(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,t):jB(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,this.map.label_alt_id,t,n)}findAtomsOnResidue(e,t){return rNe(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,t)}findElementOnResidue(e,t){return iNe(this.residueOffsets[e],this.residueOffsets[e+1],this.map.type_symbol,t)}constructor(e){this.map=e,this.entityIndex=e.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}};function AB(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i;return-1}function rNe(e,t,n,r){for(let i=e;i<t;i++)if(r.has(n.value(i)))return i;return-1}function jB(e,t,n,r,i,a){for(let o=e;o<t;o++)if(n.value(o)===i&&r.value(o)===a)return o;return-1}function iNe(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i;return-1}function aNe(e,t,n){let r=tNe(t,e,n),{label_seq_id:i,auth_seq_id:a,pdbx_PDB_ins_code:o}=e.residues,{label_entity_id:s,label_asym_id:c,auth_asym_id:l}=e.chains,u=G.ofBounds(0,e.atoms._rowCount),d=uA.transientSegments(n.chainAtomSegments,u);for(;d.hasNext;){let e=d.move(),f=e.index,p=t.getEntityIndex(s.value(f));p<0&&eNe(s.value(f)),r.chain_index_entity_index[f]=p;let m=l.value(f),h=r.auth_asym_id_auth_seq_id.get(m);h||(h=new Map,r.auth_asym_id_auth_seq_id.set(m,h));let g=c.value(f);r.label_asym_id.has(g)||r.label_asym_id.set(g,p),$Me(r.entity_index_label_asym_id,p,g,f);let _=new Map,v=new Map;r.chain_index_label_seq_id.set(f,_),r.chain_index_auth_seq_id.set(f,v);let y=uA.transientSegments(n.residueAtomSegments,u,e);for(;y.hasNext;){let e=y.move().index,t=a.value(e),n=o.value(e);_.set(OB(i.value(e),n),e),v.set(OB(t,n),e),h.set(t,f)}}return new nNe(r)}function oNe(e){if(e._rowCount===0)return{residues:[],chains:[]};let t=e._rowCount,n=[0],r=[0],{label_entity_id:i,label_asym_id:a,label_seq_id:o,auth_seq_id:s,pdbx_PDB_ins_code:c}=e;for(let e=1;e<t;e++){let t=!i.areValuesEqual(e-1,e)||!a.areValuesEqual(e-1,e);(t||!o.areValuesEqual(e-1,e)||!s.areValuesEqual(e-1,e)||!c.areValuesEqual(e-1,e))&&(n[n.length]=e),t&&(r[r.length]=e)}return{residues:n,chains:r}}function sNe(e,t,n){let r=QD.ofColumns(yDe,{type_symbol:U.ofArray({array:U.mapToArray(e.type_symbol,nI),schema:U.Schema.Aliased(U.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),i=QD.view(e,bDe,n.residues),a=QD.view(e,xDe,n.chains);if(!i.label_seq_id.isDefined){let e=new Int32Array(i.label_seq_id.rowCount),{residues:t,chains:r}=n,a=0,o=0;for(let n=0,i=e.length;n<i;++n)t[n]>=r[a+1]&&(a+=1,o=0),e[n]=++o;i.label_seq_id=U.ofIntArray(e)}return QD.columnToArray(i,`label_seq_id`,Int32Array),QD.columnToArray(i,`auth_seq_id`,Int32Array),{atoms:r,residues:i,chains:a,atomSourceIndex:t,residueSourceIndex:cNe(t,n.residues.length,n.residues)}}function cNe(e,t,n){let r=new Uint32Array(t);for(let i=0;i<t;i++){let a=n[i],o=i+1<t?n[i+1]:e.rowCount,s=e.value(a);for(let t=a+1;t<o;t++){let n=e.value(t);n<s&&(s=n)}r[i]=s}let i=qfe(t).sort((e,t)=>r[e]-r[t]);for(let e=0;e<t;e++)r[i[e]]=e;return U.ofIntArray(r)}function lNe(e){return{id:zy.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:U.ofConst(1,e._rowCount,U.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function uNe(e,t){return QD.areEqual(e.chains,t.chains)&&QD.areEqual(e.residues,t.residues)&&QD.areEqual(e.atoms,t.atoms)}function dNe(e,t){let n=new Map;if(!CB.is(t))return n;let{molstar_atom_site_operator_mapping:r}=MO(TMe,t.data.frame);if(r._rowCount===0)return n;let i=new Map,a=new Map;for(let e=0;e<r._rowCount;e++){let t=r.assembly_operator_id.valueKind(e)===U.ValueKinds.Present?{id:r.assembly_id.value(e),operList:[],operId:r.assembly_operator_id.value(e)}:void 0,n=tA.create(r.operator_name.value(e),z.identity(),{assembly:t,spgrOp:r.symmetry_operator_index.valueKind(e)===U.ValueKinds.Present?r.symmetry_operator_index.value(e):void 0,hkl:B.ofArray(r.symmetry_hkl.value(e)),ncsId:r.ncs_id.value(e)}),o=r.suffix.value(e),s=r.label_asym_id.value(e);i.set(`${s}${o}`,{name:s,operator:n});let c=r.auth_asym_id.value(e);a.set(`${c}${o}`,c)}let{label_asym_id:o,auth_asym_id:s}=e.chains,c=Array(o.rowCount),l=Array(o.rowCount);for(let e=0;e<o.rowCount;e++){let t=o.value(e),r=s.value(e);if(!i.has(t)){c[e]=t,l[e]=r;continue}let{name:u,operator:d}=i.get(t);n.set(e,d),c[e]=u,l[e]=a.get(r)||r}return e.chains.label_asym_id=U.ofArray({array:c,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=U.ofArray({array:l,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),n}function fNe(e,t,n,r,i,a){let o=oNe(e),s=sNe(e,t,o),c=dNe(s,i);if(a&&uNe(a.atomicHierarchy,s))return{sameAsPrevious:!0,hierarchy:a.atomicHierarchy,chainOperatorMapping:c};let l={residueAtomSegments:uA.ofOffsets(o.residues,G.ofBounds(0,e._rowCount)),chainAtomSegments:uA.ofOffsets(o.chains,G.ofBounds(0,e._rowCount))},u=aNe(s,n,l),d=QMe(s,l,u,r);return{sameAsPrevious:!1,hierarchy:{...s,...l,index:u,derived:d},chainOperatorMapping:c}}function MB(e,t,n,r,i,a){let{sameAsPrevious:o,hierarchy:s,chainOperatorMapping:c}=fNe(e,t,n,r,i,a);return{sameAsPrevious:o,hierarchy:s,conformation:lNe(e),chainOperatorMapping:c}}function pNe(e){return new hNe(e)}const mNe=new class{findElement(e,t){return t.kind=void 0,t.index=-1,!1}findSphereElement(e){return-1}findGaussianElement(e){return-1}};var hNe=class{get sphereMapping(){return this._sphereMapping||=NB(this.data.spheres),this._sphereMapping}get gaussianMapping(){return this._gaussianMapping||=NB(this.data.gaussians),this._gaussianMapping}findSphereElement(e){let t=this.sphereMapping[e.label_entity_id];return!t||(t=t[e.label_asym_id],!t)?-1:t[e.label_seq_id]??-1}findGaussianElement(e){let t=this.gaussianMapping[e.label_entity_id];return!t||(t=t[e.label_asym_id],!t)?-1:t[e.label_seq_id]??-1}findElement(e,t){let n=this.findSphereElement(e);if(n>=0)return t.kind=`spheres`,t.index=n,!0;let r=this.findGaussianElement(e);return r>=0?(t.kind=`gaussians`,t.index=r,!0):!1}constructor(e){this.data=e,this._sphereMapping=void 0,this._gaussianMapping=void 0}};function NB({count:e,entity_id:t,asym_id:n,seq_id_begin:r,seq_id_end:i}){let a={};for(let o=0;o<e;o++){let e=t.value(o),s=n.value(o);a[e]||(a[e]={}),a[e][s]||(a[e][s]={});let c=a[e][s],l=r.value(o),u=i.value(o);for(let e=l;e<=u;e++)c[e]=o}return a}var PB={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:U.Undefined(0,U.Schema.str),asym_id:U.Undefined(0,U.Schema.str),seq_id_begin:U.Undefined(0,U.Schema.int),seq_id_end:U.Undefined(0,U.Schema.int),chainElementSegments:uA.create([]),polymerRanges:OR.ofSortedRanges([]),gapRanges:OR.ofSortedRanges([])},FB;(function(e){e.Empty={isDefined:!1,spheres:PB,gaussians:PB,index:mNe}})(FB||={});function gNe(e,t,n){if(e.has(t))return e.get(t);let r=n.index++;return e.set(t,r),r}function _Ne(e,t){if(e.has(t))return e.get(t);let n=new Map;return e.set(t,n),n}function vNe(e,t,n){let r=e.getEntityIndex;return{findChainKey:(e,n)=>{let i=r(e);if(i<0)return-1;let a=t.get(i);return a.has(n)?a.get(n):-1},findSequenceKey:(e,i,a)=>{let o=r(e);if(o<0)return-1;let s=t.get(o);if(s===void 0)return-1;let c=s.get(i);if(c===void 0)return-1;let{elementIndices:l,seqRanges:u}=n.get(c),d=OR.firstIntersectionIndex(u,K.ofSingleton(a));return d===-1?-1:l[d]}}}function yNe(e){throw Error(`Missing entity entry for entity id '${e}'.`)}function IB(e,t){let{entity_id:n,asym_id:r,seq_id_begin:i,seq_id_end:a,count:o,chainElementSegments:s}=e,c=new Map,l=new Map,u={index:0},d=new Int32Array(o),f=new Int32Array(o),p=new Int32Array(s.count);for(let e=0;e<o;e++)f[e]=t.getEntityIndex(n.value(e)),f[e]<0&&yNe(n.value(e));for(let e=0;e<s.count;e++){let t=s.offsets[e],n=s.offsets[e+1],o=f[t];p[e]=o;let m=gNe(_Ne(l,o),r.value(t),u);for(let e=t;e<n;e++)d[e]=m;let h=[],g=[];for(let e=t;e<n;e++){let t=i.value(e),n=a.value(e);h.push(e),g.push(t,n)}let _={elementIndices:h,seqRanges:OR.ofSortedRanges(g)};c.set(m,_)}let{findChainKey:m,findSequenceKey:h}=vNe(t,l,c);return{chainKey:d,entityKey:f,findSequenceKey:h,findChainKey:m,getEntityFromChain:e=>p[e]}}function LB(e,t){let n=[],r=[],i=uA.transientSegments(e.chainElementSegments,G.ofBounds(0,e.count)),{seq_id_begin:a,seq_id_end:o}=e;for(;i.hasNext;){let{start:e,end:t}=i.move(),s=-1,c=-1;for(let i=e;i<t;++i){let l=o.value(i);i===e?(s=i,c=o.value(i)):a.value(i)-c>1&&(n.push(s,i-1),r.push(i-1,i),s=i),i===t-1&&n.push(s,i),c=l}}return{polymerRanges:OR.ofSortedRanges(n),gapRanges:OR.ofSortedRanges(r)}}const RB={hierarchy:FB.Empty,conformation:void 0};function bNe(e,t){let{ihm_sphere_obj_site:n,ihm_gaussian_obj_site:r}=e;if(n._rowCount===0&&r._rowCount===0)return RB;let i=zB(n),a=xNe(n),o=IB(i,e.entities),s=LB(i,t),c=zB(r),l=SNe(r),u=IB(c,e.entities),d=LB(c,t);return{hierarchy:{isDefined:!0,spheres:{...i,...o,...s},gaussians:{...c,...u,...d},index:pNe({spheres:i,gaussians:c})},conformation:{id:zy.create22(),spheres:a,gaussians:l}}}function xNe(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function SNe(e){let t=NI.ihm_gaussian_obj_site.covariance_matrix.space,n=[],{covariance_matrix:r}=e;for(let e=0,i=r.rowCount;e<i;e++)n[e]=BD.toMat3(TT(),t,r.value(e));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:n}}function CNe(e,t,n){let r=[0];for(let t=1,n=e.rowCount;t<n;t++)e.areValuesEqual(t-1,t)||(r[r.length]=t);return{chainElementSegments:uA.ofOffsets(r,G.ofBounds(0,e.rowCount))}}function zB(e){let{entity_id:t,seq_id_begin:n,seq_id_end:r,asym_id:i}=e;return{count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:n,seq_id_end:r,...CNe(i,n,r)}}function BB(e,t,n,r){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return rL.fromHierarchy(t,n,r);let{entity_id:i,num:a,mon_id:o}=e.entity_poly_seq,s={},c=[],l=i.rowCount,u=0;for(;u<l;){let e=u;for(;u<l-1&&i.areValuesEqual(u,u+1);)u++;u++;let n=i.value(e),r=U.window(o,e,u),d=U.window(a,e,u),f=t.getEntityIndex(n);s[f]={entityId:n,sequence:nL.ofResidueNames(r,d)},c.push(s[f])}return{byEntityKey:s,sequences:c}}async function VB(e,t,n,r){let i=hx(n,r-1),{label_entity_id:a,label_asym_id:o,label_seq_id:s}=t,c=vO(i,a.value);e.shouldUpdate&&await e.update();for(let t=0,n=c.length-1;t<n;t++){let n=vO(i,o.value,{start:c[t],end:c[t+1]});for(let t=0,r=n.length-1;t<r;t++){let r=n[t];s.valueKind(r)===U.ValueKinds.Present&&(vO(i,s.value,{sort:!0,start:r,end:n[t+1]}),e.shouldUpdate&&await e.update())}e.shouldUpdate&&await e.update()}return Kfe(i)&&i.length===t._rowCount?{atom_site:t,sourceIndex:U.ofIntArray(i)}:{atom_site:QD.view(t,t._schema,i),sourceIndex:U.ofIntArray(i)}}function HB(e,t,n,r,i){let{polymerType:a,traceElementIndex:o,directionFromElementIndex:s,directionToElementIndex:c}=i.residue,l=a[e],u=a[t];if(l===aI.NA||u===aI.NA||o[e]===-1||o[t]===-1)return!1;let d=r.findAtomsOnResidue(e,CR(l,`backboneStart`)),f=r.findAtomsOnResidue(t,CR(u,`backboneEnd`));(d===-1||f===-1)&&(d=r.findAtomsOnResidue(e,CR(l,`coarseBackbone`)),f=r.findAtomsOnResidue(t,CR(u,`coarseBackbone`)));let{x:p,y:m,z:h}=n,g=B.create(p[d],m[d],h[d]),_=B.create(p[f],m[f],h[f]),v=s[e]===-1||c[e]===-1||s[t]===-1||c[t]===-1;return B.distance(g,_)<(v?10:3)}function UB(e,t,n,r){let i=[],a=[],o=new Map,s=uA.transientSegments(e.chainAtomSegments,G.ofBounds(0,e.atoms._rowCount)),c=uA.transientSegments(e.residueAtomSegments,G.ofBounds(0,e.atoms._rowCount)),{index:l,derived:u}=e,{label_seq_id:d}=e.residues,{label_entity_id:f}=e.chains,{moleculeType:p,traceElementIndex:m}=u.residue,h,g,_,v;for(;s.hasNext;){let y=s.move();c.setSegment(y),h=-1,g=-1,_=-1,v=-1;let b=t.getEntityIndex(f.value(y.index)),x=r.byEntityKey[b],S=x?x.sequence.seqId.value(x.sequence.seqId.rowCount-1):-1,C=e.residueAtomSegments.index[y.start],w=e.residueAtomSegments.index[y.end-1],T=d.value(C),E=d.value(w);for(T===1&&E===S&&n.xyzDefined&&HB(C,w,n,l,u)&&(o.set(C,w),o.set(w,C));c.hasNext;){let t=c.move(),r=t.index,o=d.value(r);if(TI(p[r])&&m[r]!==-1)if(v!==-1)if(o!==h+1)i.push(v,_-1),a.push(g,t.end-1),v=t.start;else if(!c.hasNext)i.push(v,t.end-1);else{let r=e.residueAtomSegments.index[t.start],o=e.residueAtomSegments.index[_-1];n.xyzDefined&&!HB(r,o,n,e.index,u)&&(i.push(v,_-1),a.push(g,t.end-1),v=t.start)}else v=t.start;else v!==-1&&(i.push(v,_-1),v=-1);g=t.start,_=t.end,h=o}}return{polymerRanges:OR.ofSortedRanges(i),gapRanges:OR.ofSortedRanges(a),cyclicPolymerMap:o}}function wNe(e){let t=new Map,n=(e,t,n)=>`${e}|${t}|${n}`,r=e.pdbx_unobs_or_zero_occ_residues;for(let e=0,i=r._rowCount;e<i;++e){let i=n(r.PDB_model_num.value(e),r.label_asym_id.value(e),r.label_seq_id.value(e));t.set(i,{polymer_flag:r.polymer_flag.value(e),occupancy_flag:r.occupancy_flag.value(e)})}return{has:(e,r,i)=>t.has(n(e,r,i)),get:(e,r,i)=>t.get(n(e,r,i)),size:t.size}}function TNe(e){let t=new Map;if(e.chem_comp._rowCount>0){let{id:n}=e.chem_comp;for(let r=0,i=n.rowCount;r<i;++r)t.set(n.value(r),QD.getRow(e.chem_comp,r))}else WB(e).forEach(e=>{t.set(e,cDe(e))});return t}function ENe(e){let t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){let{comp_id:n,type:r,identifier:i}=e.pdbx_chem_comp_identifier;for(let e=0,a=n.rowCount;e<a;++e)if(r.value(e)===`SNFG CARBOHYDRATE SYMBOL`||r.value(e)===`SNFG CARB SYMBOL`){let r=i.value(e),a=BEe.get(r);a?t.set(n.value(e),a):console.warn(`Unknown SNFG name '${r}'`)}}if(e.chem_comp._rowCount>0){let{id:n,type:r}=e.chem_comp;for(let e=0,i=n.rowCount;e<i;++e){let i=n.value(e);if(t.has(i))continue;let a=r.value(e);QF.has(i)?t.set(i,QF.get(i)):CI(a,i)===iI.Saccharide&&t.set(i,qF)}}else{let n=WB(e);QF.forEach((e,r)=>{!t.has(r)&&n.has(r)&&t.set(r,e)})}return t}var WB=_A(e=>{let t=new Set,{label_comp_id:n,auth_comp_id:r}=e.atom_site,i=n.isDefined?n:r;for(let e=0,n=i.rowCount;e<n;++e)t.add(i.value(e));return t});function GB(e,t){let n=new Map,{auth_asym_id:r,label_asym_id:i,label_entity_id:a}=e.chains;for(let t=0,o=e.chains._rowCount;t<o;t++){let e=i.value(t);n.set(e,{id:e,auth_id:r.value(t),entity_id:a.value(t)})}if(t?.struct_asym._rowCount){let{id:e,entity_id:r}=t.struct_asym;for(let t=0,i=e.rowCount;t<i;++t){let i=e.value(t);n.has(i)||n.set(i,{id:i,auth_id:``,entity_id:r.value(t)})}}return n}const DNe=U.Schema.Aliased(U.Schema.Str());function KB(e){let t;if(e.entity.id.isDefined)t=e.entity;else{let n=new Set,r=[],i=[],{label_entity_id:a,label_comp_id:o}=e.atom_site;for(let t=0,s=e.atom_site._rowCount;t<s;t++){let e=a.value(t);n.has(e)||(r.push(e),i.push(lDe(o.value(t))),n.add(e))}let{entity_id:s}=e.ihm_sphere_obj_site;for(let t=0,a=e.ihm_sphere_obj_site._rowCount;t<a;t++){let e=s.value(t);n.has(e)||(r.push(e),i.push(`polymer`),n.add(e))}let{entity_id:c}=e.ihm_gaussian_obj_site;for(let t=0,a=e.ihm_gaussian_obj_site._rowCount;t<a;t++){let e=c.value(t);n.has(e)||(r.push(e),i.push(`polymer`),n.add(e))}t=QD.ofPartialColumns(NI.entity,{id:U.ofArray({array:r,schema:NI.entity.id}),type:U.ofArray({array:i,schema:NI.entity.type})},r.length)}let n=U.createIndexer(t.id),r=Array(t._rowCount);r.fill(`other`);let i=new Set,a=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){let{entity_id:t,type:a,_rowCount:o}=e.entity_poly;for(let e=0;e<o;++e){let o=t.value(e);r[n(o)]=a.value(e),i.add(o)}}else a=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){let{entity_id:t,type:a,_rowCount:o}=e.pdbx_entity_branch;for(let e=0;e<o;++e){let o=t.value(e);r[n(o)]=a.value(e),i.add(o)}}else a=!0;if(i.size<r.length&&(a=!0),a){let t=new Map;if(e.chem_comp){let{id:n,type:r}=e.chem_comp;for(let i=0,a=e.chem_comp._rowCount;i<a;i++)t.set(n.value(i),r.value(i))}if(e.atom_site){let{label_entity_id:a,label_comp_id:o}=e.atom_site;for(let s=0,c=e.atom_site._rowCount;s<c;s++){let e=a.value(s);if(!i.has(e)){let a=o.value(s),c=t.get(a)||`other`;r[n(e)]=uDe(a,c),i.add(e)}}}}let o=U.ofArray({array:r,schema:DNe});return{data:t,subtype:o,getEntityIndex:n}}function qB(e,t,n){if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;let r=Array(t.data._rowCount);r.fill(``);let{asym_id:i,prd_id:a,_rowCount:o}=e.pdbx_molecule;for(let e=0;e<o;++e){let o=i.value(e),s=n.get(o)?.entity_id;s!==void 0&&(r[t.getEntityIndex(s)]=a.value(e))}let s=U.ofArray({array:r,schema:U.Schema.str});return{...t,prd_id:s}}async function JB(e,t,n){let r=ONe(e,t),i=e.ihm_model_list._rowCount>0?await MNe(n,e,r,t):await jNe(n,e,r,t);for(let e=0;e<i.length;e++)DB.TrajectoryInfo.set(i[e],{index:e,size:i.length});return new vB(i)}function ONe(e,t){return{missingResidues:wNe(e),chemicalComponentMap:TNe(e),saccharideComponentMap:ENe(e)}}function kNe(e,t,n,r,i,a,o){let s=MB(t,n,r,i.chemicalComponentMap,a,o),c=t.pdbx_PDB_model_num.value(0);if(o&&s.sameAsPrevious)return{...o,id:zy.create22(),modelNum:c,atomicConformation:s.conformation,_dynamicPropertyData:Object.create(null)};let l=RB,u=BB(e,r,s.hierarchy,l.hierarchy),d=UB(s.hierarchy,r,s.conformation,u),f=GB(s.hierarchy),p=e.entry.id.valueKind(0)===U.ValueKinds.Present?e.entry.id.value(0):a.name,m=[];return p&&m.push(p),e.struct.title.valueKind(0)===U.ValueKinds.Present&&m.push(e.struct.title.value(0)),{id:zy.create22(),entryId:p,label:m.join(` | `),entry:p,sourceData:a,modelNum:c,parent:void 0,entities:qB(e,r,f),sequence:u,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:{...i,structAsymMap:f},customProperties:new FP,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function ANe(e,t,n,r){let i=MB(t.atom_site,t.atom_site_sourceIndex,t.entities,n.chemicalComponentMap,r),a=bNe(t,n.chemicalComponentMap),o=BB(e,t.entities,i.hierarchy,a.hierarchy),s=UB(i.hierarchy,t.entities,i.conformation,o),c=e.entry.id.valueKind(0)===U.ValueKinds.Present?e.entry.id.value(0):r.name,l=[];c&&l.push(c),e.struct.title.valueKind(0)===U.ValueKinds.Present&&l.push(e.struct.title.value(0)),t.model_name&&l.push(t.model_name),t.model_group_name&&l.push(t.model_group_name);let u=GB(i.hierarchy,e);return{id:zy.create22(),entryId:c,label:l.join(` | `),entry:c,sourceData:r,modelNum:t.model_id,parent:void 0,entities:qB(e,t.entities,u),sequence:o,atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,atomicRanges:s,atomicChainOperatorMappinng:i.chainOperatorMapping,coarseHierarchy:a.hierarchy,coarseConformation:a.conformation,properties:{...n,structAsymMap:u},customProperties:new FP,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function YB(e,t){let n=e.rowCount;if(!e.isDefined)return n;let r=t+1;for(;r<n&&e.areValuesEqual(t,r);)r++;return r}async function jNe(e,t,n,r){let i=[];if(t.atom_site){let a=t.atom_site.id.rowCount,o=KB(t),s=0;for(;s<a;){let a=YB(t.atom_site.pdbx_PDB_model_num,s),{atom_site:c,sourceIndex:l}=await VB(e,t.atom_site,s,a),u=kNe(t,c,l,o,n,r,i.length>0?i[i.length-1]:void 0);i.push(u),s=a}}return i}function XB(e,t){let n=new Map,r=e._rowCount,i=0;for(;i<r;){let r=YB(t,i),a=t.value(i);n.set(a,{table:QD.window(e,e._schema,i,r),start:i,end:r}),i=r}return n}async function MNe(e,t,n,r){let i=KB(t),a=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,o=XB(t.atom_site,a),s=XB(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),c=XB(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),l=[];if(t.ihm_model_list){let{model_id:a,model_name:u}=t.ihm_model_list;for(let d=0;d<t.ihm_model_list._rowCount;d++){let f=a.value(d),p,m;if(o.has(f)){let n=o.get(f),{atom_site:r,sourceIndex:i}=await VB(e,t.atom_site,n.start,n.end);p=r,m=i}else p=QD.window(t.atom_site,t.atom_site._schema,0,0),m=U.ofIntArray([]);let h=ANe(t,{model_id:f,model_name:u.value(d),model_group_name:fDe(f,t),entities:i,atom_site:p,atom_site_sourceIndex:m,ihm_sphere_obj_site:s.has(f)?s.get(f).table:QD.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:c.has(f)?c.get(f).table:QD.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},n,r);l.push(h)}}return l}function NNe(e,t){let n=e.atomName,r=e.residueName,i=Array(e.count),a=Array(e.count),o=new Uint32Array(e.count),s=new Uint32Array(e.count),c=Array(e.count),l=new BI,u=new LI(e.residueNumber,e.atomName),d=``,f=0,p=``,m=0,h=iI.Unknown,g=-1;for(let t=0,n=e.count;t<n;++t){let n=e.residueNumber.value(t);if(n!==g){let r=e.residueName.value(t),i=CI(u.add(r,t).type,r);(i!==h||n!==g+1&&!(g===99999&&n===0))&&(p=zI(f),f+=1,m=0),d=l.getEntityId(r,i,p),m+=1,g=n,h=i}i[t]=d,a[t]=p,o[t]=m,s[t]=t,c[t]=HF(e.atomName.value(t),e.residueName.value(t))}let _=U.ofStringArray(a),v=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:_,auth_atom_id:n,auth_comp_id:r,auth_seq_id:e.residueNumber,Cartn_x:U.ofFloatArray(U.mapToArray(e.x,e=>e*10,Float32Array)),Cartn_y:U.ofFloatArray(U.mapToArray(e.y,e=>e*10,Float32Array)),Cartn_z:U.ofFloatArray(U.mapToArray(e.z,e=>e*10,Float32Array)),id:U.ofIntArray(s),label_asym_id:_,label_atom_id:n,label_comp_id:r,label_seq_id:U.ofIntArray(o),label_entity_id:U.ofStringArray(i),occupancy:U.ofConst(1,e.count,U.Schema.float),type_symbol:U.ofStringArray(c),pdbx_PDB_model_num:U.ofConst(t,e.count,U.Schema.int)},e.count);return PI({entity:l.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:v})}var ZB;(function(e){function t(e){return e?.kind===`gro`}e.is=t;function n(e){return{kind:`gro`,name:e.structures[0].header.title,data:e}}e.fromGro=n})(ZB||={});function PNe(e){return hb.create(`Parse GRO`,async t=>{let n=ZB.fromGro(e),r=[];for(let i=0,a=e.structures.length;i<a;++i){let a=await JB(NNe(e.structures[i].atoms,i+1),n,t);a.frameCount===1&&r.push(a.representative)}return new vB(r)})}function FNe(e,t){let n=(e,n)=>(t.substr(e,n)||``).trim(),r={entry_id:rO.ofString(e),length_a:rO.ofString(n(6,9)),length_b:rO.ofString(n(15,9)),length_c:rO.ofString(n(24,9)),angle_alpha:rO.ofString(n(33,7)),angle_beta:rO.ofString(n(40,7)),angle_gamma:rO.ofString(n(47,7)),Z_PDB:rO.ofString(n(66,4)),pdbx_unique_axis:rO.ofString(`?`)},i={entry_id:rO.ofString(e),"space_group_name_H-M":rO.ofString(n(55,11)),Int_Tables_number:rO.ofString(`?`),cell_setting:rO.ofString(`?`),space_group_name_Hall:rO.ofString(`?`)};return[nO.ofFields(`cell`,r),nO.ofFields(`symmetry`,i)]}function QB(e,t){return{id:e,details:t,groups:[]}}function INe(e,t,n){let r=[],i,a,o,s=1,c=1,l=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]);for(let e=t;e<n;e++){let t=l(e);if(t.substr(11,12)===`BIOMOLECULE:`){let n=t.substr(23).trim(),a=`Biomolecule ${n}`;t=l(e+1),t.substr(11,30)!==`APPLY THE FOLLOWING TO CHAINS:`&&(e++,a=t.substr(11).trim()),i=QB(n,a),r.push(i)}else if(t.substr(13,5)===`BIOMT`){let e=t.split(/\s+/),n=parseInt(t[18])-1;n===0&&(o=z.identity(),a.operators.push({id:s++,matrix:o})),z.setValue(o,n,0,parseFloat(e[4])),z.setValue(o,n,1,parseFloat(e[5])),z.setValue(o,n,2,parseFloat(e[6])),z.setValue(o,n,3,parseFloat(e[7]))}else if(t.substr(11,30)===`APPLY THE FOLLOWING TO CHAINS:`||t.substr(11,30)===`                   AND CHAINS:`){t.substr(11,5)===`APPLY`&&(a={chains:[],operators:[]},i.groups.push(a));let e=t.substr(41,30).split(`,`);for(let t=0,n=e.length;t<n;++t){let n=e[t].trim();n&&a.chains.push(n)}}else if(t.substr(11,33)===`APPLYING THE FOLLOWING TO CHAINS:`){i=QB(`${c}`,`Biomolecule ${c}`),r.push(i),c+=1,a={chains:[],operators:[]},i.groups.push(a),e++,t=l(e);let n=t.substr(11,69).split(`,`);for(let e=0,t=n.length;e<t;++e){let t=n[e].trim();t&&a.chains.push(t)}}}if(r.length===0)return[];let u={id:rO.ofStrings(r.map(e=>e.id)),details:rO.ofStrings(r.map(e=>e.details))},d=[];for(let e of r)for(let t of e.groups)d.push({assembly_id:e.id,oper_expression:t.operators.map(e=>e.id).join(`,`),asym_id_list:t.chains.join(`,`)});let f={assembly_id:rO.ofStrings(d.map(e=>e.assembly_id)),oper_expression:rO.ofStrings(d.map(e=>e.oper_expression)),asym_id_list:rO.ofStrings(d.map(e=>e.asym_id_list))},p=[];for(let e of r)for(let t of e.groups)for(let e of t.operators){let t={id:``+e.id,type:`?`,name:`?`,symmetry_operation:`?`};for(let n=0;n<3;n++){for(let r=0;r<3;r++)t[`matrix[${n+1}][${r+1}]`]=``+z.getValue(e.matrix,n,r);t[`vector[${n+1}]`]=``+z.getValue(e.matrix,n,3)}p.push(t)}let m={id:rO.ofStrings(p.map(e=>e.id)),type:rO.ofStrings(p.map(e=>e.type)),name:rO.ofStrings(p.map(e=>e.name)),symmetry_operation:rO.ofStrings(p.map(e=>e.symmetry_operation))};for(let e=0;e<3;e++){for(let t=0;t<3;t++){let n=`matrix[${e+1}][${t+1}]`;m[n]=rO.ofStrings(p.map(e=>e[n]))}let t=`vector[${e+1}]`;m[t]=rO.ofStrings(p.map(e=>e[t]))}return[nO.ofFields(`pdbx_struct_assembly`,u),nO.ofFields(`pdbx_struct_assembly_gen`,f),nO.ofFields(`pdbx_struct_oper_list`,m)]}function LNe(e,t,n){let r=[],i,a=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]);for(let e=t;e<n;e++){let t=a(e),n=t.split(/\s+/),o=parseInt(t[5])-1;o===0&&(i=z.identity(),r.push(i)),z.setValue(i,o,0,parseFloat(n[2])),z.setValue(i,o,1,parseFloat(n[3])),z.setValue(i,o,2,parseFloat(n[4])),z.setValue(i,o,3,parseFloat(n[5]))}if(r.length===0)return[];let o=[],s=1;for(let e of r){let t={id:`ncsop`+ s++,code:`.`,details:`.`};for(let n=0;n<3;n++){for(let r=0;r<3;r++)t[`matrix[${n+1}][${r+1}]`]=``+z.getValue(e,n,r);t[`vector[${n+1}]`]=``+z.getValue(e,n,3)}o.push(t)}let c={id:rO.ofStrings(o.map(e=>e.id)),code:rO.ofStrings(o.map(e=>e.code)),details:rO.ofStrings(o.map(e=>e.details))};for(let e=0;e<3;e++){for(let t=0;t<3;t++){let n=`matrix[${e+1}][${t+1}]`;c[n]=rO.ofStrings(o.map(e=>e[n]))}let t=`vector[${e+1}]`;c[t]=rO.ofStrings(o.map(e=>e[t]))}return[nO.ofFields(`struct_ncs_oper`,c)]}var RNe={1:`helx_rh_al_p`,2:`helx_rh_om_p`,3:`helx_rh_pi_p`,4:`helx_rh_ga_p`,5:`helx_rh_3t_p`,6:`helx_lh_al_p`,7:`helx_lh_om_p`,8:`helx_lh_ga_p`,9:`helx_rh_27_p`,10:`helx_rh_pp_p`};function zNe(e){return RNe[e]||`helx_p`}function BNe(e,t,n){let r=[],i=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]);for(let e=t;e<n;e++){let t=i(e);r.push({serNum:t.substring(7,10).trim(),helixID:t.substring(11,14).trim(),initResName:t.substring(15,19).trim(),initChainID:t.substring(19,20).trim(),initSeqNum:t.substring(21,25).trim(),initICode:t.substring(25,26).trim(),endResName:t.substring(27,31).trim(),endChainID:t.substring(31,34).trim(),endSeqNum:t.substring(33,37).trim(),endICode:t.substring(37,38).trim(),helixClass:t.substring(38,40).trim(),comment:t.substring(40,70).trim(),length:t.substring(71,76).trim()})}let a=rO.ofStrings(r.map(e=>e.initChainID)),o=rO.ofStrings(r.map(e=>e.initResName)),s=rO.ofStrings(r.map(e=>e.endChainID)),c=rO.ofStrings(r.map(e=>e.endResName)),l={beg_label_asym_id:a,beg_label_comp_id:o,beg_label_seq_id:rO.ofUndefined(r.length,U.Schema.int),beg_auth_asym_id:a,beg_auth_comp_id:o,beg_auth_seq_id:rO.ofStrings(r.map(e=>e.initSeqNum)),conf_type_id:rO.ofStrings(r.map(e=>zNe(e.helixClass))),details:rO.ofStrings(r.map(e=>e.comment)),end_label_asym_id:s,end_label_comp_id:c,end_label_seq_id:rO.ofUndefined(r.length,U.Schema.int),end_auth_asym_id:s,end_auth_comp_id:c,end_auth_seq_id:rO.ofStrings(r.map(e=>e.endSeqNum)),id:rO.ofStrings(r.map(e=>e.serNum)),pdbx_beg_PDB_ins_code:rO.ofStrings(r.map(e=>e.initICode)),pdbx_end_PDB_ins_code:rO.ofStrings(r.map(e=>e.endICode)),pdbx_PDB_helix_class:rO.ofStrings(r.map(e=>e.helixClass)),pdbx_PDB_helix_length:rO.ofStrings(r.map(e=>e.length)),pdbx_PDB_helix_id:rO.ofStrings(r.map(e=>e.helixID))};return nO.ofFields(`struct_conf`,l)}function VNe(e,t,n){let r=[],i=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]);for(let e=t;e<n;e++){let t=i(e);r.push({strand:t.substring(7,10).trim(),sheetID:t.substring(11,14).trim(),numStrands:t.substring(14,16).trim(),initResName:t.substring(17,21).trim(),initChainID:t.substring(21,22).trim(),initSeqNum:t.substring(22,26).trim(),initICode:t.substring(26,27).trim(),endResName:t.substring(28,32).trim(),endChainID:t.substring(32,33).trim(),endSeqNum:t.substring(33,37).trim(),endICode:t.substring(37,38).trim(),sense:t.substring(38,40).trim(),curAtom:t.substring(41,45).trim(),curResName:t.substring(45,49).trim(),curChainId:t.substring(49,50).trim(),curResSeq:t.substring(50,54).trim(),curICode:t.substring(54,55).trim(),prevAtom:t.substring(56,60).trim(),prevResName:t.substring(60,64).trim(),prevChainId:t.substring(64,65).trim(),prevResSeq:t.substring(65,69).trim(),prevICode:t.substring(69,70).trim()})}let a=rO.ofStrings(r.map(e=>e.initChainID)),o=rO.ofStrings(r.map(e=>e.initResName)),s=rO.ofStrings(r.map(e=>e.initSeqNum)),c=rO.ofStrings(r.map(e=>e.endChainID)),l=rO.ofStrings(r.map(e=>e.endResName)),u=rO.ofStrings(r.map(e=>e.endSeqNum)),d={beg_label_asym_id:a,beg_label_comp_id:o,beg_label_seq_id:s,beg_auth_asym_id:a,beg_auth_comp_id:o,beg_auth_seq_id:s,end_label_asym_id:c,end_label_comp_id:c,end_label_seq_id:u,end_auth_asym_id:c,end_auth_comp_id:l,end_auth_seq_id:u,id:rO.ofStrings(r.map(e=>e.strand)),sheet_id:rO.ofStrings(r.map(e=>e.sheetID)),pdbx_beg_PDB_ins_code:rO.ofStrings(r.map(e=>e.initICode)),pdbx_end_PDB_ins_code:rO.ofStrings(r.map(e=>e.endICode))};return nO.ofFields(`struct_sheet_range`,d)}var HNe={MOL_ID:``,MOLECULE:``,CHAIN:``,FRAGMENT:``,SYNONYM:``,EC:``,ENGINEERED:``,MUTATION:``,OTHER_DETAILS:``};function UNe(e,t,n){let r=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]),i,a={chains:[],description:``},o=[];for(let e=t;e<n;e++){let t=r(e).substr(10,70).trim(),n=t.indexOf(`:`),s=t.substring(0,n),c;s in HNe?(i=s,c=t.substring(n+2)):c=t,c=c.replace(/;$/,``),i===`MOL_ID`?(a={chains:[],description:``},o.push(a)):i===`MOLECULE`?(a.description&&(a.description+=` `),a.description+=c):i===`CHAIN`&&Array.prototype.push.apply(a.chains,c.split(/\s*,\s*/))}let s=[];for(let e of o)for(let t of e.chains)s.push({description:e.description,chains:[t]});return s}function WNe(e,t,n){let r=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]),i=new Map;for(let e=t;e<n;e++){let t=r(e),n=t.substr(11,3).trim(),a=t.substr(15).trim();i.has(n)?i.set(n,`${i.get(n)} ${a}`):i.set(n,a)}return i}function GNe(e,t){let n=()=>[],r=()=>aO.create(e,2*t);return{index:0,group_PDB:r(),id:n(),auth_atom_id:r(),label_alt_id:r(),auth_comp_id:r(),auth_asym_id:r(),auth_seq_id:r(),pdbx_PDB_ins_code:r(),Cartn_x:r(),Cartn_y:r(),Cartn_z:r(),occupancy:r(),B_iso_or_equiv:r(),type_symbol:r(),pdbx_PDB_model_num:n(),label_entity_id:n(),partial_charge:r()}}var KNe=class{constructor(e,t,n,r){this.asymIds=e,this.modelNums=t,this.terIndices=n,this.hasAssemblies=r,this.asymIdCounts=new Map,this.currModelNum=void 0,this.currAsymId=``,this.currLabelAsymId=``}clear(){this.asymIdCounts.clear(),this.currModelNum=void 0}get(e){let t=this.asymIds.value(e);if(this.hasAssemblies)return t;let n=this.modelNums[e];if(n===this.currModelNum?this.currAsymId!==t&&(this.currAsymId=t,this.currLabelAsymId=t):(this.asymIdCounts.clear(),this.currModelNum=n,this.currLabelAsymId=t),this.asymIdCounts.has(t)){if(this.terIndices.has(e)){let e=this.asymIdCounts.get(t)+1;this.asymIdCounts.set(t,e),this.currLabelAsymId=`${t}_${e}`}}else this.asymIdCounts.set(t,0);return this.currLabelAsymId}};function qNe(e,t,n){t.clear();let r=rO.ofStrings(e.pdbx_PDB_model_num),i=rO.ofTokens(e.auth_asym_id),a=rO.ofTokens(e.auth_seq_id),o=rO.ofTokens(e.pdbx_PDB_ins_code),s=rO.ofTokens(e.auth_atom_id),c=rO.ofTokens(e.auth_comp_id),l=rO.ofStrings(e.id),u=r.str(0),d=i.str(0),f=a.int(0),p=o.str(0),m=f,h=new Map,g=new Map,_=[],v=[],y=[],b=!1;for(let e=0,t=l.rowCount;e<t;++e)if(o.str(e)!==``){b=!0;break}for(let e=0,n=l.rowCount;e<n;++e){let n=r.str(e),c=i.str(e),l=a.int(e),x=o.str(e),S=s.str(e);if(n===u?d===c?f===l?p!==x&&(g.clear(),p=x,m+=1):(g.clear(),f===m?m=l:m+=1,f=l,p=x):(g.clear(),d=c,f=l,p=x,m=l):(h.clear(),g.clear(),u=n,d=c,f=l,p=x,m=l),_[e]=t.get(e),g.has(S)){let e=g.get(S)+1;g.set(S,e),S=`${S}_${e}`}else g.set(S,0);v[e]=S,b&&(y[e]=m)}let x=U.ofStringArray(_),S=U.ofStringArray(v),C=b?rO.ofColumn(U.ofIntArray(y)):rO.ofUndefined(e.index,U.Schema.int);return{auth_asym_id:i,auth_atom_id:s,auth_comp_id:c,auth_seq_id:a,B_iso_or_equiv:rO.ofTokens(e.B_iso_or_equiv),Cartn_x:rO.ofTokens(e.Cartn_x),Cartn_y:rO.ofTokens(e.Cartn_y),Cartn_z:rO.ofTokens(e.Cartn_z),group_PDB:rO.ofTokens(e.group_PDB),id:l,label_alt_id:rO.ofTokens(e.label_alt_id),label_asym_id:rO.ofColumn(x),label_atom_id:rO.ofColumn(S),label_comp_id:c,label_seq_id:C,label_entity_id:rO.ofStrings(e.label_entity_id),occupancy:Nhe(e.occupancy)?rO.ofUndefined(e.index,U.Schema.float):rO.ofTokens(e.occupancy),type_symbol:rO.ofTokens(e.type_symbol),pdbx_PDB_ins_code:rO.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:r,partial_charge:rO.ofTokens(e.partial_charge)}}function $B(e,t,n,r,i,a){let{data:o}=n,s=i-r;aO.addToken(e.group_PDB,iO.trim(n,r,r+6)),iO.trim(n,r+6,r+11),e.id[e.index]=n.data.substring(n.tokenStart,n.tokenEnd),aO.addToken(e.auth_atom_id,iO.trim(n,r+12,r+16)),o.charCodeAt(r+16)===32?aO.add(e.label_alt_id,0,0):aO.add(e.label_alt_id,r+16,r+17),aO.addToken(e.auth_comp_id,iO.trim(n,r+17,r+21)),aO.add(e.auth_asym_id,r+21,r+22),aO.addToken(e.auth_seq_id,iO.trim(n,r+22,r+26)),o.charCodeAt(r+26)===32?aO.add(e.pdbx_PDB_ins_code,0,0):aO.add(e.pdbx_PDB_ins_code,r+26,r+27),aO.addToken(e.Cartn_x,iO.trim(n,r+30,r+38)),aO.addToken(e.Cartn_y,iO.trim(n,r+38,r+46)),aO.addToken(e.Cartn_z,iO.trim(n,r+46,r+54)),aO.addToken(e.occupancy,iO.trim(n,r+54,r+60)),s>=66?aO.addToken(e.B_iso_or_equiv,iO.trim(n,r+60,r+66)):aO.add(e.B_iso_or_equiv,0,0),a&&aO.addToken(e.partial_charge,iO.trim(n,r+70,r+76)),s>=78&&!a?(iO.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?aO.addToken(e.type_symbol,n):VF(e.type_symbol,o,r+12,r+16)):VF(e.type_symbol,o,r+12,r+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function JNe(e,t){let n=()=>[],r=()=>new Float32Array(t),i=()=>aO.create(e,2*t);return{index:0,count:t,id:n(),type_symbol:i(),pdbx_label_atom_id:i(),pdbx_label_alt_id:i(),pdbx_label_comp_id:i(),pdbx_label_asym_id:i(),pdbx_label_seq_id:i(),pdbx_PDB_ins_code:i(),"U[1][1]":r(),"U[2][2]":r(),"U[3][3]":r(),"U[1][2]":r(),"U[1][3]":r(),"U[2][3]":r(),pdbx_auth_seq_id:i(),pdbx_auth_comp_id:i(),pdbx_auth_asym_id:i(),pdbx_auth_atom_id:i()}}function YNe(e){let t=rO.ofTokens(e.pdbx_auth_seq_id),n=rO.ofTokens(e.pdbx_auth_comp_id),r=rO.ofTokens(e.pdbx_auth_asym_id),i=rO.ofTokens(e.pdbx_auth_atom_id),a={id:rO.ofStrings(e.id),type_symbol:rO.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:rO.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:n,pdbx_label_asym_id:r,pdbx_label_seq_id:t,pdbx_PDB_ins_code:rO.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:n,pdbx_auth_asym_id:r,pdbx_auth_atom_id:i};return a[`U[1][1]`]=rO.ofNumbers(e[`U[1][1]`]),a[`U[2][2]`]=rO.ofNumbers(e[`U[2][2]`]),a[`U[3][3]`]=rO.ofNumbers(e[`U[3][3]`]),a[`U[1][2]`]=rO.ofNumbers(e[`U[1][2]`]),a[`U[1][3]`]=rO.ofNumbers(e[`U[1][3]`]),a[`U[2][3]`]=rO.ofNumbers(e[`U[2][3]`]),a}function XNe(e,t,n,r,i){let{data:a}=n,o=i-r;iO.trim(n,r+6,r+11),e.id[e.index]=a.substring(n.tokenStart,n.tokenEnd),aO.addToken(e.pdbx_auth_atom_id,iO.trim(n,r+12,r+16)),a.charCodeAt(r+16)===32?aO.add(e.pdbx_label_alt_id,0,0):aO.add(e.pdbx_label_alt_id,r+16,r+17),aO.addToken(e.pdbx_auth_comp_id,iO.trim(n,r+17,r+21)),aO.add(e.pdbx_auth_asym_id,r+21,r+22),aO.addToken(e.pdbx_auth_seq_id,iO.trim(n,r+22,r+26)),a.charCodeAt(r+26)===32?aO.add(e.pdbx_PDB_ins_code,0,0):aO.add(e.pdbx_PDB_ins_code,r+26,r+27),e[`U[1][1]`][e.index]=VD(a,r+28,r+35)/1e4,e[`U[2][2]`][e.index]=VD(a,r+35,r+42)/1e4,e[`U[3][3]`][e.index]=VD(a,r+42,r+49)/1e4,e[`U[1][2]`][e.index]=VD(a,r+49,r+56)/1e4,e[`U[1][3]`][e.index]=VD(a,r+56,r+63)/1e4,e[`U[2][3]`][e.index]=VD(a,r+63,r+70)/1e4,o>=78?(iO.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?aO.addToken(e.type_symbol,n):VF(e.type_symbol,a,r+12,r+16)):VF(e.type_symbol,a,r+12,r+16),e.index++}function ZNe(e,t,n,r){let i={};for(let e=0,t=r.id.rowCount;e<t;++e)i[r.id.str(e)]=e;let a=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]),o=[],s=[],c=[],l=[],u=[],d=[],f=[],p=[],m=[],h=[],g=[],_=[],v=[],y=[],b=[],x=[11,16,21,26],S=1,C=-1,w={},T=!1;for(let e=t;e<n;e++){let t=a(e),n=i[parseInt(t.substr(6,5))];if(n!==void 0){C!==n&&(C=n,w={});for(let e=0;e<4;++e){let a=parseInt(t.substr(x[e],5));if(Number.isNaN(a))continue;let C=i[a];if(C!==void 0&&!(n>C)){if(w[C]!==void 0){c[w[C]]+=1,T=!0;continue}w[C]=S-1,o.push(`covale${S}`),s.push(`covale`),c.push(1),l.push(r.label_asym_id.str(n)),u.push(r.label_seq_id.int(n)),d.push(r.auth_seq_id.int(n)),f.push(r.label_atom_id.str(n)),p.push(r.label_alt_id.str(n)),m.push(r.pdbx_PDB_ins_code.str(n)),h.push(r.label_asym_id.str(C)),g.push(r.label_seq_id.int(C)),_.push(r.auth_seq_id.int(C)),v.push(r.label_atom_id.str(C)),y.push(r.label_alt_id.str(C)),b.push(r.pdbx_PDB_ins_code.str(C)),S+=1}}}}let E={id:rO.ofStrings(o),conn_type_id:rO.ofStrings(s),ptnr1_label_asym_id:rO.ofStrings(l),ptnr1_label_seq_id:rO.ofNumbers(u),ptnr1_auth_seq_id:rO.ofNumbers(d),ptnr1_label_atom_id:rO.ofStrings(f),pdbx_ptnr1_label_alt_id:rO.ofStrings(p),pdbx_ptnr1_PDB_ins_code:rO.ofStrings(m),ptnr2_label_asym_id:rO.ofStrings(h),ptnr2_label_seq_id:rO.ofNumbers(g),ptnr2_auth_seq_id:rO.ofNumbers(_),ptnr2_label_atom_id:rO.ofStrings(v),pdbx_ptnr2_label_alt_id:rO.ofStrings(y),pdbx_ptnr2_PDB_ins_code:rO.ofStrings(b)};if(T){let e=[`sing`,`doub`,`trpl`,`quad`];E.pdbx_value_order=rO.ofStrings(c.map(t=>e[t-1]||`sing`))}return nO.ofFields(`struct_conn`,E)}function QNe(e,t,n,r){let i=e.substring(t,n);r.id_code=i.substring(62,66).trim()||void 0,r.dep_date=i.substring(50,59).trim()||void 0,r.classification=i.substring(10,50).trim()||void 0}function eV(e,t,n,r){let i=r.length;if(i>n-t)return!1;for(let n=0;n<i;n++)if(e.charCodeAt(t+n)!==r.charCodeAt(n))return!1;return!0}async function $Ne(e){let{lines:t}=e,{data:n,indices:r}=t,i=iO(n),a=!!e.isPdbqt,o=0,s=0;for(let e=0,i=t.count;e<i;e++){let t=r[2*e],i=r[2*e+1];switch(n.charAt(t)){case`A`:eV(n,t,i,`ATOM  `)?o++:eV(n,t,i,`ANISOU`)&&s++;break;case`H`:eV(n,t,i,`HETATM`)&&o++;break}}let c={},l=GNe(n,o),u=JNe(n,s),d=new BI,f=[],p=[],m=0,h=``,g,_=!1,v=new Set;for(let o=0,s=t.count;o<s;o++){let s=r[2*o],y=r[2*o+1];switch(n.charAt(s)){case`A`:eV(n,s,y,`ATOM  `)?(m||(m++,h=``+m),$B(l,h,i,s,y,a)):eV(n,s,y,`ANISOU`)&&XNe(u,h,i,s,y);break;case`C`:if(eV(n,s,y,`CRYST1`))f.push(...FNe(e.id||`?`,n.substring(s,y)));else if(eV(n,s,y,`CONECT`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`CONECT`);)e++;g?Qy&&console.log(`only single CONECT block allowed, ignoring others`):g=[o,e],o=e-1}else if(eV(n,s,y,`COMPND`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`COMPND`);)e++;d.setCompounds(UNe(t,o,e)),o=e-1}break;case`H`:if(eV(n,s,y,`HEADER`))QNe(n,s,y,c);else if(eV(n,s,y,`HETATM`))m||(m++,h=``+m),$B(l,h,i,s,y,a);else if(eV(n,s,y,`HELIX`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`HELIX`);)e++;f.push(BNe(t,o,e)),o=e-1}else if(eV(n,s,y,`HETNAM`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`HETNAM`);)e++;p.push(...Array.from(WNe(t,o,e).entries())),o=e-1}break;case`M`:if(eV(n,s,y,`MODEL `)&&(m++,h=``+m),eV(n,s,y,`MTRIX`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`MTRIX`);)e++;f.push(...LNe(t,o,e)),o=e-1}break;case`O`:break;case`R`:if(eV(n,s,y,`REMARK 350`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`REMARK 350`);)e++;f.push(...INe(t,o,e)),o=e-1,_=!0}break;case`S`:if(eV(n,s,y,`SHEET`)){let e=o+1;for(;s=r[2*e],y=r[2*e+1],eV(n,s,y,`SHEET`);)e++;f.push(VNe(t,o,e)),o=e-1}break;case`T`:eV(n,s,y,`TER`)&&v.add(l.index)}}if(c.id_code){let e={id:rO.ofString(c.id_code)};f.push(nO.ofFields(`entry`,e))}if(c.classification){let e={pdbx_keywords:rO.ofString(c.classification)};f.push(nO.ofFields(`struct_keywords`,e))}if(c.dep_date){let e={recvd_initial_deposition_date:rO.ofString(c.dep_date)};f.push(nO.ofFields(`pdbx_database_status`,e))}let y=U.ofIntTokens(l.auth_seq_id),b=U.ofStringTokens(l.auth_atom_id),x=U.ofStringTokens(l.auth_comp_id),S=new KNe(U.ofStringTokens(l.auth_asym_id),l.pdbx_PDB_model_num,v,_),C=new LI(y,b);C.setNames(p),d.setNames(p);for(let e=0,t=x.rowCount;e<t;++e){let t=x.value(e),n=CI(C.add(t,e).type,t),r=S.get(e);l.label_entity_id[e]=d.getEntityId(t,n,r)}let w=qNe(l,S,{hasAssemblies:_});a||delete w.partial_charge,g&&f.push(ZNe(t,g[0],g[1],w));let T={entity:nO.ofTable(`entity`,d.getEntityTable()),chem_comp:nO.ofTable(`chem_comp`,C.getChemCompTable()),atom_site:nO.ofFields(`atom_site`,w),atom_site_anisotrop:nO.ofFields(`atom_site_anisotrop`,YNe(u))};for(let e of f)T[e.name]=e;return{header:e.id||`PDB`,categoryNames:Object.keys(T),categories:T}}var tV;(function(e){e.Descriptor={name:`atom_partial_charge`},e.Provider=JI.create(e.Descriptor)})(tV||={});var nV;(function(e){function t(e){return e?.kind===`pdb`}e.is=t;function n(e){return{kind:`pdb`,name:e.id||``,data:e}}e.create=n})(nV||={});function ePe(e){return hb.create(`Parse PDB`,async t=>{await t.update(`Converting to mmCIF`);let n=await $Ne(e),r=CB.fromFrame(n,void 0,nV.create(e)),i=await JB(PI(r.data.db,!0),r,t),a=n.categories.atom_site?.getField(`partial_charge`);if(a&&i.frameCount===1){let e=i.representative,t=e.atomicHierarchy.atomSourceIndex,n=U.isIdentity(t)?void 0:t.toArray({array:Int32Array}),r=a.toFloatArray(),o=n?U.ofFloatArray(U.mapToArray(t,e=>r[e],Float32Array)):U.ofFloatArray(r);tV.Provider.set(e,{data:o,type:`GASTEIGER`})}return i})}function tPe(e){let t=Array(e.count),n=Array(e.count),r=new Uint32Array(e.count),i=new Uint32Array(e.count),a=Array(e.count),o=new BI,s=new LI(e.residueId,e.atomName),c=``,l=0,u=``,d=0,f=e.segmentName.value(0),p=!1,m=iI.Unknown,h=-1;for(let g=0,_=e.count;g<_;++g){let _=e.residueId.value(g),v=e.segmentName.value(g);if(f===v?p=!1:(u=zI(l),l+=1,d=0,p=!0,f=v),p||_!==h){let t=e.residueName.value(g),n=CI(s.add(t,g).type,t);!p&&(n!==m||_!==h+1)&&(u=zI(l),l+=1,d=0),c=o.getEntityId(t,n,u),d+=1,h=_,m=n}t[g]=c,n[g]=u,r[g]=d,i[g]=g,a[g]=HF(e.atomName.value(g),e.residueName.value(g))}let g=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:U.ofIntArray(i),label_asym_id:U.ofStringArray(n),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:U.ofIntArray(r),label_entity_id:U.ofStringArray(t),occupancy:U.ofConst(1,e.count,U.Schema.float),type_symbol:U.ofStringArray(a),pdbx_PDB_model_num:U.ofConst(1,e.count,U.Schema.int)},e.count);return PI({entity:o.getEntityTable(),chem_comp:s.getChemCompTable(),atom_site:g})}var rV;(function(e){function t(e){return e?.kind===`psf`}e.is=t;function n(e){return{kind:`psf`,name:e.id,data:e}}e.fromPsf=n})(rV||={});function nPe(e){return hb.create(`Parse PSF`,async t=>{let n=rV.fromPsf(e),r=tPe(e.atoms),{atomIdA:i,atomIdB:a}=e.bonds,o={indexA:U.ofLambda({value:e=>i.value(e)-1,rowCount:i.rowCount,schema:i.schema}),indexB:U.ofLambda({value:e=>a.value(e)-1,rowCount:a.rowCount,schema:a.schema}),order:U.ofConst(1,e.bonds.count,U.Schema.int)};return QI.create(e.id,r,o,n)})}function rPe(e){return Object.keys(e).filter(e=>!isNaN(e)).map(e=>+e).sort((e,t)=>e-t).map(t=>e[t])}function iV(e,t,n){return e&&e[t]!==void 0?e[t]:n}function aV(e,...t){return{kind:`alias`,aliases:t,symbol:e}}function oV(e,t,...n){return e.info.namespace=`molscript-macro`,e.id=`molscript-macro.${e.info.name}`,{kind:`macro`,symbol:e,translate:t,aliases:[e.info.name,...n]}}function iPe(e){return e.kind===`alias`||e.kind===`macro`}const aPe=[[`Core symbols`,aV(X.core.type.bool,`bool`),aV(X.core.type.num,`num`),aV(X.core.type.str,`str`),aV(X.core.type.regex,`regex`),aV(X.core.type.list,`list`),aV(X.core.type.set,`set`),aV(X.core.type.compositeKey,`composite-key`),aV(X.core.logic.not,`not`),aV(X.core.logic.and,`and`),aV(X.core.logic.or,`or`),aV(X.core.ctrl.if,`if`),aV(X.core.ctrl.fn,`fn`),aV(X.core.ctrl.eval,`eval`),aV(X.core.math.add,`add`,`+`),aV(X.core.math.sub,`sub`,`-`),aV(X.core.math.mult,`mult`,`*`),aV(X.core.math.div,`div`,`/`),aV(X.core.math.pow,`pow`,`**`),aV(X.core.math.mod,`mod`),aV(X.core.math.min,`min`),aV(X.core.math.max,`max`),aV(X.core.math.cantorPairing,`cantor-pairing`),aV(X.core.math.sortedCantorPairing,`sorted-cantor-pairing`),aV(X.core.math.invertCantorPairing,`invert-cantor-pairing`),aV(X.core.math.floor,`floor`),aV(X.core.math.ceil,`ceil`),aV(X.core.math.roundInt,`round`),aV(X.core.math.trunc,`trunc`),aV(X.core.math.abs,`abs`),aV(X.core.math.sign,`sign`),aV(X.core.math.sqrt,`sqrt`),aV(X.core.math.cbrt,`cbrt`),aV(X.core.math.sin,`sin`),aV(X.core.math.cos,`cos`),aV(X.core.math.tan,`tan`),aV(X.core.math.asin,`asin`),aV(X.core.math.acos,`acos`),aV(X.core.math.atan,`atan`),aV(X.core.math.sinh,`sinh`),aV(X.core.math.cosh,`cosh`),aV(X.core.math.tanh,`tanh`),aV(X.core.math.exp,`exp`),aV(X.core.math.log,`log`),aV(X.core.math.log10,`log10`),aV(X.core.math.atan2,`atan2`),aV(X.core.rel.eq,`eq`,`=`),aV(X.core.rel.neq,`neq`,`!=`),aV(X.core.rel.lt,`lt`,`<`),aV(X.core.rel.lte,`lte`,`<=`),aV(X.core.rel.gr,`gr`,`>`),aV(X.core.rel.gre,`gre`,`>=`),aV(X.core.rel.inRange,`in-range`),aV(X.core.str.concat,`concat`),aV(X.core.str.match,`regex.match`),aV(X.core.list.getAt,`list.get`),aV(X.core.set.has,`set.has`),aV(X.core.set.isSubset,`set.subset`)],[`Structure`,[`Types`,aV(X.structureQuery.type.entityType,`ent-type`),aV(X.structureQuery.type.authResidueId,`auth-resid`),aV(X.structureQuery.type.labelResidueId,`label-resid`),aV(X.structureQuery.type.ringFingerprint,`ringfp`),aV(X.structureQuery.type.bondFlags,`bond-flags`)],[`Slots`,aV(X.structureQuery.slot.elementSetReduce,`atom.set.reduce.value`)],[`Generators`,aV(X.structureQuery.generator.atomGroups,`sel.atom.atom-groups`),aV(X.structureQuery.generator.queryInSelection,`sel.atom.query-in-selection`),aV(X.structureQuery.generator.rings,`sel.atom.rings`),aV(X.structureQuery.generator.empty,`sel.atom.empty`),aV(X.structureQuery.generator.all,`sel.atom.all`),aV(X.structureQuery.generator.bondedAtomicPairs,`sel.atom.bonded-pairs`),oV(dL(`sel.atom.atoms`,uL.Dictionary({0:lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test applied to each atom.`})}),TL.ElementSelection,`A selection of singleton atom sets.`),e=>Z.struct.generator.atomGroups({"atom-test":iV(e,0,!0)})),oV(dL(`sel.atom.res`,uL.Dictionary({0:lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test applied to the 1st atom of each residue.`})}),TL.ElementSelection,`A selection of atom sets grouped by residue.`),e=>Z.struct.generator.atomGroups({"residue-test":iV(e,0,!0),"group-by":Z.ammp(`residueKey`)})),oV(dL(`sel.atom.chains`,uL.Dictionary({0:lL(Y.Bool,{isOptional:!0,defaultValue:!0,description:`Test applied to the 1st atom of each chain.`})}),TL.ElementSelection,`A selection of atom sets grouped by chain.`),e=>Z.struct.generator.atomGroups({"chain-test":iV(e,0,!0),"group-by":Z.ammp(`chainKey`)}))],[`Modifiers`,aV(X.structureQuery.modifier.queryEach,`sel.atom.query-each`),aV(X.structureQuery.modifier.intersectBy,`sel.atom.intersect-by`),aV(X.structureQuery.modifier.exceptBy,`sel.atom.except-by`),aV(X.structureQuery.modifier.unionBy,`sel.atom.union-by`),aV(X.structureQuery.modifier.union,`sel.atom.union`),aV(X.structureQuery.modifier.cluster,`sel.atom.cluster`),aV(X.structureQuery.modifier.includeSurroundings,`sel.atom.include-surroundings`),aV(X.structureQuery.modifier.surroundingLigands,`sel.atom.surrounding-ligands`),aV(X.structureQuery.modifier.includeConnected,`sel.atom.include-connected`),aV(X.structureQuery.modifier.expandProperty,`sel.atom.expand-property`)],[`Filters`,aV(X.structureQuery.filter.pick,`sel.atom.pick`),aV(X.structureQuery.filter.first,`sel.atom.first`),aV(X.structureQuery.filter.withSameAtomProperties,`sel.atom.with-same-atom-properties`),aV(X.structureQuery.filter.intersectedBy,`sel.atom.intersected-by`),aV(X.structureQuery.filter.within,`sel.atom.within`),aV(X.structureQuery.filter.isConnectedTo,`sel.atom.is-connected-to`)],[`Combinators`,aV(X.structureQuery.combinator.intersect,`sel.atom.intersect`),aV(X.structureQuery.combinator.merge,`sel.atom.merge`),aV(X.structureQuery.combinator.distanceCluster,`sel.atom.dist-cluster`)],[`Atom Set Properties`,aV(X.structureQuery.atomSet.atomCount,`atom.set.atom-count`),aV(X.structureQuery.atomSet.countQuery,`atom.set.count-query`),aV(X.structureQuery.atomSet.reduce,`atom.set.reduce`),aV(X.structureQuery.atomSet.propertySet,`atom.set.property`)],[`Atom Properties`,aV(X.structureQuery.atomProperty.core.elementSymbol,`atom.el`),aV(X.structureQuery.atomProperty.core.vdw,`atom.vdw`),aV(X.structureQuery.atomProperty.core.mass,`atom.mass`),aV(X.structureQuery.atomProperty.core.atomicNumber,`atom.atomic-number`),aV(X.structureQuery.atomProperty.core.x,`atom.x`),aV(X.structureQuery.atomProperty.core.y,`atom.y`),aV(X.structureQuery.atomProperty.core.z,`atom.z`),aV(X.structureQuery.atomProperty.core.sourceIndex,`atom.src-index`),aV(X.structureQuery.atomProperty.core.operatorName,`atom.op-name`),aV(X.structureQuery.atomProperty.core.instanceId,`atom.instance-id`),aV(X.structureQuery.atomProperty.core.operatorKey,`atom.op-key`),aV(X.structureQuery.atomProperty.core.modelIndex,`atom.model-index`),aV(X.structureQuery.atomProperty.core.modelLabel,`atom.model-label`),aV(X.structureQuery.atomProperty.core.modelEntryId,`atom.model-entry-id`),aV(X.structureQuery.atomProperty.core.atomKey,`atom.key`),aV(X.structureQuery.atomProperty.core.bondCount,`atom.bond-count`),aV(X.structureQuery.atomProperty.topology.connectedComponentKey,`atom.key.molecule`),aV(X.structureQuery.atomProperty.macromolecular.authResidueId,`atom.auth-resid`),aV(X.structureQuery.atomProperty.macromolecular.labelResidueId,`atom.label-resid`),aV(X.structureQuery.atomProperty.macromolecular.residueKey,`atom.key.res`),aV(X.structureQuery.atomProperty.macromolecular.chainKey,`atom.key.chain`),aV(X.structureQuery.atomProperty.macromolecular.entityKey,`atom.key.entity`),aV(X.structureQuery.atomProperty.macromolecular.isHet,`atom.is-het`),aV(X.structureQuery.atomProperty.macromolecular.id,`atom.id`),aV(X.structureQuery.atomProperty.macromolecular.label_atom_id,`atom.label_atom_id`),aV(X.structureQuery.atomProperty.macromolecular.label_alt_id,`atom.label_alt_id`,`atom.altloc`),aV(X.structureQuery.atomProperty.macromolecular.label_comp_id,`atom.label_comp_id`),aV(X.structureQuery.atomProperty.macromolecular.label_asym_id,`atom.label_asym_id`),aV(X.structureQuery.atomProperty.macromolecular.label_entity_id,`atom.label_entity_id`),aV(X.structureQuery.atomProperty.macromolecular.label_seq_id,`atom.label_seq_id`),aV(X.structureQuery.atomProperty.macromolecular.auth_atom_id,`atom.auth_atom_id`,`atom.name`),aV(X.structureQuery.atomProperty.macromolecular.auth_comp_id,`atom.auth_comp_id`,`atom.resname`),aV(X.structureQuery.atomProperty.macromolecular.auth_asym_id,`atom.auth_asym_id`,`atom.chain`),aV(X.structureQuery.atomProperty.macromolecular.auth_seq_id,`atom.auth_seq_id`,`atom.resno`),aV(X.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,`atom.pdbx_PDB_ins_code`,`atom.inscode`),aV(X.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,`atom.pdbx_formal_charge`),aV(X.structureQuery.atomProperty.macromolecular.occupancy,`atom.occupancy`),aV(X.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,`atom.B_iso_or_equiv`,`atom.bfactor`),aV(X.structureQuery.atomProperty.macromolecular.entityType,`atom.entity-type`),aV(X.structureQuery.atomProperty.macromolecular.entitySubtype,`atom.entity-subtype`),aV(X.structureQuery.atomProperty.macromolecular.entityPrdId,`atom.entity-prd-id`),aV(X.structureQuery.atomProperty.macromolecular.entityDescription,`atom.entity-description`),aV(X.structureQuery.atomProperty.macromolecular.objectPrimitive,`atom.object-primitive`),aV(X.structureQuery.atomProperty.macromolecular.chemCompType,`atom.chem-comp-type`),aV(X.structureQuery.atomProperty.macromolecular.secondaryStructureKey,`atom.key.sec-struct`),aV(X.structureQuery.atomProperty.macromolecular.isModified,`atom.is-modified`),aV(X.structureQuery.atomProperty.macromolecular.modifiedParentName,`atom.modified-parent`),aV(X.structureQuery.atomProperty.ihm.hasSeqId,`atom.ihm.has-seq-id`),aV(X.structureQuery.atomProperty.ihm.overlapsSeqIdRange,`atom.ihm.overlaps-seq-id-range`)],[`Bond Properties`,aV(X.structureQuery.bondProperty.order,`bond.order`),aV(X.structureQuery.bondProperty.length,`bond.length`),aV(X.structureQuery.bondProperty.key,`bond.key`),aV(X.structureQuery.bondProperty.atomA,`bond.atom-a`),aV(X.structureQuery.bondProperty.atomB,`bond.atom-b`),oV(dL(`bond.is`,uL.List(TL.BondFlag),Y.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${Y.oneOfValues(TL.BondFlag).join(`, `)}`),e=>Z.core.flags.hasAny([Z.struct.bondProperty.flags(),Z.struct.type.bondFlags(rPe(e))]))]]];var sV=[];function cV(e){for(let t of e)iPe(t)?sV.push(t):t instanceof Array&&cV(t)}cV(aPe);var lV=(function(){let e=[],t=Object.create(null),n=CD.create(),r=CD.create();for(let i of sV){for(let n of i.aliases){if(e.push([n,i]),t[n])throw Error(`Alias '${n}' already in use.`);t[n]=i}let a=i.symbol.args;if(a.kind!==`dictionary`){a.type.kind===`oneof`&&Y.oneOfValues(a.type).forEach(e=>CD.add(r,e,e));continue}for(let e of Object.keys(a.map)){isNaN(e)&&CD.add(n,e,e);let t=a.map[e];t.type.kind===`oneof`&&Y.oneOfValues(t.type).forEach(e=>CD.add(r,e,e))}}return{symbolList:e,symbolMap:t,namedArgs:n.array,constants:r.array}})();lV.constants,lV.namedArgs;const uV=lV.symbolMap;lV.symbolList;function dV(e){if(cL.isLiteral(e))return e;if(cL.isSymbol(e)){if(!uV[e.name])return e;let t=uV[e.name];if(t.kind===`alias`)return cL.Symbol(uV[e.name].symbol.id);throw t.translate([])}let t=cL.isSymbol(e.head)&&!!uV[e.head.name]&&uV[e.head.name].kind===`macro`,n=t?e.head:dV(e.head),r=n!==e.head;if(!e.args)return t?dV(e.head):r?cL.Apply(n):e;let i=!1,a;if(cL.isArgumentsArray(e.args)){a=[];for(let t=0,n=e.args.length;t<n;t++){let n=e.args[t],r=dV(n);n!==r&&(i=!0),a[a.length]=r}if(i||(a=e.args),!t&&!r&&!i)return e}else{a={};for(let t of Object.keys(e.args)){let n=e.args[t],r=dV(n);n!==r&&(i=!0),a[t]=r}if(!t&&!r&&!i)return e;i||(a=e.args)}if(t){let t=uV[e.head.name];return t.kind===`macro`?t.translate(a):cL.Apply(n,a)}return cL.Apply(n,a)}function oPe(e){return dV(e)}var fV=class e{constructor(e){this._=e}parse(t){let n=this.skip(e.eof)._(t,0);return n.status?{success:!0,value:n.value}:{success:!1,index:_V(t,n.furthest),expected:n.expected}}tryParse(e){let t=this.parse(e);if(t.success)return t.value;{let n=lPe(e,t);throw Error(n)}}or(t){return e.alt(this,t)}trim(e){return this.wrap(e,e)}wrap(t,n){return pV(1,typeof t==`string`?e.string(t):t,this,typeof n==`string`?e.string(n):n)}thru(e){return e(this)}then(e){return pV(1,this,e)}many(){return new e((e,t)=>{let n=[],r;for(;;)if(r=gV(this._(e,t),r),r.status){if(t===r.index)throw Error(`infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause`);t=r.index,n.push(r.value)}else return gV(mV(t,n),r)})}times(t,n){let r=n===void 0?t:n;return new e((e,n)=>{let i=[],a,o,s;for(s=0;s<t;s++)if(a=this._(e,n),o=gV(a,o),a.status)n=a.index,i.push(a.value);else return o;for(;s<r&&(a=this._(e,n),o=gV(a,o),a.status);s+=1)n=a.index,i.push(a.value);return gV(mV(n,i),o)})}result(e){return this.map(()=>e)}atMost(e){return this.times(0,e)}atLeast(t){return e.seq(this.times(t),this.many()).map(e=>[...e[0],...e[1]])}map(t){return new e((e,n)=>{let r=this._(e,n);return r.status?gV(mV(r.index,t(r.value)),r):r})}skip(e){return pV(0,this,e)}mark(){return e.seq(e.index,this,e.index).map(e=>({start:e[0],value:e[1],end:e[2]}))}node(t){return e.seq(e.index,this,e.index).map(e=>({name:t,start:e[0],value:e[1],end:e[2]}))}sepBy(t){return e.sepBy(this,t)}sepBy1(t){return e.sepBy1(this,t)}lookahead(t){return this.skip(e.lookahead(t))}notFollowedBy(t){return this.skip(e.notFollowedBy(t))}desc(t){return new e((e,n)=>{let r=this._(e,n);return r.status||(r.expected=[t]),r})}fallback(t){return this.or(e.succeed(t))}ap(t){return e.seq(t,this).map(([e,t])=>e(t))}chain(t){return new e((e,n)=>{let r=this._(e,n);return r.status?gV(t(r.value)._(e,r.index),r):r})}};(function(e){function t(e,t,n){let i=[].slice.call(arguments);if(i.length===0)throw Error(`seqMap needs at least one argument`);let a=i.pop();return fPe(a),r.apply(null,i).map(function(e){return a.apply(null,e)})}e.seqMap=t;function n(e){let t={};for(let n of Object.keys(e))(function(n){t[n]=b(()=>e[n](t))})(n);return t}e.createLanguage=n;function r(...t){let n=t.length;return new e((e,r)=>{let i,a=Array(n),o=r;for(let r=0;r<n;r++){if(i=gV(t[r]._(e,o),i),!i.status)return i;a[r]=i.value,o=i.index}return gV(mV(o,a),i)})}e.seq=r;function i(...t){return t.length===0?f(`zero alternates`):new e((e,n)=>{let r;for(let i=0;i<t.length;i++)if(r=gV(t[i]._(e,n),r),r.status)return r;return r})}e.alt=i;function a(e,t){return o(e,t).or(d([]))}e.sepBy=a;function o(e,t){return r(e,t.then(e).many()).map(e=>[e[0],...e[1]])}e.sepBy1=o;function s(t){let n=`'${t}'`;if(t.length===1){let r=t.charCodeAt(0);return new e((e,i)=>e.charCodeAt(i)===r?mV(i+1,t):hV(i,n))}return new e((e,r)=>{let i=r+t.length;return e.slice(r,i)===t?mV(i,t):hV(r,n)})}e.string=s;function c(e){let t=``+e;return t.slice(t.lastIndexOf(`/`)+1)}function l(e){return RegExp(`^(?:`+e.source+`)`,c(e))}function u(t,n=0){let r=l(t),i=``+t;return new e((e,t)=>{let a=r.exec(e.slice(t));if(a){if(0<=n&&n<=a.length){let e=a[0],r=a[n];return mV(t+e.length,r)}return hV(t,`invalid match group (0 to ${a.length}) in ${i}`)}return hV(t,i)})}e.regexp=u;function d(t){return new e((e,n)=>mV(n,t))}e.succeed=d;function f(t){return new e((e,n)=>hV(n,t))}e.fail=f;function p(t){if(dPe(t))return new e((e,n)=>{let r=t._(e,n);return r.status&&(r.index=n,r.value=null),r});if(typeof t==`string`)return p(s(t));if(t instanceof RegExp)return p(u(t));throw Error(`not a string, regexp, or parser: `+t)}e.lookahead=p;function m(t){return new e((e,n)=>{let r=t._(e,n);return r.status?hV(n,`not "`+e.slice(n,r.index)+`"`):mV(n,null)})}e.notFollowedBy=m;function h(t){return new e((e,n)=>{let r=e.charAt(n);return n<e.length&&t(r)?mV(n+1,r):hV(n,`a character `+t)})}e.test=h;function g(e){return h(t=>e.indexOf(t)>=0)}e.oneOf=g;function _(e){return h(t=>e.indexOf(t)<0)}e.noneOf=_;function v(e,t){return h(n=>e<=n&&n<=t).desc(e+`-`+t)}e.range=v;function y(t){return new e((e,n)=>{let r=n;for(;r<e.length&&t(e.charAt(r));)r++;return mV(r,e.slice(n,r))})}e.takeWhile=y;function b(t){let n=new e((e,r)=>{let i=t()._;return n._=i,i(e,r)});return n}e.lazy=b;function x(){return f(`empty`)}e.empty=x,e.index=new e(function(e,t){return mV(t,_V(e,t))}),e.anyChar=new e((e,t)=>t>=e.length?hV(t,`any character`):mV(t+1,e.charAt(t))),e.all=new e(function(e,t){return mV(e.length,e.slice(t))}),e.eof=new e(function(e,t){return t<e.length?hV(t,`EOF`):mV(t,null)}),e.digit=u(/[0-9]/).desc(`a digit`),e.digits=u(/[0-9]*/).desc(`optional digits`),e.letter=u(/[a-z]/i).desc(`a letter`),e.letters=u(/[a-z]*/i).desc(`optional letters`),e.optWhitespace=u(/\s*/).desc(`optional whitespace`),e.whitespace=u(/\s+/).desc(`whitespace`),e.cr=s(`\r`),e.lf=s(`
`),e.crlf=s(`\r
`),e.newline=i(e.crlf,e.lf,e.cr).desc(`newline`),e.end=i(e.newline,e.eof);function S(e){return d(e)}e.of=S;function C(e){return u(e)}e.regex=C})(fV||={});function pV(e,...t){let n=t.length;return new fV((r,i)=>{let a,o,s=i;for(let i=0;i<n;i++){if(a=gV(t[i]._(r,s),a),!a.status)return a;e===i&&(o=a.value),s=a.index}return gV(mV(s,o),a)})}function mV(e,t){return{status:!0,index:e,value:t}}function hV(e,t){return{status:!1,furthest:e,expected:[t]}}function gV(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;let n=e.furthest===t.furthest?uPe(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:n}}function _V(e,t){let n=e.slice(0,t).split(`
`);return{offset:t,line:n.length,column:n[n.length-1].length+1}}function sPe(e){return e.length===1?e[0]:`one of `+e.join(`, `)}function cPe(e,t){let n=t.index,r=n.offset;if(r===e.length)return`, got the end of the input`;let i=r>0?`'...`:`'`,a=e.length-r>12?`...'`:`'`;return` at line ${n.line} column ${n.column}, got ${i}${e.slice(r,r+12)}${a}`}function lPe(e,t){return`expected ${sPe(t.expected)}${cPe(e,t)}`}function uPe(e,t){let n=e.length,r=t.length;if(n===0)return t;if(r===0)return e;let i=new Set,a=[];for(let t=0;t<n;t++)i.has(e[t])||(a[a.length]=e[t],i.add(e[t]));for(let e=0;e<r;e++)i.has(t[e])||(a[a.length]=t[e],i.add(t[e]));return a.sort(),a}function dPe(e){return e instanceof fV}function fPe(e){if(typeof e!=`function`)throw Error(`not a function: `+e)}function pPe(e){return vV.parse(e)}var vV;(function(e){let t;(function(e){function t(e){return{kind:`string`,value:e}}e.str=t;function n(e){return{kind:`symbol`,value:e}}e.symb=n;function r(e,t){return{kind:`list`,bracket:e,nodes:t}}e.list=r;function i(e){return{kind:`comment`,value:e}}e.comment=i})(t||={});let n=fV.regexp(/[\n\r\s]*/),r=fV.lazy(()=>fV.alt(i,d,a,o).trim(n)),i=fV.takeWhile(e=>e!=="`").trim("`").map(t.str),a=fV.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),o=fV.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),s=r.many(),c=s.wrap(`(`,`)`).map(e=>t.list(`(`,e)),l=s.wrap(`[`,`]`).map(e=>t.list(`[`,e)),u=s.wrap(`{`,`}`).map(e=>t.list(`{`,e)),d=fV.alt(c,l,u),f=r.many();function p(e){return f.tryParse(e)}function m(e){switch(e.kind){case`string`:return e.value;case`symbol`:{let t=e.value;if(t.length>1)switch(t.charAt(0)){case`.`:return Z.atomName(t.substr(1));case`_`:return Z.struct.type.elementSymbol([t.substr(1)])}return t===`true`?!0:t===`false`?!1:v(t)?+t:cL.Symbol(t)}case`list`:switch(e.bracket){case`[`:return Z.core.type.list(_(e.nodes).map(m));case`{`:return Z.core.type.set(_(e.nodes).map(m));case`(`:{if(e.nodes[0].kind===`comment`)throw Error(`Invalid expression`);let t=m(e.nodes[0]);return cL.Apply(t,h(e.nodes))}default:Lb(e.bracket)}default:Lb(e)}}function h(e){if(e.length<=1)return;if(!g(e)){let t=[];for(let n=1,r=e.length;n<r;n++){let r=e[n];r.kind!==`comment`&&(t[t.length]=m(r))}return t}let t={},n=!0,r=0;for(let i=1,a=e.length;i<a;i++){let o=e[i];if(o.kind!==`comment`)if(o.kind===`symbol`&&o.value.length>1&&o.value.charAt(0)===`:`){let r=o.value.substr(1);for(++i;i<a&&e[i].kind===`comment`;)i++;if(i>=a)throw Error(`There must be a value foolowed a named arg ':${r}'.`);if(e[i].kind===`comment`)throw Error(`Invalid expression`);t[r]=m(e[i]),isNaN(+r)&&(n=!1)}else t[r++]=m(o)}if(n){let e=Object.keys(t).map(e=>+e).sort((e,t)=>e-t),n=!0;for(let t=0,r=e.length;t<r;t++)if(e[t]!==t){n=!1;break}if(n){let n=[];for(let r=0,i=e.length;r<i;r++)n[r]=t[r];return n}}return t}function g(e){for(let t=1,n=e.length;t<n;t++){let n=e[t];if(n.kind===`symbol`&&n.value.length>1&&n.value.charAt(0)===`:`)return!0}return!1}function _(e){let t=!1;for(let n=0,r=e.length;n<r;n++)if(e[n].kind===`comment`){t=!0;break}return t?e.filter(e=>e.kind!==`comment`):e}function v(e){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(e)&&!isNaN(+e)}function y(e){let t=p(e),n=[];for(let e of t)e.kind!==`comment`&&(n[n.length]=m(e));return n}e.parse=y})(vV||={});var yV=Z;function bV(e,t,n){let r=fV.lazy(()=>fV.seq(e,r).map(e=>n(...e)).or(t));return r}function xV(e,t,n){return fV.seqMap(t,e.many(),(e,t)=>t.reduce((e,t)=>n(t,e),e))}function SV(e,t,n){return fV.seqMap(t,fV.seq(e,t).many(),(e,t)=>t.reduce((e,t)=>{let[r,i]=t;return n(r,e,i)},e))}function CV(e,t){return e.reduce((e,t)=>{let n=t.isUnsupported?OV(`operator '${t.name}' not supported`):t.map;return t.type(t.rule,e,n)},t)}function wV(e,t=0){return fV.optWhitespace.then(fV.regexp(e,t).skip(fV.optWhitespace))}function TV(e,t=0){return fV.regexp(e,t).skip(fV.optWhitespace)}function EV(e,t=0){return fV.optWhitespace.then(fV.regexp(e,t))}function DV(e,t){let n=t?`${e}|${XT(t)}`:e;return wV(RegExp(`(${n})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,`i`),2).map(parseFloat)}function OV(e){return function(){throw Error(e)}}function kV(e){if(e.length===1)return e[0];if(e.length>1)return yV.core.logic.and(e)}function mPe(e){if(e.length===1)return e[0];if(e.length>1)return yV.core.logic.or(e)}function AV(e,t){if(t&&t.op!==void 0&&t.val!==void 0){let n=[e,t.val];switch(t.op){case`=`:return yV.core.rel.eq(n);case`!=`:return yV.core.rel.neq(n);case`>`:return yV.core.rel.gr(n);case`<`:return yV.core.rel.lt(n);case`>=`:return yV.core.rel.gre(n);case`<=`:return yV.core.rel.lte(n);default:throw Error(`operator '${t.op}' not supported`)}}else if(t&&t.flags!==void 0)return yV.core.flags.hasAny([e,t.flags]);else if(t&&t.min!==void 0&&t.max!==void 0)return yV.core.rel.inRange([e,t.min,t.max]);else if(Array.isArray(t))return t.length>1?yV.core.set.has([yV.core.type.set(t),e]):yV.core.rel.eq([e,t[0]]);else return yV.core.rel.eq([e,t])}function jV(e){return yV.struct.generator.queryInSelection({0:e,query:yV.struct.generator.all(),"in-complement":!0})}function MV(e,t){return e.length<t.length?1:-1}function NV(e,t){let n=(t?[e].concat(t):[e]).sort(MV).map(XT).join(`|`);return RegExp(`${n}`,`i`)}function hPe(e){let t={};return Object.keys(e).sort(MV).forEach(n=>{let r=e[n],i=OV(`property '${n}' not supported`),a=fV.regexp(r.regex).map(e=>(r.isUnsupported&&i(),AV(r.property,r.map(e))));r.isNumeric||(t[n]=a)}),t}function PV(e){let t=[];return Object.keys(e).sort(MV).forEach(n=>{let r=e[n],i=OV(`property '${n}' not supported`),a=fV.regexp(r.regex).map(e=>(r.isUnsupported&&i(),AV(r.property,r.map(e)))),o=fV.regexp(NV(n,r.abbr)).trim(fV.optWhitespace),s=e=>yV.struct.generator.atomGroups({[r.level]:e});r.isNumeric?t.push(o.then(fV.seq(fV.regexp(/>=|<=|=|!=|>|</).trim(fV.optWhitespace),fV.regexp(r.regex).map(r.map))).map(e=>(r.isUnsupported&&i(),AV(r.property,{op:e[0],val:e[1]}))).map(s)):t.push(o.then(a).map(s))}),t}function FV(e){let t=[];return Object.keys(e).sort(MV).forEach(n=>{let r=e[n],i=r.map?r.map:OV(`keyword '${n}' not supported`),a=fV.regexp(NV(n,r.abbr)).map(i);t.push(a)}),t}function gPe(e,t){let n=[],r=fV.regexp(/\(\s*/),i=fV.regexp(/\s*\)/);return Object.keys(e).sort(MV).forEach(a=>{let o=e[a],s=o.map?o.map:OV(`function '${a}' not supported`),c=fV.regexp(new RegExp(a,`i`)).skip(r).then(t).skip(i).map(s);n.push(c)}),n}function IV(e,t){let n=[];return Object.keys(e).sort(MV).forEach(r=>{let i=e[r],a=OV(`property '${r}' not supported`),o=fV.regexp(NV(r,i.abbr)).lookahead(t).map(()=>(i.isUnsupported&&a(),i.property));n.push(o)}),n}function LV(e,t,n,r){let i=[];for(let t in e)i.push(t),e[t].abbr&&i.push(...e[t].abbr);for(let e in t)i.push(e),t[e].abbr&&i.push(...t[e].abbr);return n.forEach(e=>{i.push(e.name),e.abbr&&i.push(...e.abbr)}),i}function RV(e){return yV.core.type.set(e.map(yV.atomName))}function zV(e){return yV.struct.generator.queryInSelection({0:e,query:yV.struct.generator.all()})}function BV(e,t,n){switch(e.head.name){case`structure-query.atom-property.macromolecular.label_atom_id`:return yV.atomName(t);case`structure-query.atom-property.core.element-symbol`:return yV.es(t);case`structure-query.atom-property.macromolecular.secondary-structure-flags`:return n&&(t=[n[t.toUpperCase()]||`none`]),yV.struct.type.secondaryStructureFlags([t]);default:return t}}var _Pe=`structure-query.atom-property.macromolecular.`,vPe=[`entityKey`,`label_entity_id`,`entityType`],yPe=[`chainKey`,`label_asym_id`,`label_entity_id`,`auth_asym_id`,`entityType`],bPe=[`residueKey`,`label_comp_id`,`label_seq_id`,`auth_comp_id`,`auth_seq_id`,`pdbx_formal_charge`,`secondaryStructureKey`,`secondaryStructureFlags`,`isModified`,`modifiedParentName`];function xPe(e){if(e.head.name.startsWith(_Pe)){let t=e.head.name.substr(45);if(vPe.includes(t))return`entity-test`;if(yPe.includes(t))return`chain-test`;if(bPe.includes(t))return`residue-test`}return`atom-test`}var SPe=[`structure-query.atom-property.macromolecular.secondary-structure-flags`];function CPe(e,t){if(SPe.includes(e.head.name)){let n=t[0].head,r=[];return t.forEach(e=>r.push(...e.args[0])),yV.core.flags.hasAny([e,{head:n,args:r}])}else if(t.length===1)return yV.core.rel.eq([e,t[0]]);else if(t.length>1)return yV.core.set.has([yV.core.type.set(t),e])}function VV(e){return yV.struct.generator.atomGroups({"residue-test":yV.core.set.has([yV.core.type.set(e),yV.ammp(`label_comp_id`)])})}var HV=Z,UV=/[-+]?[0-9]*\.?[0-9]+/,WV=/[0-9]+/;function GV(e){return e}var wPe={none:`none`,turn:`turn`,sheet:`beta`,helix:`helix`,dna:`dna`,rna:`rna`,carbohydrate:`carbohydrate`,helix310:`3-10`,helixalpha:`alpha`,helixpi:`pi`,0:`none`,1:`turn`,2:`beta`,3:`helix`,4:`dna`,5:`rna`,6:`carbohydrate`,7:`3-10`,8:`alpha`,9:`pi`};function KV(e){if(e.head){if(e.head.name&&e.head.name===`core.type.regex`&&(e=e.args[0].replace(/^\^|\$$/g,``)),e=wPe[e.toString().toLowerCase()]||`none`,[`dna`,`rna`,`carbohydrate`].indexOf(e)!==-1)throw Error(`values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property`);return HV.struct.type.secondaryStructureFlags([e])}}const qV={adpmax:{"@desc":`the maximum anisotropic displacement parameter for the selected atom`,"@examples":[``],isUnsupported:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`},adpmin:{"@desc":`the minimum anisotropic displacement parameter for the selected atom`,"@examples":[``],isUnsupported:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`},altloc:{"@desc":`PDB alternate location identifier`,"@examples":[`altloc = A`],regex:/[a-zA-Z0-9]/,map:GV,level:`atom-test`,property:HV.ammp(`label_alt_id`)},altname:{"@desc":`an alternative name given to atoms by some file readers (for example, P2N)`,"@examples":[``],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:GV,level:`atom-test`},atomID:{"@desc":`special atom IDs for PDB atoms assigned by Jmol`,"@examples":[``],isUnsupported:!0,regex:WV,map:e=>parseInt(e),level:`atom-test`},atomIndex:{"@desc":`atom 0-based index; a unique number for each atom regardless of the number of models loaded`,"@examples":[``],isUnsupported:!0,regex:WV,map:e=>parseInt(e),level:`atom-test`},atomName:{"@desc":`atom name`,"@examples":[`atomName = CA`],regex:/[a-zA-Z0-9]+/,map:e=>HV.atomName(e),level:`atom-test`,property:HV.ammp(`label_atom_id`)},atomno:{"@desc":`sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35`,"@examples":[``],isUnsupported:!0,regex:WV,map:e=>parseInt(e),level:`atom-test`},atomType:{"@desc":`atom type (mol2, AMBER files) or atom name (other file types)`,"@examples":[`atomType = OH`],regex:/[a-zA-Z0-9]+/,map:e=>HV.atomName(e),level:`atom-test`,property:HV.ammp(`label_atom_id`)},atomX:{"@desc":`Cartesian X coordinate (or just X)`,"@examples":[`x = 4.2`],abbr:[`X`],isNumeric:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.acp(`x`)},atomY:{"@desc":`Cartesian Y coordinate (or just Y)`,"@examples":[`y < 42`],abbr:[`Y`],isNumeric:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.acp(`y`)},atomZ:{"@desc":`Cartesian Z coordinate (or just Z)`,"@examples":[`Z > 10`],abbr:[`Z`],isNumeric:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.acp(`z`)},bondcount:{"@desc":`covalent bond count`,"@examples":[`bondcount = 0`],isNumeric:!0,regex:WV,map:e=>parseInt(e),level:`atom-test`,property:HV.acp(`bondCount`)},bondingRadius:{"@desc":`radius used for auto bonding; synonymous with ionic and ionicRadius`,"@examples":[``],abbr:[`ionic`,`ionicRadius`],isUnsupported:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`},cell:{"@desc":`crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},configuration:{"@desc":`Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)`,"@examples":[``],isUnsupported:!0,regex:WV,map:e=>parseInt(e),level:`atom-test`},chain:{"@desc":`protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.`,"@examples":[`chain = A`,`chain = "AA"`],regex:/[a-zA-Z0-9]+/,map:GV,level:`chain-test`,property:HV.ammp(`auth_asym_id`)},chainNo:{"@desc":`chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},color:{"@desc":`the atom color`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},covalentRadius:{"@desc":`covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.`,"@examples":[``],abbr:[`covalent`],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},cs:{"@desc":`chemical shift calculated using computational results that include magnetic shielding tensors.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},element:{"@desc":`element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.`,"@examples":[`element=Fe`],regex:/[a-zA-Z]+/,map:e=>HV.es(e),level:`atom-test`,property:HV.acp(`elementSymbol`)},elemno:{"@desc":`atomic element number`,"@examples":[`elemno=8`],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:`atom-test`,property:HV.acp(`atomicNumber`)},eta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},theta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},file:{"@desc":`file number containing this atom`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},formalCharge:{"@desc":`formal charge`,"@examples":[`formalCharge=1`],regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.ammp(`pdbx_formal_charge`)},format:{"@desc":`format (label) of the atom.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fXyz:{"@desc":`fractional XYZ coordinates`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fX:{"@desc":`fractional X coordinate`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fY:{"@desc":`fractional Y coordinate`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fZ:{"@desc":`fractional Z coordinate`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fuxyz:{"@desc":`fractional XYZ coordinates in the unitcell coordinate system`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fux:{"@desc":`fractional X coordinate in the unitcell coordinate system`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fuy:{"@desc":`fractional Y coordinate in the unitcell coordinate system`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},fuz:{"@desc":`fractional Z coordinate in the unit cell coordinate system`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},group:{"@desc":`3-letter residue code`,"@examples":[`group = ALA`],regex:/[a-zA-Z0-9]{1,3}/,map:GV,level:`residue-test`,property:HV.ammp(`label_comp_id`)},group1:{"@desc":`single-letter residue code (amino acids only)`,"@examples":[`group1 = G`],regex:/[a-zA-Z]/,map:GV,level:`residue-test`,property:HV.ammp(`label_comp_id`)},groupID:{"@desc":`group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},groupindex:{"@desc":`overall group index`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},hydrophobicity:{"@desc":`Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},identify:{"@desc":`for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},insertion:{"@desc":`protein residue insertion code`,"@examples":[`insertion=A`],regex:/[a-zA-Z0-9]/,map:GV,level:`atom-test`,property:HV.ammp(`pdbx_PDB_ins_code`)},label:{"@desc":`current atom label (same as format)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},mass:{"@desc":`atomic mass -- especially useful with appended .max or .sum`,"@examples":[`mass > 13`],regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.acp(`mass`)},model:{"@desc":`model number`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},modelindex:{"@desc":`a unique number for each model, starting with 0 and spanning all models in all files`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},modO:{"@desc":`currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},modXYZ:{"@desc":`currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},molecule:{"@desc":`molecule number`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},monomer:{"@desc":`monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},ms:{"@desc":`magnetic shielding calculated from file-loaded tensors.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},occupancy:{"@desc":`CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.`,"@examples":[`occupancy < 1`],regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.ammp(`occupancy`)},partialCharge:{"@desc":`partial charge`,"@examples":[``],isUnsupported:!0,regex:UV,map:e=>parseFloat(e),level:`atom-test`},phi:{"@desc":`protein group PHI angle for atom's residue`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},polymer:{"@desc":`sequential polymer number in a model, starting with 1.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},polymerLength:{"@desc":`polymer length`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},property_xx:{"@desc":`a property created using the DATA command`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},psi:{"@desc":`protein group PSI angle for the atom's residue`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},radius:{"@desc":`currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},resno:{"@desc":`PDB residue number, not including insertion code (see also seqcode, below)`,"@examples":[`resno = 100`],regex:/-?[0-9]+/,map:e=>parseInt(e),level:`residue-test`,property:HV.ammp(`auth_seq_id`)},selected:{"@desc":`1.0 if atom is selected; 0.0 if not`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},sequence:{"@desc":`PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},seqcode:{"@desc":`PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},seqid:{"@desc":`(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},shape:{"@desc":`hybridization geometry such as "tetrahedral"`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},site:{"@desc":`crystallographic site number`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},spacefill:{"@desc":`currently displayed radius`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},straightness:{"@desc":`quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},strucno:{"@desc":`a unique number for each helix, sheet, or turn in a model, starting with 1.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},structure:{"@desc":`The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.`,"@examples":[`structure="helix"`,`structure=3`],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:GV,level:`residue-test`,property:`structure`},substructure:{"@desc":`like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.`,"@examples":[`substructure = "alphahelix"`,`substructure =9`],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:GV,level:`residue-test`,property:`structure`},surfacedistance:{"@desc":`A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},symop:{"@desc":`the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},symmetry:{"@desc":`as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},temperature:{"@desc":`yes  yes  temperature factor (B-factor)`,"@examples":[`temperature >= 20`],regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.ammp(`B_iso_or_equiv`)},unitXyz:{"@desc":`unit cell XYZ coordinates`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},uX:{"@desc":`unit cell X coordinate normalized to [0,1)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},uY:{"@desc":`unit cell Y coordinate normalized to [0,1)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},uZ:{"@desc":`unit cell Z coordinate normalized to [0,1)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},valence:{"@desc":`the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},vanderwaals:{"@desc":`van der Waals radius`,"@examples":[`vanderwaals >2`],regex:UV,map:e=>parseFloat(e),level:`atom-test`,property:HV.acp(`vdw`)},vectorScale:{"@desc":`vibration vector scale`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},volume:{"@desc":`approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},vXyz:{"@desc":`vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},vX:{"@desc":`vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},vY:{"@desc":`vibration vector Y coordinate`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},vZ:{"@desc":`vibration vector Z coordinate`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`},xyz:{"@desc":`Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.`,"@examples":[``],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:GV,level:`atom-test`}};var JV=Z;const YV=[{"@desc":`Selects atoms that are not included in s1.`,"@examples":[`not ARG`],name:`not`,type:bV,rule:fV.alt(fV.regex(/NOT/i).skip(fV.whitespace),fV.string(`!`).skip(fV.optWhitespace)),map:(e,t)=>jV(t)},{"@desc":`Selects atoms included in both s1 and s2.`,"@examples":[`ASP and .CA`],name:`and`,type:SV,rule:wV(/AND|&/i),map:(e,t,n)=>JV.struct.modifier.intersectBy({0:t,by:n})},{"@desc":`Selects atoms included in either s1 or s2.`,"@examples":[`ASP or GLU`],name:`or`,type:SV,rule:wV(/OR|\||,/i),map:(e,t,n)=>JV.struct.combinator.merge([t,n])}];var XV=Z,ZV={acidic:[`ASP`,`GLU`],aliphatic:[`ALA`,`GLY`,`ILE`,`LEU`,`VAL`],amino:[`ALA`,`ARG`,`ASN`,`ASP`,`CYS`,`GLN`,`GLU`,`GLY`,`HIS`,`ILE`,`LEU`,`LYS`,`MET`,`PHE`,`PRO`,`SER`,`THR`,`TRP`,`TYR`,`VAL`,`ASX`,`GLX`,`UNK`],aromatic:[`HIS`,`PHE`,`TRP`,`TYR`],basic:[`ARG`,`HIS`,`LYS`],buried:[`ALA`,`CYS`,`ILE`,`LEU`,`MET`,`PHE`,`TRP`,`VAL`],cg:[`CYT`,`C`,`GUA`,`G`],cyclic:[`HIS`,`PHE`,`PRO`,`TRP`,`TYR`],hydrophobic:[`ALA`,`GLY`,`ILE`,`LEU`,`MET`,`PHE`,`PRO`,`TRP`,`TYR`,`VAL`],large:[`ARG`,`GLU`,`GLN`,`HIS`,`ILE`,`LEU`,`LYS`,`MET`,`PHE`,`TRP`,`TYR`],medium:[`ASN`,`ASP`,`CYS`,`PRO`,`THR`,`VAL`],small:[`ALA`,`GLY`,`SER`],nucleic:[`G`,`C`,`A`,`T`,`U`,`I`,`DG`,`DC`,`DA`,`DT`,`DU`,`DI`,`+G`,`+C`,`+A`,`+T`,`+U`,`+I`]},QV={nucleic:[`P`,`O3'`,`O5'`,`C5'`,`C4'`,`C3'`,`OP1`,`OP2`,`O3*`,`O5*`,`C5*`,`C4*`,`C3*`,`C2'`,`C1'`,`O4'`,`O2'`],protein:[`C`,`N`,`CA`]};function $V(){return XV.struct.combinator.merge([XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(...ZV.nucleic),XV.ammp(`label_comp_id`)])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.logic.and([XV.core.rel.eq([XV.struct.atomSet.atomCount(),1]),XV.core.rel.eq([XV.ammp(`label_atom_id`),XV.atomName(`P`)])])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.logic.or([XV.core.set.isSubset([RV([`C1'`,`C2'`,`O3'`,`C3'`,`C4'`,`C5'`,`O5'`]),XV.ammpSet(`label_atom_id`)]),XV.core.set.isSubset([RV([`C1*`,`C2*`,`O3*`,`C3*`,`C4*`,`C5*`,`O5*`]),XV.ammpSet(`label_atom_id`)])])})])}function TPe(){return XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(...ZV.amino),XV.ammp(`label_comp_id`)])})}function EPe(){return XV.struct.combinator.merge([XV.struct.modifier.intersectBy({0:XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.core.type.set(ZV.amino),XV.ammp(`label_comp_id`)])}),by:XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.core.type.set(QV.protein),XV.ammp(`label_atom_id`)])})}),XV.struct.modifier.intersectBy({0:XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.core.type.set(ZV.nucleic),XV.ammp(`label_comp_id`)])}),by:XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.core.type.set(QV.nucleic),XV.ammp(`label_atom_id`)])})})])}const eH={all:{"@desc":`all atoms; same as *`,abbr:[`*`],map:()=>XV.struct.generator.all()},bonded:{"@desc":`covalently bonded`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.gr([XV.struct.atomProperty.core.bondCount({flags:XV.struct.type.bondFlags([`covalent`,`metallic`,`sulfide`])}),0])})},clickable:{"@desc":`actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape.`},connected:{"@desc":`bonded in any way, including hydrogen bonds`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.gr([XV.struct.atomProperty.core.bondCount({flags:XV.struct.type.bondFlags()}),0])})},displayed:{"@desc":`displayed using the display or hide command; not necessarily visible`},hidden:{"@desc":`hidden using the display or hide command`},none:{"@desc":`no atoms`,map:()=>XV.struct.generator.empty()},selected:{"@desc":`atoms that have been selected; defaults to all when a file is first loaded`},thisModel:{"@desc":`atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.`},visible:{"@desc":`visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible.`},subset:{"@desc":`the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing.`},specialPosition:{"@desc":`atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them.`},unitcell:{"@desc":`atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell.`},polyhedra:{"@desc":`all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)`},nonmetal:{"@desc":`_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.set(...[`H`,`He`,`B`,`C`,`N`,`O`,`F`,`Ne`,`Si`,`P`,`S`,`Cl`,`Ar`,`As`,`Se`,`Br`,`Kr`,`Te`,`I`,`Xe`,`At`,`Rn`].map(XV.es)),XV.acp(`elementSymbol`)])})},metal:{"@desc":`!nonmetal`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.logic.not([XV.core.set.has([XV.set(...[`H`,`He`,`B`,`C`,`N`,`O`,`F`,`Ne`,`Si`,`P`,`S`,`Cl`,`Ar`,`As`,`Se`,`Br`,`Kr`,`Te`,`I`,`Xe`,`At`,`Rn`].map(XV.es)),XV.acp(`elementSymbol`)])])})},alkaliMetal:{"@desc":`_Li,_Na,_K,_Rb,_Cs,_Fr`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.set(...[`Li`,`Na`,`K`,`Rb`,`Cs`,`Fr`].map(XV.es)),XV.acp(`elementSymbol`)])})},alkalineEarth:{"@desc":`_Be,_Mg,_Ca,_Sr,_Ba,_Ra`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.set(...[`Be`,`Mg`,`Ca`,`Sr`,`Ba`,`Ra`].map(XV.es)),XV.acp(`elementSymbol`)])})},nobleGas:{"@desc":`_He,_Ne,_Ar,_Kr,_Xe,_Rn`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.set(...[`He`,`Ne`,`Ar`,`Kr`,`Xe`,`Rn`].map(XV.es)),XV.acp(`elementSymbol`)])})},metalloid:{"@desc":`_B,_Si,_Ge,_As,_Sb,_Te`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.set.has([XV.set(...[`B`,`Si`,`Ge`,`As`,`Sb`,`Te`].map(XV.es)),XV.acp(`elementSymbol`)])})},transitionMetal:{"@desc":`(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.logic.or([XV.core.rel.inRange([XV.acp(`atomicNumber`),21,30]),XV.core.rel.inRange([XV.acp(`atomicNumber`),39,48]),XV.core.rel.inRange([XV.acp(`atomicNumber`),72,80]),XV.core.rel.inRange([XV.acp(`atomicNumber`),104,112]),XV.core.set.has([XV.set(57,89),XV.acp(`atomicNumber`)])])})},lanthanide:{"@desc":`(does not include La) elemno>57 and elemno<=71`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.inRange([XV.acp(`atomicNumber`),57,71])})},actinide:{"@desc":`(does not include Ac) elemno>89 and elemno<=103`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.inRange([XV.acp(`atomicNumber`),89,103])})},isaromatic:{"@desc":`atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.gr([XV.struct.atomProperty.core.bondCount({flags:XV.struct.type.bondFlags([`aromatic`])}),0])})},carbohydrate:{"@desc":``},ions:{"@desc":`(specifically the PDB designations "PO4" and "SO4")`},ligand:{"@desc":`(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)`},nucleic:{"@desc":`any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, ', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.`,map:()=>$V()},purine:{"@desc":`any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.`,map:()=>XV.struct.modifier.intersectBy({0:$V(),by:XV.struct.combinator.merge([XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(`A`,`G`,`I`,`DA`,`DG`,`DI`,`+A`,`+G`,`+I`),XV.ammp(`label_comp_id`)])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.set.isSubset([RV([`N7`,`C8`,`N9`]),XV.ammpSet(`label_atom_id`)])})])})},pyrimidine:{"@desc":`any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.`,map:()=>XV.struct.modifier.intersectBy({0:$V(),by:XV.struct.combinator.merge([XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(`C`,`T`,`U`,`DC`,`DT`,`DU`,`+C`,`+T`,`+U`),XV.ammp(`label_comp_id`)])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.logic.or([XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2*`)]),XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2'`)])])})])})},dna:{"@desc":`any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.`,map:()=>XV.struct.modifier.intersectBy({0:$V(),by:XV.struct.combinator.merge([XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(`DG`,`DC`,`DA`,`DT`,`DU`,`DI`,`T`,`+G`,`+C`,`+A`,`+T`),XV.ammp(`label_comp_id`)])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.logic.not([XV.core.logic.or([XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2*`)]),XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2'`)])])])})])})},rna:{"@desc":`any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.`,map:()=>XV.struct.modifier.intersectBy({0:$V(),by:XV.struct.combinator.merge([XV.struct.generator.atomGroups({"residue-test":XV.core.set.has([XV.set(`G`,`C`,`A`,`U`,`I`,`+U`,`+I`),XV.ammp(`label_comp_id`)])}),XV.struct.filter.pick({0:XV.struct.generator.atomGroups({"group-by":XV.ammp(`residueKey`)}),test:XV.core.logic.or([XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2*`)]),XV.core.set.has([XV.ammpSet(`label_atom_id`),XV.atomName(`O2'`)])])})])})},protein:{"@desc":`defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).`,map:()=>TPe()},acidic:{"@desc":`ASP GLU`,map:()=>VV(ZV.acidic)},acyclic:{"@desc":`amino and not cyclic`,map:()=>XV.struct.modifier.intersectBy({0:VV(ZV.amino),by:jV(VV(ZV.cyclic))})},aliphatic:{"@desc":`ALA GLY ILE LEU VAL`,map:()=>VV(ZV.aliphatic)},amino:{"@desc":`all twenty standard amino acids, plus ASX, GLX, UNK`,map:()=>VV(ZV.amino)},aromatic:{"@desc":`HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)`,map:()=>VV(ZV.aromatic)},basic:{"@desc":`ARG HIS LYS`,map:()=>VV(ZV.basic)},buried:{"@desc":`ALA CYS ILE LEU MET PHE TRP VAL`,map:()=>VV(ZV.buried)},charged:{"@desc":`same as acidic or basic -- ASP GLU, ARG HIS LYS`,map:()=>VV(ZV.acidic.concat(ZV.basic))},cyclic:{"@desc":`HIS PHE PRO TRP TYR`,map:()=>VV(ZV.cyclic)},helix:{"@desc":`secondary structure-related.`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`helix`]),XV.ammp(`secondaryStructureFlags`)])})},helixalpha:{"@desc":`secondary structure-related.`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`alpha`]),XV.ammp(`secondaryStructureFlags`)])})},helix310:{"@desc":`secondary structure-related.`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`3-10`]),XV.ammp(`secondaryStructureFlags`)])})},helixpi:{"@desc":`secondary structure-related.`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`pi`]),XV.ammp(`secondaryStructureFlags`)])})},hetero:{"@desc":`PDB atoms designated as HETATM`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.ammp(`isHet`)})},hydrophobic:{"@desc":`ALA GLY ILE LEU MET PHE PRO TRP TYR VAL`,map:()=>VV(ZV.hydrophobic)},large:{"@desc":`ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR`,map:()=>VV(ZV.large)},medium:{"@desc":`ASN ASP CYS PRO THR VAL`,map:()=>VV(ZV.medium)},negative:{"@desc":`same as acidic -- ASP GLU`,map:()=>VV(ZV.acidic)},neutral:{"@desc":`amino and not (acidic or basic)`,map:()=>XV.struct.modifier.intersectBy({0:VV(ZV.amino),by:jV(VV(ZV.acidic.concat(ZV.basic)))})},polar:{"@desc":`amino and not hydrophobic`,map:()=>XV.struct.modifier.intersectBy({0:VV(ZV.amino),by:jV(VV(ZV.hydrophobic))})},positive:{"@desc":`same as basic -- ARG HIS LYS`,map:()=>VV(ZV.basic)},sheet:{"@desc":`secondary structure-related`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`sheet`]),XV.ammp(`secondaryStructureFlags`)])})},small:{"@desc":`ALA GLY SER`,map:()=>VV(ZV.small)},surface:{"@desc":`amino and not buried`,map:()=>XV.struct.modifier.intersectBy({0:VV(ZV.amino),by:jV(VV(ZV.buried))})},turn:{"@desc":`secondary structure-related`,map:()=>XV.struct.generator.atomGroups({"residue-test":XV.core.flags.hasAny([XV.struct.type.secondaryStructureFlags([`turn`]),XV.ammp(`secondaryStructureFlags`)])})},alpha:{"@desc":`(*.CA)`,map:()=>XV.struct.generator.atomGroups({"atom-test":XV.core.rel.eq([XV.atomName(`CA`),XV.ammp(`label_atom_id`)])})},base:{"@desc":`(nucleic bases)`},backbone:{"@desc":`(*.C, *.CA, *.N, and all nucleic other than the bases themselves)`,abbr:[`mainchain`],map:()=>EPe()},sidechain:{"@desc":`((protein or nucleic) and not backbone)`},spine:{"@desc":`(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)`},leadatom:{"@desc":`(*.CA, *.P, and terminal *.O5')`},solvent:{"@desc":`PDB "HOH", water, also the connected set of H-O-H in any model`}};var tH=Z,DPe=[{"@desc":`value comparisons`,"@examples":[],name:`=`,abbr:[`==`],type:SV,rule:fV.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,n)=>{let r;if(t===`structure`?r=tH.core.flags.hasAny([tH.ammp(`secondaryStructureFlags`),KV(n)]):n===`structure`?r=tH.core.flags.hasAny([tH.ammp(`secondaryStructureFlags`),KV(t)]):t.head===void 0?n.head===void 0?e.toUpperCase()===`LIKE`&&(r=t.head?tH.core.str.match([tH.core.type.regex([`^${n}$`,`i`]),tH.core.type.str([t])]):tH.core.str.match([tH.core.type.regex([`^${t}$`,`i`]),tH.core.type.str([n])])):n.head.name===`core.type.regex`&&(r=tH.core.str.match([n,tH.core.type.str([t])])):t.head.name===`core.type.regex`&&(r=tH.core.str.match([t,tH.core.type.str([n])])),!r)switch(t.head&&(n=BV(t,n)),n.head&&(t=BV(n,t)),e){case`=`:r=tH.core.rel.eq([t,n]);break;case`!=`:r=tH.core.rel.neq([t,n]);break;case`>`:r=tH.core.rel.gr([t,n]);break;case`<`:r=tH.core.rel.lt([t,n]);break;case`>=`:r=tH.core.rel.gre([t,n]);break;case`<=`:r=tH.core.rel.lte([t,n]);break;default:throw Error(`value operator '${e}' not supported`)}return tH.struct.generator.atomGroups({"atom-test":r})}}];function OPe(e){let[t,n,r,i,a,o,s]=e[1],c={};a&&(c[`chain-test`]=tH.core.rel.eq([tH.ammp(`auth_asym_id`),a]));let l=[];t&&l.push(tH.core.rel.eq([tH.ammp(`label_comp_id`),t])),n&&l.push(tH.core.logic.and([tH.core.rel.gre([tH.ammp(`auth_seq_id`),n[0]]),tH.core.rel.lte([tH.ammp(`auth_seq_id`),n[1]])])),r&&l.push(tH.core.rel.eq([tH.ammp(`auth_seq_id`),r])),i&&l.push(tH.core.rel.eq([tH.ammp(`pdbx_PDB_ins_code`),i])),l.length&&(c[`residue-test`]=kV(l));let u=[];return o&&u.push(tH.core.rel.eq([tH.ammp(`auth_atom_id`),o])),s&&u.push(tH.core.rel.eq([tH.ammp(`label_alt_id`),s])),u.length&&(c[`atom-test`]=kV(u)),tH.struct.generator.atomGroups(c)}var kPe=fV.createLanguage({Integer:()=>fV.regexp(/-?[0-9]+/).map(Number).desc(`integer`),Parens:function(e){return fV.alt(e.Parens,e.Operator,e.Expression).wrap(fV.regexp(/\(\s*/),fV.regexp(/\s*\)/))},Expression:function(e){return fV.alt(e.Keywords,e.AtomExpression.map(OPe),e.Within.map(e=>tH.struct.modifier.includeSurroundings({0:e[1],radius:e[0]})),e.ValueQuery,e.Element.map(e=>tH.struct.generator.atomGroups({"atom-test":tH.core.rel.eq([tH.acp(`elementSymbol`),tH.struct.type.elementSymbol(e)])})),e.Resname.map(e=>tH.struct.generator.atomGroups({"residue-test":tH.core.rel.eq([tH.ammp(`label_comp_id`),e])})))},Operator:function(e){return CV(YV,fV.alt(e.Parens,e.Expression))},AtomExpression:function(e){return fV.seq(fV.lookahead(e.AtomPrefix),fV.seq(e.BracketedResname.or(fV.of(null)),e.ResnoRange.or(fV.of(null)),e.Resno.or(fV.of(null)),e.Inscode.or(fV.of(null)),e.Chainname.or(fV.of(null)),e.Atomname.or(fV.of(null)),e.Altloc.or(fV.of(null)),e.Model.or(fV.of(null)))).desc(`expression`)},AtomPrefix:()=>fV.regexp(/[\[0-9:^%/.-]/).desc(`atom-prefix`),Chainname:()=>fV.regexp(/:([A-Za-z]{1,3})/,1).desc(`chainname`),Model:()=>fV.regexp(/\/([0-9]+)/,1).map(Number).desc(`model`),Element:()=>fV.regexp(/_([A-Za-z]{1,3})/,1).desc(`element`),Atomname:()=>fV.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(tH.atomName).desc(`atomname`),Resname:()=>fV.regexp(/[a-zA-Z0-9]{1,4}/).desc(`resname`),Resno:e=>e.Integer.desc(`resno`),Altloc:()=>fV.regexp(/%([a-zA-Z0-9])/,1).desc(`altloc`),Inscode:()=>fV.regexp(/\^([a-zA-Z0-9])/,1).desc(`inscode`),BracketedResname:()=>fV.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc(`bracketed-resname`),ResnoRange:e=>fV.seq(e.Integer.skip(fV.seq(fV.optWhitespace,fV.string(`-`),fV.optWhitespace)),e.Integer).desc(`resno-range`),Within:e=>fV.regexp(/within/i).skip(fV.regexp(/\s*\(\s*/)).then(fV.seq(e.Integer.skip(fV.regexp(/\s*,\s*/)),e.Query)).skip(fV.regexp(/\)/)),Keywords:()=>fV.alt(...FV(eH)).desc(`keyword`),Query:function(e){return fV.alt(e.Operator,e.Parens,e.Expression).trim(fV.optWhitespace)},Number:function(){return fV.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc(`number`)},String:function(){let e=LV(qV,eH,YV).sort(MV).map(XT).join(`|`);return fV.alt(fV.regexp(RegExp(`(?!(${e}))[A-Z0-9_]+`,`i`)),fV.regexp(/'((?:[^"\\]|\\.)*)'/,1),fV.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(e=>tH.core.type.regex([`^${e}$`,`i`]))).desc(`string`)},Value:function(e){return fV.alt(e.Number,e.String)},ValueParens:function(e){return fV.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(fV.string(`(`),fV.string(`)`))},ValuePropertyNames:function(){return fV.alt(...IV(qV,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return CV(DPe,fV.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return fV.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return fV.alt(e.ValueOperator.map(e=>{if(e.head){if(e.head.name.startsWith(`structure-query.generator`))return e}else if(typeof e==`string`&&e.length<=4)return tH.struct.generator.atomGroups({"residue-test":tH.core.rel.eq([tH.ammp(`label_comp_id`),e])});throw Error(`values must be part of an comparison, value '${e}'`)}))}});const APe=e=>kPe.Query.tryParse(e);var nH=Z,rH=/[-+]?[0-9]*\.?[0-9]+/;function jPe(e){return e.split(`+`).map(nH.atomName)}function iH(e){return e.split(`+`).map(e=>e.replace(/^["']|["']$/g,``))}function aH(e){if(e.includes(`-`)&&e.includes(`+`)){let t=e.split(`+`).map(e=>e.replace(/^["']|["']$/g,``)),n=[];return t.forEach(e=>{if(e.includes(`-`)&&!e.startsWith(`-`)){let[t,r]=e.split(`-`).map(e=>parseInt(e));for(let e=t;e<=r;e++)n.push(e)}else if(e.includes(`-`)&&e.startsWith(`-`)&&e.match(/[0-9]+-[-0-9]+/)){let t=-parseInt(e.split(`-`)[1]),r;r=e.includes(`--`)?-parseInt(e.split(`-`)[3]):parseInt(e.split(`-`)[2]);for(let e=t;e<=r;e++)n.push(e)}else e.includes(`-`)&&e.startsWith(`-`)&&e.match(/[0-9]+-[-0-9]+/),n.push(parseInt(e))}),n}else if(e.includes(`-`)&&!e.includes(`+`)){let t=[];if(e.startsWith(`-`))if(e.startsWith(`-`)&&e.match(/[0-9]+-[-0-9]+/)){let n=-parseInt(e.split(`-`)[1]),r;r=e.includes(`--`)?-parseInt(e.split(`-`)[3]):parseInt(e.split(`-`)[2]);for(let e=n;e<=r;e++)t.push(e)}else e.startsWith(`-`)&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e));else{let[n,r]=e.split(`-`).map(e=>parseInt(e));for(let e=n;e<=r;e++)t.push(e)}return t}else if(!e.includes(`-`)&&e.includes(`+`))return iH(e).map(e=>parseInt(e));else return[parseInt(e)]}function MPe(e){return e.split(`+`).map(nH.struct.type.elementSymbol)}var NPe={H:`helix`,S:`beta`,L:`none`};function PPe(e){return{flags:nH.struct.type.secondaryStructureFlags(e.toUpperCase().split(`+`).map(e=>NPe[e]||`none`))}}const oH={symbol:{"@desc":`chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table`,"@examples":[`symbol O+N`],abbr:[`e.`],regex:/[a-zA-Z'"+]+/,map:MPe,level:`atom-test`,property:nH.acp(`elementSymbol`)},name:{"@desc":`atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids`,"@examples":[`name CA+CB+CG+CD`],abbr:[`n.`],regex:/[a-zA-Z0-9'"+]+/,map:jPe,level:`atom-test`,property:nH.ammp(`label_atom_id`)},resn:{"@desc":`residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids`,"@examples":[`resn ASP+GLU+ASN+GLN`,`resn A+G`],abbr:[`resname`,`r.`],regex:/[a-zA-Z0-9'"+]+/,map:iH,level:`residue-test`,property:nH.ammp(`label_comp_id`)},resi:{"@desc":`residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range`,"@examples":[`resi 1+10+100+1000`,`resi 1-10`],abbr:[`resident`,`residue`,`resid`,`i.`],regex:/[0-9+-]+/,map:aH,level:`residue-test`,property:nH.ammp(`auth_seq_id`)},alt:{"@desc":`alternate-conformation-identifier-list list of single letters`,"@examples":[`alt A+B`,`alt ""`,`alt ""+A`],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:iH,level:`atom-test`,property:nH.ammp(`label_alt_id`)},chain:{"@desc":`chain-identifier-list list of single letters or sometimes numbers`,"@examples":[`chain A`],abbr:[`c.`],regex:/[a-zA-Z0-9'"+]+/,map:iH,level:`chain-test`,property:nH.ammp(`auth_asym_id`)},segi:{"@desc":`segment-identifier-list list of up to 4 letter identifiers`,"@examples":[`segi lig`],abbr:[`segid`,`s.`],regex:/[a-zA-Z0-9'"+]+/,map:iH,level:`chain-test`,property:nH.ammp(`label_asym_id`)},flag:{"@desc":`flag-number a single integer from 0 to 31`,"@examples":[`flag 0`],isUnsupported:!0,abbr:[`f.`],regex:/[0-9]+/,map:e=>parseInt(e),level:`atom-test`},numeric_type:{"@desc":`type-number a single integer`,"@examples":[`nt. 5`],isUnsupported:!0,abbr:[`nt.`],regex:/[0-9]+/,map:e=>parseInt(e),level:`atom-test`},text_type:{"@desc":`type-string a list of up to 4 letter codes`,"@examples":[`text_type HA+HC`],isUnsupported:!0,abbr:[`tt.`],regex:/[a-zA-Z0-9'"+]+/,map:iH,level:`atom-test`},id:{"@desc":`external-index-number a single integer`,"@examples":[`id 23`],regex:/[0-9+-]+/,map:aH,level:`atom-test`,property:nH.ammp(`id`)},index:{"@desc":`internal-index-number a single integer`,"@examples":[`index 11`],regex:/[0-9+-]+/,map:aH,level:`atom-test`,property:nH.ammp(`id`)},ss:{"@desc":`secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.`,"@examples":[`ss H+S+L`,`ss S+""`],abbr:[],regex:/[a-zA-Z'"+]+/,map:PPe,level:`residue-test`,property:nH.ammp(`secondaryStructureFlags`)},b:{"@desc":`comparison-operator b-factor-value a real number`,"@examples":[`b > 10`],isNumeric:!0,abbr:[],regex:rH,map:e=>parseFloat(e),level:`atom-test`,property:nH.ammp(`B_iso_or_equiv`)},q:{"@desc":`comparison-operator occupancy-value a real number`,"@examples":[`q <0.50`],isNumeric:!0,abbr:[],regex:rH,map:e=>parseFloat(e),level:`atom-test`,property:nH.ammp(`occupancy`)},formal_charge:{"@desc":`comparison-operator formal charge-value an integer`,"@examples":[`fc. = -1`],isNumeric:!0,abbr:[`fc.`],regex:rH,map:e=>parseFloat(e),level:`atom-test`,property:nH.ammp(`pdbx_formal_charge`)},partial_charge:{"@desc":`comparison-operator partial charge-value a real number`,"@examples":[`pc. > 1`],isUnsupported:!0,isNumeric:!0,abbr:[`pc.`],regex:rH,map:e=>parseFloat(e),level:`atom-test`},elem:{"@desc":`str  atomic element symbol string ("X" if undefined)`,"@examples":[`elem N`],regex:/[a-zA-Z0-9]{1,3}/,map:e=>nH.es(e),level:`atom-test`,property:nH.acp(`elementSymbol`)}};var sH=Z;const cH=[{"@desc":`Selects atoms that are not included in s1.`,"@examples":[`NOT resn ALA`,`not (resi 42 or chain A)`,`!resi 42 or chain A`],name:`not`,type:bV,rule:fV.alt(fV.regexp(/NOT/i).skip(fV.whitespace),fV.string(`!`).skip(fV.optWhitespace)),map:(e,t)=>jV(t)},{"@desc":`Selects atoms included in both s1 and s2.`,"@examples":[`chain A AND name CA`],name:`and`,type:SV,rule:wV(/AND|&/i),map:(e,t,n)=>sH.struct.modifier.intersectBy({0:t,by:n})},{"@desc":`Selects atoms included in either s1 or s2.`,"@examples":[`chain A OR chain B`],name:`or`,type:SV,rule:wV(/OR|\|/i),map:(e,t,n)=>sH.struct.combinator.merge([t,n])},{"@desc":`Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.`,"@examples":[`chain A IN chain B`],name:`in`,type:SV,rule:wV(/IN/i),map:(e,t,n)=>sH.struct.filter.withSameAtomProperties({0:t,source:n,property:sH.core.type.compositeKey([sH.ammp(`label_atom_id`),sH.ammp(`label_seq_id`),sH.ammp(`label_comp_id`),sH.ammp(`auth_asym_id`),sH.ammp(`label_asym_id`)])})},{"@desc":`Selects atoms in s1 whose identifiers name and resi match atoms in s2.`,"@examples":[`chain A LIKE chain B`],name:`like`,type:SV,rule:wV(/LIKE|l\./i),map:(e,t,n)=>sH.struct.filter.withSameAtomProperties({0:t,source:n,property:sH.core.type.compositeKey([sH.ammp(`label_atom_id`),sH.ammp(`label_seq_id`)])})},{"@desc":`Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.`,"@examples":[`solvent GAP 2`],name:`gap`,type:xV,rule:EV(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>sH.struct.filter.within({0:sH.struct.generator.all(),target:t,"atom-radius":sH.acp(`vdw`),"max-radius":e,invert:!0})},{"@desc":`Selects atoms with centers within X Angstroms of the center of any atom in s1.`,"@examples":[`resname LIG AROUND 1`],name:`around`,abbr:[`a.`],type:xV,rule:EV(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>sH.struct.modifier.exceptBy({0:sH.struct.filter.within({0:sH.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":`Expands s1 by all atoms within X Angstroms of the center of any atom in s1.`,"@examples":[`chain A EXPAND 3`],name:`expand`,abbr:[`x.`],type:xV,rule:EV(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>sH.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":`Selects atoms in s1 that are within X Angstroms of any atom in s2.`,"@examples":[`chain A WITHIN 3 OF chain B`],name:`within`,abbr:[`w.`],type:SV,rule:DV(`WITHIN`,`w.`),map:(e,t,n)=>sH.struct.filter.within({0:t,target:n,"max-radius":e})},{"@desc":`Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).`,"@examples":[`chain A NEAR_TO 3 OF chain B`],name:`near_to`,abbr:[`nto.`],type:SV,rule:DV(`NEAR_TO`,`nto.`),map:(e,t,n)=>sH.struct.modifier.exceptBy({0:sH.struct.filter.within({0:t,target:n,"max-radius":e}),by:n})},{"@desc":`Selects atoms in s1 that are at least X Anstroms away from s2.`,"@examples":[`solvent BEYOND 2 OF chain A`],name:`beyond`,abbr:[`be.`],type:SV,rule:DV(`BEYOND`,`be.`),map:(e,t,n)=>sH.struct.modifier.exceptBy({0:sH.struct.filter.within({0:t,target:n,"max-radius":e,invert:!0}),by:n})},{"@desc":`Expands selection to complete residues.`,"@examples":[`BYRESIDUE name N`],name:`byresidue`,abbr:[`byresi`,`byres`,`br.`],type:bV,rule:TV(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>zV(sH.struct.modifier.expandProperty({0:sH.struct.modifier.union({0:t}),property:sH.ammp(`residueKey`)}))},{"@desc":`Completely selects all alpha carbons in all residues covered by a selection.`,"@examples":[`BYCALPHA chain A`],name:`bycalpha`,abbr:[`bca.`],type:bV,rule:TV(/BYCALPHA|bca\./i),map:(e,t)=>sH.struct.generator.queryInSelection({0:sH.struct.modifier.expandProperty({0:sH.struct.modifier.union({0:t}),property:sH.ammp(`residueKey`)}),query:sH.struct.generator.atomGroups({"atom-test":sH.core.rel.eq([sH.atomName(`CA`),sH.ammp(`label_atom_id`)])})})},{"@desc":`Expands selection to complete molecules.`,"@examples":[`BYMOLECULE resi 20-30`],name:`bymolecule`,isUnsupported:!0,abbr:[`bymol`,`bm.`],type:bV,rule:TV(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>zV(sH.struct.modifier.expandProperty({0:sH.struct.modifier.union({0:t}),property:sH.atp(`connectedComponentKey`)}))},{"@desc":`Expands selection to complete fragments.`,"@examples":[`BYFRAGMENT resi 10`],name:`byfragment`,abbr:[`byfrag`,`bf.`],isUnsupported:!0,type:bV,rule:TV(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":`Expands selection to complete segments.`,"@examples":[`BYSEGMENT resn CYS`],name:`bysegment`,abbr:[`bysegi`,`byseg`,`bs.`],type:bV,rule:TV(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>zV(sH.struct.modifier.expandProperty({0:sH.struct.modifier.union({0:t}),property:sH.ammp(`chainKey`)}))},{"@desc":`Expands selection to complete objects.`,"@examples":[`BYOBJECT chain A`],name:`byobject`,abbr:[`byobj`,`bo.`],isUnsupported:!0,type:bV,rule:TV(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":`Expands selection to unit cell.`,"@examples":[`BYCELL chain A`],name:`bycell`,isUnsupported:!0,type:bV,rule:TV(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":`All rings of size  7 which have at least one atom in s1.`,"@examples":[`BYRING resn HEM`],name:`byring`,type:bV,rule:TV(/BYRING/i),map:(e,t)=>zV(sH.struct.modifier.intersectBy({0:sH.struct.filter.pick({0:sH.struct.generator.rings(),test:sH.core.logic.and([sH.core.rel.lte([sH.struct.atomSet.atomCount(),7]),sH.core.rel.gr([sH.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":`Selects atoms directly bonded to s1, excludes s1.`,"@examples":[`NEIGHBOR resn CYS`],name:`neighbor`,type:bV,abbr:[`nbr.`],rule:TV(/NEIGHBOR|nbr\./i),map:(e,t)=>sH.struct.modifier.exceptBy({0:zV(sH.struct.modifier.includeConnected({0:sH.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":`Selects atoms directly bonded to s1, may include s1.`,"@examples":[`BOUND_TO name CA`],name:`bound_to`,abbr:[`bto.`],type:bV,rule:TV(/BOUND_TO|bto\./i),map:(e,t)=>zV(sH.struct.modifier.includeConnected({0:sH.struct.modifier.union({0:t})}))},{"@desc":`Extends s1 by X bonds connected to atoms in s1.`,"@examples":[`resname LIG EXTEND 3`],name:`extend`,abbr:[`xt.`],type:xV,rule:EV(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>zV(sH.struct.modifier.includeConnected({0:sH.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}];var lH=Z,uH={nucleic:[`A`,`C`,`T`,`G`,`U`,`DA`,`DC`,`DT`,`DG`,`DU`],protein:[`ALA`,`ARG`,`ASN`,`ASP`,`CYS`,`CYX`,`GLN`,`GLU`,`GLY`,`HIS`,`HID`,`HIE`,`HIP`,`ILE`,`LEU`,`LYS`,`MET`,`MSE`,`PHE`,`PRO`,`SER`,`THR`,`TRP`,`TYR`,`VAL`],solvent:[`HOH`,`WAT`,`H20`,`TIP`,`SOL`]},dH={nucleic:[`P`,`O3'`,`O5'`,`C5'`,`C4'`,`C3'`,`OP1`,`OP2`,`O3*`,`O5*`,`C5*`,`C4*`,`C3*`,`C2'`,`C1'`,`O4'`,`O2'`],protein:[`C`,`N`,`CA`,`O`]};function fH(){return lH.struct.combinator.merge([lH.struct.modifier.intersectBy({0:lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.protein),lH.ammp(`label_comp_id`)])}),by:lH.struct.generator.atomGroups({"atom-test":lH.core.set.has([lH.core.type.set(dH.protein),lH.ammp(`label_atom_id`)])})}),lH.struct.modifier.intersectBy({0:lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.nucleic),lH.ammp(`label_comp_id`)])}),by:lH.struct.generator.atomGroups({"atom-test":lH.core.set.has([lH.core.type.set(dH.nucleic),lH.ammp(`label_atom_id`)])})})])}const pH={all:{"@desc":`All atoms currently loaded into PyMOL`,abbr:[`*`],map:()=>lH.struct.generator.all()},none:{"@desc":`No atoms (empty selection)`,map:()=>lH.struct.generator.empty()},hydrogens:{"@desc":`All hydrogen atoms currently loaded into PyMOL`,abbr:[`hydro`,`h.`],map:()=>lH.struct.generator.atomGroups({"atom-test":lH.core.rel.eq([lH.acp(`elementSymbol`),lH.es(`H`)])})},hetatm:{"@desc":`All atoms loaded from Protein Data Bank HETATM records`,abbr:[`het`],map:()=>lH.struct.generator.atomGroups({"atom-test":lH.core.rel.eq([lH.ammp(`isHet`),!0])})},visible:{"@desc":`All atoms in enabled objects with at least one visible representation`,abbr:[`v.`]},polymer:{"@desc":`All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.`,abbr:[`pol.`],map:()=>lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.nucleic.concat(uH.protein)),lH.ammp(`label_comp_id`)])})},sidechain:{"@desc":`Polymer non-backbone atoms (new in PyMOL 1.6.1)`,abbr:[`sc.`],map:()=>lH.struct.modifier.exceptBy({0:lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.nucleic.concat(uH.protein)),lH.ammp(`label_comp_id`)])}),by:fH()})},present:{"@desc":`All atoms with defined coordinates in the current state (used in creating movies)`,abbr:[`pr.`]},center:{"@desc":`Pseudo-atom at the center of the scene`},origin:{"@desc":`Pseudo-atom at the origin of rotation`},enabled:{"@desc":`All enabled objects or selections from the object list.`},masked:{"@desc":`All masked atoms.`,abbr:[`msk.`]},protected:{"@desc":`All protected atoms.`,abbr:[`pr.`]},bonded:{"@desc":`All bonded atoms`,map:()=>lH.struct.generator.atomGroups({"atom-test":lH.core.rel.gr([lH.struct.atomProperty.core.bondCount({flags:lH.struct.type.bondFlags([`covalent`,`metallic`,`sulfide`])}),0])})},donors:{"@desc":`All hydrogen bond donor atoms.`,abbr:[`don.`]},acceptors:{"@desc":`All hydrogen bond acceptor atoms.`,abbr:[`acc.`]},fixed:{"@desc":`All fixed atoms.`,abbr:[`fxd.`]},restrained:{"@desc":`All restrained atoms.`,abbr:[`rst.`]},organic:{"@desc":`All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.`,abbr:[`org.`],map:()=>zV(lH.struct.modifier.expandProperty({0:lH.struct.modifier.union([lH.struct.generator.queryInSelection({0:lH.struct.generator.atomGroups({"residue-test":lH.core.logic.not([lH.core.set.has([lH.core.type.set(uH.nucleic.concat(uH.protein)),lH.ammp(`label_comp_id`)])])}),query:lH.struct.generator.atomGroups({"atom-test":lH.core.rel.eq([lH.es(`C`),lH.acp(`elementSymbol`)])})})]),property:lH.ammp(`residueKey`)}))},inorganic:{"@desc":`All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.`,abbr:[`ino.`],map:()=>zV(lH.struct.modifier.expandProperty({0:lH.struct.modifier.union([lH.struct.filter.pick({0:lH.struct.generator.atomGroups({"residue-test":lH.core.logic.not([lH.core.set.has([lH.core.type.set(uH.nucleic.concat(uH.protein).concat(uH.solvent)),lH.ammp(`label_comp_id`)])]),"group-by":lH.ammp(`residueKey`)}),test:lH.core.logic.not([lH.core.set.has([lH.struct.atomSet.propertySet([lH.acp(`elementSymbol`)]),lH.es(`C`)])])})]),property:lH.ammp(`residueKey`)}))},solvent:{"@desc":`All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.`,abbr:[`sol.`],map:()=>lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.solvent),lH.ammp(`label_comp_id`)])})},guide:{"@desc":`All protein CA and nucleic acid C4*/C4`,map:()=>lH.struct.combinator.merge([lH.struct.generator.atomGroups({"atom-test":lH.core.rel.eq([lH.atomName(`CA`),lH.ammp(`label_atom_id`)]),"residue-test":lH.core.set.has([lH.core.type.set(uH.protein),lH.ammp(`label_comp_id`)])}),lH.struct.generator.atomGroups({"atom-test":lH.core.set.has([RV([`C4*`,`C4'`]),lH.ammp(`label_atom_id`)]),"residue-test":lH.core.set.has([lH.core.type.set(uH.nucleic),lH.ammp(`label_comp_id`)])})])},metals:{"@desc":`All metal atoms (new in PyMOL 1.6.1)`},backbone:{"@desc":`Polymer backbone atoms (new in PyMOL 1.6.1)`,abbr:[`bb.`],map:()=>fH()},"polymer.protein":{"@desc":`Protein (New in PyMOL 2.1)`,abbr:[`polymer.protein`],map:()=>lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.protein),lH.ammp(`label_comp_id`)])})},"polymer.nucleic":{"@desc":`Nucleic Acid (New in PyMOL 2.1)`,abbr:[`polymer.nucleic`],map:()=>lH.struct.generator.atomGroups({"residue-test":lH.core.set.has([lH.core.type.set(uH.nucleic),lH.ammp(`label_comp_id`)])})}};var FPe=Z,mH=hPe(oH),hH=fV.string(`/`);function gH(e){return e.or(fV.of(null))}function IPe(e){let t={},n={};for(let t in e){let r=oH[t];if(!r)throw Error(`property '${t}' not supported, value '${e[t]}'`);e[t]!==null&&(n[r.level]||(n[r.level]=[]),n[r.level].push(e[t]))}for(let e in n)t[e]=kV(n[e]);return FPe.struct.generator.atomGroups(t)}var LPe=fV.createLanguage({Parens:function(e){return fV.alt(e.Parens,e.Operator,e.Expression).wrap(fV.string(`(`),fV.string(`)`))},Expression:function(e){return fV.alt(e.Keywords,e.AtomSelectionMacro.map(IPe),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return fV.alt(hH.then(fV.alt(fV.seq(gH(e.ObjectProperty).skip(hH),gH(mH.segi).skip(hH),gH(mH.chain).skip(hH),gH(mH.resi).skip(hH),gH(mH.name)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3],name:e[4]})),fV.seq(gH(e.ObjectProperty).skip(hH),gH(mH.segi).skip(hH),gH(mH.chain).skip(hH),gH(mH.resi)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3]})),fV.seq(gH(e.ObjectProperty).skip(hH),gH(mH.segi).skip(hH),gH(mH.chain)).map(e=>({object:e[0],segi:e[1],chain:e[2]})),fV.seq(gH(e.ObjectProperty).skip(hH),gH(mH.segi)).map(e=>({object:e[0],segi:e[1]})),fV.seq(gH(e.ObjectProperty)).map(e=>({object:e[0]})))),fV.alt(fV.seq(gH(e.ObjectProperty).skip(hH),gH(mH.segi).skip(hH),gH(mH.chain).skip(hH),gH(mH.resi).skip(hH),gH(mH.name)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3],name:e[4]})),fV.seq(gH(mH.segi).skip(hH),gH(mH.chain).skip(hH),gH(mH.resi).skip(hH),gH(mH.name)).map(e=>({segi:e[0],chain:e[1],resi:e[2],name:e[3]})),fV.seq(gH(mH.chain).skip(hH),gH(mH.resi).skip(hH),gH(mH.name)).map(e=>({chain:e[0],resi:e[1],name:e[2]})),fV.seq(gH(mH.resi).skip(hH),gH(mH.name)).map(e=>({resi:e[0],name:e[1]}))))},NamedAtomProperties:function(){return fV.alt(...PV(oH))},Keywords:()=>fV.alt(...FV(pH)),ObjectProperty:()=>{let e=LV(oH,pH,cH).sort(MV).map(XT).join(`|`);return fV.regexp(RegExp(`(?!(${e}))[A-Z0-9_]+`,`i`))},Object:e=>e.ObjectProperty.notFollowedBy(hH).map(e=>{throw Error(`property 'object' not supported, value '${e}'`)}),Pepseq:()=>fV.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(OV(`operator 'pepseq' not supported`)),Rep:()=>fV.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(OV(`operator 'rep' not supported`)),Operator:function(e){return CV(cH,fV.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return fV.alt(e.Operator,e.Parens,e.Expression).trim(fV.optWhitespace)}});const RPe=e=>LPe.Query.tryParse(e);var _H=Z,vH=/[-+]?[0-9]*\.?[0-9]+/,yH=/[+]?[0-9]+/,bH=/[-+]?[0-9]+/;function xH(e){return e}const SH={T:`turn`,E:`sheet`,B:`strand`,H:`alpha`,G:`3-10`,I:`pi`,C:`none`};function CH(e){return _H.struct.type.secondaryStructureFlags([SH[e.toUpperCase()]||`none`])}const wH={name:{"@desc":`str    atom name`,"@examples":[`name CA`],regex:/[a-zA-Z0-9]+/,map:_H.atomName,level:`atom-test`,property:_H.ammp(`label_atom_id`)},type:{"@desc":`str    atom type`,"@examples":[`type C3`],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:xH,level:`atom-test`},index:{"@desc":`num    the atom number, starting at 0`,"@examples":[`index 10`],isNumeric:!0,regex:yH,map:e=>parseInt(e)-1,level:`atom-test`,property:_H.ammp(`id`)},serial:{"@desc":`num    the atom number, starting at 1`,"@examples":[`serial 11`],isNumeric:!0,regex:yH,map:e=>parseInt(e),level:`atom-test`,property:_H.ammp(`id`)},atomicnumber:{"@desc":`num    atomic number (0 if undefined)`,"@examples":[`atomicnumber 13`],isNumeric:!0,regex:yH,map:e=>parseInt(e),level:`atom-test`,property:_H.acp(`atomicNumber`)},element:{"@desc":`str  atomic element symbol string ("X" if undefined)`,"@examples":[`element N`],regex:/[a-zA-Z0-9]{1,3}/,map:e=>_H.es(e),level:`atom-test`,property:_H.acp(`elementSymbol`)},altloc:{"@desc":`str  alternate location/conformation identifier`,"@examples":[`altloc C`],regex:/[a-zA-Z0-9]+/,map:xH,level:`atom-test`,property:_H.ammp(`label_alt_id`)},chain:{"@desc":`str  the one-character chain identifier`,"@examples":[`chain A`],regex:/[a-zA-Z0-9]+/,map:xH,level:`residue-test`,property:_H.ammp(`auth_asym_id`)},residue:{"@desc":`num  a set of connected atoms with the same residue number`,"@examples":[`residue < 11`,`residue 11`],isNumeric:!0,regex:bH,map:e=>parseInt(e),level:`residue-test`,property:_H.ammp(`auth_seq_id`)},fragment:{"@desc":`num  a set of connected residues`,"@examples":[`fragment 42`],isUnsupported:!0,isNumeric:!0,regex:bH,map:e=>parseInt(e),level:`residue-test`},pfrag:{"@desc":`num  a set of connected protein residues`,"@examples":[`pfrag 42`],isUnsupported:!0,isNumeric:!0,regex:bH,map:e=>parseInt(e),level:`residue-test`},nfrag:{"@desc":`num  a set of connected nucleic residues`,"@examples":[`nfrag 42`],isUnsupported:!0,isNumeric:!0,regex:bH,map:e=>parseInt(e),level:`residue-test`},sequence:{"@desc":`str  a sequence given by one letter names`,"@examples":[`sequence PGATTACA`],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:xH,level:`residue-test`},numbonds:{"@desc":`num  number of bonds`,"@examples":[`numbonds = 2`,`numbonds >= 3`],isNumeric:!0,regex:yH,map:e=>parseInt(e),level:`atom-test`,property:_H.acp(`bondCount`)},resname:{"@desc":`str  residue name`,"@examples":[`resname ALA`],regex:/[a-zA-Z0-9]+/,map:xH,level:`residue-test`,property:_H.ammp(`auth_comp_id`)},resid:{"@desc":`num  residue id`,"@examples":[`resid 42`],isNumeric:!0,regex:bH,map:e=>parseInt(e),level:`residue-test`,property:_H.ammp(`auth_seq_id`)},segname:{"@desc":`str  segment name`,"@examples":[`segname B`],regex:/[a-zA-Z0-9]+/,map:xH,level:`residue-test`,property:_H.ammp(`label_asym_id`)},x:{"@desc":`float  x coordinate`,"@examples":[`x 42`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.acp(`x`)},y:{"@desc":`float  y coordinate`,"@examples":[`y > 1.7`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.acp(`y`)},z:{"@desc":`float  z coordinate`,"@examples":[`z < 11`,`z > -21`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.acp(`z`)},radius:{"@desc":`float  atomic radius`,"@examples":[`radius > 1.3`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.acp(`vdw`)},mass:{"@desc":`float  atomic mass`,"@examples":[`mass > 2`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.acp(`mass`)},charge:{"@desc":`float  atomic charge`,"@examples":[`charge > 0`,`charge 1`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.ammp(`pdbx_formal_charge`)},beta:{"@desc":`float  temperature factor`,"@examples":[`beta < 20`,`beta > 35`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.ammp(`B_iso_or_equiv`)},occupancy:{"@desc":`float  occupancy`,"@examples":[`occupancy 1`,`occupancy < 1`],isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`,property:_H.ammp(`occupancy`)},user:{"@desc":`float  time-varying user-specified value`,"@examples":[`user < 0.1`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`atom-test`},rasmol:{"@desc":`str  translates Rasmol selection string to VMD`,"@examples":[`rasmol 'all'`],isUnsupported:!0,regex:/[^']*/,map:xH,level:`atom-test`},structure:{"@desc":`str  single letter name for the secondary structure`,"@examples":[`structure H`,`structure H E`],regex:/T|E|B|H|G|I|C/i,map:CH,level:`atom-test`,property:_H.ammp(`secondaryStructureFlags`)},phi:{"@desc":`float  phi backbone conformational angles`,"@examples":[`phi < 160`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`residue-test`},psi:{"@desc":`float  psi backbone conformational angles`,"@examples":[`psi < 160`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseFloat(e),level:`residue-test`},ufx:{"@desc":`num  force to apply in the x coordinate`,"@examples":[`ufx 1`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseInt(e),level:`atom-test`},ufy:{"@desc":`num  force to apply in the y coordinate`,"@examples":[`ufy 1`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseInt(e),level:`atom-test`},ufz:{"@desc":`num  force to apply in the z coordinate`,"@examples":[`ufz 1`],isUnsupported:!0,isNumeric:!0,regex:vH,map:e=>parseInt(e),level:`atom-test`}};var TH=Z,zPe=Object.keys(wH).sort(MV).filter(e=>!wH[e].isUnsupported).join(`|`);const EH=[{"@desc":`Selects atoms that are not included in s1.`,"@examples":[`not protein`],name:`not`,type:bV,rule:fV.regexp(/NOT/i).skip(fV.whitespace),map:(e,t)=>jV(t)},{"@desc":`Selects atoms within a specified distance of a selection`,"@examples":[`within 5 of name FE`],name:`within`,type:bV,rule:TV(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>TH.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":`Exclusive within, equivalent to (within 3 of X) and not X`,"@examples":[`exwithin 10 of resname HEM`],name:`exwithin`,type:bV,rule:TV(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>TH.struct.modifier.exceptBy({0:TH.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":`Selects atoms which have the same keyword as the atoms in a given selection`,"@examples":[`same resid as name FE`],name:`same`,type:bV,rule:TV(RegExp(`SAME\\s+(${zPe})\\s+AS`,`i`),1).map(e=>wH[e].property),map:(e,t)=>TH.struct.filter.withSameAtomProperties({0:TH.struct.generator.all(),source:t,property:e})},{"@desc":`Selects atoms included in both s1 and s2.`,"@examples":[`backbone and protein`],name:`and`,type:SV,rule:fV.alt(wV(/AND/i),fV.whitespace),map:(e,t,n)=>TH.struct.modifier.intersectBy({0:t,by:n})},{"@desc":`Selects atoms included in either s1 or s2.`,"@examples":[`water or protein`],name:`or`,type:SV,rule:wV(/OR/i),map:(e,t,n)=>TH.struct.combinator.merge([t,n])}];var DH=Z;function OH(){return DH.struct.filter.pick({0:DH.struct.generator.atomGroups({"group-by":DH.ammp(`residueKey`)}),test:DH.core.set.isSubset([RV([`C`,`N`,`CA`,`O`]),DH.ammpSet(`label_atom_id`)])})}function kH(){return DH.struct.filter.pick({0:DH.struct.generator.atomGroups({"group-by":DH.ammp(`residueKey`)}),test:DH.core.logic.and([DH.core.set.isSubset([RV([`P`]),DH.ammpSet(`label_atom_id`)]),DH.core.logic.or([DH.core.set.isSubset([RV([`O3'`,`C3'`,`C4'`,`C5'`,`O5'`]),DH.ammpSet(`label_atom_id`)]),DH.core.set.isSubset([RV([`O3*`,`C3*`,`C4*`,`C5*`,`O5*`]),DH.ammpSet(`label_atom_id`)])])])})}function AH(){return DH.struct.combinator.merge([DH.struct.generator.queryInSelection({0:OH(),query:DH.struct.generator.atomGroups({"atom-test":DH.core.set.has([RV(MH.protein),DH.ammp(`label_atom_id`)])})}),DH.struct.generator.queryInSelection({0:kH(),query:DH.struct.generator.atomGroups({"atom-test":DH.core.set.has([RV(MH.nucleic),DH.ammp(`label_atom_id`)])})})])}function jH(e){return DH.struct.generator.atomGroups({"residue-test":DH.core.flags.hasAll([DH.ammp(`secondaryStructureFlags`),DH.struct.type.secondaryStructureFlags(e)])})}var MH={nucleic:[`P`,`O3'`,`O5'`,`C5'`,`C4'`,`C3'`,`OP1`,`OP2`,`O3*`,`O5*`,`C5*`,`C4*`,`C3*`],protein:[`C`,`N`,`CA`,`O`]},NH={acidic:[`ASP`,`GLU`],aliphatic:[`ALA`,`GLY`,`ILE`,`LEU`,`VAL`],aromatic:[`HIS`,`PHE`,`TRP`,`TYR`],at:[`ADA`,`A`,`THY`,`T`],basic:[`ARG`,`HIS`,`LYS`],buried:[`ALA`,`LEU`,`VAL`,`ILE`,`PHE`,`CYS`,`MET`,`TRP`],cg:[`CYT`,`C`,`GUA`,`G`],cyclic:[`HIS`,`PHE`,`PRO`,`TRP`,`TYR`],hydrophobic:[`ALA`,`LEU`,`VAL`,`ILE`,`PRO`,`PHE`,`MET`,`TRP`],medium:[`VAL`,`THR`,`ASP`,`ASN`,`PRO`,`CYS`,`ASX`,`PCA`,`HYP`],neutral:[`VAL`,`PHE`,`GLN`,`TYR`,`HIS`,`CYS`,`MET`,`TRP`,`ASX`,`GLX`,`PCA`,`HYP`],purine:[`ADE`,`A`,`GUA`,`G`],pyrimidine:[`CYT`,`C`,`THY`,`T`,`URI`,`U`],small:[`ALA`,`GLY`,`SER`],water:[`H2O`,`HH0`,`OHH`,`HOH`,`OH2`,`SOL`,`WAT`,`TIP`,`TIP2`,`TIP3`,`TIP4`]};const PH={all:{"@desc":`everything`,map:()=>DH.struct.generator.all()},none:{"@desc":`nothing`,map:()=>DH.struct.generator.empty()},protein:{"@desc":`a residue with atoms named C, N, CA, and O`,map:()=>OH()},nucleic:{"@desc":`a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.`,map:()=>kH()},backbone:{"@desc":`the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.`,map:()=>AH()},sidechain:{"@desc":`non-backbone atoms and bonds`,map:()=>jV(AH())},water:{"@desc":`all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4`,abbr:[`waters`],map:()=>VV(NH.water)},at:{"@desc":`residues named ADA A THY T`,map:()=>VV(NH.at)},acidic:{"@desc":`residues named ASP GLU`,map:()=>VV(NH.acidic)},acyclic:{"@desc":`"protein and not cyclic"`,map:()=>DH.struct.modifier.intersectBy({0:OH(),by:jV(VV(NH.cyclic))})},aliphatic:{"@desc":`residues named ALA GLY ILE LEU VAL`,map:()=>VV(NH.aliphatic)},alpha:{"@desc":`atom's residue is an alpha helix`,map:()=>jH([`alpha`])},amino:{"@desc":`a residue with atoms named C, N, CA, and O`,map:()=>OH()},aromatic:{"@desc":`residues named HIS PHE TRP TYR`,map:()=>VV(NH.aromatic)},basic:{"@desc":`residues named ARG HIS LYS`,map:()=>VV(NH.basic)},bonded:{"@desc":`atoms for which numbonds > 0`,map:()=>zV(DH.struct.filter.pick({0:DH.struct.modifier.includeConnected({0:DH.struct.generator.all(),"bond-test":DH.core.flags.hasAny([DH.struct.bondProperty.flags(),DH.struct.type.bondFlags([`covalent`,`metallic`,`sulfide`])])}),test:DH.core.rel.gr([DH.struct.atomSet.atomCount(),1])}))},buried:{"@desc":`residues named ALA LEU VAL ILE PHE CYS MET TRP`,map:()=>VV(NH.buried)},cg:{"@desc":`residues named CYT C GUA G`,map:()=>VV(NH.cg)},charged:{"@desc":`"basic or acidic"`,map:()=>VV(NH.basic.concat(NH.acidic))},cyclic:{"@desc":`residues named HIS PHE PRO TRP TYR`,map:()=>VV(NH.cyclic)},hetero:{"@desc":`"not (protein or nucleic)"`,map:()=>jV(DH.struct.combinator.merge([OH(),kH()]))},hydrogen:{"@desc":`name "[0-9]?H.*"`,map:()=>DH.struct.generator.atomGroups({"atom-test":DH.core.str.match([DH.core.type.regex([`^[0-9]?[H].*$`,`i`]),DH.core.type.str([DH.ammp(`label_atom_id`)])])})},large:{"@desc":`"protein and not (small or medium)"`,map:()=>DH.struct.modifier.intersectBy({0:OH(),by:jV(VV(NH.small.concat(NH.medium)))})},medium:{"@desc":`residues named VAL THR ASP ASN PRO CYS ASX PCA HYP`,map:()=>VV(NH.medium)},neutral:{"@desc":`residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP`,map:()=>VV(NH.neutral)},hydrophobic:{"@desc":`hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP`,map:()=>VV(NH.hydrophobic)},polar:{"@desc":`"protein and not hydrophobic"`,map:()=>DH.struct.modifier.intersectBy({0:OH(),by:jV(VV(NH.hydrophobic))})},purine:{"@desc":`residues named ADE A GUA G`,map:()=>VV(NH.purine)},pyrimidine:{"@desc":`residues named CYT C THY T URI U`,map:()=>VV(NH.pyrimidine)},small:{"@desc":`residues named ALA GLY SER`,map:()=>VV(NH.small)},surface:{"@desc":`"protein and not buried"`,map:()=>DH.struct.modifier.intersectBy({0:OH(),by:jV(VV(NH.buried))})},alpha_helix:{"@desc":`atom's residue is in an alpha helix`,map:()=>jH([`alpha`])},pi_helix:{"@desc":`atom's residue is in a pi helix`,map:()=>jH([`pi`])},helix_3_10:{"@desc":`atom's residue is in a 3-10 helix`,map:()=>jH([`3-10`])},helix:{"@desc":`atom's residue is in an alpha or pi or 3-10 helix`,map:()=>jH([`helix`])},extended_beta:{"@desc":`atom's residue is a beta sheet`,map:()=>jH([`sheet`])},bridge_beta:{"@desc":`atom's residue is a beta sheet`,map:()=>jH([`strand`])},sheet:{"@desc":`atom's residue is a beta sheet`,map:()=>jH([`beta`])},turn:{"@desc":`atom's residue is in a turn conformation`,map:()=>jH([`turn`])},coil:{"@desc":`atom's residue is in a coil conformation`,map:()=>DH.struct.modifier.intersectBy({0:OH(),by:jH([`none`])})}};var FH=Z;const BPe={sqr:{"@desc":`square of x`,"@examples":[`sqr(2)`],map:e=>FH.core.math.pow([e,2])},sqrt:{"@desc":`square root of x`,"@examples":[`sqrt(2)`],map:e=>FH.core.math.sqrt([e])},abs:{"@desc":`absolute value of x`,"@examples":[`abs(2)`],map:e=>FH.core.math.abs([e])},floor:{"@desc":`largest integer not greater than x`,"@examples":[`floor(2)`],map:e=>FH.core.math.floor([e])},ceil:{"@desc":`smallest integer not less than x`,"@examples":[`ceil(2)`],map:e=>FH.core.math.ceil([e])},sin:{"@desc":`sine of x`,"@examples":[`sin(2)`],map:e=>FH.core.math.sin([e])},cos:{"@desc":`cosine of x`,"@examples":[`cos(2)`],map:e=>FH.core.math.cos([e])},tan:{"@desc":`tangent of x`,"@examples":[`tan(2)`],map:e=>FH.core.math.tan([e])},atan:{"@desc":`arctangent of x`,"@examples":[`atan(2)`],map:e=>FH.core.math.atan([e])},asin:{"@desc":`arcsin of x`,"@examples":[`asin(2)`],map:e=>FH.core.math.asin([e])},acos:{"@desc":`arccos of x`,"@examples":[`acos(2)`],map:e=>FH.core.math.acos([e])},sinh:{"@desc":`hyperbolic sine of x`,"@examples":[`sinh(2)`],map:e=>FH.core.math.sinh([e])},cosh:{"@desc":`hyperbolic cosine of x`,"@examples":[`cosh(2)`],map:e=>FH.core.math.cosh([e])},tanh:{"@desc":`hyperbolic tangent of x`,"@examples":[`tanh(2)`],map:e=>FH.core.math.tanh([e])},exp:{"@desc":`e to the power x`,"@examples":[`exp(2)`],map:e=>FH.core.math.exp([e])},log:{"@desc":`natural log of x`,"@examples":[`log(2)`],map:e=>FH.core.math.log([e])},log10:{"@desc":`log base 10 of x`,"@examples":[`log10(2)`],map:e=>FH.core.math.log10([e])}};var IH=Z,VPe=[{"@desc":`multiplication, division`,"@examples":[],name:`mul-div`,type:SV,rule:fV.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,n)=>{switch(e){case`*`:return IH.core.math.mult([t,n]);case`/`:return IH.core.math.div([t,n]);default:throw Error(`value operator '${e}' not supported`)}}},{"@desc":`addition, substraction`,"@examples":[],name:`add-sub`,type:SV,rule:fV.regexp(/\s*(-|\+)\s*/,1),map:(e,t,n)=>{switch(e){case`-`:return IH.core.math.sub([t,n]);case`+`:return IH.core.math.add([t,n]);default:throw Error(`value operator '${e}' not supported`)}}},{"@desc":`value comparisons`,"@examples":[],name:`comparison`,type:SV,rule:fV.alt(fV.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),fV.whitespace.result(`=`)),map:(e,t,n)=>{let r;if(t.head===void 0?n.head===void 0?e===`=~`&&(r=t.head?IH.core.str.match([IH.core.type.regex([`^${n}$`,`i`]),IH.core.type.str([t])]):IH.core.str.match([IH.core.type.regex([`^${t}$`,`i`]),IH.core.type.str([n])])):(n.head.name===`structure-query.atom-property.macromolecular.secondary-structure-flags`&&(r=IH.core.flags.hasAny([n,CH(t)])),n.head.name===`core.type.regex`&&(r=IH.core.str.match([n,IH.core.type.str([t])]))):(t.head.name===`structure-query.atom-property.macromolecular.secondary-structure-flags`&&(r=IH.core.flags.hasAny([t,CH(n)])),t.head.name===`core.type.regex`&&(r=IH.core.str.match([t,IH.core.type.str([n])]))),!r)switch(t.head&&(n=BV(t,n)),n.head&&(t=BV(n,t)),e){case`=`:case`==`:r=IH.core.rel.eq([t,n]);break;case`!=`:r=IH.core.rel.neq([t,n]);break;case`>`:r=IH.core.rel.gr([t,n]);break;case`<`:r=IH.core.rel.lt([t,n]);break;case`>=`:r=IH.core.rel.gre([t,n]);break;case`<=`:r=IH.core.rel.lte([t,n]);break;default:throw Error(`value operator '${e}' not supported`)}return IH.struct.generator.atomGroups({"atom-test":r})}}],HPe=fV.createLanguage({Parens:function(e){return fV.alt(e.Parens,e.Operator,e.Expression).wrap(fV.string(`(`),fV.string(`)`))},Expression:function(e){return fV.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return fV.alt(...PV(wH))},Keywords:()=>fV.alt(...FV(PH)),ValueRange:function(e){return fV.seq(e.Value.skip(fV.regexp(/\s+TO\s+/i)),e.Value).map(e=>({range:e}))},RangeListProperty:function(e){return fV.seq(fV.alt(...IV(wH,/\s/)).skip(fV.whitespace),fV.alt(e.ValueRange,e.Value).sepBy1(fV.whitespace)).map(e=>{let[t,n]=e,r=[],i=[];n.forEach(e=>{e.range?i.push(IH.core.rel.inRange([t,e.range[0],e.range[1]])):r.push(BV(t,e,SH))});let a=mPe(i),o=CPe(t,r),s;return s=a&&o?IH.core.logic.or([a,o]):a||o,IH.struct.generator.atomGroups({[xPe(t)]:s})})},Operator:function(e){return CV(EH,fV.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return fV.alt(e.Operator,e.Parens,e.Expression).trim(fV.optWhitespace)},Number:function(){return fV.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc(`number`)},String:function(){let e=LV(wH,PH,EH).sort(MV).map(XT).join(`|`);return fV.alt(fV.regexp(RegExp(`(?!(${e}))[A-Z0-9_]+`,`i`)),fV.regexp(/'((?:[^"\\]|\\.)*)'/,1),fV.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(e=>IH.core.type.regex([`^${e}$`,`i`]))).desc(`string`)},Value:function(e){return fV.alt(e.Number,e.String)},ValueParens:function(e){return fV.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(fV.string(`(`),fV.string(`)`))},ValuePropertyNames:function(){return fV.alt(...IV(wH,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return CV(VPe,fV.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return fV.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return fV.alt(...gPe(BPe,e.ValueOperator))},ValueQuery:function(e){return fV.alt(e.ValueOperator.map(e=>{if(!e.head.name||!e.head.name.startsWith(`structure-query.generator`))throw Error(`values must be part of an comparison, value '${e}'`);return e}))}}),UPe={pymol:RPe,vmd:e=>HPe.Query.tryParse(e),jmol:APe};function WPe(e,t){try{return UPe[e](t)}catch(e){throw console.error(e.message),e}}var LH=oB.Const,RH=oB.Dynamic,GPe=[LH(X.core.type.bool,function(e,t){return!!t[0](e)}),LH(X.core.type.num,function(e,t){return+t[0](e)}),LH(X.core.type.str,function(e,t){return``+t[0](e)}),LH(X.core.type.list,function(e,t){return aB.forEachEval(t,e,(e,t,n)=>n[t]=e,[])}),LH(X.core.type.set,function(e,t){return aB.forEachEval(t,e,function(e,t,n){return n.add(e)},new Set)}),LH(X.core.type.regex,function(e,t){return new RegExp(t[0](e),t[1]&&t[1](e)||``)}),LH(X.core.type.bitflags,function(e,t){return+t[0](e)}),LH(X.core.type.compositeKey,function(e,t){return aB.forEachEval(t,e,(e,t,n)=>n[t]=``+e,[]).join(`-`)}),LH(X.core.logic.not,(e,t)=>!t[0](e)),LH(X.core.logic.and,(e,t)=>{if(typeof t.length==`number`){for(let n=0,r=t.length;n<r;n++)if(!t[n](e))return!1}else for(let n of Object.keys(t))if(!t[n](e))return!1;return!0}),LH(X.core.logic.or,(e,t)=>{if(typeof t.length==`number`){for(let n=0,r=t.length;n<r;n++)if(t[n](e))return!0}else for(let n of Object.keys(t))if(t[n](e))return!0;return!1}),LH(X.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),LH(X.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),LH(X.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),LH(X.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),LH(X.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),LH(X.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),LH(X.core.rel.inRange,(e,t)=>{let n=t[0](e);return n>=t[1](e)&&n<=t[2](e)}),LH(X.core.math.add,(e,t)=>{let n=0;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n+=t[r](e);else for(let r of Object.keys(t))n+=t[r](e);return n}),LH(X.core.math.sub,(e,t)=>{let n=0;if(typeof t.length==`number`){if(t.length===1)return-t[0](e);n=t[0](e)||0;for(let r=1,i=t.length;r<i;r++)n-=t[r](e)}else{let r=Object.keys(t);if(r.length===1)return-t[r[0]](e);n=t[r[0]](e)||0;for(let i=1,a=r.length;i<a;i++)n-=t[r[i]](e)}return n}),LH(X.core.math.mult,(e,t)=>{let n=1;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n*=t[r](e);else for(let r of Object.keys(t))n*=t[r](e);return n}),LH(X.core.math.div,(e,t)=>t[0](e)/t[1](e)),LH(X.core.math.pow,(e,t)=>t[0](e)**+t[1](e)),LH(X.core.math.mod,(e,t)=>t[0](e)%t[1](e)),LH(X.core.math.min,(e,t)=>{let n=1/0;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n=Math.min(t[r](e),n);else for(let r of Object.keys(t))n=Math.min(t[r](e),n);return n}),LH(X.core.math.max,(e,t)=>{let n=-1/0;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n=Math.max(t[r](e),n);else for(let r of Object.keys(t))n=Math.max(t[r](e),n);return n}),LH(X.core.math.cantorPairing,(e,t)=>pE(t[0](e),t[1](e))),LH(X.core.math.sortedCantorPairing,(e,t)=>mE(t[0](e),t[1](e))),LH(X.core.math.invertCantorPairing,(e,t)=>hE([0,0],t[0](e))),LH(X.core.math.floor,(e,t)=>Math.floor(t[0](e))),LH(X.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),LH(X.core.math.roundInt,(e,t)=>Math.round(t[0](e))),LH(X.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),LH(X.core.math.abs,(e,t)=>Math.abs(t[0](e))),LH(X.core.math.sign,(e,t)=>Math.sign(t[0](e))),LH(X.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),LH(X.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),LH(X.core.math.sin,(e,t)=>Math.sin(t[0](e))),LH(X.core.math.cos,(e,t)=>Math.cos(t[0](e))),LH(X.core.math.tan,(e,t)=>Math.tan(t[0](e))),LH(X.core.math.asin,(e,t)=>Math.asin(t[0](e))),LH(X.core.math.acos,(e,t)=>Math.acos(t[0](e))),LH(X.core.math.atan,(e,t)=>Math.atan(t[0](e))),LH(X.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),LH(X.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),LH(X.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),LH(X.core.math.exp,(e,t)=>Math.exp(t[0](e))),LH(X.core.math.log,(e,t)=>Math.log(t[0](e))),LH(X.core.math.log10,(e,t)=>Math.log10(t[0](e))),LH(X.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),LH(X.core.str.match,(e,t)=>t[0](e).test(t[1](e))),LH(X.core.str.concat,(e,t)=>{let n=[];if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e).toString());else for(let r of Object.keys(t))n.push(t[r](e).toString());return n.join(``)}),LH(X.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),LH(X.core.list.equal,(e,t)=>jE(t[0](e),t[1](e))),LH(X.core.set.has,function(e,t){return t[0](e).has(t[1](e))}),LH(X.core.set.isSubset,function(e,t){return $F.isSuperset(t[1](e),t[0](e))}),LH(X.core.flags.hasAny,(e,t)=>{let n=t[1](e),r=t[0](e);return n?(r&n)!==0:!!r}),LH(X.core.flags.hasAll,(e,t)=>{let n=t[1](e),r=t[0](e);return n?(r&n)===n:!r}),LH(X.structureQuery.type.elementSymbol,(e,t)=>nI(t[0](e))),LH(X.structureQuery.type.atomName,(e,t)=>kfe(t[0](e))),LH(X.structureQuery.type.bondFlags,(e,t)=>{let n=kI.Flag.None;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n=BH(n,t[r](e));else for(let r of Object.keys(t))n=BH(n,t[r](e));return n}),LH(X.structureQuery.type.ringFingerprint,(e,t)=>DR.elementFingerprint(KPe(e,t))),LH(X.structureQuery.type.secondaryStructureFlags,(e,t)=>{let n=OI.Flag.None;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n=VH(n,t[r](e));else for(let r of Object.keys(t))n=VH(n,t[r](e));return n}),RH(X.structureQuery.filter.pick,(e,t)=>Wz.filters.pick(t[0],t.test)(e)),RH(X.structureQuery.filter.first,(e,t)=>Wz.filters.first(t[0])(e)),RH(X.structureQuery.filter.withSameAtomProperties,(e,t)=>Wz.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),RH(X.structureQuery.filter.intersectedBy,(e,t)=>Wz.filters.areIntersectedBy(t[0],t.by)(e)),RH(X.structureQuery.filter.within,(e,t)=>Wz.filters.within({query:t[0],target:t.target,minRadius:t[`min-radius`]?.call(t,e),maxRadius:t[`max-radius`]?.call(t,e),elementRadius:t[`atom-radius`],invert:t.invert?.call(t,e)})(e)),RH(X.structureQuery.filter.isConnectedTo,(e,t)=>Wz.filters.isConnectedTo({query:t[0],target:t.target,disjunct:t.disjunct?.call(t,e),invert:t.invert?.call(t,e),bondTest:t[`bond-test`]})(e)),RH(X.structureQuery.generator.atomGroups,function(e,t){return Wz.generators.atoms({entityTest:t[`entity-test`],chainTest:t[`chain-test`],residueTest:t[`residue-test`],atomTest:t[`atom-test`],groupBy:t[`group-by`]})(e)}),RH(X.structureQuery.generator.all,function(e){return Wz.generators.all(e)}),RH(X.structureQuery.generator.empty,function(e){return Wz.generators.none(e)}),RH(X.structureQuery.generator.bondedAtomicPairs,function(e,t){return Wz.generators.bondedAtomicPairs(t&&t[0])(e)}),RH(X.structureQuery.generator.rings,function(e,t){return Wz.generators.rings((t?.fingerprint)?.call(t,e),(t?.[`only-aromatic`])?.call(t,e))(e)}),RH(X.structureQuery.generator.queryInSelection,function(e,t){return Wz.generators.querySelection(t[0],t.query,t[`in-complement`]?.call(t,e))(e)}),RH(X.structureQuery.modifier.includeSurroundings,function(e,t){return Wz.modifiers.includeSurroundings(t[0],{radius:t.radius(e),wholeResidues:!!(t[`as-whole-residues`]&&t[`as-whole-residues`](e)),elementRadius:t[`atom-radius`]})(e)}),RH(X.structureQuery.modifier.surroundingLigands,function(e,t){return Wz.modifiers.surroundingLigands({query:t[0],radius:t.radius(e),includeWater:!!(t[`include-water`]&&t[`include-water`](e))})(e)}),RH(X.structureQuery.modifier.wholeResidues,function(e,t){return Wz.modifiers.wholeResidues(t[0])(e)}),RH(X.structureQuery.modifier.union,function(e,t){return Wz.modifiers.union(t[0])(e)}),RH(X.structureQuery.modifier.expandProperty,function(e,t){return Wz.modifiers.expandProperty(t[0],t.property)(e)}),RH(X.structureQuery.modifier.exceptBy,function(e,t){return Wz.modifiers.exceptBy(t[0],t.by)(e)}),RH(X.structureQuery.modifier.includeConnected,function(e,t){return Wz.modifiers.includeConnected({query:t[0],bondTest:t[`bond-test`],wholeResidues:!!(t[`as-whole-residues`]&&t[`as-whole-residues`](e)),layerCount:t[`layer-count`]&&t[`layer-count`](e)||1,fixedPoint:t[`fixed-point`]?.call(t,e)??!1})(e)}),RH(X.structureQuery.modifier.intersectBy,function(e,t){return Wz.modifiers.intersectBy(t[0],t.by)(e)}),RH(X.structureQuery.combinator.merge,(e,t)=>Wz.combinators.merge(t)(e)),RH(X.structureQuery.atomProperty.core.elementSymbol,zH(Pz.atom.type_symbol)),RH(X.structureQuery.atomProperty.core.vdw,(e,t)=>WI(Pz.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),RH(X.structureQuery.atomProperty.core.mass,(e,t)=>wDe(Pz.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),RH(X.structureQuery.atomProperty.core.atomicNumber,(e,t)=>GI(Pz.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),RH(X.structureQuery.atomProperty.core.x,zH(Pz.atom.x)),RH(X.structureQuery.atomProperty.core.y,zH(Pz.atom.y)),RH(X.structureQuery.atomProperty.core.z,zH(Pz.atom.z)),RH(X.structureQuery.atomProperty.core.sourceIndex,zH(Pz.atom.sourceIndex)),RH(X.structureQuery.atomProperty.core.operatorName,zH(Pz.unit.operator_name)),RH(X.structureQuery.atomProperty.core.instanceId,zH(Pz.unit.instance_id)),RH(X.structureQuery.atomProperty.core.operatorKey,zH(Pz.unit.operator_key)),RH(X.structureQuery.atomProperty.core.modelIndex,zH(Pz.unit.model_index)),RH(X.structureQuery.atomProperty.core.modelLabel,zH(Pz.unit.model_label)),RH(X.structureQuery.atomProperty.core.modelEntryId,zH(Pz.unit.model_entry_id)),RH(X.structureQuery.atomProperty.core.atomKey,(e,t)=>{let n=t&&t[0]&&t[0](e)||e.element;return pE(n.unit.id,n.element)}),RH(X.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>SMe(t&&t[0]&&t[0](e)||e.element)),RH(X.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>CMe(t&&t[0]&&t[0](e)||e.element)),RH(X.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>wMe(t&&t[0]&&t[0](e)||e.element)),RH(X.structureQuery.atomProperty.macromolecular.id,zH(Pz.atom.id)),RH(X.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>Pz.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!==`ATOM`),RH(X.structureQuery.atomProperty.macromolecular.label_atom_id,zH(Pz.atom.label_atom_id)),RH(X.structureQuery.atomProperty.macromolecular.label_alt_id,zH(Pz.atom.label_alt_id)),RH(X.structureQuery.atomProperty.macromolecular.label_comp_id,zH(Pz.atom.label_comp_id)),RH(X.structureQuery.atomProperty.macromolecular.label_seq_id,zH(Pz.residue.label_seq_id)),RH(X.structureQuery.atomProperty.macromolecular.label_asym_id,zH(Pz.chain.label_asym_id)),RH(X.structureQuery.atomProperty.macromolecular.label_entity_id,zH(Pz.entity.id)),RH(X.structureQuery.atomProperty.macromolecular.auth_atom_id,zH(Pz.atom.auth_atom_id)),RH(X.structureQuery.atomProperty.macromolecular.auth_comp_id,zH(Pz.atom.auth_comp_id)),RH(X.structureQuery.atomProperty.macromolecular.auth_seq_id,zH(Pz.residue.auth_seq_id)),RH(X.structureQuery.atomProperty.macromolecular.auth_asym_id,zH(Pz.chain.auth_asym_id)),RH(X.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,zH(Pz.residue.pdbx_PDB_ins_code)),RH(X.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,zH(Pz.atom.pdbx_formal_charge)),RH(X.structureQuery.atomProperty.macromolecular.occupancy,zH(Pz.atom.occupancy)),RH(X.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,zH(Pz.atom.B_iso_or_equiv)),RH(X.structureQuery.atomProperty.macromolecular.entityType,zH(Pz.entity.type)),RH(X.structureQuery.atomProperty.macromolecular.entitySubtype,zH(Pz.entity.subtype)),RH(X.structureQuery.atomProperty.macromolecular.entityPrdId,zH(Pz.entity.prd_id)),RH(X.structureQuery.atomProperty.macromolecular.entityDescription,zH(Pz.entity.pdbx_description)),RH(X.structureQuery.atomProperty.macromolecular.objectPrimitive,zH(Pz.unit.object_primitive)),RH(X.structureQuery.atomProperty.macromolecular.isNonStandard,zH(Pz.residue.isNonStandard)),RH(X.structureQuery.atomProperty.macromolecular.secondaryStructureKey,zH(Pz.residue.secondary_structure_key)),RH(X.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,zH(Pz.residue.secondary_structure_type)),RH(X.structureQuery.atomProperty.macromolecular.chemCompType,zH(Pz.residue.chem_comp_type)),RH(X.structureQuery.atomProperty.macromolecular.residueSourceIndex,zH(Pz.residue.residueSourceIndex)),RH(X.structureQuery.atomProperty.ihm.hasSeqId,function(e,t){let n=e.element,r=t&&t[0]&&t[0](e);return n.unit.kind===Q.Kind.Atomic?r===Pz.residue.label_seq_id(n):r>=Pz.coarse.seq_id_begin(n)&&r<=Pz.coarse.seq_id_end(n)}),RH(X.structureQuery.atomProperty.ihm.overlapsSeqIdRange,function(e,t){let n=e.element,r=(t&&t.beg&&t.beg(e))??-Number.MAX_VALUE,i=(t&&t.end&&t.end(e))??Number.MAX_VALUE;if(n.unit.kind===Q.Kind.Atomic){let e=Pz.residue.label_seq_id(n);return e>=r&&e<=i}let a=Pz.coarse.seq_id_begin(n),o=Pz.coarse.seq_id_end(n);return a>=r&&a<=i||o>=r&&o<=i||a<=r&&o>=i}),RH(X.structureQuery.atomSet.atomCount,function(e,t){return Wz.atomset.atomCount(e)}),RH(X.structureQuery.atomSet.countQuery,function(e,t){return Wz.atomset.countQuery(t[0])(e)}),RH(X.structureQuery.atomSet.propertySet,function(e,t){return Wz.atomset.propertySet(t[0])(e)}),RH(X.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),RH(X.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),RH(X.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),RH(X.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),RH(X.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),RH(X.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),RH(X.internal.generator.bundleElement,function(e,t){return YR(t.groupedUnits(e),t.ranges(e),t.set(e))}),RH(X.internal.generator.bundle,function(e,t){return XR(t.elements(e))(e)}),RH(X.internal.generator.current,function(e,t){return e.tryGetCurrentSelection()})];function zH(e){return(t,n)=>e(n&&n[0]&&n[0](t)||t.element)}function BH(e,t){return e|(kI.isName(t)?kI.fromName(t):kI.Flag.None)}function VH(e,t){switch(t.toLowerCase()){case`helix`:return e|OI.Flag.Helix;case`alpha`:return e|OI.Flag.Helix|OI.Flag.HelixAlpha;case`pi`:return e|OI.Flag.Helix|OI.Flag.HelixPi;case`310`:return e|OI.Flag.Helix|OI.Flag.Helix3Ten;case`beta`:return e|OI.Flag.Beta;case`strand`:return e|OI.Flag.Beta|OI.Flag.BetaStrand;case`sheet`:return e|OI.Flag.Beta|OI.Flag.BetaSheet;case`turn`:return e|OI.Flag.Turn;case`bend`:return e|OI.Flag.Bend;case`coil`:return e|OI.Flag.NA;default:return e}}function KPe(e,t){let n=[];if(!t)return n;if(typeof t.length==`number`)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e));else{let r=Object.keys(t);for(let i=1,a=r.length;i<a;i++)n.push(t[r[i]](e))}return n}(function(){for(let e of GPe)rB.addSymbol(e)})();function HH(e,t){return{expression:e,language:t}}(function(e){e.Info={"mol-script":`Mol-Script`,pymol:`PyMOL`,vmd:`VMD`,jmol:`Jmol`};function t(e){return!!e&&typeof e.expression==`string`&&!!e.language}e.is=t;function n(e,t){return e.language===t.language&&e.expression===t.expression}e.areEqual=n;function r(e){switch(e.language){case`mol-script`:let t=pPe(e.expression);if(t.length===0)throw Error(`No query`);return oPe(t[0]);case`pymol`:case`jmol`:case`vmd`:return WPe(e.language,e.expression);default:Lb(e.language)}}e.toExpression=r;function i(e){return lB(r(e))}e.toQuery=i;function a(e,t){let n=i(e)(new ZR(t));return VR.toLociWithSourceUnits(n)}e.toLoci=a;function o(e,t,n){return lB(typeof e==`function`?e(Z):e)(new ZR(t,n))}e.getStructureSelection=o})(HH||={});var UH={dynamicBonds:V.Optional(V.Boolean(!1,{description:`Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions.`}))},WH;(function(e){function t(e,t){let n=e&&bB.Provider.get(e),r=n?n.assemblies.map(e=>[e.id,`${e.id}: ${JT(e.details)}`]):[],i=n?!oA.isZero(n.spacegroup.cell):!0,a=[];if(n){let{operators:e}=n.spacegroup;for(let t=0,n=e.length;t<n;t++)a.push([t,`${t+1}: ${sA.getOperatorXyz(e[t])}`])}let o=[];e&&e.properties.structAsymMap.forEach(e=>{let t=e.id===e.auth_id?e.id:`${e.id} [auth ${e.auth_id}]`;o.push([e.id,t])});let s={auto:V.Group(UH),model:V.Group(UH),assembly:V.Group({id:V.Optional(e?V.Select(r.length?r[0][0]:``,r,{label:`Asm Id`,description:`Assembly Id`}):V.Text(``,{label:`Asm Id`,description:`Assembly Id (use empty for the 1st assembly)`})),...UH},{isFlat:!0}),"symmetry-mates":V.Group({radius:V.Numeric(5,{min:0,max:50,step:1}),...UH},{isFlat:!0}),symmetry:V.Group({ijkMin:V.Vec3(B.create(-1,-1,-1),{step:1},{label:`Min IJK`,fieldLabels:{x:`I`,y:`J`,z:`K`}}),ijkMax:V.Vec3(B.create(1,1,1),{step:1},{label:`Max IJK`,fieldLabels:{x:`I`,y:`J`,z:`K`}}),...UH},{isFlat:!0}),"symmetry-assembly":V.Group({generators:V.ObjectList({operators:V.ObjectList({index:V.Select(0,a),shift:V.Vec3(B(),{step:1},{label:`IJK`,fieldLabels:{x:`I`,y:`J`,z:`K`}})},e=>`${e.index+1}_${e.shift.map(e=>e+5).join(``)}`,{defaultValue:[]}),asymIds:V.MultiSelect([],o)},e=>`${e.asymIds.length} asym ids, ${e.operators.length} operators`,{defaultValue:[]}),...UH},{isFlat:!0})},c=[];return t===`auto`&&c.push([`auto`,`Auto`]),c.push([`model`,`Model`]),r.length>0&&c.push([`assembly`,`Assembly`]),i&&(c.push([`symmetry-mates`,`Symmetry Mates`]),c.push([`symmetry`,`Symmetry (indices)`]),c.push([`symmetry-assembly`,`Symmetry (assembly)`])),{type:V.MappedStatic(t||`model`,s,{options:c})}}e.getParams=t;function n(e,t){return!(t.name===`symmetry-assembly`||t.name===`symmetry`&&e.name===`symmetry`)}e.canAutoUpdate=n;async function r(e,t,n,r,i){let a,o=bB.Provider.get(n);!r&&o&&o.assemblies.length!==0&&(r=o.assemblies[0].id),!o||o.assemblies.length===0?e.log.warn(`Model '${n.entryId}' has no assembly, returning model structure.`):(a=ZI.findAssembly(n,r||``),a||e.log.warn(`Model '${n.entryId}' has no assembly called '${r}', returning model structure.`));let s=nB.ofModel(n,i);if(!a){let e={label:`Model`,description:nB.elementDescription(s)};return new H.Molecule.Structure(s,e)}r=a.id;let c=await Gz.buildAssembly(s,r).runInContext(t),l={label:`Assembly ${r}`,description:nB.elementDescription(c)};return new H.Molecule.Structure(c,l)}async function i(e,t,n,r,i){let a=nB.ofModel(t,i),o=await Gz.buildSymmetryRange(a,n,r).runInContext(e),s={label:`Symmetry [${n}] to [${r}]`,description:nB.elementDescription(o)};return new H.Molecule.Structure(o,s)}async function a(e,t,n,r){let i=nB.ofModel(t,r),a=await Gz.builderSymmetryMates(i,n).runInContext(e),o={label:`Symmetry Mates`,description:nB.elementDescription(a)};return new H.Molecule.Structure(a,o)}async function o(e,t,n,r,i){let a=nB.ofModel(t,i),o=await Gz.buildSymmetryAssembly(a,n,r).runInContext(e),s={label:`Symmetry Assembly`,description:nB.elementDescription(o)};return new H.Molecule.Structure(o,s)}async function s(e,t,n,s){let c=s?.params,l=bB.Provider.get(n);if(!l||!s||s.name===`model`){let e=nB.ofModel(n,c);return new H.Molecule.Structure(e,{label:`Model`,description:nB.elementDescription(e)})}if(s.name===`auto`)if(l.assemblies.length===0){let e=nB.ofModel(n,c);return new H.Molecule.Structure(e,{label:`Model`,description:nB.elementDescription(e)})}else return r(e,t,n,void 0,c);if(s.name===`assembly`)return r(e,t,n,s.params.id,c);if(s.name===`symmetry`)return i(t,n,s.params.ijkMin,s.params.ijkMax,c);if(s.name===`symmetry-mates`)return a(t,n,s.params.radius,c);if(s.name===`symmetry-assembly`)return o(t,n,s.params.generators,l,c);Lb(s)}e.create=s})(WH||={});var GH;(function(e){function t(e,t,n){return e.currentStructure===n?HH.is(t)?!!e.script&&HH.areEqual(e.script,t):e.expression===t:!1}e.isUnchanged=t;function n(e,t){let n=HH.is(t)?t:void 0,r=HH.is(t)?HH.toExpression(t):t;return{script:n,expression:r,compiled:lB(r),originalStructure:e,currentStructure:e}}e.create=n;function r(e,t){return e.compiled(new ZR(t))}e.run=r;function i(e,t){let i=n(e,t);return{entry:i,selection:r(i,e)}}e.createAndRun=i;function a(e,t){return e.currentStructure=t,e.compiled(new ZR(t))}e.updateStructure=a;function o(e,t,n){let r=VR.unionStructure(t);e.label=`${n||`Selection`}`,e.description=nB.elementDescription(r),e.data=r}e.updateStructureObject=o})(GH||={});var KH;(function(e){e.Type=`Type`,e.Structure=`Structure Property`,e.Atom=`Atom Property`,e.Bond=`Bond Property`,e.Residue=`Residue Property`,e.AminoAcid=`Amino Acid`,e.NucleicBase=`Nucleic Base`,e.Manipulate=`Manipulate Selection`,e.Validation=`Validation`,e.Misc=`Miscellaneous`,e.Internal=`Internal`})(KH||={});function qH(e,t,n={}){let r;return{label:e,expression:t,description:n.description||``,category:n.category??KH.Misc,isHidden:!!n.isHidden,priority:n.priority||0,referencesCurrent:!!n.referencesCurrent,get query(){return r||=lB(t),r},ensureCustomProperties:n.ensureCustomProperties,async getSelection(e,i,a){let o=e.managers.structure.selection.getStructure(a),s=o?VR.Sequence(a,[o]):VR.Empty(a);return n.ensureCustomProperties&&await n.ensureCustomProperties({runtime:i,assetManager:e.managers.asset},a),r||=lB(t),r(new ZR(a,{currentSelection:s}))}}}var qPe=qH(`All`,Z.struct.generator.all(),{category:``,priority:1e3}),JPe=qH(`Current Selection`,Z.internal.generator.current(),{category:``,referencesCurrent:!0}),YPe=qH(`Polymer`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.logic.and([Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),Z.core.str.match([Z.re(`(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)`,`i`),Z.ammp(`entitySubtype`)])])})]),{category:KH.Type}),XPe=qH(`Trace`,Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),"chain-test":Z.core.set.has([Z.set(`sphere`,`gaussian`),Z.ammp(`objectPrimitive`)])})]),Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"atom-test":Z.core.set.has([Z.set(`CA`,`P`),Z.ammp(`label_atom_id`)])})])])]),{category:KH.Structure}),JH=Z.core.logic.and([Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),Z.core.str.match([Z.re(`(polypeptide|cyclic-pseudo-peptide|peptide-like)`,`i`),Z.ammp(`entitySubtype`)])]),YH=Z.core.logic.and([Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),Z.core.str.match([Z.re(`(nucleotide|peptide nucleic acid)`,`i`),Z.ammp(`entitySubtype`)])]),XH=Z.core.str.match([Z.re(`non-polymer|(amino|carboxy) terminus|peptide-like`,`i`),Z.ammp(`chemCompType`)]),ZPe=qH(`Backbone`,Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.set.has([Z.set(...$F.toArray(oI)),Z.ammp(`label_atom_id`)])})]),Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":YH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.set.has([Z.set(...$F.toArray(sI)),Z.ammp(`label_atom_id`)])})])])]),{category:KH.Structure}),QPe=qH(`Sidechain`,Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.logic.or([Z.core.logic.not([Z.core.set.has([Z.set(...$F.toArray(oI)),Z.ammp(`label_atom_id`)])])])})]),Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":YH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.logic.or([Z.core.logic.not([Z.core.set.has([Z.set(...$F.toArray(sI)),Z.ammp(`label_atom_id`)])])])})])])]),{category:KH.Structure}),$Pe=qH(`Sidechain with Trace`,Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.logic.or([Z.core.logic.not([Z.core.set.has([Z.set(...$F.toArray(oI)),Z.ammp(`label_atom_id`)])]),Z.core.rel.eq([Z.ammp(`label_atom_id`),`CA`]),Z.core.logic.and([Z.core.rel.eq([Z.ammp(`auth_comp_id`),`PRO`]),Z.core.rel.eq([Z.ammp(`label_atom_id`),`N`])])])})]),Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":YH,"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([XH]),"atom-test":Z.core.logic.or([Z.core.logic.not([Z.core.set.has([Z.set(...$F.toArray(sI)),Z.ammp(`label_atom_id`)])]),Z.core.rel.eq([Z.ammp(`label_atom_id`),`P`])])})])])]),{category:KH.Structure}),eFe=qH(`Protein`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH})]),{category:KH.Type}),tFe=qH(`Nucleic`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":YH})]),{category:KH.Type}),nFe=qH(`Helix`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH,"residue-test":Z.core.flags.hasAny([Z.ammp(`secondaryStructureFlags`),Z.core.type.bitflags([OI.Flag.Helix])])})]),{category:KH.Structure,ensureCustomProperties:(e,t)=>Tz.attach(e,t)}),rFe=qH(`Beta Strand/Sheet`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":JH,"residue-test":Z.core.flags.hasAny([Z.ammp(`secondaryStructureFlags`),Z.core.type.bitflags([OI.Flag.Beta])])})]),{category:KH.Structure,ensureCustomProperties:(e,t)=>Tz.attach(e,t)}),iFe=qH(`Water`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`water`])})]),{category:KH.Type}),aFe=qH(`Ion`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entitySubtype`),`ion`])})]),{category:KH.Type}),oFe=qH(`Lipid`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entitySubtype`),`lipid`])})]),{category:KH.Type}),ZH=qH(`Carbohydrate`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.logic.or([Z.core.rel.eq([Z.ammp(`entityType`),`branched`]),Z.core.logic.and([Z.core.rel.eq([Z.ammp(`entityType`),`non-polymer`]),Z.core.str.match([Z.re(`oligosaccharide`,`i`),Z.ammp(`entitySubtype`)])])])})]),{category:KH.Type}),QH=qH(`Carbohydrate with Connected`,Z.struct.modifier.union([Z.struct.modifier.includeConnected({0:ZH.expression,"layer-count":1,"as-whole-residues":!0})]),{category:KH.Internal,isHidden:!0}),$H=qH(`Connected to Carbohydrate`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:QH.expression,by:ZH.expression})]),{category:KH.Internal,isHidden:!0}),eU=qH(`Ligand`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.logic.and([Z.core.logic.or([Z.core.rel.eq([Z.ammp(`entityType`),`non-polymer`]),Z.core.rel.neq([Z.ammp(`entityPrdId`),``])]),Z.core.logic.not([Z.core.str.match([Z.re(`(oligosaccharide|lipid|ion)`,`i`),Z.ammp(`entitySubtype`)])])]),"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.logic.not([Z.core.str.match([Z.re(`saccharide`,`i`),Z.ammp(`chemCompType`)])])})]),Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":XH})])])]),by:Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.set.has([Z.set(...$F.toArray(SI)),Z.ammp(`label_comp_id`)])})]),Z.struct.generator.atomGroups({"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.core.set.has([Z.set(...$F.toArray(nDe)),Z.ammp(`label_comp_id`)])})])})]),{category:KH.Type}),tU=qH(`Ligand with Connected`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:Z.struct.modifier.union([Z.struct.modifier.includeConnected({0:eU.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":Z.core.flags.hasAny([Z.struct.bondProperty.flags(),Z.core.type.bitflags([kI.Flag.Covalent|kI.Flag.MetallicCoordination])])})]),by:ZH.expression})]),{category:KH.Internal,isHidden:!0}),nU=qH(`Connected to Ligand`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:tU.expression,by:eU.expression})]),{category:KH.Internal,isHidden:!0}),sFe=qH(`Connected to Ligand or Carbohydrate`,Z.struct.modifier.union([Z.struct.combinator.merge([$H.expression,nU.expression])]),{category:KH.Internal,isHidden:!0}),cFe=qH(`Disulfide Bridges`,Z.struct.modifier.union([Z.struct.combinator.merge([Z.struct.modifier.union([Z.struct.modifier.wholeResidues([Z.struct.filter.isConnectedTo({0:Z.struct.generator.atomGroups({"residue-test":Z.core.set.has([Z.set(`CYS`),Z.ammp(`auth_comp_id`)]),"atom-test":Z.core.set.has([Z.set(`SG`),Z.ammp(`label_atom_id`)])}),target:Z.struct.generator.atomGroups({"residue-test":Z.core.set.has([Z.set(`CYS`),Z.ammp(`auth_comp_id`)]),"atom-test":Z.core.set.has([Z.set(`SG`),Z.ammp(`label_atom_id`)])}),"bond-test":!0})])]),Z.struct.modifier.union([Z.struct.modifier.wholeResidues([Z.struct.modifier.union([Z.struct.generator.bondedAtomicPairs({0:Z.core.flags.hasAny([Z.struct.bondProperty.flags(),Z.core.type.bitflags([kI.Flag.Disulfide])])})])])])])]),{category:KH.Bond}),lFe=qH(`NOS Bridges`,Z.struct.modifier.union([Z.struct.modifier.wholeResidues([Z.struct.filter.isConnectedTo({0:Z.struct.generator.atomGroups({"residue-test":Z.core.set.has([Z.set(`CSO`,`LYS`),Z.ammp(`auth_comp_id`)]),"atom-test":Z.core.set.has([Z.set(`OD`,`NZ`),Z.ammp(`label_atom_id`)])}),target:Z.struct.generator.atomGroups({"residue-test":Z.core.set.has([Z.set(`CSO`,`LYS`),Z.ammp(`auth_comp_id`)]),"atom-test":Z.core.set.has([Z.set(`OD`,`NZ`),Z.ammp(`label_atom_id`)])}),"bond-test":!0})])]),{category:KH.Bond}),uFe=qH(`Non-standard Residues in Polymers`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.rel.eq([Z.ammp(`entityType`),`polymer`]),"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":Z.ammp(`isNonStandard`)})]),{category:KH.Residue}),dFe=qH(`Coarse Elements`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"chain-test":Z.core.set.has([Z.set(`sphere`,`gaussian`),Z.ammp(`objectPrimitive`)])})]),{category:KH.Type}),fFe=qH(`Rings in Residues`,Z.struct.modifier.union([Z.struct.generator.rings()]),{category:KH.Residue}),pFe=qH(`Aromatic Rings in Residues`,Z.struct.modifier.union([Z.struct.generator.rings({"only-aromatic":!0})]),{category:KH.Residue}),mFe=qH(`Surrounding Residues (5 ) of Selection`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:Z.struct.modifier.includeSurroundings({0:Z.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:Z.internal.generator.current()})]),{description:`Select residues within 5  of the current selection.`,category:KH.Manipulate,referencesCurrent:!0}),hFe=qH(`Surrounding Ligands (5 ) of Selection`,Z.struct.modifier.union([Z.struct.modifier.surroundingLigands({0:Z.internal.generator.current(),radius:5,"include-water":!0})]),{description:`Select ligand components within 5  of the current selection.`,category:KH.Manipulate,referencesCurrent:!0}),gFe=qH(`Surrounding Atoms (5 ) of Selection`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:Z.struct.modifier.includeSurroundings({0:Z.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:Z.internal.generator.current()})]),{description:`Select atoms within 5  of the current selection.`,category:KH.Manipulate,referencesCurrent:!0}),_Fe=qH(`Inverse / Complement of Selection`,Z.struct.modifier.union([Z.struct.modifier.exceptBy({0:Z.struct.generator.all(),by:Z.internal.generator.current()})]),{description:`Select everything not in the current selection.`,category:KH.Manipulate,referencesCurrent:!0}),vFe=qH(`Residues Covalently Bonded to Selection`,Z.struct.modifier.union([Z.struct.modifier.includeConnected({0:Z.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:`Select residues covalently bonded to current selection.`,category:KH.Manipulate,referencesCurrent:!0}),yFe=qH(`Covalently Bonded Component`,Z.struct.modifier.union([Z.struct.modifier.includeConnected({0:Z.internal.generator.current(),"fixed-point":!0})]),{description:`Select covalently bonded component based on current selection.`,category:KH.Manipulate,referencesCurrent:!0}),bFe=qH(`Residues with Cov. or Metallic Bond to Selection`,Z.struct.modifier.union([Z.struct.modifier.includeConnected({0:Z.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":Z.core.flags.hasAny([Z.struct.bondProperty.flags(),Z.core.type.bitflags([kI.Flag.Covalent|kI.Flag.MetallicCoordination])])})]),{description:`Select residues with covalent or metallic bond to current selection.`,category:KH.Manipulate,referencesCurrent:!0}),xFe=qH(`Whole Residues of Selection`,Z.struct.modifier.union([Z.struct.modifier.wholeResidues({0:Z.internal.generator.current()})]),{description:`Expand current selection to whole residues.`,category:KH.Manipulate,referencesCurrent:!0}),SFe=[[[`HIS`],`Histidine`],[[`ARG`],`Arginine`],[[`LYS`],`Lysine`],[[`ILE`],`Isoleucine`],[[`PHE`],`Phenylalanine`],[[`LEU`],`Leucine`],[[`TRP`],`Tryptophan`],[[`ALA`],`Alanine`],[[`MET`],`Methionine`],[[`PRO`],`Proline`],[[`CYS`],`Cysteine`],[[`ASN`],`Asparagine`],[[`VAL`],`Valine`],[[`GLY`],`Glycine`],[[`SER`],`Serine`],[[`GLN`],`Glutamine`],[[`TYR`],`Tyrosine`],[[`ASP`],`Aspartic Acid`],[[`GLU`],`Glutamic Acid`],[[`THR`],`Threonine`],[[`SEC`],`Selenocysteine`],[[`PYL`],`Pyrrolysine`],[[`UNK`],`Unknown`]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),CFe=[[[`A`,`DA`],`Adenosine`],[[`C`,`DC`],`Cytidine`],[[`T`,`DT`],`Thymidine`],[[`G`,`DG`],`Guanosine`],[[`I`,`DI`],`Inosine`],[[`U`,`DU`],`Uridine`],[[`N`,`DN`],`Unknown`]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0);function rU([e,t],n,r=0){let i=e.length===1&&!iU.has(e[0])?`[${e[0]}] ${t}`:`${t} (${e.join(`, `)})`;return qH(i,Z.struct.modifier.union([Z.struct.generator.atomGroups({"residue-test":Z.core.set.has([Z.set(...e),Z.ammp(`auth_comp_id`)])})]),{category:n,priority:r,description:i})}function wFe([e,t],n,r){let i=`${t} (${e.join(`, `)})`;return qH(i,Z.struct.modifier.union([Z.struct.generator.atomGroups({"atom-test":Z.core.set.has([Z.set(...e),Z.acp(`elementSymbol`)])})]),{category:n,priority:r,description:i})}function TFe([e,t],n,r){let i=`${t}`;return qH(`${t}`,Z.struct.modifier.union([Z.struct.generator.atomGroups({"entity-test":Z.core.list.equal([Z.list(...e),Z.ammp(`entityDescription`)])})]),{category:n,priority:r,description:i})}var iU=$F.unionMany(hI,vI,yI,mI);function EFe(e){let t=new Set;for(let n of e)n.uniqueElementSymbols.forEach(e=>t.add(e));let n=[];return t.forEach(e=>{let t=oke[e]||e;n.push(wFe([[e],t],`Element Symbol`,0))}),n}function DFe(e){let t=new Map,n=new Set;for(let r of e){r.uniqueResidueNames.forEach(e=>n.add(e));for(let e of r.models)r.uniqueResidueNames.forEach(n=>{let r=e.properties.chemicalComponentMap.get(n);r&&t.set(n,r.name)})}let r=[];return $F.difference(n,iU).forEach(e=>{let n=t.get(e)||e;r.push(rU([[e],n],`Ligand/Non-standard Residue`,200))}),r}function OFe(e){let t=new Map,n=iL.create();for(let r of e){n.structure=r;for(let e of r.unitSymmetryGroups){n.unit=e.units[0],n.element=e.elements[0];let r=Pz.entity.type(n);if(r===`polymer`||r===`branched`){let e=Pz.entity.pdbx_description(n);t.set(e.join(`, `),e)}}}let r=[];return t.forEach((e,t)=>{r.push(TFe([e,t],`Polymer/Carbohydrate Entities`,300))}),r}const aU={all:qPe,current:JPe,polymer:YPe,trace:XPe,backbone:ZPe,sidechain:QPe,sidechainWithTrace:$Pe,protein:eFe,nucleic:tFe,helix:nFe,beta:rFe,water:iFe,ion:aFe,lipid:oFe,branched:ZH,branchedPlusConnected:QH,branchedConnectedOnly:$H,ligand:eU,ligandPlusConnected:tU,ligandConnectedOnly:nU,connectedOnly:sFe,disulfideBridges:cFe,nosBridges:lFe,nonStandardPolymer:uFe,coarse:dFe,ring:fFe,aromaticRing:pFe,surroundings:mFe,surroundingLigands:hFe,surroundingAtoms:gFe,complement:_Fe,covalentlyBonded:vFe,covalentlyOrMetallicBonded:bFe,covalentlyBondedComponent:yFe,wholeResidues:xFe};var kFe=class{add(e){this.list.push(e),this.options.push([e,e.label,e.category]),this.version+=1}remove(e){let t=this.list.indexOf(e);t!==-1&&(this.list.splice(t,1),this.options.splice(t,1),this.version+=1)}constructor(){this.list=[],this.options=[],this.version=1,this.list.push(...Object.values(aU),...SFe.map(e=>rU(e,KH.AminoAcid)),...CFe.map(e=>rU(e,KH.NucleicBase))),this.options.push(...this.list.map(e=>[e,e.label,e.category]))}};const AFe=()=>({type:V.MappedStatic(`static`,{static:V.Text(`polymer`),expression:V.Value(Z.struct.generator.all),bundle:V.Value(qR.Empty),script:V.Script({language:`mol-script`,expression:`(sel.atom.all)`})},{isHidden:!0}),nullIfEmpty:V.Optional(V.Boolean(!0,{isHidden:!0})),label:V.Text(``,{isHidden:!0})});function jFe(e,t,n){n.source=e;let r=nB.Empty,i;switch(t.type.name){case`static`:{let n;switch(t.type.params){case`all`:n=aU.all.query,i=`All`;break;case`polymer`:n=aU.polymer.query,i=`Polymer`;break;case`protein`:n=aU.protein.query,i=`Protein`;break;case`nucleic`:n=aU.nucleic.query,i=`Nucleic`;break;case`water`:n=Wz.internal.water(),i=`Water`;break;case`ion`:n=aU.ion.query,i=`Ion`;break;case`lipid`:n=aU.lipid.query,i=`Lipid`;break;case`branched`:n=aU.branchedPlusConnected.query,i=`Branched`;break;case`ligand`:n=aU.ligandPlusConnected.query,i=`Ligand`;break;case`non-standard`:n=aU.nonStandardPolymer.query,i=`Non-standard`;break;case`coarse`:n=aU.coarse.query,i=`Coarse`;break;default:Lb(t.type)}let a=n(new ZR(e));r=VR.unionStructure(a);break}case`script`:case`expression`:{let{selection:i,entry:a}=GH.createAndRun(e,t.type.params);n.entry=a,r=VR.unionStructure(i);break}case`bundle`:if(t.type.params.hash!==e.hashCode)break;r=qR.toStructure(t.type.params,e);break}if(t.nullIfEmpty&&r.elementCount===0)return Mx.Null;let a={label:`${t.label||i||`Component`}`,description:nB.elementDescription(r)};return new H.Molecule.Structure(r,a)}function MFe(e,t,n,r,i){if(n.type.name!==r.type.name)return lE.UpdateResult.Recreate;let a=!1;switch(r.type.name){case`static`:return n.type.params!==r.type.params||!nB.areEquivalent(e,i.source)?lE.UpdateResult.Recreate:t.data.model===e.model?lE.UpdateResult.Unchanged:DB.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),lE.UpdateResult.Updated):lE.UpdateResult.Recreate;case`script`:if(!HH.areEqual(n.type.params,r.type.params))return lE.UpdateResult.Recreate;case`expression`:{if(n.type.params!==r.type.params)return lE.UpdateResult.Recreate;if(e===i.source)break;let o=i.entry,s=GH.updateStructure(o,e);i.source=e,t.data=VR.unionStructure(s),GH.updateStructureObject(t,s,r.label),a=!0;break}case`bundle`:if(e===i.source&&qR.areEqual(n.type.params,r.type.params))break;i.source=e,r.type.params.hash===e.hashCode?(a=!0,t.data=qR.toStructure(r.type.params,e)):(a=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:nB.Empty);break}if(a){if(r.nullIfEmpty&&t.data.elementCount===0)return lE.UpdateResult.Null;t.description=nB.elementDescription(t.data)}return n.label!==r.label&&(a=!0,t.label=`${r.label||t.label}`),a?lE.UpdateResult.Updated:lE.UpdateResult.Unchanged}function NFe(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return console.error(`Value ${e} is outside the 0-7 range, defaulting to 0.`),0}}function oU(e,t){let n=aO.create(e.data,t*2),r=aO.create(e.data,t*2),i=aO.create(e.data,t*2),a=aO.create(e.data,t*2),o=aO.create(e.data,t*2);for(let s=0;s<t;++s){iO.markLine(e);let{tokenStart:t,position:s}=e;iO.trim(e,t,t+10),aO.addUnchecked(n,e.tokenStart,e.tokenEnd),iO.trim(e,t+10,t+20),aO.addUnchecked(r,e.tokenStart,e.tokenEnd),iO.trim(e,t+20,t+30),aO.addUnchecked(i,e.tokenStart,e.tokenEnd),iO.trim(e,t+31,t+34),aO.addUnchecked(a,e.tokenStart,e.tokenEnd),iO.trim(e,t+36,t+39),aO.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=s}return{count:t,x:$D(n)(U.Schema.float),y:$D(r)(U.Schema.float),z:$D(i)(U.Schema.float),type_symbol:$D(a)(U.Schema.str),formal_charge:$D(o)(U.Schema.int)}}function sU(e,t){let n=aO.create(e.data,t*2),r=aO.create(e.data,t*2),i=aO.create(e.data,t*2);for(let a=0;a<t;++a){iO.markLine(e);let{tokenStart:t,position:a}=e;iO.trim(e,t,t+3),aO.addUnchecked(n,e.tokenStart,e.tokenEnd),iO.trim(e,t+3,t+6),aO.addUnchecked(r,e.tokenStart,e.tokenEnd),iO.trim(e,t+6,t+9),aO.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=a}return{count:t,atomIdxA:$D(n)(U.Schema.int),atomIdxB:$D(r)(U.Schema.int),order:$D(i)(U.Schema.int)}}function PFe(e,t,n){iO.trim(e,t+6,t+9);let r=parseInt(iO.getTokenString(e));for(let i=0;i<r;++i){let r=9+i*8;iO.trim(e,t+r,t+r+4);let a=iO.getTokenString(e);n.atomIdx.push(+a),iO.trim(e,t+r+4,t+r+8);let o=iO.getTokenString(e);n.charge.push(+o)}iO.eatLine(e)}function FFe(e){let t=e.trim().split(/\s+/g),n=[];for(let e=1;e<t.length;e+=2){let r=+t[e],i=+t[e+1]||0;n.push({atomIdx:r,kind:i})}return n}function cU(e){let t={atomIdx:[],charge:[]},n;for(;e.position<e.length;){let{position:r}=e;iO.trim(e,r+3,r+6);let i=iO.getTokenString(e);if(i===`END`)break;switch(iO.eatLine(e),i){case`CHG`:PFe(e,r,t);break;case`APO`:n=FFe(iO.getTokenString(e).substring(3));break;default:break}}return{formalCharges:{atomIdx:U.ofIntArray(t.atomIdx),charge:U.ofIntArray(t.charge)},attachmentPoints:n}}function IFe(e){let t=iO(e),n=iO.readLine(t).trim(),r=iO.readLine(t).trim(),i=iO.readLine(t).trim(),a=iO.readLine(t),o=+a.substr(0,3),s=+a.substr(3,3),c={title:n,program:r,comment:i,atoms:oU(t,o),bonds:sU(t,s),...cU(t)};return jD.success(c)}function LFe(e){return hb.create(`Parse Mol`,async()=>IFe(e))}async function lU(e,t,n){let{atoms:r,bonds:i,formalCharges:a}=e,o=U.ofConst(`MOL`,e.atoms.count,U.Schema.str),s=U.ofConst(`A`,e.atoms.count,U.Schema.str),c=U.asArrayColumn(r.type_symbol),l=U.ofConst(1,r.count,U.Schema.int),u=new Int32Array(e.atoms.count);if(a.atomIdx.rowCount>0)for(let e=0;e<a.atomIdx.rowCount;e++)u[a.atomIdx.value(e)-1]=a.charge.value(e);else for(let t=0;t<e.atoms.count;t++)u[t]=NFe(r.formal_charge.value(t));let d=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:s,auth_atom_id:c,auth_comp_id:o,auth_seq_id:l,Cartn_x:U.asArrayColumn(r.x,Float32Array),Cartn_y:U.asArrayColumn(r.y,Float32Array),Cartn_z:U.asArrayColumn(r.z,Float32Array),id:U.range(1,r.count),label_asym_id:s,label_atom_id:c,label_comp_id:o,label_seq_id:l,label_entity_id:U.ofConst(`1`,r.count,U.Schema.str),occupancy:U.ofConst(1,r.count,U.Schema.float),type_symbol:c,pdbx_PDB_model_num:U.ofConst(1,r.count,U.Schema.int),pdbx_formal_charge:U.ofIntArray(u)},r.count),f=new BI;f.setNames([[`MOL`,`Unknown Entity`]]),f.getEntityId(`MOL`,iI.Unknown,`A`);let p=new LI(l,c);p.setNames([[`MOL`,`Unknown Molecule`]]),p.add(`MOL`,0);let m=await JB(PI({entity:f.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:d}),t??uU.create(e),n);if(m.frameCount>0){let e=U.ofIntArray(U.mapToArray(i.atomIdxA,e=>e-1,Int32Array)),t=U.ofIntArray(U.mapToArray(i.atomIdxB,e=>e-1,Int32Array)),n=U.asArrayColumn(i.order,Int32Array),a=YI.fromData({pairs:{indexA:e,indexB:t,order:n},count:r.count},{maxDistance:1/0});YI.Provider.set(m.representative,a)}return m}var uU;(function(e){function t(e){return e?.kind===`mol`}e.is=t;function n(e){return{kind:`mol`,name:e.title,data:e}}e.create=n})(uU||={});function RFe(e){return hb.create(`Parse MOL`,t=>lU(e,void 0,t))}function zFe(e){let t=e.it_number.value(0),n=e[`name_h-m_full`].value(0).replace(`-`,` `);return e.it_number.isDefined?(e[`name_h-m_full`].isDefined,t):n}function BFe(e){let{cell:t,space_group:n}=e,r=zFe(n),i=oA.create(r,B.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),B.scale(B(),B.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:sA.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}async function VFe(e,t,n){let r=e.atom_site._rowCount,i=U.ofConst(`MOL`,r,U.Schema.str),a=U.ofConst(`A`,r,U.Schema.str),o=U.ofConst(1,r,U.Schema.int),s=BFe(e),c=s.spacegroup.cell.fromFractional,{fract_x:l,fract_y:u,fract_z:d}=e.atom_site,f=new Float32Array(r),p=new Float32Array(r),m=new Float32Array(r),h=B();for(let e=0;e<r;++e)B.set(h,l.value(e),u.value(e),d.value(e)),B.transformMat4(h,h,c),f[e]=h[0],p[e]=h[1],m[e]=h[2];let{type_symbol:g,label:_}=e.atom_site,v,y;if(g.isDefined){let e=Array(r),t=new Int8Array(r);for(let n=0;n<r;++n){let r=g.value(n),i=r.length;r[i-1]===`+`?(e[n]=r.substring(0,i-2),t[n]=parseInt(r[i-2])):r[i-2]===`+`?(e[n]=r.substring(0,i-2),t[n]=parseInt(r[i-1])):r[i-1]===`-`?(e[n]=r.substring(0,i-2),t[n]=-parseInt(r[i-2])):r[i-2]===`-`?(e[n]=r.substring(0,i-2),t[n]=-parseInt(r[i-1])):(e[n]=r,t[n]=0)}v=U.ofStringArray(e),y=U.ofIntArray(t)}else{let e=Array(r);for(let t=0;t<r;++t)e[t]=HF(_.value(t),``);v=U.ofStringArray(e),y=U.Undefined(r,U.Schema.int)}let b=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:a,auth_atom_id:_,auth_comp_id:i,auth_seq_id:o,Cartn_x:U.ofFloatArray(f),Cartn_y:U.ofFloatArray(p),Cartn_z:U.ofFloatArray(m),id:U.range(0,r-1),label_asym_id:a,label_atom_id:_,label_comp_id:i,label_seq_id:o,label_entity_id:U.ofConst(`1`,r,U.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:U.ofConst(1,r,U.Schema.float),type_symbol:v,pdbx_formal_charge:y,pdbx_PDB_model_num:U.ofConst(1,r,U.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},r),x=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),S=new BI;S.setNames([[`MOL`,x||`Unknown Entity`]]),S.getEntityId(`MOL`,iI.Unknown,`A`);let C=new LI(o,e.atom_site.type_symbol);C.setNames([[`MOL`,x||`Unknown Molecule`]]),C.add(`MOL`,0);let w=await JB(PI({entity:S.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:b}),t,n);if(w.frameCount>0){let n=w.representative;bB.Provider.set(n,s);let i=e.geom_bond._rowCount;if(i>0){let a={},{label:o}=e.atom_site;for(let e=0,t=o.rowCount;e<t;++e)a[o.value(e)]=e;let s=t.data.frame.categories.ccdc_geom_bond_type?.getField(``),c=[],l=[],u=[],d=[],f=[],p=new Set,m=0,{atom_site_label_1:h,atom_site_label_2:g,valence:_,distance:v}=e.geom_bond;for(let e=0;e<i;++e){let t=a[h.value(e)],n=a[g.value(e)],r=t<n?pE(t,n):pE(n,t);if(!p.has(r)){if(p.add(r),c[m]=t,l[m]=n,d[m]=v.value(e)||-1,s){let t=s.str(e);t===`D`?(u[m]=2,f[m]=kI.Flag.Covalent):t===`A`?(u[m]=1,f[m]=kI.Flag.Covalent|kI.Flag.Aromatic):(u[m]=1,f[m]=kI.Flag.Covalent)}else f[m]=kI.Flag.Covalent,u[m]=_.isDefined?_.value(e):1;m+=1}}YI.Provider.set(n,YI.fromData({pairs:{indexA:U.ofIntArray(c),indexB:U.ofIntArray(l),order:U.ofIntArray(u),distance:U.ofFloatArray(d),flag:U.ofIntArray(f)},count:r}))}}return w}function HFe(e){if(!dU.is(e.sourceData))return;let{atom_site:t,atom_site_aniso:n}=e.sourceData.data.db;return{data:QD.ofPartialColumns(xB.Schema,{U:n.u},n._rowCount),elementToAnsiotrop:xB.getElementToAnsiotropFromLabel(t.label,n.label)}}function UFe(e){return dU.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}xB.Provider.formatRegistry.add(`cifCore`,HFe,UFe);var dU;(function(e){function t(e){return e?.kind===`cifCore`}e.is=t;function n(e,t){return t||=dk.schema.cifCore(e),{kind:`cifCore`,name:t.database_code.depnum_ccdc_archive.value(0)||t.database_code.depnum_ccdc_fiz.value(0)||t.database_code.icsd.value(0)||t.database_code.mdf.value(0)||t.database_code.nbs.value(0)||t.database_code.csd.value(0)||t.database_code.cod.value(0)||t._name,data:{db:t,frame:e}}}e.fromFrame=n})(dU||={});function WFe(e){let t=dU.fromFrame(e);return hb.create(`Parse CIF Core`,e=>VFe(t.data.db,t,e))}async function GFe(e,t){let{atoms:n}=e,r=U.ofConst(`MOL`,e.atoms.count,U.Schema.str),i=U.ofConst(`A`,e.atoms.count,U.Schema.str),a=U.ofArray({array:U.mapToArray(n.number,e=>KEe(e)),schema:U.Schema.Aliased(U.Schema.str)}),o=U.ofConst(1,n.count,U.Schema.int),s=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:i,auth_atom_id:a,auth_comp_id:r,auth_seq_id:o,Cartn_x:U.asArrayColumn(n.x,Float32Array),Cartn_y:U.asArrayColumn(n.y,Float32Array),Cartn_z:U.asArrayColumn(n.z,Float32Array),id:U.range(0,n.count-1),label_asym_id:i,label_atom_id:a,label_comp_id:r,label_seq_id:o,label_entity_id:U.ofConst(`1`,n.count,U.Schema.str),occupancy:U.ofConst(1,n.count,U.Schema.float),type_symbol:a,pdbx_PDB_model_num:U.ofConst(1,n.count,U.Schema.int)},n.count),c=new BI;c.setNames([[`MOL`,`Unknown Entity`]]),c.getEntityId(`MOL`,iI.Unknown,`A`);let l=new LI(o,a);return l.setNames([[`MOL`,`Unknown Molecule`]]),l.add(`MOL`,0),await JB(PI({entity:c.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:s}),fU.create(e),t)}var fU;(function(e){function t(e){return e?.kind===`cube`}e.is=t;function n(e){return{kind:`cube`,name:e.header.comment1,data:e}}e.create=n})(fU||={});function KFe(e){return hb.create(`Parse Cube`,t=>GFe(e,t))}var{skipWhitespace:pU,eatValue:qFe,markLine:mU,getTokenString:hU,skipStrictWhitespace:JFe}=iO;function YFe(){return{mol_name:``,num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:``,charge_type:``,status_bits:``,mol_comment:``}}function XFe(e,t){return{tokenizer:e,molecule:YFe(),runtimeCtx:t}}var gU=/\s+/g;function ZFe(e){let{tokenizer:t,molecule:n}=e;for(;hU(t)!==`@<TRIPOS>MOLECULE`&&t.position<t.data.length;)mU(t);mU(t),n.mol_name=hU(t),mU(t);let r=hU(t).trim().split(gU);n.num_atoms=parseInt(r[0]),n.num_bonds=parseInt(r[1]),n.num_subst=parseInt(r[2]),n.num_feat=parseInt(r[3]),n.num_sets=parseInt(r[4]),mU(t);let i=hU(t);if(i.startsWith(`@<TRIPOS>`))return;n.mol_type=i,mU(t);let a=hU(t);if(a.startsWith(`@<TRIPOS>`))return;n.charge_type=a,mU(t);let o=hU(t);if(o.startsWith(`@<TRIPOS>`))return;n.status_bits=o,mU(t);let s=hU(t);s.startsWith(`@<TRIPOS>`)||(n.mol_comment=s)}function _U(e,t,n){let r=0;for(let i=0;i<e;i++){let e=0;for(pU(n);JFe(n),n.tokenStart=n.position,qFe(n),n.tokenStart!==n.tokenEnd;){let r=t[e++];r&&aO.addUnchecked(r,n.tokenStart,n.tokenEnd)}e>r&&(r=e);for(let n=e;n<t.length;n++)aO.addUnchecked(t[n],0,0)}return r+1}async function QFe(e){let{tokenizer:t,molecule:n}=e;for(;hU(t)!==`@<TRIPOS>ATOM`&&t.position<t.data.length;)mU(t);let r=t.position,i=t.lineNumber,a=aO.create(t.data,n.num_atoms*2),o=aO.create(t.data,n.num_atoms*2),s=aO.create(t.data,n.num_atoms*2),c=aO.create(t.data,n.num_atoms*2),l=aO.create(t.data,n.num_atoms*2),u=aO.create(t.data,n.num_atoms*2),d=aO.create(t.data,n.num_atoms*2),f=aO.create(t.data,n.num_atoms*2),p=aO.create(t.data,n.num_atoms*2),m=aO.create(t.data,n.num_atoms*2),h=U.Undefined(n.num_atoms,U.Schema.float),g=U.Undefined(n.num_atoms,U.Schema.int),_=U.Undefined(n.num_atoms,U.Schema.str);t.position=r,t.lineNumber=i;let v=0,y=[a,o,s,c,l,u,d,f,p,m],{length:b}=t,x=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let r=Math.min(n.num_atoms-x,e);return v=Math.max(v,_U(r,y,t)),x+=r,r},e=>e.update({message:`Parsing...`,current:t.position,max:b})),{count:n.num_atoms,atom_id:$D(a)(U.Schema.int),atom_name:$D(o)(U.Schema.str),x:$D(s)(U.Schema.float),y:$D(c)(U.Schema.float),z:$D(l)(U.Schema.float),atom_type:v>5?$D(u)(U.Schema.str):_,subst_id:v>6?$D(d)(U.Schema.int):g,subst_name:v>7?$D(f)(U.Schema.str):_,charge:v>8?$D(p)(U.Schema.float):h,status_bits:v>9?$D(m)(U.Schema.str):_}}async function $Fe(e){let{tokenizer:t,molecule:n}=e;for(;hU(t)!==`@<TRIPOS>BOND`&&t.position<t.data.length;)mU(t);let r=t.position,i=t.lineNumber,a=aO.create(t.data,n.num_bonds*2),o=aO.create(t.data,n.num_bonds*2),s=aO.create(t.data,n.num_bonds*2),c=aO.create(t.data,n.num_bonds*2),l=aO.create(t.data,n.num_bonds*2),u=U.Undefined(n.num_bonds,U.Schema.str);t.position=r,t.lineNumber=i;let d=0,f=[a,o,s,c,l],{length:p}=t,m=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let r=Math.min(n.num_bonds-m,e);return d=Math.max(d,_U(r,f,t)),m+=r,r},e=>e.update({message:`Parsing...`,current:t.position,max:p})),{count:n.num_bonds,bond_id:$D(a)(U.Schema.int),origin_atom_id:$D(o)(U.Schema.int),target_atom_id:$D(s)(U.Schema.int),bond_type:$D(c)(U.Schema.str),status_bits:d>4?$D(l)(U.Schema.str):u}}async function eIe(e){let{tokenizer:t,molecule:n}=e;if(n.num_subst===0)return;for(;hU(t)!==`@<TRIPOS>SUBSTRUCTURE`&&t.position<t.data.length;)mU(t);let r=t.position,i=t.lineNumber,a=aO.create(t.data,n.num_subst*2),o=aO.create(t.data,n.num_subst*2),s=aO.create(t.data,n.num_subst*2),c=aO.create(t.data,n.num_subst*2),l=aO.create(t.data,n.num_subst*2),u=aO.create(t.data,n.num_subst*2),d=aO.create(t.data,n.num_subst*2),f=aO.create(t.data,n.num_subst*2),p=aO.create(t.data,n.num_subst*2),m=U.Undefined(n.num_subst,U.Schema.int),h=U.Undefined(n.num_subst,U.Schema.str);t.position=r,t.lineNumber=i;let g=0,_=[a,o,s,c,l,u,d,f,p],{length:v}=t,y=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let r=Math.min(n.num_subst-y,e);return g=Math.max(g,_U(r,_,t)),y+=r,r},e=>e.update({message:`Parsing...`,current:t.position,max:v})),{count:n.num_subst,subst_id:$D(a)(U.Schema.int),subst_name:$D(o)(U.Schema.str),root_atom:$D(s)(U.Schema.int),subst_type:g>3?$D(c)(U.Schema.str):h,dict_type:g>4?$D(l)(U.Schema.str):h,chain:g>5?$D(u)(U.Schema.str):h,sub_type:g>6?$D(d)(U.Schema.str):h,inter_bonds:g>7?$D(f)(U.Schema.int):m,status_bits:g>8?$D(p)(U.Schema.str):h}}function tIe(e){let{tokenizer:t}=e;for(;t.position<t.data.length;){let e=hU(t);if(e===`@<TRIPOS>MOLECULE`)return;if(e===`@<TRIPOS>CRYSIN`)break;mU(t)}if(t.position>=t.data.length)return;mU(t);let n=hU(t).trim().split(gU);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}async function nIe(e,t,n){let r=iO(t);e.update({message:`Parsing...`,current:0,max:t.length});let i=[];for(;r.position<t.length;){let t=XFe(r,e);ZFe(t);let n=await QFe(t),a=await $Fe(t),o=await eIe(t),s=tIe(t);for(i.push({molecule:t.molecule,atoms:n,bonds:a,substructures:o,crysin:s}),pU(r);hU(r)!==`@<TRIPOS>MOLECULE`&&r.position<r.data.length;)mU(r)}let a={name:n,structures:i};return jD.success(a)}function rIe(e,t){return hb.create(`Parse MOL2`,async n=>await nIe(n,e,t))}async function iIe(e,t){let n=[];for(let r=0,i=e.structures.length;r<i;++r){let{molecule:i,atoms:a,bonds:o,substructures:s,crysin:c}=e.structures[r],l=Array(a.count),u=Array(a.count),d=Array(a.count),f=Array(a.count),p=Array(a.count),m=!1;for(let e=0;e<a.count;++e)if(a.atom_type.value(e).includes(`.`)){m=!0;break}let h=new Map;if(s)for(let e=0;e<s.count;++e){let t=s.root_atom.value(e),n=s.chain.value(e),r=s.sub_type.value(e);h.set(t,{chain:n,subType:r})}let g=new BI,_=new LI(a.subst_id,a.atom_name),v,y=``,b=0,x=``,S=iI.Unknown,C=-1;for(let e=0;e<a.count;++e){let t=a.subst_name.value(e),n=a.subst_id.value(e),r=t.replace(/\d+$/,``)||`MOL`,i=t.match(/(\d+)$/);p[e]=i?parseInt(i[1]):n;let o=h.get(a.atom_id.value(e));if(o&&(v=o),v&&v.subType&&v.subType!==`UNK`&&(r=v.subType),d[e]=m?a.atom_type.value(e).split(`.`)[0].toUpperCase():HF(a.atom_name.value(e),r),f[e]=r,n!==C){let t=CI(_.add(r,e).type,r);v?.chain?x=v.chain:(t!==S||n!==C+1)&&(x=zI(b),b+=1),y=g.getEntityId(r,t,x),C=n,S=t}l[e]=y,u[e]=x}let w=U.ofStringArray(d),T=U.ofStringArray(f),E=U.ofStringArray(l),D=U.ofStringArray(u),O=U.asArrayColumn(a.atom_name),k=U.ofIntArray(p),A=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:D,auth_atom_id:O,auth_comp_id:T,auth_seq_id:k,Cartn_x:U.asArrayColumn(a.x,Float32Array),Cartn_y:U.asArrayColumn(a.y,Float32Array),Cartn_z:U.asArrayColumn(a.z,Float32Array),id:U.asArrayColumn(a.atom_id),label_asym_id:D,label_atom_id:O,label_comp_id:T,label_seq_id:a.subst_id,label_entity_id:E,occupancy:U.ofConst(1,a.count,U.Schema.float),type_symbol:w,pdbx_PDB_model_num:U.ofConst(r,a.count,U.Schema.int)},a.count),j=await JB(PI({entity:g.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:A}),vU.create(e),t);if(j.frameCount>0){let e=U.ofIntArray(U.mapToArray(o.origin_atom_id,e=>e-1,Int32Array)),t=U.ofIntArray(U.mapToArray(o.target_atom_id,e=>e-1,Int32Array)),r=o.bond_id,s=U.ofIntArray(U.mapToArray(o.bond_type,e=>{switch(e){case`ar`:case`am`:case`un`:return 1;case`du`:case`nc`:return 0;default:return parseInt(e)}},Int8Array)),l=U.ofIntArray(U.mapToArray(o.bond_type,e=>{switch(e){case`ar`:case`am`:return kI.Flag.Aromatic|kI.Flag.Covalent;case`du`:case`nc`:return kI.Flag.None;case`un`:default:return kI.Flag.Covalent}},Int8Array)),u=YI.fromData({pairs:{key:r,indexA:e,indexB:t,order:s,flag:l},count:a.count},{maxDistance:c?-1:1/0}),d=j.representative;if(YI.Provider.set(d,u),tV.Provider.set(d,{data:a.charge,type:i.charge_type}),c){let e=aIe(c);e&&bB.Provider.set(d,e)}n.push(d)}}return new vB(n)}function aIe(e){if(e.setting!==1)return;let t=oA.create(e.spaceGroup,B.create(e.a,e.b,e.c),B.scale(B(),B.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:sA.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var vU;(function(e){function t(e){return e?.kind===`mol2`}e.is=t;function n(e){return{kind:`mol2`,name:e.name,data:e}}e.create=n})(vU||={});function oIe(e){return hb.create(`Parse MOL2`,t=>iIe(e,t))}var yU=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),bU=9,xU;(function(e){function t(e){let t=1,n=0;for(;e>=t&&n<32;)n++,t<<=1;return n}e.sizeOfInt=t;let n=new Uint8Array(32);function r(e,t){let r=1,i=0;n[0]=1;for(let i=0;i<e;i++){let e,a=0;for(e=0;e<r;e++)a+=n[e]*t[i],n[e]=a&255,a>>=8;for(;a!==0;)n[e++]=a&255,a>>=8;r=e}let a=1;for(r--;n[r]>=a;)i++,a*=2;return i+r*8}e.sizeOfInts=r;let i=new ArrayBuffer(24);e.buf=new Int32Array(i);let a=new Uint32Array(i);function o(t,n,r){let i=r,o=(1<<i)-1,s=a[1],c=a[2],l=e.buf[0],u=0;for(;i>=8;)c=c<<8|t[n+ l++],u|=c>>s<<i-8,i-=8;return i>0&&(s<i&&(s+=8,c=c<<8|t[n+ l++]),s-=i,u|=c>>s&(1<<i)-1),u&=o,e.buf[0]=l,e.buf[1]=s,e.buf[2]=c,u}e.decodeBits=o;function s(t,n){let r=a[2],i=e.buf[0];return r=r<<8|t[n+i],e.buf[0]=i+1,e.buf[2]=r,r>>a[1]&255}let c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(e,t,n,r,i){let a=n,l=0;for(c[0]=0,c[1]=0,c[2]=0,c[3]=0;a>8;)c[l++]=s(e,t),a-=8;a>0&&(c[l++]=o(e,t,a));for(let e=2;e>0;e--){let t=0,n=r[e];for(let e=l-1;e>=0;e--){t=t<<8|c[e];let r=t/n|0;c[e]=r,t-=r*n}i[e]=t}i[0]=c[0]|c[1]<<8|c[2]<<16|c[3]<<24}e.decodeInts=l})(xU||={});function sIe(){throw Error(`(xdrfile error) Undefined error.`)}async function cIe(e,t){let n=new DataView(t.buffer,t.byteOffset),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=r.frames,a=r.boxes,o=r.times,s=[0,0,0,0,0,0],c=[0,0,0],l=[0,0,0],u=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1],p=0,m=xU.buf;for(;;){let r,h=n.getInt32(p+4);p+=12,o.push(n.getFloat32(p)),p+=4;let g=new Float32Array(9);for(let e=0;e<9;++e)g[e]=n.getFloat32(p)*10,p+=4;if(a.push(g),h<=9){r={count:h,x:new Float32Array(h),y:new Float32Array(h),z:new Float32Array(h)},p+=4;for(let e=0;e<h;++e)r.x[e]=n.getFloat32(p),r.y[e]=n.getFloat32(p+4),r.z[e]=n.getFloat32(p+8),p+=12}else{m[0]=m[1]=m[2]=0,c[0]=c[1]=c[2]=0,u[0]=u[1]=u[2]=0,l[0]=l[1]=l[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,r={count:h,x:new Float32Array(h),y:new Float32Array(h),z:new Float32Array(h)};let e=0,i=n.getInt32(p);p+=4;let a=n.getFloat32(p);p+=4,s[0]=n.getInt32(p),s[1]=n.getInt32(p+4),s[2]=n.getInt32(p+8),s[3]=n.getInt32(p+12),s[4]=n.getInt32(p+16),s[5]=n.getInt32(p+20),c[0]=s[3]-s[0]+1,c[1]=s[4]-s[1]+1,c[2]=s[5]-s[2]+1,p+=24;let o;(c[0]|c[1]|c[2])>16777215?(l[0]=xU.sizeOfInt(c[0]),l[1]=xU.sizeOfInt(c[1]),l[2]=xU.sizeOfInt(c[2]),o=0):o=xU.sizeOfInts(3,c);let g=n.getInt32(p);p+=4;let _=g-1;_=bU>_?bU:_;let v=yU[_]/2|0,y=yU[g]/2|0;u[0]=u[1]=u[2]=yU[g];let b=Math.ceil(n.getInt32(p)/4)*4;p+=4;let x=1/a,S=0,C=0;for(d[0]=d[1]=d[2]=0;C<i;){o===0?(d[0]=xU.decodeBits(t,p,l[0]),d[1]=xU.decodeBits(t,p,l[1]),d[2]=xU.decodeBits(t,p,l[2])):xU.decodeInts(t,p,o,c,d),C++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],f[0]=d[0],f[1]=d[1],f[2]=d[2];let n=xU.decodeBits(t,p,1),i=0;if(n===1&&(S=xU.decodeBits(t,p,5),i=S%3,S-=i,i--),S>0){d[0]=d[1]=d[2]=0;for(let n=0;n<S;n+=3){if(xU.decodeInts(t,p,g,u,d),C++,d[0]+=f[0]-y,d[1]+=f[1]-y,d[2]+=f[2]-y,n===0){let t=d[0];d[0]=f[0],f[0]=t,t=d[1],d[1]=f[1],f[1]=t,t=d[2],d[2]=f[2],f[2]=t,r.x[e]=f[0]*x,r.y[e]=f[1]*x,r.z[e]=f[2]*x,e++}else f[0]=d[0],f[1]=d[1],f[2]=d[2];r.x[e]=d[0]*x,r.y[e]=d[1]*x,r.z[e]=d[2]*x,e++}}else r.x[e]=d[0]*x,r.y[e]=d[1]*x,r.z[e]=d[2]*x,e++;g+=i,i<0?(y=v,v=g>bU?yU[g-1]/2|0:0):i>0&&(v=y,y=yU[g]/2|0),u[0]=u[1]=u[2]=yU[g],(u[0]===0||u[1]===0||u[2]===0)&&sIe()}p+=b}for(let e=0;e<h;e++)r.x[e]*=10,r.y[e]*=10,r.z[e]*=10;if(i.push(r),e.shouldUpdate&&await e.update({current:p,max:t.length}),p>=t.length)break}return o.length>=1&&(r.timeOffset=o[0]),o.length>=2&&(r.deltaTime=o[1]-o[0]),r}function lIe(e){return hb.create(`Parse XTC`,async t=>{try{t.update({canAbort:!0,message:`Parsing trajectory...`});let n=await cIe(t,e);return jD.success(n)}catch(e){return jD.error(``+e)}})}function uIe(e){return hb.create(`Parse XTC`,async t=>{await t.update(`Converting to coordinates`);let n=RF(e.deltaTime,`step`),r=RF(e.timeOffset,n.unit),i=[];for(let t=0,a=e.frames.length;t<a;++t){let a=e.boxes[t],o=B.fromArray(B(),a,0),s=B.fromArray(B(),a,3),c=B.fromArray(B(),a,6);i.push({elementCount:e.frames[t].count,cell:BF.fromBasis(o,s,c),x:e.frames[t].x,y:e.frames[t].y,z:e.frames[t].z,xyzOrdering:{isIdentity:!0},time:RF(r.value+n.value*t,n.unit)})}return zF.create(i,n,r)})}function dIe(e){let t=e.position>=e.data.length-1?0:+iO.readLine(e);isNaN(t)&&(t=0);let n=iO.readLine(e),r=new Float64Array(t),i=new Float64Array(t),a=new Float64Array(t),o=Array(t);for(let n=0;n<t;++n){let t=iO.readLineTrim(e).split(/\s+/g);o[n]=t[0],r[n]=+t[1],i[n]=+t[2],a[n]=+t[3]}return{count:t,comment:n,x:U.ofFloatArray(r),y:U.ofFloatArray(i),z:U.ofFloatArray(a),type_symbol:U.ofStringArray(o)}}function fIe(e){let t=iO(e),n=[];for(;;){let e=dIe(t);if(e.count===0)break;n.push(e)}let r={molecules:n};return jD.success(r)}function pIe(e){return hb.create(`Parse Mol`,async()=>fIe(e))}function mIe(e,t){let{molecules:n}=e,r=0;for(let e of n)r+=e.count;let i=Array(r),a=new Int32Array(r),o=new Float32Array(r),s=new Float32Array(r),c=new Float32Array(r),l=new Int32Array(r),u=0;for(let e=0;e<n.length;e++){let t=n[e];for(let n=0;n<t.count;n++)i[u]=t.type_symbol.value(n),o[u]=t.x.value(n),s[u]=t.y.value(n),c[u]=t.z.value(n),a[u]=n,l[u]=e,u++}let d=U.ofConst(`MOL`,r,U.Schema.str),f=U.ofConst(`A`,r,U.Schema.str),p=U.ofConst(1,r,U.Schema.int),m=U.ofStringArray(i),h=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:f,auth_atom_id:m,auth_comp_id:d,auth_seq_id:p,Cartn_x:U.ofFloatArray(o),Cartn_y:U.ofFloatArray(s),Cartn_z:U.ofFloatArray(c),id:U.ofIntArray(a),label_asym_id:f,label_atom_id:m,label_comp_id:d,label_seq_id:p,label_entity_id:U.ofConst(`1`,r,U.Schema.str),occupancy:U.ofConst(1,r,U.Schema.float),type_symbol:m,pdbx_PDB_model_num:U.ofIntArray(l)},r),g=new BI;g.setNames([[`MOL`,`Unknown Entity`]]),g.getEntityId(`MOL`,iI.Unknown,`A`);let _=new LI(p,m);return _.setNames([[`MOL`,`Unknown Molecule`]]),_.add(`MOL`,0),JB(PI({entity:g.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:h}),SU.create(e),t)}var SU;(function(e){function t(e){return e?.kind===`xyz`}e.is=t;function n(e){return{kind:`xyz`,name:`xyz`,data:e}}e.create=n})(SU||={});function hIe(e){return hb.create(`Parse XYZ`,t=>mIe(e,t))}const CU={lj:{mass:`unitless`,distance:`unitless`,time:`unitless`,energy:`unitless`,velocity:`unitless`,force:`unitless`,torque:`unitless`,temperature:`unitless`,pressure:`unitless`,viscosity:`unitless`,charge:`unitless`,density:`unitless`,scale:1},real:{mass:`grams/mole`,distance:`Angstroms`,time:`femtoseconds`,energy:`Kcal/mol`,velocity:`Angstroms/femtosecond`,force:`Kcal/mol-Angstrom`,torque:`Kcal/mol`,temperature:`Kelvin`,pressure:`atmospheres`,viscosity:`Poise`,charge:`multiple of electron charge`,dipole:`charge*Angstroms`,electricField:`volts/Angstrom`,density:`g/cm^3`,scale:1},metal:{mass:`grams/mole`,distance:`Angstroms`,time:`picoseconds`,energy:`eV`,velocity:`Angstroms/picosecond`,force:`eV/Angstrom`,torque:`eV`,temperature:`Kelvin`,pressure:`bars`,viscosity:`Poise`,charge:`multiple of electron charge`,dipole:`charge*Angstroms`,electricField:`volts/Angstrom`,density:`g/cm^3`,scale:1},si:{mass:`kilograms`,distance:`meters`,time:`seconds`,energy:`Joules`,velocity:`meters/second`,force:`Newtons`,torque:`Newton-meters`,temperature:`Kelvin`,pressure:`Pascals`,viscosity:`Pascal*second`,charge:`Coulombs`,dipole:`Coulombs*meters`,electricField:`volts/meter`,density:`kg/m^3`,scale:1},cgs:{mass:`grams`,distance:`centimeters`,time:`seconds`,energy:`ergs`,velocity:`centimeters/second`,force:`dynes`,torque:`dyne-centimeters`,temperature:`Kelvin`,pressure:`dyne/cm^2`,viscosity:`Poise`,charge:`statcoulombs`,dipole:`statcoul-cm`,electricField:`statvolt/cm`,density:`g/cm^3`,scale:1},electron:{mass:`atomic mass units`,distance:`Bohr`,time:`femtoseconds`,energy:`Hartrees`,velocity:`Bohr/atomic time units`,force:`Hartrees/Bohr`,temperature:`Kelvin`,pressure:`Pascals`,charge:`multiple of electron charge`,dipole:`Debye`,electricField:`volts/cm`,density:`unitless`,torque:``,viscosity:``,scale:.529177},micro:{mass:`picograms`,distance:`micrometers`,time:`microseconds`,energy:`picogram-micrometer^2/microsecond^2`,velocity:`micrometers/microsecond`,force:`picogram-micrometer/microsecond^2`,torque:`picogram-micrometer^2/microsecond^2`,temperature:`Kelvin`,pressure:`picogram/(micrometer-microsecond^2)`,viscosity:`picogram/(micrometer-microsecond)`,charge:`picocoulombs`,dipole:`picocoulomb-micrometer`,electricField:`volt/micrometer`,density:`pg/m^3`,scale:1},nano:{mass:`attograms`,distance:`nanometers`,time:`nanoseconds`,energy:`attogram-nanometer^2/nanosecond^2`,velocity:`nanometers/nanosecond`,force:`attogram-nanometer/nanosecond^2`,torque:`attogram-nanometer^2/nanosecond^2`,temperature:`Kelvin`,pressure:`attogram/(nanometer-nanosecond^2)`,viscosity:`attogram/(nanometer-nanosecond)`,charge:`multiple of electron charge`,dipole:`charge-nanometer`,electricField:`volt/nanometer`,density:`ag/nm^3`,scale:10}},wU=[`real`,`metal`,`si`,`cgs`,`electron`,`micro`,`nano`,`lj`];var{readLine:TU,skipWhitespace:EU,eatValue:DU,eatLine:gIe,markStart:OU}=iO,kU=/\s+/;function _Ie(e,t){return{tokenizer:e,runtimeCtx:t}}async function vIe(e,t,n){let{tokenizer:r}=e,i=aO.create(r.data,t*2),a=aO.create(r.data,t*2),o=aO.create(r.data,t*2),s=aO.create(r.data,t*2),c=aO.create(r.data,t*2),l=aO.create(r.data,t*2),u=aO.create(r.data,t*2),d={full:[i,a,o,s,c,l,u],atomic:[i,o,c,l,u],bond:[i,a,o,c,l,u]},f=d[n].length,{position:p}=r;TU(r).trim(),r.position=p;let{length:m}=r,h=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let i=Math.min(t-h,e);for(let e=0;e<i;++e){for(let e=0;e<f;++e){EU(r),OU(r),DU(r);let t=d[n][e];t&&aO.addUnchecked(t,r.tokenStart,r.tokenEnd)}gIe(r),OU(r)}return h+=i,i},e=>e.update({message:`Parsing...`,current:r.position,max:m})),{count:t,atomId:$D(i)(U.Schema.int),moleculeId:$D(a)(U.Schema.int),atomType:$D(o)(U.Schema.int),charge:$D(s)(U.Schema.float),x:$D(c)(U.Schema.float),y:$D(l)(U.Schema.float),z:$D(u)(U.Schema.float)}}async function yIe(e,t){let{tokenizer:n}=e,r=aO.create(n.data,t*2),i=aO.create(n.data,t*2),a=aO.create(n.data,t*2),o=aO.create(n.data,t*2),{length:s}=n,c=0;return await gb(e.runtimeCtx,10,void 0,e=>{let s=Math.min(t-c,e);for(let e=0;e<s;++e)for(let e=0;e<4;++e)switch(EU(n),OU(n),DU(n),e){case 0:aO.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:aO.addUnchecked(i,n.tokenStart,n.tokenEnd);break;case 2:aO.addUnchecked(a,n.tokenStart,n.tokenEnd);break;case 3:aO.addUnchecked(o,n.tokenStart,n.tokenEnd);break}return c+=s,s},e=>e.update({message:`Parsing...`,current:n.position,max:s})),{count:t,bondId:$D(r)(U.Schema.int),bondType:$D(i)(U.Schema.int),atomIdA:$D(a)(U.Schema.int),atomIdB:$D(o)(U.Schema.int)}}var bIe=[`full`,`atomic`,`bond`];async function xIe(e,t){let n=iO(e),r=_Ie(n,t),i,a,o=0,s=0,c=`full`;for(;n.tokenEnd<n.length;){let e=TU(r.tokenizer).trim();if(e.includes(`atoms`))o=parseInt(e.split(kU)[0]);else if(e.includes(`bonds`))s=parseInt(e.split(kU)[0]);else if(!e.includes(`Masses`))if(e.includes(`Atoms`)){let t=e.split(`#`);if(t.length>1){let e=t[1].trim();bIe.includes(e)?c=e:console.warn(`Unknown atom style: ${e}`)}i=await vIe(r,o,c)}else e.includes(`Bonds`)&&(a=await yIe(r,s))}if(i===void 0)return jD.error(`no atoms data`);a===void 0&&(a={count:0,bondId:U.ofIntArray([]),bondType:U.ofIntArray([]),atomIdA:U.ofIntArray([]),atomIdB:U.ofIntArray([])});let l={atoms:i,bonds:a};return jD.success(l)}function SIe(e){return hb.create(`Parse LammpsData`,async t=>await xIe(e,t))}async function CIe(e,t,n=`real`){let{atoms:r,bonds:i}=e,a=[],o=r.count,s=CU[n].scale,c=Array(o),l=new Int32Array(o),u=new Float32Array(o),d=new Float32Array(o),f=new Float32Array(o),p=new Int32Array(o),m=0;for(let e=0;e<o;e++)c[m]=r.atomType.value(e).toString(),u[m]=r.x.value(e)*s,d[m]=r.y.value(e)*s,f[m]=r.z.value(e)*s,l[m]=r.atomId.value(e)-1,p[m]=0,m++;let h=U.ofConst(`MOL`,o,U.Schema.str),g=U.ofLambda({value:e=>r.moleculeId.value(e).toString(),rowCount:o,schema:U.Schema.str}),_=U.ofConst(1,o,U.Schema.int),v=U.ofStringArray(c),y=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:g,auth_atom_id:v,auth_comp_id:h,auth_seq_id:_,Cartn_x:U.ofFloatArray(u),Cartn_y:U.ofFloatArray(d),Cartn_z:U.ofFloatArray(f),id:U.ofIntArray(l),label_asym_id:g,label_atom_id:v,label_comp_id:h,label_seq_id:_,label_entity_id:U.ofConst(`1`,o,U.Schema.str),occupancy:U.ofConst(1,o,U.Schema.float),type_symbol:v,pdbx_PDB_model_num:U.ofIntArray(p)},o),b=new BI;b.setNames([[`MOL`,`Unknown Entity`]]),b.getEntityId(`MOL`,iI.Unknown,`A`);let x=new LI(_,v);x.setNames([[`MOL`,`Unknown Molecule`]]),x.add(`MOL`,0);let S=await JB(PI({entity:b.getEntityTable(),chem_comp:x.getChemCompTable(),atom_site:y}),AU.create(e),t);if(S.frameCount>0){let e=S.representative;if(i.count!==0){let t=U.ofIntArray(U.mapToArray(i.atomIdA,e=>e-1,Int32Array)),n=U.ofIntArray(U.mapToArray(i.atomIdB,e=>e-1,Int32Array)),a=i.bondId,o=U.ofConst(1,i.count,U.Schema.int),s=U.ofConst(kI.Flag.Covalent,i.count,U.Schema.int),c=YI.fromData({pairs:{key:a,indexA:t,indexB:n,order:o,flag:s},count:r.count},{maxDistance:1/0});YI.Provider.set(e,c)}tV.Provider.set(e,{data:r.charge,type:`NO_CHARGES`}),a.push(e)}return new vB(a)}var AU;(function(e){function t(e){return e?.kind===`data`}e.is=t;function n(e){return{kind:`data`,name:`data`,data:e}}e.create=n})(AU||={});function wIe(e,t){return t===void 0&&(t=`real`),hb.create(`Parse Lammps Data`,n=>CIe(e,n,t))}var{readLine:jU,skipWhitespace:TIe,eatValue:EIe,eatLine:DIe,markStart:MU}=iO;function OIe(e,t){return{tokenizer:e,runtimeCtx:t}}async function kIe(e,t,n){let{tokenizer:r}=e,i=Object.fromEntries(n.map((e,t)=>[e,t])),a=n.findIndex(e=>e[0]===`x`),o=n.findIndex(e=>e[0]===`y`),s=n.findIndex(e=>e[0]===`z`),c=n[a],l=aO.create(r.data,t*2),u=aO.create(r.data,t*2),d=aO.create(r.data,t*2),f=aO.create(r.data,t*2),p=aO.create(r.data,t*2),m=aO.create(r.data,t*2),{position:h}=r;r.position=h;let g=n.length,{length:_}=r,v=0;return await gb(e.runtimeCtx,1e5,void 0,e=>{let n=Math.min(t-v,e);for(let e=0;e<n;++e){for(let e=0;e<g;++e)switch(TIe(r),MU(r),EIe(r),e){case i.id:aO.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case i.mol:aO.addUnchecked(u,r.tokenStart,r.tokenEnd);break;case i.type:aO.addUnchecked(d,r.tokenStart,r.tokenEnd);break;case a:aO.addUnchecked(f,r.tokenStart,r.tokenEnd);break;case o:aO.addUnchecked(p,r.tokenStart,r.tokenEnd);break;case s:aO.addUnchecked(m,r.tokenStart,r.tokenEnd);break}DIe(r),MU(r)}return v+=n,n},e=>e.update({message:`Parsing...`,current:r.position,max:_})),{count:t,atomMode:c,atomId:$D(l)(U.Schema.int),moleculeId:$D(u)(U.Schema.int),atomType:$D(d)(U.Schema.int),x:$D(f)(U.Schema.float),y:$D(p)(U.Schema.float),z:$D(m)(U.Schema.float)}}async function AIe(e,t){let n=iO(e),r=OIe(n,t),i={frames:[],times:[],bounds:[],timeOffset:0,deltaTime:0},a=i.frames,o=0,s=0;for(;n.tokenEnd<n.length;){let e=jU(r.tokenizer).trim();if(e.includes(`ITEM: TIMESTEP`))s=parseInt(jU(r.tokenizer).trim()),i.times.push(s);else if(e.includes(`ITEM: NUMBER OF ATOMS`))o=parseInt(jU(r.tokenizer).trim());else if(e.includes(`ITEM: ATOMS`)){let t=e.split(` `).slice(2),n=await kIe(r,o,t);a.push(n)}else if(e.includes(`ITEM: BOX BOUNDS`)){let t=e.split(`ITEM: BOX BOUNDS `)[1].split(` `),n=t[0],a=t[1],o=t[2],s=jU(r.tokenizer).trim().split(` `),c=jU(r.tokenizer).trim().split(` `),l=jU(r.tokenizer).trim().split(` `),u=parseFloat(s[0]),d=parseFloat(s[1]),f=parseFloat(c[0]),p=parseFloat(c[1]),m=parseFloat(l[0]),h=parseFloat(l[1]);i.bounds.push({lower:[u,f,m],length:[d-u,p-f,h-m],periodicity:[n,a,o]})}}return i.times.length>=1&&(i.timeOffset=i.times[0]),i.times.length>=2&&(i.deltaTime=i.times[1]-i.times[0]),jD.success(i)}function NU(e){return hb.create(`Parse Lammp Trajectory`,async t=>await AIe(e,t))}function PU(e,t=`real`){return hb.create(`Parse Lammps Trajectory`,async n=>{await n.update(`Converting to coordinates`);let r=CU[t].scale,i=RF(e.deltaTime,`step`),a=RF(e.timeOffset,i.unit),o={x:0,y:0,z:0},s={x:1,y:1,z:1},c=e.frames[0].atomMode.includes(`s`),l=[];for(let t=0,n=e.frames.length;t<n;++t){let n=e.bounds[t];c&&(s.x=n.length[0],s.y=n.length[1],s.z=n.length[2],o.x=n.lower[0],o.y=n.lower[1],o.z=n.lower[2]);let u=e.frames[t].count,d=new Float32Array(u),f=new Float32Array(u),p=new Float32Array(u),m=0;for(let n=0;n<u;n++)d[m]=(e.frames[t].x.value(n)*s.x+o.x)*r,f[m]=(e.frames[t].y.value(n)*s.y+o.y)*r,p[m]=(e.frames[t].z.value(n)*s.z+o.z)*r,m++;l.push({elementCount:e.frames[t].count,x:d,y:f,z:p,xyzOrdering:{isIdentity:!0},time:RF(a.value+i.value*t,i.unit)})}return zF.create(l,i,a)})}async function jIe(e,t,n=`real`){let r=e.frames[0],i=r.count,a=r.atomMode,o=e.bounds[0],s={x:0,y:0,z:0},c={x:1,y:1,z:1},l=CU[n].scale;a.includes(`s`)&&(c.x=o.length[0],c.y=o.length[1],c.z=o.length[2],s.x=o.lower[0],s.y=o.lower[1],s.z=o.lower[2]);let u=Array(i),d=new Int32Array(i),f=new Float32Array(i),p=new Float32Array(i),m=new Float32Array(i),h=new Int32Array(i),g=0;for(let e=0;e<i;e++)u[g]=r.atomType.value(e).toString(),f[g]=(r.x.value(e)*c.x+s.x)*l,p[g]=(r.y.value(e)*c.y+s.y)*l,m[g]=(r.z.value(e)*c.z+s.z)*l,d[g]=r.atomId.value(e),h[g]=0,g++;let _=U.ofConst(`MOL`,i,U.Schema.str),v=U.ofLambda({value:e=>r.moleculeId.value(e).toString(),rowCount:i,schema:U.Schema.str}),y=U.ofConst(1,i,U.Schema.int),b=U.ofStringArray(u),x=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:v,auth_atom_id:b,auth_comp_id:_,auth_seq_id:y,Cartn_x:U.ofFloatArray(f),Cartn_y:U.ofFloatArray(p),Cartn_z:U.ofFloatArray(m),id:U.ofIntArray(d),label_asym_id:v,label_atom_id:b,label_comp_id:_,label_seq_id:y,label_entity_id:U.ofConst(`1`,i,U.Schema.str),occupancy:U.ofConst(1,i,U.Schema.float),type_symbol:b,pdbx_PDB_model_num:U.ofIntArray(h)},i),S=new BI;S.setNames([[`MOL`,`Unknown Entity`]]),S.getEntityId(`MOL`,iI.Unknown,`A`);let C=new LI(y,b);C.setNames([[`MOL`,`Unknown Molecule`]]),C.add(`MOL`,0);let w=(await JB(PI({entity:S.getEntityTable(),chem_comp:C.getChemCompTable(),atom_site:x}),FU.create(e),t)).representative,T=await PU(e,n).runInContext(t);return DB.trajectoryFromModelAndCoordinates(w,T)}var FU;(function(e){function t(e){return e?.kind===`lammpstrj`}e.is=t;function n(e){return{kind:`lammpstrj`,name:`lammpstrj`,data:e}}e.create=n})(FU||={});function MIe(e,t){return t===void 0&&(t=`real`),hb.create(`Parse Lammps Traj Data`,n=>jIe(e,n,t))}function NIe(e){return e.trim().endsWith(`V3000`)}function PIe(e){let t=aO.create(e.data,1),n=aO.create(e.data,1);return iO.eatLine(e),IU(e),IU(e),IU(e),LU(e,t),LU(e,n),iO.eatLine(e),{atomCount:$D(t)(U.Schema.int).value(0),bondCount:$D(n)(U.Schema.int).value(0)}}function FIe(e,t){let n=aO.create(e.data,t*2),r=aO.create(e.data,t*2),i=aO.create(e.data,t*2),a=aO.create(e.data,t*2);for(let o=0;o<t;++o){iO.markLine(e),IU(e),IU(e),IU(e);let{position:t}=e;LU(e,a),LU(e,n),LU(e,r),LU(e,i),e.position=t}return iO.eatLine(e),iO.eatLine(e),{count:t,x:$D(n)(U.Schema.float),y:$D(r)(U.Schema.float),z:$D(i)(U.Schema.float),type_symbol:$D(a)(U.Schema.str),formal_charge:U.ofConst(0,t,U.Schema.int)}}function IIe(e,t){let n=aO.create(e.data,t*2),r=aO.create(e.data,t*2),i=aO.create(e.data,t*2);for(let a=0;a<t;++a){iO.markLine(e),IU(e),IU(e),IU(e);let{position:t}=e;LU(e,i),LU(e,n),LU(e,r),e.position=t}return iO.eatLine(e),iO.eatLine(e),{count:t,atomIdxA:$D(n)(U.Schema.float),atomIdxB:$D(r)(U.Schema.float),order:$D(i)(U.Schema.float)}}function IU(e){iO.skipWhitespace(e),iO.eatValue(e)}function LU(e,t){let{position:n}=e;iO.skipWhitespace(e),iO.eatValue(e),iO.trim(e,n,e.position),aO.addUnchecked(t,e.tokenStart,e.tokenEnd)}var RU=`$$$$`;function LIe(e){let t=aO.create(e.data,32),n=aO.create(e.data,32);for(;e.position<e.length;){let r=iO.readLine(e);if(r.startsWith(RU))break;if(r&&r.startsWith(`> `)){aO.add(t,e.tokenStart+2,e.tokenEnd),iO.markLine(e);let r=e.tokenStart,i=e.tokenEnd,a=!1;for(;e.position<e.length;){let t=iO.readLine(e);if(!t||t.startsWith(RU)||t.startsWith(`> `)){aO.add(n,r,i),a=!0;break}i=e.tokenEnd}a||aO.add(n,r,i)}}return{dataHeader:$D(t)(U.Schema.str),data:$D(n)(U.Schema.str)}}function RIe(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function zIe(e){let t=iO.readLine(e).trim(),n=iO.readLine(e).trim(),r=iO.readLine(e).trim(),i=iO.readLine(e),a=NIe(i),{atomCount:o,bondCount:s}=a?PIe(e):RIe(i);if(Number.isNaN(o)||Number.isNaN(s)){for(;e.position<e.length&&!iO.readLine(e).startsWith(RU););return}let c={atomIdx:U.ofConst(0,o,U.Schema.int),charge:U.ofConst(0,o,U.Schema.int)},l=a?FIe(e,o):oU(e,o),u=a?IIe(e,s):sU(e,s),d=a?{formalCharges:c}:cU(e),f=LIe(e);return{molFile:{title:t,program:n,comment:r,atoms:l,bonds:u,...d},dataItems:f}}function BIe(e){let t=iO(e),n=[];for(;t.position<t.length;){let e=zIe(t);e&&n.push(e)}return jD.success({compounds:n})}function VIe(e){return hb.create(`Parse Sdf`,async()=>BIe(e))}var zU;(function(e){function t(e){return e?.kind===`sdf`}e.is=t;function n(e){return{kind:`sdf`,name:e.molFile.title,data:e}}e.create=n})(zU||={});function HIe(e){return hb.create(`Parse SDF`,t=>lU(e.molFile,zU.create(e),t))}async function UIe(e){let t=new DataView(e.buffer),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},r=n.frames,i=n.boxes,a=n.times,o=0;for(;;){o+=8;let n=t.getInt32(o);o+=4,o+=n;let s=t.getInt32(o+8),c=t.getInt32(o+12),l=t.getInt32(o+16),u=t.getInt32(o+28),d=t.getInt32(o+32),f=t.getInt32(o+36),p=t.getInt32(o+40);o+=52;let m=s/9,h=p*3;if(m===8?a.push(t.getFloat64(o)):a.push(t.getFloat32(o)),o+=2*m,s){let e=new Float32Array(9);if(m===8)for(let n=0;n<9;++n)e[n]=t.getFloat64(o)*10,o+=8;else for(let n=0;n<9;++n)e[n]=t.getFloat32(o)*10,o+=4;i.push(e)}if(o+=c,o+=l,u){let n=new Float32Array(p),i=new Float32Array(p),a=new Float32Array(p);if(m===8)for(let e=0;e<p;++e)n[e]=t.getFloat64(o)*10,i[e]=t.getFloat64(o+8)*10,a[e]=t.getFloat64(o+16)*10,o+=24;else{let t=new Uint32Array(e.buffer,o,h);for(let e=0;e<h;++e){let n=t[e];t[e]=(n&255)<<24|(n&65280)<<8|n>>8&65280|n>>24&255}let r=new Float32Array(e.buffer,o,h);for(let e=0;e<p;++e)n[e]=r[e*3]*10,i[e]=r[e*3+1]*10,a[e]=r[e*3+2]*10,o+=12}r.push({count:p,x:n,y:i,z:a})}if(o+=d,o+=f,o>=e.byteLength)break}return a.length>=1&&(n.timeOffset=a[0]),a.length>=2&&(n.deltaTime=a[1]-a[0]),n}function WIe(e){return hb.create(`Parse TRR`,async t=>{try{t.update({canAbort:!0,message:`Parsing trajectory...`});let n=await UIe(e);return jD.success(n)}catch(e){return jD.error(``+e)}})}function GIe(e){return hb.create(`Parse TRR`,async t=>{await t.update(`Converting to coordinates`);let n=RF(e.deltaTime,`step`),r=RF(e.timeOffset,n.unit),i=[];for(let t=0,a=e.frames.length;t<a;++t){let a=e.boxes[t],o=B.fromArray(B(),a,0),s=B.fromArray(B(),a,3),c=B.fromArray(B(),a,6);i.push({elementCount:e.frames[t].count,cell:BF.fromBasis(o,s,c),x:e.frames[t].x,y:e.frames[t].y,z:e.frames[t].z,xyzOrdering:{isIdentity:!0},time:RF(r.value+n.value*t,n.unit)})}return zF.create(i,n,r)})}var KIe=1024*8,BU=[],qIe=class{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;e===void 0&&(e=KIe),typeof e==`number`?e=new ArrayBuffer(e):n=!0;let r=t.offset?t.offset>>>0:0,i=e.byteLength-r,a=r;!(e instanceof ArrayBuffer)&&!(e instanceof SharedArrayBuffer)&&(e.byteLength!==e.buffer.byteLength&&(a=e.byteOffset+r),e=e.buffer),n?this._lastWrittenByte=i:this._lastWrittenByte=0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=a,this._data=new DataView(this.buffer,a,i)}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let e=this._marks.pop();if(e===void 0)throw Error(`Mark stack empty`);return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){let t=(this.offset+e)*2,n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);let t=new Uint8Array(e);for(let n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){let e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){let e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){let e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){let e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){let e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){let e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){BU.length=e;for(let t=0;t<e;t++)BU[t]=this.readChar();return BU.join(``)}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}};function VU(e,t){if(e)throw TypeError(`Not a valid NetCDF v3.x file: `+t)}function HU(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function UU(e){let t=e.readUint32(),n=e.readChars(t);return HU(e),n}var WU={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function GU(e){switch(Number(e)){case WU.BYTE:return`byte`;case WU.CHAR:return`char`;case WU.SHORT:return`short`;case WU.INT:return`int`;case WU.FLOAT:return`float`;case WU.DOUBLE:return`double`;default:return`undefined`}}function KU(e){switch(Number(e)){case WU.BYTE:return 1;case WU.CHAR:return 1;case WU.SHORT:return 2;case WU.INT:return 4;case WU.FLOAT:return 4;case WU.DOUBLE:return 8;default:return-1}}function qU(e){switch(String(e)){case`byte`:return WU.BYTE;case`char`:return WU.CHAR;case`short`:return WU.SHORT;case`int`:return WU.INT;case`float`:return WU.FLOAT;case`double`:return WU.DOUBLE;default:return-1}}function JU(e,t){if(e!==1){let n=Array(e);for(let r=0;r<e;r++)n[r]=t();return n}else return t()}function YU(e,t,n){switch(t){case WU.BYTE:return e.readBytes(n);case WU.CHAR:return JIe(e.readChars(n));case WU.SHORT:return JU(n,e.readInt16.bind(e));case WU.INT:return JU(n,e.readInt32.bind(e));case WU.FLOAT:return JU(n,e.readFloat32.bind(e));case WU.DOUBLE:return JU(n,e.readFloat64.bind(e));default:VU(!0,`non valid type `+t);return}}function JIe(e){return e.charCodeAt(e.length-1)===0?e.substring(0,e.length-1):e}function YIe(e,t){let n=qU(t.type),r=t.size/KU(n),i=Array(r);for(let t=0;t<r;t++)i[t]=YU(e,n,1);return i}function XIe(e,t,n){let r=qU(t.type),i=t.size?t.size/KU(r):1,a=n.length,o=Array(a),s=n.recordStep;for(let t=0;t<a;t++){let n=e.offset;o[t]=YU(e,r,i),e.seek(n+s)}return o}var XU=0,ZIe=10,QIe=11,$Ie=12;function eLe(e,t){let n={recordDimension:{length:e.readUint32()}};n.version=t;let r=tLe(e);n.recordDimension.id=r.recordId,n.recordDimension.name=r.recordName,n.dimensions=r.dimensions,n.globalAttributes=ZU(e);let i=nLe(e,r.recordId,t);return n.variables=i.variables,n.recordDimension.recordStep=i.recordStep,n}function tLe(e){let t,n,r,i=e.readUint32();if(i===XU)return VU(e.readUint32()!==XU,`wrong empty tag for list of dimensions`),[];{VU(i!==ZIe,`wrong tag for list of dimensions`);let a=e.readUint32();t=Array(a);for(let i=0;i<a;i++){let a=UU(e),o=e.readUint32();o===0&&(n=i,r=a),t[i]={name:a,size:o}}return{dimensions:t,recordId:n,recordName:r}}}function ZU(e){let t,n=e.readUint32();if(n===XU)return VU(e.readUint32()!==XU,`wrong empty tag for list of attributes`),[];{VU(n!==$Ie,`wrong tag for list of attributes`);let r=e.readUint32();t=Array(r);for(let n=0;n<r;n++){let r=UU(e),i=e.readUint32();VU(i<1||i>6,`non valid type `+i);let a=YU(e,i,e.readUint32());HU(e),t[n]={name:r,type:GU(i),value:a}}}return t}function nLe(e,t,n){let r=e.readUint32(),i=0,a;if(r===XU)return VU(e.readUint32()!==XU,`wrong empty tag for list of variables`),[];{VU(r!==QIe,`wrong tag for list of variables`);let o=e.readUint32();a=Array(o);for(let r=0;r<o;r++){let o=UU(e),s=e.readUint32(),c=Array(s);for(let t=0;t<s;t++)c[t]=e.readUint32();let l=ZU(e),u=e.readUint32();VU(u<1&&u>6,`non valid type `+u);let d=e.readUint32(),f=e.readUint32();n===2&&(VU(f>0,`offsets larger than 4GB not supported`),f=e.readUint32()),c[0]===t&&(i+=d),a[r]={name:o,dimensions:c,attributes:l,type:GU(u),size:d,offset:f,record:c[0]===t}}}return{variables:a,recordStep:i}}var rLe=class{constructor(e){let t=new qIe(e);t.setBigEndian(),VU(t.readChars(3)!==`CDF`,`should start with CDF`);let n=t.readByte();VU(n>2,`unknown version`),this.header=eLe(t,n),this.buffer=t}get version(){return this.header.version===1?`classic format`:`64-bit offset format`}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables&&this.header.variables.findIndex(t=>t.name===e)!==-1}getDataVariable(e){let t;if(t=typeof e==`string`?this.header.variables?.find(t=>t.name===e):e,t===void 0)throw Error(`variable not found`);return this.buffer.seek(t.offset),t.record?XIe(this.buffer,t,this.header.recordDimension):YIe(this.buffer,t)}};async function iLe(e){let t=new rLe(e.buffer),n={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(let e of t.getDataVariable(`coordinates`))n.coordinates.push(e);if(t.hasDataVariable(`velocities`)){let e=[];for(let n of t.getDataVariable(`velocities`))e.push(n);n.velocities=e}if(t.hasDataVariable(`forces`)){let e=[];for(let n of t.getDataVariable(`forces`))e.push(n);n.forces=e}if(t.hasDataVariable(`cell_lengths`)){let e=[];for(let n of t.getDataVariable(`cell_lengths`))e.push(n);n.cell_lengths=e}if(t.hasDataVariable(`cell_angles`)){let e=[];for(let n of t.getDataVariable(`cell_angles`))e.push(n);n.cell_angles=e}if(t.hasDataVariable(`time`)){let e=[];for(let n of t.getDataVariable(`time`))e.push(n);n.time=e}return n.time&&(n.time.length>=1&&(n.timeOffset=n.time[0]),n.time.length>=2&&(n.deltaTime=n.time[1]-n.time[0])),n}function aLe(e){return hb.create(`Parse NCTRAJ`,async t=>{try{t.update({canAbort:!0,message:`Parsing trajectory...`});let n=await iLe(e);return jD.success(n)}catch(e){return jD.error(``+e)}})}function oLe(e){return hb.create(`Parse NCTRAJ`,async t=>{await t.update(`Converting to coordinates`);let n=RF(e.deltaTime,`step`),r=RF(e.timeOffset,n.unit),i=[];for(let t=0,a=e.coordinates.length;t<a;++t){let a=e.coordinates[t],o=a.length/3,s=new Float32Array(o),c=new Float32Array(o),l=new Float32Array(o);for(let e=0,t=a.length;e<t;e+=3)s[e/3]=a[e],c[e/3]=a[e+1],l[e/3]=a[e+2];let u={elementCount:o,x:s,y:c,z:l,xyzOrdering:{isIdentity:!0},time:RF(r.value+n.value*t,n.unit)};if(e.cell_lengths){let n=e.cell_lengths[t],r=B.scale(B(),B.unitX,n[0]),i=B.scale(B(),B.unitY,n[1]),a=B.scale(B(),B.unitZ,n[2]);u.cell=BF.fromBasis(r,i,a)}i.push(u)}return zF.create(i,n,r)})}function sLe(e){let{pointers:t,residuePointer:n,residueLabel:r,atomName:i}=e,a=t.NATOM,o=t.NRES,s=new Uint32Array(a),c=[],l=(e,t,n)=>{let i=r.value(e);for(let r=t,a=n;r<a;++r)s[r]=e+1,c[r]=i};for(let e=0,t=o-1;e<t;++e)l(e,n.value(e)-1,n.value(e+1)-1);l(o-1,n.value(o-1)-1,a);let u=U.ofIntArray(s),d=U.ofStringArray(c),f=Array(a),p=Array(a),m=new Uint32Array(a),h=new Uint32Array(a),g=new BI,_=new LI(u,i),v=``,y=0,b=``,x=0,S=iI.Unknown,C=-1;for(let e=0,t=a;e<t;++e){let t=u.value(e);if(t!==C){let n=d.value(e),r=CI(_.add(n,e).type,n);r!==S&&(b=zI(y),y+=1,x=0),v=g.getEntityId(n,r,b),x+=1,C=t,S=r}f[e]=v,p[e]=b,m[e]=x,h[e]=e}let w=U.ofIntArray(h),T=U.ofStringArray(p),E=Array(a);for(let e=0;e<a;++e)E[e]=HF(i.value(e),d.value(e));let D=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:T,auth_atom_id:U.asArrayColumn(i),auth_comp_id:d,auth_seq_id:u,id:U.asArrayColumn(w),label_asym_id:T,label_atom_id:U.asArrayColumn(i),label_comp_id:d,label_seq_id:U.ofIntArray(m),label_entity_id:U.ofStringArray(f),occupancy:U.ofConst(1,a,U.Schema.float),type_symbol:U.ofStringArray(E),pdbx_PDB_model_num:U.ofConst(1,a,U.Schema.int)},a);return PI({entity:g.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:D})}var QU;(function(e){function t(e){return e?.kind===`prmtop`}e.is=t;function n(e){return{kind:`prmtop`,name:e.title.join(` `)||`PRMTOP`,data:e}}e.fromPrmtop=n})(QU||={});function cLe(e){return hb.create(`Parse PRMTOP`,async t=>{let n=QU.fromPrmtop(e),r=sLe(e),{pointers:{NBONH:i,NBONA:a},bondsIncHydrogen:o,bondsWithoutHydrogen:s}=e,c=i+a,l={indexA:U.ofLambda({value:e=>e<i?o.value(e*3)/3:s.value((e-i)*3)/3,rowCount:c,schema:U.Schema.int}),indexB:U.ofLambda({value:e=>e<i?o.value(e*3+1)/3:s.value((e-i)*3+1)/3,rowCount:c,schema:U.Schema.int}),order:U.ofConst(1,c,U.Schema.int)};return QI.create(e.title.join(` `)||`PRMTOP`,r,l,n)})}function lLe(e){let{molecules:t,compounds:n}=e,r={},i=0;for(let e=0,a=t._rowCount;e<a;++e){let a=t.compound.value(e),o=t.molCount.value(e),{atoms:s}=n[a];U.asArrayColumn(s.atom),U.asArrayColumn(s.resnr),U.asArrayColumn(s.residu),i+=o*s._rowCount;let c=s.resnr.value(0);r[a]=!0;for(let e=1,t=s._rowCount;e<t;++e){let t=s.resnr.value(e);if(t!==c){r[a]=!1;break}c=t}}let a=Array(i),o=new Uint32Array(i),s=Array(i),c=0;for(let e=0,i=t._rowCount;e<i;++e){let i=t.compound.value(e),l=t.molCount.value(e),{atoms:u}=n[i],d=r[i];for(let e=0;e<l;++e)for(let t=0,n=u._rowCount;t<n;++t)a[c]=u.atom.value(t),o[c]=u.resnr.value(t),s[c]=u.residu.value(t),d&&(o[c]+=e),c+=1}let l=U.ofStringArray(a),u=U.ofIntArray(o),d=U.ofStringArray(s),f=Array(i),p=Array(i),m=new Uint32Array(i),h=new Uint32Array(i),g=new BI,_=new LI(u,l),v=``,y=0,b=``,x=0,S=iI.Unknown,C=-1;for(let e=0,t=i;e<t;++e){let t=u.value(e);if(t!==C){let n=d.value(e),r=CI(_.add(n,e).type,n);r!==S&&(b=zI(y),y+=1,x=0),v=g.getEntityId(n,r,b),x+=1,C=t,S=r}f[e]=v,p[e]=b,m[e]=x,h[e]=e}let w=U.ofIntArray(h),T=U.ofStringArray(p),E=Array(i);for(let e=0;e<i;++e)E[e]=HF(l.value(e),d.value(e));let D=QD.ofPartialColumns(NI.atom_site,{auth_asym_id:T,auth_atom_id:U.asArrayColumn(l),auth_comp_id:d,auth_seq_id:u,id:U.asArrayColumn(w),label_asym_id:T,label_atom_id:U.asArrayColumn(l),label_comp_id:d,label_seq_id:U.ofIntArray(m),label_entity_id:U.ofStringArray(f),occupancy:U.ofConst(1,i,U.Schema.float),type_symbol:U.ofStringArray(E),pdbx_PDB_model_num:U.ofConst(1,i,U.Schema.int)},i);return PI({entity:g.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:D})}function uLe(e){let{molecules:t,compounds:n}=e,r=[],i=[],a=0;for(let e=0,o=t._rowCount;e<o;++e){let o=t.compound.value(e),s=t.molCount.value(e),{atoms:c,bonds:l}=n[o];if(l)for(let e=0;e<s;++e){for(let e=0,t=l._rowCount;e<t;++e)r.push(l.ai.value(e)-1+a),i.push(l.aj.value(e)-1+a);a+=c._rowCount}else if(o===`TIP3`)for(let e=0;e<s;++e)r.push(0+a),i.push(1+a),r.push(0+a),i.push(2+a),a+=c._rowCount;else a+=s*c._rowCount}return{indexA:U.ofIntArray(r),indexB:U.ofIntArray(i),order:U.ofConst(1,r.length,U.Schema.int)}}var $U;(function(e){function t(e){return e?.kind===`top`}e.is=t;function n(e){return{kind:`top`,name:e.system||`TOP`,data:e}}e.fromTop=n})($U||={});function dLe(e){return hb.create(`Parse TOP`,async t=>{let n=$U.fromTop(e),r=lLe(e),i=uLe(e);return QI.create(e.system||`TOP`,r,i,n)})}function eW(e){return{pairs:[{loci:[e[0].loci,e[1].loci]}]}}function tW(e){return{triples:[{loci:[e[0].loci,e[1].loci,e[2].loci]}]}}function nW(e){return{quads:[{loci:[e[0].loci,e[1].loci,e[2].loci,e[3].loci]}]}}function rW(e){return{infos:[{loci:e[0].loci}]}}function iW(e){return{locis:e.map(e=>e.loci)}}function aW(e){return{locis:e.map(e=>e.loci)}}var oW={center:B(),rotation:z(),translationToCenter:z(),translationFromCenter:z(),translation:z(),local:z()};function sW(e){return e.name===`components`&&e.params.rotationCenter?.name===`centroid`}function cW(e,t){if(e.name===`matrix`){let t=z();return z.copy(t,e.params.data),e.params.transpose&&z.transpose(t,t),t}else{e.params.rotationCenter?.name===`centroid`?B.copy(oW.center,t):e.params.rotationCenter?.name===`point`?B.copy(oW.center,e.params.rotationCenter.params.point):B.set(oW.center,0,0,0),z.fromTranslation(oW.translationToCenter,oW.center),z.fromRotation(oW.rotation,e.params.angle*Math.PI/180,e.params.axis),z.fromTranslation(oW.translationFromCenter,B.negate(oW.center,oW.center));let n=z.mul3(z(),oW.translationToCenter,oW.rotation,oW.translationFromCenter);return z.fromTranslation(oW.translation,e.params.translation),z.mul(n,oW.translation,n),n}}const lW=V.MappedStatic(`matrix`,{matrix:V.Group({data:V.Mat4(z.identity()),transpose:V.Boolean(!1)},{isFlat:!0}),components:V.Group({translation:V.Vec3(B.create(0,0,0)),axis:V.Vec3(B.create(1,0,0)),angle:V.Numeric(0,{min:-360,max:360,step:1},{description:`Angle in Degrees`}),rotationCenter:V.MappedStatic(`point`,{point:V.Group({point:V.Vec3(B.create(0,0,0))},{isFlat:!0}),centroid:V.Group({})})},{isFlat:!0})},{label:`Kind`});var fLe=s({CoordinatesFromDcd:()=>pLe,CoordinatesFromLammpstraj:()=>_Le,CoordinatesFromNctraj:()=>gLe,CoordinatesFromTrr:()=>hLe,CoordinatesFromXtc:()=>mLe,CustomModelProperties:()=>hW,CustomStructureProperties:()=>_W,ModelFromTrajectory:()=>pW,ModelWithCoordinates:()=>zLe,MultiStructureSelectionFromBundle:()=>HLe,MultiStructureSelectionFromExpression:()=>VLe,ShapeFromPly:()=>JLe,StructureComplexElement:()=>KLe,StructureComplexElementTypes:()=>mW,StructureComponent:()=>qLe,StructureFromModel:()=>ILe,StructureFromTrajectory:()=>FLe,StructureInstances:()=>RLe,StructureSelectionFromBundle:()=>WLe,StructureSelectionFromExpression:()=>BLe,StructureSelectionFromScript:()=>ULe,TopologyFromPrmtop:()=>yLe,TopologyFromPsf:()=>vLe,TopologyFromTop:()=>bLe,TrajectoryFromBlob:()=>xLe,TrajectoryFromCifCore:()=>MLe,TrajectoryFromCube:()=>jLe,TrajectoryFromGRO:()=>wLe,TrajectoryFromLammpsData:()=>ELe,TrajectoryFromLammpsTrajData:()=>DLe,TrajectoryFromMOL:()=>OLe,TrajectoryFromMOL2:()=>ALe,TrajectoryFromMmCif:()=>SLe,TrajectoryFromModelAndCoordinates:()=>dW,TrajectoryFromPDB:()=>CLe,TrajectoryFromSDF:()=>kLe,TrajectoryFromXYZ:()=>TLe,TransformStructureConformation:()=>LLe,getTrajectory:()=>uW}),pLe=AD.BuiltIn({name:`coordinates-from-dcd`,display:{name:`Parse DCD`,description:`Parse DCD binary data.`},from:[H.Data.Binary],to:H.Molecule.Coordinates})({apply({a:e}){return hb.create(`Parse DCD`,async t=>{let n=await $ve(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await PEe(n.result).runInContext(t);return new H.Molecule.Coordinates(r,{label:e.label,description:`Coordinates`})})}}),mLe=AD.BuiltIn({name:`coordinates-from-xtc`,display:{name:`Parse XTC`,description:`Parse XTC binary data.`},from:[H.Data.Binary],to:H.Molecule.Coordinates})({apply({a:e}){return hb.create(`Parse XTC`,async t=>{let n=await lIe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await uIe(n.result).runInContext(t);return new H.Molecule.Coordinates(r,{label:e.label,description:`Coordinates`})})}}),hLe=AD.BuiltIn({name:`coordinates-from-trr`,display:{name:`Parse TRR`,description:`Parse TRR binary data.`},from:[H.Data.Binary],to:H.Molecule.Coordinates})({apply({a:e}){return hb.create(`Parse TRR`,async t=>{let n=await WIe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await GIe(n.result).runInContext(t);return new H.Molecule.Coordinates(r,{label:e.label,description:`Coordinates`})})}}),gLe=AD.BuiltIn({name:`coordinates-from-nctraj`,display:{name:`Parse NCTRAJ`,description:`Parse NCTRAJ binary data.`},from:[H.Data.Binary],to:H.Molecule.Coordinates})({apply({a:e}){return hb.create(`Parse NCTRAJ`,async t=>{let n=await aLe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await oLe(n.result).runInContext(t);return new H.Molecule.Coordinates(r,{label:e.label,description:`Coordinates`})})}}),_Le=AD.BuiltIn({name:`coordinates-from-lammpstraj`,display:{name:`Parse LAMMPSTRAJ`,description:`Parse LAMMPSTRAJ data.`},from:[H.Data.String],to:H.Molecule.Coordinates})({apply({a:e}){return hb.create(`Parse LAMMPSTRAJ`,async t=>{let n=await NU(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await PU(n.result).runInContext(t);return new H.Molecule.Coordinates(r,{label:e.label,description:`Coordinates`})})}}),vLe=AD.BuiltIn({name:`topology-from-psf`,display:{name:`PSF Topology`,description:`Create topology from PSF.`},from:[H.Format.Psf],to:H.Molecule.Topology})({apply({a:e}){return hb.create(`Create Topology`,async t=>{let n=await nPe(e.data).runInContext(t);return new H.Molecule.Topology(n,{label:n.label||e.label,description:`Topology`})})}}),yLe=AD.BuiltIn({name:`topology-from-prmtop`,display:{name:`PRMTOP Topology`,description:`Create topology from PRMTOP.`},from:[H.Format.Prmtop],to:H.Molecule.Topology})({apply({a:e}){return hb.create(`Create Topology`,async t=>{let n=await cLe(e.data).runInContext(t);return new H.Molecule.Topology(n,{label:n.label||e.label,description:`Topology`})})}}),bLe=AD.BuiltIn({name:`topology-from-top`,display:{name:`TOP Topology`,description:`Create topology from TOP.`},from:[H.Format.Top],to:H.Molecule.Topology})({apply({a:e}){return hb.create(`Create Topology`,async t=>{let n=await dLe(e.data).runInContext(t);return new H.Molecule.Topology(n,{label:n.label||e.label,description:`Topology`})})}});async function uW(e,t,n){if(t.type===H.Molecule.Topology.type){let r=t.data;return await DB.trajectoryFromTopologyAndCoordinates(r,n).runInContext(e)}else if(t.type===H.Molecule.Model.type){let e=t.data;return DB.trajectoryFromModelAndCoordinates(e,n)}throw Error(`no model/topology found`)}var dW=AD.BuiltIn({name:`trajectory-from-model-and-coordinates`,display:{name:`Trajectory from Topology & Coordinates`,description:`Create a trajectory from existing model/topology and coordinates.`},from:H.Root,to:H.Molecule.Trajectory,params:{modelRef:V.Text(``,{isHidden:!0}),coordinatesRef:V.Text(``,{isHidden:!0})}})({apply({params:e,dependencies:t}){return hb.create(`Create trajectory from model/topology and coordinates`,async n=>{let r=t[e.coordinatesRef].data,i=await uW(n,t[e.modelRef],r),a={label:`Trajectory`,description:`${i.frameCount} model${i.frameCount===1?``:`s`}`};return new H.Molecule.Trajectory(i,a)})}}),xLe=AD.BuiltIn({name:`trajectory-from-blob`,display:{name:`Parse Blob`,description:`Parse format blob into a single trajectory.`},from:H.Format.Blob,to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse Format Blob`,async t=>{let n=[];for(let r of e.data){if(r.kind!==`cif`)continue;let e=r.data.blocks[0],i=await wB(e).runInContext(t);if(i.frameCount===0)throw Error(`No models found.`);for(let e=0;e<i.frameCount;e++){let r=await hb.resolveInContext(i.getFrameAtIndex(e),t);n.push(r)}}for(let e=0;e<n.length;e++)DB.TrajectoryInfo.set(n[e],{index:e,size:n.length});let r={label:`Trajectory`,description:`${n.length} model${n.length===1?``:`s`}`};return new H.Molecule.Trajectory(new vB(n),r)})}});function fW(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${e.frameCount===1?``:`s`}`}}var SLe=AD.BuiltIn({name:`trajectory-from-mmcif`,display:{name:`Trajectory from mmCIF`,description:`Identify and create all separate models in the specified CIF data block`},from:H.Format.Cif,to:H.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:V.Optional(V.Boolean(!1,{description:`If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory.`})),blockHeader:V.Optional(V.Text(void 0,{description:`Header of the block to parse. If not specifed, Block Index parameter applies.`,hideIf:e=>e.loadAllBlocks===!0})),blockIndex:V.Optional(V.Numeric(0,{min:0,step:1},{description:`Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.`,hideIf:e=>e.loadAllBlocks===!0||e.blockHeader}))};let{blocks:t}=e.data,n=t.map(e=>[e.header,e.header]);return n.push([``,`[Use Block Index]`]),{loadAllBlocks:V.Optional(V.Boolean(!1,{description:`If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory.`})),blockHeader:V.Optional(V.Select(t[0]&&t[0].header,n,{description:`Header of the block to parse. If not specifed, Block Index parameter applies.`,hideIf:e=>e.loadAllBlocks===!0})),blockIndex:V.Optional(V.Numeric(0,{min:0,step:1,max:t.length-1},{description:`Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.`,hideIf:e=>e.loadAllBlocks===!0||e.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return hb.create(`Parse mmCIF`,async n=>{let r;if(t.loadAllBlocks){let t=[];for(let r of e.data.blocks){n.shouldUpdate&&await n.update(`Parsing ${r.header}...`);let e=await wB(r).runInContext(n);for(let r=0;r<e.frameCount;r++)t.push(await hb.resolveInContext(e.getFrameAtIndex(r),n))}r=new vB(t)}else{let i=t.blockHeader||e.data.blocks[t.blockIndex??0].header,a=e.data.blocks.find(e=>e.header===i);if(!a)throw Error(`Data block '${[i]}' not found.`);r=a.categoryNames.includes(`chem_comp_atom`)&&!a.categoryNames.includes(`atom_site`)&&!a.categoryNames.includes(`ihm_sphere_obj_site`)&&!a.categoryNames.includes(`ihm_gaussian_obj_site`)?await XMe(a).runInContext(n):await wB(a,e.data).runInContext(n)}if(r.frameCount===0)throw Error(`No models found.`);let i=fW(r);return new H.Molecule.Trajectory(r,i)})}}),CLe=AD.BuiltIn({name:`trajectory-from-pdb`,display:{name:`Parse PDB`,description:`Parse PDB string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory,params:{isPdbqt:V.Boolean(!1)}})({apply({a:e,params:t}){return hb.create(`Parse PDB`,async n=>{let r=await uye(e.data,e.label,t.isPdbqt).runInContext(n);if(r.isError)throw Error(r.message);let i=await ePe(r.result).runInContext(n),a=fW(i);return new H.Molecule.Trajectory(i,a)})}}),wLe=AD.BuiltIn({name:`trajectory-from-gro`,display:{name:`Parse GRO`,description:`Parse GRO string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse GRO`,async t=>{let n=await lye(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await PNe(n.result).runInContext(t),i=fW(r);return new H.Molecule.Trajectory(r,i)})}}),TLe=AD.BuiltIn({name:`trajectory-from-xyz`,display:{name:`Parse XYZ`,description:`Parse XYZ string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse XYZ`,async t=>{let n=await pIe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await hIe(n.result).runInContext(t),i=fW(r);return new H.Molecule.Trajectory(r,i)})}}),ELe=AD.BuiltIn({name:`trajectory-from-lammps-data`,display:{name:`Parse Lammps Data`,description:`Parse Lammps Data from string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory,params:{unitsStyle:V.Select(`real`,V.arrayToOptions(wU))}})({apply({a:e,params:t}){return hb.create(`Parse Lammps Data`,async n=>{let r=await SIe(e.data).runInContext(n);if(r.isError)throw Error(r.message);let i=await wIe(r.result,t.unitsStyle).runInContext(n),a=fW(i);return new H.Molecule.Trajectory(i,a)})}}),DLe=AD.BuiltIn({name:`trajectory-from-lammps-traj-data`,display:{name:`Parse Lammps traj Data`,description:`Parse Lammps Traj Data string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory,params:{unitsStyle:V.Select(`real`,V.arrayToOptions(wU))}})({apply({a:e,params:t}){return hb.create(`Parse Lammps Data`,async n=>{let r=await NU(e.data).runInContext(n);if(r.isError)throw Error(r.message);let i=await MIe(r.result,t.unitsStyle).runInContext(n),a=fW(i);return new H.Molecule.Trajectory(i,a)})}}),OLe=AD.BuiltIn({name:`trajectory-from-mol`,display:{name:`Parse MOL`,description:`Parse MOL string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse MOL`,async t=>{let n=await LFe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=await RFe(n.result).runInContext(t),i=fW(r);return new H.Molecule.Trajectory(r,i)})}}),kLe=AD.BuiltIn({name:`trajectory-from-sdf`,display:{name:`Parse SDF`,description:`Parse SDF string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse SDF`,async t=>{let n=await VIe(e.data).runInContext(t);if(n.isError)throw Error(n.message);let r=[];for(let e of n.result.compounds){let n=await HIe(e).runInContext(t);for(let e=0;e<n.frameCount;e++)r.push(await hb.resolveInContext(n.getFrameAtIndex(e),t))}let i=new vB(r),a=fW(i);return new H.Molecule.Trajectory(i,a)})}}),ALe=AD.BuiltIn({name:`trajectory-from-mol2`,display:{name:`Parse MOL2`,description:`Parse MOL2 string and create trajectory.`},from:[H.Data.String],to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse MOL2`,async t=>{let n=await rIe(e.data,e.label).runInContext(t);if(n.isError)throw Error(n.message);let r=await oIe(n.result).runInContext(t),i=fW(r);return new H.Molecule.Trajectory(r,i)})}}),jLe=AD.BuiltIn({name:`trajectory-from-cube`,display:{name:`Parse Cube`,description:`Parse Cube file to create a trajectory.`},from:H.Format.Cube,to:H.Molecule.Trajectory})({apply({a:e}){return hb.create(`Parse MOL`,async t=>{let n=await KFe(e.data).runInContext(t),r=fW(n);return new H.Molecule.Trajectory(n,r)})}}),MLe=AD.BuiltIn({name:`trajectory-from-cif-core`,display:{name:`Parse CIF Core`,description:`Identify and create all separate models in the specified CIF data block`},from:H.Format.Cif,to:H.Molecule.Trajectory,params(e){if(!e)return{blockHeader:V.Optional(V.Text(void 0,{description:`Header of the block to parse. If none is specifed, the 1st data block in the file is used.`}))};let{blocks:t}=e.data;return{blockHeader:V.Optional(V.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:`Header of the block to parse`}))}}})({apply({a:e,params:t}){return hb.create(`Parse CIF Core`,async n=>{let r=t.blockHeader||e.data.blocks[0].header,i=e.data.blocks.find(e=>e.header===r);if(!i)throw Error(`Data block '${[r]}' not found.`);let a=await WFe(i).runInContext(n);if(a.frameCount===0)throw Error(`No models found.`);let o=fW(a);return new H.Molecule.Trajectory(a,o)})}}),NLe=e=>e+1,PLe=e=>e-1,pW=AD.BuiltIn({name:`model-from-trajectory`,display:{name:`Molecular Model`,description:`Create a molecular model from specified index in a trajectory.`},from:H.Molecule.Trajectory,to:H.Molecule.Model,params:e=>e?{modelIndex:V.Converted(NLe,PLe,V.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:`Model Index`,immediateUpdate:!0}))}:{modelIndex:V.Numeric(0,{},{description:`Zero-based index of the model`,immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply({a:e,params:t}){return hb.create(`Model from Trajectory`,async n=>{let r=Math.round(t.modelIndex)%e.data.frameCount;r<0&&(r+=e.data.frameCount);let i=await hb.resolveInContext(e.data.getFrameAtIndex(r),n),a=`Model ${r+1}`,o=e.data.frameCount===1?void 0:`of ${e.data.frameCount}`;return new H.Molecule.Model(i,{label:a,description:o})})},interpolate(e,t,n){return{modelIndex:n>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*n)}},dispose({b:e}){e?.data.customProperties.dispose()}}),FLe=AD.BuiltIn({name:`structure-from-trajectory`,display:{name:`Structure from Trajectory`,description:`Create a molecular structure from a trajectory.`},from:H.Molecule.Trajectory,to:H.Molecule.Structure})({apply({a:e}){return hb.create(`Build Structure`,async t=>{let n=await nB.ofTrajectory(e.data,t),r={label:`Ensemble`,description:nB.elementDescription(n)};return new H.Molecule.Structure(n,r)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),ILe=AD.BuiltIn({name:`structure-from-model`,display:{name:`Structure`,description:`Create a molecular structure (model, assembly, or symmetry) from the specified model.`},from:H.Molecule.Model,to:H.Molecule.Structure,params(e){return WH.getParams(e&&e.data)}})({canAutoUpdate({oldParams:e,newParams:t}){return WH.canAutoUpdate(e.type,t.type)},apply({a:e,params:t},n){return hb.create(`Build Structure`,async r=>WH.create(n,r,e.data,t&&t.type))},update:({a:e,b:t,oldParams:n,newParams:r})=>Tx(n,r)?t.data.model===e.data?lE.UpdateResult.Unchanged:DB.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),lE.UpdateResult.Updated):lE.UpdateResult.Recreate:lE.UpdateResult.Recreate,dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),LLe=AD.BuiltIn({name:`transform-structure-conformation`,display:{name:`Transform Conformation`},isDecorator:!0,from:H.Molecule.Structure,to:H.Molecule.Structure,params:{transform:lW}})({canAutoUpdate({newParams:e}){return e.transform.name!==`matrix`},apply({a:e,params:t}){let n=sW(t.transform)?e.data.boundary.sphere.center:B.unit,r=cW(t.transform,n),i=nB.transform(e.data,r);return new H.Molecule.Structure(i,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),RLe=AD.BuiltIn({name:`structure-instances`,display:{name:`Structure Instances`},isDecorator:!0,from:H.Molecule.Structure,to:H.Molecule.Structure,params:{transforms:V.ObjectList({transform:lW},()=>`Transform`)}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=t.transforms.some(e=>sW(e.transform))?e.data.boundary.sphere.center:B.unit,r=t.transforms.map(e=>cW(e.transform,n));if(!r.length)return e;let i=nB.instances(e.data,r);return new H.Molecule.Structure(i,{label:e.label,description:`${e.description} [Instanced]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),zLe=AD.BuiltIn({name:`model-with-coordinates`,display:{name:`Model With Coordinates`,description:`Updates the current model with provided coordinate frame`},from:H.Molecule.Model,to:H.Molecule.Model,params:{frameIndex:V.Optional(V.Numeric(0,void 0,{isHidden:!0})),frameCount:V.Optional(V.Numeric(1,void 0,{isHidden:!0})),atomicCoordinateFrame:V.Optional(V.Value(void 0,{isHidden:!0}))},isDecorator:!0})({apply({a:e,params:t}){if(!t.atomicCoordinateFrame)return e;let n={...e.data,atomicConformation:DB.getAtomicConformationFromFrame(e.data,t.atomicCoordinateFrame)};return DB.TrajectoryInfo.set(n,{index:t.frameIndex??0,size:t.frameCount??1}),new H.Molecule.Model(n,{label:e.label,description:e.description})},update:({a:e,b:t,oldParams:n,newParams:r})=>n.atomicCoordinateFrame===r.atomicCoordinateFrame?lE.UpdateResult.Unchanged:(r.atomicCoordinateFrame?t.data={...t.data,atomicConformation:DB.getAtomicConformationFromFrame(t.data,r.atomicCoordinateFrame)}:t.data=e.data,DB.TrajectoryInfo.set(t.data,{index:r.frameIndex??0,size:r.frameCount??1}),lE.UpdateResult.Updated)}),BLe=AD.BuiltIn({name:`structure-selection-from-expression`,display:{name:`Selection`,description:`Create a molecular structure from the specified expression.`},from:H.Molecule.Structure,to:H.Molecule.Structure,params:()=>({expression:V.Value(Z.struct.generator.all,{isHidden:!0}),label:V.Optional(V.Text(``,{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){let{selection:r,entry:i}=GH.createAndRun(e.data,t.expression);if(n.entry=i,VR.isEmpty(r))return Mx.Null;let a=VR.unionStructure(r),o={label:`${t.label||`Selection`}`,description:nB.elementDescription(a)};return new H.Molecule.Structure(a,o)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(n.expression!==r.expression)return lE.UpdateResult.Recreate;let a=i.entry;if(a.currentStructure===e.data)return lE.UpdateResult.Unchanged;let o=GH.updateStructure(a,e.data);return VR.isEmpty(o)?lE.UpdateResult.Null:(GH.updateStructureObject(t,o,r.label),lE.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),VLe=AD.BuiltIn({name:`structure-multi-selection-from-expression`,display:{name:`Multi-structure Measurement Selection`,description:`Create selection object from multiple structures.`},from:H.Root,to:H.Molecule.Structure.Selections,params:()=>({selections:V.ObjectList({key:V.Text(void 0,{description:`A unique key.`}),ref:V.Text(),groupId:V.Optional(V.Text()),expression:V.Value(Z.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:V.Optional(V.Boolean(!1,{isHidden:!0,description:`Remap the selections from the original structure if structurally equivalent.`})),label:V.Optional(V.Text(``,{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:n}){let r=new Map,i=[],a=0;for(let t of e.selections){let{selection:e,entry:o}=GH.createAndRun(n[t.ref].data,t.expression);r.set(t.key,o);let s=VR.toLociWithSourceUnits(e);i.push({key:t.key,structureRef:t.ref,loci:s,groupId:t.groupId}),a+=$.size(s)}t.entries=r;let o={label:`${e.label||`Multi-selection`}`,description:`${e.selections.length} source(s), ${a} element(s) total`};return new H.Molecule.Structure.Selections(i,o)},update:({b:e,oldParams:t,newParams:n,cache:r,dependencies:i})=>{if(!!t.isTransitive!=!!n.isTransitive)return lE.UpdateResult.Recreate;let a=r.entries,o=new Map,s=new Map;for(let t of e.data)s.set(t.key,t);let c=!1,l=0,u=[];for(let e of n.selections){let t=i[e.ref].data,r=!1;if(a.has(e.key)){let i=a.get(e.key);if(GH.isUnchanged(i,e.expression,t)&&s.has(e.key)){let t=s.get(e.key);t.groupId!==e.groupId&&(t.groupId=e.groupId,c=!0),o.set(e.key,i),u.push(t),l+=$.size(t.loci);continue}if(i.expression!==e.expression)r=!0;else{let r=!1;if(n.isTransitive)if(nB.areUnitIdsAndIndicesEqual(i.originalStructure,t)){let n=GH.run(i,i.originalStructure);i.currentStructure=t,o.set(e.key,i);let r=$.remap(VR.toLociWithSourceUnits(n),t);u.push({key:e.key,structureRef:e.ref,loci:r,groupId:e.groupId}),l+=$.size(r),c=!0}else r=!0;else r=!0;if(r){c=!0;let n=GH.updateStructure(i,t);o.set(e.key,i);let r=VR.toLociWithSourceUnits(n);u.push({key:e.key,structureRef:e.ref,loci:r,groupId:e.groupId}),l+=$.size(r)}}}else r=!0;if(r){c=!0;let{selection:n,entry:r}=GH.createAndRun(t,e.expression);o.set(e.key,r);let i=VR.toLociWithSourceUnits(n);u.push({key:e.key,structureRef:e.ref,loci:i,groupId:e.groupId}),l+=$.size(i)}}return c?(r.entries=o,e.data=u,e.label=`${n.label||`Multi-selection`}`,e.description=`${u.length} source(s), ${l} element(s) total`,lE.UpdateResult.Updated):lE.UpdateResult.Unchanged}}),HLe=AD.BuiltIn({name:`structure-multi-selection-from-bundle`,display:{name:`Multi-structure Measurement Selection`,description:`Create selection object from multiple structures.`},from:H.Root,to:H.Molecule.Structure.Selections,params:()=>({selections:V.ObjectList({key:V.Text(void 0,{description:`A unique key.`}),ref:V.Text(),groupId:V.Optional(V.Text()),bundle:V.Value(qR.Empty)},e=>e.ref,{isHidden:!0}),isTransitive:V.Optional(V.Boolean(!1,{isHidden:!0,description:`Remap the selections from the original structure if structurally equivalent.`})),label:V.Optional(V.Text(``,{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:n}){let r=new Map,i=[],a=0;for(let t of e.selections){let e=n[t.ref].data,o=qR.toLoci(t.bundle,e);i.push({key:t.key,structureRef:t.ref,loci:o,groupId:t.groupId}),a+=$.size(o),r.set(t.key,{source:e})}t.entries=r;let o={label:`${e.label||`Multi-selection`}`,description:`${e.selections.length} source(s), ${a} element(s) total`};return new H.Molecule.Structure.Selections(i,o)},update:({b:e,oldParams:t,newParams:n,cache:r,dependencies:i})=>{if(!!t.isTransitive!=!!n.isTransitive)return lE.UpdateResult.Recreate;let a=r.entries,o=new Map,s=new Map;for(let e of t.selections)s.set(e.key,e.bundle);let c=new Map;for(let t of e.data)c.set(t.key,t);let l=!1,u=0,d=[];for(let e of n.selections){let t=!1;if(a.has(e.key)){let n=i[e.ref].data,r=a.get(e.key),f=s.get(e.key);if(f&&n===r.source&&e.bundle.hash===r.source.hashCode&&qR.areEqual(e.bundle,f)){let t=c.get(e.key);t.groupId!==e.groupId&&(t.groupId=e.groupId,l=!0),o.set(e.key,r),d.push(t),u+=$.size(t.loci);continue}t=!0}else t=!0;if(t){l=!0;let t=i[e.ref].data,n=qR.toLoci(e.bundle,t);d.push({key:e.key,structureRef:e.ref,loci:n,groupId:e.groupId}),u+=$.size(n),o.set(e.key,{source:t})}}return l?(r.entries=o,e.data=d,e.label=`${n.label||`Multi-selection`}`,e.description=`${d.length} source(s), ${u} element(s) total`,lE.UpdateResult.Updated):lE.UpdateResult.Unchanged}}),ULe=AD.BuiltIn({name:`structure-selection-from-script`,display:{name:`Selection`,description:`Create a molecular structure from the specified script.`},from:H.Molecule.Structure,to:H.Molecule.Structure,params:()=>({script:V.Script({language:`mol-script`,expression:`(sel.atom.atom-groups :residue-test (= atom.resname ALA))`}),label:V.Optional(V.Text(``))})})({apply({a:e,params:t,cache:n}){let{selection:r,entry:i}=GH.createAndRun(e.data,t.script);n.entry=i;let a=VR.unionStructure(r),o={label:`${t.label||`Selection`}`,description:nB.elementDescription(a)};return new H.Molecule.Structure(a,o)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!HH.areEqual(n.script,r.script))return lE.UpdateResult.Recreate;let a=i.entry;if(a.currentStructure===e.data)return lE.UpdateResult.Unchanged;let o=GH.updateStructure(a,e.data);return GH.updateStructureObject(t,o,r.label),lE.UpdateResult.Updated},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),WLe=AD.BuiltIn({name:`structure-selection-from-bundle`,display:{name:`Selection`,description:`Create a molecular structure from the specified structure-element bundle.`},from:H.Molecule.Structure,to:H.Molecule.Structure,params:()=>({bundle:V.Value(qR.Empty,{isHidden:!0}),label:V.Optional(V.Text(``,{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){if(t.bundle.hash!==e.data.hashCode)return Mx.Null;n.source=e.data;let r=qR.toStructure(t.bundle,e.data);if(r.elementCount===0)return Mx.Null;let i={label:`${t.label||`Selection`}`,description:nB.elementDescription(r)};return new H.Molecule.Structure(r,i)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!qR.areEqual(n.bundle,r.bundle))return lE.UpdateResult.Recreate;if(r.bundle.hash!==e.data.hashCode)return lE.UpdateResult.Null;if(i.source===e.data)return lE.UpdateResult.Unchanged;i.source=e.data;let a=qR.toStructure(r.bundle,e.data);return a.elementCount===0?lE.UpdateResult.Null:(t.label=`${r.label||`Selection`}`,t.description=nB.elementDescription(a),t.data=a,lE.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});const mW={polymer:`polymer`,protein:`protein`,nucleic:`nucleic`,water:`water`,branched:`branched`,ligand:`ligand`,"non-standard":`non-standard`,coarse:`coarse`,"atomic-sequence":`atomic-sequence`,"atomic-het":`atomic-het`,spheres:`spheres`};var GLe=V.objectToOptions(mW),KLe=AD.BuiltIn({name:`structure-complex-element`,display:{name:`Complex Element`,description:`Create a molecular structure from the specified model.`},from:H.Molecule.Structure,to:H.Molecule.Structure,params:{type:V.Select(`atomic-sequence`,GLe,{isHidden:!0})}})({apply({a:e,params:t}){let n,r;switch(t.type){case`polymer`:n=aU.polymer.query,r=`Polymer`;break;case`protein`:n=aU.protein.query,r=`Protein`;break;case`nucleic`:n=aU.nucleic.query,r=`Nucleic`;break;case`water`:n=Wz.internal.water(),r=`Water`;break;case`branched`:n=aU.branchedPlusConnected.query,r=`Branched`;break;case`ligand`:n=aU.ligandPlusConnected.query,r=`Ligand`;break;case`non-standard`:n=aU.nonStandardPolymer.query,r=`Non-standard`;break;case`coarse`:n=aU.coarse.query,r=`Coarse`;break;case`atomic-sequence`:n=Wz.internal.atomicSequence(),r=`Sequence`;break;case`atomic-het`:n=Wz.internal.atomicHet(),r=`HET Groups/Ligands`;break;case`spheres`:n=Wz.internal.spheres(),r=`Coarse Spheres`;break;default:Lb(t.type)}let i=n(new ZR(e.data)),a=VR.unionStructure(i);return a.elementCount===0?Mx.Null:new H.Molecule.Structure(a,{label:r,description:nB.elementDescription(a)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),qLe=AD.BuiltIn({name:`structure-component`,display:{name:`Component`,description:`A molecular structure component.`},from:H.Molecule.Structure,to:H.Molecule.Structure,params:AFe})({apply({a:e,params:t,cache:n}){return jFe(e.data,t,n)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>MFe(e.data,t,n,r,i),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),hW=AD.BuiltIn({name:`custom-model-properties`,display:{name:`Custom Model Properties`},isDecorator:!0,from:H.Molecule.Model,to:H.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data)})({apply({a:e,params:t},n){return hb.create(`Custom Props`,async r=>(await gW(e.data,n,r,t),new H.Molecule.Model(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Custom Props`,async a=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let t of n.autoAttach){let n=i.customModelProperties.get(t);n&&e.data.customProperties.reference(n.descriptor,!1)}return await gW(e.data,i,a,r),lE.UpdateResult.Updated})},dispose({b:e}){e?.data.customProperties.dispose()}});async function gW(e,t,n,r){let i={runtime:n,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:a,properties:o}=r;for(let n of Object.keys(o)){let r=t.customModelProperties.get(n),s=o[n];if(a.includes(n)||r.isHidden)try{await r.attach(i,e,s,!0)}catch(e){t.log.warn(`Error attaching model prop '${n}': ${e}`)}else r.set(e,s)}}var _W=AD.BuiltIn({name:`custom-structure-properties`,display:{name:`Custom Structure Properties`},isDecorator:!0,from:H.Molecule.Structure,to:H.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data.root)})({apply({a:e,params:t},n){return hb.create(`Custom Props`,async r=>(await vW(e.data.root,n,r,t),new H.Molecule.Structure(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:n,newParams:r},i){return e.data===t.data?hb.create(`Custom Props`,async a=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let t of n.autoAttach){let n=i.customStructureProperties.get(t);n&&e.data.customPropertyDescriptors.reference(n.descriptor,!1)}return await vW(e.data.root,i,a,r),lE.UpdateResult.Updated}):lE.UpdateResult.Recreate},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});async function vW(e,t,n,r){let i={runtime:n,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:a,properties:o}=r;for(let n of Object.keys(o)){let r=t.customStructureProperties.get(n),s=o[n];if(a.includes(n)||r.isHidden)try{await r.attach(i,e,s,!0)}catch(e){t.log.warn(`Error attaching structure prop '${n}': ${e}`)}else r.set(e,s)}}var JLe=AD.BuiltIn({name:`shape-from-ply`,display:{name:`Shape from PLY`,description:`Create Shape from PLY data`},from:H.Format.Ply,to:H.Shape.Provider,params(e){return{transforms:V.Optional(V.Value([],{isHidden:!0})),label:V.Optional(V.Text(``,{isHidden:!0}))}}})({apply({a:e,params:t}){return hb.create(`Create shape from PLY`,async n=>{let r=await MEe(e.data,t).runInContext(n),i={label:t.label||`Shape`};return new H.Shape.Provider(r,i)})}});function YLe(e){return e.originX===0&&e.originY===0&&e.originZ===0?B.create(e.NCSTART,e.NRSTART,e.NSSTART):B.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function XLe(e){let t=the(e);switch(t){case PD.Float32:return Float32Array;case PD.Int8:return Int8Array;case PD.Int16:return Int16Array;case PD.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}function ZLe(e,t){return hb.create(`Create Volume`,async n=>{let{header:r,values:i}=e,a=B.create(r.xLength,r.yLength,r.zLength);t&&t.voxelSize&&B.mul(a,a,t.voxelSize);let o=B.create(FT(r.alpha),FT(r.beta),FT(r.gamma)),s=r.ISPG>65536?0:r.ISPG,c=oA.create(s||`P 1`,a,o),l=B.create(r.MAPC-1,r.MAPR-1,r.MAPS-1),u=BD.convertToCanonicalAxisIndicesFastToSlow(l),d=[r.NX,r.NY,r.NZ],f=u([r.NC,r.NR,r.NS]),p=YLe(r);t?.offset&&B.add(p,p,t.offset);let m=u(p),h=B.create(m[0]/d[0],m[1]/d[1],m[2]/d[2]),g=B.create(f[0]/d[0],f[1]/d[1],f[2]/d[2]),_=BD.Space(f,BD.invertAxisOrder(l),XLe(r)),v=BD.create(_,BD.Data1(i)),y=r.AMIN===0&&r.AMAX===0&&r.AMEAN===0&&r.ARMS===0,b={transform:{kind:`spacegroup`,cell:c,fractionalBox:$k.create(h,B.add(B(),h,g))},cells:v,stats:{min:Number.isNaN(r.AMIN)||y?xE(i):r.AMIN,max:Number.isNaN(r.AMAX)||y?bE(i):r.AMAX,mean:Number.isNaN(r.AMEAN)||y?CE(i):r.AMEAN,sigma:Number.isNaN(r.ARMS)||r.ARMS===0?wE(i):r.ARMS}};return{label:t?.label,entryId:t?.entryId,periodicity:B.isInteger(g)?`xyz`:`none`,grid:b,instances:[{transform:z.identity()}],sourceData:yW.create(e),customProperties:new FP,_propertyData:Object.create(null)}})}var yW;(function(e){function t(e){return e?.kind===`ccp4`}e.is=t;function n(e){return{kind:`ccp4`,name:e.name,data:e}}e.create=n})(yW||={});function QLe(e,t){return hb.create(`Create Volume`,async n=>{let{header:r,values:i}=e,a=B.create(r.xlen,r.ylen,r.zlen);t&&t.voxelSize&&B.mul(a,a,t.voxelSize);let o=B.create(FT(r.alpha),FT(r.beta),FT(r.gamma)),s=oA.create(`P 1`,a,o),c=[r.xRate,r.yRate,r.zRate],l=[r.xExtent,r.yExtent,r.zExtent],u=[r.xStart,r.yStart,r.zStart],d=B.create(u[0]/c[0],u[1]/c[1],u[2]/c[2]),f=B.create(l[0]/c[0],l[1]/c[1],l[2]/c[2]),p=BD.Space(l,[0,1,2],Float32Array),m=BD.create(p,BD.Data1(i));return{label:t?.label,entryId:t?.entryId,periodicity:B.isInteger(f)?`xyz`:`none`,grid:{transform:{kind:`spacegroup`,cell:s,fractionalBox:$k.create(d,B.add(B.zero(),d,f))},cells:m,stats:{min:xE(i),max:bE(i),mean:CE(i),sigma:r.sigma===void 0?wE(i):r.sigma}},instances:[{transform:z.identity()}],sourceData:bW.create(e),customProperties:new FP,_propertyData:Object.create(null)}})}var bW;(function(e){function t(e){return e?.kind===`dsn6`}e.is=t;function n(e){return{kind:`dsn6`,name:e.name,data:e}}e.create=n})(bW||={});function $Le(e,t){return hb.create(`Create Volume`,async()=>{let{header:n,values:r}=e,i=BD.Space(n.dim,[0,1,2],Float64Array),a=BD.create(i,BD.Data1(r)),o=z.fromTranslation(z(),n.min),s=z.fromScaling(z(),n.h);return z.mul(o,o,s),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:`matrix`,matrix:o},cells:a,stats:{min:xE(r),max:bE(r),mean:CE(r),sigma:wE(r)}},instances:[{transform:z.identity()}],sourceData:xW.create(e),customProperties:new FP,_propertyData:Object.create(null)}})}var xW;(function(e){function t(e){return e?.kind===`dx`}e.is=t;function n(e){return{kind:`dx`,name:e.name,data:e}}e.create=n})(xW||={});function eRe(e,t){return hb.create(`Create Segmentation Volume`,async n=>{let{volume_data_3d_info:r,segmentation_data_3d:i}=e,a=oA.create(r.spacegroup_number.value(0)||`P 1`,B.ofArray(r.spacegroup_cell_size.value(0)),B.scale(B(),B.ofArray(r.spacegroup_cell_angles.value(0)),Math.PI/180)),o=r.axis_order.value(0),s=BD.convertToCanonicalAxisIndicesFastToSlow(o),c=s(r.sample_count.value(0)),l=BD.Space(c,BD.invertAxisOrder(o),Float32Array),u=BD.create(l,BD.Data1(i.values.toArray({array:Float32Array}))),d=B.ofArray(s(r.origin.value(0))),f=B.ofArray(s(r.dimensions.value(0))),p={label:t?.label,entryId:void 0,grid:{transform:{kind:`spacegroup`,cell:a,fractionalBox:$k.create(d,B.add(B(),d,f))},cells:u,stats:{min:0,max:1,mean:0,sigma:1}},instances:[{transform:z.identity()}],sourceData:SW.create(e),customProperties:new FP,_propertyData:{ownerId:t?.ownerId}};zP.PickingGranularity.set(p,`object`);let m=new Map,h=new Map,{segment_id:g,set_id:_}=e.segmentation_data_table;for(let e=0,t=g.rowCount;e<t;++e){let t=g.value(e),n=_.value(e);n===0||t===0||(h.has(n)||h.set(n,new Set),h.get(n).add(t))}h.forEach((e,t)=>{e.forEach(e=>{m.has(e)||m.set(e,new Set),m.get(e).add(t)})});let v=[0,0,0],y=u.space.getCoords,b=u.data,[x,S,C]=p.grid.cells.space.dimensions,w=x-1,T=S-1,E=C-1,D={};h.forEach((e,t)=>{D[t]=[w,T,E,-1,-1,-1]});for(let e=0,t=b.length;e<t;++e){let t=b[e];if(t===0)continue;y(e,v);let n=D[t];v[0]<n[0]&&(n[0]=v[0]),v[1]<n[1]&&(n[1]=v[1]),v[2]<n[2]&&(n[2]=v[2]),v[0]>n[3]&&(n[3]=v[0]),v[1]>n[4]&&(n[4]=v[1]),v[2]>n[5]&&(n[5]=v[2])}let O={};return m.forEach((e,t)=>{O[t]=$k.create(B.create(w,T,E),B.create(-1,-1,-1))}),WT(D,(e,t)=>{h.get(parseInt(t)).forEach(t=>{let n=O[t];e[0]<n.min[0]&&(n.min[0]=e[0]),e[1]<n.min[1]&&(n.min[1]=e[1]),e[2]<n.min[2]&&(n.min[2]=e[2]),e[3]>n.max[0]&&(n.max[0]=e[3]),e[4]>n.max[1]&&(n.max[1]=e[4]),e[5]>n.max[2]&&(n.max[2]=e[5])})}),zP.Segmentation.set(p,{segments:m,sets:h,bounds:O,labels:t?.segmentLabels??{}}),p})}var SW;(function(e){function t(e){return e?.kind===`segcif`}e.is=t;function n(e){return{kind:`segcif`,name:e._name,data:e}}e.create=n})(SW||={});var tRe=s({AssignColorVolume:()=>cRe,VolumeFromCcp4:()=>nRe,VolumeFromCube:()=>iRe,VolumeFromDensityServerCif:()=>oRe,VolumeFromDsn6:()=>rRe,VolumeFromDx:()=>aRe,VolumeFromSegmentationCif:()=>sRe,VolumeInstances:()=>uRe,VolumeTransform:()=>lRe}),nRe=AD.BuiltIn({name:`volume-from-ccp4`,display:{name:`Volume from CCP4/MRC/MAP`,description:`Create Volume from CCP4/MRC/MAP data`},from:H.Format.Ccp4,to:H.Volume.Data,params(e){return{voxelSize:V.Vec3(B.create(1,1,1)),offset:V.Vec3(B.create(0,0,0)),entryId:V.Text(``)}}})({apply({a:e,params:t}){return hb.create(`Create volume from CCP4/MRC/MAP`,async n=>{let r=await ZLe(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||`Volume`,description:`Volume ${e.data.header.NX}\u00D7${e.data.header.NX}\u00D7${e.data.header.NX}`};return new H.Volume.Data(r,i)})},dispose({b:e}){e?.data.customProperties.dispose()}}),rRe=AD.BuiltIn({name:`volume-from-dsn6`,display:{name:`Volume from DSN6/BRIX`,description:`Create Volume from DSN6/BRIX data`},from:H.Format.Dsn6,to:H.Volume.Data,params(e){return{voxelSize:V.Vec3(B.create(1,1,1)),entryId:V.Text(``)}}})({apply({a:e,params:t}){return hb.create(`Create volume from DSN6/BRIX`,async n=>{let r=await QLe(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||`Volume`,description:`Volume ${e.data.header.xExtent}\u00D7${e.data.header.yExtent}\u00D7${e.data.header.zExtent}`};return new H.Volume.Data(r,i)})},dispose({b:e}){e?.data.customProperties.dispose()}}),iRe=AD.BuiltIn({name:`volume-from-cube`,display:{name:`Volume from Cube`,description:`Create Volume from Cube data`},from:H.Format.Cube,to:H.Volume.Data,params(e){return{dataIndex:e?V.Select(0,e.data.header.dataSetIds.map((e,t)=>[t,`${e}`])):V.Numeric(0),entryId:V.Text(``)}}})({apply({a:e,params:t}){return hb.create(`Create volume from Cube`,async n=>{let r=await jTe(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||`Volume`,description:`Volume ${e.data.header.dim[0]}\u00D7${e.data.header.dim[1]}\u00D7${e.data.header.dim[2]}`};return new H.Volume.Data(r,i)})},dispose({b:e}){e?.data.customProperties.dispose()}}),aRe=AD.BuiltIn({name:`volume-from-dx`,display:{name:`Parse DX`,description:`Create volume from DX data.`},from:H.Format.Dx,to:H.Volume.Data})({apply({a:e}){return hb.create(`Parse DX`,async t=>{let n=await $Le(e.data,{label:e.data.name||e.label}).runInContext(t),r={label:n.label||`Volume`,description:`Volume ${e.data.header.dim[0]}\u00D7${e.data.header.dim[1]}\u00D7${e.data.header.dim[2]}`};return new H.Volume.Data(n,r)})},dispose({b:e}){e?.data.customProperties.dispose()}}),oRe=AD.BuiltIn({name:`volume-from-density-server-cif`,display:{name:`Volume from density-server CIF`,description:`Identify and create all separate models in the specified CIF data block`},from:H.Format.Cif,to:H.Volume.Data,params(e){if(!e)return{blockHeader:V.Optional(V.Text(void 0,{description:`Header of the block to parse. If none is specifed, the 1st data block in the file is used.`})),entryId:V.Text(``)};let t=e.data.blocks.slice(1);return{blockHeader:V.Optional(V.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:`Header of the block to parse`})),entryId:V.Text(``)}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return hb.create(`Parse density-server CIF`,async n=>{let r=t.blockHeader||e.data.blocks[1].header,i=e.data.blocks.find(e=>e.header===r);if(!i)throw Error(`Data block '${[r]}' not found.`);let a=dk.schema.densityServer(i),o=await LP(a,{entryId:t.entryId}).runInContext(n),[s,c,l]=o.grid.cells.space.dimensions,u={label:t.entryId??a.volume_data_3d_info.name.value(0),description:`Volume ${s}\u00D7${c}\u00D7${l}`};return new H.Volume.Data(o,u)})},dispose({b:e}){e?.data.customProperties.dispose()}}),sRe=AD.BuiltIn({name:`volume-from-segmentation-cif`,display:{name:`Volume from Segmentation CIF`},from:H.Format.Cif,to:H.Volume.Data,params(e){let t=e?.data.blocks.slice(1);return{blockHeader:t?V.Optional(V.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:`Header of the block to parse`})):V.Optional(V.Text(void 0,{description:`Header of the block to parse. If none is specifed, the 1st data block in the file is used.`})),segmentLabels:V.ObjectList({id:V.Numeric(-1),label:V.Text(``)},e=>`${e.id} = ${e.label}`,{description:`Mapping of segment IDs to segment labels`}),ownerId:V.Text(``,{isHidden:!0,description:`Reference to the object which manages this volume`})}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return hb.create(`Parse segmentation CIF`,async n=>{let r=t.blockHeader||e.data.blocks[1].header,i=e.data.blocks.find(e=>e.header===r);if(!i)throw Error(`Data block '${[r]}' not found.`);let a=dk.schema.segmentation(i),o={};for(let e of t.segmentLabels)o[e.id]=e.label;let s=await eRe(a,{segmentLabels:o,ownerId:t.ownerId}).runInContext(n),[c,l,u]=s.grid.cells.space.dimensions,d={label:a.volume_data_3d_info.name.value(0),description:`Segmentation ${c}\u00D7${l}\u00D7${u}`};return new H.Volume.Data(s,d)})},dispose({b:e}){e?.data.customProperties.dispose()}}),cRe=AD.BuiltIn({name:`assign-color-volume`,display:{name:`Assign Color Volume`,description:`Assigns another volume to be available for coloring.`},from:H.Volume.Data,to:H.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:V.Text()};let n=t.state.data.select(FE.Generators.root.subtree().ofType(H.Volume.Data).filter(t=>!!t.obj&&!t.obj?.data.colorVolume&&t.obj!==e));return n.length===0?{ref:V.Text(``,{isHidden:!0})}:{ref:V.Select(n[0].transform.ref,n.map(e=>[e.transform.ref,e.obj.label]))}}})({apply({a:e,params:t,dependencies:n}){return hb.create(`Assign Color Volume`,async r=>{if(!n||!n[t.ref])throw Error(`Dependency not available.`);let i=n[t.ref].data,a={...e.data,colorVolume:i},o={label:e.label,description:`Volume + Colors`};return new H.Volume.Data(a,o)})}});const lRe=AD.BuiltIn({name:`volume-transform`,display:{name:`Transform Volume`},isDecorator:!0,from:H.Volume.Data,to:H.Volume.Data,params:{transform:lW}})({canAutoUpdate(){return!1},apply({a:e,params:t}){let n=sW(t.transform)?NP.getBoundingSphere(e.data.grid).center:B.unit,r=cW(t.transform,n),i={kind:`matrix`,matrix:z.mul(z(),r,NP.getGridToCartesianTransform(e.data.grid))};return new H.Volume.Data({...e.data,grid:{...e.data.grid,transform:i}},{label:e.label,description:`${e.description} [Transformed]`})}}),uRe=AD.BuiltIn({name:`volume-instances`,display:{name:`Volume Instances`},isDecorator:!0,from:H.Volume.Data,to:H.Volume.Data,params:{transforms:V.ObjectList({transform:lW},()=>`Transform`)}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=t.transforms.some(e=>sW(e.transform))?NP.getBoundingSphere(e.data.grid).center:B.unit,r=t.transforms.map(e=>({transform:cW(e.transform,n)}));return r.length?new H.Volume.Data({...e.data,instances:r},{label:e.label,description:`${e.description} [Instanced]`}):e}});var CW=tE(13421772),dRe=`Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).`;const wW={};function fRe(e){return wW}function TW(e,t){let n;if(e.structure){let{elements:t,getElementIndices:r}=e.structure.carbohydrates,i=(e,n)=>{if(!Q.isAtomic(e))return CW;let i=r(e,n);return i.length>0?t[i[0]].component.color:CW};n=(e,t)=>t?GF.Secondary:iL.is(e)?i(e.unit,e.element):fR.isLocation(e)?i(e.aUnit,e.aUnit.elements[e.aIndex]):CW}else n=()=>CW;return{factory:TW,granularity:`group`,color:n,props:t,description:dRe,legend:wk(VEe)}}const pRe={name:`carbohydrate-symbol`,label:`Carbohydrate Symbol`,category:mM.Residue,factory:TW,getParams:fRe,defaultValues:V.getDefaultValues(wW),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>DB.hasCarbohydrate(e))},EW={hue:V.Interval([1,360],{min:0,max:360,step:1}),chroma:V.Interval([40,70],{min:0,max:100,step:1}),luminance:V.Interval([15,85],{min:0,max:100,step:1}),sort:V.Select(`contrast`,V.arrayToOptions([`none`,`contrast`]),{description:`no sorting leaves colors approximately ordered by hue`}),clusteringStepCount:V.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:V.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:V.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})};var DW=2,OW=[0,0,0],kW=[0,0,0];function mRe(e,t){return ZT.toHcl(OW,e),ZT.fromColor(kW,ZT.toColor(e)),OW[0]>=t.hue[0]&&OW[0]<=t.hue[1]&&OW[1]>=t.chroma[0]&&OW[1]<=t.chroma[1]&&OW[2]>=t.luminance[0]&&OW[2]<=t.luminance[1]&&kW[0]>=e[0]-DW&&kW[0]<=e[0]+DW&&kW[1]>=e[1]-DW&&kW[1]<=e[1]+DW&&kW[2]>=e[2]-DW&&kW[2]<=e[2]+DW}function hRe(e){let t=e.slice(0),n=[t.shift()];for(;t.length>0;){let e=n[n.length-1],r=0,i=-1/0;for(let n=0;n<t.length;++n){let a=ZT.distance(e,t[n]);a>i&&(i=a,r=n)}n.push(t.splice(r,1)[0])}return n}function gRe(e,t){let n=new Map,r=Math.ceil(Math.cbrt(e)),i=QT(),a=Math.max((t.hue[1]-t.hue[0])/r,1),o=Math.max((t.chroma[1]-t.chroma[0])/r,1),s=Math.max((t.luminance[1]-t.luminance[0])/r,1);for(let e=t.hue[0]+a/2;e<=t.hue[1];e+=a)for(let r=t.chroma[0]+o/2;r<=t.chroma[1];r+=o)for(let a=t.luminance[0]+s/2;a<=t.luminance[1];a+=s){let o=ZT.fromHcl(ZT(),QT.set(i,e,r,a));mRe(o,t)&&n.set(ZT.toColor(o),o)}return Array.from(n.values())}function AW(e,t){let n=1/0,r=0;for(let i=0;i<e.length;i++){let a=ZT.distance(t,e[i]);a<n&&(n=a,r=i)}return r}function _Re(e,t={}){let n={...V.getDefaultValues(EW),...t};if(e<=0)return[];let r=gRe(Math.max(n.minSampleCount,e*n.sampleCountFactor),n);if(r.length<e)return console.warn(`Not enough samples to generate distinct colors, increase sample count.`),Array(e).fill(gk.lightgrey);let i=[],a=[],o=Math.floor(r.length/e);for(let t=0;t<r.length&&(i.push(r[t]),a.push([]),!(i.length>=e));t+=o);for(let e=1;e<=n.clusteringStepCount;++e){let e=UT(a),t=UT(r);for(let n=0;n<i.length;++n){let a=AW(t,i[n]);e[n].push(r[a]),t.splice(a,1)}for(let n=0;n<t.length;++n)e[AW(i,r[n])].push(r[n]);let n=UT(i);for(let t=0;t<e.length;++t){let n=e[t],r=n.length;if(r===0)continue;let a=0,o=0,s=0;for(let e of n)a+=e[0],o+=e[1],s+=e[2];i[t]=[a/r,o/r,s/r]}if(Tx(n,i))break}return(n.sort===`contrast`?hRe(i):i).map(e=>ZT.toColor(e))}var jW={type:`generate`,colorList:`red-yellow-blue`};function MW(e={}){let t={...jW,...e};return{palette:V.MappedStatic(t.type,{colors:V.Group({list:V.ColorList(t.colorList)},{isFlat:!0}),generate:V.Group({...EW,maxCount:V.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[[`colors`,`Color List`],[`generate`,`Generate Distinct`]]})}}V.getDefaultValues(MW());var NW={valueLabel:e=>`${e+1}`,minLabel:`Start`,maxLabel:`End`};function PW(e,t,n={}){let r,i;if(t.palette.name===`colors`&&t.palette.params.list.kind===`interpolate`){let{list:a}=t.palette.params,o=[0,e-1],{minLabel:s,maxLabel:c}={...NW,...n},l=a.colors;l.length===0&&(l=sE(jW.colorList).list);let u=Hk.create({listOrName:l,domain:o,minLabel:s,maxLabel:c});i=u.legend,r=u.color}else{let a;t.palette.name===`colors`?(a=t.palette.params.list.colors.map(e=>Array.isArray(e)?e[0]:e),a.length===0&&(a=sE(`dark-2`).list.map(e=>Array.isArray(e)?e[0]:e))):(e=Math.min(e,t.palette.params.maxCount),a=_Re(e,t.palette.params));let o=n.valueLabel??NW.valueLabel,s=a.length,c=[];for(let t=0;t<e;++t){let e=t%s;c[e]===void 0?c[e]=[o(t),a[e]]:c[e][0]+=`, ${o(t)}`}i=wk(c),r=e=>a[e%s]}return{color:r,legend:i}}var vRe=`many-distinct`,FW=tE(16448250),yRe="Gives every chain a color based on its `asym_id` value.";const IW={asymId:V.Select(`auth`,V.arrayToOptions([`auth`,`label`])),...MW({type:`colors`,colorList:vRe})};function bRe(e){let t=V.clone(IW);return e.structure?.models.some(e=>e.coarseHierarchy.isDefined)&&(t.asymId.defaultValue=`label`),t}function xRe(e,t){switch(e.kind){case Q.Kind.Atomic:return t===`auth`?Pz.chain.auth_asym_id:Pz.chain.label_asym_id;case Q.Kind.Spheres:case Q.Kind.Gaussians:return Pz.coarse.asym_id}}function LW(e,t){let n=xRe(e.unit,t)(e);return e.structure.root.models.length>1?RW(e.unit.model,n):n}function RW(e,t){return`${t}|${(DB.Index.get(e).value||0)+1}`}function SRe(e,t){let n=new Map;for(let r of e.models){let i=DB.AsymIdOffset.get(r).value,a=(t===`auth`?i?.auth:i?.label)||0,o=0;r.properties.structAsymMap.forEach(({auth_id:i},s)=>{let c=t===`auth`?i:s,l=e.models.length>1?RW(r,c):c;n.has(l)||(n.set(l,o+a),++o)})}return n}function zW(e,t){let n,r;if(e.structure){let i=iL.create(e.structure.root),a=SRe(e.structure.root,t.asymId),o=Array.from(a.keys()),s=PW(a.size,t,{valueLabel:e=>o[e]});r=s.legend,n=e=>{let n;if(iL.is(e)){let r=LW(e,t.asymId);n=a.get(r)}else if(fR.isLocation(e)){i.unit=e.aUnit,i.element=e.aUnit.elements[e.aIndex];let r=LW(i,t.asymId);n=a.get(r)}return n===void 0?FW:s.color(n)}}else n=()=>FW;return{factory:zW,granularity:`group`,color:n,props:t,description:yRe,legend:r}}const BW={name:`chain-id`,label:`Chain Id`,category:mM.Chain,factory:zW,getParams:bRe,defaultValues:V.getDefaultValues(IW),isApplicable:e=>!!e.structure};var VW=tE(13421772),CRe=`Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.`;const HW={...MW({type:`colors`,colorList:`red-yellow-blue`})};function wRe(e){return HW}function UW(e,t){let n,r;if(e.structure){let{units:i}=e.structure.root,a=i.length,o=new Map,s=new Map,c=0;for(let e=0;e<a;++e)o.set(e,c),c+=i[e].elements.length,s.set(i[e].id,e);let l=PW(c,t);r=l.legend,n=e=>{if(iL.is(e)){let t=s.get(e.unit.id),n=K.findPredecessorIndex(i[t].elements,e.element);return l.color(o.get(t)+n)}else if(fR.isLocation(e)){let t=s.get(e.aUnit.id),n=K.findPredecessorIndex(i[t].elements,e.aUnit.elements[e.aIndex]);return l.color(o.get(t)+n)}return VW}}else n=()=>VW;return{factory:UW,granularity:`groupInstance`,preferSmoothing:!0,color:n,props:t,description:CRe,legend:r}}const TRe={name:`element-index`,label:`Element Index`,category:mM.Atom,factory:UW,getParams:wRe,defaultValues:V.getDefaultValues(HW),isApplicable:e=>!!e.structure};function WW(e){let t={};return WT(e,(n,r)=>{t[r]=V.Color(e[r])}),t}var ERe=`many-distinct`,GW=tE(13421772),DRe=`Assigns a color based on the operator name of a transformed chain.`;const KW={...MW({type:`colors`,colorList:ERe})};function ORe(e){return V.clone(KW)}function kRe(e){let t=new Map;for(let n=0,r=e.units.length;n<r;++n){let r=e.units[n].conformation.operator.name;t.has(r)||t.set(r,t.size)}return t}function qW(e,t){let n,r;if(e.structure){let i=kRe(e.structure.root),a=Array.from(i.keys()),o=PW(i.size,t,{valueLabel:e=>a[e]});r=o.legend,n=e=>{let t;if(iL.is(e)){let n=e.unit.conformation.operator.name;t=i.get(n)}else if(fR.isLocation(e)){let n=e.aUnit.conformation.operator.name;t=i.get(n)}return t===void 0?GW:o.color(t)}}else n=()=>GW;return{factory:qW,granularity:`instance`,color:n,props:t,description:DRe,legend:r}}const JW={name:`operator-name`,label:`Operator Name`,category:mM.Symmetry,factory:qW,getParams:ORe,defaultValues:V.getDefaultValues(KW),isApplicable:e=>!!e.structure};var ARe=`many-distinct`,YW=tE(16448250),jRe=tE(16715021),MRe="Gives every chain a color based on its `label_entity_id` value.";const XW={...MW({type:`colors`,colorList:ARe}),overrideWater:V.Boolean(!1,{description:`Override the color for water molecules.`}),waterColor:V.Color(jRe,{hideIf:e=>!e.overrideWater,description:`Color for water molecules (if overrideWater is true).`})};function NRe(e){return V.clone(XW)}function ZW(e,t){return`${e}|${t}`}function PRe(e){let t=new WeakMap,n=0;for(let r=0,i=e.models.length;r<i;++r){let i=e.models[r].sourceData;t.has(i)||t.set(i,n++)}return t}function FRe(e,t){let n=new Map;for(let r=0,i=e.models.length;r<i;++r){let i=t.get(e.models[r].sourceData)??-1,{label_entity_id:a}=e.models[r].atomicHierarchy.chains;for(let e=0,t=a.rowCount;e<t;++e){let t=ZW(a.value(e),i);n.has(t)||n.set(t,n.size)}let{coarseHierarchy:o}=e.models[r];if(o.isDefined){let{entity_id:e}=o.spheres;for(let t=0,r=e.rowCount;t<r;++t){let r=ZW(e.value(t),i);n.has(r)||n.set(r,n.size)}let{entity_id:t}=o.gaussians;for(let e=0,r=t.rowCount;e<r;++e){let r=ZW(t.value(e),i);n.has(r)||n.set(r,n.size)}}}return n}function IRe(e){switch(e.unit.kind){case Q.Kind.Atomic:return Pz.chain.label_entity_id(e);case Q.Kind.Spheres:case Q.Kind.Gaussians:return Pz.coarse.entity_id(e)}}function QW(e,t){let n,r;if(e.structure){let i=iL.create(e.structure.root),a=PRe(e.structure),o=FRe(e.structure.root,a),s=Array.from(o.keys()),c=PW(o.size,t,{valueLabel:e=>s[e]});r=c.legend,n=e=>{let n;if(iL.is(e))n=e;else if(fR.isLocation(e))i.unit=e.aUnit,i.element=e.aUnit.elements[e.aIndex],n=i;else return YW;let r=IRe(n),s=a.get(n.unit.model.sourceData)??-1;if(t.overrideWater){let e=n.unit.model.entities;if(e.data.type.value(e.getEntityIndex(r))===`water`)return t.waterColor}let l=ZW(r,s),u=o.get(l);return u===void 0?YW:c.color(u)}}else n=()=>YW;return{factory:QW,granularity:`group`,color:n,props:t,description:MRe,legend:r}}const LRe={name:`entity-id`,label:`Entity Id`,category:mM.Chain,factory:QW,getParams:NRe,defaultValues:V.getDefaultValues(XW),isApplicable:e=>!!e.structure};var $W=`dark-2`,eG=tE(16448250),RRe=`Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).`;const tG={...MW({type:`colors`,colorList:$W})};function zRe(e){let t=V.clone(tG);return e.structure&&iG(e.structure.root.models).srcKeySerialMap.size>aE[$W].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE($W).list}}),t}function nG(e,t){return`${e}|${t}`}function BRe(e,t,n,r,i,a){return`${e}|${t}|${n}|${a||i||r}`}function rG(e,t,n,r,i,a,o,s){let{entity_id:c,pdbx_src_id:l,pdbx_beg_seq_num:u,pdbx_end_seq_num:d}=i;for(let f=0,p=i._rowCount;f<p;++f){let i=c.value(f),p=nG(n,i),m;if(e.has(p))m=e.get(p);else{let t=r.entities.getEntityIndex(i),n=r.sequence.sequences[t].sequence;m=new Int16Array(n.length),e.set(p,m)}let h=o?o.value(f):``,g=s?s.value(f)[0]:``,_=BRe(n,i,a.value(f),l.value(f),h,g),v=u.valueKind(f)===U.ValueKinds.Present?u.value(f):1,y=d.valueKind(f)===U.ValueKinds.Present?d.value(f):m.length,b;t.has(_)?b=t.get(_):(b=t.size+1,t.set(_,b));for(let e=v,t=y;e<=t;++e)m[e-1]=b}}function iG(e){let t=new Map,n=new Map;for(let r=0,i=e.length;r<i;++r){let i=e[r];if(!CB.is(i.sourceData))continue;let{entity_src_gen:a,entity_src_nat:o,pdbx_entity_src_syn:s}=i.sourceData.data.db;rG(t,n,r,i,a,a.pdbx_gene_src_scientific_name,a.plasmid_name,a.pdbx_gene_src_gene),rG(t,n,r,i,o,o.pdbx_organism_scientific,o.pdbx_plasmid_name),rG(t,n,r,i,s,s.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:n}}function VRe(e){let t=0;return Array.from(e.keys()).map(e=>{let n=e.split(`|`),r=n[2];return`${Bge(n[3])?`Unnamed ${++t}`:n[3]}${r?` (${r})`:``}`})}function aG(e,t){let n,r;if(e.structure){let i=iL.create(e.structure),{models:a}=e.structure.root,{seqToSrcByModelEntity:o,srcKeySerialMap:s}=iG(a),c=VRe(s),l=PW(s.size,t,{valueLabel:e=>c[e]});r=l.legend;let u=e=>{let t=nG(a.indexOf(e.unit.model),Pz.entity.id(e)),n=o.get(t);if(n){let t=n[Pz.residue.label_seq_id(e)-1]-1;return t===-1?eG:l.color(t)}else return eG};n=e=>iL.is(e)?u(e):fR.isLocation(e)?(i.unit=e.aUnit,i.element=e.aUnit.elements[e.aIndex],u(i)):eG}else n=()=>eG;return{factory:aG,granularity:`group`,color:n,props:t,description:RRe,legend:r}}const HRe={name:`entity-source`,label:`Entity Source`,category:mM.Chain,factory:aG,getParams:zRe,defaultValues:V.getDefaultValues(tG),isApplicable:e=>!!e.structure};var oG=tE(13421772),URe=`Gives every model a unique color based on its index.`;const sG={...MW({type:`colors`,colorList:`many-distinct`})};function WRe(e){return V.clone(sG)}function cG(e,t){let n,r,i=-1;if(e.structure){let a=(DB.MaxIndex.get(e.structure.models[0]).value??-1)+1;i=a;let o=PW(a,t);r=o.legend,n=e=>iL.is(e)?o.color(DB.Index.get(e.unit.model).value||0):fR.isLocation(e)?o.color(DB.Index.get(e.aUnit.model).value||0):oG}else n=()=>oG;return{factory:cG,granularity:`instance`,color:n,props:t,contextHash:i,description:URe,legend:r}}const GRe={name:`model-index`,label:`Model Index`,category:mM.Chain,factory:cG,getParams:WRe,defaultValues:V.getDefaultValues(sG),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var lG=tE(13421772),KRe=`Gives every structure a unique color based on its index.`;const uG={...MW({type:`colors`,colorList:`many-distinct`})};function qRe(e){return V.clone(uG)}function dG(e,t){let n,r,i=-1;if(e.structure){let a=(nB.MaxIndex.get(e.structure).value??-1)+1;i=a;let o=PW(a,t);r=o.legend,n=e=>iL.is(e)?o.color(nB.Index.get(e.structure).value||0):fR.isLocation(e)?o.color(nB.Index.get(e.aStructure).value||0):lG}else n=()=>lG;return{factory:dG,granularity:`instance`,color:n,props:t,contextHash:i,description:KRe,legend:r}}const JRe={name:`structure-index`,label:`Structure Index`,category:mM.Chain,factory:dG,getParams:qRe,defaultValues:V.getDefaultValues(uG),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var fG=`dark-2`,pG=tE(13421772),YRe=`Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.`;const mG={...MW({type:`colors`,colorList:fG})};function XRe(e){let t=V.clone(mG);return e.structure&&e.structure.root.units.length>aE[fG].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE(fG).list}}),t}function hG(e,t){let n,r;if(e.structure){let{units:i}=e.structure.root,a=PW(i.length,t);r=a.legend;let o=new Map;for(let e=0,t=i.length;e<t;++e)o.set(i[e].id,a.color(e));n=e=>iL.is(e)?o.get(e.unit.id):fR.isLocation(e)?o.get(e.aUnit.id):pG}else n=()=>pG;return{factory:hG,granularity:`instance`,color:n,props:t,description:YRe,legend:r}}const ZRe={name:`unit-index`,label:`Chain Instance`,category:mM.Chain,factory:hG,getParams:XRe,defaultValues:V.getDefaultValues(mG),isApplicable:e=>!!e.structure};var gG=tE(13421772),QRe=`Gives every model (frame) a unique color based on the index in its trajectory.`;const _G={...MW({type:`colors`,colorList:`purples`})};function $Re(e){return V.clone(_G)}function vG(e,t){let n,r,i=-1;if(e.structure){let{models:a}=e.structure.root,o=0;for(let e of a)o=Math.max(o,DB.TrajectoryInfo.get(e)?.size||0);let s=[o],c=PW(o,t);r=c.legend;let l=new Map;for(let e=0,t=a.length;e<t;++e){let t=DB.TrajectoryInfo.get(a[e])?.index||0;l.set(t,c.color(t)),s.push(t)}i=gE(s),n=e=>iL.is(e)?l.get(DB.TrajectoryInfo.get(e.unit.model).index):fR.isLocation(e)?l.get(DB.TrajectoryInfo.get(e.aUnit.model).index):gG}else n=()=>gG;return{factory:vG,granularity:`instance`,color:n,props:t,contextHash:i,description:QRe,legend:r}}const eze={name:`trajectory-index`,label:`Trajectory Index`,category:mM.Chain,factory:vG,getParams:$Re,defaultValues:V.getDefaultValues(_G),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&DB.TrajectoryInfo.get(e.structure.models[0]).size>1},yG=rE({H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215});var bG=tE(16777215),tze=`Assigns a color to every atom according to its chemical element.`;const xG={carbonColor:V.MappedStatic(`chain-id`,{"chain-id":V.Group(IW),"unit-index":V.Group(mG,{label:`Chain Instance`}),"entity-id":V.Group(XW),"entity-source":V.Group(tG),"operator-name":V.Group(KW),"model-index":V.Group(sG),"structure-index":V.Group(uG),"trajectory-index":V.Group(_G),uniform:V.Group(gM),"element-symbol":V.EmptyGroup()},{description:`Use chain-id coloring for carbon atoms.`}),saturation:V.Numeric(0,{min:-6,max:6,step:.1}),lightness:V.Numeric(.2,{min:-6,max:6,step:.1}),colors:V.MappedStatic(`default`,{default:V.EmptyGroup(),custom:V.Group(WW(yG))})};function nze(e){return V.clone(xG)}function rze(e,t){let n=e[t];return n===void 0?bG:n}function ize(e,t){switch(t.name){case`chain-id`:return zW(e,t.params);case`unit-index`:return hG(e,t.params);case`entity-id`:return QW(e,t.params);case`entity-source`:return aG(e,t.params);case`operator-name`:return qW(e,t.params);case`model-index`:return cG(e,t.params);case`structure-index`:return dG(e,t.params);case`trajectory-index`:return vG(e,t.params);case`uniform`:return _M(e,t.params);case`element-symbol`:return;default:Lb(t)}}function SG(e,t){let n=iE(t.colors.name===`default`?yG:t.colors.params,t.saturation,t.lightness),r=ize(e,t.carbonColor),i=r?.color,a=r?.contextHash??-1;function o(e,t){return i&&e===`C`?i(t,!1):rze(n,e)}function s(e){if(iL.is(e)){if(Q.isAtomic(e.unit)){let{type_symbol:t}=e.unit.model.atomicHierarchy.atoms;return o(t.value(e.element),e)}}else if(fR.isLocation(e)&&Q.isAtomic(e.aUnit)){let{type_symbol:t}=e.aUnit.model.atomicHierarchy.atoms;return o(t.value(e.aUnit.elements[e.aIndex]),e)}return bG}return{factory:SG,granularity:t.carbonColor.name===`operator-name`||t.carbonColor.name===`unit-index`?`groupInstance`:`group`,preferSmoothing:!0,color:s,props:t,contextHash:a,description:tze,legend:wk(Object.keys(n).map(e=>[e,n[e]]))}}const aze={name:`element-symbol`,label:`Element Symbol`,category:mM.Atom,factory:SG,getParams:nze,defaultValues:V.getDefaultValues(xG),isApplicable:e=>!!e.structure},CG=rE({water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655});var wG=tE(16777113),oze=`Assigns a color based on the molecule type of a residue.`;const TG={saturation:V.Numeric(0,{min:-6,max:6,step:.1}),lightness:V.Numeric(0,{min:-6,max:6,step:.1}),colors:V.MappedStatic(`default`,{default:V.EmptyGroup(),custom:V.Group(WW(CG))})};function sze(e){return TG}function EG(e,t,n){switch(SR(t,n)){case iI.Water:return e.water;case iI.Ion:return e.ion;case iI.Protein:return e.protein;case iI.RNA:return e.RNA;case iI.DNA:return e.DNA;case iI.PNA:return e.PNA;case iI.Saccharide:return e.saccharide}return wG}function DG(e,t){let n=iE(t.colors.name===`default`?CG:t.colors.params,t.saturation,t.lightness);function r(e){return iL.is(e)?EG(n,e.unit,e.element):fR.isLocation(e)?EG(n,e.aUnit,e.aUnit.elements[e.aIndex]):wG}return{factory:DG,granularity:`group`,color:r,props:t,description:oze,legend:wk(Object.keys(n).map(e=>[e,n[e]]).concat([[`Other/unknown`,wG]]))}}const cze={name:`molecule-type`,label:`Molecule Type`,category:mM.Residue,factory:DG,getParams:sze,defaultValues:V.getDefaultValues(TG),isApplicable:e=>!!e.structure};var OG=`dark-2`,kG=tE(16448250),lze="Gives every polymer chain a color based on its `asym_id` value.";const AG={...MW({type:`colors`,colorList:OG})};function uze(e){let t=V.clone(AG);return e.structure&&MG(e.structure.root).size>aE[OG].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE(OG).list}}),t}function jG(e){switch(e.kind){case Q.Kind.Atomic:return Pz.chain.label_asym_id;case Q.Kind.Spheres:case Q.Kind.Gaussians:return Pz.coarse.asym_id}}function MG(e){let t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){let r=e.unitSymmetryGroups[n].units[0],{model:i}=r;if(Q.isAtomic(r)){let{chainAtomSegments:e,chains:n}=i.atomicHierarchy,a=uA.transientSegments(e,r.elements);for(;a.hasNext;){let{index:e}=a.move(),r=n.label_entity_id.value(e),o=i.entities.getEntityIndex(r);if(i.entities.data.type.value(o)===`polymer`){let r=n.label_asym_id.value(e);t.has(r)||t.set(r,t.size)}}}else if(Q.isCoarse(r)){let{chainElementSegments:e,asym_id:n,entity_id:a}=Q.isSpheres(r)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,o=uA.transientSegments(e,r.elements);for(;o.hasNext;){let{index:r}=o.move(),s=e.offsets[r],c=a.value(s),l=i.entities.getEntityIndex(c);if(i.entities.data.type.value(l)===`polymer`){let e=n.value(s);t.has(e)||t.set(e,t.size)}}}}return t}function NG(e,t){let n,r;if(e.structure){let i=iL.create(e.structure),a=MG(e.structure.root),o=Array.from(a.keys()),s=PW(a.size,t,{valueLabel:e=>o[e]});r=s.legend,n=e=>{let t;if(iL.is(e)){let n=jG(e.unit);t=a.get(n(e))}else if(fR.isLocation(e)){let n=jG(e.aUnit);i.unit=e.aUnit,i.element=e.aUnit.elements[e.aIndex],t=a.get(n(i))}return t===void 0?kG:s.color(t)}}else n=()=>kG;return{factory:NG,granularity:`group`,color:n,props:t,description:lze,legend:r}}const dze={name:`polymer-id`,label:`Polymer Chain Id`,category:mM.Chain,factory:NG,getParams:uze,defaultValues:V.getDefaultValues(AG),isApplicable:e=>!!e.structure};var PG=`dark-2`,FG=tE(13421772),fze=`Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.`;const IG={...MW({type:`colors`,colorList:PG})};function pze(e){let t=V.clone(IG);return e.structure&&LG(e.structure.root)>aE[PG].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE(PG).list}}),t}function LG(e){let t=0,{units:n}=e;for(let e=0,r=n.length;e<r;++e)n[e].polymerElements.length>0&&++t;return t}function RG(e,t){let n,r;if(e.structure){let i=PW(LG(e.structure.root),t);r=i.legend;let{units:a}=e.structure.root,o=new Map;for(let e=0,t=0,n=a.length;e<n;++e)a[e].polymerElements.length>0&&(o.set(a[e].id,i.color(t)),++t);n=e=>{let t;return iL.is(e)?t=o.get(e.unit.id):fR.isLocation(e)&&(t=o.get(e.aUnit.id)),t===void 0?FG:t}}else n=()=>FG;return{factory:RG,granularity:`instance`,color:n,props:t,description:fze,legend:r}}const mze={name:`polymer-index`,label:`Polymer Chain Instance`,category:mM.Chain,factory:RG,getParams:pze,defaultValues:V.getDefaultValues(IG),isApplicable:e=>!!e.structure},zG=rE({ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945});var BG=tE(16711935),hze=`Assigns a color to every residue according to its name.`;const VG={saturation:V.Numeric(0,{min:-6,max:6,step:.1}),lightness:V.Numeric(1,{min:-6,max:6,step:.1}),colors:V.MappedStatic(`default`,{default:V.EmptyGroup(),custom:V.Group(WW(zG))})};function gze(e){return VG}function HG(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function UG(e,t){let n=e.coarseElements.seq_id_begin.value(t);if(n===e.coarseElements.seq_id_end.value(t)){let r=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[r].sequence.compId.value(n-1)}}function WG(e,t){let n=e[t];return n===void 0?BG:n}function GG(e,t){let n=iE(t.colors.name===`default`?zG:t.colors.params,t.saturation,t.lightness);function r(e){if(iL.is(e)){if(Q.isAtomic(e.unit))return WG(n,HG(e.unit,e.element));{let t=UG(e.unit,e.element);if(t)return WG(n,t)}}else if(fR.isLocation(e)){if(Q.isAtomic(e.aUnit))return WG(n,HG(e.aUnit,e.aUnit.elements[e.aIndex]));{let t=UG(e.aUnit,e.aUnit.elements[e.aIndex]);if(t)return WG(n,t)}}return BG}return{factory:GG,granularity:`group`,preferSmoothing:!0,color:r,props:t,description:hze,legend:wk(Object.keys(n).map(e=>[e,n[e]]).concat([[`Unknown`,BG]]))}}const _ze={name:`residue-name`,label:`Residue Name`,category:mM.Residue,factory:GG,getParams:gze,defaultValues:V.getDefaultValues(VG),isApplicable:e=>!!e.structure},KG=rE({alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722});var qG=tE(8421504),vze=`Assigns a color based on the type of secondary structure and basic molecule type.`;const JG={saturation:V.Numeric(-1,{min:-6,max:6,step:.1}),lightness:V.Numeric(0,{min:-6,max:6,step:.1}),colors:V.MappedStatic(`default`,{default:V.EmptyGroup(),custom:V.Group(WW(KG))})};function yze(e){return JG}function YG(e,t,n,r){let i=OI.create(OI.Flag.None);if(r&&Q.isAtomic(t)){let e=r.get(t.invariantId);e&&(i=e.type[e.getIndex(t.residueIndex[n])])}if(OI.is(i,OI.Flag.Helix))return OI.is(i,OI.Flag.Helix3Ten)?e.threeTenHelix:OI.is(i,OI.Flag.HelixPi)?e.piHelix:e.alphaHelix;if(OI.is(i,OI.Flag.Beta))return e.betaStrand;if(OI.is(i,OI.Flag.Bend))return e.bend;if(OI.is(i,OI.Flag.Turn))return e.turn;{let r=SR(t,n);if(r===iI.DNA)return e.dna;if(r===iI.RNA)return e.rna;if(r===iI.Saccharide)return e.carbohydrate;if(r===iI.Protein)return e.coil}return qG}function XG(e,t){let n=e.structure&&Tz.get(e.structure),r=n?dE(n.id,n.version):-1,i=iE(t.colors.name===`default`?KG:t.colors.params,t.saturation,t.lightness);function a(e){return iL.is(e)?YG(i,e.unit,e.element,n?.value):fR.isLocation(e)?YG(i,e.aUnit,e.aUnit.elements[e.aIndex],n?.value):qG}return{factory:XG,granularity:`group`,preferSmoothing:!0,color:a,props:t,contextHash:r,description:vze,legend:wk(Object.keys(i).map(e=>[e,i[e]]).concat([[`Other`,qG]]))}}const bze={name:`secondary-structure`,label:`Secondary Structure`,category:mM.Residue,factory:XG,getParams:yze,defaultValues:V.getDefaultValues(JG),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Tz.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Tz.ref(e.structure,!1)}};var xze=tE(13421772),Sze="Gives every polymer residue a color based on its `seq_id` value.";const ZG={list:V.ColorList(`turbo-no-black`,{presetKind:`scale`})};function Cze(e){return ZG}function QG(e,t){let{model:n}=e;switch(e.kind){case Q.Kind.Atomic:let e=n.atomicHierarchy.residueAtomSegments.index[t];return n.atomicHierarchy.residues.label_seq_id.value(e);case Q.Kind.Spheres:return Math.round((n.coarseHierarchy.spheres.seq_id_begin.value(t)+n.coarseHierarchy.spheres.seq_id_end.value(t))/2);case Q.Kind.Gaussians:return Math.round((n.coarseHierarchy.gaussians.seq_id_begin.value(t)+n.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function $G(e,t){let{model:n}=e,r=``;switch(e.kind){case Q.Kind.Atomic:let e=n.atomicHierarchy.chainAtomSegments.index[t];r=n.atomicHierarchy.chains.label_entity_id.value(e);break;case Q.Kind.Spheres:r=n.coarseHierarchy.spheres.entity_id.value(t);break;case Q.Kind.Gaussians:r=n.coarseHierarchy.gaussians.entity_id.value(t);break}if(r===``)return 0;let i=n.entities.getEntityIndex(r);if(i===-1)return 0;let a=n.sequence.byEntityKey[i];return a===void 0?0:a.sequence.length}function eK(e,t){let n=Hk.create({listOrName:t.list.colors,minLabel:`Start`,maxLabel:`End`});return{factory:eK,granularity:`group`,preferSmoothing:!0,color:e=>{if(iL.is(e)){let{unit:t,element:r}=e,i=QG(t,r);if(i>0){let e=$G(t,r);if(e)return n.setDomain(0,e-1),n.color(i)}}else if(fR.isLocation(e)){let{aUnit:t,aIndex:r}=e,i=QG(t,t.elements[r]);if(i>0){let e=$G(t,t.elements[r]);if(e)return n.setDomain(0,e-1),n.color(i)}}return xze},props:t,description:Sze,legend:n?n.legend:void 0}}const wze={name:`sequence-id`,label:`Sequence Id`,category:mM.Residue,factory:eK,getParams:Cze,defaultValues:V.getDefaultValues(ZG),isApplicable:e=>!!e.structure};var Tze=tE(16777113),Eze=`Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.`;const tK={domain:V.Interval([0,100]),list:V.ColorList(`red-white-blue`,{presetKind:`scale`})};function Dze(e){return tK}function nK(e,t){return Q.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Q.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function rK(e,t){let n;n=t.list.kind===`set`?Hk.createDiscrete({reverse:!0,domain:t.domain,listOrName:t.list.colors}):Hk.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function r(e){return iL.is(e)?n.color(nK(e.unit,e.element)):fR.isLocation(e)?n.color(nK(e.aUnit,e.aUnit.elements[e.aIndex])):Tze}return{factory:rK,granularity:`group`,preferSmoothing:!0,color:r,props:t,description:Eze,legend:n?n.legend:void 0}}const Oze={name:`uncertainty`,label:`Uncertainty/Disorder`,category:mM.Atom,factory:rK,getParams:Dze,defaultValues:V.getDefaultValues(tK),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.B_iso_or_equiv.isDefined||e.coarseHierarchy.isDefined)};var kze=tE(15658734),Aze=`Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).`;const iK={style:V.MappedStatic(`entity-id`,{uniform:V.Group(gM),"chain-id":V.Group(IW),"entity-id":V.Group(XW),"entity-source":V.Group(tG),"molecule-type":V.Group(TG),"model-index":V.Group(sG),"structure-index":V.Group(uG),"trajectory-index":V.Group(_G)}),carbonLightness:V.Numeric(.8,{min:-6,max:6,step:.1})};function jze(e){return V.clone(iK)}function Mze(e,t){switch(t.name){case`uniform`:return _M(e,t.params);case`chain-id`:return zW(e,t.params);case`entity-id`:return QW(e,t.params);case`entity-source`:return aG(e,t.params);case`molecule-type`:return DG(e,t.params);case`model-index`:return cG(e,t.params);case`structure-index`:return dG(e,t.params);case`trajectory-index`:return vG(e,t.params);default:Lb(t)}}function aK(e,t){let{color:n,legend:r,contextHash:i}=Mze(e,t.style);function a(e,r){let i=n(e,!1);return r===`C`?tE.lighten(i,t.carbonLightness):i}function o(e){if(iL.is(e)&&Q.isAtomic(e.unit))return a(e,e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element));if(fR.isLocation(e)&&Q.isAtomic(e.aUnit)){let t=e.aUnit.elements[e.aIndex];return a(e,e.aUnit.model.atomicHierarchy.atoms.type_symbol.value(t))}return kze}return{factory:aK,granularity:`group`,preferSmoothing:!0,color:o,props:t,contextHash:i,description:Aze,legend:r}}const Nze={name:`illustrative`,label:`Illustrative`,category:mM.Misc,factory:aK,getParams:jze,defaultValues:V.getDefaultValues(iK),isApplicable:e=>!!e.structure};var Pze=`Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).`;const oK={list:V.ColorList(`red-yellow-green`,{presetKind:`scale`}),scale:V.Select(`DGwif`,[[`DGwif`,`DG water-membrane`],[`DGwoct`,`DG water-octanol`],[`Oct-IF`,`DG difference`]])};function Fze(e){return oK}var Ize={DGwif:0,DGwoct:1,"Oct-IF":2};function Lze(e,t){let n=AI[e];return n===void 0?0:n[t]}function sK(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function cK(e,t){let n=e.coarseElements.seq_id_begin.value(t);if(n===e.coarseElements.seq_id_end.value(t)){let r=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[r].sequence.compId.value(n-1)}}function lK(e,t){let n=Ize[t.scale],r=1/0,i=-1/0;for(let e in AI){let t=AI[e][n];r=Math.min(r,t),i=Math.max(i,t)}let a=Hk.create({listOrName:t.list.colors,domain:[i,r],minLabel:`Hydrophilic`,maxLabel:`Hydrophobic`});function o(e){let t;return iL.is(e)?t=Q.isAtomic(e.unit)?sK(e.unit,e.element):cK(e.unit,e.element):fR.isLocation(e)&&(t=Q.isAtomic(e.aUnit)?sK(e.aUnit,e.aUnit.elements[e.aIndex]):cK(e.aUnit,e.aUnit.elements[e.aIndex])),a.color(t?Lze(t,n):0)}return{factory:lK,granularity:`group`,preferSmoothing:!0,color:o,props:t,description:Pze,legend:a?a.legend:void 0}}const Rze={name:`hydrophobicity`,label:`Hydrophobicity`,category:mM.Residue,factory:lK,getParams:Fze,defaultValues:V.getDefaultValues(oK),isApplicable:e=>!!e.structure};var zze=tE(13421772),Bze=`Assigns a color based on the occupancy of an atom.`;const uK={domain:V.Interval([0,1]),list:V.ColorList(`purples`,{presetKind:`scale`})};function Vze(e){return uK}function dK(e,t){return Q.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function fK(e,t){let n=Hk.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function r(e){return iL.is(e)?n.color(dK(e.unit,e.element)):fR.isLocation(e)?n.color(dK(e.aUnit,e.aUnit.elements[e.aIndex])):zze}return{factory:fK,granularity:`group`,preferSmoothing:!0,color:r,props:t,description:Bze,legend:n?n.legend:void 0}}const Hze={name:`occupancy`,label:`Occupancy`,category:mM.Atom,factory:fK,getParams:Vze,defaultValues:V.getDefaultValues(uK),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.occupancy.isDefined)};var pK=`dark-2`,mK=tE(13421772),Uze=`Assigns a color based on the operator HKL value of a transformed chain.`;const hK={...MW({type:`colors`,colorList:pK})};function Wze(e){let t=V.clone(hK);return e.structure&&bK(e.structure.root).map.size>aE[pK].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE(pK).list}}),t}var gK=1e4;function _K(e){return e.map(e=>`${e+gK}`.padStart(5,`0`)).join(``)}function vK(e){let t=Rge(gK,0),n=parseInt(e.substr(0,t)),r=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t));return B.create(n-gK,r-gK,i-gK)}function yK(e){return e.map(e=>e+5).join(``)}function bK(e){let t=new Map,n=new Set;for(let t=0,r=e.units.length;t<r;++t){let r=_K(e.units[t].conformation.operator.hkl);n.add(r)}let r=Array.from(n.values()).sort();return r.forEach(e=>t.set(e,t.size)),{min:vK(r[0]),max:vK(r[r.length-1]),map:t}}function xK(e,t){let n,r;if(e.structure){let{min:i,max:a,map:o}=bK(e.structure.root),s=[];o.forEach((e,t)=>{let n=e%o.size,r=yK(vK(t));s[n]===void 0?s[n]=r:s[n]+=`, ${r}`});let c={minLabel:yK(i),maxLabel:yK(a),valueLabel:e=>s[e]},l=PW(o.size,t,c);r=l.legend,n=e=>{let t;if(iL.is(e)){let n=_K(e.unit.conformation.operator.hkl);t=o.get(n)}else if(fR.isLocation(e)){let n=_K(e.aUnit.conformation.operator.hkl);t=o.get(n)}return t===void 0?mK:l.color(t)}}else n=()=>mK;return{factory:xK,granularity:`instance`,color:n,props:t,description:Uze,legend:r}}const Gze={name:`operator-hkl`,label:`Operator HKL`,category:mM.Symmetry,factory:xK,getParams:Wze,defaultValues:V.getDefaultValues(hK),isApplicable:e=>!!e.structure};var SK=tE(16777113),Kze=`Assigns a color based on the partial charge of an atom.`;const CK={domain:V.Interval([-1,1]),list:V.ColorList(`red-white-blue`,{presetKind:`scale`})};function qze(e){return CK}function wK(e,t){return tV.Provider.get(e.model)?.data.value(t)}function TK(e,t){let n=Hk.create({domain:t.domain,listOrName:t.list.colors});function r(e){if(iL.is(e)){let t=wK(e.unit,e.element);return t===void 0?SK:n.color(t)}else if(fR.isLocation(e)){let t=wK(e.aUnit,e.aUnit.elements[e.aIndex]);return t===void 0?SK:n.color(t)}return SK}return{factory:TK,granularity:`group`,preferSmoothing:!0,color:r,props:t,description:Kze,legend:n?n.legend:void 0}}const Jze={name:`partial-charge`,label:`Partial Charge`,category:mM.Atom,factory:TK,getParams:qze,defaultValues:V.getDefaultValues(CK),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>tV.Provider.get(e)!==void 0)};var Yze=`many-distinct`,EK=tE(16448250),Xze="Gives every atom a color based on its `label_atom_id` value.";const DK={...MW({type:`colors`,colorList:Yze})};function Zze(e){return V.clone(DK)}function Qze(e){let t=new Map;for(let n of e.models){let{label_atom_id:e}=n.atomicHierarchy.atoms;for(let n=0,r=e.rowCount;n<r;++n){let r=e.value(n);t.has(r)||t.set(r,t.size)}}return t}function OK(e,t){let n,r;if(e.structure){let i=iL.create(e.structure.root),a=Qze(e.structure.root),o=Array.from(a.keys()),s=PW(a.size,t,{valueLabel:e=>o[e]});r=s.legend,n=e=>{let t;if(iL.is(e)){let n=Pz.atom.label_atom_id(e);t=a.get(n)}else if(fR.isLocation(e)){i.unit=e.aUnit,i.element=e.aUnit.elements[e.aIndex];let n=Pz.atom.label_atom_id(i);t=a.get(n)}return t===void 0?EK:s.color(t)}}else n=()=>EK;return{factory:OK,granularity:`group`,preferSmoothing:!0,color:n,props:t,description:Xze,legend:r}}const $ze={name:`atom-id`,label:`Atom Id`,category:mM.Atom,factory:OK,getParams:Zze,defaultValues:V.getDefaultValues(DK),isApplicable:e=>!!e.structure};var kK=`Assign color based on the given value of a volume cell.`;const AK={colorList:V.ColorList({kind:`interpolate`,colors:[[gk.white,0],[gk.red,.25],[gk.white,.5],[gk.blue,.75],[gk.white,1]]},{offsets:!0,isEssential:!0}),domain:V.MappedStatic(`auto`,{custom:V.Interval([-1,1],{step:.001}),auto:V.Group({symmetric:V.Boolean(!1,{description:`If true the automatic range is determined as [-|max|, |max|].`})})}),isRelative:V.Boolean(!1,{description:`If true the value is treated as relative to the volume mean and sigma.`}),defaultColor:V.Color(tE(13421772))};function eBe(e){return AK}function jK(e,t){if(e.volume){let{min:n,max:r,mean:i,sigma:a}=e.volume.grid.stats,o=t.domain.name===`custom`?t.domain.params:[n,r],{colorList:s,defaultColor:c}=t;if(t.domain.name===`auto`&&t.isRelative&&(o[0]=(o[0]-i)/a,o[1]=(o[1]-i)/a),t.domain.name===`auto`&&t.domain.params.symmetric){let e=Math.max(Math.abs(o[0]),Math.abs(o[1]));o[0]=-e,o[1]=e}if(e.locationKinds?.includes(`direct-location`)){let e=[ET(o[0],n,r),ET(o[1],n,r)];return{factory:jK,granularity:`direct`,props:t,description:kK,palette:YK.Palette(s.colors,s.kind,e,c)}}else{let n=NP.makeGetTrilinearlyInterpolated(e.volume.grid,`none`);return{factory:jK,granularity:`vertex`,preferSmoothing:!0,color:e=>{if(!ij(e))return t.defaultColor;let r=n(e.position);return Number.isNaN(r)?t.defaultColor:DT((r-o[0])/(o[1]-o[0]),0,1)*YK.PaletteScale},palette:YK.Palette(s.colors,s.kind,void 0,c),props:t,description:kK}}}else return{factory:jK,granularity:`uniform`,color:()=>t.defaultColor,props:t,description:kK}}const tBe={name:`volume-value`,label:`Volume Value`,category:mM.Misc,factory:jK,getParams:eBe,defaultValues:V.getDefaultValues(AK),isApplicable:e=>!!e.volume&&!zP.Segmentation.get(e.volume)};var MK=tE(13421772),nBe=`Gives every volume segment a unique color.`;const NK={...MW({type:`colors`,colorList:`many-distinct`})};function rBe(e){return V.clone(NK)}function PK(e,t){let n,r,i=e.volume&&zP.Segmentation.get(e.volume);if(i){let e=i.segments.size,a=Array.from(i.segments.keys()),o=PW(e,t);r=o.legend,n=e=>zP.Segment.isLocation(e)?o.color(a.indexOf(e.segment)):MK}else n=()=>MK;return{factory:PK,granularity:`instance`,color:n,props:t,description:nBe,legend:r}}const iBe={name:`volume-segment`,label:`Volume Segment`,category:mM.Misc,factory:PK,getParams:rBe,defaultValues:V.getDefaultValues(NK),isApplicable:e=>!!e.volume&&!!zP.Segmentation.get(e.volume)};var aBe=`Assigns a color based on volume value at a given vertex.`;const FK={volume:V.ValueRef(e=>e.state.data.selectQ(e=>e.root.subtree().filter(e=>zP.is(e.obj?.data))).map(e=>[e.transform.ref,e.obj?.label??`<unknown>`]),(e,t)=>t(e)),coloring:V.MappedStatic(`absolute-value`,{"absolute-value":V.Group({domain:V.MappedStatic(`auto`,{custom:V.Interval([-1,1],{step:.001}),auto:V.Group({symmetric:V.Boolean(!1,{description:`If true the automatic range is determined as [-|max|, |max|].`})})}),list:V.ColorList(`red-white-blue`,{presetKind:`scale`})}),"relative-value":V.Group({domain:V.MappedStatic(`auto`,{custom:V.Interval([-1,1],{step:.001}),auto:V.Group({symmetric:V.Boolean(!1,{description:`If true the automatic range is determined as [-|max|, |max|].`})})}),list:V.ColorList(`red-white-blue`,{presetKind:`scale`})})}),defaultColor:V.Color(tE(13421772)),normalOffset:V.Numeric(0,{min:0,max:20,step:.1},{description:`Offset vertex position along its normal by given amount.`}),usePalette:V.Boolean(!1,{description:`Use a palette to color at the pixel level.`})};function IK(e,t){let n;try{n=t.volume.getValue()}catch{}let r,i,{normalOffset:a,defaultColor:o,usePalette:s}=t;if(n){let e=t.coloring.params,{stats:c}=n.grid,l=e.domain.name===`custom`?e.domain.params:[c.min,c.max],u=t.coloring.name===`relative-value`;if(e.domain.name===`auto`&&u&&(l[0]=(l[0]-c.mean)/c.sigma,l[1]=(l[1]-c.mean)/c.sigma),e.domain.name===`auto`&&e.domain.params.symmetric){let e=Math.max(Math.abs(l[0]),Math.abs(l[1]));l[0]=-e,l[1]=e}let d=Hk.create({domain:l,listOrName:e.list.colors}),f=B(),p=NP.makeGetTrilinearlyInterpolated(n.grid,u?`relative`:`none`);r=e=>{if(!ij(e))return o;a>0?B.scaleAndAdd(f,e.position,e.normal,a):B.copy(f,e.position);let t=p(f);return Number.isNaN(t)?o:s?DT((t-l[0])/(l[1]-l[0]),0,1)*YK.PaletteScale:d.color(t)},i=s?{colors:e.list.colors.map(e=>Array.isArray(e)?e[0]:e),filter:e.list.kind===`set`?`nearest`:`linear`}:void 0}else r=()=>o;return{factory:IK,granularity:`vertex`,preferSmoothing:!0,color:r,palette:i,props:t,description:aBe}}const oBe={name:`external-volume`,label:`External Volume`,category:mM.Misc,factory:IK,getParams:()=>FK,defaultValues:V.getDefaultValues(FK),isApplicable:e=>!0};var sBe=`Uses separate themes for coloring mainchain and sidechain visuals.`;const LK={mainchain:V.MappedStatic(`molecule-type`,{uniform:V.Group(gM),"chain-id":V.Group(IW),"entity-id":V.Group(XW),"entity-source":V.Group(tG),"molecule-type":V.Group(TG),"model-index":V.Group(sG),"structure-index":V.Group(uG),"secondary-structure":V.Group(JG),"trajectory-index":V.Group(_G)}),sidechain:V.MappedStatic(`residue-name`,{uniform:V.Group(gM),"residue-name":V.Group(VG),"element-symbol":V.Group(xG),hydrophobicity:V.Group(oK),uncertainty:V.Group(tK),occupancy:V.Group(uK),"sequence-id":V.Group(ZG),"partial-charge":V.Group(CK)})};function cBe(e){return V.clone(LK)}function lBe(e,t){switch(t.name){case`uniform`:return _M(e,t.params);case`chain-id`:return zW(e,t.params);case`entity-id`:return QW(e,t.params);case`entity-source`:return aG(e,t.params);case`molecule-type`:return DG(e,t.params);case`model-index`:return cG(e,t.params);case`structure-index`:return dG(e,t.params);case`secondary-structure`:return XG(e,t.params);case`trajectory-index`:return vG(e,t.params);default:Lb(t)}}function uBe(e,t){switch(t.name){case`uniform`:return _M(e,t.params);case`residue-name`:return GG(e,t.params);case`element-symbol`:return SG(e,t.params);case`hydrophobicity`:return lK(e,t.params);case`uncertainty`:return rK(e,t.params);case`occupancy`:return fK(e,t.params);case`sequence-id`:return eK(e,t.params);case`partial-charge`:return TK(e,t.params);default:Lb(t)}}function RK(e,t){let n=lBe(e,t.mainchain),r=uBe(e,t.sidechain),i=dE(n.contextHash??0,r.contextHash??0);function a(e,t){return t?n.color(e,!1):r.color(e,!1)}let o=n.legend;return n.legend?.kind===`table-legend`&&r.legend?.kind===`table-legend`&&(o={kind:`table-legend`,table:[...n.legend.table,...r.legend.table]}),{factory:RK,granularity:`group`,preferSmoothing:!1,color:a,props:t,contextHash:i,description:sBe,legend:o}}const dBe={name:`cartoon`,label:`Cartoon`,category:mM.Misc,factory:RK,getParams:cBe,defaultValues:V.getDefaultValues(LK),isApplicable:e=>!!e.structure};var zK=tE(16777113),fBe=`Assigns a color based on the formal charge of an atom.`;const BK={domain:V.Interval([-3,3]),list:V.ColorList({kind:`set`,colors:aE[`red-white-blue`].list})};function pBe(e){return BK}function VK(e,t){return Q.isAtomic(e)?e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(t):0}function HK(e,t){let n=Hk.create({domain:t.domain,listOrName:t.list.colors});function r(e){if(iL.is(e)){let t=VK(e.unit,e.element);return t===void 0?zK:n.color(t)}else if(fR.isLocation(e)){let t=VK(e.aUnit,e.aUnit.elements[e.aIndex]);return t===void 0?zK:n.color(t)}return zK}return{factory:HK,granularity:`group`,preferSmoothing:!0,color:r,props:t,description:fBe,legend:n?n.legend:void 0}}const mBe={name:`formal-charge`,label:`Formal Charge`,category:mM.Atom,factory:HK,getParams:pBe,defaultValues:V.getDefaultValues(BK),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicHierarchy.atoms.pdbx_formal_charge.isDefined)};var hBe=`Assigns a color based on structure property at a given vertex.`;const UK={structure:V.ValueRef(e=>e.state.data.select(FE.Generators.rootsOfType(H.Molecule.Structure)).filter(e=>e.obj?.data).map(e=>[e.transform.ref,e.obj?.label??`<unknown>`]),(e,t)=>t(e)),style:V.MappedStatic(`chain-id`,{"chain-id":V.Group(IW),"entity-id":V.Group(XW),"entity-source":V.Group(tG),"molecule-type":V.Group(TG),"model-index":V.Group(sG),"structure-index":V.Group(uG)}),defaultColor:V.Color(tE(13421772)),maxDistance:V.Numeric(8,{min:.1,max:24,step:.1},{description:`Maximum distance to search for the nearest structure element. This is done only if the approximate search fails.`}),approxMaxDistance:V.Numeric(4,{min:0,max:12,step:.1},{description:`Maximum distance to search for an approximately nearest structure element. This is done before the extact search.`}),normalOffset:V.Numeric(0,{min:-10,max:20,step:.1},{description:`Offset vertex position along its normal by given amount.`}),backboneOnly:V.Boolean(!1)};function gBe(e,t){switch(t.name){case`chain-id`:return zW(e,t.params);case`entity-id`:return QW(e,t.params);case`entity-source`:return aG(e,t.params);case`molecule-type`:return DG(e,t.params);case`model-index`:return cG(e,t.params);case`structure-index`:return dG(e,t.params);default:Lb(t)}}function WK(e,t){let n;try{n=t.structure.getValue()}catch{}let r,i,a,{maxDistance:o,approxMaxDistance:s,normalOffset:c,defaultColor:l,backboneOnly:u}=t;if(n){let d=gBe({...e,structure:n},t.style),f=IR(),p=IR(),m=n;u&&(m=VR.unionStructure(aU.backbone.query(new ZR(n))));let h=B(),g=iL.create(m);r=(e,t)=>{if(!ij(e))return l;c===0?B.copy(h,e.position):B.scaleAndAdd(h,e.position,e.normal,c);let[n,r,i]=h;if(s>0){let e=m.lookup3d.approxNearest(n,r,i,s,f);if(e.count>0)return g.unit=e.units[0],g.element=g.unit.elements[e.indices[0]],d.color(g,t)}let a=m.lookup3d.find(n,r,i,o,p);if(a.count>0){let e=0,n=a.squaredDistances[0];for(let t=1;t<a.count;++t)a.squaredDistances[t]<n&&(n=a.squaredDistances[t],e=t);return g.unit=a.units[e],g.element=g.unit.elements[a.indices[e]],d.color(g,t)}return l},i=d.contextHash,a=d.legend}else r=()=>l;return{factory:WK,granularity:`vertex`,preferSmoothing:!0,color:r,props:t,contextHash:i,description:hBe,legend:a}}const _Be={name:`external-structure`,label:`External Structure`,category:mM.Misc,factory:WK,getParams:()=>UK,defaultValues:V.getDefaultValues(UK),isApplicable:e=>!0};var GK=`dark-2`,KK=tE(13421772),vBe=`Gives every volume instance a unique color based on the position (index) of the instance in the list of instances of the volume.`;const qK={...MW({type:`colors`,colorList:GK})};function yBe(e){let t=V.clone(qK);return e.volume&&e.volume.instances.length>aE[GK].list.length&&(t.palette.defaultValue.name=`colors`,t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:`interpolate`,colors:sE(GK).list}}),t}function JK(e,t){let n,r;if(e.volume){let i=PW(e.volume.instances.length,t);r=i.legend;let a=zP.Cell.isLocation;n=e=>a(e)?i.color(e.instance):KK}else n=()=>KK;return{factory:JK,granularity:`instance`,color:n,props:t,description:vBe,legend:r}}const bBe={name:`volume-instance`,label:`Volume Instance`,category:mM.Misc,factory:JK,getParams:yBe,defaultValues:V.getDefaultValues(qK),isApplicable:e=>!!e.volume};var YK;(function(e){e.Category=mM;function t(e,t,n,r){let i=[];if(e.every(e=>Array.isArray(e))){let t=0;for(let n of e)if(Array.isArray(n)){let e=yO(n[1]);e>t&&(t=e)}let n=10**t,r=[...e];r.sort((e,t)=>e[1]-t[1]);let a=r.map(e=>e[0]),o=Vk.ofSortedArray(r.map(e=>e[1])),s=[];for(let e=0,t=o.length-1;e<t;++e)s.push(o[e]+(o[e+1]-o[e])/2);s.push(o[o.length-1]);let c=Vk.ofSortedArray(s);for(let t=0,r=Math.max(n,e.length);t<r;++t){let e=ET(t,0,n-1);i[t]=a[Vk.findPredecessorIndex(c,e)]}}else for(let t of e)Array.isArray(t)?i.push(t[0]):i.push(t);return{colors:i,filter:t===`set`?`nearest`:`linear`,domain:n,defaultColor:r}}e.Palette=t,e.PaletteScale=(1<<24)-2,e.EmptyFactory=()=>e.Empty;let n=tE(13421772);e.Empty={factory:e.EmptyFactory,granularity:`uniform`,color:()=>n,props:{}};function r(e,t){return e.contextHash===t.contextHash&&e.factory===t.factory&&Tx(e.props,t.props)}e.areEqual=r,e.EmptyProvider={name:``,label:``,category:``,factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function i(){return new cq(e.BuiltIn,e.EmptyProvider)}e.createRegistry=i,e.BuiltIn={"atom-id":$ze,"carbohydrate-symbol":pRe,cartoon:dBe,"chain-id":BW,"element-index":TRe,"element-symbol":aze,"entity-id":LRe,"entity-source":HRe,"external-structure":_Be,"external-volume":oBe,"formal-charge":mBe,hydrophobicity:Rze,illustrative:Nze,"model-index":GRe,"molecule-type":cze,occupancy:Hze,"operator-hkl":Gze,"operator-name":JW,"partial-charge":Jze,"polymer-id":dze,"polymer-index":mze,"residue-name":_ze,"secondary-structure":bze,"sequence-id":wze,"shape-group":oEe,"structure-index":JRe,"trajectory-index":eze,uncertainty:Oze,"unit-index":ZRe,uniform:Dwe,"volume-instance":bBe,"volume-segment":iBe,"volume-value":tBe}})(YK||={});var xBe=1,SBe=`Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.`;const XK={scale:V.Numeric(1,{min:.1,max:5,step:.1})};function CBe(e){return XK}function ZK(e,t){return Q.isAtomic(e)?WI(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Q.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function QK(e,t){let n=t.scale===void 0?1:t.scale;function r(e){let t;return t=iL.is(e)?n*ZK(e.unit,e.element):fR.isLocation(e)?n*Math.min(ZK(e.aUnit,e.aUnit.elements[e.aIndex]),ZK(e.bUnit,e.bUnit.elements[e.bIndex])):n*xBe,t}return{factory:QK,granularity:`group`,size:r,props:t,description:SBe}}const wBe={name:`physical`,label:`Physical`,category:``,factory:QK,getParams:CBe,defaultValues:V.getDefaultValues(XK),isApplicable:e=>!!e.structure};var TBe=`Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.`;const $K={bfactorFactor:V.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:V.Numeric(.05,{min:0,max:1,step:.01}),baseSize:V.Numeric(.2,{min:0,max:2,step:.1})};function EBe(e){return $K}function eq(e,t,n){return Q.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*n.bfactorFactor:Q.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*n.rmsfFactor:0}function tq(e,t){function n(e){let n=t.baseSize;return iL.is(e)?n+=eq(e.unit,e.element,t):fR.isLocation(e)&&(n+=eq(e.aUnit,e.aUnit.elements[e.aIndex],t)),n}return{factory:tq,granularity:`group`,size:n,props:t,description:TBe}}const DBe={name:`uncertainty`,label:`Uncertainty/Disorder`,category:``,factory:tq,getParams:EBe,defaultValues:V.getDefaultValues($K),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.B_iso_or_equiv.isDefined||e.coarseHierarchy.isDefined)};var nq=`Assign size based on the given value of a volume cell. Negative values are made positive.`;const rq={scale:V.Numeric(1,{min:.1,max:5,step:.1})};function OBe(e){return rq}function iq(e,t){if(e.volume){let{data:n}=e.volume.grid.cells,r=zP.Cell.isLocation;return{factory:iq,granularity:`group`,size:e=>r(e)?Math.abs(n[e.cell])*t.scale:0,props:t,description:nq}}else return{factory:iq,granularity:`uniform`,size:()=>t.scale,props:t,description:nq}}const kBe={name:`volume-value`,label:`Volume Value`,category:``,factory:iq,getParams:OBe,defaultValues:V.getDefaultValues(rq),isApplicable:e=>!!e.volume&&!zP.Segmentation.get(e.volume)};var aq;(function(e){e.EmptyFactory=()=>e.Empty,e.Empty={factory:e.EmptyFactory,granularity:`uniform`,size:()=>1,props:{}};function t(e,t){return e.contextHash===t.contextHash&&e.factory===t.factory&&Tx(e.props,t.props)}e.areEqual=t,e.EmptyProvider={name:``,label:``,category:``,factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function n(){return new cq(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={physical:wBe,"shape-group":nEe,uncertainty:DBe,uniform:Awe,"volume-value":kBe}})(aq||={});var oq;(function(e){function t(e,t,r,i){i||=n();let a=r.colorTheme,o=r.sizeTheme;return i.color=e.colorThemeRegistry.create(a.name,t,a.params),i.size=e.sizeThemeRegistry.create(o.name,t,o.params),i}e.create=t;function n(){return{color:YK.Empty,size:aq.Empty}}e.createEmpty=n;async function r(e,t,n,r){await t.colorThemeRegistry.get(r.colorTheme.name).ensureCustomProperties?.attach(e,n),await t.sizeThemeRegistry.get(r.sizeTheme.name).ensureCustomProperties?.attach(e,n)}e.ensureDependencies=r;function i(e,t,n){var r,i;(r=e.colorThemeRegistry.get(n.colorTheme.name).ensureCustomProperties)==null||r.detach(t),(i=e.sizeThemeRegistry.get(n.sizeTheme.name).ensureCustomProperties)==null||i.detach(t)}e.releaseDependencies=i})(oq||={});function sq(e){return e.map(e=>[e.name,e.provider.label,e.provider.category])}var cq=class{get default(){return this._list[0]}get list(){return this._list}get types(){return sq(this._list)}constructor(e,t){this.emptyProvider=t,this._list=[],this._map=new Map,this._name=new Map,WT(e,(e,t)=>{if(e.name!==t)throw Error(`Fix build in themes to have matching names. ${e.name} ${t}`);this.add(e)})}sort(){this._list.sort((e,t)=>e.provider.category===t.provider.category?e.provider.label<t.provider.label?-1:e.provider.label>t.provider.label?1:0:e.provider.category<t.provider.category?-1:1)}add(e){if(this._map.has(e.name))throw Error(`${e.name} already registered.`);let t=e.name;this._list.push({name:t,provider:e}),this._map.set(t,e),this._name.set(e,t),this.sort()}remove(e){this._list.splice(this._list.findIndex(t=>t.name===e.name),1);let t=this._map.get(e.name);t&&(this._map.delete(e.name),this._name.delete(t))}has(e){return this._map.has(e.name)}get(e){return this._map.get(e)||this.emptyProvider}getName(e){if(!this._name.has(e))throw Error(`'${e.label}' is not a registered theme provider.`);return this._name.get(e)}create(e,t,n={}){let r=this.get(e);return r.factory(t,{...V.getDefaultValues(r.getParams(t)),...n})}getApplicableList(e){return this._list.filter(t=>t.provider.isApplicable(e))}getApplicableTypes(e){return sq(this.getApplicableList(e))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}},lq;(function(e){e[e.None=0]=`None`,e[e.Highlight=1]=`Highlight`,e[e.RemoveHighlight=2]=`RemoveHighlight`,e[e.Select=4]=`Select`,e[e.Deselect=8]=`Deselect`,e[e.Toggle=16]=`Toggle`,e[e.Clear=32]=`Clear`})(lq||={});var uq;(function(e){e.is=_x.has,e.All=lq.Highlight|lq.RemoveHighlight|lq.Select|lq.Deselect|lq.Toggle|lq.Clear,e.Highlighting=lq.Highlight|lq.RemoveHighlight|lq.Clear,e.Selecting=lq.Select|lq.Deselect|lq.Toggle|lq.Clear;function t(e,t){return e===lq.Highlight&&t===lq.RemoveHighlight||e===lq.RemoveHighlight&&t===lq.Highlight||e===lq.Select&&t===lq.Deselect||e===lq.Deselect&&t===lq.Select||e===lq.Toggle&&t===lq.Toggle}e.isReverse=t})(uq||={});function ABe(e,t,n){e.fill(t,0,n)}function dq(e,t,n){switch(n){case lq.Highlight:e[t]|=1;break;case lq.RemoveHighlight:e[t]&=-2;break;case lq.Select:e[t]|=2;break;case lq.Deselect:e[t]&=-3;break;case lq.Toggle:e[t]^=2;break;case lq.Clear:e[t]=0;break}}function fq(e,t,n){if(n===lq.None)return!1;if(G.is(t)){let r=G.start(t),i=G.end(t),a=r+3>>2,o=a+(i-4*a>>2);if(o<=a){for(let t=r;t<i;++t)dq(e,t,n);return!0}let s=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),c=r,l=Math.min(4*a,i),u=Math.max(r,4*o),d=i;switch(n){case lq.Highlight:for(let e=a;e<o;++e)s[e]|=16843009;break;case lq.RemoveHighlight:for(let e=a;e<o;++e)s[e]&=-16843010;break;case lq.Select:for(let e=a;e<o;++e)s[e]|=33686018;break;case lq.Deselect:for(let e=a;e<o;++e)s[e]&=-33686019;break;case lq.Toggle:for(let e=a;e<o;++e)s[e]^=33686018;break;case lq.Clear:for(let e=a;e<o;++e)s[e]=0;break;default:Lb(n)}for(let t=c;t<l;++t)dq(e,t,n);for(let t=u;t<d;++t)dq(e,t,n)}else switch(n){case lq.Highlight:for(let n=0,r=t.length;n<r;++n)e[t[n]]|=1;break;case lq.RemoveHighlight:for(let n=0,r=t.length;n<r;++n)e[t[n]]&=-2;break;case lq.Select:for(let n=0,r=t.length;n<r;++n)e[t[n]]|=2;break;case lq.Deselect:for(let n=0,r=t.length;n<r;++n)e[t[n]]&=-3;break;case lq.Toggle:for(let n=0,r=t.length;n<r;++n)e[t[n]]^=2;break;case lq.Clear:for(let n=0,r=t.length;n<r;++n)e[t[n]]=0;break;default:Lb(n)}return!0}function jBe(e,t){let n=-1,r=-1;switch(e){case lq.Highlight:t===0||t===1?(n=1,r=1):t===2||t===3?(n=1,r=3):n=1;break;case lq.RemoveHighlight:t===0||t===1?(n=0,r=0):(t===2||t===3)&&(n=1,r=2);break;case lq.Select:t===1||t===3?(n=1,r=3):t===0||t===2?(n=1,r=2):n=1;break;case lq.Deselect:t===1||t===3?(n=1,r=1):(t===0||t===2)&&(n=0,r=0);break;case lq.Toggle:t===1?(n=1,r=3):t===2?(n=0,r=0):t===3?(n=1,r=1):t===0&&(n=1,r=2);break;case lq.Clear:n=0,r=0;break}return{average:n,status:r}}function MBe(e,t){switch(e){case lq.Highlight:return .5;case lq.RemoveHighlight:return t===0?0:t===2||t===3?.5:-1;case lq.Select:return .5;case lq.Deselect:return t===1||t===3?.5:t===0?0:-1;case lq.Toggle:return t===-1?-1:.5;case lq.Clear:return t===-1?-1:t===0?0:.5;case lq.None:return-1;default:Lb(e)}}const pq={kind:`every-loci`};function mq(e){return!!e&&e.kind===`every-loci`}const hq={kind:`empty-loci`};function gq(e){return!!e&&e.kind===`empty-loci`}function _q(e){return!!e&&e.kind===`data-loci`}function NBe(e,t){if(!Ex(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n)if(!Ex(e.elements[n],t.elements[n]))return!1;return!0}function PBe(e){return e.elements.length===0}function vq(e,t,n,r,i){return{kind:`data-loci`,tag:e,data:t,elements:n,getBoundingSphere:r,getLabel:i}}var yq;(function(e){let t=new RA(`98`);function n(e){let n=e.loci.map(e=>s(e)).filter(e=>!!e);t.reset();for(let e of n)t.includePositionRadius(e.center,e.radius);t.finishedIncludeStep();for(let e of n)t.radiusPositionRadius(e.center,e.radius);return t.getSphere()}e.getBundleBoundingSphere=n;function r(e,t){return mq(e)&&mq(t)||gq(e)&&gq(t)?!0:_q(e)&&_q(t)?NBe(e,t):nB.isLoci(e)&&nB.isLoci(t)?nB.areLociEqual(e,t):$.is(e)&&$.is(t)?$.areEqual(e,t):fR.isLoci(e)&&fR.isLoci(t)?fR.areLociEqual(e,t):jF.isLoci(e)&&jF.isLoci(t)?jF.areLociEqual(e,t):MF.isLoci(e)&&MF.isLoci(t)?MF.areLociEqual(e,t):zP.isLoci(e)&&zP.isLoci(t)?zP.areLociEqual(e,t):zP.Isosurface.isLoci(e)&&zP.Isosurface.isLoci(t)?zP.Isosurface.areLociEqual(e,t):zP.Cell.isLoci(e)&&zP.Cell.isLoci(t)?zP.Cell.areLociEqual(e,t):zP.Segment.isLoci(e)&&zP.Segment.isLoci(t)?zP.Segment.areLociEqual(e,t):!1}e.areEqual=r;function i(e){return!!e&&e.kind===`every-loci`}e.isEvery=i;function a(e){return mq(e)?!1:gq(e)?!0:_q(e)?PBe(e):nB.isLoci(e)?nB.isLociEmpty(e):$.is(e)?$.isEmpty(e):fR.isLoci(e)?fR.isLociEmpty(e):jF.isLoci(e)?jF.isLociEmpty(e):MF.isLoci(e)?MF.isLociEmpty(e):zP.isLoci(e)?zP.isLociEmpty(e):zP.Isosurface.isLoci(e)?zP.Isosurface.isLociEmpty(e):zP.Cell.isLoci(e)?zP.Cell.isLociEmpty(e):zP.Segment.isLoci(e)?zP.Segment.isLociEmpty(e):!1}e.isEmpty=a;function o(e,t){return t instanceof nB&&($.is(e)?e=$.remap(e,t):nB.isLoci(e)?e=nB.remapLoci(e,t):fR.isLoci(e)&&(e=fR.remapLoci(e,t))),e}e.remap=o;function s(e,t){if(!(e.kind===`every-loci`||e.kind===`empty-loci`)){if(t||=q(),e.kind===`structure-loci`)return q.copy(t,e.structure.boundary.sphere);if(e.kind===`element-loci`)return q.copy(t,$.getBoundary(e).sphere);if(e.kind===`bond-loci`)return fR.getBoundingSphere(e,t);if(e.kind===`shape-loci`)return q.copy(t,e.shape.geometry.boundingSphere);if(e.kind===`group-loci`)return MF.getBoundingSphere(e,t);if(e.kind===`data-loci`)return e.getBoundingSphere?.call(e,t);if(e.kind===`volume-loci`)return zP.getBoundingSphere(e.volume,t);if(e.kind===`isosurface-loci`)return zP.Isosurface.getBoundingSphere(e.volume,e.isoValue,t);if(e.kind===`cell-loci`)return zP.Cell.getBoundingSphere(e.volume,e.elements,t);if(e.kind===`segment-loci`)return zP.Segment.getBoundingSphere(e.volume,e.elements,t)}}e.getBoundingSphere=s;let c=q.zero();function l(e,t){let n=s(e,c);return n?B.copy(t||B(),n.center):void 0}e.getCenter=l;function u(e){if(!(e.kind===`every-loci`||e.kind===`empty-loci`)){if(e.kind===`structure-loci`)return $.getPrincipalAxes(nB.toStructureElementLoci(e.structure));if(e.kind===`element-loci`)return $.getPrincipalAxes(e);if(e.kind===`bond-loci`||e.kind===`shape-loci`||e.kind===`group-loci`||e.kind===`data-loci`||e.kind===`volume-loci`||e.kind===`isosurface-loci`||e.kind===`cell-loci`||e.kind===`segment-loci`)return}}e.getPrincipalAxes=u;let d={element:e=>e,residue:e=>$.is(e)?$.extendToWholeResidues(e,!0):e,chain:e=>$.is(e)?$.extendToWholeChains(e):e,entity:e=>$.is(e)?$.extendToWholeEntities(e):e,model:e=>$.is(e)?$.extendToWholeModels(e):e,operator:e=>$.is(e)?$.extendToWholeOperators(e):e,structure:e=>$.is(e)?nB.toStructureElementLoci(e.structure):MF.isLoci(e)?jF.Loci(e.shape):zP.Cell.isLoci(e)||zP.Isosurface.isLoci(e)?zP.Loci(e.volume,G.ofLength(e.volume.instances.length)):e,elementInstances:e=>$.is(e)?$.extendToAllInstances(e):e,residueInstances:e=>$.is(e)?$.extendToAllInstances($.extendToWholeResidues(e,!0)):e,chainInstances:e=>$.is(e)?$.extendToAllInstances($.extendToWholeChains(e)):e};e.GranularityOptions=V.objectToOptions(d,e=>{switch(e){case`element`:return`Atom/Coarse Element`;case`elementInstances`:return[`Atom/Coarse Element Instances`,`With Symmetry`];case`structure`:return`Structure/Shape`;default:return e.indexOf(`Instances`)?[JT(e),`With Symmetry`]:JT(e)}});function f(e){return e.replace(`Instances`,``)}e.simpleGranularity=f;function p(e,t){return d[t](e)}e.applyGranularity=p;function m(e,t,n=!1){return(t!==`element`||n)&&fR.isLoci(e)&&(e=fR.toStructureElementLoci(e)),nB.isLoci(e)&&(e=nB.toStructureElementLoci(e.structure)),$.is(e)&&(e=$.remap(e,e.structure.root)),t&&(e=p(e,t)),e}e.normalize=m})(yq||={});function bq(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:`empty-loci`,layers:[]};function t(e,t){if(e.layers.length===0&&t.layers.length===0)return!0;if(e.layers.length!==t.layers.length)return!1;for(let n=0,r=e.layers.length;n<r;++n)if(e.layers[n].clear!==t.layers[n].clear||e.layers[n].color!==t.layers[n].color||!yq.areEqual(e.layers[n].loci,t.layers[n].loci))return!1;return!0}e.areEqual=t;function n(e){return e.layers.length===0}e.isEmpty=n;function r(e,t){if(e.kind===`element-loci`){let n=[];for(let r of e.layers){let{loci:e,color:i,clear:a}=r;e=$.remap(e,t),$.isEmpty(e)||n.push({loci:e,color:i,clear:a})}return{kind:`element-loci`,layers:n}}else return e}e.remap=r;function i(e){if(n(e))return e;if(e.kind===`element-loci`){let{structure:t}=e.layers[0].loci,n=new Map,r=$.none(t);for(let t=0,i=e.layers.length;t<i;++t){let{loci:a,color:o,clear:s}=e.layers[i-t-1];if(a=$.subtract(a,r),r=$.union(a,r),!$.isEmpty(a)){let e=s?-1:o;n.has(e)&&(a=$.union(a,n.get(e))),n.set(e,a)}}let i=[];return n.forEach((e,t)=>{let n=t===-1,r=n?tE(0):t;i.push({loci:e,color:r,clear:n})}),{kind:`element-loci`,layers:i}}else return e}e.merge=i;function a(e,t){if(n(e))return e;if(e.kind===`element-loci`){let{structure:n}=e.layers[0].loci,r=[];for(let i of e.layers){let{loci:e,color:a,clear:o}=i,s=$.remap(e,t);e=$.remap(s,n),$.isEmpty(e)||r.push({loci:e,color:a,clear:o})}return{kind:`element-loci`,layers:r}}else return e}e.filter=a;function o(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{script:i,color:a,clear:o}=e[r],s=HH.toLoci(i,t);$.isEmpty(s)||n.push({loci:s,color:a,clear:o})}return{kind:`element-loci`,layers:n}}e.ofScript=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{bundle:i,color:a,clear:o}=e[r],s=qR.toLoci(i,t.root);n.push({loci:s,color:a,clear:o})}return{kind:`element-loci`,layers:n}}e.ofBundle=s;function c(e){let t=[];for(let n=0,r=e.layers.length;n<r;++n){let{loci:r,color:i,clear:a}=e.layers[n],o=qR.fromLoci(r);t.push({bundle:o,color:i,clear:a})}return{kind:`element-loci`,layers:t}}e.toBundle=c})(bq||={});function xq(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:`empty-loci`,layers:[]};function t(e,t){if(e.layers.length===0&&t.layers.length===0)return!0;if(e.layers.length!==t.layers.length)return!1;for(let n=0,r=e.layers.length;n<r;++n)if(e.layers[n].value!==t.layers[n].value||!yq.areEqual(e.layers[n].loci,t.layers[n].loci))return!1;return!0}e.areEqual=t;function n(e){return e.layers.length===0}e.isEmpty=n;function r(e,t){if(e.kind===`element-loci`){let n=[];for(let r of e.layers){let e=$.remap(r.loci,t);$.isEmpty(e)||n.push({loci:e,value:r.value})}return{kind:`element-loci`,layers:n}}else return e}e.remap=r;function i(e){if(n(e))return e;if(e.kind===`element-loci`){let{structure:t}=e.layers[0].loci,n=new Map,r=$.none(t);for(let t=0,i=e.layers.length;t<i;++t){let{loci:a,value:o}=e.layers[i-t-1];a=$.subtract(a,r),r=$.union(a,r),$.isEmpty(a)||(n.has(o)&&(a=$.union(a,n.get(o))),n.set(o,a))}let i=[];return n.forEach((e,t)=>{i.push({loci:e,value:t})}),{kind:`element-loci`,layers:i}}else return e}e.merge=i;function a(e,t){if(n(e))return e;if(e.kind===`element-loci`){let{structure:n}=e.layers[0].loci,r=[];for(let i of e.layers){let{loci:e,value:a}=i,o=$.remap(e,t);e=$.remap(o,n),$.isEmpty(e)||r.push({loci:e,value:a})}return{kind:`element-loci`,layers:r}}else return e}e.filter=a;function o(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{script:i,value:a}=e[r],o=HH.toLoci(i,t);$.isEmpty(o)||n.push({loci:o,value:a})}return{kind:`element-loci`,layers:n}}e.ofScript=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{bundle:i,value:a}=e[r],o=qR.toLoci(i,t.root);n.push({loci:o,value:a})}return{kind:`element-loci`,layers:n}}e.ofBundle=s;function c(e){let t=[];for(let n=0,r=e.layers.length;n<r;++n){let{loci:r,value:i}=e.layers[n],a=qR.fromLoci(r);t.push({bundle:a,value:i})}return{kind:`element-loci`,layers:t}}e.toBundle=c})(xq||={});function FBe(){if(typeof navigator>`u`||typeof window>`u`)return!1;let e=!1;return(function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)})(navigator.userAgent||navigator.vendor||window.opera),e}function Sq(){if(typeof navigator>`u`||typeof window>`u`)return!1;let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=navigator.userAgent.includes(`Macintosh`),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(e||t&&n)}function IBe(){if(typeof navigator>`u`||!(`xr`in navigator))return!1;let e=navigator.userAgent||``;return/OculusBrowser\//.test(e)||/PicoBrowser\//.test(e)}var Cq;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function n(e){e.updateTransform=!1,e.updateMatrix=!1,e.updateColor=!1,e.updateSize=!1,e.createGeometry=!1,e.createNew=!1}e.reset=n})(Cq||={});const LBe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};var wq;(function(e){e[e.Lowest=0]=`Lowest`,e[e.Lower=1]=`Lower`,e[e.Low=2]=`Low`,e[e.Medium=3]=`Medium`,e[e.High=4]=`High`,e[e.Higher=5]=`Higher`,e[e.Highest=6]=`Highest`})(wq||={});function RBe(e){switch(e){case`lowest`:return wq.Lowest;case`lower`:return wq.Lower;case`low`:return wq.Low;case`medium`:return wq.Medium;case`high`:return wq.High;case`higher`:return wq.Higher;case`highest`:return wq.Highest}}function Tq(e,t={}){let n={...LBe,...t},r=e.elementCount*n.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(r*=n.coarseGrainedFactor),r>n.lowestElementCount?`lowest`:r>n.lowerElementCount?`lower`:r>n.lowElementCount?`low`:r>n.mediumElementCount?`medium`:r>n.highElementCount?`high`:`higher`}function zBe(e){if(e.root.models.length===1){let t=bB.Provider.get(e.root.model);if(t&&t.spacegroup.name===`P 1`&&!oA.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return $k.volume(e.root.boundary.box)}function Eq(e,t){let n=Ox(e.quality,`auto`),r=Ox(e.detail,1),i=Ox(e.radialSegments,12),a=Ox(e.linearSegments,8),o=Ox(e.resolution,2),s=Ox(e.imageResolution,1),c=Ox(e.probePositions,12),l=Ox(e.doubleSided,!0),u=0;if(n===`auto`){if(t instanceof nB)n=Tq(t.root),u=zBe(t);else if(zP.is(t)){let[e,r,i]=t.grid.cells.space.dimensions;u=e*r*i,n=u<1e7?`medium`:`low`}}if(n!==`custom`&&n!==`auto`){let e=RBe(n);switch(IBe()&&(e=Math.max(e-1,wq.Lowest)),e){case wq.Highest:r=3,i=36,a=18,o=.1,s=.01,c=72,l=!0;break;case wq.Higher:r=3,i=28,a=14,o=.3,s=.05,c=48,l=!0;break;case wq.High:r=2,i=20,a=10,o=.5,s=.1,c=36,l=!0;break;case wq.Medium:r=1,i=12,a=8,o=.8,s=.2,c=24,l=!0;break;case wq.Low:r=0,i=8,a=3,o=1.3,s=.4,c=24,l=!1;break;case wq.Lower:r=0,i=4,a=2,o=3,s=.7,c=12,l=!1;break;case wq.Lowest:r=0,i=2,a=1,o=8,s=1,c=12,l=!1;break}}return u>0&&(o=Math.max(o,u/3e8),o=Math.min(o,20)),e.transparentBackfaces===`off`&&(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(l=!1),{detail:r,radialSegments:i,linearSegments:a,resolution:o,imageResolution:s,probePositions:c,doubleSided:l}}var Dq=BBe();function BBe(){let e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(r[e]=0,r[e|256]=32768,i[e]=24,i[e|256]=24):t<-14?(r[e]=1024>>-t-14,r[e|256]=1024>>-t-14|32768,i[e]=-t-1,i[e|256]=-t-1):t<=15?(r[e]=t+15<<10,r[e|256]=t+15<<10|32768,i[e]=13,i[e|256]=13):t<128?(r[e]=31744,r[e|256]=64512,i[e]=24,i[e|256]=24):(r[e]=31744,r[e|256]=64512,i[e]=13,i[e|256]=13)}let a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(t&8388608);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)o[e]=e<<23;o[31]=1199570944,o[32]=2147483648;for(let e=33;e<63;++e)o[e]=2147483648+(e-32<<23);o[63]=3347054592;for(let e=1;e<64;++e)e!==32&&(s[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:o,offsetTable:s}}function Oq(e){e=DT(e,-65504,65504),Dq.floatView[0]=e;let t=Dq.uint32View[0],n=t>>23&511;return Dq.baseTable[n]+((t&8388607)>>Dq.shiftTable[n])}var kq=B.set,Aq=B.normalize,jq=B.sub,Mq=B.addScalar,Nq=B.scale,Pq=B.toArray;function Fq(e,t,n,r){let i=!1,a=t.grid.cells.data.length;if(zP.isLoci(e)){if(!zP.areEquivalent(e.volume,t))return!1;if(G.is(e.instances)){let t=G.start(e.instances)*a,n=G.end(e.instances)*a;r(G.ofBounds(t,n))&&(i=!0)}else for(let t=0,n=e.instances.length;t<n;++t){let n=e.instances[t]*a;r(G.ofBounds(n,n+a))&&(i=!0)}}else if(zP.Isosurface.isLoci(e)){if(!zP.areEquivalent(e.volume,t))return!1;if(n?.isoValue){if(!zP.IsoValue.areSame(e.isoValue,n.isoValue,t.grid.stats))return!1;if(G.is(e.instances)){let t=G.start(e.instances)*a,n=G.end(e.instances)*a;r(G.ofBounds(t,n))&&(i=!0)}else for(let t=0,n=e.instances.length;t<n;++t){let n=e.instances[t]*a;r(G.ofBounds(n,n+a))&&(i=!0)}}else{let{stats:n,cells:{data:o}}=t.grid,s=n.sigma,c=zP.IsoValue.toAbsolute(e.isoValue,n).absoluteValue;for(let t=0,n=o.length;t<n;++t)wT(c,o[t],s)&&K.forEach(e.instances,e=>{let n=e*a;r(G.ofSingleton(n+t))&&(i=!0)})}}else if(zP.Cell.isLoci(e)){if(!zP.areEquivalent(e.volume,t))return!1;for(let{indices:t,instances:n}of e.elements)G.is(t)?K.forEach(n,e=>{let n=e*a;r(G.offset(t,n))&&(i=!0)}):K.forEach(t,e=>{K.forEach(n,t=>{let n=t*a;r(G.ofSingleton(n+e))&&(i=!0)})})}else if(zP.Segment.isLoci(e)){if(!zP.areEquivalent(e.volume,t))return!1;if(n?.segments)for(let{segments:t,instances:o}of e.elements)K.areIntersecting(t,n.segments)&&K.forEach(o,e=>{let t=e*a;r(G.ofBounds(t,t+a))&&(i=!0)});else{let n=zP.Segmentation.get(t);if(n){let o=new Set;for(let{segments:s,instances:c}of e.elements){for(let e=0,t=K.size(s);e<t;e++){let t=K.getAt(s,e);$F.add(o,n.segments.get(t))}let e=Array.from(o.values()),l=t.grid.cells.data;for(let t=0,n=l.length;t<n;++t)if(e.includes(l[t]))for(let e=0,n=K.size(c);e<n;e++){let n=e*a;r(G.ofSingleton(t+n))&&(i=!0)}}}}}return i}function Iq(e){let[t,n,r]=e.grid.cells.space.dimensions,i=t*n*r,a=e.instances.length,o=zP.Cell.Location(e);return tj(i,a,1,(e,t)=>(o.cell=e,o.instance=t,o))}function Lq(e,t=0){let n=e[0]*e[1]*e[2],r=Math.sqrt(n),i=2**Math.ceil(Math.log(r)/Math.log(2)),a=e[0]+t,o=e[1]+t,s=1,c=a;return i<a*e[2]?(c=Math.floor(i/a),s=Math.ceil(e[2]/c),a*=c,o*=s):a*=e[2],{width:a,height:o,columns:c,rows:s,powerOfTwoSize:o<i?i:i*2}}function Rq(e,t,n=0,r=`byte`){let{cells:{space:i,data:a},stats:{max:o,min:s}}=e.grid,c=i.dimensions,{dataOffset:l}=i,{width:u,height:d}=Lq(c,n),f=t===`data`?1:4,p=r===`byte`?new Uint8Array(u*d*f):r===`halfFloat`?new Uint16Array(u*d*f):new Float32Array(u*d*f),m={array:p,width:u,height:d},h=o-s,[g,_,v]=c,y=g+n,b=_+n,x=B(),S=B(),C=g-1,w=_-1,T=v-1;for(let e=0;e<v;++e)for(let n=0;n<_;++n)for(let i=0;i<g;++i){let o=Math.floor(e*y%u/y),c=Math.floor(e*y/u),d=o*y+i,m=f*(c*b*u+n*u+d),g=l(i,n,e),_;if(_=r===`byte`?Math.round((a[g]-s)/h*255):r===`halfFloat`?Oq((a[g]-s)/h):(a[g]-s)/h,t===`data`)p[m]=_;else{if(t===`groups`)if(r===`halfFloat`){let e=DT(Math.round(g),0,16777215)+1;p[m+2]=Oq(e%256),e=Math.floor(e/256),p[m+1]=Oq(e%256),e=Math.floor(e/256),p[m]=Oq(e%256)}else XN(g,p,m);else kq(x,a[l(Math.max(0,i-1),n,e)],a[l(i,Math.max(0,n-1),e)],a[l(i,n,Math.max(0,e-1))]),kq(S,a[l(Math.min(C,i+1),n,e)],a[l(i,Math.min(w,n+1),e)],a[l(i,n,Math.min(T,e+1))]),Aq(x,jq(x,x,S)),Mq(x,Nq(x,x,.5),.5),r===`byte`?Pq(Nq(x,x,255),p,m):r===`halfFloat`?(p[m]=Oq(x[0]),p[m+1]=Oq(x[1]),p[m+2]=Oq(x[2])):Pq(x,p,m);p[m+3]=_}}return m}function VBe(e,t=`byte`){let{cells:{space:n,data:r},stats:{max:i,min:a}}=e.grid,[o,s,c]=n.dimensions,{dataOffset:l}=n,u=t===`byte`?new Uint8Array(o*s*c*4):t===`halfFloat`?new Uint16Array(o*s*c*4):new Float32Array(o*s*c*4),d={array:u,width:o,height:s,depth:c},f=i-a,p=B(),m=B(),h=o-1,g=s-1,_=c-1,v=0;for(let e=0;e<c;++e)for(let n=0;n<s;++n)for(let i=0;i<o;++i){let o=l(i,n,e);kq(p,r[l(Math.max(0,i-1),n,e)],r[l(i,Math.max(0,n-1),e)],r[l(i,n,Math.max(0,e-1))]),kq(m,r[l(Math.min(h,i+1),n,e)],r[l(i,Math.min(g,n+1),e)],r[l(i,n,Math.min(_,e+1))]),Aq(p,jq(p,p,m)),Mq(p,Nq(p,p,.5),.5),t===`byte`?(Pq(Nq(p,p,255),u,v),u[v+3]=Math.round((r[o]-a)/f*255)):t===`halfFloat`?(u[v]=Oq(p[0]),u[v+1]=Oq(p[1]),u[v+2]=Oq(p[2]),u[v+3]=Oq((r[o]-a)/f)):(Pq(p,u,v),u[v+3]=(r[o]-a)/f),v+=4}return d}function HBe(e,t,n,r=0){let i=e.grid.cells.data,a=$k.size(B(),n),o=e.grid.cells.space.dataOffset,{width:s,height:c}=Lq(a,r),l=new Uint8Array(s*c*1),u={array:l,width:s,height:c},[d,f,p]=a,m=d-1,h=f-1,g=p-1,_=d+r,v=f+r,[y,b,x]=n.min,[S,C,w]=n.max;for(let e=0;e<p;++e)for(let n=0;n<f;++n)for(let r=0;r<d;++r){let a=Math.floor(e*_%s/_),c=Math.floor(e*_/s),u=a*_+r,d=1*(c*v*s+n*s+u),f=t.includes(i[o(r+y,n+b,e+x)])?255:0,p=t.includes(i[o(Math.min(m+S,r+1+y),n+b,e+x)])?255:0,T=t.includes(i[o(Math.max(0,r-1+y),n+b,e+x)])?255:0,E=t.includes(i[o(r+y,Math.min(h+C,n+1+b),e+x)])?255:0,D=t.includes(i[o(r+y,Math.max(0,n-1+b),e+x)])?255:0,O=t.includes(i[o(r+y,n+b,Math.min(g+w,e+1+x))])?255:0,k=t.includes(i[o(r+y,n+b,Math.max(0,e-1+x))])?255:0;l[d]=Math.round((f+f+p+T+E+D+O+k)/8)}return u}function zq(e){let{grid:t}=e,{space:n}=t.cells,{get:r,set:i,add:a,dataOffset:o}=n,[s,c,l]=n.dimensions,u=B.create(s+1,c+1,l+1),d=(e,t,n,i)=>r(e,t%s,n%c,i%l),f=(e,t,n,r,a)=>i(e,t%s,n%c,r%l,a),p=(e,t,n,r,i)=>a(e,t%s,n%c,r%l,i),m=(e,t,n)=>o(e%s,t%c,n%l),h={...n,dimensions:u,get:d,set:f,add:p,dataOffset:m},g={kind:`matrix`,matrix:NP.getGridToCartesianTransform(e.grid)},_={...t,transform:g,cells:{...t.cells,space:h}};return{...e,grid:_}}function Bq(e,t,n,r,i){let{colorType:a,vertexCount:o,groupCount:s,positionBuffer:c,instanceBuffer:l,transformBuffer:u,groupBuffer:d,itemSize:f}=e,p=a.endsWith(`Instance`),m=$k.fromSphere3D($k(),p?e.boundingSphere:e.invariantBoundingSphere),h=1+t,g=$k.expand($k(),m,B.create(h,h,h)),_=1/t,v=$k.scale($k(),g,_),y=$k.size(B(),v);B.ceil(y,y),B.add(y,y,B.create(2,2,2));let{min:b}=g,[x,S]=y,{width:C,height:w}=Lq(y),T=new Float32Array(C*w*f),E=new Float32Array(C*w),D=new Uint8Array(C*w*f),O={array:D,width:C,height:w,filter:`linear`},k=p?e.instanceCount:1,A=e.colorData.array;function j(e,t,n){let r=Math.floor(n*x%C/x),i=Math.floor(n*x/C),a=r*x+e;return f*(i*S*C+t*C+a)}let[M,N,ee]=y,te=B();for(let e=0;e<k;++e){let t=r?l[e]:e;for(let r=0;r<o;r+=n){B.fromArray(te,c,r*3),p&&B.transformMat4Offset(te,te,u,0,0,e*16),B.sub(te,te,b),B.scale(te,te,_);let[n,i,a]=te,o=Math.floor(n),l=Math.floor(i),m=Math.floor(a),h=(t*s+d[r])*f,g=Math.max(0,o-2),v=Math.max(0,l-2),y=Math.max(0,m-2),x=Math.min(M,o+2+2),S=Math.min(N,l+2+2),C=Math.min(ee,m+2+2);for(let e=g;e<x;++e){let t=e-n;for(let n=v;n<S;++n){let r=n-i;for(let i=y;i<C;++i){let o=i-a,s=Math.sqrt(t*t+r*r+o*o);if(s>2)continue;let c=2-s,l=j(e,n,i);for(let e=0;e<f;++e)T[l+e]+=A[h+e]*c;E[l/f]+=c}}}}}for(let e=0,t=E.length;e<t;++e){let t=e*f,n=E[e];for(let e=0;e<f;++e)D[t+e]=Math.round(T[t+e]/n)}let P=R.create(C,w),ne=AO.create(b[0],b[1],b[2],_),re=p?`volumeInstance`:`volume`;if(r){if(!i){let e=f===4?`rgba`:f===3?`rgb`:`alpha`;i=r.resources.texture(`image-uint8`,e,`ubyte`,`linear`)}return i.load(O),{kind:`volume`,texture:i,gridTexDim:P,gridDim:y,gridTransform:ne,type:re}}else{let e=UBe({vertexCount:o,instanceCount:k,transformBuffer:u,positionBuffer:c,colorType:re,grid:D,gridDim:y,gridTexDim:P,gridTransform:ne,vertexStride:3,colorStride:f,outputStride:f});return{kind:`vertex`,texture:e,texDim:R.create(e.width,e.height),type:p?`vertexInstance`:`vertex`}}}function UBe(e){let{vertexCount:t,positionBuffer:n,transformBuffer:r,grid:i,gridDim:a,gridTexDim:o,gridTransform:s,vertexStride:c,colorStride:l}=e,u=e.itemOffset||0,d=e.outputStride;if(d+u>l)throw Error(`outputStride + itemOffset must NOT be larger than colorStride`);let f=e.colorType.endsWith(`Instance`),p=f?e.instanceCount:1,m=WA(Math.max(1,p*t),d,Uint8Array),{array:h}=m,[g,_]=a,v=o[0],y=B.fromArray(B(),s,0),b=s[3];function x(e,t,n){let r=Math.floor(n*g%v/g),i=Math.floor(n*g/v),a=r*g+e;return l*(i*_*v+t*v+a)}let S=B(),C=B(),w=B(),T=B();for(let e=0;e<p;++e)for(let a=0;a<t;++a){B.fromArray(S,n,a*c),f&&B.transformMat4Offset(S,S,r,0,0,e*16),B.sub(S,S,y),B.scale(S,S,b),B.floor(C,S),B.ceil(w,S),B.sub(T,S,C),B.sub(S,w,C),B.div(T,T,S);let[o,s,l]=C,[p,m,g]=w,[_,v,E]=T,D=x(o,s,l)+u,O=x(p,s,l)+u,k=x(o,s,g)+u,A=x(p,s,g)+u,j=x(o,m,l)+u,M=x(p,m,l)+u,N=x(o,m,g)+u,ee=x(p,m,g)+u,te=(e*t+a)*d;for(let e=0;e<d;++e){let t=i[D+e],n=i[O+e],r=i[k+e],a=i[A+e],o=i[j+e],s=i[M+e],c=i[N+e],l=i[ee+e],u=OT(t,n,_),d=OT(r,a,_),f=OT(o,s,_),p=OT(c,l,_),m=OT(u,f,v),g=OT(d,p,v);h[te+e]=OT(m,g,E)}}return m}function WBe(e){return e===`group`||e===`groupInstance`}function Vq(e,t,n,r,i){if(!WBe(e.dColorType.ref.value))return;let a=Bq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,n,r,i);a.kind===`volume`?(L.updateIfChanged(e.dColorType,a.type),L.update(e.tColorGrid,a.texture),L.update(e.uColorTexDim,a.gridTexDim),L.update(e.uColorGridDim,a.gridDim),L.update(e.uColorGridTransform,a.gridTransform)):a.kind===`vertex`&&(L.updateIfChanged(e.dColorType,a.type),L.update(e.tColor,a.texture),L.update(e.uColorTexDim,a.texDim))}function GBe(e){return e===`groupInstance`}function KBe(e,t,n,r,i){if(!GBe(e.dOverpaintType.ref.value))return;let a=Bq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i);a.kind===`volume`?(L.updateIfChanged(e.dOverpaintType,a.type),L.update(e.tOverpaintGrid,a.texture),L.update(e.uOverpaintTexDim,a.gridTexDim),L.update(e.uOverpaintGridDim,a.gridDim),L.update(e.uOverpaintGridTransform,a.gridTransform)):a.kind===`vertex`&&(L.updateIfChanged(e.dOverpaintType,a.type),L.update(e.tOverpaint,a.texture),L.update(e.uOverpaintTexDim,a.texDim))}function qBe(e){return e===`groupInstance`}function JBe(e,t,n,r,i){if(!qBe(e.dTransparencyType.ref.value))return;let a=Bq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,n,r,i);a.kind===`volume`?(L.updateIfChanged(e.dTransparencyType,a.type),L.update(e.tTransparencyGrid,a.texture),L.update(e.uTransparencyTexDim,a.gridTexDim),L.update(e.uTransparencyGridDim,a.gridDim),L.update(e.uTransparencyGridTransform,a.gridTransform)):a.kind===`vertex`&&(L.updateIfChanged(e.dTransparencyType,a.type),L.update(e.tTransparency,a.texture),L.update(e.uTransparencyTexDim,a.texDim))}function YBe(e){return e===`groupInstance`}function XBe(e,t,n,r,i){if(!YBe(e.dEmissiveType.ref.value))return;let a=Bq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tEmissive.ref.value,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,n,r,i);a.kind===`volume`?(L.updateIfChanged(e.dEmissiveType,a.type),L.update(e.tEmissiveGrid,a.texture),L.update(e.uEmissiveTexDim,a.gridTexDim),L.update(e.uEmissiveGridDim,a.gridDim),L.update(e.uEmissiveGridTransform,a.gridTransform)):a.kind===`vertex`&&(L.updateIfChanged(e.dEmissiveType,a.type),L.update(e.tEmissive,a.texture),L.update(e.uEmissiveTexDim,a.texDim))}function ZBe(e){return e===`groupInstance`}function QBe(e,t,n,r,i){if(!ZBe(e.dSubstanceType.ref.value))return;let a=Bq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i);a.kind===`volume`?(L.updateIfChanged(e.dSubstanceType,a.type),L.update(e.tSubstanceGrid,a.texture),L.update(e.uSubstanceTexDim,a.gridTexDim),L.update(e.uSubstanceGridDim,a.gridDim),L.update(e.uSubstanceGridTransform,a.gridTransform)):a.kind===`vertex`&&(L.updateIfChanged(e.dSubstanceType,a.type),L.update(e.tSubstance,a.texture),L.update(e.uSubstanceTexDim,a.texDim))}const $Be={drawCount:JP(`number`),instanceCount:JP(`number`),stride:JP(`number`),uGroupCount:J(`i`,`material`),aTransform:WP(`float32`,16,1),aInstance:WP(`float32`,1,1),aSample:WP(`float32`,1,0),uGeoTexDim:J(`v2`,`material`),tPosition:GP(`texture`,`rgba`,`float`,`nearest`,`material`),tGroup:GP(`texture`,`rgba`,`float`,`nearest`,`material`),uColorTexDim:J(`v2`,`material`),tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`,`material`),dColorType:qP(`string`,[`group`,`groupInstance`,`vertex`,`vertexInstance`]),uCurrentSlice:J(`f`),uCurrentX:J(`f`),uCurrentY:J(`f`),uBboxMin:J(`v3`,`material`),uBboxSize:J(`v3`,`material`),uResolution:J(`f`,`material`)};var Hq=`color-accumulate`,Uq=`color-count`;function Wq(e,t){let n=new Float32Array(e);for(let r=0;r<e;++r)n[r]=r*t;return n}function eVe(e,t,n,r,i){if(e.namedComputeRenderables[Hq]){let a=B.sub(B(),n.max,n.min),o=e.namedComputeRenderables[Hq].values,s=Math.round(t.vertexCount/i);(s>o.drawCount.ref.value||i!==o.stride.ref.value)&&L.update(o.aSample,Wq(s,i)),L.updateIfChanged(o.drawCount,s),L.updateIfChanged(o.instanceCount,t.instanceCount),L.updateIfChanged(o.stride,i),L.updateIfChanged(o.uGroupCount,t.groupCount),L.update(o.aTransform,t.transformBuffer),L.update(o.aInstance,t.instanceBuffer),L.update(o.uGeoTexDim,R.set(o.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),L.update(o.tPosition,t.positionTexture),L.update(o.tGroup,t.groupTexture),L.update(o.uColorTexDim,R.set(o.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),L.update(o.tColor,t.colorData),L.updateIfChanged(o.dColorType,t.colorType),L.updateIfChanged(o.uCurrentSlice,0),L.updateIfChanged(o.uCurrentX,0),L.updateIfChanged(o.uCurrentY,0),L.update(o.uBboxMin,n.min),L.update(o.uBboxSize,a),L.updateIfChanged(o.uResolution,r),e.namedComputeRenderables[Hq].update()}else e.namedComputeRenderables[Hq]=tVe(e,t,n,r,i);return e.namedComputeRenderables[Hq]}function tVe(e,t,n,r,i){let a=B.sub(B(),n.max,n.min),o=Math.round(t.vertexCount/i),s={drawCount:L.create(o),instanceCount:L.create(t.instanceCount),stride:L.create(i),uGroupCount:L.create(t.groupCount),aTransform:L.create(t.transformBuffer),aInstance:L.create(t.instanceBuffer),aSample:L.create(Wq(o,i)),uGeoTexDim:L.create(R.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:L.create(t.positionTexture),tGroup:L.create(t.groupTexture),uColorTexDim:L.create(R.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:L.create(t.colorData),dColorType:L.create(t.colorType),uCurrentSlice:L.create(0),uCurrentX:L.create(0),uCurrentY:L.create(0),uBboxMin:L.create(n.min),uBboxSize:L.create(a),uResolution:L.create(r)},c={...$Be};return hF(aF(e,`points`,fj(`accumulate`,`
precision highp float;

#include common
#include read_from_texture

uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`,`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`,{drawBuffers:`required`}),c,s),s)}function nVe(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}const rVe={..._F,tColor:GP(`texture`,`rgba`,`float`,`nearest`),tCount:GP(`texture`,`alpha`,`float`,`nearest`),uTexSize:J(`v2`)};var Gq=`color-normalize`;function iVe(e,t,n){if(e.namedComputeRenderables[Gq]){let r=e.namedComputeRenderables[Gq].values;L.update(r.tColor,t),L.update(r.tCount,n),L.update(r.uTexSize,R.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[Gq].update()}else e.namedComputeRenderables[Gq]=aVe(e,t,n);return e.namedComputeRenderables[Gq]}function aVe(e,t,n){let r={...vF,tColor:L.create(t),tCount:L.create(n),uTexSize:L.create(R.create(t.getWidth(),t.getHeight()))},i={...rVe};return hF(aF(e,`triangles`,fj(`normalize`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`),i,r),r)}function oVe(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}function sVe(e){let t=e[0]*e[1]*e[2],n=Math.sqrt(t),r=2**Math.ceil(Math.log(n)/Math.log(2)),i=0,a=e[1],o=1,s=e[2];return r<e[0]*e[2]?(s=Math.floor(r/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<r?r:r*2}}function Kq(e,t,n,r,i){let{drawBuffers:a}=r.extensions;if(!a)throw Error(`need WebGL draw buffers`);$y&&r.timer.mark(`calcTextureMeshColorSmoothing`);let{gl:o,resources:s,state:c,extensions:{colorBufferHalfFloat:l,textureHalfFloat:u}}=r,d=e.colorType.endsWith(`Instance`),f=$k.fromSphere3D($k(),d?e.boundingSphere:e.invariantBoundingSphere),p=1+t,m=$k.expand($k(),f,B.create(p,p,p)),h=1/t,g=$k.scale($k(),m,h),_=$k.size(B(),g);B.ceil(_,_),B.add(_,_,B.create(2,2,2));let{min:v}=m,[y,b,x]=_,{texDimX:S,texDimY:C,texCols:w}=sVe(_);r.namedFramebuffers[Hq]||(r.namedFramebuffers[Hq]=r.resources.framebuffer());let T=r.namedFramebuffers[Hq];Bj(o)?(r.namedTextures[Hq]||(r.namedTextures[Hq]=l&&u?s.texture(`image-float16`,`rgba`,`fp16`,`nearest`):s.texture(`image-float32`,`rgba`,`float`,`nearest`)),r.namedTextures[Uq]||(r.namedTextures[Uq]=s.texture(`image-float32`,`alpha`,`float`,`nearest`))):(r.namedTextures[Hq]||(r.namedTextures[Hq]=s.texture(`image-float32`,`rgba`,`float`,`nearest`)),r.namedTextures[Uq]||(r.namedTextures[Uq]=s.texture(`image-float32`,`rgba`,`float`,`nearest`)));let E=r.namedTextures[Hq],D=r.namedTextures[Uq];E.define(S,C),D.define(S,C),E.attachFramebuffer(T,0),D.attachFramebuffer(T,1);let O=eVe(r,e,m,t,n);c.currentRenderItemId=-1,T.bind(),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]);let{uCurrentSlice:k,uCurrentX:A,uCurrentY:j}=O.values;$y&&r.timer.mark(`ColorAccumulate.render`),nVe(r),c.viewport(0,0,S,C),c.scissor(0,0,S,C),o.clear(o.COLOR_BUFFER_BIT),L.update(j,0);let M=0,N=0,ee=0;for(let e=0;e<x;++e)M>=w&&(M-=w,N+=b,ee=0,L.update(j,N)),L.update(A,ee),L.update(k,e),c.viewport(ee,N,y,b),c.scissor(ee,N,y,b),O.render(),++M,ee+=y;E.detachFramebuffer(T,0),D.detachFramebuffer(T,1),a.drawBuffers([o.COLOR_ATTACHMENT0,o.NONE]),$y&&r.timer.markEnd(`ColorAccumulate.render`),$y&&r.timer.mark(`ColorNormalize.render`),(!i||cwe(i))&&(i=s.texture(`image-uint8`,`rgba`,`ubyte`,`linear`)),i.define(S,C);let te=iVe(r,E,D);c.currentRenderItemId=-1,oVe(r),i.attachFramebuffer(T,0),c.viewport(0,0,S,C),c.scissor(0,0,S,C),o.clear(o.COLOR_BUFFER_BIT),te.render(),$y&&r.timer.markEnd(`ColorNormalize.render`);let P=AO.create(v[0],v[1],v[2],h),ne=d?`volumeInstance`:`volume`;return $y&&r.timer.markEnd(`calcTextureMeshColorSmoothing`),{texture:i,gridDim:_,gridTexDim:R.create(S,C),gridTransform:P,type:ne}}var qq=`color-smoothing-rgb`,Jq=`color-smoothing-rgba`,Yq=`color-smoothing-alpha`;function cVe(e){return e===`group`||e===`groupInstance`}function Xq(e,t,n,r,i){if(!cVe(e.dColorType.ref.value))return;n*=3,r.namedTextures[qq]||(r.namedTextures[qq]=r.resources.texture(`image-uint8`,`rgb`,`ubyte`,`nearest`));let a=r.namedTextures[qq];a.load(e.tColor.ref.value);let o=Kq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);L.updateIfChanged(e.dColorType,o.type),L.update(e.tColorGrid,o.texture),L.update(e.uColorTexDim,o.gridTexDim),L.update(e.uColorGridDim,o.gridDim),L.update(e.uColorGridTransform,o.gridTransform)}function lVe(e){return e===`groupInstance`}function uVe(e,t,n,r,i){if(!lVe(e.dOverpaintType.ref.value))return;n*=3,r.namedTextures[Jq]||(r.namedTextures[Jq]=r.resources.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`));let a=r.namedTextures[Jq];a.load(e.tOverpaint.ref.value);let o=Kq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);L.updateIfChanged(e.dOverpaintType,o.type),L.update(e.tOverpaintGrid,o.texture),L.update(e.uOverpaintTexDim,o.gridTexDim),L.update(e.uOverpaintGridDim,o.gridDim),L.update(e.uOverpaintGridTransform,o.gridTransform)}function dVe(e){return e===`groupInstance`}function fVe(e,t,n,r,i){if(!dVe(e.dTransparencyType.ref.value))return;n*=3,r.namedTextures[Yq]||(r.namedTextures[Yq]=r.resources.texture(`image-uint8`,`alpha`,`ubyte`,`nearest`));let a=r.namedTextures[Yq];a.load(e.tTransparency.ref.value);let o=Kq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);L.updateIfChanged(e.dTransparencyType,o.type),L.update(e.tTransparencyGrid,o.texture),L.update(e.uTransparencyTexDim,o.gridTexDim),L.update(e.uTransparencyGridDim,o.gridDim),L.update(e.uTransparencyGridTransform,o.gridTransform)}function pVe(e){return e===`groupInstance`}function mVe(e,t,n,r,i){if(!pVe(e.dEmissiveType.ref.value))return;n*=3,r.namedTextures[Yq]||(r.namedTextures[Yq]=r.resources.texture(`image-uint8`,`alpha`,`ubyte`,`nearest`));let a=r.namedTextures[Yq];a.load(e.tEmissive.ref.value);let o=Kq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);L.updateIfChanged(e.dEmissiveType,o.type),L.update(e.tEmissiveGrid,o.texture),L.update(e.uEmissiveTexDim,o.gridTexDim),L.update(e.uEmissiveGridDim,o.gridDim),L.update(e.uEmissiveGridTransform,o.gridTransform)}function hVe(e){return e===`groupInstance`}function gVe(e,t,n,r,i){if(!hVe(e.dSubstanceType.ref.value))return;n*=3,r.namedTextures[Jq]||(r.namedTextures[Jq]=r.resources.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`));let a=r.namedTextures[Jq];a.load(e.tSubstance.ref.value);let o=Kq({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);L.updateIfChanged(e.dSubstanceType,o.type),L.update(e.tSubstanceGrid,o.texture),L.update(e.uSubstanceTexDim,o.gridTexDim),L.update(e.uSubstanceGridDim,o.gridDim),L.update(e.uSubstanceGridTransform,o.gridTransform)}var Zq;(function(e){function t(e,t){e&&(e.state.visible=t)}e.setVisibility=t;function n(e,t){e&&(e.state.alphaFactor=t)}e.setAlphaFactor=n;function r(e,t){e&&(e.state.pickable=t)}e.setPickable=r;function i(e,t){e&&(e.state.colorOnly=t)}e.setColorOnly=i;function a(e,t,n,r,i){if(!e||gq(t))return!1;let{tMarker:a,uMarker:o,markerAverage:s,markerStatus:c,uGroupCount:l,instanceCount:u,instanceGranularity:d}=e.values,f=d.ref.value?u.ref.value:l.ref.value*u.ref.value,{array:p}=a.ref.value,m=c.ref.value;if(!mq(t)){let e=0;if(r(t,t=>(e+=G.size(t),!0),!0),e===0)return!1;e===f&&(t=pq)}let h=!1,g=-1,_=-1;if(mq(t)){let e=jBe(n,m);e.status===-1?h=fq(p,G.ofLength(f),n):(h=m!==e.status,h&&ABe(p,e.status,f)),g=e.average,_=e.status}else h=r(t,e=>fq(p,e,n),!0),h&&(g=MBe(n,m),i&&i.status!==-1&&g===-1&&uq.isReverse(i.action,n)&&yq.areEqual(t,i.loci)&&(_=i.status,g=_===0?0:.5));return h&&(g===-1&&(g=ZA(p,f),g===0&&(_=0)),i&&(i.action=n,i.loci=t,i.status=m),L.updateIfChanged(o,_),_===-1&&L.update(a,a.ref.value),L.updateIfChanged(s,g),L.updateIfChanged(c,_)),h}e.mark=a;function o(e,t,n,r,i){if(!e)return;let{tOverpaint:a,dOverpaintType:o,dOverpaint:s,uGroupCount:c,instanceCount:l,instanceGranularity:u}=e.values,d=u.ref.value?l.ref.value:c.ref.value*l.ref.value,f=u.ref.value?`instance`:`groupInstance`;Nwe(t.layers.length?d:0,f,e.values);let{array:p}=a.ref.value;r&&DM(p,0,d);for(let e=0,r=t.layers.length;e<r;++e){let{loci:r,color:i,clear:a}=t.layers[e];n(r,e=>{let t=G.start(e),n=G.end(e);return a?DM(p,t,n):Mwe(p,t,n,i)},!1)}if(L.update(a,a.ref.value),L.updateIfChanged(o,f),L.updateIfChanged(s,t.layers.length>0),t.layers.length!==0&&f!==`instance`&&i&&wM(i.props)){let{geometry:t,props:n,webgl:r}=i;if(t.kind===`mesh`){let{resolution:i,overpaintTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(KBe(e.values,o.resolution,o.stride,r,a),t.meta.overpaintTexture=e.values.tOverpaintGrid.ref.value)}else if(r&&t.kind===`texture-mesh`){let{resolution:i,overpaintTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(uVe(e.values,o.resolution,o.stride,r,a),t.meta.overpaintTexture=e.values.tOverpaintGrid.ref.value)}}}e.setOverpaint=o;function s(e,t,n,r,i){if(!e)return;let{tTransparency:a,dTransparencyType:o,transparencyAverage:s,transparencyMin:c,dTransparency:l,uGroupCount:u,instanceCount:d,instanceGranularity:f}=e.values,p=f.ref.value?d.ref.value:u.ref.value*d.ref.value,m=f.ref.value?`instance`:`groupInstance`;Iwe(t.layers.length?p:0,m,e.values);let{array:h}=a.ref.value;r&&Fwe(h,0,p);for(let e=0,r=t.layers.length;e<r;++e){let{loci:r,value:i}=t.layers[e];n(r,e=>Pwe(h,G.start(e),G.end(e),i),!1)}if(L.update(a,a.ref.value),L.updateIfChanged(s,AM(h,p)),L.updateIfChanged(c,jM(h,p)),L.updateIfChanged(o,m),L.updateIfChanged(l,t.layers.length>0),t.layers.length!==0&&m!==`instance`&&i&&wM(i.props)){let{geometry:t,props:n,webgl:r}=i;if(t.kind===`mesh`){let{resolution:i,transparencyTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(JBe(e.values,o.resolution,o.stride,r,a),t.meta.transparencyTexture=e.values.tTransparencyGrid.ref.value)}else if(r&&t.kind===`texture-mesh`){let{resolution:i,transparencyTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(fVe(e.values,o.resolution,o.stride,r,a),t.meta.transparencyTexture=e.values.tTransparencyGrid.ref.value)}}}e.setTransparency=s;function c(e,t,n,r,i){if(!e)return;let{tEmissive:a,dEmissiveType:o,emissiveAverage:s,dEmissive:c,uGroupCount:l,instanceCount:u,instanceGranularity:d}=e.values,f=d.ref.value?u.ref.value:l.ref.value*u.ref.value,p=d.ref.value?`instance`:`groupInstance`;Wwe(t.layers.length?f:0,p,e.values);let{array:m}=a.ref.value;r&&Uwe(m,0,f);for(let e=0,r=t.layers.length;e<r;++e){let{loci:r,value:i}=t.layers[e];n(r,e=>Hwe(m,G.start(e),G.end(e),i),!1)}if(L.update(a,a.ref.value),L.updateIfChanged(s,zM(m,f)),L.updateIfChanged(o,p),L.updateIfChanged(c,t.layers.length>0),t.layers.length!==0&&p!==`instance`&&i&&wM(i.props)){let{geometry:t,props:n,webgl:r}=i;if(t.kind===`mesh`){let{resolution:i,emissiveTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(XBe(e.values,o.resolution,o.stride,r,a),t.meta.emissiveTexture=e.values.tEmissiveGrid.ref.value)}else if(r&&t.kind===`texture-mesh`){let{resolution:i,emissiveTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(mVe(e.values,o.resolution,o.stride,r,a),t.meta.emissiveTexture=e.values.tEmissiveGrid.ref.value)}}}e.setEmissive=c;function l(e,t,n,r,i){if(!e)return;let{tSubstance:a,dSubstanceType:o,dSubstance:s,uGroupCount:c,instanceCount:l,instanceGranularity:u}=e.values,d=u.ref.value?l.ref.value:c.ref.value*l.ref.value,f=u.ref.value?`instance`:`groupInstance`;Vwe(t.layers.length?d:0,f,e.values);let{array:p}=a.ref.value;r&&IM(p,0,d);for(let e=0,r=t.layers.length;e<r;++e){let{loci:r,material:i,clear:a}=t.layers[e];n(r,e=>{let t=G.start(e),n=G.end(e);return a?IM(p,t,n):Bwe(p,t,n,i)},!1)}if(L.update(a,a.ref.value),L.updateIfChanged(o,f),L.updateIfChanged(s,t.layers.length>0),t.layers.length!==0&&f!==`instance`&&i&&wM(i.props)){let{geometry:t,props:n,webgl:r}=i;if(t.kind===`mesh`){let{resolution:i,substanceTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(QBe(e.values,o.resolution,o.stride,r,a),t.meta.substanceTexture=e.values.tSubstanceGrid.ref.value)}else if(r&&t.kind===`texture-mesh`){let{resolution:i,substanceTexture:a}=t.meta,o=TM(n.smoothColors,!0,i);o&&(gVe(e.values,o.resolution,o.stride,r,a),t.meta.substanceTexture=e.values.tSubstanceGrid.ref.value)}}}e.setSubstance=l;function u(e,t,n,r){if(!e)return;let{tClipping:i,dClippingType:a,dClipping:o,uGroupCount:s,instanceCount:c,instanceGranularity:l}=e.values,u=l.ref.value?c.ref.value:s.ref.value*c.ref.value,{layers:d}=t,f=l.ref.value?`instance`:`groupInstance`;zwe(d.length?u:0,f,e.values);let{array:p}=i.ref.value;r&&Rwe(p,0,u);for(let e=0,r=t.layers.length;e<r;++e){let{loci:r,groups:i}=t.layers[e];n(r,e=>Lwe(p,G.start(e),G.end(e),i),!1)}L.update(i,i.ref.value),L.updateIfChanged(a,f),L.updateIfChanged(o,t.layers.length>0)}e.setClipping=u;function d(e,t){e&&(L.updateIfChanged(e.values.uOverpaintStrength,t.overpaint),L.updateIfChanged(e.values.uTransparencyStrength,t.transparency),L.updateIfChanged(e.values.uEmissiveStrength,t.emissive),L.updateIfChanged(e.values.uSubstanceStrength,t.substance))}e.setThemeStrength=d;function f(e,t,n){if(!e||!t&&!n)return;let{values:r}=e;t&&(z.copy(r.matrix.ref.value,t),L.update(r.matrix,r.matrix.ref.value)),n?(r.extraTransform.ref.value.set(n),L.update(r.extraTransform,r.extraTransform.ref.value)):n===null&&(fM(r.extraTransform.ref.value,r.instanceCount.ref.value),L.update(r.extraTransform,r.extraTransform.ref.value)),pM(r,r.invariantBoundingSphere.ref.value,r.instanceGrid.ref.value.cellSize,r.instanceGrid.ref.value.batchSize);let i=YA(r.invariantBoundingSphere.ref.value,r.transform.ref.value,r.instanceCount.ref.value,0);L.update(r.boundingSphere,i)}e.setTransform=f})(Zq||={});function Qq(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:`empty-loci`,layers:[]},(function(e){e.is=_x.has;let t;(function(e){e[e.None=0]=`None`,e[e.One=1]=`One`,e[e.Two=2]=`Two`,e[e.Three=4]=`Three`,e[e.Four=8]=`Four`,e[e.Five=16]=`Five`,e[e.Six=32]=`Six`})(t=e.Flag||={});function n(e){return _x.create(e)}e.create=n,e.Names={one:t.One,two:t.Two,three:t.Three,four:t.Four,five:t.Five,six:t.Six};function r(t){return t in e.Names}e.isName=r;function i(e){switch(e){case`one`:return t.One;case`two`:return t.Two;case`three`:return t.Three;case`four`:return t.Four;case`five`:return t.Five;case`six`:return t.Six}}e.fromName=i;function a(e){let n=t.None;for(let t=0,r=e.length;t<r;++t)n|=i(e[t]);return n}e.fromNames=a;function o(n){let r=[];return e.is(n,t.One)&&r.push(`one`),e.is(n,t.Two)&&r.push(`two`),e.is(n,t.Three)&&r.push(`three`),e.is(n,t.Four)&&r.push(`four`),e.is(n,t.Five)&&r.push(`five`),e.is(n,t.Six)&&r.push(`six`),r}e.toNames=o})(e.Groups||={});function t(e,t){if(e.layers.length!==t.layers.length)return!1;for(let n=0,r=e.layers.length;n<r;++n)if(e.layers[n].groups!==t.layers[n].groups||!yq.areEqual(e.layers[n].loci,t.layers[n].loci))return!1;return!0}e.areEqual=t;function n(e){return e.layers.length===0}e.isEmpty=n;function r(e,t){if(e.kind===`element-loci`){let n=[];for(let r of e.layers){let{loci:e,groups:i}=r;e=$.remap(e,t),$.isEmpty(e)||n.push({loci:e,groups:i})}return{kind:`element-loci`,layers:n}}else return e}e.remap=r;function i(e){if(n(e))return e;if(e.kind===`element-loci`){let{structure:t}=e.layers[0].loci,n=new Map,r=$.none(t);for(let t=0,i=e.layers.length;t<i;++t){let{loci:a,groups:o}=e.layers[i-t-1];a=$.subtract(a,r),r=$.union(a,r),$.isEmpty(a)||(n.has(o)&&(a=$.union(a,n.get(o))),n.set(o,a))}let i=[];return n.forEach((e,t)=>{i.push({loci:e,groups:t})}),{kind:`element-loci`,layers:i}}else return e}e.merge=i;function a(e,t){if(n(e))return e;if(e.kind===`element-loci`){let{structure:n}=e.layers[0].loci,r=[];for(let i of e.layers){let{loci:e,groups:a}=i,o=$.remap(e,t);e=$.remap(o,n),$.isEmpty(e)||r.push({loci:e,groups:a})}return{kind:`element-loci`,layers:r}}else return e}e.filter=a;function o(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{script:i,groups:a}=e[r],o=HH.toLoci(i,t);$.isEmpty(o)||n.push({loci:o,groups:a})}return{kind:`element-loci`,layers:n}}e.ofScript=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{bundle:i,groups:a}=e[r],o=qR.toLoci(i,t.root);n.push({loci:o,groups:a})}return{kind:`element-loci`,layers:n}}e.ofBundle=s;function c(e){let t=[];for(let n=0,r=e.layers.length;n<r;++n){let{loci:r,groups:i}=e.layers[n],a=qR.fromLoci(r);t.push({bundle:a,groups:i})}return{kind:`element-loci`,layers:t}}e.toBundle=c})(Qq||={});function $q(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:`empty-loci`,layers:[]};function t(e,t){if(e.layers.length===0&&t.layers.length===0)return!0;if(e.layers.length!==t.layers.length)return!1;for(let n=0,r=e.layers.length;n<r;++n)if(e.layers[n].clear!==t.layers[n].clear||!HT(e.layers[n].material,t.layers[n].material)||!yq.areEqual(e.layers[n].loci,t.layers[n].loci))return!1;return!0}e.areEqual=t;function n(e){return e.layers.length===0}e.isEmpty=n;function r(e,t){if(e.kind===`element-loci`){let n=[];for(let r of e.layers){let{loci:e,material:i,clear:a}=r;e=$.remap(e,t),$.isEmpty(e)||n.push({loci:e,material:i,clear:a})}return{kind:`element-loci`,layers:n}}else return e}e.remap=r;function i(e){if(n(e))return e;if(e.kind===`element-loci`){let{structure:t}=e.layers[0].loci,n,r=new Map,i=$.none(t);for(let t=0,a=e.layers.length;t<a;++t){let{loci:o,material:s,clear:c}=e.layers[a-t-1];o=$.subtract(o,i),i=$.union(o,i),$.isEmpty(o)||(c?n=n?$.union(o,n):o:(r.has(s)&&(o=$.union(o,r.get(s))),r.set(s,o)))}let a=[];return n&&a.push({loci:n,material:bM(),clear:!0}),r.forEach((e,t)=>{a.push({loci:e,material:t,clear:!1})}),{kind:`element-loci`,layers:a}}else return e}e.merge=i;function a(e,t){if(n(e))return e;if(e.kind===`element-loci`){let{structure:n}=e.layers[0].loci,r=[];for(let i of e.layers){let{loci:e,material:a,clear:o}=i,s=$.remap(e,t);e=$.remap(s,n),$.isEmpty(e)||r.push({loci:e,material:a,clear:o})}return{kind:`element-loci`,layers:r}}else return e}e.filter=a;function o(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{script:i,material:a,clear:o}=e[r],s=HH.toLoci(i,t);$.isEmpty(s)||n.push({loci:s,material:a,clear:o})}return{kind:`element-loci`,layers:n}}e.ofScript=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{bundle:i,material:a,clear:o}=e[r],s=qR.toLoci(i,t.root);n.push({loci:s,material:a,clear:o})}return{kind:`element-loci`,layers:n}}e.ofBundle=s;function c(e){let t=[];for(let n=0,r=e.layers.length;n<r;++n){let{loci:r,material:i,clear:a}=e.layers[n],o=qR.fromLoci(r);t.push({bundle:o,material:i,clear:a})}return{kind:`element-loci`,layers:t}}e.toBundle=c})($q||={});function eJ(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:`empty-loci`,layers:[]};function t(e,t){if(e.layers.length===0&&t.layers.length===0)return!0;if(e.layers.length!==t.layers.length)return!1;for(let n=0,r=e.layers.length;n<r;++n)if(e.layers[n].value!==t.layers[n].value||!yq.areEqual(e.layers[n].loci,t.layers[n].loci))return!1;return!0}e.areEqual=t;function n(e){return e.layers.length===0}e.isEmpty=n;function r(e,t){if(e.kind===`element-loci`){let n=[];for(let r of e.layers){let{loci:e,value:i}=r;e=$.remap(e,t),$.isEmpty(e)||n.push({loci:e,value:i})}return{kind:`element-loci`,layers:n}}else return e}e.remap=r;function i(e){if(n(e))return e;if(e.kind===`element-loci`){let{structure:t}=e.layers[0].loci,n=new Map,r=$.none(t);for(let t=0,i=e.layers.length;t<i;++t){let{loci:a,value:o}=e.layers[i-t-1];a=$.subtract(a,r),r=$.union(a,r),$.isEmpty(a)||(n.has(o)&&(a=$.union(a,n.get(o))),n.set(o,a))}let i=[];return n.forEach((e,t)=>{i.push({loci:e,value:t})}),{kind:`element-loci`,layers:i}}else return e}e.merge=i;function a(e,t){if(n(e))return e;if(e.kind===`element-loci`){let{structure:n}=e.layers[0].loci,r=[];for(let i of e.layers){let{loci:e,value:a}=i,o=$.remap(e,t);e=$.remap(o,n),$.isEmpty(e)||r.push({loci:e,value:a})}return{kind:`element-loci`,layers:r}}else return e}e.filter=a;function o(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{script:i,value:a}=e[r],o=HH.toLoci(i,t);$.isEmpty(o)||n.push({loci:o,value:a})}return{kind:`element-loci`,layers:n}}e.ofScript=o;function s(e,t){let n=[];for(let r=0,i=e.length;r<i;++r){let{bundle:i,value:a}=e[r],o=qR.toLoci(i,t.root);n.push({loci:o,value:a})}return{kind:`element-loci`,layers:n}}e.ofBundle=s;function c(e){let t=[];for(let n=0,r=e.layers.length;n<r;++n){let{loci:r,value:i}=e.layers[n],a=qR.fromLoci(r);t.push({bundle:a,value:i})}return{kind:`element-loci`,layers:t}}e.toBundle=c})(eJ||={});var _Ve;(function(e){function t(e,t,n){return V.getDefaultValues(e.getParams(t,n))}e.getDefaultParams=t})(_Ve||={});const vVe={name:``,label:``,description:``,factory:()=>rJ.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:{name:``},defaultSizeTheme:{name:``},isApplicable:()=>!0};function tJ(e){return e.map(e=>[e.name,e.provider.label])}var nJ=class{get default(){return this._list[0]}get types(){return tJ(this._list)}constructor(){this._list=[],this._map=new Map,this._name=new Map}add(e){if(this._map.has(e.name))throw Error(`${e.name} already registered.`);this._list.push({name:e.name,provider:e}),this._map.set(e.name,e),this._name.set(e,e.name)}getName(e){if(!this._name.has(e))throw Error(`'${e.label}' is not a registered represenatation provider.`);return this._name.get(e)}remove(e){let t=e.name;this._list.splice(this._list.findIndex(e=>e.name===t),1);let n=this._map.get(t);n&&(this._map.delete(t),this._name.delete(n))}get(e){return this._map.get(e)||vVe}get list(){return this._list}getApplicableList(e){return this._list.filter(t=>t.provider.isApplicable(e))}getApplicableTypes(e){return tJ(this.getApplicableList(e))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}},rJ;(function(e){(function(e){function t(e,t){return e.repr===t.repr&&yq.areEqual(e.loci,t.loci)}e.areEqual=t;function n(e){return yq.isEmpty(e.loci)}e.isEmpty=n,e.Empty={loci:hq}})(e.Loci||={});function t(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:z.identity(),overpaint:bq.Empty,transparency:xq.Empty,emissive:eJ.Empty,substance:$q.Empty,clipping:Qq.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:uq.All}}e.createState=t;function n(e,t){t.visible!==void 0&&(e.visible=t.visible),t.alphaFactor!==void 0&&(e.alphaFactor=t.alphaFactor),t.pickable!==void 0&&(e.pickable=t.pickable),t.colorOnly!==void 0&&(e.colorOnly=t.colorOnly),t.overpaint!==void 0&&(e.overpaint=t.overpaint),t.transparency!==void 0&&(e.transparency=t.transparency),t.emissive!==void 0&&(e.emissive=t.emissive),t.substance!==void 0&&(e.substance=t.substance),t.clipping!==void 0&&(e.clipping=t.clipping),t.themeStrength!==void 0&&(e.themeStrength=t.themeStrength),t.syncManually!==void 0&&(e.syncManually=t.syncManually),t.transform!==void 0&&z.copy(e.transform,t.transform),t.markerActions!==void 0&&(e.markerActions=t.markerActions)}e.updateState=n,e.StateBuilder={create:t,update:n};function r(){return{label:``,groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new sD,state:t(),theme:oq.createEmpty(),createOrUpdate:()=>hb.constant(``,void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>hq,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}}}e.createEmpty=r;class i{constructor(){this.curr=new Set,this.next=new Set,this._version=-1}get version(){return this._version}add(e,t){this.next.add(pE(e,t))}snapshot(){$F.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}e.GeometryState=i;function a(e,t,n,r,a){let o=0,s=new sD,c=new i,l=r.create(),u=oq.createEmpty(),d,f,p,m={},h=Object.keys(a).map((e,r)=>{m[r]=e;let i=a[e](t,n);return i.setState(l),i});return{label:e,updated:s,get groupCount(){let e=0;if(f){let{visuals:t}=f;for(let n=0,r=h.length;n<r;++n)(!t||t.includes(m[n]))&&(e+=h[n].groupCount)}return e},get renderObjects(){let e=[];if(f){let{visuals:t}=f;for(let n=0,r=h.length;n<r;++n)(!t||t.includes(m[n]))&&e.push(...h[n].renderObjects)}return e},get geometryVersion(){return c.version},get props(){return f},get params(){return d},createOrUpdate:(r={},i)=>{i&&i!==p&&(d=n(t,i),p=i,f||=V.getDefaultValues(d));let a=Eq(Object.assign({},f,r),p);Object.assign(f,r,a);let{visuals:l}=f;return hb.create(`Creating or updating '${e}' representation`,async e=>{for(let t=0,n=h.length;t<n;++t)(!l||l.includes(m[t]))&&await h[t].createOrUpdate(f,p).runInContext(e),c.add(t,h[t].geometryVersion);c.snapshot(),s.next(o++)})},get state(){return l},get theme(){return u},getLoci:e=>{let{visuals:t}=f;for(let n=0,r=h.length;n<r;++n)if(!t||t.includes(m[n])){let t=h[n].getLoci(e);if(!gq(t))return t}return hq},getAllLoci:()=>{let e=[],{visuals:t}=f;for(let n=0,r=h.length;n<r;++n)(!t||t.includes(m[n]))&&e.push(...h[n].getAllLoci());return e},eachLocation:e=>{let{visuals:t}=f;for(let n=0,r=h.length;n<r;++n)(!t||t.includes(m[n]))&&h[n].eachLocation(e)},mark:(e,t)=>{let n=!1;for(let r=0,i=h.length;r<i;++r)n=h[r].mark(e,t)||n;return n},setState:e=>{r.update(l,e);for(let t=0,n=h.length;t<n;++t)h[t].setState(e)},setTheme:e=>{u=e;for(let t=0,n=h.length;t<n;++t)h[t].setTheme(e)},destroy(){for(let e=0,t=h.length;e<t;++e)h[e].destroy()}}}e.createMulti=a;function o(t,n){let r=0,a=new sD,o=new i,s=e.createState(),c=oq.createEmpty(),l=V.clone(EM.Params),u=V.getDefaultValues(EM.Params);return{label:t,updated:a,get groupCount(){return n.values.uGroupCount.ref.value},get renderObjects(){return[n]},get geometryVersion(){return o.version},get props(){return u},get params(){return l},createOrUpdate:(e={})=>{let i=Eq(Object.assign({},u,e));return Object.assign(u,e,i),hb.create(`Updating '${t}' representation`,async e=>{o.add(0,n.id),o.snapshot(),a.next(r++)})},get state(){return s},get theme(){return c},getLoci:()=>hq,getAllLoci:()=>[],eachLocation:()=>{},mark:(e,t)=>!1,setState:t=>{t.visible!==void 0&&Zq.setVisibility(n,t.visible),t.alphaFactor!==void 0&&Zq.setAlphaFactor(n,t.alphaFactor),t.pickable!==void 0&&Zq.setPickable(n,t.pickable),t.colorOnly!==void 0&&Zq.setColorOnly(n,t.colorOnly),t.overpaint,t.transparency,t.emissive,t.substance,t.clipping,t.themeStrength!==void 0&&Zq.setThemeStrength(n,t.themeStrength),t.transform!==void 0&&Zq.setTransform(n,t.transform),e.updateState(s,t)},setTheme:()=>{},destroy(){}}}e.fromRenderObject=o})(rJ||={});var yVe=void 0;Object.defineProperty(rJ,`Empty`,{get:()=>yVe??=rJ.createEmpty()});var iJ;(function(e){e.Null=16777214;function t(e,t){return e.objectId===t.objectId&&e.instanceId===t.instanceId&&e.groupId===t.groupId}e.areSame=t})(iJ||={});function aJ(e,t,n={}){let r=0,i=new sD,a=rJ.createState(),o=kF(),s=[],c,l,u=-1,d=oq.createEmpty(),f=t.Params,p=V.getDefaultValues(f),m,h;n.modifyState&&rJ.updateState(a,n.modifyState(a));let g=Cq.create();function _(e={},t){Cq.reset(g),!(!t&&!l)&&(t&&!l?g.createNew=!0:t&&l&&t.id===l.id||(t&&l&&t.id!==l.id?(g.updateTransform=!0,g.createGeometry=!0):t&&console.warn(`unexpected state`)),e.instanceGranularity!==p.instanceGranularity&&(g.updateTransform=!0),g.updateTransform&&(g.updateColor=!0,g.updateSize=!0,g.updateMatrix=!0),g.createGeometry&&(g.updateColor=!0,g.updateSize=!0))}function v(f={},v){return n.modifyProps&&(f=n.modifyProps(f)),hb.create(`ShapeRepresentation.create`,async y=>{let b=Object.assign(p,f),x=v?await e(y,v,b,l):void 0;if(_(f,x),x&&(l=x,Object.assign(d,jF.getTheme(l))),g.createNew){s.length=0,m=jF.groupIterator(l);let e=jF.createTransform(l.transforms,l.geometry.boundingSphere,b.cellSize,b.batchSize),r=t.createValues(l.geometry,e,m,d,b),i=t.createRenderableState(b);n.modifyState&&Object.assign(i,n.modifyState(i)),rJ.updateState(a,i),c=AF(l.geometry.kind,r,i,o),c&&s.push(c),h=t.createPositionIterator(l.geometry,c.values)}else{if(!c)throw Error(`expected renderObject to be available`);if(g.updateTransform){m=jF.groupIterator(l);let{instanceCount:e,groupCount:t}=m;f.instanceGranularity?QA(e,`instance`,c.values):QA(e*t,`groupInstance`,c.values)}g.updateMatrix&&(jF.createTransform(l.transforms,l.geometry.boundingSphere,b.cellSize,b.batchSize,c.values),`lodLevels`in c.values&&L.update(c.values.lodLevels,c.values.lodLevels.ref.value)),g.createGeometry&&(L.updateIfChanged(c.values.drawCount,wF.getDrawCount(l.geometry)),L.updateIfChanged(c.values.uVertexCount,wF.getVertexCount(l.geometry)),L.updateIfChanged(c.values.uGroupCount,m.groupCount)),g.updateColor&&nM(m,h,d.color,c.values),g.updateSize&&`uSize`in c.values&&tP(m,d.size,c.values),t.updateValues(c.values,b),t.updateRenderableState(c.state,b),(g.updateTransform||g.createGeometry)&&(t.updateBoundingSphere(c.values,l.geometry),h=t.createPositionIterator(l.geometry,c.values))}p=b,(g.createGeometry||g.createNew)&&(u+=1),i.next(r++)})}function y(e,t,n){let r=!1;if(!MF.isLoci(e)||MF.isLociEmpty(e)||e.shape!==t)return!1;for(let t of e.groups)n(G.ofSingleton(t.instance))&&(r=!0);return r}function b(e,t){return mq(e)||jF.isLoci(e)&&e.shape===l?p.instanceGranularity?t(G.ofBounds(0,l.transforms.length)):t(G.ofBounds(0,l.groupCount*l.transforms.length)):p.instanceGranularity?y(e,l,t):bVe(e,l,t)}return{label:`Shape geometry`,get groupCount(){return m?m.count:0},get props(){return p},get params(){return f},get state(){return a},get theme(){return d},renderObjects:s,get geometryVersion(){return u},updated:i,createOrUpdate:v,getLoci(e){let{objectId:t,groupId:n,instanceId:r}=e;return c&&c.id===t?n===iJ.Null?jF.Loci(l):MF.Loci(l,[{ids:K.ofSingleton(n),instance:r}]):hq},getAllLoci(){return[jF.Loci(l)]},eachLocation:e=>{for(m.reset();m.hasNext;){let{location:t,isSecondary:n}=m.move();e(t,n)}},mark(e,t){if(!uq.is(a.markerActions,t))return!1;if(MF.isLoci(e)||jF.isLoci(e)){if(e.shape!==l)return!1}else if(!mq(e))return!1;return Zq.mark(c,e,t,b)},setState(e){n.modifyState&&(e=n.modifyState(e)),c&&(e.visible!==void 0&&Zq.setVisibility(c,e.visible),e.alphaFactor!==void 0&&Zq.setAlphaFactor(c,e.alphaFactor),e.pickable!==void 0&&Zq.setPickable(c,e.pickable),e.colorOnly!==void 0&&Zq.setColorOnly(c,e.colorOnly),e.overpaint!==void 0&&Zq.setOverpaint(c,e.overpaint,b,!0),e.transparency!==void 0&&Zq.setTransparency(c,e.transparency,b,!0),e.substance!==void 0&&Zq.setSubstance(c,e.substance,b,!0),e.transform!==void 0&&Zq.setTransform(c,e.transform)),rJ.updateState(a,e)},setTheme(e){Qy&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){s.length=0,c&&=(c.state.disposed=!0,void 0)}}}function bVe(e,t,n){if(!MF.isLoci(e)||e.shape!==t)return!1;let r=!1,{groupCount:i}=t,{groups:a}=e;for(let{ids:e,instance:t}of a)if(G.is(e)){let a=t*i+G.start(e),o=t*i+G.end(e);n(G.ofBounds(a,o))&&(r=!0)}else for(let a=0,o=e.length;a<o;a++){let o=t*i+e[a];n(G.ofSingleton(o))&&(r=!0)}return r}var oJ=z(),sJ=class{constructor(e){this.structure=e,this.groupUnitTransforms=[],this.unitOffsetMap=dA.Mutable(),this.groupIndexMap=dA.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(e.units.length*16),this.size=e.units.length,this.reset();let t=0;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){let r=e.unitSymmetryGroups[n];this.groupIndexMap.set(r.hashCode,n);let i=this.unitTransforms.subarray(t,t+r.units.length*16);this.groupUnitTransforms.push(i);for(let e=0,n=r.units.length;e<n;++e)this.unitOffsetMap.set(r.units[e].id,t+e*16);t+=r.units.length*16}}reset(){this.version=0,fM(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(this._isIdentity===void 0){this._isIdentity=!0;for(let e=0,t=this.size*16;e<t;e+=16)if(z.fromArray(oJ,this.unitTransforms,e),!z.isIdentity(oJ)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(e,t){this.version=(this.version+1)%2147483647,z.toArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id)),this._isIdentity=void 0}getTransform(e,t){return z.fromArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id))}getSymmetryGroupTransforms(e){return this.groupUnitTransforms[this.groupIndexMap.get(e.hashCode)]}},cJ=z();function lJ(e,t,n){for(let r=0,i=e.units.length;r<i;r++){let i=e.units[r];tA.lerpFromIdentity(cJ,i.conformation.operator,n),t.setTransform(cJ,i)}}var uJ=B(),dJ=B(),fJ=z();function pJ(e,t,n,r){let i=r.radius*n;for(let n=0,a=e.units.length;n<a;n++){let a=e.units[n];B.transformMat4(uJ,a.lookup3d.boundary.sphere.center,a.conformation.operator.matrix),B.sub(dJ,uJ,r.center),B.setMagnitude(dJ,dJ,i),z.fromTranslation(fJ,dJ),t.setTransform(fJ,a)}}const xVe={axis:V.MappedStatic(`custom`,{structure:V.Group({principalAxis:V.Select(`dirA`,[[`dirA`,`A`],[`dirB`,`B`],[`dirC`,`C`]])}),custom:V.Group({vector:V.Vec3(B.create(0,0,1))})}),origin:V.MappedStatic(`structure`,{structure:V.Group({}),custom:V.Group({vector:V.Vec3(B.create(0,0,0))})})};function mJ(e,t){let n,r;return n=t.axis.name===`custom`?t.axis.params.vector:nB.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],r=t.origin.name===`custom`?t.origin.params.vector:nB.getPrincipalAxes(e).momentsAxes.origin,{axis:n,origin:r}}var hJ=z(),gJ=z(),_J=z();function vJ(e,t,n,r,i){for(let a=0,o=e.units.length;a<o;a++){let o=e.units[a];B.negate(dJ,i),z.fromTranslation(fJ,dJ),z.fromRotation(hJ,Math.PI*n*2,r),z.fromTranslation(gJ,i),z.mul(_J,hJ,fJ),z.mul(_J,gJ,_J),t.setTransform(_J,o)}}var SVe=z.fromTranslation(z(),B.create(.5,.5,.5)),CVe=eN(QM(kP()),SVe),yJ=B(),bJ=z(),wVe={origin:`Origin`,model:`Model`},TVe={corner:`Corner`,center:`Center`},EVe={...HM.Params,cellColor:V.Color(gk.orange),cellScale:V.Numeric(2,{min:.1,max:5,step:.1}),ref:V.Select(`model`,V.objectToOptions(wVe),{isEssential:!0}),attachment:V.Select(`corner`,V.objectToOptions(TVe),{isEssential:!0})},DVe={mesh:(e,t)=>aJ(kVe,HM.Utils)};const xJ={...EVe};function OVe(e,t,n){let r=YN.createState(256,128,n),{fromFractional:i}=e.symmetry.spacegroup.cell;B.copy(yJ,e.ref),t.attachment===`center`?(B.trunc(yJ,yJ),B.subScalar(yJ,yJ,.5)):B.floor(yJ,yJ),z.fromTranslation(bJ,yJ);let a=eN(QM(CVe),bJ),o=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;r.currentGroup=1,YN.addCage(r,i,a,o,2,20);let s=q.fromDimensionsAndTransform(q(),B.unit,i);B.transformMat4(yJ,yJ,i),q.translate(s,s,yJ),q.expand(s,s,o);let c=YN.getMesh(r);return c.setBoundingSphere(s),c}function kVe(e,t,n,r){let i=OVe(t,n,r&&r.geometry),a=ZI.getUnitcellLabel(t.symmetry);return jF.create(a,t,i,()=>n.cellColor,()=>1,()=>a)}function SJ(e,t,n){let r=B();return n.ref===`model`&&B.transformMat4(r,DB.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:r}}function AVe(e,t){return rJ.createMulti(`Unit Cell`,e,t,rJ.StateBuilder,DVe)}var CJ=new Uint16Array([0,1,2,1,3,2]),wJ=_O.add3,TJ=_O.add2,EJ=_O.add,DJ;(function(e){function t(e={},t=2048,n=1024,r){t*=2,n*=2;let i=_O.create(Float32Array,3,n,r?r.centerBuffer.ref.value:t),a=_O.create(Float32Array,2,n,r?r.mappingBuffer.ref.value:t),o=_O.create(Float32Array,1,n,r?r.depthBuffer.ref.value:t),s=_O.create(Uint32Array,3,n,r?r.indexBuffer.ref.value:t),c=_O.create(Float32Array,1,n,r?r.groupBuffer.ref.value:t),l=_O.create(Float32Array,2,n,r?r.tcoordBuffer.ref.value:t),u={...V.getDefaultValues(uP.Params),...e},{attachment:d,background:f,backgroundMargin:p,tether:m,tetherLength:h,tetherBaseWidth:g}=u,_=wTe(u),v=1/2.5*p,y=_.buffer/_.lineHeight,b=(e,t,n,r,a)=>{wJ(i,e,t,n),EJ(o,r),EJ(c,a)};return{add:(e,t,n,r,o,c,u)=>{let p=0,x=e.length;for(let t=0;t<x;++t){let n=_.get(e[t]);p+=n.nw-2*y}let S=1/1.25,C,w;if(C=d.startsWith(`top`)?S:d.startsWith(`middle`)?S/2:0,w=d.endsWith(`right`)?p:d.endsWith(`center`)?p/2:0,m)switch(d){case`bottom-left`:w-=h/2+v+.1,C-=h/2+v;break;case`bottom-center`:C-=h+v;break;case`bottom-right`:w+=h/2+v+.1,C-=h/2+v;break;case`middle-left`:w-=h+v+.1;break;case`middle-center`:break;case`middle-right`:w+=h+v+.1;break;case`top-left`:w-=h/2+v+.1,C+=h/2+v;break;case`top-center`:C+=h+v;break;case`top-right`:w+=h/2+v+.1,C+=h/2+v;break}let T=(-w-v-.1)*c,E=(p-w+v+.1)*c,D=(S-C+v)*c,O=(-C-v)*c;if(f){TJ(a,T,D),TJ(a,T,O),TJ(a,E,D),TJ(a,E,O);let e=i.elementCount;for(let e=0;e<4;++e)TJ(l,10,10),b(t,n,r,o,u);wJ(s,e+CJ[0],e+CJ[1],e+CJ[2]),wJ(s,e+CJ[3],e+CJ[4],e+CJ[5])}if(m){let e,f,p,m,_,v,y,x,S=h*c,C=g*c;switch(d){case`bottom-left`:e=T-S/2,p=T+C/2,_=T,y=T,f=O-S/2,m=O,v=O+C/2,x=O;break;case`bottom-center`:e=0,p=C/2,_=-C/2,y=0,f=O-S,m=O,v=O,x=O;break;case`bottom-right`:e=E+S/2,p=E,_=E-C/2,y=E,f=O-S/2,m=O+C/2,v=O,x=O;break;case`middle-left`:e=T-S,p=T,_=T,y=T,f=0,m=-C/2,v=C/2,x=0;break;case`middle-center`:e=0,p=0,_=0,y=0,f=0,m=0,v=0,x=0;break;case`middle-right`:e=E+S,p=E,_=E,y=E,f=0,m=C/2,v=-C/2,x=0;break;case`top-left`:e=T-S/2,p=T+C/2,_=T,y=T,f=D+S/2,m=D,v=D-C/2,x=D;break;case`top-center`:e=0,p=C/2,_=-C/2,y=0,f=D+S,m=D,v=D,x=D;break;case`top-right`:e=E+S/2,p=E,_=E-C/2,y=E,f=D+S/2,m=D-C/2,v=D,x=D;break;default:Lb(d)}TJ(a,e,f),TJ(a,p,m),TJ(a,_,v),TJ(a,y,x);let w=i.elementCount;for(let e=0;e<4;++e)TJ(l,10,10),b(t,n,r,o,u);wJ(s,w,w+1,w+3),wJ(s,w,w+3,w+2)}w+=y,C+=y;let k=0;for(let d=0;d<x;++d){let f=_.get(e[d]),p=(k-w)*c,m=(k+f.nw-w)*c,h=(f.nh-C)*c,g=-C*c;TJ(a,p,h),TJ(a,p,g),TJ(a,m,h),TJ(a,m,g);let v=_.texture.width,x=_.texture.height;TJ(l,f.x/v,f.y/x),TJ(l,f.x/v,(f.y+f.h)/x),TJ(l,(f.x+f.w)/v,f.y/x),TJ(l,(f.x+f.w)/v,(f.y+f.h)/x),k+=f.nw-2*y;let S=i.elementCount;for(let e=0;e<4;++e)b(t,n,r,o,u);wJ(s,S+CJ[0],S+CJ[1],S+CJ[2]),wJ(s,S+CJ[3],S+CJ[4],S+CJ[5])}},getText:()=>{let e=_.texture,t=_O.compact(i,!0),n=_O.compact(a,!0),u=_O.compact(o,!0),d=_O.compact(s,!0),f=_O.compact(c,!0),p=_O.compact(l,!0);return uP.create(e,t,n,u,d,f,p,s.elementCount/2,r)}}}e.create=t})(DJ||={});const OJ={granularity:`element`,condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function kJ(e,t={}){switch(e.kind){case`structure-loci`:return e.structure.models.map(e=>e.entry).filter(e=>!!e).join(`, `);case`element-loci`:return MJ(uB.ofLoci(e),t);case`bond-loci`:let n=e.bonds[0];return n?PJ(n,t):``;case`shape-loci`:return e.shape.name;case`group-loci`:let r=e.groups[0];return r?e.shape.getLabel(K.start(r.ids),r.instance):``;case`every-loci`:return`Everything`;case`empty-loci`:return`Nothing`;case`data-loci`:return e.getLabel();case`volume-loci`:return e.volume.label||`Volume`;case`isosurface-loci`:return[`${e.volume.label||`Volume`}`,`Isosurface at ${zP.IsoValue.toString(e.isoValue)}`].join(` | `);case`cell-loci`:let i=zP.Cell.getLociSize(e),a=K.start(e.elements[0].indices),o=zP.IsoValue.absolute(e.volume.grid.cells.data[a]),s=zP.IsoValue.toRelative(o,e.volume.grid.stats),c=[`${e.volume.label||`Volume`}`,`${i===1?`Cell #${a}`:`${i} Cells`}`];return i===1&&(e.volume.instances.length>1&&c.push(`Instance #${K.start(e.elements[0].instances)+1}`),c.push(`${zP.IsoValue.toString(o)} (${zP.IsoValue.toString(s)})`)),c.join(` | `);case`segment-loci`:let l=zP.Segment.getLociSize(e),u=zP.Segmentation.get(e.volume)?.labels,d=K.start(e.elements[0].segments);if(u&&l===1){let e=u[d];if(e)return e}return[`${e.volume.label||`Volume`}`,`${l===1?`Segment ${d}`:`${l} Segments`}`].join(` | `)}}function AJ(e,t){return e===1?`1 ${t}`:`${e} ${t}s`}function jJ(e,t,n,r,i,a){return`${IJ(t,{granularity:n,hidePrefix:r,reverse:i,condensed:a})} <small>[+ ${AJ(e-1,`other ${qT(n)}`)}]</small>`}function jVe(e){let{elements:t,model:n}=e,{chainAtomSegments:r,residueAtomSegments:i}=n.atomicHierarchy,a=r.offsets[r.index[t[0]]],o=r.offsets[r.index[t[t.length-1]]+1]-1;return i.index[o]-i.index[a]+1}function MJ(e,t={}){let n={...OJ,...t},r=MVe(e,n.countsOnly,n.hidePrefix,n.condensed,n.reverse);return n.htmlStyling?r:YT(r)}function NJ(e,t={}){let n=uB.create();for(let t of e)uB.add(n,n,uB.ofLoci(t));return MJ(n,t)}function MVe(e,t=!1,n=!1,r=!1,i=!1){let{structureCount:a,chainCount:o,residueCount:s,conformationCount:c,elementCount:l}=e;if(!t&&l===1&&s===0&&o===0)return IJ(e.firstElementLoc,{hidePrefix:n,condensed:r,granularity:`element`,reverse:i});if(!t&&l===0&&s===1&&o===0)return IJ(e.firstResidueLoc,{hidePrefix:n,condensed:r,granularity:`residue`,reverse:i});if(!t&&l===0&&s===0&&o===1){let{unit:t}=e.firstChainLoc,a=Q.isAtomic(t)&&jVe(t)===1||Q.Traits.is(t.traits,Q.Trait.MultiChain)?`residue`:`chain`;return IJ(e.firstChainLoc,{hidePrefix:n,condensed:r,granularity:a,reverse:i})}else if(t){let e=[];return a>0&&e.push(AJ(a,`Structure`)),o>0&&e.push(AJ(o,`Chain`)),s>0&&e.push(AJ(s,`Residue`)),c>0&&e.push(AJ(c,`Conformation`)),l>0&&e.push(AJ(l,`Element`)),e.join(`<small> + </small>`)}else{let t=[];return a>0&&t.push(a===1?IJ(e.firstStructureLoc,{hidePrefix:n,condensed:r,granularity:`structure`,reverse:i}):jJ(a,e.firstStructureLoc,`structure`,n,i,r)),o>0&&(t.push(o===1?IJ(e.firstChainLoc,{condensed:r,granularity:`chain`,hidePrefix:n,reverse:i}):jJ(o,e.firstChainLoc,`chain`,n,i,r)),n=!0),s>0&&(t.push(s===1?IJ(e.firstResidueLoc,{condensed:r,granularity:`residue`,hidePrefix:n,reverse:i}):jJ(s,e.firstResidueLoc,`residue`,n,i,r)),n=!0),c>0&&(t.push(c===1?IJ(e.firstConformationLoc,{condensed:r,granularity:`conformation`,hidePrefix:n,reverse:i}):jJ(c,e.firstConformationLoc,`conformation`,n,i,r)),n=!0),l>0&&t.push(l===1?IJ(e.firstElementLoc,{condensed:r,granularity:`element`,hidePrefix:n,reverse:i}):jJ(l,e.firstElementLoc,`element`,n,i,r)),t.join(`<small> + </small>`)}}function PJ(e,t={}){return FJ({loci:[$(e.aStructure,[{unit:e.aUnit,indices:K.ofSingleton(e.aIndex)}]),$(e.bStructure,[{unit:e.bUnit,indices:K.ofSingleton(e.bIndex)}])]},t)}function FJ(e,t={}){let n={...OJ,...t},r=NVe(e,n);return n.htmlStyling?r:YT(r)}function NVe(e,t){let{granularity:n,hidePrefix:r,reverse:i,condensed:a}=t,o=!0;for(let t of e.loci)if(!$.is(t)||$.size(t)!==1){o=!1;break}if(o){let t=e.loci.map(e=>{let{unit:t,indices:n}=e.elements[0];return iL.create(e.structure,t,t.elements[K.start(n)])}).map(e=>LJ(e,n,r,i||a));if(a)return t.map(e=>e[0].replace(/\[.*\]/g,``).trim()).filter(e=>!!e).join(`  `);let o=0;for(let e=0,n=Math.min(...t.map(e=>e.length))-1;e<n;++e){let n=!0;for(let r=1,i=t.length;r<i;++r)if(t[0][e]!==t[r][e]){n=!1;break}if(n)o+=1;else break}if(o>0){let e=[t[0].join(` | `)];for(let n=1,r=t.length;n<r;++n)e.push(t[n].slice(o).filter(e=>!!e).join(` | `));return e.join(`  `)}else return t.map(e=>e.filter(e=>!!e).join(` | `)).filter(e=>!!e).join(`</br>`)}else return e.loci.map(e=>kJ(e,t)).filter(e=>!!e).join(a?`  `:`</br>`)}function IJ(e,t={}){let n={...OJ,...t},r=LJ(e,n.granularity,n.hidePrefix,n.reverse||n.condensed),i=n.condensed?r[0]?.replace(/\[.*\]/g,``).trim()??``:r.filter(e=>!!e).join(` | `);return n.htmlStyling?i:YT(i)}function LJ(e,t=`element`,n=!1,r=!1){let i=[];if(!n){let n=e.unit.model.entry;n.length>30&&(n=n.substr(0,27)+``),i.push(`<small>${n}</small>`),t!==`structure`&&(i.push(`<small>Model ${e.unit.model.modelNum}</small>`),i.push(`<small>Instance ${e.unit.conformation.operator.instanceId}</small>`))}return Q.isAtomic(e.unit)?i.push(...PVe(e,t,r)):Q.isCoarse(e.unit)?i.push(...FVe(e,t)):i.push(`Unknown`),r?i.reverse():i}function PVe(e,t,n=!1){let r=iL.residueIndex(e),i=Pz.chain.label_asym_id(e),a=Pz.chain.auth_asym_id(e),o=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(r)===U.ValueKinds.Present,s=Pz.residue.label_seq_id(e),c=Pz.residue.auth_seq_id(e),l=Pz.residue.pdbx_PDB_ins_code(e),u=Pz.atom.label_comp_id(e),d=Pz.atom.label_atom_id(e),f=Pz.atom.label_alt_id(e),p=Pz.atom.occupancy(e),m=Pz.atom.sourceIndex(e),h=Pz.residue.microheterogeneityCompIds(e),g=t===`residue`&&h.length>1?`(${h.join(`|`)})`:u,_=[];switch(t){case`element`:{let e=`<b>${d}</b>${f?`%${f}`:``}`,t=`<small style='margin-left: 4px'>[idx <b>${m+1}</b>]</small>`;_.push(`${e}${t}`)}case`conformation`:t===`conformation`&&f&&_.push(`<small>Conformation</small> <b>${f}</b>`);case`residue`:let n=s===c||!o?c:s;_.push(`<b>${g} ${n}</b>${n===c?``:` <small>[auth</small> <b>${c}</b><small>]</small>`}<b>${l||``}</b>`);case`chain`:i===a?_.push(`<b>${i}</b>`):t===`chain`&&Q.Traits.is(e.unit.traits,Q.Trait.MultiChain)?_.push(`<small>[auth</small> <b>${a}</b><small>]</small>`):_.push(`<b>${i}</b> <small>[auth</small> <b>${a}</b><small>]</small>`)}return _.length>0&&p!==1&&!n&&(_[0]=`${_[0]} <small>[occupancy</small> <b>${Math.round(100*p)/100}</b><small>]</small>`),_.reverse()}function FVe(e,t){let n=Pz.coarse.asym_id(e),r=Pz.coarse.seq_id_begin(e),i=Pz.coarse.seq_id_end(e),a=[];switch(t){case`element`:case`conformation`:case`residue`:if(r===i){let t=Pz.coarse.entityKey(e),n=e.unit.model.sequence.byEntityKey[t].sequence.compId.value(r-1);a.push(`<b>${n} ${r}</b>`)}else a.push(`<b>${r}-${i}</b>`);case`chain`:a.push(`<b>${n}</b>`)}return a.reverse()}function RJ(e,t={}){let n={...OJ,measureOnly:!1,unitLabel:``,...t},[r,i]=e.loci.map(e=>yq.getCenter(e)),a=`${B.distance(r,i).toFixed(2)} ${n.unitLabel}`;if(n.measureOnly)return a;let o=FJ(e,n);return n.condensed?`${a} | ${o}`:`Distance ${a}</br>${o}`}function zJ(e,t={}){let n={...OJ,measureOnly:!1,...t},[r,i,a]=e.loci.map(e=>yq.getCenter(e)),o=B.sub(B(),r,i),s=B.sub(B(),a,i),c=`${IT(B.angle(o,s)).toFixed(2)}\u00B0`;if(n.measureOnly)return c;let l=FJ(e,n);return n.condensed?`${c} | ${l}`:`Angle ${c}</br>${l}`}function BJ(e,t={}){let n={...OJ,measureOnly:!1,...t},[r,i,a,o]=e.loci.map(e=>yq.getCenter(e)),s=`${IT(B.dihedralAngle(r,i,a,o)).toFixed(2)}\u00B0`;if(n.measureOnly)return s;let c=FJ(e,n);return n.condensed?`${s} | ${c}`:`Dihedral ${s}</br>${c}`}const VJ={customText:V.Text(``,{label:`Text`,description:`Override the label with custom value.`,isEssential:!0}),textColor:V.Color(gk.black,{isEssential:!0}),textSize:V.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},HJ={...uP.Params,...VJ,borderWidth:V.Numeric(.2,{min:0,max:.5,step:.01})};var UJ={unitLabel:V.Text(``,{isEssential:!0})},IVe={...vP.Params,...UJ,lineSizeAttenuation:V.Boolean(!0),linesColor:V.Color(gk.lightgreen,{isEssential:!0}),linesSize:V.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:V.Numeric(.2,{min:.01,max:.2,step:.01})},LVe={...HJ,...UJ},WJ={lines:(e,t)=>aJ(BVe,vP.Utils,{modifyState:e=>({...e,markerActions:uq.Highlighting})}),text:(e,t)=>aJ(HVe,uP.Utils,{modifyState:e=>({...e,markerActions:lq.None})})};const GJ={...IVe,...LVe,visuals:V.MultiSelect([`lines`,`text`],V.objectToOptions(WJ))};function RVe(){return{sphereA:q(),sphereB:q(),center:B(),distance:0}}function KJ(e,t){let{sphereA:n,sphereB:r,center:i}=t,[a,o]=e.loci;return yq.getBoundingSphere(a,n),yq.getBoundingSphere(o,r),B.add(i,n.center,r.center),B.scale(i,i,.5),t.distance=B.distance(n.center,r.center),t}var qJ=RVe();function JJ(e,t){return e.pairs.length===1?`Distance ${RJ(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function zVe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.pairs.length;n<i;++n)KJ(e.pairs[n],qJ),r.addFixedLengthDashes(qJ.sphereA.center,qJ.sphereB.center,t.dashLength,n);return r.getLines()}function BVe(e,t,n,r){let i=zVe(t,n,r&&r.geometry),a=JJ(t,n.unitLabel);return jF.create(a,t,i,()=>n.linesColor,()=>n.linesSize,e=>RJ(t.pairs[e],n))}function VVe(e,t,n){let r=DJ.create(t,128,64,n);for(let n=0,i=e.pairs.length;n<i;++n){KJ(e.pairs[n],qJ);let{center:i,distance:a,sphereA:o,sphereB:s}=qJ,c=t.customText||`${a.toFixed(2)} ${t.unitLabel}`,l=Math.max(2,o.radius,s.radius)/2;r.add(c,i[0],i[1],i[2],1,l,n)}return r.getText()}function HVe(e,t,n,r){let i=VVe(t,n,r&&r.geometry),a=JJ(t,n.unitLabel);return jF.create(a,t,i,()=>n.textColor,()=>n.textSize,e=>RJ(t.pairs[e],n))}function UVe(e,t){return rJ.createMulti(`Distance`,e,t,rJ.StateBuilder,WJ)}var WVe={...HJ},YJ={text:(e,t)=>aJ(JVe,uP.Utils)};const XJ={...WVe,scaleByRadius:V.Boolean(!0),visuals:V.MultiSelect([`text`],V.objectToOptions(YJ)),snapshotKey:V.Text(``,{isEssential:!0,disableInteractiveUpdates:!0,description:`Activate the snapshot with the provided key when clicking on the label`}),tooltip:V.Text(``,{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:`Tooltip`,description:`Tooltip text to be displayed when hovering over the label`})};var GVe=q();function ZJ(e,t=!1){return e.label||kJ(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function KVe(e){return e.infos.length===1?ZJ(e.infos[0]):`${e.infos.length} Labels`}function qVe(e,t,n){let r=DJ.create(t,128,64,n),i=t.customText.trim();for(let n=0,a=e.infos.length;n<a;++n){let a=e.infos[n],o=yq.getBoundingSphere(a.loci,GVe);if(!o)continue;let{center:s,radius:c}=o,l=i||ZJ(a,!0);r.add(l,s[0],s[1],s[2],t.scaleByRadius?c/.9:0,t.scaleByRadius?Math.max(1,c):1,n)}return r.getText()}function JVe(e,t,n,r){let i=qVe(t,n,r&&r.geometry),a=KVe(t),o=n.tooltip?.trim()??``,s=n.customText.trim(),c;return c=o?e=>o:s?e=>s:e=>ZJ(t.infos[e]),jF.create(a,t,i,()=>n.textColor,()=>n.textSize,c)}function YVe(e,t){return rJ.createMulti(`Label`,e,t,rJ.StateBuilder,YJ)}var QJ=B(),XVe=z.identity(),$J=new Float32Array(18),ZVe=new Uint8Array([0,1,2,3,4,5]);function QVe(e,t,n,r,i){let{origin:a,dirA:o,dirB:s,dirC:c}=t;B.add(QJ,a,o),B.toArray(B.add(QJ,a,o),$J,0),B.toArray(B.sub(QJ,a,o),$J,3),B.toArray(B.add(QJ,a,s),$J,6),B.toArray(B.sub(QJ,a,s),$J,9),B.toArray(B.add(QJ,a,c),$J,12),B.toArray(B.sub(QJ,a,c),$J,15);let l=ZM($J,ZVe),u=Yk.volume(t),d=Math.cbrt(u)/300*n;YN.addCage(e,XVe,l,d,r,i)}B.zero(),B.zero();var eY=B(),$Ve=B(),eHe=B(),tHe=B(),nHe=z.identity(),tY=new Float32Array(24),rHe=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function iHe(e,t,n,r,i){let{origin:a,dirA:o,dirB:s,dirC:c}=t,l=B.negate($Ve,o),u=B.negate(eHe,s),d=B.negate(tHe,c),f=0,p=function(e,t,n){B.copy(eY,a),B.add(eY,eY,e),B.add(eY,eY,t),B.add(eY,eY,n),B.toArray(eY,tY,f),f+=3};p(o,s,c),p(o,s,d),p(o,u,d),p(o,u,c),p(l,u,d),p(l,u,c),p(l,s,c),p(l,s,d);let m=ZM(tY,rHe),h=Yk.volume(t),g=Math.cbrt(h)/300*n;YN.addCage(e,nHe,m,g,r,i)}var aHe=z.identity(),nY=B();function oHe(e,t,n,r,i){return B.add(nY,t,n),z.targetTo(e,t,nY,r),z.setTranslation(e,t),z.scale(e,e,i)}function rY(e,t,n,r,i,a){YN.addPrimitive(e,oHe(aHe,t,n,r,i),aN(a))}var iY={color:V.Color(gk.orange),scaleFactor:V.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:V.Numeric(2,{min:.1,max:10,step:.1})},sHe={...HM.Params,...iY},cHe={...HM.Params,...iY},lHe={...HM.Params,...iY},aY={axes:(e,t)=>aJ(fHe,HM.Utils),box:(e,t)=>aJ(hHe,HM.Utils),ellipsoid:(e,t)=>aJ(vHe,HM.Utils)};const oY={...sHe,...cHe,...lHe,visuals:V.MultiSelect([`box`],V.objectToOptions(aY))};function uHe(e){return`Principal Axes of ${NJ(e,{countsOnly:!0})}`}function dHe(e,t,n){let r=YN.createState(256,128,n),i=$.getPrincipalAxesMany(e.locis);return Yk.scale(i.momentsAxes,i.momentsAxes,t.scaleFactor),r.currentGroup=0,QVe(r,i.momentsAxes,t.radiusScale,2,20),YN.getMesh(r)}function fHe(e,t,n,r){let i=dHe(t,n,r&&r.geometry),a=uHe(t.locis);return jF.create(a,t,i,()=>n.color,()=>1,()=>a)}function pHe(e){return`Oriented Box of ${NJ(e,{countsOnly:!0})}`}function mHe(e,t,n){let r=YN.createState(256,128,n),i=$.getPrincipalAxesMany(e.locis);return Yk.scale(i.boxAxes,i.boxAxes,t.scaleFactor),r.currentGroup=0,iHe(r,i.boxAxes,t.radiusScale,2,20),YN.getMesh(r)}function hHe(e,t,n,r){let i=mHe(t,n,r&&r.geometry),a=pHe(t.locis);return jF.create(a,t,i,()=>n.color,()=>1,()=>a)}function gHe(e){return`Oriented Ellipsoid of ${NJ(e,{countsOnly:!0})}`}function _He(e,t,n){let r=YN.createState(256,128,n),i=$.getPrincipalAxesMany(e.locis).boxAxes,{origin:a,dirA:o,dirB:s}=i,c=Yk.size(B(),i);B.scale(c,c,.5*t.scaleFactor);let l=B.create(c[2],c[1],c[0]);return r.currentGroup=0,rY(r,a,o,s,l,2),YN.getMesh(r)}function vHe(e,t,n,r){let i=_He(t,n,r&&r.geometry),a=gHe(t.locis);return jF.create(a,t,i,()=>n.color,()=>1,()=>a)}function yHe(e,t){let n=rJ.createMulti(`Orientation`,e,t,rJ.StateBuilder,aY);return n.setState({markerActions:uq.Highlighting}),n}const bHe={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function sY(e){let{radius:t,segments:n,thetaStart:r,thetaLength:i}={...bHe,...e},a=i===Math.PI*2,o=a?n+1:n+2,s=new Float32Array(o*3),c=new Float32Array(o*3),l=new Uint32Array(n*3);s[0]=0,s[1]=0,s[2]=0,c[0]=0,c[1]=1,c[2]=0;for(let e=0,a=3;e<n;++e,a+=3){let o=r+e/n*i;s[a]=t*Math.sin(o),s[a+1]=0,s[a+2]=t*Math.cos(o),c[a]=0,c[a+1]=1,c[a+2]=0}for(let e=1,t=0;e<n;++e,t+=3)l[t]=e,l[t+1]=e+1,l[t+2]=0;if(a){let e=(n-1)*3;l[e]=n,l[e+1]=1,l[e+2]=0}else{let e=r+i,a=(n+1)*3;s[a]=t*Math.sin(e),s[a+1]=0,s[a+2]=t*Math.cos(e),c[a]=0,c[a+1]=1,c[a+2]=0;let o=(n-1)*3;l[o]=n,l[o+1]=n+1,l[o+2]=0}return{vertices:s,normals:c,indices:l}}var cY={color:V.Color(gk.lightgreen),arcScale:V.Numeric(.7,{min:.01,max:1,step:.01})},lY={...vP.Params,...cY,lineSizeAttenuation:V.Boolean(!0),linesSize:V.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:V.Numeric(.04,{min:.01,max:.2,step:.01})},xHe={...lY},SHe={...lY},CHe={...HM.Params,...cY,ignoreLight:V.Boolean(!0),sectorOpacity:V.Numeric(.75,{min:0,max:1,step:.01})},uY={vectors:(e,t)=>aJ(EHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),arc:(e,t)=>aJ(OHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),sector:(e,t)=>aJ(AHe,HM.Utils,{modifyProps:e=>({...e,alpha:e.sectorOpacity}),modifyState:e=>({...e,markerActions:uq.Highlighting})}),text:(e,t)=>aJ(MHe,uP.Utils,{modifyState:e=>({...e,markerActions:lq.None})})};const dY={...xHe,...SHe,...CHe,...HJ,visuals:V.MultiSelect([`vectors`,`sector`,`text`],V.objectToOptions(uY))};function wHe(){return{sphereA:q(),sphereB:q(),sphereC:q(),arcDirA:B(),arcDirC:B(),arcNormal:B(),radius:0,angle:0}}var fY=B(),pY=z();function mY(e,t,n){let{sphereA:r,sphereB:i,sphereC:a}=t,{arcDirA:o,arcDirC:s,arcNormal:c}=t,[l,u,d]=e.loci;return yq.getBoundingSphere(l,r),yq.getBoundingSphere(u,i),yq.getBoundingSphere(d,a),B.sub(o,r.center,i.center),B.sub(s,a.center,i.center),B.cross(c,o,s),t.radius=Math.min(B.magnitude(o),B.magnitude(s))*n,t.angle=B.angle(o,s),t}function hY(e,t){let{radius:n,angle:r}=e,i=t?RT(r,n)/t:32;return z.targetTo(pY,e.sphereB.center,e.sphereA.center,e.arcNormal),z.setTranslation(pY,e.sphereB.center),z.mul(pY,pY,z.rotY180),XM(sY({radius:n,thetaLength:r,segments:i}),pY)}var gY=wHe();function _Y(e){return e.triples.length===1?`Angle ${zJ(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function THe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.triples.length;n<i;++n)mY(e.triples[n],gY,t.arcScale),r.addFixedLengthDashes(gY.sphereB.center,gY.sphereA.center,t.dashLength,n),r.addFixedLengthDashes(gY.sphereB.center,gY.sphereC.center,t.dashLength,n);return r.getLines()}function EHe(e,t,n,r){let i=THe(t,n,r&&r.geometry),a=_Y(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function DHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.triples.length;n<i;++n){mY(e.triples[n],gY,t.arcScale);let{indices:i,vertices:a}=hY(gY,t.dashLength);for(let e=0,t=i.length;e<t;e+=3){if(e%2==1)continue;let t=i[e]*3,o=i[e+1]*3,s=a[t],c=a[t+1],l=a[t+2],u=a[o],d=a[o+1],f=a[o+2];r.add(s,c,l,u,d,f,n)}}return r.getLines()}function OHe(e,t,n,r){let i=DHe(t,n,r&&r.geometry),a=_Y(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function kHe(e,t,n){let r=YN.createState(128,64,n);for(let n=0,i=e.triples.length;n<i;++n){mY(e.triples[n],gY,t.arcScale);let i=hY(gY);r.currentGroup=n,YN.addPrimitive(r,z.id,i),YN.addPrimitiveFlipped(r,z.id,i)}return YN.getMesh(r)}function AHe(e,t,n,r){let i=kHe(t,n,r&&r.geometry),a=_Y(t);return jF.create(a,t,i,()=>n.color,()=>1,e=>zJ(t.triples[e]))}function jHe(e,t,n){let r=DJ.create(t,128,64,n);for(let n=0,i=e.triples.length;n<i;++n){mY(e.triples[n],gY,t.arcScale),B.add(fY,gY.arcDirA,gY.arcDirC),B.setMagnitude(fY,fY,gY.radius),B.add(fY,gY.sphereB.center,fY);let i=IT(gY.angle).toFixed(2),a=t.customText||`${i}\u00B0`,o=Math.max(2,gY.sphereA.radius,gY.sphereB.radius,gY.sphereC.radius)/2;r.add(a,fY[0],fY[1],fY[2],.1,o,n)}return r.getText()}function MHe(e,t,n,r){let i=jHe(t,n,r&&r.geometry),a=_Y(t);return jF.create(a,t,i,()=>n.textColor,()=>n.textSize,e=>zJ(t.triples[e]))}function NHe(e,t){return rJ.createMulti(`Angle`,e,t,rJ.StateBuilder,uY)}var vY={color:V.Color(gk.lightgreen),arcScale:V.Numeric(.7,{min:.01,max:1,step:.01})},yY={...vP.Params,...vY,lineSizeAttenuation:V.Boolean(!0),linesSize:V.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:V.Numeric(.04,{min:.01,max:.2,step:.01})},PHe={...yY},FHe={...yY},IHe={...yY},LHe={...yY},RHe={...HM.Params,...vY,ignoreLight:V.Boolean(!0),sectorOpacity:V.Numeric(.75,{min:0,max:1,step:.01})},bY={vectors:(e,t)=>aJ(VHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),extenders:(e,t)=>aJ(qHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),connector:(e,t)=>aJ(UHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),arms:(e,t)=>aJ(GHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),arc:(e,t)=>aJ(YHe,vP.Utils,{modifyState:e=>({...e,pickable:!1})}),sector:(e,t)=>aJ(ZHe,HM.Utils,{modifyProps:e=>({...e,alpha:e.sectorOpacity}),modifyState:e=>({...e,markerActions:uq.Highlighting})}),text:(e,t)=>aJ($He,uP.Utils,{modifyState:e=>({...e,markerActions:lq.None})})};const xY={...PHe,...FHe,...IHe,...LHe,...RHe,...HJ,visuals:V.MultiSelect([`extenders`,`arms`,`sector`,`text`],V.objectToOptions(bY))};function zHe(){return{sphereA:q(),sphereB:q(),sphereC:q(),sphereD:q(),dirBA:B(),dirCD:B(),projA:B(),projD:B(),arcPointA:B(),arcPointD:B(),arcDirA:B(),arcDirD:B(),arcCenter:B(),arcNormal:B(),radius:0,angle:0}}var SY=B(),CY=z();function wY(e,t,n){let{sphereA:r,sphereB:i,sphereC:a,sphereD:o,dirBA:s,dirCD:c,projA:l,projD:u}=t,{arcPointA:d,arcPointD:f,arcDirA:p,arcDirD:m,arcCenter:h,arcNormal:g}=t,[_,v,y,b]=e.loci;yq.getBoundingSphere(_,r),yq.getBoundingSphere(v,i),yq.getBoundingSphere(y,a),yq.getBoundingSphere(b,o),B.add(h,i.center,a.center),B.scale(h,h,.5),B.sub(s,r.center,i.center),B.sub(c,o.center,a.center),B.add(d,h,s),B.add(f,h,c),B.sub(g,a.center,i.center),B.orthogonalize(p,g,s),B.orthogonalize(m,g,c),B.projectPointOnVector(l,d,p,h),B.projectPointOnVector(u,f,m,h);let x=Math.min(B.distance(l,h),B.distance(u,h))*n;B.setMagnitude(p,p,x),B.setMagnitude(m,m,x),B.add(d,h,p),B.add(f,h,m),t.radius=x,t.angle=B.dihedralAngle(r.center,i.center,a.center,o.center),B.matchDirection(SY,g,B.sub(SY,d,r.center));let S=B.angle(s,SY),C=x/Math.cos(S-NT);B.add(l,i.center,B.setMagnitude(SY,s,C)),B.matchDirection(SY,g,B.sub(SY,f,o.center));let w=B.angle(c,SY),T=x/Math.cos(w-NT);return B.add(u,a.center,B.setMagnitude(SY,c,T)),t}function TY(e,t){let{radius:n,angle:r}=e,i=t?RT(r,n)/t:32;return z.targetTo(CY,e.arcCenter,r<0?e.arcPointD:e.arcPointA,e.arcNormal),z.setTranslation(CY,e.arcCenter),z.mul(CY,CY,z.rotY180),XM(sY({radius:n,thetaLength:Math.abs(r),segments:i}),CY)}var EY=zHe();function DY(e){return e.quads.length===1?`Dihedral ${BJ(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function BHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.quads.length;n<i;++n)wY(e.quads[n],EY,t.arcScale),r.addFixedLengthDashes(EY.arcCenter,EY.arcPointA,t.dashLength,n),r.addFixedLengthDashes(EY.arcCenter,EY.arcPointD,t.dashLength,n);return r.getLines()}function VHe(e,t,n,r){let i=BHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function HHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.quads.length;n<i;++n)wY(e.quads[n],EY,t.arcScale),r.addFixedLengthDashes(EY.sphereB.center,EY.sphereC.center,t.dashLength,n);return r.getLines()}function UHe(e,t,n,r){let i=HHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function WHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.quads.length;n<i;++n)wY(e.quads[n],EY,t.arcScale),r.addFixedLengthDashes(EY.sphereB.center,EY.sphereA.center,t.dashLength,n),r.addFixedLengthDashes(EY.sphereC.center,EY.sphereD.center,t.dashLength,n);return r.getLines()}function GHe(e,t,n,r){let i=WHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function KHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.quads.length;n<i;++n)wY(e.quads[n],EY,t.arcScale),r.addFixedLengthDashes(EY.arcPointA,EY.projA,t.dashLength,n),r.addFixedLengthDashes(EY.arcPointD,EY.projD,t.dashLength,n);return r.getLines()}function qHe(e,t,n,r){let i=KHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function JHe(e,t,n){let r=_P.create(128,64,n);for(let n=0,i=e.quads.length;n<i;++n){wY(e.quads[n],EY,t.arcScale);let{indices:i,vertices:a}=TY(EY,t.dashLength);for(let e=0,t=i.length;e<t;e+=3){if(e%2==1)continue;let t=i[e]*3,o=i[e+1]*3,s=a[t],c=a[t+1],l=a[t+2],u=a[o],d=a[o+1],f=a[o+2];r.add(s,c,l,u,d,f,n)}}return r.getLines()}function YHe(e,t,n,r){let i=JHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>n.linesSize,()=>``)}function XHe(e,t,n){let r=YN.createState(128,64,n);for(let n=0,i=e.quads.length;n<i;++n){wY(e.quads[n],EY,t.arcScale);let i=TY(EY);r.currentGroup=n,YN.addPrimitive(r,z.id,i),YN.addPrimitiveFlipped(r,z.id,i)}return YN.getMesh(r)}function ZHe(e,t,n,r){let i=XHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.color,()=>1,e=>BJ(t.quads[e]))}function QHe(e,t,n){let r=DJ.create(t,128,64,n);for(let n=0,i=e.quads.length;n<i;++n){wY(e.quads[n],EY,t.arcScale),B.add(SY,EY.arcDirA,EY.arcDirD),B.setMagnitude(SY,SY,EY.radius),B.add(SY,EY.arcCenter,SY);let i=IT(EY.angle).toFixed(2);i===`-0.00`&&(i=`0.00`);let a=t.customText||`${i}\u00B0`,o=Math.max(2,EY.sphereA.radius,EY.sphereB.radius,EY.sphereC.radius,EY.sphereD.radius)/2;r.add(a,SY[0],SY[1],SY[2],.1,o,n)}return r.getText()}function $He(e,t,n,r){let i=QHe(t,n,r&&r.geometry),a=DY(t);return jF.create(a,t,i,()=>n.textColor,()=>n.textSize,e=>BJ(t.quads[e]))}function eUe(e,t){return rJ.createMulti(`Dihedral`,e,t,rJ.StateBuilder,bY)}var tUe=s({BoxShape3D:()=>nUe,getBoxMesh:()=>OY}),nUe=AD.BuiltIn({name:`box-shape-3d`,display:`Box Shape`,from:H.Root,to:H.Shape.Provider,params:{bottomLeft:V.Vec3(B()),topRight:V.Vec3(B.create(1,1,1)),radius:V.Numeric(.15,{min:.01,max:4,step:.01}),color:V.Color(gk.red)}})({canAutoUpdate(){return!0},apply({params:e}){return hb.create(`Shape Representation`,async t=>new H.Shape.Provider({label:`Box`,data:e,params:HM.Params,getShape:(t,n)=>{let r=OY($k.create(e.bottomLeft,e.topRight),e.radius);return jF.create(`Box`,n,r,()=>n.color,()=>1,()=>`Box`)},geometryUtils:HM.Utils},{label:`Box`}))}});function OY(e,t,n){let r=B.sub(B(),e.max,e.min),i=z.fromTranslation(z(),B.create(.5,.5,.5)),a=z.fromScaling(z(),r),o=z.fromTranslation(z(),e.min),s=z.mul3(z(),o,a,i),c=YN.createState(256,128,n);c.currentGroup=1,YN.addCage(c,s,kP(),t,2,20);let l=YN.getMesh(c),u=B.scaleAndAdd(B(),e.min,r,.5),d=B.distance(e.min,u);return l.setBoundingSphere(q.create(u,d)),l}var kY={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};kY.vertices,new Uint32Array([0,1,2,3,3,1,2,0]);function rUe(){return kY}var iUe={...HM.Params,color:V.Color(gk.orange),scaleFactor:V.Numeric(1,{min:.1,max:10,step:.1})},AY={plane:(e,t)=>aJ(sUe,HM.Utils)};const jY={...iUe,visuals:V.MultiSelect([`plane`],V.objectToOptions(AY))};function aUe(e){return`Best Fit Plane of ${NJ(e,{countsOnly:!0})}`}var MY=z(),NY=B();function oUe(e,t,n){let r=YN.createState(256,128,n),i=$.getPrincipalAxesMany(e.locis).boxAxes,a=rUe();return B.add(NY,i.origin,i.dirC),z.targetTo(MY,NY,i.origin,i.dirB),z.scale(MY,MY,Yk.size(NY,i)),z.scaleUniformly(MY,MY,t.scaleFactor),z.setTranslation(MY,i.origin),r.currentGroup=0,YN.addPrimitive(r,MY,a),YN.addPrimitiveFlipped(r,MY,a),YN.getMesh(r)}function sUe(e,t,n,r){let i=oUe(t,n,r&&r.geometry),a=aUe(t.locis);return jF.create(a,t,i,()=>n.color,()=>1,()=>a)}function cUe(e,t){let n=rJ.createMulti(`Plane`,e,t,rJ.StateBuilder,AY);return n.setState({markerActions:uq.Highlighting}),n}var lUe=s({ClippingStructureRepresentation3DFromBundle:()=>SUe,ClippingStructureRepresentation3DFromScript:()=>xUe,EmissiveStructureRepresentation3DFromBundle:()=>vUe,EmissiveStructureRepresentation3DFromScript:()=>_Ue,ExplodeStructureRepresentation3D:()=>dUe,ModelUnitcell3D:()=>EUe,OverpaintStructureRepresentation3DFromBundle:()=>mUe,OverpaintStructureRepresentation3DFromScript:()=>pUe,ShapeRepresentation3D:()=>TUe,SpinStructureRepresentation3D:()=>fUe,StructureBoundingBox3D:()=>DUe,StructureRepresentation3D:()=>PY,StructureSelectionsAngle3D:()=>kUe,StructureSelectionsDihedral3D:()=>AUe,StructureSelectionsDistance3D:()=>OUe,StructureSelectionsLabel3D:()=>jUe,StructureSelectionsOrientation3D:()=>MUe,StructureSelectionsPlane3D:()=>NUe,SubstanceStructureRepresentation3DFromBundle:()=>bUe,SubstanceStructureRepresentation3DFromScript:()=>yUe,ThemeStrengthRepresentation3D:()=>CUe,TransparencyStructureRepresentation3DFromBundle:()=>gUe,TransparencyStructureRepresentation3DFromScript:()=>hUe,UnwindStructureAssemblyRepresentation3D:()=>uUe,VolumeRepresentation3D:()=>wUe,VolumeRepresentation3DHelpers:()=>FY}),PY=AD.BuiltIn({name:`structure-representation-3d`,display:`3D Representation`,from:H.Molecule.Structure,to:H.Molecule.Structure.Representation3D,params:(e,t)=>{let{registry:n,themes:r}=t.representation.structure,i=n.get(n.default.name);if(!e)return{type:V.Mapped(n.default.name,n.types,e=>V.Group(n.get(e).getParams(r,nB.Empty))),colorTheme:V.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.types,e=>V.Group(r.colorThemeRegistry.get(e).getParams({structure:nB.Empty})),{help:e=>{let{name:t,params:n}=e,i=r.colorThemeRegistry.get(t).factory({},n);return{description:i.description,legend:i.legend}}}),sizeTheme:V.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.types,e=>V.Group(r.sizeThemeRegistry.get(e).getParams({structure:nB.Empty})))};let a={structure:e.data};return{type:V.Mapped(n.default.name,n.getApplicableTypes(e.data),t=>V.Group(n.get(t).getParams(r,e.data))),colorTheme:V.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.getApplicableTypes(a),e=>V.Group(r.colorThemeRegistry.get(e).getParams(a)),{help:e=>{let{name:t,params:n}=e,i=r.colorThemeRegistry.get(t).factory(a,n);return{description:i.description,legend:i.legend}}}),sizeTheme:V.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.getApplicableTypes(a),e=>V.Group(r.sizeThemeRegistry.get(e).getParams(a)))}}})({canAutoUpdate({a:e,oldParams:t,newParams:n}){return e.data.elementCount<1e4||t.type.name===n.type.name&&n.type.params.quality!==`custom`},apply({a:e,params:t,cache:n},r){return hb.create(`Structure Representation`,async n=>{let i={runtime:n,assetManager:r.managers.asset,errorContext:r.errorContext},a=r.representation.structure.registry.get(t.type.name),o=a.getData?.call(a,e.data,t.type.params)||e.data;a.ensureCustomProperties&&await a.ensureCustomProperties.attach(i,o);let s=a.factory({webgl:r.canvas3d?.webgl,...r.representation.structure.themes},a.getParams);await oq.ensureDependencies(i,r.representation.structure.themes,{structure:o},t),s.setTheme(oq.create(r.representation.structure.themes,{structure:o},t));let c=t.type.params||{};return await s.createOrUpdate(c,o).runInContext(n),new H.Molecule.Structure.Representation3D({repr:s,sourceData:e.data},{label:a.label})})},update({a:e,b:t,oldParams:n,newParams:r,cache:i},a){return hb.create(`Structure Representation`,async i=>{if(r.type.name!==n.type.name)return lE.UpdateResult.Recreate;let o=a.representation.structure.registry.get(r.type.name);if(o.mustRecreate?.call(o,n.type.params,r.type.params))return lE.UpdateResult.Recreate;let s=o.getData?.call(o,e.data,r.type.params)||e.data,c={runtime:i,assetManager:a.managers.asset,errorContext:a.errorContext};o.ensureCustomProperties&&await o.ensureCustomProperties.attach(c,s),oq.releaseDependencies(a.representation.structure.themes,{structure:t.data.sourceData},n),await oq.ensureDependencies(c,a.representation.structure.themes,{structure:s},r),t.data.repr.setTheme(oq.create(a.representation.structure.themes,{structure:s},r));let l={...t.data.repr.props,...r.type.params};return await t.data.repr.createOrUpdate(l,s).runInContext(i),t.data.sourceData=e.data,lE.UpdateResult.Updated})},dispose({b:e,params:t},n){if(!e||!t)return;let r=e.data.sourceData,i=n.representation.structure.registry.get(t.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(r),oq.releaseDependencies(n.representation.structure.themes,{structure:r},t)},interpolate(e,t,n){if(e.colorTheme.name!==`uniform`||t.colorTheme.name!==`uniform`)return n<=.5?e:t;let r=e.colorTheme.params.value,i=t.colorTheme.params.value,a=tE.interpolate(r,i,n);return{type:n<=.5?e.type:t.type,colorTheme:{name:`uniform`,params:{value:a}},sizeTheme:n<=.5?e.sizeTheme:t.sizeTheme}}}),uUe=AD.BuiltIn({name:`unwind-structure-assembly-representation-3d`,display:`Unwind Assembly 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:{t:V.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=new sJ(n);return lJ(n,r,t.t),new H.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new sJ(n)},info:n,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info;if(e.data.sourceData!==i||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;if(r.t===n.t)return lE.UpdateResult.Unchanged;let a=t.data.state.unitTransforms;return lJ(i,a,n.t),t.label=`Unwind T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,lE.UpdateResult.Updated}}),dUe=AD.BuiltIn({name:`explode-structure-representation-3d`,display:`Explode 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:{t:V.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=new sJ(n);return pJ(n,r,t.t,n.root.boundary.sphere),new H.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new sJ(n)},info:n,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=e.data.sourceData;if(t.data.info!==i||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;if(r.t===n.t)return lE.UpdateResult.Unchanged;let a=t.data.state.unitTransforms;return pJ(i,a,n.t,i.root.boundary.sphere),t.label=`Explode T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,lE.UpdateResult.Updated}}),fUe=AD.BuiltIn({name:`spin-structure-representation-3d`,display:`Spin 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:{t:V.Numeric(0,{min:0,max:1,step:.01}),...xVe}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=new sJ(n),{axis:i,origin:a}=mJ(n.root,t);return vJ(n,r,t.t,i,a),new H.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new sJ(n)},info:n,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=e.data.sourceData;if(t.data.info!==i||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;if(r.t===n.t&&r.axis===n.axis&&r.origin===n.origin)return lE.UpdateResult.Unchanged;let a=t.data.state.unitTransforms,{axis:o,origin:s}=mJ(i.root,n);return vJ(i,a,n.t,o,s),t.label=`Spin T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,lE.UpdateResult.Updated}}),pUe=AD.BuiltIn({name:`overpaint-structure-representation-3d-from-script`,display:`Overpaint 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({script:V.Script(HH(`(sel.atom.all)`,`mol-script`)),color:V.Color(gk.blueviolet),clear:V.Boolean(!1)},e=>`${e.clear?`Clear`:tE.toRgbString(e.color)}`,{defaultValue:[{script:HH(`(sel.atom.all)`,`mol-script`),color:gk.blueviolet,clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=bq.ofScript(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:bq.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.overpaint,c=bq.ofScript(n.layers,a);return bq.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.overpaint=c,t.data.repr=e.data.repr,t.label=`Overpaint (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),mUe=AD.BuiltIn({name:`overpaint-structure-representation-3d-from-bundle`,display:`Overpaint 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({bundle:V.Value(qR.Empty),color:V.Color(gk.blueviolet),clear:V.Boolean(!1)},e=>`${e.clear?`Clear`:tE.toRgbString(e.color)}`,{defaultValue:[{bundle:qR.Empty,color:gk.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=bq.ofBundle(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:bq.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.overpaint,c=bq.ofBundle(n.layers,a);return bq.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.overpaint=c,t.data.repr=e.data.repr,t.label=`Overpaint (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),hUe=AD.BuiltIn({name:`transparency-structure-representation-3d-from-script`,display:`Transparency 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({script:V.Script(HH(`(sel.atom.all)`,`mol-script`)),value:V.Numeric(.5,{min:0,max:1,step:.01},{label:`Transparency`})},e=>`Transparency (${e.value})`,{defaultValue:[{script:HH(`(sel.atom.all)`,`mol-script`),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=xq.ofScript(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:xq.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.transparency,c=xq.ofScript(n.layers,a);return xq.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.transparency=c,t.data.repr=e.data.repr,t.label=`Transparency (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),gUe=AD.BuiltIn({name:`transparency-structure-representation-3d-from-bundle`,display:`Transparency 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({bundle:V.Value(qR.Empty),value:V.Numeric(.5,{min:0,max:1,step:.01},{label:`Transparency`})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:qR.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=xq.ofBundle(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:xq.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.transparency,c=xq.ofBundle(n.layers,a);return xq.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.transparency=c,t.data.repr=e.data.repr,t.label=`Transparency (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),_Ue=AD.BuiltIn({name:`emissive-structure-representation-3d-from-script`,display:`Emissive 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({script:V.Script(HH(`(sel.atom.all)`,`mol-script`)),value:V.Numeric(.5,{min:0,max:1,step:.01},{label:`Emissive`})},e=>`Emissive (${e.value})`,{defaultValue:[{script:HH(`(sel.atom.all)`,`mol-script`),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=eJ.ofScript(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{emissive:i},initialState:{emissive:eJ.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Emissive (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.emissive,c=eJ.ofScript(n.layers,a);return eJ.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.emissive=c,t.data.repr=e.data.repr,t.label=`Emissive (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),vUe=AD.BuiltIn({name:`emissive-structure-representation-3d-from-bundle`,display:`Emissive 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({bundle:V.Value(qR.Empty),value:V.Numeric(.5,{min:0,max:1,step:.01},{label:`Emissive`})},e=>`Emissive (${e.value})`,{defaultValue:[{bundle:qR.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=eJ.ofBundle(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{emissive:i},initialState:{emissive:eJ.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Emissive (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.emissive,c=eJ.ofBundle(n.layers,a);return eJ.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.emissive=c,t.data.repr=e.data.repr,t.label=`Emissive (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),yUe=AD.BuiltIn({name:`substance-structure-representation-3d-from-script`,display:`Substance 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({script:V.Script(HH(`(sel.atom.all)`,`mol-script`)),material:bM.getParam(),clear:V.Boolean(!1)},e=>`${e.clear?`Clear`:bM.toString(e.material)}`,{defaultValue:[{script:HH(`(sel.atom.all)`,`mol-script`),material:bM({roughness:1}),clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=$q.ofScript(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:$q.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.substance,c=$q.ofScript(n.layers,a);return $q.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.substance=c,t.data.repr=e.data.repr,t.label=`Substance (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),bUe=AD.BuiltIn({name:`substance-structure-representation-3d-from-bundle`,display:`Substance 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({bundle:V.Value(qR.Empty),material:bM.getParam(),clear:V.Boolean(!1)},e=>`${e.clear?`Clear`:bM.toString(e.material)}`,{defaultValue:[{bundle:qR.Empty,material:bM({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=e.data.repr.geometryVersion,i=$q.ofBundle(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:$q.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info,a=e.data.sourceData;if(a!==i.structure||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let o=e.data.repr.geometryVersion;if(o!==i.geometryVersion&&wM(e.data.repr.props))return lE.UpdateResult.Recreate;let s=t.data.state.substance,c=$q.ofBundle(n.layers,a);return $q.areEqual(s,c)?lE.UpdateResult.Unchanged:(i.geometryVersion=o,t.data.state.substance=c,t.data.repr=e.data.repr,t.label=`Substance (${c.layers.length} Layers)`,lE.UpdateResult.Updated)}}),xUe=AD.BuiltIn({name:`clipping-structure-representation-3d-from-script`,display:`Clipping 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({script:V.Script(HH(`(sel.atom.all)`,`mol-script`)),groups:V.Converted(e=>Qq.Groups.toNames(e),e=>Qq.Groups.fromNames(e),V.MultiSelect(Ib(Qq.Groups.Names),V.objectToOptions(Qq.Groups.Names)))},e=>`${Qq.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:HH(`(sel.atom.all)`,`mol-script`),groups:Qq.Groups.Flag.None}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=Qq.ofScript(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:Qq.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info;if(e.data.sourceData!==i||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let a=t.data.state.clipping,o=Qq.ofScript(n.layers,i);return Qq.areEqual(a,o)?lE.UpdateResult.Unchanged:(t.data.state.clipping=o,t.data.repr=e.data.repr,t.label=`Clipping (${o.layers.length} Layers)`,lE.UpdateResult.Updated)}}),SUe=AD.BuiltIn({name:`clipping-structure-representation-3d-from-bundle`,display:`Clipping 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({layers:V.ObjectList({bundle:V.Value(qR.Empty),groups:V.Converted(e=>Qq.Groups.toNames(e),e=>Qq.Groups.fromNames(e),V.MultiSelect(Ib(Qq.Groups.Names),V.objectToOptions(Qq.Groups.Names)))},e=>`${Qq.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:qR.Empty,groups:Qq.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let n=e.data.sourceData,r=Qq.ofBundle(t.layers,n);return new H.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:Qq.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){let i=t.data.info;if(e.data.sourceData!==i||e.data.repr!==t.data.repr)return lE.UpdateResult.Recreate;let a=t.data.state.clipping,o=Qq.ofBundle(n.layers,i);return Qq.areEqual(a,o)?lE.UpdateResult.Unchanged:(t.data.state.clipping=o,t.data.repr=e.data.repr,t.label=`Clipping (${o.layers.length} Layers)`,lE.UpdateResult.Updated)}}),CUe=AD.BuiltIn({name:`theme-strength-representation-3d`,display:`Theme Strength 3D Representation`,from:H.Molecule.Structure.Representation3D,to:H.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:V.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:V.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:V.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:V.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){return new H.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,emissive:t.emissiveStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:e.data.repr},{label:`Theme Strength`,description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.emissiveStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){return n.overpaintStrength===t.data.state.themeStrength?.overpaint&&n.transparencyStrength===t.data.state.themeStrength?.transparency&&n.emissiveStrength===t.data.state.themeStrength?.emissive&&n.substanceStrength===t.data.state.themeStrength?.substance?lE.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:n.overpaintStrength,transparency:n.transparencyStrength,emissive:n.emissiveStrength,substance:n.substanceStrength},t.data.repr=e.data.repr,t.label=`Theme Strength`,t.description=`${n.overpaintStrength.toFixed(2)}, ${n.transparencyStrength.toFixed(2)}, ${n.emissiveStrength.toFixed(2)}, ${n.substanceStrength.toFixed(2)}`,lE.UpdateResult.Updated)},interpolate(e,t,n){return{overpaintStrength:OT(e.overpaintStrength,t.overpaintStrength,n),transparencyStrength:OT(e.transparencyStrength,t.transparencyStrength,n),emissiveStrength:OT(e.emissiveStrength,t.emissiveStrength,n),substanceStrength:OT(e.substanceStrength,t.substanceStrength,n)}}}),FY;(function(e){function t(e,t,n,r,i,a,o,s){let c=e.representation.volume.registry.get(t),l=e.representation.volume.themes.colorThemeRegistry.get(i||c.defaultColorTheme.name),u=e.representation.volume.themes.sizeThemeRegistry.get(o||c.defaultSizeTheme.name),d=V.getDefaultValues(c.getParams(e.representation.volume.themes,n));return{type:{name:t,params:r?{...d,...r}:d},colorTheme:{name:l.name,params:a?{...l.defaultValues,...a}:l.defaultValues},sizeTheme:{name:u.name,params:s?{...u.defaultValues,...s}:u.defaultValues}}}e.getDefaultParams=t;function n(e,t,n,r,i,a,o){let s=e.representation.volume.registry.get(t),c=e.representation.volume.themes.colorThemeRegistry.get(r||s.defaultColorTheme.name),l=e.representation.volume.themes.sizeThemeRegistry.get(a||s.defaultSizeTheme.name);return{type:{name:t,params:n?{...s.defaultValues,...n}:s.defaultValues},colorTheme:{name:s.defaultColorTheme.name,params:i?{...c.defaultValues,...i}:c.defaultValues},sizeTheme:{name:s.defaultSizeTheme.name,params:o?{...l.defaultValues,...o}:l.defaultValues}}}e.getDefaultParamsStatic=n;function r(e){if(e.isoValue)return zP.IsoValue.toString(e.isoValue);if(e.renderMode?.params?.isoValue)return zP.IsoValue.toString(e.renderMode?.params?.isoValue)}e.getDescription=r})(FY||={});var wUe=AD.BuiltIn({name:`volume-representation-3d`,display:`3D Representation`,from:H.Volume.Data,to:H.Volume.Representation3D,params:(e,t)=>{let{registry:n,themes:r}=t.representation.volume,i=n.get(n.default.name);if(!e)return{type:V.Mapped(n.default.name,n.types,e=>V.Group(n.get(e).getParams(r,zP.One))),colorTheme:V.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.types,e=>V.Group(r.colorThemeRegistry.get(e).getParams({volume:zP.One}))),sizeTheme:V.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.types,e=>V.Group(r.sizeThemeRegistry.get(e).getParams({volume:zP.One})))};let a={volume:e.data};return{type:V.Mapped(n.default.name,n.types,t=>V.Group(n.get(t).getParams(r,e.data))),colorTheme:V.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.getApplicableTypes(a),e=>V.Group(r.colorThemeRegistry.get(e).getParams(a))),sizeTheme:V.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.getApplicableTypes(a),e=>V.Group(r.sizeThemeRegistry.get(e).getParams(a)))}}})({canAutoUpdate({oldParams:e,newParams:t}){return e.type.name===t.type.name},apply({a:e,params:t},n){return hb.create(`Volume Representation`,async r=>{let i={runtime:r,assetManager:n.managers.asset,errorContext:n.errorContext},a=n.representation.volume.registry.get(t.type.name);a.ensureCustomProperties&&await a.ensureCustomProperties.attach(i,e.data);let o=a.factory({webgl:n.canvas3d?.webgl,...n.representation.volume.themes},a.getParams);o.setTheme(oq.create(n.representation.volume.themes,{volume:e.data,locationKinds:a.locationKinds},t));let s=t.type.params||{};return await o.createOrUpdate(s,e.data).runInContext(r),new H.Volume.Representation3D({repr:o,sourceData:e.data},{label:a.label,description:FY.getDescription(s)})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Volume Representation`,async a=>{var o;let s=i.representation.volume.registry.get(n.type.name);if(r.type.name!==n.type.name)return(o=s.ensureCustomProperties)==null||o.detach(e.data),lE.UpdateResult.Recreate;let c={...t.data.repr.props,...r.type.params};return t.data.repr.setTheme(oq.create(i.representation.volume.themes,{volume:e.data,locationKinds:s.locationKinds},r)),await t.data.repr.createOrUpdate(c,e.data).runInContext(a),t.data.sourceData=e.data,t.description=FY.getDescription(c),lE.UpdateResult.Updated})}}),TUe=AD.BuiltIn({name:`shape-representation-3d`,display:`3D Representation`,from:H.Shape.Provider,to:H.Shape.Representation3D,params:(e,t)=>e?e.data.params:EM.Params})({canAutoUpdate(){return!0},apply({a:e,params:t}){return hb.create(`Shape Representation`,async n=>{let r={...V.getDefaultValues(e.data.params),...t},i=aJ(e.data.getShape,e.data.geometryUtils);return await i.createOrUpdate(r,e.data.data).runInContext(n),new H.Shape.Representation3D({repr:i,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,newParams:n}){return hb.create(`Shape Representation`,async r=>{let i={...t.data.repr.props,...n};return await t.data.repr.createOrUpdate(i,e.data.data).runInContext(r),t.data.sourceData=e.data,lE.UpdateResult.Updated})}}),EUe=AD.BuiltIn({name:`model-unitcell-3d`,display:`Model Unit Cell`,from:H.Molecule.Model,to:H.Shape.Representation3D,params:()=>({...xJ})})({isApplicable:e=>!!bB.Provider.get(e.data),canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Model Unit Cell`,async r=>{let i=bB.Provider.get(e.data);if(!i)return Mx.Null;let a=SJ(e.data,i,t),o=AVe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>xJ);return await o.createOrUpdate(t,a).runInContext(r),new H.Shape.Representation3D({repr:o,sourceData:a},{label:`Unit Cell`,description:i.spacegroup.name})})},update({a:e,b:t,newParams:n}){return hb.create(`Model Unit Cell`,async r=>{let i=bB.Provider.get(e.data);if(!i)return lE.UpdateResult.Null;let a={...t.data.repr.props,...n},o=SJ(e.data,i,a);return await t.data.repr.createOrUpdate(a,o).runInContext(r),t.data.sourceData=o,lE.UpdateResult.Updated})}}),DUe=AD.BuiltIn({name:`structure-bounding-box-3d`,display:`Bounding Box`,from:H.Molecule.Structure,to:H.Shape.Representation3D,params:{radius:V.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:V.Color(gk.red,{isEssential:!0}),...HM.Params}})({canAutoUpdate(){return!0},apply({a:e,params:t},n){return hb.create(`Bounding Box`,async n=>{let r=aJ((e,t,n,r)=>{let i=OY(t.box,t.radius,r?.geometry);return jF.create(`Bouding Box`,t,i,()=>t.color,()=>1,()=>`Bounding Box`)},HM.Utils);return await r.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(n),new H.Shape.Representation3D({repr:r,sourceData:e.data},{label:`Bounding Box`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Bounding Box`,async n=>(await t.data.repr.createOrUpdate(r,{box:e.data.boundary.box,radius:r.radius,color:r.color}).runInContext(n),t.data.sourceData=e.data,lE.UpdateResult.Updated))}}),OUe=AD.BuiltIn({name:`structure-selections-distance-3d`,display:`3D Distance`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...GJ})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Distance`,async r=>{let i=eW(e.data),a=UVe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>GJ);return await a.createOrUpdate(t,i).runInContext(r),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Distance`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Distance`,async n=>{let i={...t.data.repr.props,...r},a=eW(e.data);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,lE.UpdateResult.Updated})}}),kUe=AD.BuiltIn({name:`structure-selections-angle-3d`,display:`3D Angle`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...dY})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Angle`,async r=>{let i=tW(e.data),a=NHe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>dY);return await a.createOrUpdate(t,i).runInContext(r),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Angle`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Angle`,async n=>{let i={...t.data.repr.props,...r},a=tW(e.data);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,lE.UpdateResult.Updated})}}),AUe=AD.BuiltIn({name:`structure-selections-dihedral-3d`,display:`3D Dihedral`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...xY})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Dihedral`,async r=>{let i=nW(e.data),a=eUe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>xY);return await a.createOrUpdate(t,i).runInContext(r),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Dihedral`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Dihedral`,async n=>{let i={...t.data.repr.props,...r},a=nW(e.data);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,lE.UpdateResult.Updated})}}),jUe=AD.BuiltIn({name:`structure-selections-label-3d`,display:`3D Label`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...XJ})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Label`,async r=>{let i=rW(e.data),a=YVe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>XJ);await a.createOrUpdate(t,i).runInContext(r);let o=!!(t.snapshotKey?.trim()||t.tooltip?.trim());return a.setState({pickable:o,markerActions:o?uq.Highlighting:lq.None}),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Label`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Label`,async n=>{let i={...t.data.repr.props,...r},a=rW(e.data);await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a;let o=!!(r.snapshotKey?.trim()||r.tooltip?.trim());return t.data.repr.setState({pickable:o,markerActions:o?uq.Highlighting:lq.None}),lE.UpdateResult.Updated})}}),MUe=AD.BuiltIn({name:`structure-selections-orientation-3d`,display:`3D Orientation`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...oY})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Orientation`,async r=>{let i=iW(e.data),a=yHe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>oY);return await a.createOrUpdate(t,i).runInContext(r),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Orientation`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Orientation`,async n=>{let i={...t.data.repr.props,...r},a=iW(e.data);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,lE.UpdateResult.Updated})}}),NUe=AD.BuiltIn({name:`structure-selections-plane-3d`,display:`3D Plane`,from:H.Molecule.Structure.Selections,to:H.Shape.Representation3D,params:()=>({...jY})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},n){return hb.create(`Structure Plane`,async r=>{let i=aW(e.data),a=cUe({webgl:n.canvas3d?.webgl,...n.representation.structure.themes},()=>jY);return await a.createOrUpdate(t,i).runInContext(r),new H.Shape.Representation3D({repr:a,sourceData:i},{label:`Plane`})})},update({a:e,b:t,oldParams:n,newParams:r},i){return hb.create(`Structure Plane`,async n=>{let i={...t.data.repr.props,...r},a=aW(e.data);return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,lE.UpdateResult.Updated})}});const IY={Data:Ave,Misc:Xve,Model:fLe,Volume:tRe,Representation:lUe,Shape:tUe};var LY;(function(e){function t(e){return e}e.create=t;function n(e,t){var n;if(t.customDurationMs)return t.customDurationMs;let r=(n=t.definition).getDuration?.call(n,t.params,e);if(r?.kind===`fixed`)return r.durationMs}e.getDuration=n})(LY||={});const RY=LY.create({name:`built-in.animate-model-index`,display:{name:`Animate Trajectory`},isExportable:!0,params:()=>({mode:V.MappedStatic(`loop`,{palindrome:V.Group({}),loop:V.Group({direction:V.Select(`forward`,[[`forward`,`Forward`],[`backward`,`Backward`]])}),once:V.Group({direction:V.Select(`forward`,[[`forward`,`Forward`],[`backward`,`Backward`]])},{isFlat:!0})},{options:[[`palindrome`,`Palindrome`],[`loop`,`Loop`],[`once`,`Once`]]}),duration:V.MappedStatic(`fixed`,{fixed:V.Group({durationInS:V.Numeric(5,{min:1,max:120,step:.1},{description:`Duration in seconds`})},{isFlat:!0}),computed:V.Group({targetFps:V.Numeric(30,{min:5,max:250,step:1},{label:`Target FPS`})},{isFlat:!0}),sequential:V.Group({maxFps:V.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){let t=e.state.data,n=t.select(FE.Generators.ofTransformer(IY.Model.ModelFromTrajectory));for(let e of n){let n=FE.findAncestorOfType(t.tree,t.cells,e.transform.ref,H.Molecule.Trajectory);if(n&&n.obj&&n.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:`No trajectory to animate`}},getDuration:(e,t)=>{if(e.duration?.name===`fixed`)return{kind:`fixed`,durationMs:e.duration.params.durationInS*1e3};if(e.duration.name===`computed`){let n=t.state.data,r=n.select(FE.Generators.ofTransformer(IY.Model.ModelFromTrajectory)),i=0;for(let t of r){let r=FE.findAncestorOfType(n.tree,n.cells,t.transform.ref,H.Molecule.Trajectory);if(!r||!r.obj)continue;let a=r.obj;i=Math.max(Math.ceil(1e3*a.data.frameCount/e.duration.params.targetFps),i)}return{kind:`fixed`,durationMs:i}}return{kind:`unknown`}},initialState:()=>({}),async apply(e,t,n){if(n.params.duration.name===`sequential`&&t.current>0&&t.current-t.lastApplied<1e3/n.params.duration.params.maxFps)return{kind:`skip`};let r=n.plugin.state.data,i=r.select(FE.Generators.ofTransformer(IY.Model.ModelFromTrajectory));if(i.length===0)return{kind:`finished`};let a=r.build(),o=n.params,s=e.palindromeDirections||{},c=!1,l=!0;for(let e of i){let n=FE.findAncestorOfType(r.tree,r.cells,e.transform.ref,H.Molecule.Trajectory);if(!n||!n.obj)continue;let i=n.obj;i.data.frameCount<=1||a.to(e).update(n=>{let r=i.data.frameCount;if(r!==1)l=!1;else return n;if(o.duration.name===`sequential`){let t=1;if(o.mode.name===`once`){if(t=o.mode.params.direction===`backward`?-1:1,t===-1&&n.modelIndex===0||t===1&&n.modelIndex===r-1)return c=!0,n}else o.mode.name===`palindrome`&&(t=n.modelIndex===0?1:n.modelIndex===r-1?-1:s[e.transform.ref]||1);s[e.transform.ref]=t;let i=(n.modelIndex+t)%r;return i<0&&(i+=r),c=c||t===-1&&i===0||t===1&&i===r-1,{modelIndex:i}}else{let e=o.duration.name===`fixed`?o.duration.params.durationInS*1e3:Math.ceil(1e3*i.data.frameCount/o.duration.params.targetFps);if(o.mode.name===`once`&&t.current>=e)return c=!0,{modelIndex:i.data.frameCount-1};let n=t.current%e/e;return o.mode.name===`loop`&&o.mode.params.direction===`backward`&&(n=1-n),o.mode.name===`palindrome`&&(n=2*n,n>1&&(n=2-n)),{modelIndex:Math.min(Math.floor(i.data.frameCount*n),i.data.frameCount-1)}}})}return l||await jx.State.Update(n.plugin,{state:r,tree:a,options:{doNotLogTiming:!0}}),l||o.mode.name===`once`&&c?{kind:`finished`}:o.mode.name===`palindrome`?{kind:`next`,state:{palindromeDirections:s}}:{kind:`next`,state:{}}}});var zY=class{constructor(){this.subs=void 0}subscribe(e,t){if(!e)return{unsubscribe:()=>{}};this.subs===void 0&&(this.subs=[]);let n=e.subscribe(t);return this.subs.push(n),{unsubscribe:()=>{n&&this.subs&&kE(this.subs,n)&&(n.unsubscribe(),n=void 0)}}}get ev(){return this._ev||=_D.create()}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(let e of this.subs)e.unsubscribe();this.subs=void 0}}},BY=class extends zY{updateState(...e){let t=this.state,n=Dfe(t,e);return n===t?!1:(this._state=n,!0)}get state(){return this._state}constructor(e){super(),this._state=e}};const VY=`measurement-group`,HY=`measurement-order-label`,UY={distanceUnitLabel:V.Text(``,{isEssential:!0}),textColor:VJ.textColor};var PUe=V.getDefaultValues(UY);function WY(e){return{bundle:qR.fromLoci(e)}}var FUe=class extends BY{stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){let e=this.plugin.state.data,t=FE.findTagInSubtree(e.tree,yE.RootRef,VY),n=this.plugin.state.data.build();return t?n.to(t):n.toRoot().group(IY.Misc.CreateGroup,{label:`Measurements`},{tags:VY})}async setOptions(e){this.updateState({options:e})&&this.stateUpdated();let t=this.plugin.state.data.build();for(let n of this.state.distances)t.to(n).update(t=>{t.unitLabel=e.distanceUnitLabel,t.textColor=e.textColor});for(let n of this.state.labels)t.to(n).update(t=>{t.textColor=e.textColor});for(let n of this.state.angles)t.to(n).update(t=>{t.textColor=e.textColor});for(let n of this.state.dihedrals)t.to(n).update(t=>{t.textColor=e.textColor});t.editInfo.count!==0&&await jx.State.Update(this.plugin,{state:this.plugin.state.data,tree:t,options:{doNotLogTiming:!0}})}async addDistance(e,t,n){let r=this.plugin.helpers.substructureParent.get(e.structure),i=this.plugin.helpers.substructureParent.get(t.structure);if(!r||!i)return;let a=[r.transform.ref];OE(a,i.transform.ref);let o=this.getGroup().apply(IY.Model.MultiStructureSelectionFromBundle,{selections:[{key:`a`,groupId:`a`,ref:r.transform.ref,...WY(e)},{key:`b`,groupId:`b`,ref:i.transform.ref,...WY(t)}],isTransitive:!0,label:`Distance`},{dependsOn:a,tags:n?.selectionTags}),s=o.apply(IY.Representation.StructureSelectionsDistance3D,{customText:n?.customText||``,unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor,...n?.lineParams,...n?.labelParams,...n?.visualParams},{tags:n?.reprTags}),c=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:c,tree:s,options:{doNotLogTiming:!0}}),{selection:o.selector,representation:s.selector}}async addAngle(e,t,n,r){let i=this.plugin.helpers.substructureParent.get(e.structure),a=this.plugin.helpers.substructureParent.get(t.structure),o=this.plugin.helpers.substructureParent.get(n.structure);if(!i||!a||!o)return;let s=[i.transform.ref];OE(s,a.transform.ref),OE(s,o.transform.ref);let c=this.getGroup().apply(IY.Model.MultiStructureSelectionFromBundle,{selections:[{key:`a`,ref:i.transform.ref,...WY(e)},{key:`b`,ref:a.transform.ref,...WY(t)},{key:`c`,ref:o.transform.ref,...WY(n)}],isTransitive:!0,label:`Angle`},{dependsOn:s,tags:r?.selectionTags}),l=c.apply(IY.Representation.StructureSelectionsAngle3D,{customText:r?.customText||``,textColor:this.state.options.textColor,...r?.lineParams,...r?.labelParams,...r?.visualParams},{tags:r?.reprTags}),u=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:u,tree:l,options:{doNotLogTiming:!0}}),{selection:c.selector,representation:l.selector}}async addDihedral(e,t,n,r,i){let a=this.plugin.helpers.substructureParent.get(e.structure),o=this.plugin.helpers.substructureParent.get(t.structure),s=this.plugin.helpers.substructureParent.get(n.structure),c=this.plugin.helpers.substructureParent.get(r.structure);if(!a||!o||!s||!c)return;let l=[a.transform.ref];OE(l,o.transform.ref),OE(l,s.transform.ref),OE(l,c.transform.ref);let u=this.getGroup().apply(IY.Model.MultiStructureSelectionFromBundle,{selections:[{key:`a`,ref:a.transform.ref,...WY(e)},{key:`b`,ref:o.transform.ref,...WY(t)},{key:`c`,ref:s.transform.ref,...WY(n)},{key:`d`,ref:c.transform.ref,...WY(r)}],isTransitive:!0,label:`Dihedral`},{dependsOn:l,tags:i?.selectionTags}),d=u.apply(IY.Representation.StructureSelectionsDihedral3D,{customText:i?.customText||``,textColor:this.state.options.textColor,...i?.lineParams,...i?.labelParams,...i?.visualParams},{tags:i?.reprTags}),f=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:f,tree:d,options:{doNotLogTiming:!0}}),{selection:u.selector,representation:d.selector}}async addLabel(e,t){let n=this.plugin.helpers.substructureParent.get(e.structure);if(!n)return;let r=[n.transform.ref],i=this.getGroup().apply(IY.Model.MultiStructureSelectionFromBundle,{selections:[{key:`a`,ref:n.transform.ref,...WY(e)}],isTransitive:!0,label:`Label`},{dependsOn:r,tags:t?.selectionTags}),a=i.apply(IY.Representation.StructureSelectionsLabel3D,{textColor:this.state.options.textColor,...t?.labelParams,...t?.visualParams},{tags:t?.reprTags}),o=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:o,tree:a,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:a.selector}}async addOrientation(e){let t=[],n=[];for(let r=0,i=e.length;r<i;++r){let i=e[r],a=this.plugin.helpers.substructureParent.get(i.structure);a&&(OE(n,a.transform.ref),t.push({key:`l${r}`,ref:a.transform.ref,...WY(i)}))}if(t.length===0)return;let r=this.getGroup().apply(IY.Model.MultiStructureSelectionFromBundle,{selections:t,isTransitive:!0,label:`Orientation`},{dependsOn:n}),i=r.apply(IY.Representation.StructureSelectionsOrientation3D),a=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:a,tree:i,options:{doNotLogTiming:!0}}),{selection:r.selector,representation:i.selector}}async addPlane(e){let t=[],n=[];for(let r=0,i=e.length;r<i;++r){let i=e[r],a=this.plugin.helpers.substructureParent.get(i.structure);a&&(OE(n,a.transform.ref),t.push({key:`l${r}`,ref:a.transform.ref,...WY(i)}))}if(t.length===0)return;let r=this.getGroup(),i=r.apply(IY.Model.MultiStructureSelectionFromBundle,{selections:t,isTransitive:!0,label:`Plane`},{dependsOn:n}),a=i.apply(IY.Representation.StructureSelectionsPlane3D),o=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:o,tree:r,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:a.selector}}async addOrderLabels(e){let t=this.getGroup(),n=this.plugin.state.data.select(FE.Generators.ofType(H.Molecule.Structure.Selections).withTag(HY));for(let e of n)t.delete(e);let r=1;for(let n of e){let e=this.plugin.helpers.substructureParent.get(n.structure);if(!e)continue;let i=[e.transform.ref];t.apply(IY.Model.MultiStructureSelectionFromBundle,{selections:[{key:`a`,ref:e.transform.ref,...WY(n)}],isTransitive:!0,label:`Order`},{dependsOn:i,tags:HY}).apply(IY.Representation.StructureSelectionsLabel3D,{textColor:tE.fromRgb(255,255,255),borderColor:tE.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:`${r++}`},{tags:HY})}let i=this.plugin.state.data;return await jx.State.Update(this.plugin,{state:i,tree:t,options:{doNotLogTiming:!0}}),{representation:t.selector}}getTransforms(e){let t=this.plugin.state.data,n=FE.findTagInSubtree(t.tree,yE.RootRef,VY),r=n?t.select(FE.Generators.ofTransformer(e,n)):this._empty;return r.length===0?this._empty:r}sync(){let e=[];for(let t of this.getTransforms(IY.Representation.StructureSelectionsLabel3D)){let n=t.obj.tags;(!n||!n.includes(`measurement-order-label`))&&e.push(t)}this.updateState({labels:e,distances:this.getTransforms(IY.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(IY.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(IY.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(IY.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(IY.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}constructor(e){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:PUe}),this.plugin=e,this.behaviors={state:this.ev.behavior(this.state)},this._empty=[],e.state.data.events.changed.subscribe(t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync()}),e.behaviors.state.isAnimating.subscribe(t=>{!t&&!e.behaviors.state.isUpdating.value&&this.sync()})}};const GY=async(e,t)=>{let n=`https://models.rcsb.org/${t.toLowerCase()}.bcif`;await e.managers.structure.hierarchy.remove(e.managers.structure.hierarchy.current.structures);let r=await e.builders.data.download({url:gx.Url(n),isBinary:!0}),i=await e.builders.structure.parseTrajectory(r,`mmcif`);await e.builders.structure.hierarchy.applyPreset(i,`default`)},IUe=async(e,t)=>{await e.managers.structure.hierarchy.remove(e.managers.structure.hierarchy.current.structures);let n=t.name.endsWith(`.bcif`),r=await e.builders.data.readFile({file:gx.File(t),isBinary:n,label:t.name}),i=t.name.endsWith(`.pdb`)?`pdb`:`mmcif`,a=await e.builders.structure.parseTrajectory(r.data,i);await e.builders.structure.hierarchy.applyPreset(a,`default`)},LUe=async(e,t)=>{console.log(`[HyperMol] updateRepresentation called with type:`,t);let n=e.managers.structure.hierarchy.current.structures;if(n.length===0){console.warn(`[HyperMol] No structures found`);return}let r=n[0],i=`polymer`;t===`ball-stick`&&(i=`all`),console.log(`[HyperMol] Creating/Selecting component with selection:`,i);let a=await e.builders.structure.tryCreateComponentStatic(r.cell,i);if(!a&&i===`polymer`&&(console.warn(`[HyperMol] Polymer component creation failed, falling back to "all"`),a=await e.builders.structure.tryCreateComponentStatic(r.cell,`all`)),a){let n=r.components,i=[],o=a.cell;for(let t of n)t.cell===o?(console.log(`[HyperMol] Reusing component, clearing existing representations`),await e.managers.structure.hierarchy.remove(t.representations)):(console.log(`[HyperMol] Removing unused component`),i.push(t));i.length>0&&await e.managers.structure.hierarchy.remove(i),console.log(`[HyperMol] Adding new representation...`);let s=t===`ball-stick`?`ball-and-stick`:t,c=e.canvas3d?.camera.getSnapshot();await e.builders.structure.representation.addRepresentation(a,{type:s,color:`chain-id`}),c&&e.canvas3d?.camera.setState(c),console.log(`[HyperMol] Representation added successfully`)}else console.error(`[HyperMol] Failed to create component`)},RUe=async(e,t)=>{let n=e.managers.structure.hierarchy.current.structures;if(n.length===0)return;let r=n[0].components;await e.managers.structure.component.updateRepresentationsTheme(r,{color:t})},zUe=async e=>{let t=e.canvas3d?.webgl.gl.canvas;if(t&&typeof t.toDataURL==`function`){let e=t.toDataURL(`image/png`),n=document.createElement(`a`);n.href=e,n.download=`hypermol-snapshot-${Date.now()}.png`,n.click()}},BUe=async e=>{await e.managers.animation.stop(),await e.managers.animation.play(RY,{duration:{name:`computed`,params:{targetFps:30}},mode:{name:`loop`,params:{direction:`forward`}}})},VUe=async e=>{await e.managers.animation.stop()},KY=e=>{let t=e.managers.structure.hierarchy.current.structures;if(t.length===0)return null;let n=t[0].cell.obj?.data;if(!n||n.models.length===0)return null;let r=n.models[0];return`trajectoryInfo`in r?r.trajectoryInfo:null},qY=(e,t)=>{e.managers.interactivity.setProps({granularity:t})},HUe=async e=>{let t=e.state.data,n=t.select(FE.Generators.root.subtree().withTag(VY));for(let e of n)await t.updateTree(t.build().delete(e.transform.ref)).run()},UUe=async(e,t,n)=>{let r=2;return n===`angle`?r=3:n===`dihedral`&&(r=4),t.length===r?(n===`distance`?await e.managers.structure.measurement.addDistance(t[0],t[1]):n===`angle`?await e.managers.structure.measurement.addAngle(t[0],t[1],t[2]):n===`dihedral`&&await e.managers.structure.measurement.addDihedral(t[0],t[1],t[2],t[3]),`Measured ${n}`):`Please select exactly ${r} atoms (currently ${t.length})`},WUe=e=>$(e.structure,e.elements.map(e=>({unit:e.unit,indices:K.ofSortedArray(K.toArray(e.indices))}))),GUe=async e=>{try{let t=await fetch(`https://data.rcsb.org/rest/v1/core/entry/${e}`);if(!t.ok)throw Error(`Network response was not ok`);let n=await t.json();return{id:n.rcsb_id,title:n.struct.title,description:n.struct.pdbx_descriptor,resolution:n.rcsb_entry_info.resolution_combined?.[0]?.toFixed(2)+` `,organism:n.rcsb_entity_source_organism?.[0]?.scientific_name}}catch(t){return console.warn(`Failed to fetch metadata for ${e}, using fallback.`,t),{id:e,title:`Structure ${e}`,description:`Metadata not available`}}};var{Sider:KUe}=Rv,{Title:qUe,Text:JY}=Wle,{Dragger:JUe}=fue,{Option:YY}=hg;const YUe=()=>{let{plugin:e}=Iy(),{message:t}=Ym.useApp(),[n,r]=(0,y.useState)(!1),[i,a]=(0,y.useState)(!1),[o,s]=(0,y.useState)(null),[c,l]=(0,y.useState)(!1),[u,d]=(0,y.useState)(0),[f,p]=(0,y.useState)(`residue`),[m,h]=(0,y.useState)(`none`),[g,_]=(0,y.useState)([]),v=y.useRef([]);y.useEffect(()=>{if(!e||m===`none`)return;v.current=[],_([]),qY(e,`element`);let n=e.behaviors.interaction.click.subscribe(n=>{if(n.current?.loci&&n.current.loci.kind===`element-loci`){let r=n.current.loci;if(!$.isEmpty(r)){if($.size(r)!==1){t.warning(`Please click exactly one atom`);return}if(v.current.length>0){let e=v.current[v.current.length-1];if($.areEqual(e,r)){console.log(`[HyperMol] Duplicate click detected, ignoring`);return}}console.log(`[HyperMol] Clicked Loci:`,r);let n=r.elements[0];console.log(`[HyperMol] Atom Unit:`,n.unit.id,`Index:`,K.start(n.indices));let i=r,a=e.managers.structure.hierarchy.current.structures;for(let e of a){let t=e.cell.obj?.data;if(t){let e=$.remap(r,t);if(!$.isEmpty(e)){i=e,console.log(`[HyperMol] Remapped Loci to Root Structure`);break}}}let o=WUe(i),s=[...v.current,o];v.current=s,console.log(`[HyperMol] Current Points:`,s.length);let c=2;m===`angle`?c=3:m===`dihedral`&&(c=4),s.length===c?(UUe(e,s,m).then(e=>t.success(e)),h(`none`),_([]),v.current=[]):(t.info(`Selected ${s.length}/${c}`),_(s))}}});return()=>{n.unsubscribe(),e&&qY(e,f)}},[e,m,t,f]);let b=async n=>{if(!(!e||!n)){a(!0),s(null);try{await Promise.all([GY(e,n),GUe(n).then(s)]);let r=KY(e);d(r?r.size:0),t.success(`Loaded ${n.toUpperCase()}`)}catch(e){console.error(e),t.error(`Failed to load.`)}finally{a(!1)}}},x={name:`file`,multiple:!1,showUploadList:!1,beforeUpload:n=>(e&&IUe(e,n).then(()=>{let n=KY(e);d(n?n.size:0),t.success(`Loaded File`)}),!1)},S={color:`#8A8680`,fontSize:`11px`,fontWeight:600,textTransform:`uppercase`,letterSpacing:`0.5px`},C={color:`#DA7756`};return(0,I.jsx)(KUe,{collapsible:!0,collapsed:n,onCollapse:r,width:340,style:{background:`#EBE8E2`,borderRight:`1px solid #E0DDD5`,overflowY:`auto`,height:`100vh`},trigger:null,children:(0,I.jsxs)(`div`,{style:{padding:`24px`,display:n?`none`:`block`},children:[(0,I.jsxs)(`div`,{style:{marginBottom:`24px`},children:[(0,I.jsx)(qUe,{level:3,style:{color:`#45423C`,margin:0,fontFamily:`serif`},children:`HyperMol`}),(0,I.jsx)(JY,{style:{color:`#8A8680`,fontSize:`13px`},children:`WebGL2 Accelerated Viewer`})]}),(0,I.jsx)(JY,{style:S,children:`Data Source`}),(0,I.jsx)(Mce.Search,{placeholder:`PDB ID (e.g. 1BNA)`,allowClear:!0,enterButton:(0,I.jsx)(O_,{type:`primary`,icon:(0,I.jsx)(fg,{})}),onSearch:b,loading:i,size:`large`,style:{marginTop:`8px`,marginBottom:`16px`},variant:`filled`}),(0,I.jsxs)(JUe,{...x,style:{background:`#F7F5F3`,borderColor:`#E0DDD5`,borderRadius:`12px`},children:[(0,I.jsx)(`p`,{className:`ant-upload-drag-icon`,children:(0,I.jsx)(Wse,{style:{color:`#DA7756`,fontSize:`28px`}})}),(0,I.jsx)(`p`,{className:`ant-upload-text`,style:{color:`#666`,fontSize:`13px`},children:`Drag local .bcif / .pdb`})]}),o&&(0,I.jsxs)(gse,{size:`small`,variant:`borderless`,style:{marginTop:`20px`,background:`#FFF`,boxShadow:`0 4px 12px rgba(0,0,0,0.02)`},children:[(0,I.jsxs)(`div`,{style:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,marginBottom:`8px`},children:[(0,I.jsx)(JY,{strong:!0,style:{fontSize:`16px`,color:`#DA7756`},children:o.id}),(0,I.jsx)(ty,{color:`orange`,children:o.resolution})]}),(0,I.jsx)(JY,{style:{color:`#444`,fontSize:`13px`,lineHeight:1.4,display:`block`},children:o.title}),(0,I.jsxs)(`div`,{style:{marginTop:`12px`,fontSize:`12px`,color:`#999`},children:[(0,I.jsx)(Lse,{}),` `,o.organism]})]}),(0,I.jsx)(J_,{style:{borderColor:`#D6D3CD`}}),(0,I.jsx)(JY,{style:S,children:`Representation`}),(0,I.jsxs)(`div`,{style:{marginTop:`12px`,display:`flex`,flexDirection:`column`,gap:`12px`},children:[(0,I.jsxs)(hg,{defaultValue:`cartoon`,variant:`borderless`,style:{background:`#FFF`,borderRadius:`8px`,padding:`4px`},onChange:t=>LUe(e,t),children:[(0,I.jsx)(YY,{value:`cartoon`,children:`Cartoon`}),(0,I.jsx)(YY,{value:`ball-stick`,children:`Ball & Stick`}),(0,I.jsx)(YY,{value:`molecular-surface`,children:`Soft Surface`})]}),(0,I.jsxs)(hg,{defaultValue:`chain-id`,variant:`borderless`,style:{background:`#FFF`,borderRadius:`8px`,padding:`4px`},onChange:t=>RUe(e,t),suffixIcon:(0,I.jsx)(Cse,{style:C}),children:[(0,I.jsx)(YY,{value:`chain-id`,children:`By Chain`}),(0,I.jsx)(YY,{value:`element-symbol`,children:`By Element`}),(0,I.jsx)(YY,{value:`rainbow`,children:`Rainbow Gradient`}),(0,I.jsx)(YY,{value:`hydrophobicity`,children:`Hydrophobicity`})]})]}),(0,I.jsx)(J_,{style:{borderColor:`#D6D3CD`}}),(0,I.jsx)(JY,{style:S,children:`Sequence Playback`}),u>1&&(0,I.jsx)(`div`,{style:{marginBottom:`8px`},children:(0,I.jsxs)(ty,{color:`geekblue`,children:[u,` Frames`]})}),(0,I.jsx)(`div`,{style:{marginTop:`12px`,marginBottom:`16px`},children:(0,I.jsx)(O_,{block:!0,icon:c?(0,I.jsx)(Jse,{}):(0,I.jsx)(Qse,{}),onClick:async()=>{e&&(c?(await VUe(e),l(!1)):(await BUe(e),l(!0)))},style:{background:c?`#FDF3F0`:`#FFF`,borderColor:c?`#DA7756`:`#E0DDD5`,color:c?`#DA7756`:`#666`},children:c?`Pause Simulation`:`Play Simulation`})}),(0,I.jsx)(J_,{style:{borderColor:`#D6D3CD`}}),(0,I.jsx)(JY,{style:S,children:`Measurements (Playground)`}),(0,I.jsxs)(`div`,{style:{marginTop:`12px`,marginBottom:`12px`},children:[(0,I.jsxs)(`div`,{style:{marginBottom:`8px`,display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,I.jsx)(JY,{style:{fontSize:`12px`,color:`#666`},children:`Selection Mode:`}),(0,I.jsxs)(M_.Group,{size:`small`,value:f,onChange:t=>{p(t.target.value),e&&qY(e,t.target.value)},buttonStyle:`solid`,children:[(0,I.jsx)(M_.Button,{value:`residue`,children:`Residue`}),(0,I.jsx)(M_.Button,{value:`element`,children:`Atom`})]})]}),(0,I.jsxs)(`div`,{style:{display:`grid`,gridTemplateColumns:`1fr 1fr 1fr`,gap:`4px`},children:[(0,I.jsx)(O_,{size:`small`,type:m===`distance`?`primary`:`default`,onClick:()=>{h(`distance`),_([]),t.info(`Click 2 atoms`)},children:`Dist (2)`}),(0,I.jsx)(O_,{size:`small`,type:m===`angle`?`primary`:`default`,onClick:()=>{h(`angle`),_([]),t.info(`Click 3 atoms`)},children:`Angle (3)`}),(0,I.jsx)(O_,{size:`small`,type:m===`dihedral`?`primary`:`default`,onClick:()=>{h(`dihedral`),_([]),t.info(`Click 4 atoms`)},children:`Torsion (4)`})]}),m!==`none`&&(0,I.jsxs)(`div`,{style:{marginTop:`8px`,textAlign:`center`},children:[(0,I.jsxs)(ty,{color:`processing`,children:[`Selecting: `,g.length,` / `,m===`distance`?2:m===`angle`?3:4]}),(0,I.jsx)(O_,{type:`text`,size:`small`,danger:!0,onClick:()=>{h(`none`),_([])},children:`Cancel`})]}),(0,I.jsx)(O_,{block:!0,size:`small`,danger:!0,icon:(0,I.jsx)(kse,{}),style:{marginTop:`8px`},onClick:()=>e&&HUe(e),children:`Clear Measurements`})]}),(0,I.jsx)(J_,{style:{borderColor:`#D6D3CD`}}),(0,I.jsx)(O_,{block:!0,size:`large`,icon:(0,I.jsx)(Tse,{}),style:{background:`#FFF`,borderColor:`#E0DDD5`,color:`#666`,height:`48px`},onClick:()=>zUe(e),children:`Capture High-Res`})]})})};var{Content:XUe}=Rv;const ZUe=({children:e})=>(0,I.jsxs)(Rv,{style:{minHeight:`100vh`},children:[(0,I.jsx)(YUe,{}),(0,I.jsx)(Rv,{children:(0,I.jsx)(XUe,{style:{position:`relative`,background:`#000`},children:e})})]});function XY(e){return e.svg?(0,I.jsx)(`span`,{className:`msp-icon msp-material-icon${e.inline?` msp-icon-inline`:``}`,title:e.title,style:e.style,children:(0,I.jsx)(e.svg,{})}):null}var ZY=(0,I.jsx)(`circle`,{r:`6px`,id:`circle-left`,cy:`12px`,cx:`8px`,strokeWidth:`1px`}),QY=(0,I.jsx)(`circle`,{r:`6px`,id:`circle-right`,cy:`12px`,cx:`16px`,strokeWidth:`1px`}),QUe=(0,I.jsxs)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:[(0,I.jsxs)(`defs`,{children:[ZY,QY]}),(0,I.jsxs)(`g`,{children:[(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-filled`}),(0,I.jsx)(`use`,{href:`#circle-right`,className:`msp-shape-filled`}),(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-empty`})]})]});function $Y(){return QUe}var $Ue=(0,I.jsxs)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:[(0,I.jsxs)(`defs`,{children:[ZY,QY,(0,I.jsxs)(`mask`,{id:`mask-left`,children:[(0,I.jsx)(`use`,{href:`#circle-left`,fill:`white`,stroke:`white`}),(0,I.jsx)(`use`,{href:`#circle-right`,fill:`black`,strokeWidth:`0px`,stroke:`white`})]})]}),(0,I.jsxs)(`g`,{children:[(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-filled`,mask:`url(#mask-left)`}),(0,I.jsx)(`use`,{href:`#circle-right`,className:`msp-shape-empty`})]})]});function eX(){return $Ue}var eWe=(0,I.jsxs)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:[(0,I.jsxs)(`defs`,{children:[ZY,QY,(0,I.jsx)(`clipPath`,{id:`clip-left`,children:(0,I.jsx)(`use`,{href:`#circle-right`})})]}),(0,I.jsxs)(`g`,{children:[(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-filled`,clipPath:`url(#clip-left)`}),(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-empty`}),(0,I.jsx)(`use`,{href:`#circle-right`,className:`msp-shape-empty`})]})]});function tX(){return eWe}var tWe=(0,I.jsxs)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:[(0,I.jsxs)(`defs`,{children:[ZY,QY]}),(0,I.jsxs)(`g`,{children:[(0,I.jsx)(`use`,{href:`#circle-left`,className:`msp-shape-empty`}),(0,I.jsx)(`use`,{href:`#circle-right`,className:`msp-shape-filled`})]})]});function nX(){return tWe}var nWe=(0,I.jsx)(`svg`,{width:`17px`,height:`17px`,viewBox:`0 0 299.463 299.463`,strokeWidth:`6px`,children:(0,I.jsx)(`g`,{children:(0,I.jsx)(`path`,{d:`M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z`})})});function rWe(){return nWe}var iWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z`})});function rX(){return iWe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z`})}),(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15`})});var aWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z`})});function oWe(){return aWe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{fill:`currentColor`,d:`M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z`})}),(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{fill:`currentColor`,d:`M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z`})});var sWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{fill:`currentColor`,d:`M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z`})});function cWe(){return sWe}var lWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z`})});function uWe(){return lWe}var dWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z`})});function iX(){return dWe}var fWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z`})});function aX(){return fWe}var pWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z`})});function mWe(){return hWe}var hWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M15 2c-2.71 0-5.05 1.54-6.22 3.78-1.28.67-2.34 1.72-3 3C3.54 9.95 2 12.29 2 15c0 3.87 3.13 7 7 7 2.71 0 5.05-1.54 6.22-3.78 1.28-.67 2.34-1.72 3-3C20.46 14.05 22 11.71 22 9c0-3.87-3.13-7-7-7M9 20c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.87 3.13 7 7 7-.84.63-1.88 1-3 1m3-3c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.86 3.13 6.99 7 7-.84.63-1.88 1-3 1m4.7-3.3c-.53.19-1.1.3-1.7.3-2.76 0-5-2.24-5-5 0-.6.11-1.17.3-1.7.53-.19 1.1-.3 1.7-.3 2.76 0 5 2.24 5 5 0 .6-.11 1.17-.3 1.7M19 12c0-3.86-3.13-6.99-7-7 .84-.63 1.87-1 3-1 2.76 0 5 2.24 5 5 0 1.12-.37 2.16-1 3`})});function oX(){return pWe}var gWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M7 10l5 5 5-5z`})});function sX(){return gWe}var _We=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M10 17l5-5-5-5v10z`})});function cX(){return _We}var vWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z`})});function lX(){return vWe}var yWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z`})});function bWe(){return yWe}var xWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 12h-2v3h-3v2h5zM7 9h3V7H5v5h2zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16.01H3V4.99h18z`})});function SWe(){return xWe}var CWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z`})});function uX(){return CWe}var wWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z`})});function dX(){return wWe}var TWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z`})});function fX(){return TWe}var EWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z`})});function DWe(){return EWe}var OWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z`})});function kWe(){return OWe}var AWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z`})});function jWe(){return AWe}var MWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z`})});function NWe(){return MWe}var PWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z`})});function pX(){return PWe}var FWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z`})});function mX(){return FWe}var IWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z`})});function LWe(){return IWe}var RWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z`})});function hX(){return RWe}var zWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`})});function gX(){return zWe}var BWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z`})});function _X(){return BWe}var VWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z`})});function HWe(){return VWe}var UWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z`})});function WWe(){return UWe}var GWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z`})});function KWe(){return GWe}var qWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z`})});function JWe(){return qWe}var YWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z`})});function XWe(){return YWe}var ZWe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z`})});function QWe(){return ZWe}var $We=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z`})});function vX(){return $We}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z`})});var eGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z`})});function yX(){return eGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z`})});var tGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z`})});function nGe(){return tGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z`})});var rGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z`})});function iGe(){return rGe}var aGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z`})});function bX(){return aGe}var oGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z`})});function xX(){return oGe}var sGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z`})});function SX(){return sGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z`})});var cGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z`})});function lGe(){return cGe}var uGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z`})});function CX(){return uGe}var dGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z`})});function wX(){return dGe}var fGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z`})});function TX(){return fGe}var pGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z`})});function mGe(){return pGe}var hGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M8 5v14l11-7z`})});function EX(){return hGe}var gGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z`})});function DX(){return gGe}var _Ge=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 13H5v-2h14v2z`})});function OX(){return _Ge}var vGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z`})});function kX(){return vGe}var yGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,strokeWidth:`0.1px`,children:(0,I.jsx)(`path`,{d:`M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z`})});function AX(){return yGe}var bGe=(0,I.jsxs)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:[(0,I.jsx)(`circle`,{cx:`7`,cy:`14`,r:`3`}),(0,I.jsx)(`circle`,{cx:`11`,cy:`6`,r:`3`}),(0,I.jsx)(`circle`,{cx:`16.6`,cy:`17.6`,r:`3`})]});function xGe(){return bGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z`})});var SGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6 6h2v12H6zm3.5 6l8.5 6V6z`})});function CGe(){return SGe}var wGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6 6h12v12H6z`})});function jX(){return wGe}var TGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z`})});function EGe(){return TGe}var DGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z`})});function OGe(){return DGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M21 4H7V2H5v20h2v-8h14l-2-5zm-6 5c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2`})});var kGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z`})});function MX(){return kGe}var AGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z`})});(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z`})}),(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M4 4h16v12H5.17L4 17.17zm0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm2 10h8v2H6zm0-3h12v2H6zm0-3h12v2H6z`})}),(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z`})}),(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10H7v-2h10z`})});function NX(){return AGe}var jGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z`})});function PX(){return jGe}var MGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z`})});function FX(){return MGe}(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M 9.64 7.64 c 0.23 -0.5 0.36 -1.05 0.36 -1.64 c 0 -2.21 -1.79 -4 -4 -4 S 2 3.79 2 6 s 1.79 4 4 4 c 0.59 0 1.14 -0.13 1.64 -0.36 L 10 12 l -2.36 2.36 C 7.14 14.13 6.59 14 6 14 c -2.21 0 -4 1.79 -4 4 s 1.79 4 4 4 s 4 -1.79 4 -4 c 0 -0.59 -0.13 -1.14 -0.36 -1.64 L 12 14 l 7 7 h 3 v -1 L 9.64 7.64 Z M 6 8 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 0 12 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 6 -7.5 c -0.28 0 -0.5 -0.22 -0.5 -0.5 s 0.22 -0.5 0.5 -0.5 s 0.5 0.22 0.5 0.5 s -0.22 0.5 -0.5 0.5 Z M 19 3 l -6 6 l 2 2 l 7 -7 V 3 Z`})});var NGe=(0,I.jsx)(`svg`,{width:`24px`,height:`24px`,viewBox:`0 0 24 24`,children:(0,I.jsx)(`path`,{d:`M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z`})});function PGe(){return NGe}var FGe=(0,I.jsxs)(`svg`,{width:`16px`,height:`16px`,viewBox:`0 0 16 16`,children:[(0,I.jsx)(`path`,{d:`M8 1.248c1.857 0 3.526.641 4.65 1.794a5 5 0 0 1 2.518 1.09C13.907 1.482 11.295 0 8 0 4.75 0 2.12 1.48.844 4.122a5 5 0 0 1 2.289-1.047C4.236 1.872 5.974 1.248 8 1.248`}),(0,I.jsx)(`path`,{d:`M12 12a4 4 0 0 1-2.786-1.13l-.002-.002a1.6 1.6 0 0 0-.276-.167A2.2 2.2 0 0 0 8 10.5c-.414 0-.729.103-.935.201a1.6 1.6 0 0 0-.277.167l-.002.002A4 4 0 1 1 4 4h8a4 4 0 0 1 0 8`})]});function IGe(){return FGe}const LGe=oWe,RGe=xGe,IX=lGe,zGe=nGe;var LX=class extends y.Component{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initialExpanded},this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let e=this.props.hideOffset?`msp-control-group-children`:`msp-control-group-children msp-control-offset`;return this.props.childrenClassName&&(e+=` `+this.props.childrenClassName),(0,I.jsxs)(`div`,{className:`msp-control-group-wrapper`,style:{position:`relative`,marginTop:this.props.noTopMargin?0:void 0},children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,I.jsxs)(VX,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,I.jsx)(XY,{svg:this.state.isExpanded?cX:sX}),this.props.topRightIcon&&(0,I.jsx)(XY,{svg:this.props.topRightIcon,style:{position:`absolute`,right:`2px`,top:0}}),(0,I.jsx)(`b`,{children:this.props.header})]})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:e,style:{display:this.state.isExpanded?`block`:`none`,maxHeight:this.props.maxHeight,overflow:`hidden`,overflowY:`auto`},children:this.props.children})]})}};function RX(e){return e}var zX=class extends y.PureComponent{constructor(){super(...arguments),this.input=y.createRef(),this.delayHandle=void 0,this.pendingValue=void 0,this.state={originalValue:``,value:``},this.onBlur=()=>{this.setState({value:``+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()},this.raiseOnChange=()=>{this.pendingValue!==void 0&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)},this.onChange=e=>{let t=e.target.value;if(this.props.isValid&&!this.props.isValid(t)||this.props.numeric&&Number.isNaN(+t)){this.clearTimeout(),this.setState({value:t});return}if(this.props.numeric)this.setState({value:t},()=>this.triggerChanged(t,+t));else{let e=(this.props.toValue||RX)(t),n=(this.props.fromValue||RX)(e);this.setState({value:n},()=>this.triggerChanged(n,e))}},this.onKeyUp=e=>{(e.charCode===27||e.keyCode===27||e.key===`Escape`)&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()},this.onKeyPress=e=>{(e.keyCode===13||e.charCode===13||e.key===`Enter`)&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),e.stopPropagation()}}get isPending(){return this.delayHandle!==void 0}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(e,t){this.clearTimeout(),e!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=t,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(t))}static getDerivedStateFromProps(e,t){let n=e.fromValue?e.fromValue(e.value):e.value;return n===t.originalValue?null:{originalValue:n,value:n}}render(){return(0,I.jsx)(`input`,{type:`text`,className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}},BGe=class extends y.Component{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){let{label:e,pivot:t,controls:n}=this.props;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:(0,I.jsxs)(I.Fragment,{children:[e,(0,I.jsx)(`button`,{className:`msp-btn-link msp-btn-icon msp-control-group-expander`,onClick:this.toggleExpanded,title:`${this.state.isExpanded?`Less`:`More`} options`,style:{background:`transparent`,textAlign:`left`,padding:`0`},children:(0,I.jsx)(XY,{svg:this.state.isExpanded?OX:aX,style:{display:`inline-block`}})})]}),control:t,children:this.props.colorStripe&&(0,I.jsx)(`div`,{className:`msp-expandable-group-color-stripe`,style:{backgroundColor:tE.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:n})]})}};function BX(e){return(0,I.jsxs)(`div`,{className:`msp-section-header${e.accent?` msp-transform-header-brand-`+e.accent:``}`,children:[e.icon&&(0,I.jsx)(XY,{svg:e.icon}),e.title,` `,(0,I.jsx)(`small`,{children:e.desc})]})}function VX(e){let t=`msp-btn`;e.inline||(t+=` msp-btn-block`),e.noOverflow&&(t+=` msp-no-overflow`),e.flex&&(t+=` msp-flex-item`),(e.commit===`on`||e.commit)&&(t+=` msp-btn-commit msp-btn-commit-on`),e.commit===`off`&&(t+=` msp-btn-commit msp-btn-commit-off`),e.children||(t+=` msp-btn-childless`),e.className&&(t+=` `+e.className);let n;return e.flex&&(typeof e.flex==`number`?n={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:typeof e.flex==`string`&&(n={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(n?Object.assign(n,e.style):n=e.style),(0,I.jsxs)(`button`,{onClick:e.onClick,title:e.title,disabled:e.disabled,style:n,className:t,"data-id":e[`data-id`],"data-color":e[`data-color`],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,I.jsx)(XY,{svg:e.icon}),e.children]})}function HX(e){let t=`msp-btn msp-btn-icon${e.small?`-small`:``}${e.className?` `+e.className:``}`;e.toggleState!==void 0&&(t+=` msp-btn-link-toggle-${e.toggleState?`on`:`off`}`),e.transparent&&(t+=` msp-transparent-bg`);let n;return e.flex&&(n=typeof e.flex==`boolean`?{flex:`0 0 32px`,padding:0}:typeof e.flex==`number`?{flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:{flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(n?Object.assign(n,e.style):n=e.style),(0,I.jsxs)(`button`,{className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e[`data-id`],style:n,children:[e.svg&&(0,I.jsx)(XY,{svg:e.svg}),e.extraContent]})}var UX=class extends y.PureComponent{constructor(){super(...arguments),this.onClick=e=>{e.currentTarget.blur(),this.props.toggle()}}render(){let e=this.props,t=e.label,n=e.isSelected?`${e.className||``} msp-control-current`:e.className;return(0,I.jsx)(VX,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:e.disabled,style:e.style,className:n,children:t&&this.props.isSelected?(0,I.jsx)(`b`,{children:t}):t})}},WX=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,style:{marginTop:this.props.marginTop===void 0?`1px`:this.props.marginTop,marginLeft:this.props.headerLeftMargin},children:(0,I.jsxs)(`button`,{className:`msp-btn msp-form-control msp-btn-block`,onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,I.jsx)(XY,{svg:this.state.isExpanded?sX:cX}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,I.jsx)(`div`,{className:this.props.accent?`msp-accent-offset`:`msp-control-offset`,children:this.props.children}))]})}};function GX(e){let t=`msp-control-row`;return e.className&&(t+=` `+e.className),(0,I.jsxs)(`div`,{className:t,children:[(0,I.jsx)(`span`,{className:`msp-control-row-label`,title:e.title,children:e.label}),(0,I.jsx)(`div`,{className:`msp-control-row-ctrl`,children:e.control}),e.children]})}const KX=y.createContext(void 0);var qX=class extends y.Component{subscribe(e,t){this.subs===void 0&&(this.subs=[]),this.subs.push(e.subscribe(t))}componentWillUnmount(){if(this.subs){for(let e of this.subs)e.unsubscribe();this.subs=void 0}}constructor(e,t){super(e),this.subs=void 0,this.plugin=t,this.init&&this.init()}};qX.contextType=KX;var JX=class extends y.PureComponent{subscribe(e,t){this.subs===void 0&&(this.subs=[]),this.subs.push(e.subscribe(t))}componentWillUnmount(){if(this.subs){for(let e of this.subs)e.unsubscribe();this.subs=void 0}}constructor(e,t){super(e,t),this.subs=void 0,this.plugin=t,this.init&&this.init()}};JX.contextType=KX;var YX=class extends qX{toggleCollapsed(){this.setState({isCollapsed:!this.state.isCollapsed})}componentDidUpdate(e){this.props.initiallyCollapsed!==void 0&&e.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){if(this.state.isHidden)return null;let e=this.state.header.toLowerCase().replace(/\s/g,``);return(0,I.jsxs)(`div`,{className:this.state.isCollapsed?`msp-transform-wrapper msp-transform-wrapper-collapsed`:`msp-transform-wrapper`,children:[(0,I.jsx)(`div`,{id:e,className:`msp-transform-header`,children:(0,I.jsxs)(VX,{icon:this.state.brand?void 0:this.state.isCollapsed?cX:sX,noOverflow:!0,onClick:()=>this.toggleCollapsed(),className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:`Click to ${this.state.isCollapsed?`expand`:`collapse`}`,children:[(0,I.jsx)(XY,{svg:this.state.brand?.svg,inline:!0}),this.state.header,(0,I.jsx)(`small`,{style:{margin:`0 6px`},children:this.state.isCollapsed?``:this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(e,t){super(e,t);let n=this.defaultState();e.initiallyCollapsed!==void 0&&(n.isCollapsed=e.initiallyCollapsed),e.header!==void 0&&(n.header=e.header),this.state=n}};function VGe(e,t){let n=t||{};return(e[e.length-1]===``?[...e,``]:e).join((n.padRight?` `:``)+`,`+(n.padLeft===!1?``:` `)).trim()}var HGe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,UGe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,WGe={};function XX(e,t){return((t||WGe).jsx?UGe:HGe).test(e)}var GGe=/[ \t\n\f\r]/g;function KGe(e){return typeof e==`object`?e.type===`text`?ZX(e.value):!1:ZX(e)}function ZX(e){return e.replace(GGe,``)===``}var QX=class{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}};QX.prototype.normal={},QX.prototype.property={},QX.prototype.space=void 0;function $X(e,t){let n={},r={};for(let t of e)Object.assign(n,t.property),Object.assign(r,t.normal);return new QX(n,r,t)}function eZ(e){return e.toLowerCase()}var tZ=class{constructor(e,t){this.attribute=t,this.property=e}};tZ.prototype.attribute=``,tZ.prototype.booleanish=!1,tZ.prototype.boolean=!1,tZ.prototype.commaOrSpaceSeparated=!1,tZ.prototype.commaSeparated=!1,tZ.prototype.defined=!1,tZ.prototype.mustUseProperty=!1,tZ.prototype.number=!1,tZ.prototype.overloadedBoolean=!1,tZ.prototype.property=``,tZ.prototype.spaceSeparated=!1,tZ.prototype.space=void 0;var nZ=s({boolean:()=>rZ,booleanish:()=>iZ,commaOrSpaceSeparated:()=>lZ,commaSeparated:()=>cZ,number:()=>oZ,overloadedBoolean:()=>aZ,spaceSeparated:()=>sZ}),qGe=0;const rZ=uZ(),iZ=uZ(),aZ=uZ(),oZ=uZ(),sZ=uZ(),cZ=uZ(),lZ=uZ();function uZ(){return 2**++qGe}var dZ=Object.keys(nZ),fZ=class extends tZ{constructor(e,t,n,r){let i=-1;if(super(e,t),pZ(this,`space`,r),typeof n==`number`)for(;++i<dZ.length;){let e=dZ[i];pZ(this,dZ[i],(n&nZ[e])===nZ[e])}}};fZ.prototype.defined=!0;function pZ(e,t,n){n&&(e[t]=n)}function mZ(e){let t={},n={};for(let[r,i]of Object.entries(e.properties)){let a=new fZ(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),t[r]=a,n[eZ(r)]=r,n[eZ(a.attribute)]=r}return new QX(t,n,e.space)}const hZ=mZ({properties:{ariaActiveDescendant:null,ariaAtomic:iZ,ariaAutoComplete:null,ariaBusy:iZ,ariaChecked:iZ,ariaColCount:oZ,ariaColIndex:oZ,ariaColSpan:oZ,ariaControls:sZ,ariaCurrent:null,ariaDescribedBy:sZ,ariaDetails:null,ariaDisabled:iZ,ariaDropEffect:sZ,ariaErrorMessage:null,ariaExpanded:iZ,ariaFlowTo:sZ,ariaGrabbed:iZ,ariaHasPopup:null,ariaHidden:iZ,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:sZ,ariaLevel:oZ,ariaLive:null,ariaModal:iZ,ariaMultiLine:iZ,ariaMultiSelectable:iZ,ariaOrientation:null,ariaOwns:sZ,ariaPlaceholder:null,ariaPosInSet:oZ,ariaPressed:iZ,ariaReadOnly:iZ,ariaRelevant:null,ariaRequired:iZ,ariaRoleDescription:sZ,ariaRowCount:oZ,ariaRowIndex:oZ,ariaRowSpan:oZ,ariaSelected:iZ,ariaSetSize:oZ,ariaSort:null,ariaValueMax:oZ,ariaValueMin:oZ,ariaValueNow:oZ,ariaValueText:null,role:null},transform(e,t){return t===`role`?t:`aria-`+t.slice(4).toLowerCase()}});function gZ(e,t){return t in e?e[t]:t}function _Z(e,t){return gZ(e,t.toLowerCase())}const JGe=mZ({attributes:{acceptcharset:`accept-charset`,classname:`class`,htmlfor:`for`,httpequiv:`http-equiv`},mustUseProperty:[`checked`,`multiple`,`muted`,`selected`],properties:{abbr:null,accept:cZ,acceptCharset:sZ,accessKey:sZ,action:null,allow:null,allowFullScreen:rZ,allowPaymentRequest:rZ,allowUserMedia:rZ,alt:null,as:null,async:rZ,autoCapitalize:null,autoComplete:sZ,autoFocus:rZ,autoPlay:rZ,blocking:sZ,capture:null,charSet:null,checked:rZ,cite:null,className:sZ,cols:oZ,colSpan:null,content:null,contentEditable:iZ,controls:rZ,controlsList:sZ,coords:oZ|cZ,crossOrigin:null,data:null,dateTime:null,decoding:null,default:rZ,defer:rZ,dir:null,dirName:null,disabled:rZ,download:aZ,draggable:iZ,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:rZ,formTarget:null,headers:sZ,height:oZ,hidden:aZ,high:oZ,href:null,hrefLang:null,htmlFor:sZ,httpEquiv:sZ,id:null,imageSizes:null,imageSrcSet:null,inert:rZ,inputMode:null,integrity:null,is:null,isMap:rZ,itemId:null,itemProp:sZ,itemRef:sZ,itemScope:rZ,itemType:sZ,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:rZ,low:oZ,manifest:null,max:null,maxLength:oZ,media:null,method:null,min:null,minLength:oZ,multiple:rZ,muted:rZ,name:null,nonce:null,noModule:rZ,noValidate:rZ,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:rZ,optimum:oZ,pattern:null,ping:sZ,placeholder:null,playsInline:rZ,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:rZ,referrerPolicy:null,rel:sZ,required:rZ,reversed:rZ,rows:oZ,rowSpan:oZ,sandbox:sZ,scope:null,scoped:rZ,seamless:rZ,selected:rZ,shadowRootClonable:rZ,shadowRootDelegatesFocus:rZ,shadowRootMode:null,shape:null,size:oZ,sizes:null,slot:null,span:oZ,spellCheck:iZ,src:null,srcDoc:null,srcLang:null,srcSet:null,start:oZ,step:null,style:null,tabIndex:oZ,target:null,title:null,translate:null,type:null,typeMustMatch:rZ,useMap:null,value:iZ,width:oZ,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:sZ,axis:null,background:null,bgColor:null,border:oZ,borderColor:null,bottomMargin:oZ,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:rZ,declare:rZ,event:null,face:null,frame:null,frameBorder:null,hSpace:oZ,leftMargin:oZ,link:null,longDesc:null,lowSrc:null,marginHeight:oZ,marginWidth:oZ,noResize:rZ,noHref:rZ,noShade:rZ,noWrap:rZ,object:null,profile:null,prompt:null,rev:null,rightMargin:oZ,rules:null,scheme:null,scrolling:iZ,standby:null,summary:null,text:null,topMargin:oZ,valueType:null,version:null,vAlign:null,vLink:null,vSpace:oZ,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:rZ,disableRemotePlayback:rZ,prefix:null,property:null,results:oZ,security:null,unselectable:null},space:`html`,transform:_Z}),YGe=mZ({attributes:{accentHeight:`accent-height`,alignmentBaseline:`alignment-baseline`,arabicForm:`arabic-form`,baselineShift:`baseline-shift`,capHeight:`cap-height`,className:`class`,clipPath:`clip-path`,clipRule:`clip-rule`,colorInterpolation:`color-interpolation`,colorInterpolationFilters:`color-interpolation-filters`,colorProfile:`color-profile`,colorRendering:`color-rendering`,crossOrigin:`crossorigin`,dataType:`datatype`,dominantBaseline:`dominant-baseline`,enableBackground:`enable-background`,fillOpacity:`fill-opacity`,fillRule:`fill-rule`,floodColor:`flood-color`,floodOpacity:`flood-opacity`,fontFamily:`font-family`,fontSize:`font-size`,fontSizeAdjust:`font-size-adjust`,fontStretch:`font-stretch`,fontStyle:`font-style`,fontVariant:`font-variant`,fontWeight:`font-weight`,glyphName:`glyph-name`,glyphOrientationHorizontal:`glyph-orientation-horizontal`,glyphOrientationVertical:`glyph-orientation-vertical`,hrefLang:`hreflang`,horizAdvX:`horiz-adv-x`,horizOriginX:`horiz-origin-x`,horizOriginY:`horiz-origin-y`,imageRendering:`image-rendering`,letterSpacing:`letter-spacing`,lightingColor:`lighting-color`,markerEnd:`marker-end`,markerMid:`marker-mid`,markerStart:`marker-start`,navDown:`nav-down`,navDownLeft:`nav-down-left`,navDownRight:`nav-down-right`,navLeft:`nav-left`,navNext:`nav-next`,navPrev:`nav-prev`,navRight:`nav-right`,navUp:`nav-up`,navUpLeft:`nav-up-left`,navUpRight:`nav-up-right`,onAbort:`onabort`,onActivate:`onactivate`,onAfterPrint:`onafterprint`,onBeforePrint:`onbeforeprint`,onBegin:`onbegin`,onCancel:`oncancel`,onCanPlay:`oncanplay`,onCanPlayThrough:`oncanplaythrough`,onChange:`onchange`,onClick:`onclick`,onClose:`onclose`,onCopy:`oncopy`,onCueChange:`oncuechange`,onCut:`oncut`,onDblClick:`ondblclick`,onDrag:`ondrag`,onDragEnd:`ondragend`,onDragEnter:`ondragenter`,onDragExit:`ondragexit`,onDragLeave:`ondragleave`,onDragOver:`ondragover`,onDragStart:`ondragstart`,onDrop:`ondrop`,onDurationChange:`ondurationchange`,onEmptied:`onemptied`,onEnd:`onend`,onEnded:`onended`,onError:`onerror`,onFocus:`onfocus`,onFocusIn:`onfocusin`,onFocusOut:`onfocusout`,onHashChange:`onhashchange`,onInput:`oninput`,onInvalid:`oninvalid`,onKeyDown:`onkeydown`,onKeyPress:`onkeypress`,onKeyUp:`onkeyup`,onLoad:`onload`,onLoadedData:`onloadeddata`,onLoadedMetadata:`onloadedmetadata`,onLoadStart:`onloadstart`,onMessage:`onmessage`,onMouseDown:`onmousedown`,onMouseEnter:`onmouseenter`,onMouseLeave:`onmouseleave`,onMouseMove:`onmousemove`,onMouseOut:`onmouseout`,onMouseOver:`onmouseover`,onMouseUp:`onmouseup`,onMouseWheel:`onmousewheel`,onOffline:`onoffline`,onOnline:`ononline`,onPageHide:`onpagehide`,onPageShow:`onpageshow`,onPaste:`onpaste`,onPause:`onpause`,onPlay:`onplay`,onPlaying:`onplaying`,onPopState:`onpopstate`,onProgress:`onprogress`,onRateChange:`onratechange`,onRepeat:`onrepeat`,onReset:`onreset`,onResize:`onresize`,onScroll:`onscroll`,onSeeked:`onseeked`,onSeeking:`onseeking`,onSelect:`onselect`,onShow:`onshow`,onStalled:`onstalled`,onStorage:`onstorage`,onSubmit:`onsubmit`,onSuspend:`onsuspend`,onTimeUpdate:`ontimeupdate`,onToggle:`ontoggle`,onUnload:`onunload`,onVolumeChange:`onvolumechange`,onWaiting:`onwaiting`,onZoom:`onzoom`,overlinePosition:`overline-position`,overlineThickness:`overline-thickness`,paintOrder:`paint-order`,panose1:`panose-1`,pointerEvents:`pointer-events`,referrerPolicy:`referrerpolicy`,renderingIntent:`rendering-intent`,shapeRendering:`shape-rendering`,stopColor:`stop-color`,stopOpacity:`stop-opacity`,strikethroughPosition:`strikethrough-position`,strikethroughThickness:`strikethrough-thickness`,strokeDashArray:`stroke-dasharray`,strokeDashOffset:`stroke-dashoffset`,strokeLineCap:`stroke-linecap`,strokeLineJoin:`stroke-linejoin`,strokeMiterLimit:`stroke-miterlimit`,strokeOpacity:`stroke-opacity`,strokeWidth:`stroke-width`,tabIndex:`tabindex`,textAnchor:`text-anchor`,textDecoration:`text-decoration`,textRendering:`text-rendering`,transformOrigin:`transform-origin`,typeOf:`typeof`,underlinePosition:`underline-position`,underlineThickness:`underline-thickness`,unicodeBidi:`unicode-bidi`,unicodeRange:`unicode-range`,unitsPerEm:`units-per-em`,vAlphabetic:`v-alphabetic`,vHanging:`v-hanging`,vIdeographic:`v-ideographic`,vMathematical:`v-mathematical`,vectorEffect:`vector-effect`,vertAdvY:`vert-adv-y`,vertOriginX:`vert-origin-x`,vertOriginY:`vert-origin-y`,wordSpacing:`word-spacing`,writingMode:`writing-mode`,xHeight:`x-height`,playbackOrder:`playbackorder`,timelineBegin:`timelinebegin`},properties:{about:lZ,accentHeight:oZ,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:oZ,amplitude:oZ,arabicForm:null,ascent:oZ,attributeName:null,attributeType:null,azimuth:oZ,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:oZ,by:null,calcMode:null,capHeight:oZ,className:sZ,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:oZ,diffuseConstant:oZ,direction:null,display:null,dur:null,divisor:oZ,dominantBaseline:null,download:rZ,dx:null,dy:null,edgeMode:null,editable:null,elevation:oZ,enableBackground:null,end:null,event:null,exponent:oZ,externalResourcesRequired:null,fill:null,fillOpacity:oZ,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:cZ,g2:cZ,glyphName:cZ,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:oZ,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:oZ,horizOriginX:oZ,horizOriginY:oZ,id:null,ideographic:oZ,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:oZ,k:oZ,k1:oZ,k2:oZ,k3:oZ,k4:oZ,kernelMatrix:lZ,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:oZ,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:oZ,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:oZ,overlineThickness:oZ,paintOrder:null,panose1:null,path:null,pathLength:oZ,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:sZ,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:oZ,pointsAtY:oZ,pointsAtZ:oZ,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:lZ,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:lZ,rev:lZ,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:lZ,requiredFeatures:lZ,requiredFonts:lZ,requiredFormats:lZ,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:oZ,specularExponent:oZ,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:oZ,strikethroughThickness:oZ,string:null,stroke:null,strokeDashArray:lZ,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:oZ,strokeOpacity:oZ,strokeWidth:null,style:null,surfaceScale:oZ,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:lZ,tabIndex:oZ,tableValues:null,target:null,targetX:oZ,targetY:oZ,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:lZ,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:oZ,underlineThickness:oZ,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:oZ,values:null,vAlphabetic:oZ,vMathematical:oZ,vectorEffect:null,vHanging:oZ,vIdeographic:oZ,version:null,vertAdvY:oZ,vertOriginX:oZ,vertOriginY:oZ,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:oZ,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:`svg`,transform:gZ}),vZ=mZ({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:`xlink`,transform(e,t){return`xlink:`+t.slice(5).toLowerCase()}}),yZ=mZ({attributes:{xmlnsxlink:`xmlns:xlink`},properties:{xmlnsXLink:null,xmlns:null},space:`xmlns`,transform:_Z}),bZ=mZ({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:`xml`,transform(e,t){return`xml:`+t.slice(3).toLowerCase()}}),XGe={classId:`classID`,dataType:`datatype`,itemId:`itemID`,strokeDashArray:`strokeDasharray`,strokeDashOffset:`strokeDashoffset`,strokeLineCap:`strokeLinecap`,strokeLineJoin:`strokeLinejoin`,strokeMiterLimit:`strokeMiterlimit`,typeOf:`typeof`,xLinkActuate:`xlinkActuate`,xLinkArcRole:`xlinkArcrole`,xLinkHref:`xlinkHref`,xLinkRole:`xlinkRole`,xLinkShow:`xlinkShow`,xLinkTitle:`xlinkTitle`,xLinkType:`xlinkType`,xmlnsXLink:`xmlnsXlink`};var ZGe=/[A-Z]/g,xZ=/-[a-z]/g,QGe=/^data[-\w.:]+$/i;function $Ge(e,t){let n=eZ(t),r=t,i=tZ;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)===`data`&&QGe.test(t)){if(t.charAt(4)===`-`){let e=t.slice(5).replace(xZ,tKe);r=`data`+e.charAt(0).toUpperCase()+e.slice(1)}else{let e=t.slice(4);if(!xZ.test(e)){let n=e.replace(ZGe,eKe);n.charAt(0)!==`-`&&(n=`-`+n),t=`data`+n}}i=fZ}return new i(r,t)}function eKe(e){return`-`+e.toLowerCase()}function tKe(e){return e.charAt(1).toUpperCase()}const nKe=$X([hZ,JGe,vZ,yZ,bZ],`html`),SZ=$X([hZ,YGe,vZ,yZ,bZ],`svg`);function rKe(e){return e.join(` `).trim()}var iKe=o(((e,t)=>{var n=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,r=/\n/g,i=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,o=/^:\s*/,s=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,c=/^[;\s]*/,l=/^\s+|\s+$/g,u=`
`,d=`/`,f=`*`,p=``,m=`comment`,h=`declaration`;function g(e,t){if(typeof e!=`string`)throw TypeError(`First argument must be a string`);if(!e)return[];t||={};var l=1,g=1;function v(e){var t=e.match(r);t&&(l+=t.length);var n=e.lastIndexOf(u);g=~n?e.length-n:g+e.length}function y(){var e={line:l,column:g};return function(t){return t.position=new b(e),C(),t}}function b(e){this.start=e,this.end={line:l,column:g},this.source=t.source}b.prototype.content=e;function x(n){var r=Error(t.source+`:`+l+`:`+g+`: `+n);if(r.reason=n,r.filename=t.source,r.line=l,r.column=g,r.source=e,!t.silent)throw r}function S(t){var n=t.exec(e);if(n){var r=n[0];return v(r),e=e.slice(r.length),n}}function C(){S(i)}function w(e){var t;for(e||=[];t=T();)t!==!1&&e.push(t);return e}function T(){var t=y();if(!(d!=e.charAt(0)||f!=e.charAt(1))){for(var n=2;p!=e.charAt(n)&&(f!=e.charAt(n)||d!=e.charAt(n+1));)++n;if(n+=2,p===e.charAt(n-1))return x(`End of comment missing`);var r=e.slice(2,n-2);return g+=2,v(r),e=e.slice(n),g+=2,t({type:m,comment:r})}}function E(){var e=y(),t=S(a);if(t){if(T(),!S(o))return x(`property missing ':'`);var r=S(s),i=e({type:h,property:_(t[0].replace(n,p)),value:r?_(r[0].replace(n,p)):p});return S(c),i}}function D(){var e=[];w(e);for(var t;t=E();)t!==!1&&(e.push(t),w(e));return e}return C(),D()}function _(e){return e?e.replace(l,p):p}t.exports=g})),aKe=o((e=>{var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,`__esModule`,{value:!0}),e.default=r;var n=t(iKe());function r(e,t){let r=null;if(!e||typeof e!=`string`)return r;let i=(0,n.default)(e),a=typeof t==`function`;return i.forEach(e=>{if(e.type!==`declaration`)return;let{property:n,value:i}=e;a?t(n,i,e):i&&(r||={},r[n]=i)}),r}})),oKe=o((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,n=/-([a-z])/g,r=/^[^-]+$/,i=/^-(webkit|moz|ms|o|khtml)-/,a=/^-(ms)-/,o=function(e){return!e||r.test(e)||t.test(e)},s=function(e,t){return t.toUpperCase()},c=function(e,t){return`${t}-`};e.camelCase=function(e,t){return t===void 0&&(t={}),o(e)?e:(e=e.toLowerCase(),e=t.reactCompat?e.replace(a,c):e.replace(i,c),e.replace(n,s))}})),sKe=o(((e,t)=>{var n=(e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(aKe()),r=oKe();function i(e,t){var i={};return!e||typeof e!=`string`||(0,n.default)(e,function(e,n){e&&n&&(i[(0,r.camelCase)(e,t)]=n)}),i}i.default=i,t.exports=i}));const CZ=TZ(`end`),wZ=TZ(`start`);function TZ(e){return t;function t(t){let n=t&&t.position&&t.position[e]||{};if(typeof n.line==`number`&&n.line>0&&typeof n.column==`number`&&n.column>0)return{line:n.line,column:n.column,offset:typeof n.offset==`number`&&n.offset>-1?n.offset:void 0}}}function cKe(e){let t=wZ(e),n=CZ(e);if(t&&n)return{start:t,end:n}}function EZ(e){return!e||typeof e!=`object`?``:`position`in e||`type`in e?OZ(e.position):`start`in e||`end`in e?OZ(e):`line`in e||`column`in e?DZ(e):``}function DZ(e){return kZ(e&&e.line)+`:`+kZ(e&&e.column)}function OZ(e){return DZ(e&&e.start)+`-`+DZ(e&&e.end)}function kZ(e){return e&&typeof e==`number`?e:1}var AZ=class extends Error{constructor(e,t,n){super(),typeof t==`string`&&(n=t,t=void 0);let r=``,i={},a=!1;if(t&&(i=`line`in t&&`column`in t||`start`in t&&`end`in t?{place:t}:`type`in t?{ancestors:[t],place:t.position}:{...t}),typeof e==`string`?r=e:!i.cause&&e&&(a=!0,r=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof n==`string`){let e=n.indexOf(`:`);e===-1?i.ruleId=n:(i.source=n.slice(0,e),i.ruleId=n.slice(e+1))}if(!i.place&&i.ancestors&&i.ancestors){let e=i.ancestors[i.ancestors.length-1];e&&(i.place=e.position)}let o=i.place&&`start`in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file=``,this.message=r,this.line=o?o.line:void 0,this.name=EZ(i.place)||`1:1`,this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=a&&i.cause&&typeof i.cause.stack==`string`?i.cause.stack:``,this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}};AZ.prototype.file=``,AZ.prototype.name=``,AZ.prototype.reason=``,AZ.prototype.message=``,AZ.prototype.stack=``,AZ.prototype.column=void 0,AZ.prototype.line=void 0,AZ.prototype.ancestors=void 0,AZ.prototype.cause=void 0,AZ.prototype.fatal=void 0,AZ.prototype.place=void 0,AZ.prototype.ruleId=void 0,AZ.prototype.source=void 0;var lKe=l(sKe(),1),jZ={}.hasOwnProperty,uKe=new Map,dKe=/[A-Z]/g,fKe=new Set([`table`,`tbody`,`thead`,`tfoot`,`tr`]),pKe=new Set([`td`,`th`]),MZ=`https://github.com/syntax-tree/hast-util-to-jsx-runtime`;function mKe(e,t){if(!t||t.Fragment===void 0)throw TypeError("Expected `Fragment` in options");let n=t.filePath||void 0,r;if(t.development){if(typeof t.jsxDEV!=`function`)throw TypeError("Expected `jsxDEV` in options when `development: true`");r=SKe(n,t.jsxDEV)}else{if(typeof t.jsx!=`function`)throw TypeError("Expected `jsx` in production options");if(typeof t.jsxs!=`function`)throw TypeError("Expected `jsxs` in production options");r=xKe(n,t.jsx,t.jsxs)}let i={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||`react`,evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space===`svg`?SZ:nKe,stylePropertyNameCase:t.stylePropertyNameCase||`dom`,tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},a=NZ(i,e,void 0);return a&&typeof a!=`string`?a:i.create(e,i.Fragment,{children:a||void 0},void 0)}function NZ(e,t,n){if(t.type===`element`)return hKe(e,t,n);if(t.type===`mdxFlowExpression`||t.type===`mdxTextExpression`)return gKe(e,t);if(t.type===`mdxJsxFlowElement`||t.type===`mdxJsxTextElement`)return vKe(e,t,n);if(t.type===`mdxjsEsm`)return _Ke(e,t);if(t.type===`root`)return yKe(e,t,n);if(t.type===`text`)return bKe(e,t)}function hKe(e,t,n){let r=e.schema,i=r;t.tagName.toLowerCase()===`svg`&&r.space===`html`&&(i=SZ,e.schema=i),e.ancestors.push(t);let a=LZ(e,t.tagName,!1),o=CKe(e,t),s=IZ(e,t);return fKe.has(t.tagName)&&(s=s.filter(function(e){return typeof e==`string`?!KGe(e):!0})),PZ(e,o,a,t),FZ(o,s),e.ancestors.pop(),e.schema=r,e.create(t,a,o,n)}function gKe(e,t){if(t.data&&t.data.estree&&e.evaluater){let n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}RZ(e,t.position)}function _Ke(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);RZ(e,t.position)}function vKe(e,t,n){let r=e.schema,i=r;t.name===`svg`&&r.space===`html`&&(i=SZ,e.schema=i),e.ancestors.push(t);let a=t.name===null?e.Fragment:LZ(e,t.name,!0),o=wKe(e,t),s=IZ(e,t);return PZ(e,o,a,t),FZ(o,s),e.ancestors.pop(),e.schema=r,e.create(t,a,o,n)}function yKe(e,t,n){let r={};return FZ(r,IZ(e,t)),e.create(t,e.Fragment,r,n)}function bKe(e,t){return t.value}function PZ(e,t,n,r){typeof n!=`string`&&n!==e.Fragment&&e.passNode&&(t.node=r)}function FZ(e,t){if(t.length>0){let n=t.length>1?t:t[0];n&&(e.children=n)}}function xKe(e,t,n){return r;function r(e,r,i,a){let o=Array.isArray(i.children)?n:t;return a?o(r,i,a):o(r,i)}}function SKe(e,t){return n;function n(n,r,i,a){let o=Array.isArray(i.children),s=wZ(n);return t(r,i,a,o,{columnNumber:s?s.column-1:void 0,fileName:e,lineNumber:s?s.line:void 0},void 0)}}function CKe(e,t){let n={},r,i;for(i in t.properties)if(i!==`children`&&jZ.call(t.properties,i)){let a=TKe(e,i,t.properties[i]);if(a){let[i,o]=a;e.tableCellAlignToStyle&&i===`align`&&typeof o==`string`&&pKe.has(t.tagName)?r=o:n[i]=o}}if(r){let t=n.style||={};t[e.stylePropertyNameCase===`css`?`text-align`:`textAlign`]=r}return n}function wKe(e,t){let n={};for(let r of t.attributes)if(r.type===`mdxJsxExpressionAttribute`)if(r.data&&r.data.estree&&e.evaluater){let t=r.data.estree.body[0];t.type;let i=t.expression;i.type;let a=i.properties[0];a.type,Object.assign(n,e.evaluater.evaluateExpression(a.argument))}else RZ(e,t.position);else{let i=r.name,a;if(r.value&&typeof r.value==`object`)if(r.value.data&&r.value.data.estree&&e.evaluater){let t=r.value.data.estree.body[0];t.type,a=e.evaluater.evaluateExpression(t.expression)}else RZ(e,t.position);else a=r.value===null?!0:r.value;n[i]=a}return n}function IZ(e,t){let n=[],r=-1,i=e.passKeys?new Map:uKe;for(;++r<t.children.length;){let a=t.children[r],o;if(e.passKeys){let e=a.type===`element`?a.tagName:a.type===`mdxJsxFlowElement`||a.type===`mdxJsxTextElement`?a.name:void 0;if(e){let t=i.get(e)||0;o=e+`-`+t,i.set(e,t+1)}}let s=NZ(e,a,o);s!==void 0&&n.push(s)}return n}function TKe(e,t,n){let r=$Ge(e.schema,t);if(!(n==null||typeof n==`number`&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?VGe(n):rKe(n)),r.property===`style`){let t=typeof n==`object`?n:EKe(e,String(n));return e.stylePropertyNameCase===`css`&&(t=DKe(t)),[`style`,t]}return[e.elementAttributeNameCase===`react`&&r.space?XGe[r.property]||r.property:r.attribute,n]}}function EKe(e,t){try{return(0,lKe.default)(t,{reactCompat:!0})}catch(t){if(e.ignoreInvalidStyle)return{};let n=t,r=new AZ("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:n,ruleId:`style`,source:`hast-util-to-jsx-runtime`});throw r.file=e.filePath||void 0,r.url=MZ+`#cannot-parse-style-attribute`,r}}function LZ(e,t,n){let r;if(!n)r={type:`Literal`,value:t};else if(t.includes(`.`)){let e=t.split(`.`),n=-1,i;for(;++n<e.length;){let t=XX(e[n])?{type:`Identifier`,name:e[n]}:{type:`Literal`,value:e[n]};i=i?{type:`MemberExpression`,object:i,property:t,computed:!!(n&&t.type===`Literal`),optional:!1}:t}r=i}else r=XX(t)&&!/^[a-z]/.test(t)?{type:`Identifier`,name:t}:{type:`Literal`,value:t};if(r.type===`Literal`){let t=r.value;return jZ.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(r);RZ(e)}function RZ(e,t){let n=new AZ("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:`mdx-estree`,source:`hast-util-to-jsx-runtime`});throw n.file=e.filePath||void 0,n.url=MZ+`#cannot-handle-mdx-estrees-without-createevaluater`,n}function DKe(e){let t={},n;for(n in e)jZ.call(e,n)&&(t[OKe(n)]=e[n]);return t}function OKe(e){let t=e.replace(dKe,kKe);return t.slice(0,3)===`ms-`&&(t=`-`+t),t}function kKe(e){return`-`+e.toLowerCase()}const zZ={action:[`form`],cite:[`blockquote`,`del`,`ins`,`q`],data:[`object`],formAction:[`button`,`input`],href:[`a`,`area`,`base`,`link`],icon:[`menuitem`],itemId:null,manifest:[`html`],ping:[`a`,`area`],poster:[`video`],src:[`audio`,`embed`,`iframe`,`img`,`input`,`script`,`source`,`track`,`video`]};var AKe={};function BZ(e,t){let n=t||AKe;return VZ(e,typeof n.includeImageAlt==`boolean`?n.includeImageAlt:!0,typeof n.includeHtml==`boolean`?n.includeHtml:!0)}function VZ(e,t,n){if(jKe(e)){if(`value`in e)return e.type===`html`&&!n?``:e.value;if(t&&`alt`in e&&e.alt)return e.alt;if(`children`in e)return HZ(e.children,t,n)}return Array.isArray(e)?HZ(e,t,n):``}function HZ(e,t,n){let r=[],i=-1;for(;++i<e.length;)r[i]=VZ(e[i],t,n);return r.join(``)}function jKe(e){return!!(e&&typeof e==`object`)}var UZ=document.createElement(`i`);function WZ(e){let t=`&`+e+`;`;UZ.innerHTML=t;let n=UZ.textContent;return n.charCodeAt(n.length-1)===59&&e!==`semi`||n===t?!1:n}function GZ(e,t,n,r){let i=e.length,a=0,o;if(t=t<0?-t>i?0:i+t:t>i?i:t,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(t,n),e.splice(...o);else for(n&&e.splice(t,n);a<r.length;)o=r.slice(a,a+1e4),o.unshift(t,0),e.splice(...o),a+=1e4,t+=1e4}function KZ(e,t){return e.length>0?(GZ(e,e.length,0,t),e):t}var qZ={}.hasOwnProperty;function JZ(e){let t={},n=-1;for(;++n<e.length;)MKe(t,e[n]);return t}function MKe(e,t){let n;for(n in t){let r=(qZ.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n],a;if(i)for(a in i){qZ.call(r,a)||(r[a]=[]);let e=i[a];NKe(r[a],Array.isArray(e)?e:e?[e]:[])}}}function NKe(e,t){let n=-1,r=[];for(;++n<t.length;)(t[n].add===`after`?e:r).push(t[n]);GZ(e,0,0,r)}function YZ(e,t){let n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)==65535||(n&65535)==65534||n>1114111?``:String.fromCodePoint(n)}function XZ(e){return e.replace(/[\t\n\r ]+/g,` `).replace(/^ | $/g,``).toLowerCase().toUpperCase()}const ZZ=oQ(/[A-Za-z]/),QZ=oQ(/[\dA-Za-z]/),PKe=oQ(/[#-'*+\--9=?A-Z^-~]/);function $Z(e){return e!==null&&(e<32||e===127)}const eQ=oQ(/\d/),FKe=oQ(/[\dA-Fa-f]/),IKe=oQ(/[!-/:-@[-`{-~]/);function tQ(e){return e!==null&&e<-2}function nQ(e){return e!==null&&(e<0||e===32)}function rQ(e){return e===-2||e===-1||e===32}const iQ=oQ(/\p{P}|\p{S}/u),aQ=oQ(/\s/);function oQ(e){return t;function t(t){return t!==null&&t>-1&&e.test(String.fromCharCode(t))}}function sQ(e){let t=[],n=-1,r=0,i=0;for(;++n<e.length;){let a=e.charCodeAt(n),o=``;if(a===37&&QZ(e.charCodeAt(n+1))&&QZ(e.charCodeAt(n+2)))i=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(o=String.fromCharCode(a));else if(a>55295&&a<57344){let t=e.charCodeAt(n+1);a<56320&&t>56319&&t<57344?(o=String.fromCharCode(a,t),i=1):o=``}else o=String.fromCharCode(a);o&&=(t.push(e.slice(r,n),encodeURIComponent(o)),r=n+i+1,``),i&&=(n+=i,0)}return t.join(``)+e.slice(r)}function cQ(e,t,n,r){let i=r?r-1:1/0,a=0;return o;function o(r){return rQ(r)?(e.enter(n),s(r)):t(r)}function s(r){return rQ(r)&&a++<i?(e.consume(r),s):(e.exit(n),t(r))}}const LKe={tokenize:RKe};function RKe(e){let t=e.attempt(this.parser.constructs.contentInitial,r,i),n;return t;function r(n){if(n===null){e.consume(n);return}return e.enter(`lineEnding`),e.consume(n),e.exit(`lineEnding`),cQ(e,t,`linePrefix`)}function i(t){return e.enter(`paragraph`),a(t)}function a(t){let r=e.enter(`chunkText`,{contentType:`text`,previous:n});return n&&(n.next=r),n=r,o(t)}function o(t){if(t===null){e.exit(`chunkText`),e.exit(`paragraph`),e.consume(t);return}return tQ(t)?(e.consume(t),e.exit(`chunkText`),a):(e.consume(t),o)}}const zKe={tokenize:BKe};var lQ={tokenize:VKe};function BKe(e){let t=this,n=[],r=0,i,a,o;return s;function s(i){if(r<n.length){let a=n[r];return t.containerState=a[1],e.attempt(a[0].continuation,c,l)(i)}return l(i)}function c(e){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,i&&v();let n=t.events.length,a=n,o;for(;a--;)if(t.events[a][0]===`exit`&&t.events[a][1].type===`chunkFlow`){o=t.events[a][1].end;break}_(r);let s=n;for(;s<t.events.length;)t.events[s][1].end={...o},s++;return GZ(t.events,a+1,0,t.events.slice(n)),t.events.length=s,l(e)}return s(e)}function l(a){if(r===n.length){if(!i)return f(a);if(i.currentConstruct&&i.currentConstruct.concrete)return m(a);t.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(lQ,u,d)(a)}function u(e){return i&&v(),_(r),f(e)}function d(e){return t.parser.lazy[t.now().line]=r!==n.length,o=t.now().offset,m(e)}function f(n){return t.containerState={},e.attempt(lQ,p,m)(n)}function p(e){return r++,n.push([t.currentConstruct,t.containerState]),f(e)}function m(n){if(n===null){i&&v(),_(0),e.consume(n);return}return i||=t.parser.flow(t.now()),e.enter(`chunkFlow`,{_tokenizer:i,contentType:`flow`,previous:a}),h(n)}function h(n){if(n===null){g(e.exit(`chunkFlow`),!0),_(0),e.consume(n);return}return tQ(n)?(e.consume(n),g(e.exit(`chunkFlow`)),r=0,t.interrupt=void 0,s):(e.consume(n),h)}function g(e,n){let s=t.sliceStream(e);if(n&&s.push(null),e.previous=a,a&&(a.next=e),a=e,i.defineSkip(e.start),i.write(s),t.parser.lazy[e.start.line]){let e=i.events.length;for(;e--;)if(i.events[e][1].start.offset<o&&(!i.events[e][1].end||i.events[e][1].end.offset>o))return;let n=t.events.length,a=n,s,c;for(;a--;)if(t.events[a][0]===`exit`&&t.events[a][1].type===`chunkFlow`){if(s){c=t.events[a][1].end;break}s=!0}for(_(r),e=n;e<t.events.length;)t.events[e][1].end={...c},e++;GZ(t.events,a+1,0,t.events.slice(n)),t.events.length=e}}function _(r){let i=n.length;for(;i-- >r;){let r=n[i];t.containerState=r[1],r[0].exit.call(t,e)}n.length=r}function v(){i.write([null]),a=void 0,i=void 0,t.containerState._closeFlow=void 0}}function VKe(e,t,n){return cQ(e,e.attempt(this.parser.constructs.document,t,n),`linePrefix`,this.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)}function uQ(e){if(e===null||nQ(e)||aQ(e))return 1;if(iQ(e))return 2}function dQ(e,t,n){let r=[],i=-1;for(;++i<e.length;){let a=e[i].resolveAll;a&&!r.includes(a)&&(t=a(t,n),r.push(a))}return t}const fQ={name:`attention`,resolveAll:HKe,tokenize:UKe};function HKe(e,t){let n=-1,r,i,a,o,s,c,l,u;for(;++n<e.length;)if(e[n][0]===`enter`&&e[n][1].type===`attentionSequence`&&e[n][1]._close){for(r=n;r--;)if(e[r][0]===`exit`&&e[r][1].type===`attentionSequence`&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;c=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;let d={...e[r][1].end},f={...e[n][1].start};WKe(d,-c),WKe(f,c),o={type:c>1?`strongSequence`:`emphasisSequence`,start:d,end:{...e[r][1].end}},s={type:c>1?`strongSequence`:`emphasisSequence`,start:{...e[n][1].start},end:f},a={type:c>1?`strongText`:`emphasisText`,start:{...e[r][1].end},end:{...e[n][1].start}},i={type:c>1?`strong`:`emphasis`,start:{...o.start},end:{...s.end}},e[r][1].end={...o.start},e[n][1].start={...s.end},l=[],e[r][1].end.offset-e[r][1].start.offset&&(l=KZ(l,[[`enter`,e[r][1],t],[`exit`,e[r][1],t]])),l=KZ(l,[[`enter`,i,t],[`enter`,o,t],[`exit`,o,t],[`enter`,a,t]]),l=KZ(l,dQ(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),l=KZ(l,[[`exit`,a,t],[`enter`,s,t],[`exit`,s,t],[`exit`,i,t]]),e[n][1].end.offset-e[n][1].start.offset?(u=2,l=KZ(l,[[`enter`,e[n][1],t],[`exit`,e[n][1],t]])):u=0,GZ(e,r-1,n-r+3,l),n=r+l.length-u-2;break}}for(n=-1;++n<e.length;)e[n][1].type===`attentionSequence`&&(e[n][1].type=`data`);return e}function UKe(e,t){let n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=uQ(r),a;return o;function o(t){return a=t,e.enter(`attentionSequence`),s(t)}function s(o){if(o===a)return e.consume(o),s;let c=e.exit(`attentionSequence`),l=uQ(o),u=!l||l===2&&i||n.includes(o),d=!i||i===2&&l||n.includes(r);return c._open=!!(a===42?u:u&&(i||!d)),c._close=!!(a===42?d:d&&(l||!u)),t(o)}}function WKe(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const GKe={name:`autolink`,tokenize:KKe};function KKe(e,t,n){let r=0;return i;function i(t){return e.enter(`autolink`),e.enter(`autolinkMarker`),e.consume(t),e.exit(`autolinkMarker`),e.enter(`autolinkProtocol`),a}function a(t){return ZZ(t)?(e.consume(t),o):t===64?n(t):l(t)}function o(e){return e===43||e===45||e===46||QZ(e)?(r=1,s(e)):l(e)}function s(t){return t===58?(e.consume(t),r=0,c):(t===43||t===45||t===46||QZ(t))&&r++<32?(e.consume(t),s):(r=0,l(t))}function c(r){return r===62?(e.exit(`autolinkProtocol`),e.enter(`autolinkMarker`),e.consume(r),e.exit(`autolinkMarker`),e.exit(`autolink`),t):r===null||r===32||r===60||$Z(r)?n(r):(e.consume(r),c)}function l(t){return t===64?(e.consume(t),u):PKe(t)?(e.consume(t),l):n(t)}function u(e){return QZ(e)?d(e):n(e)}function d(n){return n===46?(e.consume(n),r=0,u):n===62?(e.exit(`autolinkProtocol`).type=`autolinkEmail`,e.enter(`autolinkMarker`),e.consume(n),e.exit(`autolinkMarker`),e.exit(`autolink`),t):f(n)}function f(t){if((t===45||QZ(t))&&r++<63){let n=t===45?f:d;return e.consume(t),n}return n(t)}}const pQ={partial:!0,tokenize:qKe};function qKe(e,t,n){return r;function r(t){return rQ(t)?cQ(e,i,`linePrefix`)(t):i(t)}function i(e){return e===null||tQ(e)?t(e):n(e)}}const JKe={continuation:{tokenize:XKe},exit:ZKe,name:`blockQuote`,tokenize:YKe};function YKe(e,t,n){let r=this;return i;function i(t){if(t===62){let n=r.containerState;return n.open||=(e.enter(`blockQuote`,{_container:!0}),!0),e.enter(`blockQuotePrefix`),e.enter(`blockQuoteMarker`),e.consume(t),e.exit(`blockQuoteMarker`),a}return n(t)}function a(n){return rQ(n)?(e.enter(`blockQuotePrefixWhitespace`),e.consume(n),e.exit(`blockQuotePrefixWhitespace`),e.exit(`blockQuotePrefix`),t):(e.exit(`blockQuotePrefix`),t(n))}}function XKe(e,t,n){let r=this;return i;function i(t){return rQ(t)?cQ(e,a,`linePrefix`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)(t):a(t)}function a(r){return e.attempt(JKe,t,n)(r)}}function ZKe(e){e.exit(`blockQuote`)}const QKe={name:`characterEscape`,tokenize:$Ke};function $Ke(e,t,n){return r;function r(t){return e.enter(`characterEscape`),e.enter(`escapeMarker`),e.consume(t),e.exit(`escapeMarker`),i}function i(r){return IKe(r)?(e.enter(`characterEscapeValue`),e.consume(r),e.exit(`characterEscapeValue`),e.exit(`characterEscape`),t):n(r)}}const eqe={name:`characterReference`,tokenize:tqe};function tqe(e,t,n){let r=this,i=0,a,o;return s;function s(t){return e.enter(`characterReference`),e.enter(`characterReferenceMarker`),e.consume(t),e.exit(`characterReferenceMarker`),c}function c(t){return t===35?(e.enter(`characterReferenceMarkerNumeric`),e.consume(t),e.exit(`characterReferenceMarkerNumeric`),l):(e.enter(`characterReferenceValue`),a=31,o=QZ,u(t))}function l(t){return t===88||t===120?(e.enter(`characterReferenceMarkerHexadecimal`),e.consume(t),e.exit(`characterReferenceMarkerHexadecimal`),e.enter(`characterReferenceValue`),a=6,o=FKe,u):(e.enter(`characterReferenceValue`),a=7,o=eQ,u(t))}function u(s){if(s===59&&i){let i=e.exit(`characterReferenceValue`);return o===QZ&&!WZ(r.sliceSerialize(i))?n(s):(e.enter(`characterReferenceMarker`),e.consume(s),e.exit(`characterReferenceMarker`),e.exit(`characterReference`),t)}return o(s)&&i++<a?(e.consume(s),u):n(s)}}var nqe={partial:!0,tokenize:aqe};const rqe={concrete:!0,name:`codeFenced`,tokenize:iqe};function iqe(e,t,n){let r=this,i={partial:!0,tokenize:x},a=0,o=0,s;return c;function c(e){return l(e)}function l(t){let n=r.events[r.events.length-1];return a=n&&n[1].type===`linePrefix`?n[2].sliceSerialize(n[1],!0).length:0,s=t,e.enter(`codeFenced`),e.enter(`codeFencedFence`),e.enter(`codeFencedFenceSequence`),u(t)}function u(t){return t===s?(o++,e.consume(t),u):o<3?n(t):(e.exit(`codeFencedFenceSequence`),rQ(t)?cQ(e,d,`whitespace`)(t):d(t))}function d(n){return n===null||tQ(n)?(e.exit(`codeFencedFence`),r.interrupt?t(n):e.check(nqe,h,b)(n)):(e.enter(`codeFencedFenceInfo`),e.enter(`chunkString`,{contentType:`string`}),f(n))}function f(t){return t===null||tQ(t)?(e.exit(`chunkString`),e.exit(`codeFencedFenceInfo`),d(t)):rQ(t)?(e.exit(`chunkString`),e.exit(`codeFencedFenceInfo`),cQ(e,p,`whitespace`)(t)):t===96&&t===s?n(t):(e.consume(t),f)}function p(t){return t===null||tQ(t)?d(t):(e.enter(`codeFencedFenceMeta`),e.enter(`chunkString`,{contentType:`string`}),m(t))}function m(t){return t===null||tQ(t)?(e.exit(`chunkString`),e.exit(`codeFencedFenceMeta`),d(t)):t===96&&t===s?n(t):(e.consume(t),m)}function h(t){return e.attempt(i,b,g)(t)}function g(t){return e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),_}function _(t){return a>0&&rQ(t)?cQ(e,v,`linePrefix`,a+1)(t):v(t)}function v(t){return t===null||tQ(t)?e.check(nqe,h,b)(t):(e.enter(`codeFlowValue`),y(t))}function y(t){return t===null||tQ(t)?(e.exit(`codeFlowValue`),v(t)):(e.consume(t),y)}function b(n){return e.exit(`codeFenced`),t(n)}function x(e,t,n){let i=0;return a;function a(t){return e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),c}function c(t){return e.enter(`codeFencedFence`),rQ(t)?cQ(e,l,`linePrefix`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)(t):l(t)}function l(t){return t===s?(e.enter(`codeFencedFenceSequence`),u(t)):n(t)}function u(t){return t===s?(i++,e.consume(t),u):i>=o?(e.exit(`codeFencedFenceSequence`),rQ(t)?cQ(e,d,`whitespace`)(t):d(t)):n(t)}function d(r){return r===null||tQ(r)?(e.exit(`codeFencedFence`),t(r)):n(r)}}}function aqe(e,t,n){let r=this;return i;function i(t){return t===null?n(t):(e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),a)}function a(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}const mQ={name:`codeIndented`,tokenize:sqe};var oqe={partial:!0,tokenize:cqe};function sqe(e,t,n){let r=this;return i;function i(t){return e.enter(`codeIndented`),cQ(e,a,`linePrefix`,5)(t)}function a(e){let t=r.events[r.events.length-1];return t&&t[1].type===`linePrefix`&&t[2].sliceSerialize(t[1],!0).length>=4?o(e):n(e)}function o(t){return t===null?c(t):tQ(t)?e.attempt(oqe,o,c)(t):(e.enter(`codeFlowValue`),s(t))}function s(t){return t===null||tQ(t)?(e.exit(`codeFlowValue`),o(t)):(e.consume(t),s)}function c(n){return e.exit(`codeIndented`),t(n)}}function cqe(e,t,n){let r=this;return i;function i(t){return r.parser.lazy[r.now().line]?n(t):tQ(t)?(e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),i):cQ(e,a,`linePrefix`,5)(t)}function a(e){let a=r.events[r.events.length-1];return a&&a[1].type===`linePrefix`&&a[2].sliceSerialize(a[1],!0).length>=4?t(e):tQ(e)?i(e):n(e)}}const lqe={name:`codeText`,previous:dqe,resolve:uqe,tokenize:fqe};function uqe(e){let t=e.length-4,n=3,r,i;if((e[n][1].type===`lineEnding`||e[n][1].type===`space`)&&(e[t][1].type===`lineEnding`||e[t][1].type===`space`)){for(r=n;++r<t;)if(e[r][1].type===`codeTextData`){e[n][1].type=`codeTextPadding`,e[t][1].type=`codeTextPadding`,n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)i===void 0?r!==t&&e[r][1].type!==`lineEnding`&&(i=r):(r===t||e[r][1].type===`lineEnding`)&&(e[i][1].type=`codeTextData`,r!==i+2&&(e[i][1].end=e[r-1][1].end,e.splice(i+2,r-i-2),t-=r-i-2,r=i+2),i=void 0);return e}function dqe(e){return e!==96||this.events[this.events.length-1][1].type===`characterEscape`}function fqe(e,t,n){let r=0,i,a;return o;function o(t){return e.enter(`codeText`),e.enter(`codeTextSequence`),s(t)}function s(t){return t===96?(e.consume(t),r++,s):(e.exit(`codeTextSequence`),c(t))}function c(t){return t===null?n(t):t===32?(e.enter(`space`),e.consume(t),e.exit(`space`),c):t===96?(a=e.enter(`codeTextSequence`),i=0,u(t)):tQ(t)?(e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),c):(e.enter(`codeTextData`),l(t))}function l(t){return t===null||t===32||t===96||tQ(t)?(e.exit(`codeTextData`),c(t)):(e.consume(t),l)}function u(n){return n===96?(e.consume(n),i++,u):i===r?(e.exit(`codeTextSequence`),e.exit(`codeText`),t(n)):(a.type=`codeTextData`,l(n))}}var pqe=class{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){let n=t??1/0;return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){let r=t||0;this.setCursor(Math.trunc(e));let i=this.right.splice(this.right.length-r,1/0);return n&&hQ(this.left,n),i.reverse()}pop(){return this.setCursor(1/0),this.left.pop()}push(e){this.setCursor(1/0),this.left.push(e)}pushMany(e){this.setCursor(1/0),hQ(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),hQ(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){let t=this.left.splice(e,1/0);hQ(this.right,t.reverse())}else{let t=this.right.splice(this.left.length+this.right.length-e,1/0);hQ(this.left,t.reverse())}}};function hQ(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function mqe(e){let t={},n=-1,r,i,a,o,s,c,l,u=new pqe(e);for(;++n<u.length;){for(;n in t;)n=t[n];if(r=u.get(n),n&&r[1].type===`chunkFlow`&&u.get(n-1)[1].type===`listItemPrefix`&&(c=r[1]._tokenizer.events,a=0,a<c.length&&c[a][1].type===`lineEndingBlank`&&(a+=2),a<c.length&&c[a][1].type===`content`))for(;++a<c.length&&c[a][1].type!==`content`;)c[a][1].type===`chunkText`&&(c[a][1]._isInFirstContentOfListItem=!0,a++);if(r[0]===`enter`)r[1].contentType&&(Object.assign(t,hqe(u,n)),n=t[n],l=!0);else if(r[1]._container){for(a=n,i=void 0;a--;)if(o=u.get(a),o[1].type===`lineEnding`||o[1].type===`lineEndingBlank`)o[0]===`enter`&&(i&&(u.get(i)[1].type=`lineEndingBlank`),o[1].type=`lineEnding`,i=a);else if(!(o[1].type===`linePrefix`||o[1].type===`listItemIndent`))break;i&&(r[1].end={...u.get(i)[1].start},s=u.slice(i,n),s.unshift(r),u.splice(i,n-i+1,s))}}return GZ(e,0,1/0,u.slice(0)),!l}function hqe(e,t){let n=e.get(t)[1],r=e.get(t)[2],i=t-1,a=[],o=n._tokenizer;o||(o=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));let s=o.events,c=[],l={},u,d,f=-1,p=n,m=0,h=0,g=[h];for(;p;){for(;e.get(++i)[1]!==p;);a.push(i),p._tokenizer||(u=r.sliceStream(p),p.next||u.push(null),d&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++f<s.length;)s[f][0]===`exit`&&s[f-1][0]===`enter`&&s[f][1].type===s[f-1][1].type&&s[f][1].start.line!==s[f][1].end.line&&(h=f+1,g.push(h),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),f=g.length;f--;){let t=s.slice(g[f],g[f+1]),n=a.pop();c.push([n,n+t.length-1]),e.splice(n,2,t)}for(c.reverse(),f=-1;++f<c.length;)l[m+c[f][0]]=m+c[f][1],m+=c[f][1]-c[f][0]-1;return l}const gqe={resolve:vqe,tokenize:yqe};var _qe={partial:!0,tokenize:bqe};function vqe(e){return mqe(e),e}function yqe(e,t){let n;return r;function r(t){return e.enter(`content`),n=e.enter(`chunkContent`,{contentType:`content`}),i(t)}function i(t){return t===null?a(t):tQ(t)?e.check(_qe,o,a)(t):(e.consume(t),i)}function a(n){return e.exit(`chunkContent`),e.exit(`content`),t(n)}function o(t){return e.consume(t),e.exit(`chunkContent`),n.next=e.enter(`chunkContent`,{contentType:`content`,previous:n}),n=n.next,i}}function bqe(e,t,n){let r=this;return i;function i(t){return e.exit(`chunkContent`),e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),cQ(e,a,`linePrefix`)}function a(i){if(i===null||tQ(i))return n(i);let a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes(`codeIndented`)&&a&&a[1].type===`linePrefix`&&a[2].sliceSerialize(a[1],!0).length>=4?t(i):e.interrupt(r.parser.constructs.flow,n,t)(i)}}function xqe(e,t,n,r,i,a,o,s,c){let l=c||1/0,u=0;return d;function d(t){return t===60?(e.enter(r),e.enter(i),e.enter(a),e.consume(t),e.exit(a),f):t===null||t===32||t===41||$Z(t)?n(t):(e.enter(r),e.enter(o),e.enter(s),e.enter(`chunkString`,{contentType:`string`}),h(t))}function f(n){return n===62?(e.enter(a),e.consume(n),e.exit(a),e.exit(i),e.exit(r),t):(e.enter(s),e.enter(`chunkString`,{contentType:`string`}),p(n))}function p(t){return t===62?(e.exit(`chunkString`),e.exit(s),f(t)):t===null||t===60||tQ(t)?n(t):(e.consume(t),t===92?m:p)}function m(t){return t===60||t===62||t===92?(e.consume(t),p):p(t)}function h(i){return!u&&(i===null||i===41||nQ(i))?(e.exit(`chunkString`),e.exit(s),e.exit(o),e.exit(r),t(i)):u<l&&i===40?(e.consume(i),u++,h):i===41?(e.consume(i),u--,h):i===null||i===32||i===40||$Z(i)?n(i):(e.consume(i),i===92?g:h)}function g(t){return t===40||t===41||t===92?(e.consume(t),h):h(t)}}function Sqe(e,t,n,r,i,a){let o=this,s=0,c;return l;function l(t){return e.enter(r),e.enter(i),e.consume(t),e.exit(i),e.enter(a),u}function u(l){return s>999||l===null||l===91||l===93&&!c||l===94&&!s&&`_hiddenFootnoteSupport`in o.parser.constructs?n(l):l===93?(e.exit(a),e.enter(i),e.consume(l),e.exit(i),e.exit(r),t):tQ(l)?(e.enter(`lineEnding`),e.consume(l),e.exit(`lineEnding`),u):(e.enter(`chunkString`,{contentType:`string`}),d(l))}function d(t){return t===null||t===91||t===93||tQ(t)||s++>999?(e.exit(`chunkString`),u(t)):(e.consume(t),c||=!rQ(t),t===92?f:d)}function f(t){return t===91||t===92||t===93?(e.consume(t),s++,d):d(t)}}function Cqe(e,t,n,r,i,a){let o;return s;function s(t){return t===34||t===39||t===40?(e.enter(r),e.enter(i),e.consume(t),e.exit(i),o=t===40?41:t,c):n(t)}function c(n){return n===o?(e.enter(i),e.consume(n),e.exit(i),e.exit(r),t):(e.enter(a),l(n))}function l(t){return t===o?(e.exit(a),c(o)):t===null?n(t):tQ(t)?(e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),cQ(e,l,`linePrefix`)):(e.enter(`chunkString`,{contentType:`string`}),u(t))}function u(t){return t===o||t===null||tQ(t)?(e.exit(`chunkString`),l(t)):(e.consume(t),t===92?d:u)}function d(t){return t===o||t===92?(e.consume(t),u):u(t)}}function gQ(e,t){let n;return r;function r(i){return tQ(i)?(e.enter(`lineEnding`),e.consume(i),e.exit(`lineEnding`),n=!0,r):rQ(i)?cQ(e,r,n?`linePrefix`:`lineSuffix`)(i):t(i)}}const wqe={name:`definition`,tokenize:Eqe};var Tqe={partial:!0,tokenize:Dqe};function Eqe(e,t,n){let r=this,i;return a;function a(t){return e.enter(`definition`),o(t)}function o(t){return Sqe.call(r,e,s,n,`definitionLabel`,`definitionLabelMarker`,`definitionLabelString`)(t)}function s(t){return i=XZ(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),t===58?(e.enter(`definitionMarker`),e.consume(t),e.exit(`definitionMarker`),c):n(t)}function c(t){return nQ(t)?gQ(e,l)(t):l(t)}function l(t){return xqe(e,u,n,`definitionDestination`,`definitionDestinationLiteral`,`definitionDestinationLiteralMarker`,`definitionDestinationRaw`,`definitionDestinationString`)(t)}function u(t){return e.attempt(Tqe,d,d)(t)}function d(t){return rQ(t)?cQ(e,f,`whitespace`)(t):f(t)}function f(a){return a===null||tQ(a)?(e.exit(`definition`),r.parser.defined.push(i),t(a)):n(a)}}function Dqe(e,t,n){return r;function r(t){return nQ(t)?gQ(e,i)(t):n(t)}function i(t){return Cqe(e,a,n,`definitionTitle`,`definitionTitleMarker`,`definitionTitleString`)(t)}function a(t){return rQ(t)?cQ(e,o,`whitespace`)(t):o(t)}function o(e){return e===null||tQ(e)?t(e):n(e)}}const Oqe={name:`hardBreakEscape`,tokenize:kqe};function kqe(e,t,n){return r;function r(t){return e.enter(`hardBreakEscape`),e.consume(t),i}function i(r){return tQ(r)?(e.exit(`hardBreakEscape`),t(r)):n(r)}}const Aqe={name:`headingAtx`,resolve:jqe,tokenize:Mqe};function jqe(e,t){let n=e.length-2,r=3,i,a;return e[r][1].type===`whitespace`&&(r+=2),n-2>r&&e[n][1].type===`whitespace`&&(n-=2),e[n][1].type===`atxHeadingSequence`&&(r===n-1||n-4>r&&e[n-2][1].type===`whitespace`)&&(n-=r+1===n?2:4),n>r&&(i={type:`atxHeadingText`,start:e[r][1].start,end:e[n][1].end},a={type:`chunkText`,start:e[r][1].start,end:e[n][1].end,contentType:`text`},GZ(e,r,n-r+1,[[`enter`,i,t],[`enter`,a,t],[`exit`,a,t],[`exit`,i,t]])),e}function Mqe(e,t,n){let r=0;return i;function i(t){return e.enter(`atxHeading`),a(t)}function a(t){return e.enter(`atxHeadingSequence`),o(t)}function o(t){return t===35&&r++<6?(e.consume(t),o):t===null||nQ(t)?(e.exit(`atxHeadingSequence`),s(t)):n(t)}function s(n){return n===35?(e.enter(`atxHeadingSequence`),c(n)):n===null||tQ(n)?(e.exit(`atxHeading`),t(n)):rQ(n)?cQ(e,s,`whitespace`)(n):(e.enter(`atxHeadingText`),l(n))}function c(t){return t===35?(e.consume(t),c):(e.exit(`atxHeadingSequence`),s(t))}function l(t){return t===null||t===35||nQ(t)?(e.exit(`atxHeadingText`),s(t)):(e.consume(t),l)}}const Nqe=`address.article.aside.base.basefont.blockquote.body.caption.center.col.colgroup.dd.details.dialog.dir.div.dl.dt.fieldset.figcaption.figure.footer.form.frame.frameset.h1.h2.h3.h4.h5.h6.head.header.hr.html.iframe.legend.li.link.main.menu.menuitem.nav.noframes.ol.optgroup.option.p.param.search.section.summary.table.tbody.td.tfoot.th.thead.title.tr.track.ul`.split(`.`),Pqe=[`pre`,`script`,`style`,`textarea`],Fqe={concrete:!0,name:`htmlFlow`,resolveTo:Rqe,tokenize:zqe};var Iqe={partial:!0,tokenize:Vqe},Lqe={partial:!0,tokenize:Bqe};function Rqe(e){let t=e.length;for(;t--&&!(e[t][0]===`enter`&&e[t][1].type===`htmlFlow`););return t>1&&e[t-2][1].type===`linePrefix`&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function zqe(e,t,n){let r=this,i,a,o,s,c;return l;function l(e){return u(e)}function u(t){return e.enter(`htmlFlow`),e.enter(`htmlFlowData`),e.consume(t),d}function d(s){return s===33?(e.consume(s),f):s===47?(e.consume(s),a=!0,h):s===63?(e.consume(s),i=3,r.interrupt?t:P):ZZ(s)?(e.consume(s),o=String.fromCharCode(s),g):n(s)}function f(a){return a===45?(e.consume(a),i=2,p):a===91?(e.consume(a),i=5,s=0,m):ZZ(a)?(e.consume(a),i=4,r.interrupt?t:P):n(a)}function p(i){return i===45?(e.consume(i),r.interrupt?t:P):n(i)}function m(i){return i===`CDATA[`.charCodeAt(s++)?(e.consume(i),s===6?r.interrupt?t:O:m):n(i)}function h(t){return ZZ(t)?(e.consume(t),o=String.fromCharCode(t),g):n(t)}function g(s){if(s===null||s===47||s===62||nQ(s)){let c=s===47,l=o.toLowerCase();return!c&&!a&&Pqe.includes(l)?(i=1,r.interrupt?t(s):O(s)):Nqe.includes(o.toLowerCase())?(i=6,c?(e.consume(s),_):r.interrupt?t(s):O(s)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(s):a?v(s):y(s))}return s===45||QZ(s)?(e.consume(s),o+=String.fromCharCode(s),g):n(s)}function _(i){return i===62?(e.consume(i),r.interrupt?t:O):n(i)}function v(t){return rQ(t)?(e.consume(t),v):E(t)}function y(t){return t===47?(e.consume(t),E):t===58||t===95||ZZ(t)?(e.consume(t),b):rQ(t)?(e.consume(t),y):E(t)}function b(t){return t===45||t===46||t===58||t===95||QZ(t)?(e.consume(t),b):x(t)}function x(t){return t===61?(e.consume(t),S):rQ(t)?(e.consume(t),x):y(t)}function S(t){return t===null||t===60||t===61||t===62||t===96?n(t):t===34||t===39?(e.consume(t),c=t,C):rQ(t)?(e.consume(t),S):w(t)}function C(t){return t===c?(e.consume(t),c=null,T):t===null||tQ(t)?n(t):(e.consume(t),C)}function w(t){return t===null||t===34||t===39||t===47||t===60||t===61||t===62||t===96||nQ(t)?x(t):(e.consume(t),w)}function T(e){return e===47||e===62||rQ(e)?y(e):n(e)}function E(t){return t===62?(e.consume(t),D):n(t)}function D(t){return t===null||tQ(t)?O(t):rQ(t)?(e.consume(t),D):n(t)}function O(t){return t===45&&i===2?(e.consume(t),M):t===60&&i===1?(e.consume(t),N):t===62&&i===4?(e.consume(t),ne):t===63&&i===3?(e.consume(t),P):t===93&&i===5?(e.consume(t),te):tQ(t)&&(i===6||i===7)?(e.exit(`htmlFlowData`),e.check(Iqe,re,k)(t)):t===null||tQ(t)?(e.exit(`htmlFlowData`),k(t)):(e.consume(t),O)}function k(t){return e.check(Lqe,A,re)(t)}function A(t){return e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),j}function j(t){return t===null||tQ(t)?k(t):(e.enter(`htmlFlowData`),O(t))}function M(t){return t===45?(e.consume(t),P):O(t)}function N(t){return t===47?(e.consume(t),o=``,ee):O(t)}function ee(t){if(t===62){let n=o.toLowerCase();return Pqe.includes(n)?(e.consume(t),ne):O(t)}return ZZ(t)&&o.length<8?(e.consume(t),o+=String.fromCharCode(t),ee):O(t)}function te(t){return t===93?(e.consume(t),P):O(t)}function P(t){return t===62?(e.consume(t),ne):t===45&&i===2?(e.consume(t),P):O(t)}function ne(t){return t===null||tQ(t)?(e.exit(`htmlFlowData`),re(t)):(e.consume(t),ne)}function re(n){return e.exit(`htmlFlow`),t(n)}}function Bqe(e,t,n){let r=this;return i;function i(t){return tQ(t)?(e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),a):n(t)}function a(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}function Vqe(e,t,n){return r;function r(r){return e.enter(`lineEnding`),e.consume(r),e.exit(`lineEnding`),e.attempt(pQ,t,n)}}const Hqe={name:`htmlText`,tokenize:Uqe};function Uqe(e,t,n){let r=this,i,a,o;return s;function s(t){return e.enter(`htmlText`),e.enter(`htmlTextData`),e.consume(t),c}function c(t){return t===33?(e.consume(t),l):t===47?(e.consume(t),x):t===63?(e.consume(t),y):ZZ(t)?(e.consume(t),w):n(t)}function l(t){return t===45?(e.consume(t),u):t===91?(e.consume(t),a=0,m):ZZ(t)?(e.consume(t),v):n(t)}function u(t){return t===45?(e.consume(t),p):n(t)}function d(t){return t===null?n(t):t===45?(e.consume(t),f):tQ(t)?(o=d,N(t)):(e.consume(t),d)}function f(t){return t===45?(e.consume(t),p):d(t)}function p(e){return e===62?M(e):e===45?f(e):d(e)}function m(t){return t===`CDATA[`.charCodeAt(a++)?(e.consume(t),a===6?h:m):n(t)}function h(t){return t===null?n(t):t===93?(e.consume(t),g):tQ(t)?(o=h,N(t)):(e.consume(t),h)}function g(t){return t===93?(e.consume(t),_):h(t)}function _(t){return t===62?M(t):t===93?(e.consume(t),_):h(t)}function v(t){return t===null||t===62?M(t):tQ(t)?(o=v,N(t)):(e.consume(t),v)}function y(t){return t===null?n(t):t===63?(e.consume(t),b):tQ(t)?(o=y,N(t)):(e.consume(t),y)}function b(e){return e===62?M(e):y(e)}function x(t){return ZZ(t)?(e.consume(t),S):n(t)}function S(t){return t===45||QZ(t)?(e.consume(t),S):C(t)}function C(t){return tQ(t)?(o=C,N(t)):rQ(t)?(e.consume(t),C):M(t)}function w(t){return t===45||QZ(t)?(e.consume(t),w):t===47||t===62||nQ(t)?T(t):n(t)}function T(t){return t===47?(e.consume(t),M):t===58||t===95||ZZ(t)?(e.consume(t),E):tQ(t)?(o=T,N(t)):rQ(t)?(e.consume(t),T):M(t)}function E(t){return t===45||t===46||t===58||t===95||QZ(t)?(e.consume(t),E):D(t)}function D(t){return t===61?(e.consume(t),O):tQ(t)?(o=D,N(t)):rQ(t)?(e.consume(t),D):T(t)}function O(t){return t===null||t===60||t===61||t===62||t===96?n(t):t===34||t===39?(e.consume(t),i=t,k):tQ(t)?(o=O,N(t)):rQ(t)?(e.consume(t),O):(e.consume(t),A)}function k(t){return t===i?(e.consume(t),i=void 0,j):t===null?n(t):tQ(t)?(o=k,N(t)):(e.consume(t),k)}function A(t){return t===null||t===34||t===39||t===60||t===61||t===96?n(t):t===47||t===62||nQ(t)?T(t):(e.consume(t),A)}function j(e){return e===47||e===62||nQ(e)?T(e):n(e)}function M(r){return r===62?(e.consume(r),e.exit(`htmlTextData`),e.exit(`htmlText`),t):n(r)}function N(t){return e.exit(`htmlTextData`),e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),ee}function ee(t){return rQ(t)?cQ(e,te,`linePrefix`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)(t):te(t)}function te(t){return e.enter(`htmlTextData`),o(t)}}const _Q={name:`labelEnd`,resolveAll:qqe,resolveTo:Jqe,tokenize:Yqe};var Wqe={tokenize:Xqe},Gqe={tokenize:Zqe},Kqe={tokenize:Qqe};function qqe(e){let t=-1,n=[];for(;++t<e.length;){let r=e[t][1];if(n.push(e[t]),r.type===`labelImage`||r.type===`labelLink`||r.type===`labelEnd`){let e=r.type===`labelImage`?4:2;r.type=`data`,t+=e}}return e.length!==n.length&&GZ(e,0,e.length,n),e}function Jqe(e,t){let n=e.length,r=0,i,a,o,s;for(;n--;)if(i=e[n][1],a){if(i.type===`link`||i.type===`labelLink`&&i._inactive)break;e[n][0]===`enter`&&i.type===`labelLink`&&(i._inactive=!0)}else if(o){if(e[n][0]===`enter`&&(i.type===`labelImage`||i.type===`labelLink`)&&!i._balanced&&(a=n,i.type!==`labelLink`)){r=2;break}}else i.type===`labelEnd`&&(o=n);let c={type:e[a][1].type===`labelLink`?`link`:`image`,start:{...e[a][1].start},end:{...e[e.length-1][1].end}},l={type:`label`,start:{...e[a][1].start},end:{...e[o][1].end}},u={type:`labelText`,start:{...e[a+r+2][1].end},end:{...e[o-2][1].start}};return s=[[`enter`,c,t],[`enter`,l,t]],s=KZ(s,e.slice(a+1,a+r+3)),s=KZ(s,[[`enter`,u,t]]),s=KZ(s,dQ(t.parser.constructs.insideSpan.null,e.slice(a+r+4,o-3),t)),s=KZ(s,[[`exit`,u,t],e[o-2],e[o-1],[`exit`,l,t]]),s=KZ(s,e.slice(o+1)),s=KZ(s,[[`exit`,c,t]]),GZ(e,a,e.length,s),e}function Yqe(e,t,n){let r=this,i=r.events.length,a,o;for(;i--;)if((r.events[i][1].type===`labelImage`||r.events[i][1].type===`labelLink`)&&!r.events[i][1]._balanced){a=r.events[i][1];break}return s;function s(t){return a?a._inactive?d(t):(o=r.parser.defined.includes(XZ(r.sliceSerialize({start:a.end,end:r.now()}))),e.enter(`labelEnd`),e.enter(`labelMarker`),e.consume(t),e.exit(`labelMarker`),e.exit(`labelEnd`),c):n(t)}function c(t){return t===40?e.attempt(Wqe,u,o?u:d)(t):t===91?e.attempt(Gqe,u,o?l:d)(t):o?u(t):d(t)}function l(t){return e.attempt(Kqe,u,d)(t)}function u(e){return t(e)}function d(e){return a._balanced=!0,n(e)}}function Xqe(e,t,n){return r;function r(t){return e.enter(`resource`),e.enter(`resourceMarker`),e.consume(t),e.exit(`resourceMarker`),i}function i(t){return nQ(t)?gQ(e,a)(t):a(t)}function a(t){return t===41?u(t):xqe(e,o,s,`resourceDestination`,`resourceDestinationLiteral`,`resourceDestinationLiteralMarker`,`resourceDestinationRaw`,`resourceDestinationString`,32)(t)}function o(t){return nQ(t)?gQ(e,c)(t):u(t)}function s(e){return n(e)}function c(t){return t===34||t===39||t===40?Cqe(e,l,n,`resourceTitle`,`resourceTitleMarker`,`resourceTitleString`)(t):u(t)}function l(t){return nQ(t)?gQ(e,u)(t):u(t)}function u(r){return r===41?(e.enter(`resourceMarker`),e.consume(r),e.exit(`resourceMarker`),e.exit(`resource`),t):n(r)}}function Zqe(e,t,n){let r=this;return i;function i(t){return Sqe.call(r,e,a,o,`reference`,`referenceMarker`,`referenceString`)(t)}function a(e){return r.parser.defined.includes(XZ(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function o(e){return n(e)}}function Qqe(e,t,n){return r;function r(t){return e.enter(`reference`),e.enter(`referenceMarker`),e.consume(t),e.exit(`referenceMarker`),i}function i(r){return r===93?(e.enter(`referenceMarker`),e.consume(r),e.exit(`referenceMarker`),e.exit(`reference`),t):n(r)}}const $qe={name:`labelStartImage`,resolveAll:_Q.resolveAll,tokenize:eJe};function eJe(e,t,n){let r=this;return i;function i(t){return e.enter(`labelImage`),e.enter(`labelImageMarker`),e.consume(t),e.exit(`labelImageMarker`),a}function a(t){return t===91?(e.enter(`labelMarker`),e.consume(t),e.exit(`labelMarker`),e.exit(`labelImage`),o):n(t)}function o(e){return e===94&&`_hiddenFootnoteSupport`in r.parser.constructs?n(e):t(e)}}const tJe={name:`labelStartLink`,resolveAll:_Q.resolveAll,tokenize:nJe};function nJe(e,t,n){let r=this;return i;function i(t){return e.enter(`labelLink`),e.enter(`labelMarker`),e.consume(t),e.exit(`labelMarker`),e.exit(`labelLink`),a}function a(e){return e===94&&`_hiddenFootnoteSupport`in r.parser.constructs?n(e):t(e)}}const vQ={name:`lineEnding`,tokenize:rJe};function rJe(e,t){return n;function n(n){return e.enter(`lineEnding`),e.consume(n),e.exit(`lineEnding`),cQ(e,t,`linePrefix`)}}const yQ={name:`thematicBreak`,tokenize:iJe};function iJe(e,t,n){let r=0,i;return a;function a(t){return e.enter(`thematicBreak`),o(t)}function o(e){return i=e,s(e)}function s(a){return a===i?(e.enter(`thematicBreakSequence`),c(a)):r>=3&&(a===null||tQ(a))?(e.exit(`thematicBreak`),t(a)):n(a)}function c(t){return t===i?(e.consume(t),r++,c):(e.exit(`thematicBreakSequence`),rQ(t)?cQ(e,s,`whitespace`)(t):s(t))}}const bQ={continuation:{tokenize:cJe},exit:uJe,name:`list`,tokenize:sJe};var aJe={partial:!0,tokenize:dJe},oJe={partial:!0,tokenize:lJe};function sJe(e,t,n){let r=this,i=r.events[r.events.length-1],a=i&&i[1].type===`linePrefix`?i[2].sliceSerialize(i[1],!0).length:0,o=0;return s;function s(t){let i=r.containerState.type||(t===42||t===43||t===45?`listUnordered`:`listOrdered`);if(i===`listUnordered`?!r.containerState.marker||t===r.containerState.marker:eQ(t)){if(r.containerState.type||(r.containerState.type=i,e.enter(i,{_container:!0})),i===`listUnordered`)return e.enter(`listItemPrefix`),t===42||t===45?e.check(yQ,n,l)(t):l(t);if(!r.interrupt||t===49)return e.enter(`listItemPrefix`),e.enter(`listItemValue`),c(t)}return n(t)}function c(t){return eQ(t)&&++o<10?(e.consume(t),c):(!r.interrupt||o<2)&&(r.containerState.marker?t===r.containerState.marker:t===41||t===46)?(e.exit(`listItemValue`),l(t)):n(t)}function l(t){return e.enter(`listItemMarker`),e.consume(t),e.exit(`listItemMarker`),r.containerState.marker=r.containerState.marker||t,e.check(pQ,r.interrupt?n:u,e.attempt(aJe,f,d))}function u(e){return r.containerState.initialBlankLine=!0,a++,f(e)}function d(t){return rQ(t)?(e.enter(`listItemPrefixWhitespace`),e.consume(t),e.exit(`listItemPrefixWhitespace`),f):n(t)}function f(n){return r.containerState.size=a+r.sliceSerialize(e.exit(`listItemPrefix`),!0).length,t(n)}}function cJe(e,t,n){let r=this;return r.containerState._closeFlow=void 0,e.check(pQ,i,a);function i(n){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,cQ(e,t,`listItemIndent`,r.containerState.size+1)(n)}function a(n){return r.containerState.furtherBlankLines||!rQ(n)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(n)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(oJe,t,o)(n))}function o(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,cQ(e,e.attempt(bQ,t,n),`linePrefix`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)(i)}}function lJe(e,t,n){let r=this;return cQ(e,i,`listItemIndent`,r.containerState.size+1);function i(e){let i=r.events[r.events.length-1];return i&&i[1].type===`listItemIndent`&&i[2].sliceSerialize(i[1],!0).length===r.containerState.size?t(e):n(e)}}function uJe(e){e.exit(this.containerState.type)}function dJe(e,t,n){let r=this;return cQ(e,i,`listItemPrefixWhitespace`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:5);function i(e){let i=r.events[r.events.length-1];return!rQ(e)&&i&&i[1].type===`listItemPrefixWhitespace`?t(e):n(e)}}const fJe={name:`setextUnderline`,resolveTo:pJe,tokenize:mJe};function pJe(e,t){let n=e.length,r,i,a;for(;n--;)if(e[n][0]===`enter`){if(e[n][1].type===`content`){r=n;break}e[n][1].type===`paragraph`&&(i=n)}else e[n][1].type===`content`&&e.splice(n,1),!a&&e[n][1].type===`definition`&&(a=n);let o={type:`setextHeading`,start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[i][1].type=`setextHeadingText`,a?(e.splice(i,0,[`enter`,o,t]),e.splice(a+1,0,[`exit`,e[r][1],t]),e[r][1].end={...e[a][1].end}):e[r][1]=o,e.push([`exit`,o,t]),e}function mJe(e,t,n){let r=this,i;return a;function a(t){let a=r.events.length,s;for(;a--;)if(r.events[a][1].type!==`lineEnding`&&r.events[a][1].type!==`linePrefix`&&r.events[a][1].type!==`content`){s=r.events[a][1].type===`paragraph`;break}return!r.parser.lazy[r.now().line]&&(r.interrupt||s)?(e.enter(`setextHeadingLine`),i=t,o(t)):n(t)}function o(t){return e.enter(`setextHeadingLineSequence`),s(t)}function s(t){return t===i?(e.consume(t),s):(e.exit(`setextHeadingLineSequence`),rQ(t)?cQ(e,c,`lineSuffix`)(t):c(t))}function c(r){return r===null||tQ(r)?(e.exit(`setextHeadingLine`),t(r)):n(r)}}const hJe={tokenize:gJe};function gJe(e){let t=this,n=e.attempt(pQ,r,e.attempt(this.parser.constructs.flowInitial,i,cQ(e,e.attempt(this.parser.constructs.flow,i,e.attempt(gqe,i)),`linePrefix`)));return n;function r(r){if(r===null){e.consume(r);return}return e.enter(`lineEndingBlank`),e.consume(r),e.exit(`lineEndingBlank`),t.currentConstruct=void 0,n}function i(r){if(r===null){e.consume(r);return}return e.enter(`lineEnding`),e.consume(r),e.exit(`lineEnding`),t.currentConstruct=void 0,n}}const _Je={resolveAll:xJe()},vJe=bJe(`string`),yJe=bJe(`text`);function bJe(e){return{resolveAll:xJe(e===`text`?SJe:void 0),tokenize:t};function t(t){let n=this,r=this.parser.constructs[e],i=t.attempt(r,a,o);return a;function a(e){return c(e)?i(e):o(e)}function o(e){if(e===null){t.consume(e);return}return t.enter(`data`),t.consume(e),s}function s(e){return c(e)?(t.exit(`data`),i(e)):(t.consume(e),s)}function c(e){if(e===null)return!0;let t=r[e],i=-1;if(t)for(;++i<t.length;){let e=t[i];if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}function xJe(e){return t;function t(t,n){let r=-1,i;for(;++r<=t.length;)i===void 0?t[r]&&t[r][1].type===`data`&&(i=r,r++):(!t[r]||t[r][1].type!==`data`)&&(r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),r=i+2),i=void 0);return e?e(t,n):t}}function SJe(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type===`lineEnding`)&&e[n-1][1].type===`data`){let r=e[n-1][1],i=t.sliceStream(r),a=i.length,o=-1,s=0,c;for(;a--;){let e=i[a];if(typeof e==`string`){for(o=e.length;e.charCodeAt(o-1)===32;)s++,o--;if(o)break;o=-1}else if(e===-2)c=!0,s++;else if(e!==-1){a++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(s=0),s){let i={type:n===e.length||c||s<2?`lineSuffix`:`hardBreakTrailing`,start:{_bufferIndex:a?o:r.start._bufferIndex+o,_index:r.start._index+a,line:r.end.line,column:r.end.column-s,offset:r.end.offset-s},end:{...r.end}};r.end={...i.start},r.start.offset===r.end.offset?Object.assign(r,i):(e.splice(n,0,[`enter`,i,t],[`exit`,i,t]),n+=2)}n++}return e}var CJe=s({attentionMarkers:()=>jJe,contentInitial:()=>TJe,disable:()=>MJe,document:()=>wJe,flow:()=>DJe,flowInitial:()=>EJe,insideSpan:()=>AJe,string:()=>OJe,text:()=>kJe});const wJe={42:bQ,43:bQ,45:bQ,48:bQ,49:bQ,50:bQ,51:bQ,52:bQ,53:bQ,54:bQ,55:bQ,56:bQ,57:bQ,62:JKe},TJe={91:wqe},EJe={[-2]:mQ,[-1]:mQ,32:mQ},DJe={35:Aqe,42:yQ,45:[fJe,yQ],60:Fqe,61:fJe,95:yQ,96:rqe,126:rqe},OJe={38:eqe,92:QKe},kJe={[-5]:vQ,[-4]:vQ,[-3]:vQ,33:$qe,38:eqe,42:fQ,60:[GKe,Hqe],91:tJe,92:[Oqe,QKe],93:_Q,95:fQ,96:lqe},AJe={null:[fQ,_Je]},jJe={null:[42,95]},MJe={null:[]};function NJe(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0},i={},a=[],o=[],s=[],c={attempt:C(x),check:C(S),consume:v,enter:y,exit:b,interrupt:C(S,{interrupt:!0})},l={code:null,containerState:{},defineSkip:h,events:[],now:m,parser:e,previous:null,sliceSerialize:f,sliceStream:p,write:d},u=t.tokenize.call(l,c);return t.resolveAll&&a.push(t),l;function d(e){return o=KZ(o,e),g(),o[o.length-1]===null?(w(t,0),l.events=dQ(a,l.events,l),l.events):[]}function f(e,t){return FJe(p(e),t)}function p(e){return PJe(o,e)}function m(){let{_bufferIndex:e,_index:t,line:n,column:i,offset:a}=r;return{_bufferIndex:e,_index:t,line:n,column:i,offset:a}}function h(e){i[e.line]=e.column,E()}function g(){let e;for(;r._index<o.length;){let t=o[r._index];if(typeof t==`string`)for(e=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===e&&r._bufferIndex<t.length;)_(t.charCodeAt(r._bufferIndex));else _(t)}}function _(e){u=u(e)}function v(e){tQ(e)?(r.line++,r.column=1,r.offset+=e===-3?2:1,E()):e!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),l.previous=e}function y(e,t){let n=t||{};return n.type=e,n.start=m(),l.events.push([`enter`,n,l]),s.push(n),n}function b(e){let t=s.pop();return t.end=m(),l.events.push([`exit`,t,l]),t}function x(e,t){w(e,t.from)}function S(e,t){t.restore()}function C(e,t){return n;function n(n,r,i){let a,o,s,u;return Array.isArray(n)?f(n):`tokenize`in n?f([n]):d(n);function d(e){return t;function t(t){let n=t!==null&&e[t],r=t!==null&&e.null;return f([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(t)}}function f(e){return a=e,o=0,e.length===0?i:p(e[o])}function p(e){return n;function n(n){return u=T(),s=e,e.partial||(l.currentConstruct=e),e.name&&l.parser.constructs.disable.null.includes(e.name)?h(n):e.tokenize.call(t?Object.assign(Object.create(l),t):l,c,m,h)(n)}}function m(t){return e(s,u),r}function h(e){return u.restore(),++o<a.length?p(a[o]):i}}}function w(e,t){e.resolveAll&&!a.includes(e)&&a.push(e),e.resolve&&GZ(l.events,t,l.events.length-t,e.resolve(l.events.slice(t),l)),e.resolveTo&&(l.events=e.resolveTo(l.events,l))}function T(){let e=m(),t=l.previous,n=l.currentConstruct,i=l.events.length,a=Array.from(s);return{from:i,restore:o};function o(){r=e,l.previous=t,l.currentConstruct=n,l.events.length=i,s=a,E()}}function E(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function PJe(e,t){let n=t.start._index,r=t.start._bufferIndex,i=t.end._index,a=t.end._bufferIndex,o;if(n===i)o=[e[n].slice(r,a)];else{if(o=e.slice(n,i),r>-1){let e=o[0];typeof e==`string`?o[0]=e.slice(r):o.shift()}a>0&&o.push(e[i].slice(0,a))}return o}function FJe(e,t){let n=-1,r=[],i;for(;++n<e.length;){let a=e[n],o;if(typeof a==`string`)o=a;else switch(a){case-5:o=`\r`;break;case-4:o=`
`;break;case-3:o=`\r
`;break;case-2:o=t?` `:`	`;break;case-1:if(!t&&i)continue;o=` `;break;default:o=String.fromCharCode(a)}i=a===-2,r.push(o)}return r.join(``)}function IJe(e){let t={constructs:JZ([CJe,...(e||{}).extensions||[]]),content:n(LKe),defined:[],document:n(zKe),flow:n(hJe),lazy:{},string:n(vJe),text:n(yJe)};return t;function n(e){return n;function n(n){return NJe(t,e,n)}}}function LJe(e){for(;!mqe(e););return e}var RJe=/[\0\t\n\r]/g;function zJe(){let e=1,t=``,n=!0,r;return i;function i(i,a,o){let s=[],c,l,u,d,f;for(i=t+(typeof i==`string`?i.toString():new TextDecoder(a||void 0).decode(i)),u=0,t=``,n&&=(i.charCodeAt(0)===65279&&u++,void 0);u<i.length;){if(RJe.lastIndex=u,c=RJe.exec(i),d=c&&c.index!==void 0?c.index:i.length,f=i.charCodeAt(d),!c){t=i.slice(u);break}if(f===10&&u===d&&r)s.push(-3),r=void 0;else switch(r&&=(s.push(-5),void 0),u<d&&(s.push(i.slice(u,d)),e+=d-u),f){case 0:s.push(65533),e++;break;case 9:for(l=Math.ceil(e/4)*4,s.push(-2);e++<l;)s.push(-1);break;case 10:s.push(-4),e=1;break;default:r=!0,e=1}u=d+1}return o&&(r&&s.push(-5),t&&s.push(t),s.push(null)),s}}var BJe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function VJe(e){return e.replace(BJe,HJe)}function HJe(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){let e=n.charCodeAt(1),t=e===120||e===88;return YZ(n.slice(t?2:1),t?16:10)}return WZ(n)||e}var UJe={}.hasOwnProperty;function WJe(e,t,n){return typeof t!=`string`&&(n=t,t=void 0),GJe(n)(LJe(IJe(n).document().write(zJe()(e,t,!0))))}function GJe(e){let t={transforms:[],canContainEols:[`emphasis`,`fragment`,`heading`,`paragraph`,`strong`],enter:{autolink:a(be),autolinkProtocol:T,autolinkEmail:T,atxHeading:a(ge),blockQuote:a(de),characterEscape:T,characterReference:T,codeFenced:a(fe),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:a(fe,o),codeText:a(pe,o),codeTextData:T,data:T,codeFlowValue:T,definition:a(me),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:a(he),hardBreakEscape:a(_e),hardBreakTrailing:a(_e),htmlFlow:a(ve,o),htmlFlowData:T,htmlText:a(ve,o),htmlTextData:T,image:a(ye),label:o,link:a(be),listItem:a(Se),listItemValue:f,listOrdered:a(xe,d),listUnordered:a(xe),paragraph:a(Ce),reference:ie,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:a(ge),strong:a(we),thematicBreak:a(Ee)},exit:{atxHeading:c(),atxHeadingSequence:x,autolink:c(),autolinkEmail:ue,autolinkProtocol:le,blockQuote:c(),characterEscapeValue:E,characterReferenceMarkerHexadecimal:oe,characterReferenceMarkerNumeric:oe,characterReferenceValue:se,characterReference:ce,codeFenced:c(g),codeFencedFence:h,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:E,codeIndented:c(_),codeText:c(j),codeTextData:E,data:E,definition:c(),definitionDestinationString:b,definitionLabelString:v,definitionTitleString:y,emphasis:c(),hardBreakEscape:c(O),hardBreakTrailing:c(O),htmlFlow:c(k),htmlFlowData:E,htmlText:c(A),htmlTextData:E,image:c(N),label:te,labelText:ee,lineEnding:D,link:c(M),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:ae,resourceDestinationString:P,resourceTitleString:ne,resource:re,setextHeading:c(w),setextHeadingLineSequence:C,setextHeadingText:S,strong:c(),thematicBreak:c()}};KJe(t,(e||{}).mdastExtensions||[]);let n={};return r;function r(e){let r={type:`root`,children:[]},a={stack:[r],tokenStack:[],config:t,enter:s,exit:l,buffer:o,resume:u,data:n},c=[],d=-1;for(;++d<e.length;)(e[d][1].type===`listOrdered`||e[d][1].type===`listUnordered`)&&(e[d][0]===`enter`?c.push(d):d=i(e,c.pop(),d));for(d=-1;++d<e.length;){let n=t[e[d][0]];UJe.call(n,e[d][1].type)&&n[e[d][1].type].call(Object.assign({sliceSerialize:e[d][2].sliceSerialize},a),e[d][1])}if(a.tokenStack.length>0){let e=a.tokenStack[a.tokenStack.length-1];(e[1]||JJe).call(a,void 0,e[0])}for(r.position={start:xQ(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:xQ(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},d=-1;++d<t.transforms.length;)r=t.transforms[d](r)||r;return r}function i(e,t,n){let r=t-1,i=-1,a=!1,o,s,c,l;for(;++r<=n;){let t=e[r];switch(t[1].type){case`listUnordered`:case`listOrdered`:case`blockQuote`:t[0]===`enter`?i++:i--,l=void 0;break;case`lineEndingBlank`:t[0]===`enter`&&(o&&!l&&!i&&!c&&(c=r),l=void 0);break;case`linePrefix`:case`listItemValue`:case`listItemMarker`:case`listItemPrefix`:case`listItemPrefixWhitespace`:break;default:l=void 0}if(!i&&t[0]===`enter`&&t[1].type===`listItemPrefix`||i===-1&&t[0]===`exit`&&(t[1].type===`listUnordered`||t[1].type===`listOrdered`)){if(o){let i=r;for(s=void 0;i--;){let t=e[i];if(t[1].type===`lineEnding`||t[1].type===`lineEndingBlank`){if(t[0]===`exit`)continue;s&&(e[s][1].type=`lineEndingBlank`,a=!0),t[1].type=`lineEnding`,s=i}else if(!(t[1].type===`linePrefix`||t[1].type===`blockQuotePrefix`||t[1].type===`blockQuotePrefixWhitespace`||t[1].type===`blockQuoteMarker`||t[1].type===`listItemIndent`))break}c&&(!s||c<s)&&(o._spread=!0),o.end=Object.assign({},s?e[s][1].start:t[1].end),e.splice(s||r,0,[`exit`,o,t[2]]),r++,n++}if(t[1].type===`listItemPrefix`){let i={type:`listItem`,_spread:!1,start:Object.assign({},t[1].start),end:void 0};o=i,e.splice(r,0,[`enter`,i,t[2]]),r++,n++,c=void 0,l=!0}}}return e[t][1]._spread=a,n}function a(e,t){return n;function n(n){s.call(this,e(n),n),t&&t.call(this,n)}}function o(){this.stack.push({type:`fragment`,children:[]})}function s(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:xQ(t.start),end:void 0}}function c(e){return t;function t(t){e&&e.call(this,t),l.call(this,t)}}function l(e,t){let n=this.stack.pop(),r=this.tokenStack.pop();if(r)r[0].type!==e.type&&(t?t.call(this,e,r[0]):(r[1]||JJe).call(this,e,r[0]));else throw Error("Cannot close `"+e.type+"` ("+EZ({start:e.start,end:e.end})+`): its not open`);n.position.end=xQ(e.end)}function u(){return BZ(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f(e){if(this.data.expectingFirstListItemValue){let t=this.stack[this.stack.length-2];t.start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0}}function p(){let e=this.resume(),t=this.stack[this.stack.length-1];t.lang=e}function m(){let e=this.resume(),t=this.stack[this.stack.length-1];t.meta=e}function h(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function g(){let e=this.resume(),t=this.stack[this.stack.length-1];t.value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,``),this.data.flowCodeInside=void 0}function _(){let e=this.resume(),t=this.stack[this.stack.length-1];t.value=e.replace(/(\r?\n|\r)$/g,``)}function v(e){let t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=XZ(this.sliceSerialize(e)).toLowerCase()}function y(){let e=this.resume(),t=this.stack[this.stack.length-1];t.title=e}function b(){let e=this.resume(),t=this.stack[this.stack.length-1];t.url=e}function x(e){let t=this.stack[this.stack.length-1];t.depth||=this.sliceSerialize(e).length}function S(){this.data.setextHeadingSlurpLineEnding=!0}function C(e){let t=this.stack[this.stack.length-1];t.depth=this.sliceSerialize(e).codePointAt(0)===61?1:2}function w(){this.data.setextHeadingSlurpLineEnding=void 0}function T(e){let t=this.stack[this.stack.length-1].children,n=t[t.length-1];(!n||n.type!==`text`)&&(n=Te(),n.position={start:xQ(e.start),end:void 0},t.push(n)),this.stack.push(n)}function E(e){let t=this.stack.pop();t.value+=this.sliceSerialize(e),t.position.end=xQ(e.end)}function D(e){let n=this.stack[this.stack.length-1];if(this.data.atHardBreak){let t=n.children[n.children.length-1];t.position.end=xQ(e.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(T.call(this,e),E.call(this,e))}function O(){this.data.atHardBreak=!0}function k(){let e=this.resume(),t=this.stack[this.stack.length-1];t.value=e}function A(){let e=this.resume(),t=this.stack[this.stack.length-1];t.value=e}function j(){let e=this.resume(),t=this.stack[this.stack.length-1];t.value=e}function M(){let e=this.stack[this.stack.length-1];if(this.data.inReference){let t=this.data.referenceType||`shortcut`;e.type+=`Reference`,e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function N(){let e=this.stack[this.stack.length-1];if(this.data.inReference){let t=this.data.referenceType||`shortcut`;e.type+=`Reference`,e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function ee(e){let t=this.sliceSerialize(e),n=this.stack[this.stack.length-2];n.label=VJe(t),n.identifier=XZ(t).toLowerCase()}function te(){let e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1];this.data.inReference=!0,n.type===`link`?n.children=e.children:n.alt=t}function P(){let e=this.resume(),t=this.stack[this.stack.length-1];t.url=e}function ne(){let e=this.resume(),t=this.stack[this.stack.length-1];t.title=e}function re(){this.data.inReference=void 0}function ie(){this.data.referenceType=`collapsed`}function ae(e){let t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=XZ(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType=`full`}function oe(e){this.data.characterReferenceType=e.type}function se(e){let t=this.sliceSerialize(e),n=this.data.characterReferenceType,r;n?(r=YZ(t,n===`characterReferenceMarkerNumeric`?10:16),this.data.characterReferenceType=void 0):r=WZ(t);let i=this.stack[this.stack.length-1];i.value+=r}function ce(e){let t=this.stack.pop();t.position.end=xQ(e.end)}function le(e){E.call(this,e);let t=this.stack[this.stack.length-1];t.url=this.sliceSerialize(e)}function ue(e){E.call(this,e);let t=this.stack[this.stack.length-1];t.url=`mailto:`+this.sliceSerialize(e)}function de(){return{type:`blockquote`,children:[]}}function fe(){return{type:`code`,lang:null,meta:null,value:``}}function pe(){return{type:`inlineCode`,value:``}}function me(){return{type:`definition`,identifier:``,label:null,title:null,url:``}}function he(){return{type:`emphasis`,children:[]}}function ge(){return{type:`heading`,depth:0,children:[]}}function _e(){return{type:`break`}}function ve(){return{type:`html`,value:``}}function ye(){return{type:`image`,title:null,url:``,alt:null}}function be(){return{type:`link`,title:null,url:``,children:[]}}function xe(e){return{type:`list`,ordered:e.type===`listOrdered`,start:null,spread:e._spread,children:[]}}function Se(e){return{type:`listItem`,spread:e._spread,checked:null,children:[]}}function Ce(){return{type:`paragraph`,children:[]}}function we(){return{type:`strong`,children:[]}}function Te(){return{type:`text`,value:``}}function Ee(){return{type:`thematicBreak`}}}function xQ(e){return{line:e.line,column:e.column,offset:e.offset}}function KJe(e,t){let n=-1;for(;++n<t.length;){let r=t[n];Array.isArray(r)?KJe(e,r):qJe(e,r)}}function qJe(e,t){let n;for(n in t)if(UJe.call(t,n))switch(n){case`canContainEols`:{let r=t[n];r&&e[n].push(...r);break}case`transforms`:{let r=t[n];r&&e[n].push(...r);break}case`enter`:case`exit`:{let r=t[n];r&&Object.assign(e[n],r);break}}}function JJe(e,t){throw e?Error("Cannot close `"+e.type+"` ("+EZ({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+EZ({start:t.start,end:t.end})+`) is open`):Error("Cannot close document, a token (`"+t.type+"`, "+EZ({start:t.start,end:t.end})+`) is still open`)}function YJe(e){let t=this;t.parser=n;function n(n){return WJe(n,{...t.data(`settings`),...e,extensions:t.data(`micromarkExtensions`)||[],mdastExtensions:t.data(`fromMarkdownExtensions`)||[]})}}function XJe(e,t){let n={type:`element`,tagName:`blockquote`,properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function ZJe(e,t){let n={type:`element`,tagName:`br`,properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:`text`,value:`
`}]}function QJe(e,t){let n=t.value?t.value+`
`:``,r={},i=t.lang?t.lang.split(/\s+/):[];i.length>0&&(r.className=[`language-`+i[0]]);let a={type:`element`,tagName:`code`,properties:r,children:[{type:`text`,value:n}]};return t.meta&&(a.data={meta:t.meta}),e.patch(t,a),a=e.applyData(t,a),a={type:`element`,tagName:`pre`,properties:{},children:[a]},e.patch(t,a),a}function $Je(e,t){let n={type:`element`,tagName:`del`,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function eYe(e,t){let n={type:`element`,tagName:`em`,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function tYe(e,t){let n=typeof e.options.clobberPrefix==`string`?e.options.clobberPrefix:`user-content-`,r=String(t.identifier).toUpperCase(),i=sQ(r.toLowerCase()),a=e.footnoteOrder.indexOf(r),o,s=e.footnoteCounts.get(r);s===void 0?(s=0,e.footnoteOrder.push(r),o=e.footnoteOrder.length):o=a+1,s+=1,e.footnoteCounts.set(r,s);let c={type:`element`,tagName:`a`,properties:{href:`#`+n+`fn-`+i,id:n+`fnref-`+i+(s>1?`-`+s:``),dataFootnoteRef:!0,ariaDescribedBy:[`footnote-label`]},children:[{type:`text`,value:String(o)}]};e.patch(t,c);let l={type:`element`,tagName:`sup`,properties:{},children:[c]};return e.patch(t,l),e.applyData(t,l)}function nYe(e,t){let n={type:`element`,tagName:`h`+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function rYe(e,t){if(e.options.allowDangerousHtml){let n={type:`raw`,value:t.value};return e.patch(t,n),e.applyData(t,n)}}function iYe(e,t){let n=t.referenceType,r=`]`;if(n===`collapsed`?r+=`[]`:n===`full`&&(r+=`[`+(t.label||t.identifier)+`]`),t.type===`imageReference`)return[{type:`text`,value:`![`+t.alt+r}];let i=e.all(t),a=i[0];a&&a.type===`text`?a.value=`[`+a.value:i.unshift({type:`text`,value:`[`});let o=i[i.length-1];return o&&o.type===`text`?o.value+=r:i.push({type:`text`,value:r}),i}function aYe(e,t){let n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return iYe(e,t);let i={src:sQ(r.url||``),alt:t.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);let a={type:`element`,tagName:`img`,properties:i,children:[]};return e.patch(t,a),e.applyData(t,a)}function oYe(e,t){let n={src:sQ(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);let r={type:`element`,tagName:`img`,properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)}function sYe(e,t){let n={type:`text`,value:t.value.replace(/\r?\n|\r/g,` `)};e.patch(t,n);let r={type:`element`,tagName:`code`,properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)}function cYe(e,t){let n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return iYe(e,t);let i={href:sQ(r.url||``)};r.title!==null&&r.title!==void 0&&(i.title=r.title);let a={type:`element`,tagName:`a`,properties:i,children:e.all(t)};return e.patch(t,a),e.applyData(t,a)}function lYe(e,t){let n={href:sQ(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);let r={type:`element`,tagName:`a`,properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function uYe(e,t,n){let r=e.all(t),i=n?dYe(n):fYe(t),a={},o=[];if(typeof t.checked==`boolean`){let e=r[0],n;e&&e.type===`element`&&e.tagName===`p`?n=e:(n={type:`element`,tagName:`p`,properties:{},children:[]},r.unshift(n)),n.children.length>0&&n.children.unshift({type:`text`,value:` `}),n.children.unshift({type:`element`,tagName:`input`,properties:{type:`checkbox`,checked:t.checked,disabled:!0},children:[]}),a.className=[`task-list-item`]}let s=-1;for(;++s<r.length;){let e=r[s];(i||s!==0||e.type!==`element`||e.tagName!==`p`)&&o.push({type:`text`,value:`
`}),e.type===`element`&&e.tagName===`p`&&!i?o.push(...e.children):o.push(e)}let c=r[r.length-1];c&&(i||c.type!==`element`||c.tagName!==`p`)&&o.push({type:`text`,value:`
`});let l={type:`element`,tagName:`li`,properties:a,children:o};return e.patch(t,l),e.applyData(t,l)}function dYe(e){let t=!1;if(e.type===`list`){t=e.spread||!1;let n=e.children,r=-1;for(;!t&&++r<n.length;)t=fYe(n[r])}return t}function fYe(e){return e.spread??e.children.length>1}function pYe(e,t){let n={},r=e.all(t),i=-1;for(typeof t.start==`number`&&t.start!==1&&(n.start=t.start);++i<r.length;){let e=r[i];if(e.type===`element`&&e.tagName===`li`&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes(`task-list-item`)){n.className=[`contains-task-list`];break}}let a={type:`element`,tagName:t.ordered?`ol`:`ul`,properties:n,children:e.wrap(r,!0)};return e.patch(t,a),e.applyData(t,a)}function mYe(e,t){let n={type:`element`,tagName:`p`,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function hYe(e,t){let n={type:`root`,children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function gYe(e,t){let n={type:`element`,tagName:`strong`,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function _Ye(e,t){let n=e.all(t),r=n.shift(),i=[];if(r){let n={type:`element`,tagName:`thead`,properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],n),i.push(n)}if(n.length>0){let r={type:`element`,tagName:`tbody`,properties:{},children:e.wrap(n,!0)},a=wZ(t.children[1]),o=CZ(t.children[t.children.length-1]);a&&o&&(r.position={start:a,end:o}),i.push(r)}let a={type:`element`,tagName:`table`,properties:{},children:e.wrap(i,!0)};return e.patch(t,a),e.applyData(t,a)}function vYe(e,t,n){let r=n?n.children:void 0,i=(r?r.indexOf(t):1)===0?`th`:`td`,a=n&&n.type===`table`?n.align:void 0,o=a?a.length:t.children.length,s=-1,c=[];for(;++s<o;){let n=t.children[s],r={},o=a?a[s]:void 0;o&&(r.align=o);let l={type:`element`,tagName:i,properties:r,children:[]};n&&(l.children=e.all(n),e.patch(n,l),l=e.applyData(n,l)),c.push(l)}let l={type:`element`,tagName:`tr`,properties:{},children:e.wrap(c,!0)};return e.patch(t,l),e.applyData(t,l)}function yYe(e,t){let n={type:`element`,tagName:`td`,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}var bYe=9,xYe=32;function SYe(e){let t=String(e),n=/\r?\n|\r/g,r=n.exec(t),i=0,a=[];for(;r;)a.push(CYe(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t);return a.push(CYe(t.slice(i),i>0,!1)),a.join(``)}function CYe(e,t,n){let r=0,i=e.length;if(t){let t=e.codePointAt(r);for(;t===bYe||t===xYe;)r++,t=e.codePointAt(r)}if(n){let t=e.codePointAt(i-1);for(;t===bYe||t===xYe;)i--,t=e.codePointAt(i-1)}return i>r?e.slice(r,i):``}function wYe(e,t){let n={type:`text`,value:SYe(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function TYe(e,t){let n={type:`element`,tagName:`hr`,properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const EYe={blockquote:XJe,break:ZJe,code:QJe,delete:$Je,emphasis:eYe,footnoteReference:tYe,heading:nYe,html:rYe,imageReference:aYe,image:oYe,inlineCode:sYe,linkReference:cYe,link:lYe,listItem:uYe,list:pYe,paragraph:mYe,root:hYe,strong:gYe,table:_Ye,tableCell:yYe,tableRow:vYe,text:wYe,thematicBreak:TYe,toml:SQ,yaml:SQ,definition:SQ,footnoteDefinition:SQ};function SQ(){}var DYe=typeof self==`object`?self:globalThis,OYe=(e,t)=>{let n=(t,n)=>(e.set(n,t),t),r=i=>{if(e.has(i))return e.get(i);let[a,o]=t[i];switch(a){case 0:case-1:return n(o,i);case 1:{let e=n([],i);for(let t of o)e.push(r(t));return e}case 2:{let e=n({},i);for(let[t,n]of o)e[r(t)]=r(n);return e}case 3:return n(new Date(o),i);case 4:{let{source:e,flags:t}=o;return n(new RegExp(e,t),i)}case 5:{let e=n(new Map,i);for(let[t,n]of o)e.set(r(t),r(n));return e}case 6:{let e=n(new Set,i);for(let t of o)e.add(r(t));return e}case 7:{let{name:e,message:t}=o;return n(new DYe[e](t),i)}case 8:return n(BigInt(o),i);case`BigInt`:return n(Object(BigInt(o)),i);case`ArrayBuffer`:return n(new Uint8Array(o).buffer,o);case`DataView`:{let{buffer:e}=new Uint8Array(o);return n(new DataView(e),o)}}return n(new DYe[a](o),i)};return r};const kYe=e=>OYe(new Map,e)(0);var CQ=``,{toString:AYe}={},{keys:jYe}=Object,wQ=e=>{let t=typeof e;if(t!==`object`||!e)return[0,t];let n=AYe.call(e).slice(8,-1);switch(n){case`Array`:return[1,CQ];case`Object`:return[2,CQ];case`Date`:return[3,CQ];case`RegExp`:return[4,CQ];case`Map`:return[5,CQ];case`Set`:return[6,CQ];case`DataView`:return[1,n]}return n.includes(`Array`)?[1,n]:n.includes(`Error`)?[7,n]:[2,n]},TQ=([e,t])=>e===0&&(t===`function`||t===`symbol`),MYe=(e,t,n,r)=>{let i=(e,t)=>{let i=r.push(e)-1;return n.set(t,i),i},a=r=>{if(n.has(r))return n.get(r);let[o,s]=wQ(r);switch(o){case 0:{let t=r;switch(s){case`bigint`:o=8,t=r.toString();break;case`function`:case`symbol`:if(e)throw TypeError(`unable to serialize `+s);t=null;break;case`undefined`:return i([-1],r)}return i([o,t],r)}case 1:{if(s){let e=r;return s===`DataView`?e=new Uint8Array(r.buffer):s===`ArrayBuffer`&&(e=new Uint8Array(r)),i([s,[...e]],r)}let e=[],t=i([o,e],r);for(let t of r)e.push(a(t));return t}case 2:{if(s)switch(s){case`BigInt`:return i([s,r.toString()],r);case`Boolean`:case`Number`:case`String`:return i([s,r.valueOf()],r)}if(t&&`toJSON`in r)return a(r.toJSON());let n=[],c=i([o,n],r);for(let t of jYe(r))(e||!TQ(wQ(r[t])))&&n.push([a(t),a(r[t])]);return c}case 3:return i([o,r.toISOString()],r);case 4:{let{source:e,flags:t}=r;return i([o,{source:e,flags:t}],r)}case 5:{let t=[],n=i([o,t],r);for(let[n,i]of r)(e||!(TQ(wQ(n))||TQ(wQ(i))))&&t.push([a(n),a(i)]);return n}case 6:{let t=[],n=i([o,t],r);for(let n of r)(e||!TQ(wQ(n)))&&t.push(a(n));return n}}let{message:c}=r;return i([o,{name:s,message:c}],r)};return a};const NYe=(e,{json:t,lossy:n}={})=>{let r=[];return MYe(!(t||n),!!t,new Map,r)(e),r};var EQ=typeof structuredClone==`function`?(e,t)=>t&&(`json`in t||`lossy`in t)?kYe(NYe(e,t)):structuredClone(e):(e,t)=>kYe(NYe(e,t));function PYe(e,t){let n=[{type:`text`,value:``}];return t>1&&n.push({type:`element`,tagName:`sup`,properties:{},children:[{type:`text`,value:String(t)}]}),n}function FYe(e,t){return`Back to reference `+(e+1)+(t>1?`-`+t:``)}function IYe(e){let t=typeof e.options.clobberPrefix==`string`?e.options.clobberPrefix:`user-content-`,n=e.options.footnoteBackContent||PYe,r=e.options.footnoteBackLabel||FYe,i=e.options.footnoteLabel||`Footnotes`,a=e.options.footnoteLabelTagName||`h2`,o=e.options.footnoteLabelProperties||{className:[`sr-only`]},s=[],c=-1;for(;++c<e.footnoteOrder.length;){let i=e.footnoteById.get(e.footnoteOrder[c]);if(!i)continue;let a=e.all(i),o=String(i.identifier).toUpperCase(),l=sQ(o.toLowerCase()),u=0,d=[],f=e.footnoteCounts.get(o);for(;f!==void 0&&++u<=f;){d.length>0&&d.push({type:`text`,value:` `});let e=typeof n==`string`?n:n(c,u);typeof e==`string`&&(e={type:`text`,value:e}),d.push({type:`element`,tagName:`a`,properties:{href:`#`+t+`fnref-`+l+(u>1?`-`+u:``),dataFootnoteBackref:``,ariaLabel:typeof r==`string`?r:r(c,u),className:[`data-footnote-backref`]},children:Array.isArray(e)?e:[e]})}let p=a[a.length-1];if(p&&p.type===`element`&&p.tagName===`p`){let e=p.children[p.children.length-1];e&&e.type===`text`?e.value+=` `:p.children.push({type:`text`,value:` `}),p.children.push(...d)}else a.push(...d);let m={type:`element`,tagName:`li`,properties:{id:t+`fn-`+l},children:e.wrap(a,!0)};e.patch(i,m),s.push(m)}if(s.length!==0)return{type:`element`,tagName:`section`,properties:{dataFootnotes:!0,className:[`footnotes`]},children:[{type:`element`,tagName:a,properties:{...EQ(o),id:`footnote-label`},children:[{type:`text`,value:i}]},{type:`text`,value:`
`},{type:`element`,tagName:`ol`,properties:{},children:e.wrap(s,!0)},{type:`text`,value:`
`}]}}const DQ=(function(e){if(e==null)return BYe;if(typeof e==`function`)return OQ(e);if(typeof e==`object`)return Array.isArray(e)?LYe(e):RYe(e);if(typeof e==`string`)return zYe(e);throw Error(`Expected function, string, or object as test`)});function LYe(e){let t=[],n=-1;for(;++n<e.length;)t[n]=DQ(e[n]);return OQ(r);function r(...e){let n=-1;for(;++n<t.length;)if(t[n].apply(this,e))return!0;return!1}}function RYe(e){let t=e;return OQ(n);function n(n){let r=n,i;for(i in e)if(r[i]!==t[i])return!1;return!0}}function zYe(e){return OQ(t);function t(t){return t&&t.type===e}}function OQ(e){return t;function t(t,n,r){return!!(VYe(t)&&e.call(this,t,typeof n==`number`?n:void 0,r||void 0))}}function BYe(){return!0}function VYe(e){return typeof e==`object`&&!!e&&`type`in e}function HYe(e){return e}var UYe=[];function WYe(e,t,n,r){let i;typeof t==`function`&&typeof n!=`function`?(r=n,n=t):i=t;let a=DQ(i),o=r?-1:1;s(e,void 0,[])();function s(e,i,c){let l=e&&typeof e==`object`?e:{};if(typeof l.type==`string`){let t=typeof l.tagName==`string`?l.tagName:typeof l.name==`string`?l.name:void 0;Object.defineProperty(u,`name`,{value:`node (`+HYe(e.type+(t?`<`+t+`>`:``))+`)`})}return u;function u(){let l=UYe,u,d,f;if((!t||a(e,i,c[c.length-1]||void 0))&&(l=GYe(n(e,c)),l[0]===!1))return l;if(`children`in e&&e.children){let t=e;if(t.children&&l[0]!==`skip`)for(d=(r?t.children.length:-1)+o,f=c.concat(t);d>-1&&d<t.children.length;){let e=t.children[d];if(u=s(e,d,f)(),u[0]===!1)return u;d=typeof u[1]==`number`?u[1]:d+o}}return l}}}function GYe(e){return Array.isArray(e)?e:typeof e==`number`?[!0,e]:e==null?UYe:[e]}function kQ(e,t,n,r){let i,a,o;typeof t==`function`&&typeof n!=`function`?(a=void 0,o=t,i=n):(a=t,o=n,i=r),WYe(e,a,s,i);function s(e,t){let n=t[t.length-1],r=n?n.children.indexOf(e):void 0;return o(e,r,n)}}var AQ={}.hasOwnProperty,KYe={};function qYe(e,t){let n=t||KYe,r=new Map,i=new Map,a={all:s,applyData:YYe,definitionById:r,footnoteById:i,footnoteCounts:new Map,footnoteOrder:[],handlers:{...EYe,...n.handlers},one:o,options:n,patch:JYe,wrap:ZYe};return kQ(e,function(e){if(e.type===`definition`||e.type===`footnoteDefinition`){let t=e.type===`definition`?r:i,n=String(e.identifier).toUpperCase();t.has(n)||t.set(n,e)}}),a;function o(e,t){let n=e.type,r=a.handlers[n];if(AQ.call(a.handlers,n)&&r)return r(a,e,t);if(a.options.passThrough&&a.options.passThrough.includes(n)){if(`children`in e){let{children:t,...n}=e,r=EQ(n);return r.children=a.all(e),r}return EQ(e)}return(a.options.unknownHandler||XYe)(a,e,t)}function s(e){let t=[];if(`children`in e){let n=e.children,r=-1;for(;++r<n.length;){let i=a.one(n[r],e);if(i){if(r&&n[r-1].type===`break`&&(!Array.isArray(i)&&i.type===`text`&&(i.value=QYe(i.value)),!Array.isArray(i)&&i.type===`element`)){let e=i.children[0];e&&e.type===`text`&&(e.value=QYe(e.value))}Array.isArray(i)?t.push(...i):t.push(i)}}}return t}}function JYe(e,t){e.position&&(t.position=cKe(e))}function YYe(e,t){let n=t;if(e&&e.data){let t=e.data.hName,r=e.data.hChildren,i=e.data.hProperties;typeof t==`string`&&(n.type===`element`?n.tagName=t:n={type:`element`,tagName:t,properties:{},children:`children`in n?n.children:[n]}),n.type===`element`&&i&&Object.assign(n.properties,EQ(i)),`children`in n&&n.children&&r!=null&&(n.children=r)}return n}function XYe(e,t){let n=t.data||{},r=`value`in t&&!(AQ.call(n,`hProperties`)||AQ.call(n,`hChildren`))?{type:`text`,value:t.value}:{type:`element`,tagName:`div`,properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function ZYe(e,t){let n=[],r=-1;for(t&&n.push({type:`text`,value:`
`});++r<e.length;)r&&n.push({type:`text`,value:`
`}),n.push(e[r]);return t&&e.length>0&&n.push({type:`text`,value:`
`}),n}function QYe(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function $Ye(e,t){let n=qYe(e,t),r=n.one(e,void 0),i=IYe(n),a=Array.isArray(r)?{type:`root`,children:r}:r||{type:`root`,children:[]};return i&&(`children`in a,a.children.push({type:`text`,value:`
`},i)),a}function eXe(e,t){return e&&`run`in e?async function(n,r){let i=$Ye(n,{file:r,...t});await e.run(i,r)}:function(n,r){return $Ye(n,{file:r,...e||t})}}function tXe(e){if(e)throw e}var nXe=o(((e,t)=>{var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=Object.defineProperty,a=Object.getOwnPropertyDescriptor,o=function(e){return typeof Array.isArray==`function`?Array.isArray(e):r.call(e)===`[object Array]`},s=function(e){if(!e||r.call(e)!==`[object Object]`)return!1;var t=n.call(e,`constructor`),i=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,`isPrototypeOf`);if(e.constructor&&!t&&!i)return!1;for(var a in e);return a===void 0||n.call(e,a)},c=function(e,t){i&&t.name===`__proto__`?i(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,t){if(t===`__proto__`)if(n.call(e,t)){if(a)return a(e,t).value}else return;return e[t]};t.exports=function e(){var t,n,r,i,a,u,d=arguments[0],f=1,p=arguments.length,m=!1;for(typeof d==`boolean`&&(m=d,d=arguments[1]||{},f=2),(d==null||typeof d!=`object`&&typeof d!=`function`)&&(d={});f<p;++f)if(t=arguments[f],t!=null)for(n in t)r=l(d,n),i=l(t,n),d!==i&&(m&&i&&(s(i)||(a=o(i)))?(a?(a=!1,u=r&&o(r)?r:[]):u=r&&s(r)?r:{},c(d,{name:n,newValue:e(m,u,i)})):i!==void 0&&c(d,{name:n,newValue:i}));return d}}));function jQ(e){if(typeof e!=`object`||!e)return!1;let t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function rXe(){let e=[],t={run:n,use:r};return t;function n(...t){let n=-1,r=t.pop();if(typeof r!=`function`)throw TypeError(`Expected function as last argument, not `+r);i(null,...t);function i(a,...o){let s=e[++n],c=-1;if(a){r(a);return}for(;++c<t.length;)(o[c]===null||o[c]===void 0)&&(o[c]=t[c]);t=o,s?iXe(s,i)(...o):r(null,...o)}}function r(n){if(typeof n!=`function`)throw TypeError("Expected `middelware` to be a function, not "+n);return e.push(n),t}}function iXe(e,t){let n;return r;function r(...t){let r=e.length>t.length,o;r&&t.push(i);try{o=e.apply(this,t)}catch(e){let t=e;if(r&&n)throw t;return i(t)}r||(o&&o.then&&typeof o.then==`function`?o.then(a,i):o instanceof Error?i(o):a(o))}function i(e,...r){n||(n=!0,t(e,...r))}function a(e){i(null,e)}}const MQ={basename:aXe,dirname:oXe,extname:sXe,join:cXe,sep:`/`};function aXe(e,t){if(t!==void 0&&typeof t!=`string`)throw TypeError(`"ext" argument must be a string`);NQ(e);let n=0,r=-1,i=e.length,a;if(t===void 0||t.length===0||t.length>e.length){for(;i--;)if(e.codePointAt(i)===47){if(a){n=i+1;break}}else r<0&&(a=!0,r=i+1);return r<0?``:e.slice(n,r)}if(t===e)return``;let o=-1,s=t.length-1;for(;i--;)if(e.codePointAt(i)===47){if(a){n=i+1;break}}else o<0&&(a=!0,o=i+1),s>-1&&(e.codePointAt(i)===t.codePointAt(s--)?s<0&&(r=i):(s=-1,r=o));return n===r?r=o:r<0&&(r=e.length),e.slice(n,r)}function oXe(e){if(NQ(e),e.length===0)return`.`;let t=-1,n=e.length,r;for(;--n;)if(e.codePointAt(n)===47){if(r){t=n;break}}else r||=!0;return t<0?e.codePointAt(0)===47?`/`:`.`:t===1&&e.codePointAt(0)===47?`//`:e.slice(0,t)}function sXe(e){NQ(e);let t=e.length,n=-1,r=0,i=-1,a=0,o;for(;t--;){let s=e.codePointAt(t);if(s===47){if(o){r=t+1;break}continue}n<0&&(o=!0,n=t+1),s===46?i<0?i=t:a!==1&&(a=1):i>-1&&(a=-1)}return i<0||n<0||a===0||a===1&&i===n-1&&i===r+1?``:e.slice(i,n)}function cXe(...e){let t=-1,n;for(;++t<e.length;)NQ(e[t]),e[t]&&(n=n===void 0?e[t]:n+`/`+e[t]);return n===void 0?`.`:lXe(n)}function lXe(e){NQ(e);let t=e.codePointAt(0)===47,n=uXe(e,!t);return n.length===0&&!t&&(n=`.`),n.length>0&&e.codePointAt(e.length-1)===47&&(n+=`/`),t?`/`+n:n}function uXe(e,t){let n=``,r=0,i=-1,a=0,o=-1,s,c;for(;++o<=e.length;){if(o<e.length)s=e.codePointAt(o);else if(s===47)break;else s=47;if(s===47){if(!(i===o-1||a===1))if(i!==o-1&&a===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf(`/`),c!==n.length-1){c<0?(n=``,r=0):(n=n.slice(0,c),r=n.length-1-n.lastIndexOf(`/`)),i=o,a=0;continue}}else if(n.length>0){n=``,r=0,i=o,a=0;continue}}t&&(n=n.length>0?n+`/..`:`..`,r=2)}else n.length>0?n+=`/`+e.slice(i+1,o):n=e.slice(i+1,o),r=o-i-1;i=o,a=0}else s===46&&a>-1?a++:a=-1}return n}function NQ(e){if(typeof e!=`string`)throw TypeError(`Path must be a string. Received `+JSON.stringify(e))}const dXe={cwd:fXe};function fXe(){return`/`}function PQ(e){return!!(typeof e==`object`&&e&&`href`in e&&e.href&&`protocol`in e&&e.protocol&&e.auth===void 0)}function pXe(e){if(typeof e==`string`)e=new URL(e);else if(!PQ(e)){let t=TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code=`ERR_INVALID_ARG_TYPE`,t}if(e.protocol!==`file:`){let e=TypeError(`The URL must be of scheme file`);throw e.code=`ERR_INVALID_URL_SCHEME`,e}return mXe(e)}function mXe(e){if(e.hostname!==``){let e=TypeError(`File URL host must be "localhost" or empty on darwin`);throw e.code=`ERR_INVALID_FILE_URL_HOST`,e}let t=e.pathname,n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){let e=t.codePointAt(n+2);if(e===70||e===102){let e=TypeError(`File URL path must not include encoded / characters`);throw e.code=`ERR_INVALID_FILE_URL_PATH`,e}}return decodeURIComponent(t)}var FQ=[`history`,`path`,`basename`,`stem`,`extname`,`dirname`],hXe=class{constructor(e){let t;t=e?PQ(e)?{path:e}:typeof e==`string`||_Xe(e)?{value:e}:e:{},this.cwd=`cwd`in t?``:dXe.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n=-1;for(;++n<FQ.length;){let e=FQ[n];e in t&&t[e]!==void 0&&t[e]!==null&&(this[e]=e===`history`?[...t[e]]:t[e])}let r;for(r in t)FQ.includes(r)||(this[r]=t[r])}get basename(){return typeof this.path==`string`?MQ.basename(this.path):void 0}set basename(e){LQ(e,`basename`),IQ(e,`basename`),this.path=MQ.join(this.dirname||``,e)}get dirname(){return typeof this.path==`string`?MQ.dirname(this.path):void 0}set dirname(e){gXe(this.basename,`dirname`),this.path=MQ.join(e||``,this.basename)}get extname(){return typeof this.path==`string`?MQ.extname(this.path):void 0}set extname(e){if(IQ(e,`extname`),gXe(this.dirname,`extname`),e){if(e.codePointAt(0)!==46)throw Error("`extname` must start with `.`");if(e.includes(`.`,1))throw Error("`extname` cannot contain multiple dots")}this.path=MQ.join(this.dirname,this.stem+(e||``))}get path(){return this.history[this.history.length-1]}set path(e){PQ(e)&&(e=pXe(e)),LQ(e,`path`),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path==`string`?MQ.basename(this.path,this.extname):void 0}set stem(e){LQ(e,`stem`),IQ(e,`stem`),this.path=MQ.join(this.dirname||``,e+(this.extname||``))}fail(e,t,n){let r=this.message(e,t,n);throw r.fatal=!0,r}info(e,t,n){let r=this.message(e,t,n);return r.fatal=void 0,r}message(e,t,n){let r=new AZ(e,t,n);return this.path&&(r.name=this.path+`:`+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return this.value===void 0?``:typeof this.value==`string`?this.value:new TextDecoder(e||void 0).decode(this.value)}};function IQ(e,t){if(e&&e.includes(MQ.sep))throw Error("`"+t+"` cannot be a path: did not expect `"+MQ.sep+"`")}function LQ(e,t){if(!e)throw Error("`"+t+"` cannot be empty")}function gXe(e,t){if(!e)throw Error("Setting `"+t+"` requires `path` to be set too")}function _Xe(e){return!!(e&&typeof e==`object`&&`byteLength`in e&&`byteOffset`in e)}const vXe=(function(e){let t=this.constructor.prototype,n=t[e],r=function(){return n.apply(r,arguments)};return Object.setPrototypeOf(r,t),r});var RQ=l(nXe(),1),yXe={}.hasOwnProperty;const bXe=new class e extends vXe{constructor(){super(`copy`),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=rXe()}copy(){let t=new e,n=-1;for(;++n<this.attachers.length;){let e=this.attachers[n];t.use(...e)}return t.data((0,RQ.default)(!0,{},this.namespace)),t}data(e,t){return typeof e==`string`?arguments.length===2?(VQ(`data`,this.frozen),this.namespace[e]=t,this):yXe.call(this.namespace,e)&&this.namespace[e]||void 0:e?(VQ(`data`,this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;let e=this;for(;++this.freezeIndex<this.attachers.length;){let[t,...n]=this.attachers[this.freezeIndex];if(n[0]===!1)continue;n[0]===!0&&(n[0]=void 0);let r=t.call(e,...n);typeof r==`function`&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=1/0,this}parse(e){this.freeze();let t=HQ(e),n=this.parser||this.Parser;return zQ(`parse`,n),n(String(t),t)}process(e,t){let n=this;return this.freeze(),zQ(`process`,this.parser||this.Parser),BQ(`process`,this.compiler||this.Compiler),t?r(void 0,t):new Promise(r);function r(r,i){let a=HQ(e),o=n.parse(a);n.run(o,a,function(e,t,r){if(e||!t||!r)return s(e);let i=t,a=n.stringify(i,r);wXe(a)?r.value=a:r.result=a,s(e,r)});function s(e,n){e||!n?i(e):r?r(n):t(void 0,n)}}}processSync(e){let t=!1,n;return this.freeze(),zQ(`processSync`,this.parser||this.Parser),BQ(`processSync`,this.compiler||this.Compiler),this.process(e,r),SXe(`processSync`,`process`,t),n;function r(e,r){t=!0,tXe(e),n=r}}run(e,t,n){xXe(e),this.freeze();let r=this.transformers;return!n&&typeof t==`function`&&(n=t,t=void 0),n?i(void 0,n):new Promise(i);function i(i,a){let o=HQ(t);r.run(e,o,s);function s(t,r,o){let s=r||e;t?a(t):i?i(s):n(void 0,s,o)}}}runSync(e,t){let n=!1,r;return this.run(e,t,i),SXe(`runSync`,`run`,n),r;function i(e,t){tXe(e),r=t,n=!0}}stringify(e,t){this.freeze();let n=HQ(t),r=this.compiler||this.Compiler;return BQ(`stringify`,r),xXe(e),r(e,n)}use(e,...t){let n=this.attachers,r=this.namespace;if(VQ(`use`,this.frozen),e!=null)if(typeof e==`function`)s(e,t);else if(typeof e==`object`)Array.isArray(e)?o(e):a(e);else throw TypeError("Expected usable value, not `"+e+"`");return this;function i(e){if(typeof e==`function`)s(e,[]);else if(typeof e==`object`)if(Array.isArray(e)){let[t,...n]=e;s(t,n)}else a(e);else throw TypeError("Expected usable value, not `"+e+"`")}function a(e){if(!(`plugins`in e)&&!(`settings`in e))throw Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(e.plugins),e.settings&&(r.settings=(0,RQ.default)(!0,r.settings,e.settings))}function o(e){let t=-1;if(e!=null)if(Array.isArray(e))for(;++t<e.length;){let n=e[t];i(n)}else throw TypeError("Expected a list of plugins, not `"+e+"`")}function s(e,t){let r=-1,i=-1;for(;++r<n.length;)if(n[r][0]===e){i=r;break}if(i===-1)n.push([e,...t]);else if(t.length>0){let[r,...a]=t,o=n[i][1];jQ(o)&&jQ(r)&&(r=(0,RQ.default)(!0,o,r)),n[i]=[e,r,...a]}}}}().freeze();function zQ(e,t){if(typeof t!=`function`)throw TypeError("Cannot `"+e+"` without `parser`")}function BQ(e,t){if(typeof t!=`function`)throw TypeError("Cannot `"+e+"` without `compiler`")}function VQ(e,t){if(t)throw Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function xXe(e){if(!jQ(e)||typeof e.type!=`string`)throw TypeError("Expected node, got `"+e+"`")}function SXe(e,t,n){if(!n)throw Error("`"+e+"` finished async. Use `"+t+"` instead")}function HQ(e){return CXe(e)?e:new hXe(e)}function CXe(e){return!!(e&&typeof e==`object`&&`message`in e&&`messages`in e)}function wXe(e){return typeof e==`string`||TXe(e)}function TXe(e){return!!(e&&typeof e==`object`&&`byteLength`in e&&`byteOffset`in e)}var EXe=[],DXe={allowDangerousHtml:!0},OXe=/^(https?|ircs?|mailto|xmpp)$/i,kXe=[{from:`astPlugins`,id:`remove-buggy-html-in-markdown-parser`},{from:`allowDangerousHtml`,id:`remove-buggy-html-in-markdown-parser`},{from:`allowNode`,id:`replace-allownode-allowedtypes-and-disallowedtypes`,to:`allowElement`},{from:`allowedTypes`,id:`replace-allownode-allowedtypes-and-disallowedtypes`,to:`allowedElements`},{from:`className`,id:`remove-classname`},{from:`disallowedTypes`,id:`replace-allownode-allowedtypes-and-disallowedtypes`,to:`disallowedElements`},{from:`escapeHtml`,id:`remove-buggy-html-in-markdown-parser`},{from:`includeElementIndex`,id:`#remove-includeelementindex`},{from:`includeNodeIndex`,id:`change-includenodeindex-to-includeelementindex`},{from:`linkTarget`,id:`remove-linktarget`},{from:`plugins`,id:`change-plugins-to-remarkplugins`,to:`remarkPlugins`},{from:`rawSourcePos`,id:`#remove-rawsourcepos`},{from:`renderers`,id:`change-renderers-to-components`,to:`components`},{from:`source`,id:`change-source-to-children`,to:`children`},{from:`sourcePos`,id:`#remove-sourcepos`},{from:`transformImageUri`,id:`#add-urltransform`,to:`urlTransform`},{from:`transformLinkUri`,id:`#add-urltransform`,to:`urlTransform`}];function AXe(e){let t=jXe(e),n=MXe(e);return NXe(t.runSync(t.parse(n),n),e)}function jXe(e){let t=e.rehypePlugins||EXe,n=e.remarkPlugins||EXe,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...DXe}:DXe;return bXe().use(YJe).use(n).use(eXe,r).use(t)}function MXe(e){let t=e.children||``,n=new hXe;return typeof t==`string`?n.value=t:``+t,n}function NXe(e,t){let n=t.allowedElements,r=t.allowElement,i=t.components,a=t.disallowedElements,o=t.skipHtml,s=t.unwrapDisallowed,c=t.urlTransform||PXe;for(let e of kXe)Object.hasOwn(t,e.from)&&``+e.from+(e.to?"use `"+e.to+"` instead":`remove it`)+e.id;return kQ(e,l),mKe(e,{Fragment:I.Fragment,components:i,ignoreInvalidStyle:!0,jsx:I.jsx,jsxs:I.jsxs,passKeys:!0,passNode:!0});function l(e,t,i){if(e.type===`raw`&&i&&typeof t==`number`)return o?i.children.splice(t,1):i.children[t]={type:`text`,value:e.value},t;if(e.type===`element`){let t;for(t in zZ)if(Object.hasOwn(zZ,t)&&Object.hasOwn(e.properties,t)){let n=e.properties[t],r=zZ[t];(r===null||r.includes(e.tagName))&&(e.properties[t]=c(String(n||``),t,e))}}if(e.type===`element`){let o=n?!n.includes(e.tagName):a?a.includes(e.tagName):!1;if(!o&&r&&typeof t==`number`&&(o=!r(e,t,i)),o&&i&&typeof t==`number`)return s&&e.children?i.children.splice(t,1,...e.children):i.children.splice(t,1),t}}}function PXe(e){let t=e.indexOf(`:`),n=e.indexOf(`?`),r=e.indexOf(`#`),i=e.indexOf(`/`);return t===-1||i!==-1&&t>i||n!==-1&&t>n||r!==-1&&t>r||OXe.test(e.slice(0,t))?e:``}const FXe={get defaultTransparency(){return Sq()?`blended`:`wboit`},get preferWebGl1(){return typeof navigator>`u`||typeof window>`u`?!1:[`Version/15.1 Safari`,`Version/15.2 Safari`,`Version/15.3 Safari`].some(e=>navigator.userAgent.indexOf(e)>0)?!0:Sq()}};var IXe=class{toString(){return this.key}valueOf(){return this.key}constructor(e,t){this.key=e,this.defaultValue=t}};function UQ(e,t){return new IXe(e,t)}const WQ={item:UQ,General:{IsBusyTimeoutMs:UQ(`plugin-config.is-busy-timeout`,750),DisableAntialiasing:UQ(`plugin-config.disable-antialiasing`,!1),DisablePreserveDrawingBuffer:UQ(`plugin-config.disable-preserve-drawing-buffer`,!1),PixelScale:UQ(`plugin-config.pixel-scale`,1),PickScale:UQ(`plugin-config.pick-scale`,.25),Transparency:UQ(`plugin-config.transparency`,FXe.defaultTransparency),PreferWebGl1:UQ(`plugin-config.prefer-webgl1`,FXe.preferWebGl1),AllowMajorPerformanceCaveat:UQ(`plugin-config.allow-major-performance-caveat`,!1),PowerPreference:UQ(`plugin-config.power-preference`,`high-performance`),ResolutionMode:UQ(`plugin-config.resolution-mode`,`auto`)},State:{DefaultServer:UQ(`plugin-state.server`,`https://webchem.ncbr.muni.cz/molstar-state`),CurrentServer:UQ(`plugin-state.server`,`https://webchem.ncbr.muni.cz/molstar-state`),HistoryCapacity:UQ(`history-capacity.server`,5)},VolumeStreaming:{Enabled:UQ(`volume-streaming.enabled`,!0),DefaultServer:UQ(`volume-streaming.server`,`https://ds.litemol.org`),CanStream:UQ(`volume-streaming.can-stream`,(e,t)=>e.models.length===1&&DB.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:UQ(`volume-streaming.emdb-header-server`,`https://files.wwpdb.org/pub/emdb/structures`)},Viewport:{ShowReset:UQ(`viewer.show-reset-button`,!0),ShowExpand:UQ(`viewer.show-expand-button`,!0),ShowToggleFullscreen:UQ(`viewer.show-toggle-fullscreen-button`,!0),ShowControls:UQ(`viewer.show-controls-button`,!0),ShowSettings:UQ(`viewer.show-settings-button`,!0),ShowSelectionMode:UQ(`viewer.show-selection-model-button`,!0),ShowAnimation:UQ(`viewer.show-animation-button`,!0),ShowTrajectoryControls:UQ(`viewer.show-trajectory-controls`,!0),ShowScreenshotControls:UQ(`viewer.show-screenshot-controls`,!0),ShowIllumination:UQ(`viewer.show-illumination-button`,!0),ShowXR:UQ(`viewer.show-xr`,`always`)},Download:{DefaultPdbProvider:UQ(`download.default-pdb-provider`,`pdbe`),DefaultEmdbProvider:UQ(`download.default-emdb-provider`,`pdbe`)},Structure:{SizeThresholds:UQ(`structure.size-thresholds`,nB.DefaultSizeThresholds),DefaultRepresentationPreset:UQ(`structure.default-representation-preset`,`auto`),DefaultRepresentationPresetParams:UQ(`structure.default-representation-preset-params`,{}),SaccharideCompIdMapType:UQ(`structure.saccharide-comp-id-map-type`,`default`)},Background:{Styles:UQ(`background.styles`,[])}};var LXe=class{get(e){return this._config.has(e)?this._config.get(e):e.defaultValue}set(e,t){this._config.set(e,t)}delete(e){this._config.delete(e)}constructor(e){this._config=new Map,e&&e.forEach(([e,t])=>this._config.set(e,t))}};function GQ(e,t,n,r){let i=0,{webgl:a}=t,o=new sD,s=new rJ.GeometryState,c=kF(),l=[],u=O$.create(),d,f,p,m,h=oq.createEmpty();function g(e={},g){return g&&g!==f&&(p=n(t,g),f=g,m||=V.getDefaultValues(p)),m=Object.assign({},m,e),hb.create(`Creating or updating ComplexRepresentation`,async e=>{let t=!1;d?d.mustRecreate?.call(d,f,m,a)&&(d.destroy(),d=r(c,f,m,a),t=!0):(d=r(c,f,m,a),t=!0);let n=d.createOrUpdate({webgl:a,runtime:e},h,m,g);n&&await n,t&&x(u),l.length=0,d&&d.renderObject&&(l.push(d.renderObject),s.add(d.renderObject.id,d.geometryVersion)),s.snapshot(),i+=1,o.next(i)})}function _(e){return d?d.getLoci(e):hq}function v(){return[nB.Loci(f.child??f)]}function y(e){d?.eachLocation(e)}function b(e,t){if(!f||!uq.is(u.markerActions,t))return!1;if(nB.isLoci(e)||$.is(e)||fR.isLoci(e)){if(!nB.areRootsEquivalent(e.structure,f))return!1;e=yq.remap(e,f),(nB.isLoci(e)||$.is(e)&&$.isWholeStructure(e))&&(e=pq)}else if(!mq(e)&&!_q(e))return!1;return yq.isEmpty(e)?!1:d?d.mark(e,t):!1}function x(e){if(O$.update(u,e),e.visible!==void 0&&d&&d.setVisibility(e.visible&&(u.unitTransforms===null||u.unitTransforms.isIdentity)),e.alphaFactor!==void 0&&d&&d.setAlphaFactor(e.alphaFactor),e.pickable!==void 0&&d&&d.setPickable(e.pickable),e.overpaint!==void 0&&d){let t=bq.remap(e.overpaint,f);d.setOverpaint(t,a)}if(e.transparency!==void 0&&d){let t=xq.remap(e.transparency,f);d.setTransparency(t,a)}if(e.emissive!==void 0&&d){let t=eJ.remap(e.emissive,f);d.setEmissive(t,a)}if(e.substance!==void 0&&d){let t=$q.remap(e.substance,f);d.setSubstance(t,a)}if(e.clipping!==void 0&&d){let t=Qq.remap(e.clipping,f);d.setClipping(t)}e.themeStrength!==void 0&&d&&d.setThemeStrength(e.themeStrength),e.transform!==void 0&&d&&d.setTransform(e.transform),e.unitTransforms!==void 0&&d&&d.setVisibility(u.visible&&(e.unitTransforms===null||e.unitTransforms.isIdentity))}function S(e){h=e}function C(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return m},get params(){return p},get state(){return u},get theme(){return h},get geometryVersion(){return s.version},renderObjects:l,updated:o,createOrUpdate:g,setState:x,setTheme:S,getLoci:_,getAllLoci:v,eachLocation:y,mark:b,destroy:C}}function KQ(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function RXe(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function qQ(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function JQ(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function YQ(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function zXe(e,t,n){let r=0,i=e.interUnitBonds.getEdgeIndices(n,t.id);for(let t=0,n=i.length;t<n;++t){let n=e.interUnitBonds.edges[i[t]];kI.isCovalent(n.props.flag)&&(r+=1)}return r}function BXe(e,t){let n=0,{offset:r,edgeProps:{flags:i}}=e.bonds;for(let e=r[t],a=r[t+1];e<a;++e)kI.isCovalent(i[e])&&(n+=1);return n}function XQ(e,t,n){return zXe(e,t,n)+BXe(t,n)}function ZQ(e,t,n,r){let i=0;return $Q(e,t,n,(e,t)=>{KQ(e,t)===r&&(i+=1)}),i}function VXe(e,t,n){let{offset:r,b:i,edgeProps:{flags:a}}=e.bonds;kI.is;for(let e=r[t],o=r[t+1];e<o;++e)if(i[e]===n&&kI.isCovalent(a[e]))return!0;return!1}function HXe(e,t,n,r,i){let a=e.interUnitBonds.getEdge(n,t.id,i,r.id);return a&&kI.isCovalent(a.props.flag)}function UXe(e,t,n,r,i){return t===r?VXe(t,n,i):HXe(e,t,n,r,i)}function WXe(e,t,n,r){let i=e.interUnitBonds.getEdgeIndices(n,t.id);for(let t=0,n=i.length;t<n;++t){let n=e.interUnitBonds.edges[i[t]],a=e.unitMap.get(n.unitB);kI.isCovalent(n.props.flag)&&r(a,n.indexB)}}function QQ(e,t,n){let{offset:r,b:i,edgeProps:{flags:a}}=e.bonds;for(let o=r[t],s=r[t+1];o<s;++o)kI.isCovalent(a[o])&&n(e,i[o])}function $Q(e,t,n,r){WXe(e,t,n,r),QQ(t,n,r)}function GXe(e,t,n){return KQ(t,n)===bR.S&&ZQ(e,t,n,bR.O)===3}function KXe(e,t,n){return KQ(t,n)===bR.S&&ZQ(e,t,n,bR.O)===4}function qXe(e,t,n){return KQ(t,n)===bR.P&&ZQ(e,t,n,bR.O)===XQ(e,t,n)}function JXe(e,t,n){let r=0;return KQ(t,n)===bR.C&&ZQ(e,t,n,bR.O)===2&&ZQ(e,t,n,bR.C)===1&&$Q(e,t,n,(t,n)=>{KQ(t,n)===bR.O&&XQ(e,t,n)-ZQ(e,t,n,bR.H)===1&&(r+=1)}),r===2}function YXe(e,t,n){let r=0;return KQ(t,n)===bR.C&&XQ(e,t,n)===3&&ZQ(e,t,n,bR.N)===3&&$Q(e,t,n,(t,n)=>{XQ(e,t,n)-ZQ(e,t,n,bR.H)===1&&(r+=1)}),r===2}function XXe(e,t,n){let r=0;return KQ(t,n)===bR.C&&XQ(e,t,n)===3&&ZQ(e,t,n,bR.N)===2&&ZQ(e,t,n,bR.C)===1&&$Q(e,t,n,(t,n)=>{XQ(e,t,n)-ZQ(e,t,n,bR.H)===1&&(r+=1)}),r===2}var ZXe=new Set([`N`,`O`,`S`,`F`,`CL`,`BR`,`I`]);function QXe(e){return ZXe.has(e)}function $Xe(e,t,n){let r=!1;return $Q(e,t,n,(e,t)=>{QXe(KQ(e,t))&&(r=!0)}),r}var eZe=z.toArray,e$=!1;function t$(e){if(!e)Qy&&!e$&&(console.warn(`WebGL required for "sphere impostors". Falling back to "sphere mesh".`),e$=!0);else if(!e.extensions.fragDepth||!e.extensions.textureFloat){if(Qy&&!e$){let t=[];e.extensions.fragDepth||t.push(`fragDepth`),e.extensions.textureFloat||t.push(`textureFloat`),console.warn(`Missing "${t.join(`", "`)}" extensions required for "sphere impostors". Falling back to "sphere mesh".`),e$=!0}}else return!0;return!1}var n$=!1;function r$(e){if(!e)Qy&&!n$&&(console.warn(`WebGL required for "cylinder impostors". Falling back to "cylinder mesh".`),n$=!0);else if(e.extensions.fragDepth)return!0;else if(Qy&&!n$){let t=[];e.extensions.fragDepth||t.push(`fragDepth`),console.warn(`Missing "${t.join(`", "`)}" extensions required for "cylinder impostors". Falling back to "cylinder mesh".`),n$=!0}return!1}function tZe(e,t,n){let{elements:r,model:i}=t;if(K.indexOf(r,n)!==-1){let{index:a,offsets:o}=i.atomicHierarchy.residueAtomSegments,s=a[n],c=[];for(let e=o[s],t=o[s+1];e<t;++e){let t=K.indexOf(r,e);t!==-1&&c.push(t)}let l=K.ofSortedArray(Vk.ofSortedArray(c));return $(e,[{unit:t,indices:l}])}return hq}function nZe(e,t,n){let{elements:r,model:i}=t,{label_alt_id:a}=i.atomicHierarchy.atoms,o=a.value(n);if(K.indexOf(r,n)!==-1){let{index:r}=i.atomicHierarchy.residueAtomSegments,a=r[n];return i$(e,t,a,o)}return $(e,[])}function i$(e,t,n,r){let{elements:i,model:a}=t,{label_alt_id:o}=a.atomicHierarchy.atoms,{offsets:s}=a.atomicHierarchy.residueAtomSegments,c=[];for(let e=s[n],t=s[n+1];e<t;++e){let t=K.indexOf(i,e);if(t!==-1){let n=o.value(e);(r===n||n===``)&&c.push(t)}}let l=K.ofSortedArray(Vk.ofSortedArray(c));return $(e,[{unit:t,indices:l}])}function rZe(e,t,n,r,i,a){let{child:o}=e.structure,s=t&&o?e.group.units.filter(e=>o.unitMap.has(e.id)):e.group.units,c=s.length,l=c*16,u=a&&a.aTransform.ref.value.length>=l?a.aTransform.ref.value:new Float32Array(l);for(let e=0;e<c;e++)eZe(s[e].conformation.operator.matrix,u,e*16);return lM(u,c,n,r,i,a)}const iZe=V.objectToOptions({atomic:{},spheres:{},gaussians:{}});function aZe(e,t){for(let n=0,r=e.length;n<r;++n)if(Q.isAtomic(t)&&e[n]===`atomic`||Q.isSpheres(t)&&e[n]===`spheres`||Q.isGaussians(t)&&e[n]===`gaussians`)return!0;return!1}var oZe=5e8;function sZe(e,t,n=oZe){let r=$k.size(B(),e);B.ceil(r,r),r.sort((e,t)=>t-e);let i=Math.floor(Math.cbrt(n)*Math.cbrt(n)),a=r[0]*r[1];return{area:a,areaCells:Math.ceil(a/(t*t)),maxAreaCells:i}}function a$(e,t,n=oZe){let{area:r,areaCells:i,maxAreaCells:a}=sZe(e,t.resolution,n),o=i>a?Math.sqrt(r/a):t.resolution;return{...t,resolution:o}}function cZe(e){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicConformation;case Q.Kind.Spheres:return e.model.coarseConformation.spheres;case Q.Kind.Gaussians:return e.model.coarseConformation.gaussians}}const o$={ignoreHydrogens:V.Boolean(!1,{description:`Whether or not to include hydrogen atoms in the surface calculation.`}),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1,{description:`Whether or not to only use trace atoms in the surface calculation.`}),includeParent:V.Boolean(!1,{description:`Include elements of the parent structure in surface calculation to get a surface patch of the current structure.`})};V.getDefaultValues(o$);var lZe=B();function uZe(e,t,n,r){return B.squaredDistance(B.set(lZe,e,t,n),r)}function dZe(e,t,n){let r=0,i=t.length;for(let a=0,o=n.length;a<o;++a){let o=Vk.indexOfInRange(t,n[a],r,i);o===-1?e[a]=-2:(e[a]=o,r=o)}}function s$(e,t,n,r){let{ignoreHydrogens:i,ignoreHydrogensVariant:a,traceOnly:o,includeParent:s}=r,c=s?e.root.unitMap.get(t.id):t,l=s&&c!==t,{x:u,y:d,z:f}=cZe(c),{elements:p}=c,{center:m,radius:h}=t.boundary.sphere,g=(h+11)*(h+11),_,v;if(i||o||l){let t=[],n=[];for(let r=0,s=p.length;r<s;++r){let s=p[r];i&&l$(e,c,s,a)||o&&!u$(c,s)||l&&uZe(u[s],d[s],f[s],m)>g||(t.push(s),n.push(r))}_=Vk.ofSortedArray(t),v=n}else _=p,v=TE(new Int32Array(_.length));s&&c!==t&&dZe(v,t.elements,_);let y={indices:_,x:u,y:d,z:f,id:v},b=l?PR(y):t.boundary,x=iL.create(e,c);return{position:y,boundary:b,radius:e=>(x.element=e,n.size(x))}}function c$(e,t,n){let{ignoreHydrogens:r,ignoreHydrogensVariant:i,traceOnly:a,includeParent:o}=n,s=o&&!!e.parent,c=iL.create(e.root),{center:l,radius:u}=e.boundary.sphere,d=(u+11)*(u+11),f,p,m,h,g,_;if(r||a||s){let{getSerialIndex:n}=e.serialMapping,o=s?e.root.units:e.units,u=[],v=[],y=[],b=[],x=[];for(let f=0,p=o.length;f<p;++f){let p=o[f],{elements:m,conformation:h}=p,g=e.unitMap.get(p.id);c.unit=p;for(let o=0,f=m.length;o<f;++o){let f=m[o];if(r&&l$(e,p,f,i)||a&&!u$(p,f))continue;let _=h.x(f),S=h.y(f),C=h.z(f);s&&uZe(_,S,C,l)>d||(u.push(_),v.push(S),y.push(C),c.element=f,b.push(t.size(c)),s?(g?Vk.indexOf(g.elements,f):-1)===-1?x.push(-2):x.push(n(g,f)):x.push(n(p,f)))}}f=u,p=v,m=y,h=b,g=x,_=K.ofRange(0,g.length)}else{let{elementCount:n}=e,r=new Float32Array(n),i=new Float32Array(n),a=new Float32Array(n),o=new Float32Array(n);for(let n=0,s=0,l=e.units.length;n<l;++n){let l=e.units[n],{elements:u,conformation:d}=l;c.unit=l;for(let e=0,n=u.length;e<n;++e){let n=u[e],l=s+e;r[l]=d.x(n),i[l]=d.y(n),a[l]=d.z(n),c.element=n,o[l]=t.size(c)}s+=u.length}f=r,p=i,m=a,h=o,g=TE(new Uint32Array(n)),_=K.ofRange(0,g.length)}let v={indices:_,x:f,y:p,z:m,id:g};return{position:v,boundary:s?PR(v):e.boundary,radius:e=>h[e]}}var fZe=UI.H;function l$(e,t,n,r){if(Q.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[n]!==fZe)return!1;if(r===`all`)return!0;let i=$Xe(e,t,Vk.indexOf(t.elements,n));return!!(i&&r===`polar`||!i&&r===`non-polar`)}function u$(e,t){if(Q.isCoarse(e))return!0;let n=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return n===`CA`||n===`BB`||n===`P`}function d$(e){return V.MultiSelect(e,iZe,{description:`For which kinds of units/chains to show the representation visuals.`})}const f$={unitKinds:d$([`atomic`,`spheres`]),includeParent:V.Boolean(!1,{isHidden:!0})},pZe={...HM.Params},mZe={...HP.Params},hZe={...CF.Params},gZe={...iP.Params},_Ze={...vP.Params},vZe={...uP.Params},yZe={...VP.Params},bZe={...UP.Params},xZe={...SF.Params};function SZe(e,t,n,r,i,a){let{createValues:o,createRenderableState:s}=wF.getUtils(t),c=o(t,dM(),n,r,i),l=s(i);return AF(t.kind,c,l,a)}function p$(e,t){let{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:a,eachLocation:o,setUpdateState:s,mustRecreate:c,processValues:l,dispose:u}=e,{updateValues:d,updateBoundingSphere:f,updateRenderableState:p,createPositionIterator:m}=e.geometryUtils,h=Cq.create(),g={loci:hq,action:lq.None,status:-1},_,v,y,b,x=Object.assign({},n),S=oq.createEmpty(),C,w,T=-1,E,D;function O(e,t,n){if(!n&&!C)throw Error(`missing structure`);if(v=Object.assign({},x,t),y=e,b=n,Cq.reset(h),!_||!C){h.createNew=!0,h.createGeometry=!0;return}s(h,v,x,y,S,b,C),nB.areEquivalent(b,C)||(h.createGeometry=!0),nB.areHierarchiesEqual(b,C)||(h.updateTransform=!0,h.createGeometry=!0),YK.areEqual(e.color,S.color)||(h.updateColor=!0),aq.areEqual(e.size,S.size)||(h.updateSize=!0),Tx(v.unitKinds,x.unitKinds)||(h.createGeometry=!0),C.child!==b.child&&(h.createGeometry=!0,h.updateTransform=!0),v.instanceGranularity!==x.instanceGranularity&&(h.updateTransform=!0),h.updateSize&&!(`uSize`in _.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}function k(e){if(h.createNew)if(E=i(b,v),e)_=SZe(b,e,E,y,v,t),D=m(e,_.values);else throw Error(`expected geometry to be given`);else{if(!_)throw Error(`expected renderObject to be available`);if((h.updateColor||h.updateSize||h.updateTransform)&&(E=i(b,v)),h.updateTransform){let{instanceCount:e,groupCount:t}=E;v.instanceGranularity?QA(e,`instance`,_.values):QA(e*t,`groupInstance`,_.values)}if(h.createGeometry)if(e)L.updateIfChanged(_.values.drawCount,wF.getDrawCount(e)),L.updateIfChanged(_.values.uVertexCount,wF.getVertexCount(e)),L.updateIfChanged(_.values.uGroupCount,E.groupCount);else throw Error(`expected geometry to be given`);(h.updateTransform||h.createGeometry)&&(f(_.values,e||w),D=m(w,_.values)),h.updateSize&&`uSize`in _.values&&tP(E,y.size,_.values),h.updateColor&&nM(E,D,y.color,_.values),d(_.values,v),p(_.state,v)}x=v,S=y,C=b,e&&(w=e,T+=1)}function A(e){return!!(mq(e)||nB.isLoci(e)&&nB.areRootsEquivalent(e.structure,C)||$.is(e)&&nB.areRootsEquivalent(e.structure,C)&&$.isWholeStructure(e))}function j(e,t,n){let r=!1;return!$.is(e)&&!fR.isLoci(e)||!nB.areEquivalent(e.structure,t)?!1:(n(G.ofSingleton(0))&&(r=!0),r)}function M(e,t,n){return A(e)?x.instanceGranularity?t(G.ofBounds(0,E.instanceCount)):t(G.ofBounds(0,E.groupCount*E.instanceCount)):x.instanceGranularity?j(e,C,t):o(e,C,t,n)}function N(e){_&&l?.(_.values,w,x,S,e.webgl)}return{get groupCount(){return E?E.count:0},get renderObject(){return E&&E.count?_:void 0},get geometryVersion(){return T},createOrUpdate(e,t,n={},i){if(O(t,n,i||C),h.createGeometry){let t=r(e,b,y,v,w);if(Rb(t))return t.then(t=>{k(t),N(e)});k(t)}else k();N(e)},getLoci(e){return _?a(e,C,_.id):hq},eachLocation(e){for(E.reset();E.hasNext;){let{location:t,isSecondary:n}=E.move();e(t,n)}},mark(e,t){return Zq.mark(_,e,t,M,g)},setVisibility(e){Zq.setVisibility(_,e)},setAlphaFactor(e){Zq.setAlphaFactor(_,e)},setPickable(e){Zq.setPickable(_,e)},setColorOnly(e){Zq.setColorOnly(_,e)},setTransform(e,t){Zq.setTransform(_,e,t)},setOverpaint(e,t){let n={geometry:w,props:x,webgl:t};Zq.setOverpaint(_,e,M,!0,n)},setTransparency(e,t){let n={geometry:w,props:x,webgl:t};Zq.setTransparency(_,e,M,!0,n)},setEmissive(e,t){let n={geometry:w,props:x,webgl:t};Zq.setEmissive(_,e,M,!0,n)},setSubstance(e,t){let n={geometry:w,props:x,webgl:t};Zq.setSubstance(_,e,M,!0,n)},setClipping(e){Zq.setClipping(_,e,M,!0)},setThemeStrength(e){Zq.setThemeStrength(_,e)},destroy(){u?.(w),_&&=(_.state.disposed=!0,void 0)},mustRecreate:c}}const m$={...pZe,...f$};function h$(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:HM.Utils},t)}const CZe={...mZe,...f$};function wZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:HP.Utils},t)}const TZe={...hZe,...f$};function EZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:CF.Utils},t)}const DZe={...gZe,...f$};function OZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:iP.Utils},t)}const g$={..._Ze,...f$};function _$(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:vP.Utils},t)}const kZe={...vZe,...f$};function AZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0),n.background!==r.background&&(t.createGeometry=!0),n.backgroundMargin!==r.backgroundMargin&&(t.createGeometry=!0),n.tether!==r.tether&&(t.createGeometry=!0),n.tetherLength!==r.tetherLength&&(t.createGeometry=!0),n.tetherBaseWidth!==r.tetherBaseWidth&&(t.createGeometry=!0),n.attachment!==r.attachment&&(t.createGeometry=!0),n.fontFamily!==r.fontFamily&&(t.createGeometry=!0),n.fontQuality!==r.fontQuality&&(t.createGeometry=!0),n.fontStyle!==r.fontStyle&&(t.createGeometry=!0),n.fontVariant!==r.fontVariant&&(t.createGeometry=!0),n.fontWeight!==r.fontWeight&&(t.createGeometry=!0)},geometryUtils:uP.Utils},t)}const jZe={...yZe,...f$};function MZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:VP.Utils},t)}const NZe={...bZe,...f$};function PZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:UP.Utils},t)}const FZe={...xZe,...f$};function IZe(e,t){return p$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:SF.Utils},t)}function v$(e,t,n,r){let i=0,{webgl:a}=t,o=new sD,s=kF(),c=[],l=new rJ.GeometryState,u=O$.create(),d=new Map,f,p,m,h,g=oq.createEmpty();function _(e={},_){return _&&_!==f&&(m=n(t,_),h||=V.getDefaultValues(m)),h=Object.assign({},h,e),hb.create(`Creating or updating UnitsRepresentation`,async e=>{if(!f&&!_)throw Error(`missing structure`);if(_&&!f){p=_.unitSymmetryGroups;for(let t=0;t<p.length;t++){let n=p[t],i=r(s,_,h,a),o=i.createOrUpdate({webgl:a,runtime:e},g,h,{group:n,structure:_});o&&await o,S(i,n,u),d.set(n.hashCode,{visual:i,group:n}),e.shouldUpdate&&await e.update({message:`Creating or updating UnitsVisual`,current:t,max:p.length})}}else if(_&&(!nB.areUnitIdsAndIndicesEqual(_,f)||_.child!==f.child)){p=_.unitSymmetryGroups;let t=d;d=new Map;for(let n=0;n<p.length;n++){let i=p[n],o=t.get(i.hashCode);if(o){let{visual:n}=o;if(n.mustRecreate?.call(n,{group:i,structure:_},h,a)){n.destroy(),n=r(s,_,h,a);let t=n.createOrUpdate({webgl:a,runtime:e},g,h,{group:i,structure:_});t&&await t,S(n,i,u)}else{let t=n.createOrUpdate({webgl:a,runtime:e},g,h,{group:i,structure:_});t&&await t}if(d.set(i.hashCode,{visual:n,group:i}),t.delete(i.hashCode),n.renderObject){let e=n.renderObject.values.tMarker.ref.value.array;fq(e,G.ofBounds(0,e.length),lq.RemoveHighlight)}}else{let t=r(s,_,h,a),n=t.createOrUpdate({webgl:a,runtime:e},g,h,{group:i,structure:_});n&&await n,S(t,i,u),d.set(i.hashCode,{visual:t,group:i})}e.shouldUpdate&&await e.update({message:`Creating or updating UnitsVisual`,current:n,max:p.length})}t.forEach(({visual:e})=>{e.destroy()})}else if(_&&_!==f&&nB.areUnitIdsAndIndicesEqual(_,f)){p=_.unitSymmetryGroups;for(let n=0;n<p.length;n++){let i=p[n],o=d.get(i.hashCode);if(o){let{visual:n}=o;if(n.mustRecreate?.call(n,{group:i,structure:_},h,t.webgl)){n.destroy(),n=r(s,_,h,t.webgl),o.visual=n;let c=n.createOrUpdate({webgl:a,runtime:e},g,h,{group:i,structure:_});c&&await c,S(n,i,u)}else{let t=n.createOrUpdate({webgl:a,runtime:e},g,h,{group:i,structure:_});t&&await t}o.group=i}else throw Error(`expected to find visual for hashCode ${i.hashCode}`);e.shouldUpdate&&await e.update({message:`Creating or updating UnitsVisual`,current:n,max:p.length})}}else{let n=[];d.forEach(e=>n.push(e));for(let i=0,o=n.length;i<o;++i){let{visual:c,group:l}=n[i];if(c.mustRecreate?.call(c,{group:l,structure:f},h,t.webgl)){c.destroy(),c=r(s,f,h,a),n[i].visual=c;let t=c.createOrUpdate({webgl:a,runtime:e},g,h,{group:l,structure:f});t&&await t,S(c,l,u)}else{let t=c.createOrUpdate({webgl:a,runtime:e},g,h);t&&await t}e.shouldUpdate&&await e.update({message:`Creating or updating UnitsVisual`,current:i,max:o})}}c.length=0,d.forEach(({visual:e})=>{e.renderObject&&(c.push(e.renderObject),l.add(e.renderObject.id,e.geometryVersion))}),l.snapshot(),_&&(f=_),o.next(i++)})}function v(e){let t=hq;return d.forEach(({visual:n})=>{let r=n.getLoci(e);gq(r)||(t=r)}),t}function y(e){d.forEach(({visual:t})=>{t.eachLocation(e)})}function b(){return[nB.Loci(f.child??f)]}function x(e,t){if(!f||!uq.is(u.markerActions,t))return!1;if(nB.isLoci(e)||$.is(e)||fR.isLoci(e)){if(!nB.areRootsEquivalent(e.structure,f))return!1;e=yq.remap(e,f),(nB.isLoci(e)||$.is(e)&&$.isWholeStructure(e))&&(e=pq)}else if(!mq(e)&&!_q(e))return!1;if(yq.isEmpty(e))return!1;let n=!1;return d.forEach(({visual:r})=>{n=r.mark(e,t)||n}),n}function S(e,t,n){let{visible:r,alphaFactor:i,pickable:o,overpaint:s,transparency:c,emissive:l,substance:d,clipping:f,themeStrength:p,transform:m,unitTransforms:h}=n;r!==void 0&&e.setVisibility(r),i!==void 0&&e.setAlphaFactor(i),o!==void 0&&e.setPickable(o),s!==void 0&&e.setOverpaint(s,a),c!==void 0&&e.setTransparency(c,a),l!==void 0&&e.setEmissive(l,a),d!==void 0&&e.setSubstance(d,a),f!==void 0&&e.setClipping(f),p!==void 0&&e.setThemeStrength(p),m!==void 0&&(m!==u.transform||!z.areEqual(m,u.transform,1e-6))&&e.setTransform(m),h!==void 0&&(h?e.setTransform(void 0,h.getSymmetryGroupTransforms(t)):h!==u.unitTransforms&&e.setTransform(void 0,null))}function C(e){let{visible:t,alphaFactor:n,pickable:r,overpaint:i,transparency:a,emissive:o,substance:s,clipping:c,themeStrength:l,transform:p,unitTransforms:m,syncManually:h,markerActions:g}=e,_={};t!==void 0&&(_.visible=t),n!==void 0&&(_.alphaFactor=n),r!==void 0&&(_.pickable=r),i!==void 0&&f&&(_.overpaint=bq.remap(i,f)),a!==void 0&&f&&(_.transparency=xq.remap(a,f)),o!==void 0&&f&&(_.emissive=eJ.remap(o,f)),s!==void 0&&f&&(_.substance=$q.remap(s,f)),c!==void 0&&f&&(_.clipping=Qq.remap(c,f)),l!==void 0&&(_.themeStrength=l),p!==void 0&&!z.areEqual(p,u.transform,1e-6)&&(_.transform=p),(m!==u.unitTransforms||m?.version!==u.unitTransformsVersion)&&(_.unitTransforms=m,u.unitTransformsVersion=m?m?.version:-1),h!==void 0&&(_.syncManually=h),g!==void 0&&(_.markerActions=g),d.forEach(({visual:e,group:t})=>S(e,t,_)),O$.update(u,_)}function w(e){g=e}function T(){d.forEach(({visual:e})=>e.destroy()),d.clear()}return{label:e,get groupCount(){let e=0;return d.forEach(({visual:t})=>{t.renderObject&&(e+=t.groupCount)}),e},get geometryVersion(){return l.version},get props(){return h},get params(){return m},get state(){return u},get theme(){return g},renderObjects:c,updated:o,createOrUpdate:_,setState:C,setTheme:w,getLoci:v,getAllLoci:b,eachLocation:y,mark:x,destroy:T}}function LZe(e,t,n,r,i,a){let{createValues:o,createRenderableState:s}=wF.getUtils(t),c=o(t,rZe(e,i.includeParent,t.boundingSphere,i.cellSize,i.batchSize),n,r,i),l=s(i);return AF(t.kind,c,l,a)}function y$(e,t){let{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:a,eachLocation:o,setUpdateState:s,initUpdateState:c,mustRecreate:l,processValues:u,dispose:d}=e,{createEmpty:f,updateValues:p,updateBoundingSphere:m,updateRenderableState:h,createPositionIterator:g}=e.geometryUtils,_=Cq.create(),v={loci:hq,action:lq.None,status:-1},y,b=Object.assign({},n),x=oq.createEmpty(),S,C,w,T,E,D=-1,O,k;function A(e,t,n){if(!n&&!T)throw Error(`missing structureGroup`);if(b=t,x=e,S=n,Cq.reset(_),!y||!T){c?.(_,b,x,S),_.createNew=!0,_.createGeometry=!0;return}s(_,b,C,x,w,S,T),nB.areHierarchiesEqual(T.structure,S.structure)||(_.updateTransform=!0,_.updateColor=!0,_.updateSize=!0),YK.areEqual(x.color,w.color)||(_.updateColor=!0),aq.areEqual(x.size,w.size)||(_.updateSize=!0),T.structure.child!==S.structure.child&&(_.createGeometry=!0,_.updateTransform=!0),(b.instanceGranularity!==C.instanceGranularity||b.cellSize!==C.cellSize||b.batchSize!==C.batchSize)&&(_.updateTransform=!0),Tx(b.unitKinds,C.unitKinds)||(_.createGeometry=!0),S.group.transformHash!==T.group.transformHash&&(S.group.units.length!==T.group.units.length||_.updateColor?_.updateTransform=!0:_.updateMatrix=!0);let r=S.group.units[0],i=T.group.units[0];Q.areOperatorsEqual(r,i)||(_.updateTransform=!0),Q.areConformationsEqual(r,i)||(_.createGeometry=!0),_.updateTransform&&(_.updateMatrix=!0),_.updateSize&&!(`uSize`in y.values)&&(_.createGeometry=!0),(_.createGeometry||_.updateTransform)&&(T.structure.hashCode!==S.structure.hashCode&&(_.updateColor=!0,_.updateSize=!0),(x.color.granularity.startsWith(`vertex`)||y.values.dColorType.ref.value.startsWith(`vertex`)||x.color.granularity.startsWith(`volume`)||y.values.dColorType.ref.value.startsWith(`volume`))&&(_.updateColor=!0))}function j(e){if(_.createNew)if(O=i(S,b),e)y=LZe(S,e,O,x,b,t),k=g(e,y.values);else throw Error(`expected geometry to be given`);else{if(!y)throw Error(`expected renderObject to be available`);if((_.updateColor||_.updateSize||_.updateTransform)&&(O=i(S,b)),_.updateTransform){let{instanceCount:e,groupCount:t}=O;b.instanceGranularity?QA(e,`instance`,y.values):QA(e*t,`groupInstance`,y.values)}if(_.updateMatrix&&(rZe(S,b.includeParent,e?.boundingSphere||y.values.invariantBoundingSphere.ref.value,b.cellSize,b.batchSize,y.values),`lodLevels`in y.values&&L.update(y.values.lodLevels,y.values.lodLevels.ref.value)),_.createGeometry)if(e)L.updateIfChanged(y.values.drawCount,wF.getDrawCount(e)),L.updateIfChanged(y.values.uVertexCount,wF.getVertexCount(e)),L.updateIfChanged(y.values.uGroupCount,O.groupCount);else throw Error(`expected geometry to be given`);(_.updateTransform||_.createGeometry)&&(m(y.values,e||E),k=g(e||E,y.values)),_.updateSize&&`uSize`in y.values&&tP(O,x.size,y.values),_.updateColor&&nM(O,k,x.color,y.values),p(y.values,b),h(y.state,b)}C=b,w=x,T=S,e&&(E=e,D+=1)}function M(e,t,n,i,a,o){return aZe(a.unitKinds,t)?r(e,t,n,i,a,o):f(o)}function N(e){return!!(mq(e)||nB.isLoci(e)&&nB.areRootsEquivalent(e.structure,T.structure)||$.is(e)&&nB.areRootsEquivalent(e.structure,T.structure)&&$.isWholeStructure(e))}function ee(e,t,n){let r=!1;if(fR.isLoci(e)){let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;for(let t of e.bonds){if(t.aUnit!==t.bUnit)continue;let e=a.unitIndexMap.get(t.aUnit.id);e!==void 0&&n(G.ofSingleton(e))&&(r=!0)}}else if($.is(e)){let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;for(let t of e.elements){let e=a.unitIndexMap.get(t.unit.id);e!==void 0&&n(G.ofSingleton(e))&&(r=!0)}}return r}function te(e,t,n){return N(e)?C.instanceGranularity?t(G.ofBounds(0,O.instanceCount)):t(G.ofBounds(0,O.groupCount*O.instanceCount)):C.instanceGranularity?ee(e,T,t):o(e,T,t,n)}function P(e){y&&u?.(y.values,E,C,w,e.webgl)}return{get groupCount(){return O?O.count:0},get renderObject(){return O&&O.count?y:void 0},get geometryVersion(){return D},createOrUpdate(e,t,n,r){if(A(t,n,r||T),_.createGeometry){let t=M(e,S.group.units[0],S.structure,x,b,E);if(Rb(t))return t.then(t=>{j(t),P(e)});j(t)}else j();P(e)},getLoci(e){return y?a(e,T,y.id):hq},eachLocation(e){for(O.reset();O.hasNext;){let{location:t,isSecondary:n}=O.move();e(t,n)}},mark(e,t){let n=!0;if($.is(e)){n=!1;let{invariantId:t}=T.group.units[0];for(let r of e.elements)if(r.unit.invariantId===t){n=!0;break}}return n?Zq.mark(y,e,t,te,v):!1},setVisibility(e){Zq.setVisibility(y,e)},setAlphaFactor(e){Zq.setAlphaFactor(y,e)},setPickable(e){Zq.setPickable(y,e)},setColorOnly(e){Zq.setColorOnly(y,e)},setTransform(e,t){Zq.setTransform(y,e,t)},setOverpaint(e,t){let n={geometry:E,props:C,webgl:t};Zq.setOverpaint(y,e,te,!0,n)},setTransparency(e,t){let n={geometry:E,props:C,webgl:t};Zq.setTransparency(y,e,te,!0,n)},setEmissive(e,t){let n={geometry:E,props:C,webgl:t};Zq.setEmissive(y,e,te,!0,n)},setSubstance(e,t){let n={geometry:E,props:C,webgl:t};Zq.setSubstance(y,e,te,!0,n)},setClipping(e){Zq.setClipping(y,e,te,!0)},setThemeStrength(e){Zq.setThemeStrength(y,e)},destroy(){d?.(E),y&&=(y.state.disposed=!0,void 0)},mustRecreate:l}}const b$={...pZe,...f$};function x$(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:HM.Utils},t)}const S$={...mZe,...f$};function C$(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:HP.Utils},t)}const w$={...hZe,...f$};function T$(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:CF.Utils},t)}const RZe={...gZe,...f$};function zZe(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:iP.Utils},t)}const E$={..._Ze,...f$};function D$(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.updateSize=!0)},geometryUtils:vP.Utils},t)}({...vZe,...f$});const BZe={...yZe,...f$};function VZe(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:VP.Utils},t)}const HZe={...bZe,...f$};function UZe(e,t){return y$({...e,setUpdateState:(t,n,r,i,a,o,s)=>{e.setUpdateState(t,n,r,i,a,o,s),aq.areEqual(i.size,a.size)||(t.createGeometry=!0)},geometryUtils:UP.Utils},t)}({...xZe,...f$});const O$={create:()=>({...rJ.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{rJ.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};function k$(e){return e}var A$;(function(e){e[e.Spherical=0]=`Spherical`,e[e.Terminal=1]=`Terminal`,e[e.Linear=2]=`Linear`,e[e.Trigonal=3]=`Trigonal`,e[e.Tetrahedral=4]=`Tetrahedral`,e[e.TrigonalBiPyramidal=5]=`TrigonalBiPyramidal`,e[e.Octahedral=6]=`Octahedral`,e[e.SquarePlanar=7]=`SquarePlanar`,e[e.Unknown=8]=`Unknown`})(A$||={});function WZe(e){switch(e){case A$.Spherical:return`Spherical`;case A$.Terminal:return`Terminal`;case A$.Linear:return`Linear`;case A$.Trigonal:return`Trigonal`;case A$.Tetrahedral:return`Tetrahedral`;case A$.TrigonalBiPyramidal:return`Trigonal Bi-Pyramidal`;case A$.Octahedral:return`Octahedral`;case A$.SquarePlanar:return`Square Planar`;case A$.Unknown:return`Unknown`}}function j$(e){switch(e){case 0:return A$.Spherical;case 1:return A$.Terminal;case 2:return A$.Linear;case 3:return A$.Trigonal;case 4:return A$.Tetrahedral;default:return A$.Unknown}}const GZe=new Map([[A$.Linear,FT(180)],[A$.Trigonal,FT(120)],[A$.Tetrahedral,FT(109.4721)],[A$.Octahedral,FT(90)]]);var M$=B(),N$=B(),P$=B(),F$=B(),I$=B();function L$(e,t,n,r,i,a=!0){let o=[],s=[];return t.conformation.position(t.elements[n],P$),r.conformation.position(r.elements[i],F$),B.sub(M$,F$,P$),$Q(e,t,n,(e,t)=>{KQ(e,t)===bR.H?a||(e.conformation.position(e.elements[t],I$),B.sub(N$,I$,P$),s.push(B.angle(M$,N$))):(e.conformation.position(e.elements[t],I$),B.sub(N$,I$,P$),o.push(B.angle(M$,N$)))}),[o,s]}function KZe(e,t,n,r,i){t.conformation.position(t.elements[n],P$),r.conformation.position(r.elements[i],F$),B.sub(M$,F$,P$);let a=[B(),B()],o=0,s,c;if($Q(e,t,n,(e,t)=>{o>1||KQ(e,t)!==bR.H&&(s=e,c=t,e.conformation.position(e.elements[t],I$),B.sub(a[o++],I$,P$))}),o===1&&s&&c&&$Q(e,s,c,(e,r)=>{o>1||e===t&&r===n||KQ(e,r)!==bR.H&&(e.conformation.position(e.elements[r],I$),B.sub(a[o++],I$,P$))}),o===2)return B.cross(N$,a[0],a[1]),Math.abs(Math.PI/2-B.angle(N$,M$))}function qZe(e,t,n,r,i){let a=n;t.conformation.position(t.elements[n],P$),r.conformation.position(r.elements[i],F$),B.sub(M$,F$,P$);let o=B.squaredDistance(P$,F$);return $Q(e,t,n,(e,t)=>{if(KQ(e,t)===bR.H){e.conformation.position(e.elements[t],I$);let n=B.squaredDistance(I$,F$);n<o&&(o=n,a=t)}}),a}var R$=new fR.ElementBondIterator,z$=new fR.ElementBondIterator;function JZe(e,t,n){let r=KQ(t,n),i=r===bR.O||r===bR.N;if(i&&XQ(e,t,n)===4)return!1;for(R$.setElement(e,t,n);R$.hasNext;){let t=R$.move();if(t.order>1)return!0;if(i){let n=KQ(t.otherUnit,t.otherIndex);for(z$.setElement(e,t.otherUnit,t.otherIndex);z$.hasNext;){let e=z$.move();if(e.order>1){if((n===bR.P||n===bR.S)&&KQ(e.otherUnit,e.otherIndex)===bR.O)continue;return!0}}}}return!1}function YZe(e,t,n){let r=0,{offset:i,edgeProps:{flags:a,order:o}}=t.bonds;for(let e=i[n],t=i[n+1];e<t;++e)kI.isCovalent(a[e])&&(r+=o[e]);return e.interUnitBonds.getEdgeIndices(n,t.id).forEach(t=>{let n=e.interUnitBonds.edges[t];kI.isCovalent(n.props.flag)&&(r+=n.props.order)}),r}var B$=new fR.ElementBondIterator,V$=new fR.ElementBondIterator;function XZe(e,t,n,r,i){let a=ZQ(e,t,n,bR.H),o=KQ(t,n),s=RXe(t,n),c=r.assignCharge===`always`||r.assignCharge===`auto`&&s===0,l=r.assignH===`always`||r.assignH===`auto`&&!i&&a===0,u=XQ(e,t,n),d=YZe(e,t,n),f=JZe(e,t,n),p=d-u>0,m=0,h=A$.Unknown;switch(o){case bR.H:c&&(u===0?(s=1,h=A$.Spherical):u===1&&(s=0,h=A$.Terminal));break;case bR.C:c&&(s=0),l&&(m=Math.max(0,4-d-Math.abs(s))),h=j$(u+m+Math.max(0,-s));break;case bR.N:if(c)if(!l)s=d-3;else if(f&&d<4)s=u-a===1&&d-a===2?1:0;else for(B$.setElement(e,t,n);B$.hasNext;){let e=B$.move(),t=KQ(e.otherUnit,e.otherIndex);if(t===bR.S||_ke(t)){s=0;break}else s=1}l&&(m=Math.max(0,3-d+s)),h=j$(f&&!p?u+m-s:u+m+1-s);break;case bR.O:if(c&&(l||(s=d-2),d===1)){B$.setElement(e,t,n);b1:for(;B$.hasNext;){let r=B$.move();for(V$.setElement(e,r.otherUnit,r.otherIndex);V$.hasNext;){let e=V$.move();if(!(e.otherUnit===t&&e.otherIndex===n)&&KQ(e.otherUnit,e.otherIndex)===bR.O&&e.order===2){s=-1;break b1}}}}l&&(m=Math.max(0,2-d+s)),h=j$(f&&!p?u+m-s+1:u+m-s+2);break;case bR.S:c&&(l||(s=d<=3&&ZQ(e,t,n,bR.O)===0?d-2:0)),l&&d<2&&(m=Math.max(0,2-d+s)),d<=3&&(h=j$(u+m-s+2));break;case bR.F:case bR.CL:case bR.BR:case bR.I:case bR.AT:c&&(s=d-1);break;case bR.LI:case bR.NA:case bR.K:case bR.RB:case bR.CS:case bR.FR:c&&(s=1-d);break;case bR.BE:case bR.MG:case bR.CA:case bR.SR:case bR.BA:case bR.RA:c&&(s=2-d);break;default:Qy&&console.warn(`Requested charge, protonation for an unhandled element`,o)}return[s,m,m+a,h]}function ZZe(e,t,n){let r=t.elements.length,i=new Int8Array(r),a=new Int8Array(r),o=new Int8Array(r),s=new Int8Array(r),c=!!e.parent,l;if(c){let n=e.root.unitMap.get(t.id);if(l=Vk.indicesOf(n.elements,t.elements),l.length!==t.elements.length)throw Error(`expected to find an index for every element`);t=n,e=e.root}let u=!1;for(let e=0;e<r;++e){let n=c?l[e]:e;if(KQ(t,n)===bR.H){u=!0;break}}for(let d=0;d<r;++d){let r=c?l[d]:d,[f,p,m,h]=XZe(e,t,r,n,u);i[d]=f,a[d]=p,o[d]=m,s[d]=h}return{charge:i,implicitH:a,totalH:o,idealGeometry:s}}const QZe={assignCharge:V.Select(`auto`,[[`always`,`always`],[`auto`,`auto`],[`never`,`never`]]),assignH:V.Select(`auto`,[[`always`,`always`],[`auto`,`auto`],[`never`,`never`]])};async function $Ze(e,t,n){let r={...V.getDefaultValues(QZe),...n},i=new Map,a=`valence-model-${JSON.stringify(r)}`;for(let e=0,n=t.units.length;e<n;++e){let n=t.units[e];if(Q.isAtomic(n)){let e;n.transientCache.has(a)?e=n.transientCache.get(a):(e=ZZe(t,n,r),n.transientCache.set(a,e)),i.set(n.id,e)}}return i}const H$={...QZe},U$=_z.createProvider({label:`Valence Model`,descriptor:PP({name:`molstar_computed_valence_model`}),type:`local`,defaultParams:H$,getParams:e=>H$,isApplicable:e=>!0,obtain:async(e,t,n)=>{let r={...V.getDefaultValues(H$),...n};return{value:await $Ze(e.runtime,t,r)}}});var W$;(function(e){function t(e,t,n,r){return B.set(e,r.x[n],r.y[n],r.z[n]),B.transformMat4(e,e,t.conformation.operator.matrix),e}e.setPosition=t;function n(e,t){let n=new Int32Array(t+1),r=new Int32Array(t),i=new Int32Array(t),{members:a,count:o,offsets:s}=e;for(let e=0,t=s[o];e<t;++e)++i[a[e]];let c=0;for(let e=0;e<t;e++)n[e]=c,c+=i[e];n[t]=c;let l=new Int32Array(c);for(let e=0;e<o;++e)for(let t=s[e],i=s[e+1];t<i;++t){let i=a[t],o=n[i]+r[i];l[o]=e,++r[i]}return{indices:l,offsets:n}}e.createElementsIndex=n;function r(e,t){let r,a;return{...t,get lookup3d(){if(!r){let e={x:t.x,y:t.y,z:t.z,indices:K.ofBounds(0,t.count)};r=yA(e,PR(e))}return r},get elementsIndex(){return a||=n(t,e)},subset:e=>i(t,e)}}e.create=r;function i(e,t){let n,{count:r,types:i}=e,a=[];for(let e=0;e<r;++e)t.has(i[e])&&a.push(e);let o=Vk.ofSortedArray(a);return{indices:o,get lookup3d(){if(!n){let t={x:e.x,y:e.y,z:e.z,indices:o};n=yA(t,PR(t))}return n}}}e.createSubset=i;function a(e,t,n){let r=U$.get(e).value;if(!r||!r.has(t.id))throw Error(`valence model required`);return{unit:t,types:n.types,feature:-1,x:n.x,y:n.y,z:n.z,members:n.members,offsets:n.offsets,idealGeometry:r.get(t.id).idealGeometry}}e.Info=a;function o(e,t){return B.set(e,t.x[t.feature],t.y[t.feature],t.z[t.feature]),B.transformMat4(e,e,t.unit.conformation.operator.matrix),e}e.position=o;let s=B(),c=B();function l(e,t){let n=e.members[e.offsets[e.feature]],r=t.members[t.offsets[t.feature]];return e.unit.conformation.position(e.unit.elements[n],s),t.unit.conformation.position(t.unit.elements[r],c),B.distance(s,c)}e.distance=l;function u(e,t){return{types:new Set(e),add:t}}e.Provider=u})(W$||={});var eQe;(function(e){function t(e=2048,t=1024,n){let r=_O.create(Float32Array,1,t,n?n.x:e),i=_O.create(Float32Array,1,t,n?n.y:e),a=_O.create(Float32Array,1,t,n?n.z:e),o=_O.create(Uint8Array,1,t,n?n.types:e),s=_O.create(Uint8Array,1,t,n?n.groups:e),c=_O.create(Uint32Array,1,t,n?n.offsets:e),l=_O.create(Uint32Array,1,t,n?n.members:e),u={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{u.x=0,u.y=0,u.z=0,u.offset=l.elementCount,u.count=0},pushMember:(e,t,n,r)=>{_O.add(l,r),u.x+=e,u.y+=t,u.z+=n,u.count+=1},finishState:(e,t)=>{let{count:n}=u;n!==0&&(_O.add(o,e),_O.add(s,t),_O.add(r,u.x/n),_O.add(i,u.y/n),_O.add(a,u.z/n),_O.add(c,u.offset))},add:(e,t,n,u,d,f)=>{_O.add(o,e),_O.add(s,t),_O.add(r,n),_O.add(i,u),_O.add(a,d),_O.add(c,l.elementCount),_O.add(l,f)},getFeatures:e=>{_O.add(c,l.elementCount);let t=_O.compact(r,!0),n=_O.compact(i,!0),u=_O.compact(a,!0),d=r.elementCount;return W$.create(e,{x:t,y:n,z:u,count:d,types:_O.compact(o,!0),groups:_O.compact(s,!0),offsets:_O.compact(c,!0),members:_O.compact(l,!0)})}}}e.create=t})(eQe||={});var tQe;(function(e){function t(e,t,n){let r=new Int32Array(n+1),i=new Int32Array(n),a=new Int32Array(n),{members:o,offsets:s}=t;for(let t=0,n=e.edgeCount*2;t<n;++t){let n=e.a[t],r=e.b[t];if(!(n>r)){for(let e=s[n],t=s[n+1];e<t;++e)++a[o[e]];for(let e=s[r],t=s[r+1];e<t;++e)++a[o[e]]}}let c=0;for(let e=0;e<n;e++)r[e]=c,c+=a[e];r[n]=c;let l=new Int32Array(c);for(let t=0,n=e.edgeCount*2;t<n;++t){let n=e.a[t],a=e.b[t];if(!(n>a)){for(let e=s[n],a=s[n+1];e<a;++e){let n=o[e],a=r[n]+i[n];l[a]=t,++i[n]}for(let e=s[a],n=s[a+1];e<n;++e){let n=o[e],a=r[n]+i[n];l[a]=t,++i[n]}}}return{indices:l,offsets:r}}e.createElementsIndex=t})(tQe||={});var nQe=class extends OL{getContactIndicesForElement(e,t){return this.elementKeyIndex.get(this.getElementKey(e,t.id))||[]}getElementKey(e,t){return`${e}|${t}`}constructor(e,t){super(e),this.elementKeyIndex=new Map;for(let e=0,n=this.edges.length;e<n;++e){let{unitA:n,indexA:r}=this.edges[e],{offsets:i,members:a}=t.get(n);for(let t=i[r],o=i[r+1];t<o;++t){let r=this.getElementKey(a[t],n),i=this.elementKeyIndex.get(r);i===void 0?this.elementKeyIndex.set(r,[e]):i.push(e)}}}},G$;(function(e){e[e.None=0]=`None`,e[e.Filtered=1]=`Filtered`})(G$||={});var K$;(function(e){e[e.Unknown=0]=`Unknown`,e[e.Ionic=1]=`Ionic`,e[e.CationPi=2]=`CationPi`,e[e.PiStacking=3]=`PiStacking`,e[e.HydrogenBond=4]=`HydrogenBond`,e[e.HalogenBond=5]=`HalogenBond`,e[e.Hydrophobic=6]=`Hydrophobic`,e[e.MetalCoordination=7]=`MetalCoordination`,e[e.WeakHydrogenBond=8]=`WeakHydrogenBond`})(K$||={});function rQe(e){switch(e){case K$.HydrogenBond:return`Hydrogen Bond`;case K$.Hydrophobic:return`Hydrophobic Contact`;case K$.HalogenBond:return`Halogen Bond`;case K$.Ionic:return`Ionic Interaction`;case K$.MetalCoordination:return`Metal Coordination`;case K$.CationPi:return`Cation-Pi Interaction`;case K$.PiStacking:return`Pi Stacking`;case K$.WeakHydrogenBond:return`Weak Hydrogen Bond`;case K$.Unknown:return`Unknown Interaction`}}var q$;(function(e){e[e.None=0]=`None`,e[e.PositiveCharge=1]=`PositiveCharge`,e[e.NegativeCharge=2]=`NegativeCharge`,e[e.AromaticRing=3]=`AromaticRing`,e[e.HydrogenDonor=4]=`HydrogenDonor`,e[e.HydrogenAcceptor=5]=`HydrogenAcceptor`,e[e.HalogenDonor=6]=`HalogenDonor`,e[e.HalogenAcceptor=7]=`HalogenAcceptor`,e[e.HydrophobicAtom=8]=`HydrophobicAtom`,e[e.WeakHydrogenDonor=9]=`WeakHydrogenDonor`,e[e.IonicTypePartner=10]=`IonicTypePartner`,e[e.DativeBondPartner=11]=`DativeBondPartner`,e[e.TransitionMetal=12]=`TransitionMetal`,e[e.IonicTypeMetal=13]=`IonicTypeMetal`})(q$||={});var iQe;(function(e){e[e.None=0]=`None`,e[e.PositiveCharge=1]=`PositiveCharge`,e[e.NegativeCharge=2]=`NegativeCharge`,e[e.AromaticRing=3]=`AromaticRing`,e[e.HydrogenDonor=4]=`HydrogenDonor`,e[e.HydrogenAcceptor=5]=`HydrogenAcceptor`,e[e.HalogenDonor=6]=`HalogenDonor`,e[e.HalogenAcceptor=7]=`HalogenAcceptor`,e[e.HydrophobicAtom=8]=`HydrophobicAtom`,e[e.WeakHydrogenDonor=9]=`WeakHydrogenDonor`,e[e.IonicTypePartner=10]=`IonicTypePartner`,e[e.DativeBondPartner=11]=`DativeBondPartner`,e[e.TransitionMetal=12]=`TransitionMetal`,e[e.IonicTypeMetal=13]=`IonicTypeMetal`})(iQe||={});function aQe(e){switch(e){case q$.None:return`None`;case q$.PositiveCharge:return`Positive Charge`;case q$.NegativeCharge:return`Negative Charge`;case q$.AromaticRing:return`Aromatic Ring`;case q$.HydrogenDonor:return`Hydrogen Donor`;case q$.HydrogenAcceptor:return`Hydrogen Acceptor`;case q$.HalogenDonor:return`Halogen Donor`;case q$.HalogenAcceptor:return`Halogen Acceptor`;case q$.HydrophobicAtom:return`HydrophobicAtom`;case q$.WeakHydrogenDonor:return`Weak Hydrogen Donor`;case q$.IonicTypePartner:return`Ionic Type Partner`;case q$.DativeBondPartner:return`Dative Bond Partner`;case q$.TransitionMetal:return`Transition Metal`;case q$.IonicTypeMetal:return`Ionic Type Metal`}}var J$;(function(e){e[e.None=0]=`None`,e[e.QuaternaryAmine=1]=`QuaternaryAmine`,e[e.TertiaryAmine=2]=`TertiaryAmine`,e[e.Sulfonium=3]=`Sulfonium`,e[e.SulfonicAcid=4]=`SulfonicAcid`,e[e.Sulfate=5]=`Sulfate`,e[e.Phosphate=6]=`Phosphate`,e[e.Halocarbon=7]=`Halocarbon`,e[e.Guanidine=8]=`Guanidine`,e[e.Acetamidine=9]=`Acetamidine`,e[e.Carboxylate=10]=`Carboxylate`})(J$||={});function oQe(e){switch(e){case J$.None:return`None`;case J$.QuaternaryAmine:return`Quaternary Amine`;case J$.TertiaryAmine:return`Tertiary Amine`;case J$.Sulfonium:return`Sulfonium`;case J$.SulfonicAcid:return`Sulfonic Acid`;case J$.Sulfate:return`Sulfate`;case J$.Phosphate:return`Phosphate`;case J$.Halocarbon:return`Halocarbon`;case J$.Guanidine:return`Guanidine`;case J$.Acetamidine:return`Acetamidine`;case J$.Carboxylate:return`Carboxylate`}}var sQe;(function(e){function t(e,t){let n=[],r=[],i=[];return{add(e,t,a){n[n.length]=e,r[r.length]=t,i[i.length]=a},getContacts(){let a=new KI.EdgeBuilder(e.count,n,r),o=new Int8Array(a.slotCount),s=new Int8Array(a.slotCount);for(let e=0,t=a.edgeCount;e<t;e++)a.addNextEdge(),a.assignProperty(o,i[e]);let c=a.createGraph({type:o,flag:s}),l;return Object.defineProperty(c,`elementsIndex`,{get:()=>l||=tQe.createElementsIndex(c,e,t)})}}}e.create=t})(sQe||={});var cQe;(function(e){function t(){let e=new OL.Builder;return{startUnitPair(t,n){e.startUnitPair(t.id,n.id)},finishUnitPair(){e.finishUnitPair()},add(t,n,r){e.add(t,n,{type:r,flag:G$.None})},getContacts(t){return new nQe(e.getMap(),t)}}}e.create=t})(cQe||={});const lQe={lineOfSightDistFactor:V.Numeric(1,{min:0,max:3,step:.1})};var uQe=3;function dQe(e,t,n){let r=t.members[t.offsets[t.feature]],i=n.members[n.offsets[n.feature]];if(r===i&&t.unit===n.unit)return!1;let a=JQ(t.unit,r),o=JQ(n.unit,i);return!(a&&o&&a!==o||t.unit===n.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[r]]===n.unit.residueIndex[n.unit.elements[i]]||UXe(e,t.unit,r,n.unit,i))}function fQe(e,t,n,r){let i=JQ(e,t),a=JQ(n,r);return i&&a&&i!==a}function pQe(e,t){let{feature:n,offsets:r,members:i}=t;for(let t=r[n],a=r[n+1];t<a;++t)if(i[t]===e)return!0;return!1}var Y$=B(),X$=B(),Z$=B(),mQe=IR();function hQe(e,t,n,r){let i=t.feature,a=n.feature,o=t.members[t.offsets[i]],s=n.members[n.offsets[a]];W$.position(X$,t),W$.position(Z$,n),B.scale(Y$,B.add(Y$,X$,Z$),.5);let c=r*uQe,{count:l,indices:u,units:d,squaredDistances:f}=e.lookup3d.find(Y$[0],Y$[1],Y$[2],c,mQe);if(l===0)return!0;for(let e=0;e<l;++e){let i=u[e],a=d[e];if(!Q.isAtomic(a))continue;let c=KQ(a,i);if(c===bR.H)continue;let l=WI(c);if(!(l*l*r*r<=f[e])&&!(fQe(a,i,t.unit,o)||fQe(a,i,n.unit,s))&&!(t.unit===a&&pQe(i,t)||n.unit===a&&pQe(i,n))&&(a.conformation.position(a.elements[i],Y$),!(B.squaredDistance(Y$,X$)<1||B.squaredDistance(Y$,Z$)<1)))return!1}return!0}function gQe(e,t,n,r,i,a){for(let o of i)_Qe(e,t,n,r,o,a)}function _Qe(e,t,n,r,i,a){let{x:o,y:s,z:c}=n,{lookup3d:l,indices:u}=n.subset(i.requiredFeatures),d=W$.Info(e,t,n),f={...d},p=a.lineOfSightDistFactor;for(let t=0,n=K.size(u);t<n;++t){let n=K.getAt(u,t),{count:a,indices:m,squaredDistances:h}=l.find(o[n],s[n],c[n],i.maxDistance);if(a!==0){d.feature=n;for(let t=0;t<a;++t){let a=K.getAt(u,m[t]);if(a<=n||(f.feature=a,!dQe(e,d,f)))continue;let o=i.getType(e,d,f,h[t]);o&&hQe(e,d,f,p)&&r.add(n,a,o)}}}}var vQe=z();function yQe(e,t,n,r,i,a,o,s){let{count:c,x:l,y:u,z:d}=n,{lookup3d:f}=i,p=z.mul(vQe,r.conformation.operator.inverse,t.conformation.operator.matrix),m=!z.isIdentity(p),h=B(),g=Math.max(...o.map(e=>e.maxDistance)),{center:_,radius:v}=f.boundary.sphere,y=(v+g)*(v+g),b=s.lineOfSightDistFactor,x=W$.Info(e,t,n),S=W$.Info(e,r,i);a.startUnitPair(t,r);for(let t=0;t<c;++t){if(B.set(h,l[t],u[t],d[t]),m&&B.transformMat4(h,h,p),B.squaredDistance(h,_)>y)continue;let{indices:n,count:r,squaredDistances:i}=f.find(h[0],h[1],h[2],g);if(r!==0){x.feature=t;for(let s=0;s<r;++s){let r=n[s];if(S.feature=r,!dQe(e,x,S))continue;let c=i[s];for(let n of o)if(c<n.maxDistance*n.maxDistance){let i=n.getType(e,x,S,c);if(i&&hQe(e,x,S,b)){a.add(t,r,i);break}}}}}a.finishUnitPair()}var bQe={distanceMax:V.Numeric(4,{min:1,max:5,step:.1}),angleMax:V.Numeric(30,{min:0,max:60,step:1})},xQe=[bR.CL,bR.BR,bR.I,bR.AT];function SQe(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let e=0,s=r.length;e<s;++e){let s=KQ(t,e);xQe.includes(s)&&n.add(q$.HalogenDonor,J$.None,i[r[e]],a[r[e]],o[r[e]],e)}}var CQe=[bR.N,bR.O,bR.S],wQe=[bR.C,bR.N,bR.P,bR.S];function TQe(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let s=0,c=r.length;s<c;++s){let c=KQ(t,s);if(CQe.includes(c)){let c=!1;$Q(e,t,s,(e,t)=>{wQe.includes(KQ(e,t))&&(c=!0)}),c&&n.add(q$.HalogenAcceptor,J$.None,i[r[s]],a[r[s]],o[r[s]],s)}}}function EQe(e,t){return e===q$.HalogenAcceptor&&t===q$.HalogenDonor||e===q$.HalogenDonor&&t===q$.HalogenAcceptor}var DQe=FT(180),OQe=FT(120);function kQe(e){return{angleMax:FT(e.angleMax)}}function AQe(e,t,n,r){let i=t.types[t.feature],a=n.types[n.feature];if(!EQe(i,a))return;let[o,s]=i===q$.HalogenDonor?[t,n]:[n,t],c=o.members[o.offsets[o.feature]],l=s.members[s.offsets[s.feature]],[u]=L$(e,o.unit,c,s.unit,l);if(u.length!==1||DQe-u[0]>r.angleMax)return;let[d]=L$(e,s.unit,l,o.unit,c);if(d.length!==0&&!d.some(e=>OQe-e>r.angleMax))return K$.HalogenBond}const jQe=W$.Provider([q$.HalogenDonor],SQe),MQe=W$.Provider([q$.HalogenAcceptor],TQe),NQe={name:`halogen-bonds`,params:bQe,createTester:e=>{let t=kQe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([q$.HalogenDonor,q$.HalogenAcceptor]),getType:(e,n,r)=>AQe(e,n,r,t)}}};var PQe={distanceMax:V.Numeric(3.5,{min:1,max:5,step:.1}),backbone:V.Boolean(!0,{description:`Include backbone-to-backbone hydrogen bonds`}),accAngleDevMax:V.Numeric(45,{min:0,max:180,step:1},{description:`Max deviation from ideal acceptor angle`}),ignoreHydrogens:V.Boolean(!1,{description:`Ignore explicit hydrogens in geometric constraints`}),donAngleDevMax:V.Numeric(45,{min:0,max:180,step:1},{description:`Max deviation from ideal donor angle`}),accOutOfPlaneAngleMax:V.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:V.Numeric(45,{min:0,max:180,step:1})},FQe={...PQe,water:V.Boolean(!1,{description:`Include water-to-water hydrogen bonds`}),sulfurDistanceMax:V.Numeric(4.1,{min:1,max:5,step:.1})},IQe={...PQe};function Q$(e,t){let n=U$.get(e).value;if(!n)throw Error(`expected valence model to be available`);let r=n.get(t.id);if(!r)throw Error(`expected valence model for unit to be available`);return r}function LQe(e,t,n){let{totalH:r}=Q$(e,t),{elements:i}=t,{x:a,y:o,z:s}=t.model.atomicConformation;for(let e=0,c=i.length;e<c;++e){let c=KQ(t,e);(WQe(t,e)||r[e]>0&&(c===bR.N||c===bR.O||c===bR.S))&&n.add(q$.HydrogenDonor,J$.None,a[i[e]],o[i[e]],s[i[e]],e)}}function RQe(e,t,n){let{totalH:r}=Q$(e,t),{elements:i}=t,{x:a,y:o,z:s}=t.model.atomicConformation;for(let c=0,l=i.length;c<l;++c)KQ(t,c)===bR.C&&r[c]>0&&(ZQ(e,t,c,bR.N)>0||ZQ(e,t,c,bR.O)>0||zQe(t,c))&&n.add(q$.WeakHydrogenDonor,J$.None,a[i[c]],o[i[c]],s[i[c]],c)}function zQe(e,t){let{elementAromaticRingIndices:n,all:r}=e.rings,i=n.get(t);if(i===void 0)return!1;for(let t=0,n=i.length;t<n;++t){let n=r[i[t]];for(let t=0,r=n.length;t<r;++t){let r=KQ(e,n[t]);if(r===bR.N||r===bR.O)return!0}}return!1}function BQe(e,t,n){let{charge:r,implicitH:i,idealGeometry:a}=Q$(e,t),{elements:o}=t,{x:s,y:c,z:l}=t.model.atomicConformation,u=e=>{n.add(q$.HydrogenAcceptor,J$.None,s[o[e]],c[o[e]],l[o[e]],e)};for(let n=0,s=o.length;n<s;++n){let o=KQ(t,n);if(o===bR.O)u(n);else if(o===bR.N){if(WQe(t,n))u(n);else if(r[n]<1){let r=XQ(e,t,n)+i[n],o=a[n];(o===A$.Tetrahedral&&r<4||o===A$.Trigonal&&r<3||o===A$.Linear&&r<2)&&u(n)}}else if(o===bR.S){let e=YQ(t,n);(e===`CYS`||e===`MET`||RXe(t,n)===-1)&&u(n)}}}function VQe(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===iI.Water}function HQe(e,t){return oI.has(qQ(e,t))}function UQe(e,t){return e.rings.elementRingIndices.has(t)}function WQe(e,t){return YQ(e,t)===`HIS`&&KQ(e,t)===bR.N&&UQe(e,t)}function GQe(e,t,n,r){return HQe(e,t)&&HQe(n,r)}function KQe(e,t,n,r){return VQe(e,t)&&VQe(n,r)}function qQe(e,t){return e===q$.HydrogenAcceptor&&t===q$.HydrogenDonor||e===q$.HydrogenDonor&&t===q$.HydrogenAcceptor}function JQe(e,t){return e===q$.WeakHydrogenDonor&&t===q$.HydrogenAcceptor||e===q$.HydrogenAcceptor&&t===q$.WeakHydrogenDonor}function YQe(e){return{ignoreHydrogens:e.ignoreHydrogens,includeBackbone:e.backbone,maxAccAngleDev:FT(e.accAngleDevMax),maxDonAngleDev:FT(e.donAngleDevMax),maxAccOutOfPlaneAngle:FT(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:FT(e.donOutOfPlaneAngleMax)}}function XQe(e){return{...YQe(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}var ZQe=FT(120);function QQe(e,t,n,r){let i=t.members[t.offsets[t.feature]],a=n.members[n.offsets[n.feature]];if(!r.includeBackbone&&GQe(t.unit,i,n.unit,a))return;let[o,s]=L$(e,t.unit,i,n.unit,a,r.ignoreHydrogens),c=GZe.get(t.idealGeometry[i])||ZQe;if(o.some(e=>Math.abs(c-e)>r.maxDonAngleDev)||s.length&&!s.some(e=>e<r.maxDonAngleDev))return;if(t.idealGeometry[i]===A$.Trigonal){let o=KZe(e,t.unit,i,n.unit,a);if(o!==void 0&&o>r.maxDonOutOfPlaneAngle)return}let l=i;!r.ignoreHydrogens&&s.length>0&&(l=qZe(e,t.unit,i,n.unit,a));let[u,d]=L$(e,n.unit,a,t.unit,l,r.ignoreHydrogens),f=GZe.get(n.idealGeometry[a])||ZQe;if(!u.some(e=>f-e>r.maxAccAngleDev)&&!d.some(e=>f-e>r.maxAccAngleDev)){if(n.idealGeometry[a]===A$.Trigonal){let o=KZe(e,n.unit,a,t.unit,i);if(o!==void 0&&o>r.maxAccOutOfPlaneAngle)return}return!0}}function $Qe(e,t,n,r,i){let a=t.types[t.feature],o=n.types[n.feature];if(!qQe(a,o))return;let[s,c]=o===q$.HydrogenAcceptor?[t,n]:[n,t],l=s.members[s.offsets[s.feature]],u=c.members[c.offsets[c.feature]];if(!(r>(KQ(s.unit,l)===bR.S||KQ(c.unit,u)===bR.S?i.maxSulfurDistSq:i.maxDistSq))&&!(!i.includeWater&&KQe(s.unit,l,c.unit,u))&&QQe(e,s,c,i))return K$.HydrogenBond}function e$e(e,t,n,r,i){let a=t.types[t.feature],o=n.types[n.feature];if(!JQe(a,o))return;let[s,c]=o===q$.HydrogenAcceptor?[t,n]:[n,t];if(QQe(e,s,c,i))return K$.WeakHydrogenBond}const t$e=W$.Provider([q$.HydrogenDonor],LQe),n$e=W$.Provider([q$.WeakHydrogenDonor],RQe),r$e=W$.Provider([q$.HydrogenAcceptor],BQe),i$e={name:`hydrogen-bonds`,params:FQe,createTester:e=>{let t=Math.max(e.distanceMax,e.sulfurDistanceMax),n=XQe(e);return{maxDistance:t,requiredFeatures:new Set([q$.HydrogenDonor,q$.HydrogenAcceptor]),getType:(e,t,r,i)=>$Qe(e,t,r,i,n)}}},a$e={name:`weak-hydrogen-bonds`,params:IQe,createTester:e=>{let t=YQe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([q$.WeakHydrogenDonor,q$.HydrogenAcceptor]),getType:(e,n,r,i)=>e$e(e,n,r,i,t)}}};var o$e={distanceMax:V.Numeric(5,{min:0,max:8,step:.1})},s$e={distanceMax:V.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:V.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:V.Numeric(30,{min:0,max:180,step:1})},c$e={distanceMax:V.Numeric(6,{min:1,max:8,step:.1}),offsetMax:V.Numeric(2,{min:0,max:4,step:.1})},l$e=[`ARG`,`HIS`,`LYS`],u$e=[`GLU`,`ASP`];function d$e(e,t){let n=U$.get(e).value;if(!n)throw Error(`expected valence model to be available`);let r=n.get(t.id);if(!r)throw Error(`expected valence model for unit to be available`);return r}function f$e(e,t,n){let{charge:r}=d$e(e,t),{elements:i}=t,{x:a,y:o,z:s}=t.model.atomicConformation,c=new Set,{label_comp_id:l}=t.model.atomicHierarchy.atoms,u=uA.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);for(;u.hasNext;){let{index:d,start:f,end:p}=u.move(),m=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(l$e.includes(m)){n.startState();for(let e=f;e<p;++e)KQ(t,e)===bR.N&&!oI.has(qQ(t,e))&&n.pushMember(a[i[e]],o[i[e]],s[i[e]],e);n.finishState(q$.PositiveCharge,J$.None)}else if(!SI.has(m)){c.clear();for(let r=f;r<p;++r){let l=J$.None;YXe(e,t,r)?l=J$.Guanidine:XXe(e,t,r)&&(l=J$.Acetamidine),l&&(n.startState(),$Q(e,t,r,(e,r)=>{KQ(t,r)===bR.N&&(c.add(r),n.pushMember(a[i[r]],o[i[r]],s[i[r]],r))}),n.finishState(q$.PositiveCharge,l))}for(let e=f;e<p;++e)r[e]>0&&!c.has(e)&&n.add(q$.PositiveCharge,J$.None,a[i[e]],o[i[e]],s[i[e]],e)}}}function p$e(e,t,n){let{charge:r}=d$e(e,t),{elements:i}=t,{x:a,y:o,z:s}=t.model.atomicConformation,c=new Set,{label_comp_id:l}=t.model.atomicHierarchy.atoms,u=uA.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);for(;u.hasNext;){let{index:d,start:f,end:p}=u.move(),m=l.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(u$e.includes(m)){n.startState();for(let e=f;e<p;++e)KQ(t,e)===bR.O&&!oI.has(qQ(t,e))&&n.pushMember(a[i[e]],o[i[e]],s[i[e]],e);n.finishState(q$.NegativeCharge,J$.None)}else if(xI.has(m))for(let r=f;r<p;++r)qXe(e,t,r)&&(n.startState(),$Q(e,t,r,(e,r)=>{KQ(t,r)===bR.O&&n.pushMember(a[i[r]],o[i[r]],s[i[r]],r)}),n.finishState(q$.NegativeCharge,J$.Phosphate));else if(!SI.has(m)){for(let r=f;r<p;++r){n.startState(),KQ(t,r)===bR.N&&!oI.has(qQ(t,r))&&n.pushMember(a[i[r]],o[i[r]],s[i[r]],r),n.finishState(q$.NegativeCharge,J$.None);let l=J$.None;GXe(e,t,r)?l=J$.SulfonicAcid:qXe(e,t,r)?l=J$.Phosphate:KXe(e,t,r)?l=J$.Sulfate:JXe(e,t,r)&&(l=J$.Carboxylate),l&&(n.startState(),$Q(e,t,r,(e,r)=>{KQ(t,r)===bR.O&&(c.add(r),n.pushMember(a[i[r]],o[i[r]],s[i[r]],r))}),n.finishState(q$.NegativeCharge,l))}for(let e=f;e<p;++e)r[e]<0&&!c.has(e)&&n.add(q$.NegativeCharge,J$.None,a[i[e]],o[i[e]],s[i[e]],e)}}}function m$e(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let e of t.rings.aromaticRings){let s=t.rings.all[e];n.startState();for(let e=0,t=s.length;e<t;++e){let t=s[e];n.pushMember(i[r[t]],a[r[t]],o[r[t]],t)}n.finishState(q$.AromaticRing,J$.None)}}function h$e(e,t){return e===q$.NegativeCharge&&t===q$.PositiveCharge||e===q$.PositiveCharge&&t===q$.NegativeCharge}function g$e(e,t){return e===q$.AromaticRing&&t===q$.AromaticRing}function _$e(e,t){return e===q$.AromaticRing&&t===q$.PositiveCharge||e===q$.PositiveCharge&&t===q$.AromaticRing}var v$e=B(),y$e=B();function b$e(e,t,n){let{feature:r,offsets:i,members:a}=e,{feature:o,offsets:s,members:c}=t;for(let l=i[r],u=i[r+1];l<u;++l){let r=a[l];e.unit.conformation.position(e.unit.elements[r],v$e);for(let e=s[o],r=s[o+1];e<r;++e){let r=c[e];if(t.unit.conformation.position(t.unit.elements[r],y$e),B.squaredDistance(v$e,y$e)<n)return!0}}return!1}var $$=B(),e1=B(),t1=B(),n1=B();function r1(e,t){let{unit:n,feature:r,offsets:i,members:a}=t,{elements:o}=n,s=i[r];return t.unit.conformation.position(o[a[s]],$$),t.unit.conformation.position(o[a[s+1]],e1),t.unit.conformation.position(o[a[s+2]],t1),B.triangleNormal(e,$$,e1,t1)}var i1=function(e,t,n){return W$.position($$,e),W$.position(e1,t),B.sub(t1,$$,e1),B.projectOnPlane(n1,t1,n),B.add(n1,n1,e1),B.distance(n1,e1)};function x$e(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function S$e(e){return{offsetMax:e.offsetMax,angleDevMax:FT(e.angleDevMax)}}function C$e(e){return{offsetMax:e.offsetMax}}var w$e=FT(180),T$e=FT(90),a1=B(),o1=B();function E$e(e,t,n,r,i){let a=t.types[t.feature],o=n.types[n.feature];if(h$e(a,o)&&b$e(t,n,i.distanceMaxSq))return K$.Ionic}function D$e(e,t,n,r,i){let a=t.types[t.feature],o=n.types[n.feature];if(g$e(a,o)){r1(a1,t),r1(o1,n);let e=B.angle(a1,o1);if(Math.min(i1(t,n,o1),i1(n,t,a1))<=i.offsetMax&&(e<=i.angleDevMax||e>=w$e-i.angleDevMax||e<=i.angleDevMax+T$e&&e>=T$e-i.angleDevMax))return K$.PiStacking}}function O$e(e,t,n,r,i){let a=t.types[t.feature],o=n.types[n.feature];if(_$e(a,o)){let[e,r]=a===q$.AromaticRing?[t,n]:[n,t];if(r1(a1,e),i1(r,e,a1)<=i.offsetMax)return K$.CationPi}}const k$e=W$.Provider([q$.NegativeCharge],p$e),A$e=W$.Provider([q$.PositiveCharge],f$e),j$e=W$.Provider([q$.AromaticRing],m$e),M$e={name:`ionic`,params:o$e,createTester:e=>{let t=x$e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([q$.NegativeCharge,q$.PositiveCharge]),getType:(e,n,r,i)=>E$e(e,n,r,i,t)}}},N$e={name:`pi-stacking`,params:s$e,createTester:e=>{let t=S$e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([q$.AromaticRing]),getType:(e,n,r,i)=>D$e(e,n,r,i,t)}}},P$e={name:`cation-pi`,params:c$e,createTester:e=>{let t=C$e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([q$.AromaticRing,q$.PositiveCharge]),getType:(e,n,r,i)=>O$e(e,n,r,i,t)}}};var F$e={distanceMax:V.Numeric(4,{min:1,max:5,step:.1})};function I$e(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let s=0,c=r.length;s<c;++s){let c=KQ(t,s),l=!1;c===bR.C?(l=!0,$Q(e,t,s,(e,t)=>{let n=KQ(e,t);n!==bR.C&&n!==bR.H&&(l=!1)})):c===bR.F&&(l=!0),l&&n.add(q$.HydrophobicAtom,J$.None,i[r[s]],a[r[s]],o[r[s]],s)}}function L$e(e,t){return e===q$.HydrophobicAtom&&t===q$.HydrophobicAtom}function R$e(e,t,n,r){let i=t.types[t.feature],a=n.types[n.feature];if(!L$e(i,a))return;let o=t.members[t.offsets[t.feature]],s=n.members[n.offsets[n.feature]];if(!(KQ(t.unit,o)===bR.F&&KQ(n.unit,s)===bR.F))return K$.Hydrophobic}const z$e=W$.Provider([q$.HydrophobicAtom],I$e),B$e={name:`hydrophobic`,params:F$e,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([q$.HydrophobicAtom]),getType:(e,t,n,r)=>R$e(e,t,n,r)})},V$e={distanceMax:V.Numeric(3,{min:1,max:5,step:.1})};var H$e=[bR.LI,bR.NA,bR.K,bR.RB,bR.CS,bR.MG,bR.CA,bR.SR,bR.BA,bR.AL,bR.GA,bR.IN,bR.TL,bR.SC,bR.SN,bR.PB,bR.BI,bR.SB,bR.HG];function U$e(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let e=0,s=r.length;e<s;++e){let s=KQ(t,e),c=q$.None;H$e.includes(s)?c=q$.IonicTypeMetal:(xR(s)||s===bR.ZN||s===bR.CD)&&(c=q$.TransitionMetal),c&&n.add(c,J$.None,i[r[e]],a[r[e]],o[r[e]],e)}}function W$e(e){return!oI.has(e)}function G$e(e){return oI.has(e)}function K$e(e){return sI.has(e)}function q$e(e,t,n){let{elements:r}=t,{x:i,y:a,z:o}=t.model.atomicConformation;for(let e=0,s=r.length;e<s;++e){let s=KQ(t,e),c=YQ(t,e),l=qQ(t,e),u=!1,d=!1,f=_I.has(c),p=xI.has(c);!f&&!p?mke(s)||s===bR.O||s===bR.S?(u=!0,d=!0):s===bR.N&&(u=!0):f?s===bR.O?([`ASP`,`GLU`,`SER`,`THR`,`TYR`,`ASN`,`GLN`].includes(c)&&W$e(l)||G$e(l))&&(u=!0,d=!0):s===bR.S&&(c===`CYS`||c===`MET`)?(u=!0,d=!0):s===bR.N&&c===`HIS`&&W$e(l)&&(u=!0):p&&(s===bR.O&&K$e(l)?(u=!0,d=!0):[`N3`,`N4`,`N7`].includes(l)?u=!0:[`O2`,`O4`,`O6`].includes(l)&&(u=!0,d=!0)),u&&n.add(q$.DativeBondPartner,J$.None,i[r[e]],a[r[e]],o[r[e]],e),d&&n.add(q$.IonicTypePartner,J$.None,i[r[e]],a[r[e]],o[r[e]],e)}}function J$e(e,t){if(e===q$.TransitionMetal)return t===q$.DativeBondPartner||t===q$.TransitionMetal;if(e===q$.IonicTypeMetal)return t===q$.IonicTypePartner}function Y$e(e,t,n,r){let i=t.types[t.feature],a=n.types[n.feature];if(!(!J$e(i,a)&&!J$e(a,i)))return K$.MetalCoordination}const X$e=W$.Provider([q$.IonicTypeMetal,q$.TransitionMetal],U$e),Z$e=W$.Provider([q$.IonicTypePartner,q$.DativeBondPartner],q$e),Q$e={name:`metal-coordination`,params:V$e,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([q$.IonicTypeMetal,q$.TransitionMetal,q$.IonicTypePartner,q$.DativeBondPartner]),getType:(e,t,n,r)=>Y$e(e,t,n,r)})};function $$e(e,t){let{contacts:n,unitsContacts:r,unitsFeatures:i}=t,a=[e1e(e,t),t1e(e,t),n1e(e,t),r1e(e,t),i1e(e,t)];for(let t=0,r=n.edgeCount;t<r;++t){let r=n.edges[t],o=e.unitMap.get(r.unitA),s=e.unitMap.get(r.unitB),c=W$.Info(e,o,i.get(r.unitA));c.feature=r.indexA;let l=W$.Info(e,s,i.get(r.unitB));l.feature=r.indexB;for(let e of a)e.isApplicable(r.props.type)&&e.handleInterContact(t,c,l)}let o=r.keys();for(;;){let{done:t,value:n}=o.next();if(t)break;let s=r.get(n),c=i.get(n),l=e.unitMap.get(n);if(!Q.isAtomic(l))continue;let u=W$.Info(e,l,c),d=W$.Info(e,l,c);for(let e of a)e.startUnit(l,s,c);for(let e=0,t=s.edgeCount*2;e<t;++e){u.feature=s.a[e],d.feature=s.b[e];for(let t of a)t.isApplicable(s.edgeProps.type[e])&&t.handleIntraContact(e,u,d)}}}function e1e(e,t){let{contacts:n}=t,r=function(e,t,n,r,i){let[a,o]=r.get(n)||[1/0,-1];e<a?(o!==-1&&i(o),r.set(n,[e,t])):i(t)};function i(e,t,n,i,a){let o=t.members[t.offsets[t.feature]],s=n.members[n.offsets[n.feature]],c=t.unit.getResidueIndex(o),l=n.unit.getResidueIndex(s),u=`${o}|${t.unit.id}|${l}|${n.unit.id}|A`,d=`${s}|${n.unit.id}|${c}|${t.unit.id}|B`,f=W$.distance(t,n);r(f,e,u,i,a),r(f,e,d,i,a)}let a=new Map,o=e=>n.edges[e].props.flag=G$.Filtered,s,c;return{isApplicable:e=>e===K$.Hydrophobic,handleInterContact:(e,t,n)=>{i(e,t,n,a,o)},startUnit:(e,t,n)=>{s=new Map,c=e=>t.edgeProps.flag[e]=G$.Filtered},handleIntraContact:(e,t,n)=>{i(e,t,n,s,c)}}}function t1e(e,t){let{contacts:n}=t,r=(e,r)=>{let i=e.types[e.feature]===q$.WeakHydrogenDonor?r:e,a=i.members[i.offsets[i.feature]],{edgeProps:{type:o},elementsIndex:{offsets:s,indices:c}}=t.unitsContacts.get(i.unit.id);for(let e=s[a],t=s[a+1];e<t;++e)if(o[c[e]]===K$.HydrogenBond)return!0;let l=n.getEdgeIndices(i.feature,i.unit.id);for(let e=0,t=l.length;e<t;++e)if(n.edges[l[e]].props.type===K$.HydrogenBond)return!0;return!1};return{isApplicable:e=>e===K$.WeakHydrogenBond,handleInterContact:(e,t,i)=>{r(t,i)&&(n.edges[e].props.flag=G$.Filtered)},startUnit:()=>{},handleIntraContact:(e,n,i)=>{if(r(n,i)){let{flag:r}=t.unitsContacts.get(n.unit.id).edgeProps;r[e]=G$.Filtered}}}}function s1(e,t,n,r,i){let{offsets:a,feature:o}=n,{offsets:s,feature:c}=r;for(let l=a[o],u=a[o+1];l<u;++l){let a=n.members[l],o=i.getContactIndicesForElement(a,n.unit);for(let n=0,a=o.length;n<a;++n){let a=o[n];if(e.includes(i.edges[a].props.type))for(let e=s[c],n=s[c+1];e<n;++e){let n=r.members[e];if(i.getContactIndicesForElement(n,r.unit).includes(a)){i.edges[t].props.flag=G$.Filtered;return}}}}}function c1(e,t,n,r,i){let{edgeProps:{type:a,flag:o},elementsIndex:{offsets:s,indices:c}}=i,{offsets:l,feature:u}=n,{offsets:d,feature:f}=r;for(let i=l[u],p=l[u+1];i<p;++i){let l=n.members[i];for(let n=s[l],i=s[l+1];n<i;++n){let i=c[n];if(e.includes(a[i]))for(let e=d[f],n=d[f+1];e<n;++e){let n=r.members[e];for(let e=s[n],r=s[n+1];e<r;++e)if(i===c[e]){o[t]=G$.Filtered;return}}}}}function n1e(e,t){let{contacts:n}=t;return{isApplicable:e=>e===K$.Ionic,handleInterContact:(e,t,r)=>{s1([K$.HydrogenBond,K$.WeakHydrogenBond],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{c1([K$.HydrogenBond,K$.WeakHydrogenBond],e,n,r,t.unitsContacts.get(n.unit.id))}}}function r1e(e,t){let{contacts:n}=t;return{isApplicable:e=>e===K$.Hydrophobic||e===K$.CationPi,handleInterContact:(e,t,r)=>{s1([K$.PiStacking],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{c1([K$.PiStacking],e,n,r,t.unitsContacts.get(n.unit.id))}}}function i1e(e,t){let{contacts:n}=t;return{isApplicable:e=>e===K$.Ionic,handleInterContact:(e,t,r)=>{s1([K$.MetalCoordination],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{c1([K$.MetalCoordination],e,n,r,t.unitsContacts.get(n.unit.id))}}}var l1;(function(e){function t(e,t,n,r,i,a){return ej(`interactions`,{structure:t,interactions:e},{unitA:n,indexA:r,unitB:i,indexB:a})}e.Location=t;function n(e){return!!e&&e.kind===`data-location`&&e.tag===`interactions`}e.isLocation=n;function r(e,t){return e.data.structure===t.data.structure&&e.data.interactions===t.data.interactions&&e.element.indexA===t.element.indexA&&e.element.indexB===t.element.indexB&&e.element.unitA===t.element.unitA&&e.element.unitB===t.element.unitB}e.areLocationsEqual=r;function i(e,t){let{unitA:n,indexA:r,unitB:i,indexB:a}=t,{contacts:o,unitsContacts:s}=e;if(n===i){let e=s.get(n.id),t=e.getDirectedEdgeIndex(r,a);return rQe(e.edgeProps.type[t])}else{let e=o.getEdgeIndex(r,n.id,a,i.id);return rQe(o.edges[e].props.type)}}function a(e){return i(e.data.interactions,e.element)}e.locationLabel=a;function o(e,t,n){return vq(`interactions`,{structure:e,interactions:t},n,e=>c(t,n,e),()=>l(e,t,n))}e.Loci=o;function s(e){return!!e&&e.kind===`data-loci`&&e.tag===`interactions`}e.isLoci=s;function c(e,t,n){let{unitsFeatures:r}=e;return FA.fromPairProvider(t.length,(e,n,i)=>{let a=t[e];W$.setPosition(n,a.unitA,a.indexA,r.get(a.unitA.id)),W$.setPosition(i,a.unitB,a.indexB,r.get(a.unitB.id))},n)}e.getBoundingSphere=c;function l(e,t,n){let r=n[0];if(r===void 0)return``;let{unitA:a,indexA:o,unitB:s,indexB:c}=r,{unitsFeatures:l}=t,{members:u,offsets:d}=l.get(a.id),{members:f,offsets:p}=l.get(s.id),m={granularity:`element`};return(d[o+1]-d[o]>1||p[c+1]-p[c]>1)&&(m.granularity=`residue`),[i(t,r),PJ(fR.Location(e,a,u[d[o]],e,s,f[p[c]]),m)].join(`</br>`)}e.getLabel=l})(l1||={});var a1e=[t$e,n$e,r$e,k$e,A$e,j$e,jQe,MQe,z$e,X$e,Z$e],u1={ionic:M$e,"pi-stacking":N$e,"cation-pi":P$e,"halogen-bonds":NQe,"hydrogen-bonds":i$e,"weak-hydrogen-bonds":a$e,hydrophobic:B$e,"metal-coordination":Q$e};function o1e(e=[]){let t=Object.create(null);return Object.keys(u1).forEach(n=>{t[n]=V.MappedStatic(e.includes(n)?`on`:`off`,{on:V.Group(u1[n].params),off:V.Group({})},{cycle:!0})}),t}const s1e=o1e([`cation-pi`,`pi-stacking`,`hydrogen-bonds`,`halogen-bonds`,`metal-coordination`]),c1e={providers:V.Group(s1e,{isFlat:!0}),contacts:V.Group(lQe,{label:`Advanced Options`})};async function l1e(e,t,n,r){let i={...V.getDefaultValues(c1e),...n},a=JSON.stringify(i);await U$.attach(e,t);let o=[];Ib(u1).forEach(e=>{let{name:t,params:n}=i.providers[e];t===`on`&&o.push(u1[e].createTester(n))});let s=new Set;o.forEach(e=>$F.add(s,e.requiredFeatures));let c=a1e.filter(e=>$F.areIntersecting(s,e.types)),l=dA.Mutable(),u=dA.Mutable();for(let n=0,s=t.unitSymmetryGroups.length;n<s;++n){let d=t.unitSymmetryGroups[n];e.runtime.shouldUpdate&&await e.runtime.update({message:`computing interactions`,current:n,max:s});let f=u1e(t,d.units[0],c,a);for(let e=0,t=d.units.length;e<t;++e){let t=d.units[e];l.set(t.id,f)}if(r?.skipIntraContacts)continue;let p=d1e(t,d.units[0],f,o,i.contacts);for(let e=0,t=d.units.length;e<t;++e){let t=d.units[e];u.set(t.id,p)}}let d={unitsFeatures:l,unitsContacts:u,contacts:f1e(t,l,o,i.contacts,r)};return $$e(t,d),d}function u1e(e,t,n,r){let i=`features-${r}`;if(t.transientCache.has(i))return t.transientCache.get(i);let a=t.elements.length,o=eQe.create(a,a/2);if(Q.isAtomic(t))for(let r of n)r.add(e,t,o);let s=o.getFeatures(a);return t.transientCache.set(i,s),s}function d1e(e,t,n,r,i){let a=sQe.create(n,t.elements.length);return Q.isAtomic(t)&&gQe(e,t,n,a,r,i),a.getContacts()}function f1e(e,t,n,r,i){let a=cQe.create();return nB.eachUnitPair(e,(i,o)=>{yQe(e,i,t.get(i.id),o,t.get(o.id),a,n,r)},{maxRadius:Math.max(...n.map(e=>e.maxDistance)),validUnit:e=>Q.isAtomic(e),validUnitPair:(t,n)=>i?.unitPairTest?i.unitPairTest(t,n):nB.validUnitPair(e,t,n)}),a.getContacts(t)}const d1={...c1e},f1=_z.createProvider({label:`Interactions`,descriptor:PP({name:`molstar_computed_interactions`}),type:`local`,defaultParams:d1,getParams:e=>d1,isApplicable:e=>!e.isCoarseGrained,obtain:async(e,t,n)=>({value:await l1e(e,t,{...V.getDefaultValues(d1),...n})})});var p1=B(),m1=B(),h1=B(),g1=_O.add,p1e=_O.add3,_1;(function(e){function t(e=2048,t=1024,n){let r=_O.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),i=_O.create(Float32Array,3,t,n?n.startBuffer.ref.value:e),a=_O.create(Float32Array,3,t,n?n.endBuffer.ref.value:e),o=_O.create(Float32Array,1,t,n?n.scaleBuffer.ref.value:e),s=_O.create(Float32Array,1,t,n?n.capBuffer.ref.value:e),c=_O.create(Float32Array,1,t,n?n.colorModeBuffer.ref.value:e),l=(e,t,n,l,u,d,f,p,m,h,g)=>{for(let _=0;_<6;++_)p1e(i,e,t,n),p1e(a,l,u,d),g1(r,g),g1(o,f),g1(s,(p?1:0)+(m?2:0)),g1(c,h)},u=(e,t,n,r,i,a,o,s,c)=>{let u=B.distance(e,t),d=n%2!=0,f=Math.floor((n+1)/2),p=u/(n+.5),m=2;B.setMagnitude(h1,B.sub(h1,t,e),p),B.copy(p1,e);for(let n=0;n<f;++n)B.add(p1,p1,h1),d&&n===f-1?(B.copy(m1,t),o||(a=!1)):B.add(m1,p1,h1),s&&(m=B.distance(e,m1)/(u*2)),l(p1[0],p1[1],p1[2],m1[0],m1[1],m1[2],r,i,a,m,c),B.add(p1,p1,h1)};return{add:l,addFixedCountDashes:u,addFixedLengthDashes:(e,t,n,r,i,a,o,s)=>{u(e,t,B.distance(e,t)/n,r,i,a,!0,o,s)},getCylinders:()=>{let e=r.elementCount/6,t=_O.compact(r,!0),l=_O.compact(i,!0),u=_O.compact(a,!0),d=_O.compact(o,!0),f=_O.compact(s,!0),p=_O.compact(c,!0),m=n&&e<=n.cylinderCount?n.mappingBuffer.ref.value:new Float32Array(e*18),h=n&&e<=n.cylinderCount?n.indexBuffer.ref.value:new Uint32Array(e*12);return(!n||e>n.cylinderCount)&&m1e(e,m,h),CF.create(m,h,t,l,u,d,f,p,e,n)}}}e.create=t})(_1||={});function m1e(e,t,n){for(let n=0;n<e;++n){let e=n*18;t[e]=-1,t[e+1]=1,t[e+2]=-1,t[e+3]=-1,t[e+4]=-1,t[e+5]=-1,t[e+6]=1,t[e+7]=1,t[e+8]=-1,t[e+9]=1,t[e+10]=1,t[e+11]=1,t[e+12]=1,t[e+13]=-1,t[e+14]=-1,t[e+15]=1,t[e+16]=-1,t[e+17]=1}for(let t=0;t<e;++t){let e=t*6,r=t*12;n[r]=e,n[r+1]=e+1,n[r+2]=e+2,n[r+3]=e+1,n[r+4]=e+4,n[r+5]=e+2,n[r+6]=e+2,n[r+7]=e+4,n[r+8]=e+3,n[r+9]=e+4,n[r+10]=e+5,n[r+11]=e+3}}const v1={linkScale:V.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:V.Numeric(1,{min:0,max:2,step:.01}),linkCap:V.Boolean(!1),aromaticScale:V.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:V.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:V.Numeric(2,{min:1,max:6,step:1}),dashCount:V.Numeric(4,{min:0,max:10,step:1}),dashScale:V.Numeric(.8,{min:0,max:2,step:.1}),dashCap:V.Boolean(!0),stubCap:V.Boolean(!0),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo),colorMode:V.Select(`default`,V.arrayToOptions([`default`,`interpolate`]),EM.ShadingCategory)};V.getDefaultValues(v1);const h1e={linkScale:V.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:V.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:V.Numeric(2,{min:1,max:6,step:1}),dashCount:V.Numeric(4,{min:0,max:10,step:1})};V.getDefaultValues(h1e);var y1=B(),b1=B(),x1=B(),g1e=B.create(0,1,0);function S1(e,t,n,r){B.normalize(b1,B.sub(b1,t,n)),r===null?B.copy(x1,t):B.sub(x1,t,r),B.normalize(x1,x1);let i=B.dot(b1,x1);return 1-Math.abs(i)<1e-5&&(B.set(x1,1,0,0),i=B.dot(b1,x1),1-Math.abs(i)<1e-5&&(B.set(x1,0,1,0),i=B.dot(b1,x1))),B.setMagnitude(b1,b1,i),B.sub(x1,x1,b1),B.normalize(e,x1)}const _1e={linkCount:0,position:()=>{},radius:()=>0};var C1;(function(e){e[e.Solid=0]=`Solid`,e[e.Dashed=1]=`Dashed`,e[e.Double=2]=`Double`,e[e.OffsetDouble=3]=`OffsetDouble`,e[e.Triple=4]=`Triple`,e[e.OffsetTriple=5]=`OffsetTriple`,e[e.Disk=6]=`Disk`,e[e.Aromatic=7]=`Aromatic`,e[e.MirroredAromatic=8]=`MirroredAromatic`})(C1||={});var w1=B.scale,T1=B.add,E1=B.sub,D1=B.setMagnitude,v1e=B.dot;function O1(e,t,n,r){let{linkCount:i,referencePosition:a,position:o,style:s,radius:c,ignore:l,stub:u}=t;if(!i)return{mesh:HM.createEmpty(r)};let{radialSegments:d,stubCap:f}=n,p=d*2*i*2,m=YN.createState(p,p/4,r),h=B(),g=0,_=0,v={builderState:m,props:n,assignNonAdjustedPosition:(e,t)=>{o(e,t,_,!1)},referencePosition:a?()=>a(_):void 0},y={a:B(),b:B(),group:0,linkStub:!1,linkStyle:C1.Solid,linkRadius:0};for(let e=i;_<e;++_)l&&l(_)||(o(y.a,y.b,_,!0),T1(h,h,y.a),T1(h,h,y.b),g+=2,y.group=_,y.linkStub=f&&(u?u(_):!1),y.linkRadius=c(_),y.linkStyle=s?s(_):C1.Solid,b1e(v,y));let b=YN.getMesh(m);if(g===0)return{mesh:b};B.scale(h,h,1/g);let x=r?q.clone(r.boundingSphere):void 0;return x&&B.distance(h,x.center)/x.radius<.1?{mesh:b,boundingSphere:x}:{mesh:b}}var y1e={cylinderProps:{radiusTop:1,radiusBottom:1,radialSegments:8,topCap:!1,bottomCap:!1},vShift:B(),va:B(),vb:B()};function b1e(e,t){let{builderState:n,props:r,assignNonAdjustedPosition:i,referencePosition:a}=e,{linkRadius:o,linkStub:s,linkStyle:c,a:l,b:u}=t,{linkScale:d,linkSpacing:f,radialSegments:p,linkCap:m,aromaticScale:h,aromaticSpacing:g,aromaticDashCount:_,dashCount:v,dashScale:y,dashCap:b}=r,{cylinderProps:x,vShift:S,va:C,vb:w}=y1e;x.radialSegments=p,B.copy(C,l),B.copy(w,u),E1(y1,w,C);let T=v1e(y1,g1e)>0,[E,D]=T?[s,m]:[m,s];if(n.currentGroup=t.group,c===C1.Solid)x.radiusTop=x.radiusBottom=o,x.topCap=E,x.bottomCap=D,PN(n,C,w,.5,x);else if(c===C1.Dashed)x.radiusTop=x.radiusBottom=o*y,x.topCap=x.bottomCap=b,FN(n,C,w,.5,v,s,x);else if(c===C1.Double||c===C1.OffsetDouble||c===C1.Triple||c===C1.OffsetTriple||c===C1.Aromatic||c===C1.MirroredAromatic){let e=c===C1.Double||c===C1.OffsetDouble?2:c===C1.Triple||c===C1.OffsetTriple?3:1.5,t=o*(d/(.5*e)),r=(o-t)*f;if(S1(S,C,w,a?a():null),x.topCap=E,x.bottomCap=D,c===C1.Aromatic||c===C1.MirroredAromatic){x.radiusTop=x.radiusBottom=o,PN(n,C,w,.5,x);let e=o+h*o+h*o*g;i&&i(C,w),D1(y1,E1(y1,w,C),o*.5),T1(C,C,y1),E1(w,w,y1),x.radiusTop=x.radiusBottom=o*h,x.topCap=x.bottomCap=b,D1(S,S,e),E1(C,C,S),E1(w,w,S),FN(n,C,w,.5,_,s,x),c===C1.MirroredAromatic&&(D1(S,S,e*2),T1(C,C,S),T1(w,w,S),FN(n,C,w,.5,_,s,x))}else if(c===C1.OffsetDouble||c===C1.OffsetTriple){let r=o+t+d*o*f;D1(S,S,r),x.radiusTop=x.radiusBottom=o,PN(n,C,w,.5,x),w1(y1,y1,f*d*.2),T1(C,C,y1),E1(w,w,y1),x.radiusTop=x.radiusBottom=t,x.topCap=T?s:b,x.bottomCap=T?b:s,D1(S,S,r),E1(C,C,S),E1(w,w,S),PN(n,C,w,.5,x),e===3&&(D1(S,S,r*2),T1(C,C,S),T1(w,w,S),PN(n,C,w,.5,x))}else D1(S,S,r),x.radiusTop=x.radiusBottom=t,e===3&&PN(n,C,w,.5,x),fTe(n,C,w,.5,S,x)}else c===C1.Disk&&(w1(y1,y1,.475),T1(C,C,y1),E1(w,w,y1),x.radiusTop=x.radiusBottom=o,x.topCap=E,x.bottomCap=D,PN(n,C,w,.5,x))}function k1(e,t,n,r){let{linkCount:i,referencePosition:a,position:o,style:s,radius:c,ignore:l,stub:u}=t;if(!i)return{cylinders:CF.createEmpty(r)};let{linkScale:d,linkSpacing:f,linkCap:p,aromaticScale:m,aromaticSpacing:h,aromaticDashCount:g,dashCount:_,dashScale:v,dashCap:y,stubCap:b,colorMode:x}=n,S=x===`interpolate`,C=S===!0?3:2,w=i*2,T=_1.create(w,w/4,r),E=B(),D=B(),O=B(),k=B(),A=B(),j=0;for(let e=0,t=i;e<t;++e){if(l&&l(e))continue;o(E,D,e,!0),T1(A,A,E),T1(A,A,D),j+=2;let t=c(e),n=s?s(e):C1.Solid,r=b&&(u?u(e):!1);if(n===C1.Solid)w1(O,T1(O,E,D),.5),T.add(E[0],E[1],E[2],O[0],O[1],O[2],1,p,r,C,e);else if(n===C1.Dashed)w1(O,T1(O,E,D),.5),T.addFixedCountDashes(E,O,_,v,y,y,r,S,e);else if(n===C1.Double||n===C1.OffsetDouble||n===C1.Triple||n===C1.OffsetTriple||n===C1.Aromatic||n===C1.MirroredAromatic){let i=n===C1.Double||n===C1.OffsetDouble?2:n===C1.Triple||n===C1.OffsetTriple?3:1.5,s=d/(.5*i),c=(t-s*t)*f;if(w1(O,T1(O,E,D),.5),S1(k,E,D,a?a(e):null),n===C1.Aromatic||n===C1.MirroredAromatic){T.add(E[0],E[1],E[2],O[0],O[1],O[2],1,p,r,C,e);let i=t+m*t+m*t*h;o(E,D,e,!1),D1(y1,E1(y1,D,E),t*.5),T1(E,E,y1),D1(k,k,i),E1(E,E,k),E1(O,O,k),T.addFixedCountDashes(E,O,g,m,y,y,r,S,e),n===C1.MirroredAromatic&&(D1(k,k,i*2),T1(E,E,k),T1(O,O,k),T.addFixedCountDashes(E,O,g,m,y,y,r,S,e))}else n===C1.OffsetDouble||n===C1.OffsetTriple?(D1(k,k,t+s*t+d*t*f),T.add(E[0],E[1],E[2],O[0],O[1],O[2],1,p,r,C,e),D1(y1,E1(y1,E,O),t/1.5),E1(E,E,y1),i===3&&T.add(E[0]+k[0],E[1]+k[1],E[2]+k[2],O[0]+k[0],O[1]+k[1],O[2]+k[2],s,p,r,C,e),T.add(E[0]-k[0],E[1]-k[1],E[2]-k[2],O[0]-k[0],O[1]-k[1],O[2]-k[2],s,y,r,C,e)):(D1(k,k,c),i===3&&T.add(E[0],E[1],E[2],O[0],O[1],O[2],s,p,r,C,e),T.add(E[0]+k[0],E[1]+k[1],E[2]+k[2],O[0]+k[0],O[1]+k[1],O[2]+k[2],s,p,r,C,e),T.add(E[0]-k[0],E[1]-k[1],E[2]-k[2],O[0]-k[0],O[1]-k[1],O[2]-k[2],s,p,r,C,e))}else n===C1.Disk&&(w1(y1,E1(y1,O,E),.475),T1(E,E,y1),E1(O,O,y1),T.add(E[0],E[1],E[2],O[0],O[1],O[2],1,p,r,C,e))}let M=T.getCylinders();if(j===0)return{cylinders:M};B.scale(A,A,1/j);let N=r?q.clone(r.boundingSphere):void 0;return N&&B.distance(A,N.center)/N.radius<.1?{cylinders:M,boundingSphere:N}:{cylinders:M}}function A1(e,t,n,r){let{linkCount:i,referencePosition:a,position:o,style:s,ignore:c}=t;if(!i)return{lines:vP.createEmpty(r)};let{linkScale:l,linkSpacing:u,aromaticDashCount:d,dashCount:f}=n,p=i*2,m=_P.create(p,p/4,r),h=B(),g=B(),_=B(),v=B(),y=B(),b=0;for(let e=0,t=i;e<t;++e){if(c&&c(e))continue;o(h,g,e,!0),T1(y,y,h),T1(y,y,g),b+=2;let t=s?s(e):C1.Solid;if(t===C1.Solid)w1(_,T1(_,h,g),.5),m.add(h[0],h[1],h[2],_[0],_[1],_[2],e);else if(t===C1.Dashed)w1(_,T1(_,h,g),.5),m.addFixedCountDashes(h,_,f,e);else if(t===C1.Double||t===C1.OffsetDouble||t===C1.Triple||t===C1.OffsetTriple||t===C1.Aromatic||t===C1.MirroredAromatic){let n=t===C1.Double||t===C1.OffsetDouble?2:t===C1.Triple||t===C1.OffsetTriple?3:1.5,r=(1-1*(l/(.5*n)))*u;if(w1(_,T1(_,h,g),.5),S1(v,h,g,a?a(e):null),t===C1.Aromatic||t===C1.MirroredAromatic){m.add(h[0],h[1],h[2],_[0],_[1],_[2],e);let n=r*4.5;D1(y1,E1(y1,g,h),n*.5),T1(h,h,y1),D1(v,v,n),E1(h,h,v),E1(_,_,v),m.addFixedCountDashes(h,_,d,e),t===C1.MirroredAromatic&&(D1(v,v,n*2),T1(h,h,v),T1(_,_,v),m.addFixedCountDashes(h,_,d,e))}else t===C1.OffsetDouble||t===C1.OffsetTriple?(D1(v,v,r*3),m.add(h[0],h[1],h[2],_[0],_[1],_[2],e),w1(y1,E1(y1,h,_),u*l),E1(h,h,y1),n===3&&m.add(h[0]+v[0],h[1]+v[1],h[2]+v[2],_[0]+v[0],_[1]+v[1],_[2]+v[2],e),m.add(h[0]-v[0],h[1]-v[1],h[2]-v[2],_[0]-v[0],_[1]-v[1],_[2]-v[2],e)):(D1(v,v,r*1.5),n===3&&m.add(h[0],h[1],h[2],_[0],_[1],_[2],e),m.add(h[0]+v[0],h[1]+v[1],h[2]+v[2],_[0]+v[0],_[1]+v[1],_[2]+v[2],e),m.add(h[0]-v[0],h[1]-v[1],h[2]-v[2],_[0]-v[0],_[1]-v[1],_[2]-v[2],e))}else t===C1.Disk&&(w1(y1,E1(y1,_,h),.475),T1(h,h,y1),E1(_,_,y1),m.add(h[0],h[1],h[2],_[0],_[1],_[2],e))}let x=m.getLines();if(b===0)return{lines:x};B.scale(y,y,1/b);let S=r?q.clone(r.boundingSphere):void 0;return S&&B.distance(y,S.center)/S.radius<.1?{lines:x,boundingSphere:S}:{lines:x}}const x1e={sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),dashCount:V.Numeric(6,{min:1,max:10,step:1}),dashScale:V.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),includeParent:V.Boolean(!1),parentDisplay:V.Select(`stub`,V.arrayToOptions([`stub`,`full`,`between`]),{description:`Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.`})};async function S1e(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return HM.createEmpty(a);let c=iL.create(n,t),l=f1.get(n).value,u=l.unitsFeatures.get(t.id),d=l.unitsContacts.get(t.id),{x:f,y:p,z:m,members:h,offsets:g,types:_}=u,{edgeCount:v,a:y,b,edgeProps:{flag:x,type:S}}=d,{sizeFactor:C,ignoreHydrogens:w,ignoreHydrogensVariant:T,parentDisplay:E}=i;if(!v)return HM.createEmpty(a);let{elements:D,conformation:O}=t,k=B(),A=B(),j=B(),{mesh:M,boundingSphere:N}=O1(e,{linkCount:v*2,position:(e,r,i)=>{let a=S[i];if((!w||T!==`all`)&&(a===K$.HydrogenBond||a===K$.WeakHydrogenBond&&T!==`non-polar`)){let o=h[g[y[i]]],s=h[g[b[i]]];O.invariantPosition(D[o],A),O.invariantPosition(D[s],j);let c=B.distance(A,j),l=c;B.copy(e,A),B.copy(r,j);let u=a===K$.HydrogenBond?q$.HydrogenDonor:q$.WeakHydrogenDonor;_[g[y[i]]]===u?QQ(t,o,(r,i)=>{if(l$(n,t,D[i],`all`)){O.invariantPosition(D[i],k);let t=B.distance(k,j);t<c&&(c=t,B.copy(e,k))}}):QQ(t,s,(e,i)=>{if(l$(n,t,D[i],`all`)){O.invariantPosition(D[i],k);let e=B.distance(k,A);e<l&&(l=e,B.copy(r,k))}})}else B.set(e,f[y[i]],p[y[i]],m[y[i]]),B.set(r,f[b[i]],p[b[i]],m[b[i]])},style:e=>C1.Dashed,radius:e=>{c.element=D[h[g[y[e]]]];let t=r.size.size(c);c.element=D[h[g[b[e]]]];let n=r.size.size(c);return Math.min(t,n)*C},ignore:e=>{if(x[e]===G$.Filtered)return!0;if(s)if(E===`stub`){let t=y[e];for(let e=g[t],n=g[t+1];e<n;++e){let t=D[h[g[e]]];if(!Vk.has(s.elements,t))return!0}}else if(E===`full`||E===`between`){let t=!1,n=!1,r=y[e];for(let e=g[r],n=g[r+1];e<n;++e){let n=D[h[g[e]]];Vk.has(s.elements,n)||(t=!0)}let i=b[e];for(let e=g[i],t=g[i+1];e<t;++e){let t=D[h[g[e]]];Vk.has(s.elements,t)||(n=!0)}return E===`full`?t&&n:t===n}else Lb(E);return!1}},i,a);if(N)M.setBoundingSphere(N);else if(M.triangleCount>0){let e=q.expand(q(),(s??t).boundary.sphere,1*C);M.setBoundingSphere(e)}return M}const C1e={...b$,...v1,...x1e};function w1e(e){return x$({defaultProps:V.getDefaultValues(C1e),createGeometry:S1e,createLocationIterator:D1e,getLoci:T1e,eachLocation:E1e,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.radialSegments!==n.radialSegments||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.parentDisplay!==n.parentDisplay;let s=f1.get(a.structure).version;e.info.interactionsHash!==s&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.info.interactionsHash=s)}},e)}function T1e(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=e.unitMap.get(n.units[i].id),o=f1.get(e).value,{a:s,b:c}=o.unitsContacts.get(r.id);return l1.Loci(e,o,[{unitA:r,indexA:s[a],unitB:r,indexB:c[a]},{unitA:r,indexA:c[a],unitB:r,indexB:s[a]}])}return hq}var j1=new Set;function E1e(e,t,n,r){let i=!1;if(l1.isLoci(e)){let{structure:r,group:a}=t;if(!nB.areEquivalent(e.data.structure,r))return!1;let o=f1.get(r).value;if(e.data.interactions!==o)return!1;let s=a.units[0],c=o.unitsContacts.get(s.id),l=c.edgeCount*2;for(let t of e.elements){if(t.unitA!==t.unitB)continue;let e=a.unitIndexMap.get(t.unitA.id);if(e!==void 0){let r=c.getDirectedEdgeIndex(t.indexA,t.indexB);r!==-1&&n(G.ofSingleton(e*l+r))&&(i=!0)}}}else if($.is(e)){let{structure:a,group:o}=t;if(!nB.areEquivalent(e.structure,a))return!1;let s=f1.get(a).value;if(!s)return!1;let c=o.units[0],l=s.unitsContacts.get(c.id),u=s.unitsFeatures.get(c.id),d=l.edgeCount*2,{offset:f}=l,{offsets:p,indices:m}=u.elementsIndex,{members:h,offsets:g}=u;for(let t of e.elements){let e=o.unitIndexMap.get(t.unit.id);e!==void 0&&(K.forEach(t.indices,e=>{for(let t=p[e],n=p[e+1];t<n;++t){let e=m[t];for(let t=f[e],n=f[e+1];t<n;++t)j1.add(t)}}),j1.forEach(a=>{if(r){let e=l.a[a];for(let n=g[e],r=g[e+1];n<r;++n)if(!K.has(t.indices,h[n]))return;let n=l.b[a];for(let e=g[n],r=g[n+1];e<r;++e)if(!K.has(t.indices,h[e]))return}n(G.ofSingleton(e*d+a))&&(i=!0)}),j1.clear())}}return i}function D1e(e){let{structure:t,group:n}=e,r=n.units[0],i=f1.get(t).value,a=i.unitsContacts.get(r.id),o=a.edgeCount*2,s=n.units.length,c=l1.Location(i,t),{element:l}=c;return tj(o,s,1,(e,t)=>{let r=n.units[t];return l.unitA=r,l.indexA=a.a[e],l.unitB=r,l.indexB=a.b[e],c})}function O1e(e,t,n,r,i){if(!t.hasAtomic)return HM.createEmpty(i);let a=iL.create(t),{contacts:o,unitsFeatures:s}=f1.get(t).value,{edgeCount:c,edges:l}=o,{sizeFactor:u,ignoreHydrogens:d,ignoreHydrogensVariant:f,parentDisplay:p}=r;if(!c)return HM.createEmpty(i);let{child:m}=t,h=B(),g=B(),_=B(),{mesh:v,boundingSphere:y}=O1(e,{linkCount:c,position:(e,n,r)=>{let{unitA:i,indexA:a,unitB:o,indexB:c,props:{type:u}}=l[r],p=s.get(i),m=s.get(o),v=t.unitMap.get(i),y=t.unitMap.get(o);if((!d||f!==`all`)&&(u===K$.HydrogenBond||u===K$.WeakHydrogenBond&&f!==`non-polar`)){let r=p.members[p.offsets[a]],i=m.members[m.offsets[c]];v.conformation.position(v.elements[r],g),y.conformation.position(y.elements[i],_);let o=B.distance(g,_),s=o;B.copy(e,g),B.copy(n,_);let l=u===K$.HydrogenBond?q$.HydrogenDonor:q$.WeakHydrogenDonor;p.types[p.offsets[a]]===l?$Q(t,v,r,(n,r)=>{let i=n.elements[r];if(l$(t,n,i,`all`)){n.conformation.position(i,h);let t=B.distance(h,_);t<o&&(o=t,B.copy(e,h))}}):$Q(t,y,i,(e,r)=>{let i=e.elements[r];if(l$(t,e,i,`all`)){e.conformation.position(i,h);let t=B.distance(h,g);t<s&&(s=t,B.copy(n,h))}})}else B.set(e,p.x[a],p.y[a],p.z[a]),B.transformMat4(e,e,v.conformation.operator.matrix),B.set(n,m.x[c],m.y[c],m.z[c]),B.transformMat4(n,n,y.conformation.operator.matrix)},style:e=>C1.Dashed,radius:e=>{let r=l[e],i=s.get(r.unitA);a.unit=t.unitMap.get(r.unitA),a.element=a.unit.elements[i.members[i.offsets[r.indexA]]];let o=n.size.size(a),c=s.get(r.unitB);a.unit=t.unitMap.get(r.unitB),a.element=a.unit.elements[c.members[c.offsets[r.indexB]]];let d=n.size.size(a);return Math.min(o,d)*u},ignore:e=>{if(l[e].props.flag===G$.Filtered)return!0;if(m){let n=l[e];if(p===`stub`){let e=m.unitMap.get(n.unitA);if(!e)return!0;let r=t.unitMap.get(n.unitA),{offsets:i,members:a}=s.get(n.unitA);for(let t=i[n.indexA],o=i[n.indexA+1];t<o;++t){let n=r.elements[a[t]];if(!Vk.has(e.elements,n))return!0}}else if(p===`full`||p===`between`){let e=!1,r=!1,i=m.unitMap.get(n.unitA);if(!i)e=!0;else{let r=t.unitMap.get(n.unitA),{offsets:a,members:o}=s.get(n.unitA);for(let t=a[n.indexA],s=a[n.indexA+1];t<s;++t){let n=r.elements[o[t]];Vk.has(i.elements,n)||(e=!0)}}let a=m.unitMap.get(n.unitB);if(!a)r=!0;else{let e=t.unitMap.get(n.unitB),{offsets:i,members:o}=s.get(n.unitB);for(let t=i[n.indexB],s=i[n.indexB+1];t<s;++t){let n=e.elements[o[t]];Vk.has(a.elements,n)||(r=!0)}}return p===`full`?e&&r:e===r}else Lb(p)}return!1}},r,i);if(y)v.setBoundingSphere(y);else if(v.triangleCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*u);v.setBoundingSphere(n)}return v}const k1e={...m$,...v1,...x1e};function A1e(e){return h$({defaultProps:V.getDefaultValues(k1e),createGeometry:O1e,createLocationIterator:N1e,getLoci:j1e,eachLocation:M1e,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.radialSegments!==n.radialSegments||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.parentDisplay!==n.parentDisplay;let s=f1.get(a).version;e.info.interactionsHash!==s&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.info.interactionsHash=s)}},e)}function j1e(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){let e=f1.get(t).value,n=e.contacts.edges[i],r=t.unitMap.get(n.unitA),a=t.unitMap.get(n.unitB);return l1.Loci(t,e,[{unitA:r,indexA:n.indexA,unitB:a,indexB:n.indexB},{unitA:a,indexA:n.indexB,unitB:r,indexB:n.indexA}])}return hq}var M1=new Map,N1=new Set;function M1e(e,t,n,r){let i=!1;if(l1.isLoci(e)){if(!nB.areEquivalent(e.data.structure,t))return!1;let r=f1.get(t).value;if(e.data.interactions!==r)return!1;let{contacts:a}=r;for(let t of e.elements){let e=a.getEdgeIndex(t.indexA,t.unitA.id,t.indexB,t.unitB.id);e!==-1&&n(G.ofSingleton(e))&&(i=!0)}}else if($.is(e)){if(!nB.areEquivalent(e.structure,t)||r&&e.elements.length===1)return!1;let a=f1.get(t).value;if(!a)return!1;let{contacts:o,unitsFeatures:s}=a;for(let t of e.elements)M1.set(t.unit.id,t.indices);for(let t of e.elements){let{unit:e}=t;Q.isAtomic(e)&&K.forEach(t.indices,t=>{for(let n of o.getContactIndicesForElement(t,e))N1.add(n)})}N1.forEach(e=>{if(r){let{indexA:t,unitA:n,indexB:r,unitB:i}=o.edges[e],a=M1.get(n),c=M1.get(i);if(!a||!c)return;let{offsets:l,members:u}=s.get(n);for(let e=l[t],n=l[t+1];e<n;++e)if(!K.has(a,u[e]))return;let{offsets:d,members:f}=s.get(i);for(let e=d[r],t=d[r+1];e<t;++e)if(!K.has(c,f[e]))return}n(G.ofSingleton(e))&&(i=!0)}),M1.clear(),N1.clear()}return i}function N1e(e){let t=f1.get(e).value,{contacts:n}=t,r=n.edgeCount,i=l1.Location(t,e),{element:a}=i;return tj(r,1,1,t=>{let r=n.edges[t];return a.unitA=e.unitMap.get(r.unitA),a.indexA=r.indexA,a.unitB=e.unitMap.get(r.unitB),a.indexB=r.indexB,i},!0)}var P1e={"intra-unit":(e,t)=>v$(`Intra-unit interactions cylinder`,e,t,w1e),"inter-unit":(e,t)=>GQ(`Inter-unit interactions cylinder`,e,t,A1e)};const F1e={...C1e,...k1e,unitKinds:d$([`atomic`]),sizeFactor:V.Numeric(.2,{min:.01,max:1,step:.01}),visuals:V.MultiSelect([`intra-unit`,`inter-unit`],V.objectToOptions(P1e))};function I1e(e,t){return V.clone(F1e)}function L1e(e,t){return rJ.createMulti(`Interactions`,e,t,O$,P1e)}const P1=k$({name:`interactions`,label:`Non-covalent Interactions`,description:`Displays non-covalent interactions as dashed cylinders.`,factory:L1e,getParams:I1e,defaultValues:V.getDefaultValues(F1e),defaultColorTheme:{name:`interaction-type`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.elementCount>0&&f1.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>f1.attach(e,t,void 0,!0),detach:e=>f1.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent});var F1=tE(13421772),R1e=`Assigns colors according the interaction type of a link.`,I1=rE({HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404}),z1e=[[`Hydrogen Bond`,I1.HydrogenBond],[`Hydrophobic`,I1.Hydrophobic],[`Halogen Bond`,I1.HalogenBond],[`Ionic`,I1.Ionic],[`Metal Coordination`,I1.MetalCoordination],[`Cation Pi`,I1.CationPi],[`Pi Stacking`,I1.PiStacking],[`Weak HydrogenBond`,I1.WeakHydrogenBond]];function B1e(e){switch(e){case K$.HydrogenBond:return I1.HydrogenBond;case K$.Hydrophobic:return I1.Hydrophobic;case K$.HalogenBond:return I1.HalogenBond;case K$.Ionic:return I1.Ionic;case K$.MetalCoordination:return I1.MetalCoordination;case K$.CationPi:return I1.CationPi;case K$.PiStacking:return I1.PiStacking;case K$.WeakHydrogenBond:return I1.WeakHydrogenBond;case K$.Unknown:return F1}}const V1e={};function H1e(e){return V1e}function U1e(e,t){let n,r=e.structure?f1.get(e.structure):void 0,i=r?dE(r.id,r.version):-1;return n=r&&r.value?e=>{if(l1.isLocation(e)){let{unitsContacts:t,contacts:n}=e.data.interactions,{unitA:r,unitB:i,indexA:a,indexB:o}=e.element;if(r===i){let e=t.get(r.id),n=e.getDirectedEdgeIndex(a,o);return B1e(e.edgeProps.type[n])}else{let e=n.getEdgeIndex(a,r.id,o,i.id);return B1e(n.edges[e].props.type)}}return F1}:()=>F1,{factory:U1e,granularity:`group`,color:n,props:t,contextHash:i,description:R1e,legend:wk(z1e)}}const L1={name:`interaction-type`,label:`Interaction Type`,category:mM.Misc,factory:U1e,getParams:H1e,defaultValues:V.getDefaultValues(V1e),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?f1.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&f1.ref(e.structure,!1)}};function R1(e,t,n={}){let r=n;return typeof r.type==`string`||typeof r.color==`string`||typeof r.size==`string`?K1e(e,t||nB.Empty,n):q1e(e,t||nB.Empty,n)}function W1e(e,t){let{themes:n}=e.representation.structure;return t?n.colorThemeRegistry.getApplicableTypes({structure:t}):n.colorThemeRegistry.types}function z1(e,t,n,r,i){let{registry:a,themes:o}=e.representation.structure,s=a.get(n||a.default.name),c=o.colorThemeRegistry.get(r||s.defaultColorTheme.name),l=V.getDefaultValues(c.getParams({structure:t||nB.Empty}));return c.name===s.defaultColorTheme.name&&Object.assign(l,s.defaultColorTheme.props),{name:c.name,params:Object.assign(l,i)}}function G1e(e,t,n,r,i){let{registry:a,themes:o}=e.representation.structure,s=a.get(n||a.default.name),c=o.sizeThemeRegistry.get(r||s.defaultSizeTheme.name),l=V.getDefaultValues(c.getParams({structure:t||nB.Empty}));return c.name===s.defaultSizeTheme.name&&Object.assign(l,s.defaultSizeTheme.props),{name:c.name,params:Object.assign(l,i)}}function K1e(e,t,n){let r=n.type&&e.representation.structure.registry.get(n.type)||e.representation.structure.registry.default.provider,i=n.color&&e.representation.structure.themes.colorThemeRegistry.get(n.color)||e.representation.structure.themes.colorThemeRegistry.get(r.defaultColorTheme.name),a=n.size&&e.representation.structure.themes.sizeThemeRegistry.get(n.size)||e.representation.structure.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name);return q1e(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:a,sizeParams:n.sizeParams})}function q1e(e,t,n={}){let{themes:r}=e.representation.structure,i={structure:t},a=n.type||e.representation.structure.registry.default.provider,o=V.getDefaultValues(a.getParams(r,t)),s=Object.assign(o,n.typeParams),c=n.color||r.colorThemeRegistry.get(a.defaultColorTheme.name),l=V.getDefaultValues(c.getParams(i));c.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);let u=Object.assign(l,n.colorParams),d=n.size||r.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=V.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);let p=Object.assign(f,n.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:c.name,params:u},sizeTheme:{name:d.name,params:p}}}var B1;(function(e){class t extends H.Create({name:`Root`,typeClass:`Root`}){}e.Root=t;class n extends H.Create({name:`Category`,typeClass:`Object`}){}e.Category=n;class r extends H.CreateBehavior({name:`Behavior`}){}e.Behavior=r,e.Categories={common:`Common`,representation:`Representation`,interaction:`Interaction`,"custom-props":`Custom Properties`,misc:`Miscellaneous`},e.CreateCategory=AD.BuiltIn({name:`create-behavior-category`,display:{name:`Behavior Category`},from:t,to:n,params:{label:V.Text(``,{isHidden:!0})}})({apply({params:e}){return new n({},{label:e.label})}});let i=new Map;function a(e){return i.get(e.id)}e.getCategoryId=a;function o(e){let n=AD.CreateBuiltIn({name:e.name,display:e.display,from:[t],to:[r],params:e.params,apply({params:t},n){let i=e.label?e.label(t):{label:e.display.name,description:e.display.description};return new r(new e.ctor(n,t),i)},update({b:e,newParams:t}){return hb.create(`Update Behavior`,async()=>e.data.update&&await e.data.update(t)?lE.UpdateResult.Updated:lE.UpdateResult.Unchanged)},canAutoUpdate:e.canAutoUpdate});return i.set(n.id,e.category),n}e.create=o;function s(e,t){return class{register(){this.sub=e.subscribe(this.ctx,e=>t(e,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}constructor(e){this.ctx=e,this.sub=void 0}}}e.simpleCommandHandler=s;class c{subscribeCommand(e,t){this.subs.push(e.subscribe(this.ctx,t))}subscribeObservable(e,t){this.subs.push(e.subscribe(t))}track(e){this.subs.push(e)}dispose(){for(let e of this.subs)e.unsubscribe();this.subs=[]}update(e){return Dx(e,this.params)?!1:(this.params=e,!0)}constructor(e,t){this.ctx=e,this.params=t,this.subs=[]}}e.Handler=c;class l{subscribeCommand(e,t){this.subs.push(e.subscribe(this.plugin,t))}subscribeObservable(e,t){let n=e.subscribe(t);return this.subs.push(n),{unsubscribe:()=>{let e=this.subs.indexOf(n);e>=0&&(this.subs.splice(e,1),n.unsubscribe())}}}dispose(){for(let e of this.subs)e.unsubscribe();this.subs=[]}constructor(e,t){this.plugin=e,this.params=t,this.subs=[]}}e.WithSubscribers=l})(B1||={});function V1(){return V1.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function n(e,t,n,r){return{x:e,y:t,width:n,height:r}}e.create=n;function r(e){return{...e}}e.clone=r;function i(e,t){return Object.assign(e,t)}e.copy=i;function a(e,t,n,r,i){return e.x=t,e.y=n,e.width=r,e.height=i,e}e.set=a;function o(e,t){return e[0]=t.x,e[1]=t.y,e[2]=t.width,e[3]=t.height,e}e.toVec4=o;function s(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}e.equals=s})(V1||={});var H1=AO();function J1e(e,t,n,r){let{x:i,y:a,width:o,height:s}=n;AO.set(H1,t[0],t[1],t[2],1),AO.transformMat4(H1,H1,r);let c=H1[3];return c!==0&&(H1[0]/=c,H1[1]/=c,H1[2]/=c),e[0]=(H1[0]+1)*o*.5+i,e[1]=(H1[1]+1)*s*.5+a,e[2]=(H1[2]+1)*.5,e[3]=c===0?0:1/c,e}function U1(e,t,n,r){let{x:i,y:a,width:o,height:s}=n,c=t[0]-i,l=t[1]-a,u=t[2];return e[0]=2*c/o-1,e[1]=2*l/s-1,e[2]=2*u-1,B.transformMat4(e,e,r)}function W1(e){if(typeof e==`object`){if(`buttons`in e)return e.buttons;if(`which`in e){let t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function G1(e){if(typeof e==`object`&&`button`in e){let t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function K1(e){return{alt:`altKey`in e?e.altKey:!1,shift:`shiftKey`in e?e.shiftKey:!1,control:`ctrlKey`in e?e.ctrlKey:!1,meta:`metaKey`in e?e.metaKey:!1}}const Y1e={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1};var q1;(function(e){e.None=i();function t(e,t){return e.shift===t.shift&&e.alt===t.alt&&e.control===t.control&&e.meta===t.meta}e.areEqual=t;function n(n){return t(n,e.None)}e.areNone=n;function r(e){if(!e)return 0;let t=0;return e.shift&&t++,e.alt&&t++,e.control&&t++,e.meta&&t++,t}e.size=r;function i(e={}){return{shift:!!e.shift,alt:!!e.alt,control:!!e.control,meta:!!e.meta}}e.create=i})(q1||={});var J1;(function(e){e.has=_x.has,e.create=_x.create,(function(e){e[e.None=0]=`None`,e[e.Primary=1]=`Primary`,e[e.Secondary=2]=`Secondary`,e[e.Auxilary=4]=`Auxilary`,e[e.Forth=8]=`Forth`,e[e.Five=16]=`Five`,e[e.Trigger=32]=`Trigger`,e[e.Squeeze=48]=`Squeeze`})(e.Flag||={})})(J1||={});const X1e={key:``,code:``,modifiers:q1.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:xx};var Y1;(function(e){e[e.Stopped=0]=`Stopped`,e[e.Started=1]=`Started`,e[e.Moving=2]=`Moving`})(Y1||={});function Z1e(){return{drag:new sD,interactionEnd:new sD,click:new sD,move:new sD,wheel:new sD,pinch:new sD,gesture:new sD,resize:new sD,leave:new sD,enter:new sD,modifiers:new sD,key:new sD,keyUp:new sD,keyDown:new sD,lock:new sD,trackedPointers:new sD}}var Q1e=[`Backspace`,`Delete`],$1e;(function(e){function t(e={}){let{noScroll:t,noContextMenu:n}={...Y1e,...e};return{noScroll:t,noContextMenu:n,pointerLock:!1,width:0,height:0,pixelRatio:1,...Z1e(),setPixelScale:xx,updateTrackedPointers:xx,updateScreenTouches:xx,requestPointerLock:xx,exitPointerLock:xx,dispose:xx}}e.create=t;function n(e,t={}){let{noScroll:n,noMiddleClickScroll:r,noContextMenu:i,noPinchZoom:a,noTextSelect:o,mask:s,pixelScale:c,preventGestures:l}={...Y1e,...t},u=e.clientWidth*x(),d=e.clientHeight*x(),f=!1,p=V1(),m=R(),h=R(),g=R(),_=R(),v=R(),y={shift:!1,alt:!1,control:!1,meta:!1},b={x:-1,y:-1,pageX:-1,pageY:-1};function x(){return window.devicePixelRatio*c}function S(){return{...y}}function C(t){return t.target===document.body||t.target===e}let w=Y1.Stopped,T=!1,E=J1.create(J1.Flag.None),D=J1.Flag.None,O=!1,k=!1,A;window.ResizeObserver!==void 0&&(A=new window.ResizeObserver(ot));let j=Z1e(),{drag:M,interactionEnd:N,wheel:ee,pinch:te,gesture:P,click:ne,move:re,leave:ie,enter:ae,resize:oe,modifiers:se,key:ce,keyUp:le,keyDown:ue,lock:de,trackedPointers:fe}=j;pe();function pe(){e.addEventListener(`contextmenu`,_e,!1),e.addEventListener(`wheel`,Qe,!1),e.addEventListener(`mousedown`,Ke,!1),window.addEventListener(`mousemove`,qe,!1),window.addEventListener(`mouseup`,Je,!1),e.addEventListener(`touchstart`,Ue,!1),e.addEventListener(`touchmove`,Ge,!1),e.addEventListener(`touchend`,We,!1),e.addEventListener(`gesturechange`,it,!1),e.addEventListener(`gesturestart`,nt,!1),e.addEventListener(`gestureend`,at,!1),window.addEventListener(`blur`,ye),window.addEventListener(`keyup`,xe,!1),window.addEventListener(`keydown`,be,!1),window.addEventListener(`keypress`,Se,!1),document.addEventListener(`pointerlockchange`,he,!1),document.addEventListener(`pointerlockerror`,ge,!1),A==null?window.addEventListener(`resize`,ot,!1):A.observe(e.parentElement)}function me(){T||(T=!0,e.removeEventListener(`contextmenu`,_e,!1),e.removeEventListener(`wheel`,Qe,!1),e.removeEventListener(`mousedown`,Ke,!1),window.removeEventListener(`mousemove`,qe,!1),window.removeEventListener(`mouseup`,Je,!1),e.removeEventListener(`touchstart`,Ue,!1),e.removeEventListener(`touchmove`,Ge,!1),e.removeEventListener(`touchend`,We,!1),e.removeEventListener(`gesturechange`,it,!1),e.removeEventListener(`gesturestart`,nt,!1),e.removeEventListener(`gestureend`,at,!1),window.removeEventListener(`blur`,ye),window.removeEventListener(`keyup`,xe,!1),window.removeEventListener(`keydown`,be,!1),window.removeEventListener(`keypress`,Se,!1),document.removeEventListener(`pointerlockchange`,he,!1),document.removeEventListener(`pointerlockerror`,ge,!1),dt.remove(),A==null?window.removeEventListener(`resize`,ot,!1):(A.unobserve(e.parentElement),A.disconnect()))}function he(){f=e.ownerDocument.pointerLockElement===e,pt(f),de.next(f)}function ge(){console.error(`Unable to use Pointer Lock API`),f=!1,pt(f),de.next(f)}function _e(e){s(e.clientX,e.clientY)&&i&&e.preventDefault()}function ve(e){y.alt=e.altKey,y.shift=e.shiftKey,y.control=e.ctrlKey,y.meta=e.metaKey}function ye(){(E||y.shift||y.alt||y.meta||y.control)&&(E=0,y.shift=y.alt=y.control=y.meta=!1)}function be(e){let t=!1;!y.alt&&e.altKey&&(t=!0,y.alt=!0),!y.shift&&e.shiftKey&&(t=!0,y.shift=!0),!y.control&&e.ctrlKey&&(t=!0,y.control=!0),!y.meta&&e.metaKey&&(t=!0,y.meta=!0),t&&O&&se.next(S()),C(e)&&O&&ue.next({key:e.key,code:e.code,modifiers:S(),...b,preventDefault:()=>e.preventDefault()})}function xe(e){let t=!1;y.alt&&!e.altKey&&(t=!0,y.alt=!1),y.shift&&!e.shiftKey&&(t=!0,y.shift=!1),y.control&&!e.ctrlKey&&(t=!0,y.control=!1),y.meta&&!e.metaKey&&(t=!0,y.meta=!1),t&&O&&se.next(S()),Q1e.includes(e.key)&&Se(e),C(e)&&O&&le.next({key:e.key,code:e.code,modifiers:S(),...b,preventDefault:()=>e.preventDefault()})}function Se(e){!C(e)||!O||ce.next({key:e.key,code:e.code,modifiers:S(),...b,preventDefault:()=>e.preventDefault()})}let Ce={primary:{prev:void 0,down:R(),end:R(),axes:[]},secondary:{prev:void 0,down:R(),end:R(),axes:[]},distance:-1};function we(e,t,n){let r=J1.has(t,e);return(n?J1.has(n,e):!1)&&!r}function Te(e,t){let{x:n,y:r,dx:i,dy:a,ray:o,buttons:s,axes:c}=e,[l,u]=[n,r],d=q1.create(),f=t?Ce.secondary:Ce.primary,{prev:p}=f;s===J1.Flag.Secondary?re.next({x:n,y:r,pageX:l,pageY:u,buttons:J1.Flag.None,button:J1.Flag.None,modifiers:d,inside:!0,onElement:!0,ray:o}):p?.buttons===J1.Flag.Secondary&&ie.next(void 0);let m=J1.has(s,J1.Flag.Primary),h=p?J1.has(p.buttons,J1.Flag.Primary):!1;if(h&&!m&&(R.set(f.end,n,r),R.distance(f.end,f.down)<20&&ne.next({x:n,y:r,pageX:l,pageY:u,buttons:J1.Flag.Trigger,button:J1.Flag.Trigger,modifiers:d,ray:o}),N.next(void 0)),m){let e=!h;M.next({x:n,y:r,dx:i,dy:a,pageX:l,pageY:u,buttons:J1.Flag.Trigger,button:J1.Flag.Trigger,modifiers:d,isStart:e,useDelta:!0}),e&&R.set(f.down,n,r)}let g={x:0,y:0,pageX:0,pageY:0,modifiers:d,preventDefault:()=>{}};if(we(J1.Flag.Forth,s,p?.buttons)){let e=t?`GamepadX`:`GamepadA`;le.next({...g,code:e,key:e})}if(we(J1.Flag.Five,s,p?.buttons)){let e=t?`GamepadY`:`GamepadB`;le.next({...g,code:e,key:e})}c&&(c[2]<0?(ue.next({...g,code:`GamepadLeft`,key:`GamepadLeft`}),le.next({...g,code:`GamepadRight`,key:`GamepadRight`})):c[2]>0?(ue.next({...g,code:`GamepadRight`,key:`GamepadRight`}),le.next({...g,code:`GamepadLeft`,key:`GamepadLeft`})):c[2]!==f.axes[2]&&(le.next({...g,code:`GamepadLeft`,key:`GamepadLeft`}),le.next({...g,code:`GamepadRight`,key:`GamepadRight`})),c[3]<0?(ue.next({...g,code:`GamepadUp`,key:`GamepadUp`}),le.next({...g,code:`GamepadDown`,key:`GamepadDown`})):c[3]>0?(ue.next({...g,code:`GamepadDown`,key:`GamepadDown`}),le.next({...g,code:`GamepadUp`,key:`GamepadUp`})):c[3]!==f.axes[3]&&(le.next({...g,code:`GamepadUp`,key:`GamepadUp`}),le.next({...g,code:`GamepadDown`,key:`GamepadDown`}))),f.axes=c||[],f.prev=e}function Ee(e,t,n){let r=B.distance(e.ray.origin,t.ray.origin);if(Ce.distance>0){let e=r/Ce.distance;P.next({scale:e,rotation:0,deltaScale:0,deltaRotation:0,buttons:n,button:n,modifiers:S()})}Ce.distance=r}function De(e){let t,n;for(let r of e)r.handedness===`right`?t=r:r.handedness===`left`&&(n=r);!t&&n&&(t=n,n=void 0),t?.buttons===J1.Flag.Primary&&n?.buttons===J1.Flag.Primary?Ee(t,n,J1.Flag.Trigger):t?.buttons===J1.Flag.Secondary&&n?.buttons===J1.Flag.Secondary?Ee(t,n,J1.Flag.Squeeze):(Ce.distance===-1&&(t&&Te(t,!1),n&&Te(n,!0)),!t?.buttons&&!n?.buttons&&(Ce.distance=-1))}let Oe,ke,Ae=-1;function je(e){if(e.length===2){let t=R.fromObj(e[0]),n=R.fromObj(e[1]),r=R.distance(t,n),i=J1.Flag.Trigger;if(Ae>0){let e=r/Ae;P.next({scale:e,rotation:0,deltaScale:0,deltaRotation:0,buttons:i,button:i,modifiers:S()})}Ae=r,Oe=void 0;return}Ae=-1;let t=e[0];if(!t){if(ke&&Oe){let e=R.fromObj(ke),t=R.fromObj(Oe);if(R.distance(e,t)<10){let[t,n]=e,[r,i]=[t,n],a=q1.create(),o=J1.Flag.Trigger,{ray:s}=ke;ne.next({x:t,y:n,pageX:r,pageY:i,buttons:o,button:o,modifiers:a,ray:s})}N.next(void 0)}Oe=void 0,ke=void 0;return}let[n,r]=R.fromObj(t),[i,a]=[n,r],o=q1.create(),s=J1.Flag.Trigger,c=Oe===void 0,l=Oe?n-Oe.x:0,u=Oe?r-Oe.y:0;Oe=t,c&&(ke=t),M.next({x:n,y:r,dx:l,dy:u,pageX:i,pageY:a,buttons:s,button:s,modifiers:o,isStart:c,useDelta:!0})}function Me(e){let t=e.touches[0],n=e.touches[1];return{clientX:(t.clientX+n.clientX)/2,clientY:(t.clientY+n.clientY)/2,pageX:(t.pageX+n.pageX)/2,pageY:(t.pageY+n.pageY)/2,target:e.target}}function Ne(e){let t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+n*n)}let Pe=-1,Fe,Ie=R(),Le=R();function Re(e){Pe<0||(R.set(Le,e.touches[0].pageX,e.touches[0].pageY),Pe+=R.distance(Ie,Le),R.copy(Ie,Le))}let ze=R(),Be=!1,Ve=0,He=1;function Ue(e){if(e.preventDefault(),Fe=void 0,Pe=-1,e.touches.length===1)E=D=J1.Flag.Primary,Pe=0,R.set(Ie,e.touches[0].pageX,e.touches[0].pageY),Fe=e.touches[0],Xe(e.touches[0]),R.copy(ze,h),Be=!0;else if(e.touches.length===2){E=J1.Flag.Secondary|J1.Flag.Auxilary,D=J1.Flag.Secondary,ve(e),He=1,Ve=Ne(e);let{pageX:t,pageY:n}=ut(Me(e));Be||=(lt(ze,Me(e)),!0),te.next({isStart:!0,distance:Ve,delta:0,fraction:He,fractionDelta:0,startX:ze[0],startY:ze[1],centerPageX:t,centerPageY:n,buttons:E,button:D,modifiers:S()})}else e.touches.length===3&&(E=D=J1.Flag.Forth,Xe(Me(e)))}function We(e){if(Ye(),Fe&&Pe<=4){let e=Fe;if(!s(e.clientX,e.clientY))return;lt(Le,e);let{pageX:t,pageY:n}=ut(e),[r,i]=Le;ne.next({x:r,y:i,pageX:t,pageY:n,buttons:E,button:D,modifiers:S()})}Fe=void 0,Be=!1}function Ge(e){if(D=J1.Flag.None,a&&(e.preventDefault(),e.stopPropagation(),e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation())),Fe=void 0,e.touches.length===1)E=J1.Flag.Primary,Fe=e.touches[0],Re(e),Ze(e.touches[0]);else if(e.touches.length===2){E=J1.Flag.Secondary|J1.Flag.Auxilary,D=J1.Flag.Secondary,ve(e);let{pageX:t,pageY:n}=ut(Me(e)),r=Ne(e),i=Ve-r,a=Ve/r,o=a-He;He=a,te.next({isStart:!1,distance:r,delta:i,fraction:a,fractionDelta:o,startX:ze[0],startY:ze[1],centerPageX:t,centerPageY:n,buttons:E,button:D,modifiers:S()})}else e.touches.length===3&&(E=J1.Flag.Forth,Ze(Me(e)))}function Ke(e){ve(e),E=W1(e),D=G1(e),r&&E===J1.Flag.Auxilary&&e.preventDefault,Xe(e)}function qe(e){ve(e),E=W1(e),D=J1.Flag.None,Ze(e)}function Je(e){ve(e),E=W1(e),D=G1(e),F(e),Ye()}function Ye(){N.next(void 0)}function Xe(e){s(e.clientX,e.clientY)&&(lt(h,e),R.copy(m,h),st(h)&&(w=Y1.Started))}function F(e){if(w=Y1.Stopped,s(e.clientX,e.clientY)){if(lt(g,e),!k&&R.distance(g,m)<4){let{pageX:t,pageY:n}=ut(e),[r,i]=g;ne.next({x:r,y:i,pageX:t,pageY:n,buttons:E,button:D,modifiers:S()})}k=!1}}function Ze(t){var n;lt(g,t);let{pageX:r,pageY:i}=ut(t),[a,c]=g,{movementX:l,movementY:u}=t,d=st(g)&&s(t.clientX,t.clientY);if(O&&!d?ie.next(void 0):!O&&d&&ae.next(void 0),O=d,b.x=a,b.y=c,b.pageX=r,b.pageY=i,re.next({x:a,y:c,pageX:r,pageY:i,movementX:l,movementY:u,buttons:E,button:D,modifiers:S(),inside:d,onElement:t.target===e}),w===Y1.Stopped||(o&&((n=t.preventDefault)==null||n.call(t)),R.div(_,R.sub(_,g,h),ct(v)),R.magnitude(_)<1e-6))return;let f=w===Y1.Started;if(f&&!s(t.clientX,t.clientY))return;R.distance(g,m)>=4&&(k=!0);let[p,y]=_;M.next({x:a,y:c,dx:p,dy:y,pageX:r,pageY:i,buttons:E,button:D,modifiers:S(),isStart:f}),R.copy(h,g),w=Y1.Moving}function Qe(e){if(!s(e.clientX,e.clientY))return;lt(g,e);let{pageX:t,pageY:r}=ut(e),[i,a]=g;n&&e.preventDefault();let o=e0e(e);E=D=J1.Flag.Auxilary,(o.dx||o.dy||o.dz)&&ee.next({x:i,y:a,pageX:t,pageY:r,...o,buttons:E,button:D,modifiers:S()})}function $e(e){var t,n;l&&(e.preventDefault(),(t=e.stopImmediatePropagation)==null||t.call(e),(n=e.stopPropagation)==null||n.call(e))}let et=0,tt=0;function nt(e){$e(e),et=e.scale,tt=e.rotation,P.next({scale:e.scale,rotation:e.rotation,deltaRotation:0,deltaScale:0,isStart:!0,buttons:E,button:D,modifiers:S()})}function rt(e,t){P.next({scale:e.scale,rotation:e.rotation,deltaRotation:tt-e.rotation,deltaScale:et-e.scale,isEnd:t,buttons:E,button:D,modifiers:S()}),tt=e.rotation,et=e.scale}function it(e){$e(e),rt(e)}function at(e){$e(e),rt(e,!0)}function ot(){u=e.clientWidth*x(),d=e.clientHeight*x(),oe.next({})}function st(t){if(e instanceof Window||e instanceof Document||e===document.body)return!0;{let n=e.getBoundingClientRect();return t[0]>=0&&t[1]>=0&&t[0]<n.width&&t[1]<n.height}}function ct(t){return t[0]=e.clientWidth,t[1]=e.clientHeight,t}function lt(t,n){if(u=e.clientWidth*x(),d=e.clientHeight*x(),f){let e=x();t[0]=(p.x+p.width/2)/e,t[1]=(d-(p.y+p.height/2))/e}else{let r=e.getBoundingClientRect();t[0]=(n.clientX||0)-r.left,t[1]=(n.clientY||0)-r.top}return t}function ut(e){return f?{pageX:Math.round(window.innerWidth/2)+p.x,pageY:Math.round(window.innerHeight/2)+p.y}:{pageX:e.pageX,pageY:e.pageY}}let dt=ft();function ft(){var t;let n=document.createElement(`div`),r=`#000 30%, #0000 0 calc(100% - 30%), #000 0`,i=`linear-gradient(0deg, ${r}) 50%/10% 100% no-repeat`,a=`linear-gradient(90deg, ${r}) 50%/100% 10% no-repeat`;return Object.assign(n.style,{width:`30px`,aspectRatio:1,background:`${i}, ${a}, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:`none`,zIndex:1e3,position:`absolute`,mixBlendMode:`difference`,filter:`invert(1)`}),(t=e.parentElement)==null||t.appendChild(n),n}function pt(e){if(dt.style.display=e?`block`:`none`,e){let e=x(),t=(p.x+p.width/2)/e,n=(p.y+p.height/2)/e;dt.style.width=`30px`,dt.style.left=`calc(${t}px - ${30/2}px)`,dt.style.bottom=`calc(${n}px - ${30/2}px)`}}return{get noScroll(){return n},set noScroll(e){n=e},get noContextMenu(){return i},set noContextMenu(e){i=e},get width(){return u},get height(){return d},get pixelRatio(){return x()},get pointerLock(){return f},...j,setPixelScale:t=>{c=t,u=e.clientWidth*x(),d=e.clientHeight*x()},updateTrackedPointers:e=>{De(e),fe.next(e)},updateScreenTouches:e=>{je(e)},requestPointerLock:t=>{p=t,f||e.requestPointerLock()},exitPointerLock:()=>{f&&e.ownerDocument.exitPointerLock()},dispose:me}}e.fromElement=n})($1e||={});function e0e(e){let t=0,n=0,r=0,i=0,a=0;return`detail`in e&&(n=e.detail),`wheelDelta`in e&&(n=-e.wheelDelta/120),`wheelDeltaY`in e&&(n=-e.wheelDeltaY/120),`wheelDeltaX`in e&&(t=-e.wheelDeltaX/120),`axis`in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=t*10,i=n*10,`deltaY`in e&&(i=e.deltaY),`deltaX`in e&&(r=e.deltaX),`deltaZ`in e&&(a=e.deltaZ),(r||i||a)&&e.deltaMode&&(e.deltaMode===1?(r*=40,i*=40,a*=40):(r*=800,i*=800,a*=800)),r&&!t&&(t=r<0?-1:1),i&&!n&&(n=i<0?-1:1),{spinX:t,spinY:n,dx:r,dy:i,dz:a}}var X1;(function(e){e[e.None=0]=`None`,e[e.Object=1]=`Object`,e[e.Instance=2]=`Instance`,e[e.Group=3]=`Group`})(X1||={});var Z1;(function(e){e[e.None=0]=`None`,e[e.Depth=1]=`Depth`,e[e.Mask=2]=`Mask`})(Z1||={});const Q1={backgroundColor:V.Color(tE(0),{description:`Background color of the 3D canvas`}),pickingAlphaThreshold:V.Numeric(.5,{min:0,max:1,step:.01},{description:`The minimum opacity value needed for an object to be pickable.`}),interiorDarkening:V.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:V.Boolean(!0,{label:`Use Interior Color`}),interiorColor:V.Color(tE.fromNormalizedRgb(.3,.3,.3)),colorMarker:V.Boolean(!0,{description:`Enable color marker`}),highlightColor:V.Color(tE.fromNormalizedRgb(1,.4,.6)),selectColor:V.Color(tE.fromNormalizedRgb(.2,1,.1)),dimColor:V.Color(tE.fromNormalizedRgb(1,1,1)),highlightStrength:V.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:V.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:V.Numeric(0,{min:0,max:1,step:.1}),markerPriority:V.Select(1,[[1,`Highlight`],[2,`Select`]]),xrayEdgeFalloff:V.Numeric(1,{min:0,max:3,step:.1}),celSteps:V.Numeric(5,{min:2,max:16,step:1}),exposure:V.Numeric(1,{min:0,max:3,step:.01}),light:V.ObjectList({inclination:V.Numeric(150,{min:0,max:180,step:1}),azimuth:V.Numeric(320,{min:0,max:360,step:1}),color:V.Color(tE.fromNormalizedRgb(1,1,1)),intensity:V.Numeric(.6,{min:0,max:5,step:.01})},e=>tE.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:tE.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:V.Color(tE.fromNormalizedRgb(1,1,1)),ambientIntensity:V.Numeric(.4,{min:0,max:2,step:.01})};var $1=B(),e0=B();function t0e(e,t){let n=e.length,{direction:r,color:i}=t||{direction:Array(n*3).fill(0),color:Array(n*3).fill(0)};for(let t=0;t<n;++t){let n=e[t];B.directionFromSpherical($1,FT(n.inclination),FT(n.azimuth),1),B.toArray($1,r,t*3),B.scale(e0,tE.toVec3Normalized(e0,n.color),n.intensity),B.toArray(e0,i,t*3)}return{count:n,direction:r,color:i}}function n0e(e,t){let n=Array(e.count*3);for(let r=0,i=e.count;r<i;++r)B.fromArray($1,e.direction,r*3),B.transformDirection($1,$1,t),B.toArray($1,n,r*3);return n}var r0e;(function(e){let t;(function(e){e[e.None=0]=`None`,e[e.BlendedFront=1]=`BlendedFront`,e[e.BlendedBack=2]=`BlendedBack`})(t||={});let n;(function(e){e[e.All=0]=`All`,e[e.Opaque=1]=`Opaque`,e[e.Transparent=2]=`Transparent`})(n||={});function r(e,r={}){let{gl:i,state:a,stats:o}=e,s=V.merge(Q1,V.getDefaultValues(Q1),r),c=t0e(s.light),l=V1(),u=R.create(i.drawingBufferWidth,i.drawingBufferHeight),d=tE.toVec3Normalized(B(),s.backgroundColor),f=!1,p=null,m=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`);m.define(1,1),m.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});let h=[[`tDepth`,m]],g=z(),_=z(),v=z(),y=z(),b=z(),x=z(),S=z(),C=z(),w=z(),T=z(),E=z(),D=B(),O=B(),k=B(),A=sF(),j=R(),M=cF(),N=1,ee=q(),te=B();B.scale(te,tE.toArrayNormalized(s.ambientColor,te,0),s.ambientIntensity);let P={uDrawId:L.create(0),uModel:L.create(z.identity()),uView:L.create(_),uInvView:L.create(v),uModelView:L.create(y),uInvModelView:L.create(b),uInvProjection:L.create(x),uProjection:L.create(z()),uModelViewProjection:L.create(S),uInvModelViewProjection:L.create(C),uHasHeadRotation:L.create(!1),uInvHeadRotation:L.create(w),uHasEyeCamera:L.create(!1),uModelViewEye:L.create(T),uInvModelViewEye:L.create(E),uIsAsymmetricProjection:L.create(!1),uIsOrtho:L.create(1),uViewOffset:L.create(j),uModelScale:L.create(1),uPixelRatio:L.create(e.pixelRatio),uViewport:L.create(V1.toVec4(AO(),l)),uDrawingBufferSize:L.create(u),uCameraPosition:L.create(O),uCameraDir:L.create(D),uCameraPlane:L.create(sF.toArray(A,AO(),0)),uNear:L.create(1),uFar:L.create(1e4),uFog:L.create(!0),uFogNear:L.create(1),uFogFar:L.create(1e4),uFogColor:L.create(d),uRenderMask:L.create(0),uMarkingDepthTest:L.create(!1),uPickType:L.create(X1.None),uMarkingType:L.create(Z1.None),uTransparentBackground:L.create(!1),uLightDirection:L.create(c.direction),uLightColor:L.create(c.color),uAmbientColor:L.create(te),uPickingAlphaThreshold:L.create(s.pickingAlphaThreshold),uInteriorDarkening:L.create(s.interiorDarkening),uInteriorColorFlag:L.create(s.interiorColorFlag),uInteriorColor:L.create(tE.toVec3Normalized(B(),s.interiorColor)),uHighlightColor:L.create(tE.toVec3Normalized(B(),s.highlightColor)),uSelectColor:L.create(tE.toVec3Normalized(B(),s.selectColor)),uDimColor:L.create(tE.toVec3Normalized(B(),s.dimColor)),uHighlightStrength:L.create(s.highlightStrength),uSelectStrength:L.create(s.selectStrength),uDimStrength:L.create(s.dimStrength),uMarkerPriority:L.create(s.markerPriority),uMarkerAverage:L.create(0),uXrayEdgeFalloff:L.create(s.xrayEdgeFalloff),uCelSteps:L.create(s.celSteps),uExposure:L.create(s.exposure)},ne=Object.entries(P),re=!0,ie=(n,r,o)=>{if(n.state.disposed||!n.state.visible||!n.state.pickable&&r===`pick`||!n.values.drawCount.ref.value||(q.scaleNX(ee,n.values.boundingSphere.ref.value,N),!cF.intersectsSphere3D(M,ee)))return;let[s,c]=n.values.uLod.ref.value;if(s!==0||c!==0){let{center:e,radius:t}=ee,n=sF.distanceToPoint(A,e);if(n+t<s*N||n-t>c*N)return}if(N===1){if(p!==null&&p(ee))return;let t=n.values.instanceGrid.ref.value.cellSize>0,r=n.values.uInstanceCount.ref.value>1;t&&(r||n.values.lodLevels)?n.cull(A,M,p,e.stats):n.uncull()}else if(n.values.lodLevels){let{center:e,radius:t}=ee,r=sF.distanceToPoint(A,e);n.cullSimple(r,t,N)}else n.uncull();let l=n.getProgram(r);if(a.currentProgramId!==l.id&&(re=!0,l.use()),re&&=(l.setUniforms(ne),l.bindTextures(h,0),!1),n.values.dGeometryType.ref.value===`directVolume`){if(r!==`color`)return;a.disable(i.CULL_FACE),a.frontFace(i.CCW)}else o===t.BlendedFront?(a.enable(i.CULL_FACE),n.values.dFlipSided?.ref.value?(a.frontFace(i.CW),a.cullFace(i.FRONT)):(a.frontFace(i.CCW),a.cullFace(i.BACK))):o===t.BlendedBack?(a.enable(i.CULL_FACE),n.values.dFlipSided?.ref.value?(a.frontFace(i.CW),a.cullFace(i.BACK)):(a.frontFace(i.CCW),a.cullFace(i.FRONT))):(n.values.uDoubleSided?n.values.uDoubleSided.ref.value||n.values.hasReflection.ref.value?a.disable(i.CULL_FACE):a.enable(i.CULL_FACE):a.disable(i.CULL_FACE),n.values.dFlipSided?.ref.value?(a.frontFace(i.CW),a.cullFace(i.FRONT)):(a.frontFace(i.CCW),a.cullFace(i.BACK)));n.render(r,h.length)},ae=(e,t)=>{L.update(P.uView,e.view),L.update(P.uInvView,z.invert(v,e.view)),L.update(P.uProjection,e.projection),L.update(P.uInvProjection,z.invert(x,e.projection)),L.updateIfChanged(P.uIsOrtho,e.state.mode===`orthographic`?1:0),L.update(P.uViewOffset,e.viewOffset.enabled?R.set(j,e.viewOffset.offsetX*16,e.viewOffset.offsetY*16):R.set(j,0,0)),L.updateIfChanged(P.uModelScale,e.scale),L.update(P.uCameraPosition,z.getTranslation(O,v)),B.scale(k,e.state.target,e.scale),B.normalize(D,B.sub(D,k,O)),L.update(P.uCameraDir,D),L.updateIfChanged(P.uFar,e.far),L.updateIfChanged(P.uNear,e.near),L.updateIfChanged(P.uFog,e.state.fog>0),L.updateIfChanged(P.uFogFar,e.fogFar),L.updateIfChanged(P.uFogNear,e.fogNear),L.updateIfChanged(P.uTransparentBackground,f),cF.fromProjectionMatrix(M,e.projectionView),sF.copy(A,M[cF.PlaneIndex.Near]),A.constant-=sF.distanceToPoint(A,O),L.update(P.uCameraPlane,sF.toArray(A,P.uCameraPlane.ref.value,0)),L.updateIfChanged(P.uMarkerAverage,t.markerAverage),z.isZero(e.headRotation)?(L.updateIfChanged(P.uHasHeadRotation,!1),L.updateIfChanged(P.uInvHeadRotation,z.id),L.update(P.uLightDirection,c.direction)):(L.updateIfChanged(P.uHasHeadRotation,!0),L.update(P.uInvHeadRotation,z.invert(w,e.headRotation)),L.update(P.uLightDirection,n0e(c,w))),L.update(P.uIsAsymmetricProjection,e.isAsymmetricProjection)},oe=(e,t,n,r,o)=>{ME(h,`tDepth`,n||m),N=t.scale,L.update(P.uModel,z.scaleUniformly(g,e.view,N)),L.update(P.uModelView,z.mul(y,t.view,g)),L.update(P.uInvModelView,z.invert(b,y)),L.update(P.uModelViewProjection,z.mul(S,y,t.projection)),L.update(P.uInvModelViewProjection,z.invert(C,S)),L.updateIfChanged(P.uRenderMask,r),L.updateIfChanged(P.uMarkingDepthTest,o),z.isZero(t.viewEye)?(L.updateIfChanged(P.uHasEyeCamera,!1),L.updateIfChanged(P.uModelViewEye,z.id),L.updateIfChanged(P.uInvModelViewEye,z.id)):(L.updateIfChanged(P.uHasEyeCamera,!0),L.update(P.uModelViewEye,z.mul(T,t.viewEye,g)),L.update(P.uInvModelViewEye,z.invert(E,T))),a.enable(i.SCISSOR_TEST),a.colorMask(!0,!0,!0,!0);let{x:s,y:c,width:u,height:d}=l;a.viewport(s,c,u,d),a.scissor(s,c,u,d),re=!0,a.currentRenderItemId=-1},se=function(e){let t=DT(e.values.alpha.ref.value*e.state.alphaFactor,0,1),n=e.values.dXrayShaded?.ref.value===`on`||e.values.dXrayShaded?.ref.value===`inverted`;return t===1&&e.values.transparencyAverage.ref.value!==1&&e.values.dGeometryType.ref.value!==`directVolume`&&e.values.dPointStyle?.ref.value!==`fuzzy`&&!n||e.values.dTransparentBackfaces?.ref.value===`opaque`},ce=function(e){let t=DT(e.values.alpha.ref.value*e.state.alphaFactor,0,1),n=e.values.dXrayShaded?.ref.value===`on`||e.values.dXrayShaded?.ref.value===`inverted`;return t!==0&&(t<1||e.values.transparencyAverage.ref.value>0||e.values.dGeometryType.ref.value===`directVolume`||e.values.dPointStyle?.ref.value===`fuzzy`||e.values.dGeometryType.ref.value===`text`||e.values.dGeometryType.ref.value===`image`||n)},le=(r,o,s,c)=>{$y&&e.timer.mark(`Renderer.renderPick`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.All,!1),L.updateIfChanged(P.uPickType,c);let{renderables:l}=r;for(let e=0,n=l.length;e<n;++e)l[e].state.colorOnly||ie(l[e],s,t.None);$y&&e.timer.markEnd(`Renderer.renderPick`)},ue=(r,o)=>{$y&&e.timer.mark(`Renderer.renderDepth`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.All,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e)ie(s[e],`depth`,t.None);$y&&e.timer.markEnd(`Renderer.renderDepth`)},de=(r,o)=>{$y&&e.timer.mark(`Renderer.renderDepthOpaque`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.Opaque,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];se(n)&&ie(n,`depth`,t.None)}$y&&e.timer.markEnd(`Renderer.renderDepthOpaque`)},fe=(r,o)=>{$y&&e.timer.mark(`Renderer.renderDepthOpaqueBack`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),a.depthFunc(i.GREATER),oe(r,o,null,n.Opaque,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];se(n)&&ie(n,`depth`,t.BlendedBack)}a.depthFunc(i.LESS),$y&&e.timer.markEnd(`Renderer.renderDepthOpaqueBack`)},pe=(r,o,s)=>{$y&&e.timer.mark(`Renderer.renderDepthTransparent`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,s,n.Transparent,!1);let{renderables:c}=r;for(let e=0,n=c.length;e<n;++e){let n=c[e];ce(n)&&ie(n,`depth`,t.None)}$y&&e.timer.markEnd(`Renderer.renderDepthTransparent`)},me=(r,o)=>{$y&&e.timer.mark(`Renderer.renderMarkingDepth`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.All,!1),L.updateIfChanged(P.uMarkingType,Z1.Depth);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];DT(n.values.alpha.ref.value*n.state.alphaFactor,0,1)!==0&&n.values.transparencyAverage.ref.value!==1&&n.values.markerAverage.ref.value!==1&&ie(s[e],`marking`,t.None)}$y&&e.timer.markEnd(`Renderer.renderMarkingDepth`)},he=(r,o,s)=>{$y&&e.timer.mark(`Renderer.renderMarkingMask`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,s,n.All,!!s),L.updateIfChanged(P.uMarkingType,Z1.Mask);let{renderables:c}=r;for(let e=0,n=c.length;e<n;++e)c[e].values.markerAverage.ref.value>0&&ie(c[e],`marking`,t.None);$y&&e.timer.markEnd(`Renderer.renderMarkingMask`)},ge=(r,o)=>{$y&&e.timer.mark(`Renderer.renderEmissive`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.Opaque,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];se(n)&&ie(n,`emissive`,t.None)}$y&&e.timer.markEnd(`Renderer.renderEmissive`)},_e=(r,o)=>{$y&&e.timer.mark(`Renderer.renderTracing`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.Opaque,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];se(n)&&ie(n,`tracing`,t.None)}$y&&e.timer.markEnd(`Renderer.renderTracing`)},ve=(e,t)=>{e.hasOpaque&&ye(e,t),e.opacityAverage<1&&be(e,t)},ye=(r,o)=>{$y&&e.timer.mark(`Renderer.renderOpaque`),a.disable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!0),oe(r,o,null,n.Opaque,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];se(n)&&ie(n,`color`,t.None)}$y&&e.timer.markEnd(`Renderer.renderOpaque`)},be=(r,o)=>{$y&&e.timer.mark(`Renderer.renderBlendedTransparent`),f?a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA):a.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),a.enable(i.DEPTH_TEST),a.depthMask(!1),oe(r,o,null,n.Transparent,!1);let{renderables:s}=r;for(let e=0,n=s.length;e<n;++e){let n=s[e];ce(n)&&(n.values.uDoubleSided?.ref.value?(n.values.dTransparentBackfaces?.ref.value!==`opaque`&&ie(n,`color`,t.BlendedBack),ie(n,`color`,t.BlendedFront)):ie(n,`color`,t.None))}$y&&e.timer.markEnd(`Renderer.renderBlendedTransparent`)};return{clear:(e,t,n)=>{a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.colorMask(!0,!0,!0,!0),a.depthMask(!0),n||f&&!t?a.clearColor(0,0,0,0):e?a.clearColor(d[0],d[1],d[2],1):a.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},clearDepth:(e=!1)=>{a.enable(i.SCISSOR_TEST),a.enable(i.DEPTH_TEST),a.depthMask(!0),e?(a.colorMask(!0,!0,!0,!0),a.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):i.clear(i.DEPTH_BUFFER_BIT)},update:ae,renderPick:le,renderDepth:ue,renderDepthOpaque:de,renderDepthOpaqueBack:fe,renderDepthTransparent:pe,renderMarkingDepth:me,renderMarkingMask:he,renderEmissive:ge,renderTracing:_e,renderBlended:ve,renderOpaque:ye,renderBlendedTransparent:be,renderVolume:(r,o,s)=>{$y&&e.timer.mark(`Renderer.renderVolume`),a.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),a.enable(i.BLEND),a.disable(i.DEPTH_TEST),a.depthMask(!1),oe(r,o,s,n.Transparent,!1);let{renderables:c}=r;for(let e=0,n=c.length;e<n;++e){let n=c[e];n.values.dGeometryType.ref.value===`directVolume`&&ie(n,`color`,t.None)}$y&&e.timer.markEnd(`Renderer.renderVolume`)},renderWboitTransparent:(r,i,a)=>{$y&&e.timer.mark(`Renderer.renderWboitTransparent`),oe(r,i,a,n.Transparent,!1);let{renderables:o}=r;for(let e=0,n=o.length;e<n;++e){let n=o[e];ce(n)&&ie(n,`color`,t.None)}$y&&e.timer.markEnd(`Renderer.renderWboitTransparent`)},renderDpoitTransparent:(r,o,s,c)=>{$y&&e.timer.mark(`Renderer.renderDpoitTransparent`),a.enable(i.BLEND),ME(h,`tDpoitDepth`,c.depth),ME(h,`tDpoitFrontColor`,c.frontColor),ME(h,`tDpoitBackColor`,c.backColor),oe(r,o,s,n.Transparent,!1);let{renderables:l}=r;for(let e=0,n=l.length;e<n;++e){let n=l[e];ce(n)&&ie(n,`color`,t.None)}$y&&e.timer.markEnd(`Renderer.renderDpoitTransparent`)},setProps:e=>{e.backgroundColor!==void 0&&e.backgroundColor!==s.backgroundColor&&(s.backgroundColor=e.backgroundColor,tE.toVec3Normalized(d,s.backgroundColor),L.update(P.uFogColor,B.copy(P.uFogColor.ref.value,d))),e.pickingAlphaThreshold!==void 0&&e.pickingAlphaThreshold!==s.pickingAlphaThreshold&&(s.pickingAlphaThreshold=e.pickingAlphaThreshold,L.update(P.uPickingAlphaThreshold,s.pickingAlphaThreshold)),e.interiorDarkening!==void 0&&e.interiorDarkening!==s.interiorDarkening&&(s.interiorDarkening=e.interiorDarkening,L.update(P.uInteriorDarkening,s.interiorDarkening)),e.interiorColorFlag!==void 0&&e.interiorColorFlag!==s.interiorColorFlag&&(s.interiorColorFlag=e.interiorColorFlag,L.update(P.uInteriorColorFlag,s.interiorColorFlag)),e.interiorColor!==void 0&&e.interiorColor!==s.interiorColor&&(s.interiorColor=e.interiorColor,L.update(P.uInteriorColor,tE.toVec3Normalized(P.uInteriorColor.ref.value,s.interiorColor))),e.colorMarker!==void 0&&e.colorMarker!==s.colorMarker&&(s.colorMarker=e.colorMarker),e.highlightColor!==void 0&&e.highlightColor!==s.highlightColor&&(s.highlightColor=e.highlightColor,L.update(P.uHighlightColor,tE.toVec3Normalized(P.uHighlightColor.ref.value,s.highlightColor))),e.selectColor!==void 0&&e.selectColor!==s.selectColor&&(s.selectColor=e.selectColor,L.update(P.uSelectColor,tE.toVec3Normalized(P.uSelectColor.ref.value,s.selectColor))),e.dimColor!==void 0&&e.dimColor!==s.dimColor&&(s.dimColor=e.dimColor,L.update(P.uDimColor,tE.toVec3Normalized(P.uDimColor.ref.value,s.dimColor))),e.highlightStrength!==void 0&&e.highlightStrength!==s.highlightStrength&&(s.highlightStrength=e.highlightStrength,L.update(P.uHighlightStrength,s.highlightStrength)),e.selectStrength!==void 0&&e.selectStrength!==s.selectStrength&&(s.selectStrength=e.selectStrength,L.update(P.uSelectStrength,s.selectStrength)),e.dimStrength!==void 0&&e.dimStrength!==s.dimStrength&&(s.dimStrength=e.dimStrength,L.update(P.uDimStrength,s.dimStrength)),e.markerPriority!==void 0&&e.markerPriority!==s.markerPriority&&(s.markerPriority=e.markerPriority,L.update(P.uMarkerPriority,s.markerPriority)),e.xrayEdgeFalloff!==void 0&&e.xrayEdgeFalloff!==s.xrayEdgeFalloff&&(s.xrayEdgeFalloff=e.xrayEdgeFalloff,L.update(P.uXrayEdgeFalloff,s.xrayEdgeFalloff)),e.celSteps!==void 0&&e.celSteps!==s.celSteps&&(s.celSteps=e.celSteps,L.update(P.uCelSteps,s.celSteps)),e.exposure!==void 0&&e.exposure!==s.exposure&&(s.exposure=e.exposure,L.update(P.uExposure,s.exposure)),e.light!==void 0&&!Tx(e.light,s.light)&&(s.light=e.light,Object.assign(c,t0e(e.light,c)),L.update(P.uLightDirection,c.direction),L.update(P.uLightColor,c.color)),e.ambientColor!==void 0&&e.ambientColor!==s.ambientColor&&(s.ambientColor=e.ambientColor,B.scale(te,tE.toArrayNormalized(s.ambientColor,te,0),s.ambientIntensity),L.update(P.uAmbientColor,te)),e.ambientIntensity!==void 0&&e.ambientIntensity!==s.ambientIntensity&&(s.ambientIntensity=e.ambientIntensity,B.scale(te,tE.toArrayNormalized(s.ambientColor,te,0),s.ambientIntensity),L.update(P.uAmbientColor,te))},setViewport:(e,t,n,r)=>{a.viewport(e,t,n,r),a.scissor(e,t,n,r),(e!==l.x||t!==l.y||n!==l.width||r!==l.height)&&(V1.set(l,e,t,n,r),L.update(P.uViewport,AO.set(P.uViewport.ref.value,e,t,n,r)))},setTransparentBackground:e=>{f=e},setDrawingBufferSize:(e,t)=>{(e!==u[0]||t!==u[1])&&L.update(P.uDrawingBufferSize,R.set(u,e,t))},setPixelRatio:e=>{L.update(P.uPixelRatio,e)},setOcclusionTest:e=>{p=e},props:s,get stats(){return{programCount:e.stats.resourceCounts.program,shaderCount:e.stats.resourceCounts.shader,attributeCount:e.stats.resourceCounts.attribute,elementsCount:e.stats.resourceCounts.elements,framebufferCount:e.stats.resourceCounts.framebuffer,renderbufferCount:e.stats.resourceCounts.renderbuffer,textureCount:e.stats.resourceCounts.texture,vertexArrayCount:e.stats.resourceCounts.vertexArray,drawCount:o.drawCount,instanceCount:o.instanceCount,instancedDrawCount:o.instancedDrawCount}},get light(){return c},get ambientColor(){return P.uAmbientColor.ref.value},dispose:()=>{}}}e.create=r})(r0e||={});function t0(e,t=``,n=``){return t0.create(e,t,n)}(function(e){function t(e,t=``,n=``){return{triggers:e,action:t,description:n}}e.create=t;function n(e){return!!e&&Array.isArray(e.triggers)&&typeof e.action==`string`}e.isBinding=n,e.Empty={triggers:[],action:``,description:``};function r(e){return e.triggers.length===0||e.triggers.every(e=>e.buttons===void 0&&e.modifiers===void 0&&!e.code)}e.isEmpty=r;function i(e,t,n){return e.triggers.some(e=>c.match(e,t,n))}e.match=i;function a(e,t,n,r){return e.triggers.some(e=>c.matchKey(e,t,n,r))}e.matchKey=a;function o(e){return e.triggers.map(c.format).join(` or `)}e.formatTriggers=o;function s(e,t=``){return Mfe(e.description||JT(t),{triggers:`<i>`+o(e)+`</i>`})}e.format=s;function c(e,t){return c.create(e,t)}e.Trigger=c;function l(e,t){return c.create(void 0,t,e)}e.TriggerKey=l,(function(e){function t(e,t,n){return{buttons:e,modifiers:t,code:n}}e.create=t,e.Empty={};function n(e,t,n){let{buttons:r,modifiers:i}=e;return r!==void 0&&(r===t||J1.has(r,t))&&(!i||q1.areEqual(i,n))}e.match=n;function r(e,t,n,r){let{modifiers:i,code:a}=e;return a!==void 0&&(a===t||a.length===1&&t.length===4&&t.startsWith(`Key`)&&!!r&&r.length===1&&r.toUpperCase()===a.toUpperCase())&&(!i||q1.areEqual(i,n))}e.matchKey=r;function i(e){let t=[],n=i0e(e.buttons,e.code);n&&t.push(n);let r=o0e(e.code);r&&t.push(r);let i=a0e(e.modifiers);return i&&t.push(i),t.join(` + `)}e.format=i})(c=e.Trigger||={})})(t0||={});var n0=J1;function i0e(e,t){let n=[];return e===void 0&&!t?n.push(`any mouse button`):e===0?n.push(`mouse hover`):e!==void 0&&(n0.has(e,n0.Flag.Primary)&&n.push(`left mouse button`),n0.has(e,n0.Flag.Secondary)&&n.push(`right mouse button`),n0.has(e,n0.Flag.Auxilary)&&n.push(`wheel/middle mouse button`),n0.has(e,n0.Flag.Forth)&&n.push(`three fingers`)),n.join(` + `)}function a0e(e,t){let n=[];return e?(e.alt&&n.push(`alt key`),e.control&&n.push(`control key`),e.meta&&n.push(`meta/command key`),e.shift&&n.push(`shift key`),t&&n.length===0&&n.push(`no key`)):t&&n.push(`any key`),n.join(` + `)}function o0e(e){return e?.startsWith(`Key`)&&(e=e.substring(3)),e&&KT(e).toLowerCase()}var r0=J1,i0=q1,a0=t0.Trigger,o0=t0.TriggerKey;const s0e={dragRotate:t0([a0(r0.Flag.Primary,i0.create()),a0(r0.Flag.Trigger)],`Rotate`,"Drag using ${triggers}"),dragRotateZ:t0([a0(r0.Flag.Primary,i0.create({shift:!0,control:!0}))],`Rotate around z-axis (roll)`,"Drag using ${triggers}"),dragPan:t0([a0(r0.Flag.Secondary,i0.create()),a0(r0.Flag.Primary,i0.create({control:!0}))],`Pan`,"Drag using ${triggers}"),dragZoom:t0.Empty,dragFocus:t0([a0(r0.Flag.Forth,i0.create())],`Focus`,"Drag using ${triggers}"),dragFocusZoom:t0([a0(r0.Flag.Auxilary,i0.create())],`Focus and zoom`,"Drag using ${triggers}"),scrollZoom:t0([a0(r0.Flag.Auxilary,i0.create())],`Zoom`,"Scroll using ${triggers}"),scrollFocus:t0([a0(r0.Flag.Auxilary,i0.create({shift:!0}))],`Clip`,"Scroll using ${triggers}"),scrollFocusZoom:t0.Empty,keyMoveForward:t0([o0(`KeyW`),o0(`GamepadUp`)],`Move forward`,"Press ${triggers}"),keyMoveBack:t0([o0(`KeyS`),o0(`GamepadDown`)],`Move back`,"Press ${triggers}"),keyMoveLeft:t0([o0(`KeyA`)],`Move left`,"Press ${triggers}"),keyMoveRight:t0([o0(`KeyD`)],`Move right`,"Press ${triggers}"),keyMoveUp:t0([o0(`KeyR`)],`Move up`,"Press ${triggers}"),keyMoveDown:t0([o0(`KeyF`)],`Move down`,"Press ${triggers}"),keyRollLeft:t0([o0(`KeyQ`)],`Roll left`,"Press ${triggers}"),keyRollRight:t0([o0(`KeyE`)],`Roll right`,"Press ${triggers}"),keyPitchUp:t0([o0(`ArrowUp`,i0.create({shift:!0}))],`Pitch up`,"Press ${triggers}"),keyPitchDown:t0([o0(`ArrowDown`,i0.create({shift:!0}))],`Pitch down`,"Press ${triggers}"),keyYawLeft:t0([o0(`ArrowLeft`,i0.create({shift:!0}))],`Yaw left`,"Press ${triggers}"),keyYawRight:t0([o0(`ArrowRight`,i0.create({shift:!0}))],`Yaw right`,"Press ${triggers}"),boostMove:t0([o0(`ShiftLeft`)],`Boost move`,"Press ${triggers}"),enablePointerLock:t0([o0(`Space`,i0.create({control:!0}))],`Enable pointer lock`,"Press ${triggers}")},c0e={rotateSpeed:V.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:V.Numeric(7,{min:1,max:15,step:1}),panSpeed:V.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:V.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:V.Numeric(5,{min:.1,max:10,step:.1}),flyMode:V.Boolean(!1),animate:V.MappedStatic(`off`,{off:V.EmptyGroup(),spin:V.Group({speed:V.Numeric(.1,{min:-2,max:2,step:.01},{description:`Number of rotations per second`})},{description:`Spin the 3D scene around the x-axis in view space`}),rock:V.Group({speed:V.Numeric(.3,{min:-5,max:5,step:.1},{description:`Number of oscilations per second`}),angle:V.Numeric(10,{min:0,max:90,step:1},{description:`How many degrees to rotate in each direction.`})},{description:`Rock the 3D scene around the x-axis in view space`})}),staticMoving:V.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:V.Numeric(.2,{},{isHidden:!0}),minDistance:V.Numeric(.01,{},{isHidden:!0}),maxDistance:V.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:V.Numeric(1,{},{isHidden:!0}),maxWheelDelta:V.Numeric(.02,{},{isHidden:!0}),autoAdjustMinMaxDistance:V.MappedStatic(`on`,{off:V.EmptyGroup(),on:V.Group({minDistanceFactor:V.Numeric(0),minDistancePadding:V.Numeric(5),maxDistanceFactor:V.Numeric(10),maxDistanceMin:V.Numeric(20)})},{isHidden:!0})},l0e={bindings:s0e};var u0e;(function(e){function t(e,t,n,r={},i={}){let a={...V.getDefaultValues(c0e),...r},o={...l0e,...i},s=o.bindings,c=V1.clone(t.viewport),l=!1,u=e.drag.subscribe(Ve),d=e.interactionEnd.subscribe(He),f=e.wheel.subscribe(Ue),p=e.pinch.subscribe(We),m=e.keyDown.subscribe(Ke),h=e.keyUp.subscribe(qe),g=e.move.subscribe(Ge),_=e.lock.subscribe(Xe),v=e.leave.subscribe(Ze),y=!1,b=B(),x=B(),S=R(),C=R(),w=B(),T=0,E=R(),D=R(),O=0,k=0,A=0,j=R(),M=R(),N=R(),ee=R(),te=R(),P=R(),ne=B.clone(t.target),re=B.clone(t.position),ie=B.clone(t.up),ae=R();function oe(e,t){return R.set(ae,(e-c.x)/c.width,(t-c.y)/c.height)}let se=R();function ce(e,t){return R.set(se,(e-c.width*.5-c.x)/(c.width*.5),(c.height+2*(c.y-t))/c.width)}function le(){let t=e.width/e.height||1;return a.rotateSpeed*e.pixelRatio*t}let ue=B(),de=MT(),fe=B(),pe=B(),me=B(),he=B();function ge(){let e=C[0]-S[0],n=C[1]-S[1];B.set(he,e,n,0);let r=B.magnitude(he)*le();r?(B.sub(x,t.position,t.target),B.normalize(fe,x),B.normalize(pe,t.up),B.normalize(me,B.cross(me,pe,fe)),B.setMagnitude(pe,pe,n),B.setMagnitude(me,me,e),B.add(he,pe,me),B.normalize(ue,B.cross(ue,he,x)),MT.setAxisAngle(de,ue,r),B.transformQuat(x,x,de),B.transformQuat(t.up,t.up,de),B.copy(w,ue),T=r):!a.staticMoving&&T&&(T*=Math.sqrt(1-a.dynamicDampingFactor),B.sub(x,t.position,t.target),MT.setAxisAngle(de,w,T),B.transformQuat(x,x,de),B.transformQuat(t.up,t.up,de)),R.copy(S,C)}let _e=MT(),ve=B();function ye(){let e=(Me.rollRight-Me.rollLeft)/45,n=(D[0]-E[0])*-Math.sign(D[1]),r=(D[1]-E[1])*-Math.sign(D[0]),i=-a.rotateSpeed*(-n+r)+e;i?(B.normalize(ve,x),MT.setAxisAngle(_e,ve,i),B.transformQuat(t.up,t.up,_e),O=i):!a.staticMoving&&O&&(O*=Math.sqrt(1-a.dynamicDampingFactor),B.normalize(ve,x),MT.setAxisAngle(_e,ve,O),B.transformQuat(t.up,t.up,_e)),R.copy(E,D)}let be=MT(),xe=B();function Se(){let e=(Me.pitchUp-Me.pitchDown)/(a.flyMode?360:90),n=-a.rotateSpeed*e;n?(B.cross(xe,x,t.up),B.normalize(xe,xe),MT.setAxisAngle(be,xe,n),B.transformQuat(x,x,be),B.transformQuat(t.up,t.up,be),k=n):!a.staticMoving&&k&&(k*=Math.sqrt(1-a.dynamicDampingFactor),B.cross(xe,x,t.up),B.normalize(xe,xe),MT.setAxisAngle(be,xe,k),B.transformQuat(x,x,be),B.transformQuat(t.up,t.up,be))}let Ce=MT(),we=B();function Te(){let e=(Me.yawRight-Me.yawLeft)/(a.flyMode?360:90),n=-a.rotateSpeed*e;n?(B.normalize(we,t.up),MT.setAxisAngle(Ce,we,n),B.transformQuat(x,x,Ce),B.transformQuat(t.up,t.up,Ce),A=n):!a.staticMoving&&A&&(A*=Math.sqrt(1-a.dynamicDampingFactor),B.normalize(we,t.up),MT.setAxisAngle(Ce,we,A),B.transformQuat(x,x,Ce),B.transformQuat(t.up,t.up,Ce))}function Ee(){let e=1+(M[1]-j[1])*a.zoomSpeed;e!==1&&e>0&&B.scale(x,x,e),a.staticMoving?R.copy(j,M):j[1]+=(M[1]-j[1])*a.dynamicDampingFactor}function De(){let e=(ee[1]-N[1])*a.zoomSpeed;if(e!==0){let n=Math.max(1,t.state.radius+t.state.radius*e);t.setState({radius:n})}a.staticMoving?R.copy(N,ee):N[1]+=(ee[1]-N[1])*a.dynamicDampingFactor}let Oe=R(),ke=B(),Ae=B();function je(){if(R.sub(Oe,R.copy(Oe,P),te),R.squaredMagnitude(Oe)){let n=e.pixelRatio*a.panSpeed;Oe[0]*=1/t.zoom*t.viewport.width*n,Oe[1]*=1/t.zoom*t.viewport.height*n,B.cross(Ae,B.copy(Ae,x),t.up),B.setMagnitude(Ae,Ae,Oe[0]),B.setMagnitude(ke,t.up,Oe[1]),B.add(Ae,Ae,ke),B.add(t.position,t.position,Ae),B.add(t.target,t.target,Ae),a.staticMoving?R.copy(te,P):(R.sub(Oe,P,te),R.scale(Oe,Oe,a.dynamicDampingFactor),R.add(te,te,Oe))}}let Me={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},Ne=B(),Pe=B();function Fe(r){B.sub(Pe,t.position,t.target);let i=Math.max(t.state.minNear,a.minDistance);B.setMagnitude(Pe,Pe,i);let o=a.flyMode||e.pointerLock,s=r*(60/1e3)*a.moveSpeed*(Me.boostMove===1?a.boostMoveFactor:1);if(Me.moveForward===1&&(B.distance(t.position,n.boundingSphereVisible.center)<n.boundingSphereVisible.radius&&o?(B.normalize(Ne,Pe),B.scaleAndSub(t.position,t.position,Ne,s)):(B.sub(Ne,t.position,t.target),B.scale(Ne,Ne,1-s/100),B.add(t.position,t.target,Ne)),o&&B.sub(t.target,t.position,Pe)),Me.moveBack===1&&(B.distance(t.position,n.boundingSphereVisible.center)<n.boundingSphereVisible.radius&&o?(B.normalize(Ne,Pe),B.scaleAndAdd(t.position,t.position,Ne,s)):(B.sub(Ne,t.position,t.target),B.scale(Ne,Ne,1+s/100),B.add(t.position,t.target,Ne)),o&&B.sub(t.target,t.position,Pe)),Me.moveLeft===1&&(B.cross(Ne,Pe,t.up),B.normalize(Ne,Ne),o?(B.scaleAndAdd(t.position,t.position,Ne,s),B.sub(t.target,t.position,Pe)):(B.scaleAndSub(t.position,t.position,Ne,s),B.sub(t.target,t.position,x))),Me.moveRight===1&&(B.cross(Ne,Pe,t.up),B.normalize(Ne,Ne),o?(B.scaleAndSub(t.position,t.position,Ne,s),B.sub(t.target,t.position,Pe)):(B.scaleAndAdd(t.position,t.position,Ne,s),B.sub(t.target,t.position,x))),Me.moveUp===1&&(B.normalize(Ne,t.up),o?(B.scaleAndAdd(t.position,t.position,Ne,s),B.sub(t.target,t.position,Pe)):(B.scaleAndSub(t.position,t.position,Ne,s),B.sub(t.target,t.position,x))),Me.moveDown===1&&(B.normalize(Ne,t.up),o?(B.scaleAndSub(t.position,t.position,Ne,s),B.sub(t.target,t.position,Pe)):(B.scaleAndAdd(t.position,t.position,Ne,s),B.sub(t.target,t.position,x))),o){let e=B.distance(t.position,n.boundingSphereVisible.center);t.setState({minFar:e+n.boundingSphereVisible.radius})}}function Ie(){let e=Math.min(Math.max(t.state.radiusMax*1e3,.01),a.maxDistance);B.squaredMagnitude(x)>e*e&&(B.setMagnitude(x,x,e),B.add(t.position,t.target,x),R.copy(j,M),R.copy(N,ee)),B.squaredMagnitude(x)<a.minDistance*a.minDistance&&(B.setMagnitude(x,x,a.minDistance),B.add(t.position,t.target,x),R.copy(j,M),R.copy(N,ee))}function Le(t,n){return t*=e.pixelRatio,n*=e.pixelRatio,t>c.x+c.width||e.height-n>c.y+c.height||t<c.x||e.height-n<c.y}let Re=-1;function ze(e){if(Re===e)return;let n=e-Re;Re>0&&(a.animate.name===`spin`?et(n):a.animate.name===`rock`&&rt(n)),B.sub(x,t.position,t.target),ge(),ye(),Se(),Te(),Ee(),De(),je(),B.add(t.position,t.target,x),Ie(),Re>0&&Fe(Math.min(n,15*1e3/60)),B.sub(x,t.position,t.target),Ie(),B.squaredDistance(b,t.position)>1e-6&&B.copy(b,t.position),Re=e}function Be(){B.copy(t.target,ne),B.copy(t.position,re),B.copy(t.up,ie),B.sub(x,t.position,t.target),B.copy(b,t.position)}function Ve({x:n,y:r,dx:i,dy:a,pageX:o,pageY:l,buttons:u,modifiers:d,isStart:f,useDelta:p}){let m=!p&&Le(n,r);if(f&&m||!f&&!y)return;y=!0,it();let h=t0.match(s.dragRotate,u,d),g=t0.match(s.dragRotateZ,u,d),_=t0.match(s.dragPan,u,d),v=t0.match(s.dragZoom,u,d),b=t0.match(s.dragFocus,u,d),x=t0.match(s.dragFocusZoom,u,d);p&&h&&R.copy(S,ce(o-i,l-a)),ce(o,l),oe(o,l);let w=e.pixelRatio,T=(n*w-c.width/2-c.x)/c.width,O=-(e.height-r*w-c.height/2-c.y)/c.height;if(f&&(h&&(R.copy(C,se),R.copy(S,C)),g&&(R.set(D,T,O),R.copy(E,D)),(v||x)&&(R.copy(j,ae),R.copy(M,j)),b&&(R.copy(N,ae),R.copy(ee,N)),_&&(R.copy(te,ae),R.copy(P,te))),h&&R.copy(C,se),g&&R.set(D,T,O),(v||x)&&R.copy(M,ae),b&&R.copy(ee,ae),x){let e=B.distance(t.state.position,t.state.target);t.setState({radius:e/5})}_&&R.copy(P,ae)}function He(){y=!1}function Ue({x:e,y:t,spinX:n,spinY:r,dz:i,buttons:o,modifiers:c}){if(Le(e,t))return;let l=wfe(n*.075,r*.075,i*1e-4);l<-a.maxWheelDelta?l=-a.maxWheelDelta:l>a.maxWheelDelta&&(l=a.maxWheelDelta),t0.match(s.scrollZoom,o,c)&&(M[1]+=l),t0.match(s.scrollFocus,o,c)&&(ee[1]+=l)}function We({isStart:e,startX:t,startY:n,centerPageX:r,centerPageY:i,fractionDelta:o,buttons:c,modifiers:l}){if(Le(t,n))return;let u=t0.match(s.dragPan,c,l),d=t0.match(s.scrollZoom,c,l);y=u||d,u&&(oe(r,i),e?(R.copy(te,ae),R.copy(P,te)):R.copy(P,ae)),d&&(M[1]+=a.gestureScaleFactor*o)}function Ge({movementX:t,movementY:n}){if(!e.pointerLock||t===void 0||n===void 0)return;let r=c.width*.5-c.x,i=c.height*.5-c.y;R.copy(S,ce(r,i)),R.copy(C,ce(t+r,n+i))}function Ke({modifiers:t,code:n,key:r,x:i,y:a}){Le(i,a)||(t0.matchKey(s.keyMoveForward,n,t,r)?Me.moveForward=1:t0.matchKey(s.keyMoveBack,n,t,r)?Me.moveBack=1:t0.matchKey(s.keyMoveLeft,n,t,r)?Me.moveLeft=1:t0.matchKey(s.keyMoveRight,n,t,r)?Me.moveRight=1:t0.matchKey(s.keyMoveUp,n,t,r)?Me.moveUp=1:t0.matchKey(s.keyMoveDown,n,t,r)?Me.moveDown=1:t0.matchKey(s.keyRollLeft,n,t,r)?Me.rollLeft=1:t0.matchKey(s.keyRollRight,n,t,r)?Me.rollRight=1:t0.matchKey(s.keyPitchUp,n,t,r)?Me.pitchUp=1:t0.matchKey(s.keyPitchDown,n,t,r)?Me.pitchDown=1:t0.matchKey(s.keyYawLeft,n,t,r)?Me.yawLeft=1:t0.matchKey(s.keyYawRight,n,t,r)&&(Me.yawRight=1),t0.matchKey(s.boostMove,n,t,r)&&(Me.boostMove=1),t0.matchKey(s.enablePointerLock,n,t,r)&&e.requestPointerLock(c))}function qe({modifiers:e,code:t,key:n,x:r,y:i}){if(Le(r,i))return;let a=!1;t.startsWith(`Alt`)?(a=!0,e.alt=!0):t.startsWith(`Shift`)?(a=!0,e.shift=!0):t.startsWith(`Control`)?(a=!0,e.control=!0):t.startsWith(`Meta`)&&(a=!0,e.meta=!0);let o=[];a?(Me.moveForward&&o.push(s.keyMoveForward.triggers[0]?.code||``),Me.moveBack&&o.push(s.keyMoveBack.triggers[0]?.code||``),Me.moveLeft&&o.push(s.keyMoveLeft.triggers[0]?.code||``),Me.moveRight&&o.push(s.keyMoveRight.triggers[0]?.code||``),Me.moveUp&&o.push(s.keyMoveUp.triggers[0]?.code||``),Me.moveDown&&o.push(s.keyMoveDown.triggers[0]?.code||``),Me.rollLeft&&o.push(s.keyRollLeft.triggers[0]?.code||``),Me.rollRight&&o.push(s.keyRollRight.triggers[0]?.code||``),Me.pitchUp&&o.push(s.keyPitchUp.triggers[0]?.code||``),Me.pitchDown&&o.push(s.keyPitchDown.triggers[0]?.code||``),Me.yawLeft&&o.push(s.keyYawLeft.triggers[0]?.code||``),Me.yawRight&&o.push(s.keyYawRight.triggers[0]?.code||``)):o.push(t);for(let t of o)t0.matchKey(s.keyMoveForward,t,e,n)?Me.moveForward=0:t0.matchKey(s.keyMoveBack,t,e,n)?Me.moveBack=0:t0.matchKey(s.keyMoveLeft,t,e,n)?Me.moveLeft=0:t0.matchKey(s.keyMoveRight,t,e,n)?Me.moveRight=0:t0.matchKey(s.keyMoveUp,t,e,n)?Me.moveUp=0:t0.matchKey(s.keyMoveDown,t,e,n)?Me.moveDown=0:t0.matchKey(s.keyRollLeft,t,e,n)?Me.rollLeft=0:t0.matchKey(s.keyRollRight,t,e,n)?Me.rollRight=0:t0.matchKey(s.keyPitchUp,t,e,n)?Me.pitchUp=0:t0.matchKey(s.keyPitchDown,t,e,n)?Me.pitchDown=0:t0.matchKey(s.keyYawLeft,t,e,n)?Me.yawLeft=0:t0.matchKey(s.keyYawRight,t,e,n)&&(Me.yawRight=0);t0.matchKey(s.boostMove,t,e,n)&&(Me.boostMove=0)}function Je(){B.sub(Pe,t.position,t.target);let e=Math.max(t.state.minNear,a.minDistance);B.setMagnitude(Pe,Pe,e),B.sub(t.target,t.position,Pe);let r=B.distance(t.position,n.boundingSphereVisible.center);t.setState({minFar:r+n.boundingSphereVisible.radius})}function Ye(){let{center:e,radius:r}=n.boundingSphereVisible;if(B.distance(t.position,e)>r){let n=t.getFocus(e,r);t.setState({...n,minFar:0})}else t.setState({minFar:0,radius:n.boundingSphereVisible.radius})}function Xe(e){e?Je():Ye()}function F(){Me.moveForward=0,Me.moveBack=0,Me.moveLeft=0,Me.moveRight=0,Me.moveUp=0,Me.moveDown=0,Me.rollLeft=0,Me.rollRight=0,Me.pitchUp=0,Me.pitchDown=0,Me.yawLeft=0,Me.yawRight=0,Me.boostMove=0}function Ze(){F()}function Qe(){l||(l=!0,u.unsubscribe(),f.unsubscribe(),p.unsubscribe(),d.unsubscribe(),m.unsubscribe(),h.unsubscribe(),g.unsubscribe(),_.unsubscribe(),v.unsubscribe())}let $e=R.create(.005,0);function et(e){a.animate.name!==`spin`||a.animate.params.speed===0||y||($e[0]=e*(2*Math.PI*a.animate.params.speed/1e3)/le(),R.add(C,S,$e))}let tt=0,nt=R.create(.005,0);function rt(e){if(a.animate.name!==`rock`||a.animate.params.speed===0||y)return;let t=e/1e3*a.animate.params.speed,n=FT(a.animate.params.angle)/le(),r=Math.sin(tt*Math.PI*2)*n;nt[0]=Math.sin((tt+t)*Math.PI*2)*n-r,R.add(C,S,nt),tt+=t,tt>=1&&(tt=0)}function it(){tt=0}function at(e){Re=-1,ze(e)}return{viewport:c,get isAnimating(){return a.animate.name!==`off`},get isMoving(){return Me.moveForward===1||Me.moveBack===1||Me.moveLeft===1||Me.moveRight===1||Me.moveUp===1||Me.moveDown===1||Me.rollLeft===1||Me.rollRight===1||Me.pitchUp===1||Me.pitchDown===1||Me.yawLeft===1||Me.yawRight===1},get props(){return a},setProps:e=>{e.animate?.name===`rock`&&a.animate.name!==`rock`&&it(),e.flyMode!==void 0&&e.flyMode!==a.flyMode&&(e.flyMode?Je():Ye()),Object.assign(a,e)},get attribs(){return o},setAttribs:e=>{Object.assign(o,e),Object.assign(s,o.bindings)},start:at,update:ze,reset:Be,dispose:Qe}}e.create=t})(u0e||={});var d0e;(function(e){function t(){return{view:z.identity(),position:B.create(0,0,0),direction:B.create(0,0,-1),up:B.create(0,1,0)}}e.create=t})(d0e||={});var f0e=class{constructor(){this.removeList=oL(),this.removeMap=new Map,this.addList=oL(),this.addMap=new Map}get isEmpty(){return this.removeList.count===0&&this.addList.count===0}get size(){return this.removeMap.size+this.addMap.size}add(e){if(this.removeMap.has(e)){let t=this.removeMap.get(e);this.removeMap.delete(e),this.removeList.remove(t)}if(this.addMap.has(e))return;let t=this.addList.addLast(e);this.addMap.set(e,t)}remove(e){if(this.addMap.has(e)){let t=this.addMap.get(e);this.addMap.delete(e),this.addList.remove(t)}if(this.removeMap.has(e))return;let t=this.removeList.addLast(e);this.removeMap.set(e,t)}tryGetRemove(){let e=this.removeList.removeFirst();return e&&this.removeMap.delete(e),e}tryGetAdd(){let e=this.addList.removeFirst();return e&&this.addMap.delete(e),e}},s0=new RA(`98`);function p0e(e,t,n){s0.reset();for(let t=0,r=e.length;t<r;++t){if(n&&!e[t].state.visible||!e[t].values.drawCount.ref.value)continue;let r=e[t].values.boundingSphere.ref.value;r.radius&&s0.includeSphere(r)}s0.finishedIncludeStep();for(let t=0,r=e.length;t<r;++t){if(n&&!e[t].state.visible||!e[t].values.drawCount.ref.value)continue;let r=e[t].values.boundingSphere.ref.value;r.radius&&s0.radiusSphere(r)}return s0.getSphere(t)}function m0e(e,t){let n=e.getProgram(`color`).id,r=t.getProgram(`color`).id,i=e.materialId,a=t.materialId;return n===r?i===a?e.id-t.id:i-a:n-r}var c0;(function(e){function t(e,t=`blended`,n={dColorMarker:!0,dLightCount:1}){let r=new Map,i=[],a=q(),o=q(),s=[],c=[],l=!0,u=!0,d=!0,f=!0,p=!0,m=!0,h=!0,g=0,_=0,v=0,y=0,b=!1,{view:x,position:S,direction:C,up:w}=d0e.create();function T(a){if(r.has(a))console.warn(`RenderObject with id '${a.id}' already present`);else{let o=EEe(e,a,t,n);i.push(o),a.type===`direct-volume`?c.push(o):s.push(o),r.set(a,o),l=!0,u=!0}}function E(e){let t=r.get(e);t&&(t.dispose(),kE(i,t),kE(s,t),kE(c,t),r.delete(e),l=!0,u=!0)}function D(e){let t=Ly(),n=0;for(;;){let r=O.tryGetRemove();if(!r)break;if(E(r),++n%100==0&&Ly()-t>e)return!1}for(;;){let r=O.tryGetAdd();if(!r)break;if(T(r),++n%100==0&&Ly()-t>e)return!1}return i.sort(m0e),d=!0,f=!0,p=!0,m=!0,h=!0,!0}let O=new f0e,k=-1;function A(){let e=23;for(let t=0,n=i.length;t<n;++t)i[t].state.visible&&(e=31*e+i[t].id|0);return e=uE(e),e===-1&&(e=0),e}function j(){let e=A();return e===k?!1:(u=!0,d=!0,f=!0,p=!0,m=!0,h=!0,k=e,!0)}function M(){if(s.length===0)return 0;let e=0,t=0;for(let n=0,r=s.length;n<r;++n)s[n].state.visible&&(t+=s[n].values.markerAverage.ref.value,e+=1);return e>0?t/e:0}function N(){if(s.length===0)return 0;let e=0,t=0;for(let n=0,r=s.length;n<r;++n)s[n].state.visible&&(t+=s[n].values.emissiveAverage.ref.value+s[n].values.uEmissive.ref.value,e+=1);return e>0?t/e:0}function ee(){if(s.length===0)return 0;let e=0,t=0;for(let n=0,r=s.length;n<r;++n){let r=s[n];if(!r.state.visible)continue;let i=DT(r.values.alpha.ref.value*r.state.alphaFactor,0,1),a=r.values.dXrayShaded?.ref.value===`on`||r.values.dXrayShaded?.ref.value===`inverted`?.5:1,o=r.values.dPointStyle?.ref.value===`fuzzy`?.5:1,c=r.values.dGeometryType.ref.value===`text`?.5:1,l=r.values.dGeometryType.ref.value===`image`?.5:1;t+=(1-r.values.transparencyAverage.ref.value)*i*a*o*c*l,e+=1}return e>0?t/e:0}function te(){if(s.length===0)return 1;let e=1,t=[];for(let n=0,r=s.length;n<r;++n){let r=s[n];if(!r.state.visible)continue;t.length=0;let i=DT(r.values.alpha.ref.value*r.state.alphaFactor,0,1);i<1&&t.push(1-i),(r.values.dXrayShaded?.ref.value===`on`||r.values.dXrayShaded?.ref.value===`inverted`||r.values.dPointStyle?.ref.value===`fuzzy`||r.values.dGeometryType.ref.value===`text`||r.values.dGeometryType.ref.value===`image`)&&t.push(.5),r.values.transparencyMin.ref.value>0&&t.push(r.values.transparencyMin.ref.value),e=Math.min(e,...t)}return e}function P(){if(s.length===0)return!1;for(let e=0,t=s.length;e<t;++e){let t=s[e];if(t.state.visible&&(t.state.opaque||t.state.alphaFactor===1&&t.values.alpha.ref.value===1&&t.values.transparencyAverage.ref.value!==1||t.values.dTransparentBackfaces?.ref.value===`opaque`))return!0}return!1}return{view:x,position:S,direction:C,up:w,renderables:i,primitives:{view:x,position:S,direction:C,up:w,renderables:s},volumes:{view:x,position:S,direction:C,up:w,renderables:c},syncVisibility:j,setTransparency:e=>{t=e;for(let t=0,n=i.length;t<n;++t)i[t].setTransparency(e)},setGlobals:e=>{n=e;for(let t of i)L.updateIfChanged(t.values.dColorMarker,e.dColorMarker),L.updateIfChanged(t.values.dLightCount,e.dLightCount),t.update()},update(e,t){var n;if(e)for(let t=0,i=e.length;t<i;++t)(n=r.get(e[t]))==null||n.update();else for(let e=0,t=i.length;e<t;++e)i[e].update();t?j():(l=!0,u=!0),d=!0,f=!0,p=!0,m=!0,h=!0},add:e=>O.add(e),remove:e=>O.remove(e),commit:(e=Number.MAX_VALUE)=>D(e),get commitQueueSize(){return O.size},get needsCommit(){return!O.isEmpty},has:e=>r.has(e),clear:()=>{for(let e=0,t=i.length;e<t;++e)i[e].dispose();i.length=0,s.length=0,c.length=0,r.clear(),l=!0,u=!0},forEach:e=>{r.forEach(e)},get count(){return i.length},get boundingSphere(){return l&&=(p0e(i,a,!1),!1),a},get boundingSphereVisible(){return u&&=(p0e(i,o,!0),!1),o},get transparency(){return t},get markerAverage(){return d&&=(g=M(),!1),g},get emissiveAverage(){return f&&=(_=N(),!1),_},get opacityAverage(){return p&&=(v=ee(),!1),v},get transparencyMin(){return m&&=(y=te(),!1),y},get hasOpaque(){return h&&=(b=P(),!1),b}}}e.create=t})(c0||={});var h0e=class e{get source(){return this._source}get target(){return this._target}apply(t,n=0,r){if((!this.inTransition||n>0)&&l0.copySnapshot(this._source,this.camera.state),this.inTransition||l0.copySnapshot(this._target,this.camera.state),l0.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&n<=0||t.mode!==void 0&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=r||e.defaultTransition,(!this.inTransition||n>0)&&(this.start=this.t,this.durationMs=n)}tick(e){this.t=e,this.update()}finish(e){l0.copySnapshot(this.camera.state,e),this.inTransition=!1}update(){if(!this.inTransition)return;let e=Math.min((this.t-this.start)/this.durationMs,1);if(e===1){this.finish(this._target);return}this.func(this._current,e,this._source,this._target),l0.copySnapshot(this.camera.state,this._current)}constructor(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=l0.createDefaultSnapshot(),this._target=l0.createDefaultSnapshot(),this._current=l0.createDefaultSnapshot()}};(function(e){let t=MT.identity(),n=MT.identity(),r=B(),i=B();function a(e,a,o,s){l0.copySnapshot(e,s),MT.slerp(t,MT.Identity,MT.rotationTo(t,o.up,s.up),a),B.transformQuat(e.up,o.up,t),B.lerp(e.target,o.target,s.target,a);let c=OT(B.distance(o.target,o.position),B.distance(s.target,s.position),a);B.sub(r,o.position,o.target),B.normalize(r,r),B.sub(i,s.position,s.target),B.normalize(i,i),MT.rotationTo(n,r,i),MT.slerp(n,MT.Identity,n,a),B.transformQuat(r,r,n),B.scale(r,r,c),B.add(e.position,e.target,r),e.radius=OT(o.radius,s.radius,a),e.radiusMax=OT(o.radiusMax,s.radiusMax,a),e.fov=OT(o.fov,s.fov,a),e.fog=OT(o.fog,s.fog,a)}e.defaultTransition=a})(h0e||={});var g0e=AO(),l0=class e{get position(){return this.state.position}set position(e){B.copy(this.state.position,e)}get up(){return this.state.up}set up(e){B.copy(this.state.up,e)}get target(){return this.state.target}set target(e){B.copy(this.state.target,e)}update(){let e=this.state;if(e.radiusMax===0)return!1;let t=B.distance(e.position,e.target),n=this.minTargetDistance/this.scale;t<n&&(B.sub(this.deltaDirection,e.target,e.position),B.setMagnitude(this.deltaDirection,this.deltaDirection,n),B.sub(e.position,e.target,this.deltaDirection));let r=2*Math.tan(e.fov/2)*B.distance(e.position,e.target)*this.scale;switch(this.zoom=this.viewport.height/r,b0e(this),this.state.mode){case`orthographic`:v0e(this);break;case`perspective`:y0e(this);break;default:Lb(this.state.mode)}let i=!z.areEqual(this.projection,this.prevProjection,1e-6)||!z.areEqual(this.view,this.prevView,1e-6);if(i){if(z.mul(this.projectionView,this.projection,this.view),!z.tryInvert(this.inverseProjectionView,this.projectionView))return z.copy(this.view,this.prevView),z.copy(this.projection,this.prevProjection),z.mul(this.projectionView,this.projection,this.view),!1;z.copy(this.prevView,this.view),z.copy(this.prevProjection,this.projection)}return i}setState(e,t){this.transition.apply(e,t),this.stateChanged.next(e)}getSnapshot(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)}getTargetDistance(t){return Math.max(this.minTargetDistance/this.scale,e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height))}getFocus(t,n,r,i,a){let o=Math.max(n,.01),s=this.getTargetDistance(o);B.sub(this.deltaDirection,a?.target??this.target,a?.position??this.position),i&&B.matchDirection(this.deltaDirection,i,this.deltaDirection),B.setMagnitude(this.deltaDirection,this.deltaDirection,s),B.sub(this.newPosition,t,this.deltaDirection);let c=e.copySnapshot(e.createDefaultSnapshot(),this.state);return c.target=B.clone(t),c.radius=o,c.position=B.clone(this.newPosition),r&&B.matchDirection(c.up,r,c.up),c}getCenter(t,n){B.sub(this.deltaDirection,this.target,this.position),B.sub(this.newPosition,t,this.deltaDirection);let r=e.copySnapshot(e.createDefaultSnapshot(),this.state);return r.target=B.clone(t),r.position=B.clone(this.newPosition),n&&(r.radius=Math.max(n,.01)),r}getInvariantFocus(t,n,r,i){let a=Math.max(n,.01),o=this.getTargetDistance(a);B.copy(this.deltaDirection,i),B.setMagnitude(this.deltaDirection,this.deltaDirection,o),B.sub(this.newPosition,t,this.deltaDirection);let s=e.copySnapshot(e.createDefaultSnapshot(),this.state);return s.target=B.clone(t),s.radius=a,s.position=B.clone(this.newPosition),B.copy(s.up,r),s}focus(e,t,n,r,i){t>0&&this.setState(this.getFocus(e,t,r,i),n)}center(e,t){this.setState(this.getCenter(e),t)}project(e,t){return J1e(e,t,this.viewport,this.projectionView)}unproject(e,t){return U1(e,t,this.viewport,this.inverseProjectionView)}getPixelSize(e){this.project(g0e,e);let t=g0e[3],n=this.viewport.width,r=this.projection[0];return 2/t/(n*Math.abs(r))}getRay(e,t,n){return this.state.mode===`orthographic`?(B.set(e.origin,t,n,0),this.unproject(e.origin,e.origin),B.normalize(e.direction,B.sub(e.direction,this.target,this.position)),B.scaleAndAdd(e.origin,e.origin,e.direction,-this.near)):(B.copy(e.origin,this.state.position),B.scale(e.origin,e.origin,this.scale),B.set(e.direction,t,n,.5),this.unproject(e.direction,e.direction),B.normalize(e.direction,B.sub(e.direction,e.direction,e.origin))),e}constructor(t,n=V1.create(0,0,128,128)){this.view=z.identity(),this.projection=z.identity(),this.projectionView=z.identity(),this.inverseProjectionView=z.identity(),this.headRotation=z.zero(),this.viewEye=z.zero(),this.isAsymmetricProjection=!1,this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.disabled=!1,this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.forceFull=!1,this.scale=1,this.minTargetDistance=0,this.transition=new h0e(this),this.stateChanged=new cD(this.state),this.prevProjection=z.identity(),this.prevView=z.identity(),this.deltaDirection=B(),this.newPosition=B(),this.viewport=n,e.copySnapshot(this.state,t)}};(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function n(e,t,n,r,i,a,o){e.fullWidth=t,e.fullHeight=n,e.offsetX=r,e.offsetY=i,e.width=a,e.height=o}e.setViewOffset=n;function r(e,t){e.enabled=t.enabled,e.fullWidth=t.fullWidth,e.fullHeight=t.fullHeight,e.offsetX=t.offsetX,e.offsetY=t.offsetY,e.width=t.width,e.height=t.height}e.copyViewOffset=r;function i(e,t,n,r,i){let a=Math.max(e,.01),o=r/i,s=i<r?1:o;return t===`orthographic`?Math.abs(a/s/Math.tan(n/2)):Math.abs(a/s/Math.sin(n/2))}e.targetDistance=i;function a(){return{mode:`perspective`,fov:Math.PI/4,position:B.create(0,0,100),up:B.create(0,1,0),target:B.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}}e.createDefaultSnapshot=a;function o(e,t){return t?(t.mode!==void 0&&(e.mode=t.mode),t.fov!==void 0&&(e.fov=t.fov),t.position!==void 0&&B.copy(e.position,t.position),t.up!==void 0&&B.copy(e.up,t.up),t.target!==void 0&&B.copy(e.target,t.target),t.radius!==void 0&&(e.radius=t.radius),t.radiusMax!==void 0&&(e.radiusMax=t.radiusMax),t.fog!==void 0&&(e.fog=t.fog),t.clipFar!==void 0&&(e.clipFar=t.clipFar),t.minNear!==void 0&&(e.minNear=t.minNear),t.minFar!==void 0&&(e.minFar=t.minFar),e):e}e.copySnapshot=o;function s(e,t){return e.mode===t.mode&&e.fov===t.fov&&e.radius===t.radius&&e.radiusMax===t.radiusMax&&e.fog===t.fog&&e.clipFar===t.clipFar&&e.minNear===t.minNear&&e.minFar===t.minFar&&B.exactEquals(e.position,t.position)&&B.exactEquals(e.up,t.up)&&B.exactEquals(e.target,t.target)}e.areSnapshotsEqual=s})(l0||={});var u0=B(),d0=B();function _0e(e){e.scale===1?z.lookAt(e.view,e.state.position,e.state.target,e.state.up):(B.scale(u0,e.state.position,e.scale),B.scale(d0,e.state.target,e.scale),z.lookAt(e.view,u0,d0,e.state.up))}function v0e(e){let{viewport:t,zoom:n,near:r,far:i,viewOffset:a}=e,o=-t.width/2,s=t.width/2,c=t.height/2,l=-t.height/2,u=(s-o)/(2*n),d=(c-l)/(2*n),f=(s+o)/2,p=(c+l)/2,m=f-u,h=f+u,g=p+d,_=p-d;if(a.enabled){let e=n/(a.width/a.fullWidth),t=n/(a.height/a.fullHeight),r=(s-o)/a.width,i=(c-l)/a.height;m+=r*(a.offsetX/e),h=m+r*(a.width/e),g-=i*(a.offsetY/t),_=g-i*(a.height/t)}z.ortho(e.projection,m,h,g,_,r,i),_0e(e)}function y0e(e){let t=e.viewport.width/e.viewport.height,{near:n,far:r,viewOffset:i}=e,a=n*Math.tan(.5*e.state.fov),o=2*a,s=t*o,c=-.5*s;i.enabled&&(c+=i.offsetX*s/i.fullWidth,a-=i.offsetY*o/i.fullHeight,s*=i.width/i.fullWidth,o*=i.height/i.fullHeight),z.perspective(e.projection,c,c+s,a,a-o,n,r),_0e(e)}function b0e(e){let{forceFull:t,scale:n}=e,{radius:r,radiusMax:i,mode:a,fog:o,clipFar:s,minNear:c,minFar:l}=e.state;i*=n,l*=n,c*=n,r*=n,t&&(r=i);let u=.01*n;r<u&&(r=u);let d=Math.max(s?r:i,l);B.scale(d0,e.state.target,n),B.scale(u0,e.state.position,n);let f=B.distance(u0,d0),p=t?.01:f-r,m=f+d;t&&(c=p),p=Math.max(Math.min(i,c),p),m=Math.max(c,m),p===m&&(m=p+.01*n);let h=f-d*(-(50-o)/50),g=m;e.near=p,e.far=m,e.fogNear=h,e.fogFar=g}const f0={sceneBoundingSpheres:V.Boolean(!1,{description:`Show full scene bounding spheres.`}),visibleSceneBoundingSpheres:V.Boolean(!1,{description:`Show visible scene bounding spheres.`}),objectBoundingSpheres:V.Boolean(!1,{description:`Show bounding spheres of visible render objects.`}),instanceBoundingSpheres:V.Boolean(!1,{description:`Show bounding spheres of visible instances.`})};var x0e=class{constructor(e,t,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=c0.create(e,`blended`),this.parent=t,this._props={...V.getDefaultValues(f0),...n}}update(){let e=p0(this.scene,this.parent.boundingSphere,this.sceneData,gk.lightgrey,C0e);e&&(this.sceneData=e);let t=p0(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,gk.black,w0e);t&&(this.visibleSceneData=t),this.parent.forEach((e,t)=>{let n=this.objectsData.get(t),r=p0(this.scene,e.values.boundingSphere.ref.value,n,gk.tomato,T0e);r&&this.objectsData.set(t,r);let i=this.instancesData.get(t),a=p0(this.scene,e.values.invariantBoundingSphere.ref.value,i,gk.skyblue,E0e,{aTransform:t.values.aTransform,matrix:t.values.matrix,transform:t.values.transform,extraTransform:t.values.extraTransform,uInstanceCount:t.values.uInstanceCount,instanceCount:t.values.instanceCount,aInstance:t.values.aInstance,hasReflection:t.values.hasReflection,instanceGrid:t.values.instanceGrid});a&&this.instancesData.set(t,a)}),this.objectsData.forEach((e,t)=>{this.parent.has(t)||(this.scene.remove(e.renderObject),this.objectsData.delete(t))}),this.instancesData.forEach((e,t)=>{this.parent.has(t)||(this.scene.remove(e.renderObject),this.instancesData.delete(t))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((e,t)=>{let n=this.objectsData.get(t);n&&(n.renderObject.state.visible=t.state.visible&&this._props.objectBoundingSpheres);let r=this.instancesData.get(t);r&&(r.renderObject.state.visible=t.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(e){Object.assign(this._props,e),this.isEnabled&&this.update()}};function p0(e,t,n,r,i,a){if(!n||!q.equals(n.boundingSphere,t)){let o=S0e(t,n&&n.mesh),s=n?n.renderObject:D0e(o,r,i,a);return n?L.updateIfChanged(s.values.drawCount,wF.getDrawCount(o)):e.add(s),{boundingSphere:q.clone(t),renderObject:s,mesh:o}}}function S0e(e,t){let n=rN(2),r=YN.createState(n,n/2,t);if(e.radius&&(oN(r,e.center,e.radius,2),q.hasExtrema(e)))for(let t of e.extrema)oN(r,t,1,0);return YN.getMesh(r)}var C0e=kF(),w0e=kF(),T0e=kF(),E0e=kF();function D0e(e,t,n,r){return AF(`mesh`,HM.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,r),{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},n)}var m0=B(),h0=B(),O0e=B();const k0e={maxFps:V.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:V.Numeric(3,{min:0,max:20,step:1},{description:`Number of extra pixels at which to prefer atoms over bonds.`}),convertCoordsToRay:V.Boolean(!1,{description:`Convert screen coordinates to ray for picking.`})};var A0e=class{setProps(e){Object.assign(this.props,e)}getTarget(){return this.ray?this.ray:this.props.convertCoordsToRay?this.camera.getRay(vA(),this.endX,this.input.height-this.endY):R.create(this.endX,this.endY)}handleMove(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&(this.pickData=this.canvasAsyncIdentify(this.getTarget()),this.startX=this.endX,this.startY=this.endY)}handleClick(){let e=this.canvasIdentify(this.getTarget()),t=this.getLoci(e?.id,e?.position);this.events.click.next({current:t,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:R.create(this.endX,this.endY),position:e?.position}),this.prevLoci=t}handleDrag(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&!this.outsideViewport(this.startX,this.startY,this.ray)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:R.create(this.startX,this.startY),pageEnd:R.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)}tick(e){if(this.inside){if(this.pickData){let e=this.pickData.tryGet();if(e!==`pending`){if(this.position=e?.position,this.inside){let t=this.getLoci(e?.id,e?.position);this.events.hover.next({current:t,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:R.create(this.endX,this.endY),position:e?.position}),this.prevLoci=t}this.pickData=void 0}}e-this.prevT>1e3/this.props.maxFps&&(this.prevT=e,this.isInteracting?this.handleDrag():this.handleMove())}}leave(){this.inside=!1,rJ.Loci.isEmpty(this.prevLoci)||(this.prevLoci=rJ.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(e,t,n,r,i,a){this.inside=!0,this.buttons=n,this.button=r,this.modifiers=i,this.ray=a,this.endX=e,this.endY=t}click(e,t,n,r,i,a){this.endX=e,this.endY=t,this.buttons=n,this.button=r,this.modifiers=i,this.ray=a,this.handleClick()}drag(e,t,n,r,i){this.endX=e,this.endY=t,this.buttons=n,this.button=r,this.modifiers=i,this.handleDrag()}modify(e){q1.areEqual(e,this.modifiers)||(this.modifiers=e,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:R.create(this.endX,this.endY),position:this.position}))}outsideViewport(e,t,n){if(n)return!1;let{input:r,camera:{viewport:i}}=this;return e*=r.pixelRatio,t*=r.pixelRatio,e>i.x+i.width||r.height-t>i.y+i.height||e<i.x||r.height-t<i.y}getLoci(e,t){let{repr:n,loci:r}=this.lociGetter(e);if(t&&n&&fR.isLoci(r)&&r.bonds.length===2){let{aUnit:e,aIndex:i}=r.bonds[0];e.conformation.position(e.elements[i],m0),B.sub(O0e,this.camera.state.position,this.camera.state.target),B.projectPointOnPlane(h0,t,O0e,m0);let a=this.camera.getPixelSize(h0),o=n.theme.size.size(r.bonds[0])*(n.props.sizeFactor??1);if(n.props.lineSizeAttenuation===!1&&(o*=a/2),o+=this.props.preferAtomPixelPadding*a,B.distance(h0,m0)<o)return{repr:n,loci:fR.toFirstStructureElementLoci(r)}}return{repr:n,loci:r}}dispose(){this.ev.dispose()}constructor(e,t,n,r,i,a,o={}){this.canvasIdentify=e,this.canvasAsyncIdentify=t,this.lociGetter=n,this.input=r,this.camera=i,this.controls=a,this.ev=_D.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.ray=void 0,this.pickData=void 0,this.position=void 0,this.isInteracting=!1,this.prevLoci=rJ.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=J1.create(0),this.button=J1.create(0),this.modifiers=q1.None,this.props={...V.getDefaultValues(k0e),...o},r.drag.subscribe(({x:e,y:t,buttons:n,button:r,modifiers:i})=>{this.isInteracting=!0,this.drag(e,t,n,r,i)}),r.move.subscribe(({x:e,y:t,inside:n,buttons:r,button:i,modifiers:a,onElement:o,ray:s})=>{if(!(!n||this.isInteracting)){if(!o){this.leave();return}this.move(e,t,r,i,a,s)}}),r.leave.subscribe(()=>{this.leave()}),r.click.subscribe(({x:e,y:t,buttons:n,button:r,modifiers:i,ray:a})=>{this.outsideViewport(e,t,a)||this.click(e,t,n,r,i,a)}),r.interactionEnd.subscribe(()=>{this.isInteracting=!1}),r.modifiers.subscribe(e=>{this.modify(e)})}};const j0e={edgeThresholdMin:V.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:`Trims the algorithm from processing darks.`}),edgeThresholdMax:V.Numeric(.063,{min:.063,max:.333,step:.001},{description:`The minimum amount of local contrast required to apply algorithm.`}),iterations:V.Numeric(12,{min:0,max:16,step:1},{description:`Number of edge exploration steps.`}),subpixelQuality:V.Numeric(.3,{min:0,max:1,step:.01},{description:`Choose the amount of sub-pixel aliasing removal.`})};var M0e=class{constructor(e,t){this.webgl=e,this.renderable=F0e(e,t)}updateState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){L.update(this.renderable.values.uTexSizeInv,R.set(this.renderable.values.uTexSizeInv.ref.value,1/e,1/t))}update(e,t){let{values:n}=this.renderable,{edgeThresholdMin:r,edgeThresholdMax:i,iterations:a,subpixelQuality:o}=t,s=!1;n.tColor.ref.value!==e&&(L.update(this.renderable.values.tColor,e),s=!0),n.dEdgeThresholdMin.ref.value!==r&&(s=!0),L.updateIfChanged(n.dEdgeThresholdMin,r),n.dEdgeThresholdMax.ref.value!==i&&(s=!0),L.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==a&&(s=!0),L.updateIfChanged(n.dIterations,a),n.dSubpixelQuality.ref.value!==o&&(s=!0),L.updateIfChanged(n.dSubpixelQuality,o),s&&this.renderable.update()}render(e,t){$y&&this.webgl.timer.mark(`FxaaPass.render`),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),$y&&this.webgl.timer.markEnd(`FxaaPass.render`)}},N0e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),dEdgeThresholdMin:qP(`number`),dEdgeThresholdMax:qP(`number`),dIterations:qP(`number`),dSubpixelQuality:qP(`number`)},P0e=fj(`fxaa`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`);function F0e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tColor:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),dEdgeThresholdMin:L.create(.0312),dEdgeThresholdMax:L.create(.125),dIterations:L.create(12),dSubpixelQuality:L.create(.3)};return hF(aF(e,`triangles`,P0e,{...N0e},i),i)}const I0e={edgeThreshold:V.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:V.Numeric(16,{min:0,max:32,step:1})};var L0e=class{get supported(){return this._supported}constructor(e,t){if(this.webgl=e,this._supported=!1,typeof HTMLImageElement>`u`){Qy&&console.log(`Missing "HTMLImageElement" required for "SMAA"`);return}let n=t.getWidth(),r=t.getHeight();this.edgesTarget=e.createRenderTarget(n,r,!1,`uint8`,`linear`),this.weightsTarget=e.createRenderTarget(n,r,!1,`uint8`,`linear`),this.edgesRenderable=B0e(e,t),this.weightsRenderable=U0e(e,this.edgesTarget.texture),this.blendRenderable=K0e(e,t,this.weightsTarget.texture),this._supported=!0}getByteCount(){return this.supported?this.edgesTarget.getByteCount()+this.weightsTarget.getByteCount():0}updateState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),L.update(this.edgesRenderable.values.uViewport,V1.toVec4(this.edgesRenderable.values.uViewport.ref.value,e)),L.update(this.weightsRenderable.values.uViewport,V1.toVec4(this.weightsRenderable.values.uViewport.ref.value,e)),L.update(this.blendRenderable.values.uViewport,V1.toVec4(this.blendRenderable.values.uViewport.ref.value,e))}setSize(e,t){let n=this.edgesTarget.getWidth(),r=this.edgesTarget.getHeight();(e!==n||t!==r)&&(this.edgesTarget.setSize(e,t),this.weightsTarget.setSize(e,t),L.update(this.edgesRenderable.values.uTexSizeInv,R.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),L.update(this.weightsRenderable.values.uTexSizeInv,R.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),L.update(this.blendRenderable.values.uTexSizeInv,R.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/e,1/t)))}update(e,t){let n=!1;this.edgesRenderable.values.tColor.ref.value!==e&&(L.update(this.edgesRenderable.values.tColor,e),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==t.edgeThreshold&&(L.update(this.edgesRenderable.values.dEdgeThreshold,t.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==t.maxSearchSteps&&(L.update(this.weightsRenderable.values.dMaxSearchSteps,t.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==e&&(L.update(this.blendRenderable.values.tColor,e),this.blendRenderable.update())}render(e,t){$y&&this.webgl.timer.mark(`SmaaPass.render`),this.edgesTarget.bind(),this.updateState(e),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(e),this.weightsRenderable.render(),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.blendRenderable.render(),$y&&this.webgl.timer.markEnd(`SmaaPass.render`)}},R0e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uViewport:J(`v4`),dEdgeThreshold:qP(`number`)},z0e=fj(`smaa-edges`,`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`);function B0e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tColor:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),uViewport:L.create(AO()),dEdgeThreshold:L.create(.1)};return hF(aF(e,`triangles`,z0e,{...R0e},i),i)}var V0e={..._F,tEdges:GP(`texture`,`rgba`,`ubyte`,`linear`),tArea:GP(`texture`,`rgb`,`ubyte`,`linear`),tSearch:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSizeInv:J(`v2`),uViewport:J(`v4`),dMaxSearchSteps:qP(`number`)},H0e=fj(`smaa-weights`,`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`);function U0e(e,t){let n=t.getWidth(),r=t.getHeight(),i=e.resources.texture(`image-uint8`,`rgb`,`ubyte`,`linear`),a=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),o={...vF,tEdges:L.create(t),tArea:L.create(i),tSearch:L.create(a),uTexSizeInv:L.create(R.create(1/n,1/r)),uViewport:L.create(AO()),dMaxSearchSteps:L.create(16)};return $j(q0e(),o.tArea,i),$j(J0e(),o.tSearch,a),hF(aF(e,`triangles`,H0e,{...V0e},o),o)}var W0e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`linear`),tWeights:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uViewport:J(`v4`)},G0e=fj(`smaa-blend`,`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`);function K0e(e,t,n){let r=t.getWidth(),i=t.getHeight(),a={...vF,tColor:L.create(t),tWeights:L.create(n),uTexSizeInv:L.create(R.create(1/r,1/i)),uViewport:L.create(AO())};return hF(aF(e,`triangles`,G0e,{...W0e},a),a)}function q0e(){return`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=`}function J0e(){return`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=`}function g0(){return g0.zero()}(function(e){function t(){let e=[.1,0,0];return e[0]=0,e}e.zero=t;function n(e,n,r){let i=t();return i[0]=e,i[1]=n,i[2]=r,i}e.create=n;function r(e,t,n,r){return e[0]=t,e[0]=n,e[0]=r,e}e.set=r;function i(e){let n=t();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}e.clone=i;function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}e.copy=a;function o(e,t,n){let r=t[0],i=t[4],a=t[8],o=t[1],s=t[5],c=t[9],l=t[2],u=t[6],d=t[10];switch(n){case`XYZ`:e[1]=Math.asin(DT(a,-1,1)),Math.abs(a)<.9999999?(e[0]=Math.atan2(-c,d),e[2]=Math.atan2(-i,r)):(e[0]=Math.atan2(u,s),e[2]=0);break;case`YXZ`:e[0]=Math.asin(-DT(c,-1,1)),Math.abs(c)<.9999999?(e[1]=Math.atan2(a,d),e[2]=Math.atan2(o,s)):(e[1]=Math.atan2(-l,r),e[2]=0);break;case`ZXY`:e[0]=Math.asin(DT(u,-1,1)),Math.abs(u)<.9999999?(e[1]=Math.atan2(-l,d),e[2]=Math.atan2(-i,s)):(e[1]=0,e[2]=Math.atan2(o,r));break;case`ZYX`:e[1]=Math.asin(-DT(l,-1,1)),Math.abs(l)<.9999999?(e[0]=Math.atan2(u,d),e[2]=Math.atan2(o,r)):(e[0]=0,e[2]=Math.atan2(-i,s));break;case`YZX`:e[2]=Math.asin(DT(o,-1,1)),Math.abs(o)<.9999999?(e[0]=Math.atan2(-c,s),e[1]=Math.atan2(-l,r)):(e[0]=0,e[1]=Math.atan2(a,d));break;case`XZY`:e[2]=Math.asin(-DT(i,-1,1)),Math.abs(i)<.9999999?(e[0]=Math.atan2(u,s),e[1]=Math.atan2(a,r)):(e[0]=Math.atan2(-c,d),e[1]=0);break;default:Lb(n)}return e}e.fromMat4=o;let s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function c(e,t,n){return z.fromQuat(s,t),o(e,s,n)}e.fromQuat=c;function l(e,t){return r(e,t[0],t[1],t[2])}e.fromVec3=l;function u(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}e.exactEquals=u;function d(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e}e.fromArray=d;function f(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t}e.toArray=f})(g0||={});var Y0e={opacity:V.Numeric(1,{min:0,max:1,step:.01}),saturation:V.Numeric(0,{min:-1,max:1,step:.01}),lightness:V.Numeric(0,{min:-1,max:1,step:.01})},X0e={faces:V.MappedStatic(`urls`,{urls:V.Group({nx:V.Text(``,{label:`Negative X / Left`}),ny:V.Text(``,{label:`Negative Y / Bottom`}),nz:V.Text(``,{label:`Negative Z / Back`}),px:V.Text(``,{label:`Positive X / Right`}),py:V.Text(``,{label:`Positive Y / Top`}),pz:V.Text(``,{label:`Positive Z / Front`})},{isExpanded:!0,label:`URLs`}),files:V.Group({nx:V.File({label:`Negative X / Left`,accept:`image/*`}),ny:V.File({label:`Negative Y / Bottom`,accept:`image/*`}),nz:V.File({label:`Negative Z / Back`,accept:`image/*`}),px:V.File({label:`Positive X / Right`,accept:`image/*`}),py:V.File({label:`Positive Y / Top`,accept:`image/*`}),pz:V.File({label:`Positive Z / Front`,accept:`image/*`})},{isExpanded:!0,label:`Files`})}),blur:V.Numeric(0,{min:0,max:1,step:.01},{description:`Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.`}),rotation:V.Group({x:V.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:V.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:V.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...Y0e},Z0e={source:V.MappedStatic(`url`,{url:V.Text(``),file:V.File({accept:`image/*`})}),blur:V.Numeric(0,{min:0,max:1,step:.01},{description:`Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.`}),...Y0e,coverage:V.Select(`viewport`,V.arrayToOptions([`viewport`,`canvas`]))},Q0e={topColor:V.Color(tE(14540253)),bottomColor:V.Color(tE(15658734)),ratio:V.Numeric(.5,{min:0,max:1,step:.01}),coverage:V.Select(`viewport`,V.arrayToOptions([`viewport`,`canvas`]))},$0e={centerColor:V.Color(tE(14540253)),edgeColor:V.Color(tE(15658734)),ratio:V.Numeric(.5,{min:0,max:1,step:.01}),coverage:V.Select(`viewport`,V.arrayToOptions([`viewport`,`canvas`]))};const e2e={variant:V.MappedStatic(`off`,{off:V.EmptyGroup(),skybox:V.Group(X0e,{isExpanded:!0}),image:V.Group(Z0e,{isExpanded:!0}),horizontalGradient:V.Group(Q0e,{isExpanded:!0}),radialGradient:V.Group($0e,{isExpanded:!0})},{label:`Environment`})};var t2e=class{constructor(e,t,n,r){this.webgl=e,this.assetManager=t,this.camera=new l0,this.target=B(),this.position=B(),this.dir=B(),this.bgColor=B(),this.renderable=m2e(e,n,r)}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;(e!==n||t!==r)&&L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t))}clearSkybox(){this.skybox!==void 0&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(e=>this.assetManager.release(e)),this.skybox=void 0)}updateSkybox(e,t,n){let r=this.skybox?.props.faces,i=t.faces.params;if(!i.nx||!i.ny||!i.nz||!i.px||!i.py||!i.pz){this.clearSkybox(),n?.(!1);return}if(!this.skybox||!r||!o2e(t.faces,this.skybox.props.faces)){this.clearSkybox();let{texture:e,assets:r}=s2e(this.webgl,this.assetManager,t.faces,e=>{this.skybox&&(this.skybox.loaded=!e),n?.(!0)});this.skybox={texture:e,props:{...t},assets:r,loaded:!1},L.update(this.renderable.values.tSkybox,e),this.renderable.update()}else n?.(!1);if(!this.skybox)return;let a=e;e.state.mode===`orthographic`&&(this.camera.setState({...e.state,mode:`perspective`}),this.camera.update(),a=this.camera);let o=this.renderable.values.uViewDirectionProjectionInverse.ref.value;z.isZero(e.headRotation)?(B.sub(this.dir,a.state.position,a.state.target),B.setMagnitude(this.dir,this.dir,.1),B.copy(this.position,this.dir),z.lookAt(o,this.position,this.target,a.state.up)):z.invert(o,e.headRotation),z.mul(o,a.projection,o),z.invert(o,o),L.update(this.renderable.values.uViewDirectionProjectionInverse,o);let s=this.renderable.values.uRotation.ref.value;TT.fromEuler(s,g0.create(FT(t.rotation.x),FT(t.rotation.y),FT(t.rotation.z)),`XYZ`),L.update(this.renderable.values.uRotation,s),L.updateIfChanged(this.renderable.values.uBlur,t.blur),L.updateIfChanged(this.renderable.values.uOpacity,t.opacity),L.updateIfChanged(this.renderable.values.uSaturation,t.saturation),L.updateIfChanged(this.renderable.values.uLightness,t.lightness),L.updateIfChanged(this.renderable.values.dVariant,`skybox`),this.renderable.update()}clearImage(){this.image!==void 0&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(e,t){if(!e.source.params){this.clearImage(),t?.(!1);return}if(!this.image||!this.image.props.source.params||!u2e(e.source,this.image.props.source)){this.clearImage();let{texture:n,asset:r}=d2e(this.webgl,this.assetManager,e.source,e=>{this.image&&(this.image.loaded=!e),t?.(!0)});this.image={texture:n,props:{...e},asset:r,loaded:!1},L.update(this.renderable.values.tImage,n),this.renderable.update()}else t?.(!1);this.image&&(L.updateIfChanged(this.renderable.values.uBlur,e.blur),L.updateIfChanged(this.renderable.values.uOpacity,e.opacity),L.updateIfChanged(this.renderable.values.uSaturation,e.saturation),L.updateIfChanged(this.renderable.values.uLightness,e.lightness),L.updateIfChanged(this.renderable.values.uViewportAdjusted,e.coverage===`viewport`),L.updateIfChanged(this.renderable.values.dVariant,`image`),this.renderable.update())}updateImageScaling(){let e=this.renderable.values,[t,n]=e.uTexSize.ref.value,r=this.image?.texture.getWidth()||0,i=this.image?.texture.getHeight()||0,a=t/n;a<r/i?L.update(e.uImageScale,R.set(e.uImageScale.ref.value,r*n/i,n)):L.update(e.uImageScale,R.set(e.uImageScale.ref.value,t,i*t/r));let[o,s]=e.uImageScale.ref.value,c=o/s;c>a?L.update(e.uImageOffset,R.set(e.uImageOffset.ref.value,(1-a/c)/2,0)):L.update(e.uImageOffset,R.set(e.uImageOffset.ref.value,0,(1-c/a)/2))}updateGradient(e,t,n,r,i){L.update(this.renderable.values.uGradientColorA,tE.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,e)),L.update(this.renderable.values.uGradientColorB,tE.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,t)),L.updateIfChanged(this.renderable.values.uGradientRatio,n),L.updateIfChanged(this.renderable.values.uViewportAdjusted,i),L.updateIfChanged(this.renderable.values.dVariant,r),this.renderable.update()}update(e,t,n){if(t.variant.name===`off`){this.clearSkybox(),this.clearImage(),n?.(!1);return}else t.variant.name===`skybox`?(this.clearImage(),this.updateSkybox(e,t.variant.params,n)):t.variant.name===`image`?(this.clearSkybox(),this.updateImage(t.variant.params,n)):t.variant.name===`horizontalGradient`?(this.clearSkybox(),this.clearImage(),this.updateGradient(t.variant.params.topColor,t.variant.params.bottomColor,t.variant.params.ratio,t.variant.name,t.variant.params.coverage===`viewport`),n?.(!1)):t.variant.name===`radialGradient`&&(this.clearSkybox(),this.clearImage(),this.updateGradient(t.variant.params.centerColor,t.variant.params.edgeColor,t.variant.params.ratio,t.variant.name,t.variant.params.coverage===`viewport`),n?.(!1));let{x:r,y:i,width:a,height:o}=e.viewport;L.update(this.renderable.values.uViewport,AO.set(this.renderable.values.uViewport.ref.value,r,i,a,o))}_isEnabled(e){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||e.variant.name===`horizontalGradient`||e.variant.name===`radialGradient`)}isEnabled(e){return e.enabled&&this._isEnabled(e.background)}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||this.renderable.values.dVariant.ref.value===`horizontalGradient`||this.renderable.values.dVariant.ref.value===`radialGradient`)}clear(e,t,n){let{gl:r,state:i}=this.webgl;this._isEnabled(e)?(t?i.clearColor(0,0,0,0):(tE.toVec3Normalized(this.bgColor,n),i.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),r.clear(r.COLOR_BUFFER_BIT),i.enable(r.BLEND),i.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(i.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT))}render(e){!this._isEnabled(e)||!this.isReady()||(this.renderable.values.dVariant.ref.value===`image`&&this.updateImageScaling(),$y&&this.webgl.timer.mark(`BackgroundPass.render`),this.renderable.render(),$y&&this.webgl.timer.markEnd(`BackgroundPass.render`))}dispose(){this.clearSkybox(),this.clearImage()}},n2e=`background-skybox`;function r2e(e,t){return t.name===`urls`?{nx:gx.getUrlAsset(e,t.params.nx),ny:gx.getUrlAsset(e,t.params.ny),nz:gx.getUrlAsset(e,t.params.nz),px:gx.getUrlAsset(e,t.params.px),py:gx.getUrlAsset(e,t.params.py),pz:gx.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}function i2e(e,t){let n=t=>e.resolve(t,`binary`).run().then(e=>new Blob([e.data]));return{nx:n(t.nx),ny:n(t.ny),nz:n(t.nz),px:n(t.px),py:n(t.py),pz:n(t.pz)}}function a2e(e){return e.name===`urls`?`${n2e}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${n2e}_${e.params.nx?.id}|${e.params.ny?.id}|${e.params.nz?.id}|${e.params.px?.id}|${e.params.py?.id}|${e.params.pz?.id}`}function o2e(e,t){return a2e(e)===a2e(t)}function s2e(e,t,n,r){let i=r2e(t,n),a=i2e(t,i),o=[i.nx,i.ny,i.nz,i.px,i.py,i.pz];return typeof HTMLImageElement>`u`?(console.error(`Missing "HTMLImageElement" required for background skybox`),r?.(!0),{texture:tM(),assets:o}):{texture:e.resources.cubeTexture(a,!0,r),assets:o}}var c2e=`background-image`;function l2e(e){return e.name===`url`?`${c2e}_${e.params}`:`${c2e}_${e.params?.id}`}function u2e(e,t){return l2e(e)===l2e(t)}function d2e(e,t,n,r){let i=n.name===`url`?t.tryFindFilename(n.params)??gx.getUrlAsset(t,n.params):n.params;if(typeof HTMLImageElement>`u`)return console.error(`Missing "HTMLImageElement" required for background image`),r?.(!0),{texture:tM(),asset:i};let a=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`linear`),o=new Image;return o.onload=()=>{a.load(o),(e.isWebGL2||LT(o.width)&&LT(o.height))&&a.mipmap(),r?.()},o.onerror=()=>{r?.(!0)},t.resolve(i,`binary`).run().then(e=>{let t=new Blob([e.data]);o.src=URL.createObjectURL(t)}),{texture:a,asset:i}}var f2e={drawCount:JP(`number`),instanceCount:JP(`number`),aPosition:WP(`float32`,2,0),tSkybox:GP(`texture`,`rgba`,`ubyte`,`linear`),tImage:GP(`texture`,`rgba`,`ubyte`,`linear`),uImageScale:J(`v2`),uImageOffset:J(`v2`),uTexSize:J(`v2`),uViewport:J(`v4`),uViewportAdjusted:J(`b`),uViewDirectionProjectionInverse:J(`m4`),uGradientColorA:J(`v3`),uGradientColorB:J(`v3`),uGradientRatio:J(`f`),uBlur:J(`f`),uOpacity:J(`f`),uSaturation:J(`f`),uLightness:J(`f`),uRotation:J(`m3`),dVariant:qP(`string`,[`skybox`,`image`,`verticalGradient`,`horizontalGradient`,`radialGradient`])},p2e=fj(`background`,`
precision mediump float;

attribute vec2 aPosition;

varying vec4 vPosition;

void main() {
    vPosition = vec4(aPosition, 1.0, 1.0);
    gl_Position = vec4(aPosition, 1.0, 1.0);
}
`,`
precision mediump float;
precision mediump samplerCube;
precision mediump sampler2D;

#if defined(dVariant_skybox)
    uniform samplerCube tSkybox;
    uniform mat4 uViewDirectionProjectionInverse;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
    uniform mat3 uRotation;
#elif defined(dVariant_image)
    uniform sampler2D tImage;
    uniform vec2 uImageScale;
    uniform vec2 uImageOffset;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)
    uniform vec3 uGradientColorA;
    uniform vec3 uGradientColorB;
    uniform float uGradientRatio;
#endif

uniform vec2 uTexSize;
uniform vec4 uViewport;
uniform bool uViewportAdjusted;
varying vec4 vPosition;

// TODO: add as general pp option to remove banding?
// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf
vec3 ScreenSpaceDither(vec2 vScreenPos) {
    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));
    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));
    return vDither.rgb / 255.0;
}

vec3 saturateColor(vec3 c, float amount) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    vec3 intensity = vec3(dot(c, W));
    return mix(intensity, c, 1.0 + amount);
}

vec3 lightenColor(vec3 c, float amount) {
    return c + amount;
}

void main() {
    #if defined(dVariant_skybox)
        vec4 t = uViewDirectionProjectionInverse * vPosition;
        #ifdef enabledShaderTextureLod
            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);
        #else
            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_image)
        vec2 coords;
        if (uViewportAdjusted) {
            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;
        } else {
            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;
        }
        #ifdef enabledShaderTextureLod
            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);
        #else
            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_horizontalGradient)
        float d;
        if (uViewportAdjusted) {
            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        } else {
            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #elif defined(dVariant_radialGradient)
        float d;
        if (uViewportAdjusted) {
            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;
        } else {
            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #endif
}
`,{shaderTextureLod:`optional`});function m2e(e,t,n){let r={drawCount:L.create(6),instanceCount:L.create(1),aPosition:L.create(gF),tSkybox:L.create(tM()),tImage:L.create(tM()),uImageScale:L.create(R()),uImageOffset:L.create(R()),uTexSize:L.create(R.create(t,n)),uViewport:L.create(AO()),uViewportAdjusted:L.create(!0),uViewDirectionProjectionInverse:L.create(z()),uGradientColorA:L.create(B()),uGradientColorB:L.create(B()),uGradientRatio:L.create(.5),uBlur:L.create(0),uOpacity:L.create(1),uSaturation:L.create(0),uLightness:L.create(0),uRotation:L.create(TT.identity()),dVariant:L.create(`skybox`)};return hF(aF(e,`triangles`,p2e,{...f2e},r),r)}const h2e={sharpness:V.Numeric(.5,{min:0,max:1,step:.05}),denoise:V.Boolean(!0)};var g2e=class{constructor(e,t){this.webgl=e,this.renderable=y2e(e,t)}updateState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){L.update(this.renderable.values.uTexSizeInv,R.set(this.renderable.values.uTexSizeInv.ref.value,1/e,1/t))}update(e,t){let{values:n}=this.renderable,{sharpness:r,denoise:i}=t,a=!1;n.tColor.ref.value!==e&&(L.update(this.renderable.values.tColor,e),a=!0),L.updateIfChanged(n.uSharpness,2-2*r**.25),n.dDenoise.ref.value!==i&&(a=!0),L.updateIfChanged(n.dDenoise,i),a&&this.renderable.update()}render(e,t){$y&&this.webgl.timer.mark(`CasPass.render`),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),$y&&this.webgl.timer.markEnd(`CasPass.render`)}},_2e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uSharpness:J(`f`),dDenoise:qP(`boolean`)},v2e=fj(`cas`,tF,`
precision mediump float;
precision mediump sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

uniform float uSharpness;

// adapted from https://www.shadertoy.com/view/stXSWB

/*
* FidelityFX Super Resolution scales up a low resolution
* image, while adding fine detail.
*
* MIT Open License
*
* https://gpuopen.com/fsr
*
* Left: FSR processed
* Right: Original texture, bilinear interpolation
*
* Mouse at top: Sharpness 0 stops (maximum)
* Mouse at bottom: Sharpness 2 stops (minimum)
*
* It works in two passes-
*   EASU upsamples the image with a clamped Lanczos kernel.
*   RCAS sharpens the image at the target resolution.
*
* I needed to make a few changes to improve readability and
* WebGL compatibility in an algorithm I don't fully understand.
* Expect bugs.
*
* Shader not currently running for WebGL1 targets (eg. mobile Safari)
*
* There is kind of no point to using FSR in Shadertoy, as it renders buffers
* at full target resolution. But this might be useful for WebGL based demos
* running smaller-than-target render buffers.
*
* For sharpening with a full resolution render buffer,
* FidelityFX CAS is a better option.
* https://www.shadertoy.com/view/ftsXzM
*
* For readability and compatibility, these optimisations have been removed:
*   * Fast approximate inverse and inversesqrt
*   * textureGather fetches (not WebGL compatible)
*   * Multiplying by reciprocal instead of division
*
* Apologies to AMD for the numerous slowdowns and errors I have introduced.
*
*/

/***** RCAS *****/
#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))

// Input callback prototypes that need to be implemented by calling shader
vec4 FsrRcasLoadF(vec2 p);
//------------------------------------------------------------------------------------------------------------------------------
void FsrRcasCon(
    out float con,
    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.
    float sharpness
) {
    // Transform from stops to linear value.
    con = exp2(-sharpness);
}

vec3 FsrRcasF(
    vec2 ip, // Integer pixel position in output.
    float con
) {
    // Constant generated by RcasSetup().
    // Algorithm uses minimal 3x3 pixel neighborhood.
    //    b
    //  d e f
    //    h
    vec2 sp = vec2(ip);
    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;
    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;
    vec3 e = FsrRcasLoadF(sp).rgb;
    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;
    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;

    // Luma times 2.
    float bL = b.g + .5 * (b.b + b.r);
    float dL = d.g + .5 * (d.b + d.r);
    float eL = e.g + .5 * (e.b + e.r);
    float fL = f.g + .5 * (f.b + f.r);
    float hL = h.g + .5 * (h.b + h.r);

    // Noise detection.
    #ifdef dDenoise
        float nz = .25 * (bL + dL + fL + hL) - eL;
        nz=clamp(
            abs(nz)
            /(
                max(max(bL,dL),max(eL,max(fL,hL)))
                -min(min(bL,dL),min(eL,min(fL,hL)))
            ),
            0., 1.
        );
        nz=1.-.5*nz;
    #endif

    // Min and max of ring.
    vec3 mn4 = min(b, min(f, h));
    vec3 mx4 = max(b, max(f, h));

    // Immediate constants for peak range.
    vec2 peakC = vec2(1., -4.);

    // Limiters, these need to be high precision RCPs.
    vec3 hitMin = mn4 / (4. * mx4);
    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);
    vec3 lobeRGB = max(-hitMin, hitMax);
    float lobe = max(
        -FSR_RCAS_LIMIT,
        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)
    )*con;

    // Apply noise removal.
    #ifdef dDenoise
        lobe *= nz;
    #endif

    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.
    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);
}


vec4 FsrRcasLoadF(vec2 p) {
    return texture2D(tColor, p * uTexSizeInv);
}

void main() {
    // Set up constants
    float con;
    FsrRcasCon(con, uSharpness);

    // Perform RCAS pass
    vec3 col = FsrRcasF(gl_FragCoord.xy, con);

    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);
}
`);function y2e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tColor:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),uSharpness:L.create(.5),dDenoise:L.create(!0)};return hF(aF(e,`triangles`,v2e,{..._2e},i),i)}const b2e={blurSize:V.Numeric(9,{min:1,max:32,step:1}),blurSpread:V.Numeric(1,{min:0,max:10,step:.1}),inFocus:V.Numeric(0,{min:-5e3,max:5e3,step:1},{description:`Distance from the scene center that will be in focus`}),PPM:V.Numeric(20,{min:0,max:5e3,step:.1},{description:`Size of the area that will be in focus`}),center:V.Select(`camera-target`,V.arrayToOptions([`scene-center`,`camera-target`])),mode:V.Select(`plane`,V.arrayToOptions([`plane`,`sphere`]))};var _0=class{static isEnabled(e){return e.enabled&&e.dof.name!==`off`}constructor(e,t,n){this.webgl=e,this.target=e.createRenderTarget(t,n,!1);let r=tM();this.renderable=C2e(e,r,r,r)}getByteCount(){return this.target.getByteCount()}updateState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){let n=this.target.texture.getWidth(),r=this.target.texture.getHeight();(e!==n||t!==r)&&(this.target.setSize(e,t),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r,i,a){let o=!1;this.renderable.values.tColor.ref.value!==t&&(L.update(this.renderable.values.tColor,t),o=!0),this.renderable.values.tDepthOpaque.ref.value!==n&&(L.update(this.renderable.values.tDepthOpaque,n),o=!0),this.renderable.values.tDepthTransparent.ref.value!==r&&(L.update(this.renderable.values.tDepthTransparent,r),o=!0);let s=e.state.mode===`orthographic`?1:0,c=this.renderable.values.uInvProjection.ref.value;z.invert(c,e.projection);let[l,u]=this.renderable.values.uTexSize.ref.value,d=e.viewport;L.update(this.renderable.values.uProjection,e.projection),L.update(this.renderable.values.uInvProjection,c),L.update(this.renderable.values.uMode,i.mode===`sphere`?1:0),AO.set(this.renderable.values.uBounds.ref.value,d.x/l,d.y/u,(d.x+d.width)/l,(d.y+d.height)/u),L.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),L.updateIfChanged(this.renderable.values.uNear,e.near),L.updateIfChanged(this.renderable.values.uFar,e.far),L.updateIfChanged(this.renderable.values.dOrthographic,s);let f=Math.round(i.blurSize*this.webgl.pixelRatio);this.renderable.values.dBlurSize.ref.value!==f&&(L.update(this.renderable.values.dBlurSize,f),o=!0);let p=i.center===`scene-center`?a.center:e.state.target,m=B.distance(e.state.position,p)+i.inFocus;L.updateIfChanged(this.renderable.values.uInFocus,m*e.scale);let h=this.renderable.values.uCenter.ref.value;B.transformMat4(h,p,e.view),L.update(this.renderable.values.uCenter,h),L.updateIfChanged(this.renderable.values.uBlurSpread,i.blurSpread),L.updateIfChanged(this.renderable.values.uPPM,i.PPM*e.scale),o&&this.renderable.update()}render(e,t){$y&&this.webgl.timer.mark(`DofPass.render`),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),$y&&this.webgl.timer.markEnd(`DofPass.render`)}},x2e={..._F,tDepthOpaque:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uProjection:J(`m4`),uInvProjection:J(`m4`),uBounds:J(`v4`),uCenter:J(`v3`),uMode:J(`i`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),dBlurSize:qP(`number`),uBlurSpread:J(`f`),uInFocus:J(`f`),uPPM:J(`f`)},S2e=fj(`dof`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uBlurSpread;
uniform float uInFocus;
uniform float uPPM;

uniform float uNear; // Near plane
uniform float uFar;  // Far plane

uniform mat4 uInvProjection; // Inverse projection
uniform mat4 uProjection; // projection

uniform int uMode; // 0-planar, 1-spherical
uniform vec3 uCenter; // Center of focus sphere in view space

// Function to convert depth value from depth buffer to view space Z
float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

// Retrieve depth from opaque depth texture
float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

// Retrieve depth from transparent depth texture
float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords) {
    return min(getDepthOpaque(coords), getDepthTransparent(coords));
}

float getCOC(vec2 uv) {
    float depth = getDepth(uv);
    float viewDist = getViewZ(depth);
    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    float coc = 0.0;  // Circle of Confusion
    if (uMode == 0) { // planar Depth of field
        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range
    } else if(uMode == 1) { // spherical Depth of field
        coc = focusDist / uPPM ;
    }
    coc = clamp(coc, -1.0, 1.0);
    return coc;
}

// Simple box blur for blurring the image
vec3 getBlurredImage(vec2 coords) {
    vec4 blurColor = vec4(0);
    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);
    float count = 0.0;
    for (int x = 0; x < int(dBlurSize); x++) {
        for (int y = 0; y < int(dBlurSize); y++) {
            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);
            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;
            float coc = getCOC(uvPixel);
            coc = smoothstep(0.0, 1.0, abs(coc));
            // mix blurColor with new color with weight coc
            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;
            count+=coc;
        }
    }
    blurColor = blurColor / count;
    return blurColor.rgb;
}

// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/
void main() {
    vec2 uv = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, uv);
    float depth = getDepth(uv);

    float viewDist = getViewZ(depth);

    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    vec3 blurColor = getBlurredImage(uv);

    float coc = getCOC(uv); // Circle of Confusion

    // for debugging the coc
    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));
    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC
    gl_FragColor = color;
}
`);function C2e(e,t,n,r){let i=t.getWidth(),a=t.getHeight(),o={...vF,tDepthOpaque:L.create(n),tDepthTransparent:L.create(r),tColor:L.create(t),uTexSize:L.create(R.create(i,a)),uProjection:L.create(z.identity()),uInvProjection:L.create(z.identity()),uBounds:L.create(AO()),uCenter:L.create(B()),uMode:L.create(0),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),dBlurSize:L.create(5),uBlurSpread:L.create(300),uInFocus:L.create(20),uPPM:L.create(20)};return hF(aF(e,`triangles`,S2e,{...x2e},o),o)}var v0=5;const w2e={strength:V.Numeric(1,{min:0,max:3,step:.1}),radius:V.Numeric(0,{min:0,max:1,step:.01}),threshold:V.Numeric(0,{min:0,max:1,step:.01},{description:`Luminosity threshold`,hideIf:e=>e.mode===`emissive`}),mode:V.Select(`emissive`,[[`luminosity`,`Luminosity`],[`emissive`,`Emissive`]])};var y0=class{static isEnabled(e){return e.enabled&&e.bloom.name===`on`}constructor(e,t,n){this.webgl=e,this.horizontalBlurTargets=[],this.verticalBlurTargets=[],this.emissiveTarget=e.createRenderTarget(t,n,!0,`uint8`,`linear`,`rgba`),this.luminosityTarget=e.createRenderTarget(t,n,!1,`uint8`,`linear`),this.compositeTarget=e.createRenderTarget(t,n,!1,`uint8`,`linear`);let r=Math.round(t/2),i=Math.round(n/2);for(let t=0;t<v0;++t)this.horizontalBlurTargets[t]=e.createRenderTarget(r,i,!1,`uint8`,`linear`),this.verticalBlurTargets[t]=e.createRenderTarget(r,i,!1,`uint8`,`linear`),r=Math.round(r/2),i=Math.round(i/2);let a=tM();this.luminosityRenderable=D2e(e,a,a,a),this.blurRenderable=P2e(e,a),this.compositeRenderable=L2e(e,t,n,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=yF(e,this.compositeTarget.texture)}getByteCount(){return this.emissiveTarget.getByteCount()+this.luminosityTarget.getByteCount()+this.compositeTarget.getByteCount()+this.horizontalBlurTargets.reduce((e,t)=>e+t.getByteCount(),0)+this.verticalBlurTargets.reduce((e,t)=>e+t.getByteCount(),0)}setSize(e,t){let n=this.luminosityTarget.getWidth(),r=this.luminosityTarget.getHeight();if(e!==n||t!==r){this.emissiveTarget.setSize(e,t),this.luminosityTarget.setSize(e,t),this.compositeTarget.setSize(e,t);let n=Math.round(e/2),r=Math.round(t/2);for(let e=0;e<v0;++e)this.horizontalBlurTargets[e].setSize(n,r),this.verticalBlurTargets[e].setSize(n,r),n=Math.round(n/2),r=Math.round(r/2);L.update(this.luminosityRenderable.values.uTexSizeInv,R.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),L.update(this.compositeRenderable.values.uTexSizeInv,R.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),L.update(this.copyRenderable.values.uTexSize,R.set(this.copyRenderable.values.uTexSize.ref.value,e,t))}}update(e,t,n,r){let i=!1;this.luminosityRenderable.values.tColor.ref.value!==e&&(L.update(this.luminosityRenderable.values.tColor,e),i=!0),this.luminosityRenderable.values.tEmissive.ref.value!==t&&(L.update(this.luminosityRenderable.values.tEmissive,t),i=!0),this.luminosityRenderable.values.tDepth.ref.value!==n&&(L.update(this.luminosityRenderable.values.tDepth,n),i=!0),this.luminosityRenderable.values.dMode.ref.value!==r.mode&&(L.update(this.luminosityRenderable.values.dMode,r.mode),i=!0),L.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,r.threshold),i&&this.luminosityRenderable.update();let a=!1;this.blurRenderable.values.tInput.ref.value!==e&&(L.update(this.blurRenderable.values.tInput,e),a=!0),a&&this.blurRenderable.update(),L.update(this.compositeRenderable.values.uBloomRadius,r.radius),L.update(this.compositeRenderable.values.uBloomStrength,r.strength)}render(e,t){$y&&this.webgl.timer.mark(`BloomPass.render`);let{gl:n,state:r}=this.webgl,{x:i,y:a,width:o,height:s}=e;r.viewport(i,a,o,s),r.scissor(i,a,o,s),r.enable(n.SCISSOR_TEST),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render();for(let e=0;e<v0;++e){let t=this.horizontalBlurTargets[e].getWidth(),n=this.horizontalBlurTargets[e].getHeight();r.viewport(0,0,t,n),r.scissor(0,0,t,n),L.update(this.blurRenderable.values.dKernelRadius,b0[e]),L.update(this.blurRenderable.values.uGaussianCoefficients,k2e(b0[e])),L.update(this.blurRenderable.values.uTexSizeInv,R.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/t,1/n)),this.horizontalBlurTargets[e].bind(),L.update(this.blurRenderable.values.tInput,e===0?this.luminosityTarget.texture:this.verticalBlurTargets[e-1].texture),L.update(this.blurRenderable.values.uDirection,A2e),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[e].bind(),L.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[e].texture),L.update(this.blurRenderable.values.uDirection,j2e),this.blurRenderable.update(),this.blurRenderable.render()}r.viewport(i,a,o,s),r.scissor(i,a,o,s),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),t?t.bind():this.webgl.bindDrawingBuffer(),r.enable(n.BLEND),r.blendFunc(n.ONE,n.ONE),this.copyRenderable.render(),$y&&this.webgl.timer.markEnd(`BloomPass.render`)}},T2e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`linear`),tEmissive:GP(`texture`,`rgba`,`ubyte`,`linear`),tDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSizeInv:J(`v2`),uDefaultColor:J(`v3`),uDefaultOpacity:J(`f`),uLuminosityThreshold:J(`f`),uSmoothWidth:J(`f`),dMode:qP(`string`,[`luminosity`,`emissive`])},E2e=fj(`Bloom Luminosity`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tEmissive;
uniform sampler2D tDepth;
uniform vec2 uTexSizeInv;

uniform vec3 uDefaultColor;
uniform float uDefaultOpacity;
uniform float uLuminosityThreshold;
uniform float uSmoothWidth;

#include common

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 texel = texture2D(tColor, coords);
    float emissive = texture2D(tEmissive, coords).a;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
    }

    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);

    #if defined(dMode_luminosity)
        vec3 luma = vec3(0.299, 0.587, 0.114);
        float v = dot(texel.xyz, luma);
        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);

        gl_FragColor = mix(outputColor, texel, alpha);
    #elif defined(dMode_emissive)
        gl_FragColor = mix(outputColor, texel, emissive);
    #endif
}
`);function D2e(e,t,n,r){let i=t.getWidth(),a=t.getHeight(),o={...vF,tColor:L.create(t),tEmissive:L.create(n),tDepth:L.create(r),uTexSizeInv:L.create(R.create(1/i,1/a)),uDefaultColor:L.create(B()),uDefaultOpacity:L.create(0),uLuminosityThreshold:L.create(0),uSmoothWidth:L.create(1),dMode:L.create(`emissive`)};return hF(aF(e,`triangles`,E2e,{...T2e},o),o)}function O2e(e){let t=[];for(let n=0;n<e;++n)t.push(.39894*Math.exp(-.5*n*n/(e*e))/e);return t}var k2e=_A(O2e),b0=[3,5,7,9,11],A2e=R.create(1,0),j2e=R.create(0,1),M2e={..._F,tInput:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uDirection:J(`v2`),uGaussianCoefficients:J(`f[]`),dKernelRadius:qP(`number`)},N2e=fj(`Bloom Blur`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInput;
uniform vec2 uTexSizeInv;

uniform vec2 uDirection;
uniform float uGaussianCoefficients[dKernelRadius];

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    float weightSum = uGaussianCoefficients[0];
    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;

    for(int i = 1; i < dKernelRadius; ++i) {
        float x = float(i);
        float w = uGaussianCoefficients[i];
        vec2 offset = uDirection * uTexSizeInv * x;
        vec4 sample1 = texture2D(tInput, coords + offset);
        vec4 sample2 = texture2D(tInput, coords - offset);
        diffuseSum += (sample1 + sample2) * w;
        weightSum += 2.0 * w;
    }

    gl_FragColor = diffuseSum / weightSum;
}
`);function P2e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tInput:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),uDirection:L.create(R()),uGaussianCoefficients:L.create([]),dKernelRadius:L.create(b0[0])};return hF(aF(e,`triangles`,N2e,{...M2e},i),i)}var F2e={..._F,tBlur1:GP(`texture`,`rgba`,`ubyte`,`linear`),tBlur2:GP(`texture`,`rgba`,`ubyte`,`linear`),tBlur3:GP(`texture`,`rgba`,`ubyte`,`linear`),tBlur4:GP(`texture`,`rgba`,`ubyte`,`linear`),tBlur5:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uBloomStrength:J(`f`),uBloomRadius:J(`f`),uBloomFactors:J(`f[]`),uBloomTints:J(`v3[]`)},I2e=fj(`Bloom Composite`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform vec2 uTexSizeInv;

uniform sampler2D tBlur1;
uniform sampler2D tBlur2;
uniform sampler2D tBlur3;
uniform sampler2D tBlur4;
uniform sampler2D tBlur5;
uniform float uBloomStrength;
uniform float uBloomRadius;
uniform float uBloomFactors[5];
uniform vec3 uBloomTints[5];

float lerpBloomFactor(const in float factor) {
    float mirrorFactor = 1.2 - factor;
    return mix(factor, mirrorFactor, uBloomRadius);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;

    gl_FragColor = uBloomStrength * (
        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +
        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +
        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +
        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +
        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)
    );
}
`);function L2e(e,t,n,r,i,a,o,s){let c={...vF,uTexSizeInv:L.create(R.create(t,n)),tBlur1:L.create(r),tBlur2:L.create(i),tBlur3:L.create(a),tBlur4:L.create(o),tBlur5:L.create(s),uBloomStrength:L.create(1),uBloomRadius:L.create(0),uBloomFactors:L.create([1,.8,.6,.4,.2]),uBloomTints:L.create(Array(15).fill(1))};return hF(aF(e,`triangles`,I2e,{...F2e},c),c)}const R2e={scale:V.Numeric(1,{min:1,max:5,step:1}),threshold:V.Numeric(.33,{min:.01,max:1,step:.01}),color:V.Color(tE(0)),includeTransparent:V.Boolean(!0,{description:`Whether to show outline for transparent objects`})};var x0=class{static isEnabled(e){return e.enabled&&e.outline.name!==`off`}constructor(e,t,n,r,i){this.webgl=e,this.target=e.createRenderTarget(t,n,!1),this.renderable=B2e(e,i,r,!0)}getByteCount(){return this.target.getByteCount()}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;(e!==n||t!==r)&&(this.target.setSize(e,t),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r){let i=!1,a=e.state.mode===`orthographic`?1:0,o=this.renderable.values.uInvProjection.ref.value;z.invert(o,e.projection);let s=t.includeTransparent??!0,c=Math.max(1,Math.round(t.scale*this.webgl.pixelRatio))-1,l=50*t.threshold*this.webgl.pixelRatio;return L.updateIfChanged(this.renderable.values.uNear,e.near),L.updateIfChanged(this.renderable.values.uFar,e.far),L.update(this.renderable.values.uInvProjection,o),this.renderable.values.dTransparentOutline.ref.value!==s&&(i=!0,L.update(this.renderable.values.dTransparentOutline,s)),this.renderable.values.dOrthographic.ref.value!==a&&(i=!0,L.update(this.renderable.values.dOrthographic,a)),L.updateIfChanged(this.renderable.values.uOutlineThreshold,l),this.renderable.values.tDepthTransparent.ref.value!==n&&(i=!0,L.update(this.renderable.values.tDepthTransparent,n)),this.renderable.values.tDepthOpaque.ref.value!==r&&(i=!0,L.update(this.renderable.values.tDepthOpaque,r)),i&&this.renderable.update(),{transparentOutline:s,outlineScale:c}}render(){$y&&this.webgl.timer.mark(`OutlinePass.render`),this.target.bind(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`OutlinePass.render`)}};const z2e={..._F,tDepthOpaque:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),uInvProjection:J(`m4`),uOutlineThreshold:J(`f`),dTransparentOutline:qP(`boolean`)};function B2e(e,t,n,r){let i=t.getWidth(),a=t.getHeight(),o={...vF,tDepthOpaque:L.create(t),tDepthTransparent:L.create(n),uTexSize:L.create(R.create(i,a)),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uInvProjection:L.create(z.identity()),uOutlineThreshold:L.create(.33),dTransparentOutline:L.create(r)},s={...z2e};return hF(aF(e,`triangles`,fj(`outlines`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform mat4 uInvProjection;

uniform float uOutlineThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

vec2 getDepthTransparentWithAlpha(const in vec2 coords) {
    #ifdef dTransparentOutline
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords));
    #else
        return vec2(1.0, 0.0);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    float backgroundViewZ = 2.0 * uFar;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepthOpaque = getDepthOpaque(coords);
    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);
    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;

    vec2 selfDepthTransparentWithAlpha = getDepthTransparentWithAlpha(coords);
    float selfDepthTransparent = selfDepthTransparentWithAlpha.x;
    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);
    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;

    float bestOpaqueDepth = 1.0;
    float bestTransparentDepth = 1.0;
    float bestTransparentAlpha = 0.0;

    float opaqueOutlineFlag = 0.0;
    float transparentOutlineFlag = 0.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            // Opaque
            float sampleDepthOpaque = getDepthOpaque(sampleCoords);
            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);
            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestOpaqueDepth) {
                bestOpaqueDepth = sampleDepthOpaque;
                opaqueOutlineFlag = 1.0;
            }

            // Transparent
            vec2 sampleDepthTransparentWithAlpha = getDepthTransparentWithAlpha(sampleCoords);
            float sampleDepthTransparent = sampleDepthTransparentWithAlpha.x;
            float sampleAlphaTransparent = sampleDepthTransparentWithAlpha.y;
            float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);
            if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestTransparentDepth) {
                bestTransparentDepth = sampleDepthTransparent;
                bestTransparentAlpha = sampleAlphaTransparent;
                transparentOutlineFlag = 1.0;
            }
        }
    }

    if (transparentOutlineFlag > 0.0 && bestOpaqueDepth < 1.0 && bestTransparentDepth > bestOpaqueDepth) {
        transparentOutlineFlag = 0.0;
        bestTransparentAlpha = 0.0;
    }

    vec2 depthPacked; // Pack depth in G/B channels
    float outlineTypeFlag = 0.0;
    if (opaqueOutlineFlag > 0.0 && transparentOutlineFlag > 0.0) {
        outlineTypeFlag = 0.75; // Both
        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);
    } else if (transparentOutlineFlag > 0.0) {
        outlineTypeFlag = 0.5;  // Transparent only
        depthPacked = packUnitIntervalToRG(bestTransparentDepth);
    } else if (opaqueOutlineFlag > 0.0) {
        outlineTypeFlag = 0.25; // Opaque only
        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);
    }

    float alpha = clamp(bestTransparentAlpha, 0.0, 0.5) * 2.0; // limiting to range [0.0, 0.5] to improve alpha precision since we don't need a wider range
    float packedFlagWithAlpha = pack2x4(vec2(outlineTypeFlag, alpha)); // pack outlineType with alpha
    gl_FragColor = vec4(packedFlagWithAlpha, depthPacked.x, depthPacked.y, bestTransparentDepth);
}
`),s,o),o)}const V2e={steps:V.Numeric(1,{min:1,max:64,step:1}),maxDistance:V.Numeric(3,{min:0,max:256,step:1}),tolerance:V.Numeric(1,{min:0,max:10,step:.1})};var S0=class{static isEnabled(e){return e.enabled&&e.shadow.name!==`off`}constructor(e,t,n,r){this.webgl=e,this.invProjection=z.identity(),this.invHeadRotation=z.identity(),this.target=e.createRenderTarget(t,n,!1),this.renderable=U2e(e,r)}getByteCount(){return this.target.getByteCount()}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;(e!==n||t!==r)&&(this.target.setSize(e,t),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r){let i=!1,a=e.state.mode===`orthographic`?1:0,[o,s]=this.renderable.values.uTexSize.ref.value,c=e.viewport;L.update(this.renderable.values.uProjection,e.projection),L.update(this.renderable.values.uInvProjection,z.invert(this.invProjection,e.projection)),AO.set(this.renderable.values.uBounds.ref.value,c.x/o,c.y/s,(c.x+c.width)/o,(c.y+c.height)/s),L.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),L.updateIfChanged(this.renderable.values.uNear,e.near),L.updateIfChanged(this.renderable.values.uFar,e.far),this.renderable.values.dOrthographic.ref.value!==a&&(L.update(this.renderable.values.dOrthographic,a),i=!0),L.updateIfChanged(this.renderable.values.uMaxDistance,r.maxDistance*e.scale),L.updateIfChanged(this.renderable.values.uTolerance,r.tolerance*e.scale),this.renderable.values.dSteps.ref.value!==r.steps&&(L.update(this.renderable.values.dSteps,r.steps),i=!0),z.isZero(e.headRotation)?L.update(this.renderable.values.uLightDirection,t.direction):L.update(this.renderable.values.uLightDirection,n0e(t,z.invert(this.invHeadRotation,e.headRotation))),L.update(this.renderable.values.uLightColor,t.color),this.renderable.values.dLightCount.ref.value!==t.count&&(L.update(this.renderable.values.dLightCount,t.count),i=!0),L.update(this.renderable.values.uAmbientColor,n),i&&this.renderable.update()}render(){$y&&this.webgl.timer.mark(`ShadowPass.render`),this.target.bind(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`ShadowPass.render`)}},H2e={..._F,tDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uProjection:J(`m4`),uInvProjection:J(`m4`),uBounds:J(`v4`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),dSteps:qP(`number`),uMaxDistance:J(`f`),uTolerance:J(`f`),uLightDirection:J(`v3[]`),uLightColor:J(`v3[]`),dLightCount:qP(`number`),uAmbientColor:J(`v3`)};function U2e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tDepth:L.create(t),uTexSize:L.create(R.create(n,r)),uProjection:L.create(z.identity()),uInvProjection:L.create(z.identity()),uBounds:L.create(AO()),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),dSteps:L.create(1),uMaxDistance:L.create(3),uTolerance:L.create(1),uLightDirection:L.create([]),uLightColor:L.create([]),dLightCount:L.create(0),uAmbientColor:L.create(B())},a={...H2e};return hF(aF(e,`triangles`,fj(`shadows`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif

uniform vec3 uAmbientColor;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uMaxDistance;
uniform float uTolerance;

// Map full [0,1] coords -> bounds [0,1] coords
vec2 fullCoordsToBoundsCoords(vec2 fullCoords) {
    return (fullCoords - uBounds.xy) / (uBounds.zw - uBounds.xy);
}

// Map bounds [0,1] coords -> full [0,1] coords
vec2 boundsCoordsToFullCoords(vec2 boundsCoords) {
    return uBounds.xy + (uBounds.zw - uBounds.xy) * boundsCoords;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float screenFade(const in vec2 coords) {
    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);
    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));
    return saturate(1.0 - dot(fade, fade));
}

// based on https://panoskarabelas.com/posts/screen_space_shadows/
vec3 screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in vec3 lightColor, const in float stepLength) {
    // Ray position and direction (in view-space)
    vec3 rayPos = position;
    vec3 rayDir = -lightDirection;

    // Compute ray step
    vec3 rayStep = rayDir * stepLength;

    // Ray march towards the light
    vec4 rayCoords = vec4(0.0);
    for (int i = 0; i < dSteps; ++i) {
        // Step the ray
        rayPos += rayStep;

        rayCoords = uProjection * vec4(rayPos, 1.0);
        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;
        rayCoords.xy = boundsCoordsToFullCoords(rayCoords.xy);

        if (outsideBounds(rayCoords.xy)) {
            return lightColor;
        }

        // Compute the difference between the ray's and the camera's depth
        float depth = getDepth(rayCoords.xy);
        float viewZ = getViewZ(depth);
        float zDelta = rayPos.z - viewZ;

        if (zDelta < uTolerance) {
            // Fade out as we approach the edges of the screen
            return mix(vec3(0.0), lightColor, 1.0 - screenFade(rayCoords.xy));
        }
    }

    return lightColor;
}

void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;
    float selfDepth = getDepth(selfCoords);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec2 selfBoundsCoords = fullCoordsToBoundsCoords(selfCoords);
    if (any(lessThan(selfBoundsCoords, vec2(0.0))) || any(greaterThan(selfBoundsCoords, vec2(1.0)))) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfBoundsCoords, selfDepth), uInvProjection);
    float stepLength = uMaxDistance / float(dSteps);

    float l = length(uAmbientColor);
    float a = l;
    #if dLightCount != 0
        vec3 s;
        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            s = screenSpaceShadow(selfViewPos, uLightDirection[i], uLightColor[i], stepLength);
            l += length(s);
            a += length(uLightColor[i]);
        }
        #pragma unroll_loop_end
    #endif

    gl_FragColor = vec4(l / a);
}
`),a,i),i)}const W2e={samples:V.Numeric(32,{min:1,max:256,step:1}),multiScale:V.MappedStatic(`off`,{on:V.Group({levels:V.ObjectList({radius:V.Numeric(5,{min:0,max:20,step:.1},{description:`Final occlusion radius is 2^x`}),bias:V.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:V.Numeric(10,{min:0,max:50,step:1}),farThreshold:V.Numeric(1500,{min:0,max:1e4,step:100})}),off:V.Group({})},{cycle:!0}),radius:V.Numeric(5,{min:0,max:20,step:.1},{description:`Final occlusion radius is 2^x`,hideIf:e=>e?.multiScale.name===`on`}),bias:V.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:V.Numeric(15,{min:1,max:25,step:2}),blurDepthBias:V.Numeric(.5,{min:0,max:1,step:.01}),resolutionScale:V.Numeric(1,{min:.1,max:1,step:.05},{description:`Adjust resolution of occlusion calculation`}),color:V.Color(tE(0)),transparentThreshold:V.Numeric(.4,{min:0,max:1,step:.05})};function G2e(e,t,n){let r=e.length,{radius:i,bias:a}=n||{radius:Array(r*3).fill(0),bias:Array(r*3).fill(0)};e=e.slice().sort((e,t)=>e.radius-t.radius);for(let n=0;n<r;++n){let r=e[n];i[n]=2**r.radius*t,a[n]=r.bias}return{count:r,radius:i,bias:a}}var C0=class e{static isEnabled(e){return e.enabled&&e.occlusion.name!==`off`}static isTransparentEnabled(e,t){return e.opacityAverage<1&&e.transparencyMin<t.transparentThreshold}calcSsaoScale(e){return Math.min(1,1/this.webgl.pixelRatio)*e}getDepthTexture(){return this.ssaoScale===1?this.depthTextureOpaque:this.downsampledDepthTargetOpaque.texture}getTransparentDepthTexture(){return this.ssaoScale===1?this.depthTextureTransparent:this.downsampledDepthTargetTransparent.texture}constructor(e,t,n,r,i,a){this.webgl=e,this.invProjection=z.identity(),this.levelsCameraScale=-1;let{textureFloatLinear:o}=e.extensions;this.depthTextureOpaque=i,this.depthTextureTransparent=a,this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.texSize=[t,n],this.levels=[],this.framebuffer=e.resources.framebuffer(),this.blurFirstPassFramebuffer=e.resources.framebuffer(),this.blurSecondPassFramebuffer=e.resources.framebuffer();let s=Math.floor(t*this.ssaoScale),c=Math.floor(n*this.ssaoScale),l=Math.max(1,Math.floor(s*.5)),u=Math.max(1,Math.floor(c*.5)),d=Math.max(1,Math.floor(s*.25)),f=Math.max(1,Math.floor(c*.25)),p=o?`linear`:`nearest`;this.downsampledDepthTargetOpaque=r?e.createRenderTarget(s,c,!1,`uint8`,`linear`,`rgba`):e.createRenderTarget(s,c,!1,`float32`,p,e.isWebGL2?`alpha`:`rgba`),this.downsampleDepthRenderableOpaque=yF(e,i);let m=this.getDepthTexture();this.depthHalfTargetOpaque=r?e.createRenderTarget(l,u,!1,`uint8`,`linear`,`rgba`):e.createRenderTarget(l,u,!1,`float32`,p,e.isWebGL2?`alpha`:`rgba`),this.depthHalfRenderableOpaque=yF(e,m),this.depthQuarterTargetOpaque=r?e.createRenderTarget(d,f,!1,`uint8`,`linear`,`rgba`):e.createRenderTarget(d,f,!1,`float32`,p,e.isWebGL2?`alpha`:`rgba`),this.depthQuarterRenderableOpaque=yF(e,this.depthHalfTargetOpaque.texture),this.downsampledDepthTargetTransparent=e.createRenderTarget(s,c,!1,`uint8`,`linear`,`rgba`),this.downsampleDepthRenderableTransparent=yF(e,a);let h=this.getTransparentDepthTexture();this.depthHalfTargetTransparent=e.createRenderTarget(l,u,!1,`uint8`,`linear`,`rgba`),this.depthHalfRenderableTransparent=yF(e,h),this.depthQuarterTargetTransparent=e.createRenderTarget(d,f,!1,`uint8`,`linear`,`rgba`),this.depthQuarterRenderableTransparent=yF(e,this.depthHalfTargetTransparent.texture),this.ssaoDepthTexture=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`linear`),this.ssaoDepthTexture.define(s,c),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,`color0`),this.ssaoDepthTransparentTexture=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`linear`),this.ssaoDepthTransparentTexture.define(s,c),this.depthBlurProxyTexture=e.resources.texture(`image-uint8`,`rgba`,`ubyte`,`linear`),this.depthBlurProxyTexture.define(s,c),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,`color0`),this.renderable=q2e(e,m,this.depthHalfTargetOpaque.texture,this.depthQuarterTargetOpaque.texture,h,this.depthHalfTargetTransparent.texture,this.depthQuarterTargetTransparent.texture),this.blurFirstPassRenderable=Y2e(e,this.ssaoDepthTransparentTexture,`horizontal`),this.blurSecondPassRenderable=Y2e(e,this.depthBlurProxyTexture,`vertical`)}getByteCount(){return this.downsampledDepthTargetOpaque.getByteCount()+this.depthHalfTargetOpaque.getByteCount()+this.depthQuarterTargetOpaque.getByteCount()+this.downsampledDepthTargetTransparent.getByteCount()+this.depthHalfTargetTransparent.getByteCount()+this.depthQuarterTargetTransparent.getByteCount()+this.ssaoDepthTexture.getByteCount()+this.ssaoDepthTransparentTexture.getByteCount()+this.depthBlurProxyTexture.getByteCount()}setSize(e,t){let[n,r]=this.texSize,i=this.calcSsaoScale(1);if(e!==n||t!==r||this.ssaoScale!==i){this.texSize.splice(0,2,e,t);let n=Math.floor(e*this.ssaoScale),r=Math.floor(t*this.ssaoScale);this.ssaoDepthTexture.define(n,r),this.ssaoDepthTransparentTexture.define(n,r),this.depthBlurProxyTexture.define(n,r);let i=Math.max(1,Math.floor(n*.5)),a=Math.max(1,Math.floor(r*.5)),o=Math.max(1,Math.floor(n*.25)),s=Math.max(1,Math.floor(r*.25));this.downsampledDepthTargetOpaque.setSize(n,r),this.depthHalfTargetOpaque.setSize(i,a),this.depthQuarterTargetOpaque.setSize(o,s),L.update(this.downsampleDepthRenderableOpaque.values.uTexSize,R.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,n,r)),L.update(this.depthHalfRenderableOpaque.values.uTexSize,R.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,i,a)),L.update(this.depthQuarterRenderableOpaque.values.uTexSize,R.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,o,s)),this.downsampledDepthTargetTransparent.setSize(n,r),this.depthHalfTargetTransparent.setSize(i,a),this.depthQuarterTargetTransparent.setSize(o,s),L.update(this.downsampleDepthRenderableTransparent.values.uTexSize,R.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,n,r)),L.update(this.depthHalfRenderableTransparent.values.uTexSize,R.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,i,a)),L.update(this.depthQuarterRenderableTransparent.values.uTexSize,R.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,o,s)),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,n,r)),L.update(this.blurFirstPassRenderable.values.uTexSize,R.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,n,r)),L.update(this.blurSecondPassRenderable.values.uTexSize,R.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,n,r));let c=this.getDepthTexture(),l=this.getTransparentDepthTexture();L.update(this.depthHalfRenderableOpaque.values.tColor,c),L.update(this.depthHalfRenderableTransparent.values.tColor,l),L.update(this.renderable.values.tDepth,c),L.update(this.renderable.values.tDepthTransparent,l),this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update(),this.renderable.update()}}reset(){this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,`color0`),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,`color0`)}update(t,n,r,i=!1){let a=!1,o=!1,s=!1,c=t.state.mode===`orthographic`?1:0,l=z.invert(this.invProjection,t.projection),[u,d]=this.texSize,f=t.viewport;L.update(this.renderable.values.uProjection,t.projection),L.update(this.renderable.values.uInvProjection,l);let p=this.renderable.values.uBounds,m=this.ssaoScale;AO.set(p.ref.value,Math.floor(f.x*m)/(u*m),Math.floor(f.y*m)/(d*m),Math.ceil((f.x+f.width)*m)/(u*m),Math.ceil((f.y+f.height)*m)/(d*m)),L.update(p,p.ref.value),L.update(this.blurFirstPassRenderable.values.uBounds,p.ref.value),L.update(this.blurSecondPassRenderable.values.uBounds,p.ref.value),L.updateIfChanged(this.blurFirstPassRenderable.values.uNear,t.near),L.updateIfChanged(this.blurSecondPassRenderable.values.uNear,t.near),L.updateIfChanged(this.blurFirstPassRenderable.values.uFar,t.far),L.updateIfChanged(this.blurSecondPassRenderable.values.uFar,t.far),L.update(this.blurFirstPassRenderable.values.uInvProjection,l),L.update(this.blurSecondPassRenderable.values.uInvProjection,l),L.update(this.blurFirstPassRenderable.values.uBlurDepthBias,r.blurDepthBias*t.scale),L.update(this.blurSecondPassRenderable.values.uBlurDepthBias,r.blurDepthBias*t.scale),this.blurFirstPassRenderable.values.dOrthographic.ref.value!==c&&(o=!0,L.update(this.blurFirstPassRenderable.values.dOrthographic,c),L.update(this.blurSecondPassRenderable.values.dOrthographic,c));let h=e.isTransparentEnabled(n,r);this.renderable.values.dIncludeTransparent.ref.value!==h&&(a=!0,L.update(this.renderable.values.dIncludeTransparent,h)),this.renderable.values.dIllumination.ref.value!==i&&(a=!0,L.update(this.renderable.values.dIllumination,i)),this.nSamples!==r.samples&&(a=!0,this.nSamples=r.samples,L.update(this.renderable.values.uSamples,Z2e(this.nSamples)),L.updateIfChanged(this.renderable.values.dNSamples,this.nSamples));let g=r.multiScale.name===`on`;if(this.renderable.values.dMultiScale.ref.value!==g&&(a=!0,L.update(this.renderable.values.dMultiScale,g)),r.multiScale.name===`on`){let e=r.multiScale.params;if(this.levelsCameraScale!==t.scale||!Tx(this.levels,e.levels)){a=!0,this.levelsCameraScale=t.scale,this.levels=e.levels;let n=G2e(e.levels,t.scale);L.updateIfChanged(this.renderable.values.dLevels,n.count),L.update(this.renderable.values.uLevelRadius,n.radius),L.update(this.renderable.values.uLevelBias,n.bias)}L.updateIfChanged(this.renderable.values.uNearThreshold,e.nearThreshold),L.updateIfChanged(this.renderable.values.uFarThreshold,e.farThreshold)}else L.updateIfChanged(this.renderable.values.uRadius,2**r.radius*t.scale);if(L.updateIfChanged(this.renderable.values.uBias,r.bias),this.blurKernelSize!==r.blurKernelSize){o=!0,this.blurKernelSize=r.blurKernelSize;let e=X2e(this.blurKernelSize);L.update(this.blurFirstPassRenderable.values.uKernel,e),L.update(this.blurSecondPassRenderable.values.uKernel,e),L.update(this.blurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),L.update(this.blurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}let _=this.calcSsaoScale(r.resolutionScale);if(this.ssaoScale!==_){a=!0,s=!0,this.ssaoScale=_;let e=Math.floor(u*this.ssaoScale),t=Math.floor(d*this.ssaoScale);this.ssaoDepthTexture.define(e,t),this.ssaoDepthTransparentTexture.define(e,t),this.depthBlurProxyTexture.define(e,t);let n=Math.floor(e*.5),r=Math.floor(t*.5),i=Math.floor(e*.25),o=Math.floor(t*.25);this.downsampledDepthTargetOpaque.setSize(e,t),this.depthHalfTargetOpaque.setSize(n,r),this.depthQuarterTargetOpaque.setSize(i,o);let c=this.getDepthTexture();L.update(this.depthHalfRenderableOpaque.values.tColor,c),L.update(this.renderable.values.tDepth,c),L.update(this.renderable.values.tDepthHalf,this.depthHalfTargetOpaque.texture),L.update(this.renderable.values.tDepthQuarter,this.depthQuarterTargetOpaque.texture),L.update(this.downsampleDepthRenderableOpaque.values.uTexSize,R.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,e,t)),L.update(this.depthHalfRenderableOpaque.values.uTexSize,R.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,n,r)),L.update(this.depthQuarterRenderableOpaque.values.uTexSize,R.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,i,o)),this.downsampledDepthTargetTransparent.setSize(e,t),this.depthHalfTargetTransparent.setSize(n,r),this.depthQuarterTargetTransparent.setSize(i,o);let l=this.getTransparentDepthTexture();L.update(this.depthHalfRenderableTransparent.values.tColor,l),L.update(this.renderable.values.tDepthTransparent,l),L.update(this.renderable.values.tDepthHalfTransparent,this.depthHalfTargetTransparent.texture),L.update(this.renderable.values.tDepthQuarterTransparent,this.depthQuarterTargetTransparent.texture),L.update(this.downsampleDepthRenderableTransparent.values.uTexSize,R.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,e,t)),L.update(this.depthHalfRenderableTransparent.values.uTexSize,R.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,n,r)),L.update(this.depthQuarterRenderableTransparent.values.uTexSize,R.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,i,o)),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)),L.update(this.blurFirstPassRenderable.values.uTexSize,R.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,e,t)),L.update(this.blurSecondPassRenderable.values.uTexSize,R.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,e,t))}a&&this.renderable.update(),o&&(this.blurFirstPassRenderable.update(),this.blurSecondPassRenderable.update()),s&&(this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update())}render(e){$y&&this.webgl.timer.mark(`SSAO.render`);let{state:t}=this.webgl,{x:n,y:r,width:i,height:a}=e.viewport,o=this.renderable.values.dIncludeTransparent.ref.value,s=this.renderable.values.dMultiScale.ref.value,c=Math.floor(n*this.ssaoScale),l=Math.floor(r*this.ssaoScale),u=Math.ceil(i*this.ssaoScale),d=Math.ceil(a*this.ssaoScale);t.viewport(c,l,u,d),t.scissor(c,l,u,d),this.ssaoScale<1&&($y&&this.webgl.timer.mark(`SSAO.downsample`),this.downsampledDepthTargetOpaque.bind(),this.downsampleDepthRenderableOpaque.render(),o&&(this.downsampledDepthTargetTransparent.bind(),this.downsampleDepthRenderableTransparent.render()),$y&&this.webgl.timer.markEnd(`SSAO.downsample`)),$y&&this.webgl.timer.mark(`SSAO.half`),s&&(this.depthHalfTargetOpaque.bind(),this.depthHalfRenderableOpaque.render()),s&&o&&(this.depthHalfTargetTransparent.bind(),this.depthHalfRenderableTransparent.render()),$y&&this.webgl.timer.markEnd(`SSAO.half`),$y&&this.webgl.timer.mark(`SSAO.quarter`),s&&(this.depthQuarterTargetOpaque.bind(),this.depthQuarterRenderableOpaque.render()),s&&o&&(this.depthQuarterTargetTransparent.bind(),this.depthQuarterRenderableTransparent.render()),$y&&this.webgl.timer.markEnd(`SSAO.quarter`),$y&&this.webgl.timer.mark(`SSAO.opaque`),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,`color0`),L.update(this.renderable.values.uTransparencyFlag,0),this.framebuffer.bind(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`SSAO.opaque`),$y&&this.webgl.timer.mark(`SSAO.blurOpaque`),L.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTexture.attachFramebuffer(this.blurSecondPassFramebuffer,`color0`),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),$y&&this.webgl.timer.markEnd(`SSAO.blurOpaque`),o&&($y&&this.webgl.timer.mark(`SSAO.transparent `),this.ssaoDepthTransparentTexture.attachFramebuffer(this.framebuffer,`color0`),L.update(this.renderable.values.uTransparencyFlag,1),this.framebuffer.bind(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`SSAO.transparent `),$y&&this.webgl.timer.mark(`SSAO.blurTransparent `),L.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTransparentTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTransparentTexture.attachFramebuffer(this.blurSecondPassFramebuffer,`color0`),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),$y&&this.webgl.timer.markEnd(`SSAO.blurTransparent `)),$y&&this.webgl.timer.markEnd(`SSAO.render`)}},K2e={..._F,tDepth:GP(`texture`,`rgba`,`ubyte`,`linear`),tDepthHalf:GP(`texture`,`rgba`,`ubyte`,`linear`),tDepthQuarter:GP(`texture`,`rgba`,`ubyte`,`linear`),dIllumination:qP(`boolean`),uTransparencyFlag:J(`i`),dIncludeTransparent:qP(`boolean`),tDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`linear`),tDepthHalfTransparent:GP(`texture`,`rgba`,`ubyte`,`linear`),tDepthQuarterTransparent:GP(`texture`,`rgba`,`ubyte`,`linear`),uSamples:J(`v3[]`),dNSamples:qP(`number`),uProjection:J(`m4`),uInvProjection:J(`m4`),uBounds:J(`v4`),uTexSize:J(`v2`),uRadius:J(`f`),uBias:J(`f`),dMultiScale:qP(`boolean`),dLevels:qP(`number`),uLevelRadius:J(`f[]`),uLevelBias:J(`f[]`),uNearThreshold:J(`f`),uFarThreshold:J(`f`)};function q2e(e,t,n,r,i,a,o){let s={...vF,tDepth:L.create(t),tDepthHalf:L.create(n),tDepthQuarter:L.create(r),dIllumination:L.create(!1),dIncludeTransparent:L.create(!0),uTransparencyFlag:L.create(0),tDepthTransparent:L.create(i),tDepthHalfTransparent:L.create(a),tDepthQuarterTransparent:L.create(o),uSamples:L.create(Z2e(32)),dNSamples:L.create(32),uProjection:L.create(z.identity()),uInvProjection:L.create(z.identity()),uBounds:L.create(AO()),uTexSize:L.create(R.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:L.create(2**5),uBias:L.create(.8),dMultiScale:L.create(!1),dLevels:L.create(3),uLevelRadius:L.create([2**2,2**5,2**8]),uLevelBias:L.create([.8,.8,.8]),uNearThreshold:L.create(10),uFarThreshold:L.create(1500)},c={...K2e};return hF(aF(e,`triangles`,fj(`ssao`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common


uniform sampler2D tDepth;
uniform sampler2D tDepthHalf;
uniform sampler2D tDepthQuarter;

#if defined(dIncludeTransparent)
    uniform sampler2D tDepthTransparent;
    uniform sampler2D tDepthHalfTransparent;
    uniform sampler2D tDepthQuarterTransparent;
#endif

uniform int uTransparencyFlag;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#ifdef dMultiScale
    uniform float uLevelRadius[dLevels];
    uniform float uLevelBias[dLevels];
    uniform float uNearThreshold;
    uniform float uFarThreshold;
#else
    uniform float uRadius;
#endif
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords, const in int transparentFlag) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    if (transparentFlag == 1){
        #if defined(dIncludeTransparent)
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c)).x;
        #else
            return 1.0;
        #endif
    } else {
        #ifdef depthTextureSupport
            return texture2D(tDepth, c).r;
        #else
            return unpackRGBAToDepth(texture2D(tDepth, c));
        #endif
    }
}

#if defined(dIncludeTransparent)
    vec2 getDepthTransparentWithAlpha(const in vec2 coords){
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
    }
#endif

#define dQuarterThreshold 0.1
#define dHalfThreshold 0.05

float getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    float d = distance(coords, selfCoords);
    #ifdef depthTextureSupport
        if (d > dQuarterThreshold) {
            return texture2D(tDepthQuarter, c).r;
        } else if (d > dHalfThreshold) {
            return texture2D(tDepthHalf, c).r;
        } else {
            return texture2D(tDepth, c).r;
        }
    #else
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthHalf, c));
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, c));
        }
    #endif
}

#if defined(dIncludeTransparent)
    vec2 getMappedDepthTransparentWithAlpha(const in vec2 coords, const in vec2 selfCoords) {
        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
        float d = distance(coords, selfCoords);
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthQuarterTransparent, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthHalfTransparent, c));
        } else {
            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));
        }
    }
#endif

// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0
vec3 viewNormalAtPixelPositionAccurate(const in vec2 vpos, const in int transparentFlag) {
    // current pixel's depth
    float c = getDepth(vpos, transparentFlag);

    // get current pixel's view space position
    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);

    // get view space position at 1 pixel offsets in each major direction
    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize, transparentFlag)), uInvProjection);
    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize, transparentFlag)), uInvProjection);

    // get the difference between the current and each offset position
    vec3 l = viewSpacePos_c - viewSpacePos_l;
    vec3 r = viewSpacePos_r - viewSpacePos_c;
    vec3 d = viewSpacePos_c - viewSpacePos_d;
    vec3 u = viewSpacePos_u - viewSpacePos_c;

    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis
    vec4 H = vec4(
        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize, transparentFlag)
    );

    // get depth values at 1 & 2 pixels offsets from current along the vertical axis
    vec4 V = vec4(
        getDepth(vpos + vec2(0.0,-1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 1.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0,-2.0) / uTexSize, transparentFlag),
        getDepth(vpos + vec2(0.0, 2.0) / uTexSize, transparentFlag)
    );

    // current pixel's depth difference from slope of offset depth samples
    // differs from original article because we're using non-linear depth values
    // see article's comments
    vec2 he = abs((2.0 * H.xy - H.zw) - c);
    vec2 ve = abs((2.0 * V.xy - V.zw) - c);

    // pick horizontal and vertical diff with the smallest depth difference from slopes
    vec3 hDeriv = he.x < he.y ? l : r;
    vec3 vDeriv = ve.x < ve.y ? d : u;

    // get view space normal from the cross product of the best derivatives
    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));

    return viewNormal;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;
    float selfDepth = getDepth(selfCoords, uTransparencyFlag);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);
        return;
    }

    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords, uTransparencyFlag);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));
    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    #ifdef dMultiScale
        float pixelSize = getPixelSize(selfCoords, selfDepth);

        for(int l = 0; l < dLevels; l++) {
            // TODO: smooth transition
            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;
            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;

            float levelOcclusion = 0.0;
            for(int i = 0; i < dNSamples; i++) {
                // get sample position:
                vec3 sampleViewPos = TBN * uSamples[i];
                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];

                // project sample position:
                vec4 offset = vec4(sampleViewPos, 1.0);
                offset = uProjection * offset;
                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

                // get sample depth:
                float sampleOcc = 0.0;
                #ifdef dIllumination
                    if (uTransparencyFlag == 1) {
                #endif
                    float sampleDepth = getMappedDepth(offset.xy, selfCoords);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];
                #ifdef dIllumination
                    }
                #endif
                #if defined(dIncludeTransparent)
                    vec2 sampleDepthWithAlpha = getMappedDepthTransparentWithAlpha(offset.xy, selfCoords);
                    if (!isBackground(sampleDepthWithAlpha.x)) {
                        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                        sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l] * sampleDepthWithAlpha.y);
                    }
                #endif

                levelOcclusion += sampleOcc;
            }
            occlusion = max(occlusion, levelOcclusion);
        }
    #else
        for(int i = 0; i < dNSamples; i++) {
            vec3 sampleViewPos = TBN * uSamples[i];
            sampleViewPos = selfViewPos + sampleViewPos * uRadius;

            vec4 offset = vec4(sampleViewPos, 1.0);
            offset = uProjection * offset;
            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

            float sampleOcc = 0.0;
            #ifdef dIllumination
                if (uTransparencyFlag == 1) {
            #endif
                    // NOTE: using getMappedDepth here causes issues on some mobile devices
                    float sampleDepth = getDepth(offset.xy, 0);
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
            #ifdef dIllumination
                }
            #endif
            #if defined(dIncludeTransparent)
                vec2 sampleDepthWithAlpha = getDepthTransparentWithAlpha(offset.xy);
                if (!isBackground(sampleDepthWithAlpha.x)) {
                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;
                    sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ)) * sampleDepthWithAlpha.y);
                }
            #endif

            occlusion += sampleOcc;
        }
    #endif
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`),c,s),s)}var J2e={..._F,tSsaoDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uKernel:J(`f[]`),dOcclusionKernelSize:qP(`number`),uBlurDepthBias:J(`f`),uBlurDirectionX:J(`f`),uBlurDirectionY:J(`f`),uInvProjection:J(`m4`),uNear:J(`f`),uFar:J(`f`),uBounds:J(`v4`),dOrthographic:qP(`number`)};function Y2e(e,t,n){let r={...vF,tSsaoDepth:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),uKernel:L.create(X2e(15)),dOcclusionKernelSize:L.create(15),uBlurDepthBias:L.create(.5),uBlurDirectionX:L.create(n===`horizontal`?1:0),uBlurDirectionY:L.create(n===`vertical`?1:0),uInvProjection:L.create(z.identity()),uNear:L.create(0),uFar:L.create(1e4),uBounds:L.create(AO()),dOrthographic:L.create(0)},i={...J2e};return hF(aF(e,`triangles`,fj(`ssao_blur`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];
uniform float uBlurDepthBias;

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform mat4 uInvProjection;
uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool isNearClip(const in float depth) {
    return depth == 0.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // (if background and if second pass) or if near clip
    if ((isBackground(selfDepth) && uBlurDirectionY != 0.0) || isNearClip(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);
    float pixelSize = getPixelSize(coords, selfDepth);

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    int halfKernelSize = dOcclusionKernelSize / 2;
    // only if kernelSize is odd
    for (int i = -halfKernelSize; i <= halfKernelSize; i++) {
        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;

        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth) || isNearClip(sampleDepth)) {
            continue;
        }

        float sampleViewZ = getViewZ(sampleDepth);
        if (abs(selfViewZ - sampleViewZ) >= uBlurDepthBias) {
            continue;
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }
    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`),i,r),r)}function X2e(e){let t=e/3,n=Math.floor((e+1)/2),r=[];for(let e=0;e<n;e++)r.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-e*e/(2*t*t)));return r}var w0=[];for(let e=0;e<256;e++){let e=B();e[0]=Math.random()*2-1,e[1]=Math.random()*2-1,e[2]=Math.random(),B.normalize(e,e),B.scale(e,e,Math.random()),w0.push(e)}function Z2e(e){let t=[];for(let n=0;n<e;n++){let r=(n*n+2*n+1)/(e*e);r=.1+r*.9,t.push(w0[n][0]*r),t.push(w0[n][1]*r),t.push(w0[n][2]*r)}return t}var Q2e={..._F,tSsaoDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),tSsaoDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),tTransparentColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),dBlendTransparency:qP(`boolean`),tDepthOpaque:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),tShadows:GP(`texture`,`rgba`,`ubyte`,`nearest`),tOutlines:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),uFogNear:J(`f`),uFogFar:J(`f`),uFogColor:J(`v3`),uOutlineColor:J(`v3`),uOcclusionColor:J(`v3`),uTransparentBackground:J(`b`),dOcclusionEnable:qP(`boolean`),dOcclusionSingleDepth:qP(`boolean`),dOcclusionIncludeOpacity:qP(`boolean`),dOcclusionIncludeTransparency:qP(`boolean`),uOcclusionOffset:J(`v2`),dShadowEnable:qP(`boolean`),dOutlineEnable:qP(`boolean`),dOutlineScale:qP(`number`),dTransparentOutline:qP(`boolean`)};function $2e(e,t,n,r,i,a,o,s,c,l){let u={...vF,tSsaoDepth:L.create(s),tSsaoDepthTransparent:L.create(c),tColor:L.create(t),tTransparentColor:L.create(n),dBlendTransparency:L.create(!0),tDepthOpaque:L.create(r),tDepthTransparent:L.create(i),tShadows:L.create(a),tOutlines:L.create(o),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uFogNear:L.create(1e4),uFogFar:L.create(1e4),uFogColor:L.create(B.create(1,1,1)),uOutlineColor:L.create(B.create(0,0,0)),uOcclusionColor:L.create(B.create(0,0,0)),uTransparentBackground:L.create(!1),dOcclusionEnable:L.create(!0),dOcclusionSingleDepth:L.create(!1),dOcclusionIncludeOpacity:L.create(!0),dOcclusionIncludeTransparency:L.create(!1),uOcclusionOffset:L.create(R.create(0,0)),dShadowEnable:L.create(!1),dOutlineEnable:L.create(!1),dOutlineScale:L.create(1),dTransparentOutline:L.create(l)},d={...Q2e};return hF(aF(e,`triangles`,fj(`postprocessing`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tColor;
uniform sampler2D tTransparentColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tShadows;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;
uniform vec2 uOcclusionOffset;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
void getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {
    vec2 invTexSize = 1.0 / uTexSize;

    hasOpaque = false;
    hasTransparent = false;
    opaqueDepth = 1.0;
    transparentDepth = 1.0;
    alpha = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);
            float sampleTransparentDepth = sampleOutlineCombined.a;
            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);

            float sampleFlag = sampleFlagWithAlpha.x;
            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);

            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both
                if (sampleOpaqueDepth < opaqueDepth) {
                    hasOpaque = true;
                    opaqueDepth = sampleOpaqueDepth;
                }
            }

            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both
                hasTransparent = true;
                transparentDepth = sampleTransparentDepth;
                alpha = sampleAlpha;
            }
        }
    }
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float opaqueDepth = getDepthOpaque(coords);
    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        #if defined(dOutlineEnable) || defined(dOcclusionEnable) && defined(dOcclusionIncludeTransparency)
            transparentDepth = getDepthTransparent(coords);
        #endif
    #endif

    #if defined(dOcclusionEnable) || defined(dShadowEnable)
        bool isOpaqueBackground = isBackground(opaqueDepth);
        float viewDist = abs(getViewZ(opaqueDepth));
        float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
    #endif

    #if defined(dOcclusionEnable)
        if (!isOpaqueBackground) {
            float occlusionFactor = getSsao(coords + uOcclusionOffset);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #if defined(dBlendTransparency) && defined(dOcclusionIncludeTransparency)
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords + uOcclusionOffset);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dShadowEnable
        if (!isOpaqueBackground) {
            vec4 shadow = texture2D(tShadows, coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);
            } else {
                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);
            }
        }
    #endif

    // outline needs to be handled after occlusion and shadow to keep them clean
    #ifdef dOutlineEnable
        bool hasOpaque;
        bool hasTransparent;
        float outlineOpaqueDepth;
        float outlineTransparentDepth;
        float outlineAlpha;
        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);

        if (hasOpaque) {
            float viewDist = abs(getViewZ(outlineOpaqueDepth));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
        }

        #ifdef dBlendTransparency
            if (hasTransparent) {
                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {
                    blendTransparency = false;
                } else {
                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);
                    float viewDist = abs(getViewZ(outlineTransparentDepth));
                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));
                    transparentColor.a = finalAlpha;
                    transparentColor.rgb = uOutlineColor * finalAlpha;
                }
            }
        #endif
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            float alpha = transparentColor.a;
            if (alpha != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - alpha);
            }
        }
    #endif

    gl_FragColor = color;
}
`),d,u),u)}const T0={enabled:V.Boolean(!0),occlusion:V.MappedStatic(`on`,{on:V.Group(W2e),off:V.Group({})},{cycle:!0,description:`Darken occluded crevices with the ambient occlusion effect`,hideIf:e=>e.enabled===!1}),shadow:V.MappedStatic(`off`,{on:V.Group(V2e),off:V.Group({})},{cycle:!0,description:`Simplistic shadows`,hideIf:e=>e.enabled===!1}),outline:V.MappedStatic(`off`,{on:V.Group(R2e),off:V.Group({})},{cycle:!0,description:`Draw outline around 3D objects`,hideIf:e=>e.enabled===!1}),dof:V.MappedStatic(`off`,{on:V.Group(b2e),off:V.Group({})},{cycle:!0,description:`DOF`,hideIf:e=>e.enabled===!1}),antialiasing:V.MappedStatic(`smaa`,{fxaa:V.Group(j0e),smaa:V.Group(I0e),off:V.Group({})},{options:[[`fxaa`,`FXAA`],[`smaa`,`SMAA`],[`off`,`Off`]],description:`Smooth pixel edges`,hideIf:e=>e.enabled===!1}),sharpening:V.MappedStatic(`off`,{on:V.Group(h2e),off:V.Group({})},{cycle:!0,description:`Contrast Adaptive Sharpening`,hideIf:e=>e.enabled===!1}),background:V.Group(e2e,{isFlat:!0,hideIf:e=>e.enabled===!1}),bloom:V.MappedStatic(`on`,{on:V.Group(w2e),off:V.Group({})},{cycle:!0,description:`Bloom`,hideIf:e=>e.enabled===!1})};var E0=class e{static isEnabled(e){return e.enabled&&(C0.isEnabled(e)||S0.isEnabled(e)||x0.isEnabled(e)||e.background.variant.name!==`off`)}static isTransparentDepthRequired(t,n){return n.enabled&&(_0.isEnabled(n)||x0.isEnabled(n)&&e.isTransparentOutlineEnabled(n)||C0.isEnabled(n)&&e.isTransparentSsaoEnabled(t,n))&&t.opacityAverage<1}static isTransparentOutlineEnabled(e){return e.enabled&&x0.isEnabled(e)&&(e.outline.params.includeTransparent??!0)}static isTransparentSsaoEnabled(e,t){return t.enabled&&C0.isEnabled(t)&&C0.isTransparentEnabled(e,t.occlusion.params)}static isSsaoEnabled(e){return e.enabled&&C0.isEnabled(e)}constructor(e,t,n){this.webgl=e,this.drawPass=n,this.occlusionOffset=[0,0],this.transparentBackground=!1;let{colorTarget:r,transparentColorTarget:i,depthTextureOpaque:a,depthTextureTransparent:o,packedDepth:s}=n,c=r.getWidth(),l=r.getHeight();this.target=e.createRenderTarget(c,l,!1,`uint8`,`linear`),this.ssao=new C0(e,c,l,s,a,o),this.shadow=new S0(e,c,l,a),this.outline=new x0(e,c,l,o,a),this.renderable=$2e(e,r.texture,i.texture,a,o,this.shadow.target.texture,this.outline.target.texture,this.ssao.ssaoDepthTexture,this.ssao.ssaoDepthTransparentTexture,!0),this.background=new t2e(e,t,c,l)}getByteCount(){return this.target.getByteCount()+this.ssao.getByteCount()+this.shadow.getByteCount()+this.outline.getByteCount()}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;(e!==n||t!==r)&&(this.target.setSize(e,t),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t))),this.ssao.setSize(e,t),this.shadow.setSize(e,t),this.outline.setSize(e,t),this.background.setSize(e,t)}reset(){this.ssao.reset()}updateState(e,t,n,r,i,a,o){let s=!1,c=e.state.mode===`orthographic`?1:0,l=x0.isEnabled(i),u=S0.isEnabled(i),d=C0.isEnabled(i);if(d){let n=i.occlusion.params;this.ssao.update(e,t,n);let r=C0.isTransparentEnabled(t,n);this.renderable.values.dOcclusionIncludeTransparency.ref.value!==r&&(s=!0,L.update(this.renderable.values.dOcclusionIncludeTransparency,r)),L.update(this.renderable.values.uOcclusionColor,tE.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,n.color))}if(u&&this.shadow.update(e,a,o,i.shadow.params),l){let t=i.outline.params,{transparentOutline:n,outlineScale:r}=this.outline.update(e,t,this.drawPass.depthTextureTransparent,this.drawPass.depthTextureOpaque);L.update(this.renderable.values.uOutlineColor,tE.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,t.color)),this.renderable.values.dOutlineScale.ref.value!==r&&(s=!0,L.update(this.renderable.values.dOutlineScale,r)),this.renderable.values.dTransparentOutline.ref.value!==n&&(s=!0,L.update(this.renderable.values.dTransparentOutline,n))}L.updateIfChanged(this.renderable.values.uFar,e.far),L.updateIfChanged(this.renderable.values.uNear,e.near),L.updateIfChanged(this.renderable.values.uFogFar,e.fogFar),L.updateIfChanged(this.renderable.values.uFogNear,e.fogNear),L.update(this.renderable.values.uFogColor,tE.toVec3Normalized(this.renderable.values.uFogColor.ref.value,r)),L.updateIfChanged(this.renderable.values.uTransparentBackground,n),this.renderable.values.dOrthographic.ref.value!==c&&(s=!0,L.update(this.renderable.values.dOrthographic,c)),this.renderable.values.dOutlineEnable.ref.value!==l&&(s=!0,L.update(this.renderable.values.dOutlineEnable,l)),this.renderable.values.dShadowEnable.ref.value!==u&&(s=!0,L.update(this.renderable.values.dShadowEnable,u)),this.renderable.values.dOcclusionEnable.ref.value!==d&&(s=!0,L.update(this.renderable.values.dOcclusionEnable,d));let f=t.opacityAverage<1;this.renderable.values.dBlendTransparency.ref.value!==f&&(s=!0,L.update(this.renderable.values.dBlendTransparency,f)),s&&this.renderable.update();let{gl:p,state:m}=this.webgl;m.enable(p.SCISSOR_TEST),m.disable(p.BLEND),m.disable(p.DEPTH_TEST),m.depthMask(!1)}setOcclusionOffset(e,t){this.occlusionOffset[0]=e,this.occlusionOffset[1]=t,L.update(this.renderable.values.uOcclusionOffset,R.set(this.renderable.values.uOcclusionOffset.ref.value,e,t))}setTransparentBackground(e){this.transparentBackground=e}render(e,t,n,r,i,a,o,s){$y&&this.webgl.timer.mark(`PostprocessingPass.render`),this.updateState(e,t,r,i,a,o,s);let{state:c}=this.webgl,{x:l,y:u,width:d,height:f}=e.viewport;a.occlusion.name===`on`&&this.occlusionOffset[0]===0&&this.occlusionOffset[1]===0&&this.ssao.render(e),c.viewport(l,u,d,f),c.scissor(l,u,d,f),a.outline.name===`on`&&this.outline.render(),a.shadow.name===`on`&&this.shadow.render(),n?this.webgl.bindDrawingBuffer():this.target.bind(),this.background.update(e,a.background),this.background.clear(a.background,this.transparentBackground,i),this.background.render(a.background),this.renderable.render(),$y&&this.webgl.timer.markEnd(`PostprocessingPass.render`)}},D0=class{static isEnabled(e){return e.enabled&&(e.antialiasing.name!==`off`||e.sharpening.name!==`off`)}constructor(e,t,n){this.target=e.createRenderTarget(t,n,!1),this.internalTarget=e.createRenderTarget(t,n,!1),this.fxaa=new M0e(e,this.target.texture),this.smaa=new L0e(e,this.target.texture),this.cas=new g2e(e,this.target.texture)}getByteCount(){return this.target.getByteCount()+this.internalTarget.getByteCount()+this.smaa.getByteCount()}setSize(e,t){let n=this.target.texture.getWidth(),r=this.target.texture.getHeight();(e!==n||t!==r)&&(this.target.setSize(e,t),this.internalTarget.setSize(e,t),this.fxaa.setSize(e,t),this.smaa.supported&&this.smaa.setSize(e,t),this.cas.setSize(e,t))}_renderFxaa(e,t,n,r){r.antialiasing.name===`fxaa`&&(this.fxaa.update(t,r.antialiasing.params),this.fxaa.render(e.viewport,n))}_renderSmaa(e,t,n,r){r.antialiasing.name===`smaa`&&(this.smaa.update(t,r.antialiasing.params),this.smaa.render(e.viewport,n))}_renderAntialiasing(e,t,n,r){r.antialiasing.name===`fxaa`?this._renderFxaa(e,t,n,r):r.antialiasing.name===`smaa`&&this._renderSmaa(e,t,n,r)}_renderCas(e,t,n,r){r.sharpening.name===`on`&&(r.antialiasing.name!==`off`&&(t=this.internalTarget.texture),this.cas.update(t,r.sharpening.params),this.cas.render(e.viewport,n))}render(e,t,n,r){if(r.antialiasing.name===`off`&&r.sharpening.name===`off`)return;if(r.antialiasing.name===`smaa`&&!this.smaa.supported){console.error(`SMAA not supported, missing "HTMLImageElement"`);return}let i=n===!0?void 0:n===!1?this.target:n;r.sharpening.name===`off`?this._renderAntialiasing(e,t,i,r):(r.antialiasing.name===`off`||this._renderAntialiasing(e,t,this.internalTarget,r),this._renderCas(e,t,i,r))}};const e4e=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var t4e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uWeight:J(`f`)},n4e=fj(`compose`,tF,e4e);function r4e(e,t){let n={...vF,tColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),uWeight:L.create(1)};return hF(aF(e,`triangles`,n4e,{...t4e},n),n)}const i4e={mode:V.Select(`temporal`,[[`off`,`Off`],[`on`,`On`],[`temporal`,`Temporal`]]),sampleLevel:V.Numeric(2,{min:0,max:5,step:1},{description:`Take level^2 samples.`}),reduceFlicker:V.Boolean(!0,{description:`Reduce flicker in "temporal" mode.`}),reuseOcclusion:V.Boolean(!0,{description:`Reuse occlusion data. It is faster but has some artefacts.`})};var O0=class{static isEnabled(e){return e.mode!==`off`}constructor(e,t){this.webgl=e,this.drawPass=t;let{colorBufferFloat:n,textureFloat:r,colorBufferHalfFloat:i,textureHalfFloat:a}=e.extensions,o=t.colorTarget.getWidth(),s=t.colorTarget.getHeight();this.colorTarget=e.createRenderTarget(o,s,!1);let c=i&&a?`fp16`:n&&r?`float32`:`uint8`;this.composeTarget=e.createRenderTarget(o,s,!1,c),this.holdTarget=e.createRenderTarget(o,s,!1),this.compose=r4e(e,t.colorTarget.texture)}getByteCount(){return this.colorTarget.getByteCount()+this.composeTarget.getByteCount()+this.holdTarget.getByteCount()}syncSize(){let e=this.drawPass.colorTarget.getWidth(),t=this.drawPass.colorTarget.getHeight(),[n,r]=this.compose.values.uTexSize.ref.value;(e!==n||t!==r)&&(this.colorTarget.setSize(e,t),this.composeTarget.setSize(e,t),this.holdTarget.setSize(e,t),L.update(this.compose.values.uTexSize,R.set(this.compose.values.uTexSize.ref.value,e,t)))}render(e,t,n,r,i){return n.multiSample.mode===`temporal`&&!i?this.renderTemporalMultiSample(e,t,n,r):(this.renderMultiSample(t,r,n),-2)}bindOutputTarget(e){e?this.webgl.bindDrawingBuffer():this.colorTarget.bind()}renderMultiSample(e,t,n){let{camera:r}=e,{compose:i,composeTarget:a,drawPass:o,webgl:s}=this,{gl:c,state:l}=s;$y&&s.timer.mark(`MultiSamplePass.renderMultiSample`);let u=k0[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],{x:d,y:f,width:p,height:m}=r.viewport,h=1/u.length;r.viewOffset.enabled=!0,L.update(i.values.tColor,o.getColorTarget(n.postprocessing).texture),i.update();for(let t=0;t<u.length;++t){let s=u[t];l0.setViewOffset(r.viewOffset,p,m,s[0],s[1],p,m),r.update();let g=h+.03125*(-.5+(t+.5)/u.length);L.update(i.values.uWeight,g),t===0||!n.multiSample.reuseOcclusion?o.postprocessing.setOcclusionOffset(0,0):o.postprocessing.setOcclusionOffset(s[0]/p,s[1]/m),o.render(e,n,!1),a.bind(),l.enable(c.BLEND),l.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),l.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE),l.disable(c.DEPTH_TEST),l.depthMask(!1),l.viewport(d,f,p,m),l.scissor(d,f,p,m),t===0&&(l.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),i.render()}o.postprocessing.setOcclusionOffset(0,0),L.update(i.values.uWeight,1),L.update(i.values.tColor,a.texture),i.update(),this.bindOutputTarget(t),l.viewport(d,f,p,m),l.scissor(d,f,p,m),l.disable(c.BLEND),i.render(),r.viewOffset.enabled=!1,r.update(),$y&&s.timer.markEnd(`MultiSamplePass.renderMultiSample`)}renderTemporalMultiSample(e,t,n,r){let{camera:i}=t,{compose:a,composeTarget:o,holdTarget:s,drawPass:c,webgl:l}=this,{gl:u,state:d}=l;$y&&l.timer.mark(`MultiSamplePass.renderTemporalMultiSample`);let f=k0[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(e===-2||e>=f.length)return-2;let{x:p,y:m,width:h,height:g}=i.viewport,_=1/f.length;if(e===-1)c.render(t,n,!1),L.update(a.values.uWeight,1),L.update(a.values.tColor,c.getColorTarget(n.postprocessing).texture),a.update(),s.bind(),d.disable(u.BLEND),d.disable(u.DEPTH_TEST),d.depthMask(!1),d.viewport(p,m,h,g),d.scissor(p,m,h,g),a.render(),e+=1;else{i.viewOffset.enabled=!0,L.update(a.values.tColor,c.getColorTarget(n.postprocessing).texture),L.update(a.values.uWeight,_),a.update();let r=2**Math.max(0,n.multiSample.sampleLevel-2);for(let s=0;s<r;++s){let r=f[e];if(l0.setViewOffset(i.viewOffset,h,g,r[0],r[1],h,g),i.update(),e===0||!n.multiSample.reuseOcclusion?c.postprocessing.setOcclusionOffset(0,0):c.postprocessing.setOcclusionOffset(r[0]/h,r[1]/g),c.render(t,n,!1),o.bind(),d.enable(u.BLEND),d.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),d.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),d.disable(u.DEPTH_TEST),d.depthMask(!1),d.viewport(p,m,h,g),d.scissor(p,m,h,g),e===0&&(d.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),a.render(),e+=1,e>=f.length)break}}c.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(r),d.viewport(p,m,h,g),d.scissor(p,m,h,g);let v=e*_;return v>0&&(L.update(a.values.uWeight,1),L.update(a.values.tColor,o.texture),a.update(),d.disable(u.BLEND),a.render()),v<1&&(L.update(a.values.uWeight,1-v),L.update(a.values.tColor,s.texture),a.update(),v===0?d.disable(u.BLEND):d.enable(u.BLEND),a.render()),i.viewOffset.enabled=!1,i.update(),$y&&l.timer.markEnd(`MultiSamplePass.renderTemporalMultiSample`),e>=f.length?-2:e}};const k0=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];k0.forEach(e=>{e.forEach(e=>{e[0]*=.0625,e[1]*=.0625})});var a4e=class{update(e,t){return e&&(this.sampleIndex=-1),t.mode===`temporal`?this.sampleIndex!==-2:!1}render(e,t,n,r){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,e,t,n,!!r),this.sampleIndex<0}constructor(e){this.multiSamplePass=e,this.sampleIndex=-2}};const o4e={pickPadding:1,maxAsyncReadLag:5};var s4e=class{constructor(e,t,n,r){this.webgl=e,this.width=t,this.height=n,this.pickScale=r;let i=r/e.pixelRatio;this.pickWidth=Math.ceil(t*i),this.pickHeight=Math.ceil(n*i);let{resources:a,extensions:{drawBuffers:o},gl:s}=e;o?(this.objectPickTexture=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=a.framebuffer(),this.objectPickFramebuffer=a.framebuffer(),this.instancePickFramebuffer=a.framebuffer(),this.groupPickFramebuffer=a.framebuffer(),this.depthPickFramebuffer=a.framebuffer(),this.framebuffer.bind(),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1,o.COLOR_ATTACHMENT2,o.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,`color0`),this.instancePickTexture.attachFramebuffer(this.framebuffer,`color1`),this.groupPickTexture.attachFramebuffer(this.framebuffer,`color2`),this.depthPickTexture.attachFramebuffer(this.framebuffer,`color3`),this.depthRenderbuffer=Bj(s)?a.renderbuffer(`depth32f`,`depth`,this.pickWidth,this.pickHeight):a.renderbuffer(`depth16`,`depth`,this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,`color0`),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,`color0`),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,`color0`),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,`color0`)):(this.objectPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight))}getByteCount(){return this.webgl.extensions.drawBuffers?this.objectPickTexture.getByteCount()+this.instancePickTexture.getByteCount()+this.groupPickTexture.getByteCount()+this.depthPickTexture.getByteCount()+this.depthRenderbuffer.getByteCount():this.objectPickTarget.getByteCount()+this.instancePickTarget.getByteCount()+this.groupPickTarget.getByteCount()+this.depthPickTarget.getByteCount()}dispose(){this.webgl.extensions.drawBuffers?(this.framebuffer.destroy(),this.objectPickTexture.destroy(),this.instancePickTexture.destroy(),this.groupPickTexture.destroy(),this.depthPickTexture.destroy(),this.objectPickFramebuffer.destroy(),this.instancePickFramebuffer.destroy(),this.groupPickFramebuffer.destroy(),this.depthPickFramebuffer.destroy(),this.depthRenderbuffer.destroy()):(this.objectPickTarget.destroy(),this.instancePickTarget.destroy(),this.groupPickTarget.destroy(),this.depthPickTarget.destroy())}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(e){this.pickScale=e,this.setSize(this.width,this.height)}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.height}setSize(e,t){this.width=e,this.height=t;let n=this.pickScale/this.webgl.pixelRatio,r=Math.ceil(this.width*n),i=Math.ceil(this.height*n);(r!==this.pickWidth||i!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=i,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}reset(){let{drawBuffers:e}=this.webgl.extensions;e&&(this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2,e.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,`color0`),this.instancePickTexture.attachFramebuffer(this.framebuffer,`color1`),this.groupPickTexture.attachFramebuffer(this.framebuffer,`color2`),this.depthPickTexture.attachFramebuffer(this.framebuffer,`color3`),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,`color0`),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,`color0`),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,`color0`),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,`color0`))}renderVariant(e,t,n,r,i,a){e.clear(!1),e.update(t,n),e.renderPick(n.primitives,t,i,a),r.handle.isEnabled&&e.renderPick(r.handle.scene,t,i,a),r.camera.isEnabled&&(r.camera.update(t),e.update(r.camera.camera,r.camera.scene),e.renderPick(r.camera.scene,r.camera.camera,i,a))}render(e,t,n,r){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(e,t,n,r,`pick`,X1.None)):(this.objectPickTarget.bind(),this.renderVariant(e,t,n,r,`pick`,X1.Object),this.instancePickTarget.bind(),this.renderVariant(e,t,n,r,`pick`,X1.Instance),this.groupPickTarget.bind(),this.renderVariant(e,t,n,r,`pick`,X1.Group),this.depthPickTarget.bind(),this.renderVariant(e,t,n,r,`depth`,X1.None))}},c4e=!1;function l4e(e){return e.isWebGL2?!0:(Qy&&!c4e&&(console.log(`WebGL2 required for async picking. Falling back to synchronous picking.`),c4e=!0),!1)}var A0;(function(e){e[e.Pending=0]=`Pending`,e[e.Resolved=1]=`Resolved`,e[e.Failed=2]=`Failed`})(A0||={});var u4e=class{setup(){let e=this.viewport.width*this.viewport.height*4;(!this.object||this.object.length!==e)&&(this.object=new Uint8Array(e),this.instance=new Uint8Array(e),this.group=new Uint8Array(e),this.depth=new Uint8Array(e))}setViewport(e,t,n,r){V1.set(this.viewport,e,t,n,r),this.setup()}read(){$y&&this.webgl.timer.mark(`PickBuffers.read`);let{x:e,y:t,width:n,height:r}=this.viewport;this.pickPass.bindObject(),this.webgl.readPixels(e,t,n,r,this.object),this.pickPass.bindInstance(),this.webgl.readPixels(e,t,n,r,this.instance),this.pickPass.bindGroup(),this.webgl.readPixels(e,t,n,r,this.group),this.pickPass.bindDepth(),this.webgl.readPixels(e,t,n,r,this.depth),this.ready=!0,$y&&this.webgl.timer.markEnd(`PickBuffers.read`)}asyncRead(){let{gl:e}=this.webgl;if(!Bj(e))return;$y&&this.webgl.timer.mark(`PickBuffers.asyncRead`),this.fenceSync!==null&&e.deleteSync(this.fenceSync);let{x:t,y:n,width:r,height:i}=this.viewport;this.pickPass.bindObject(),this.objectBuffer.read(t,n,r,i),this.pickPass.bindInstance(),this.instanceBuffer.read(t,n,r,i),this.pickPass.bindGroup(),this.groupBuffer.read(t,n,r,i),this.pickPass.bindDepth(),this.depthBuffer.read(t,n,r,i),this.fenceTimestamp=Ly(),this.fenceSync=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),this.ready=!1,$y&&this.webgl.timer.markEnd(`PickBuffers.asyncRead`)}check(){if(this.ready)return A0.Resolved;if(this.fenceSync===null)return A0.Failed;let{gl:e}=this.webgl;if(!Bj(e))return A0.Failed;let t=e.clientWaitSync(this.fenceSync,0,0);return t===e.WAIT_FAILED||this.lag>=this.maxAsyncReadLag?t!==e.WAIT_FAILED&&Ly()-this.fenceTimestamp<1e3/60?(this.lag+=1,A0.Pending):(e.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!1,A0.Failed):t===e.TIMEOUT_EXPIRED?(this.lag+=1,A0.Pending):(this.objectBuffer.getSubData(this.object),this.instanceBuffer.getSubData(this.instance),this.groupBuffer.getSubData(this.group),this.depthBuffer.getSubData(this.depth),e.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!0,A0.Resolved)}getIdx(e,t){return(t*this.viewport.width+e)*4}getDepth(e,t){if(!this.ready)return-1;let n=this.getIdx(e,t),r=this.depth;return hTe(r[n],r[n+1],r[n+2],r[n+3])}getId(e,t,n){if(!this.ready)return-1;let r=this.getIdx(e,t);return ZN(n[r],n[r+1],n[r+2])}getObjectId(e,t){return this.getId(e,t,this.object)}getInstanceId(e,t){return this.getId(e,t,this.instance)}getGroupId(e,t){return this.getId(e,t,this.group)}getPickingId(e,t){let n=this.getObjectId(e,t);if(n===-1||n===iJ.Null)return;let r=this.getInstanceId(e,t);if(r===-1||r===iJ.Null)return;let i=this.getGroupId(e,t);if(i!==-1)return{objectId:n,instanceId:r,groupId:i}}reset(){this.fenceSync=null,this.ready=!1,this.lag=0,this.fenceTimestamp=0}dispose(){let{gl:e}=this.webgl;Bj(e)&&(this.objectBuffer.destroy(),this.instanceBuffer.destroy(),this.groupBuffer.destroy(),this.depthBuffer.destroy(),this.fenceSync!==null&&(e.deleteSync(this.fenceSync),this.fenceSync=null))}constructor(e,t,n=5){this.webgl=e,this.pickPass=t,this.maxAsyncReadLag=n,this.viewport=V1.create(0,0,0,0),this.fenceSync=null,this.fenceTimestamp=0,this.ready=!1,this.lag=0,e.isWebGL2&&(this.objectBuffer=e.resources.pixelPack(`rgba`,`ubyte`),this.instanceBuffer=e.resources.pixelPack(`rgba`,`ubyte`),this.groupBuffer=e.resources.pixelPack(`rgba`,`ubyte`),this.depthBuffer=e.resources.pixelPack(`rgba`,`ubyte`)),this.setup()}};const d4e={eyeSeparation:V.Numeric(.062,{min:.02,max:.1,step:.001},{description:`Distance between left and right camera.`}),focus:V.Numeric(10,{min:1,max:20,step:.1},{description:`Apparent object distance.`})},f4e=V.getDefaultValues(d4e);var j0=class{get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}constructor(e,t={}){this.parent=e,this.left=new p4e,this.right=new p4e,this.props={...f4e,...t}}setProps(e){Object.assign(this.props,e)}update(e){this.parent.update(),e?_4e(this.parent,this.left,this.right,e):g4e(this.parent,this.props,this.left,this.right)}};(function(e){function t(e){return`left`in e&&`right`in e}e.is=t})(j0||={});var p4e=class{constructor(){this.viewport=V1.create(0,0,0,0),this.view=z(),this.projection=z(),this.projectionView=z(),this.inverseProjectionView=z(),this.headRotation=z(),this.viewEye=z(),this.isAsymmetricProjection=!0,this.state=l0.createDefaultSnapshot(),this.viewOffset=l0.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0,this.forceFull=!1,this.scale=0,this.minTargetDistance=0,this.disabled=!1}getRay(e,t,n){return z.getTranslation(e.origin,z.invert(z(),this.view)),B.set(e.direction,t,n,.5),U1(e.direction,e.direction,this.viewport,this.inverseProjectionView),B.normalize(e.direction,B.sub(e.direction,e.direction,e.origin)),e}},m4e=z.identity(),h4e=z.identity();function M0(e,t){V1.copy(t.viewport,e.viewport),z.copy(t.view,e.view),z.copy(t.projection,e.projection),z.copy(t.headRotation,e.headRotation),l0.copySnapshot(t.state,e.state),l0.copyViewOffset(t.viewOffset,e.viewOffset),t.far=e.far,t.near=e.near,t.fogFar=e.fogFar,t.fogNear=e.fogNear,t.forceFull=e.forceFull,t.scale=e.scale,t.minTargetDistance=e.minTargetDistance}function g4e(e,t,n,r){M0(e,n),M0(e,r);let i=Math.floor(e.viewport.width/2),a=i/e.viewport.height;n.viewport.width=i,r.viewport.x+=i,r.viewport.width-=i;let o=t.eyeSeparation/2,s=o*e.near/t.focus,c=e.near*Math.tan(e.state.fov*.5),l,u;m4e[12]=-o,h4e[12]=o,l=-c*a+s,u=c*a+s,n.projection[0]=2*e.near/(u-l),n.projection[8]=(u+l)/(u-l),z.mul(n.view,n.view,m4e),z.mul(n.projectionView,n.projection,n.view),z.invert(n.inverseProjectionView,n.projectionView),l=-c*a-s,u=c*a-s,r.projection[0]=2*e.near/(u-l),r.projection[8]=(u+l)/(u-l),z.mul(r.view,r.view,h4e),z.mul(r.projectionView,r.projection,r.view),z.invert(r.inverseProjectionView,r.projectionView),n.disabled=!1,r.disabled=!1}function _4e(e,t,n,r){v4e(e,t,r.pose.views[0],r.layer),r.pose.views.length===1?n.disabled=!0:v4e(e,n,r.pose.views[1],r.layer)}function v4e(e,t,n,r){M0(e,t);let i=r.getViewport(n);V1.set(t.viewport,i.x,i.y,i.width,i.height),z.fromArray(t.projection,n.projectionMatrix,0),z.fromArray(t.view,n.transform.inverse.matrix,0),z.mul(t.projectionView,t.projection,t.view),z.invert(t.inverseProjectionView,t.projectionView),t.disabled=!1}var y4e=class{setViewport(e,t,n,r){V1.set(this.viewport,e,t,n,r),this.update()}setPickPadding(e){this.pickPadding!==e&&(this.pickPadding=e,this.update())}update(){let{x:e,y:t,width:n,height:r}=this.viewport;this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(e*this.pickRatio),this.pickY=Math.ceil(t*this.pickRatio);let i=Math.floor(n*this.pickRatio),a=Math.floor(r*this.pickRatio);(i!==this.pickWidth||a!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=a,this.halfPickWidth=Math.floor(this.pickWidth/2),this.buffers.setViewport(this.pickX,this.pickY,this.pickWidth,this.pickHeight)),this.spiral=zT(Math.ceil(this.pickRatio*this.pickPadding)),this.dirty=!0}render(e){$y&&this.webgl.timer.mark(`PickHelper.render`,{captureStats:!0});let{pickX:t,pickY:n,pickWidth:r,pickHeight:i,halfPickWidth:a}=this,{renderer:o,scene:s,helper:c}=this;o.setTransparentBackground(!1),o.setDrawingBufferSize(r,i),o.setPixelRatio(this.pickRatio),j0.is(e)?(o.setViewport(t,n,a,i),this.pickPass.render(o,e.left,s,c),o.setViewport(t+a,n,r-a,i),this.pickPass.render(o,e.right,s,c)):(o.setViewport(t,n,r,i),this.pickPass.render(o,e,s,c)),this.dirty=!1,$y&&this.webgl.timer.markEnd(`PickHelper.render`)}identifyInternal(e,t,n){if(this.webgl.isContextLost)return;let{webgl:r,pickRatio:i}=this;if(r.isContextLost)return;e*=r.pixelRatio,t*=r.pixelRatio,t=this.pickPass.drawingBufferHeight-t;let{viewport:a}=this;if(e<a.x||t<a.y||e>a.x+a.width||t>a.y+a.height)return;let o=e-a.x,s=t-a.y,c=Math.floor(o*i),l=Math.floor(s*i),u=this.buffers.getPickingId(c,l);if(u===void 0)return;let d=this.buffers.getDepth(c,l),f=B.create(e,t,d);if(j0.is(n)){let t=Math.floor(a.width/2);e>a.x+t?(f[0]=a.x+(o-t)*2,U1(f,f,a,n.right.inverseProjectionView)):(f[0]=a.x+o*2,U1(f,f,a,n.left.inverseProjectionView))}else U1(f,f,a,n.inverseProjectionView);return{id:u,position:f}}prepare(){this.pickRatio!==this.pickPass.pickRatio&&this.update()}getPickData(e,t,n){for(let r of this.spiral){let i=this.identifyInternal(e+r[0],t+r[1],n);if(i)return i}}identify(e,t,n){return this.prepare(),this.dirty&&($y&&this.webgl.timer.mark(`PickHelper.identify`),this.render(n),this.buffers.read(),$y&&this.webgl.timer.markEnd(`PickHelper.identify`)),this.getPickData(e,t,n)}asyncIdentify(e,t,n){return this.prepare(),this.dirty&&($y&&this.webgl.timer.mark(`PickHelper.asyncIdentify`),this.render(n),this.buffers.asyncRead(),$y&&this.webgl.timer.markEnd(`PickHelper.asyncIdentify`)),{tryGet:()=>{let r=this.buffers.check();if(r===A0.Resolved)return this.getPickData(e,t,n);if(r===A0.Pending)return`pending`;r===A0.Failed&&(this.dirty=!0)}}}reset(){this.buffers.reset(),this.dirty=!0}dispose(){this.buffers.dispose()}constructor(e,t,n,r,i,a,o){this.webgl=e,this.renderer=t,this.scene=n,this.helper=r,this.pickPass=i,this.dirty=!0,this.buffers=new u4e(this.webgl,this.pickPass),this.viewport=V1(),this.setViewport(a.x,a.y,a.width,a.height),this.pickPadding=o.pickPadding,l4e(e)||(this.asyncIdentify=(e,t,n)=>({tryGet:()=>this.identify(e,t,n)}))}},b4e={..._F,tWboitA:GP(`texture`,`rgba`,`float`,`nearest`),tWboitB:GP(`texture`,`rgba`,`float`,`nearest`),uTexSize:J(`v2`)},x4e=fj(`evaluate-wboit`,tF,`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`);function S4e(e,t,n){let r={...vF,tWboitA:L.create(t),tWboitB:L.create(n),uTexSize:L.create(R.create(t.getWidth(),t.getHeight()))};return hF(aF(e,`triangles`,x4e,{...b4e},r),r)}var C4e=class e{get supported(){return this._supported}getByteCount(){return this._supported?this.textureA.getByteCount()+this.textureB.getByteCount()+this.depthRenderbuffer.getByteCount():0}bind(){let{state:e,gl:t}=this.webgl;this.framebuffer.bind(),e.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),e.disable(t.DEPTH_TEST),e.blendFuncSeparate(t.ONE,t.ONE,t.ZERO,t.ONE_MINUS_SRC_ALPHA),e.enable(t.BLEND)}render(){$y&&this.webgl.timer.mark(`WboitPass.render`);let{state:e,gl:t}=this.webgl;e.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),e.enable(t.BLEND),this.renderable.update(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`WboitPass.render`)}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;(e!==n||t!==r)&&(this.textureA.define(e,t),this.textureB.define(e,t),this.depthRenderbuffer.setSize(e,t),L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)))}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:e}}=this.webgl;this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,`color0`),this.textureB.attachFramebuffer(this.framebuffer,`color1`),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(e){let{extensions:{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i}}=e;if(!n||!r||!i||!t){if(Qy){let e=[];n||e.push(`textureFloat`),r||e.push(`colorBufferFloat`),i||e.push(`depthTexture`),t||e.push(`drawBuffers`),console.log(`Missing "${e.join(`", "`)}" extensions required for "wboit"`)}return!1}else return!0}constructor(t,n,r){if(this.webgl=t,this._supported=!1,!e.isSupported(t))return;let{resources:i,gl:a}=t;this.textureA=i.texture(`image-float32`,`rgba`,`float`,`nearest`),this.textureA.define(n,r),this.textureB=i.texture(`image-float32`,`rgba`,`float`,`nearest`),this.textureB.define(n,r),this.depthRenderbuffer=Bj(a)?i.renderbuffer(`depth32f`,`depth`,n,r):i.renderbuffer(`depth16`,`depth`,n,r),this.renderable=S4e(t,this.textureA,this.textureB),this.framebuffer=i.framebuffer(),this._supported=!0,this._init()}},w4e={..._F,tDpoitBackColor:GP(`texture`,`rgba`,`float`,`nearest`),uTexSize:J(`v2`)},T4e=fj(`blend-back-dpoit`,tF,`
    precision highp float;

    uniform sampler2D tDpoitBackColor;
    uniform vec2 uTexSize;

    void main() {
        vec2 coords = gl_FragCoord.xy / uTexSize;
        gl_FragColor = texture2D(tDpoitBackColor, coords);
        if (gl_FragColor.a == 0.0) {
            discard;
        }
    }
`);function E4e(e,t){let n={...vF,tDpoitBackColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight()))};return hF(aF(e,`triangles`,T4e,{...w4e},n),n)}var D4e={..._F,tDpoitFrontColor:GP(`texture`,`rgba`,`float`,`nearest`),uTexSize:J(`v2`)},O4e=fj(`evaluate-dpoit`,tF,`
precision highp float;

uniform sampler2D tDpoitFrontColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tDpoitFrontColor, coords);
}
`);function k4e(e,t){let n={...vF,tDpoitFrontColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight()))};return hF(aF(e,`triangles`,O4e,{...D4e},n),n)}var A4e=class e{get supported(){return this._supported}getByteCount(){return this._supported?this.depthTextures[0].getByteCount()+this.depthTextures[1].getByteCount()+this.colorFrontTextures[0].getByteCount()+this.colorFrontTextures[1].getByteCount()+this.colorBackTextures[0].getByteCount()+this.colorBackTextures[1].getByteCount():0}bind(){let{state:e,gl:t,extensions:{blendMinMax:n}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),e.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),e.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),e.blendEquation(n.MAX),e.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){let{state:e,gl:t,extensions:{blendMinMax:n}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),e.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),e.blendEquation(n.MAX),e.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){$y&&this.webgl.timer.mark(`DpoitPass.renderBlendBack`);let{state:e,gl:t}=this.webgl;e.blendEquation(t.FUNC_ADD),e.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),L.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),$y&&this.webgl.timer.markEnd(`DpoitPass.renderBlendBack`)}render(){$y&&this.webgl.timer.mark(`DpoitPass.render`);let{state:e,gl:t}=this.webgl;e.blendEquation(t.FUNC_ADD),e.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),L.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),$y&&this.webgl.timer.markEnd(`DpoitPass.render`)}setSize(e,t){let[n,r]=this.renderable.values.uTexSize.ref.value;if(e!==n||t!==r){for(let n=0;n<2;n++)this.depthTextures[n].define(e,t),this.colorFrontTextures[n].define(e,t),this.colorBackTextures[n].define(e,t);L.update(this.renderable.values.uTexSize,R.set(this.renderable.values.uTexSize.ref.value,e,t)),L.update(this.blendBackRenderable.values.uTexSize,R.set(this.blendBackRenderable.values.uTexSize.ref.value,e,t))}}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:e}}=this.webgl;for(let t=0;t<2;t++)this.depthFramebuffers[t].bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2]),this.colorFrontTextures[t].attachFramebuffer(this.depthFramebuffers[t],`color0`),this.colorBackTextures[t].attachFramebuffer(this.depthFramebuffers[t],`color1`),this.depthTextures[t].attachFramebuffer(this.depthFramebuffers[t],`color2`),this.colorFramebuffers[t].bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),this.colorFrontTextures[t].attachFramebuffer(this.colorFramebuffers[t],`color0`),this.colorBackTextures[t].attachFramebuffer(this.colorFramebuffers[t],`color1`)}static isSupported(e){let{extensions:{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i,blendMinMax:a}}=e;if(!n||!r||!i||!t||!a){if(Qy){let e=[];n||e.push(`textureFloat`),r||e.push(`colorBufferFloat`),i||e.push(`depthTexture`),t||e.push(`drawBuffers`),a||e.push(`blendMinMax`),console.log(`Missing "${e.join(`", "`)}" extensions required for "dpoit"`)}return!1}else return!0}constructor(t,n,r){if(this.webgl=t,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,!e.isSupported(t))return;let{resources:i,extensions:{colorBufferHalfFloat:a,textureHalfFloat:o}}=t;Bj(t.gl)?(this.depthTextures=[i.texture(`image-float32`,`rg`,`float`,`nearest`),i.texture(`image-float32`,`rg`,`float`,`nearest`)],this.colorFrontTextures=a&&o?[i.texture(`image-float16`,`rgba`,`fp16`,`nearest`),i.texture(`image-float16`,`rgba`,`fp16`,`nearest`)]:[i.texture(`image-float32`,`rgba`,`float`,`nearest`),i.texture(`image-float32`,`rgba`,`float`,`nearest`)],this.colorBackTextures=a&&o?[i.texture(`image-float16`,`rgba`,`fp16`,`nearest`),i.texture(`image-float16`,`rgba`,`fp16`,`nearest`)]:[i.texture(`image-float32`,`rgba`,`float`,`nearest`),i.texture(`image-float32`,`rgba`,`float`,`nearest`)]):(this.depthTextures=[i.texture(`image-float32`,`rgba`,`float`,`nearest`),i.texture(`image-float32`,`rgba`,`float`,`nearest`)],this.colorFrontTextures=[i.texture(`image-float32`,`rgba`,`float`,`nearest`),i.texture(`image-float32`,`rgba`,`float`,`nearest`)],this.colorBackTextures=[i.texture(`image-float32`,`rgba`,`float`,`nearest`),i.texture(`image-float32`,`rgba`,`float`,`nearest`)]),this.depthTextures[0].define(n,r),this.depthTextures[1].define(n,r),this.colorFrontTextures[0].define(n,r),this.colorFrontTextures[1].define(n,r),this.colorBackTextures[0].define(n,r),this.colorBackTextures[1].define(n,r),this.depthFramebuffers=[i.framebuffer(),i.framebuffer()],this.colorFramebuffers=[i.framebuffer(),i.framebuffer()],this.blendBackRenderable=E4e(t,this.colorBackTextures[0]),this.renderable=k4e(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}};const j4e={enabled:V.Boolean(!0),highlightEdgeColor:V.Color(tE.darken(tE.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:V.Color(tE.darken(tE.fromNormalizedRgb(.2,1,.1),1)),edgeScale:V.Numeric(1,{min:1,max:3,step:1},{description:`Thickness of the edge.`}),highlightEdgeStrength:V.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:V.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:V.Numeric(.3,{min:0,max:1,step:.1},{description:`Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done.`}),innerEdgeFactor:V.Numeric(1.5,{min:0,max:3,step:.1},{description:`Factor to multiply the inner edge color with - for added contrast.`})};var N0=class{static isEnabled(e){return e.enabled}constructor(e,t,n){this.webgl=e,this.depthTarget=e.createRenderTarget(t,n),this.maskTarget=e.createRenderTarget(t,n),this.edgesTarget=e.createRenderTarget(t,n),this.edge=P4e(e,this.maskTarget.texture),this.overlay=L4e(e,this.edgesTarget.texture)}getByteCount(){return this.depthTarget.getByteCount()+this.maskTarget.getByteCount()+this.edgesTarget.getByteCount()}setEdgeState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.enable(t.BLEND),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}setOverlayState(e){let{gl:t,state:n}=this.webgl;n.enable(t.SCISSOR_TEST),n.enable(t.BLEND),n.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),n.blendEquation(t.FUNC_ADD),n.disable(t.DEPTH_TEST),n.depthMask(!1);let{x:r,y:i,width:a,height:o}=e;n.viewport(r,i,a,o),n.scissor(r,i,a,o)}setSize(e,t){let n=this.depthTarget.getWidth(),r=this.depthTarget.getHeight();(e!==n||t!==r)&&(this.depthTarget.setSize(e,t),this.maskTarget.setSize(e,t),this.edgesTarget.setSize(e,t),L.update(this.edge.values.uTexSizeInv,R.set(this.edge.values.uTexSizeInv.ref.value,1/e,1/t)),L.update(this.overlay.values.uTexSizeInv,R.set(this.overlay.values.uTexSizeInv.ref.value,1/e,1/t)))}update(e){let{highlightEdgeColor:t,selectEdgeColor:n,edgeScale:r,innerEdgeFactor:i,ghostEdgeStrength:a,highlightEdgeStrength:o,selectEdgeStrength:s}=e,{values:c}=this.edge,l=Math.max(1,Math.round(r*this.webgl.pixelRatio));c.dEdgeScale.ref.value!==l&&(L.update(c.dEdgeScale,l),this.edge.update());let{values:u}=this.overlay;L.update(u.uHighlightEdgeColor,tE.toVec3Normalized(u.uHighlightEdgeColor.ref.value,t)),L.update(u.uSelectEdgeColor,tE.toVec3Normalized(u.uSelectEdgeColor.ref.value,n)),L.updateIfChanged(u.uInnerEdgeFactor,i),L.updateIfChanged(u.uGhostEdgeStrength,a),L.updateIfChanged(u.uHighlightEdgeStrength,o),L.updateIfChanged(u.uSelectEdgeStrength,s)}render(e,t){$y&&this.webgl.timer.mark(`MarkingPass.render`),this.edgesTarget.bind(),this.setEdgeState(e),this.edge.render(),t.bind(),this.setOverlayState(e),this.overlay.render(),$y&&this.webgl.timer.markEnd(`MarkingPass.render`)}},M4e={..._F,tMaskTexture:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),dEdgeScale:qP(`number`)},N4e=fj(`edge`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`);function P4e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tMaskTexture:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),dEdgeScale:L.create(1)};return hF(aF(e,`triangles`,N4e,{...M4e},i),i)}var F4e={..._F,tEdgeTexture:GP(`texture`,`rgba`,`ubyte`,`linear`),uTexSizeInv:J(`v2`),uHighlightEdgeColor:J(`v3`),uSelectEdgeColor:J(`v3`),uHighlightEdgeStrength:J(`f`),uSelectEdgeStrength:J(`f`),uGhostEdgeStrength:J(`f`),uInnerEdgeFactor:J(`f`)},I4e=fj(`overlay`,tF,`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uHighlightEdgeStrength;
uniform float uSelectEdgeStrength;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;
        gl_FragColor.a *= edgeStrength;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`);function L4e(e,t){let n=t.getWidth(),r=t.getHeight(),i={...vF,tEdgeTexture:L.create(t),uTexSizeInv:L.create(R.create(1/n,1/r)),uHighlightEdgeColor:L.create(B()),uSelectEdgeColor:L.create(B()),uHighlightEdgeStrength:L.create(1),uSelectEdgeStrength:L.create(1),uGhostEdgeStrength:L.create(0),uInnerEdgeFactor:L.create(0)};return hF(aF(e,`triangles`,I4e,{...F4e},i),i)}var R4e=class{setTransparency(e){e===`wboit`?(this.transparencyMode=this.wboit.supported?`wboit`:`blended`,Qy&&!this.wboit.supported&&console.log(`Missing "wboit" support, falling back to "blended".`)):e===`dpoit`?(this.transparencyMode=this.dpoit.supported?`dpoit`:`blended`,Qy&&!this.dpoit.supported&&console.log(`Missing "dpoit" support, falling back to "blended".`)):this.transparencyMode=`blended`,this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,`depth`)}get transparency(){return this.transparencyMode}constructor(e,t,n,r,i){this.webgl=e,this.transparencyMode=`blended`;let{extensions:a,resources:o,isWebGL2:s}=e;this.drawTarget=e.createDrawTarget(),this.colorTarget=e.createRenderTarget(n,r,!0,`uint8`,`linear`),this.transparentColorTarget=e.createRenderTarget(n,r,!1,`uint8`,`linear`),this.packedDepth=!a.depthTexture,this.depthTargetTransparent=e.createRenderTarget(n,r),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?e.createRenderTarget(n,r):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:o.texture(`image-depth`,`depth`,s?`float`:`ushort`,`nearest`),this.packedDepth||this.depthTextureOpaque.define(n,r),this.wboit=new C4e(e,n,r),this.dpoit=new A4e(e,n,r),this.marking=new N0(e,n,r),this.postprocessing=new E0(e,t,this),this.antialiasing=new D0(e,n,r),this.bloom=new y0(e,n,r),this.dof=new _0(e,n,r),this.copyFboTarget=yF(e,this.colorTarget.texture),this.copyFboPostprocessing=yF(e,this.postprocessing.target.texture),this.setTransparency(i)}getByteCount(){return this.drawTarget.getByteCount()+this.colorTarget.getByteCount()+this.transparentColorTarget.getByteCount()+this.depthTargetTransparent.getByteCount()+(this.depthTargetOpaque?this.depthTargetOpaque.getByteCount():this.depthTextureOpaque.getByteCount())+this.wboit.getByteCount()+this.dpoit.getByteCount()+this.marking.getByteCount()+this.postprocessing.getByteCount()+this.antialiasing.getByteCount()+this.bloom.getByteCount()+this.dof.getByteCount()}reset(){this.wboit.reset(),this.dpoit.reset(),this.postprocessing.reset()}setSize(e,t){let n=this.colorTarget.getWidth(),r=this.colorTarget.getHeight();(e!==n||t!==r)&&(this.colorTarget.setSize(e,t),this.depthTargetTransparent.setSize(e,t),this.transparentColorTarget.setSize(e,t),this.depthTargetOpaque?this.depthTargetOpaque.setSize(e,t):this.depthTextureOpaque.define(e,t),L.update(this.copyFboTarget.values.uTexSize,R.set(this.copyFboTarget.values.uTexSize.ref.value,e,t)),L.update(this.copyFboPostprocessing.values.uTexSize,R.set(this.copyFboPostprocessing.values.uTexSize.ref.value,e,t))),this.wboit.supported&&this.wboit.setSize(e,t),this.dpoit.supported&&this.dpoit.setSize(e,t),this.marking.setSize(e,t),this.postprocessing.setSize(e,t),this.antialiasing.setSize(e,t),this.dof.setSize(e,t),this.bloom.setSize(e,t)}_renderDpoit(e,t,n,r,i,a){if(!this.dpoit.supported)throw Error(`expected dpoit to be supported`);this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,`depth`),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,`depth`),E0.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque));let o=E0.isEnabled(a);if(n.opacityAverage<1){let i=o?this.transparentColorTarget:this.colorTarget;o&&(i.bind(),e.clear(!1,!1,!0));let a=this.dpoit.bind();e.renderDpoitTransparent(n.primitives,t,this.depthTextureOpaque,a);for(let a=0;a<r;a++){$y&&this.webgl.timer.mark(`DpoitPass.layer`);let a=this.dpoit.bindDualDepthPeeling();e.renderDpoitTransparent(n.primitives,t,this.depthTextureOpaque,a),r>1&&(i.bind(),this.dpoit.renderBlendBack()),$y&&this.webgl.timer.markEnd(`DpoitPass.layer`)}i.bind(),this.dpoit.render()}E0.isEnabled(a)&&this.postprocessing.render(t,n,!1,i,e.props.backgroundColor,a,e.light,e.ambientColor),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.depthTextureOpaque)}_renderWboit(e,t,n,r,i){if(!this.wboit.supported)throw Error(`expected wboit to be supported`);this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,`depth`),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),E0.isTransparentDepthRequired(n,i)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque));let a=E0.isEnabled(i);if(n.opacityAverage<1){let r=a?this.transparentColorTarget:this.colorTarget;a&&(r.bind(),e.clear(!1,!1,!0)),this.wboit.bind(),e.renderWboitTransparent(n.primitives,t,this.depthTextureOpaque),r.bind(),this.wboit.render()}E0.isEnabled(i)&&this.postprocessing.render(t,n,!1,r,e.props.backgroundColor,i,e.light,e.ambientColor),n.volumes.renderables.length>0&&(this.wboit.bind(),e.renderWboitTransparent(n.volumes,t,this.depthTextureOpaque),(a?this.postprocessing.target:this.colorTarget).bind(),this.wboit.render())}_renderBlended(e,t,n,r,i,a){var o,s,c,l,u,d;if(r?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,`depth`),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),r)n.opacityAverage<1&&e.renderBlendedTransparent(n.primitives,t);else{this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),e.clearDepth(!0),e.renderDepthOpaque(n.primitives,t),this.colorTarget.bind()),E0.isTransparentDepthRequired(n,a)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque));let r=E0.isEnabled(a);if(n.opacityAverage<1&&(r&&(this.transparentColorTarget.bind(),e.clear(!1,!1,!0),this.packedDepth?(o=this.colorTarget.depthRenderbuffer)==null||o.attachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.transparentColorTarget.framebuffer,`depth`)),e.renderBlendedTransparent(n.primitives,t),r&&(this.packedDepth?(s=this.colorTarget.depthRenderbuffer)==null||s.detachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.transparentColorTarget.framebuffer,`depth`))),r&&(this.packedDepth?(c=this.colorTarget.depthRenderbuffer)==null||c.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,`depth`),this.postprocessing.render(t,n,!1,i,e.props.backgroundColor,a,e.light,e.ambientColor),this.packedDepth?(l=this.colorTarget.depthRenderbuffer)==null||l.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,`depth`)),n.volumes.renderables.length>0){let r=E0.isEnabled(a)?this.postprocessing.target:this.colorTarget;this.packedDepth?(u=this.colorTarget.depthRenderbuffer)==null||u.detachFramebuffer(r.framebuffer):this.depthTextureOpaque.detachFramebuffer(r.framebuffer,`depth`),r.bind(),e.renderVolume(n.volumes,t,this.depthTextureOpaque),this.packedDepth?(d=this.colorTarget.depthRenderbuffer)==null||d.attachFramebuffer(r.framebuffer):this.depthTextureOpaque.attachFramebuffer(r.framebuffer,`depth`),r.bind()}}}_render(e,t,n,r,i,a,o){if(t.disabled)return;let s=n.volumes.renderables.length>0,c=E0.isEnabled(o.postprocessing),l=D0.isEnabled(o.postprocessing),u=N0.isEnabled(o.marking),d=_0.isEnabled(o.postprocessing),f=y0.isEnabled(o.postprocessing),{x:p,y:m,width:h,height:g}=t.viewport;e.setViewport(p,m,h,g),e.update(t,n),a&&!l&&i&&(this.drawTarget.bind(),e.clear(!1));let _=!1;this.transparencyMode===`wboit`&&this.wboit.supported?(this._renderWboit(e,t,n,a,o.postprocessing),_=!0):this.transparencyMode===`dpoit`&&this.dpoit.supported?(this._renderDpoit(e,t,n,o.dpoitIterations,a,o.postprocessing),_=!0):this._renderBlended(e,t,n,!s&&!c&&!l&&i,a,o.postprocessing);let v=c?this.postprocessing.target:!i||s||_?this.colorTarget:this.drawTarget;if(u&&n.markerAverage>0){let r=o.marking.ghostEdgeStrength<1;r&&n.markerAverage!==1&&(this.marking.depthTarget.bind(),e.clear(!1,!0),e.renderMarkingDepth(n.primitives,t)),this.marking.maskTarget.bind(),e.clear(!1,!0),e.renderMarkingMask(n.primitives,t,r?this.marking.depthTarget.texture:null),this.marking.update(o.marking),this.marking.render(t.viewport,v)}else v.bind();r.debug.isEnabled&&(r.debug.syncVisibility(),e.renderBlended(r.debug.scene,t)),r.handle.isEnabled&&e.renderBlended(r.handle.scene,t),r.pointer.isEnabled&&(r.pointer.setCamera(t),e.update(r.pointer.camera,r.pointer.scene),e.renderBlended(r.pointer.scene,r.pointer.camera)),r.camera.isEnabled&&(r.camera.update(t),e.update(r.camera.camera,r.camera.scene),e.renderBlended(r.camera.scene,r.camera.camera));let y=!1;if(l){let e=E0.isEnabled(o.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.antialiasing.render(t,e,i&&!d,o.postprocessing)}else i&&!_0.isEnabled(o.postprocessing)&&(y=!0);if(d&&o.postprocessing.dof.name===`on`){let e=D0.isEnabled(o.postprocessing)?this.antialiasing.target.texture:E0.isEnabled(o.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.dof.update(t,e,this.depthTargetOpaque?.texture||this.depthTextureOpaque,this.depthTextureTransparent,o.postprocessing.dof.params,n.boundingSphereVisible),this.dof.render(t.viewport,i?void 0:this.getColorTarget(o.postprocessing))}else i&&!D0.isEnabled(o.postprocessing)&&(y=!0);if(y&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),c?this.copyFboPostprocessing.render():(s||_)&&this.copyFboTarget.render()),f&&o.postprocessing.bloom.name===`on`){let r=o.postprocessing.bloom.params.mode===`emissive`;r&&n.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),e.clear(!1,!0),e.update(t,n),e.renderEmissive(n.primitives,t)),(!r||n.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,this.depthTargetOpaque?.texture||this.depthTextureOpaque,o.postprocessing.bloom.params),this.bloom.render(t.viewport,i?void 0:this.getColorTarget(o.postprocessing)))}this.webgl.gl.flush()}render(e,t,n){$y&&this.webgl.timer.mark(`DrawPass.render`);let{renderer:r,camera:i,scene:a,helper:o}=e;this.postprocessing.setTransparentBackground(t.transparentBackground);let s=t.transparentBackground||this.postprocessing.background.isEnabled(t.postprocessing);r.setTransparentBackground(s),r.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),r.setPixelRatio(this.webgl.pixelRatio),j0.is(i)?($y&&this.webgl.timer.mark(`StereoCamera.left`),this._render(r,i.left,a,o,n,s,t),$y&&this.webgl.timer.markEnd(`StereoCamera.left`),$y&&this.webgl.timer.mark(`StereoCamera.right`),this._render(r,i.right,a,o,n,s,t),$y&&this.webgl.timer.markEnd(`StereoCamera.right`)):this._render(r,i,a,o,n,s,t),$y&&this.webgl.timer.markEnd(`DrawPass.render`)}getColorTarget(e){return _0.isEnabled(e)?this.dof.target:D0.isEnabled(e)?this.antialiasing.target:E0.isEnabled(e)?this.postprocessing.target:this.colorTarget}},P0;(function(e){function t(e,t,n){return{array:e,width:t,height:n}}e.create=t;function n(e){let{array:t,width:n,height:r}=e,i=n*(t.length/(n*r));for(let e=0,n=r/2;e<n;++e)for(let n=0,a=i;n<a;++n){let a=e*i+n,o=(r-e-1)*i+n,s=t[a];t[a]=t[o],t[o]=s}return e}e.flipY=n;function r(e){let{array:t}=e,n=t instanceof Uint8Array?255:1;for(let e=0,r=t.length;e<r;e+=4){let r=t[e+3]/n;t[e]/=r,t[e+1]/=r,t[e+2]/=r}return e}e.divideByAlpha=r})(P0||={});var z4e={alpha:V.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:`Opacity`}),colorX:V.Color(gk.red,{isEssential:!0}),colorY:V.Color(gk.green,{isEssential:!0}),colorZ:V.Color(gk.blue,{isEssential:!0}),scale:V.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:V.Select(`bottom-left`,V.arrayToOptions([`bottom-left`,`bottom-right`,`top-left`,`top-right`])),locationOffsetX:V.Numeric(0),locationOffsetY:V.Numeric(0),originColor:V.Color(gk.grey),radiusScale:V.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:V.Boolean(!0),planeColorXY:V.Color(gk.grey,{label:`Plane Color XY`}),planeColorXZ:V.Color(gk.grey,{label:`Plane Color XZ`}),planeColorYZ:V.Color(gk.grey,{label:`Plane Color YZ`}),showLabels:V.Boolean(!1),labelX:V.Text(`X`),labelY:V.Text(`Y`),labelZ:V.Text(`Z`),labelColorX:V.Color(gk.grey),labelColorY:V.Color(gk.grey),labelColorZ:V.Color(gk.grey),labelOpacity:V.Numeric(1,{min:0,max:1,step:.01}),labelScale:V.Numeric(.25,{min:.1,max:1,step:.01})};const F0={axes:V.MappedStatic(`on`,{on:V.Group(z4e),off:V.Group({})},{cycle:!0,description:`Show camera orientation axes`})};var B4e=class{constructor(e,t={}){this.webgl=e,this.props={axes:{name:`off`,params:{}}},this.pixelRatio=1,this.eachGroup=(e,t)=>{if(!L0(e))return!1;let n=!1;if(this.meshRenderObject){let r=this.meshRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of e.elements){let e=a*r+i;t(G.ofSingleton(e))&&(n=!0)}}if(this.textRenderObject){let r=this.textRenderObject.values.uGroupCount.ref.value;for(let{groupId:i,instanceId:a}of e.elements){let e=a*r+i;t(G.ofSingleton(e))&&(n=!0)}}return n},this.scene=c0.create(e,`blended`),this.camera=new l0,B.set(this.camera.up,0,1,0),B.set(this.camera.target,0,0,0),this.setProps(t)}setProps(e){this.props=vD(this.props,t=>{if(e.axes!==void 0&&(t.axes.name=e.axes.name,e.axes.name===`on`)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...e.axes.params,scale:e.axes.params.scale*this.pixelRatio,labelScale:e.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=K4e(n),this.scene.add(this.meshRenderObject),e.axes.params.showLabels?(this.textRenderObject=Y4e(n),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),B.set(this.camera.position,0,0,n.scale*200),z.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),t.axes.params={...e.axes.params}}})}get isEnabled(){return this.props.axes.name===`on`}getLoci(e){let{objectId:t,groupId:n,instanceId:r}=e;return(!this.meshRenderObject||t!==this.meshRenderObject.id)&&(!this.textRenderObject||t!==this.textRenderObject.id)||n===I0.None?hq:H4e(this,n,r)}mark(e,t){return!uq.is(uq.Highlighting,t)||!mq(e)&&(!L0(e)||e.data!==this)?!1:Zq.mark(this.meshRenderObject,e,t,this.eachGroup)||Zq.mark(this.textRenderObject,e,t,this.eachGroup)}update(e){if(!this.meshRenderObject||this.props.axes.name===`off`)return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),U4e(this.camera,e.viewport,e.viewOffset),z.extractRotation(this.scene.view,e.view);let t=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,r=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;n===`bottom-left`?z.setTranslation(this.scene.view,B.create(-e.viewport.width/2+t+r,-e.viewport.height/2+t+i,0)):n===`bottom-right`?z.setTranslation(this.scene.view,B.create(e.viewport.width/2-t-r,-e.viewport.height/2+t+i,0)):n===`top-left`?z.setTranslation(this.scene.view,B.create(-e.viewport.width/2+t+r,e.viewport.height/2-t-i,0)):n===`top-right`?z.setTranslation(this.scene.view,B.create(e.viewport.width/2-t-r,e.viewport.height/2-t-i,0)):Lb(n)}},I0;(function(e){e[e.None=0]=`None`,e[e.X=1]=`X`,e[e.Y=2]=`Y`,e[e.Z=3]=`Z`,e[e.XY=4]=`XY`,e[e.XZ=5]=`XZ`,e[e.YZ=6]=`YZ`,e[e.Origin=7]=`Origin`})(I0||={});function V4e(e,t){let n=t.props.axes,r=n.name===`on`?n.params.labelX:`X`,i=n.name===`on`?n.params.labelY:`Y`,a=n.name===`on`?n.params.labelZ:`Z`;switch(e){case I0.X:return`${r} Axis`;case I0.Y:return`${i} Axis`;case I0.Z:return`${a} Axis`;case I0.XY:return`${r}${i} Plane`;case I0.XZ:return`${r}${a} Plane`;case I0.YZ:return`${i}${a} Plane`;case I0.Origin:return`Origin`;default:return`Axes`}}function H4e(e,t,n){return vq(`camera-axes`,e,[{groupId:t,instanceId:n}],void 0,()=>V4e(t,e))}function L0(e){return e.kind===`data-loci`&&e.tag===`camera-axes`}function U4e(e,t,n){let{near:r,far:i}=e,a=-t.width/2,o=t.width/2,s=t.height/2,c=-t.height/2,l=(o-a)/2,u=(s-c)/2,d=(o+a)/2,f=(s+c)/2,p=d-l,m=d+l,h=f+u,g=f-u;if(n.enabled){let e=(o-a)/n.width,t=(s-c)/n.height;p+=e*n.offsetX,m=p+e*n.width,h-=t*n.offsetY,g=h-t*n.height}z.ortho(e.projection,p,m,h,g,r,i)}function W4e(e,t){let n=YN.createState(512,256,t),r=100*e.scale,i=e.radiusScale*r,a=e.showLabels?100*e.labelScale/3:0,o=B.scale(B(),B.unitX,r-a),s=B.scale(B(),B.unitY,r-a),c=B.scale(B(),B.unitZ,r-a),l={radiusTop:i,radiusBottom:i,radialSegments:32};if(n.currentGroup=I0.Origin,oN(n,B.origin,i,2),n.currentGroup=I0.X,oN(n,o,i,2),PN(n,B.origin,o,1,l),n.currentGroup=I0.Y,oN(n,s,i,2),PN(n,B.origin,s,1,l),n.currentGroup=I0.Z,oN(n,c,i,2),PN(n,B.origin,c,1,l),e.showPlanes){B.scale(o,o,.5),B.scale(s,s,.5),B.scale(c,c,.5),n.currentGroup=I0.XY,YN.addTriangle(n,B.origin,o,s),YN.addTriangle(n,B.origin,s,o);let e=B.add(B(),o,s);YN.addTriangle(n,e,o,s),YN.addTriangle(n,e,s,o),n.currentGroup=I0.XZ,YN.addTriangle(n,B.origin,o,c),YN.addTriangle(n,B.origin,c,o);let t=B.add(B(),o,c);YN.addTriangle(n,t,o,c),YN.addTriangle(n,t,c,o),n.currentGroup=I0.YZ,YN.addTriangle(n,B.origin,s,c),YN.addTriangle(n,B.origin,c,s);let r=B.add(B(),s,c);YN.addTriangle(n,r,s,c),YN.addTriangle(n,r,c,s)}return YN.getMesh(n)}function G4e(e,t){let n=100*e.scale,r=W4e(e,t?.geometry);return r.setBoundingSphere(q.create(B.create(n/2,n/2,n/2),n+n/4)),jF.create(`axes-mesh`,{},r,t=>{switch(t){case I0.X:return e.colorX;case I0.Y:return e.colorY;case I0.Z:return e.colorZ;case I0.XY:return e.planeColorXY;case I0.XZ:return e.planeColorXZ;case I0.YZ:return e.planeColorYZ;case I0.Origin:return e.originColor;default:return gk.grey}},()=>1,()=>``)}function K4e(e){let t=G4e(e);return jF.createRenderObject(t,{...V.getDefaultValues(HM.Params),...e,ignoreLight:!0,cellSize:0})}function q4e(e,t){let n=DJ.create(e,8,8,t),r=100*e.scale,i=B.scale(B(),B.unitX,r),a=B.scale(B(),B.unitY,r),o=B.scale(B(),B.unitZ,r),s=100*e.labelScale;return n.add(e.labelX,i[0],i[1],i[2],0,s,I0.X),n.add(e.labelY,a[0],a[1],a[2],0,s,I0.Y),n.add(e.labelZ,o[0],o[1],o[2],0,s,I0.Z),n.getText()}function J4e(e,t){let n=100*e.scale,r=q4e(e,t?.geometry);return r.setBoundingSphere(q.create(B.create(n/2,n/2,n/2),n)),jF.create(`axes-text`,{},r,t=>{switch(t){case I0.X:return e.labelColorX;case I0.Y:return e.labelColorY;case I0.Z:return e.labelColorZ;default:return gk.grey}},()=>1,()=>``)}function Y4e(e){let t=J4e(e);return jF.createRenderObject(t,{...V.getDefaultValues(uP.Params),...e,alpha:e.labelOpacity,cellSize:0})}const X4e={rendersPerFrame:V.Interval([1,16],{min:1,max:64,step:1},{description:`Number of rays per pixel each frame. May be adjusted to reach targetFps but will stay within given interval.`}),targetFps:V.Numeric(30,{min:0,max:120,step:.1},{description:`Target FPS per frame. If observed FPS is lower or higher, some parameters may get adjusted.`}),steps:V.Numeric(32,{min:1,max:1024,step:1}),firstStepSize:V.Numeric(.01,{min:.001,max:1,step:.001}),refineSteps:V.Numeric(4,{min:0,max:8,step:1},{description:`Number of refine steps per ray hit. May be lower to reach targetFps.`}),rayDistance:V.Numeric(256,{min:1,max:8192,step:1},{description:`Maximum distance a ray can travel (in world units).`}),thicknessMode:V.Select(`auto`,V.arrayToOptions([`auto`,`fixed`])),minThickness:V.Numeric(.5,{min:.1,max:16,step:.1},{hideIf:e=>e.thicknessMode===`fixed`}),thicknessFactor:V.Numeric(1,{min:.1,max:2,step:.05},{hideIf:e=>e.thicknessMode===`fixed`}),thickness:V.Numeric(4,{min:.1,max:512,step:.1},{hideIf:e=>e.thicknessMode===`auto`}),bounces:V.Numeric(4,{min:1,max:32,step:1},{description:`Number of bounces for each ray.`}),glow:V.Boolean(!0,{description:`Bounced rays always get the full light. This produces a slight glowing effect.`}),shadowEnable:V.Boolean(!1),shadowSoftness:V.Numeric(.1,{min:.01,max:1,step:.01}),shadowThickness:V.Numeric(.5,{min:.1,max:32,step:.1})};var Z4e=class{constructor(e,t){this.webgl=e,this.drawPass=t,this.clearAdjustedProps=!0,this.prevTime=0,this.currTime=0,this.rendersPerFrame=1,this.refineSteps=1,this.steps=16;let{extensions:{drawBuffers:n,colorBufferHalfFloat:r,textureHalfFloat:i},resources:a,isWebGL2:o}=e,{depthTextureOpaque:s}=t,c=s.getWidth(),l=s.getHeight();o?(this.shadedTextureOpaque=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.shadedTextureOpaque.define(c,l),this.normalTextureOpaque=r&&i?a.texture(`image-float16`,`rgba`,`fp16`,`nearest`):a.texture(`image-float32`,`rgba`,`float`,`nearest`),this.normalTextureOpaque.define(c,l),this.colorTextureOpaque=a.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),this.colorTextureOpaque.define(c,l)):(this.shadedTextureOpaque=a.texture(`image-float32`,`rgba`,`float`,`nearest`),this.shadedTextureOpaque.define(c,l),this.normalTextureOpaque=a.texture(`image-float32`,`rgba`,`float`,`nearest`),this.normalTextureOpaque.define(c,l),this.colorTextureOpaque=a.texture(`image-float32`,`rgba`,`float`,`nearest`),this.colorTextureOpaque.define(c,l)),this.framebuffer=a.framebuffer(),this.framebuffer.bind(),n.drawBuffers([n.COLOR_ATTACHMENT0,n.COLOR_ATTACHMENT1,n.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,`color0`),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,`color1`),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,`color2`),this.thicknessTarget=e.createRenderTarget(c,l,!0,`uint8`,`nearest`),this.holdTarget=e.createRenderTarget(c,l,!1,`float32`),this.accumulateTarget=e.createRenderTarget(c,l,!1,`float32`),this.composeTarget=e.createRenderTarget(c,l,!1,`uint8`,`linear`),this.traceRenderable=e3e(e,this.colorTextureOpaque,this.normalTextureOpaque,this.shadedTextureOpaque,this.thicknessTarget.texture,this.accumulateTarget.texture,this.drawPass.depthTextureOpaque),this.accumulateRenderable=r3e(e,this.holdTarget.texture)}getByteCount(){return this.thicknessTarget.getByteCount()+this.holdTarget.getByteCount()+this.accumulateTarget.getByteCount()+this.composeTarget.getByteCount()+this.colorTextureOpaque.getByteCount()+this.normalTextureOpaque.getByteCount()+this.shadedTextureOpaque.getByteCount()}renderInput(e,t,n,r){$y&&this.webgl.timer.mark(`TracePass.renderInput`);let{gl:i,state:a}=this.webgl;this.framebuffer.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.framebuffer,`depth`),e.clear(!0),e.renderTracing(n.primitives,t),r.thicknessMode===`auto`&&(this.thicknessTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),e.renderDepthOpaqueBack(n.primitives,t)),$y&&this.webgl.timer.markEnd(`TracePass.renderInput`)}setSize(e,t){let n=this.composeTarget.getWidth(),r=this.composeTarget.getHeight();(e!==n||t!==r)&&(this.thicknessTarget.setSize(e,t),this.holdTarget.setSize(e,t),this.accumulateTarget.setSize(e,t),this.composeTarget.setSize(e,t),this.colorTextureOpaque.define(e,t),this.normalTextureOpaque.define(e,t),this.shadedTextureOpaque.define(e,t),L.update(this.traceRenderable.values.uTexSize,R.set(this.traceRenderable.values.uTexSize.ref.value,e,t)),L.update(this.accumulateRenderable.values.uTexSize,R.set(this.accumulateRenderable.values.uTexSize.ref.value,e,t)))}reset(){let{drawBuffers:e}=this.webgl.extensions;this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,`color0`),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,`color1`),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,`color2`),this.restart(!0)}restart(e=!1){let{gl:t,state:n}=this.webgl;this.accumulateTarget.bind(),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.composeTarget.bind(),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),e&&(this.prevTime=0,this.currTime=0,this.clearAdjustedProps=!0)}increaseAdjustedProps(e){this.steps+=1,this.steps>e.steps&&(this.refineSteps+=1),this.refineSteps>e.refineSteps&&(this.rendersPerFrame+=1)}decreaseAdjustedProps(e){let t=Math.min(1,e.refineSteps);--this.rendersPerFrame,this.rendersPerFrame<1&&--this.refineSteps,this.refineSteps<t&&--this.steps}getAdjustedProps(e,t){this.currTime=Ly();let n=Math.min(1,e.refineSteps),r=Math.round(e.steps/2);if(this.clearAdjustedProps&&=(this.rendersPerFrame=e.rendersPerFrame[0],this.refineSteps=n,this.steps=r,!1),t>0){let t=1e3/e.targetFps,n=this.currTime-this.prevTime,r=Math.round(n/t);if(r>=2)for(;r>0;)this.decreaseAdjustedProps(e),--r;else n<t?this.increaseAdjustedProps(e):n>t+.5&&this.decreaseAdjustedProps(e)}return this.prevTime=this.currTime,this.rendersPerFrame=DT(this.rendersPerFrame,e.rendersPerFrame[0],e.rendersPerFrame[1]),this.refineSteps=DT(this.refineSteps,n,e.refineSteps),this.steps=DT(this.steps,r,e.steps),{rendersPerFrame:t===0?Math.ceil(this.rendersPerFrame/2):this.rendersPerFrame,refineSteps:t===0?n:this.refineSteps,steps:t===0?r:this.steps}}render(e,t,n,r,i){let{rendersPerFrame:a,refineSteps:o,steps:s}=this.getAdjustedProps(n,r);$y&&this.webgl.timer.mark(`TracePass.render`,{note:`${a} rendersPerFrame, ${o} refineSteps, ${s} steps`});let{renderer:c,camera:l,scene:u}=e,{gl:d,state:f}=this.webgl,{x:p,y:m,width:h,height:g}=l.viewport;(r===0||i)&&(c.setTransparentBackground(t),c.setDrawingBufferSize(this.composeTarget.getWidth(),this.composeTarget.getHeight()),c.setPixelRatio(this.webgl.pixelRatio),c.setViewport(p,m,h,g),c.update(l,u),this.renderInput(c,l,u,n)),f.disable(d.BLEND),f.disable(d.DEPTH_TEST),f.disable(d.CULL_FACE),f.depthMask(!1),f.viewport(p,m,h,g),f.scissor(p,m,h,g);let _=z.identity();z.invert(_,l.projection);let v=l.state.mode===`orthographic`?1:0,[y,b]=this.traceRenderable.values.uTexSize.ref.value,x=l.viewport,S=B();B.scale(S,tE.toArrayNormalized(c.props.ambientColor,S,0),c.props.ambientIntensity);let C=B.clone(S);for(let e=0,t=c.light.count;e<t;++e){let t=B.fromArray(B(),c.light.color,e*3);B.add(C,C,t)}this.holdTarget.bind();let w=!1;L.update(this.traceRenderable.values.uFrameNo,r),this.traceRenderable.values.dRendersPerFrame.ref.value!==a&&(L.update(this.traceRenderable.values.dRendersPerFrame,a),w=!0),L.update(this.traceRenderable.values.uProjection,l.projection),L.update(this.traceRenderable.values.uInvProjection,_),AO.set(this.traceRenderable.values.uBounds.ref.value,x.x/y,x.y/b,(x.x+x.width)/y,(x.y+x.height)/b),L.update(this.traceRenderable.values.uBounds,this.traceRenderable.values.uBounds.ref.value),L.updateIfChanged(this.traceRenderable.values.uNear,l.near),L.updateIfChanged(this.traceRenderable.values.uFar,l.far),L.updateIfChanged(this.traceRenderable.values.uFogFar,l.fogFar),L.updateIfChanged(this.traceRenderable.values.uFogNear,l.fogNear),L.update(this.traceRenderable.values.uFogColor,tE.toVec3Normalized(this.traceRenderable.values.uFogColor.ref.value,c.props.backgroundColor)),this.traceRenderable.values.dOrthographic.ref.value!==v&&(L.update(this.traceRenderable.values.dOrthographic,v),w=!0),L.update(this.traceRenderable.values.uLightDirection,c.light.direction),L.update(this.traceRenderable.values.uLightColor,c.light.color),this.traceRenderable.values.dLightCount.ref.value!==c.light.count&&(L.update(this.traceRenderable.values.dLightCount,c.light.count),w=!0),L.update(this.traceRenderable.values.uAmbientColor,S),L.update(this.traceRenderable.values.uLightStrength,C),this.traceRenderable.values.dGlow.ref.value!==n.glow&&(L.update(this.traceRenderable.values.dGlow,n.glow),w=!0),this.traceRenderable.values.dBounces.ref.value!==n.bounces&&(L.update(this.traceRenderable.values.dBounces,n.bounces),w=!0),this.traceRenderable.values.dSteps.ref.value!==s&&(L.update(this.traceRenderable.values.dSteps,s),w=!0),this.traceRenderable.values.dFirstStepSize.ref.value!==n.firstStepSize&&(L.update(this.traceRenderable.values.dFirstStepSize,n.firstStepSize),w=!0),this.traceRenderable.values.dRefineSteps.ref.value!==o&&(L.update(this.traceRenderable.values.dRefineSteps,o),w=!0),L.updateIfChanged(this.traceRenderable.values.uRayDistance,n.rayDistance),this.traceRenderable.values.dThicknessMode.ref.value!==n.thicknessMode&&(L.update(this.traceRenderable.values.dThicknessMode,n.thicknessMode),w=!0),L.updateIfChanged(this.traceRenderable.values.uMinThickness,n.minThickness),L.updateIfChanged(this.traceRenderable.values.uThicknessFactor,n.thicknessFactor),L.updateIfChanged(this.traceRenderable.values.uThickness,n.thickness),this.traceRenderable.values.dShadowEnable.ref.value!==n.shadowEnable&&(L.update(this.traceRenderable.values.dShadowEnable,n.shadowEnable),w=!0),L.updateIfChanged(this.traceRenderable.values.uShadowSoftness,n.shadowSoftness),L.updateIfChanged(this.traceRenderable.values.uShadowThickness,n.shadowThickness),w&&this.traceRenderable.update(),$y&&this.webgl.timer.mark(`TracePass.renderTrace`),this.traceRenderable.render(),$y&&this.webgl.timer.markEnd(`TracePass.renderTrace`),this.accumulateTarget.bind(),this.accumulateRenderable.render(),$y&&this.webgl.timer.markEnd(`TracePass.render`)}},Q4e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),tNormal:GP(`texture`,`rgba`,`ubyte`,`nearest`),tShaded:GP(`texture`,`rgba`,`ubyte`,`nearest`),tThickness:GP(`texture`,`rgba`,`ubyte`,`nearest`),tAccumulate:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),uFogNear:J(`f`),uFogFar:J(`f`),uFogColor:J(`v3`),uProjection:J(`m4`),uInvProjection:J(`m4`),uBounds:J(`v4`),uLightDirection:J(`v3[]`),uLightColor:J(`v3[]`),dLightCount:qP(`number`),uAmbientColor:J(`v3`),uLightStrength:J(`v3`),uFrameNo:J(`i`),dRendersPerFrame:qP(`number`),dGlow:qP(`boolean`),dBounces:qP(`number`),dSteps:qP(`number`),dFirstStepSize:qP(`number`),dRefineSteps:qP(`number`),uRayDistance:J(`f`),dThicknessMode:qP(`string`),uMinThickness:J(`f`),uThicknessFactor:J(`f`),uThickness:J(`f`),dShadowEnable:qP(`boolean`),uShadowSoftness:J(`f`),uShadowThickness:J(`f`)},$4e=fj(`trace`,tF,`
precision highp int;
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tShaded;
uniform sampler2D tThickness;
uniform sampler2D tAccumulate;
uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;
uniform vec3 uLightStrength;

uniform int uFrameNo;

uniform float uRayDistance;
uniform float uMinThickness;
uniform float uThicknessFactor;
uniform float uThickness;

uniform float uShadowSoftness;
uniform float uShadowThickness;

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#include common

// parts adapted from
// - https://blog.demofox.org/2020/05/25/casual-shadertoy-path-tracing-1-basic-camera-diffuse-emissive/
// - https://github.com/0beqz/realism-effects/blob/v2-debug/src/ssgi/shader/ssgi.frag

//

// after a hit, it moves the ray this far along the normal away from a surface.
// Helps prevent incorrect intersections when rays bounce off of objects.
#define RayPosNormalNudge 0.0001

#if __VERSION__ == 100
    #define StateType float

    // from https://www.shadertoy.com/view/4djSRW
    float hash14(vec4 p4) {
        p4 = fract(p4  * vec4(0.1031, 0.1030, 0.0973, 0.1099));
        p4 += dot(p4, p4.wzxy + 33.33);
        return fract((p4.x + p4.y) * (p4.z + p4.w));
    }

    float randomFloat(inout float state) {
        state += 0.06711056;
        return 1.0 - hash14(vec4(gl_FragCoord.xy, float(uFrameNo), state));
    }
#else
    #define StateType uint

    // https://www.pcg-random.org/
    // https://jcgt.org/published/0009/03/02/
    uint pcg(inout uint seed) {
        seed = seed * 747796405u + 2891336453u;
        uint word = ((seed >> ((seed >> 28u) + 4u)) ^ seed) * 277803737u;
        return (word >> 22u) ^ word;
    }

    float randomFloat(inout uint state) {
        return float(pcg(state)) / 4294967296.0;
    }
#endif

vec3 randomUnitVector(inout StateType state) {
    float z = randomFloat(state) * 2.0 - 1.0;
    float a = randomFloat(state) * TWO_PI;
    float r = sqrt(1.0 - z * z);
    float x = r * cos(a);
    float y = r * sin(a);
    return vec3(x, y, z);
}

struct RayHitInfo {
    bool missed;
    vec3 position;
    vec3 normal;
    vec3 color;
    vec3 emissive;
};

//

float getDepth(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return texture2D(tDepth, c).r;
}

float getThickness(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    return unpackRGBAToDepth(texture2D(tThickness, c));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

vec2 viewSpaceToScreenSpace(const vec3 position) {
    vec4 projectedCoord = uProjection * vec4(position, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    // [-1, 1] --> [0, 1] (NDC to screen position)
    projectedCoord.xy = projectedCoord.xy * 0.5 + 0.5;
    return projectedCoord.xy;
}

vec2 binarySearch(inout vec3 dir, inout vec3 hitPos) {
    float rayHitDepthDifference;
    vec2 coords;

    dir *= 0.5;
    hitPos -= dir;

    for (int i = 0; i < dRefineSteps; i++) {
        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        dir *= 0.5;
        if (rayHitDepthDifference >= 0.0) {
            hitPos -= dir;
        } else {
            hitPos += dir;
        }
    }

    coords = viewSpaceToScreenSpace(hitPos);

    return coords;
}

float calculateGrowthFactor(float begin, float end, float steps) {
    return pow(end / begin, 1.0 / steps);
}

vec2 rayMarch(in vec3 dir, in float thickness, inout vec3 hitPos, out bool missed) {
    float rayHitDepthDifference;
    vec2 coords;

    float begin = float(dFirstStepSize);
    dir *= begin;
    missed = false;
    float gf = calculateGrowthFactor(begin, uRayDistance, float(dSteps));

    for (int i = 1; i < dSteps; i++) {
        hitPos += dir;
        dir *= gf;

        coords = viewSpaceToScreenSpace(hitPos);
        float depth = getDepth(coords);
        float z = getViewZ(depth);
        rayHitDepthDifference = z - hitPos.z;

        if (thickness == 0.0) {
            #ifdef dThicknessMode_auto
                thickness = max(uMinThickness, (getViewZ(getThickness(coords)) - z) * uThicknessFactor * texture2D(tColor, coords).a);
            #else
                thickness = uThickness;
            #endif
        }

        if (rayHitDepthDifference >= 0.0 && rayHitDepthDifference < thickness) {
            if (dRefineSteps == 0) {
                return coords;
            } else {
                return binarySearch(dir, hitPos);
            }
        }
    }

    missed = true;

    return coords;
}

//

void trace(in vec3 rayPos, in vec3 rayDir, inout RayHitInfo hitInfo) {
    vec3 hitPos = vec3(rayPos);
    bool missed;
    vec2 coords;
    coords = rayMarch(rayDir, 0.0, hitPos, missed);

    hitInfo.missed = missed;
    hitInfo.position = hitPos;
    hitInfo.normal = -texture2D(tNormal, coords).rgb;
    hitInfo.color = texture2D(tColor, coords).rgb;
    hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a * 2.0;

    float depth = getDepth(coords);
    if (isBackground(depth)) {
        hitInfo.emissive = vec3(0.0);
    }
}

vec3 viewPos;

vec3 colorForRay(in vec3 startRayPos, in vec3 startRayDir, inout StateType rngState) {
    vec3 ret = vec3(0.0, 0.0, 0.0);

    vec3 throughput = vec3(1.0, 1.0, 1.0);
    vec3 rayPos = startRayPos;
    vec3 rayDir = startRayDir;

    RayHitInfo hitInfo;
    RayHitInfo prevHitInfo;

    for (int bounceIndex = 0; bounceIndex <= dBounces; ++bounceIndex) {
        // shoot a ray out into the world
        if (bounceIndex == 0) {
            vec2 coords = gl_FragCoord.xy / uTexSize;
            float depth = getDepth(coords);

            hitInfo.missed = false;
            hitInfo.position = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
            hitInfo.normal = -texture2D(tNormal, coords).rgb;
            hitInfo.color = texture2D(tShaded, coords).rgb;
            hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a;

            // shadow
            #ifdef dShadowEnable
                #if dLightCount != 0
                    vec3 directLight = vec3(uAmbientColor);
                    #pragma unroll_loop_start
                    bool missed;
                    vec3 hitPos;
                    for (int i = 0; i < dLightCount; ++i) {
                        missed = false;
                        hitPos = viewPos + hitInfo.normal * RayPosNormalNudge;
                        hitPos += -uLightDirection[i] * (randomFloat(rngState));
                        rayMarch(-uLightDirection[i] + randomUnitVector(rngState) * uShadowSoftness, uShadowThickness, hitPos, missed);
                        if (missed) directLight += uLightColor[i];
                    }
                    #pragma unroll_loop_end
                    hitInfo.color *= directLight / uLightStrength;
                #endif
            #endif

            if (hitInfo.normal == vec3(0.0)) {
                hitInfo.missed = true;
            }
        } else {
            prevHitInfo = hitInfo;
            trace(rayPos, rayDir, hitInfo);
        }

        // if the ray missed, we are done
        if (hitInfo.missed) {
            vec3 accIrradiance = vec3(1.0);
            #ifdef dGlow
                if (bounceIndex > 1) {
                    accIrradiance = uLightStrength;
                }
            #else
                if (bounceIndex > 1) {
                    accIrradiance = uAmbientColor;
                    #if dLightCount != 0
                        #pragma unroll_loop_start
                        float dotNL;
                        vec3 irradiance;
                        for (int i = 0; i < dLightCount; ++i) {
                            dotNL = saturate(dot(prevHitInfo.normal, -uLightDirection[i]));
                            irradiance = dotNL * uLightColor[i];
                            accIrradiance += irradiance;
                        }
                        #pragma unroll_loop_end
                    #endif
                }
            #endif
            ret += prevHitInfo.color * accIrradiance * throughput;
            break;
        }

        // add emissive light
        ret += hitInfo.emissive * throughput;

        // update the ray position
        rayPos = hitInfo.position + hitInfo.normal * RayPosNormalNudge;

        // new ray direction from normal oriented cosine weighted hemisphere sample
        rayDir = normalize(hitInfo.normal + randomUnitVector(rngState));

        if (bounceIndex == 0) {
            continue;
        }

        // update the colorMultiplier.
        throughput *= hitInfo.color;

        // Russian Roulette
        // As the throughput gets smaller, the ray is more likely to get terminated early.
        // Survivors have their value boosted to make up for fewer samples being in the average.
        {
            float p = max(throughput.r, max(throughput.g, throughput.b));
            if (randomFloat(rngState) > p)
                break;

            // Add the energy we 'lose' by randomly terminating paths
            throughput *= 1.0 / p;
        }
    }

    // return pixel color
    return ret;
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = texture2D(tColor, coords);
        return;
    }

    #if __VERSION__ == 100
        float rngState = 26699.0;
    #else
        // initialize a random number state based on gl_FragCoord and uFrameNo
        uint rngState = uint(uint(gl_FragCoord.x) * 1973u + uint(gl_FragCoord.y) * 9277u + uint(uFrameNo) * 26699u) | 1u;
    #endif

    vec3 cameraPos = vec3(0.0, 0.0, 0.0);
    viewPos = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 rayDir = normalize(viewPos);

    // raytrace for this pixel
    vec3 color = vec3(0.0, 0.0, 0.0);
    for (int index = 0; index < int(dRendersPerFrame); ++index) {
        color += colorForRay(cameraPos, rayDir, rngState) / float(dRendersPerFrame);
    }

    // average the frames together
    vec4 lastFrameColor = texture2D(tAccumulate, coords);
    float blend = (uFrameNo < 1 || lastFrameColor.a == 0.0) ? 1.0 : 1.0 / (1.0 + (1.0 / lastFrameColor.a));
    color = mix(lastFrameColor.rgb, color, blend);

    // show the result
    gl_FragColor = vec4(color, blend);
}
`);function e3e(e,t,n,r,i,a,o){let s={...vF,tColor:L.create(t),tNormal:L.create(n),tShaded:L.create(r),tThickness:L.create(i),tAccumulate:L.create(a),tDepth:L.create(o),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uFogNear:L.create(1e4),uFogFar:L.create(1e4),uFogColor:L.create(B.create(1,1,1)),uProjection:L.create(z.identity()),uInvProjection:L.create(z.identity()),uBounds:L.create(AO()),uLightDirection:L.create([]),uLightColor:L.create([]),dLightCount:L.create(0),uAmbientColor:L.create(B()),uLightStrength:L.create(B.create(1,1,1)),uFrameNo:L.create(0),dRendersPerFrame:L.create(1),dGlow:L.create(!0),dBounces:L.create(4),dSteps:L.create(32),dFirstStepSize:L.create(.01),dRefineSteps:L.create(4),uRayDistance:L.create(256),dThicknessMode:L.create(`auto`),uMinThickness:L.create(.5),uThicknessFactor:L.create(1),uThickness:L.create(4),dShadowEnable:L.create(!1),uShadowSoftness:L.create(.1),uShadowThickness:L.create(.1)};return hF(aF(e,`triangles`,$4e,{...Q4e},s),s)}var t3e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uWeight:J(`f`)},n3e=fj(`accumulate`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`);function r3e(e,t){let n={...vF,tColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),uWeight:L.create(1)};return hF(aF(e,`triangles`,n3e,{...t3e},n),n)}var i3e=!1;function a3e(e){let{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i}=e.extensions;if(!n||!r||!i||!t){if(Qy&&!i3e){let e=[];n||e.push(`textureFloat`),r||e.push(`colorBufferFloat`),i||e.push(`depthTexture`),t||e.push(`drawBuffers`),console.log(`Missing "${e.join(`", "`)}" extensions required for "illumination"`),i3e=!0}return!1}else return!0}const o3e={enabled:V.Boolean(!1),maxIterations:V.Numeric(5,{min:0,max:16,step:1},{description:`Maximum number of tracing iterations. Final iteration count is 2^x.`}),denoise:V.Boolean(!0),denoiseThreshold:V.Interval([.15,1],{min:0,max:4,step:.01},{description:`Threshold for denoising. Automatically adjusted within given interval based on current iteration.`}),ignoreOutline:V.Boolean(!0,{description:`Ignore outline in illumination pass where it is generally not needed for visual clarity. Useful when illumination is often toggled on/off.`}),...X4e};var R0=class e{get iteration(){return this._iteration}get colorTarget(){return this._colorTarget}get supported(){return this._supported}getByteCount(){return this._supported?this.tracing.getByteCount()+this.transparentTarget.getByteCount()+this.outputTarget.getByteCount()+this.multiSampleComposeTarget.getByteCount()+this.multiSampleHoldTarget.getByteCount()+this.multiSampleAccumulateTarget.getByteCount():0}getMaxIterations(e){return 2**e.maxIterations}static isSupported(e){return a3e(e)}static isEnabled(e,t){return t.enabled&&a3e(e)}constructor(t,n){if(this.webgl=t,this.drawPass=n,this._iteration=0,this._supported=!1,this.prevSampleIndex=-1,!e.isSupported(t))return;let{colorTarget:r}=n,i=r.getWidth(),a=r.getHeight();this.tracing=new Z4e(t,this.drawPass),this.transparentTarget=t.createRenderTarget(i,a,!1,`uint8`,`nearest`),this.outputTarget=t.createRenderTarget(i,a,!1,`uint8`,`linear`),this.copyRenderable=yF(t,this.transparentTarget.texture),this.composeRenderable=l3e(t,this.tracing.accumulateTarget.texture,this.tracing.normalTextureOpaque,this.tracing.colorTextureOpaque,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,this.drawPass.postprocessing.outline.target.texture,this.transparentTarget.texture,this.drawPass.postprocessing.ssao.ssaoDepthTexture,this.drawPass.postprocessing.ssao.ssaoDepthTransparentTexture,!1),this.multiSampleComposeTarget=t.createRenderTarget(i,a,!1,`float32`),this.multiSampleHoldTarget=t.createRenderTarget(i,a,!1),this.multiSampleAccumulateTarget=t.createRenderTarget(i,a,!1,`float32`),this.multiSampleCompose=f3e(t,this.outputTarget.texture),this._supported=!0}renderInput(e,t,n,r){$y&&this.webgl.timer.mark(`IlluminationPass.renderInput`);let{gl:i,state:a}=this.webgl,o=N0.isEnabled(r.marking),s=n.opacityAverage<1||n.volumes.renderables.length>0,c=o&&n.markerAverage>0;this.transparentTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT);let l=E0.isTransparentOutlineEnabled(r.postprocessing)&&!r.illumination.ignoreOutline,u=_0.isEnabled(r.postprocessing),d=E0.isTransparentSsaoEnabled(n,r.postprocessing);if((l||u||d)&&(this.drawPass.depthTargetTransparent.bind(),e.clearDepth(!0)),s){if(this.drawPass.transparency===`wboit`)this.drawPass.wboit.bind(),e.renderWboitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque),n.volumes.renderables.length>0&&e.renderWboitTransparent(n.volumes,t,this.drawPass.depthTextureOpaque),this.transparentTarget.bind(),this.drawPass.wboit.render();else if(this.drawPass.transparency===`dpoit`){let i=this.drawPass.dpoit.bind();e.renderDpoitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque,i);for(let i=0,a=r.dpoitIterations;i<a;i++){$y&&this.webgl.timer.mark(`DpoitPass.layer`);let r=this.drawPass.dpoit.bindDualDepthPeeling();e.renderDpoitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque,r),a>1&&(this.transparentTarget.bind(),this.drawPass.dpoit.renderBlendBack()),$y&&this.webgl.timer.markEnd(`DpoitPass.layer`)}this.transparentTarget.bind(),this.drawPass.dpoit.render(),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.drawPass.depthTextureOpaque)}else this.transparentTarget.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.transparentTarget.framebuffer,`depth`),e.renderBlendedTransparent(n.primitives,t),this.drawPass.depthTextureOpaque.detachFramebuffer(this.transparentTarget.framebuffer,`depth`),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.drawPass.depthTextureOpaque);(l||u||d)&&(this.drawPass.depthTargetTransparent.bind(),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.drawPass.depthTextureOpaque)),d&&(this.drawPass.postprocessing.ssao.update(t,n,r.postprocessing.occlusion.params,!0),this.drawPass.postprocessing.ssao.render(t))}if(c){let i=r.marking.ghostEdgeStrength<1;i&&n.markerAverage!==1&&(this.drawPass.marking.depthTarget.bind(),e.clear(!1,!0),e.renderMarkingDepth(n.primitives,t)),this.drawPass.marking.maskTarget.bind(),e.clear(!1,!0),e.renderMarkingMask(n.primitives,t,i?this.drawPass.marking.depthTarget.texture:null),this.drawPass.marking.update(r.marking),this.drawPass.marking.render(t.viewport,this.transparentTarget)}this.tracing.composeTarget.bind(),a.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),$y&&this.webgl.timer.markEnd(`IlluminationPass.renderInput`)}shouldRender(e){return this._supported&&e.enabled&&this._iteration<this.getMaxIterations(e)}setSize(e,t){if(!this._supported)return;let n=this.outputTarget.getWidth(),r=this.outputTarget.getHeight();(e!==n||t!==r)&&(this.tracing.setSize(e,t),this.transparentTarget.setSize(e,t),this.outputTarget.setSize(e,t),L.update(this.copyRenderable.values.uTexSize,R.set(this.copyRenderable.values.uTexSize.ref.value,e,t)),L.update(this.composeRenderable.values.uTexSize,R.set(this.composeRenderable.values.uTexSize.ref.value,e,t)),this.multiSampleComposeTarget.setSize(e,t),this.multiSampleHoldTarget.setSize(e,t),this.multiSampleAccumulateTarget.setSize(e,t),L.update(this.multiSampleCompose.values.uTexSize,R.set(this.multiSampleCompose.values.uTexSize.ref.value,e,t))),this.drawPass.setSize(e,t)}reset(){this._supported&&(this.tracing.reset(),this._iteration=0,this.prevSampleIndex=-1)}restart(e=!1){this._supported&&(this.tracing.restart(e),this._iteration=0,this.prevSampleIndex=-1)}renderInternal(e,t,n,r){if(!this.shouldRender(t.illumination))return;$y&&this.webgl.timer.mark(`IlluminationPass.render`,{note:`iteration ${this._iteration+1} of ${this.getMaxIterations(t.illumination)}`}),this.tracing.render(e,t.transparentBackground,t.illumination,this._iteration,r);let{renderer:i,camera:a,scene:o,helper:s}=e,{gl:c,state:l}=this.webgl,{x:u,y:d,width:f,height:p}=a.viewport;(this._iteration===0||r)&&(i.setTransparentBackground(t.transparentBackground),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(u,d,f,p),i.update(a,o),this.renderInput(i,a,o,t)),l.disable(c.BLEND),l.disable(c.DEPTH_TEST),l.disable(c.CULL_FACE),l.depthMask(!1),l.viewport(u,d,f,p),l.scissor(u,d,f,p);let m=a.state.mode===`orthographic`?1:0,h=D0.isEnabled(t.postprocessing),g=x0.isEnabled(t.postprocessing)&&!t.illumination.ignoreOutline,_=E0.isTransparentSsaoEnabled(o,t.postprocessing),v=y0.isEnabled(t.postprocessing),y=_0.isEnabled(t.postprocessing),b=N0.isEnabled(t.marking),x=o.opacityAverage<1||o.volumes.renderables.length>0,S=b&&o.markerAverage>0,C=!1;if(this.composeRenderable.values.dOutlineEnable.ref.value!==g&&(C=!0,L.update(this.composeRenderable.values.dOutlineEnable,g)),g&&t.postprocessing.outline.name===`on`){let{transparentOutline:e,outlineScale:n}=this.drawPass.postprocessing.outline.update(a,t.postprocessing.outline.params,this.drawPass.depthTargetTransparent.texture,this.drawPass.depthTextureOpaque);this.drawPass.postprocessing.outline.render(),L.update(this.composeRenderable.values.uOutlineColor,tE.toVec3Normalized(this.composeRenderable.values.uOutlineColor.ref.value,t.postprocessing.outline.params.color)),this.composeRenderable.values.dOutlineScale.ref.value!==n&&(C=!0,L.update(this.composeRenderable.values.dOutlineScale,n)),this.composeRenderable.values.dTransparentOutline.ref.value!==e&&(C=!0,L.update(this.composeRenderable.values.dTransparentOutline,e))}this.composeRenderable.values.dOcclusionEnable.ref.value!==_&&(C=!0,L.update(this.composeRenderable.values.dOcclusionEnable,_)),_&&t.postprocessing.occlusion.name===`on`&&L.update(this.composeRenderable.values.uOcclusionColor,tE.toVec3Normalized(this.composeRenderable.values.uOcclusionColor.ref.value,t.postprocessing.occlusion.params.color));let w=x||S;this.composeRenderable.values.dBlendTransparency.ref.value!==w&&(C=!0,L.update(this.composeRenderable.values.dBlendTransparency,w)),L.updateIfChanged(this.composeRenderable.values.uNear,a.near),L.updateIfChanged(this.composeRenderable.values.uFar,a.far),L.updateIfChanged(this.composeRenderable.values.uFogFar,a.fogFar),L.updateIfChanged(this.composeRenderable.values.uFogNear,a.fogNear),L.update(this.composeRenderable.values.uFogColor,tE.toVec3Normalized(this.composeRenderable.values.uFogColor.ref.value,i.props.backgroundColor)),this.composeRenderable.values.dOrthographic.ref.value!==m&&(L.update(this.composeRenderable.values.dOrthographic,m),C=!0),n&&!h&&!y?this.webgl.bindDrawingBuffer():this.tracing.composeTarget.bind(),this._colorTarget=this.tracing.composeTarget,this.drawPass.postprocessing.background.update(a,t.postprocessing.background),this.drawPass.postprocessing.background.clear(t.postprocessing.background,t.transparentBackground,i.props.backgroundColor),this.drawPass.postprocessing.background.render(t.postprocessing.background),L.updateIfChanged(this.composeRenderable.values.uTransparentBackground,t.transparentBackground||this.drawPass.postprocessing.background.isEnabled(t.postprocessing)),this.composeRenderable.values.dDenoise.ref.value!==t.illumination.denoise&&(L.update(this.composeRenderable.values.dDenoise,t.illumination.denoise),C=!0);let T=t.multiSample.mode===`on`?t.illumination.denoiseThreshold[0]:OT(t.illumination.denoiseThreshold[1],t.illumination.denoiseThreshold[0],DT(this.iteration/(this.getMaxIterations(t.illumination)/2),0,1));L.updateIfChanged(this.composeRenderable.values.uDenoiseThreshold,T),C&&this.composeRenderable.update(),this.composeRenderable.render(),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(u,d,f,p),i.update(a,o),s.debug.isEnabled&&(s.debug.syncVisibility(),i.renderBlended(s.debug.scene,a)),s.handle.isEnabled&&i.renderBlended(s.handle.scene,a),s.camera.isEnabled&&(s.camera.update(a),i.update(s.camera.camera,s.camera.scene),i.renderBlended(s.camera.scene,s.camera.camera));let E=!1,D=this.outputTarget;if(h){let e=n&&!y;this.drawPass.antialiasing.render(a,this.tracing.composeTarget.texture,e?!0:this.outputTarget,t.postprocessing),e?E=!0:(this._colorTarget=this.outputTarget,D=this.tracing.composeTarget)}if(v&&t.postprocessing.bloom.name===`on`){let e=n&&!y||E;this.drawPass.bloom.update(this.tracing.colorTextureOpaque,this.tracing.normalTextureOpaque,this.drawPass.depthTextureOpaque,t.postprocessing.bloom.params),this.drawPass.bloom.render(a.viewport,e?void 0:this._colorTarget)}if(y&&t.postprocessing.dof.name===`on`){let e=n||E;this.drawPass.dof.update(a,this._colorTarget.texture,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,t.postprocessing.dof.params,o.boundingSphereVisible),this.drawPass.dof.render(a.viewport,e?void 0:D),e||(this._colorTarget=D)}this._iteration+=1,$y&&this.webgl.timer.markEnd(`IlluminationPass.render`),this.webgl.gl.flush()}renderMultiSample(e,t,n){let{camera:r}=e,{multiSampleCompose:i,multiSampleComposeTarget:a,multiSampleHoldTarget:o,webgl:s}=this,{gl:c,state:l}=s,u=k0[Math.max(0,Math.min(t.multiSample.sampleLevel,5))],d=this.getMaxIterations(t.illumination),f=Math.min(this._iteration,d),p=Math.floor(f/d*u.length);$y&&s.timer.mark(`IlluminationPass.renderMultiSample`,{note:`sampleIndex ${p+1} of ${u.length}`});let{x:m,y:h,width:g,height:_}=r.viewport,v=1/d;if(f===0)this.renderInternal(e,t,!1,!0),L.update(i.values.uWeight,1),L.update(i.values.tColor,this._colorTarget.texture),i.update(),o.bind(),l.disable(c.BLEND),l.disable(c.DEPTH_TEST),l.depthMask(!1),l.viewport(m,h,g,_),l.scissor(m,h,g,_),i.render();else{r.viewOffset.enabled=!0,L.update(i.values.tColor,this._colorTarget.texture),L.update(i.values.uWeight,v),i.update();let n=u[p];l0.setViewOffset(r.viewOffset,g,_,n[0],n[1],g,_),r.update(),this.renderInternal(e,t,!1,this.prevSampleIndex!==p),a.bind(),l.enable(c.BLEND),l.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),l.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE),l.disable(c.DEPTH_TEST),l.depthMask(!1),l.viewport(m,h,g,_),l.scissor(m,h,g,_),f===1&&(l.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),i.render()}this.prevSampleIndex=p,n?this.webgl.bindDrawingBuffer():this.multiSampleAccumulateTarget.bind(),l.viewport(m,h,g,_),l.scissor(m,h,g,_);let y=f*v;y>0&&(L.update(i.values.uWeight,1),L.update(i.values.tColor,a.texture),i.update(),l.disable(c.BLEND),i.render()),y<1&&(L.update(i.values.uWeight,1-y),L.update(i.values.tColor,o.texture),i.update(),y===0?l.disable(c.BLEND):l.enable(c.BLEND),i.render()),n||(l.disable(c.BLEND),this.colorTarget.bind(),this.copyRenderable.values.tColor.ref.value!==this.multiSampleAccumulateTarget.texture&&(L.update(this.copyRenderable.values.tColor,this.multiSampleAccumulateTarget.texture),this.copyRenderable.update()),this.copyRenderable.render()),r.viewOffset.enabled=!1,r.update(),$y&&s.timer.markEnd(`IlluminationPass.renderMultiSample`)}render(e,t,n){this._supported&&(t.multiSample.mode===`on`?this.renderMultiSample(e,t,n):this.renderInternal(e,t,n,!1))}},s3e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),tNormal:GP(`texture`,`rgba`,`ubyte`,`nearest`),tShaded:GP(`texture`,`rgba`,`ubyte`,`nearest`),tTransparentColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),dBlendTransparency:qP(`boolean`),tSsaoDepth:GP(`texture`,`rgba`,`ubyte`,`nearest`),tSsaoDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepthOpaque:GP(`texture`,`rgba`,`ubyte`,`nearest`),tDepthTransparent:GP(`texture`,`rgba`,`ubyte`,`nearest`),tOutlines:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),dDenoise:qP(`boolean`),uDenoiseThreshold:J(`f`),dOrthographic:qP(`number`),uNear:J(`f`),uFar:J(`f`),uFogNear:J(`f`),uFogFar:J(`f`),uFogColor:J(`v3`),uOutlineColor:J(`v3`),uOcclusionColor:J(`v3`),uTransparentBackground:J(`b`),dOcclusionEnable:qP(`boolean`),dOutlineEnable:qP(`boolean`),dOutlineScale:qP(`number`),dTransparentOutline:qP(`boolean`)},c3e=fj(`compose`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tShaded;
uniform sampler2D tColor;
uniform sampler2D tNormal;
uniform sampler2D tTransparentColor;
uniform sampler2D tSsaoDepth;
uniform sampler2D tSsaoDepthTransparent;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;

uniform float uDenoiseThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #if defined(dTransparentOutline) || defined(dOcclusionEnable)
        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

float getSsaoTransparent(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

//

// TODO: investigate
// https://interplayoflight.wordpress.com/2022/03/26/raytraced-global-illumination-denoising/

//

#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI
#define INV_PI 0.31830988618379067153776752674503

// https://github.com/BrutPitt/glslSmartDeNoise
//
//  smartDeNoise - parameters
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
//  sampler2D tex     - sampler image / texture
//  vec2 uv           - actual fragment coord
//  float sigma  >  0 - sigma Standard Deviation
//  float kSigma >= 0 - sigma coefficient
//      kSigma * sigma  -->  radius of the circular kernel
//  float threshold   - edge sharpening threshold

float NormalWeightStrength = 6.0;

vec4 smartDeNoise(sampler2D tex, vec2 uv) {
    float sigma = 3.0;
    float kSigma = 2.0;
    float threshold = uDenoiseThreshold;

    vec4 centrPx = texture2D(tex, uv);
    if (threshold == 0.0) return centrPx;

    float invSigmaQx2 = 0.5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)
    float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)

    float invThresholdSqx2 = 0.5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)
    float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)

    float zBuff = 0.0;
    vec4 aBuff = vec4(0.0);

    vec3 normal = texture2D(tNormal, uv).xyz;

    for (int x = -6; x <= 6; ++x) {
        for (int y = -6; y <= 6; ++y) {
            vec2 d = vec2(float(x), float(y));

            float blurFactor = exp(-dot(d , d) * invSigmaQx2) * invSigmaQx2PI;
            vec2 uvSample = uv + d / uTexSize;

            vec3 normalSample = texture2D(tNormal, uvSample).xyz;
            float normalW = saturate(dot(normal, normalSample));
            normalW = pow(normalW, NormalWeightStrength);
            blurFactor *= normalW;

            vec4 walkPx = texture2D(tex, uvSample);

            vec4 dC = walkPx - centrPx;
            float deltaFactor = exp(-dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;

            zBuff += deltaFactor;
            aBuff += deltaFactor * walkPx;
        }
    }

    if (zBuff <= EPSILON) {
        return centrPx;
    }

    return aBuff / zBuff;
}

int squaredOutlineScale = dOutlineScale * dOutlineScale;
void getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {
    vec2 invTexSize = 1.0 / uTexSize;
    
    hasOpaque = false;
    hasTransparent = false;
    opaqueDepth = 1.0;
    transparentDepth = 1.0;
    alpha = 0.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > squaredOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);
            float sampleTransparentDepth = sampleOutlineCombined.a;
            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);

            float sampleFlag = sampleFlagWithAlpha.x;
            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);
            
            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both
                if (sampleOpaqueDepth < opaqueDepth) {
                    hasOpaque = true;
                    opaqueDepth = sampleOpaqueDepth;
                }
            }
            
            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both
                hasTransparent = true;
                transparentDepth = sampleTransparentDepth;
                alpha = sampleAlpha;
            }
        }
    }
}

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    #ifdef dDenoise
        vec4 color = smartDeNoise(tColor, coords);
    #else
        vec4 color = texture2D(tColor, coords);
    #endif

    float opaqueDepth = getDepthOpaque(coords);
    float backgroundViewZ = 2.0 * uFar;
    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(opaqueSelfViewZ));
    float fogAlpha = 1.0 - fogFactor;

    float transparentDepth = 1.0;
    #ifdef dBlendTransparency
        bool blendTransparency = true;
        vec4 transparentColor = texture2D(tTransparentColor, coords);

        transparentDepth = getDepthTransparent(coords);
    #endif

    float alpha = 1.0;
    if (!uTransparentBackground) {
        // mix opaque objects with background color
        color.rgb = mix(color.rgb, uFogColor, fogFactor);
    } else {
        // pre-multiplied alpha expected for transparent background
        alpha = fogAlpha;
        color.rgb *= fogAlpha;
    }

    #if defined(dOcclusionEnable)
        if (!isBackground(opaqueDepth)) {
            float occlusionFactor = getSsao(coords);

            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
        #ifdef dBlendTransparency
            if (!isBackground(transparentDepth)) {
                float viewDist = abs(getViewZ(transparentDepth));
                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                float occlusionFactor = getSsaoTransparent(coords);
                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);
            }
        #endif
    #endif

    #ifdef dOutlineEnable
        bool hasOpaque;
        bool hasTransparent;
        float outlineOpaqueDepth;
        float outlineTransparentDepth;
        float outlineAlpha;
        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);

        if (hasOpaque) {
            float viewDist = abs(getViewZ(outlineOpaqueDepth));
            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {                    
                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                alpha = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);
            }
        }  

        #ifdef dBlendTransparency            
            if (hasTransparent) {
                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {
                    blendTransparency = false;
                } else {
                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);
                    float viewDist = abs(getViewZ(outlineTransparentDepth));
                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));
                    transparentColor.a = finalAlpha;
                    transparentColor.rgb = uOutlineColor * finalAlpha;
                }
            }
        #endif
    #endif

    #ifdef dBlendTransparency
        if (blendTransparency) {
            if (transparentColor.a != 0.0) {
                // blending
                color = transparentColor + color * (1.0 - transparentColor.a);
                alpha = transparentColor.a + alpha * (1.0 - transparentColor.a);
            }
        }
    #endif

    gl_FragColor = vec4(color.rgb, alpha);
}
`);function l3e(e,t,n,r,i,a,o,s,c,l,u){let d={...vF,tColor:L.create(t),tNormal:L.create(n),tShaded:L.create(r),tTransparentColor:L.create(s),dBlendTransparency:L.create(!0),tSsaoDepth:L.create(c),tSsaoDepthTransparent:L.create(l),tDepthOpaque:L.create(i),tDepthTransparent:L.create(a),tOutlines:L.create(o),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),dDenoise:L.create(!0),uDenoiseThreshold:L.create(.1),dOrthographic:L.create(0),uNear:L.create(1),uFar:L.create(1e4),uFogNear:L.create(1e4),uFogFar:L.create(1e4),uFogColor:L.create(B.create(1,1,1)),uOutlineColor:L.create(B.create(0,0,0)),uOcclusionColor:L.create(B.create(0,0,0)),uTransparentBackground:L.create(!1),dOcclusionEnable:L.create(!1),dOutlineEnable:L.create(!1),dOutlineScale:L.create(1),dTransparentOutline:L.create(u)};return hF(aF(e,`triangles`,c3e,{...s3e},d),d)}var u3e={..._F,tColor:GP(`texture`,`rgba`,`ubyte`,`nearest`),uTexSize:J(`v2`),uWeight:J(`f`)},d3e=fj(`compose`,tF,e4e);function f3e(e,t){let n={...vF,tColor:L.create(t),uTexSize:L.create(R.create(t.getWidth(),t.getHeight())),uWeight:L.create(1)};return hF(aF(e,`triangles`,d3e,{...u3e},n),n)}var p3e=class e{static ensureRequired(t,n,r){let i=new e(t,n);i.updateRequired(r),i.finalizeRequired(!0)}constructor(e,t){this.webgl=e,this.scene=t,this.required=[]}updateRequired(e){this.required.length=0,this.required.push(`color`),R0.isEnabled(this.webgl,e.illumination)&&this.required.push(`tracing`),N0.isEnabled(e.marking)&&this.scene.markerAverage>0&&this.required.push(`marking`),y0.isEnabled(e.postprocessing)&&this.scene.emissiveAverage>0&&this.required.push(`emissive`),(E0.isTransparentDepthRequired(this.scene,e.postprocessing)||!this.webgl.extensions.drawBuffers||!this.webgl.extensions.depthTexture||R0.isEnabled(this.webgl,e.illumination))&&this.required.push(`depth`),this.webgl.resources.linkPrograms(this.required)}finalizeRequired(e){return this.finalize(this.required,e)}finalize(e,t){return this.webgl.resources.finalizePrograms(e,t)}};const m3e={transparentBackground:V.Boolean(!1),dpoitIterations:V.Numeric(2,{min:1,max:10,step:1}),multiSample:V.Group(i4e),postprocessing:V.Group(T0),marking:V.Group(j4e),illumination:V.Group(o3e),cameraHelper:V.Group(F0),renderer:V.Group(Q1)};var h3e=class{get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}constructor(e,t,n,r,i,a,o){this.webgl=e,this.renderer=n,this.scene=r,this.camera=i,this._width=0,this._height=0,this._camera=new l0,this.props={...V.getDefaultValues(m3e),...o},this.drawPass=new R4e(e,t,128,128,r.transparency),this.illuminationPass=new R0(e,this.drawPass),this.multiSamplePass=new O0(e,this.drawPass),this.multiSampleHelper=new a4e(this.multiSamplePass),this.helper={camera:new B4e(e,this.props.cameraHelper),debug:a.debug,handle:a.handle,pointer:a.pointer},this.setSize(1024,768)}getByteCount(){return this.drawPass.getByteCount()+this.illuminationPass.getByteCount()+this.multiSamplePass.getByteCount()}updateBackground(){return new Promise(e=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{e()})})}setSize(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.drawPass.setSize(e,t),this.illuminationPass.setSize(e,t),this.multiSamplePass.syncSize())}setProps(e={}){Object.assign(this.props,e),e.cameraHelper&&this.helper.camera.setProps(e.cameraHelper)}async render(e){this.drawPass.setTransparency(this.scene.transparency),p3e.ensureRequired(this.webgl,this.scene,this.props),l0.copySnapshot(this._camera.state,this.camera.state),V1.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();let t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};if(this.illuminationPass.supported&&this.props.illumination.enabled){for(await e.update({message:`Tracing...`,current:1,max:this.illuminationPass.getMaxIterations(this.props.illumination)}),this.illuminationPass.restart(!0);this.illuminationPass.shouldRender(this.props.illumination);)$y&&this.webgl.timer.mark(`ImagePass.render`,{captureStats:!0}),this.illuminationPass.render(t,this.props,!1),$y&&this.webgl.timer.markEnd(`ImagePass.render`),e.shouldUpdate&&await e.update({current:this.illuminationPass.iteration}),await this.webgl.waitForGpuCommandsComplete();this._colorTarget=this.illuminationPass.colorTarget}else $y&&this.webgl.timer.mark(`ImagePass.render`,{captureStats:!0}),O0.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing)),$y&&this.webgl.timer.markEnd(`ImagePass.render`);if($y){let e=this.webgl.timer.resolve();if(e)for(let t of e)Aj([t])}Qy&&console.log(`image pass byte count ${(this.getByteCount()/1024/1024).toFixed(3)} MiB`)}async getImageData(e,t,n,r){this.setSize(t,n),await this.render(e),this.colorTarget.bind();let i=r?.width??t,a=r?.height??n,o=new Uint8Array(i*a*4);r?this.webgl.readPixels(r.x,n-r.y-r.height,i,a,o):this.webgl.readPixels(0,0,i,a,o);let s=P0.create(o,i,a);return P0.flipY(s),P0.divideByAlpha(s),new ImageData(new Uint8ClampedArray(o),i,a)}},g3e={...HM.Params,alpha:{...HM.Params.alpha,defaultValue:1},ignoreLight:{...HM.Params.ignoreLight,defaultValue:!0},colorX:V.Color(gk.red,{isEssential:!0}),colorY:V.Color(gk.green,{isEssential:!0}),colorZ:V.Color(gk.blue,{isEssential:!0}),scale:V.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})};const _3e={handle:V.MappedStatic(`off`,{on:V.Group(g3e),off:V.Group({})},{cycle:!0,description:`Show handle tool`})};var v3e=class{getBoundingSphere(e,t){return this.renderObject&&(q.copy(e,this.renderObject.values.invariantBoundingSphere.ref.value),z.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,t*16),q.transform(e,e,this._transform)),e}setProps(e){this.props=vD(this.props,t=>{e.handle!==void 0&&(t.handle.name=e.handle.name,e.handle.name===`on`&&(this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio,this.renderObject=C3e({...e.handle.params,scale:e.handle.params.scale*this.webgl.pixelRatio,cellSize:0}),this.scene.add(this.renderObject),this.scene.commit(),t.handle.params={...e.handle.params}))})}get isEnabled(){return this.props.handle.name===`on`}update(e,t,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),z.setTranslation(this.renderObject.values.aTransform.ref.value,t),z.fromMat3(this.renderObject.values.aTransform.ref.value,n),L.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(e){let{objectId:t,groupId:n,instanceId:r}=e;return!this.renderObject||t!==this.renderObject.id?hq:b3e(this,n,r)}mark(e,t){return!uq.is(uq.Highlighting,t)||!mq(e)&&(!x3e(e)||e.data!==this)?!1:Zq.mark(this.renderObject,e,t,this.eachGroup)}constructor(e,t={}){this.webgl=e,this.props={handle:{name:`off`,params:{}}},this.pixelRatio=1,this._transform=z(),this.eachGroup=(e,t)=>{if(!this.renderObject||!x3e(e))return!1;let n=!1,r=this.renderObject.values.uGroupCount.ref.value,{elements:i}=e;for(let{groupId:e,instanceId:a}of i){let i=a*r+e;t(G.ofSingleton(i))&&(n=!0)}return n},this.scene=c0.create(e,`blended`),this.setProps(t)}};function y3e(e,t){let n=YN.createState(512,256,t),r=.05*e,i=B.scale(B(),B.unitX,e),a=B.scale(B(),B.unitY,e),o=B.scale(B(),B.unitZ,e),s={radiusTop:r,radiusBottom:r,radialSegments:32};return n.currentGroup=z0.TranslateScreenXY,oN(n,B.origin,r*3,2),n.currentGroup=z0.TranslateObjectX,oN(n,i,r,2),PN(n,B.origin,i,1,s),n.currentGroup=z0.TranslateObjectY,oN(n,a,r,2),PN(n,B.origin,a,1,s),n.currentGroup=z0.TranslateObjectZ,oN(n,o,r,2),PN(n,B.origin,o,1,s),YN.getMesh(n)}const z0={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function b3e(e,t,n){return vq(`handle`,e,[{groupId:t,instanceId:n}],t=>e.getBoundingSphere(t,n),()=>`Handle Helper | Group Id ${t} | Instance Id ${n}`)}function x3e(e){return e.kind===`data-loci`&&e.tag===`handle`}function S3e(e,t){let n=10*e.scale,r=y3e(n,t?.geometry);return r.setBoundingSphere(q.create(B.create(n/2,n/2,n/2),n+n/4)),jF.create(`handle`,{},r,t=>{switch(t){case z0.TranslateObjectX:return e.colorX;case z0.TranslateObjectY:return e.colorY;case z0.TranslateObjectZ:return e.colorZ;default:return gk.grey}},()=>1,()=>``)}function C3e(e){let t=S3e(e);return jF.createRenderObject(t,e)}const B0={...HM.Params,enabled:V.Select(`off`,V.arrayToOptions([`on`,`off`]),{isEssential:!0}),ignoreLight:{...HM.Params.ignoreLight,defaultValue:!0},color:V.Color(gk.grey,{isEssential:!0}),hitColor:V.Color(gk.pink,{isEssential:!0})};var w3e=class{setProps(e){Object.assign(this.props,e),this.isEnabled&&this.update(this.pointers,this.points,this.hit)}ensureEnabled(){this.props.enabled!==`on`&&(this.props.enabled=`on`)}get isEnabled(){return this.props.enabled===`on`}setCamera(e){l0.copySnapshot(this.camera.state,e.state),V1.copy(this.camera.viewport,e.viewport),z.copy(this.camera.view,e.view),z.copy(this.camera.projection,e.projection),z.copy(this.camera.projectionView,e.projectionView),z.copy(this.camera.headRotation,e.headRotation),l0.copyViewOffset(this.camera.viewOffset,e.viewOffset),this.camera.far=e.far,this.camera.near=e.near,this.camera.fogFar=e.fogFar,this.camera.fogNear=e.fogNear,this.camera.forceFull=e.forceFull,this.camera.scale=1,this.modelScale=e.scale}update(e,t,n){if(this.pointers=e,this.points=t,this.hit=n,this.props.enabled!==`on`){this.renderObject&&(this.renderObject.state.visible=!1);return}this.shape=D3e(this.getData(),this.props,this.shape),L.updateIfChanged(this.renderObject.values.drawCount,wF.getDrawCount(this.shape.geometry)),L.updateIfChanged(this.renderObject.values.uVertexCount,wF.getVertexCount(this.shape.geometry)),L.updateIfChanged(this.renderObject.values.uGroupCount,2),HM.Utils.updateBoundingSphere(this.renderObject.values,this.shape.geometry),HM.Utils.updateValues(this.renderObject.values,this.props),HM.Utils.updateRenderableState(this.renderObject.state,this.props),this.renderObject.state.visible=!0,this.scene.update(void 0,!1),this.scene.commit()}getData(){return{pointers:this.pointers,points:this.points,hit:this.hit,modelScale:this.modelScale,camera:this.camera,pixels:12}}constructor(e,t={}){this.pixelScale=1,this.modelScale=1,this.pointers=[],this.points=[],this.hit=void 0,this.scene=c0.create(e,`blended`),this.props={...V.getDefaultValues(B0),...t},this.camera=new l0,this.shape=D3e(this.getData(),this.props,this.shape),this.renderObject=O3e(this.shape,this.props),this.scene.add(this.renderObject)}},V0;(function(e){e[e.None=0]=`None`,e[e.Hit=1]=`Hit`})(V0||={});var T3e=B();function H0(e,t,n,r){let i=B.scale(T3e,n.state.position,r),a=B.distance(e,i);return 2*Math.tan(n.state.fov/2)*a/n.viewport.height*t}function E3e(e,t){let n=YN.createState(512,256,t),r=5e-4,i={radiusTop:r,radiusBottom:r,radialSegments:32},{modelScale:a,camera:o,pixels:s}=e;n.currentGroup=V0.None;for(let t of e.pointers){dTe(n,t,.2,i);let e=H0(t.origin,s,o,a);oN(n,t.origin,e,1)}for(let t of e.points)oN(n,t,H0(t,s,o,a),1);if(e.hit){n.currentGroup=V0.Hit;let t=H0(e.hit,s,o,a);oN(n,e.hit,t,1)}return YN.getMesh(n)}function D3e(e,t,n){let r=E3e(e,n?.geometry);return jF.create(`pointer-mesh`,e,r,e=>{switch(e){case V0.Hit:return t.hitColor;default:return t.color}},()=>1,()=>``,void 0,2)}function O3e(e,t){return jF.createRenderObject(e,{...V.getDefaultValues(HM.Params),...t,ignoreLight:t.ignoreLight,cellSize:0})}const k3e={debug:V.Group(f0),camera:V.Group({helper:V.Group(F0)}),handle:V.Group(_3e),pointer:V.Group(B0)},A3e=V.getDefaultValues(k3e);var j3e=class{constructor(e,t,n={}){let r={...A3e,...n};this.debug=new x0e(e,t,r.debug),this.camera=new B4e(e,r.camera.helper),this.handle=new v3e(e,r.handle),this.pointer=new w3e(e,r.pointer)}},M3e=class{constructor(e,t,n={}){this.webgl=e;let r=this.webgl.getDrawingBufferSize();this.draw=new R4e(e,t,r.width,r.height,n.transparency||`blended`),this.pick=new s4e(e,r.width,r.height,n.pickScale||.25),this.multiSample=new O0(e,this.draw),this.illumination=new R0(e,this.draw)}getByteCount(){return this.draw.getByteCount()+this.pick.getByteCount()+this.multiSample.getByteCount()+this.illumination.getByteCount()}setPickScale(e){this.pick.setPickScale(e)}setTransparency(e){this.draw.setTransparency(e)}updateSize(){let e=this.webgl.getDrawingBufferSize(),t=Math.max(e.width,2),n=Math.max(e.height,2);this.draw.setSize(t,n),this.pick.setSize(t,n),this.multiSample.syncSize(),this.illumination.setSize(t,n)}},N3e={..._F,tPreviousLevel:GP(`texture`,`alpha`,`float`,`nearest`),uInvSize:J(`v2`),uOffset:J(`v2`)},P3e=fj(`hi-z`,tF,`
precision highp float;
precision highp sampler2D;

uniform sampler2D tPreviousLevel;
uniform vec2 uInvSize;
uniform vec2 uOffset;

void main(void) {
    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;

    float x = texture(tPreviousLevel, position).r;
    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;
    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;
    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;

    gl_FragColor = vec4(max(max(x, y), max(z, w)));
}
`);function F3e(e,t){let n={...vF,tPreviousLevel:L.create(t),uInvSize:L.create(R()),uOffset:L.create(R())};return hF(aF(e,`triangles`,P3e,{...N3e},n),n)}var I3e=new ArrayBuffer(4);new Int32Array(I3e),new Float32Array(I3e);var L3e=new ArrayBuffer(4),R3e=new Int32Array(L3e),z3e=new Float32Array(L3e);function B3e(e){return R3e[0]=(1<<23)*((e<-126?-126:e)+126.94269504),z3e[0]}function V3e(e){return B3e(1.44269504*e)}var H3e=new ArrayBuffer(8);new Int32Array(H3e),new Float32Array(H3e);var U3e=new ArrayBuffer(4),W3e=new Int32Array(U3e),G3e=new Float32Array(U3e);function K3e(e){return G3e[0]=e,W3e[0]*1.1920928955078125e-7-126.94269504}Math.PI/2,2*Math.PI,1/(2*Math.PI),2/Math.PI,4/Math.PI,4/(Math.PI*Math.PI),Math.PI/2-2*Math.PI;var q3e=new ArrayBuffer(16);new Int32Array(q3e),new Float32Array(q3e);var J3e=new ArrayBuffer(8);new Int32Array(J3e),new Float32Array(J3e);var Y3e=new ArrayBuffer(4);new Int32Array(Y3e),new Float32Array(Y3e),Math.PI/4;var X3e=B.transformMat4,Z3e=AO.set,Q3e=K3e;function $3e(e,t,n){return t*n/((n-t)*e-n)}function e6e(e,t,n){return e*(t-n)-t}function U0(e,t,n,r){return r[11]===-1?$3e(e,t,n):e6e(e,t,n)}function t6e(e,t,n,r){let i=t[0]*n,a=t[1]*n,o=t[2]*n,s=t[2]*t[2]-n*n,c=Math.sqrt(t[0]*t[0]+s),l=(c*t[0]-o)/(c*t[2]+i)*r[0],u=(c*t[0]+o)/(c*t[2]-i)*r[0],d=Math.sqrt(t[1]*t[1]+s),f=(d*t[1]-o)/(d*t[2]+a)*r[5],p=(d*t[1]+o)/(d*t[2]-a)*r[5];return Z3e(e,u*-.5+.5,f*.5+.5,l*-.5+.5,p*.5+.5)}function n6e(e,t,n,r){let i=r[0],a=r[5],o=(t[0]+n)*i,s=(t[0]-n)*i,c=(t[1]+n)*a,l=(t[1]-n)*a;return Z3e(e,s*.5+.5,c*-.5+.5,o*.5+.5,l*-.5+.5)}function r6e(e,t,n,r){return r[11]===-1?t6e(e,t,n,r):n6e(e,t,n,r)}const i6e={enabled:V.Boolean(!1,{description:`Hierarchical Z-buffer occlusion culling. Only available for WebGL2.`}),maxFrameLag:V.Numeric(10,{min:1,max:30,step:1},{description:`Maximum number of frames to wait for Z-buffer data.`}),minLevel:V.Numeric(3,{min:1,max:10,step:1})};var a6e=class{getByteCount(){return this.supported?this.tex.getByteCount()+this.buf.getByteCount()+this.levelData.reduce((e,t)=>e+t.texture.getByteCount(),0):0}clear(){if(!this.supported)return;let{gl:e}=this.webgl;Bj(e)&&(this.sync!==null&&(e.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display=`none`,this.debug.container.style.display=`none`))}render(e){if(!this.supported||!this.props.enabled)return;let{gl:t,state:n}=this.webgl;if(!Bj(t)||this.sync!==null)return;this.nextNear=e.near,this.nextFar=e.far,z.copy(this.nextView,e.view),z.copy(this.nextProjection,e.projection),$y&&this.webgl.timer.mark(`hi-Z`),n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0);let r=this.renderable.values,i=2**(Math.ceil(Math.log(Math.max(t.drawingBufferWidth,t.drawingBufferHeight))/Math.log(2))-1);for(let e=0,a=this.levelData.length;e<a;++e){let a=this.levelData[e];a.framebuffer.bind(),e>0?(L.update(r.uInvSize,a.invSize),L.update(r.uOffset,R.set(r.uOffset.ref.value,0,0)),L.update(r.tPreviousLevel,this.levelData[e-1].texture)):(L.update(r.uInvSize,R.set(r.uInvSize.ref.value,1/i,1/i)),L.update(r.uOffset,R.set(r.uOffset.ref.value,this.viewport.x/t.drawingBufferWidth,this.viewport.y/t.drawingBufferHeight)),L.update(r.tPreviousLevel,this.drawPass.depthTextureOpaque)),n.currentRenderItemId=-1,n.viewport(0,0,a.size[0],a.size[1]),t.clear(t.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),e>=this.props.minLevel&&(this.tex.bind(0),t.copyTexSubImage2D(t.TEXTURE_2D,0,a.offset,0,0,0,a.size[0],a.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);let a=this.tex.getWidth(),o=this.tex.getHeight();this.buf.read(0,0,a,o),this.sync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),t.flush(),$y&&this.webgl.timer.markEnd(`hi-Z`)}tick(){if(!this.supported||!this.props.enabled||this.sync===null)return;let{gl:e}=this.webgl;if(!Bj(e))return;let t=e.clientWaitSync(this.sync,0,0);t===e.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(e.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):t===e.TIMEOUT_EXPIRED?this.frameLag+=1:(this.buf.getSubData(this.buffer),e.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,z.copy(this.view,this.nextView),z.copy(this.projection,this.nextProjection))}transform(e){let{view:t,vp:n}=this;return X3e(n,e.center,t),{vp:n,r:e.radius*1.2+1.52}}project(e,t){let{projection:n,aabb:r,viewport:i}=this;r6e(r,e,t,n);let a=r[2]-r[0],o=r[3]-r[1],s=Math.max(a*i.width,o*i.height);return{aabb:r,w:a,h:o,pr:s,lod:Math.ceil(Q3e(s/2))}}setViewport(e,t,n,r){if(!this.supported)return;n=Math.max(n,2),r=Math.max(r,2),V1.set(this.viewport,e,t,n,r);let i=Math.ceil(Math.log(Math.max(n,r))/Math.log(2));if(i===this.levelData.length)return;let{minLevel:a}=this.props;this.buffer=new Float32Array(2**(i-a)*2**(i-1-a)),this.tex.define(2**(i-a),2**(i-1-a));for(let e of this.levelData)e.framebuffer.destroy(),e.texture.destroy();this.levelData.length=0;for(let e=0;e<i;++e){let t=this.webgl.resources.framebuffer(),n=2**(i-e-1),r=R.create(n,n),a=R.create(1/n,1/n),o=this.webgl.resources.texture(`image-float32`,`alpha`,`float`,`nearest`);o.define(n,n),o.attachFramebuffer(t,0),this.levelData.push({texture:o,framebuffer:t,size:r,invSize:a,offset:0})}let o=0;for(let e=0,t=i;e<t;++e){let t=this.levelData[e];e>=a&&(this.levelData[e].offset=o,o+=t.size[0])}this.clear()}setProps(e){if(this.supported)if(this.props.minLevel!==e.minLevel){Object.assign(this.props,e);let{x:t,y:n,width:r,height:i}=this.viewport;this.setViewport(t,n,r,i)}else Object.assign(this.props,e),this.props.enabled||this.clear()}initDebug(e){if(!e.parentElement)return;let t=document.createElement(`div`);Object.assign(t.style,{display:`block`,position:`absolute`,pointerEvents:`none`}),e.parentElement.appendChild(t);let n=document.createElement(`canvas`),r=n.getContext(`2d`);if(!r)throw Error(`Could not create canvas 2d context`);Object.assign(n.style,{width:`100%`,height:`100%`,imageRendering:`pixelated`,position:`relative`,pointerEvents:`none`}),t.appendChild(n);let i=document.createElement(`div`);Object.assign(i.style,{display:`none`,position:`absolute`,pointerEvents:`none`}),e.parentElement.appendChild(i),this.debug={container:t,canvas:n,ctx:r,rect:i}}canDebug(e){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(e,t){if(!this.canDebug(this.debug))return;let{gl:{drawingBufferHeight:n},pixelRatio:r}=this.webgl,{viewport:{x:i,y:a,width:o,height:s}}=this,c=(e[0]*o+i)/r,l=(e[1]*s-a)/r,u=(e[2]*o+i)/r,d=(e[3]*s-a)/r,f=(n-s)/r;Object.assign(this.debug.rect.style,{border:t?`solid red`:`solid green`,display:`block`,left:`${c}px`,top:`${l+f}px`,width:`${u-c}px`,height:`${d-l}px`})}showBuffer(e){if(!this.canDebug(this.debug))return;if(e>=this.levelData.length||e<this.props.minLevel){this.debug.container.style.display=`none`;return}let{offset:t,size:[n,r]}=this.levelData[e],i=this.tex.getWidth(),a=new Uint8ClampedArray(n*r*4);a.fill(255);for(let e=0;e<r;++e)for(let o=0;o<n;++o){let s=(r-e-1)*n+o,c=this.buffer[e*i+o+t]*255;a[s*4+0]=c,a[s*4+3]=255-c}let o=new ImageData(a,n,r);this.debug.canvas.width=o.width,this.debug.canvas.height=o.height,this.debug.ctx.putImageData(o,0,0);let{viewport:{x:s,y:c,width:l,height:u},webgl:{pixelRatio:d}}=this;Object.assign(this.debug.container.style,{display:`block`,bottom:`${c/d}px`,left:`${s/d}px`,width:`${l/d}px`,height:`${u/d}px`})}debugOcclusion(e){if(!this.canDebug(this.debug))return;if(!e){this.debug.rect.style.display=`none`,this.debug.container.style.display=`none`;return}let t=this.isOccluded(e),{vp:n,r}=this.transform(e),{aabb:i,lod:a}=this.project(n,r);this.showRect(i,t),this.showBuffer(a)}reset(){this.sync=null,this.ready=!1,this.frameLag=0,this.levelData.length=0;let{x:e,y:t,width:n,height:r}=this.viewport;this.setViewport(e,t,n,r)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.buf.destroy(),this.renderable.dispose();for(let e of this.levelData)e.framebuffer.destroy(),e.texture.destroy()}}constructor(e,t,n,r){this.webgl=e,this.drawPass=t,this.viewport=V1(),this.near=0,this.far=0,this.view=z(),this.projection=z(),this.nextNear=0,this.nextFar=0,this.nextView=z(),this.nextProjection=z(),this.aabb=AO(),this.vp=B(),this.levelData=[],this.sync=null,this.buffer=new Float32Array,this.frameLag=0,this.ready=!1,this.isOccluded=e=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;let{vp:t,r:n}=this.transform(e),{near:r,far:i,projection:a}=this,o=t[2]+n;if(-o<r)return!1;let{aabb:s,w:c,h:l,lod:u}=this.project(t,n);if(u>=this.levelData.length||u<this.props.minLevel)return!1;let{offset:d,size:f}=this.levelData[u],p=s[0]+c/2,m=s[1]+l/2,h=f[0],g=p*h,_=m*h,v=Math.floor(g),y=Math.ceil(_),b=this.tex.getWidth();if(v+1>=h||y+1>=h)return!1;let x=(h-y-1)*b+v+d;if(o>U0(this.buffer[x],r,i,a)||o>U0(this.buffer[x+1],r,i,a))return!1;let S=(h-y+1-1)*b+v+d;return!(o>U0(this.buffer[S],r,i,a)||o>U0(this.buffer[S+1],r,i,a))},this.props={...V.getDefaultValues(i6e),...r};let{gl:i,extensions:a}=e;if(!Bj(i)||!a.colorBufferFloat){Qy&&console.log(`Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"`),this.supported=!1;return}this.fb=e.resources.framebuffer(),this.tex=e.resources.texture(`image-float32`,`alpha`,`float`,`nearest`),this.tex.attachFramebuffer(this.fb,0);let o=i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT),s=i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE);if(o!==i.RED||s!==i.FLOAT){Qy&&console.log(`Missing red/float reading support required for "Hi-Z"`),this.supported=!1;return}this.supported=!0,this.buf=e.resources.pixelPack(`alpha`,`float`),this.renderable=F3e(e,this.drawPass.depthTextureOpaque),Qy&&n&&this.initDebug(n)}},o6e=J1,s6e=t0.Trigger,c6e=t0.TriggerKey;function l6e(e){let t=z.getDecomposition(e);return new XRRigidTransform(B.toObj(t.position),MT.toObj(t.quaternion))}function u6e(e,t){let n=B.fromObj(e.transform.position),r=z.fromArray(z(),e.transform.matrix,0),i=z.getDecomposition(r),a=z.fromQuat(z(),i.quaternion),o=B.transformMat4(B(),B.negUnitZ,a),s=vA.create(n,o);return t&&vA.transform(s,s,z.invert(z(),t)),s}const d6e={bindings:{exit:t0([c6e(`GamepadB`)]),togglePassthrough:t0([c6e(`GamepadA`)]),gestureScale:t0([s6e(o6e.Flag.Trigger)])}},f6e={minTargetDistance:V.Numeric(.4,{min:.001,max:1,step:.001}),disablePostprocessing:V.Boolean(!0),resolutionScale:V.Numeric(1,{min:.1,max:2,step:.1}),sceneRadiusInMeters:V.Numeric(.25,{min:.01,max:2,step:.01},{description:`The radius of the scene bounding sphere in meters, used to set the initial camera scale.`})};var p6e=class{get session(){return this.xrSession}setProps(e){Object.assign(this.props,e)}setAttribs(e){Object.assign(this.attribs,e)}intersect(e,t,n,r){let i=B(),a=u6e(r,t);if(sF.intersectRay3D(i,n,a)){let{height:t}=e.viewport,n=J1e(AO(),i,e.viewport,e.projectionView);return{point:i,screen:R.create(Math.floor(n[0]),t-Math.floor(n[1]))}}}setScaleFactor(e){this.scaleFactor=e}resetScale(){this.scaleFactor=1,this.prevScale=0}update(e){let{xrSession:t,xrRefSpace:n,input:r,camera:i,stereoCamera:a,pointerHelper:o}=this;if(!e||!t||!n)return!1;i.scale*=this.scaleFactor,this.prevScale=i.scale;let s=B.sub(B(),i.position,i.target);B.scaleAndAdd(i.position,i.position,s,1-this.scaleFactor),this.scaleFactor=1;let c=l6e(i.view),l=n.getOffsetReferenceSpace(c),u=e.getViewerPose(l);if(!u)return!1;let d=e.getViewerPose(n);if(d){let e=MT.fromObj(d.transform.orientation);z.fromQuat(i.headRotation,e)}let{depthFar:f,depthNear:p,baseLayer:m}=t.renderState;if(!m)return!1;(f!==i.far||p!==i.near)&&t.updateRenderState({depthNear:i.near,depthFar:i.far}),a.update({pose:u,layer:m});let h=a.left,g=B.scale(B(),h.state.target,h.scale),_=z.getTranslation(B(),z.invert(z(),h.view)),v=B.sub(B(),_,g),y=sF.fromNormalAndCoplanarPoint(sF(),v,g),b=[],x=[],S=[],C=[];if(t.inputSources)for(let r of t.inputSources){if(r.targetRayMode===`screen`){if(r.gamepad){let{axes:e}=r.gamepad,{width:t,height:n}=h.viewport,i=(e[0]+1)/2*t,a=(e[1]+1)/2*n,o=h.getRay(vA(),i,n-a);C.push({x:i,y:a,ray:o})}continue}if(r.targetRayMode!==`tracked-pointer`)continue;let{handedness:t,targetRaySpace:a,gamepad:o}=r;if(!t)continue;let s=e.getPose(a,n);if(!s)continue;let c=u6e(s,i.view);b.push(c);let l=q.scaleNX(q(),this.scene.boundingSphereVisible,h.scale),u=B();vA.intersectSphere3D(u,c,l)&&x.push(u);let d=J1.create(J1.Flag.None);o?.buttons[0]?.pressed&&(d|=J1.Flag.Primary),o?.buttons[1]?.pressed&&(d|=J1.Flag.Secondary),o?.buttons[3]?.pressed&&(d|=J1.Flag.Auxilary),o?.buttons[4]?.pressed&&(d|=J1.Flag.Forth),o?.buttons[5]?.pressed&&(d|=J1.Flag.Five);let f=t===`left`?this.prevInput.left:this.prevInput.right,p=this.intersect(h,i.view,y,s),m=f?this.intersect(h,i.view,y,f.targetRayPose):void 0,[g,_]=p?.screen??[0,0],[v,w]=m?.screen??[g,_],T=R.set(R(),g-v,_-w);R.setMagnitude(T,T,Math.min(100,R.magnitude(T)));let[E,D]=R.round(T,T);S.push({handedness:t,buttons:d,x:g,y:_,dx:E,dy:D,ray:c,axes:o?.axes}),t===`left`?this.prevInput.left={targetRayPose:s}:this.prevInput.right={targetRayPose:s}}else this.prevInput.left=void 0,this.prevInput.right=void 0;return r.updateTrackedPointers(S),r.updateScreenTouches(C),o.ensureEnabled(),o.update(b,x,this.hit),!0}async setSession(e){if(this.xrSession!==e)if(await this.webgl.xr.set(e,{resolutionScale:this.props.resolutionScale}),this.xrSession=this.webgl.xr.session,this.prevInput={},this.hit=void 0,this.xrSession){this.xrRefSpace=await this.xrSession.requestReferenceSpace(`local`),this.pointerHelper.setProps({enabled:`on`});let e=this.prevScale;if(e===0){let{radius:t}=this.scene.boundingSphereVisible;e=t?1/t*this.props.sceneRadiusInMeters:.01}this.camera.forceFull=!0,this.camera.scale=e,this.camera.minTargetDistance=this.props.minTargetDistance,this.prevScale=e}else this.xrRefSpace=void 0,z.setZero(this.camera.headRotation),this.pointerHelper.setProps({enabled:`off`}),this.camera.forceFull=!1,this.camera.scale=1,this.camera.minTargetDistance=0}async end(){await this.webgl.xr.end()}async request(){if(!navigator.xr)return;let e=await navigator.xr.isSessionSupported(`immersive-ar`)?await navigator.xr.requestSession(`immersive-ar`):await navigator.xr.requestSession(`immersive-vr`);await this.setSession(e)}dispose(){var e;this.hoverSub.unsubscribe(),this.keyUpSub.unsubscribe(),this.gestureSub.unsubscribe(),this.sessionChangedSub.unsubscribe(),this.togglePassthrough.complete(),this.sessionChanged.complete(),this.isSupported.complete(),(e=navigator.xr)==null||e.removeEventListener(`devicechange`,this.checkSupported)}constructor(e,t,n,r,i,a,o,s={},c={}){var l;this.webgl=e,this.input=t,this.scene=n,this.camera=r,this.stereoCamera=i,this.pointerHelper=a,this.interactionHelper=o,this.togglePassthrough=new sD,this.sessionChanged=new sD,this.isSupported=new cD(!1),this.xrSession=void 0,this.xrRefSpace=void 0,this.scaleFactor=1,this.prevScale=0,this.prevInput={},this.hit=void 0,this.checkSupported=async()=>{if(!navigator.xr)return!1;let[e,t]=await Promise.all([navigator.xr.isSessionSupported(`immersive-ar`),navigator.xr.isSessionSupported(`immersive-vr`)]);this.isSupported.next(e||t)},this.props={...V.getDefaultValues(f6e),...s},this.attribs={...d6e,...c},this.hoverSub=this.interactionHelper.events.hover.subscribe(({position:e})=>{this.hit=e}),this.sessionChangedSub=e.xr.changed.subscribe(async()=>{await this.setSession(e.xr.session),this.sessionChanged.next()}),this.checkSupported(),(l=navigator.xr)==null||l.addEventListener(`devicechange`,this.checkSupported),this.keyUpSub=t.keyUp.subscribe(({code:e,modifiers:t,key:n})=>{let r=this.attribs.bindings;t0.matchKey(r.exit,e,t,n)&&this.end(),t0.matchKey(r.togglePassthrough,e,t,n)&&this.togglePassthrough.next()}),this.gestureSub=t.gesture.subscribe(({scale:e,button:t,modifiers:n})=>{let r=this.attribs.bindings;t0.match(r.gestureScale,t,n)&&this.setScaleFactor(e)})}},m6e=class{setPickPadding(e){this.pickPadding!==e&&(this.pickPadding=e,this.update())}update(){let e=this.pickPadding*2+1;V1.set(this.viewport,0,0,e,e),this.buffers.setViewport(0,0,e,e),this.spiral=zT(this.pickPadding),this.size=e,this.pickPass.setSize(e,e)}render(e){$y&&this.webgl.timer.mark(`RayHelper.render`,{captureStats:!0});let{renderer:t,scene:n,helper:r}=this;t.setTransparentBackground(!1),t.setDrawingBufferSize(this.size,this.size),t.setPixelRatio(1),t.setViewport(0,0,this.size,this.size),this.pickPass.render(t,e,n,r),$y&&this.webgl.timer.markEnd(`RayHelper.render`)}identifyInternal(e,t){if(this.webgl.isContextLost)return;let{viewport:n}=this,r=this.buffers.getPickingId(e,t);if(r===void 0)return;let i=this.buffers.getDepth(e,t),a=B.create(e,t,i);return U1(a,a,n,this.camera.inverseProjectionView),{id:r,position:a}}prepare(e,t){this.camera.far=t.far,this.camera.near=t.near,this.camera.fogFar=t.fogFar,this.camera.fogNear=t.fogNear,this.camera.forceFull=t.forceFull,this.camera.scale=t.scale,V1.copy(this.camera.viewport,this.viewport),l0.copySnapshot(this.camera.state,{...t.state,mode:`orthographic`}),h6e(this.camera,e,t.up),z.mul(this.camera.projectionView,this.camera.projection,this.camera.view),z.tryInvert(this.camera.inverseProjectionView,this.camera.projectionView),z.copy(this.camera.viewEye,t.view)}getPickData(){let e=this.pickPadding;for(let t of this.spiral){let n=this.identifyInternal(e+t[0],e+t[1]);if(n)return n}}intersectsScene(e,t){return q.scaleNX(this.sphere,this.scene.boundingSphereVisible,t),vA.isInsideSphere3D(e,this.sphere)||vA.isIntersectingSphere3D(e,this.sphere)}identify(e,t){if(this.intersectsScene(e,t.scale))return this.prepare(e,t),$y&&this.webgl.timer.mark(`RayHelper.identify`),this.render(this.camera),this.buffers.read(),$y&&this.webgl.timer.markEnd(`RayHelper.identify`),this.getPickData()}asyncIdentify(e,t){if(this.intersectsScene(e,t.scale))return this.prepare(e,t),$y&&this.webgl.timer.mark(`RayHelper.asyncIdentify`),this.render(this.camera),this.buffers.asyncRead(),$y&&this.webgl.timer.markEnd(`RayHelper.asyncIdentify`),{tryGet:()=>{let e=this.buffers.check();if(e===A0.Resolved)return this.getPickData();if(e===A0.Pending)return`pending`}}}reset(){this.buffers.reset(),this.pickPass.reset()}dispose(){this.buffers.dispose(),this.pickPass.dispose()}constructor(e,t,n,r,i){this.webgl=e,this.renderer=t,this.scene=n,this.helper=r,this.viewport=V1(),this.sphere=q();let a=i.pickPadding*2+1;this.camera=new l0,this.pickPass=new s4e(e,a,a,1),this.buffers=new u4e(this.webgl,this.pickPass,i.maxAsyncReadLag),this.pickPadding=i.pickPadding,this.update(),l4e(e)||(this.asyncIdentify=(e,t)=>({tryGet:()=>this.identify(e,t)}))}};function h6e(e,t,n){let{near:r,far:i,viewport:a}=e,o=2*Math.tan(FT(.1)/2)*B.distance(e.position,e.target)*e.scale,s=a.height/o,c=-a.width/2,l=a.width/2,u=a.height/2,d=-a.height/2,f=(l-c)/(2*s),p=(u-d)/(2*s),m=(l+c)/2,h=(u+d)/2,g=m-f,_=m+f,v=h+p,y=h-p;z.ortho(e.projection,g,_,v,y,r,i);let b=B.normalize(B(),t.direction),x=MT.fromUnitVec3(MT(),b,B.negUnitZ);MT.invert(x,x);let S=B.clone(t.origin),C=B.add(B(),S,b);z.lookAt(e.view,S,C,n)}const g6e={intensity:V.Numeric(15,{min:1,max:100,step:1})},W0={camera:V.Group({mode:V.Select(`perspective`,V.arrayToOptions([`perspective`,`orthographic`]),{label:`Camera`}),helper:V.Group(F0,{isFlat:!0}),stereo:V.MappedStatic(`off`,{on:V.Group(d4e),off:V.Group({})},{cycle:!0,hideIf:e=>e?.mode!==`perspective`}),fov:V.Numeric(45,{min:10,max:130,step:1},{label:`Field of View`}),manualReset:V.Boolean(!1,{isHidden:!0})},{pivot:`mode`}),cameraFog:V.MappedStatic(`on`,{on:V.Group(g6e),off:V.Group({})},{cycle:!0,description:`Show fog in the distance`}),cameraClipping:V.Group({radius:V.Numeric(100,{min:0,max:99,step:1},{label:`Clipping`,description:`How much of the scene to show.`}),far:V.Boolean(!0,{description:`Hide scene in the distance`}),minNear:V.Numeric(1,{min:.1,max:100,step:.1},{description:`Minimal allowed distance of near clipping plane from the camera. Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0.`})},{pivot:`radius`}),viewport:V.MappedStatic(`canvas`,{canvas:V.Group({}),"static-frame":V.Group({x:V.Numeric(0),y:V.Numeric(0),width:V.Numeric(128),height:V.Numeric(128)}),"relative-frame":V.Group({x:V.Numeric(.33,{min:0,max:1,step:.01}),y:V.Numeric(.33,{min:0,max:1,step:.01}),width:V.Numeric(.5,{min:.01,max:1,step:.01}),height:V.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:V.Numeric(250,{min:0,max:1e3,step:1},{description:`The time it takes to reset the camera.`}),sceneRadiusFactor:V.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:V.Boolean(!1),dpoitIterations:V.Numeric(2,{min:1,max:10,step:1}),pickPadding:V.Numeric(3,{min:0,max:10,step:1},{description:`Extra pixels to around target to check in case target is empty.`}),userInteractionReleaseMs:V.Numeric(250,{min:0,max:1e3,step:1},{description:`The time before the user is not considered interacting anymore.`}),multiSample:V.Group(i4e),postprocessing:V.Group(T0),marking:V.Group(j4e),illumination:V.Group(o3e),hiZ:V.Group(i6e),renderer:V.Group(Q1),trackball:V.Group(c0e),interaction:V.Group(k0e),debug:V.Group(f0),handle:V.Group(_3e),pointer:V.Group(B0),xr:V.Group(f6e,{label:`XR`})},G0=V.getDefaultValues(W0),_6e={trackball:l0e,xr:d6e};var K0;(function(e){e.DefaultAttribs={powerPreference:`high-performance`,failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},e.Params={resolutionMode:V.Select(`auto`,V.arrayToOptions([`auto`,`scaled`,`native`])),pixelScale:V.Numeric(1,{min:.1,max:2,step:.05}),pickScale:V.Numeric(.25,{min:.1,max:1,step:.05}),transparency:V.Select(`wboit`,[[`blended`,`Blended`],[`wboit`,`Weighted, Blended`],[`dpoit`,`Depth Peeling`]])},e.DefaultProps=V.getDefaultValues(e.Params);function t(t,n,r={},i={}){let a={...e.DefaultAttribs,...r},o={...e.DefaultProps,...i},{powerPreference:s,failIfMajorPerformanceCaveat:c,antialias:l,preserveDrawingBuffer:u,preferWebGl1:d}=a,f=cCe(t,{powerPreference:s,failIfMajorPerformanceCaveat:c,antialias:l,preserveDrawingBuffer:u,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:d});if(f===null)throw Error(`Could not create a WebGL rendering context`);let p=()=>{let e=o.pixelScale/(typeof window<`u`&&(window==null?void 0:window.devicePixelRatio)||1);return o.resolutionMode===`auto`?FBe()?e:o.pixelScale:o.resolutionMode===`native`?o.pixelScale:e},m=()=>{let e=p();v.setPixelScale(e),y.setPixelScale(e)},{pickScale:h,transparency:g}=o,_=p(),v=$1e.fromElement(t,{pixelScale:_,preventGestures:!0}),y=gCe(f,{pixelScale:_}),b=new M3e(y,n,{pickScale:h,transparency:g});if(Qy){let e=f.getExtension(`WEBGL_lose_context`);e&&t.addEventListener(`mousedown`,t=>{y.isContextLost||!t.shiftKey||!t.ctrlKey||!t.altKey||(Qy&&console.log(`lose context`),e.loseContext(),setTimeout(()=>{y.isContextLost&&(Qy&&console.log(`restore context`),e.restoreContext())},1e3))},!1)}let x=new sD,S=e=>{y.setContextLost(),e.preventDefault(),Qy&&console.log(`context lost`),x.next(Ly())},C=()=>{y.isContextLost&&(y.handleContextRestored(()=>{b.draw.reset(),b.pick.reset(),b.illumination.reset()}),Qy&&console.log(`context restored`))};t.addEventListener(`webglcontextlost`,S,!1),t.addEventListener(`webglcontextrestored`,C,!1);let w=new cD(void 0);return{canvas:t,webgl:y,input:v,passes:b,attribs:a,get props(){return{...o}},contextLost:x,contextRestored:y.contextRestored,assetManager:n,changed:w,get pixelScale(){return p()},syncPixelScale:m,setProps:e=>{if(!e)return;let t=!1,n=!1;e.resolutionMode!==void 0&&e.resolutionMode!==o.resolutionMode&&(o.resolutionMode=e.resolutionMode,n=!0),e.pixelScale!==void 0&&e.pixelScale!==o.pixelScale&&(o.pixelScale=e.pixelScale,n=!0),n&&(m(),a.handleResize(),t=!0),e.pickScale!==void 0&&e.pickScale!==o.pickScale&&(o.pickScale=e.pickScale,b.setPickScale(e.pickScale),t=!0),e.transparency!==void 0&&e.transparency!==o.transparency&&(o.transparency=e.transparency,b.setTransparency(e.transparency),t=!0),t&&w.next(void 0)},dispose:e=>{v.dispose(),t.removeEventListener(`webglcontextlost`,S,!1),t.removeEventListener(`webglcontextrestored`,C,!1),y.destroy(e),x.complete(),w.complete()}}}e.fromCanvas=t})(K0||={});var v6e=typeof window<`u`?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),y6e=typeof window<`u`?window.cancelAnimationFrame:e=>clearImmediate(e),b6e;(function(e){function t(e,t={},n={}){let{webgl:r,input:i,passes:a,assetManager:o,canvas:s,contextLost:c}=e,l={...UT(G0),...UT(t)},u={...UT(_6e),...UT(n)},d=new Map,f=new Map,p=new cD(0),m=new sD,h=Ly(),g=new cD(0),_=new cD(0),v=new cD(0),{contextRestored:y}=r,b=0,x=0,S=128,C=128,w=!1,T=0;ct();let E=c0.create(r,a.draw.transparency,{dColorMarker:l.renderer.colorMarker,dLightCount:l.renderer.light?.length});function D(){return E.boundingSphere.radius*l.sceneRadiusFactor}let O=new l0({position:B.create(0,0,100),mode:l.camera.mode,fog:l.cameraFog.name===`on`?l.cameraFog.params.intensity:0,clipFar:l.cameraClipping.far,minNear:l.cameraClipping.minNear,fov:FT(l.camera.fov)},{x:b,y:x,width:S,height:C}),k=new j0(O,l.camera.stereo.params),A=u0e.create(i,O,E,l.trackball,u.trackball),j=new j3e(r,E,l),M=new a6e(r,a.draw,s,l.hiZ),N=r0e.create(r,l.renderer);N.setOcclusionTest(M.isOccluded);let ee=new p3e(r,E);ee.updateRequired(l);let te={pickPadding:l.pickPadding,maxAsyncReadLag:o4e.maxAsyncReadLag},P=new y4e(r,N,E,j,a.pick,{x:b,y:x,width:S,height:C},te),ne=new m6e(r,N,E,j,te),re=new A0e(Ve,He,ye,i,O,A,l.interaction),ie=new a4e(a.multiSample);a.draw.postprocessing.background.update(O,l.postprocessing.background,e=>{e&&Ae()});let ae=!1,oe,se,ce=!1;function le(){return{transparency:e.props.transparency,transparentBackground:l.transparentBackground,hiZ:M.props.enabled,postprocessing:l.postprocessing.enabled,axes:UT(j.camera.props.axes)}}let ue=le();function de(){Object.assign(ue,le())}function fe(){l.postprocessing.enabled=ue.postprocessing,l.transparentBackground=ue.transparentBackground,e.setProps({transparency:ue.transparency}),M.setProps({enabled:ue.hiZ}),j.camera.setProps({axes:ue.axes})}function pe(){l.postprocessing.enabled=!me.props.disablePostprocessing,e.setProps({transparency:`blended`}),M.setProps({enabled:!1}),j.camera.setProps({axes:{name:`off`,params:{}}}),me.session?.environmentBlendMode===`alpha-blend`&&(l.transparentBackground=ge)}let me=new p6e(r,i,E,O,k,j.pointer,re,l.xr,u.xr),he={request:async()=>{try{await me.request()}catch(e){console.error(e),he.requestFailed.next(e)}},end:()=>me.end(),isSupported:new cD(!1),isPresenting:new cD(!1),requestFailed:new sD},ge=!1,_e=[me.isSupported.subscribe(e=>he.isSupported.next(e)),me.togglePassthrough.subscribe(()=>{me.session?.environmentBlendMode===`alpha-blend`&&(ge=!l.transparentBackground)}),me.sessionChanged.subscribe(()=>{we=null,ce=!0,me.session?(de(),ge=me.session?.environmentBlendMode===`alpha-blend`,pe()):fe(),Be(),he.isPresenting.next(!!me.session)})],ve=!0;function ye(e){let t=hq,n=rJ.Empty;if(e){let r=j.camera.getLoci(e);if(r!==hq)return{loci:r,repr:n};t=j.handle.getLoci(e),d.forEach((r,i)=>{let a=i.getLoci(e);gq(a)||(gq(t)||console.warn(`found another loci, this should not happen`),t=a,n=i)})}return{loci:t,repr:n}}let be=[];function xe(e,t){be.push([e,t])}function Se(){let e=!1;for(let[t,n]of be)e=Ce(t,n)||e;return be=[],e&&(E.update(void 0,!0),j.handle.scene.update(void 0,!0),j.camera.scene.update(void 0,!0),ee.updateRequired(l),ee.finalizeRequired(!0),m.next()),e}function Ce(e,t){let{repr:n,loci:r}=e,i=!1;return n?i=n.mark(r,t)||i:d.forEach((e,n)=>{i=n.mark(r,t)||i}),i=j.handle.mark(r,t)||i,i=j.camera.mark(r,t)||i,i}let we=null;function Te(e,t){if(r.isContextLost||r.xr.session&&!t)return!1;let n=!1;ce&&(rt(!1),ce=!1,n=!0);let i=r.getDrawingBufferSize();if(b>i.width||b+S<0||x>i.height||x+C<0)return!1;if(we!==null&&!t)if(r.checkSyncStatus(we))we=null;else return!1;t&&(pe(),l.transparentBackground=ge);let o=Se()&&(N.props.colorMarker||l.marking.enabled),s=!1;A.update(T);let c=O.update(),u=me.update(t);if(!u&&t)return!1;let d=e||c||n||w||u;if(w=!1,a.illumination.supported&&l.illumination.enabled&&!t){if((d||o)&&(N.setOcclusionTest(null),a.illumination.restart()),a.illumination.shouldRender(l.illumination)&&(!ot&&E.count>0||a.illumination.iteration===0||l.userInteractionReleaseMs===0)){$y&&r.timer.mark(`Canvas3D.render`,{captureStats:!0});let e={renderer:N,camera:O,scene:E,helper:j};a.illumination.render(e,l,!0),$y&&r.timer.markEnd(`Canvas3D.render`),P.dirty=P.dirty||d,s=!0}}else{let e=ie.update(o||d,l.multiSample)&&!t;if(d||e||o){N.setOcclusionTest(M.isOccluded);let e=O;(l.camera.stereo.name===`on`||u)&&(u||k.update(),e=k),$y&&r.timer.mark(`Canvas3D.render`,{captureStats:!0});let n={renderer:N,camera:e,scene:E,helper:j};if(O0.isEnabled(l.multiSample)&&!t){let e=l.multiSample.reduceFlicker&&!c&&o&&!A.isAnimating;ie.render(n,l,!0,e)}else a.draw.render(n,l,!0);M.render(O),$y&&r.timer.markEnd(`Canvas3D.render`),P.dirty=P.dirty||d,s=!0}}return s&&!t&&(we=r.getFenceSync()),s}let Ee=!1,De=!1,Oe=!1;function ke(e){if(!(De||Oe)){if(!ee.finalizeRequired(e?.isSynchronous)){w=!0;return}Te(!!e?.force,e?.xrFrame)&&ve&&g.next(Ly()-h)}}function Ae(){w=!0}let je=0;function Me(e,t){Oe||r.xr.session&&!t?.xrFrame||(T=e,Ue(t?.isSynchronous),t?.updateControls&&A.update(T),O.transition.tick(T),M.tick(),!t?.manualDraw&&(ke({isSynchronous:t?.isSynchronous,xrFrame:t?.xrFrame}),!O.transition.inTransition&&!r.isContextLost&&re.tick(T)))}let Ne;function Pe(e){return Ne=e,r.xr.session?r.xr.session.requestAnimationFrame(e):v6e(e)}function Fe(e){Ne=void 0,r.xr.session?r.xr.session.cancelAnimationFrame(e):y6e(e)}function Ie(e,t){Me(Ly(),{xrFrame:t}),je=Pe(Ie)}function Le(e){h=e,A.start(e)}function Re(){De=!1,A.start(Ly()),je===0&&Ie(0)}function ze(e=!1){De=e,je!==0&&(Fe(je),je=0)}function Be(){De=!1,Ne&&Pe(Ne)}function Ve(e){if(!r.isContextLost){if(ee.finalize([`pick`],!0),`origin`in e)return ne.identify(e,O);{let t=l.camera.stereo.name===`on`?k:O;return P.identify(e[0],e[1],t)}}}function He(e){if(!r.isContextLost){if(ee.finalize([`pick`],!0),`origin`in e)return ne.asyncIdentify(e,O);{let t=l.camera.stereo.name===`on`?k:O;return P.asyncIdentify(e[0],e[1],t)}}}function Ue(e=!1){let t=Je(e);ee.updateRequired(l),t&&(We(),Ee&&=(j.debug.isEnabled&&j.debug.update(),ke({force:!0}),!1),_.next(Ly()))}function We(){if(!ae)return;he.isPresenting.value||me.resetScale();let{center:e,radius:t}=E.boundingSphereVisible,n=A.props.autoAdjustMinMaxDistance;if(n.name===`on`){let e=n.params.minDistanceFactor*t+n.params.minDistancePadding,r=Math.max(n.params.maxDistanceFactor*t,n.params.maxDistanceMin);A.setProps({minDistance:e,maxDistance:r})}if(t>0){let n=oe===void 0?l.cameraResetDurationMs:oe,r=O.getFocus(e,t),i=typeof se==`function`?se(E,O):se,a=i?{...r,...i}:r;O.setState({...a,radiusMax:D()},n)}oe=void 0,se=void 0,ae=!1}let Ge=q(),Ke=q();function qe(){if(O.state.radiusMax===0)return!0;if(O.transition.inTransition||se)return!1;let e=!0,t=!0;q.set(Ke,O.state.target,O.state.radius);for(let n of E.renderables){if(!n.state.visible)continue;let r=n.values.boundingSphere.ref.value;if(!r.radius)continue;t=!1;let i=B.distance(Ke.center,r.center);if((i>Ke.radius||i>r.radius||r.radius>O.state.radiusMax)&&!q.includes(Ge,r))return!0;q.overlaps(Ke,r)&&(e=!1)}return e||!t&&Ke.radius<=.1}function Je(e){return E.needsCommit?(q.copy(Ge,E.boundingSphereVisible),M.clear(),E.commit(e?void 0:250)?(v.next(0),j.debug.isEnabled&&j.debug.update(),!l.camera.manualReset&&(p.value===0||qe())&&(ae=!0),Ge.radius===0&&(oe=0),l.camera.manualReset||O.setState({radiusMax:D()},0),p.next(d.size),Qy&&Ye(),!0):(v.next(E.commitQueueSize),!1)):!0}function Ye(){let e=E.renderables.map(e=>({drawCount:e.values.drawCount.ref.value,instanceCount:e.values.instanceCount.ref.value,materialId:e.materialId,renderItemId:e.id,geometryType:e.values.dGeometryType.ref.value,"byteCount [MiB]":Vge(e.getByteCount()/1024/1024,3)}));console.groupCollapsed(`${e.length} RenderItems`),e.length<=64?console.table(e):console.log(e),console.log(JSON.stringify(r.stats,void 0,4));let{texture:t,cubeTexture:n,attribute:i,elements:o,pixelPack:s,renderbuffer:c}=r.resources.getByteCounts();console.log(JSON.stringify({texture:`${(t/1024/1024).toFixed(3)} MiB`,cubeTexture:`${(n/1024/1024).toFixed(3)} MiB`,attribute:`${(i/1024/1024).toFixed(3)} MiB`,elements:`${(o/1024/1024).toFixed(3)} MiB`,pixelPack:`${(s/1024/1024).toFixed(3)} MiB`,renderbuffer:`${(c/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify({renderables:`${(E.renderables.reduce((e,t)=>e+t.getByteCount(),0)/1024/1024).toFixed(3)} MiB`,passes:{draw:`${(a.draw.getByteCount()/1024/1024).toFixed(3)} MiB`,illumination:`${(a.illumination.getByteCount()/1024/1024).toFixed(3)} MiB`,pick:`${(a.pick.getByteCount()/1024/1024).toFixed(3)} MiB`,hiZ:`${(M.getByteCount()/1024/1024).toFixed(3)} MiB`}},void 0,4)),$y&&console.log(JSON.stringify(r.timer.formatedStats(),void 0,4)),console.groupEnd()}function Xe(e){Ze(e);let t=d.get(e),n=new Set;e.renderObjects.forEach(e=>n.add(e)),t?$F.areEqual(n,t)||(n.forEach(e=>{t.has(e)||E.add(e)}),t.forEach(e=>{n.has(e)||E.remove(e)})):e.renderObjects.forEach(e=>E.add(e)),d.set(e,n),E.update(e.renderObjects,!1),Ee=!0,Qy&&Ye()}function F(e){Qe(e);let t=d.get(e);t&&(t.forEach(e=>E.remove(e)),d.delete(e),Ee=!0,Qy&&Ye())}function Ze(e){f.has(e)||f.set(e,e.updated.subscribe(t=>{e.state.syncManually||Xe(e)}))}function Qe(e){let t=f.get(e);t&&(t.unsubscribe(),f.delete(e))}function $e(){let e=E.boundingSphere.radius>0?100-Math.round(O.transition.target.radius/D()*100):0;return{camera:{mode:O.state.mode,helper:{...j.camera.props},stereo:{...l.camera.stereo},fov:Math.round(IT(O.state.fov)),manualReset:!!l.camera.manualReset},cameraFog:O.state.fog>0?{name:`on`,params:{intensity:O.state.fog}}:{name:`off`,params:{}},cameraClipping:{far:O.state.clipFar,radius:e,minNear:O.state.minNear},cameraResetDurationMs:l.cameraResetDurationMs,sceneRadiusFactor:l.sceneRadiusFactor,transparentBackground:l.transparentBackground,dpoitIterations:l.dpoitIterations,pickPadding:l.pickPadding,userInteractionReleaseMs:l.userInteractionReleaseMs,viewport:l.viewport,postprocessing:{...l.postprocessing},marking:{...l.marking},multiSample:{...l.multiSample},illumination:{...l.illumination},hiZ:{...M.props},renderer:{...N.props},trackball:{...A.props},interaction:{...re.props},debug:{...j.debug.props},handle:{...j.handle.props},pointer:{...j.pointer.props},xr:{...me.props}}}let et=c?.subscribe(()=>{Oe=!0,we=null,P.dirty=!0}),tt=y.subscribe(()=>{P.reset(),ne.reset(),M.reset(),E.forEach(e=>{e.values.meta?.ref.value.reset&&(e.values.meta.ref.value.reset(),e.update())}),Oe=!1,ke({force:!0}),ke({force:!0})}),nt=new cD(0);function rt(e=!0){a.updateSize(),ct(),lt(),e&&Ae(),nt.next(+new Date)}bue(Ye);let it=e.changed?.subscribe(()=>{E.setTransparency(a.draw.transparency),Ae()}),at=!1,ot=!1,st=[i.drag.subscribe(()=>{at=!0}),i.interactionEnd.subscribe(()=>{at=!1}),pD(i.drag,i.pinch,i.wheel,i.interactionEnd).subscribe(()=>{m.next()}),m.subscribe(()=>{ot=!0}),m.pipe(hD(l.userInteractionReleaseMs)).subscribe(()=>{ot=at,!at&&a.illumination.supported&&l.illumination.enabled&&Ae()})];if(Qy&&s){let e,t=e=>{let t=e&&yq.getBoundingSphere(yq.normalize(e,`residue`));M.debugOcclusion(t)};i.click.subscribe(n=>{if(!n.modifiers.control||n.button!==2)return;let r=Ve(R.create(n.x,n.y));if(!r){e=void 0,t(e);return}e=ye(r.id).loci,t(e)}),g.subscribe(()=>{setTimeout(()=>{t(e)},100)})}return{webgl:r,add:Xe,remove:F,commit:Ue,update:(e,t)=>{if(e){if(!d.has(e))return;E.update(e.renderObjects,!!t)}else E.update(void 0,!!t);Ee=!0},clear:()=>{f.forEach(e=>e.unsubscribe()),f.clear(),d.clear(),E.clear(),j.debug.clear(),we!==null&&(r.deleteSync(we),we=null),Ae(),p.next(d.size)},syncVisibility:()=>{O.state.radiusMax===0&&(ae=!0,oe=0),E.syncVisibility()&&j.debug.isEnabled&&j.debug.update(),Ae()},requestDraw:Ae,tick:Me,animate:Re,resetTime:Le,pause:ze,resume:Be,requestAnimationFrame:Pe,cancelAnimationFrame:Fe,identify:Ve,asyncIdentify:He,mark:xe,getLoci:ye,handleResize:rt,requestResize:()=>{ce=!0},requestCameraReset:e=>{oe=e?.durationMs,se=e?.snapshot,ae=!0},camera:O,boundingSphere:E.boundingSphere,boundingSphereVisible:E.boundingSphereVisible,get notifyDidDraw(){return ve},set notifyDidDraw(e){ve=e},didDraw:g,commited:_,commitQueueSize:v,reprCount:p,resized:nt,setProps:(e,t=!1)=>{let n=typeof e==`function`?vD($e(),e):e;n.sceneRadiusFactor!==void 0&&(l.sceneRadiusFactor=n.sceneRadiusFactor,O.setState({radiusMax:D()},0));let r=Object.create(null);n.camera&&n.camera.mode!==void 0&&n.camera.mode!==O.state.mode&&(r.mode=n.camera.mode);let i=Math.round(IT(O.state.fov));if(n.camera&&n.camera.fov!==void 0&&n.camera.fov!==i&&(r.fov=FT(n.camera.fov)),n.cameraFog!==void 0&&n.cameraFog.params){let e=n.cameraFog.name===`on`?n.cameraFog.params.intensity:0;e!==O.state.fog&&(r.fog=e)}if(n.cameraClipping!==void 0&&(n.cameraClipping.far!==void 0&&n.cameraClipping.far!==O.state.clipFar&&(r.clipFar=n.cameraClipping.far),n.cameraClipping.minNear!==void 0&&n.cameraClipping.minNear!==O.state.minNear&&(r.minNear=n.cameraClipping.minNear),n.cameraClipping.radius!==void 0)){let e=D()/100*(100-n.cameraClipping.radius);e>0&&e!==r.radius&&(r.radius=Math.max(e,.01))}Object.keys(r).length>0&&O.setState(r),n.camera?.helper&&j.camera.setProps(n.camera.helper),n.camera?.manualReset!==void 0&&(l.camera.manualReset=n.camera.manualReset),n.camera?.stereo!==void 0&&(Object.assign(l.camera.stereo,n.camera.stereo),k.setProps(l.camera.stereo.params)),n.cameraResetDurationMs!==void 0&&(l.cameraResetDurationMs=n.cameraResetDurationMs),n.transparentBackground!==void 0&&(l.transparentBackground=n.transparentBackground),n.dpoitIterations!==void 0&&(l.dpoitIterations=n.dpoitIterations),n.pickPadding!==void 0&&(l.pickPadding=n.pickPadding,P.setPickPadding(l.pickPadding)),n.userInteractionReleaseMs!==void 0&&(l.userInteractionReleaseMs=n.userInteractionReleaseMs),n.viewport!==void 0&&(l.viewport===n.viewport||l.viewport.name===n.viewport.name&&Ex(l.viewport.params,n.viewport.params)||(l.viewport=n.viewport,ct(),lt())),n.postprocessing?.background&&(Object.assign(l.postprocessing.background,n.postprocessing.background),a.draw.postprocessing.background.update(O,l.postprocessing.background,e=>{e&&!t&&Ae()})),n.postprocessing&&Object.assign(l.postprocessing,n.postprocessing),n.marking&&Object.assign(l.marking,n.marking),n.illumination&&Object.assign(l.illumination,n.illumination),n.multiSample&&Object.assign(l.multiSample,n.multiSample),n.hiZ&&M.setProps(n.hiZ),n.renderer&&(E.setGlobals({dColorMarker:n.renderer.colorMarker??N.props.colorMarker,dLightCount:n.renderer.light?.length??N.props.light.length}),N.setProps(n.renderer)),n.trackball&&A.setProps(n.trackball),n.interaction&&re.setProps(n.interaction),n.debug&&j.debug.setProps(n.debug),n.handle&&j.handle.setProps(n.handle),n.pointer&&j.pointer.setProps(n.pointer),n.xr&&me.setProps(n.xr),r.mode===`orthographic`&&(l.camera.stereo.name=`off`),ee.updateRequired(l),t||Ae()},setAttribs:e=>{e.trackball&&A.setAttribs(e.trackball),e.xr&&me.setAttribs(e.xr)},getImagePass:(e={})=>new h3e(r,o,N,E,O,j,e),getRenderObjects(){let e=[];return E.forEach((t,n)=>e.push(n)),e},get props(){return $e()},get attribs(){return{trackball:A.attribs,xr:me.attribs}},get input(){return i},get stats(){return N.stats},get interaction(){return re.events},xr:he,dispose:()=>{et?.unsubscribe(),tt.unsubscribe(),it?.unsubscribe();for(let e of _e)e.unsubscribe();_e.length=0;for(let e of st)e.unsubscribe();st.length=0,y6e(je),Ne=void 0,be=[],E.clear(),j.debug.clear(),A.dispose(),N.dispose(),re.dispose(),M.dispose(),P.dispose(),ne.dispose(),me.dispose(),we!==null&&(r.deleteSync(we),we=null),p.complete(),m.complete(),g.complete(),nt.complete(),_.complete(),v.complete(),he.isPresenting.complete(),he.isSupported.complete(),he.requestFailed.complete(),xue(Ye)}};function ct(){let e=b,t=x,n=S,i=C,a=r.getDrawingBufferSize();l.viewport.name===`canvas`?(b=0,x=0,S=a.width,C=a.height):l.viewport.name===`static-frame`?(b=l.viewport.params.x*r.pixelRatio,C=l.viewport.params.height*r.pixelRatio,x=a.height-C-l.viewport.params.y*r.pixelRatio,S=l.viewport.params.width*r.pixelRatio):l.viewport.name===`relative-frame`&&(b=Math.round(l.viewport.params.x*a.width),C=Math.round(l.viewport.params.height*a.height),x=Math.round(a.height-C-l.viewport.params.y*a.height),S=Math.round(l.viewport.params.width*a.width)),(e!==b||t!==x||n!==S||i!==C)&&(w=!0)}function lt(){P.setViewport(b,x,S,C),N.setViewport(b,x,S,C),V1.set(O.viewport,b,x,S,C),V1.set(A.viewport,b,x,S,C),M.setViewport(b,x,S,C)}}e.create=t})(b6e||={});async function q0(e,t,n=!1){var r,i;if(t.data&&await e.runTask(e.state.data.setSnapshot(t.data)),t.canvas3d?.props){let n=V.normalizeParams(W0,t.canvas3d.props,`children`);(t.camera?.current||t.camera?.focus)&&(n.camera=void 0,n.cameraClipping=void 0,n.cameraFog=void 0),(r=e.canvas3d)==null||r.setProps(n)}t.camera?.current?(i=e.canvas3d)==null||i.requestCameraReset({snapshot:t.camera.current,durationMs:n||t.camera.transitionStyle===`instant`?0:t.camera.transitionDurationInMs}):t.camera?.focus&&e.managers.camera.focusObject({...t.camera.focus,durationMs:n||t.camera.transitionStyle===`instant`?0:t.camera.transitionDurationInMs})}const x6e=LY.create({name:`built-in.animate-state-snapshots`,display:{name:`State Snapshots`},isExportable:!0,params:()=>({}),canApply(e){let t=e.managers.snapshot.state.entries;return t.size<1?{canApply:!1,reason:`At least 1 state required.`}:t.some(e=>!!e?.snapshot.startAnimation)?{canApply:!1,reason:`Nested animations not supported.`}:{canApply:e.managers.snapshot.state.entries.size>0}},setup(e,t,n){q0(n,n.managers.snapshot.state.entries.get(0).snapshot,!0)},getDuration:(e,t)=>({kind:`fixed`,durationMs:t.managers.snapshot.state.entries.toArray().reduce((e,t)=>e+(t.snapshot.durationInMs??0),0)}),initialState:(e,t)=>{let n=t.managers.snapshot.state.entries.toArray();return{totalDuration:n.reduce((e,t)=>e+(t.snapshot.durationInMs??0),0),snapshots:n,currentIndex:0,currentTransitionFrame:0}},async apply(e,t,n){if(t.current>=e.totalDuration)return{kind:`finished`};let r=0,i=0,a=0;for(let n of e.snapshots){if(a=t.current-r,r+=n.snapshot.durationInMs??0,t.current<r)break;i++}if(i>=e.snapshots.length)return{kind:`finished`};let{transition:o,camera:s,canvas3d:c}=e.snapshots[i].snapshot,l=Y0.getStateTransitionFrameIndex(e.snapshots[i].snapshot,a);return o&&l!==void 0?i===e.currentIndex&&l===e.currentTransitionFrame?{kind:`skip`}:(l===0||i!==e.currentIndex?await q0(n.plugin,{...o.frames[l],camera:s,canvas3d:c}):await q0(n.plugin,o.frames[l]),{kind:`next`,state:{...e,currentIndex:i,currentAnimationFrame:l}}):i===e.currentIndex?{kind:`skip`}:(await q0(n.plugin,e.snapshots[i].snapshot),{kind:`next`,state:{...e,currentIndex:i,currentAnimationFrame:void 0}})}}),J0=LY.create({name:`built-in.animate-state-snapshot-transition`,display:{name:`State Snapshot Transition`},isExportable:!0,params:()=>({}),canApply(e){let{snapshot:t}=e.managers,{current:n}=t;return n?.snapshot.transition?{canApply:!0}:{canApply:!1,reason:`No transition found`}},setup(e,t,n){let{current:r}=n.managers.snapshot;r&&q0(n,r.snapshot.transition?.frames[0]??r.snapshot,!0)},getDuration:(e,t)=>{let{current:n}=t.managers.snapshot;return n?.snapshot.transition?n.snapshot.transition?.loop?{kind:`infinite`}:{kind:`fixed`,durationMs:Y0.getStateTransitionDuration(n.snapshot)??0}:{kind:`fixed`,durationMs:0}},initialState:(e,t)=>{let{current:n}=t.managers.snapshot;if(n)return{totalDuration:n.snapshot.transition?.loop?Number.MAX_VALUE:Y0.getStateTransitionDuration(n.snapshot)??0,snapshots:[n],currentIndex:0,currentTransitionFrame:void 0,isInitial:!0}},async apply(e,t,n){let r=e.snapshots[0]?.snapshot;if(t.current>=e.totalDuration){if(r?.transition&&e.isInitial){let t=r.transition.frames.length-1;n.plugin.managers.snapshot.setSnapshotAnimationFrame(e.totalDuration,!1),await q0(n.plugin,r.transition.frames[t])}return{kind:`finished`}}if(!r)return{kind:`finished`};let{transition:i,camera:a,canvas3d:o}=r,s=Y0.getStateTransitionFrameIndex(r,t.current);return!i||s===void 0?{kind:`finished`}:s===e.currentTransitionFrame?{kind:`skip`}:(n.plugin.managers.snapshot.setSnapshotAnimationFrame(t.current,!1),s===0?await q0(n.plugin,{...i.frames[s],camera:a,canvas3d:o}):await q0(n.plugin,i.frames[s]),{kind:`next`,state:{...e,currentAnimationFrame:s,isInitial:!1}})}});var Y0=class e extends zY{get animation(){return this.plugin.managers.animation}getSnapshot(e){let t={...this.snapshotParams.value,...e};return{id:zy.create22(),data:t.data?this.data.getSnapshot():void 0,behaviour:t.behavior?this.behaviors.getSnapshot():void 0,animation:t.animation?this.animation.getSnapshot():void 0,startAnimation:t.startAnimation?!!t.startAnimation:void 0,camera:t.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:t.cameraTransition.name,transitionDurationInMs:t?.cameraTransition?.name===`animate`?t.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:t.canvas3dContext?{props:this.plugin.canvas3dContext?.props}:void 0,canvas3d:t.canvas3d?{props:this.plugin.canvas3d?.props}:void 0,interactivity:t.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:t.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:t.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:t?.durationInMs}}async setSnapshot(e){var t;if(await this.animation.stop(),e.structureComponentManager?.options&&this.plugin.managers.structure.component._setSnapshotState(e.structureComponentManager?.options),e.behaviour&&await this.plugin.runTask(this.behaviors.setSnapshot(e.behaviour)),e.data&&await this.plugin.runTask(this.data.setSnapshot(e.data)),e.canvas3d?.props){let t=V.normalizeParams(W0,e.canvas3d.props,`children`);(e.camera?.current||e.camera?.focus)&&(t.camera=void 0,t.cameraClipping=void 0,t.cameraFog=void 0),await jx.Canvas3D.SetSettings(this.plugin,{settings:t})}if(e.canvas3dContext?.props){let n=V.normalizeParams(K0.Params,e.canvas3dContext.props,`children`);(t=this.plugin.canvas3dContext)==null||t.setProps(n)}if(e.interactivity&&e.interactivity.props&&this.plugin.managers.interactivity.setProps(e.interactivity.props),e.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(e.structureFocus),e.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(e.structureSelection),e.animation&&this.animation.setSnapshot(e.animation),e.camera?.current?jx.Camera.Reset(this.plugin,{snapshot:e.camera.current,durationMs:e.camera.transitionStyle===`animate`?e.camera.transitionDurationInMs:void 0}):e.camera?.focus&&jx.Camera.FocusObject(this.plugin,{...e.camera.focus,durationMs:e.camera.transitionStyle===`animate`?e.camera.transitionDurationInMs:void 0}),typeof e?.onLoadMarkdownCommands==`object`&&Object.keys(e.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute(`click`,e.onLoadMarkdownCommands),e.startAnimation){this.animation.start();return}e.transition?.autoplay&&(await Xy.immediatePromise(),this.animation.play(J0,{}))}async setAnimationSnapshot(e,t){var n;await this.animation.stopStateTransitionAnimation();let{transition:r}=e;if(!r)return;let i=Math.min(t,r.frames.length-1),a=r.frames[i]??e.data;if(a.data&&await this.plugin.runTask(this.data.setSnapshot(a.data)),a.canvas3d?.props){let e=V.normalizeParams(W0,a.canvas3d.props,`children`);(n=this.plugin.canvas3d)==null||n.setProps(e)}a.camera?.current&&jx.Camera.Reset(this.plugin,{snapshot:a.camera.current,durationMs:a.camera.transitionStyle===`animate`?a.camera.transitionDurationInMs:void 0}),!t&&typeof e?.onLoadMarkdownCommands==`object`&&Object.keys(e.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute(`click`,e.onLoadMarkdownCommands)}updateTransform(e,t,n,r){let i=e.build().to(t).update(n);return jx.State.Update(this.plugin,{state:e,tree:i,options:{canUndo:r}})}hasBehavior(e){return this.behaviors.tree.transforms.has(e.id)}updateBehavior(e,t){let n=this.behaviors.build();if(this.behaviors.tree.transforms.has(e.id))n.to(e.id).update(t);else{let r=e.createDefaultParams(void 0,this.plugin);n.to(B1.getCategoryId(e)).apply(e,vD(r,t),{ref:e.id})}return this.plugin.runTask(this.behaviors.updateTree(n))}dispose(){this.behaviors.cells.forEach(e=>{var t,n,r,i;B1.Behavior.is(e.obj)&&((n=(t=e.obj.data).unregister)==null||n.call(t),(i=(r=e.obj.data).dispose)==null||i.call(r))}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}constructor(t){super(),this.plugin=t,this.data=wD.create(new H.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(WQ.State.HistoryCapacity)}),this.behaviors=wD.create(new B1.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}}),this.events={cell:{stateUpdated:pD(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:pD(this.data.events.cell.created,this.behaviors.events.cell.created),removed:pD(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:pD(this.data.events.object.created,this.behaviors.events.object.created),removed:pD(this.data.events.object.removed,this.behaviors.events.object.removed),updated:pD(this.data.events.object.updated,this.behaviors.events.object.updated)}},this.snapshotParams=this.ev.behavior(e.DefaultSnapshotParams),this.setSnapshotParams=t=>{this.snapshotParams.next({...e.DefaultSnapshotParams,...t})}}};(function(e){e.SnapshotParams={durationInMs:V.Numeric(1500,{min:100,max:15e3,step:100},{label:`Duration in ms`}),data:V.Boolean(!0),behavior:V.Boolean(!1),structureSelection:V.Boolean(!1),componentManager:V.Boolean(!0),animation:V.Boolean(!0),startAnimation:V.Boolean(!1),canvas3d:V.Boolean(!0),canvas3dContext:V.Boolean(!0),interactivity:V.Boolean(!0),camera:V.Boolean(!0),cameraTransition:V.MappedStatic(`animate`,{animate:V.Group({durationInMs:V.Numeric(250,{min:100,max:5e3,step:500},{label:`Duration in ms`})}),instant:V.Group({})},{options:[[`animate`,`Animate`],[`instant`,`Instant`]]}),image:V.Boolean(!1)},e.DefaultSnapshotParams=V.getDefaultValues(e.SnapshotParams),e.getMinFrameDuration=gA(e=>{if(!e)return 1e3/60;let{transition:t}=e;if(!t)return 1e3/60;let n=1/0;for(let e of t.frames)e.durationInMs>0&&e.durationInMs<n&&(n=e.durationInMs);return Number.isFinite(n)?n:1e3/60}),e.getStateTransitionDuration=gA(e=>{if(!e)return;let{transition:t}=e;if(!t)return;let n=0;for(let e=0;e<t.frames.length;e++){let r=t.frames[e];n+=r.durationInMs}return n}),e.getStateTransitionFrameTime=gA((e,t)=>{if(!e||t===void 0)return 0;let{transition:n}=e;if(!n)return 0;let r=0;for(let e=0;e<t&&!(n.frames.length<=e);e++){let t=n.frames[e];r+=t.durationInMs}return r});function t(t,n){let{transition:r}=t;if(!r?.frames.length)return;let i=n;r.loop&&(i%=e.getStateTransitionDuration(t)??1);let a=0;if(i<=r.frames[0].durationInMs)return 0;for(let e=0;e<r.frames.length;e++){if(a>=i)return e;let t=r.frames[e];a+=t.durationInMs}return r.frames.length-1}e.getStateTransitionFrameIndex=t})(Y0||={});var S6e=`5.4.2`,C6e=new Date(1765134038263);function w6e(e,t,n,r=1){e.width=Math.round(window.devicePixelRatio*r*t),e.height=Math.round(window.devicePixelRatio*r*n),Object.assign(e.style,{width:`${t}px`,height:`${n}px`})}function T6e(e,t,n=1){let r=window.innerWidth,i=window.innerHeight;t!==document.body&&(r=t.offsetWidth,i=t.offsetHeight),w6e(e,r,i,n)}function E6e(e,t,n,r){let i=atob(e.toDataURL(n,r).split(`,`)[1]),a=i.length,o=a>>2,s=new Uint8Array(a),c=new Uint32Array(s.buffer,0,o),l=0;for(let e=0;e<o;++e)c[e]=i.charCodeAt(l++)|i.charCodeAt(l++)<<8|i.charCodeAt(l++)<<16|i.charCodeAt(l++)<<24;let u=a&3;for(;u--;)s[l]=i.charCodeAt(l++);t(new Blob([s],{type:n||`image/png`}))}async function X0(e,t,n){return new Promise((r,i)=>{let a=e=>{e?r(e):i(`no blob returned`)};HTMLCanvasElement.prototype.toBlob?e.toBlob(a,t,n):E6e(e,a,t,n)})}var D6e=class{constructor(){this.queue=[]}run(e){this.queue.length<2?this.queue.push(e):this.queue[this.queue.length-1]=e,this.queue.length===1&&this.next()}async next(){for(;this.queue.length>0;)try{let e=this.queue[0];await e()}catch(e){console.error(`Error in SingleTaskQueue execution:`,e)}finally{this.queue.shift()}}},Z0=class e extends BY{updateState(e){return`current`in e&&!(`currentAnimationTimeMs`in e)?super.updateState({...e,currentAnimationTimeMs:0}):super.updateState(e)}get current(){let e=this.state.current;return this.state.entries.find(t=>t.snapshot.id===e)}getIndex(e){return this.state.entries.indexOf(e)}getEntry(e){if(e)return this.entryMap.get(e)}remove(e){let t=this.entryMap.get(e);t&&(t?.image&&this.plugin.managers.asset.delete(t.image),this.entryMap.delete(e),this.updateState({current:this.state.current===e?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(t))}),this.events.changed.next(void 0))}add(e){this.entryMap.set(e.snapshot.id,e),this.updateState({current:e.snapshot.id,entries:this.state.entries.push(e)}),this.events.changed.next(void 0)}replace(t,n,r){let i=this.getEntry(t);if(!i)return;this.defaultSnapshotId=void 0,i?.image&&this.plugin.managers.asset.delete(i.image);let a=this.getIndex(i),o=e.Entry(n,{key:r?.key??i.key,name:r?.name??i.name,description:r?.description??i.description,descriptionFormat:r?.descriptionFormat??i.descriptionFormat,image:r?.image});this.entryMap.set(n.id,o),this.updateState({current:o.snapshot.id,entries:this.state.entries.set(a,o)}),this.events.changed.next(void 0)}move(e,t){let n=this.state.entries.size;if(n<2)return;let r=this.getEntry(e);if(!r)return;let i=this.getIndex(r),a=(i+t)%n;a<0&&(a+=n);let o=this.state.entries.get(a),s=this.state.entries.asMutable();s.set(a,r),s.set(i,o),this.updateState({current:r.snapshot.id,entries:s.asImmutable()}),this.events.changed.next(void 0)}update(e,t){let n=this.getIndex(e);if(n<0)return;let r=this.state.entries.set(n,{...e,key:t.key?.trim()||void 0,name:t.name?.trim()||void 0,description:t.description?.trim()||void 0,descriptionFormat:t.descriptionFormat});this.updateState({entries:r}),this.entryMap.set(e.snapshot.id,this.state.entries.get(n)),this.events.changed.next(void 0)}clear(){this.state.entries.size!==0&&(this.entryMap.forEach(e=>{e?.image&&this.plugin.managers.asset.delete(e.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:bw()}),this.events.changed.next(void 0))}applyKey(e){let t=this.state.entries.find(t=>t.key===e);t&&(this.updateState({current:t.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(t.snapshot))}setCurrent(e){let t=this.getEntry(e);return t&&(this.updateState({current:e}),this.events.changed.next(void 0)),t&&t.snapshot}setSnapshotAnimationFrame(e,t=!1){let n=this.getEntry(this.state.current);if(!n)return;let r=Y0.getStateTransitionFrameIndex(n.snapshot,e)??0;return this.updateState({currentAnimationTimeMs:e})&&this.events.changed.next(void 0),t&&this.animationFrameQueue.run(()=>this.plugin.state.setAnimationSnapshot(n.snapshot,r??0)),r}getNextId(e,t){let n=this.state.entries.size;if(!e){if(n===0)return;let e=t===-1?n-1:0;return this.state.entries.get(e).snapshot.id}let r=this.getEntry(e);if(!r)return;let i=this.getIndex(r);if(!(i<0))return i=(i+t)%n,i<0&&(i+=n),this.state.entries.get(i).snapshot.id}applyNext(e){let t=this.getNextId(this.state.current,e);if(t){let e=this.setCurrent(t);if(e)return this.plugin.state.setSnapshot(e)}}async setStateSnapshot(t){this.clear();let n=bw().asMutable();for(let e of t.entries)this.entryMap.set(e.snapshot.id,e),n.push(e);let r=t.current?t.current:t.entries.length>0?t.entries[0].snapshot.id:void 0;if(this.updateState({current:r,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:t.playback?t.playback.nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),!r)return;let i=this.getEntry(r),a=i&&i.snapshot;if(a)return await this.plugin.state.setSnapshot(a),t.playback?.isPlaying&&this.play({delayFirst:!0}),a}async syncCurrent(t){let n=this.state.entries.size===0,r=this.state.entries.size===1&&this.state.current&&(!this.defaultSnapshotId||this.state.current===this.defaultSnapshotId);if(!n&&!r)return;let i=this.plugin.state.getSnapshot(t?.params),a=t?.params?.image??this.plugin.state.snapshotParams.value.image?await e.getCanvasImageAsset(this.plugin,`${i.id}-image.png`):void 0;if(n)this.add(e.Entry(i,{name:t?.name,description:t?.description,descriptionFormat:t?.descriptionFormat,image:a}));else if(r){let e=this.getEntry(this.state.current);e?.image&&this.plugin.managers.asset.delete(e.image),this.replace(this.state.current,i,{image:a})}this.defaultSnapshotId=i.id}async getStateSnapshot(e){return await this.syncCurrent(e),{timestamp:+new Date,version:S6e,name:e&&e.name,description:e&&e.description,current:this.state.current,playback:{isPlaying:!!(e&&e.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}}async serialize(e){let t=JSON.stringify(await this.getStateSnapshot({params:e?.params}),null,2);if(!e?.type||e.type===`json`||e.type===`molj`)return new Blob([t],{type:`application/json;charset=utf-8`});{let e=new Uint8Array(Jy(t));Uy(e,0,t);let n={"state.json":e},r=[];for(let{asset:e,file:t}of this.plugin.managers.asset.assets)r.push([e.id,e]),n[`assets/${e.id}`]=new Uint8Array(await t.arrayBuffer());if(r.length>0){let e=JSON.stringify(r,null,2),t=new Uint8Array(Jy(e));Uy(t,0,e),n[`assets.json`]=t}let i=await this.plugin.runTask(Zue(n));return new Blob([i],{type:`application/zip`})}}async open(t){try{let n=t.name.toLowerCase();if(n.endsWith(`json`)||n.endsWith(`molj`)){let n=await this.plugin.runTask(nx(t,`string`)),r=JSON.parse(By.toString(n));e.isStateSnapshot(r)?await this.setStateSnapshot(r):e.isStateSnapshot(r.data)?await this.setStateSnapshot(r.data):await this.plugin.state.setSnapshot(r)}else{let e=await this.plugin.runTask(nx(t,`zip`)),n=Object.create(null);WT(e,(e,t)=>{if(t===`state.json`||t===`assets.json`)return;let r=t.substring(t.indexOf(`/`)+1);n[r]=e});let r=new File([e[`state.json`]],`state.json`),i=await this.plugin.runTask(nx(r,`json`));if(e[`assets.json`]){let t=new File([e[`assets.json`]],`assets.json`),r=await this.plugin.runTask(nx(t,`json`));for(let[e,t]of r)this.plugin.managers.asset.set(t,new File([n[e]],t.name))}await this.setStateSnapshot(i)}this.events.opened.next(void 0)}catch(e){console.error(e),this.plugin.log.error(`Error reading state`)}}async startPlayback(){let{current:e}=this;if(e)if(e.snapshot.transition){let e=this.setCurrent(this.state.current);await this.plugin.state.setSnapshot(e);let t=e.durationInMs===void 0?this.state.nextSnapshotDelayInMs:e.durationInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,t))}else return this.next()}async play(e){if(this.state.isPlaying&&!e?.delayFirst)if(e?.restart)await this.stop();else return;if(this.updateState({isPlaying:!0}),e?.delayFirst){let e=this.getEntry(this.state.current);if(!e){this.next();return}this.events.changed.next(void 0);let t=e.snapshot,n=t.durationInMs===void 0?this.state.nextSnapshotDelayInMs:t.durationInMs;this.timeoutHandle=setTimeout(this.next,n)}else this.startPlayback()}async stop(){await this.plugin.managers.animation.stop(),this.updateState({isPlaying:!1}),this.timeoutHandle!==void 0&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}async togglePlay(){this.state.isPlaying?(await this.stop(),this.plugin.managers.markdownExtensions.audio.pause()):await this.play()}dispose(){super.dispose(),this.entryMap.clear()}constructor(t){super({current:void 0,entries:bw(),isPlaying:!1,nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.plugin=t,this.entryMap=new Map,this.defaultSnapshotId=void 0,this.events={changed:this.ev(),opened:this.ev()},this.animationFrameQueue=new D6e,this.timeoutHandle=void 0,this.next=async()=>{this.timeoutHandle=void 0;let e=this.getNextId(this.state.current,1);if(!e||e===this.state.current){this.stop();return}let t=this.setCurrent(e);await this.plugin.state.setSnapshot(t);let n=t.durationInMs===void 0?this.state.nextSnapshotDelayInMs:t.durationInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,n))}}};Z0.DefaultNextSnapshotDelayInMs=1500,(function(e){function t(e,t){return{timestamp:+new Date,snapshot:e,...t}}e.Entry=t;function n(e){let t=e;return!!t&&!!t.timestamp&&!!t.entries}e.isStateSnapshot=n;async function r(e,t){let n=hb.create(`Render Screenshot`,async n=>{if(!e.helpers.viewportScreenshot)return;let r=await e.helpers.viewportScreenshot.getPreview(n,512);if(!r)return;let i=await X0(r.canvas,`png`),a=new File([i],t),o={kind:`file`,id:zy.create22(),name:t};return e.managers.asset.set(o,a),o});return e.runTask(n)}e.getCanvasImageAsset=r})(Z0||={});function O6e(){let e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return t+`-`+n+`-`+r+`-`+i+`-`+a+`-`+o}function k6e(e){window.open(e,`_blank`)||(window.location.href=e)}function A6e(e){try{e.dispatchEvent(new MouseEvent(`click`))}catch{let t=document.createEvent(`MouseEvents`);t.initMouseEvent(`click`,!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}function j6e(e,t=`download`){if(e)if(`download`in HTMLAnchorElement.prototype){let n=document.createElement(`a`);n.download=t,n.rel=`noopener`,typeof e==`string`?(n.href=e,A6e(n)):(n.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(n.href),4e4),setTimeout(()=>A6e(n)))}else if(typeof navigator<`u`&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{let t=window.navigator.userAgent,n=/Safari/i.test(t),r=/CriOS\/[\d]+/.test(t),i=e=>{k6e(r?e:e.replace(/^data:[^;]*;/,`data:attachment/file;`))};if((n||r)&&FileReader)if(e instanceof Blob){let t=new FileReader;t.onloadend=()=>i(t.result),t.readAsDataURL(e)}else i(e);else{let t=URL.createObjectURL(typeof e==`string`?new Blob([e]):e);location.href=t,setTimeout(()=>URL.revokeObjectURL(t),4e4)}}}function Q0(e,t){return`${e}${e[e.length-1]===`/`||t[0]===`/`?``:`/`}${t}`}var M6e=s({ApplyAction:()=>L6e,ClearHighlights:()=>U6e,Highlight:()=>H6e,RemoveObject:()=>R6e,SetCurrentObject:()=>F6e,Snapshots:()=>W6e,SyncBehaviors:()=>P6e,ToggleExpanded:()=>z6e,ToggleVisibility:()=>B6e,Update:()=>I6e,registerDefault:()=>N6e,setSubtreeVisibility:()=>$0});function N6e(e){P6e(e),F6e(e),I6e(e),L6e(e),R6e(e),z6e(e),B6e(e),H6e(e),U6e(e),W6e(e)}function P6e(e){e.state.events.object.created.subscribe(e=>{H.isBehavior(e.obj)&&e.obj.data.register(e.ref)}),e.state.events.object.removed.subscribe(e=>{var t,n,r,i;H.isBehavior(e.obj)&&((n=(t=e.obj.data).unregister)==null||n.call(t),(i=(r=e.obj.data).dispose)==null||i.call(r))}),e.state.events.object.updated.subscribe(e=>{var t,n,r,i;e.action===`recreate`&&(e.oldObj&&H.isBehavior(e.oldObj)&&((n=(t=e.oldObj.data).unregister)==null||n.call(t),(i=(r=e.oldObj.data).dispose)==null||i.call(r)),e.obj&&H.isBehavior(e.obj)&&e.obj.data.register(e.ref))})}function F6e(e){jx.State.SetCurrentObject.subscribe(e,({state:e,ref:t})=>e.setCurrent(t))}function I6e(e){jx.State.Update.subscribe(e,({state:t,tree:n,options:r})=>e.runTask(t.updateTree(n,r)))}function L6e(e){jx.State.ApplyAction.subscribe(e,({state:t,action:n,ref:r})=>e.runTask(t.applyAction(n.action,n.params,r)))}function R6e(e){function t(t,n){let r=t.build().delete(n);return e.runTask(t.updateTree(r))}jx.State.RemoveObject.subscribe(e,({state:e,ref:n,removeParentGhosts:r})=>{if(r){let r=e.tree,i=r.transforms.get(n);if(i.parent===n)return t(e,n);for(;;){let n=r.children.get(i.parent);if(i.parent===i.ref||n.size>1)return t(e,i.ref);let a=r.transforms.get(i.parent);if(!a.state.isGhost)return t(e,i.ref);i=a}}else return t(e,n)})}function z6e(e){jx.State.ToggleExpanded.subscribe(e,({state:e,ref:t})=>e.updateCellState(t,({isCollapsed:e})=>({isCollapsed:!e})))}function B6e(e){jx.State.ToggleVisibility.subscribe(e,({state:e,ref:t})=>$0(e,t,!e.cells.get(t).state.isHidden))}function $0(e,t,n){PE.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:n},V6e)}function V6e(e,t,n){n.state.updateCellState(e.ref,{isHidden:n.value})}function H6e(e){jx.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:n})=>{if(!e.canvas3d||e.isBusy)return;e.managers.interactivity.lociHighlights.clearHighlights();let r=typeof n==`string`?[n]:n;for(let n of r){let r=t.cells.get(n);if(r){if(H.Molecule.Structure.is(r.obj))e.managers.interactivity.lociHighlights.highlight({loci:nB.Loci(r.obj.data)},!1);else if(r&&H.isRepresentation3D(r.obj)){let{repr:t}=r.obj.data;for(let n of t.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:n,repr:t},!1)}else if(H.Molecule.Structure.Selections.is(r.obj))for(let t of r.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:t.loci},!1)}}})}function U6e(e){jx.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function W6e(e){e.config.set(WQ.State.CurrentServer,e.config.get(WQ.State.DefaultServer)),jx.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),jx.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),jx.State.Snapshots.Add.subscribe(e,async({key:t,name:n,description:r,descriptionFormat:i,params:a})=>{let o=e.state.getSnapshot(a),s=a?.image??e.state.snapshotParams.value.image?await Z0.getCanvasImageAsset(e,`${o.id}-image.png`):void 0,c=Z0.Entry(o,{key:t,name:n,description:r,descriptionFormat:i,image:s});e.managers.snapshot.add(c)}),jx.State.Snapshots.Replace.subscribe(e,async({id:t,params:n})=>{let r=e.state.getSnapshot(n),i=n?.image??e.state.snapshotParams.value.image?await Z0.getCanvasImageAsset(e,`${r.id}-image.png`):void 0;e.managers.snapshot.replace(t,e.state.getSnapshot(n),{image:i})}),jx.State.Snapshots.Move.subscribe(e,({id:t,dir:n})=>{e.managers.snapshot.move(t,n)}),jx.State.Snapshots.Apply.subscribe(e,({id:t})=>{let n=e.managers.snapshot.setCurrent(t);if(n)return e.state.setSnapshot(n)}),jx.State.Snapshots.Upload.subscribe(e,async({name:t,description:n,playOnLoad:r,serverUrl:i,params:a})=>fetch(Q0(i,`set?name=${encodeURIComponent(t||``)}&description=${encodeURIComponent(n||``)}`),{method:`POST`,mode:`cors`,referrer:`no-referrer`,headers:{"Content-Type":`application/json; charset=utf-8`},body:JSON.stringify(await e.managers.snapshot.getStateSnapshot({name:t,description:n,playOnLoad:r}))})),jx.State.Snapshots.Fetch.subscribe(e,async({url:t})=>{let n=await e.runTask(e.fetch({url:t,type:`json`}));await e.managers.snapshot.setStateSnapshot(n.data)}),jx.State.Snapshots.DownloadToFile.subscribe(e,async({name:t,type:n,params:r})=>{let i=`mol-star_state_${t||O6e()}.${n===`json`?`molj`:`molx`}`;j6e(await e.managers.snapshot.serialize({type:n,params:r}),`${i}`)}),jx.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),jx.State.Snapshots.OpenUrl.subscribe(e,async({url:t,type:n})=>{let r=await e.runTask(e.fetch({url:t,type:`binary`}));return e.managers.snapshot.open(new File([r],`state.${n}`))})}var G6e=s({SyncRepresentationToCanvas:()=>q6e,SyncStructureRepresentation3DState:()=>J6e,UpdateRepresentationVisibility:()=>Y6e,registerDefault:()=>K6e});function K6e(e){q6e(e),J6e(e),Y6e(e)}function q6e(e){let t=e.state.data.events;t.object.created.subscribe(t=>{var n;H.isRepresentation3D(t.obj)&&(e2(t.state.cells.get(t.ref),t.obj.data.repr),t.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)==null||n.add(t.obj.data.repr))}),t.object.updated.subscribe(t=>{var n,r;t.oldObj&&H.isRepresentation3D(t.oldObj)&&((n=e.canvas3d)==null||n.remove(t.oldObj.data.repr),t.oldObj.data.repr.destroy()),H.isRepresentation3D(t.obj)&&(e2(t.state.cells.get(t.ref),t.obj.data.repr),t.action===`recreate`&&t.obj.data.repr.setState({syncManually:!0}),(r=e.canvas3d)==null||r.add(t.obj.data.repr))}),t.object.removed.subscribe(t=>{var n;H.isRepresentation3D(t.obj)&&((n=e.canvas3d)==null||n.remove(t.obj.data.repr),t.obj.data.repr.destroy())})}function J6e(e){let t=e.state.data.events;t.object.created.subscribe(t=>{var n;if(!H.Molecule.Structure.Representation3DState.is(t.obj))return;let r=t.obj.data;r.repr.setState(r.state),(n=e.canvas3d)==null||n.update(r.repr)}),t.object.updated.subscribe(t=>{var n;if(!H.Molecule.Structure.Representation3DState.is(t.obj))return;let r=t.obj.data;r.repr.setState(r.state),(n=e.canvas3d)==null||n.update(r.repr)}),t.object.removed.subscribe(t=>{var n;if(!H.Molecule.Structure.Representation3DState.is(t.obj))return;let r=t.obj.data;r.repr.setState(r.initialState),(n=e.canvas3d)==null||n.update(r.repr)})}function Y6e(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{var n;let r=t.state.cells.get(t.ref);H.isRepresentation3D(r.obj)&&e2(r,r.obj.data.repr)&&((n=e.canvas3d)==null||n.syncVisibility())})}function e2(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var X6e=s({Focus:()=>e8e,FocusObject:()=>t8e,OrientAxes:()=>n8e,Reset:()=>Q6e,ResetAxes:()=>r8e,SetSnapshot:()=>$6e,registerDefault:()=>Z6e});function Z6e(e){Q6e(e),e8e(e),t8e(e),$6e(e),n8e(e),r8e(e)}function Q6e(e){jx.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function $6e(e){jx.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:n})=>{e.managers.camera.setSnapshot(t,n)})}function e8e(e){jx.Camera.Focus.subscribe(e,({center:t,radius:n,durationMs:r})=>{e.managers.camera.focusSphere({center:t,radius:n},{durationMs:r}),e.events.canvas3d.settingsUpdated.next(void 0)})}function t8e(e){jx.Camera.FocusObject.subscribe(e,async t=>{e.managers.camera.focusObject(t)})}function n8e(e){jx.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:n})=>{e.managers.camera.orientAxes(t,n)})}function r8e(e){jx.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}var i8e=s({Canvas3DSetSettings:()=>o8e,registerDefault:()=>a8e});function a8e(e){o8e(e)}function o8e(e){jx.Canvas3D.ResetSettings.subscribe(e,()=>{var t;(t=e.canvas3d)==null||t.setProps(G0),e.events.canvas3d.settingsUpdated.next(void 0)}),jx.Canvas3D.SetSettings.subscribe(e,t=>{var n;e.canvas3d&&((n=e.canvas3d)==null||n.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var s8e=s({DefaultFocusLociBindings:()=>h8e,DefaultLociLabelProvider:()=>m8e,DefaultSelectLociBindings:()=>d8e,FocusLoci:()=>i2,HighlightLoci:()=>u8e,SelectLoci:()=>p8e}),t2=J1,n2=q1,r2=t0.Trigger,c8e={hoverHighlightOnly:t0([r2(t2.Flag.None)],`Highlight`,"Hover element using ${triggers}"),hoverHighlightOnlyExtend:t0([r2(t2.Flag.None,n2.create({shift:!0}))],`Extend highlight`,"From selected to hovered element along polymer using ${triggers}")},l8e={bindings:V.Value(c8e,{isHidden:!0}),ignore:V.Value([],{isHidden:!0}),preferAtoms:V.Boolean(!1,{description:`Always prefer atoms over bonds`}),mark:V.Boolean(!0)};const u8e=B1.create({name:`representation-highlight-loci`,category:`interaction`,ctor:class extends B1.Handler{constructor(){super(...arguments),this.lociMarkProvider=(e,t)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(e,t)}}getLoci(e){return this.params.preferAtoms&&fR.isLoci(e)&&e.bonds.length===2?fR.toFirstStructureElementLoci(e):e}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:e,buttons:t,modifiers:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let r=this.getLoci(e.loci);if(this.params.ignore.includes(r.kind)){this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:hq});return}let i=!1;t0.match(this.params.bindings.hoverHighlightOnly,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:r}),i=!0),t0.match(this.params.bindings.hoverHighlightOnlyExtend,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:r}),i=!0),i||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:hq})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>l8e,display:{name:`Highlight Loci on Canvas`}}),d8e={clickSelect:t0.Empty,clickSelectOnly:t0.Empty,clickToggle:t0([r2(t2.Flag.Primary,n2.create())],`Toggle selection`,"Click on element using ${triggers}"),clickToggleExtend:t0([r2(t2.Flag.Primary,n2.create({shift:!0}))],`Toggle extended selection`,"Click on element using ${triggers} to extend selection along polymer"),clickDeselect:t0.Empty,clickDeselectAllOnEmpty:t0([r2(t2.Flag.Primary,n2.create())],`Deselect all`,"Click on nothing using ${triggers}")};var f8e={bindings:V.Value(d8e,{isHidden:!0}),ignore:V.Value([],{isHidden:!0}),preferAtoms:V.Boolean(!1,{description:`Always prefer atoms over bonds`}),mark:V.Boolean(!0)};const p8e=B1.create({name:`representation-select-loci`,category:`interaction`,ctor:class extends B1.Handler{getLoci(e){return this.params.preferAtoms&&fR.isLoci(e)&&e.bonds.length===2?fR.toFirstStructureElementLoci(e):e}applySelectMark(e,t){let n=this.ctx.state.data.cells.get(e);if(n&&H.isRepresentation3D(n.obj)){this.spine.current=n;let e=this.spine.getRootOfType(H.Molecule.Structure);if(e){t&&this.lociMarkProvider({loci:nB.Loci(e.data)},lq.Deselect);let n=this.ctx.managers.structure.selection.getLoci(e.data);this.lociMarkProvider({loci:n},lq.Select)}}}register(){let e=e=>yq.isEmpty(e),t=e=>!yq.isEmpty(e),n=[[`clickSelect`,e=>this.ctx.managers.interactivity.lociSelects.select(e),t],[`clickToggle`,e=>this.ctx.managers.interactivity.lociSelects.toggle(e),t],[`clickToggleExtend`,e=>this.ctx.managers.interactivity.lociSelects.toggleExtend(e),t],[`clickSelectOnly`,e=>this.ctx.managers.interactivity.lociSelects.selectOnly(e),t],[`clickDeselect`,e=>this.ctx.managers.interactivity.lociSelects.deselect(e),t],[`clickDeselectAllOnEmpty`,()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),e]];n.sort((e,t)=>{let n=this.params.bindings[e[0]],r=this.params.bindings[t[0]],i=n.triggers.length===0?0:bE(n.triggers.map(e=>n2.size(e.modifiers)));return(r.triggers.length===0?0:bE(r.triggers.map(e=>n2.size(e.modifiers))))-i}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;let i=this.getLoci(e.loci);if(!this.params.ignore.includes(i.kind)){for(let[a,o,s]of n)if(t0.match(this.params.bindings[a],t,r)&&(!s||s(i))){o({repr:e.repr,loci:i});break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:e})=>this.applySelectMark(e)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:e,obj:t,oldObj:n,oldData:r,action:i})=>{let a=this.ctx.state.data.cells.get(e);if(a&&H.Molecule.Structure.is(a.obj)){let a=t.data,o=i===`recreate`?n?.data:i===`in-place`?r:void 0;if(o&&nB.areEquivalent(a,o)&&nB.areHierarchiesEqual(a,o))return;let s=this.ctx.state.data.select(FE.children(e).ofType(H.Molecule.Structure.Representation3D));for(let e of s)this.applySelectMark(e.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}constructor(e,t){super(e,t),this.lociMarkProvider=(e,t)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:e.loci},t)},this.spine=new SD.Impl(e.state.data.cells)}},params:()=>f8e,display:{name:`Select Loci on Canvas`}}),m8e=B1.create({name:`default-loci-label-provider`,category:`interaction`,ctor:class{register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}constructor(e){this.ctx=e,this.f={label:e=>{let t=[];if($.is(e)){let n=new Set;for(let{unit:t}of e.elements){let r=iL.create(e.structure,t,t.elements[0]),i=Pz.entity.pdbx_description(r).join(`, `);n.add(i)}n.size===1&&n.forEach(e=>t.push(e))}return t.push(kJ(e)),t.filter(e=>!!e).join(`</br>`)},group:e=>e.toString().replace(/Model [0-9]+/g,`Models`),priority:100}}},display:{name:`Provide Default Loci Label`}}),h8e={clickFocus:t0([r2(t2.Flag.Primary,n2.create()),r2(t2.Flag.Trigger)],`Representation Focus`,"Click element using ${triggers}"),clickFocusAdd:t0([r2(t2.Flag.Primary,n2.create({control:!0})),r2(t2.Flag.Primary,n2.create({meta:!0}))],`Representation Focus Add`,"Click element using ${triggers}"),clickFocusExtend:t0([r2(t2.Flag.Primary,n2.create({shift:!0}))],`Representation Focus Extend`,"Click on element using ${triggers}"),clickFocusSelectMode:t0([],`Representation Focus (Selection Mode)`,"Click element using ${triggers}"),clickFocusAddSelectMode:t0([],`Representation Focus Add (Selection Mode)`,"Click element using ${triggers}"),clickFocusExtendSelectMode:t0([],`Representation Focus Extend (Selection Mode)`,"Click on element using ${triggers}")};var g8e={bindings:V.Value(h8e,{isHidden:!0})};const i2=B1.create({name:`representation-focus-loci`,category:`interaction`,ctor:class extends B1.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{let{clickFocus:r,clickFocusAdd:i,clickFocusExtend:a,clickFocusSelectMode:o,clickFocusAddSelectMode:s,clickFocusExtendSelectMode:c}=this.params.bindings,l=this.ctx.selectionMode?o:r,u=t0.match(l,t,n),d=this.ctx.selectionMode?s:i,f=t0.match(d,t,n),p=this.ctx.selectionMode?c:a,m=t0.match(p,t,n);if(!u&&!f&&!m)return;let h=(e.repr?.props?.snapshotKey)?.trim()??``;if(!this.ctx.selectionMode&&u&&h){this.ctx.managers.snapshot.applyKey(h);return}let g=e.repr?.props?.markdownCommands;if(!this.ctx.selectionMode&&u&&typeof g==`object`&&Object.keys(g).length>0){this.ctx.managers.markdownExtensions.tryExecute(`click`,g);return}let{granularity:_}=this.ctx.managers.interactivity.props;if(_!==`residue`&&_!==`element`)return;let v=yq.normalize(e.loci,`residue`),y=this.ctx.managers.structure.focus.current;if(y&&yq.areEqual(y.loci,v))this.ctx.managers.structure.focus.clear();else if(u)this.ctx.managers.structure.focus.setFromLoci(v);else{m?this.ctx.managers.structure.focus.extendFromLoci(v):this.ctx.managers.structure.focus.toggleFromLoci(v);let e=this.ctx.managers.structure.focus.current?.loci;e&&this.ctx.managers.camera.focusLoci(e)}})}},params:()=>g8e,display:{name:`Representation Focus Loci on Canvas`}});var _8e=s({CameraAxisHelper:()=>x8e,CameraControls:()=>w8e,DefaultClickResetCameraOnEmpty:()=>l2,DefaultClickResetCameraOnEmptySelectMode:()=>u2,DefaultFocusLociBindings:()=>v8e,FocusLoci:()=>b8e}),a2=J1,o2=q1,s2=t0.Trigger,c2=t0.TriggerKey;const l2=t0([s2(a2.Flag.Primary,o2.create()),s2(a2.Flag.Secondary,o2.create()),s2(a2.Flag.Primary,o2.create({control:!0})),s2(a2.Flag.Trigger)],`Reset camera focus`,"Click on nothing using ${triggers}"),u2=t0([s2(a2.Flag.Secondary,o2.create()),s2(a2.Flag.Primary,o2.create({control:!0}))],`Reset camera focus (Selection Mode)`,"Click on nothing using ${triggers}"),v8e={clickCenterFocus:t0([s2(a2.Flag.Primary,o2.create()),s2(a2.Flag.Secondary,o2.create()),s2(a2.Flag.Primary,o2.create({control:!0})),s2(a2.Flag.Trigger)],`Camera center and focus`,"Click element using ${triggers}"),clickCenterFocusSelectMode:t0([s2(a2.Flag.Secondary,o2.create()),s2(a2.Flag.Primary,o2.create({control:!0}))],`Camera center and focus (Selection Mode)`,"Click element using ${triggers}"),clickResetCameraOnEmpty:l2,clickResetCameraOnEmptySelectMode:u2};var y8e={minRadius:V.Numeric(8,{min:1,max:50,step:1}),extraRadius:V.Numeric(4,{min:1,max:50,step:1},{description:`Value added to the bounding-sphere radius of the Loci`}),durationMs:V.Numeric(250,{min:0,max:1e3,step:1},{description:`Camera transition duration`}),bindings:V.Value(v8e,{isHidden:!0})};const b8e=B1.create({name:`camera-focus-loci`,category:`interaction`,ctor:class extends B1.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{if(!this.ctx.canvas3d)return;let r=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,i=this.ctx.selectionMode?this.params.bindings.clickResetCameraOnEmptySelectMode??u2:this.params.bindings.clickResetCameraOnEmpty??l2;if(yq.isEmpty(e.loci)&&t0.match(i,t,n)){jx.Camera.Reset(this.ctx,{});return}let a=(e.repr?.props?.snapshotKey)?.trim()??``,o=e.repr?.props?.markdownCommands;if(!(a||typeof o==`object`&&Object.keys(o).length>0)&&t0.match(r,t,n)){let t=yq.normalize(e.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(t,this.params)}})}},params:()=>y8e,display:{name:`Camera Focus Loci on Canvas`}}),x8e=B1.create({name:`camera-axis-helper`,category:`interaction`,ctor:class extends B1.Handler{register(){let e=I0.None,t=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:n})=>{if(!this.ctx.canvas3d||!L0(n.loci))return;let r=n.loci.elements[0].groupId;if(r===I0.None){e=I0.None,t=0;return}let{camera:i}=this.ctx.canvas3d,a,o;if(r>=I0.X&&r<=I0.Z){e=I0.None,t=0;let n=B.sub(B(),i.target,i.position),s=B.cross(B(),n,i.up);o=B(),o[r-1]=1,a=B.cross(B(),o,s),B.magnitude(a)===0&&(a=n)}else e===r?t=(t+1)%2:(e=r,t=0),r===I0.XY?(o=t?B.unitX:B.unitY,a=B.negUnitZ):r===I0.XZ?(o=t?B.unitX:B.unitZ,a=B.negUnitY):(o=t?B.unitY:B.unitZ,a=B.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(e,t)=>t.getInvariantFocus(e.boundingSphereVisible.center,e.boundingSphereVisible.radius,o,a)})})}},params:()=>({}),display:{name:`Camera Axis Helper`}});var S8e={keySpinAnimation:t0([c2(`I`)],`Spin Animation`,"Press ${triggers}"),keyRockAnimation:t0([c2(`O`)],`Rock Animation`,"Press ${triggers}"),keyToggleFlyMode:t0([c2(`Space`,o2.create({shift:!0}))],`Toggle Fly Mode`,"Press ${triggers}"),keyResetView:t0([c2(`T`)],`Reset View`,"Press ${triggers}"),keyGlobalIllumination:t0([c2(`G`)],`Global Illumination`,"Press ${triggers}")},C8e={bindings:V.Value(S8e,{isHidden:!0})};const w8e=B1.create({name:`camera-controls`,category:`interaction`,ctor:class extends B1.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:n})=>{if(!this.ctx.canvas3d)return;let r={...S8e,...this.params.bindings},i=this.ctx.canvas3d.props.trackball,a=this.ctx.canvas3d.props.illumination;if(t0.matchKey(r.keySpinAnimation,e,n,t)){let e=i.animate.name===`spin`?`off`:`spin`;e===`off`?jx.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...i,animate:{name:e,params:{}}}}}):jx.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...i,animate:{name:e,params:{speed:.1}}}}})}if(t0.matchKey(r.keyRockAnimation,e,n,t)){let e=i.animate.name===`rock`?`off`:`rock`;e===`off`?jx.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...i,animate:{name:e,params:{}}}}}):jx.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...i,animate:{name:e,params:{speed:.3,angle:10}}}}})}if(t0.matchKey(r.keyToggleFlyMode,e,n,t)){let e=!i.flyMode;jx.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...i,flyMode:e}}}),this.ctx.canvas3dContext?.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=e?`crosshair`:`unset`)}t0.matchKey(r.keyResetView,e,n,t)&&jx.Camera.Reset(this.ctx,{}),t0.matchKey(r.keyGlobalIllumination,e,n,t)&&jx.Canvas3D.SetSettings(this.ctx,{settings:{illumination:{...a,enabled:!a.enabled}}})})}},params:()=>C8e,display:{name:`Camera Controls on Canvas`}});var T8e=s({SnapshotControls:()=>O8e}),d2=q1,f2=t0.TriggerKey,E8e={next:t0([f2(`ArrowRight`,d2.create({control:!0})),f2(`GamepadY`)]),previous:t0([f2(`ArrowLeft`,d2.create({control:!0})),f2(`GamepadX`)]),first:t0([f2(`ArrowUp`,d2.create({control:!0}))]),last:t0([f2(`ArrowDown`,d2.create({control:!0}))])},D8e={bindings:V.Value(E8e,{isHidden:!0})};const O8e=B1.create({name:`snapshot-controls`,category:`interaction`,ctor:class extends B1.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.keyReleased,({code:e,modifiers:t,key:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let r=this.params.bindings,{snapshot:i}=this.ctx.managers;if(t0.matchKey(r.next,e,t,n)&&i.applyNext(1),t0.matchKey(r.previous,e,t,n)&&i.applyNext(-1),t0.matchKey(r.first,e,t,n)){let e=i.state.entries.get(0),t=i.setCurrent(e.snapshot.id);if(t)return this.ctx.state.setSnapshot(t)}if(t0.matchKey(r.last,e,t,n)){let e=i.state.entries.get(i.state.entries.size-1),t=i.setCurrent(e.snapshot.id);if(t)return this.ctx.state.setSnapshot(t)}})}},params:()=>D8e,display:{name:`Snapshot Controls`}}),k8e=B1.create({name:`structure-info-prop`,category:`custom-props`,display:{name:`Structure Info`},ctor:class extends B1.Handler{get maxModelIndex(){let e=-1,t=this.ctx.state.data.select(FE.Generators.rootsOfType(H.Molecule.Model));for(let n of t){let t=n.obj?.data&&DB.Index.get(n.obj?.data).value;t!==void 0&&t>e&&(e=t)}return e}get maxStructureIndex(){let e=-1,t=this.ctx.state.data.select(FE.Generators.rootsOfType(H.Molecule.Structure));for(let n of t){let t=n.obj?.data&&nB.Index.get(n.obj?.data).value;t!==void 0&&t>e&&(e=t)}return e}get asymIdOffset(){let e=0,t=0,n=this.ctx.state.data.select(FE.Generators.rootsOfType(H.Molecule.Model));for(let r of n){let n=r.obj?.data;if(n){let r=DB.AsymIdCount.get(n),i=DB.AsymIdOffset.get(n).value;r!==void 0&&i!==void 0&&(e=Math.max(e,i.auth+r.auth),t=Math.max(t,i.label+r.label))}}return{auth:e,label:t}}setModelMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(FE.Generators.rootsOfType(H.Molecule.Model));for(let n of t){let t=n.obj?.data;t&&DB.MaxIndex.get(t).value!==e&&DB.MaxIndex.set(t,{value:e},e)}}setStructureMaxIndex(){let e=this.maxModelIndex,t=this.ctx.state.data.select(FE.Generators.rootsOfType(H.Molecule.Structure));for(let n of t){let t=n.obj?.data;t&&nB.MaxIndex.get(t).value!==e&&nB.MaxIndex.set(t,{value:e},e)}}handleModel(e,t){if(DB.Index.get(e).value===void 0){let n=(t&&DB.Index.get(t).value)??this.maxModelIndex+1;DB.Index.set(e,{value:n},n)}if(DB.AsymIdOffset.get(e).value===void 0){let n=(t&&DB.AsymIdOffset.get(t).value)??{...this.asymIdOffset};DB.AsymIdOffset.set(e,{value:n},n)}}handleStructure(e,t){if(e.parent!==void 0||nB.Index.get(e).value!==void 0)return;let n=(t&&nB.Index.get(t).value)??this.maxStructureIndex+1;nB.Index.set(e,{value:n},n)}handle(e,t,n){H.Molecule.Structure.is(t)?!this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator&&t.data.parent===void 0&&this.handleStructure(t.data,n?.data):H.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,n?.data))}register(){this.ctx.customModelProperties.register(DB.AsymIdOffset,!0),this.ctx.customModelProperties.register(DB.Index,!0),this.ctx.customModelProperties.register(DB.MaxIndex,!0),this.ctx.customStructureProperties.register(nB.Index,!0),this.ctx.customStructureProperties.register(nB.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(DB.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(DB.Index.descriptor.name),this.ctx.customModelProperties.unregister(DB.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(nB.Index.descriptor.name),this.ctx.customStructureProperties.unregister(nB.MaxIndex.descriptor.name)}}}),p2=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],A8e={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165};function j8e(e){let{key:t}=Pz.residue,{type_symbol:n,label_atom_id:r,label_comp_id:i}=Pz.atom,{structure:a,atomRadiusType:o,serialResidueIndex:s}=e,c=iL.create(a),l=0,u=0,d=-1;c.structure=a;for(let f=0,p=0,m=a.units.length;f<m;++f){let m=a.units[f],{elements:h}=m;c.unit=m,l=-1;for(let a=0,f=h.length;a<f;++a){let f=h[a],g=p+a;c.element=f,u=t(c),l!==u&&++d,l=u;let _=n(c);if(zL(IL(_))){o[g]=0,s[g]=-1;continue}let v=r(c),y=SR(m,f);if(y===iI.Water||!e.nonPolymer&&!TI(y)){o[g]=0,s[g]=-1;continue}let b=i(c);if(e.traceOnly&&(v!==`CA`&&v!==`BB`||!A8e[b])){o[g]=0,s[g]=d;continue}EI(y)?o[g]=N8e(v,_,b):y===iI.Protein?o[g]=M8e(v,_,b):o[g]=m2(_),s[g]=d}p+=h.length}}function M8e(e,t,n){switch(t){case`O`:return 5;case`S`:return 6;case`N`:return e===`NZ`?4:3;case`C`:switch(e){case`C`:case`CE1`:case`CE2`:case`CE3`:case`CH2`:case`CZ`:case`CZ2`:case`CZ3`:return 1;case`CA`:case`CB`:case`CE`:case`CG1`:case`CG2`:return 2;default:switch(n){case`PHE`:case`TRP`:case`TYR`:case`HIS`:case`ASP`:case`ASN`:return 1;case`PRO`:case`LYS`:case`ARG`:case`MET`:case`ILE`:case`LEU`:return 2;case`GLU`:case`GLN`:return e===`CD`?1:2}}}return m2(t)}function N8e(e,t,n){switch(t){case`C`:return 7;case`N`:return 8;case`P`:return 9;case`O`:return 5}return m2(t)}function m2(e){let t=WI(e),n=p2.indexOf(t);return n===-1&&(n=p2.length,p2[n]=t),n}var P8e=5e3;async function F8e(e,t){let{atomRadiusType:n}=t;for(let r=0;r<n.length;r+=P8e)e.shouldUpdate&&await e.update({message:`Computing per residue surface accessibility...`,current:r,max:n.length}),I8e(t,r,Math.min(r+P8e,n.length))}function I8e(e,t,n){let{structure:r,atomRadiusType:i,serialResidueIndex:a,area:o,spherePoints:s,scalingConstant:c,maxLookupRadius:l,probeSize:u}=e,{lookup3d:d,serialMapping:f,unitIndexMap:p,units:m}=r,{cumulativeUnitElementCount:h,elementIndices:g,unitIndices:_}=f;for(let e=t;e<n;++e){let t=p2[i[e]];if(t===p2[0])continue;let n=m[_[e]],r=g[e],f=n.conformation.x(r),v=n.conformation.y(r),y=n.conformation.z(r),{count:b,units:x,indices:S,squaredDistances:C}=d.find(f,v,y,l),w=u+t,T=u+w,E=[];for(let e=0;e<b;++e){let t=x[e],a=h[p.get(t.id)]+S[e],o=g[a],s=p2[i[a]];if(n===t&&r===o||s===p2[0])continue;let c=u+s;if(C[e]<(T+s)*(T+s)){let n=g[a];E[E.length]=[C[e],(C[e]+w*w-c*c)/(2*w),t.conformation.x(n)-f,t.conformation.y(n)-v,t.conformation.z(n)-y]}}E.sort((e,t)=>e[0]-t[0]);let D=0;sl:for(let e=0;e<s.length;++e){let[t,n,r]=s[e];for(let e=0;e<E.length;++e){let[,i,a,o,s]=E[e];if(t*a+n*o+r*s>i)continue sl}++D}o[a[e]]+=c*D*w*w}}const L8e={numberOfSpherePoints:V.Numeric(92,{min:12,max:360,step:1},{description:`Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973.`}),probeSize:V.Numeric(1.4,{min:.1,max:4,step:.01},{description:`Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)`}),nonPolymer:V.Boolean(!1,{description:`Include non-polymer atoms as occluders.`}),traceOnly:V.Boolean(!1,{description:`Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids.`})};var h2;(function(e){function t(e,t={}){let r={...V.getDefaultValues(L8e),...t};return hb.create(`Compute Accessible Surface Area`,async t=>await n(t,e,r))}e.compute=t;async function n(e,t,n){let i=r(t,n);j8e(i),await F8e(e,i);let{area:a,serialResidueIndex:o}=i;return{area:a,serialResidueIndex:o}}function r(e,t){let{elementCount:n,atomicResidueCount:r}=e,{probeSize:a,nonPolymer:o,traceOnly:s,numberOfSpherePoints:c}=t;return{structure:e,probeSize:a,nonPolymer:o,traceOnly:s,spherePoints:i(c),scalingConstant:4*Math.PI/c,maxLookupRadius:2*t.probeSize+2*p2[2],atomRadiusType:new Int8Array(n),serialResidueIndex:new Int32Array(n),area:new Float32Array(r)}}function i(e){let t=[],n=Math.PI*(3-Math.sqrt(5)),r=2/e;for(let i=0;i<e;++i){let e=i*r-1+r/2,a=Math.sqrt(1-e*e),o=i*n;t[t.length]=B.create(Math.cos(o)*a,e,Math.sin(o)*a)}return t}let a;(function(e){e[e.NA=0]=`NA`,e[e.Buried=1]=`Buried`,e[e.Accessible=2]=`Accessible`})(a=e.Flags||={}),e.Flag={NA:a.NA,Buried:a.Buried,Accessible:a.Accessible};function o(e,t){return t/(A8e[e]||121)}e.normalize=o;function s(e,t){let{area:n,serialResidueIndex:r}=t,i=r[Vk.indexOf(Vk.ofSortedArray(e.structure.root.serialMapping.elementIndices),e.element)];return i===-1?-1:n[i]}e.getValue=s;function c(e,t){let n=s(e,t);return n===-1?-1:o(Pz.atom.label_comp_id(e),n)}e.getNormalizedValue=c;function l(e,t){let n=c(e,t);return n===-1?a.NA:n<.16?a.Buried:a.Accessible}e.getFlag=l})(h2||={});const g2={...L8e},_2={isBuried:oB.Dynamic(fL(`computed`,`accessible-surface-area.is-buried`,Y.Bool),e=>{if(!Q.isAtomic(e.element.unit))return!1;let t=v2.get(e.element.structure).value;return t?h2.getFlag(e.element,t)===h2.Flags.Buried:!1}),isAccessible:oB.Dynamic(fL(`computed`,`accessible-surface-area.is-accessible`,Y.Bool),e=>{if(!Q.isAtomic(e.element.unit))return!1;let t=v2.get(e.element.structure).value;return t?h2.getFlag(e.element,t)===h2.Flags.Accessible:!1})},v2=_z.createProvider({label:`Accessible Surface Area`,descriptor:PP({name:`molstar_accessible_surface_area`,symbols:_2}),type:`root`,defaultParams:g2,getParams:e=>g2,isApplicable:e=>!0,obtain:async(e,t,n)=>{let r={...V.getDefaultValues(g2),...n};return{value:await h2.compute(t,r).runInContext(e.runtime)}}});var y2=tE(16448250),R8e=`Assigns a color based on the relative accessible surface area of a residue.`;const z8e={list:V.ColorList(`yellow-green-blue`,{presetKind:`scale`})};function B8e(e){return z8e}function V8e(e,t){let n,r=Hk.create({listOrName:t.list.colors,minLabel:`buried`,maxLabel:`exposed`,domain:[0,1]}),i=e.structure&&v2.get(e.structure),a=i?dE(i.id,i.version):-1;if(i?.value&&e.structure){let t=iL.create(e.structure),a=i.value,o=e=>{let t=h2.getNormalizedValue(e,a);return t===-1?y2:r.color(t)};n=e=>iL.is(e)&&Q.isAtomic(e.unit)?o(e):fR.isLocation(e)?(t.unit=e.aUnit,t.element=e.aUnit.elements[e.aIndex],o(t)):y2}else n=()=>y2;return{factory:V8e,granularity:`group`,preferSmoothing:!0,color:n,props:t,contextHash:a,description:R8e,legend:r?r.legend:void 0}}const H8e={name:`accessible-surface-area`,label:`Accessible Surface Area`,category:mM.Residue,factory:V8e,getParams:B8e,defaultValues:V.getDefaultValues(z8e),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?v2.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&v2.ref(e.structure,!1)}},U8e=B1.create({name:`computed-accessible-surface-area-prop`,category:`custom-props`,display:{name:`Accessible Surface Area`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=v2,this.labelProvider={label:e=>{if(this.params.showTooltip)return W8e(e)}}}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){rB.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(H8e),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(G8e),this.ctx.query.structure.registry.add(K8e)}unregister(){rB.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(H8e),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(G8e),this.ctx.query.structure.registry.remove(K8e)}},params:()=>({autoAttach:V.Boolean(!1),showTooltip:V.Boolean(!0)})});function W8e(e){if(e.kind===`element-loci`){if(e.elements.length===0)return;let t=v2.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(v2.descriptor))return;let{getSerialIndex:n}=e.structure.root.serialMapping,{area:r,serialResidueIndex:i}=t,a=new Set,o=0;for(let{indices:t,unit:s}of e.elements){let{elements:e}=s;K.forEach(t,t=>{let c=i[n(s,e[t])];c!==-1&&!a.has(c)&&(o+=r[c],a.add(c))})}return a.size===0?void 0:`Accessible Surface Area ${`<small>(${a.size} ${a.size>1?`Residues sum`:`Residue`})</small>`}: ${o.toFixed(2)} \u212B<sup>2</sup>`}else if(e.kind===`structure-loci`){let t=v2.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(v2.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${Gfe(t.area).toFixed(2)} \u212B<sup>2</sup>`}}var G8e=qH(`Buried Protein Residues`,Z.struct.modifier.union([Z.struct.modifier.wholeResidues([Z.struct.modifier.union([Z.struct.generator.atomGroups({"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":_2.isBuried.symbol()})])])]),{description:`Select buried protein residues.`,category:KH.Residue,ensureCustomProperties:(e,t)=>v2.attach(e,t)}),K8e=qH(`Accessible Protein Residues`,Z.struct.modifier.union([Z.struct.modifier.wholeResidues([Z.struct.modifier.union([Z.struct.generator.atomGroups({"chain-test":Z.core.rel.eq([Z.ammp(`objectPrimitive`),`atomistic`]),"residue-test":_2.isAccessible.symbol()})])])]),{description:`Select accessible protein residues.`,category:KH.Residue,ensureCustomProperties:(e,t)=>v2.attach(e,t)});const q8e=B1.create({name:`computed-interactions-prop`,category:`custom-props`,display:{name:`Interactions`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=f1,this.labelProvider={label:e=>{if(this.params.showTooltip)switch(e.kind){case`element-loci`:if(e.elements.length===0)return;let t=[],n=this.getStructures(e.structure);for(let r of n){let n=this.provider.get(r).value;if(!n)continue;let i=$.remap(e,r);if(i.elements.length!==1)continue;let a=i.elements[0];if(K.size(a.indices)!==1)continue;let o=n.unitsFeatures.get(a.unit.id);if(!o)continue;let s=[],c=[],l=[],u=K.start(a.indices),{types:d,groups:f,elementsIndex:{indices:p,offsets:m}}=o;for(let e=m[u],t=m[u+1];e<t;++e){let t=p[e],n=d[t],r=f[t];n&&s.push(aQe(n)),r&&c.push(oQe(r))}s.length&&l.push(`<small>Types</small> ${s.join(`, `)}`),c.length&&l.push(`<small>Groups</small> ${c.join(`, `)}`),l.length&&t.push(`Interaction Feature: ${l.join(` | `)}`)}return t.length?t.join(`<br/>`):void 0;default:return}}}}getStructures(e){let t=[],n=this.ctx.helpers.substructureParent.get(e);if(n){let e=this.ctx.state.data.select(FE.Generators.ofType(H.Molecule.Structure,n.transform.ref));for(let n of e)n.obj&&OE(t,n.obj.data)}return t}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(L1),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(P1)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(L1),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(P1)}},params:()=>({autoAttach:V.Boolean(!1),showTooltip:V.Boolean(!0)})}),J8e=B1.create({name:`computed-secondary-structure-prop`,category:`custom-props`,display:{name:`Secondary Structure`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=Tz}update(e){let t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:V.Boolean(!1)})}),Y8e=B1.create({name:`computed-valence-model-prop`,category:`custom-props`,display:{name:`Valence Model`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=U$,this.labelProvider={label:e=>{if(this.params.showTooltip)switch(e.kind){case`element-loci`:if(e.elements.length===0)return;let t=[],n=this.getStructures(e.structure);for(let r of n){let n=this.provider.get(r).value;if(!n)continue;let i=$.remap(e,r);if(i.elements.length!==1)continue;let a=i.elements[0];if(K.size(a.indices)!==1)continue;let o=n.get(a.unit.id);if(!o)continue;let s=K.start(a.indices),c=o.charge[s],l=o.idealGeometry[s],u=o.implicitH[s],d=o.totalH[s];t.push(`Valence Model: <small>Charge</small> ${c} | <small>Ideal Geometry</small> ${WZe(l)} | <small>Implicit H</small> ${u} | <small>Total H</small> ${d}`)}return t.length?t.join(`<br/>`):void 0;default:return}}}}getStructures(e){let t=[],n=this.ctx.helpers.substructureParent.get(e);if(n){let e=this.ctx.state.data.select(FE.Generators.ofType(H.Molecule.Structure,n.transform.ref));for(let n of e)n.obj&&OE(t,n.obj.data)}return t}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:V.Boolean(!1),showTooltip:V.Boolean(!0)})});var b2=tE(16448250),X8e=`Assigns a color based on SIFTS mapping.`,x2=new Map;const Z8e={...MW({type:`colors`,colorList:`set-1`})};function Q8e(e){return Z8e}function $8e(e,t){let n;if(e.structure){for(let t of e.structure.models){let e=fB.Provider.get(t).value;if(e)for(let t of e.accession)!t||x2.has(t)||x2.set(t,x2.size)}let r=iL.create(e.structure),i=PW(x2.size+1,t,{valueLabel:e=>`${e}`}),a=new Map,o=e=>{let t=fB.getKey(e);if(!t)return b2;if(a.has(t))return a.get(t);let n=i.color(x2.get(t));return a.set(t,n),n};n=e=>iL.is(e)&&Q.isAtomic(e.unit)?o(e):fR.isLocation(e)?(r.unit=e.aUnit,r.element=e.aUnit.elements[e.aIndex],o(r)):b2}else n=()=>b2;return{factory:$8e,granularity:`group`,preferSmoothing:!0,color:n,props:t,description:X8e}}const e5e={name:`sifts-mapping`,label:`SIFTS Mapping`,category:mM.Residue,factory:$8e,getParams:Q8e,defaultValues:V.getDefaultValues(Z8e),isApplicable:e=>!!e.structure?.models.some(e=>fB.Provider.isApplicable(e)),ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let n of t.structure.models)await fB.Provider.attach(e,n,void 0,!0)},detach:e=>{if(e.structure)for(let t of e.structure.models)fB.Provider.ref(t,!1)}}},t5e=B1.create({name:`sifts-mapping-prop`,category:`custom-props`,display:{name:`SIFTS Mapping`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=fB.Provider,this.labelProvider={label:e=>{if(this.params.showTooltip)return n5e(e)}}}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(e5e),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(e5e),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:V.Boolean(!0),showTooltip:V.Boolean(!0)})});function n5e(e){if(e.kind===`element-loci`){if(e.elements.length===0)return;let t=e.elements[0],n=t.unit,r=iL.create(e.structure,n,n.elements[K.getAt(t.indices,0)]);return fB.getLabel(r)}}var S2;(function(e){e.Descriptor={name:`ihm_cross_link_restraint`},e.Provider=JI.create(e.Descriptor);function t(e,t){let n={entity_id:e.entity_id_1,asym_id:e.asym_id_1,seq_id:e.seq_id_1,atom_id:e.atom_id_1},r={entity_id:e.entity_id_2,asym_id:e.asym_id_2,seq_id:e.seq_id_2,atom_id:e.atom_id_2};function i(e,t,n){let r=e.get(t);r?r.push(n):e.set(t,[n])}function a(n,r){let a=r.entity_id.value(n),o=r.asym_id.value(n),u=r.seq_id.value(n);if(e.model_granularity.value(n)===`by-atom`){let e=t.atomicHierarchy.index.findAtom({auth_seq_id:u,label_asym_id:o,label_atom_id:r.atom_id.value(n),label_entity_id:a});e>=0&&i(s,e,n)}else if(t.coarseHierarchy.isDefined){let e=t.coarseHierarchy.spheres.findSequenceKey(a,o,u);if(e>=0)i(c,e,n);else{let e=t.coarseHierarchy.gaussians.findSequenceKey(a,o,u);e>=0&&i(l,e,n)}}}function o(e){switch(e){case Q.Kind.Atomic:return s;case Q.Kind.Spheres:return c;case Q.Kind.Gaussians:return l}}let s=new Map,c=new Map,l=new Map,u=[];for(let t=0;t<e._rowCount;++t)a(t,n),a(t,r);return{getIndicesByElement:(e,t)=>{let n=o(t).get(e);return n===void 0?u:n},data:e}}e.fromTable=t})(S2||={});var r5e=[];function i5e(e,t,n,r){return`${e}|${t.id}|${n}|${r.id}`}var a5e=class{getPairIndices(e,t,n,r){let i=i5e(e,t,n,r);return this.pairKeyIndices.get(i)||r5e}getPairs(e,t,n,r){return this.getPairIndices(e,t,n,r).map(e=>this.pairs[e])}constructor(e){this.pairs=e;let t=new Map;this.pairs.forEach((e,n)=>{let r=i5e(e.indexA,e.unitA,e.indexB,e.unitB),i=t.get(r);i?i.push(n):t.set(r,[n])}),this.count=e.length,this.pairKeyIndices=t}};const C2=_z.createProvider({label:`Cross Link Restraint`,descriptor:PP({name:`integrative-cross-link-restraint`}),type:`local`,defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(e=>!!S2.Provider.get(e)),obtain:async(e,t,n)=>({value:l5e(t)})});var w2;(function(e){(function(e){e.CrossLinkRestraint=`cross-link-restraint`})(e.Tag||={});function t(e){return e.models.some(e=>!!S2.Provider.get(e))}e.isApplicable=t;let n=B(),r=B();function i(e){return e.unitA.conformation.position(e.unitA.elements[e.indexA],n),e.unitB.conformation.position(e.unitB.elements[e.indexB],r),B.distance(n,r)}e.distance=i;function a(e,t,n){return ej(`cross-link-restraints`,{structure:t,crossLinkRestraints:e},n)}e.Location=a;function o(e){return!!e&&e.kind===`data-location`&&e.tag===`cross-link-restraints`}e.isLocation=o;function s(e,t){return e.data.structure===t.data.structure&&e.data.crossLinkRestraints===t.data.crossLinkRestraints&&e.element===t.element}e.areLocationsEqual=s;function c(e,t){let n=e.pairs[t];return`Cross Link Restraint | Type: ${n.restraintType} | Threshold: ${n.distanceThreshold} \u212B | Psi: ${n.psi} | Sigma 1: ${n.sigma1} | Sigma 2: ${n.sigma2} | Distance: ${i(n).toFixed(2)} \u212B`}function l(e){return c(e.data.crossLinkRestraints,e.element)}e.locationLabel=l;function u(e,t,n){return vq(`cross-link-restraints`,{structure:e,crossLinkRestraints:t},n,e=>f(t,n,e),()=>p(e,t,n))}e.Loci=u;function d(e){return!!e&&e.kind===`data-loci`&&e.tag===`interactions`}e.isLoci=d;function f(e,t,n){return FA.fromPairProvider(t.length,(n,r,i)=>{let a=e.pairs[t[n]];a.unitA.conformation.position(a.unitA.elements[a.indexA],r),a.unitB.conformation.position(a.unitB.elements[a.indexB],i)},n)}e.getBoundingSphere=f;function p(e,t,n){let r=n[0];if(r===void 0)return``;let i=t.pairs[r];return[c(t,r),PJ(fR.Location(e,i.unitA,i.indexA,e,i.unitB,i.indexB))].join(`</br>`)}e.getLabel=p})(w2||={});function o5e(e,t,n){let{elements:r}=t,i=r.length,a=t.kind;for(let t=0;t<i;t++){let i=r[t];n.getIndicesByElement(i,a).forEach(n=>e.set(n,t))}}function s5e(e,t,n){if(t.model!==n.model||t.model.sourceData.kind!==`mmCIF`)return;let r=S2.Provider.get(t.model);if(!r)return;let i=new Map,a=new Map;o5e(i,t,r),o5e(a,n,r),i.forEach((i,o)=>{let s=a.get(o);s!==void 0&&e.push(T2(t,i,n,s,r,o),T2(n,s,t,i,r,o))})}function c5e(e,t){if(t.model.sourceData.kind!==`mmCIF`)return;let n=S2.Provider.get(t.model);if(!n)return;let{elements:r}=t,i=r.length,a=t.kind,o=new Map;for(let e=0;e<i;e++){let t=r[e];n.getIndicesByElement(t,a).forEach(t=>{let n=o.get(t);n?n.push(e):o.set(t,[e])})}o.forEach((r,i)=>{if(r.length<2)return;let[a,o]=r;e.push(T2(t,a,t,o,n,i),T2(t,o,t,a,n,i))})}function T2(e,t,n,r,i,a){return{unitA:e,indexA:t,unitB:n,indexB:r,restraintType:i.data.restraint_type.value(a),distanceThreshold:i.data.distance_threshold.value(a),psi:i.data.psi.value(a),sigma1:i.data.sigma_1.value(a),sigma2:i.data.sigma_2.value(a)}}function l5e(e){let t=[];if(!e.models.some(e=>S2.Provider.get(e)))return new a5e(t);let n=e.units.length;for(let r=0;r<n;++r){let i=e.units[r];c5e(t,i);for(let a=r+1;a<n;++a){let n=e.units[a];i.model===n.model&&s5e(t,i,n)}}return new a5e(t)}function u5e(e,t,n,r,i){let a=C2.get(t).value;if(!a.count)return HM.createEmpty(i);let{sizeFactor:o}=r,s=iL.create(t),{mesh:c,boundingSphere:l}=O1(e,{linkCount:a.count,position:(e,t,n)=>{let r=a.pairs[n],i=r.unitA,o=r.unitB;i.conformation.position(i.elements[r.indexA],e),o.conformation.position(o.elements[r.indexB],t)},radius:e=>{let t=a.pairs[e];return s.unit=t.unitA,s.element=t.unitA.elements[t.indexA],n.size.size(s)*o}},r,i);if(l)c.setBoundingSphere(l);else if(c.triangleCount>0){let e=q.expand(q(),t.boundary.sphere,1*o);c.setBoundingSphere(e)}return c}const d5e={...m$,...v1,sizeFactor:V.Numeric(.5,{min:0,max:10,step:.1})};function f5e(e){return h$({defaultProps:V.getDefaultValues(d5e),createGeometry:u5e,createLocationIterator:p5e,getLoci:m5e,eachLocation:h5e,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function p5e(e){let t=C2.get(e).value,{pairs:n}=t,r=n.length,i=w2.Location(t,e);return tj(r,1,1,e=>(i.element=e,i),!0)}function m5e(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){let e=C2.get(t).value;if(e.pairs[i])return w2.Loci(t,e,[i])}return hq}function h5e(e,t,n){let r=!1;if(w2.isLoci(e)){if(!nB.areEquivalent(e.data.structure,t))return!1;let i=C2.get(t).value;if(e.data.crossLinkRestraints!==i)return!1;for(let t of e.elements)n(G.ofSingleton(t))&&(r=!0)}return r}var g5e={"cross-link-restraint":(e,t)=>GQ(`Cross-link restraint`,e,t,f5e)};const _5e={...d5e};function v5e(e,t){return V.clone(_5e)}function y5e(e,t){return rJ.createMulti(`CrossLinkRestraint`,e,t,O$,g5e)}const b5e=k$({name:w2.Tag.CrossLinkRestraint,label:`Cross Link Restraint`,description:`Displays cross-link restraints.`,factory:y5e,getParams:v5e,defaultValues:V.getDefaultValues(_5e),defaultColorTheme:{name:w2.Tag.CrossLinkRestraint},defaultSizeTheme:{name:`uniform`},isApplicable:e=>w2.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>C2.attach(e,t,void 0,!0),detach:e=>C2.ref(e,!1)}});var x5e=tE(13421772),S5e="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).";const C5e={domain:V.Interval([.5,1.5],{step:.01}),list:V.ColorList(`red-grey`,{presetKind:`scale`})};function w5e(e){return C5e}function T5e(e,t){let n,r,i=e.structure&&C2.get(e.structure).value;if(i){r=Hk.create({domain:t.domain,listOrName:t.list.colors});let e=r.color;n=t=>{if(w2.isLocation(t)){let n=i.pairs[t.element];if(n)return e(w2.distance(n)/n.distanceThreshold)}return x5e}}else n=()=>x5e;return{factory:T5e,granularity:`group`,color:n,props:t,description:S5e,legend:r?r.legend:void 0}}const E5e={name:`cross-link`,label:`Cross Link`,category:mM.Misc,factory:T5e,getParams:w5e,defaultValues:V.getDefaultValues(C5e),isApplicable:e=>!!e.structure&&w2.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?C2.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&C2.ref(e.structure,!1)}},D5e=B1.create({name:`integrative-cross-link-restraint`,category:`custom-props`,display:{name:`Cross Link Restraint`},ctor:class extends B1.Handler{constructor(){super(...arguments),this.provider=S2.Provider}register(){this.provider.formatRegistry.add(`mmCIF`,O5e),this.ctx.representation.structure.themes.colorThemeRegistry.add(E5e),this.ctx.representation.structure.registry.add(b5e)}unregister(){this.provider.formatRegistry.remove(`mmCIF`),this.ctx.representation.structure.themes.colorThemeRegistry.remove(E5e),this.ctx.representation.structure.registry.remove(b5e)}}});function O5e(e){if(!CB.is(e.sourceData))return;let{ihm_cross_link_restraint:t}=e.sourceData.data.db;if(t._rowCount!==0)return S2.fromTable(t,e)}var k5e=s({AccessibleSurfaceArea:()=>U8e,BestDatabaseSequenceMapping:()=>t5e,CrossLinkRestraint:()=>D5e,Interactions:()=>q8e,SecondaryStructure:()=>J8e,StructureInfo:()=>k8e,ValenceModel:()=>Y8e});const E2={State:M6e,Representation:G6e,Camera:X6e,Misc:i8e},D2={Representation:s8e,Camera:_8e,State:T8e,CustomProps:k5e};var A5e=e=>{let t=IY.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:V.Numeric(5,{min:1,max:10,step:1}),targetParams:V.Group(t,{label:`Target`,customDefault:R1(e,void 0,{type:`ball-and-stick`,size:`physical`,typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:`off`,excludeTypes:[`hydrogen-bond`,`metal-coordination`]}})}),surroundingsParams:V.Group(t,{label:`Surroundings`,customDefault:R1(e,void 0,{type:`ball-and-stick`,size:`physical`,typeParams:{sizeFactor:.16,excludeTypes:[`hydrogen-bond`,`metal-coordination`]}})}),nciParams:V.Group(t,{label:`Non-covalent Int.`,customDefault:R1(e,void 0,{type:P1,color:L1,size:aq.BuiltIn.uniform})}),components:V.MultiSelect(j5e,V.arrayToOptions(j5e)),excludeTargetFromSurroundings:V.Boolean(!1,{label:`Exclude Target`,description:`Exclude the focus "target" from the surroudings component.`}),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),ignoreLight:V.Boolean(!1),material:bM.getParam(),clip:V.Group(xM.Params)}},j5e=[`target`,`surroundings`,`interactions`],O2;(function(e){e.TargetSel=`structure-focus-target-sel`,e.TargetRepr=`structure-focus-target-repr`,e.SurrSel=`structure-focus-surr-sel`,e.SurrRepr=`structure-focus-surr-repr`,e.SurrNciRepr=`structure-focus-surr-nci-repr`})(O2||={});var M5e=new Set([O2.TargetSel,O2.TargetRepr,O2.SurrSel,O2.SurrRepr,O2.SurrNciRepr]),N5e=class extends B1.WithSubscribers{constructor(){super(...arguments),this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} )`}getReprParams(e){return{...e,type:{name:e.type.name,params:{...e.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip}}}}ensureShape(e){let t=this.plugin.state.data,n=t.tree,r=t.build(),i=FE.findUniqueTagsInSubtree(n,e.transform.ref,M5e);i[O2.TargetSel]||(i[O2.TargetSel]=r.to(e).apply(IY.Model.StructureSelectionFromBundle,{bundle:qR.Empty,label:`[Focus] Target`},{tags:O2.TargetSel}).ref),i[O2.SurrSel]||(i[O2.SurrSel]=r.to(e).apply(IY.Model.StructureSelectionFromExpression,{expression:Z.struct.generator.empty(),label:this.surrLabel},{tags:O2.SurrSel}).ref);let a=this.params.components;return a.indexOf(`target`)>=0&&!i[O2.TargetRepr]&&(i[O2.TargetRepr]=r.to(i[O2.TargetSel]).apply(IY.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:O2.TargetRepr}).ref),a.indexOf(`surroundings`)>=0&&!i[O2.SurrRepr]&&(i[O2.SurrRepr]=r.to(i[O2.SurrSel]).apply(IY.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:O2.SurrRepr}).ref),a.indexOf(`interactions`)>=0&&!i[O2.SurrNciRepr]&&e.obj&&P1.isApplicable(e.obj?.data)&&(i[O2.SurrNciRepr]=r.to(i[O2.SurrSel]).apply(IY.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:O2.SurrNciRepr}).ref),{state:t,builder:r,refs:i}}clear(e){let t=this.plugin.state.data;this.currentSource=void 0;let n=t.select(FE.Generators.byRef(e).subtree().withTag(O2.TargetSel)),r=t.select(FE.Generators.byRef(e).subtree().withTag(O2.SurrSel));if(n.length===0&&r.length===0)return;let i=t.build(),a=qR.Empty;for(let e of n)i.to(e).update(IY.Model.StructureSelectionFromBundle,e=>({...e,bundle:a}));let o=Z.struct.generator.empty();for(let e of r)i.to(e).update(IY.Model.StructureSelectionFromExpression,e=>({...e,expression:o}));return jx.State.Update(this.plugin,{state:t,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}async focus(e){let t=this.plugin.helpers.substructureParent.get(e.structure);if(!t||!t.obj)return;this.currentSource=e;let n=$.remap(e,t.obj.data),r=$.extendToWholeResidues(n),i=qR.fromLoci(r),a=qR.toExpression(i),o=Z.struct.modifier.includeSurroundings({0:a,radius:this.params.expandRadius,"as-whole-residues":!0});this.params.excludeTargetFromSurroundings&&(o=Z.struct.modifier.exceptBy({0:o,by:a}));let{state:s,builder:c,refs:l}=this.ensureShape(t);c.to(l[O2.TargetSel]).update(IY.Model.StructureSelectionFromBundle,e=>({...e,bundle:i})),c.to(l[O2.SurrSel]).update(IY.Model.StructureSelectionFromExpression,e=>({...e,expression:o,label:this.surrLabel})),await jx.State.Update(this.plugin,{state:s,tree:c,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}register(e){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,e=>{e?this.focus(e.loci):this.clear(yE.RootRef)})}async update(e){let t=this.params;if(this.params=e,t.excludeTargetFromSurroundings!==e.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),!0;let n=this.plugin.state.data,r=n.build(),i=FE.Generators.root.subtree(),a=this.params.components,o=a.indexOf(`target`)>=0;for(let e of n.select(i.withTag(O2.TargetRepr)))o?r.to(e).update(this.getReprParams(this.params.targetParams)):r.delete(e.transform.ref);o=a.indexOf(`surroundings`)>=0;for(let e of n.select(i.withTag(O2.SurrRepr)))o?r.to(e).update(this.getReprParams(this.params.surroundingsParams)):r.delete(e.transform.ref);o=a.indexOf(`interactions`)>=0;for(let e of n.select(i.withTag(O2.SurrNciRepr)))o?r.to(e).update(this.getReprParams(this.params.nciParams)):r.delete(e.transform.ref);return await jx.State.Update(this.plugin,{state:n,tree:r,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),e.expandRadius===t.expandRadius||this.currentSource&&this.focus(this.currentSource),!0}};const k2=B1.create({name:`create-structure-focus-representation`,display:{name:`Structure Focus Representation`},category:`interaction`,ctor:N5e,params:(e,t)=>A5e(t)});function A2(e){return e}(function(e){e.CommonParams={ignoreHydrogens:V.Optional(V.Boolean(!1)),ignoreHydrogensVariant:V.Optional(V.Select(`all`,V.arrayToOptions([`all`,`non-polar`]))),ignoreLight:V.Optional(V.Boolean(!1)),quality:V.Optional(V.Select(`auto`,SM)),theme:V.Optional(V.Group({globalName:V.Optional(V.Text(``)),globalColorParams:V.Optional(V.Value({},{isHidden:!0})),carbonColor:V.Optional(V.Select(`chain-id`,V.arrayToOptions([`chain-id`,`operator-name`,`element-symbol`]))),symmetryColor:V.Optional(V.Text(``)),symmetryColorParams:V.Optional(V.Value({},{isHidden:!0})),focus:V.Optional(V.Group({name:V.Optional(V.Text(``)),params:V.Optional(V.Value({}))}))}))};function t(e){return e===`chain-id`?{name:e,params:BW.defaultValues}:e===`operator-name`?{name:e,params:JW.defaultValues}:{name:e,params:{}}}function n(e){return e.units.some(e=>!e.conformation.operator.assembly&&e.conformation.operator.spgrOp>=0)}function r(e,r,i){let a=e.state.data.build(),o=e.builders.structure.representation,s=e.managers.structure.component.state.options.hydrogens,c={quality:e.managers.structure.component.state.options.visualQuality,ignoreHydrogens:s!==`all`,ignoreHydrogensVariant:s===`only-polar`?`non-polar`:`all`,ignoreLight:e.managers.structure.component.state.options.ignoreLight};r.quality&&r.quality!==`auto`&&(c.quality=r.quality),r.ignoreHydrogens!==void 0&&(c.ignoreHydrogens=!!r.ignoreHydrogens),r.ignoreHydrogensVariant!==void 0&&(c.ignoreHydrogensVariant=r.ignoreHydrogensVariant),r.ignoreLight!==void 0&&(c.ignoreLight=!!r.ignoreLight);let l=r.theme?.globalName?r.theme?.globalName:void 0,u=r.theme?.carbonColor===void 0?{...r.theme?.globalColorParams}:{carbonColor:t(r.theme?.carbonColor),...r.theme?.globalColorParams};return{update:a,builder:o,color:l,symmetryColor:i&&r.theme?.symmetryColor&&n(i)?r.theme?.symmetryColor:l,symmetryColorParams:r.theme?.symmetryColorParams?{...r.theme?.globalColorParams,...r.theme?.symmetryColorParams}:{...r.theme?.globalColorParams},globalColorParams:r.theme?.globalColorParams?{...r.theme?.globalColorParams}:void 0,typeParams:c,ballAndStickColor:u}}e.reprBuilder=r;function i(e,t,n,r){if(e.state.hasBehavior(k2))return e.state.updateBehavior(k2,i=>{let a=z1(e,t,`ball-and-stick`,n||`element-symbol`,r);i.surroundingsParams.colorTheme=a,i.targetParams.colorTheme=a})}e.updateFocusRepr=i})(A2||={});var j2=A2.CommonParams,M2=A2.reprBuilder,N2=A2.updateFocusRepr,P5e=A2({id:`preset-structure-representation-auto`,display:{name:`Automatic`,description:`Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces.`},params:()=>j2,apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e)?.obj?.data;if(!r)return{};let i=n.config.get(WQ.Structure.SizeThresholds)||nB.DefaultSizeThresholds,a=nB.getSize(r,i),o=r.polymerResidueCount/r.polymerGapCount;switch(a){case nB.Size.Gigantic:case nB.Size.Huge:return R5e.apply(e,t,n);case nB.Size.Large:return z5e.apply(e,t,n);case nB.Size.Medium:if(o>3)return I5e.apply(e,t,n);case nB.Size.Small:return B5e.apply(e,{...t,showCarbohydrateSymbol:!0},n);default:Lb(a)}}}),F5e=A2({id:`preset-structure-representation-empty`,display:{name:`Empty`,description:`Removes all existing representations.`},async apply(e,t,n){return{}}}),P2=`Basic`,I5e=A2({id:`preset-structure-representation-polymer-and-ligand`,display:{name:`Polymer & Ligand`,group:P2,description:`Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={polymer:await F2(n,r,`polymer`),ligand:await F2(n,r,`ligand`),nonStandard:await F2(n,r,`non-standard`),branched:await F2(n,r,`branched`,{label:`Carbohydrate`}),water:await F2(n,r,`water`),ion:await F2(n,r,`ion`),lipid:await F2(n,r,`lipid`),coarse:await F2(n,r,`coarse`)},a=r.obj.data,o=(i.water?.obj?.data?.elementCount||0)>5e4?`line`:`ball-and-stick`,s=(i.lipid?.obj?.data?.elementCount||0)>2e4?`line`:`ball-and-stick`,{update:c,builder:l,typeParams:u,color:d,symmetryColor:f,symmetryColorParams:p,globalColorParams:m,ballAndStickColor:h}=M2(n,t,a),g={polymer:l.buildRepresentation(c,i.polymer,{type:`cartoon`,typeParams:u,color:f,colorParams:p},{tag:`polymer`}),ligand:l.buildRepresentation(c,i.ligand,{type:`ball-and-stick`,typeParams:u,color:d,colorParams:h},{tag:`ligand`}),nonStandard:l.buildRepresentation(c,i.nonStandard,{type:`ball-and-stick`,typeParams:u,color:d,colorParams:h},{tag:`non-standard`}),branchedBallAndStick:l.buildRepresentation(c,i.branched,{type:`ball-and-stick`,typeParams:{...u,alpha:.3},color:d,colorParams:h},{tag:`branched-ball-and-stick`}),branchedSnfg3d:l.buildRepresentation(c,i.branched,{type:`carbohydrate`,typeParams:u,color:d,colorParams:m},{tag:`branched-snfg-3d`}),water:l.buildRepresentation(c,i.water,{type:o,typeParams:{...u,alpha:.6,visuals:o===`line`?[`intra-bond`,`element-point`]:void 0},color:d,colorParams:{carbonColor:{name:`element-symbol`,params:{}},...m}},{tag:`water`}),ion:l.buildRepresentation(c,i.ion,{type:`ball-and-stick`,typeParams:u,color:d,colorParams:{carbonColor:{name:`element-symbol`,params:{}},...m}},{tag:`ion`}),lipid:l.buildRepresentation(c,i.lipid,{type:s,typeParams:{...u,alpha:.6,visuals:s===`line`?[`intra-bond`]:void 0},color:d,colorParams:{carbonColor:{name:`element-symbol`,params:{}},...m}},{tag:`lipid`}),coarse:l.buildRepresentation(c,i.coarse,{type:`spacefill`,typeParams:u,color:d||`chain-id`,colorParams:m},{tag:`coarse`})};return await c.commit({revertOnError:!1}),await N2(n,a,t.theme?.focus?.name,t.theme?.focus?.params),{components:i,representations:g}}}),L5e=A2({id:`preset-structure-representation-protein-and-nucleic`,display:{name:`Protein & Nucleic`,group:P2,description:`Shows proteins as Cartoon and RNA/DNA as Gaussian Surface.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={protein:await W5e(n,r,`protein`),nucleic:await W5e(n,r,`nucleic`)},a=r.obj.data,o={radiusOffset:a.isCoarseGrained?2:0,smoothness:a.isCoarseGrained?1:1.5},{update:s,builder:c,typeParams:l,symmetryColor:u,symmetryColorParams:d}=M2(n,t,a),f={protein:c.buildRepresentation(s,i.protein,{type:`cartoon`,typeParams:l,color:u,colorParams:d},{tag:`protein`}),nucleic:c.buildRepresentation(s,i.nucleic,{type:`gaussian-surface`,typeParams:{...l,...o},color:u,colorParams:d},{tag:`nucleic`})};return await s.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name,t.theme?.focus?.params),{components:i,representations:f}}}),R5e=A2({id:`preset-structure-representation-coarse-surface`,display:{name:`Coarse Surface`,group:P2,description:`Shows polymers and lipids as coarse Gaussian Surface.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={polymer:await F2(n,r,`polymer`),lipid:await F2(n,r,`lipid`)},a=r.obj.data,o=n.config.get(WQ.Structure.SizeThresholds)||nB.DefaultSizeThresholds,s=nB.getSize(a,o),c=Object.create(null);s===nB.Size.Gigantic?Object.assign(c,{traceOnly:!a.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:[`structure-gaussian-surface-mesh`]}):s===nB.Size.Huge?Object.assign(c,{radiusOffset:a.isCoarseGrained?2:0,smoothness:1}):a.isCoarseGrained&&Object.assign(c,{radiusOffset:2,smoothness:1});let{update:l,builder:u,typeParams:d,symmetryColor:f,symmetryColorParams:p}=M2(n,t,a),m={polymer:u.buildRepresentation(l,i.polymer,{type:`gaussian-surface`,typeParams:{...d,...c},color:f,colorParams:p},{tag:`polymer`}),lipid:u.buildRepresentation(l,i.lipid,{type:`gaussian-surface`,typeParams:{...d,...c},color:f,colorParams:p},{tag:`lipid`})};return await l.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name,t.theme?.focus?.params),{components:i,representations:m}}}),z5e=A2({id:`preset-structure-representation-polymer-cartoon`,display:{name:`Polymer Cartoon`,group:P2,description:`Shows polymers as Cartoon.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={polymer:await F2(n,r,`polymer`)},a=r.obj.data,{update:o,builder:s,typeParams:c,symmetryColor:l,symmetryColorParams:u}=M2(n,t,a),d={polymer:s.buildRepresentation(o,i.polymer,{type:`cartoon`,typeParams:c,color:l,colorParams:u},{tag:`polymer`})};return await o.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name,t.theme?.focus?.params),{components:i,representations:d}}}),B5e=A2({id:`preset-structure-representation-atomic-detail`,display:{name:`Atomic Detail`,group:P2,description:`Shows everything in atomic detail.`},params:()=>({...j2,showCarbohydrateSymbol:V.Boolean(!1)}),async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={all:await F2(n,r,`all`),branched:void 0},a=r.obj.data,o=a.elementCount>1e5,s=a.elementCount>1e6,c=a.units.length>5e3,l=a.atomicResidueCount&&a.elementCount>1e3&&a.atomicResidueCount/a.elementCount<3,u=a.models[0],d=!!YI.Provider.get(u)||iR.isExhaustive(u),f=`ball-and-stick`;a.isCoarseGrained||c?f=s?`point`:`spacefill`:l&&!d?f=`spacefill`:o&&(f=`line`);let p=t.showCarbohydrateSymbol&&!o&&!l;p&&Object.assign(i,{branched:await F2(n,r,`branched`,{label:`Carbohydrate`})});let{update:m,builder:h,typeParams:g,color:_,ballAndStickColor:v,globalColorParams:y}=M2(n,t,a),b=l&&!d?{carbonColor:{name:`element-symbol`,params:{}},...y}:v,x={all:h.buildRepresentation(m,i.all,{type:f,typeParams:g,color:_,colorParams:b},{tag:`all`})};return p&&Object.assign(x,{snfg3d:h.buildRepresentation(m,i.branched,{type:`carbohydrate`,typeParams:{...g,alpha:.4,visuals:[`carbohydrate-symbol`]},color:_,colorParams:y},{tag:`snfg-3d`})}),await m.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name??_,t.theme?.focus?.params??b),{components:i,representations:x}}}),V5e=A2({id:`preset-structure-representation-illustrative`,display:{name:`Illustrative`,group:`Miscellaneous`,description:`Show everything in spacefill representation with illustrative colors and ignore light.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={all:await F2(n,r,`all`),branched:void 0},a=r.obj.data,{update:o,builder:s,typeParams:c,color:l}=M2(n,t,a),u={all:s.buildRepresentation(o,i.all,{type:`spacefill`,typeParams:{...c,ignoreLight:!0},color:`illustrative`,colorParams:{style:{name:`entity-id`,params:{overrideWater:!0}}}},{tag:`all`})};return await o.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name??l,t.theme?.focus?.params),{components:i,representations:u}}}),H5e=A2({id:`preset-structure-representation-molecular-surface`,display:{name:`Molecular Surface`,group:`Miscellaneous`,description:`Show everything in molecular surface representation with illustrative colors.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={all:await F2(n,r,`all`),branched:void 0},a=r.obj.data,{update:o,builder:s,typeParams:c,color:l}=M2(n,t,a),u={all:s.buildRepresentation(o,i.all,{type:`molecular-surface`,typeParams:c,color:`entity-id`,colorParams:{overrideWater:!0}},{tag:`all`})};return await o.commit({revertOnError:!0}),await N2(n,a,t.theme?.focus?.name??l,t.theme?.focus?.params),{components:i,representations:u}}}),U5e=A2({id:`preset-structure-representation-auto-lod`,display:{name:`Automatic Detail`,group:`Miscellaneous`,description:`Shows more (or less) detailed representations automatically based on camera distance.`},params:()=>j2,async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e);if(!r)return{};let i={all:await F2(n,r,`all`)},a=r.obj.data,{update:o,builder:s,typeParams:c,color:l,symmetryColor:u,symmetryColorParams:d,ballAndStickColor:f}=M2(n,t,a),p={gaussianSurface:s.buildRepresentation(o,i.all,{type:`gaussian-surface`,typeParams:{...c,lod:B.create(30,1e7,100)},color:u,colorParams:d},{tag:`gaussian-surface`}),cartoon:s.buildRepresentation(o,i.all,{type:`cartoon`,typeParams:{...c,lod:B.create(-20,300,100)},color:u,colorParams:d},{tag:`cartoon`}),ballAndStick:s.buildRepresentation(o,i.all,{type:`ball-and-stick`,typeParams:{...c,lod:B.create(-20,40,20)},color:l,colorParams:f},{tag:`ball-and-stick`})};return await o.commit({revertOnError:!1}),await N2(n,a,t.theme?.focus?.name,t.theme?.focus?.params),{components:i,representations:p}}});function F2(e,t,n,r){return e.builders.structure.tryCreateComponentStatic(t,n,r)}function W5e(e,t,n,r){return e.builders.structure.tryCreateComponentFromSelection(t,aU[n],`selection-${n}`,r)}const I2={empty:F5e,auto:P5e,"atomic-detail":B5e,"polymer-cartoon":z5e,"polymer-and-ligand":I5e,"protein-and-nucleic":L5e,"coarse-surface":R5e,illustrative:V5e,"molecular-surface":H5e,"auto-lod":U5e};function L2(e){return e}function R2(e,t){if(e.ext===`bcif`)try{let e=Kge(t);if(e.encoder.startsWith(`VolumeServer`))return`dscif`;if(e.encoder.startsWith(`volseg-volume-server`))return`segcif`;if(B2(e,`volume_data_3d_info`)){if(B2(e,`volume_data_3d`))return`dscif`;if(B2(e,`segmentation_data_3d`))return`segcif`}}catch(e){console.error(e)}else if(e.ext===`cif`){let e=t;if(e.startsWith(`data_SERVER
#
_density_server_result`))return`dscif`;if(e.startsWith(`data_SERVER
#
data_SEGMENTATION_DATA`))return`segcif`;if(z2(e,`volume_data_3d_info`)){if(z2(e,`volume_data_3d`))return`dscif`;if(z2(e,`segmentation_data_3d`))return`segcif`}if(e.includes(`atom_site_fract_x`)||e.includes(`atom_site.fract_x`))return`coreCif`}return-1}function z2(e,t){return e.includes(`_${t}.`)}function B2(e,t){for(let n of e.dataBlocks)for(let e of n.categories)if(e.name===t)return!0;return!1}const V2=`Trajectory`;function H2(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,`default`)}const G5e={label:`mmCIF`,description:`mmCIF`,category:V2,stringExtensions:[`cif`,`mmcif`,`mcif`],binaryExtensions:[`bcif`],isApplicable:(e,t)=>e.ext===`mmcif`||e.ext===`mcif`?!0:e.ext===`cif`||e.ext===`bcif`?R2(e,t)===-1:!1,parse:async(e,t,n)=>{let r=e.state.data.build().to(t).apply(IY.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await r.apply(IY.Model.TrajectoryFromMmCif,void 0,{tags:n?.trajectoryTags}).commit({revertOnError:!0});return((r.selector.cell?.obj)?.data.blocks.length||0)>1&&e.state.data.updateCellState(r.ref,{isGhost:!1}),{trajectory:i}},visuals:H2},K5e={label:`cifCore`,description:`CIF Core`,category:V2,stringExtensions:[`cif`],isApplicable:(e,t)=>e.ext===`cif`?R2(e,t)===`coreCif`:!1,parse:async(e,t,n)=>{let r=e.state.data.build().to(t).apply(IY.Data.ParseCif,void 0,{state:{isGhost:!0}}),i=await r.apply(IY.Model.TrajectoryFromCifCore,void 0,{tags:n?.trajectoryTags}).commit({revertOnError:!0});return((r.selector.cell?.obj)?.data.blocks.length||0)>1&&e.state.data.updateCellState(r.ref,{isGhost:!1}),{trajectory:i}},visuals:H2};function U2(e,t){return async(n,r,i)=>({trajectory:await n.state.data.build().to(r).apply(e,t,{tags:i?.trajectoryTags}).commit({revertOnError:!0})})}const q5e={label:`PDB`,description:`PDB`,category:V2,stringExtensions:[`pdb`,`ent`],parse:U2(IY.Model.TrajectoryFromPDB),visuals:H2},J5e={label:`PDBQT`,description:`PDBQT`,category:V2,stringExtensions:[`pdbqt`],parse:U2(IY.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:H2},Y5e={label:`XYZ`,description:`XYZ`,category:V2,stringExtensions:[`xyz`],parse:U2(IY.Model.TrajectoryFromXYZ),visuals:H2},X5e={label:`Lammps Data`,description:`Lammps Data`,category:V2,stringExtensions:[`data`],parse:U2(IY.Model.TrajectoryFromLammpsData),visuals:H2},Z5e={label:`Lammps Trajectory Data`,description:`Lammps Trajectory Data`,category:V2,stringExtensions:[`lammpstrj`],parse:U2(IY.Model.TrajectoryFromLammpsTrajData),visuals:H2},Q5e={label:`GRO`,description:`GRO`,category:V2,stringExtensions:[`gro`],binaryExtensions:[],parse:U2(IY.Model.TrajectoryFromGRO),visuals:H2},$5e={label:`MOL`,description:`MOL`,category:V2,stringExtensions:[`mol`],parse:U2(IY.Model.TrajectoryFromMOL),visuals:H2},e7e={label:`SDF`,description:`SDF`,category:V2,stringExtensions:[`sdf`,`sd`],parse:U2(IY.Model.TrajectoryFromSDF),visuals:H2},t7e={label:`MOL2`,description:`MOL2`,category:V2,stringExtensions:[`mol2`],parse:U2(IY.Model.TrajectoryFromMOL2),visuals:H2},n7e=[[`mmcif`,G5e],[`cifCore`,K5e],[`pdb`,q5e],[`pdbqt`,J5e],[`gro`,Q5e],[`xyz`,Y5e],[`lammps_data`,X5e],[`lammps_traj_data`,Z5e],[`mol`,$5e],[`sdf`,e7e],[`mol2`,t7e]];var r7e=[`gz`,`zip`];function W2(e){let t=e,n=``,r=t.lastIndexOf(`?`),i=r===-1?``:t.substring(r);t=t.substring(0,r===-1?t.length:r);let a=t.replace(/^.*[\\/]/,``),o=a.substring(0,a.lastIndexOf(`.`)),s=a.split(`.`),c=s.length>1?(s.pop()||``).toLowerCase():``,l=t.match(/^(.+):\/\/(.+)$/);l&&(n=l[1].toLowerCase(),t=l[2]||``);let u=t.substring(0,t.lastIndexOf(`/`)+1);if(r7e.includes(c)){let e=t.length-c.length-1;c=(t.substring(0,e).split(`.`).pop()||``).toLowerCase();let n=o.length-c.length-1;o=o.substring(0,n)}return{path:t,name:a,ext:c,base:o,dir:u,protocol:n,query:i}}const G2=`Topology`;var i7e=L2({label:`PSF`,description:`PSF`,category:G2,stringExtensions:[`psf`],parse:async(e,t)=>{let n=e.state.data.build().to(t).apply(IY.Data.ParsePsf,{},{state:{isGhost:!0}}),r=n.apply(IY.Model.TopologyFromPsf);return await n.commit(),{format:n.selector,topology:r.selector}}}),a7e=L2({label:`PRMTOP`,description:`PRMTOP`,category:G2,stringExtensions:[`prmtop`,`parm7`],parse:async(e,t)=>{let n=e.state.data.build().to(t).apply(IY.Data.ParsePrmtop,{},{state:{isGhost:!0}}),r=n.apply(IY.Model.TopologyFromPrmtop);return await n.commit(),{format:n.selector,topology:r.selector}}}),o7e=L2({label:`TOP`,description:`TOP`,category:G2,stringExtensions:[`top`],parse:async(e,t)=>{let n=e.state.data.build().to(t).apply(IY.Data.ParseTop,{},{state:{isGhost:!0}}),r=n.apply(IY.Model.TopologyFromTop);return await n.commit(),{format:n.selector,topology:r.selector}}});const s7e=[[`psf`,i7e],[`prmtop`,a7e],[`top`,o7e]],K2=`Coordinates`;var c7e=L2({label:`DCD`,description:`DCD`,category:K2,binaryExtensions:[`dcd`],parse:(e,t)=>e.state.data.build().to(t).apply(IY.Model.CoordinatesFromDcd).commit()}),l7e=L2({label:`XTC`,description:`XTC`,category:K2,binaryExtensions:[`xtc`],parse:(e,t)=>e.state.data.build().to(t).apply(IY.Model.CoordinatesFromXtc).commit()}),u7e=L2({label:`TRR`,description:`TRR`,category:K2,binaryExtensions:[`trr`],parse:(e,t)=>e.state.data.build().to(t).apply(IY.Model.CoordinatesFromTrr).commit()}),d7e=L2({label:`NCTRAJ`,description:`NCTRAJ`,category:K2,binaryExtensions:[`nc`,`nctraj`],parse:(e,t)=>e.state.data.build().to(t).apply(IY.Model.CoordinatesFromNctraj).commit()}),f7e=L2({label:`LAMMPSTRAJ`,description:`LAMMPSTRAJ`,category:K2,stringExtensions:[`lammpstrj`],parse:(e,t)=>e.state.data.build().to(t).apply(IY.Model.CoordinatesFromLammpstraj).commit()});const p7e=[[`dcd`,c7e],[`xtc`,l7e],[`trr`,u7e],[`nctraj`,d7e],[`lammpstrj`,f7e]];var m7e=s({AddTrajectory:()=>C7e,DownloadStructure:()=>_7e,EnableModelCustomProps:()=>x7e,EnableStructureCustomProps:()=>S7e,LoadTrajectory:()=>w7e,PdbDownloadProvider:()=>g7e,UpdateTrajectory:()=>J2}),h7e=e=>{let t=e.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id;return V.Group({type:WH.getParams(void 0,`auto`).type,representation:V.Select(t,e.builders.structure.representation.getPresets().map(e=>[e.id,e.display.name,e.display.group]),{description:`Which representation preset to use.`}),representationParams:V.Group(A2.CommonParams,{isHidden:!0}),asTrajectory:V.Optional(V.Boolean(!1,{description:`Load all entries into a single trajectory.`}))},{isExpanded:!1})};const g7e={rcsb:V.Group({encoding:V.Select(`bcif`,V.arrayToOptions([`cif`,`bcif`]))},{label:`RCSB PDB`,isFlat:!0}),pdbe:V.Group({variant:V.Select(`updated-bcif`,[[`updated-bcif`,`Updated (bcif)`],[`updated`,`Updated`],[`archival`,`Archival`]])},{label:`PDBe`,isFlat:!0}),pdbj:V.EmptyGroup({label:`PDBj`})};var _7e=cE.build({from:H.Root,display:{name:`Download Structure`,description:`Load a structure from the provided source and create its representation.`},params:(e,t)=>{let n=h7e(t),r=t.config.get(WQ.Download.DefaultPdbProvider)||`pdbe`;return{source:V.MappedStatic(`pdb`,{pdb:V.Group({provider:V.Group({id:V.Text(`1tqn`,{label:`PDB Id(s)`,description:`One or more comma/space separated PDB ids.`}),server:V.MappedStatic(r,g7e)},{pivot:`id`}),options:n},{isFlat:!0,label:`PDB`}),"pdb-ihm":V.Group({provider:V.Group({id:V.Text(`8zzc`,{label:`PDB-IHM Id(s)`,description:`One or more comma/space separated ids.`}),encoding:V.Select(`bcif`,V.arrayToOptions([`cif`,`bcif`]))},{pivot:`id`}),options:n},{isFlat:!0,label:`PDB-IHM`}),swissmodel:V.Group({id:V.Text(`Q9Y2I8`,{label:`UniProtKB AC(s)`,description:`One or more comma/space separated ACs.`}),options:n},{isFlat:!0,label:`SWISS-MODEL`,description:`Loads the best homology model or experimental structure`}),alphafolddb:V.Group({provider:V.Group({id:V.Text(`Q8W3K0`,{label:`UniProtKB AC(s)`,description:`One or more comma/space separated ACs.`}),encoding:V.Select(`bcif`,V.arrayToOptions([`cif`,`bcif`]))},{pivot:`id`}),options:n},{isFlat:!0,label:`AlphaFold DB`,description:`Loads the predicted model if available`}),modelarchive:V.Group({id:V.Text(`ma-bak-cepc-0003`,{label:`Accession Code(s)`,description:`One or more comma/space separated ACs.`}),options:n},{isFlat:!0,label:`Model Archive`}),pubchem:V.Group({id:V.Text(`2244,2245`,{label:`PubChem ID`,description:`One or more comma/space separated IDs.`}),options:n},{isFlat:!0,label:`PubChem`,description:`Loads 3D conformer from PubChem.`}),url:V.Group({url:V.Url(``),format:V.Select(`mmcif`,V.arrayToOptions(n7e.map(e=>e[0]),e=>e)),isBinary:V.Boolean(!1),label:V.Optional(V.Text(``)),options:n},{isFlat:!0,label:`URL`})})}}})(({params:e,state:t},n)=>hb.create(`Download Structure`,async r=>{n.behaviors.layout.leftPanelTabName.next(`data`);let i=e.source,a,o=!1,s=`mmcif`;switch(i.name){case`url`:a=[{url:i.params.url,isBinary:i.params.isBinary,label:i.params.label||void 0}],s=i.params.format;break;case`pdb`:a=await(i.params.provider.server.name===`pdbe`?v7e(i):i.params.provider.server.name===`pdbj`?y7e(i):i.params.provider.server.name===`rcsb`?b7e(i):Lb(i)),o=!!i.params.options.asTrajectory;break;case`pdb-ihm`:let e=e=>e.startsWith(`PDBDEV_`)?e:`PDBDEV_${e.padStart(8,`0`)}`;a=await q2(i.params.provider.id,t=>{if(t.match(/^[1-9][A-Z0-9]{3}$/i)!==null)return i.params.provider.encoding===`bcif`?`https://pdb-ihm.org/bcif/${t.toLowerCase()}.bcif`:`https://pdb-ihm.org/cif/${t.toLowerCase()}.cif`;let n=e(t.toUpperCase());return i.params.provider.encoding===`bcif`?`https://pdb-ihm.org/bcif/${n}.bcif`:`https://pdb-ihm.org/cif/${n}.cif`},t=>{let n=t.toUpperCase();return n.match(/^[1-9][A-Z0-9]{3}$/)?`PDB-IHM: ${n}`:e(n)},i.params.provider.encoding===`bcif`),o=!!i.params.options.asTrajectory;break;case`swissmodel`:a=await q2(i.params.id,e=>`https://swissmodel.expasy.org/repository/uniprot/${e.toUpperCase()}.pdb`,e=>`SWISS-MODEL: ${e}`,!1),o=!!i.params.options.asTrajectory,s=`pdb`;break;case`alphafolddb`:a=await q2(i.params.provider.id,async e=>{let t=`https://www.alphafold.ebi.ac.uk/api/prediction/${e.toUpperCase()}`,r=await n.runTask(n.fetch({url:t,type:`json`}));if(Array.isArray(r)&&r.length>0){let e=i.params.provider.encoding===`bcif`?`bcifUrl`:`cifUrl`;return r[0][e]}throw Error(`No AlphaFold DB entry for '${e}'`)},e=>`AlphaFold DB: ${e}`,i.params.provider.encoding===`bcif`),o=!!i.params.options.asTrajectory,s=`mmcif`;break;case`modelarchive`:a=await q2(i.params.id,e=>`https://www.modelarchive.org/doi/10.5452/${e.toLowerCase()}.cif`,e=>`Model Archive: ${e}`,!1),o=!!i.params.options.asTrajectory,s=`mmcif`;break;case`pubchem`:a=await q2(i.params.id,e=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${e.trim()}/record/SDF/?record_type=3d`,e=>`PubChem: ${e}`,!1),o=!!i.params.options.asTrajectory,s=`mol`;break;default:Lb(i)}let c=e.source.params.options.representation||n.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id,l=c!==I2.empty.id,u=i.params.options.type.name===`auto`?void 0:i.params.options.type;await t.transaction(async()=>{if(a.length>0&&o){let t=await n.builders.data.downloadBlob({sources:a.map((e,t)=>({id:``+t,url:e.url,isBinary:e.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),r=await n.builders.structure.parseTrajectory(t,{formats:a.map((e,t)=>({id:``+t,format:`cif`}))});await n.builders.structure.hierarchy.applyPreset(r,`default`,{structure:u,showUnitcell:l,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}else for(let t of a){let r=await n.builders.data.download(t,{state:{isGhost:!0}}),i=n.dataFormats.get(s);if(!i)throw Error(`unknown file format`);let a=await n.builders.structure.parseTrajectory(r,i);await n.builders.structure.hierarchy.applyPreset(a,`default`,{structure:u,showUnitcell:l,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}}).runInContext(r)}));async function q2(e,t,n,r){let i=e.split(/[,\s]/).map(e=>e.trim()).filter(e=>!!e&&(e.length>=4||/^[1-9][0-9]*$/.test(e))),a=[];for(let e of i)a.push({url:gx.Url(await t(e)),isBinary:r,label:n(e)});return a}async function v7e(e){if(e.name!==`pdb`||e.params.provider.server.name!==`pdbe`)throw Error(`expected pdbe`);return e.params.provider.server.params.variant===`updated`?q2(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/static/entry/${e.toLowerCase()}_updated.cif`,e=>`PDBe: ${e} (updated cif)`,!1):e.params.provider.server.params.variant===`updated-bcif`?q2(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${e.toLowerCase()}.bcif`,e=>`PDBe: ${e} (updated cif)`,!0):q2(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/static/entry/${e.toLowerCase()}.cif`,e=>`PDBe: ${e} (cif)`,!1)}async function y7e(e){if(e.name!==`pdb`||e.params.provider.server.name!==`pdbj`)throw Error(`expected pdbj`);return q2(e.params.provider.id,e=>`https://data.pdbjlc1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${e.toLowerCase().substring(1,3)}/${e.toLowerCase()}.cif`,e=>`PDBj: ${e} (cif)`,!1)}async function b7e(e){if(e.name!==`pdb`||e.params.provider.server.name!==`rcsb`)throw Error(`expected rcsb`);return e.params.provider.server.params.encoding===`cif`?q2(e.params.provider.id,e=>`https://files.rcsb.org/download/${e.toUpperCase()}.cif`,e=>`RCSB PDB: ${e} (cif)`,!1):q2(e.params.provider.id,e=>`https://models.rcsb.org/${e.toUpperCase()}.bcif`,e=>`RCSB PDB: ${e} (bcif)`,!0)}const J2=cE.build({display:{name:`Update Trajectory`},params:{action:V.Select(`advance`,V.arrayToOptions([`advance`,`reset`])),by:V.Optional(V.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{let n=t.selectQ(e=>e.ofTransformer(IY.Model.ModelFromTrajectory)),r=t.build();if(e.action===`reset`)for(let e of n)r.to(e).update({modelIndex:0});else for(let i of n){let n=FE.findAncestorOfType(t.tree,t.cells,i.transform.ref,H.Molecule.Trajectory);if(!n||!n.obj)continue;let a=n.obj;r.to(i).update(t=>{let n=(t.modelIndex+e.by)%a.data.frameCount;return n<0&&(n+=a.data.frameCount),{modelIndex:n}})}return t.updateTree(r)}),x7e=cE.build({display:{name:`Custom Model Properties`,description:`Enable parameters for custom properties of the model.`},from:H.Molecule.Model,params(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable(e,t,n){return t.transformer!==hW}})(({ref:e,params:t},n)=>n.builders.structure.insertModelProperties(e,t)),S7e=cE.build({display:{name:`Custom Structure Properties`,description:`Enable parameters for custom properties of the structure.`},from:H.Molecule.Structure,params(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable(e,t,n){return t.transformer!==_W}})(({ref:e,params:t},n)=>n.builders.structure.insertStructureProperties(e,t)),C7e=cE.build({display:{name:`Add Trajectory`,description:`Add trajectory from existing model/topology and coordinates.`},from:H.Root,params(e,t){let n=t.state.data,r=[...n.selectQ(e=>e.rootsOfType(H.Molecule.Model)),...n.selectQ(e=>e.rootsOfType(H.Molecule.Topology))].map(e=>[e.transform.ref,e.obj.label]),i=n.selectQ(e=>e.rootsOfType(H.Molecule.Coordinates)).map(e=>[e.transform.ref,e.obj.label]);return{model:V.Select(r.length?r[0][0]:``,r),coordinates:V.Select(i.length?i[0][0]:``,i)}}})(({params:e,state:t},n)=>hb.create(`Add Trajectory`,r=>t.transaction(async()=>{let i=[e.model,e.coordinates],a=t.build().toRoot().apply(dW,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:i}).apply(IY.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(a).runInContext(r);let o=await n.builders.structure.createStructure(a.selector);await n.builders.structure.representation.applyPreset(o,`auto`)}).runInContext(r))),w7e=cE.build({display:{name:`Load Trajectory`,description:`Load trajectory of model/topology and coordinates from URL or file.`},from:H.Root,params(e,t){let{options:n}=t.dataFormats,r=n.filter(e=>e[2]===`Trajectory`||e[2]===`Topology`),i=n.filter(e=>e[2]===K2),a=[],o=[];for(let{provider:e}of t.dataFormats.list)e.category===`Trajectory`||e.category===`Topology`?(e.binaryExtensions&&a.push(...e.binaryExtensions),e.stringExtensions&&a.push(...e.stringExtensions)):e.category===`Coordinates`&&(e.binaryExtensions&&o.push(...e.binaryExtensions),e.stringExtensions&&o.push(...e.stringExtensions));return{source:V.MappedStatic(`file`,{url:V.Group({model:V.Group({url:V.Url(``),format:V.Select(r[0][0],r),isBinary:V.Boolean(!1)},{isExpanded:!0}),coordinates:V.Group({url:V.Url(``),format:V.Select(i[0][0],i)},{isExpanded:!0})},{isFlat:!0}),file:V.Group({model:V.File({accept:a.map(e=>`.${e}`).join(`,`),label:`Model`}),coordinates:V.File({accept:o.map(e=>`.${e}`).join(`,`),label:`Coordinates`})},{isFlat:!0})},{options:[[`url`,`URL`],[`file`,`File`]]})}}})(({params:e,state:t},n)=>hb.create(`Load Trajectory`,r=>t.transaction(async()=>{let i=e.source;if(i.name===`file`&&(i.params.model===null||i.params.coordinates===null)){n.log.error(`No file(s) selected`);return}if(i.name===`url`&&(!i.params.model||!i.params.coordinates)){n.log.error(`No URL(s) given`);return}let a=async(e,t,r)=>{let i=await n.builders.data.download({url:e,isBinary:r}),a=n.dataFormats.get(t);if(!a){n.log.warn(`LoadTrajectory: could not find data provider for '${t}'`);return}return a.parse(n,i)},o=async e=>{if(!e)throw Error(`No file selected`);let t=W2(e.file?.name??``),r=n.dataFormats.binaryExtensions.has(t.ext),{data:i}=await n.builders.data.readFile({file:e,isBinary:r}),a=n.dataFormats.auto(t,i.cell?.obj);if(!a){n.log.warn(`LoadTrajectory: could not find data provider for '${t.ext}'`),await n.state.data.build().delete(i).commit();return}return a.parse(n,i)};try{let e=i.name===`url`?await a(i.params.model.url,i.params.model.format,i.params.model.isBinary):await o(i.params.model),s;s=`trajectory`in e?await t.build().to(e.trajectory).apply(pW,{modelIndex:0}).commit():e.topology;let c=i.name===`url`?await a(i.params.coordinates.url,i.params.coordinates.format,!0):await o(i.params.coordinates),l=[s.ref,c.ref],u=t.build().toRoot().apply(dW,{modelRef:s.ref,coordinatesRef:c.ref},{dependsOn:l}).apply(IY.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(u).runInContext(r);let d=await n.builders.structure.createStructure(u.selector);await n.builders.structure.representation.applyPreset(d,`auto`)}catch(e){console.error(e),n.log.error(`Error loading trajectory`)}}).runInContext(r)));var Y2=class extends y.PureComponent{constructor(){super(...arguments),this.hide=()=>this.props.onSelect(void 0)}render(){let e=this.props,t=(0,I.jsx)(T7e,{items:e.items,onSelect:e.onSelect,current:e.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,I.jsxs)(`div`,{className:`msp-action-menu-options${e.header?``:` msp-action-menu-options-no-header`}`,children:[e.header&&(0,I.jsx)(LX,{header:e.header,title:e.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:_X,children:t}),!e.header&&t]})}};(function(e){function t(e,t){return t?{kind:`header`,label:e,...t}:{kind:`header`,label:e}}e.Header=t;function n(e,t,n){return{kind:`item`,label:e,value:t,...n}}e.Item=n;function r(t,n){let{label:r,value:i,category:a,selected:o,icon:s,addOn:c,description:l}=n||{},u,d=[];for(let f=0;f<t.length;f++){let p=t[f];if(n?.filter&&!n.filter(p))continue;let m=a?.(p),h=r?r(p):``+p,g=i?i(p):p,_=l?l(p):typeof p==`string`?p:void 0,v;m?(u||=new Map,v=u.get(m),v||(v=[e.Header(m,{description:m})],u.set(m,v),d.push(v))):v=d;let y=c?.(p);v.push({kind:`item`,label:h,value:g,icon:s?s(p):void 0,selected:o?o(p):void 0,addOn:y,description:_})}return d}e.createItems=r;let i={value:e=>e[0],label:e=>e[1],category:e=>e[2]};function a(e,t){return r(e,t?{...i,...t}:i)}e.createItemsFromSelectOptions=a;function o(e){if(Q2(e))return!1;if(Z2(e))return!!e.selected;for(let t of e)if(o(t))return!0;return!1}e.hasSelectedItem=o;function s(e,t){if(!Q2(e)){if(Z2(e))return e.value===t?e:void 0;for(let n of e){let e=s(n,t);if(e)return e}}}e.findItem=s;function c(e){if(!Q2(e)){if(Z2(e))return e;for(let t of e){let e=c(t);if(e)return e}}}e.getFirstItem=c})(Y2||={});var T7e=class e extends y.PureComponent{constructor(){super(...arguments),this.state=e.createState(this.props),this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()},this.selectAll=()=>{let e=$2(this.props.items,[]).filter(e=>!e.selected);this.props.onSelect(e)},this.selectNone=()=>{let e=$2(this.props.items,[]).filter(e=>!!e.selected);this.props.onSelect(e)}}static createState(e,t){let n=X2(e.items)&&Q2(e.items[0])?e.items[0]:void 0,r=n?.isIndependent?!1:e.multiselect?Y2.hasSelectedItem(e.items):!!e.current&&!!Y2.findItem(e.items,e.current.value)||Y2.hasSelectedItem(e.items);return{header:n,hasCurrent:r,isExpanded:r||(t??!!n?.initiallyExpanded)}}componentDidUpdate(t){if(this.props.items!==t.items||this.props.current!==t.current){let n=X2(this.props.items)&&X2(t.items)&&Q2(this.props.items[0])&&Q2(t.items[0])&&this.props.items[0].label===t.items[0].label?this.state.isExpanded:void 0;this.setState(e.createState(this.props,n))}}get multiselectHeader(){let{header:e,hasCurrent:t}=this.state;return(0,I.jsxs)(`div`,{className:`msp-flex-row msp-control-group-header`,children:[(0,I.jsx)(VX,{icon:this.state.isExpanded?sX:cX,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?`collapse`:`expand`}.${e?.description?` ${e?.description}`:``}`,children:t?(0,I.jsx)(`b`,{children:e?.label}):e?.label}),(0,I.jsx)(VX,{icon:hX,flex:!0,onClick:this.selectAll,style:{flex:`0 0 50px`,textAlign:`right`},children:`All`}),(0,I.jsx)(VX,{icon:_X,flex:!0,onClick:this.selectNone,style:{flex:`0 0 50px`,textAlign:`right`},children:`None`})]})}get basicHeader(){let{header:e,hasCurrent:t}=this.state;return(0,I.jsx)(`div`,{className:`msp-control-group-header`,style:{marginTop:`1px`},children:(0,I.jsx)(VX,{noOverflow:!0,icon:this.state.isExpanded?sX:cX,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?`collapse`:`expand`}. ${e?.description?e?.description:``}`,children:t?(0,I.jsx)(`b`,{children:e?.label}):e?.label})})}render(){let{items:t,onSelect:n,current:r}=this.props;if(Q2(t))return null;if(Z2(t))return(0,I.jsx)(E7e,{item:t,onSelect:n,current:r,multiselect:this.props.multiselect});let{header:i}=this.state;return(0,I.jsxs)(I.Fragment,{children:[i&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,I.jsx)(`div`,{className:this.props.noOffset?void 0:this.props.noAccent?`msp-control-offset`:`msp-accent-offset`,children:(!i||this.state.isExpanded)&&t.map((t,i)=>Q2(t)?null:Z2(t)?(0,I.jsx)(E7e,{item:t,onSelect:n,current:r,multiselect:this.props.multiselect},i):(0,I.jsx)(e,{items:t,onSelect:n,current:r,multiselect:this.props.multiselect,noAccent:!0},i))})]})}},E7e=({item:e,onSelect:t,current:n,multiselect:r})=>{let i=n===e,a=e.addOn?{position:`relative`}:void 0;return(0,I.jsxs)(VX,{icon:e.icon,noOverflow:!0,className:`msp-action-menu-button`,onClick:n=>t(r?[e]:e,n),disabled:e.disabled,style:a,title:e.description,children:[i||e.selected?(0,I.jsx)(`b`,{children:e.label}):e.label,e.addOn]})};function X2(e){return!!e&&Array.isArray(e)}function Z2(e){let t=e;return t&&t.kind===`item`}function Q2(e){let t=e;return t&&t.kind===`header`}function $2(e,t){if(Q2(e))return t;if(Z2(e))return t.push(e),t;for(let n of e)$2(n,t);return t}const D7e=Nfe([[`black`,0],[`gray`,8421504],[`white`,16777215],[`red`,13840661],[`orange`,14840576],[`yellow`,16565248],[`green`,6863872],[`cyan`,1484197],[`blue`,40160],[`purple`,8086783],[`magenta`,16394495],[`violet`,8200583]]);var O7e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()},this.onClickSwatch=e=>{let t=tE.fromHexString(e.currentTarget.getAttribute(`data-color`)||`0`);t!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(t))},this.onR=e=>{let[,t,n]=tE.toRgb(this.props.value),r=tE.fromRgb(e,t,n);r!==this.props.value&&this.update(r)},this.onG=e=>{let[t,,n]=tE.toRgb(this.props.value),r=tE.fromRgb(t,e,n);r!==this.props.value&&this.update(r)},this.onB=e=>{let[t,n]=tE.toRgb(this.props.value),r=tE.fromRgb(t,n,e);r!==this.props.value&&this.update(r)},this.onRGB=e=>{let t=tE.fromHexStyle(e.currentTarget.value||`0`);t!==this.props.value&&this.update(t)},this.onLighten=()=>{this.update(tE.lighten(this.props.value,.1))},this.onDarken=()=>{this.update(tE.darken(this.props.value,.1))}}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}swatch(){return(0,I.jsx)(`div`,{className:`msp-combined-color-swatch`,children:D7e.map(e=>(0,I.jsx)(VX,{inline:!0,"data-color":e[1],onClick:this.onClickSwatch,style:{background:tE.toStyle(e[1])}},e[1]))})}render(){let e=this.props.param.label||KT(this.props.name),[t,n,r]=tE.toRgb(this.props.value),i=(0,I.jsxs)(I.Fragment,{children:[this.swatch(),(0,I.jsx)(GX,{label:`RGB`,className:`msp-control-label-short`,control:(0,I.jsxs)(`div`,{style:{display:`flex`,textAlignLast:`center`,left:`80px`},children:[(0,I.jsx)(zX,{onChange:this.onR,numeric:!0,value:t,delayMs:250,style:{order:1,flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,I.jsx)(zX,{onChange:this.onG,numeric:!0,value:n,delayMs:250,style:{order:2,flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,I.jsx)(zX,{onChange:this.onB,numeric:!0,value:r,delayMs:250,style:{order:3,flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,I.jsx)(`input`,{onInput:this.onRGB,type:`color`,value:tE.toHexStyle(this.props.value),style:{order:4,flex:`1 1 auto`,minWidth:`32px`,width:`32px`,height:`32px`,padding:`0 2px 0 2px`,background:`none`,border:`none`,cursor:`pointer`}})]})}),(0,I.jsxs)(`div`,{style:{display:`flex`,textAlignLast:`center`},children:[(0,I.jsx)(VX,{onClick:this.onLighten,style:{order:1,flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,children:`Lighten`}),(0,I.jsx)(VX,{onClick:this.onDarken,style:{order:1,flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,children:`Darken`})]})]});return this.props.hideNameRow?i:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{title:this.props.param.description,label:e,control:(0,I.jsx)(VX,{onClick:this.toggleExpanded,inline:!0,className:`msp-combined-color-button`,style:{background:tE.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:i})]})}};(function(){let e=new Map;for(let t of D7e)e.set(t[1],t[0]);return e})();function k7e(e){switch(e.kind){case`scale-legend`:return A7e;case`table-legend`:return j7e;default:let t=e;console.warn(`${t} has no associated UI component`);return}}var A7e=class extends y.PureComponent{render(){let{legend:e}=this.props;return(0,I.jsx)(`div`,{className:`msp-scale-legend`,children:(0,I.jsxs)(`div`,{style:{background:`linear-gradient(to right, ${e.colors.map(e=>Array.isArray(e)?`${tE.toStyle(e[0])} ${100*e[1]}%`:tE.toStyle(e)).join(`, `)})`},children:[(0,I.jsx)(`span`,{style:{float:`left`},children:e.minLabel}),(0,I.jsx)(`span`,{style:{float:`right`},children:e.maxLabel})]})})}},j7e=class extends y.PureComponent{render(){let{legend:e}=this.props;return(0,I.jsx)(`div`,{className:`msp-table-legend`,children:e.table.map((e,t)=>{let[n,r]=e;return(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-table-legend-color`,style:{backgroundColor:tE.toStyle(r)}}),(0,I.jsx)(`div`,{className:`msp-table-legend-text`,children:n})]},t)})})}},M7e=class extends y.Component{constructor(e){super(e),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});let e=R.create(this.props.nX,this.props.nY);this.props.onmouseover(e)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,I.jsx)(`circle`,{r:`10`,id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:`black`},`${this.props.id}circle`)]}},N7e=class extends y.Component{constructor(e){super(e),this.handleKeyDown=e=>{},this.handleKeyUp=e=>{},this.handleClick=e=>e=>{},this.handleMouseDown=e=>t=>{if(e===0||e===this.state.points.length-1||this.state.canSelectMultiple)return;let n=this.normalizePoint(R.create(this.state.points[e][0],this.state.points[e][1]));this.ghostPoints.push(document.createElementNS(this.namespace,`circle`)),this.ghostPoints[0].setAttribute(`r`,`10`),this.ghostPoints[0].setAttribute(`fill`,`orange`),this.ghostPoints[0].setAttribute(`cx`,`${n[0]}`),this.ghostPoints[0].setAttribute(`cy`,`${n[1]}`),this.ghostPoints[0].setAttribute(`style`,`display: none`),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=n[0],this.updatedY=n[1],this.selected=[e]},this.deletePoint=e=>t=>{if(e===0||e===this.state.points.length-1)return;let n=this.state.points.filter((t,n)=>n!==e);n.sort((e,t)=>e[0]===t[0]?e[0]===0?e[1]-t[1]:e[1]===1?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:n}),this.change(n),t.stopPropagation()},this.myRef=y.createRef(),this.state={points:[R.create(0,0),R.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace=`http://www.w3.org/2000/svg`;for(let e of this.props.data)this.state.points.push(e);this.state.points.sort((e,t)=>e[0]===t[0]?e[0]===0?e[1]-t[1]:e[1]===1?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){let e=this.renderPoints(),t=this.renderLines(),n=this.renderHistogram();return[(0,I.jsx)(`div`,{children:(0,I.jsxs)(`svg`,{className:`msp-canvas`,ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,I.jsxs)(`g`,{stroke:`black`,fill:`black`,children:[n,t,e]}),(0,I.jsx)(`g`,{className:`ghost-points`,stroke:`black`,fill:`black`})]})},`LineGraph`),(0,I.jsx)(`div`,{id:`modal-root`},`modal`)]}componentDidMount(){this.gElement=document.getElementsByClassName(`ghost-points`)[0]}change(e){let t=e.slice();t.shift(),t.pop(),this.props.onChange(t)}handleDrag(e){if(this.selected===void 0)return;let t=this.myRef.createSVGPoint(),n,r=this.padding/2;t.x=e.clientX,t.y=e.clientY;let i=t.matrixTransform(this.myRef.getScreenCTM().inverse());n=R.create(i.x,i.y),n=(i.x<r||i.x>this.width+r)&&(i.y>this.height+r||i.y<r)?R.create(this.updatedX,this.updatedY):i.x<r?R.create(r,i.y):i.x>this.width+r?R.create(this.width+r,i.y):i.y>this.height+r?R.create(i.x,this.height+r):i.y<r?R.create(i.x,r):R.create(i.x,i.y),this.updatedX=n[0],this.updatedY=n[1];let a=this.unNormalizePoint(n);this.ghostPoints[0].setAttribute(`style`,`display: visible`),this.ghostPoints[0].setAttribute(`cx`,`${n[0]}`),this.ghostPoints[0].setAttribute(`cy`,`${n[1]}`),this.props.onDrag(a)}handleMultipleDrag(){}handlePointUpdate(e){let t=this.selected;if(this.state.canSelectMultiple)return;if(t===void 0||t[0]===0||t[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;let n=this.unNormalizePoint(R.create(this.updatedX,this.updatedY)),r=this.state.points.filter((e,n)=>n!==t[0]);r.push(n),r.sort((e,t)=>e[0]===t[0]?e[0]===0?e[1]-t[1]:e[1]===1?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:r}),this.change(r),this.gElement.innerHTML=``,this.ghostPoints=[],document.removeEventListener(`mousemove`,this.handleDrag,!0),document.removeEventListener(`mouseup`,this.handlePointUpdate,!0)}handleDoubleClick(e){let t=this.myRef.createSVGPoint();t.x=e.clientX,t.y=e.clientY;let n=t.matrixTransform(this.myRef.getScreenCTM().inverse()),r=this.state.points,i=this.padding/2;if(n.x<i||n.x>this.width+i||n.y>this.height+i||n.y<this.padding/2)return;let a=this.unNormalizePoint(R.create(n.x,n.y));r.push(a),r.sort((e,t)=>e[0]===t[0]?e[0]===0?e[1]-t[1]:e[1]===1?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:r}),this.change(r)}handleLeave(){this.selected!==void 0&&(document.addEventListener(`mousemove`,this.handleDrag,!0),document.addEventListener(`mouseup`,this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener(`mousemove`,this.handleDrag,!0),document.removeEventListener(`mouseup`,this.handlePointUpdate,!0)}normalizePoint(e){let t=this.padding/2,n=this.width+t,r=this.height+t,i=e[0]*(n-t)+t,a=e[1]*(r-t)+t,o=this.height+this.padding-a;return R.create(i,o)}unNormalizePoint(e){let t=this.padding/2,n=this.width+t,r=this.height+t,i=(e[0]-t)/(n-t),a=(this.height+this.padding-e[1]-t)/(r-t);return R.create(i,a)}refCallBack(e){e&&(this.myRef=e)}renderHistogram(){if(!this.props.volume)return null;let e=NP.getHistogram(this.props.volume.grid,40),t=[],n=e.counts.length,r=this.width/n,i=this.padding/2,a=bE(e.counts)||1;for(let o=0;o<n;o++){let s=this.width*o/(n-1)+i,c=this.height+i,l=this.height*(1-e.counts[o]/a)+i;t.push((0,I.jsx)(`line`,{x1:s,x2:s,y1:c,y2:l,stroke:`#ded9ca`,strokeWidth:r},`histogram${o}`))}return t}renderPoints(){let e=[],t;for(let n=0;n<this.state.points.length;n++)n!==0&&n!==this.state.points.length-1&&(t=this.normalizePoint(this.state.points[n]),e.push((0,I.jsx)(M7e,{id:n,x:t[0],y:t[1],nX:this.state.points[n][0],nY:this.state.points[n][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(n),onclick:this.handleClick(n)},n)));return e}renderLines(){let e=[],t=[],n,r,i,a,o,s=this.padding/2;for(let t of this.state.points)n=this.width+s,r=this.height+this.padding,i=t[0]*(n-s)+s,a=t[1]*(r-s)+s,o=this.height+this.padding-a,e.push(R.create(i,o));let c=e,l=c.length;for(let e=0;e<l-1;e++){let n=c[e][0],r=c[e][1],i=c[e+1][0],a=c[e+1][1];t.push((0,I.jsx)(`line`,{x1:n,x2:i,y1:r,y2:a,stroke:`#cec9ba`,strokeWidth:`5`},`lineOf${e}`))}return t}},e4=class extends y.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:0},this.begin=()=>{this.setState({isChanging:!0})},this.end=e=>{this.setState({isChanging:!1}),this.props.onChange(e)},this.updateCurrent=e=>{var t,n;this.setState({current:e}),(n=(t=this.props).onChangeImmediate)==null||n.call(t,e)},this.updateManually=e=>{this.setState({isChanging:!0});let t=e;this.props.step===1&&(t=Math.round(t)),t<this.props.min&&(t=this.props.min),t>this.props.max&&(t=this.props.max),this.setState({current:t,isChanging:!0})},this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)},this.onMouseWheel=e=>{let{dx:t,dy:n,dz:r}=e0e(e),i=(t>=0?1:-1)*(n>=0?1:-1)*(r>=0?1:-1),a=e.getModifierState(`Shift`),o=i*(this.props.max-this.props.min)/(a?100:25);this.updateCurrent(this.state.current+o)}}static getDerivedStateFromProps(e,t){return t.isChanging||e.value===t.current?null:{current:e.value}}render(){let e=this.props.step;return e===void 0&&(e=1),(0,I.jsxs)(`div`,{className:this.props.hideInput?`msp-slider msp-slider-no-input`:`msp-slider`,children:[(0,I.jsx)(`div`,{children:(0,I.jsx)(r4,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onWheel:this.onMouseWheel,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,I.jsx)(`div`,{children:(0,I.jsx)(zX,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}},P7e=class extends y.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:[0,1]},this.begin=()=>{this.setState({isChanging:!0})},this.end=e=>{this.setState({isChanging:!1}),this.props.onChange(e)},this.updateCurrent=e=>{this.setState({current:e})},this.updateMax=e=>{let t=e;this.props.step===1&&(t=Math.round(t)),t<this.state.current[0]?t=this.state.current[0]:t<this.props.min&&(t=this.props.min),t>this.props.max&&(t=this.props.max),this.props.onChange([this.state.current[0],t])},this.updateMin=e=>{let t=e;this.props.step===1&&(t=Math.round(t)),t<this.props.min&&(t=this.props.min),t>this.state.current[1]?t=this.state.current[1]:t>this.props.max&&(t=this.props.max),this.props.onChange([t,this.state.current[1]])}}static getDerivedStateFromProps(e,t){return t.isChanging||e.value[0]===t.current[0]&&e.value[1]===t.current[1]?null:{current:e.value}}render(){let e=this.props.step;return e===void 0&&(e=1),(0,I.jsxs)(`div`,{className:`msp-slider2`,children:[(0,I.jsx)(`div`,{children:(0,I.jsx)(zX,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,I.jsx)(`div`,{children:(0,I.jsx)(r4,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,I.jsx)(`div`,{children:(0,I.jsx)(zX,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}};function t4(e){let t=[],n={}.hasOwnProperty;for(let e=0;e<arguments.length;e++){let r=arguments[e];if(!r)continue;let i=typeof r;if(i===`string`||i===`number`)t.push(r);else if(Array.isArray(r))t.push(t4.apply(null,r));else if(i===`object`)for(let e in r)n.call(r,e)&&r[e]&&t.push(e)}return t.join(` `)}function F7e(e){return e.touches.length>1||e.type.toLowerCase()===`touchend`&&e.touches.length>0}function I7e(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function L7e(e,t){return e?t.clientY:t.pageX}function R7e(e,t){let n=t.getBoundingClientRect();return e?n.top+n.height*.5:n.left+n.width*.5}function n4(e){e.stopPropagation(),e.preventDefault()}var z7e=class extends y.Component{render(){let{className:e,tipFormatter:t,vertical:n,offset:r,value:i,index:a}=this.props;return(0,I.jsx)(`div`,{className:e,style:n?{bottom:`${r}%`}:{left:`${r}%`},title:t(i,a)})}},r4=class extends y.Component{constructor(e){super(e),this.sliderElement=y.createRef(),this.handleElements=[],this.dragOffset=0,this.startPosition=0,this.startValue=0,this._getPointsCache=void 0,this.onMouseDown=e=>{if(e.button!==0)return;let t=L7e(this.props.vertical,e);if(!this.isEventFromHandle(e))this.dragOffset=0;else{let n=R7e(this.props.vertical,e.target);this.dragOffset=t-n,t=n}this.onStart(t),this.addDocumentEvents(`mouse`),n4(e)},this.onTouchMove=e=>{if(F7e(e)){this.end(`touch`);return}let t=I7e(this.props.vertical,e);this.onMove(e,t-this.dragOffset)},this.onTouchStart=e=>{if(F7e(e))return;let t=I7e(this.props.vertical,e);if(!this.isEventFromHandle(e))this.dragOffset=0;else{let n=R7e(this.props.vertical,e.target);this.dragOffset=t-n,t=n}this.onStart(t),this.addDocumentEvents(`touch`),n4(e)},this.eventHandlers={touchmove:e=>this.onTouchMove(e),touchend:e=>this.end(`touch`),mousemove:e=>this.onMouseMove(e),mouseup:e=>this.end(`mouse`)},this.calcOffset=e=>{let{min:t,max:n}=this.props;return(e-t)/(n-t)*100};let{range:t,min:n,max:r}=e,i=t?Array.apply(null,Array(+t+1)).map(()=>n):n,a=`defaultValue`in e?e.defaultValue:i,o=e.value===void 0?a:e.value,s=(t?o:[n,o]).map(e=>this.trimAlignValue(e)),c;c=t&&s[0]===s[s.length-1]&&s[0]===r?0:s.length-1,this.state={handle:null,recent:c,bounds:s}}componentDidUpdate(e){if(!(`value`in this.props||`min`in this.props||`max`in this.props))return;let{bounds:t}=this.state;if(e.range){let e=(this.props.value||t).map(e=>this.trimAlignValue(e,this.props));if(e.every((e,n)=>e===t[n]))return;this.setState({bounds:e}),t.some(e=>this.isValueOutOfBounds(e,this.props))&&this.props.onChange(e)}else{let n=this.props.value===void 0?t[1]:this.props.value,r=this.trimAlignValue(n,this.props);if(r===t[1]&&t[0]===e.min)return;this.setState({bounds:[e.min,r]}),this.isValueOutOfBounds(t[1],this.props)&&this.props.onChange(r)}}onChange(e){let t=this.props;`value`in t?e.handle!==void 0&&this.setState({handle:e.handle}):this.setState(e);let n={...this.state,...e},r=t.range?n.bounds:n.bounds[1];t.onChange(r)}onMouseMove(e){let t=L7e(this.props.vertical,e);this.onMove(e,t-this.dragOffset)}onMove(e,t){n4(e);let n=this.props,r=this.state,i=t-this.startPosition;i=this.props.vertical?-i:i;let a=i/this.getSliderLength()*(n.max-n.min),o=this.trimAlignValue(this.startValue+a);if(o===r.bounds[r.handle])return;let s=[...r.bounds];s[r.handle]=o;let c=r.handle;if(n.pushable){let e=r.bounds[c];this.pushSurroundingHandles(s,c,e)}else n.allowCross&&(s.sort((e,t)=>e-t),c=s.indexOf(o));this.onChange({handle:c,bounds:s})}onStart(e){this.props.onBeforeChange(this.getValue());let t=this.calcValueByPos(e);this.startValue=t,this.startPosition=e;let n=this.state,{bounds:r}=n,i=1;if(this.props.range){let e=0;for(let n=1;n<r.length-1;++n)t>r[n]&&(e=n);Math.abs(r[e+1]-t)<Math.abs(r[e]-t)&&(e+=1),i=e;let a=r[e+1]===r[e];a&&(i=n.recent),a&&t!==r[e+1]&&(i=t<r[e+1]?e:e+1)}if(this.setState({handle:i,recent:i}),t===n.bounds[i])return;let a=[...n.bounds];a[i]=t,this.onChange({bounds:a})}getPoints(){let{marks:e,step:t,min:n,max:r}=this.props,i=this._getPointsCache;if(!i||i.marks!==e||i.step!==t){let i={...e};if(t!==null)for(let e=n;e<=r;e+=t)i[e]=e;let a=Object.keys(i).map(parseFloat);a.sort((e,t)=>e-t),this._getPointsCache={marks:e,step:t,points:a}}return this._getPointsCache.points}getPrecision(e){let t=e.toString(),n=0;return t.indexOf(`.`)>=0&&(n=t.length-t.indexOf(`.`)-1),n}getSliderLength(){let e=this.sliderElement.current;return e?this.props.vertical?e.clientHeight:e.clientWidth:0}getSliderStart(){let e=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?e.top:e.left}getValue(){let{bounds:e}=this.state;return this.props.range?e:e[1]}addDocumentEvents(e){e===`touch`?(document.addEventListener(`touchmove`,this.eventHandlers.touchmove),document.addEventListener(`touchend`,this.eventHandlers.touchend)):e===`mouse`&&(document.addEventListener(`mousemove`,this.eventHandlers.mousemove),document.addEventListener(`mouseup`,this.eventHandlers.mouseup))}calcValue(e){let{vertical:t,min:n,max:r}=this.props,i=Math.abs(e/this.getSliderLength());return t?(1-i)*(r-n)+n:i*(r-n)+n}calcValueByPos(e){let t=e-this.getSliderStart();return this.trimAlignValue(this.calcValue(t))}end(e){this.removeEvents(e),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(e){for(let t of this.handleElements)if(t.current===e.target)return!0;return!1}isValueOutOfBounds(e,t){return e<t.min||e>t.max}pushHandle(e,t,n,r){let i=e[t],a=e[t];for(;n*(a-i)<r;){if(!this.pushHandleOnePoint(e,t,n))return e[t]=i,!1;a=e[t]}return!0}pushHandleOnePoint(e,t,n){let r=this.getPoints(),i=r.indexOf(e[t])+n;if(i>=r.length||i<0)return!1;let a=t+n,o=r[i],{pushable:s}=this.props,c=n*(e[a]-o);return this.pushHandle(e,a,n,+s-c)?(e[t]=o,!0):!1}pushSurroundingHandles(e,t,n){let{pushable:r}=this.props,i=e[t],a=0;if(e[t+1]-i<+r?a=1:i-e[t-1]<+r&&(a=-1),a===0)return;let o=t+a,s=a*(e[o]-i);this.pushHandle(e,o,a,+r-s)||(e[t]=n)}removeEvents(e){e===`touch`?(document.removeEventListener(`touchmove`,this.eventHandlers.touchmove),document.removeEventListener(`touchend`,this.eventHandlers.touchend)):e===`mouse`&&(document.removeEventListener(`mousemove`,this.eventHandlers.mousemove),document.removeEventListener(`mouseup`,this.eventHandlers.mouseup))}trimAlignValue(e,t){let{handle:n,bounds:r}=this.state||{},{marks:i,step:a,min:o,max:s,allowCross:c}={...this.props,...t||{}},l=e;l<=o&&(l=o),l>=s&&(l=s),!c&&n!=null&&n>0&&l<=r[n-1]&&(l=r[n-1]),!c&&n!=null&&n<r.length-1&&l>=r[n+1]&&(l=r[n+1]);let u=Object.keys(i).map(parseFloat);if(a!==null){let e=Math.round((l-o)/a)*a+o;u.push(e)}let d=u.map(e=>Math.abs(l-e)),f=u[d.indexOf(Math.min.apply(Math,d))];return a===null?f:parseFloat(f.toFixed(this.getPrecision(a)))}render(){let{handle:e,bounds:t}=this.state,{className:n,prefixCls:r,disabled:i,vertical:a,range:o,step:s,marks:c,tipFormatter:l}=this.props,u=this.props.handle,d=t.map(this.calcOffset),f=`${r}-handle`,p=t.map((e,n)=>t4({[f]:!0,[`${f}-${n+1}`]:!0,[`${f}-lower`]:n===0,[`${f}-upper`]:n===t.length-1})),m={prefixCls:r,noTip:s===null||l===null,tipFormatter:l,vertical:a};if(this.handleElements.length!==t.length){this.handleElements=[];for(let e=0;e<t.length;e++)this.handleElements.push(y.createRef())}let h=t.map((t,n)=>y.cloneElement(u,{...m,className:p[n],value:t,offset:d[n],dragging:e===n,index:n,key:n,ref:this.handleElements[n]}));o||h.shift();let g=t4({[r]:!0,[`${r}-with-marks`]:Object.keys(c).length,[`${r}-disabled`]:i,[`${r}-vertical`]:this.props.vertical,[n]:!!n});return(0,I.jsxs)(`div`,{ref:this.sliderElement,className:g,onTouchStart:i?xx:this.onTouchStart,onMouseDown:i?xx:this.onMouseDown,onWheel:i?xx:this.props.onWheel,children:[(0,I.jsx)(`div`,{className:`${r}-rail`}),h]})}};r4.defaultProps={prefixCls:`msp-slider-base`,className:``,min:0,max:100,step:1,marks:{},handle:(0,I.jsx)(z7e,{className:``,vertical:!1,offset:0,tipFormatter:e=>e,value:0,index:0}),onBeforeChange:xx,onChange:xx,onAfterChange:xx,tipFormatter:(e,t)=>e,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1};var B7e=/^#([0-9A-F]{3}){1,2}$/i,V7e=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i;function H7e(e){if(e==null)return;let t;if(B7e.test(e)&&(e.length===4&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),t=tE.fromHexStyle(e),t!==void 0&&!isNaN(t))||(t=gk[e.toLowerCase()],t!==void 0))return t;let n=V7e.exec(e);if(n){let e=parseInt(n[1],10),t=parseInt(n[2],10),r=parseInt(n[3],10);if(e>=0&&e<=255&&t>=0&&t<=255&&r>=0&&r<=255)return tE.fromRgb(e,t,r)}}function U7e(e){let t=e.length,n=[];if(e.every(e=>Array.isArray(e))){let t=[...e];if(!t[0])return`linear-gradient(to right, #000 0%, #000 100%)`;t.sort((e,t)=>e[1]-t[1]),n.push(`${tE.toStyle(t[0][0])} ${(100*t[0][1]).toFixed(2)}%`);for(let e=0,r=t.length-1;e<r;++e){let[r,i]=t[e],[a,o]=t[e+1],s=i+(o-i)/2;n.push(`${tE.toStyle(r)} ${(100*s).toFixed(2)}%`,`${tE.toStyle(a)} ${(100*s).toFixed(2)}%`)}n.push(`${tE.toStyle(t[t.length-1][0])} ${(100*t[t.length-1][1]).toFixed(2)}%`)}else{n.push(`${i4(e[0])} ${100*(1/t)}%`);for(let r=1,i=t-1;r<i;++r)n.push(`${i4(e[r])} ${100*(r/t)}%`,`${i4(e[r])} ${100*((r+1)/t)}%`);n.push(`${i4(e[t-1])} ${100*((t-1)/t)}%`)}return`linear-gradient(to right, ${n.join(`, `)})`}function W7e(e){if(e.length===0)return`linear-gradient(to right, #000 0%, #000 100%)`;let t=e.every(e=>Array.isArray(e)),n;if(t){let t=[...e];t.sort((e,t)=>e[1]-t[1]),n=t.map(e=>i4(e,!0))}else n=e.map(e=>i4(e));return`linear-gradient(to right, ${n.join(`, `)})`}function i4(e,t=!1){return Array.isArray(e)?t?`${tE.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:tE.toStyle(e[0]):tE.toStyle(e)}function G7e(e,t=/,/){let n=[],r=e.replace(/\s+/g,``),i=0,a=0;for(let e=0,o=r.length;e<o;++e){let o=r[e];if(o===`(`){a++;continue}else if(o===`)`){a>0&&a--;continue}if(a>0||!t.test(o))continue;let s=r.substring(i,e);i=e+1;let c=H7e(s);c!==void 0&&n.push(c)}if(i<r.length){let e=r.substring(i),t=H7e(e);console.log(e,t),t!==void 0&&n.push(t)}return n}var a4=class extends y.PureComponent{constructor(){super(...arguments),this.onChange=e=>{var t,n;if((n=(t=this.props).onChange)==null||n.call(t,e,this.props.values),this.props.onChangeValues){let t={...this.props.values,[e.name]:e.value};this.props.onChangeValues(t,this.props.values)}},this.paramGroups=gA(e=>q7e(e))}renderGroup(e){if(e.length===0)return null;let t=this.props.values,n=null,r;for(let[i,a,o]of e)a.hideIf?.call(a,t)||(n||=[],r=a.category,n.push((0,I.jsx)(o,{param:a,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:i,value:t[i]},i)));return n?r?[(0,I.jsx)(WX,{header:r,children:n},r)]:n:null}renderPart(e){let t=null;for(let n of e){let e=this.renderGroup(n);if(e){t||=[];for(let n of e)t.push(n)}}return t}render(){let e=this.paramGroups(this.props.params),t=this.renderPart(e.essentials),n=this.renderPart(e.advanced);return t&&n?(0,I.jsxs)(I.Fragment,{children:[t,(0,I.jsx)(WX,{header:`Advanced Options`,children:n})]}):t||n}},K7e=class extends qX{constructor(){super(...arguments),this.state={isDisabled:!1},this.setSettings=(e,t)=>{let n={...t,[e.name]:e.value},r=this.props.mapping.update(n,this.plugin);this.props.mapping.apply(r,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,e=>{this.setState({isDisabled:e})})}render(){let e=this.props.mapping.getTarget(this.plugin),t=this.props.mapping.getValues(e,this.plugin);return(0,I.jsx)(a4,{params:this.props.mapping.params(this.plugin),values:t,onChange:this.setSettings,isDisabled:this.state.isDisabled})}};function q7e(e){function t(e,t,n){let r=o4(t);if(r)if(!t.category)n.params[0].push([e,t,r]);else{n.map||=new Map;let i=n.map.get(t.category);i||(i=[],n.map.set(t.category,i),n.params.push(i)),i.push([e,t,r])}}function n(e,t){let n=e[0],r=t[0];return!n||!n[1].category?-1:!r||!r[1].category?1:n[1].category<r[1].category?-1:1}let r=Object.keys(e),i={params:[[]],map:void 0},a={params:[[]],map:void 0};for(let n of r){let r=e[n];r.isHidden||(r.isEssential?t(n,r,i):t(n,r,a))}return i.params.sort(n),a.params.sort(n),{essentials:i.params,advanced:a.params}}function o4(e){switch(e.type){case`value`:return;case`boolean`:return l4;case`number`:return e.min!==void 0&&e.max!==void 0?Q7e:Z7e;case`converted`:return S9e;case`conditioned`:return x9e;case`multi-select`:return g9e;case`color`:return O7e;case`color-list`:return e.offsets?u9e:l9e;case`vec3`:return d9e;case`mat4`:return f9e;case`url`:return p9e;case`file`:return m9e;case`file-list`:return h9e;case`select`:return d4;case`value-ref`:return t9e;case`data-ref`:return;case`text`:return $7e;case`interval`:return e.min!==void 0&&e.max!==void 0?r9e:n9e;case`group`:return _9e;case`mapped`:return v9e;case`line-graph`:return X7e;case`script`:return C9e;case`object-list`:return m4;default:let t=e;console.warn(`${t} has no associated UI component`);return}}var J7e=class extends y.PureComponent{render(){let{legend:e,description:t}=this.props,n=e&&k7e(e);return(0,I.jsx)(`div`,{className:`msp-help-text`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsxs)(`div`,{className:`msp-help-description`,children:[(0,I.jsx)(XY,{svg:xX,inline:!0}),t]}),n&&(0,I.jsx)(`div`,{className:`msp-help-legend`,children:(0,I.jsx)(n,{legend:e})})]})})}};function s4(e){let{props:t,state:n,control:r,toggleHelp:i,addOn:a}=e,o=[];t.param.shortLabel&&o.push(`msp-control-label-short`),t.param.twoColumns&&o.push(`msp-control-col-2`),t.param.multiline&&o.push(`msp-control-twoline`);let s=o.join(` `),c=t.param.label||KT(t.name),l=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},u=l.description||l.legend,d=c+(u?`. Click for help.`:``);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{className:s,title:d,label:(0,I.jsxs)(I.Fragment,{children:[c,u&&(0,I.jsx)(Y7e,{show:n.showHelp,toggle:i,title:d})]}),control:r}),u&&n.showHelp&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(J7e,{legend:l.legend,description:l.description})}),a]})}function Y7e({show:e,toggle:t,title:n}){return(0,I.jsx)(`button`,{className:`msp-help msp-btn-link msp-btn-icon msp-control-group-expander`,onClick:t,title:n||`${e?`Hide`:`Show`} help`,style:{background:`transparent`,textAlign:`left`,padding:`0`},children:(0,I.jsx)(XY,{svg:xX})})}var c4=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderAddOn(){return null}render(){return s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},l4=class extends c4{constructor(){super(...arguments),this.onClick=e=>{this.update(!this.props.value),e.currentTarget.blur()}}renderControl(){return(0,I.jsxs)(`button`,{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,I.jsx)(XY,{svg:this.props.value?hX:gX}),this.props.value?`On`:`Off`]})}},X7e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`},this.onHover=e=>{this.setState({isOverPoint:!this.state.isOverPoint}),e?this.setState({message:this.pointToLabel(e)}):this.setState({message:`${this.props.value.length} points`})},this.onDrag=e=>{this.setState({message:this.pointToLabel(e)})},this.onChange=e=>{this.props.onChange({name:this.props.name,param:this.props.param,value:e})},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}pointToLabel(e){var t;if(!e)return``;let n=(t=this.props.param).getVolume?.call(t);if(n){let{min:t,max:r,mean:i,sigma:a}=n.grid.stats,o=t+(r-t)*e[0],s=(o-i)/a;return`(${o.toFixed(2)} | ${s.toFixed(2)}, ${e[1].toFixed(2)})`}else return`(${e[0].toFixed(2)}, ${e[1].toFixed(2)})`}render(){var e;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:this.props.param.label||KT(this.props.name),control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,I.jsx)(`div`,{className:`msp-control-offset`,style:{display:this.state.isExpanded?`block`:`none`,marginTop:1},children:(0,I.jsx)(N7e,{data:this.props.value,volume:(e=this.props.param).getVolume?.call(e),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}},Z7e=class extends y.PureComponent{constructor(){super(...arguments),this.state={value:`0`},this.update=e=>{let t=yO(this.props.param.step||.01);e=parseFloat(e.toFixed(t)),this.props.onChange({param:this.props.param,name:this.props.name,value:e})}}render(){let e=this.props.param.label||KT(this.props.name),t=this.props.param.label||KT(this.props.name),n=yO(this.props.param.step||.01);return(0,I.jsx)(GX,{title:this.props.param.description,label:t,control:(0,I.jsx)(zX,{numeric:!0,value:parseFloat(this.props.value.toFixed(n)),onEnter:this.props.onEnter,placeholder:e,isDisabled:this.props.isDisabled,onChange:this.update})})}},Q7e=class extends c4{constructor(){super(...arguments),this.onChange=e=>{this.update(e)}}renderControl(){return(0,I.jsx)(e4,{value:this.props.value===void 0?this.props.param.defaultValue:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}},$7e=class extends c4{constructor(){super(...arguments),this.updateValue=e=>{e!==this.props.value&&this.update(e)}}renderControl(){let e=this.props.param.placeholder||this.props.param.label||KT(this.props.name);return(0,I.jsx)(e9e,{props:this.props,placeholder:e,update:this.updateValue})}};function e9e({props:e,placeholder:t,update:n}){let[r,i]=y.useState(e.value),[a,o]=y.useState(!1);y.useEffect(()=>i(e.value),[e.value]);let s=t=>{a||e.param.disableInteractiveUpdates?i(t.target.value):n(t.target.value)},c=t=>{o(!1);let r=t.target;e.param.disableInteractiveUpdates?i(r.value):n(r.value)},l=t=>{e.param.disableInteractiveUpdates&&n(t.target.value)},u=t=>{t.key===`Enter`&&(e.onEnter&&!e.param.multiline?(t.stopPropagation(),e.onEnter()):t.shiftKey||t.ctrlKey||t.metaKey?t.currentTarget.blur():e.param.disableInteractiveUpdates&&!e.param.multiline&&n(r))};return e.param.multiline?(0,I.jsx)(`div`,{className:`msp-control-text-area-wrapper`,children:(0,I.jsx)(`textarea`,{value:r??``,placeholder:t,disabled:e.isDisabled,onChange:s,onBlur:l,onKeyDown:u,onCompositionStart:()=>o(!0),onCompositionEnd:c})}):(0,I.jsx)(`input`,{type:`text`,value:r??``,placeholder:t,disabled:e.isDisabled,onChange:s,onBlur:l,onKeyDown:u,onCompositionStart:()=>o(!0),onCompositionEnd:c})}var u4=class extends y.PureComponent{constructor(){super(...arguments),this.onChange=e=>{typeof this.props.param.defaultValue==`number`?this.update(parseInt(e.target.value,10)):this.update(e.target.value)}}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}render(){let e=this.props.value!==void 0&&!this.props.param.options.some(e=>e[0]===this.props.value);return(0,I.jsxs)(`select`,{className:`msp-form-control`,title:this.props.title,value:this.props.value===void 0?this.props.param.defaultValue:this.props.value,onChange:this.onChange,disabled:this.props.isDisabled,children:[e&&(0,I.jsx)(`option`,{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([e,t])=>(0,I.jsx)(`option`,{value:e,children:t},e))]})}},d4=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=e=>{!e||e.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:e.value})})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.cycle=()=>{let{options:e}=this.props.param,t=e.findIndex(e=>e[0]===this.props.value),n=t===e.length-1?0:t+1;this.props.onChange({param:this.props.param,name:this.props.name,value:e[n][0]})},this.items=gA(e=>Y2.createItemsFromSelectOptions(e.options)),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){let e=this.items(this.props.param),t=this.props.value===void 0?void 0:Y2.findItem(e,this.props.value),n=t?t.label:this.props.value===void 0?`${Y2.getFirstItem(e)?.label||``} [Default]`:`[Invalid] ${this.props.value}`,r=this.props.param.cycle?this.cycle:this.toggle,i=this.props.param.cycle?`center`:`left`,a=this.props.param.cycle?this.props.value===`on`?hX:this.props.value===`off`?gX:void 0:void 0;return(0,I.jsx)(UX,{disabled:this.props.isDisabled,style:{textAlign:i,overflow:`hidden`,textOverflow:`ellipsis`},label:n,title:n,icon:a,toggle:r,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let e=this.items(this.props.param);return(0,I.jsx)(Y2,{items:e,current:Y2.findItem(e,this.props.value),onSelect:this.onSelect})}render(){return s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},t9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=e=>{!e||e.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:e.value}})})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return Y2.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){let e=this.items,t=this.props.value.ref?Y2.findItem(e,this.props.value.ref):void 0,n=t?t.label:`[Ref] ${this.props.value.ref??``}`;return(0,I.jsx)(UX,{disabled:this.props.isDisabled,style:{textAlign:`left`,overflow:`hidden`,textOverflow:`ellipsis`},label:n,title:n,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let e=this.items;return(0,I.jsx)(Y2,{items:e,current:Y2.findItem(e,this.props.value.ref),onSelect:this.onSelect})}render(){return s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}};t9e.contextType=KX;var n9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:V.Numeric(0,{step:this.props.param.step},{label:`Min`}),1:V.Numeric(0,{step:this.props.param.step},{label:`Max`})},this.componentChange=({name:e,value:t})=>{let n=[...this.props.value];n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){let e=this.props.value,t=this.props.param.label||KT(this.props.name),n=yO(this.props.param.step||.01),r=`[${e[0].toFixed(n)}, ${e[1].toFixed(n)}]`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:t,control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:r})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(a4,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},r9e=class extends c4{constructor(){super(...arguments),this.onChange=e=>{this.update(e)}}renderControl(){return(0,I.jsx)(P7e,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}},i9e=_A(W7e),a9e=_A(U7e);function f4(e,t=`0`){return{background:o9e(e.colors,e.kind===`set`),position:`absolute`,bottom:`0`,height:`4px`,right:t,left:`0`}}function o9e(e,t){return t?a9e(e):i9e(e)}function s9e(){let e=e=>{let t=sE(e[0]);return(0,I.jsx)(`div`,{style:f4({kind:t.type===`qualitative`?`set`:`interpolate`,colors:t.list})})};return{ColorPresets:{all:Y2.createItemsFromSelectOptions(oE,{addOn:e,description:e=>e[3]}),scale:Y2.createItemsFromSelectOptions(Pfe,{addOn:e,description:e=>e[3]}),set:Y2.createItemsFromSelectOptions(Ffe,{addOn:e,description:e=>e[3]})},ColorsParam:V.ObjectList({color:V.Color(0)},({color:e})=>tE.toHexString(e).toUpperCase()),OffsetColorsParam:V.ObjectList({color:V.Color(0),offset:V.Numeric(0,{min:0,max:1,step:.01})},({color:e,offset:t})=>`${tE.toHexString(e).toUpperCase()} [${t.toFixed(2)}]`),IsInterpolatedParam:V.Boolean(!1,{label:`Interpolated`})}}var p4;function c9e(){return p4||(p4=s9e(),p4)}var l9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:this.state.show===`edit`?void 0:`edit`}),this.togglePresets=()=>this.setState({show:this.state.show===`presets`?void 0:`presets`}),this.selectPreset=e=>{if(!e)return;this.setState({show:void 0});let t=sE(e.value);this.update({kind:t.type===`qualitative`?`set`:`interpolate`,colors:t.list})},this.colorsChanged=({value:e})=>{this.update({kind:this.props.value.kind,colors:e.map(e=>e.color)})},this.isInterpolatedChanged=({value:e})=>{this.update({kind:e?`interpolate`:`set`,colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderControl(){let{value:e}=this.props;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`button`,{onClick:this.toggleEdit,style:{position:`relative`,paddingRight:`33px`},children:[e.colors.length===1?`1 color`:`${e.colors.length} colors`,(0,I.jsx)(`div`,{style:f4(e,`33px`)})]}),(0,I.jsx)(HX,{svg:dX,onClick:this.togglePresets,toggleState:this.state.show===`presets`,title:`Color Presets`,style:{padding:0,position:`absolute`,right:0,top:0,width:`32px`}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:e,ColorsParam:t,IsInterpolatedParam:n}=c9e(),r=e[this.props.param.presetKind];return this.state.show===`presets`?(0,I.jsx)(Y2,{items:r,onSelect:this.selectPreset}):(0,I.jsxs)(`div`,{className:`msp-control-offset`,children:[(0,I.jsx)(m4,{name:`colors`,param:t,value:this.props.value.colors.map(e=>({color:Array.isArray(e)?e[0]:e})),onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,I.jsx)(l4,{name:`isInterpolated`,param:n,value:this.props.value.kind===`interpolate`,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},u9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:this.state.show===`edit`?void 0:`edit`}),this.togglePresets=()=>this.setState({show:this.state.show===`presets`?void 0:`presets`}),this.selectPreset=e=>{if(!e)return;this.setState({show:void 0});let t=sE(e.value);this.update({kind:t.type===`qualitative`?`set`:`interpolate`,colors:t.list})},this.colorsChanged=({value:e})=>{let t=e.map(e=>[e.color,e.offset]);t.sort((e,t)=>e[1]-t[1]),this.update({kind:this.props.value.kind,colors:t})},this.isInterpolatedChanged=({value:e})=>{this.update({kind:e?`interpolate`:`set`,colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderControl(){let{value:e}=this.props;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`button`,{onClick:this.toggleEdit,style:{position:`relative`,paddingRight:`33px`},children:[e.colors.length===1?`1 color`:`${e.colors.length} colors`,(0,I.jsx)(`div`,{style:f4(e,`33px`)})]}),(0,I.jsx)(HX,{svg:dX,onClick:this.togglePresets,toggleState:this.state.show===`presets`,title:`Color Presets`,style:{padding:0,position:`absolute`,right:0,top:0,width:`32px`}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:e,OffsetColorsParam:t,IsInterpolatedParam:n}=c9e(),r=e[this.props.param.presetKind];if(this.state.show===`presets`)return(0,I.jsx)(Y2,{items:r,onSelect:this.selectPreset});let i=this.props.value.colors,a=i.map((e,t)=>Array.isArray(e)?{color:e[0],offset:e[1]}:{color:e,offset:t/i.length});return a.sort((e,t)=>e.offset-t.offset),(0,I.jsxs)(`div`,{className:`msp-control-offset`,children:[(0,I.jsx)(m4,{name:`colors`,param:t,value:a,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,I.jsx)(l4,{name:`isInterpolated`,param:n,value:this.props.value.kind===`interpolate`,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},d9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:V.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||`X`}),1:V.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||`Y`}),2:V.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||`Z`})},this.componentChange=({name:e,value:t})=>{let n=B.copy(B.zero(),this.props.value);n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){let e=this.props.value,t=this.props.param.label||KT(this.props.name),n=yO(this.props.param.step||.01),r=`[${e[0].toFixed(n)}, ${e[1].toFixed(n)}, ${e[2].toFixed(n)}]`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:t,control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,I.jsx)(`div`,{title:r,className:`msp-no-overflow`,style:{display:`block`},children:r})})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(a4,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},f9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={json:V.Text(JSON.stringify(z()),{description:`JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format`})},this.componentChange=({name:e,value:t})=>{let n=z.copy(z(),this.props.value);e===`json`?z.copy(n,JSON.parse(t)):n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}changeValue(e){return t=>{let n=z.copy(z(),this.props.value);n[e]=t,this.change(n)}}get grid(){let e=this.props.value,t=[];for(let n=0;n<4;n++){let r=[];for(let t=0;t<4;t++)r.push((0,I.jsx)(zX,{numeric:!0,delayMs:50,value:z.getValue(e,n,t),onChange:this.changeValue(4*t+n),className:`msp-form-control`,blurOnEnter:!0,isDisabled:this.props.isDisabled},t));t.push((0,I.jsx)(`div`,{className:`msp-flex-row`,children:r},n))}return(0,I.jsx)(`div`,{className:`msp-parameter-matrix`,children:t})}render(){let e={json:JSON.stringify(this.props.value)};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:this.props.param.label||KT(this.props.name),control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,I.jsx)(`div`,{className:`msp-no-overflow`,style:{display:`block`},children:`44 Matrix`})})}),this.state.isExpanded&&(0,I.jsxs)(`div`,{className:`msp-control-offset`,children:[this.grid,(0,I.jsx)(a4,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}},p9e=class extends c4{constructor(){super(...arguments),this.onChange=e=>{let t=e.target.value;t!==gx.getUrl(this.props.value||``)&&this.update(gx.Url(t))},this.onKeyPress=e=>{(e.keyCode===13||e.charCode===13||e.key===`Enter`)&&this.props.onEnter&&this.props.onEnter(),e.stopPropagation()}}renderControl(){let e=this.props.param.label||KT(this.props.name);return(0,I.jsx)(`input`,{type:`text`,value:gx.getUrl(this.props.value||``),placeholder:e,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}},m9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFile=e=>{this.change(e.target.files[0])},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:gx.File(e)})}renderControl(){let e=this.props.value;return(0,I.jsxs)(`div`,{className:`msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file`,style:{marginTop:`1px`},children:[e?e.name:`Select a file...`,` `,(0,I.jsx)(`input`,{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:`file`,multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},h9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFileList=e=>{this.change(e.target.files)},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(e){let t=[];if(e)for(let n=0,r=e.length;n<r;++n)t.push(gx.File(e[n]));this.props.onChange({name:this.props.name,param:this.props.param,value:t})}renderControl(){let e=this.props.value,t=[];if(e)for(let n of e)t.push(n.name);return(0,I.jsxs)(`div`,{className:`msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file`,style:{marginTop:`1px`},children:[t.length===0?`Select files...`:t.length===1?t[0]:`${t.length} files selected`,` `,(0,I.jsx)(`input`,{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:`file`,multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?s4({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},g9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}toggle(e){return t=>{this.props.value.indexOf(e)<0?this.change(this.props.value.concat(e)):this.change(this.props.value.filter(t=>t!==e)),t.currentTarget.blur()}}render(){let e=this.props.value,t=this.props.param.emptyValue;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:this.props.param.label||KT(this.props.name),control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:e.length===0&&t?t:`${e.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:this.props.param.options.map(([t,n])=>{let r=e.indexOf(t)>=0;return(0,I.jsx)(VX,{onClick:this.toggle(t),disabled:this.props.isDisabled,style:{marginTop:`1px`},children:(0,I.jsx)(`span`,{style:{float:r?`left`:`right`},children:r?` ${n}`:`${n} `})},t)})})]})}},_9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1},this.onChangeParam=e=>{this.change({...this.props.value,[e.name]:e.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets}),this.presetItems=gA(e=>Y2.createItemsFromSelectOptions(e.presets??[])),this.onSelectPreset=e=>{this.setState({showPresets:!1}),this.change(e?.value)}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}pivotedPresets(){if(!this.props.param.presets)return null;let e=this.props.param.label||KT(this.props.name);return(0,I.jsxs)(`div`,{className:`msp-control-group-wrapper`,children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsxs)(`button`,{className:`msp-btn msp-form-control msp-btn-block`,onClick:this.toggleShowPresets,children:[(0,I.jsx)(XY,{svg:dX}),e,` Presets`]})}),this.state.showPresets&&(0,I.jsx)(Y2,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(`div`,{className:`msp-control-group-presets-wrapper`,children:(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsxs)(`button`,{className:`msp-btn msp-form-control msp-btn-block`,onClick:this.toggleShowPresets,children:[(0,I.jsx)(XY,{svg:dX}),`Presets`]})})}),this.state.showPresets&&(0,I.jsx)(Y2,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){let e=this.props.param.pivot,t=this.props.param.params,n=t[e],r=(0,I.jsx)(o4(n),{name:e,param:n,value:this.props.value[e],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,I.jsxs)(`div`,{className:`msp-mapped-parameter-group`,children:[r,(0,I.jsx)(HX,{svg:CX,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`More Options`})]});let i=Object.create(null);for(let n of Object.keys(t))n!==e&&(i[n]=t[n]);return(0,I.jsxs)(`div`,{className:`msp-mapped-parameter-group`,children:[r,(0,I.jsx)(HX,{svg:CX,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`More Options`}),(0,I.jsxs)(`div`,{className:`msp-control-offset`,children:[this.pivotedPresets(),(0,I.jsx)(a4,{params:i,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){let e=this.props.param.params;if(Object.keys(e).length===0)return null;if(this.props.param.pivot)return this.pivoted();let t=this.props.param.label||KT(this.props.name),n=(0,I.jsx)(a4,{params:e,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,I.jsx)(`div`,{className:`msp-control-offset`,children:n}):this.props.param.isFlat?n:(0,I.jsxs)(`div`,{className:`msp-control-group-wrapper`,style:{position:`relative`},children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsxs)(`button`,{className:`msp-btn msp-form-control msp-btn-block`,onClick:this.toggleExpanded,children:[(0,I.jsx)(XY,{svg:this.state.isExpanded?sX:cX}),t]})}),this.presets(),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:n})]})}},v9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.valuesCache={},this.onChangeName=e=>{this.change({name:e.value,params:this.getValues(e.value)})},this.onChangeParam=e=>{this.setValues(this.props.value.name,e.value),this.change({name:this.props.value.name,params:e.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(e,t){this.valuesCache[e]=t}getValues(e){return e in this.valuesCache?this.valuesCache[e]:this.props.param.map(e).defaultValue}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}areParamsEmpty(e){for(let t of Object.keys(e))if(!e[t].isHidden)return!1;return!0}render(){let e=this.props.value||this.props.param.defaultValue,t=this.props.param.map(e.name),n=this.props.param.label||KT(this.props.name),r=o4(t),i=this.props.param.help,a=(0,I.jsx)(d4,{param:i?{...this.props.param.select,help:e=>i({name:e,params:this.getValues(e)})}:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:n,value:e.name});return r?t.type===`group`&&!t.isFlat?this.areParamsEmpty(t.params)?a:(0,I.jsxs)(`div`,{className:`msp-mapped-parameter-group`,children:[a,(0,I.jsx)(HX,{svg:CX,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${n} Properties`}),this.state.isExpanded&&(0,I.jsx)(_9e,{inMapped:!0,param:t,value:e.params,name:e.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):(0,I.jsxs)(I.Fragment,{children:[a,(0,I.jsx)(r,{param:t,value:e.params,name:e.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):a}},y9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={current:this.props.value},this.onChangeParam=e=>{this.setState({current:{...this.state.current,[e.name]:e.value}})},this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(e){(this.props.params!==e.params||this.props.value!==e.value)&&this.setState({current:this.props.value})}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,I.jsx)(`button`,{className:`msp-btn msp-btn-block msp-form-control msp-control-top-offset`,onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?`Update`:`Add`})]})}},b9e=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.update=e=>{this.props.actions.update(e,this.props.index)},this.moveUp=()=>{this.props.actions.move(this.props.index,-1)},this.moveDown=()=>{this.props.actions.move(this.props.index,1)},this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-param-object-list-item`,children:[(0,I.jsxs)(`button`,{className:`msp-btn msp-btn-block msp-form-control`,onClick:this.toggleExpanded,children:[(0,I.jsx)(`span`,{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(HX,{svg:oX,title:`Move Up`,onClick:this.moveUp,small:!0}),(0,I.jsx)(HX,{svg:lX,title:`Move Down`,onClick:this.moveDown,small:!0}),(0,I.jsx)(HX,{svg:vX,title:`Remove`,onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(y9e,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}},m4=class extends y.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.add=e=>{this.change([...this.props.value,e])},this.actions={update:(e,t)=>{let n=this.props.value.slice(0);n[t]=e,this.change(n)},move:(e,t)=>{let n=this.props.value;if(n.length===1)return;let r=(e+t)%n.length;r<0&&(r+=n.length),n=n.slice(0);let i=n[e];n[e]=n[r],n[r]=i,this.change(n)},remove:e=>{let t=this.props.value,n=[];for(let r=0;r<t.length;r++)e!==r&&n.push(t[r]);this.change(n)}},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){let e=this.props.value,t=this.props.param.label||KT(this.props.name),n=`${e.length} item${e.length===1?``:`s`}`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:t,control:(0,I.jsx)(`button`,{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:n})}),this.state.isExpanded&&(0,I.jsxs)(`div`,{className:`msp-control-offset`,children:[this.props.value.map((e,t)=>(0,I.jsx)(b9e,{param:this.props.param,value:e,index:t,actions:this.actions,isDisabled:this.props.isDisabled},t)),(0,I.jsx)(LX,{header:`New Item`,children:(0,I.jsx)(y9e,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}},x9e=class extends y.PureComponent{constructor(){super(...arguments),this.onChangeCondition=e=>{this.change(this.props.param.conditionedValue(this.props.value,e.value))},this.onChangeParam=e=>{this.change(e.value)}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){let e=this.props.value,t=this.props.param.conditionForValue(e),n=this.props.param.conditionParams[t],r=this.props.param.label||KT(this.props.name),i=o4(n),a=(0,I.jsx)(d4,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${r} Kind`,value:t});return i?(0,I.jsxs)(I.Fragment,{children:[a,(0,I.jsx)(i,{param:n,value:e,name:r,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):a}},S9e=class extends y.PureComponent{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(e.value)})}}render(){let e=this.props.param.fromValue(this.props.value),t=o4(this.props.param.converted);return t?(0,I.jsx)(t,{param:this.props.param.converted,value:e,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}},C9e=class extends y.PureComponent{constructor(){super(...arguments),this.onChange=({name:e,value:t})=>{let n=e;t!==this.props.value[n]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[n]:t}})}}render(){let e=(0,I.jsx)(d4,{param:{defaultValue:this.props.value.language,options:V.objectToOptions(HH.Info),type:`select`},isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:`language`,value:this.props.value.language}),t=(0,I.jsx)($7e,{param:{defaultValue:this.props.value.language,type:`text`},isDisabled:this.props.isDisabled,onChange:this.onChange,name:`expression`,value:this.props.value.expression});return(0,I.jsxs)(I.Fragment,{children:[e,this.props.value.language!==`mol-script`&&(0,I.jsxs)(`div`,{className:`msp-help-text`,style:{padding:`10px`},children:[(0,I.jsx)(XY,{svg:FX}),` Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended.`]}),t]})}},w9e=class extends qX{constructor(){super(...arguments),this.updateParams=e=>{this.plugin.managers.animation.updateParams({[e.name]:e.value})},this.updateCurrentParams=e=>{this.plugin.managers.animation.updateCurrentParams({[e.name]:e.value})},this.startOrStop=()=>{let e=this.plugin.managers.animation;e.state.animationState===`playing`?e.stop():(this.props.onStart&&this.props.onStart(),e.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){var e;let t=this.plugin.managers.animation;if(t.isEmpty)return null;let n=t.state.animationState===`playing`,r=(e=t.current.anim).canApply?.call(e,this.plugin);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:t.getParams(),values:t.state.params,onChange:this.updateParams,isDisabled:n}),(0,I.jsx)(a4,{params:t.current.params,values:t.current.paramValues,onChange:this.updateCurrentParams,isDisabled:n}),(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{icon:t.state.animationState===`playing`?EX:void 0,onClick:this.startOrStop,disabled:r!==void 0&&r.canApply===!1,children:t.state.animationState===`playing`?`Stop`:r===void 0||r.canApply?`Start`:r.reason||`Start`})})]})}},T9e=`overpaint-controls`;async function E9e(e,t,n,r,i){await D9e(e,t,async(e,t,a)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return;let o=t.obj.data.sourceData,s=await r(o.root);if(yq.isEmpty(s)||gq(s))return;let c={bundle:qR.fromLoci(s),color:n===-1?tE(0):n,clear:n===-1};if(a){let t=O9e([...a.params.values.layers,c],o);e.to(a).update(bq.toBundle(t))}else{let n=O9e([c],o);e.to(t.transform.ref).apply(IY.Representation.OverpaintStructureRepresentation3DFromBundle,bq.toBundle(n),{tags:T9e})}})}async function D9e(e,t,n){let r=e.state.data,i=r.build();for(let e of t)for(let t of e.representations){let e=r.select(FE.Generators.ofTransformer(IY.Representation.OverpaintStructureRepresentation3DFromBundle,t.cell.transform.ref).withTag(T9e));await n(i,t.cell,e[0])}return i.commit({doNotUpdateCurrent:!0})}function O9e(e,t){let n=bq.ofBundle(e,t.root),r=bq.merge(n);return bq.filter(r,t)}var k9e=`clipping-controls`;async function A9e(e,t,n,r,i){await j9e(e,t,async(e,t,a)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return;let o=t.obj.data.sourceData,s=await r(o.root);if(yq.isEmpty(s)||gq(s))return;let c={bundle:qR.fromLoci(s),groups:n};if(a){let t=M9e([...a.params.values.layers,c],o);e.to(a).update(Qq.toBundle(t))}else{let n=M9e([c],o);e.to(t.transform.ref).apply(IY.Representation.ClippingStructureRepresentation3DFromBundle,Qq.toBundle(n),{tags:k9e})}})}async function j9e(e,t,n){let r=e.state.data,i=r.build();for(let e of t)for(let t of e.representations){let e=r.select(FE.Generators.ofTransformer(IY.Representation.ClippingStructureRepresentation3DFromBundle,t.cell.transform.ref).withTag(k9e));await n(i,t.cell,e[0])}return i.commit({doNotUpdateCurrent:!0})}function M9e(e,t){let n=Qq.ofBundle(e,t.root),r=Qq.merge(n);return Qq.filter(r,t)}var N9e=`transparency-controls`;async function P9e(e,t,n,r,i){await F9e(e,t,async(e,t,a)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return;let o=t.obj.data.sourceData,s=await r(o.root);if(yq.isEmpty(s)||gq(s))return;let c={bundle:qR.fromLoci(s),value:n};if(a){let t=I9e([...a.params.values.layers,c],o);e.to(a).update(xq.toBundle(t))}else{let n=I9e([c],o);e.to(t.transform.ref).apply(IY.Representation.TransparencyStructureRepresentation3DFromBundle,xq.toBundle(n),{tags:N9e})}})}async function F9e(e,t,n){let r=e.state.data,i=r.build();for(let e of t)for(let t of e.representations){let e=r.select(FE.Generators.ofTransformer(IY.Representation.TransparencyStructureRepresentation3DFromBundle,t.cell.transform.ref).withTag(N9e));await n(i,t.cell,e[0])}return i.commit({doNotUpdateCurrent:!0})}function I9e(e,t){let n=xq.ofBundle(e,t.root),r=xq.merge(n);return xq.filter(r,t)}var L9e=`substance-controls`;async function R9e(e,t,n,r,i){await z9e(e,t,async(e,t,a)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return;let o=t.obj.data.sourceData,s=await r(o.root);if(yq.isEmpty(s)||gq(s))return;let c={bundle:qR.fromLoci(s),material:n??bM(),clear:!n};if(a){let t=B9e([...a.params.values.layers,c],o);e.to(a).update($q.toBundle(t))}else{let n=B9e([c],o);e.to(t.transform.ref).apply(IY.Representation.SubstanceStructureRepresentation3DFromBundle,$q.toBundle(n),{tags:L9e})}})}async function z9e(e,t,n){let r=e.state.data,i=r.build();for(let e of t)for(let t of e.representations){let e=r.select(FE.Generators.ofTransformer(IY.Representation.SubstanceStructureRepresentation3DFromBundle,t.cell.transform.ref).withTag(L9e));await n(i,t.cell,e[0])}return i.commit({doNotUpdateCurrent:!0})}function B9e(e,t){let n=$q.ofBundle(e,t.root),r=$q.merge(n);return $q.filter(r,t)}var V9e=`emissive-controls`;async function H9e(e,t,n,r,i){await U9e(e,t,async(e,t,a)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return;let o=t.obj.data.sourceData,s=await r(o.root);if(yq.isEmpty(s)||gq(s))return;let c={bundle:qR.fromLoci(s),value:n};if(a){let t=W9e([...a.params.values.layers,c],o);e.to(a).update(eJ.toBundle(t))}else{let n=W9e([c],o);e.to(t.transform.ref).apply(IY.Representation.EmissiveStructureRepresentation3DFromBundle,eJ.toBundle(n),{tags:V9e})}})}async function U9e(e,t,n){let r=e.state.data,i=r.build();for(let e of t)for(let t of e.representations){let e=r.select(FE.Generators.ofTransformer(IY.Representation.EmissiveStructureRepresentation3DFromBundle,t.cell.transform.ref).withTag(V9e));await n(i,t.cell,e[0])}return i.commit({doNotUpdateCurrent:!0})}function W9e(e,t){let n=eJ.ofBundle(e,t.root),r=eJ.merge(n);return eJ.filter(r,t)}var h4=class e extends BY{get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(e){this.updateState({options:e}),this.events.optionsUpdated.next(void 0)}async setOptions(e){let t=e.interactions!==this.state.options.interactions;this.updateState({options:e}),this.events.optionsUpdated.next(void 0);let n=this.dataState.build();for(let e of this.currentStructures)for(let t of e.components)this.updateReprParams(n,t);return this.plugin.dataTransaction(async()=>{await n.commit(),await this.plugin.state.updateBehavior(k2,t=>{t.ignoreHydrogens=e.hydrogens!==`all`,t.ignoreHydrogensVariant=e.hydrogens===`only-polar`?`non-polar`:`all`,t.ignoreLight=e.ignoreLight,t.material=e.materialStyle,t.clip=e.clipObjects}),t&&await this.updateInterationProps()})}updateReprParams(e,t){let{hydrogens:n,visualQuality:r,ignoreLight:i,materialStyle:a,clipObjects:o}=this.state.options,s=n!==`all`,c=n===`only-polar`?`non-polar`:`all`;for(let n of t.representations){if(n.cell.transform.transformer!==PY)continue;let t=n.cell.transform.params;(!!t.type.params.ignoreHydrogens!==s||t.type.params.ignoreHydrogensVariant!==c||t.type.params.quality!==r||t.type.params.ignoreLight!==i||!Ex(t.type.params.material,a)||!V.areEqual(xM.Params,t.type.params.clip,o))&&e.to(n.cell).update(e=>{e.type.params.ignoreHydrogens=s,e.type.params.ignoreHydrogensVariant=c,e.type.params.quality=r,e.type.params.ignoreLight=i,e.type.params.material=a,e.type.params.clip=o})}}async updateInterationProps(){for(let e of this.currentStructures){let t=f1.getParams(e.cell.obj?.data);if(e.properties){let n=e.properties.cell.transform.params?.properties[f1.descriptor.name];if(V.areEqual(t,n,this.state.options.interactions))continue;await this.dataState.build().to(e.properties.cell).update(e=>{e.properties[f1.descriptor.name]=this.state.options.interactions}).commit()}else{let n=this.plugin.customStructureProperties.getParams(e.cell.obj?.data),r=V.getDefaultValues(n);if(V.areEqual(t,r.properties[f1.descriptor.name],this.state.options.interactions))continue;r.properties[f1.descriptor.name]=this.state.options.interactions,await this.plugin.builders.structure.insertStructureProperties(e.cell,r)}}}applyPreset(e,t,n){return this.plugin.dataTransaction(async()=>{for(let r of e){let e=await this.plugin.builders.structure.representation.applyPreset(r.cell,t,n);await this.syncPreset(r,e)}},{canUndo:`Preset`})}syncPreset(e,t){if(!t||!t.components)return this.clearComponents([e]);let n=new Set;if(WT(t.components,e=>{e&&n.add(e.ref)}),t.representations&&WT(t.representations,e=>{e&&n.add(e.ref)}),n.size===0)return this.clearComponents([e]);let r=!1,i=this.dataState.build(),a=e=>{n.has(e.cell.transform.ref)||(r=!0,i.delete(e.cell))};for(let t of e.components){a(t);for(let e of t.representations)a(e);if(t.genericRepresentations)for(let e of t.genericRepresentations)a(e)}if(e.genericRepresentations)for(let t of e.genericRepresentations)a(t);if(r)return i.commit()}clear(e){return this.clearComponents(e)}selectThis(e){let t=this.plugin.managers.structure.selection;t.clear();for(let n of e){let e=nB.toSubStructureElementLoci(n.structure.cell.obj.data,n.cell.obj?.data);t.fromLoci(`set`,e)}}canBeModified(e){return this.plugin.builders.structure.isComponentTransform(e.cell)}modifyByCurrentSelection(e,t){return this.plugin.runTask(hb.create(`Modify Component`,async n=>{let r=this.dataState.build();for(let n of e){if(!this.canBeModified(n))continue;let e=this.plugin.managers.structure.selection.getStructure(n.structure.cell.obj.data);!e||e.elementCount===0||this.modifyComponent(r,n,e,t)}await this.dataState.updateTree(r,{canUndo:`Modify Selection`}).runInContext(n)}))}toggleVisibility(e,t){if(e.length!==0)if(t){let n=e[0].representations.indexOf(t),r=!t.cell.state.isHidden;for(let t of e){let e=t.representations[n];e&&$0(this.dataState,e.cell.transform.ref,r)}}else{let t=!e[0].cell.state.isHidden;for(let n of e)$0(this.dataState,n.cell.transform.ref,t)}}removeRepresentations(e,t){if(e.length===0)return;let n=[];if(t){let r=e[0].representations.indexOf(t);if(r<0)return;for(let t of e)t.representations[r]&&n.push(t.representations[r])}else for(let t of e)for(let e of t.representations)n.push(e);return this.plugin.managers.structure.hierarchy.remove(n,!0)}updateRepresentations(e,t,n){if(e.length===0)return Promise.resolve();let r=e[0].representations.indexOf(t);if(r<0)return Promise.resolve();let i=this.dataState.build();for(let a of e){let e=a.representations[r];e&&e.cell.transform.transformer===t.cell.transform.transformer&&i.to(e.cell).update(n)}return i.commit({canUndo:`Update Representation`})}updateRepresentationsTheme(e,t){if(e.length===0)return;let n=this.dataState.build();for(let r of e)for(let e of r.representations){let i=e.cell.transform.params,a=typeof t==`function`?t(r,e):t,o=a.color===`default`?z1(this.plugin,r.structure.cell.obj?.data,i?.type.name):a.color?z1(this.plugin,r.structure.cell.obj?.data,i?.type.name,a.color,a.colorParams):void 0,s=a.size===`default`?G1e(this.plugin,r.structure.cell.obj?.data,i?.type.name):a.color?G1e(this.plugin,r.structure.cell.obj?.data,i?.type.name,a.size,a.sizeParams):void 0;(o||s)&&n.to(e.cell).update(e=>{o&&(e.colorTheme=o),s&&(e.sizeTheme=s)})}return n.commit({canUndo:`Update Theme`})}addRepresentation(e,t){if(e.length===0)return;let{hydrogens:n,visualQuality:r,ignoreLight:i,materialStyle:a,clipObjects:o}=this.state.options,s={ignoreHydrogens:n!==`all`,ignoreHydrogensVariant:n===`only-polar`?`non-polar`:`all`,quality:r,ignoreLight:i,material:a,clip:o};return this.plugin.dataTransaction(async()=>{for(let n of e)await this.plugin.builders.structure.representation.addRepresentation(n.cell,{type:this.plugin.representation.structure.registry.get(t),typeParams:s})},{canUndo:`Add Representation`})}tryFindComponent(e,t){if(e.components.length!==0)return this.plugin.runTask(hb.create(`Find Component`,async n=>{let r=e.cell.obj?.data;if(!r)return;let i=VR.unionStructure(await t.getSelection(this.plugin,n,r));for(let t of e.components){let e=t.cell.obj?.data;if(!(!e||!t.cell.parent)&&Bke(i,e))return t.cell}}))}async add(e,t){return this.plugin.dataTransaction(async()=>{let n=t||this.currentStructures;if(n.length===0)return;let{hydrogens:r,visualQuality:i,ignoreLight:a,materialStyle:o,clipObjects:s}=this.state.options,c={ignoreHydrogens:r!==`all`,ignoreHydrogensVariant:r===`only-polar`?`non-polar`:`all`,quality:i,ignoreLight:a,material:o,clip:s},l=zy.create22();for(let t of n){let n;e.options.checkExisting&&(n=await this.tryFindComponent(t,e.selection)),n||=await this.plugin.builders.structure.tryCreateComponentFromSelection(t.cell,e.selection,l,{label:e.options.label||(e.selection===aU.current?`Custom Selection`:``)}),!(e.representation===`none`||!n)&&await this.plugin.builders.structure.representation.addRepresentation(n,{type:this.plugin.representation.structure.registry.get(e.representation),typeParams:c})}},{canUndo:`Add Selection`})}async applyTheme(e,t){return this.plugin.dataTransaction(async n=>{let r=t||this.currentStructures;if(r.length===0)return;let i=async t=>VR.toLociWithSourceUnits(await e.selection.getSelection(this.plugin,n,t));for(let t of r)if(e.action.name===`color`){let n=e.action.params;await E9e(this.plugin,t.components,n.color,i,e.representations)}else if(e.action.name===`resetColor`)await E9e(this.plugin,t.components,-1,i,e.representations);else if(e.action.name===`transparency`){let n=e.action.params;await P9e(this.plugin,t.components,n.value,i,e.representations)}else if(e.action.name===`emissive`){let n=e.action.params;await H9e(this.plugin,t.components,n.value,i,e.representations)}else if(e.action.name===`material`){let n=e.action.params;await R9e(this.plugin,t.components,n.material,i,e.representations)}else if(e.action.name===`resetMaterial`)await R9e(this.plugin,t.components,void 0,i,e.representations);else if(e.action.name===`clipping`){let n=e.action.params;await A9e(this.plugin,t.components,Qq.Groups.fromNames(n.excludeGroups),i,e.representations)}},{canUndo:`Apply Theme`})}modifyComponent(e,t,n,r){let i=t.cell.obj?.data;if(!i||(r===`subtract`||r===`intersect`)&&!RR(i,n))return;let a=t.structure.cell.obj?.data,o=r===`union`?LR(a,[i,n]):r===`intersect`?zR(i,n):BR(i,n);if(o.elementCount===0)e.delete(t.cell.transform.ref);else{let n={type:{name:`bundle`,params:qR.fromSubStructure(a,o)},nullIfEmpty:!0,label:t.cell.obj?.label};e.to(t.cell).update(n)}}updateLabel(e,t){let n={type:e.cell.params?.values.type,nullIfEmpty:e.cell.params?.values.nullIfEmpty,label:t};this.dataState.build().to(e.cell).update(n).commit()}get dataState(){return this.plugin.state.data}clearComponents(e){let t=this.dataState.build();for(let n of e)for(let e of n.components)t.delete(e.cell.transform.ref);return t.commit({canUndo:`Clear Selections`})}constructor(t){super({options:V.getDefaultValues(e.OptionsParams)}),this.plugin=t,this.events={optionsUpdated:this.ev()}}};(function(e){e.OptionsParams={hydrogens:V.Select(`all`,[[`all`,`Show All`],[`hide-all`,`Hide All`],[`only-polar`,`Only Polar`]],{description:`Determine display of hydrogen atoms in representations`}),visualQuality:V.Select(`auto`,SM,{description:`Control the visual/rendering quality of representations`}),ignoreLight:V.Boolean(!1,{description:`Ignore light for stylized rendering of representations`}),materialStyle:bM.getParam(),clipObjects:V.Group(xM.Params),interactions:V.Group(f1.defaultParams,{label:`Non-covalent Interactions`})};function t(e,t){let{options:n}=e.query.structure.registry;return t={pivot:e.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...t},{selection:V.Select(n[1][0],n,{isHidden:t?.hideSelection}),representation:i(e,t?.pivot,t?.allowNone?[[`none`,`< Create Later >`]]:[]),options:V.Group({label:V.Text(``),checkExisting:V.Boolean(!!t?.checkExisting,{help:()=>({description:`Checks if a selection with the specifield elements already exists to avoid creating duplicate components.`})})})}}e.getAddParams=t;function n(e,t){let{options:n}=e.query.structure.registry;return{selection:V.Select(n[1][0],n,{isHidden:!1}),action:V.MappedStatic(`color`,{color:V.Group({color:V.Color(gk.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:V.EmptyGroup({label:`Reset Color`}),transparency:V.Group({value:V.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:V.Group({value:V.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:V.Group({material:bM.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:V.EmptyGroup({label:`Reset Material`}),clipping:V.Group({excludeGroups:V.MultiSelect([],V.objectToOptions(Qq.Groups.Names))},{isFlat:!0})}),representations:V.MultiSelect([],r(e,t),{emptyValue:`All`})}}e.getThemeParams=n;function r(e,t){return t?.cell.obj?.data?e.representation.structure.registry.getApplicableTypes(t.cell.obj?.data):e.representation.structure.registry.types}e.getRepresentationTypes=r;function i(e,t,n,i){let a=[...n,...r(e,t)];return V.Select(a[0][0],a,{label:i})}})(h4||={});var g4;(function(e){function t(e,t){return{key:e,data:t}}function n(e){return{entries:oL(),capacity:Math.max(1,e)}}e.create=n;function r(e,t){for(let n=e.entries.first;n;n=n.next)if(n.value.key===t)return e.entries.remove(n),e.entries.addLast(n.value),n.value.data}e.get=r;function i(e,n,r){let i;if(e.entries.count>=e.capacity){let t=e.entries.first;i=t.value.data,e.entries.remove(t)}return e.entries.addLast(t(n,r)),i}e.set=i;function a(e,t){for(let n=e.entries.first;n;n=n.next)if(n.value.key===t){e.entries.remove(n);break}}e.remove=a})(g4||={});var G9e=class{constructor(e=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=e}enqueue(e){this.log&&console.log(`SingleAsyncQueue enqueue`,this.counter),this.queue[0]={id:this.counter,func:e},this.counter++,this.run()}async run(){if(this.isRunning)return;let e=this.queue.pop();if(e){this.isRunning=!0;try{this.log&&console.log(`SingleAsyncQueue run`,e.id),await e.func(),this.log&&console.log(`SingleAsyncQueue complete`,e.id)}finally{this.isRunning=!1,this.run()}}}},_4=class extends H.CreateBehavior({name:`Volume Streaming`}){};(function(e){e.RootTag=`volume-streaming-info`;function t(e,t,n,r,i={}){return V.Group({isoValue:zP.createIsoValueParam(i.isoValue??n,r),color:V.Color(i.color??t),wireframe:V.Boolean(i.wireframe??!1),opacity:V.Numeric(i.opacity??.3,{min:0,max:1,step:.01})},{label:e,isExpanded:!0})}let n={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function r(e={}){let{data:t,defaultView:n,channelParams:r}=e,a=new Map;t&&t.entries.forEach(e=>a.set(e.dataId,e));let o=t?t.entries.map(e=>[e.dataId,e.dataId]):[],s=t?t.entries[0].dataId:``;return{entry:V.Mapped(s,o,e=>V.Group(i({entryData:a.get(e),defaultView:n,structure:t&&t.structure,channelParams:r})))}}e.createParams=r;function i(r){let{entryData:i,defaultView:o,structure:s,channelParams:c={}}=r,l=i||{kind:`em`,header:{sampling:[n],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:zP.IsoValue.relative(0)},u=s&&s.boundary.box||$k();return{view:V.MappedStatic(o||(l.kind===`em`?`auto`:`selection-box`),{off:V.Group({}),box:V.Group({bottomLeft:V.Vec3(u.min),topRight:V.Vec3(u.max)},{description:`Static box defined by cartesian coords.`,isFlat:!0}),"selection-box":V.Group({radius:V.Numeric(5,{min:0,max:50,step:.5},{description:`Radius in  within which the volume is shown.`}),bottomLeft:V.Vec3(B.create(0,0,0),{},{isHidden:!0}),topRight:V.Vec3(B.create(0,0,0),{},{isHidden:!0})},{description:`Box around focused element.`,isFlat:!0}),"camera-target":V.Group({radius:V.Numeric(.5,{min:0,max:1,step:.05},{description:`Radius within which the volume is shown (relative to the field of view).`}),dynamicDetailLevel:a(l.header.availablePrecisions,0,{label:`Dynamic Detail`}),bottomLeft:V.Vec3(B.create(0,0,0),{},{isHidden:!0}),topRight:V.Vec3(B.create(0,0,0),{},{isHidden:!0})},{description:`Box around camera target.`,isFlat:!0}),cell:V.Group({}),auto:V.Group({radius:V.Numeric(5,{min:0,max:50,step:.5},{description:`Radius in  within which the volume is shown.`}),selectionDetailLevel:a(l.header.availablePrecisions,6,{label:`Selection Detail`}),isSelection:V.Boolean(!1,{isHidden:!0}),bottomLeft:V.Vec3(u.min,{},{isHidden:!0}),topRight:V.Vec3(u.max,{},{isHidden:!0})},{description:`Box around focused element.`,isFlat:!0})},{options:e.ViewTypeOptions,description:`Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.`}),detailLevel:a(l.header.availablePrecisions,3),channels:l.kind===`em`?V.Group({em:t(`EM`,tE(6524815),l.emDefaultContourLevel||zP.IsoValue.relative(1),l.header.sampling[0].valuesInfo[0],c.em)},{isFlat:!0}):V.Group({"2fo-fc":t(`2Fo-Fc`,tE(3367602),zP.IsoValue.relative(1.5),l.header.sampling[0].valuesInfo[0],c[`2fo-fc`]),"fo-fc(+ve)":t(`Fo-Fc(+ve)`,tE(3390259),zP.IsoValue.relative(3),l.header.sampling[0].valuesInfo[1],c[`fo-fc(+ve)`]),"fo-fc(-ve)":t(`Fo-Fc(-ve)`,tE(12268339),zP.IsoValue.relative(-3),l.header.sampling[0].valuesInfo[1],c[`fo-fc(-ve)`])},{isFlat:!0})}}e.createEntryParams=i;function a(e,t,n){return V.Select(Math.min(t,e.length-1),e.map((e,t)=>[t,`${t+1} [ ${e.maxVoxels**(1/3)|0}^3 cells ]`]),{description:`Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).`,...n})}function o(e){return{entry:{name:e.entry.name,params:{detailLevel:e.entry.params.detailLevel,channels:e.entry.params.channels,view:{name:e.entry.params.view.name,params:{...e.entry.params.view.params}}}}}}e.copyParams=o,e.ViewTypeOptions=[[`off`,`Off`],[`box`,`Bounded Box`],[`selection-box`,`Around Focus`],[`camera-target`,`Around Camera`],[`cell`,`Whole Structure`],[`auto`,`Auto`]],e.ChannelTypeOptions=[[`em`,`em`],[`2fo-fc`,`2fo-fc`],[`fo-fc(+ve)`,`fo-fc(+ve)`],[`fo-fc(-ve)`,`fo-fc(-ve)`]];class s extends B1.WithSubscribers{get info(){return this.infoMap.get(this.params.entry.name)}async queryData(e){let t=Q0(this.data.serverUrl,`${this.info.kind}/${this.info.dataId.toLowerCase()}`);if(e){let{min:n,max:r}=e;t+=`/box/${n.map(e=>Math.round(1e3*e)/1e3).join(`,`)}/${r.map(e=>Math.round(1e3*e)/1e3).join(`,`)}`}else t+=`/cell`;let n=this.params.entry.params.detailLevel;this.params.entry.params.view.name===`auto`&&this.params.entry.params.view.params.isSelection&&(n=this.params.entry.params.view.params.selectionDetailLevel),this.params.entry.params.view.name===`camera-target`&&e&&(n=this.decideDetail(e,this.params.entry.params.view.params.dynamicDetailLevel)),t+=`?detail=${n}`;let r=g4.get(this.cache,t);if(r)return r.data;let i=gx.getUrlAsset(this.plugin.managers.asset,t),a=await this.plugin.runTask(this.plugin.managers.asset.resolve(i,`binary`)),o=await this.parseCif(a.data);if(!o)return;let s=g4.set(this.cache,t,{data:o,asset:a});return s&&s.asset.dispose(),o}async parseCif(e){let t=await this.plugin.runTask(dk.parseBinary(e));if(t.isError){this.plugin.log.error(`VolumeStreaming, parsing CIF: `+t.toString());return}if(t.result.blocks.length<2){this.plugin.log.error(`VolumeStreaming: Invalid data.`);return}let n={};for(let e=1;e<t.result.blocks.length;e++){let r=t.result.blocks[e],i=dk.schema.densityServer(r),a=await this.plugin.runTask(LP(i));n[r.header]=a}return n}async updateParams(e,t=!1){let n=o(this.params),r=n.entry.params.view.name;r!==`off`&&r!==`cell`&&(n.entry.params.view.params.bottomLeft=e?.min||B.zero(),n.entry.params.view.params.topRight=e?.max||B.zero()),r===`auto`&&(n.entry.params.view.params.isSelection=t);let i=this.plugin.state.data,a=i.build().to(this.ref).update(n);await jx.State.Update(this.plugin,{state:i,tree:a,options:{doNotUpdateCurrent:!0}})}getStructureRoot(){return this.plugin.state.data.select(FE.Generators.byRef(this.ref).rootOfType(H.Molecule.Structure))[0]}register(e){this.ref=e,this.subscribeObservable(this.plugin.state.events.object.removed,e=>{!H.Molecule.Structure.is(e.obj)||!$.is(this.lastLoci)||this.lastLoci.structure===e.obj.data&&(this.lastLoci=hq)}),this.subscribeObservable(this.plugin.state.events.object.updated,e=>{!H.Molecule.Structure.is(e.oldObj)||!$.is(this.lastLoci)||this.lastLoci.structure===e.oldObj.data&&(this.lastLoci=hq)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,e=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;let t=e?e.loci:hq;switch(this.params.entry.params.view.name){case`auto`:this.updateAuto(t);break;case`selection-box`:this.updateSelectionBox(t);break;default:this.lastLoci=t;break}})}unregister(){let e=this.cache.entries.first;for(;e;)e.value.data.asset.dispose(),e=e.next}isCameraTargetSame(e,t){if(!e||!t)return!1;let n=B.equals(e.target,t.target),r=B.squaredDistance(e.target,e.position),i=B.squaredDistance(t.target,t.position),a=Math.abs(r-i)/r<.001;return n&&a}cameraTargetDistance(e){return B.distance(e.target,e.position)}getBoxFromLoci(e){if(yq.isEmpty(e)||gq(e))return $k();let t=this.plugin.helpers.substructureParent.get(e.structure,!0);if(!t)return $k();let n=this.getStructureRoot();if(!n||n.obj?.data!==t.obj?.data)return $k();let r=SB.get(n.obj?.data.models[0]);r&&z.invert(this._invTransform,r);let i=$.extendToWholeResidues(e),a=$.getBoundary(i,r&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return $.size(i)===1&&$k.expand(a,a,B.create(1,1,1)),a}updateAuto(e){this.updateQueue.enqueue(async()=>{this.lastLoci=e,gq(e)?await this.updateParams(this.info.kind===`x-ray`?this.data.structure.boundary.box:void 0,!1):await this.updateParams(this.getBoxFromLoci(e),!0)})}updateSelectionBox(e){this.updateQueue.enqueue(async()=>{yq.areEqual(this.lastLoci,e)?this.lastLoci=hq:this.lastLoci=e;let t=this.getBoxFromLoci(this.lastLoci);await this.updateParams(t)})}updateCameraTarget(e){this.updateQueue.enqueue(async()=>{var t,n;let r=this.plugin.canvas3d?.props.camera.manualReset;try{r||(t=this.plugin.canvas3d)==null||t.setProps({camera:{manualReset:!0}});let n=this.boxFromCameraTarget(e,!0);await this.updateParams(n)}finally{r||(n=this.plugin.canvas3d)==null||n.setProps({camera:{manualReset:r}})}})}boxFromCameraTarget(e,t){let n=e.target,r=this.cameraTargetDistance(e),i=Math.tan(.5*e.fov)*r,a=this.plugin.canvas3d?.camera.viewport;a&&a.width>a.height&&(i*=a.width/a.height);let o=this.params.entry.params.view.name===`camera-target`?this.params.entry.params.view.params.radius:.5;i*=o;let s,c,l;if(t){let e=B.zero();$k.size(e,this.data.structure.boundary.box),s=Math.min(i,.5*e[0]),c=Math.min(i,.5*e[1]),l=Math.min(i,.5*e[2])}else s=c=l=i;return $k.create(B.create(n[0]-s,n[1]-c,n[2]-l),B.create(n[0]+s,n[1]+c,n[2]+l))}decideDetail(e,t){let n=this.info.kind===`x-ray`?$k.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((e,t)=>e*t,1),r=$k.volume(e)/n,i=this.info.header.availablePrecisions.length-1,a=t;for(;r<=.5&&a<i;)r*=2,a+=1;return a}async update(e){let t=e.entry.params.view.name===`selection-box`&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!==`selection-box`;this.params=e;let n,r=!1;switch(e.entry.params.view.name!==`camera-target`&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),e.entry.params.view.name){case`off`:r=!0;break;case`box`:n=$k.create(e.entry.params.view.params.bottomLeft,e.entry.params.view.params.topRight),r=$k.volume(n)<1e-4;break;case`selection-box`:{n=t?this.getBoxFromLoci(this.lastLoci)||$k():$k.create(B.clone(e.entry.params.view.params.bottomLeft),B.clone(e.entry.params.view.params.topRight));let i=e.entry.params.view.params.radius;r=$k.volume(n)<1e-4,$k.expand(n,n,B.create(i,i,i));break}case`camera-target`:this.cameraTargetSubscription||=this.subscribeObservable(this.cameraTargetObservable,e=>this.updateCameraTarget(e)),n=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case`cell`:n=this.info.kind===`x-ray`?this.data.structure.boundary.box:void 0;break;case`auto`:if(n=e.entry.params.view.params.isSelection||this.info.kind===`x-ray`?$k.create(B.clone(e.entry.params.view.params.bottomLeft),B.clone(e.entry.params.view.params.topRight)):void 0,n&&(r=$k.volume(n)<1e-4,e.entry.params.view.params.isSelection)){let t=e.entry.params.view.params.radius;$k.expand(n,n,B.create(t,t,t))}break}let i=r?{}:await this.queryData(n);if(!i)return!1;let a=e.entry.params.channels;return this.info.kind===`x-ray`?(this.channels[`2fo-fc`]=this.createChannel(i[`2FO-FC`]||zP.One,a[`2fo-fc`],this.info.header.sampling[0].valuesInfo[0]),this.channels[`fo-fc(+ve)`]=this.createChannel(i[`FO-FC`]||zP.One,a[`fo-fc(+ve)`],this.info.header.sampling[0].valuesInfo[1]),this.channels[`fo-fc(-ve)`]=this.createChannel(i[`FO-FC`]||zP.One,a[`fo-fc(-ve)`],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(i.EM||zP.One,a.em,this.info.header.sampling[0].valuesInfo[0]),!0}createChannel(e,t,n){let r=t;return{data:e,color:r.color,wireframe:r.wireframe,opacity:r.opacity,isoValue:r.isoValue.kind===`relative`?r.isoValue:zP.IsoValue.toRelative(r.isoValue,n)}}getDescription(){return this.params.entry.params.view.name===`selection-box`?`Selection`:this.params.entry.params.view.name===`camera-target`?`Camera`:this.params.entry.params.view.name===`box`?`Static Box`:this.params.entry.params.view.name===`cell`?`Cell`:``}constructor(e,t){super(e,{}),this.plugin=e,this.data=t,this.cache=g4.create(25),this.params={},this.lastLoci=hq,this.ref=``,this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe(gD(500,void 0,{leading:!0,trailing:!0}),lme(()=>this.plugin.canvas3d?.camera.getSnapshot()),hme((e,t)=>this.isCameraTargetSame(e,t)),mD(e=>e!==void 0)),this.cameraTargetSubscription=void 0,this.channels={},this._invTransform=z(),this.infoMap=new Map,this.data.entries.forEach(e=>this.infoMap.set(e.dataId,e)),this.updateQueue=new G9e}}e.Behavior=s})(_4||={});function K9e(e,t){let n=aet(e,t||v4());return met(e.tree,n),t&&t.refs.forEach(det,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}function v4(){return{trajectories:[],models:[],structures:[],refs:new Map}}function q9e(e){return{kind:`trajectory`,cell:e,version:e.transform.version,models:[]}}function J9e(e,t){return{kind:`model`,cell:e,version:e.transform.version,trajectory:t,structures:[]}}function Y9e(e,t){return{kind:`model-properties`,cell:e,version:e.transform.version,model:t}}function X9e(e,t){return{kind:`model-unitcell`,cell:e,version:e.transform.version,model:t}}function Z9e(e,t){return{kind:`structure`,cell:e,version:e.transform.version,model:t,components:[]}}function Q9e(e,t){return{kind:`structure-properties`,cell:e,version:e.transform.version,structure:t}}function $9e(e,t){return{kind:`structure-transform`,cell:e,version:e.transform.version,structure:t}}function eet(e,t){return{kind:`structure-volume-streaming`,cell:e,version:e.transform.version,structure:t}}function tet(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function net(e,t){return{kind:`structure-component`,cell:e,version:e.transform.version,structure:t,key:tet(e),representations:[]}}function ret(e,t){return{kind:`structure-representation`,cell:e,version:e.transform.version,component:t}}function iet(e,t){return{kind:`generic-representation`,cell:e,version:e.transform.version,parent:t}}function aet(e,t){return{state:e,oldHierarchy:t,hierarchy:v4(),changed:!1,added:new Set}}function y4(e,t,n,r,...i){let a=r(...i);n.push(a),e.hierarchy.refs.set(t.transform.ref,a);let o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(a.cell.transform.ref),e.changed=!0),a}function b4(e,t,n,...r){let i=n(...r);e.hierarchy.refs.set(t.transform.ref,i);let a=e.oldHierarchy.refs.get(t.transform.ref);return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function oet(e){return t=>e.is(t.obj)}function set(e,t){return(n,r)=>!t(r)&&e.is(n.obj)}function x4(e){return t=>t.transform.transformer===e}function S4(){}var cet=[[oet(H.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=y4(e,t,e.hierarchy.trajectories,q9e,t)},e=>e.currentTrajectory=void 0],[set(H.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentTrajectory?e.currentModel=y4(e,t,e.currentTrajectory.models,J9e,t,e.currentTrajectory):e.currentModel=b4(e,t,J9e,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[x4(IY.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.properties=b4(e,t,Y9e,t,e.currentModel)},S4],[x4(IY.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.unitcell=b4(e,t,X9e,t,e.currentModel)},S4],[set(H.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentModel?e.currentStructure=y4(e,t,e.currentModel.structures,Z9e,t,e.currentModel):e.currentStructure=b4(e,t,Z9e,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[x4(IY.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.properties=b4(e,t,Q9e,t,e.currentStructure)},S4],[x4(IY.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.transform=b4(e,t,$9e,t,e.currentStructure)},S4],[oet(_4),(e,t)=>(e.currentStructure&&(e.currentStructure.volumeStreaming=b4(e,t,eet,t,e.currentStructure)),!1),S4],[(e,t)=>!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:H.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent&&(e.parentComponents||=[],e.parentComponents.push(e.currentComponent)),e.currentComponent=y4(e,t,e.currentStructure.components,net,t,e.currentStructure))},e=>{e.parentComponents&&e.parentComponents.length>0?e.currentComponent=e.parentComponents.pop():e.currentComponent=void 0}],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&H.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&y4(e,t,e.currentComponent.representations,ret,t,e.currentComponent),!1),S4],[e=>!e.state.isGhost&&H.isRepresentation3D(e.obj),(e,t)=>{let n=e.currentComponent||e.currentStructure||e.currentModel;n&&(n.genericRepresentations||=[],y4(e,t,n.genericRepresentations,iet,t,n))},S4]];function uet(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Mx.Null||e.status!==`ok`&&e.status!==`error`)}function det(e){let{cell:t}=e;uet(t)||(this.changed=!0)}function fet(e){pet(this,this.tree.transforms.get(e))}function pet(e,t){let{state:n}=e,r=n.state.cells.get(t.ref);if(!uet(r))return;let i,a=!1;for(let[e,t,o]of cet)if(e(r,n)){if(t(n,r)===!1){a=!0;break}i=o;break}if(a)return;let o=e.tree.children.get(t.ref);o&&o.size&&o.forEach(fet,e),i&&i(n)}function met(e,t){let n={tree:e,state:t};return pet(n,e.root),n.state}var C4=class e extends zY{get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups||=e.getComponentGroups(this.selection.structures),this._currentComponentGroups}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(let e of this.selection.trajectories)this._currentSelectionSet.add(e.cell.transform.ref);for(let e of this.selection.models)this._currentSelectionSet.add(e.cell.transform.ref);for(let e of this.selection.structures)this._currentSelectionSet.add(e.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){let e=this.plugin.managers.structure.hierarchy.current.structures,t=[];for(let n of e)this.plugin.managers.structure.selection.structureHasSelection(n)&&t.push(n);return t}findStructure(e){if(!e)return;let t=this.plugin.helpers.substructureParent.get(e);if(!t)return;let n=this.plugin.state.data.selectQ(e=>e.byValue(t).rootOfType(H.Molecule.Structure))[0];if(n)return this.behaviors.selection.value.structures.find(e=>e.cell===n)}syncCurrent(e,t){let n=this.seletionSet,r=[];for(let i of e){let e=i.cell.transform.ref;(n.has(e)||t.has(e))&&r.push(i)}return r.length===0?e.length>0?[e[0]]:[]:r}sync(e){if(!e&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){e&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let t=K9e(this.plugin.state.data,this.current);if(!t.changed)return;let{hierarchy:n}=t,r=this.syncCurrent(n.trajectories,t.added),i=this.syncCurrent(n.models,t.added),a=this.syncCurrent(n.structures,t.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=n,this.state.selection.trajectories=r,this.state.selection.models=i,this.state.selection.structures=a,e?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,trajectories:r,models:i,structures:a})):this.state.notified=!1}updateCurrent(e,t){let n=this.current,r=t===`add`?$F.union(this.seletionSet,new Set(e.map(e=>e.cell.transform.ref))):$F.difference(this.seletionSet,new Set(e.map(e=>e.cell.transform.ref))),i=[],a=[],o=[];for(let e of n.trajectories)r.has(e.cell.transform.ref)&&i.push(e);for(let e of n.models)r.has(e.cell.transform.ref)&&a.push(e);for(let e of n.structures)r.has(e.cell.transform.ref)&&o.push(e);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=i,this.state.selection.models=a,this.state.selection.structures=o,this.behaviors.selection.next({hierarchy:n,trajectories:i,models:a,structures:o})}remove(e,t){if(e.length===0)return;let n=this.plugin.state.data.build();for(let t of e)n.delete(typeof t==`string`?t:t.cell.transform.ref);return n.commit({canUndo:t?`Remove`:!1})}toggleVisibility(e,t){if(e.length===0)return;let n=t===void 0?!e[0].cell.state.isHidden:t!==`show`;for(let t of e)$0(this.dataState,t.cell.transform.ref,n)}applyPreset(e,t,n){return this.plugin.dataTransaction(async()=>{for(let r of e)r.models.length>0&&await this.clearTrajectory(r),await this.plugin.builders.structure.hierarchy.applyPreset(r.cell,t,n)})}async updateStructure(e,t){await this.plugin.dataTransaction(async()=>{let n=PE.getDecoratorRoot(this.dataState.tree,e.cell.transform.ref),r=this.dataState.tree.children.get(n).toArray();await this.remove(r,!1),await this.plugin.state.updateTransform(this.plugin.state.data,e.cell.transform.ref,t,`Structure Type`),await this.plugin.builders.structure.representation.applyPreset(e.cell.transform.ref,`auto`)},{canUndo:`Structure Type`}),jx.Camera.Reset(this.plugin)}clearTrajectory(e){let t=this.dataState.build();for(let n of e.models)t.delete(n.cell);return t.commit()}constructor(e){super(),this.plugin=e,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:v4(),selection:{trajectories:[],models:[],structures:[]}},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})},this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.subscribe(e.state.data.events.changed,t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(e.behaviors.state.isAnimating,t=>{!t&&!e.behaviors.state.isUpdating.value&&this.sync(!0)})}};(function(e){function t(e){if(!e.length)return[];if(e.length===1)return e[0].components.map(e=>[e]);let t=[],n=new Map;for(let r of e)for(let e of r.components){let r=e.key;if(!r)continue;let i=n.get(r);i||(i=[],n.set(r,i),t.push(i)),i.push(e)}return t}e.getComponentGroups=t;function n(e){let{structures:t}=e.managers.structure.hierarchy.selection;if(t.length===0)return``;if(t.length===1){let e=t[0],n=e.cell.obj?.data;if(!n)return e.cell.obj?.label||`Structure`;let r=n.models[0]||n.representativeModel||n.masterModel;if(!r)return e.cell.obj?.label||`Structure`;let i=r.entryId;return e.model?.trajectory?.models&&e.model.trajectory.models.length===1?i:e.model?`${e.model.cell.obj?.label} | ${i}`:i}let n=t[0]?.model?.trajectory,r=!0;for(let e of t)if(e?.model?.trajectory!==n){r=!1;break}return r&&n?`${n.cell.obj?.label} | ${t.length} structures`:`${t.length} structures`}e.getSelectedStructuresDescription=n})(C4||={});var w4=class extends JX{constructor(){super(...arguments),this.onChange=({name:e,value:t})=>{let n={...this.props.params,[e]:t};this.props.events.onChange(n,this.areInitial(n),this.validate(n))}}validate(e){}areInitial(e){return V.areEqual(this.props.info.params,e,this.props.info.initialValues)}render(){return(0,I.jsx)(a4,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}};(function(e){function t(e){let t=Object.keys(e);for(let n of t)if(!e[n].isHidden)return!1;return!0}function n(e,n,r,i){let a=n.cells.get(i).obj,o=r.definition.params?r.definition.params(a,e):{};return{initialValues:V.getDefaultValues(o),params:o,isEmpty:t(o)}}e.infoFromAction=n;function r(e,n,r){let i=n.cells.get(r.ref),a=i.params&&i.params.definition||{};return{initialValues:i.params&&i.params.values||{},params:a,isEmpty:t(a)}}e.infoFromTransform=r})(w4||={});var het=class extends JX{constructor(){super(...arguments),this.busy=new cD(!1),this.onEnter=()=>{this.state.error||this.apply()},this.autoApplyHandle=void 0,this.events={onEnter:this.onEnter,onChange:(e,t,n)=>{this.clearAutoApply(),this.setState({params:e,isInitial:t,error:n&&n[0]},()=>{!t&&!this.state.error&&this.canAutoApply(e)&&(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}},this.apply=async()=>{var e,t;this.clearAutoApply(),this.setState({busy:!0});try{await this.applyAction()}catch(e){console.error(e)}finally{(t=(e=this.props).onApply)==null||t.call(e),this.busy.next(!1)}},this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})},this.setDefault=()=>{let e=this.getInfo(),t=V.getDefaultValues(e.params);this.setState({params:t,isInitial:V.areEqual(e.params,t,e.initialValues),error:void 0})},this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.busy.value!==e&&this.busy.next(e)}),this.subscribe(this.busy.pipe(_me(1)),e=>{this.setState({busy:e})})}renderApply(){let e=this.canApply();return this.props.autoHideApply&&(!e||this.canAutoApply(this.state.params))?null:(0,I.jsxs)(`div`,{className:`msp-transform-apply-wrap`,children:[(0,I.jsx)(HX,{svg:DX,className:`msp-transform-default-params`,onClick:this.setDefault,disabled:this.state.busy,title:`Set default params`}),(0,I.jsx)(`div`,{className:`msp-transform-apply-wider`,children:(0,I.jsx)(VX,{icon:e?hX:void 0,className:`msp-btn-commit msp-btn-commit-${e?`on`:`off`}`,onClick:this.apply,disabled:!e,children:this.props.applyLabel||this.applyText()})})]})}renderDefault(){let e=this.getInfo(),t=e.isEmpty&&this.isUpdate(),n=this.getHeader(),r=this.getTransformerId(),i=this.plugin.customParamEditors.has(r)?this.plugin.customParamEditors.get(r):w4,a=this.state.isCollapsed?`msp-transform-wrapper msp-transform-wrapper-collapsed`:`msp-transform-wrapper`,o=null;if(!t&&!this.state.isCollapsed){let{a:t,b:n,bCell:r}=this.getSourceAndTarget(),a=this.renderApply();o=(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(i,{info:e,a:t,b:n,bCell:r,events:this.events,params:this.state.params,isDisabled:this.state.busy}),a]})}let s=(0,I.jsxs)(`div`,{className:a,style:{marginBottom:this.props.noMargin?0:void 0},children:[n!==`none`&&!this.props.wrapInExpander&&(0,I.jsx)(`div`,{className:`msp-transform-header`,children:(0,I.jsxs)(VX,{onClick:this.toggleExpanded,title:n.description,children:[!t&&(0,I.jsx)(XY,{svg:this.state.isCollapsed?cX:sX}),n.name]})}),o]});return t||!this.props.wrapInExpander?s:(0,I.jsx)(WX,{header:this.isUpdate()?`Update ${n===`none`?``:n.name}`:`Apply ${n===`none`?``:n.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:s})}renderSimple(){let e=this.getInfo(),t=this.canApply(),n=(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{icon:this.props.simpleApply?.icon,title:this.props.simpleApply?.title,disabled:this.state.busy||!t,onClick:this.apply,className:`msp-btn-apply-simple`,children:this.props.simpleApply?.header}),!e.isEmpty&&(0,I.jsx)(UX,{icon:MX,label:``,title:`Options`,toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:`0 0 40px`,padding:0}})]});if(this.state.isCollapsed)return n;let r=this.getTransformerId(),i=this.plugin.customParamEditors.has(r)?this.plugin.customParamEditors.get(r):w4,{a,b:o,bCell:s}=this.getSourceAndTarget();return(0,I.jsxs)(I.Fragment,{children:[n,(0,I.jsx)(i,{info:e,a,b:o,bCell:s,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}},T4=class extends het{constructor(){super(...arguments),this._getInfo=gA(e=>w4.infoFromTransform(this.plugin,this.props.state,e)),this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){let{state:e}=this.props,t=e.cells.get(this.props.transform.ref);if(!t)return!1;if(t.status===`error`){let t=e.cells.get(this.props.transform.parent);return t?t.status===`ok`:!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?`Update`:`Nothing to Update`}isUpdate(){return!0}getSourceAndTarget(){let e=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:e?.obj,bCell:e}}canAutoApply(e){let t=this.props.transform.transformer.definition.canAutoUpdate;if(!t)return!1;let{state:n}=this.props,r=n.cells.get(this.props.transform.ref);return!r||!r.sourceRef||r.status!==`ok`?!1:t({a:n.cells.get(r.sourceRef).obj,b:r.obj,oldParams:this.getInfo().initialValues,newParams:e},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:e,state:t})=>{this.props.transform.ref!==e||this.props.state!==t||this.state.params!==this.props.transform.params&&(this._getInfo=gA(e=>w4.infoFromTransform(this.plugin,this.props.state,e)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(e){if(this.props.transform!==e.transform){let e=this.props.state.cells.get(this.props.transform.ref);this.setState({params:e.params?.values||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}},get=class extends JX{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){let{selection:e}=this.plugin.managers.structure.hierarchy;if(e.structures.length===0)return null;let t=[];for(let n of e.structures){let e=n.model;e?.unitcell&&e.unitcell?.cell.obj&&t.push(e.unitcell)}return t.length===0?null:(0,I.jsx)(_et,{refs:t,labelMultiple:`Unit Cells`})}get customControls(){let e=[];return this.plugin.genericRepresentationControls.forEach((t,n)=>{let[r,i]=t(this.plugin.managers.structure.hierarchy.selection);r.length>0&&e.push((0,I.jsx)(`div`,{children:(0,I.jsx)(_et,{refs:r,labelMultiple:i})},n))}),e.length>0?e:null}render(){return(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(`div`,{style:{marginTop:`6px`},children:[this.unitcell,this.customControls]})})}},_et=class extends JX{constructor(){super(...arguments),this.state={showOptions:!1},this.toggleVisibility=e=>{e.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),e.currentTarget.blur()},this.highlight=e=>{e.preventDefault(),this.pivot.cell.parent&&jx.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(e=>e.cell.transform.ref)})},this.clearHighlight=e=>{e.preventDefault(),jx.Interactivity.ClearHighlights(this.plugin)},this.focus=e=>{e.preventDefault();let t=!0;for(let e of this.props.refs)if(!e.cell.state.isHidden){t=!1;break}t&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,`show`);let n=[];for(let e of this.props.refs){if(e.cell.state.isHidden)continue;let t=e.cell.obj?.data.repr.getLoci();t&&n.push(t)}this.plugin.managers.camera.focusLoci(n)},this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{wD.ObjectEvent.isCell(e,this.pivot?.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){let{refs:e,labelMultiple:t}=this.props;if(e.length===0)return null;let n=e[0],r,i;if(e.length===1){let{obj:e}=n.cell;if(!e)return null;r=e?.label,i=e?.description}else r=`${e.length} ${t||`Objects`}`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsxs)(`button`,{className:`msp-form-control msp-control-button-label`,title:`${r}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:`left`},children:[r,` `,(0,I.jsx)(`small`,{children:i})]}),(0,I.jsx)(HX,{svg:n.cell.state.isHidden?NX:PX,toggleState:!1,className:`msp-form-control`,onClick:this.toggleVisibility,title:`${n.cell.state.isHidden?`Show`:`Hide`}`,small:!0,flex:!0}),e.length===1&&(0,I.jsx)(HX,{svg:CX,className:`msp-form-control`,onClick:this.toggleOptions,title:`Options`,toggleState:this.state.showOptions,flex:!0})]}),e.length===1&&this.state.showOptions&&n.cell.parent&&(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(T4,{state:n.cell.parent,transform:n.cell.transform,customHeader:`none`,autoHideApply:!0})})})]})}},vet=class extends YX{defaultState(){return{header:`Components`,isCollapsed:!1,isDisabled:!1,brand:{accent:`blue`,svg:rX}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>this.setState({description:C4.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(yet,{}),(0,I.jsx)(Cet,{}),(0,I.jsx)(get,{})]})}},yet=class extends JX{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1,canUndo:!1},this.togglePreset=this.toggleAction(`preset`),this.toggleAdd=this.toggleAction(`add`),this.toggleOptions=this.toggleAction(`options`),this.hideAction=()=>this.setState({action:void 0}),this.applyPreset=e=>{if(this.hideAction(),!e)return;let t=this.plugin.managers.structure,{structures:n}=t.hierarchy.selection;e.value===null?t.component.clear(n):t.component.applyPreset(n,e.value)},this.undo=()=>{let e=this.plugin.state.data.undo();e&&this.plugin.runTask(e)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>this.setState({action:this.state.action!==`options`||e.structures.length===0?void 0:`options`,isEmpty:e.structures.length===0})),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,action:this.state.action===`options`?`options`:void 0})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:e})=>{this.setState({canUndo:e.canUndo})})}toggleAction(e){return()=>this.setState({action:this.state.action===e?void 0:e})}get presetControls(){return(0,I.jsx)(Y2,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){let e=this.plugin.managers.structure.component.pivotStructure,t=this.plugin.builders.structure.representation.getPresets(e?.cell.obj);return Y2.createItems(t,{label:e=>e.display.name,category:e=>e.display.group,description:e=>e.display.description})}render(){let e=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:`Some mistakes of the past can be undone.`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(UX,{icon:dX,label:`Preset`,title:`Apply a representation preset for the current structure(s).`,toggle:this.togglePreset,isSelected:this.state.action===`preset`,disabled:this.isDisabled}),(0,I.jsx)(UX,{icon:aX,label:`Add`,title:`Add a new representation component for a selection.`,toggle:this.toggleAdd,isSelected:this.state.action===`add`,disabled:this.isDisabled}),(0,I.jsx)(UX,{icon:MX,label:``,title:`Options that are applied to all applicable representations.`,style:{flex:`0 0 40px`,padding:0},toggle:this.toggleOptions,isSelected:this.state.action===`options`,disabled:this.isDisabled}),(0,I.jsx)(HX,{svg:kX,className:`msp-flex-item`,flex:`40px`,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:e})]}),this.state.action===`preset`&&this.presetControls,this.state.action===`add`&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(bet,{onApply:this.hideAction})}),this.state.action===`options`&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(xet,{isDisabled:this.isDisabled})})]})}},bet=class extends JX{constructor(){super(...arguments),this.state=this.createState(),this.apply=()=>{let e=this.props.forSelection?this.currentStructures:this.selectedStructures;this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,e)},this.paramsChanged=e=>this.setState({values:e})}createState(){let e=h4.getAddParams(this.plugin);return{params:e,values:V.getDefaultValues(e)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,I.jsx)(VX,{icon:aX,title:`Use Selection and optional Representation to create a new Component.`,className:`msp-btn-commit msp-btn-commit-on`,onClick:this.apply,style:{marginTop:`1px`},children:`Create Component`})]})}},xet=class extends JX{constructor(){super(...arguments),this.update=e=>this.plugin.managers.structure.component.setOptions(e)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,I.jsx)(a4,{params:h4.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}},Cet=class extends JX{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){let e=this.plugin.managers.structure.hierarchy.currentComponentGroups;return e.length===0?null:(0,I.jsx)(`div`,{style:{marginTop:`6px`},children:e.map(e=>(0,I.jsx)(wet,{group:e},e[0].cell.transform.ref))})}},wet=class extends JX{constructor(){super(...arguments),this.state={action:void 0},this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)},this.selectAction=e=>{e&&(e?.value)()},this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0),this.toggleAction=()=>this.setState({action:this.state.action===`action`?void 0:`action`}),this.toggleLabel=()=>this.setState({action:this.state.action===`label`?void 0:`label`}),this.highlight=e=>{e.preventDefault(),this.props.group[0].cell.parent&&jx.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(e=>e.cell.transform.ref)})},this.clearHighlight=e=>{e.preventDefault(),jx.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{let e=!0;for(let t of this.props.group)if(!t.cell.state.isHidden){e=!1;break}e&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,`show`),this.plugin.managers.camera.focusSpheres(this.props.group,e=>{if(!e.cell.state.isHidden)return e.cell.obj?.data.boundary.sphere})},this.updateLabel=e=>{this.plugin.managers.structure.component.updateLabel(this.pivot,e)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{wD.ObjectEvent.isCell(e,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){let e=this.plugin.managers.structure.component,t=this.pivot.representations[0].cell.transform.params?.colorTheme.name,n=W1e(this.plugin,this.pivot.cell.obj?.data);return Y2.createItemsFromSelectOptions(n,{value:t=>()=>e.updateRepresentationsTheme(this.props.group,{color:t[0]}),selected:e=>e[0]===t})}get actions(){let e=this.plugin.managers.structure.component,t=[[Y2.Header(`Add Representation`),...h4.getRepresentationTypes(this.plugin,this.props.group[0]).map(t=>Y2.Item(t[1],()=>e.addRepresentation(this.props.group,t[0])))]];return this.pivot.representations.length>0&&t.push([Y2.Header(`Set Coloring`,{isIndependent:!0}),...this.colorByActions]),e.canBeModified(this.props.group[0])&&t.push([Y2.Header(`Modify by Selection`),Y2.Item(`Include`,()=>e.modifyByCurrentSelection(this.props.group,`union`),{icon:$Y}),Y2.Item(`Subtract`,()=>e.modifyByCurrentSelection(this.props.group,`subtract`),{icon:eX}),Y2.Item(`Intersect`,()=>e.modifyByCurrentSelection(this.props.group,`intersect`),{icon:tX})]),t.push(Y2.Item(`Select This`,()=>e.selectThis(this.props.group),{icon:nX})),e.canBeModified(this.props.group[0])&&t.push(Y2.Item(`Edit Label`,this.toggleLabel)),t}get reprLabel(){let e=this.pivot;return e.representations.length===0?`No repr.`:e.representations.length===1?e.representations[0].cell.obj?.label:`${e.representations.length} reprs`}render(){let e=this.pivot,t=e.cell,n=t.obj?.label,r=this.reprLabel;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsxs)(VX,{noOverflow:!0,className:`msp-control-button-label`,title:`${n}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:`left`},children:[n,(0,I.jsx)(`small`,{className:`msp-25-lower-contrast-text`,style:{float:`right`},children:r})]}),(0,I.jsx)(HX,{svg:t.state.isHidden?NX:PX,toggleState:!1,onClick:this.toggleVisible,title:`${t.state.isHidden?`Show`:`Hide`} component`,small:!0,className:`msp-form-control`,flex:!0}),(0,I.jsx)(HX,{svg:vX,toggleState:!1,onClick:this.remove,title:`Remove`,small:!0,className:`msp-form-control`,flex:!0}),(0,I.jsx)(HX,{svg:CX,onClick:this.toggleAction,title:`Actions`,toggleState:this.state.action===`action`,className:`msp-form-control`,flex:!0})]}),this.state.action===`label`&&(0,I.jsx)(`div`,{className:`msp-control-offset`,style:{marginBottom:`6px`},children:(0,I.jsx)(GX,{label:`Label`,control:(0,I.jsxs)(`div`,{style:{display:`flex`,textAlignLast:`center`},children:[(0,I.jsx)(zX,{onChange:this.updateLabel,value:n,style:{flex:`1 1 auto`,minWidth:0},className:`msp-form-control`,blurOnEnter:!0,blurOnEscape:!0}),(0,I.jsx)(HX,{svg:hX,onClick:this.toggleLabel,className:`msp-form-control msp-control-button-label`,flex:!0})]})})}),this.state.action===`action`&&(0,I.jsxs)(`div`,{className:`msp-accent-offset`,children:[(0,I.jsx)(`div`,{style:{marginBottom:`6px`},children:(0,I.jsx)(Y2,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,I.jsx)(`div`,{style:{marginBottom:`6px`},children:e.representations.map(e=>(0,I.jsx)(Tet,{group:this.props.group,representation:e},e.cell.transform.ref))})]})]})}},Tet=class extends JX{constructor(){super(...arguments),this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation),this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)},this.update=e=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,e)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{wD.ObjectEvent.isCell(e,this.props.representation.cell)&&this.forceUpdate()})}render(){let e=this.props.representation.cell;return(0,I.jsxs)(`div`,{className:`msp-representation-entry`,children:[e.parent&&(0,I.jsx)(WX,{header:`${e.obj?.label||``} Representation`,noOffset:!0,children:(0,I.jsx)(T4,{state:e.parent,transform:e.transform,customHeader:`none`,customUpdate:this.update,noMargin:!0})}),(0,I.jsx)(HX,{svg:vX,onClick:this.remove,title:`Remove`,small:!0,className:`msp-default-bg`,toggleState:!1,style:{position:`absolute`,top:0,right:`32px`,lineHeight:`24px`,height:`24px`,textAlign:`right`,width:`44px`,paddingRight:`6px`,background:`none`}}),(0,I.jsx)(HX,{svg:this.props.representation.cell.state.isHidden?NX:PX,toggleState:!1,onClick:this.toggleVisible,title:`Toggle Visibility`,small:!0,className:`msp-default-bg`,style:{position:`absolute`,top:0,right:0,lineHeight:`24px`,height:`24px`,textAlign:`right`,width:`32px`,paddingRight:`6px`,background:`none`}})]})}},E4=class e extends BY{get props(){return{...this.state.props}}setProps(e){let t=this.props,n={...this.state.props,...e};HT(t,n)||(this.updateState({props:n}),this.lociSelects.setProps(n),this.lociHighlights.setProps(n),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}constructor(t,n={}){super({props:{...V.getDefaultValues(e.Params),...n}}),this.plugin=t,this._props=V.getDefaultValues(e.Params),this.events={propsUpdated:this.ev()},this.lociSelects=new e.LociSelectManager(t,this._props),this.lociHighlights=new e.LociHighlightManager(t,this._props)}};(function(e){e.Params={granularity:V.Select(`residue`,yq.GranularityOptions,{label:`Picking Level`,description:`Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements`})};class t{setProps(e){Object.assign(this.props,e)}addProvider(e){this.providers.push(e)}removeProvider(e){this.providers=this.providers.filter(t=>t!==e)}normalizedLoci(e,t,n=!1){let{loci:r,repr:i}=e,a=t?this.props.granularity:void 0;return{loci:yq.normalize(r,a,n),repr:i}}mark(e,t,n=!1){if(!yq.isEmpty(e.loci))for(let r of this.providers)r(e,t,n)}dispose(){this.providers.length=0,this.sel.dispose()}constructor(t,n={}){this.ctx=t,this.providers=[],this.props=V.getDefaultValues(e.Params),this.sel=t.managers.structure.selection,this.setProps(n)}}e.LociMarkManager=t;class n extends t{constructor(){super(...arguments),this.prev=[],this.clearHighlights=(e=!1)=>{for(let t of this.prev)this.mark(t,lq.RemoveHighlight,e);this.prev.length=0}}isHighlighted(e){for(let t of this.prev)if(rJ.Loci.areEqual(t,e))return!0;return!1}addHighlight(e){this.mark(e,lq.Highlight),this.prev.push(e)}highlight(e,t=!0){let n=this.normalizedLoci(e,t);this.isHighlighted(n)||this.addHighlight(n)}highlightOnly(e,t=!0){let n=this.normalizedLoci(e,t);this.isHighlighted(n)||(yq.isEmpty(n.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(n)))}highlightOnlyExtend(e,t=!0){let n=this.normalizedLoci(e,t);if($.is(n.loci)){let e={loci:(this.ctx.selectionMode?this.sel.tryGetRange(n.loci):this.ctx.managers.structure.focus.tryGetRange(n.loci))??n.loci,repr:n.repr};this.isHighlighted(e)||(yq.isEmpty(e.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(e)))}}dispose(){super.dispose(),this.prev.length=0}}e.LociHighlightManager=n;class r extends t{toggle(e,t=!0){if(yq.isEmpty(e.loci))return;let n=this.normalizedLoci(e,t,!0);$.is(n.loci)?this.toggleSel(n):super.mark(n,lq.Toggle)}toggleExtend(e,t=!0){if(yq.isEmpty(e.loci))return;let n=this.normalizedLoci(e,t,!0);if($.is(n.loci)){let e=this.sel.tryGetRange(n.loci)||n.loci;this.toggleSel({loci:e,repr:n.repr})}}select(e,t=!0){let n=this.normalizedLoci(e,t,!0);$.is(n.loci)&&this.sel.modify(`add`,n.loci),this.mark(n,lq.Select)}selectJoin(e,t=!0){let n=this.normalizedLoci(e,t,!0);$.is(n.loci)&&this.sel.modify(`intersect`,n.loci),this.mark(n,lq.Select)}selectOnly(e,t=!0){let n=this.normalizedLoci(e,t,!0);$.is(n.loci)&&(this.mark({loci:nB.Loci(n.loci.structure),repr:n.repr},lq.Deselect),this.sel.modify(`set`,n.loci)),this.mark(n,lq.Select)}deselect(e,t=!0){let n=this.normalizedLoci(e,t,!0);$.is(n.loci)&&this.sel.modify(`remove`,n.loci),this.mark(n,lq.Deselect)}deselectAll(){this.sel.clear(),this.mark({loci:pq},lq.Deselect)}deselectAllOnEmpty(e){gq(e.loci)&&this.deselectAll()}mark(e,t){let{loci:n}=e;if(!yq.isEmpty(n))if($.is(n)){let e=this.sel.getLoci(n.structure);super.mark({loci:nB.Loci(n.structure)},lq.Deselect,!yq.isEmpty(e)),super.mark({loci:e},lq.Select)}else super.mark(e,t)}toggleSel(e){this.sel.has(e.loci)?(this.sel.modify(`remove`,e.loci),this.mark(e,lq.Deselect)):(this.sel.modify(`add`,e.loci),this.mark(e,lq.Select))}}e.LociSelectManager=r})(E4||={});function Eet(e,t){let n=[],r=t===`auth`?`auth_asym_id`:`label_asym_id`,i=t===`auth`?`auth_seq_id`:`label_seq_id`;for(let t of e)if(t.kind===`range`)n.push(Z.struct.generator.atomGroups({"chain-test":Z.core.rel.eq([Z.ammp(r),t.asym_id]),"residue-test":Z.core.rel.inRange([Z.ammp(i),t.seq_id_beg,t.seq_id_end])}));else{let e=(t.ins_code??``).trim();n.push(Z.struct.generator.atomGroups({"chain-test":Z.core.rel.eq([Z.ammp(r),t.asym_id]),"residue-test":Z.core.logic.and([Z.core.rel.eq([Z.ammp(i),t.seq_id]),Z.core.rel.eq([Z.ammp(`pdbx_PDB_ins_code`),e])])}))}return lB(Z.struct.combinator.merge(n))}function Det(e){let t=CD.create();for(let[n,r]of e)for(let e=n;e<=r;e++)CD.add(t,e,e);return lB(Z.struct.generator.atomGroups({"atom-test":Z.core.set.has([Z.set(...t.array),Z.ammp(`id`)])}))}function Oet(e){let t=CD.create();for(let[n,r]of e)for(let e=n;e<=r;e++)CD.add(t,e.toString(),e.toString());return lB(Z.struct.generator.atomGroups({"atom-test":Z.core.set.has([Z.set(...t.array),Z.acp(`elementSymbol`)])}))}function ket(e){return lB(Z.struct.generator.atomGroups({"atom-test":Z.core.set.has([Z.set(...e),Z.acp(`elementSymbol`)])}))}function Aet(e,t,n){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(n)?{kind:`single`,asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:`range`,asym_id:e,seq_id_beg:+t[0],seq_id_end:n}}function jet(e){return e?e.split(`:`):[]}function Met(e){return e.split(`,`).map(e=>e.trim().split(/\s+|[-]/g).filter(e=>!!e)).map(e=>Aet(e[0],jet(e[1]),+e[2])).filter(e=>!!e)}function Net(e){return e.split(`,`).map(e=>e.trim().split(/\s+|[-]/g).filter(e=>!!e)).filter(e=>e.length===1||e.length===2).map(e=>e.length===1?[+e[0],+e[0]]:[+e[0],+e[1]])}function Pet(e,t){return t===`atom-id`?Det(Net(e)):t===`element-symbol`?/[a-zA-Z]/.test(e)?ket(e.split(`,`).map(e=>e.trim())):Oet(Net(e)):Eet(Met(e),t)}function Fet(e){return Object.keys(e).map(t=>[t,e[t]]).filter(e=>t0.isBinding(e[1]))}var D4=class extends y.PureComponent{getBindingComponents(){return(0,I.jsx)(I.Fragment,{children:Fet(this.props.bindings).map(e=>{let[t,n]=e;return t0.isEmpty(n)?null:(0,I.jsxs)(`div`,{style:{marginBottom:`6px`},children:[(0,I.jsx)(`b`,{children:n.action}),(0,I.jsx)(`br`,{}),(0,I.jsx)(`span`,{dangerouslySetInnerHTML:{__html:t0.format(n,t)}})]},t)})})}render(){return(0,I.jsx)(O4,{children:this.getBindingComponents()})}},O4=class extends y.PureComponent{render(){return(0,I.jsx)(`div`,{className:`msp-help-text`,children:(0,I.jsx)(`div`,{children:this.props.children})})}},k4=class extends y.PureComponent{constructor(){super(...arguments),this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,I.jsxs)(`div`,{className:`msp-control-group-wrapper`,children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsxs)(VX,{onClick:this.toggleExpanded,children:[(0,I.jsx)(XY,{svg:this.state.isExpanded?sX:cX}),this.props.header]})}),this.state.isExpanded&&(0,I.jsx)(`div`,{className:`msp-control-offset`,style:{display:this.state.isExpanded?`block`:`none`},children:this.props.children})]})}};function A4(e){return(0,I.jsx)(`div`,{className:`msp-simple-help-section`,children:e.header})}var j4=class extends qX{constructor(){super(...arguments),this.getInteractionBindings=gA(e=>{let t;return e.forEach(e=>{let n=e.params?.values;n?.bindings&&Object.keys(n.bindings).length>0&&(t||={},Object.assign(t,n.bindings))}),t})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){let e=this.getInteractionBindings(this.plugin.state.behaviors.cells);return(0,I.jsxs)(I.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,I.jsx)(k4,{header:`Moving in 3D`,children:(0,I.jsx)(D4,{bindings:this.plugin.canvas3d.attribs.trackball.bindings})},`trackball`),!!e&&(0,I.jsx)(k4,{header:`Mouse & Key Controls`,children:(0,I.jsx)(D4,{bindings:e})},`interactions`)]})}},Iet=class extends qX{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(e){return e.triggers.map(e=>t0.Trigger.format(e)).join(` or `)}getTriggerFor(e,t){let n=this.plugin.state.behaviors.select(FE.Generators.ofTransformer(e)),r=n.length===1?n[0].params:void 0,i=r?r.values.bindings:{},a=t in i?i[t]:t0.Empty;return this.formatTriggers(a)}render(){let e=this.getTriggerFor(p8e,`clickSelectToggle`),t=this.getTriggerFor(i2,`clickFocus`);return(0,I.jsxs)(`div`,{children:[(0,I.jsx)(A4,{header:`Interface Controls`}),(0,I.jsxs)(k4,{header:`Inline Help`,children:[(0,I.jsx)(O4,{children:`Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text.`}),(0,I.jsx)(O4,{children:`Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse.`})]}),(0,I.jsx)(k4,{header:`Selections`,children:(0,I.jsxs)(O4,{children:[`The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by`,(0,I.jsxs)(`ul`,{style:{paddingLeft:`20px`},children:[(0,I.jsxs)(`li`,{children:[`picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using `,e,` (for more see help section on `,(0,I.jsx)(`i`,{children:`Mouse Controls`}),`)`]}),(0,I.jsxs)(`li`,{children:[`using the `,(0,I.jsx)(`i`,{children:`Add`}),`, `,(0,I.jsx)(`i`,{children:`Remove`}),` and `,(0,I.jsx)(`i`,{children:`Only`}),` dropdown buttons in the `,(0,I.jsx)(`i`,{children:`Manage Selection`}),` panel which allow modifing the current selection by predefined sets`]})]})]})}),(0,I.jsx)(k4,{header:`Coloring`,children:(0,I.jsxs)(O4,{children:[`There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the `,(0,I.jsx)(`i`,{children:`Structure Settings`}),` panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on `,(0,I.jsx)(`i`,{children:`Selections`}),`) and, second, choose a color from the color dropdown botton in the `,(0,I.jsx)(`i`,{children:`Selection`}),` row of the `,(0,I.jsx)(`i`,{children:`Change Representation`}),` panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown.`]})}),(0,I.jsx)(k4,{header:`Representations`,children:(0,I.jsxs)(O4,{children:[`Structures can be shown with many different representations (e.g. cartoon or spacefill). The `,(0,I.jsx)(`i`,{children:`Change Representation`}),` panel offers a collection of predefined styles which can be applied using the `,(0,I.jsx)(`i`,{children:`Preset`}),` dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on `,(0,I.jsx)(`i`,{children:`Selections`}),`) and, second, choose a representation to hide or show from the `,(0,I.jsx)(`i`,{children:`Show`}),` and `,(0,I.jsx)(`i`,{children:`Hide`}),` dropdown bottons in the `,(0,I.jsx)(`i`,{children:`Selection`}),` row of the `,(0,I.jsx)(`i`,{children:`Change Representation`}),` panel. The `,(0,I.jsx)(`i`,{children:`Everything`}),` row applies the action to the whole structure instead of the current selection.`]})}),(0,I.jsx)(k4,{header:`Surroundings`,children:(0,I.jsxs)(O4,{children:[`To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using `,t,`.`]})}),(0,I.jsx)(A4,{header:`How-to Guides`}),(0,I.jsx)(k4,{header:`Create an Image`,children:(0,I.jsxs)(O4,{children:[(0,I.jsxs)(`p`,{children:[`Use the `,(0,I.jsx)(XY,{svg:NWe}),` icon in the viewport to bring up the screenshot controls.`]}),(0,I.jsxs)(`p`,{children:[`To adjust the size of the image, use the `,(0,I.jsx)(`i`,{children:`Resolution`}),` dropdown.`]})]})}),(0,I.jsx)(A4,{header:`Mouse Controls`}),(0,I.jsx)(j4,{})]})}},M4=class extends JX{constructor(){super(...arguments),this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){let e=this.props.inline?{background:`transparent`,width:`auto`,height:`auto`,lineHeight:`unset`}:{background:`transparent`};return(0,I.jsx)(HX,{svg:LGe,onClick:this._toggleSelMode,title:`Toggle Selection Mode`,style:e,toggleState:this.plugin.selectionMode})}},N4={granularity:E4.Params.granularity},P4=new Map([[`add`,`Add/Union Selection`],[`remove`,`Remove/Subtract Selection`],[`intersect`,`Intersect Selection`],[`set`,`Set Selection`]]),Let=class extends qX{constructor(){super(...arguments),this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1,structureSelectionParams:N4},this.set=(e,t)=>{this.plugin.managers.structure.selection.fromSelectionQuery(e,t,!1)},this.selectQuery=(e,t)=>{if(!e||!this.state.action){this.setState({action:void 0});return}let n=this.state.action;t?.shiftKey?this.set(n,e.value):this.setState({action:void 0},()=>{this.set(n,e.value)})},this.selectHelper=(e,t)=>{if(console.log(e),!e||!this.state.action){this.setState({action:void 0,helper:void 0});return}this.setState({helper:e.value.kind})},this.queriesItems=[],this.queriesVersion=-1,this.helpersItems=void 0,this.toggleAdd=this.showAction(`add`),this.toggleRemove=this.showAction(`remove`),this.toggleIntersect=this.showAction(`intersect`),this.toggleSet=this.showAction(`set`),this.toggleTheme=this.showAction(`theme`),this.toggleAddComponent=this.showAction(`add-component`),this.toggleHelp=this.showAction(`help`),this.setGranuality=({value:e})=>{this.plugin.managers.interactivity.setProps({granularity:e})},this.turnOff=()=>this.plugin.selectionMode=!1,this.undo=()=>{let e=this.plugin.state.data.undo();e&&this.plugin.runTask(e)},this.subtract=()=>{let e=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),t=[];for(let n of e)t.push(...n.components);t.length!==0&&this.plugin.managers.structure.component.modifyByCurrentSelection(t,`subtract`)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{let t=e.hierarchy.structures.length===0;this.state.isEmpty!==t&&this.setState({isEmpty:t}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:e})=>{this.setState({canUndo:e.canUndo})});let e=this.plugin.spec.components?.selectionTools?.granularityOptions;if(e){let t=new Set(e),n={...N4,granularity:{...N4.granularity,options:N4.granularity.options.filter(([e])=>t.has(e))}};this.setState({structureSelectionParams:n})}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){let e=[];for(let t of this.plugin.managers.structure.hierarchy.selection.structures){let n=t.cell.obj?.data;n&&e.push(n)}return e}get queries(){let{registry:e}=this.plugin.query.structure;if(e.version!==this.queriesVersion){let t=this.structures,n=[...e.list,...OFe(t),...DFe(t),...EFe(t)].sort((e,t)=>t.priority-e.priority);this.queriesItems=Y2.createItems(n,{filter:e=>e!==aU.current&&!e.isHidden,label:e=>e.label,category:e=>e.category,description:e=>e.description}),this.queriesVersion=e.version}return this.queriesItems}get helpers(){return this.helpersItems||=Y2.createItems([{kind:`residue-list`,category:`Helpers`,label:`Atom/Residue Identifier List`,description:`Create a selection from a list of atom/residue ranges.`}],{label:e=>e.label,category:e=>e.category,description:e=>e.description}),this.helpersItems}showAction(e){return()=>this.setState({action:this.state.action===e?void 0:e,helper:void 0})}render(){let e=this.plugin.managers.interactivity.props.granularity,t=this.plugin.spec.components?.selectionTools?.hide,n=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:`Some mistakes of the past can be undone.`,r;if(this.state.action&&!this.state.helper)r=(0,I.jsxs)(I.Fragment,{children:[this.state.action&&this.state.action!==`theme`&&this.state.action!==`add-component`&&this.state.action!==`help`&&(0,I.jsxs)(`div`,{className:`msp-selection-viewport-controls-actions`,children:[(0,I.jsx)(Y2,{header:P4.get(this.state.action),title:`Click to close.`,items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,I.jsx)(Y2,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),this.state.action===`theme`&&(0,I.jsx)(`div`,{className:`msp-selection-viewport-controls-actions`,children:(0,I.jsx)(LX,{header:`Theme`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:_X,children:(0,I.jsx)(zet,{onApply:this.toggleTheme})})}),this.state.action===`add-component`&&(0,I.jsx)(`div`,{className:`msp-selection-viewport-controls-actions`,children:(0,I.jsx)(LX,{header:`Add Component`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:_X,children:(0,I.jsx)(bet,{onApply:this.toggleAddComponent,forSelection:!0})})}),this.state.action===`help`&&(0,I.jsx)(`div`,{className:`msp-selection-viewport-controls-actions`,children:(0,I.jsxs)(LX,{header:`Help`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:_X,maxHeight:`300px`,children:[(0,I.jsx)(k4,{header:`Selection Operations`,children:(0,I.jsxs)(O4,{children:[`Use `,(0,I.jsx)(XY,{svg:$Y,inline:!0}),` `,(0,I.jsx)(XY,{svg:eX,inline:!0}),` `,(0,I.jsx)(XY,{svg:tX,inline:!0}),` `,(0,I.jsx)(XY,{svg:nX,inline:!0}),` to modify the selection.`]})}),(0,I.jsx)(k4,{header:`Representation Operations`,children:(0,I.jsxs)(O4,{children:[`Use `,(0,I.jsx)(XY,{svg:fX,inline:!0}),` `,(0,I.jsx)(XY,{svg:rX,inline:!0}),` `,(0,I.jsx)(XY,{svg:OX,inline:!0}),` `,(0,I.jsx)(XY,{svg:kX,inline:!0}),` to color, create components, remove from components, or undo actions.`]})}),(0,I.jsx)(j4,{selectOnly:!0})]})})]});else if(P4.has(this.state.action)&&this.state.helper===`residue-list`){let e=()=>this.setState({action:void 0,helper:void 0});r=(0,I.jsx)(`div`,{className:`msp-selection-viewport-controls-actions`,children:(0,I.jsx)(LX,{header:`Atom/Residue Identifier List`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:e,topRightIcon:_X,children:(0,I.jsx)(Het,{modifier:this.state.action,plugin:this.plugin,close:e})})})}return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,style:{background:`none`},children:[!t?.granularity&&(0,I.jsx)(u4,{title:`Picking Level for selecting and highlighting`,param:this.state.structureSelectionParams.granularity,name:`granularity`,value:e,onChange:this.setGranuality,isDisabled:this.isDisabled}),!t?.union&&(0,I.jsx)(UX,{icon:$Y,title:`${P4.get(`add`)}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:this.state.action===`add`,disabled:this.isDisabled}),!t?.subtract&&(0,I.jsx)(UX,{icon:eX,title:`${P4.get(`remove`)}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:this.state.action===`remove`,disabled:this.isDisabled}),!t?.intersect&&(0,I.jsx)(UX,{icon:tX,title:`${P4.get(`intersect`)}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:this.state.action===`intersect`,disabled:this.isDisabled}),!t?.set&&(0,I.jsx)(UX,{icon:nX,title:`${P4.get(`set`)}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:this.state.action===`set`,disabled:this.isDisabled}),!t?.theme&&(0,I.jsx)(UX,{icon:fX,title:`Apply Theme to Selection`,toggle:this.toggleTheme,isSelected:this.state.action===`theme`,disabled:this.isDisabled,style:{marginLeft:`10px`}}),!t?.componentAdd&&(0,I.jsx)(UX,{icon:rX,title:`Create Component of Selection with Representation`,toggle:this.toggleAddComponent,isSelected:this.state.action===`add-component`,disabled:this.isDisabled}),!t?.componentRemove&&(0,I.jsx)(HX,{svg:OX,title:`Remove/subtract Selection from all Components`,onClick:this.subtract,disabled:this.isDisabled}),!t?.undo&&(0,I.jsx)(HX,{svg:kX,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:n}),!t?.help&&(0,I.jsx)(UX,{icon:xX,title:`Show/hide help`,toggle:this.toggleHelp,style:{marginLeft:`10px`},isSelected:this.state.action===`help`}),!t?.cancel&&this.plugin.config.get(WQ.Viewport.ShowSelectionMode)&&(0,I.jsx)(HX,{svg:pX,title:`Turn selection mode off`,onClick:this.turnOff})]}),r]})}},Ret=class extends qX{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1},this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll(),this.focus=()=>{if(this.plugin.managers.structure.selection.stats.elementCount===0)return;let{sphere:e}=this.plugin.managers.structure.selection.getBoundary();this.plugin.managers.camera.focusSphere(e)},this.highlight=e=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(e=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:e.selection},!1)})},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{let t=e.structures.length===0;this.state.isEmpty!==t&&this.setState({isEmpty:t})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){let e=this.plugin.managers.structure.selection.stats;return e.structureCount===0||e.elementCount===0?`Nothing Selected`:`${YT(e.label)} Selected`}render(){let e=this.plugin.managers.structure.selection.stats,t=e.structureCount===0||e.elementCount===0;return t&&this.props.hideOnEmpty?null:(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{noOverflow:!0,onClick:this.focus,title:`Click to Focus Selection`,disabled:t,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:t?void 0:`left`},children:this.stats}),!t&&(0,I.jsx)(HX,{svg:pX,onClick:this.clear,title:`Clear`,className:`msp-form-control`,flex:!0})]})})}},zet=class extends JX{constructor(){super(...arguments),this._params=gA(e=>h4.getThemeParams(this.plugin,e)),this.state={values:V.getDefaultValues(this.params)},this.apply=()=>{var e,t;this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),(t=(e=this.props).onApply)==null||t.call(e)},this.paramsChanged=e=>this.setState({values:e})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,I.jsx)(VX,{icon:fX,className:`msp-btn-commit msp-btn-commit-on`,onClick:this.apply,style:{marginTop:`1px`},children:`Apply Theme`})]})}},Bet={idType:V.Select(`auth`,V.arrayToOptions([`auth`,`label`,`atom-id`,`element-symbol`])),identifiers:V.Text(``,{description:`A comma separated list of atom identifiers (e.g. 10, 15-25), element symbols (e.g. N, C or 20-200) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)`})},Vet=V.getDefaultValues(Bet);function Het({modifier:e,plugin:t,close:n}){let[r,i]=y.useState(Vet),a=()=>{if(r.identifiers.trim().length!==0)try{n();let i=Pet(r.identifiers,r.idType);t.managers.structure.selection.fromCompiledQuery(e,i,!1)}catch(e){console.error(e),t.log.error(`Failed to create selection`)}};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:Bet,values:r,onChangeValues:i,onEnter:a}),(0,I.jsxs)(VX,{className:`msp-btn-commit msp-btn-commit-on`,disabled:r.identifiers.trim().length===0,onClick:a,style:{marginTop:`1px`},children:[qT(e),` Selection`]})]})}var Uet=class extends YX{defaultState(){return{isCollapsed:!1,header:`Measurements`,brand:{accent:`gray`,svg:uWe}}}renderControls(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Get,{}),(0,I.jsx)(Wet,{})]})}},Wet=class extends JX{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(e,t){let n=[];for(let t of e)t.obj&&n.push((0,I.jsx)(qet,{cell:t},t.obj.id));return n.length?(0,I.jsx)(WX,{header:t,initiallyExpanded:!0,children:n}):null}render(){let e=this.plugin.managers.structure.measurement.state;return(0,I.jsxs)(`div`,{style:{marginTop:`6px`},children:[this.renderGroup(e.labels,`Labels`),this.renderGroup(e.distances,`Distances`),this.renderGroup(e.angles,`Angles`),this.renderGroup(e.dihedrals,`Dihedrals`),this.renderGroup(e.orientations,`Orientations`),this.renderGroup(e.planes,`Planes`)]})}},Get=class extends JX{constructor(){super(...arguments),this.state={isBusy:!1,action:void 0},this.measureDistance=()=>{let e=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDistance(e[0].loci,e[1].loci)},this.measureAngle=()=>{let e=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addAngle(e[0].loci,e[1].loci,e[2].loci)},this.measureDihedral=()=>{let e=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDihedral(e[0].loci,e[1].loci,e[2].loci,e[3].loci)},this.addLabel=()=>{let e=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addLabel(e[0].loci)},this.addOrientation=()=>{let e=[];this.plugin.managers.structure.selection.entries.forEach(t=>{e.push(t.selection)}),this.plugin.managers.structure.measurement.addOrientation(e)},this.addPlane=()=>{let e=[];this.plugin.managers.structure.selection.entries.forEach(t=>{e.push(t.selection)}),this.plugin.managers.structure.measurement.addPlane(e)},this.selectAction=e=>{this.toggleAdd(),e&&(e?.value)()},this.toggleAdd=()=>this.setState({action:this.state.action===`add`?void 0:`add`}),this.toggleOptions=()=>this.setState({action:this.state.action===`options`?void 0:`options`})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(e,t){this.state.action!==t.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if(this.state.action!==`add`){this.clearOrderLabels();return}let e=[],t=this.selection.additionsHistory;for(let n=0;n<t.length&&n<4;n++)e.push(t[n].loci);this.plugin.managers.structure.measurement.addOrderLabels(e)}get selection(){return this.plugin.managers.structure.selection}get actions(){let e=this.selection.additionsHistory;return[{kind:`item`,label:`Label ${e.length===0?` (1 selection item required)`:` (1st selection item)`}`,value:this.addLabel,disabled:e.length===0},{kind:`item`,label:`Distance ${e.length<2?` (2 selection items required)`:` (top 2 selection items)`}`,value:this.measureDistance,disabled:e.length<2},{kind:`item`,label:`Angle ${e.length<3?` (3 selection items required)`:` (top 3 items)`}`,value:this.measureAngle,disabled:e.length<3},{kind:`item`,label:`Dihedral ${e.length<4?` (4 selection items required)`:` (top 4 selection items)`}`,value:this.measureDihedral,disabled:e.length<4},{kind:`item`,label:`Orientation ${e.length===0?` (selection required)`:` (current selection)`}`,value:this.addOrientation,disabled:e.length===0},{kind:`item`,label:`Plane ${e.length===0?` (selection required)`:` (current selection)`}`,value:this.addPlane,disabled:e.length===0}]}highlight(e){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e},!1)}moveHistory(e,t){this.plugin.managers.structure.selection.modifyHistory(e,t,4)}focusLoci(e){this.plugin.managers.camera.focusLoci(e)}historyEntry(e,t){let n=this.plugin.managers.structure.selection.additionsHistory;return(0,I.jsxs)(`div`,{className:`msp-flex-row`,onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,I.jsxs)(VX,{noOverflow:!0,title:`Click to focus. Hover to highlight.`,onClick:()=>this.focusLoci(e.loci),style:{width:`auto`,textAlign:`left`},children:[t,`. `,(0,I.jsx)(`span`,{dangerouslySetInnerHTML:{__html:e.label}})]}),n.length>1&&(0,I.jsx)(HX,{svg:lX,small:!0,className:`msp-form-control`,onClick:()=>this.moveHistory(e,`up`),flex:`20px`,title:`Move up`}),n.length>1&&(0,I.jsx)(HX,{svg:oX,small:!0,className:`msp-form-control`,onClick:()=>this.moveHistory(e,`down`),flex:`20px`,title:`Move down`}),(0,I.jsx)(HX,{svg:vX,small:!0,className:`msp-form-control`,onClick:()=>this.plugin.managers.structure.selection.modifyHistory(e,`remove`),flex:!0,title:`Remove`})]},e.id)}add(){let e=this.plugin.managers.structure.selection.additionsHistory,t=[];for(let n=0,r=Math.min(e.length,4);n<r;n++)t.push(this.historyEntry(e[n],n+1));let n=this.plugin.config.get(WQ.Viewport.ShowSelectionMode)?(0,I.jsxs)(I.Fragment,{children:[` `,`(toggle `,(0,I.jsx)(M4,{inline:!0}),` mode)`]}):null;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Y2,{items:this.actions,onSelect:this.selectAction}),t.length>0&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:t}),t.length===0&&(0,I.jsx)(`div`,{className:`msp-control-offset msp-help-text`,children:(0,I.jsxs)(`div`,{className:`msp-help-description`,children:[(0,I.jsx)(XY,{svg:xX,inline:!0}),`Add one or more selections`,n]})})]})}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(UX,{icon:aX,label:`Add`,toggle:this.toggleAdd,isSelected:this.state.action===`add`,disabled:this.state.isBusy,className:`msp-btn-apply-simple`}),(0,I.jsx)(UX,{icon:MX,label:``,title:`Options`,toggle:this.toggleOptions,isSelected:this.state.action===`options`,disabled:this.state.isBusy,style:{flex:`0 0 40px`,padding:0}})]}),this.state.action===`add`&&this.add(),this.state.action===`options`&&(0,I.jsx)(Ket,{})]})}},Ket=class extends JX{constructor(){super(...arguments),this.state={isDisabled:!1},this.changed=e=>{this.plugin.managers.structure.measurement.setOptions(e)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isDisabled:e})})}render(){let e=this.plugin.managers.structure.measurement.state;return(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(a4,{params:UY,values:e.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}},qet=class extends JX{constructor(){super(...arguments),this.state={showUpdate:!1},this.delete=()=>{jx.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})},this.toggleVisibility=e=>{e.preventDefault(),jx.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),e.currentTarget.blur()},this.highlight=()=>{if(!this.selections)return;this.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let e of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:e},!1);let e=this.props.cell.obj?.data.repr.getAllLoci();if(e)for(let t of e)this.plugin.managers.interactivity.lociHighlights.highlight({loci:t},!1)},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()},this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate}),this.focus=()=>{if(!this.selections)return;let e=yq.getBundleBoundingSphere({loci:this.lociArray});e&&this.plugin.managers.camera.focusSphere(e)},this.selectAction=e=>{e&&(this.setState({showUpdate:!1}),(e?.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{this.forceUpdate()})}get selections(){return this.props.cell.obj?.data.sourceData}get lociArray(){let e=this.selections;return e?e.infos?[e.infos[0].loci]:e.pairs?e.pairs[0].loci:e.triples?e.triples[0].loci:e.quads?e.quads[0].loci:e.locis?e.locis:[]:[]}get label(){let e=this.selections;return e?e.infos?kJ(e.infos[0].loci,{condensed:!0}):e.pairs?RJ(e.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):e.triples?zJ(e.triples[0],{condensed:!0}):e.quads?BJ(e.quads[0],{condensed:!0}):e.locis?NJ(e.locis,{countsOnly:!0}):`<empty>`:`<empty>`}get actions(){return this.props.cell.sourceRef,[Y2.Item(`Select This`,()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:nX})]}render(){let{cell:e}=this.props,{obj:t}=e;return t?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,I.jsx)(`button`,{className:`msp-form-control msp-control-button-label msp-no-overflow`,title:`Click to focus. Hover to highlight.`,onClick:this.focus,style:{width:`auto`,textAlign:`left`},children:(0,I.jsx)(`span`,{dangerouslySetInnerHTML:{__html:this.label}})}),(0,I.jsx)(HX,{svg:e.state.isHidden?NX:PX,toggleState:!1,small:!0,className:`msp-form-control`,onClick:this.toggleVisibility,flex:!0,title:e.state.isHidden?`Show`:`Hide`}),(0,I.jsx)(HX,{svg:vX,small:!0,className:`msp-form-control`,onClick:this.delete,flex:!0,title:`Delete`,toggleState:!1}),(0,I.jsx)(HX,{svg:CX,className:`msp-form-control`,onClick:this.toggleUpdate,flex:!0,title:`Actions`,toggleState:this.state.showUpdate})]},t.id),this.state.showUpdate&&e.parent&&(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(`div`,{className:`msp-accent-offset`,children:[(0,I.jsx)(Y2,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,I.jsx)(WX,{header:`Options`,noOffset:!0,children:(0,I.jsx)(T4,{state:e.parent,transform:e.transform,customHeader:`none`,autoHideApply:!0})})]})})]}):null}};function F4(e,t,n,r){let i=Vk.indexOf(t.unit.elements,t.element),a=$(t.structure,[{unit:t.unit,indices:K.ofSingleton(i)}]),o=r===`residue`?$.extendToWholeResidues(a):$.extendToWholeChains(a),s=Pz.entity.pdbx_description(t).join(`, `);for(let t of n.units){let i=$(o.structure,[{unit:t,indices:o.elements[0].indices}]),a=kJ(i,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:r});a||=kJ(i,{hidePrefix:!1,htmlStyling:!1}),n.units.length>1&&(a+=` | ${i.elements[0].unit.conformation.operator.name}`);let c={label:a,category:s,loci:i};e.has(s)?e.get(s).push(c):e.set(s,[c])}}function Jet(e){let t=new Map,n=iL.create(e);for(let r of e.unitSymmetryGroups){if(!Q.isAtomic(r.units[0]))continue;n.unit=r.units[0],n.element=r.elements[0];let e=Q.Traits.is(n.unit.traits,Q.Trait.MultiChain),i=Pz.entity.type(n),a=i===`non-polymer`,o=i===`branched`;if(Pz.entity.prd_id(n))F4(t,n,r,`chain`);else if(a&&!e)F4(t,n,r,`residue`);else if(o||a&&e){let e=n.unit,{index:i}=e.model.atomicHierarchy.residueAtomSegments,a=-1;for(let o=0,s=e.elements.length;o<s;++o){let s=e.elements[o],c=i[s];c!==a&&(n.element=s,F4(t,n,r,`residue`),a=c)}}}let r=[];return t.forEach((e,t)=>{e.length===1?r.push({label:`${t}: ${e[0].label}`,loci:e[0].loci}):e.length<2e3&&r.push(...e)}),r}var Yet=class extends qX{constructor(){super(...arguments),this.state={isBusy:!1,showAction:!1},this.getSelectionItems=gA(e=>{let t=[];for(let n of e){let e=n.cell.obj?.data;if(e){let n=Jet(e);n.length>0&&t.push([Y2.Header(e.label,{description:e.label}),...Y2.createItems(n,{label:e=>e.label,category:e=>e.category,description:e=>e.label})])}}return t}),this.selectAction=(e,t)=>{if(!e||!this.state.showAction){this.setState({showAction:!1});return}let n=e.value;t?.shiftKey?this.plugin.managers.structure.focus.addFromLoci(n.loci):this.plugin.managers.structure.focus.set(n),this.focusCamera()},this.toggleAction=()=>this.setState({showAction:!this.state.showAction}),this.focusCamera=()=>{let{current:e}=this.plugin.managers.structure.focus;e&&this.plugin.managers.camera.focusLoci(e.loci)},this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()},this.highlightCurrent=()=>{let{current:e}=this.plugin.managers.structure.focus;e&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e.loci},!1)},this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,e=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,e=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,showAction:!1})})}get isDisabled(){return this.state.isBusy||this.plugin.managers.structure.hierarchy.selection.structures.length===0}get actionItems(){let e=[],{history:t}=this.plugin.managers.structure.focus;t.length>0&&e.push([Y2.Header(`History`,{description:`Previously focused on items.`}),...Y2.createItems(t,{label:e=>e.label,description:e=>e.category&&e.label!==e.category?`${e.category} | ${e.label}`:e.label})]);let n=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(n.length===1){let e=n[0][0];e.initiallyExpanded=!0}let r=[];return n.length>0&&r.push(...n),e.length>0&&r.push(...e),r}getToggleBindingLabel(){let e=this.plugin.state.behaviors.transforms.get(i2.id);if(!e)return``;let t=e.params?.bindings.clickFocus;return!t||t0.isEmpty(t)?``:t0.formatTriggers(t)}render(){let{current:e}=this.plugin.managers.structure.focus,t=e?.label||`Nothing Focused`,n=`Click to Center Camera`;if(!e){n=`Select focus using the menu`;let e=this.getToggleBindingLabel();e&&(n+=`\nor use '${e}' on element`)}return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{noOverflow:!0,onClick:this.focusCamera,title:n,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!e,style:{textAlignLast:e?`left`:void 0},children:t}),e&&(0,I.jsx)(HX,{svg:pX,onClick:this.clear,title:`Clear`,className:`msp-form-control`,flex:!0,disabled:this.isDisabled}),(0,I.jsx)(UX,{icon:LWe,title:`Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.`,toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:`0 0 40px`,padding:0}})]}),this.state.showAction&&(0,I.jsx)(Y2,{items:this.actionItems,onSelect:this.selectAction})]})}},Xet=class extends YX{constructor(){super(...arguments),this.item=e=>{let t=this.plugin.managers.structure.hierarchy.seletionSet,n;switch(e.kind){case`model`:{let t=e.cell.obj?.data;t&&DB.TrajectoryInfo.get(t).size>1&&(n=`${e.cell.obj?.data.entryId} | Model ${DB.TrajectoryInfo.get(t).index+1} of ${DB.TrajectoryInfo.get(t).size}`),n=`${e.cell.obj?.data.entryId} | ${e.cell.obj?.label}`;break}case`structure`:{let t=e.cell.obj?.data.models[0];if(t&&DB.TrajectoryInfo.get(t).size>1){n=`${t.entryId} | ${e.cell.obj?.label} (Model ${DB.TrajectoryInfo.get(t).index+1} of ${DB.TrajectoryInfo.get(t).size})`;break}else if(t){n=`${t.entryId} | ${e.cell.obj?.label}`;break}else{n=`${e.cell.obj?.label}`;break}}default:n=e.cell.obj?.label;break}return{kind:`item`,label:n||e.kind,selected:t.has(e.cell.transform.ref),value:[e]}},this.getTrajectoryItems=e=>e.models.length===0?this.item(e):[Y2.Header(e.cell.obj?.label),...e.models.map(this.getModelItems)],this.getModelItems=e=>{if(e.structures.length===0)return this.item(e);if(e.structures.length===1){let t=this.plugin.managers.structure.hierarchy.seletionSet,n=e.structures[0];return{label:`${e.cell.obj?.label} | ${n.cell.obj?.label}`,selected:t.has(n.cell.transform.ref),value:[e,n]}}return[Y2.Header(e.cell.obj?.label),...e.structures.map(this.item)]},this.selectHierarchy=e=>{if(!e||e.length===0)return;let t=[];for(let n of e)for(let e of n.value)t.push(e);this.plugin.managers.structure.hierarchy.updateCurrent(t,e[0].selected?`remove`:`add`)},this.toggleHierarchy=()=>this.setState({show:this.state.show===`hierarchy`?void 0:`hierarchy`}),this.togglePreset=()=>this.setState({show:this.state.show===`presets`?void 0:`presets`}),this.applyPreset=e=>{if(this.setState({show:void 0}),!e)return;let t=this.plugin.managers.structure,{trajectories:n}=t.hierarchy.selection;t.hierarchy.applyPreset(n,e.value)},this.updateModelQueueParams=void 0,this.isUpdatingModel=!1,this.updateStructureModel=e=>{this.updateModelQueueParams=e,this._updateStructureModel()},this.updateStructure=e=>{let{selection:t}=this.plugin.managers.structure.hierarchy,n=t.structures[0];return this.plugin.managers.structure.hierarchy.updateStructure(n,e)}}defaultState(){return{header:`Structure`,isCollapsed:!1,isBusy:!1,brand:{accent:`purple`,svg:rWe}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get hierarchyItems(){let{current:e}=this.plugin.managers.structure.hierarchy,t=[];return e.trajectories.length>1&&t.push([Y2.Header(`Trajectories`),...e.trajectories.map(this.item)]),(e.models.length>1||e.trajectories.length>1)&&t.push([Y2.Header(`Models`),...e.models.map(this.item)]),e.trajectories.length===1&&e.models.length===1?t.push(...e.structures.map(this.item)):e.structures.length>0&&t.push([Y2.Header(`Structures`),...e.structures.map(this.item)]),t}get isEmpty(){let{structures:e,models:t,trajectories:n}=this.plugin.managers.structure.hierarchy.current;return n.length===0&&t.length===0&&e.length===0}get label(){let{structures:e,models:t,trajectories:n}=this.plugin.managers.structure.hierarchy.selection;if(e.length===1){let t=e[0];return t.model?.trajectory?.models&&t.model.trajectory.models.length===1?t.cell.obj?.data.label:t.model?`${t.model.cell.obj?.label} | ${t.cell.obj?.data.label}`:t.cell.obj?.data.label}if(e.length>1){let t=e[0]?.model?.trajectory,n=!0;for(let r of e)if(r?.model?.trajectory!==t){n=!1;break}return n&&t?`${t.cell.obj?.label} | ${e.length} structures`:`${e.length} structures`}if(t.length>0){let e=t[0].trajectory;if(t.length===1){let n=t[0].cell.obj?.data;return n&&DB.TrajectoryInfo.get(n).size>1?`${e?.cell.obj?.label} | Model ${DB.TrajectoryInfo.get(n).index+1} of ${DB.TrajectoryInfo.get(n).size}`:`${e?.cell.obj?.label} | Model`}let n=!0;for(let r of t)if(r.trajectory!==e){n=!1;break}return n?`${e?.cell.obj?.label} | ${t.length} models`:`${t.length} models`}return n.length>0?n.length===1?`${n[0].cell.obj?.label} trajectory`:`${n.length} trajectories`:n.length===0&&t.length===0&&e.length===0?`Nothing Loaded`:`Nothing Selected`}get presetActions(){let e=[],{trajectories:t}=this.plugin.managers.structure.hierarchy.selection;if(t.length===0)return e;let n=this.plugin.builders.structure.hierarchy.getPresets(t[0].cell.obj);if(t.length>1){let e=new Set(n);for(let n=1;n<t.length;n++){let r=this.plugin.builders.structure.hierarchy.getPresets(t[n].cell.obj),i=new Set(r);for(let t of r)i.has(t)||e.delete(t)}n=n.filter(t=>e.has(t))}for(let t of n)e.push(Y2.Item(t.display.name,t,{description:t.display.description}));return e}async _updateStructureModel(){if(!this.updateModelQueueParams||this.isUpdatingModel)return;let e=this.updateModelQueueParams;this.updateModelQueueParams=void 0;try{this.isUpdatingModel=!0;let{selection:t}=this.plugin.managers.structure.hierarchy,n=t.structures[0].model;await this.plugin.state.updateTransform(this.plugin.state.data,n.cell.transform.ref,e,`Model Index`)}finally{this.isUpdatingModel=!1,this._updateStructureModel()}}get modelIndex(){let{selection:e}=this.plugin.managers.structure.hierarchy;if(e.structures.length!==1)return null;let t=e.structures[0].model;if(!t||t.cell.transform.transformer!==IY.Model.ModelFromTrajectory||!t.cell.obj||DB.TrajectoryInfo.get(t.cell.obj.data).size<=1)return null;let n=t.cell.params?.definition;return n?(0,I.jsx)(a4,{params:n,values:t.cell.params?.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){let{selection:e}=this.plugin.managers.structure.hierarchy;if(e.structures.length!==1)return null;let t=e.structures[0];return!t.cell.params?.definition||!t.cell.parent?null:(0,I.jsx)(T4,{state:t.cell.parent,transform:t.cell.transform,customHeader:`none`,customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0})}get transform(){let{selection:e}=this.plugin.managers.structure.hierarchy;if(e.structures.length!==1)return null;let t=e.structures[0];if(!t.cell.parent)return null;let n=FE.tryFindDecorator(this.plugin.state.data,t.cell.transform.ref,IY.Model.TransformStructureConformation);if(n)return(0,I.jsx)(WX,{header:`Conformation Transform`,children:(0,I.jsx)(T4,{state:n.parent,transform:n.transform,customHeader:`none`,noMargin:!0,autoHideApply:!0})})}renderControls(){let e=this.state.isBusy||this.isEmpty,t=this.presetActions,n=this.label;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,style:{marginTop:`1px`},children:[(0,I.jsx)(VX,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:e,title:n,children:n}),t.length>0&&(0,I.jsx)(HX,{svg:dX,className:`msp-form-control`,flex:`40px`,onClick:this.togglePreset,title:`Apply a structure presets to the current hierarchy.`,toggleState:this.state.show===`presets`,disabled:e})]}),this.state.show===`hierarchy`&&(0,I.jsx)(Y2,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),this.state.show===`presets`&&(0,I.jsx)(Y2,{items:t,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,I.jsxs)(`div`,{style:{marginTop:`6px`},children:[(0,I.jsx)(Yet,{}),(0,I.jsx)(Ret,{hideOnEmpty:!0})]})]})}};function I4(e,t,n={}){let r=n;return typeof r.type==`string`||typeof r.color==`string`||typeof r.size==`string`?Zet(e,t||zP.One,n):Qet(e,t||zP.One,n)}function Zet(e,t,n){let r=n.type&&e.representation.volume.registry.get(n.type)||e.representation.volume.registry.default.provider,i=n.color&&e.representation.volume.themes.colorThemeRegistry.get(n.color)||e.representation.volume.themes.colorThemeRegistry.get(r.defaultColorTheme.name),a=n.size&&e.representation.volume.themes.sizeThemeRegistry.get(n.size)||e.representation.volume.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name);return Qet(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:a,sizeParams:n.sizeParams})}function Qet(e,t,n={}){let{themes:r}=e.representation.volume,i={volume:t},a=n.type||e.representation.volume.registry.default.provider,o=V.getDefaultValues(a.getParams(r,t)),s=Object.assign(o,n.typeParams),c=n.color||r.colorThemeRegistry.get(a.defaultColorTheme.name),l=V.getDefaultValues(c.getParams(i));c.name===a.defaultColorTheme.name&&Object.assign(l,a.defaultColorTheme.props);let u=Object.assign(l,n.colorParams),d=n.size||r.sizeThemeRegistry.get(a.defaultSizeTheme.name),f=V.getDefaultValues(d.getParams(i));d.name===a.defaultSizeTheme.name&&Object.assign(f,a.defaultSizeTheme.props);let p=Object.assign(f,n.sizeParams);return{type:{name:a.name,params:s},colorTheme:{name:c.name,params:u},sizeTheme:{name:d.name,params:p}}}function $et(e,t){let n=rtt(e,t||L4());return dtt(e.tree,n),t&&t.refs.forEach(ctt,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}function L4(){return{volumes:[],lazyVolumes:[],refs:new Map}}function ett(e){return{kind:`volume`,cell:e,version:e.transform.version,representations:[]}}function ttt(e){return{kind:`lazy-volume`,cell:e,version:e.transform.version}}function ntt(e,t){return{kind:`volume-representation`,cell:e,version:e.transform.version,volume:t}}function rtt(e,t){return{state:e,oldHierarchy:t,hierarchy:L4(),changed:!1,added:new Set}}function R4(e,t,n,r,...i){let a=r(...i);n.push(a),e.hierarchy.refs.set(t.transform.ref,a);let o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(a.cell.transform.ref),e.changed=!0),a}function itt(e,t){return(n,r)=>!t(r)&&e.is(n.obj)}function att(){}var ott=[[itt(H.Volume.Data,e=>e.currentVolume),(e,t)=>{e.currentVolume=R4(e,t,e.hierarchy.volumes,ett,t)},e=>e.currentVolume=void 0],[e=>H.Volume.Lazy.is(e.obj),(e,t)=>{R4(e,t,e.hierarchy.lazyVolumes,ttt,t)},att],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&H.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&R4(e,t,e.currentVolume.representations,ntt,t,e.currentVolume),!1),att]];function stt(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Mx.Null||e.status!==`ok`&&e.status!==`error`)}function ctt(e){let{cell:t}=e;stt(t)||(this.changed=!0)}function ltt(e){utt(this,this.tree.transforms.get(e))}function utt(e,t){let{state:n}=e,r=n.state.cells.get(t.ref);if(!stt(r))return;let i,a=!1;for(let[e,t,o]of ott)if(e(r,n)){if(t(n,r)===!1){a=!0;break}i=o;break}if(a)return;let o=e.tree.children.get(t.ref);o&&o.size&&o.forEach(ltt,e),i&&i(n)}function dtt(e,t){let n={tree:e,state:t};return utt(n,e.root),n.state}var z4=class extends zY{get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(e){if(!e&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){e&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let t=$et(this.plugin.state.data,this.current);if(!t.changed)return;let{hierarchy:n}=t;this.state.hierarchy=n,this.state.selection?this.state.selection=n.refs.has(this.state.selection.cell.transform.ref)?n.refs.get(this.state.selection.cell.transform.ref):n.volumes[0]:this.state.selection=n.volumes[0],e?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,volume:this.state.selection})):this.state.notified=!1}setCurrent(e){this.state.selection=e||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:e||this.state.hierarchy.volumes[0]})}remove(e,t){if(e.length===0)return;let n=this.plugin.state.data.build();for(let t of e)n.delete(typeof t==`string`?t:t.cell.transform.ref);return n.commit({canUndo:t?`Remove`:!1})}toggleVisibility(e,t){if(e.length===0)return;let n=t===void 0?!e[0].cell.state.isHidden:t!==`show`;for(let t of e)$0(this.dataState,t.cell.transform.ref,n)}addRepresentation(e,t){return this.dataState.build().to(e.cell).apply(IY.Representation.VolumeRepresentation3D,I4(this.plugin,e.cell.obj?.data,{type:t})).commit({canUndo:`Add Representation`})}constructor(e){super(),this.plugin=e,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:L4(),selection:void 0},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})},this.subscribe(e.state.data.events.changed,t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(e.behaviors.state.isAnimating,t=>{!t&&!e.behaviors.state.isUpdating.value&&this.sync(!0)})}};(function(e){function t(e,t){return t?.cell.obj?.data?e.representation.volume.registry.getApplicableTypes(t.cell.obj?.data):e.representation.volume.registry.types}e.getRepresentationTypes=t})(z4||={});var B4=class extends H.Create({name:`Volume Streaming`,typeClass:`Object`}){},ftt;(function(e){(function(e){e.Float32=`float32`,e.Int8=`int8`})(e.ValueType||={})})(ftt||={});function ptt(e,t=`x-ray`){if(!e)return t;let n=e.models[0];return CB.is(n.sourceData)?DB.hasEmMap(n)?`em`:DB.hasXrayMap(n)?`x-ray`:DB.isFromEm(n)?`em`:DB.isFromXray(n)?`x-ray`:t:t}function mtt(e){let t=[];if(!CB.is(e.sourceData))return[e.entryId];let{db_id:n,db_name:r,content_type:i}=e.sourceData.data.db.pdbx_database_related;if(!r.isDefined)return[e.entryId];for(let e=0,a=r.rowCount;e<a;++e)r.value(e).toUpperCase()===`EMDB`&&i.value(e)===`associated EM volume`&&t.push(n.value(e));return t}function htt(e){return[e.entryId]}function gtt(e,t){if(!t||!t.models.length)return[];let n=t.models[0];switch(e){case`em`:return mtt(n);case`x-ray`:return htt(n)}}async function _tt(e,t,n,r){switch(e){case`emdb`:return vtt(t,n,r);case`pdbe`:return ytt(t,n,r)}}async function vtt(e,t,n){let r=e.config.get(WQ.VolumeStreaming.EmdbHeaderServer),i=(await e.fetch({url:`${r}/${n.toUpperCase()}/header/${n.toLowerCase()}.xml`,type:`xml`}).runInContext(t)).getElementsByTagName(`map`)[0].getElementsByTagName(`contour`),a=i[0];for(let e=1;e<i.length;e++)if(i[e].getAttribute(`primary`)===`true`){a=i[e];break}return parseFloat(a.getElementsByTagName(`level`)[0].textContent)}async function ytt(e,t,n){n=n.toUpperCase();let r=(await e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${n}`,type:`json`}).runInContext(t))?.map?.contour_list?.contour;return!r||r.length===0?btt(e,t,n):r.find(e=>e.primary)?.level??r[0].level}async function btt(e,t,n){n=n.toUpperCase();let r=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${n}`,type:`json`}).runInContext(t))?.[n],i;return r?.[0]?.map?.contour_level?.value!==void 0&&(i=+r[0].map.contour_level.value),i}async function xtt(e,t,n){let r=(await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${n}`,type:`json`}).runInContext(t))?.[n],i=[];if(r?.[0]?.related_structures){let e=r[0].related_structures.filter(e=>e.resource===`EMDB`&&e.relationship===`associated EM volume`);if(!e.length)throw Error(`No related EMDB entry found for '${n}'.`);i.push(...e.map(e=>e.accession))}else throw Error(`No related EMDB entry found for '${n}'.`);return i}function V4(e,t,n){return{i:e,j:t,k:n}}function H4(e,t){return{a:e,b:t}}const U4=[V4(0,0,0),V4(1,0,0),V4(1,1,0),V4(0,1,0),V4(0,0,1),V4(1,0,1),V4(1,1,1),V4(0,1,1)],Stt=[H4(U4[0],U4[1]),H4(U4[1],U4[2]),H4(U4[2],U4[3]),H4(U4[3],U4[0]),H4(U4[4],U4[5]),H4(U4[5],U4[6]),H4(U4[6],U4[7]),H4(U4[7],U4[4]),H4(U4[0],U4[4]),H4(U4[1],U4[5]),H4(U4[2],U4[6]),H4(U4[3],U4[7])],Ctt=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],wtt=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],W4=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],G4=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function Ttt(e,t){let n=Math.min(65536,e*4),r=_O.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=_O.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),a=_O.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),o=_O.create(Uint32Array,3,n,t&&t.indexBuffer.ref.value),s=0,c=0;return{addVertex:(e,t,n)=>(++s,_O.add3(r,e,t,n)),addNormal:(e,t,n)=>{_O.add3(i,e,t,n)},addGroup:e=>{_O.add(a,e)},addTriangle:(e,t,n,r)=>{let i=e[t],a=e[n],s=e[r];i>=0&&a>=0&&s>=0&&(++c,_O.add3(o,i,a,s))},get:()=>{let e=_O.compact(r,!0),n=_O.compact(i,!0),l=_O.compact(o,!0),u=_O.compact(a,!0);return HM.create(e,l,n,u,s,c,t)}}}function Ett(e,t){let n=_O.create(Float32Array,3,e),r=_O.create(Float32Array,1,e),i=_O.create(Float32Array,2,e),a=0;return{addVertex:(e,t,r)=>_O.add3(n,e,t,r),addNormal:()=>xx,addGroup:e=>{_O.add(r,e)},addTriangle:(e,t,n,r,o)=>{let s=e[t],c=e[n],l=e[r];s>=0&&c>=0&&l>=0&&(G4[t][n]&o&&(++a,_O.add2(i,e[t],e[n])),G4[n][r]&o&&(++a,_O.add2(i,e[n],e[r])),G4[t][r]&o&&(++a,_O.add2(i,e[t],e[r])))},get:()=>{let e=_O.compact(n,!0),o=_O.compact(i,!0),s=_O.compact(r,!0),c=_P.create(a,a/10,t);for(let t=0;t<a;++t){let n=o[t*2],r=o[t*2+1];c.add(e[n*3],e[n*3+1],e[n*3+2],e[r*3],e[r*3+1],e[r*3+2],s[n])}return c.getLines()}}}function Dtt(e){return{...e,bottomLeft:Ox(e.bottomLeft,[0,0,0]),topRight:Ox(e.topRight,e.scalarField.space.dimensions)}}function Ott(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function K4(e,t){return hb.create(`Marching Cubes Mesh`,async n=>{let r=Dtt(e),{dX:i,dY:a,dZ:o}=Ott(r),s=Ttt(Math.min(262144,Math.max(i*a*o/32,1024)),t);return await new ktt(n,s,r).run(),s.get()})}function q4(e,t){return hb.create(`Marching Cubes Lines`,async n=>{let r=Dtt(e),{dX:i,dY:a,dZ:o}=Ott(r),s=Ett(Math.min(262144,Math.max(i*a*o/32,1024)),t);return await new ktt(n,s,r).run(),s.get()})}var ktt=class{async doSlices(){let e=0;this.edgeFilter=15;for(let t=this.minZ;t<this.maxZ;t++,this.edgeFilter&=-5)this.slice(t),e+=this.sliceSize,this.ctx.shouldUpdate&&await this.ctx.update({message:`Computing surface...`,current:e,max:this.size})}slice(e){this.edgeFilter|=2;for(let t=this.minY;t<this.maxY;t++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,t,e,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(e)}async run(){await this.doSlices()}constructor(e,t,n){this.ctx=e,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new Att(t,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}},Att=class{get3dOffsetFromEdgeInfo(e){return this.nX*((this.k+e.k)%2*this.nY+this.j+e.j)+this.i+e.i}clearEdgeVertexIndexSlice(e){let t=e%2==0?0:3*this.nX*this.nY,n=e%2==0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,t,n)}interpolate(e){let t=Ctt[e],n=3*this.get3dOffsetFromEdgeInfo(t)+t.e,r=this.verticesOnEdges[n];if(r>0)return r-1;let i=this.scalarField,a=this.scalarFieldGet,o=Stt[e],s=o.a,c=o.b,l=s.i+this.i,u=s.j+this.j,d=s.k+this.k,f=c.i+this.i,p=c.j+this.j,m=c.k+this.k,h=a(i,l,u,d),g=a(i,f,p,m),_=(this.isoLevel-h)/(h-g);if(this.idField){let e=this.idFieldGet(this.idField,l,u,d),t=this.idFieldGet(this.idField,f,p,m),n=_<.5?e:t;if(n===-1&&(n=_<.5?t:e),n===-2)return-1;this.builder.addGroup(n)}else this.builder.addGroup(0);let v=this.builder.addVertex(l+_*(l-f),u+_*(u-p),d+_*(d-m));this.verticesOnEdges[n]=v+1;let y=a(i,Math.max(0,l-1),u,d)-a(i,Math.min(this.nX-1,l+1),u,d),b=a(i,l,Math.max(0,u-1),d)-a(i,l,Math.min(this.nY-1,u+1),d),x=a(i,l,u,Math.max(0,d-1))-a(i,l,u,Math.min(this.nZ-1,d+1)),S=a(i,Math.max(0,f-1),p,m)-a(i,Math.min(this.nX-1,f+1),p,m),C=a(i,f,Math.max(0,p-1),m)-a(i,f,Math.min(this.nY-1,p+1),m),w=a(i,f,p,Math.max(0,m-1))-a(i,f,p,Math.min(this.nZ-1,m+1)),T=y+_*(y-S),E=b+_*(b-C),D=x+_*(x-w);return this.isoLevel>=0?this.builder.addNormal(T,E,D):this.builder.addNormal(-T,-E,-D),v}constructor(e,t){this.builder=e,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;let n=t.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=t.isoLevel,this.scalarFieldGet=t.scalarField.space.get,this.scalarField=t.scalarField.data,t.idField&&(this.idField=t.idField.data,this.idFieldGet=t.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get(e,t,n){return this.scalarFieldGet(this.scalarField,e,t,n)}processCell(e,t,n,r){let i=0;if(this.get(e,t,n)<this.isoLevel&&(i|=1),this.get(e+1,t,n)<this.isoLevel&&(i|=2),this.get(e+1,t+1,n)<this.isoLevel&&(i|=4),this.get(e,t+1,n)<this.isoLevel&&(i|=8),this.get(e,t,n+1)<this.isoLevel&&(i|=16),this.get(e+1,t,n+1)<this.isoLevel&&(i|=32),this.get(e+1,t+1,n+1)<this.isoLevel&&(i|=64),this.get(e,t+1,n+1)<this.isoLevel&&(i|=128),i===0||i===255)return;this.i=e,this.j=t,this.k=n;let a=wtt[i];(a&1)>0&&(this.vertList[0]=this.interpolate(0)),(a&2)>0&&(this.vertList[1]=this.interpolate(1)),(a&4)>0&&(this.vertList[2]=this.interpolate(2)),(a&8)>0&&(this.vertList[3]=this.interpolate(3)),(a&16)>0&&(this.vertList[4]=this.interpolate(4)),(a&32)>0&&(this.vertList[5]=this.interpolate(5)),(a&64)>0&&(this.vertList[6]=this.interpolate(6)),(a&128)>0&&(this.vertList[7]=this.interpolate(7)),(a&256)>0&&(this.vertList[8]=this.interpolate(8)),(a&512)>0&&(this.vertList[9]=this.interpolate(9)),(a&1024)>0&&(this.vertList[10]=this.interpolate(10)),(a&2048)>0&&(this.vertList[11]=this.interpolate(11));let o=W4[i];for(let e=0;e<o.length;e+=3){let t=o[e],n=o[e+1],i=o[e+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,t,n,i,r):this.builder.addTriangle(this.vertList,i,n,t,r)}}};function jtt(e,t,n,r,i){let a=e.instances.length,o=new Float32Array(a*16);for(let t=0;t<a;++t)z.toArray(e.instances[t].transform,o,t*16);return lM(o,a,t,n,r,i)}function Mtt(e,t,n,r,i,a){let{createValues:o,createRenderableState:s}=wF.getUtils(t),c=o(t,jtt(e,t.boundingSphere,i.cellSize,i.batchSize),n,r,i),l=s(i);return AF(t.kind,c,l,a)}function J4(e,t){let{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:a,eachLocation:o,setUpdateState:s,mustRecreate:c,dispose:l}=e,{updateValues:u,updateBoundingSphere:d,updateRenderableState:f,createPositionIterator:p}=e.geometryUtils,m=Cq.create(),h,g,_,v,y,b=Object.assign({},n),x=oq.createEmpty(),S,C,w,T=-1,E,D;function O(e,t,n,r){if(!n&&!S)throw Error(`missing volume`);if(g=Object.assign({},b,t),_=e,v=n,y=r,Cq.reset(m),h?NP.areEquivalent(v.grid,S.grid)&&!zP.areInstanceTransformsEqual(v,S)?m.updateTransform=!0:(!zP.areEquivalent(v,S)||y!==C)&&(m.createNew=!0):m.createNew=!0,m.createNew){m.createGeometry=!0;return}s(m,n,g,b,_,x),YK.areEqual(e.color,x.color)||(m.updateColor=!0),aq.areEqual(e.size,x.size)||(m.updateSize=!0),(g.instanceGranularity!==b.instanceGranularity||g.cellSize!==b.cellSize||g.batchSize!==b.batchSize)&&(m.updateTransform=!0),m.updateTransform&&(m.updateMatrix=!0),m.updateSize&&!(`uSize`in h.values)&&(m.createGeometry=!0),m.createGeometry&&(m.updateColor=!0,m.updateSize=!0)}function k(e){if(m.createNew)if(E=i(v,y),e)h=Mtt(v,e,E,_,g,t),D=p(e,h.values);else throw Error(`expected geometry to be given`);else{if(!h)throw Error(`expected renderObject to be available`);if((m.updateColor||m.updateSize||m.updateTransform)&&(E=i(v,y)),m.updateTransform){let{instanceCount:e,groupCount:t}=E;g.instanceGranularity?QA(e,`instance`,h.values):QA(e*t,`groupInstance`,h.values)}if(m.updateMatrix&&jtt(v,w.boundingSphere,g.cellSize,g.batchSize,h.values),m.createGeometry)if(e)L.updateIfChanged(h.values.drawCount,wF.getDrawCount(e)),L.updateIfChanged(h.values.uVertexCount,wF.getVertexCount(e)),L.updateIfChanged(h.values.uGroupCount,E.groupCount);else throw Error(`expected geometry to be given`);(m.updateTransform||m.createGeometry)&&(d(h.values,e||w),D=p(e||w,h.values)),m.updateSize&&`uSize`in h.values&&tP(E,_.size,h.values),m.updateColor&&nM(E,D,_.color,h.values),u(h.values,g),f(h.state,g)}b=g,x=_,S=v,C=y,e&&(w=e,T+=1)}function A(e,t,n,r){let i=!1;if(zP.Cell.isLoci(e)){if(zP.Cell.isLociEmpty(e)||!zP.areEquivalent(e.volume,t))return!1;for(let{instances:t}of e.elements)K.forEach(t,e=>{r(G.ofSingleton(e))&&(i=!0)})}else if(zP.Segment.isLoci(e)){if(zP.Segment.isLociEmpty(e)||!zP.areEquivalent(e.volume,t))return!1;for(let{segments:t,instances:a}of e.elements)K.has(t,n)&&K.forEach(a,e=>{r(G.ofSingleton(e))&&(i=!0)})}else if(zP.Isosurface.isLoci(e)){if(zP.Isosurface.isLociEmpty(e))return!1;if(G.is(e.instances))r(e.instances)&&(i=!0);else for(let t=0,n=e.instances.length;t<n;++t)r(G.ofSingleton(t))&&(i=!0)}else if(zP.isLoci(e)){if(zP.isLociEmpty(e))return!1;if(G.is(e.instances))r(e.instances)&&(i=!0);else for(let t=0,n=e.instances.length;t<n;++t)r(G.ofSingleton(t))&&(i=!0)}return i}function j(e,t){return mq(e)?b.instanceGranularity?t(G.ofBounds(0,E.instanceCount)):t(G.ofBounds(0,E.groupCount*E.instanceCount)):b.instanceGranularity?A(e,S,C,t):o(e,S,C,b,t)}return{get groupCount(){return E?E.count:0},get renderObject(){return h},get geometryVersion(){return T},async createOrUpdate(e,t,n={},i){if(O(t,n,i?.volume||S,i?.key||C),m.createGeometry){let t=r(e,v,y,_,g,w);return Rb(t)?t.then(k):k(t)}else k()},getLoci(e){return h?a(e,S,C,b,h.id):hq},eachLocation(e){for(E.reset();E.hasNext;){let{location:t,isSecondary:n}=E.move();e(t,n)}},mark(e,t){return Zq.mark(h,e,t,j)},setVisibility(e){Zq.setVisibility(h,e)},setAlphaFactor(e){Zq.setAlphaFactor(h,e)},setPickable(e){Zq.setPickable(h,e)},setColorOnly(e){Zq.setColorOnly(h,e)},setTransform(e,t){Zq.setTransform(h,e,t)},setOverpaint(e){return Zq.setOverpaint(h,e,j,!0)},setTransparency(e){return Zq.setTransparency(h,e,j,!0)},setEmissive(e){return Zq.setEmissive(h,e,j,!0)},setSubstance(e){return Zq.setSubstance(h,e,j,!0)},setClipping(e){return Zq.setClipping(h,e,j,!0)},setThemeStrength(e){Zq.setThemeStrength(h,e)},destroy(){l?.(w),h&&=(h.state.disposed=!0,void 0)},mustRecreate:c}}function Y4(e){return e}({...EM.Params});function X4(e,t,n,r,i,a=()=>[-1]){let o=0,{webgl:s}=t,c=new sD,l=new rJ.GeometryState,u=kF(),d=[],f=rJ.createState(),p=new Map,m,h,g,_,v=oq.createEmpty();async function y(e,t){let n=p.get(t);return n?n.mustRecreate?.call(n,{volume:m,key:t},_,s)&&(n.destroy(),n=r(u,m,t,_,s),p.set(t,n)):(n=r(u,m,t,_,s),p.set(t,n)),n.createOrUpdate({webgl:s,runtime:e},v,_,{volume:m,key:t})}function b(e={},r){r&&r!==m&&(g=n(t,r),m=r,_||=V.getDefaultValues(g));let i=Eq(Object.assign({},_,e),m);return Object.assign(_,e,i),h=a(_),hb.create(`Creating or updating VolumeRepresentation`,async e=>{let t=new Set(p.keys());for(let n=0,r=h.length;n<r;++n){let r=h[n];t.delete(r);let i=y(e,r);i&&await i}t.forEach(e=>{var t;(t=p.get(e))==null||t.destroy(),p.delete(e)}),d.length=0,p.forEach(e=>{e.renderObject&&(d.push(e.renderObject),l.add(e.renderObject.id,e.geometryVersion))}),l.snapshot(),c.next(o++)})}function x(e,t){let n=!1;return p.forEach(r=>{n=r.mark(e,t)||n}),n}function S(e,t){t.visible!==void 0&&e&&e.setVisibility(t.visible),t.alphaFactor!==void 0&&e&&e.setAlphaFactor(t.alphaFactor),t.pickable!==void 0&&e&&e.setPickable(t.pickable),t.overpaint!==void 0&&e&&e.setOverpaint(t.overpaint),t.transparency!==void 0&&e&&e.setTransparency(t.transparency),t.emissive!==void 0&&e&&e.setEmissive(t.emissive),t.substance!==void 0&&e&&e.setSubstance(t.substance),t.clipping!==void 0&&e&&e.setClipping(t.clipping),t.transform!==void 0&&e&&e.setTransform(t.transform),t.themeStrength!==void 0&&e&&e.setThemeStrength(t.themeStrength)}function C(e){let{visible:t,alphaFactor:n,pickable:r,overpaint:i,transparency:a,emissive:o,substance:s,clipping:c,transform:l,themeStrength:u,syncManually:d,markerActions:m}=e,h={};t!==void 0&&(h.visible=t),n!==void 0&&(h.alphaFactor=n),r!==void 0&&(h.pickable=r),i!==void 0&&(h.overpaint=i),a!==void 0&&(h.transparency=a),o!==void 0&&(h.emissive=o),s!==void 0&&(h.substance=s),c!==void 0&&(h.clipping=c),u!==void 0&&(h.themeStrength=u),l!==void 0&&!z.areEqual(l,f.transform,1e-6)&&(h.transform=l),d!==void 0&&(h.syncManually=d),m!==void 0&&(h.markerActions=m),p.forEach(e=>S(e,h)),rJ.updateState(f,e)}function w(e){v=e}function T(){p.forEach(e=>e.destroy()),p.clear()}return{label:e,get groupCount(){let e=0;return p.forEach(t=>{t.renderObject&&(e+=t.groupCount)}),e},get props(){return _},get params(){return g},get state(){return f},get theme(){return v},get geometryVersion(){return l.version},renderObjects:d,updated:c,createOrUpdate:b,setState:C,setTheme:w,getLoci:e=>{let t=hq;return p.forEach(n=>{let r=n.getLoci(e);gq(r)||(t=r)}),t},getAllLoci:()=>[i(m,_)],eachLocation:e=>{p.forEach(t=>{t.eachLocation(e)})},mark:x,destroy:T}}var Ntt={..._F,tTexture:GP(`texture`,`rgba`,`float`,`nearest`)},Z4=`histopyramid-sum`;function Ptt(e,t){if(e.namedComputeRenderables[Z4]){let n=e.namedComputeRenderables[Z4].values;L.update(n.tTexture,t),e.namedComputeRenderables[Z4].update()}else e.namedComputeRenderables[Z4]=Ftt(e,t);return e.namedComputeRenderables[Z4]}function Ftt(e,t){let n={...vF,tTexture:L.create(t)},r={...Ntt};return hF(aF(e,`triangles`,fj(`sum`,tF,`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`,{},{0:`ivec4`}),r,n),n)}function Itt(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}var Q4=new Uint8Array(4),Ltt=new Int32Array(4);function Rtt(e,t){$y&&e.timer.mark(`getHistopyramidSum`);let{gl:n,state:r,resources:i}=e,a=Ptt(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[Z4]||(e.namedFramebuffers[Z4]=i.framebuffer());let o=e.namedFramebuffers[Z4];return e.namedTextures[Z4]||(e.namedTextures[Z4]=Bj(n)?i.texture(`image-int32`,`rgba`,`int`,`nearest`):i.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),e.namedTextures[Z4].define(1,1)),e.namedTextures[Z4].attachFramebuffer(o,0),Itt(e),r.viewport(0,0,1,1),a.render(),n.finish(),e.readPixels(0,0,1,1,Bj(n)?Ltt:Q4),n.bindFramebuffer(n.FRAMEBUFFER,null),$y&&e.timer.markEnd(`getHistopyramidSum`),Bj(n)?Ltt[0]:ZN(Q4[0],Q4[1],Q4[2])}var ztt={..._F,tInputLevel:GP(`texture`,`rgba`,`float`,`nearest`),tPreviousLevel:GP(`texture`,`rgba`,`float`,`nearest`),uSize:J(`f`),uTexSize:J(`f`),uFirst:J(`b`)},$4=`histogram-pyramid`;function Btt(e,t,n){if(e.namedComputeRenderables[$4]){let r=e.namedComputeRenderables[$4].values;L.update(r.tInputLevel,t),L.update(r.tPreviousLevel,n),e.namedComputeRenderables[$4].update()}else e.namedComputeRenderables[$4]=Vtt(e,t,n);return e.namedComputeRenderables[$4]}function Vtt(e,t,n){let r={...vF,tInputLevel:L.create(t),tPreviousLevel:L.create(n),uSize:L.create(0),uTexSize:L.create(0),uFirst:L.create(!0)},i={...ztt};return hF(aF(e,`triangles`,fj(`reduction`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`,{},{0:`ivec4`}),i,r),r)}function Htt(e,t){let n=2**t,r=`level${t}`,i=e.isWebGL2?e3(r,e,`image-int32`,`alpha`,`int`,`nearest`):e3(r,e,`image-uint8`,`rgba`,`ubyte`,`nearest`);i.define(n,n);let a=Gtt(r,e);return a||=Wtt(r,e),i.attachFramebuffer(a,0),{texture:i,framebuffer:a}}function Utt(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}function Wtt(e,t){let n=`${$4}-${e}`;return t.namedFramebuffers[n]||(t.namedFramebuffers[n]=t.resources.framebuffer()),t.namedFramebuffers[n]}function e3(e,t,n,r,i,a){let o=`${$4}-${e}`;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(n,r,i,a)),t.namedTextures[o]}function Gtt(e,t){let n=`${$4}-${e}`;return t.namedFramebuffers[n]}function Ktt(e,t,n,r){$y&&e.timer.mark(`createHistogramPyramid`);let{gl:i,state:a}=e,o=t.getWidth();if(o!==t.getHeight()||!LT(o))throw Error(`inputTexture must be of square power-of-two size`);let s=Math.ceil(Math.log(o)/Math.log(2)),c=2**s,l=2**s,u=2**(s-1),d=e.isWebGL2?e3(`pyramid`,e,`image-int32`,`alpha`,`int`,`nearest`):e3(`pyramid`,e,`image-uint8`,`rgba`,`ubyte`,`nearest`);d.define(l,u);let f=Wtt(`pyramid`,e);d.attachFramebuffer(f,0),a.viewport(0,0,l,u),Bj(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT);let p=[];for(let t=0;t<s;++t)p.push(Htt(e,t));let m=Btt(e,t,p[0].texture);a.currentRenderItemId=-1,Utt(e);let h=0;for(let e=0;e<s;e++){let t=s-1-e;p[t].framebuffer.bind();let n=2**t;L.update(m.values.uSize,2**(e+1)/c),L.update(m.values.uTexSize,n),L.updateIfChanged(m.values.uFirst,e===0),e>0&&(L.update(m.values.tPreviousLevel,p[s-e].texture),m.update()),a.currentRenderItemId=-1,a.viewport(0,0,n,n),a.scissor(0,0,n,n),Bj(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),a.scissor(0,0,r[0],r[1]),m.render(),d.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,h,0,0,0,n,n),d.unbind(0),h+=n}i.finish(),$y&&e.timer.markEnd(`createHistogramPyramid`);let g=Math.max(1,Rtt(e,p[0].texture));return{pyramidTex:d,count:g,height:Math.ceil(g/2**s),levels:s,scale:n}}var t3;function qtt(){if(t3!==void 0)return t3;t3=WA(256,1,Uint8Array);let{array:e}=t3;for(let t=0,n=W4.length;t<n;++t)e[t]=W4[t].length/3;return t3}var n3;function Jtt(){if(n3!==void 0)return n3;n3=WA(4096,1,Uint8Array);let{array:e}=n3;for(let t=0,n=W4.length;t<n;++t)for(let n=0;n<16;++n)n<W4[t].length?e[t*16+n]=W4[t][n]:e[t*16+n]=255;return n3}var Ytt={..._F,tTriCount:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),tVolumeData:GP(`texture`,`rgba`,`ubyte`,`nearest`),dValueChannel:qP(`string`,[`red`,`alpha`]),uIsoValue:J(`f`),uGridDim:J(`v3`),uGridTexDim:J(`v3`),uScale:J(`v2`)},r3=`active-voxels`;function Xtt(e,t){return Bj(e.gl)&&t.format===e.gl.RED?`red`:`alpha`}function Ztt(e,t,n,r,i,a){if(e.namedComputeRenderables[r3]){let o=e.namedComputeRenderables[r3].values;L.update(o.uQuadScale,a),L.update(o.tVolumeData,t),L.update(o.dValueChannel,Xtt(e,t)),L.updateIfChanged(o.uIsoValue,i),L.update(o.uGridDim,n),L.update(o.uGridTexDim,r),L.update(o.uScale,a),e.namedComputeRenderables[r3].update()}else e.namedComputeRenderables[r3]=Qtt(e,t,n,r,i,a);return e.namedComputeRenderables[r3]}function Qtt(e,t,n,r,i,a){let o={...vF,tTriCount:L.create(qtt()),uQuadScale:L.create(a),tVolumeData:L.create(t),dValueChannel:L.create(Xtt(e,t)),uIsoValue:L.create(i),uGridDim:L.create(n),uGridTexDim:L.create(r),uScale:L.create(a)},s={...Ytt};return hF(aF(e,`triangles`,fj(`active-voxels`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

float voxelValue(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxelValue(posXYZ), uIsoValue)
        + 2. * step(voxelValue(posXYZ + c1), uIsoValue)
        + 4. * step(voxelValue(posXYZ + c2), uIsoValue)
        + 8. * step(voxelValue(posXYZ + c3), uIsoValue)
        + 16. * step(voxelValue(posXYZ + c4), uIsoValue)
        + 32. * step(voxelValue(posXYZ + c5), uIsoValue)
        + 64. * step(voxelValue(posXYZ + c6), uIsoValue)
        + 128. * step(voxelValue(posXYZ + c7), uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`),s,o),o)}function $tt(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}function ent(e,t,n,r,i,a){$y&&e.timer.mark(`calcActiveVoxels`);let{gl:o,state:s,resources:c}=e,l=t.getWidth(),u=t.getHeight();e.namedFramebuffers[r3]||(e.namedFramebuffers[r3]=c.framebuffer());let d=e.namedFramebuffers[r3];d.bind(),e.namedTextures[r3]||(e.namedTextures[r3]=c.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`));let f=e.namedTextures[r3];f.define(l,u);let p=Ztt(e,t,n,r,i,a);return e.state.currentRenderItemId=-1,f.attachFramebuffer(d,0),$tt(e),s.viewport(0,0,l,u),s.scissor(0,0,l,u),o.clear(o.COLOR_BUFFER_BIT),s.scissor(0,0,r[0],r[1]),p.render(),o.finish(),$y&&e.timer.markEnd(`calcActiveVoxels`),f}var tnt={..._F,tTriIndices:GP(`image-uint8`,`alpha`,`ubyte`,`nearest`),tActiveVoxelsPyramid:GP(`texture`,`rgba`,`float`,`nearest`),tActiveVoxelsBase:GP(`texture`,`rgba`,`float`,`nearest`),tVolumeData:GP(`texture`,`rgba`,`ubyte`,`nearest`),dValueChannel:qP(`string`,[`red`,`alpha`]),uIsoValue:J(`f`),uSize:J(`f`),uLevels:J(`f`),uCount:J(`f`),uInvert:J(`b`),uGridDim:J(`v3`),uGridTexDim:J(`v3`),uGridDataDim:J(`v3`),uGridTransform:J(`m4`),uGridTransformAdjoint:J(`m3`),uScale:J(`v2`),dPackedGroup:qP(`boolean`),dAxisOrder:qP(`string`,[`012`,`021`,`102`,`120`,`201`,`210`]),dConstantGroup:qP(`boolean`)},i3=`isosurface`;function nnt(e,t){return Bj(e.gl)&&t.format===e.gl.RED?`red`:`alpha`}function rnt(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){if(e.namedComputeRenderables[i3]){let g=e.namedComputeRenderables[i3].values;L.update(g.tActiveVoxelsPyramid,t),L.update(g.tActiveVoxelsBase,n),L.update(g.tVolumeData,r),L.update(g.dValueChannel,nnt(e,r)),L.updateIfChanged(g.uIsoValue,c),L.updateIfChanged(g.uSize,2**l),L.updateIfChanged(g.uLevels,l),L.updateIfChanged(g.uCount,d),L.updateIfChanged(g.uInvert,f),L.update(g.uGridDim,i),L.update(g.uGridTexDim,a),L.update(g.uGridDataDim,o),L.update(g.uGridTransform,s),L.update(g.uGridTransformAdjoint,TT.adjointFromMat4(TT(),s)),L.update(g.uScale,u),L.updateIfChanged(g.dPackedGroup,p),L.updateIfChanged(g.dAxisOrder,m.join(``)),L.updateIfChanged(g.dConstantGroup,h),e.namedComputeRenderables[i3].update()}else e.namedComputeRenderables[i3]=int(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h);return e.namedComputeRenderables[i3]}function int(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){let g={...vF,tTriIndices:L.create(Jtt()),tActiveVoxelsPyramid:L.create(t),tActiveVoxelsBase:L.create(n),tVolumeData:L.create(r),dValueChannel:L.create(nnt(e,r)),uIsoValue:L.create(c),uSize:L.create(2**l),uLevels:L.create(l),uCount:L.create(d),uInvert:L.create(f),uGridDim:L.create(i),uGridTexDim:L.create(a),uGridDataDim:L.create(o),uGridTransform:L.create(s),uGridTransformAdjoint:L.create(TT.adjointFromMat4(TT(),s)),uScale:L.create(u),dPackedGroup:L.create(p),dAxisOrder:L.create(m.join(``)),dConstantGroup:L.create(h)},_={...tnt};return hF(aF(e,`triangles`,fj(`isosurface`,tF,`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec3 uGridDataDim;
uniform mat4 uGridTransform;
uniform mat3 uGridTransformAdjoint;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

float voxelValuePadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
    #ifdef dValueChannel_red
        return v.r;
    #else
        return v.a;
    #endif
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * uGridDataDim.z + p.x * uGridDataDim.z * uGridDataDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * uGridDataDim.y + p.x * uGridDataDim.y * uGridDataDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * uGridDataDim.z + p.y * uGridDataDim.z * uGridDataDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * uGridDataDim.x + p.y * uGridDataDim.x * uGridDataDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * uGridDataDim.y + p.z * uGridDataDim.y * uGridDataDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * uGridDataDim.x + p.z * uGridDataDim.x * uGridDataDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    #ifdef dValueChannel_red
        float v0 = d0.r;
        float v1 = d1.r;
    #else
        float v0 = d0.a;
        float v1 = d1.a;
    #endif

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100 || defined(dConstantGroup)
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // ensure a constant group id per triangle as needed
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelValuePadded(b0 - c1) - voxelValuePadded(b0 + c1),
        voxelValuePadded(b0 - c3) - voxelValuePadded(b0 + c3),
        voxelValuePadded(b0 - c4) - voxelValuePadded(b0 + c4)
    ));
    vec3 n1 = -normalize(vec3(
        voxelValuePadded(b1 - c1) - voxelValuePadded(b1 + c1),
        voxelValuePadded(b1 - c3) - voxelValuePadded(b1 + c3),
        voxelValuePadded(b1 - c4) - voxelValuePadded(b1 + c4)
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz = uGridTransformAdjoint * gl_FragData[2].xyz;
}
`,{drawBuffers:`required`}),_,g),g)}function ant(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}function ont(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){let{drawBuffers:g}=e.extensions;if(!g)throw Error(`need WebGL draw buffers`);$y&&e.timer.mark(`createIsosurfaceBuffers`);let{gl:_,state:v,resources:y,extensions:b}=e,{pyramidTex:x,height:S,levels:C,scale:w,count:T}=r,E=x.getWidth();e.namedFramebuffers[i3]||(e.namedFramebuffers[i3]=y.framebuffer());let D=e.namedFramebuffers[i3];Bj(_)?(p||=y.texture(`image-float32`,`rgba`,`float`,`nearest`),m||=y.texture(`image-uint8`,`rgba`,`ubyte`,`nearest`),h||=b.colorBufferHalfFloat&&b.textureHalfFloat?y.texture(`image-float16`,`rgba`,`fp16`,`nearest`):y.texture(`image-float32`,`rgba`,`float`,`nearest`)):(p||=y.texture(`image-float32`,`rgba`,`float`,`nearest`),m||=y.texture(`image-float32`,`rgba`,`float`,`nearest`),h||=y.texture(`image-float32`,`rgba`,`float`,`nearest`)),p.define(E,S),m.define(E,S),h.define(E,S),p.attachFramebuffer(D,0),m.attachFramebuffer(D,1),h.attachFramebuffer(D,2);let O=rnt(e,x,t,n,i,a,o,s,c,C,w,T,l,u,d,f);return e.state.currentRenderItemId=-1,D.bind(),g.drawBuffers([g.COLOR_ATTACHMENT0,g.COLOR_ATTACHMENT1,g.COLOR_ATTACHMENT2]),ant(e),v.viewport(0,0,E,S),_.clear(_.COLOR_BUFFER_BIT),O.render(),_.finish(),$y&&e.timer.markEnd(`createIsosurfaceBuffers`),{vertexTexture:p,groupTexture:m,normalTexture:h,vertexCount:T}}function a3(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m){$y&&e.timer.mark(`extractIsosurface`);let h=ent(e,t,n,r,s,a),g=ont(e,h,t,Ktt(e,h,a,r),n,r,i,o,s,c,l,u,d,f,p,m);return $y&&e.timer.markEnd(`extractIsosurface`),g}const o3={isoValue:zP.IsoValueParam,wrap:V.Select(`auto`,V.arrayToOptions([`off`,`on`,`auto`]))},snt={...o3,tryUseGpu:V.Boolean(!0),gpuDataType:V.Select(`byte`,V.arrayToOptions([`byte`,`float`,`halfFloat`]),{hideIf:e=>!e.tryUseGpu})};function cnt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}function s3(e,t){return t===`on`?!0:t===`off`?!1:e.periodicity===`xyz`}var c3=1;function l3(e,t){if(e.grid.cells.data.length<10**3)return!1;let n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=Lq(n,c3);return r<=t.maxTextureSize/2}function lnt(e,t,n,r,i){return r.tryUseGpu&&i&&cnt(i)&&l3(t,i)?mnt(e):fnt(e)}function unt(e,t){let n=G.ofLength(e.instances.length);return zP.Isosurface.Loci(e,t.isoValue,n)}function u3(e,t,n,r,i){let{objectId:a,groupId:o,instanceId:s}=e;if(i===a){let e=zP.PickingGranularity.get(t),n=K.ofSingleton(s);if(e===`volume`)return zP.Loci(t,n);if(e===`object`||o===iJ.Null)return zP.Isosurface.Loci(t,r.isoValue,n);{let e=G.ofSingleton(o);return zP.Cell.Loci(t,[{indices:e,instances:n}])}}return hq}function d3(e,t,n,r,i){return Fq(e,t,{isoValue:r.isoValue},i)}async function dnt(e,t,n,r,i,a){e.runtime.update({message:`Marching cubes...`});let o=t.grid.cells;s3(t,i.wrap)&&(o=zq(t).grid.cells);let s=TE(new Int32Array(t.grid.cells.data.length)),c=await K4({isoLevel:zP.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:o,idField:BD.create(o.space,BD.Data1(s))},a).runAsChild(e.runtime),l=NP.getGridToCartesianTransform(t.grid);return HM.transform(c,l),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(c,!1),L.updateIfChanged(c.varyingGroup,!1)):L.updateIfChanged(c.varyingGroup,!0),c.setBoundingSphere(zP.Isosurface.getBoundingSphere(t,i.isoValue)),c}const f3={...HM.Params,...UP.Params,...o3,...snt,quality:{...HM.Params.quality,isEssential:!1}};function fnt(e){return J4({defaultProps:V.getDefaultValues(f3),createGeometry:dnt,createLocationIterator:Iq,getLoci:u3,eachLocation:d3,setUpdateState:(e,t,n,r)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.wrap!==r.wrap},geometryUtils:HM.Utils,mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&l3(e.volume,n)},e)}var p3;(function(e){let t=`volume-isosurface-texture`;e.descriptor=PP({name:t});function n(e){delete e._propertyData[t]}e.clear=n;function r(n,r,i){let{gpuDataType:a}=i,o=s3(n,i.wrap),s=NP.getGridToCartesianTransform(n.grid),c=B.clone(n.grid.cells.space.dimensions),{width:l,height:u,powerOfTwoSize:d}=Lq(c,c3),f=B.create(l,u,0),p=B.subScalar(B(),c,o?1:0),m=R.create(l/d,u/d);if(d>r.maxTextureSize/2)throw Error(`volume too large for gpu isosurface extraction`);let h=a===`halfFloat`&&!r.extensions.textureHalfFloat?`float`:a;if(n._propertyData[t]?.dataType!==h||n._propertyData[t]?.wrap!==o){let i=h===`byte`?r.resources.texture(`image-uint8`,`alpha`,`ubyte`,`linear`):h===`halfFloat`?r.resources.texture(`image-float16`,`alpha`,`fp16`,`linear`):r.resources.texture(`image-float32`,`alpha`,`float`,`linear`);n._propertyData[t]={texture:i,dataType:h,wrap:o},i.define(d,d),i.load(Rq(n,`data`,c3,h),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:()=>i.destroy()}])}return c[0]+=c3,c[1]+=c3,{texture:n._propertyData[t].texture,transform:s,gridDimension:c,gridTexDim:f,gridDataDim:p,gridTexScale:m}}e.get=r})(p3||={});function pnt(e,t,n,r,i,a){let{webgl:o}=e;if(!o)throw Error(`webgl context required to create volume isosurface texture-mesh`);if(t.grid.cells.data.length<=1)return UP.createEmpty(a);s3(t,i.wrap)&&(t=zq(t));let{max:s,min:c}=t.grid.stats,l=s-c,u=zP.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,d=(u-c)/l,f=t.grid.cells.space.axisOrderSlowToFast,p=t.grid.cells.data.length,m=zP.getBoundingSphere(t),h=e=>{let{texture:n,gridDimension:r,gridTexDim:a,gridDataDim:s,gridTexScale:c,transform:l}=p3.get(t,o,i),h=e?.doubleBuffer.get(),g=a3(o,n,r,a,s,c,l,d,u<0,!1,f,!0,h?.vertex,h?.group,h?.normal);return UP.create(g.vertexCount,p,g.vertexTexture,g.groupTexture,g.normalTexture,m,e)},g=h(a);return g.meta.webgl=o,g.meta.reset=()=>{p3.clear(t),h(g)},g}function mnt(e){return J4({defaultProps:V.getDefaultValues(f3),createGeometry:pnt,createLocationIterator:Iq,getLoci:u3,eachLocation:d3,setUpdateState:(e,t,n,r)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.gpuDataType!==r.gpuDataType||n.wrap!==r.wrap},geometryUtils:UP.Utils,mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!l3(e.volume,n),dispose:e=>{e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy()}},e)}async function hnt(e,t,n,r,i,a){e.runtime.update({message:`Marching cubes...`});let o=t.grid.cells;s3(t,i.wrap)&&(o=zq(t).grid.cells);let s=TE(new Int32Array(t.grid.cells.data.length)),c=await q4({isoLevel:zP.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:o,idField:BD.create(o.space,BD.Data1(s))},a).runAsChild(e.runtime),l=NP.getGridToCartesianTransform(t.grid);return vP.transform(c,l),c.setBoundingSphere(zP.Isosurface.getBoundingSphere(t,i.isoValue)),c}const gnt={...vP.Params,...o3,quality:{...vP.Params.quality,isEssential:!1},sizeFactor:V.Numeric(3,{min:0,max:10,step:.1})};function _nt(e){return J4({defaultProps:V.getDefaultValues(gnt),createGeometry:hnt,createLocationIterator:Iq,getLoci:u3,eachLocation:d3,setUpdateState:(e,t,n,r)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.wrap!==r.wrap},geometryUtils:vP.Utils},e)}var vnt={solid:(e,t)=>X4(`Isosurface mesh`,e,t,lnt,unt),wireframe:(e,t)=>X4(`Isosurface wireframe`,e,t,_nt,unt)};const ynt={...f3,...gnt,visuals:V.MultiSelect([`solid`],V.objectToOptions(vnt)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory)};function bnt(e,t){let n=V.clone(ynt);return n.isoValue=zP.createIsoValueParam(zP.IsoValue.relative(2),t.grid.stats),n}function xnt(e,t){return rJ.createMulti(`Isosurface`,e,t,rJ.StateBuilder,vnt)}const Snt=Y4({name:`isosurface`,label:`Isosurface`,description:`Displays a triangulated isosurface of volumetric data.`,factory:xnt,getParams:bnt,defaultValues:V.getDefaultValues(ynt),defaultColorTheme:{name:`uniform`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>!zP.isEmpty(e)&&!zP.Segmentation.get(e)}),m3={...SF.Params,quality:{...SF.Params.quality,isEssential:!1},dimension:V.MappedStatic(`x`,{x:V.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),y:V.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),z:V.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),relativeX:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>e.mode!==`grid`,description:`Slice position in grid coordinates.`}),isoValue:zP.IsoValueParam,mode:V.Select(`grid`,V.arrayToOptions([`grid`,`frame`,`plane`]),{description:`Grid: slice through the volume along the grid axes in integer steps. Frame: slice through the volume along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal.`}),offset:V.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!==`frame`,description:`Relative offset from center.`}),axis:V.Select(`a`,V.arrayToOptions([`a`,`b`,`c`]),{isEssential:!0,hideIf:e=>e.mode!==`frame`,description:`Axis of the frame.`}),rotation:V.Group({axis:V.Vec3(B.create(1,0,0),{},{description:`Axis of rotation`}),angle:V.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:`Axis rotation angle in Degrees`})},{isExpanded:!0,hideIf:e=>e.mode!==`frame`}),plane:V.Group({point:V.Vec3(B.create(0,0,0),{},{description:`Plane point`}),normal:V.Vec3(B.create(1,0,0),{},{description:`Plane normal`})},{isExpanded:!0,hideIf:e=>e.mode!==`plane`})};function Cnt(e,t){let n=V.clone(m3),r=t.grid.cells.space.dimensions;return n.dimension=V.MappedStatic(`x`,{x:V.Numeric(0,{min:0,max:r[0]-1,step:1},{immediateUpdate:!0}),y:V.Numeric(0,{min:0,max:r[1]-1,step:1},{immediateUpdate:!0}),z:V.Numeric(0,{min:0,max:r[2]-1,step:1},{immediateUpdate:!0}),relativeX:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:V.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>e.mode!==`grid`}),n.isoValue=zP.createIsoValueParam(zP.IsoValue.absolute(t.grid.stats.min),t.grid.stats),n}async function wnt(e,t,n,r,i,a){switch(i.mode){case`frame`:return Dnt(e,t,n,r,i,a);case`grid`:return knt(e,t,n,r,i,a);case`plane`:return Ont(e,t,n,r,i,a);default:Lb(i.mode)}}function Tnt(e,t){let{axis:n,rotation:r,mode:i}=t,a=NP.getGridToCartesianTransform(e.grid),o=z.invert(z(),a),[s,c,l]=e.grid.cells.space.dimensions,u=s,d=c,f=l,p=B.create(u,0,0),m=B.create(0,d,0),h=B.create(0,0,f),g=Math.max(u,d,f)/Math.max(s,c,l),_=B.create(0,0,0),v=B.create(u,d,f);B.transformMat4(_,_,a),B.transformMat4(v,v,a);let y=B.center(B(),v,_),b=B(),x=B(),S=B(),C=B();if(n===`c`?(B.set(b,u,d,f),B.copy(x,p),B.copy(S,m),B.copy(C,h)):n===`b`?(B.set(b,u,f,d),B.copy(x,p),B.copy(C,m),B.copy(S,h)):(B.set(b,d,f,u),B.copy(C,p),B.copy(x,m),B.copy(S,h)),r.angle!==0){let e=B();B.scaleAndAdd(e,e,p,r.axis[0]),B.scaleAndAdd(e,e,m,r.axis[1]),B.scaleAndAdd(e,e,h,r.axis[2]),B.normalize(e,e);let t=z.fromRotation(z(),FT(r.angle),e);B.transformDirection(x,x,t),B.transformDirection(S,S,t),B.transformDirection(C,C,t)}if(i===`frame`){let e=B.distance(_,v),t=B.distance(_,v)*Math.SQRT2;B.set(b,t,t,e)}return B.transformDirection(x,x,a),B.transformDirection(S,S,a),B.transformDirection(C,C,a),{size:b,major:x,minor:S,normal:C,center:y,trim:{type:3,center:B.create(u/2,d/2,f/2),scale:B.create(u,d,f),rotation:MT.identity(),transform:o},resolution:g}}function Ent(e,t,n,r,i,a){let{m:o,width:s,height:c}=n,{cells:{space:l},stats:u}=e.grid,{min:d,max:f}=u,p=t.color.granularity===`uniform`,m=`color`in t.color&&t.color.color?t.color.color:()=>tE(16777215),h=B(),g=NP.getGridToCartesianTransform(e.grid),_=z.invert(z(),g),[v,y,b]=l.dimensions,x=new Uint8Array(s*c*4),S=new Uint8Array(s*c*4),C=new Float32Array(s*c),w=B(),T=rj(B(),B()),E=NP.makeGetTrilinearlyInterpolated(e.grid,`none`),D=0;for(let e=0;e<c;++e)for(let t=0;t<s;++t){let n=DT(t+.5,0,s-1)/s-.5,r=DT(e+.5,0,c-1)/c-.5;B.set(h,r,-n,0),B.transformMat4(h,h,o),B.copy(w,h),B.transformMat4(w,w,_);let i=Math.trunc(w[0]),a=Math.trunc(w[1]),u=Math.trunc(w[2]);B.copy(T.position,h);let g=m(T,!1);tE.toArray(g,x,D);let O=ET(E(h),d,f);p&&(x[D]*=O,x[D+1]*=O,x[D+2]*=O),C[D/4]=O,i>=0&&i<v&&a>=0&&a<y&&u>=0&&u<b&&XN(l.dataOffset(i,a,u),S,D),D+=4}let O={width:s,height:c,array:x,flipY:!0},k={width:s,height:c,array:S,flipY:!0},A={width:s,height:c,array:C,flipY:!0},j=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);DA(o,j,0,4);let M=DT(ET(zP.IsoValue.toAbsolute(r,u).absoluteValue,d,f),0,1),N=SF.create(O,j,k,A,i,M,a);return N.setBoundingSphere(zP.getBoundingSphere(e)),N}async function Dnt(e,t,n,r,i,a){let{offset:o,isoValue:s}=i,{size:c,major:l,minor:u,normal:d,center:f,trim:p,resolution:m}=Tnt(t,i),h=1/m,g=B.create(c[0],c[1],1),_=B.setMagnitude(B(),d,c[2]/2),v=Math.floor(c[1]*h),y=Math.floor(c[0]*h),b=z.identity(),x=B(),S=B();return B.add(x,f,l),z.targetTo(b,f,x,u),B.scaleAndAdd(S,f,_,o),z.setTranslation(b,S),z.mul(b,b,z.rotY90),z.scale(b,b,g),Ent(t,r,{m:b,width:v,height:y},s,p,a)}async function Ont(e,t,n,r,i,a){let{plane:{point:o,normal:s},isoValue:c}=i,l=z.fromPlane(z(),s,o),u=NP.getGridToCartesianTransform(t.grid),d=z.invert(z(),u),[f,p,m]=t.grid.cells.space.dimensions,h=f,g=p,_=m,v=1/(Math.max(h,g,_)/Math.max(f,p,m)),y=B.distance(B.create(0,0,0),B.create(h,g,_))*Math.SQRT2,b=B.set(B(),y,y,y);z.mul(l,l,z.rotY90),z.scale(l,l,b);let x=Math.floor(b[1]*v),S=Math.floor(b[0]*v),C={type:3,center:B.create(h/2,g/2,_/2),scale:B.create(h,g,_),rotation:MT.identity(),transform:d};return Ent(t,r,{m:l,width:x,height:S},c,C,a)}async function knt(e,t,n,r,i,a){let{dimension:{name:o},isoValue:s}=i,{cells:{space:c,data:l},stats:u}=t.grid,{min:d,max:f}=u,p=r.color.granularity===`uniform`,m=`color`in r.color&&r.color.color?r.color.color:()=>tE(16777215),{width:h,height:g,x:_,y:v,z:y,x0:b,y0:x,z0:S,nx:C,ny:w,nz:T}=g3(t.grid,i),E=new Float32Array(o===`x`||o===`relativeX`?[_,0,0,_,v,0,_,0,y,_,v,y]:o===`y`||o===`relativeY`?[0,v,0,_,v,0,0,v,y,_,v,y]:[0,0,y,0,v,y,_,0,y,_,v,y]),D=new Uint8Array(h*g*4),O=Ant(t.grid,i),k=new Float32Array(h*g),A=NP.getGridToCartesianTransform(t.grid),j=rj(B(),B()),M=0;for(let e=x;e<w;++e)for(let t=b;t<C;++t)for(let n=S;n<T;++n){B.set(j.position,t,e,n),B.transformMat4(j.position,j.position,A),tE.toArray(m(j,!1),D,M);let r=ET(c.get(l,t,e,n),d,f);p&&(D[M]*=r,D[M+1]*=r,D[M+2]*=r),k[M/4]=r,M+=4}let N={width:h,height:g,array:D,flipY:!0},ee={width:h,height:g,array:O,flipY:!0},te={width:h,height:g,array:k,flipY:!0};DA(NP.getGridToCartesianTransform(t.grid),E,0,4);let P=SF.createEmptyTrim(),ne=DT(ET(zP.IsoValue.toAbsolute(s,u).absoluteValue,d,f),0,1),re=SF.create(N,E,ee,te,P,ne,a);return re.setBoundingSphere(zP.getBoundingSphere(t)),re}function h3(e,t){return DT(Math.round((e-1)*t),0,e-1)}function g3(e,t){let{dimension:{name:n,params:r}}=t,{space:i}=e.cells,a,o,s,c,l,u=0,d=0,f=0,[p,m,h]=i.dimensions;return n===`x`?(s=r,c=m,l=h,a=h,o=m,u=s,p=u+1):n===`y`?(s=p,c=r,l=h,a=h,o=p,d=c,m=d+1):n===`z`?(s=p,c=m,l=r,a=p,o=m,f=l,h=f+1):n===`relativeX`?(s=h3(p,r),c=m,l=h,a=h,o=m,u=s,p=u+1):n===`relativeY`?(s=p,c=h3(m,r),l=h,a=h,o=p,d=c,m=d+1):(s=p,c=m,l=h3(h,r),a=p,o=m,f=l,h=f+1),{width:a,height:o,x:s,y:c,z:l,x0:u,y0:d,z0:f,nx:p,ny:m,nz:h}}function Ant(e,t){let{space:n}=e.cells,{width:r,height:i,x0:a,y0:o,z0:s,nx:c,ny:l,nz:u}=g3(e,t),d=new Uint8Array(r*i*4),f=0;for(let e=o;e<l;++e)for(let t=a;t<c;++t)for(let r=s;r<u;++r)XN(n.dataOffset(t,e,r),d,f),f+=4;return d}function jnt(e,t){let{space:n}=e.cells,{width:r,height:i,x0:a,y0:o,z0:s,nx:c,ny:l,nz:u}=g3(e,t),d=new Uint32Array(r*i),f=0;for(let e=o;e<l;++e)for(let t=a;t<c;++t)for(let r=s;r<u;++r)d[f]=n.dataOffset(t,e,r),f+=1;return d}function Mnt(e,t,n){if(n.mode===`grid`){let r=jnt(e.grid,n),i=Vk.ofUnsortedArray(r);return zP.Cell.Loci(e,[{indices:i,instances:t}])}else return zP.Loci(e,t)}function Nnt(e,t){return Mnt(e,G.ofLength(e.instances.length),t)}function Pnt(e,t,n,r,i){let{objectId:a,groupId:o,instanceId:s}=e;if(i===a){let e=zP.PickingGranularity.get(t),n=K.ofSingleton(s);if(e===`volume`)return zP.Loci(t,n);if(e===`object`||o===iJ.Null)return Mnt(t,n,r);{let e=G.ofSingleton(o);return zP.Cell.Loci(t,[{indices:e,instances:n}])}}return hq}function Fnt(e,t,n,r,i){return Fq(e,t,void 0,i)}function Int(e){return J4({defaultProps:V.getDefaultValues(m3),createGeometry:wnt,createLocationIterator:Iq,getLoci:Pnt,eachLocation:Fnt,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=n.dimension.name!==r.dimension.name||n.dimension.params!==r.dimension.params||n.mode!==r.mode||!B.equals(n.rotation.axis,r.rotation.axis)||n.rotation.angle!==r.rotation.angle||n.offset!==r.offset||n.axis!==r.axis||!B.equals(n.plane.point,r.plane.point)||!B.equals(n.plane.normal,r.plane.normal)||!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||!YK.areEqual(i.color,a.color)},geometryUtils:SF.Utils},e)}function Lnt(e,t){return X4(`Slice`,e,t,Int,Nnt)}const Rnt=Y4({name:`slice`,label:`Slice`,description:`Slice of volume rendered as image with interpolation.`,factory:Lnt,getParams:Cnt,defaultValues:V.getDefaultValues(m3),defaultColorTheme:{name:`uniform`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>!zP.isEmpty(e)&&!zP.Segmentation.get(e)});function znt(e,t){let n=$k();return $k.add(n,e),$k.transform(n,n,t),n}function Bnt(e,t,n,r,i){let a=n.grid.cells.space.dimensions,{width:o,height:s}=Lq(a);if(Math.max(o,s)>t.maxTextureSize/2)throw Error(`volume too large for direct-volume rendering`);let c=r.dataType===`halfFloat`&&!t.extensions.textureHalfFloat?`float`:r.dataType,l=Rq(n,`normals`,0,c),u=NP.getGridToCartesianTransform(n.grid),d=znt(a,u),f;f=i&&i.dataType.ref.value===c?i.gridTexture.ref.value:c===`byte`?t.resources.texture(`image-uint8`,`rgba`,`ubyte`,`linear`):c===`halfFloat`?t.resources.texture(`image-float16`,`rgba`,`fp16`,`linear`):t.resources.texture(`image-float32`,`rgba`,`float`,`linear`),f.load(l);let{unitToCartn:p,cellDim:m}=Vnt(n.grid),h=n.grid.cells.space.axisOrderSlowToFast;return VP.create(d,a,u,p,m,f,n.grid.stats,!1,h,c,i)}function Vnt(e){if(e.transform.kind===`matrix`)return{unitToCartn:z.mul(z(),e.transform.matrix,z.fromScaling(z(),e.cells.space.dimensions)),cellDim:z.getScaling(B(),e.transform.matrix)};let t=e.transform.fractionalBox,n=$k.size(B(),t);return{unitToCartn:z.mul3(z(),e.transform.cell.fromFractional,z.fromTranslation(z(),t.min),z.fromScaling(z(),n)),cellDim:B.div(B(),e.transform.cell.size,e.cells.space.dimensions)}}function Hnt(e,t,n,r,i){let a=n.grid.cells.space.dimensions;if(Math.max(...a)>t.max3dTextureSize/2)throw Error(`volume too large for direct-volume rendering`);let o=r.dataType===`halfFloat`&&!t.extensions.textureHalfFloat?`float`:r.dataType,s=VBe(n,o),c=NP.getGridToCartesianTransform(n.grid),l=znt(a,c),u;u=i&&i.dataType.ref.value===o?i.gridTexture.ref.value:o===`byte`?t.resources.texture(`volume-uint8`,`rgba`,`ubyte`,`linear`):o===`halfFloat`?t.resources.texture(`volume-float16`,`rgba`,`fp16`,`linear`):t.resources.texture(`volume-float32`,`rgba`,`float`,`linear`),u.load(s);let{unitToCartn:d,cellDim:f}=Vnt(n.grid),p=n.grid.cells.space.axisOrderSlowToFast;return VP.create(l,a,c,d,f,u,n.grid.stats,!1,p,o,i)}async function Unt(e,t,n,r,i,a){let{runtime:o,webgl:s}=e;if(s===void 0)throw Error("DirectVolumeVisual requires `webgl` in VisualContext");return s.isWebGL2?Hnt(o,s,t,i,a):Bnt(o,s,t,i,a)}function Wnt(e,t){let n=G.ofLength(e.instances.length);return zP.Loci(e,n)}function Gnt(e,t,n,r,i){let{objectId:a,groupId:o,instanceId:s}=e;if(i===a){let e=K.ofSingleton(s),n=G.ofSingleton(o);return zP.Cell.Loci(t,[{indices:n,instances:e}])}return hq}function Knt(e,t,n,r,i){return Fq(e,t,void 0,i)}const _3={...VP.Params,quality:{...VP.Params.quality,isEssential:!1},dataType:V.Select(`byte`,V.arrayToOptions([`byte`,`float`,`halfFloat`]))};function qnt(e,t){let n=V.clone(_3);return n.controlPoints.getVolume=()=>t,n}function Jnt(e){return J4({defaultProps:V.getDefaultValues(_3),createGeometry:Unt,createLocationIterator:Iq,getLoci:Gnt,eachLocation:Knt,setUpdateState:(e,t,n,r)=>{e.createGeometry=n.dataType!==r.dataType},geometryUtils:VP.Utils,dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}function Ynt(e,t){return X4(`Direct Volume`,e,t,Jnt,Wnt)}const Xnt=Y4({name:`direct-volume`,label:`Direct Volume`,description:`Direct rendering of volumetric data.`,factory:Ynt,getParams:qnt,defaultValues:V.getDefaultValues(_3),defaultColorTheme:{name:`volume-value`},defaultSizeTheme:{name:`uniform`},locationKinds:[`position-location`,`direct-location`],isApplicable:e=>!zP.isEmpty(e)&&!zP.Segmentation.get(e)}),Znt={segments:V.Converted(e=>e.map(e=>`${e}`),e=>e.map(e=>parseInt(e)),V.MultiSelect([`0`],V.arrayToOptions([`0`]),{isEssential:!0}))};function Qnt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var v3=1;function y3(e,t){if(e.grid.cells.data.length<10**3)return!1;let n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=Lq(n,v3);return r<=t.maxTextureSize/2}var $nt=z();function ert(e,t){let n=NP.getGridToCartesianTransform(e),r=z.fromTranslation($nt,t.min);return z.mul(z(),n,r)}function trt(e,t,n,r,i){return r.tryUseGpu&&i&&Qnt(i)&&y3(t,i)?urt(e):srt(e)}function nrt(e,t){let n=Vk.ofUnsortedArray(t.segments),r=G.ofLength(e.instances.length);return zP.Segment.Loci(e,[{segments:n,instances:r}])}function rrt(e,t,n,r,i){let{objectId:a,groupId:o,instanceId:s}=e;if(i===a){let e=zP.PickingGranularity.get(t),r=K.ofSingleton(s);if(e===`volume`)return zP.Loci(t,r);if(e===`object`||o===iJ.Null){let e=K.ofSingleton(n);return zP.Segment.Loci(t,[{segments:e,instances:r}])}else{let e=G.ofSingleton(o);return zP.Cell.Loci(t,[{indices:e,instances:r}])}}return hq}function irt(e,t,n,r,i){return Fq(e,t,{segments:Vk.ofSingleton(n)},i)}function art(e,t,n){let r=n.data,i=n.space.dataOffset,a=$k.size(B(),t),[o,s,c]=a,l=o-1,u=s-1,d=c-1,[f,p,m]=t.min,[h,g,_]=t.max,v=[...n.space.axisOrderSlowToFast],y=BD.Space(a,v,Uint8Array),b=BD.create(y,y.create()),x=b.data,S=y.set;for(let t=0;t<c;++t)for(let n=0;n<s;++n)for(let a=0;a<o;++a){let o=e.includes(r[i(a+f,n+p,t+m)])?255:0,s=e.includes(r[i(Math.min(l+h,a+1+f),n+p,t+m)])?255:0,c=e.includes(r[i(Math.max(0,a-1+f),n+p,t+m)])?255:0,v=e.includes(r[i(a+f,Math.min(u+g,n+1+p),t+m)])?255:0,y=e.includes(r[i(a+f,Math.max(0,n-1+p),t+m)])?255:0,b=e.includes(r[i(a+f,n+p,Math.min(d+_,t+1+m))])?255:0,C=e.includes(r[i(a+f,n+p,Math.max(0,t-1+m))])?255:0;S(x,a,n,t,Math.round((o+o+s+c+v+y+b+C)/8))}return b}async function ort(e,t,n,r,i,a){let o=zP.Segmentation.get(t);if(!o)throw Error(`missing volume segmentation`);e.runtime.update({message:`Marching cubes...`});let s=$k.clone(o.bounds[n]);$k.expand(s,s,B.create(2,2,2));let c=art(Array.from(o.segments.get(n).values()),s,t.grid.cells),l=TE(new Int32Array(c.data.length)),u=await K4({isoLevel:128,scalarField:c,idField:BD.create(c.space,BD.Data1(l))},a).runAsChild(e.runtime),d=ert(t.grid,s);HM.transform(u,d),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(u,!1),L.updateIfChanged(u.varyingGroup,!1)):L.updateIfChanged(u.varyingGroup,!0);let f=G.ofLength(t.instances.length),p=K.ofSingleton(n);return u.setBoundingSphere(zP.Segment.getBoundingSphere(t,[{segments:p,instances:f}])),u}const b3={...HM.Params,...UP.Params,...Znt,quality:{...HM.Params.quality,isEssential:!1},tryUseGpu:V.Boolean(!0)};function srt(e){return J4({defaultProps:V.getDefaultValues(b3),createGeometry:ort,createLocationIterator:(e,t)=>{let n=zP.Segment.Location(e,t);return tj(e.grid.cells.data.length,e.instances?e.instances.length:1,1,()=>n)},getLoci:rrt,eachLocation:irt,setUpdateState:(e,t,n,r)=>{},geometryUtils:HM.Utils,mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&y3(e.volume,n)},e)}var x3=`segment-texture`;function crt(e,t,n){let r=zP.Segmentation.get(e);if(!r)throw Error(`missing volume segmentation`);let{resources:i}=n,a=$k.clone(r.bounds[t]);$k.expand(a,a,B.create(2,2,2));let o=ert(e.grid,a),s=$k.size(B(),a),{width:c,height:l,powerOfTwoSize:u}=Lq(s,v3),d=B.create(c,l,0),f=B.clone(s),p=R.create(c/u,l/u);if(u>n.maxTextureSize/2)throw Error(`volume too large for gpu segment extraction`);n.namedTextures[x3]||(n.namedTextures[x3]=i.texture(`image-uint8`,`alpha`,`ubyte`,`linear`));let m=n.namedTextures[x3];m.define(u,u);let h=Array.from(r.segments.get(t).values());return m.load(HBe(e,h,a,v3),!0),s[0]+=v3,s[1]+=v3,{texture:m,transform:o,gridDimension:s,gridTexDim:d,gridDataDim:f,gridTexScale:p}}async function lrt(e,t,n,r,i,a){if(!e.webgl)throw Error(`webgl context required to create volume segment texture-mesh`);if(t.grid.cells.data.length<=1)return UP.createEmpty(a);let{texture:o,gridDimension:s,gridTexDim:c,gridDataDim:l,gridTexScale:u,transform:d}=crt(t,n,e.webgl),f=t.grid.cells.space.axisOrderSlowToFast,p=a?.doubleBuffer.get(),m=a3(e.webgl,o,s,c,l,u,d,.5,!1,!1,f,!0,p?.vertex,p?.group,p?.normal),h=t.grid.cells.data.length,g=G.ofLength(t.instances.length),_=K.ofSingleton(n),v=zP.Segment.getBoundingSphere(t,[{segments:_,instances:g}]);return UP.create(m.vertexCount,h,m.vertexTexture,m.groupTexture,m.normalTexture,v,a)}function urt(e){return J4({defaultProps:V.getDefaultValues(b3),createGeometry:lrt,createLocationIterator:(e,t)=>{let n=zP.Segment.Location(e,t);return tj(e.grid.cells.data.length,e.instances?e.instances.length:1,1,()=>n)},getLoci:rrt,eachLocation:irt,setUpdateState:(e,t,n,r)=>{},geometryUtils:UP.Utils,mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!y3(e.volume,n),dispose:e=>{e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy()}},e)}function drt(e){return Vk.ofUnsortedArray(e.segments)}var frt={segment:(e,t)=>X4(`Segment mesh`,e,t,trt,nrt,drt)};const prt={...b3,visuals:V.MultiSelect([`segment`],V.objectToOptions(frt)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory)};function mrt(e,t){let n=V.clone(prt),r=zP.Segmentation.get(t);if(r){let e=Array.from(r.segments.keys());n.segments=V.Converted(e=>e.map(e=>`${e}`),e=>e.map(e=>parseInt(e)),V.MultiSelect(e.map(e=>`${e}`),V.arrayToOptions(e.map(e=>`${e}`)),{isEssential:!0}))}return n}function hrt(e,t){return rJ.createMulti(`Segment`,e,t,rJ.StateBuilder,frt)}const grt=Y4({name:`segment`,label:`Segment`,description:`Displays a triangulated segment of volumetric data.`,factory:hrt,getParams:mrt,defaultValues:V.getDefaultValues(prt),defaultColorTheme:{name:`volume-segment`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>!zP.isEmpty(e)&&!!zP.Segmentation.get(e)});var _rt=_O.add3,vrt=_O.add,S3;(function(e){function t(e=2048,t=1024,n){let r=_O.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),i=_O.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e);return{add:(e,t,n,a)=>{_rt(r,e,t,n),vrt(i,a)},getSpheres:()=>{let e=_O.compact(r,!0),t=_O.compact(i,!0);return HP.create(e,t,r.elementCount,n)}}}e.create=t})(S3||={});var yrt=_O.add3,brt=_O.add,C3;(function(e){function t(e=2048,t=1024,n){let r=_O.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),i=_O.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e);return{add:(e,t,n,a)=>{yrt(r,e,t,n),brt(i,a)},getPoints:()=>{let e=_O.compact(r,!0),t=_O.compact(i,!0);return iP.create(e,t,r.elementCount,n)}}}e.create=t})(C3||={});const xrt={isoValue:zP.IsoValueParam,perturbPositions:V.Boolean(!1)},w3={...HP.Params,...HM.Params,...xrt,tryUseImpostor:V.Boolean(!0),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo)};function Srt(e,t,n,r,i){return r.tryUseImpostor&&i&&i.extensions.fragDepth&&i.extensions.textureFloat?Crt(e):wrt(e)}function Crt(e){return J4({defaultProps:V.getDefaultValues(w3),createGeometry:Trt,createLocationIterator:Iq,getLoci:O3,eachLocation:k3,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions},geometryUtils:HP.Utils,mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function wrt(e){return J4({defaultProps:V.getDefaultValues(w3),createGeometry:Ert,createLocationIterator:Iq,getLoci:O3,eachLocation:k3,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions||n.sizeFactor!==r.sizeFactor||n.detail!==r.detail},geometryUtils:HM.Utils,mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}function T3(e){return{...z.extractBasis(e),maxScale:z.getMaxScaleOnAxis(e)}}var E3=B();function D3({x:e,y:t,z:n,maxScale:r}){let i=(Math.random()-.5)*r,a=(Math.random()-.5)*r,o=(Math.random()-.5)*r;return B.scale(E3,e,i),B.scaleAndAdd(E3,E3,t,a),B.scaleAndAdd(E3,E3,n,o),E3}function Trt(e,t,n,r,i,a){let{cells:{space:o,data:s},stats:c}=t.grid,l=NP.getGridToCartesianTransform(t.grid),u=zP.IsoValue.toAbsolute(i.isoValue,c).absoluteValue,d=B(),[f,p,m]=o.dimensions,h=Math.ceil(f*p*m/10),g=S3.create(h,Math.ceil(h/2),a),_=u<0,v=i.perturbPositions?T3(l):void 0;for(let e=0;e<m;++e)for(let t=0;t<p;++t)for(let n=0;n<f;++n){let r=o.get(s,n,t,e);if(!_&&r<u||_&&r>u)continue;let i=o.dataOffset(n,t,e);if(v){B.set(d,n,t,e),B.transformMat4(d,d,l);let r=D3(v);B.add(d,d,r)}else B.set(d,n,t,e),B.transformMat4(d,d,l);g.add(d[0],d[1],d[2],i)}let y=g.getSpheres();return y.setBoundingSphere(zP.Isosurface.getBoundingSphere(t,i.isoValue)),y}function Ert(e,t,n,r,i,a){let{detail:o,sizeFactor:s}=i,{cells:{space:c,data:l},stats:u}=t.grid,d=NP.getGridToCartesianTransform(t.grid),f=zP.IsoValue.toAbsolute(i.isoValue,u).absoluteValue,p=B(),[m,h,g]=c.dimensions,_=Math.ceil(m*h*g/10)*rN(o),v=YN.createState(_,Math.ceil(_/2),a),y=zP.Cell.Location(t),b=r.size.size,x=f<0,S=i.perturbPositions?T3(d):void 0;for(let e=0;e<g;++e)for(let t=0;t<h;++t)for(let n=0;n<m;++n){let r=c.get(l,n,t,e);if(!x&&r<f||x&&r>f)continue;let i=c.dataOffset(n,t,e);y.cell=i;let a=b(y)*s;if(S){B.set(p,n,t,e),B.transformMat4(p,p,d);let r=D3(S);B.add(p,p,r)}else B.set(p,n,t,e),B.transformMat4(p,p,d);v.currentGroup=i,oN(v,p,a,o)}let C=YN.getMesh(v);return C.setBoundingSphere(zP.Isosurface.getBoundingSphere(t,i.isoValue)),C}const Drt={...iP.Params,...xrt};function Ort(e){return J4({defaultProps:V.getDefaultValues(Drt),createGeometry:krt,createLocationIterator:Iq,getLoci:O3,eachLocation:k3,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!zP.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions},geometryUtils:iP.Utils},e)}function krt(e,t,n,r,i,a){let{cells:{space:o,data:s},stats:c}=t.grid,l=NP.getGridToCartesianTransform(t.grid),u=zP.IsoValue.toAbsolute(i.isoValue,c).absoluteValue,d=B(),[f,p,m]=o.dimensions,h=Math.ceil(f*p*m/10),g=C3.create(h,Math.ceil(h/2),a),_=u<0,v=i.perturbPositions?T3(l):void 0;for(let e=0;e<m;++e)for(let t=0;t<p;++t)for(let n=0;n<f;++n){let r=o.get(s,n,t,e);if(!_&&r<u||_&&r>u)continue;let i=o.dataOffset(n,t,e);if(v){B.set(d,n,t,e),B.transformMat4(d,d,l);let r=D3(v);B.add(d,d,r)}else B.set(d,n,t,e),B.transformMat4(d,d,l);g.add(d[0],d[1],d[2],i)}let y=g.getPoints();return y.setBoundingSphere(zP.Isosurface.getBoundingSphere(t,i.isoValue)),y}function Art(e,t){let n=G.ofLength(e.instances.length);return zP.Isosurface.Loci(e,t.isoValue,n)}function O3(e,t,n,r,i){let{objectId:a,groupId:o,instanceId:s}=e;if(i===a){let e=zP.PickingGranularity.get(t),n=K.ofSingleton(s);if(e===`volume`)return zP.Loci(t,n);if(e===`object`||o===iJ.Null)return zP.Isosurface.Loci(t,r.isoValue,n);{let e=G.ofSingleton(o);return zP.Cell.Loci(t,[{indices:e,instances:n}])}}return hq}function k3(e,t,n,r,i){return Fq(e,t,{isoValue:r.isoValue},i)}var jrt={sphere:(e,t)=>X4(`Dot sphere`,e,t,Srt,Art),point:(e,t)=>X4(`Dot point`,e,t,Ort,Art)};const Mrt={...w3,...Drt,visuals:V.MultiSelect([`sphere`],V.objectToOptions(jrt)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory)};function Nrt(e,t){let n=V.clone(Mrt);return n.isoValue=zP.createIsoValueParam(zP.IsoValue.relative(2),t.grid.stats),n}function Prt(e,t){return rJ.createMulti(`Dot`,e,t,rJ.StateBuilder,jrt)}const Frt=Y4({name:`dot`,label:`Dot`,description:`Displays dots of volumetric data.`,factory:Prt,getParams:Nrt,defaultValues:V.getDefaultValues(Mrt),defaultColorTheme:{name:`uniform`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>!zP.isEmpty(e)&&!zP.Segmentation.get(e)});var A3=class e extends nJ{constructor(){super(),WT(e.BuiltIn,(e,t)=>{if(e.name!==t)throw Error(`Fix BuiltInVolumeRepresentations to have matching names. ${e.name} ${t}`);this.add(e)})}};(function(e){e.BuiltIn={"direct-volume":Xnt,dot:Frt,isosurface:Snt,segment:grt,slice:Rnt}})(A3||={});function Irt(e,t,n,r){e.push({source:t===`em`?{name:`em`,params:{isoValue:zP.IsoValue.absolute(r||0)}}:{name:`x-ray`,params:{}},dataId:n})}const j3=cE.build({display:{name:`Volume Streaming`},from:H.Molecule.Structure,params(e,t){let n=ptt(e&&e.data),r=gtt(n,e&&e.data);return{method:V.Select(n,[[`em`,`EM`],[`x-ray`,`X-Ray`]]),entries:V.ObjectList({id:V.Text(r[0]||``)},({id:e})=>e,{defaultValue:r.map(e=>({id:e}))}),defaultView:V.Select(n===`em`?`auto`:`selection-box`,_4.ViewTypeOptions),options:V.Group({serverUrl:V.Text(t.config.get(WQ.VolumeStreaming.DefaultServer)||`https://ds.litemol.org`),behaviorRef:V.Text(``,{isHidden:!0}),emContourProvider:V.Select(`emdb`,[[`emdb`,`EMDB`],[`pdbe`,`PDBe`]],{isHidden:!0}),channelParams:V.Value({},{isHidden:!0})})}},isApplicable:(e,t,n)=>{let r=n.config.get(WQ.VolumeStreaming.CanStream);return r?r(e.data,n):e.data.models.length===1&&DB.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:n},r)=>hb.create(`Volume Streaming`,async i=>{let a=[];for(let e=0,t=n.entries.length;e<t;++e){let t=n.entries[e].id.toLowerCase(),o;if(n.method===`em`){if(!t.toUpperCase().startsWith(`EMD`)){await i.update(`Getting EMDB info...`);let e=await xtt(r,i,t);for(let t=0,o=e.length;t<o;++t){let o=e[t],s;try{s=await _tt(n.options.emContourProvider,r,i,o)}catch(e){console.info(`Could not get map info for ${o}: ${e}`);continue}Irt(a,n.method,o,s||0)}continue}try{o=await _tt(n.options.emContourProvider,r,i,t)}catch(e){console.info(`Could not get map info for ${t}: ${e}`);continue}}Irt(a,n.method,t,o||0)}let o=t.build().to(e).applyOrUpdateTagged(_4.RootTag,zrt,{serverUrl:n.options.serverUrl,entries:a});await o.commit();let s=o.selector;if(!s.isOk)return;let c=t.tree.children.get(s.ref);c?.size>0&&await r.managers.structure.hierarchy.remove(c?.toArray());let l=s.cell.obj,u=t.build().to(o.ref).apply(M3,V.getDefaultValues(_4.createParams({data:l.data,defaultView:n.defaultView,channelParams:n.options.channelParams})),{ref:n.options.behaviorRef?n.options.behaviorRef:void 0});n.method===`em`?u.apply(N3,{channel:`em`},{state:{isGhost:!0},tags:`em`}):(u.apply(N3,{channel:`2fo-fc`},{state:{isGhost:!0},tags:`2fo-fc`}),u.apply(N3,{channel:`fo-fc(+ve)`},{state:{isGhost:!0},tags:`fo-fc(+ve)`}),u.apply(N3,{channel:`fo-fc(-ve)`},{state:{isGhost:!0},tags:`fo-fc(-ve)`})),await t.updateTree(u).runInContext(i)})),Lrt=cE.build({display:{name:`Boxify Volume Streaming`,description:`Make the current box permanent.`},from:_4,isApplicable:e=>e.data.params.entry.params.view.name===`selection-box`})(({a:e,ref:t,state:n},r)=>{let i=e.data.params;if(i.entry.params.view.name!==`selection-box`)return;let a=$k.create(B.clone(i.entry.params.view.params.bottomLeft),B.clone(i.entry.params.view.params.topRight)),o=i.entry.params.view.params.radius;$k.expand(a,a,B.create(o,o,o));let s={...i,entry:{name:i.entry.name,params:{...i.entry.params,view:{name:`box`,params:{bottomLeft:a.min,topRight:a.max}}}}};return n.updateTree(n.build().to(t).update(s))});var Rrt={dataId:V.Text(``),source:V.MappedStatic(`x-ray`,{em:V.Group({isoValue:zP.createIsoValueParam(zP.IsoValue.relative(1))}),"x-ray":V.Group({})})},zrt=AD.BuiltIn({name:`create-volume-streaming-info`,display:{name:`Volume Streaming Info`},from:H.Molecule.Structure,to:B4,params(e){return{serverUrl:V.Text(`https://ds.litemol.org`),entries:V.ObjectList(Rrt,({dataId:e})=>e,{defaultValue:[{dataId:``,source:{name:`x-ray`,params:{}}}]})}}})({apply:({a:e,params:t},n)=>hb.create(``,async r=>{let i=[];for(let e=0,a=t.entries.length;e<a;++e){let a=t.entries[e],o=a.dataId,s=a.source.name===`em`?a.source.params.isoValue:zP.IsoValue.relative(1);await r.update(`Getting server header...`);let c=await n.fetch({url:Q0(t.serverUrl,`${a.source.name}/${o.toLocaleLowerCase()}`),type:`json`}).runInContext(r);i.push({dataId:o,kind:a.source.name,header:c,emDefaultContourLevel:s})}return new B4({serverUrl:t.serverUrl,entries:i,structure:e.data},{label:`Volume Server`,description:`${i.map(e=>e.dataId).join(`, `)}`})})}),M3=AD.BuiltIn({name:`create-volume-streaming-behavior`,display:{name:`Volume Streaming Behavior`},from:B4,to:_4,params(e){return _4.createParams({data:e&&e.data})}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||t.entry.params.view.name===`selection-box`||t.entry.params.view.name===`camera-target`||t.entry.params.view.name===`off`,apply:({a:e,params:t},n)=>hb.create(`Volume streaming`,async r=>{let i=new _4.Behavior(n,e.data);return await i.update(t),new _4(i,{label:`Volume Streaming`,description:i.getDescription()})}),update({a:e,b:t,oldParams:n,newParams:r}){return hb.create(`Update Volume Streaming`,async e=>{if(n.entry.name!==r.entry.name&&`em`in r.entry.params.channels){let{emDefaultContourLevel:e}=t.data.infoMap.get(r.entry.name);e&&(r.entry.params.channels.em.isoValue=e)}let i=await t.data.update(r)?lE.UpdateResult.Updated:lE.UpdateResult.Unchanged;return t.description=t.data.getDescription(),i})}}),N3=AD.BuiltIn({name:`create-volume-streaming-visual`,display:{name:`Volume Streaming Visual`},from:_4,to:H.Volume.Representation3D,params:{channel:V.Select(`em`,_4.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:n},r)=>hb.create(`Volume Representation`,async i=>{let a=e.data.channels[t.channel];if(!a)return Mx.Null;let o=Brt(e.data,t.channel),s=A3.BuiltIn.isosurface,c=o.type.params||{},l=s.factory({webgl:r.canvas3d?.webgl,...r.representation.volume.themes},s.getParams);l.setTheme(oq.create(r.representation.volume.themes,{volume:a.data},o));let u=n.getAncestorOfType(H.Molecule.Structure)?.data,d=u?.models.length===0?void 0:SB.get(u?.models[0]);return await l.createOrUpdate(c,a.data).runInContext(i),d&&l.setState({transform:d}),new H.Volume.Representation3D({repr:l,sourceData:a.data},{label:`${Math.round(a.isoValue.relativeValue*100)/100}  [${t.channel}]`})}),update:({a:e,b:t,newParams:n,spine:r},i)=>hb.create(`Volume Representation`,async r=>{let a=e.data.channels[n.channel];if(!a)return lE.UpdateResult.Unchanged;let o=t.data.repr.state.visible,s=Brt(e.data,n.channel),c={...t.data.repr.props,...s.type.params};return t.data.repr.setTheme(oq.create(i.representation.volume.themes,{volume:a.data},s)),await t.data.repr.createOrUpdate(c,a.data).runInContext(r),t.data.repr.setState({visible:o}),t.data.sourceData=a.data,lE.UpdateResult.Updated})});function Brt(e,t){let n=e.channels[t];return FY.getDefaultParamsStatic(e.plugin,`isosurface`,{isoValue:n.isoValue,alpha:n.opacity,visuals:n.wireframe?[`wireframe`]:[`solid`]},`uniform`,{value:n.color})}var P3=class extends het{constructor(){super(...arguments),this._getInfo=gA((e,t,n)=>w4.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef)),this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return jx.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,this.state?.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?`none`:this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return`Apply`}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(e,t){let n=e.state.transforms.get(e.nodeRef).version;if(e.nodeRef===t.ref&&n===t.version)return null;let r=e.state.cells.get(e.nodeRef).obj,i=e.action.definition.params?V.getDefaultValues(e.action.definition.params(r,t.plugin)):{};return{plugin:t.plugin,ref:e.nodeRef,version:n,params:i,isInitial:!0,error:void 0}}},Vrt=class extends YX{defaultState(){return{header:`Volume Streaming`,isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:`cyan`,svg:uX}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:C4.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{yE.hasTag(e.cell.transform,_4.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){var e;let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length!==1)return!1;let n=this.pivot.cell;return n.obj?!!(e=j3.definition).isApplicable?.call(e,n.obj,n.transform,this.plugin):!1}renderEnable(){let e=this.pivot;if(!e.cell.parent)return null;let t=FE.findTagInSubtree(e.cell.parent.tree,this.pivot.cell.transform.ref,_4.RootTag),n=t&&e.cell.parent.cells.get(t),r=n&&n.status===`error`?{header:n.errorText&&n.errorText?.includes(`404`)?`No Density Data Available`:`Error Enabling`,icon:yX,title:n.errorText}:n&&n.obj?.data.entries.length===0?{header:`Error Enabling`,icon:yX,title:`No Entry for Streaming Found`}:{header:`Enable`,icon:hX,title:`Enable`};return(0,I.jsx)(P3,{state:e.cell.parent,action:j3,initiallyCollapsed:!0,nodeRef:e.cell.transform.ref,simpleApply:r})}renderParams(){let e=this.pivot;if(!e.cell.parent)return null;let t=(e.volumeStreaming?.cell.transform.params)?.entry.params.view.name===`selection-box`&&this.plugin.state.behaviors.cells.get(i2.id)?.params?.values?.bindings;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(T4,{state:e.cell.parent,transform:e.volumeStreaming.cell.transform,customHeader:`none`,noMargin:!0}),t&&(0,I.jsx)(WX,{header:`Controls Help`,children:(0,I.jsx)(D4,{bindings:t})})]})}renderControls(){let e=this.pivot;return e?e.volumeStreaming?this.renderParams():this.renderEnable():null}},Hrt=class extends YX{constructor(){super(...arguments),this.item=e=>{let t=this.plugin.managers.volume.hierarchy.selection,n=e.cell.obj?.label||`Volume`;return{kind:`item`,label:(e.kind===`lazy-volume`?`Load `:``)+(n||e.kind),selected:t===e,value:e}},this.selectCurrent=e=>{if(this.toggleHierarchy(),!e)return;let t=e.value;t.kind===`volume`?this.plugin.managers.volume.hierarchy.setCurrent(t):this.lazyLoad(t.cell)},this.selectAdd=e=>{e&&(this.setState({show:void 0}),e.value())},this.toggleHierarchy=()=>this.setState({show:this.state.show===`hierarchy`?void 0:`hierarchy`}),this.toggleAddRepr=()=>this.setState({show:this.state.show===`add-repr`?void 0:`add-repr`}),this.toggleVisibility=()=>{let{current:e}=this.plugin.managers.volume.hierarchy,t=!(e.volumes[0]?.representations[0])?.cell.state.isHidden;this.plugin.managers.volume.hierarchy.toggleVisibility(e.volumes.flatMap(e=>e.representations),t?`hide`:`show`)}}defaultState(){return{header:`Volume`,isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:`purple`,svg:uX}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,e=>{this.setState({isHidden:e.hierarchy.volumes.length===0&&e.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get hierarchyItems(){let{current:e}=this.plugin.managers.volume.hierarchy,t=[];for(let n of e.volumes)t.push(this.item(n));for(let n of e.lazyVolumes)t.push(this.item(n));return t}get addActions(){let e=this.plugin.managers.volume.hierarchy,t=e.selection;return[...z4.getRepresentationTypes(this.plugin,t).map(n=>Y2.Item(n[1],()=>e.addRepresentation(t,n[0])))]}get isEmpty(){let{volumes:e,lazyVolumes:t}=this.plugin.managers.volume.hierarchy.current;return e.length===0&&t.length===0}get label(){if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`;let e=this.plugin.managers.volume.hierarchy.selection;return e?e?.cell.obj?.label||`Volume`:`Nothing Selected`}async lazyLoad(e){let{url:t,isBinary:n,format:r,entryId:i,isovalues:a}=e.obj.data;this.setState({isBusy:!0,loadingLabel:e.obj.label});try{let o=this.plugin;await o.dataTransaction(async()=>{let s=await o.builders.data.download({url:t,isBinary:n},{state:{isGhost:!0}}),c=await o.dataFormats.get(r).parse(o,s,{entryId:i}),l=c.volume||c.volumes[0];if(!l?.isOk)throw Error(`Failed to parse any volume.`);let u=o.build();for(let e of a)u.to(c.volumes?.[e.volumeIndex??0]??c.volume).apply(IY.Representation.VolumeRepresentation3D,I4(this.plugin,l.data,{type:`isosurface`,typeParams:{alpha:e.alpha??1,isoValue:e.type===`absolute`?{kind:`absolute`,absoluteValue:e.value}:{kind:`relative`,relativeValue:e.value}},color:`uniform`,colorParams:{value:e.color}}));await u.commit(),await o.build().delete(e).commit()})}finally{this.setState({isBusy:!1,loadingLabel:void 0})}}renderControls(){let e=this.state.isBusy||this.isEmpty,t=this.label,n=this.plugin.managers.volume.hierarchy.selection,{current:r}=this.plugin.managers.volume.hierarchy;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,style:{marginTop:`1px`},children:[(0,I.jsx)(VX,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:e,title:t,children:t}),!this.isEmpty&&n&&(0,I.jsx)(HX,{svg:aX,onClick:this.toggleAddRepr,title:`Apply a structure presets to the current hierarchy.`,toggleState:this.state.show===`add-repr`,disabled:e}),!this.isEmpty&&(0,I.jsx)(HX,{svg:PX,onClick:this.toggleVisibility,toggleState:!1,title:`Toggle visibility of all volumes.`,disabled:e})]}),this.state.show===`hierarchy`&&(0,I.jsx)(Y2,{items:this.hierarchyItems,onSelect:this.selectCurrent}),this.state.show===`add-repr`&&(0,I.jsx)(Y2,{items:this.addActions,onSelect:this.selectAdd}),r.volumes.length>0&&(0,I.jsx)(`div`,{style:{marginTop:`6px`},children:r.volumes.map(e=>(0,I.jsx)(Urt,{volume:e},e.cell.transform.ref))})]})}};function Urt({volume:e}){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,style:{marginTop:`1px`},children:(0,I.jsx)(`div`,{children:(0,I.jsx)(`b`,{children:e.cell.obj?.label??`n/a`})})}),e.representations.map(t=>(0,I.jsx)(Wrt,{volume:e,representation:t},t.cell.transform.ref))]})}var Wrt=class extends JX{constructor(){super(...arguments),this.state={action:void 0},this.updateIsoValueEvent=new sD,this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0),this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])},this.toggleColor=()=>{this.setState({action:this.state.action===`select-color`?void 0:`select-color`})},this.toggleUpdate=()=>this.setState({action:this.state.action===`update`?void 0:`update`}),this.highlight=e=>{e.preventDefault(),this.props.representation.cell.parent&&jx.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})},this.clearHighlight=e=>{e.preventDefault(),jx.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{let e=this.props.representation,t=e.cell.obj?.data.repr.getAllLoci();e.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],`show`),t&&this.plugin.managers.camera.focusLoci(t,{extraRadius:1})},this.updateColor=({value:e})=>{let t=this.props.representation.cell.transform;return this.plugin.build().to(t.ref).update({...t.params,colorTheme:{name:`uniform`,params:{value:e}}}).commit()},this.requestIsoValueUpdate=e=>{this.updateIsoValueEvent.next(e)},this.updateIsoValue=e=>{let t=this.props.representation.cell.transform;return this.plugin.build().to(t.ref).update({...t.params,type:{...t.params?.type,params:{...t.params?.type.params,isoValue:e.isoValue}}}).commit()},this.isoValueParams=gA((e,t)=>{let n=this.props.representation.cell.transform.params;if(n?.type.name===`isosurface`)return{isoValue:zP.createIsoValueParam(n.type.params.isoValue,this.props.volume.cell.obj?.data.grid?.stats)}})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{wD.ObjectEvent.isCell(e,this.props.representation.cell)&&this.forceUpdate()}),this.subscribe(this.updateIsoValueEvent.pipe(gD(100,void 0,{leading:!1,trailing:!0})),this.updateIsoValue)}get color(){let e=this.props.representation.cell;if(e.transform.params?.colorTheme.name===`uniform`)return e.transform.params?.colorTheme.params.value}get isIsoSurface(){return this.props.representation.cell.transform.params?.type.name===`isosurface`}render(){let e=this.props.representation.cell,t=e.transform.params,n=this.color,r=this.isoValueParams(e.transform.ref,t?.type.name);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[n!==void 0&&(0,I.jsx)(VX,{style:{backgroundColor:tE.toStyle(n),minWidth:32,width:32},onClick:this.toggleColor}),(0,I.jsxs)(VX,{noOverflow:!0,className:`msp-control-button-label`,title:`${e.obj?.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:`left`},children:[e.obj?.label,(0,I.jsx)(`small`,{className:`msp-25-lower-contrast-text`,style:{float:`right`},children:e.obj?.description})]}),(0,I.jsx)(HX,{svg:e.state.isHidden?NX:PX,toggleState:!1,onClick:this.toggleVisible,title:`${e.state.isHidden?`Show`:`Hide`} component`,small:!0,className:`msp-form-control`,flex:!0}),(0,I.jsx)(HX,{svg:vX,onClick:this.remove,title:`Remove`,small:!0}),(0,I.jsx)(HX,{svg:CX,onClick:this.toggleUpdate,title:`Actions`,toggleState:this.state.action===`update`})]}),this.state.action===`update`&&!!e.parent&&(0,I.jsx)(`div`,{style:{marginBottom:`6px`},className:`msp-accent-offset`,children:(0,I.jsxs)(`div`,{children:[!!r&&(0,I.jsx)(`div`,{style:{marginBottom:`1px`},children:(0,I.jsx)(a4,{params:r,values:{isoValue:t?.type.params.isoValue},onChangeValues:this.requestIsoValueUpdate})}),(0,I.jsx)(T4,{state:e.parent,transform:e.transform,customHeader:`none`,noMargin:!0})]})}),this.state.action===`select-color`&&n!==void 0&&(0,I.jsx)(`div`,{style:{marginBottom:`6px`,marginTop:1},className:`msp-accent-offset`,children:(0,I.jsx)(LX,{header:`Select Color`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:_X,noTopMargin:!0,childrenClassName:`msp-viewport-controls-panel-controls`,children:(0,I.jsx)(O7e,{param:Grt,value:this.color,onChange:this.updateColor,name:`color`,hideNameRow:!0})})})]})}},Grt=V.Color(tE(1184274)),F3;(function(e){function t(e){return{size:e,matrix:Xk.create(e,e),eigenValues:new Float64Array(e),D:new Float64Array(e),E:new Float64Array(e)}}e.createCache=t;function n(e){Krt(e.size,e.matrix.data,e.eigenValues,e.D,e.E)}e.compute=n})(F3||={});function Krt(e,t,n,r,i){for(let t=0;t<e;t++)i[t]=0;let a=e-1;for(let n=0;n<e;n++)r[n]=t[n*e+a];qrt(t,r,i,e),Jrt(t,r,i,e);for(let t=0;t<e;t++)n[t]=r[t]}function qrt(e,t,n,r){for(let i=r-1;i>0;i--){let a=0,o=0;for(let e=0;e<i;e++)a+=Math.abs(t[e]);if(a===0){n[i]=t[i-1];for(let n=0;n<i;n++)t[n]=e[n*r+i-1],e[n*r+i]=0,e[i*r+n]=0}else{for(let e=0;e<i;e++)t[e]/=a,o+=t[e]*t[e];let s=t[i-1],c=Math.sqrt(o);s>0&&(c=-c),n[i]=a*c,o-=s*c,t[i-1]=s-c;for(let e=0;e<i;e++)n[e]=0;for(let a=0;a<i;a++){s=t[a],e[i*r+a]=s,c=n[a]+e[a*r+a]*s;for(let o=a+1;o<=i-1;o++)c+=e[a*r+o]*t[o],n[o]+=e[a*r+o]*s;n[a]=c}s=0;for(let e=0;e<i;e++)n[e]/=o,s+=n[e]*t[e];let l=s/(o+o);for(let e=0;e<i;e++)n[e]-=l*t[e];for(let a=0;a<i;a++){s=t[a],c=n[a];for(let o=a;o<=i-1;o++)e[a*r+o]-=s*n[o]+c*t[o];t[a]=e[a*r+i-1],e[a*r+i]=0}}t[i]=o}for(let n=0;n<r-1;n++){e[n*r+r-1]=e[n*r+n],e[n*r+n]=1;let i=t[n+1];if(i!==0){for(let a=0;a<=n;a++)t[a]=e[(n+1)*r+a]/i;for(let i=0;i<=n;i++){let a=0;for(let t=0;t<=n;t++)a+=e[(n+1)*r+t]*e[i*r+t];for(let o=0;o<=n;o++)e[i*r+o]-=a*t[o]}}for(let t=0;t<=n;t++)e[(n+1)*r+t]=0}for(let n=0;n<r;n++)t[n]=e[n*r+r-1],e[n*r+r-1]=0;e[r*r-1]=1,n[0]=0}function Jrt(e,t,n,r){for(let e=1;e<r;e++)n[e-1]=n[e];n[r-1]=0;let i=0,a=0,o=2**-53;for(let s=0;s<r;s++){a=Math.max(a,Math.abs(t[s])+Math.abs(n[s]));let c=s;for(;c<r&&!(Math.abs(n[c])<=o*a);)c++;if(c>s){let l=0;do{l+=1;let a=t[s],o=(t[s+1]-a)/(2*n[s]),u=Yrt(o,1);o<0&&(u=-u),t[s]=n[s]/(o+u),t[s+1]=n[s]*(o+u);let d=t[s+1],f=a-t[s];for(let e=s+2;e<r;e++)t[e]-=f;i+=f,o=t[c];let p=1,m=p,h=p,g=n[s+1],_=0,v=0;for(let i=c-1;i>=s;i--){h=m,m=p,v=_,a=p*n[i],f=p*o,u=Yrt(o,n[i]),n[i+1]=_*u,_=n[i]/u,p=o/u,o=p*t[i]-_*a,t[i+1]=f+_*(p*a+_*t[i]);for(let t=0;t<r;t++)f=e[(i+1)*r+t],e[(i+1)*r+t]=_*e[i*r+t]+p*f,e[i*r+t]=p*e[i*r+t]-_*f}if(o=-_*v*h*g*n[s]/d,n[s]=_*o,t[s]=p*o,l>=1e3)throw Error(`SVD: Not converging.`)}while(Math.abs(n[s])>o*a)}t[s]=t[s]+i,n[s]=0}for(let n=0;n<r-1;n++){let i=n,a=t[n];for(let e=n+1;e<r;e++)t[e]<a&&(i=e,a=t[e]);if(i!==n){t[i]=t[n],t[n]=a;for(let t=0;t<r;t++)a=e[n*r+t],e[n*r+t]=e[i*r+t],e[i*r+t]=a}}}function Yrt(e,t){if(Math.abs(e)>Math.abs(t)){let n=t/e;return Math.abs(e)*Math.sqrt(1+n*n)}if(t!==0){let n=e/t;return Math.abs(t)*Math.sqrt(1+n*n)}return 0}var I3;(function(e){(function(e){function t(e){return{x:new Float64Array(e),y:new Float64Array(e),z:new Float64Array(e)}}e.empty=t})(e.Positions||={});function t(e,t){return t??={bTransform:z.zero(),rmsd:0,nAlignedElements:0},$rt(new Xrt(e,t)),t}e.compute=t})(I3||={});var Xrt=class{constructor(e,t){this.evdCache=F3.createCache(4),this.translateB=z.identity(),this.rotateB=z.identity(),this.tempMatrix=z.identity(),this.a=e.a,this.b=e.b,e.centerA?this.centerA=e.centerA:this.centerA=e.centerA=FA.fromArrays(e.a,q()).center,e.centerB?this.centerB=e.centerB:this.centerB=e.centerB=FA.fromArrays(e.b,q()).center,this.result=t}};function Zrt(e){let t=e.evdCache.matrix;Xk.makeZero(t);let n=e.a.x,r=e.a.y,i=e.a.z,a=e.b.x,o=e.b.y,s=e.b.z,c=e.centerA,l=e.centerB,u=0,d=Math.min(e.a.x.length,e.b.x.length);for(let e=0;e<d;e++){let d=n[e]-c[0],f=r[e]-c[1],p=i[e]-c[2],m=a[e]-l[0],h=o[e]-l[1],g=s[e]-l[2];u+=d*d+f*f+p*p+m*m+h*h+g*g,Xk.add(t,0,0,d*m+f*h+p*g),Xk.add(t,0,1,-(p*h)+f*g),Xk.add(t,0,2,p*m-d*g),Xk.add(t,0,3,-(f*m)+d*h),Xk.add(t,1,0,-(p*h)+f*g),Xk.add(t,1,1,d*m-f*h-p*g),Xk.add(t,1,2,f*m+d*h),Xk.add(t,1,3,p*m+d*g),Xk.add(t,2,0,p*m-d*g),Xk.add(t,2,1,f*m+d*h),Xk.add(t,2,2,-(d*m)+f*h-p*g),Xk.add(t,2,3,p*h+f*g),Xk.add(t,3,0,-(f*m)+d*h),Xk.add(t,3,1,p*m+d*g),Xk.add(t,3,2,p*h+f*g),Xk.add(t,3,3,-(d*m)-f*h+p*g)}return u}function Qrt(e){let t=e.evdCache.matrix,n=Xk.get(t,1,3),r=Xk.get(t,2,3),i=Xk.get(t,3,3),a=Xk.get(t,0,3),o=2*r*r,s=2*i*i,c=2*n*n,l=2*n*r,u=2*a*i,d=2*n*i,f=2*a*r,p=2*r*i,m=2*a*n,h=e.translateB;z.setValue(h,0,3,-e.centerB[0]),z.setValue(h,1,3,-e.centerB[1]),z.setValue(h,2,3,-e.centerB[2]),h=e.rotateB,z.setValue(h,0,0,1-o-s),z.setValue(h,0,1,l+u),z.setValue(h,0,2,d-f),z.setValue(h,1,0,l-u),z.setValue(h,1,1,1-c-s),z.setValue(h,1,2,p+m),z.setValue(h,2,0,d+f),z.setValue(h,2,1,p-m),z.setValue(h,2,2,1-c-o),z.setValue(h,3,3,1),z.mul(e.tempMatrix,e.rotateB,e.translateB),h=e.translateB,z.setValue(h,0,3,e.centerA[0]),z.setValue(h,1,3,e.centerA[1]),z.setValue(h,2,3,e.centerA[2]),z.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function $rt(e){let t=Zrt(e);F3.compute(e.evdCache);let n=t-2*e.evdCache.eigenValues[3];n=n<0?0:Math.sqrt(n/e.a.x.length),Qrt(e),e.result.rmsd=n,e.result.nAlignedElements=e.a.x.length}var eit=`ACDEFGHIKLMNPQRSTVWY`,tit=`ARNDCQEGHILKMFPSTWYVBZX`,nit=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],rit=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function iit(e,t){let n,r=0,i={};return t.forEach(t=>{n=0;let a={};t.forEach(t=>a[e[n++]]=t),i[e[r++]]=a}),i}const ait=(()=>({blosum62:iit(tit,rit),blosum62x:iit(eit,nit)}))();var oit={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:`default`};function sit(e,t,n={}){let r=new cit(e,t,{...oit,...n});return r.calculate(),r.trace()}var cit=class{constructor(e,t,n){this.seqA=e,this.seqB=t,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix===`default`?void 0:ait[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){let{n:e,m:t,gapPenalty:n,S:r,V:i,H:a}=this;for(let n=0;n<=e;++n){r[n]=[],i[n]=[],a[n]=[];for(let e=0;e<=t;++e)r[n][e]=0,i[n][e]=0,a[n][e]=0}for(let t=0;t<=e;++t)r[t][0]=n,a[t][0]=-1/0;for(let e=0;e<=t;++e)r[0][e]=n,i[0][e]=-1/0;r[0][0]=0}makeScoreFn(){let{seqA:e,seqB:t,substMatrix:n}=this;return n?function(r,i){let a=e[r],o=t[i];return n[a]?.[o]??-4}:function(n,r){return e[n]===t[r]?5:-3}}calculate(){this.initMatrices();let e=this.makeScoreFn(),{V:t,H:n,S:r,n:i,m:a,gapExtensionPenalty:o,gapPenalty:s}=this,c,l,u,d,f;for(let p=1;p<=i;++p){l=r[p-1],c=t[p-1],u=t[p],d=n[p],f=r[p];for(let t=1;t<=a;++t)u[t]=Math.max(l[t]+s,c[t]+o),d[t]=Math.max(f[t-1]+s,d[t-1]+o),f[t]=Math.max(l[t-1]+e(p-1,t-1),u[t],d[t])}}trace(){let e=this.makeScoreFn(),{V:t,H:n,S:r,seqA:i,seqB:a,gapExtensionPenalty:o,gapPenalty:s}=this,c=this.n,l=this.m,u,d,f=``,p=``;for(r[c][l]>=t[c][l]?(u=`S`,d=r[c][l]):t[c][l]>=n[c][l]?(u=`V`,d=t[c][l]):(u=`H`,d=n[c][l]);c>0&&l>0;)u===`S`?r[c][l]===r[c-1][l-1]+e(c-1,l-1)?(f=i[c-1]+f,p=a[l-1]+p,--c,--l,u=`S`):r[c][l]===t[c][l]?u=`V`:r[c][l]===n[c][l]?u=`H`:(--c,--l):u===`V`?t[c][l]===t[c-1][l]+o?(f=i[c-1]+f,p=`-`+p,--c,u=`V`):t[c][l]===r[c-1][l]+s?(f=i[c-1]+f,p=`-`+p,--c,u=`S`):--c:u===`H`&&(n[c][l]===n[c][l-1]+o?(f=`-`+f,p=a[l-1]+p,--l,u=`H`):n[c][l]===r[c][l-1]+s?(f=`-`+f,p=a[l-1]+p,--l,u=`S`):--l);for(;c>0;)f=i[c-1]+f,p=`-`+p,--c;for(;l>0;)f=`-`+f,p=a[l-1]+p,--l;return{aliA:f,aliB:p,score:d}}},lit;(function(e){function t(e){let t=new Map;if(Q.isAtomic(e.unit)){let{label_seq_id:n}=e.unit.model.atomicHierarchy.residues,{residueIndex:r}=e.unit;for(let i=0,a=K.size(e.indices);i<a;++i){let a=K.getAt(e.indices,i),o=e.unit.elements[a],s=n.value(r[o]);t.has(s)?t.get(s).push(a):t.set(s,[a])}}else if(Q.isCoarse(e.unit)){let{seq_id_begin:n}=Q.isSpheres(e.unit)?e.unit.model.coarseHierarchy.spheres:e.unit.model.coarseHierarchy.gaussians;for(let r=0,i=K.size(e.indices);r<i;++r){let i=K.getAt(e.indices,r),a=e.unit.elements[i],o=n.value(a);t.set(o,[i])}}return t}e.createSeqIdIndicesMap=t;function n(e,n={}){let r=dit(e.a.unit),i=dit(e.b.unit),a=t(e.a),o=t(e.b),s=[],c=[],{aliA:l,aliB:u,score:d}=sit(r.code.toArray(),i.code.toArray(),n),f=0,p=0;for(let e=0,t=l.length;e<t;++e){if(l[e]===`-`||u[e]===`-`){l[e]!==`-`&&(f+=1),u[e]!==`-`&&(p+=1);continue}let t=r.seqId.value(f),n=i.seqId.value(p);if(a.has(t)&&o.has(n)){let e=a.get(t),r=o.get(n);for(let t=0,n=Math.min(e.length,r.length);t<n;++t)s.push(e[t]),c.push(r[t])}f+=1,p+=1}let m=K.intersect(K.ofSortedArray(s),e.a.indices),h=K.intersect(K.ofSortedArray(c),e.b.indices);return{a:{unit:e.a.unit,indices:m},b:{unit:e.b.unit,indices:h},score:d}}e.compute=n})(lit||={});function uit(e){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case Q.Kind.Spheres:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case Q.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function dit(e){return e.model.sequence.byEntityKey[uit(e)].sequence}function fit(e){let t=[];if(e.length<=0)return t;let n=hit(e),r={a:L3(e[0],n),b:L3(e[1],n)};t[0]=I3.compute(r);for(let i=2;i<e.length;i++)r.b=L3(e[i],n),r.centerB=void 0,t.push(I3.compute(r));return t}var pit=/(polypeptide|cyclic-pseudo-peptide)/i;function mit(e){let t=[];if(e.length<=0)return t;let n=$.getFirstLocation(e[0]),r=Pz.entity.subtype(n).match(pit)?`blosum62`:`default`;for(let n=1;n<e.length;n++){let{a:i,b:a,score:o}=lit.compute({a:e[0].elements[0],b:e[n].elements[0]},{substMatrix:r}),s=$(e[0].structure,[i]),c=$(e[n].structure,[a]),l=K.size(i.indices);t.push({...I3.compute({a:L3(s,l),b:L3(c,l)}),alignmentScore:o})}return t}function L3(e,t){let n=I3.Positions.empty(t),r=0;for(let i of e.elements){let{unit:e,indices:a}=i,{elements:o,conformation:s}=e;for(let e=0,i=K.size(a);e<i;e++){let i=o[K.getAt(a,e)];if(n.x[r]=s.x(i),n.y[r]=s.y(i),n.z[r]=s.z(i),r++,r>=t)break}if(r>=t)break}return n}function hit(e){if(e.length===0)return 0;let t=$.size(e[0]);for(let n=1;n<e.length;n++){let r=$.size(e[n]);r<t&&(t=r)}return t}function git(e,t){let n=new Map;for(let r=0;r<e.length;r++)bit(e[r],n,r,t?.traceOnly??!0,t?.includeResidueTest??yit);let r=Array.from(n.values()),i=vit(e.length,r),a=[],o=[],s=[];for(let e of i)if(e.count===0)a.push([e.i,e.j]);else{let[t,n]=_it(r,e.i,e.j,e.count),i=I3.compute({a:t,b:n});Number.isNaN(i.rmsd)?o.push([e.i,e.j]):s.push({transform:i,pivot:e.i,other:e.j})}return{entries:s,zeroOverlapPairs:a,failedPairs:o}}function _it(e,t,n,r){let i=I3.Positions.empty(r),a=I3.Positions.empty(r),o=0;for(let{pivots:r}of e){let e=r[t],s=r[n];if(!e||!s)continue;let c=Math.min(e[2]-e[1],s[2]-s[1]);for(let t=0;t<c;t++){let n=e[1]+t;i.x[o]=e[0].conformation.x(n),i.y[o]=e[0].conformation.y(n),i.z[o]=e[0].conformation.z(n),n=s[1]+t,a.x[o]=s[0].conformation.x(n),a.y[o]=s[0].conformation.y(n),a.z[o]=s[0].conformation.z(n),o++}}return[i,a]}function vit(e,t){let n=[];for(let t=0;t<e;t++){n[t]=[];for(let r=0;r<e;r++)n[t][r]=0}for(let{pivots:r}of t)for(let t=0;t<e;t++){if(!r[t])continue;let i=r[t][2]-r[t][1];for(let a=t+1;a<e;a++){if(!r[a])continue;let e=r[a][2]-r[a][1];n[t][a]=n[t][a]+Math.min(i,e)}}let r=[];for(let t=1;t<e;t++)r[t-1]={i:0,j:t,count:n[0][t]};return r}function yit(){return!0}function bit(e,t,n,r,i){let a=iL.create(e);for(let o of e.units){if(o.kind!==Q.Kind.Atomic)continue;let{elements:e,model:s}=o;a.unit=o;let c=fB.Provider.get(s).value;if(!c)return;let{dbName:l,accession:u,num:d}=c,f=uA.transientSegments(o.model.atomicHierarchy.chainAtomSegments,e),p=uA.transientSegments(o.model.atomicHierarchy.residueAtomSegments,e),m=o.model.atomicHierarchy.derived.residue.traceElementIndex;for(;f.hasNext;){let s=f.move();for(p.setSegment(s);p.hasNext;){let s=p.move(),c=s.index;if(!l[c])continue;let f=m[c],h,g;if(r){if(h=f,h===-1)continue;g=h+1}else h=e[s.start],g=e[s.end-1]+1;if(a.element=f>=0?f:h,!i(a,c,h,g))continue;let _=`${l[c]}-${u[c]}-${d[c]}`;if(!t.has(_))t.set(_,{key:_,pivots:{[n]:[o,h,g]}});else{let e=t.get(_);e.pivots[n]||(e.pivots[n]=[o,h,g])}}}}}var xit=class extends YX{defaultState(){return{isCollapsed:!1,header:`Superposition`,brand:{accent:`gray`,svg:zGe},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{this.setState({isHidden:e.structures.length<2})})}renderControls(){return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(Tit,{})})}};const Sit={alignSequences:V.Boolean(!0,{isEssential:!0,description:`For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition.`}),traceOnly:V.Boolean(!0,{description:`For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms.`})};var Cit=V.getDefaultValues(Sit),wit=`SuperpositionTransform`,Tit=class extends JX{constructor(){super(...arguments),this.state={isBusy:!1,canUseDb:!1,action:void 0,options:Cit},this.superposeChains=async()=>{let{query:e}=this.state.options.traceOnly?aU.trace:aU.polymer,t=this.chainEntries,n=t.map(t=>{let n=$.toStructure(t.loci),r=VR.toLociWithSourceUnits(e(new ZR(n)));return $.remap(r,this.getRootStructure(t.loci.structure))}),r=((this.plugin.managers.structure.hierarchy.findStructure(n[0]?.structure)?.transform)?.cell.obj)?.data.coordinateSystem,i=this.state.options.alignSequences?mit(n):fit(n),a=t[0];for(let e=1,o=n.length;e<o;++e){let n=t[e],{bTransform:o,rmsd:s}=i[e-1];await this.transform(n.cell,o,r);let c=YT(a.label),l=YT(n.label);this.plugin.log.info(`Superposed [${c}] and [${l}] with RMSD ${s.toFixed(2)}.`)}await this.cameraReset()},this.superposeAtoms=async()=>{let e=this.atomEntries,t=e.map(e=>$.remap(e.loci,this.getRootStructure(e.loci.structure))),n=fit(t),r=((this.plugin.managers.structure.hierarchy.findStructure(t[0]?.structure)?.transform)?.cell.obj)?.data.coordinateSystem,i=e[0];for(let a=1,o=t.length;a<o;++a){let t=e[a],{bTransform:o,rmsd:s}=n[a-1];await this.transform(t.cell,o,r);let c=YT(i.label),l=YT(t.label),u=e[a].atoms.length;this.plugin.log.info(`Superposed ${u} ${u===1?`atom`:`atoms`} of [${c}] and [${l}] with RMSD ${s.toFixed(2)}.`)}await this.cameraReset()},this.superposeDb=async()=>{let e=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,t=this.state.options.traceOnly,n=e.map(e=>e.cell.obj?.data),{entries:r,failedPairs:i,zeroOverlapPairs:a}=git(n,{traceOnly:t}),o=((e[0]?.transform)?.cell.obj)?.data.coordinateSystem,s=0;for(let t of r)await this.transform(e[t.other].cell,t.transform.bTransform,o),s+=t.transform.rmsd;s/=Math.max(r.length-1,1);let c=e=>`[${e.map(([e,t])=>`(${n[e].models[0].entryId}, ${n[t].models[0].entryId})`).join(`, `)}]`;a.length&&this.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${c(a)}.`),i.length&&this.plugin.log.error(`Superposition: Failed to superpose structures ${c(i)}.`),r.length&&(this.plugin.log.info(`Superposed ${r.length+1} structures with avg. RMSD ${s.toFixed(2)} .`),await this.cameraReset())},this.toggleByChains=()=>this.setState({action:this.state.action===`byChains`?void 0:`byChains`}),this.toggleByAtoms=()=>this.setState({action:this.state.action===`byAtoms`?void 0:`byAtoms`}),this.toggleOptions=()=>this.setState({action:this.state.action===`options`?void 0:`options`}),this.setOptions=e=>{this.setState({options:e})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{this.setState({canUseDb:e.structures.every(e=>!!e.cell.obj?.data&&e.cell.obj.data.models.some(e=>fB.Provider.isApplicable(e)))})})}get selection(){return this.plugin.managers.structure.selection}async transform(e,t,n){let r=Fx.resolveAndCheck(this.plugin.state.data,e);if(!r)return;let i=this.plugin.state.data.selectQ(e=>e.byRef(r.transform.ref).subtree().withTransformer(IY.Model.TransformStructureConformation))[0],a={transform:{name:`matrix`,params:{data:n&&!z.isIdentity(n.matrix)?z.mul(z(),n.matrix,t):t,transpose:!1}}},o=i?this.plugin.state.data.build().to(i).update(a):this.plugin.state.data.build().to(e).insert(IY.Model.TransformStructureConformation,a,{tags:wit});await this.plugin.runTask(this.plugin.state.data.updateTree(o))}getRootStructure(e){let t=this.plugin.helpers.substructureParent.get(e);return this.plugin.state.data.selectQ(e=>e.byValue(t).rootOfType(H.Molecule.Structure))[0].obj?.data}async cameraReset(){await new Promise(e=>requestAnimationFrame(e)),jx.Camera.Reset(this.plugin)}highlight(e){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e},!1)}moveHistory(e,t){this.plugin.managers.structure.selection.modifyHistory(e,t,void 0,!0)}focusLoci(e){this.plugin.managers.camera.focusLoci(e)}lociEntry(e,t){return(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{noOverflow:!0,title:`Click to focus. Hover to highlight.`,onClick:()=>this.focusLoci(e.loci),style:{width:`auto`,textAlign:`left`},onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,I.jsx)(`span`,{dangerouslySetInnerHTML:{__html:e.label}})})},t)}historyEntry(e,t){let n=this.plugin.managers.structure.selection.additionsHistory;return(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsxs)(VX,{noOverflow:!0,title:`Click to focus. Hover to highlight.`,onClick:()=>this.focusLoci(e.loci),style:{width:`auto`,textAlign:`left`},onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[t,`. `,(0,I.jsx)(`span`,{dangerouslySetInnerHTML:{__html:e.label}})]}),n.length>1&&(0,I.jsx)(HX,{svg:lX,small:!0,className:`msp-form-control`,onClick:()=>this.moveHistory(e,`up`),flex:`20px`,title:`Move up`}),n.length>1&&(0,I.jsx)(HX,{svg:oX,small:!0,className:`msp-form-control`,onClick:()=>this.moveHistory(e,`down`),flex:`20px`,title:`Move down`}),(0,I.jsx)(HX,{svg:vX,small:!0,className:`msp-form-control`,onClick:()=>this.plugin.managers.structure.selection.modifyHistory(e,`remove`),flex:!0,title:`Remove`})]},e.id)}atomsLociEntry(e,t){return(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsx)(`div`,{className:`msp-no-overflow`,title:e.label,children:e.label})}),(0,I.jsx)(`div`,{className:`msp-control-offset`,children:e.atoms.map((e,t)=>this.historyEntry(e,t))})]},t)}get chainEntries(){let e=iL.create(),t=[];return this.plugin.managers.structure.selection.entries.forEach(({selection:n},r)=>{let i=Fx.resolveAndCheck(this.plugin.state.data,r);if(!i||$.isEmpty(n))return;let a=$.getFirstLocation(n,e);if(n.elements.length>1||Pz.entity.type(a)!==`polymer`)return;let o=MJ(uB.ofLoci(n),{countsOnly:!0}),s=IJ(a,{reverse:!0,granularity:`chain`}).split(`|`),c=`${o} | ${s[0]} | ${s[s.length-1]}`;t.push({loci:n,label:c,cell:i})}),t}get atomEntries(){let e=new Map,t=this.plugin.managers.structure.selection.additionsHistory;for(let n=0,r=t.length;n<r;++n){let r=t[n];if($.size(r.loci)!==1)continue;let i=r.loci.structure;e.has(i)?e.get(i).push(r):e.set(i,[r])}let n=[];return e.forEach((e,t)=>{let r=this.plugin.helpers.substructureParent.get(t),i=[];for(let t=0,n=e.length;t<n;++t)i.push(e[t].loci.elements[0]);let a=$(e[0].loci.structure,i),o=a.structure.label.split(` | `)[0];n.push({loci:a,label:o,cell:r,atoms:e})}),n}toggleHint(){return this.plugin.config.get(WQ.Viewport.ShowSelectionMode)?(0,I.jsxs)(I.Fragment,{children:[` `,`(toggle `,(0,I.jsx)(M4,{inline:!0}),` mode)`]}):null}addByChains(){let e=this.chainEntries;return(0,I.jsxs)(I.Fragment,{children:[e.length>0&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:e.map((e,t)=>this.lociEntry(e,t))}),e.length<2&&(0,I.jsx)(`div`,{className:`msp-control-offset msp-help-text`,children:(0,I.jsxs)(`div`,{className:`msp-help-description`,children:[(0,I.jsx)(XY,{svg:xX,inline:!0}),`Add 2 or more selections`,this.toggleHint(),` from separate structures. Selections must be limited to single polymer chains or residues therein.`]})}),e.length>1&&(0,I.jsx)(VX,{title:`Superpose structures by selected chains.`,className:`msp-btn-commit msp-btn-commit-on`,onClick:this.superposeChains,style:{marginTop:`1px`},children:`Superpose`})]})}addByAtoms(){let e=this.atomEntries;return(0,I.jsxs)(I.Fragment,{children:[e.length>0&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:e.map((e,t)=>this.atomsLociEntry(e,t))}),e.length<2&&(0,I.jsx)(`div`,{className:`msp-control-offset msp-help-text`,children:(0,I.jsxs)(`div`,{className:`msp-help-description`,children:[(0,I.jsx)(XY,{svg:xX,inline:!0}),`Add 1 or more selections`,this.toggleHint(),` from separate structures. Selections must be limited to single atoms.`]})}),e.length>1&&(0,I.jsx)(VX,{title:`Superpose structures by selected atoms.`,className:`msp-btn-commit msp-btn-commit-on`,onClick:this.superposeAtoms,style:{marginTop:`1px`},children:`Superpose`})]})}superposeByDbMapping(){return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(VX,{icon:IX,title:`Superpose structures using intersection of residues from SIFTS UNIPROT mapping.`,className:`msp-btn msp-btn-block`,onClick:this.superposeDb,style:{marginTop:`1px`},disabled:this.state.isBusy,children:`Uniprot`})})}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(UX,{icon:IX,label:`Chains`,toggle:this.toggleByChains,isSelected:this.state.action===`byChains`,disabled:this.state.isBusy}),(0,I.jsx)(UX,{icon:RGe,label:`Atoms`,toggle:this.toggleByAtoms,isSelected:this.state.action===`byAtoms`,disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,I.jsx)(UX,{icon:MX,label:``,title:`Options`,toggle:this.toggleOptions,isSelected:this.state.action===`options`,disabled:this.state.isBusy,style:{flex:`0 0 40px`,padding:0}})]}),this.state.action===`byChains`&&this.addByChains(),this.state.action===`byAtoms`&&this.addByAtoms(),this.state.action===`options`&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(a4,{params:Sit,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}},Eit=class extends YX{defaultState(){return{isCollapsed:!1,header:`Quick Styles`,brand:{accent:`gray`,svg:cWe}}}renderControls(){return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(Dit,{})})}},Dit=class extends JX{constructor(){super(...arguments),this.state={busy:!1,style:`default`}}async applyRepresentation(e){this.setState({busy:!0}),await kit(this.plugin,e),await Ait(this.plugin,this.state.style),this.setState({busy:!1})}async applyStyle(e){this.setState({busy:!0}),await Ait(this.plugin,e),this.setState({busy:!1,style:e})}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Oit,{title:`Apply Representation`,children:(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{title:`Applies default representation preset (depends on structure size)`,onClick:()=>this.applyRepresentation(`default`),disabled:this.state.busy,children:`Default`}),(0,I.jsx)(VX,{title:`Applies cartoon polymer and ball-and-stick ligand representation preset`,onClick:()=>this.applyRepresentation(`cartoon`),disabled:this.state.busy,children:`Cartoon`}),(0,I.jsx)(VX,{title:`Applies spacefill representation preset`,onClick:()=>this.applyRepresentation(`spacefill`),disabled:this.state.busy,children:`Spacefill`}),(0,I.jsx)(VX,{title:`Applies molecular surface representation preset`,onClick:()=>this.applyRepresentation(`surface`),disabled:this.state.busy,children:`Surface`})]})}),(0,I.jsx)(Oit,{title:`Apply Style`,children:(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{title:`Applies default appearance (no outline, no ignore-light)`,onClick:()=>this.applyStyle(`default`),disabled:this.state.busy,children:`Default`}),(0,I.jsx)(VX,{title:`Applies illustrative appearance (outline, ignore-light)`,onClick:()=>this.applyStyle(`illustrative`),disabled:this.state.busy,children:`Illustrative`})]})})]})}};function Oit(e){return(0,I.jsxs)(`div`,{className:`msp-control-group-wrapper`,children:[(0,I.jsx)(`div`,{className:`msp-control-group-header`,children:(0,I.jsx)(`div`,{children:(0,I.jsx)(`b`,{children:e.title})})}),e.children]})}async function kit(e,t){let{structures:n}=e.managers.structure.hierarchy.selection;switch(t){case`default`:let t=e.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id,r=e.builders.structure.representation.resolveProvider(t);await e.managers.structure.component.applyPreset(n,r);break;case`spacefill`:await e.managers.structure.component.applyPreset(n,I2.illustrative);break;case`cartoon`:await e.managers.structure.component.applyPreset(n,I2[`polymer-and-ligand`]);break;case`surface`:await e.managers.structure.component.applyPreset(n,I2[`molecular-surface`]);break}}async function Ait(e,t){if(t===`default`&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!1}),e.canvas3d)){let t=V.getDefaultValues(T0);e.canvas3d.setProps({postprocessing:{outline:t.outline,occlusion:t.occlusion,shadow:t.shadow}})}if(t===`illustrative`&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!0}),e.canvas3d)){let t=e.canvas3d.props.postprocessing;e.canvas3d.setProps({postprocessing:{outline:{name:`on`,params:t.outline.name===`on`?t.outline.params:{scale:1,color:tE(0),threshold:.33,includeTransparent:!0}},occlusion:{name:`on`,params:t.occlusion.name===`on`?t.occlusion.params:{multiScale:{name:`off`,params:{}},radius:5,bias:.8,blurKernelSize:15,blurDepthBias:.5,samples:32,resolutionScale:1,color:tE(0),transparentThreshold:.4}},shadow:{name:`off`,params:{}}}})}}function jit(e,t){let n=String(e);if(typeof t!=`string`)throw TypeError(`Expected character`);let r=0,i=n.indexOf(t);for(;i!==-1;)r++,i=n.indexOf(t,i+t.length);return r}function Mit(e){if(typeof e!=`string`)throw TypeError(`Expected a string`);return e.replace(/[|\\{}()[\]^$+*?.]/g,`\\$&`).replace(/-/g,`\\x2d`)}function Nit(e,t,n){let r=DQ((n||{}).ignore||[]),i=Pit(t),a=-1;for(;++a<i.length;)WYe(e,`text`,o);function o(e,t){let n=-1,i;for(;++n<t.length;){let e=t[n],a=i?i.children:void 0;if(r(e,a?a.indexOf(e):void 0,i))return;i=e}if(i)return s(e,t)}function s(e,t){let n=t[t.length-1],r=i[a][0],o=i[a][1],s=0,c=n.children.indexOf(e),l=!1,u=[];r.lastIndex=0;let d=r.exec(e.value);for(;d;){let n=d.index,i={index:d.index,input:d.input,stack:[...t,e]},a=o(...d,i);if(typeof a==`string`&&(a=a.length>0?{type:`text`,value:a}:void 0),a===!1?r.lastIndex=n+1:(s!==n&&u.push({type:`text`,value:e.value.slice(s,n)}),Array.isArray(a)?u.push(...a):a&&u.push(a),s=n+d[0].length,l=!0),!r.global)break;d=r.exec(e.value)}return l?(s<e.value.length&&u.push({type:`text`,value:e.value.slice(s)}),n.children.splice(c,1,...u)):u=[e],c+u.length}}function Pit(e){let t=[];if(!Array.isArray(e))throw TypeError(`Expected find and replace tuple or list of tuples`);let n=!e[0]||Array.isArray(e[0])?e:[e],r=-1;for(;++r<n.length;){let e=n[r];t.push([Fit(e[0]),Iit(e[1])])}return t}function Fit(e){return typeof e==`string`?new RegExp(Mit(e),`g`):e}function Iit(e){return typeof e==`function`?e:function(){return e}}var R3=`phrasing`,z3=[`autolink`,`link`,`image`,`label`];function Lit(){return{transforms:[Wit],enter:{literalAutolink:zit,literalAutolinkEmail:B3,literalAutolinkHttp:B3,literalAutolinkWww:B3},exit:{literalAutolink:Uit,literalAutolinkEmail:Hit,literalAutolinkHttp:Bit,literalAutolinkWww:Vit}}}function Rit(){return{unsafe:[{character:`@`,before:`[+\\-.\\w]`,after:`[\\-.\\w]`,inConstruct:R3,notInConstruct:z3},{character:`.`,before:`[Ww]`,after:`[\\-.\\w]`,inConstruct:R3,notInConstruct:z3},{character:`:`,before:`[ps]`,after:`\\/`,inConstruct:R3,notInConstruct:z3}]}}function zit(e){this.enter({type:`link`,title:null,url:``,children:[]},e)}function B3(e){this.config.enter.autolinkProtocol.call(this,e)}function Bit(e){this.config.exit.autolinkProtocol.call(this,e)}function Vit(e){this.config.exit.data.call(this,e);let t=this.stack[this.stack.length-1];t.type,t.url=`http://`+this.sliceSerialize(e)}function Hit(e){this.config.exit.autolinkEmail.call(this,e)}function Uit(e){this.exit(e)}function Wit(e){Nit(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Git],[RegExp(`(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)`,`gu`),Kit]],{ignore:[`link`,`linkReference`]})}function Git(e,t,n,r,i){let a=``;if(!Yit(i)||(/^w/i.test(t)&&(n=t+n,t=``,a=`http://`),!qit(n)))return!1;let o=Jit(n+r);if(!o[0])return!1;let s={type:`link`,title:null,url:a+t+o[0],children:[{type:`text`,value:t+o[0]}]};return o[1]?[s,{type:`text`,value:o[1]}]:s}function Kit(e,t,n,r){return!Yit(r,!0)||/[-\d_]$/.test(n)?!1:{type:`link`,title:null,url:`mailto:`+t+`@`+n,children:[{type:`text`,value:t+`@`+n}]}}function qit(e){let t=e.split(`.`);return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function Jit(e){let t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],r=n.indexOf(`)`),i=jit(e,`(`),a=jit(e,`)`);for(;r!==-1&&i>a;)e+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(`)`),a++;return[e,n]}function Yit(e,t){let n=e.input.charCodeAt(e.index-1);return(e.index===0||aQ(n)||iQ(n))&&(!t||n!==47)}aat.peek=iat;function Xit(){this.buffer()}function Zit(e){this.enter({type:`footnoteReference`,identifier:``,label:``},e)}function Qit(){this.buffer()}function $it(e){this.enter({type:`footnoteDefinition`,identifier:``,label:``,children:[]},e)}function eat(e){let t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=XZ(this.sliceSerialize(e)).toLowerCase(),n.label=t}function tat(e){this.exit(e)}function nat(e){let t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=XZ(this.sliceSerialize(e)).toLowerCase(),n.label=t}function rat(e){this.exit(e)}function iat(){return`[`}function aat(e,t,n,r){let i=n.createTracker(r),a=i.move(`[^`),o=n.enter(`footnoteReference`),s=n.enter(`reference`);return a+=i.move(n.safe(n.associationId(e),{after:`]`,before:a})),s(),o(),a+=i.move(`]`),a}function oat(){return{enter:{gfmFootnoteCallString:Xit,gfmFootnoteCall:Zit,gfmFootnoteDefinitionLabelString:Qit,gfmFootnoteDefinition:$it},exit:{gfmFootnoteCallString:eat,gfmFootnoteCall:tat,gfmFootnoteDefinitionLabelString:nat,gfmFootnoteDefinition:rat}}}function sat(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:n,footnoteReference:aat},unsafe:[{character:`[`,inConstruct:[`label`,`phrasing`,`reference`]}]};function n(e,n,r,i){let a=r.createTracker(i),o=a.move(`[^`),s=r.enter(`footnoteDefinition`),c=r.enter(`label`);return o+=a.move(r.safe(r.associationId(e),{before:o,after:`]`})),c(),o+=a.move(`]:`),e.children&&e.children.length>0&&(a.shift(4),o+=a.move((t?`
`:` `)+r.indentLines(r.containerFlow(e,a.current()),t?lat:cat))),s(),o}}function cat(e,t,n){return t===0?e:lat(e,t,n)}function lat(e,t,n){return(n?``:`    `)+e}var uat=[`autolink`,`destinationLiteral`,`destinationRaw`,`reference`,`titleQuote`,`titleApostrophe`];hat.peek=gat;function dat(){return{canContainEols:[`delete`],enter:{strikethrough:pat},exit:{strikethrough:mat}}}function fat(){return{unsafe:[{character:`~`,inConstruct:`phrasing`,notInConstruct:uat}],handlers:{delete:hat}}}function pat(e){this.enter({type:`delete`,children:[]},e)}function mat(e){this.exit(e)}function hat(e,t,n,r){let i=n.createTracker(r),a=n.enter(`strikethrough`),o=i.move(`~~`);return o+=n.containerPhrasing(e,{...i.current(),before:o,after:`~`}),o+=i.move(`~~`),a(),o}function gat(){return`~`}function _at(e){return e.length}function vat(e,t){let n=t||{},r=(n.align||[]).concat(),i=n.stringLength||_at,a=[],o=[],s=[],c=[],l=0,u=-1;for(;++u<e.length;){let t=[],r=[],a=-1;for(e[u].length>l&&(l=e[u].length);++a<e[u].length;){let o=yat(e[u][a]);if(n.alignDelimiters!==!1){let e=i(o);r[a]=e,(c[a]===void 0||e>c[a])&&(c[a]=e)}t.push(o)}o[u]=t,s[u]=r}let d=-1;if(typeof r==`object`&&`length`in r)for(;++d<l;)a[d]=bat(r[d]);else{let e=bat(r);for(;++d<l;)a[d]=e}d=-1;let f=[],p=[];for(;++d<l;){let e=a[d],t=``,r=``;e===99?(t=`:`,r=`:`):e===108?t=`:`:e===114&&(r=`:`);let i=n.alignDelimiters===!1?1:Math.max(1,c[d]-t.length-r.length),o=t+`-`.repeat(i)+r;n.alignDelimiters!==!1&&(i=t.length+i+r.length,i>c[d]&&(c[d]=i),p[d]=i),f[d]=o}o.splice(1,0,f),s.splice(1,0,p),u=-1;let m=[];for(;++u<o.length;){let e=o[u],t=s[u];d=-1;let r=[];for(;++d<l;){let i=e[d]||``,o=``,s=``;if(n.alignDelimiters!==!1){let e=c[d]-(t[d]||0),n=a[d];n===114?o=` `.repeat(e):n===99?e%2?(o=` `.repeat(e/2+.5),s=` `.repeat(e/2-.5)):(o=` `.repeat(e/2),s=o):s=` `.repeat(e)}n.delimiterStart!==!1&&!d&&r.push(`|`),n.padding!==!1&&!(n.alignDelimiters===!1&&i===``)&&(n.delimiterStart!==!1||d)&&r.push(` `),n.alignDelimiters!==!1&&r.push(o),r.push(i),n.alignDelimiters!==!1&&r.push(s),n.padding!==!1&&r.push(` `),(n.delimiterEnd!==!1||d!==l-1)&&r.push(`|`)}m.push(n.delimiterEnd===!1?r.join(``).replace(/ +$/,``):r.join(``))}return m.join(`
`)}function yat(e){return e==null?``:String(e)}function bat(e){let t=typeof e==`string`?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function xat(e,t,n,r){let i=n.enter(`blockquote`),a=n.createTracker(r);a.move(`> `),a.shift(2);let o=n.indentLines(n.containerFlow(e,a.current()),Sat);return i(),o}function Sat(e,t,n){return`>`+(n?``:` `)+e}function Cat(e,t){return wat(e,t.inConstruct,!0)&&!wat(e,t.notInConstruct,!1)}function wat(e,t,n){if(typeof t==`string`&&(t=[t]),!t||t.length===0)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function Tat(e,t,n,r){let i=-1;for(;++i<n.unsafe.length;)if(n.unsafe[i].character===`
`&&Cat(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?``:` `;return`\\
`}function Eat(e,t){let n=String(e),r=n.indexOf(t),i=r,a=0,o=0;if(typeof t!=`string`)throw TypeError(`Expected substring`);for(;r!==-1;)r===i?++a>o&&(o=a):a=1,i=r+t.length,r=n.indexOf(t,i);return o}function Dat(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function Oat(e){let t=e.options.fence||"`";if(t!=="`"&&t!==`~`)throw Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function kat(e,t,n,r){let i=Oat(n),a=e.value||``,o=i==="`"?`GraveAccent`:`Tilde`;if(Dat(e,n)){let e=n.enter(`codeIndented`),t=n.indentLines(a,Aat);return e(),t}let s=n.createTracker(r),c=i.repeat(Math.max(Eat(a,i)+1,3)),l=n.enter(`codeFenced`),u=s.move(c);if(e.lang){let t=n.enter(`codeFencedLang${o}`);u+=s.move(n.safe(e.lang,{before:u,after:` `,encode:["`"],...s.current()})),t()}if(e.lang&&e.meta){let t=n.enter(`codeFencedMeta${o}`);u+=s.move(` `),u+=s.move(n.safe(e.meta,{before:u,after:`
`,encode:["`"],...s.current()})),t()}return u+=s.move(`
`),a&&(u+=s.move(a+`
`)),u+=s.move(c),l(),u}function Aat(e,t,n){return(n?``:`    `)+e}function V3(e){let t=e.options.quote||`"`;if(t!==`"`&&t!==`'`)throw Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function jat(e,t,n,r){let i=V3(n),a=i===`"`?`Quote`:`Apostrophe`,o=n.enter(`definition`),s=n.enter(`label`),c=n.createTracker(r),l=c.move(`[`);return l+=c.move(n.safe(n.associationId(e),{before:l,after:`]`,...c.current()})),l+=c.move(`]: `),s(),!e.url||/[\0- \u007F]/.test(e.url)?(s=n.enter(`destinationLiteral`),l+=c.move(`<`),l+=c.move(n.safe(e.url,{before:l,after:`>`,...c.current()})),l+=c.move(`>`)):(s=n.enter(`destinationRaw`),l+=c.move(n.safe(e.url,{before:l,after:e.title?` `:`
`,...c.current()}))),s(),e.title&&(s=n.enter(`title${a}`),l+=c.move(` `+i),l+=c.move(n.safe(e.title,{before:l,after:i,...c.current()})),l+=c.move(i),s()),o(),l}function Mat(e){let t=e.options.emphasis||`*`;if(t!==`*`&&t!==`_`)throw Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function H3(e){return`&#x`+e.toString(16).toUpperCase()+`;`}function U3(e,t,n){let r=uQ(e),i=uQ(t);return r===void 0?i===void 0?n===`_`?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:i===void 0?{inside:!1,outside:!1}:i===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Nat.peek=Pat;function Nat(e,t,n,r){let i=Mat(n),a=n.enter(`emphasis`),o=n.createTracker(r),s=o.move(i),c=o.move(n.containerPhrasing(e,{after:i,before:s,...o.current()})),l=c.charCodeAt(0),u=U3(r.before.charCodeAt(r.before.length-1),l,i);u.inside&&(c=H3(l)+c.slice(1));let d=c.charCodeAt(c.length-1),f=U3(r.after.charCodeAt(0),d,i);f.inside&&(c=c.slice(0,-1)+H3(d));let p=o.move(i);return a(),n.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},s+c+p}function Pat(e,t,n){return n.options.emphasis||`*`}function Fat(e,t){let n=!1;return kQ(e,function(e){if(`value`in e&&/\r?\n|\r/.test(e.value)||e.type===`break`)return n=!0,!1}),!!((!e.depth||e.depth<3)&&BZ(e)&&(t.options.setext||n))}function Iat(e,t,n,r){let i=Math.max(Math.min(6,e.depth||1),1),a=n.createTracker(r);if(Fat(e,n)){let t=n.enter(`headingSetext`),r=n.enter(`phrasing`),o=n.containerPhrasing(e,{...a.current(),before:`
`,after:`
`});return r(),t(),o+`
`+(i===1?`=`:`-`).repeat(o.length-(Math.max(o.lastIndexOf(`\r`),o.lastIndexOf(`
`))+1))}let o=`#`.repeat(i),s=n.enter(`headingAtx`),c=n.enter(`phrasing`);a.move(o+` `);let l=n.containerPhrasing(e,{before:`# `,after:`
`,...a.current()});return/^[\t ]/.test(l)&&(l=H3(l.charCodeAt(0))+l.slice(1)),l=l?o+` `+l:o,n.options.closeAtx&&(l+=` `+o),c(),s(),l}Lat.peek=Rat;function Lat(e){return e.value||``}function Rat(){return`<`}zat.peek=Bat;function zat(e,t,n,r){let i=V3(n),a=i===`"`?`Quote`:`Apostrophe`,o=n.enter(`image`),s=n.enter(`label`),c=n.createTracker(r),l=c.move(`![`);return l+=c.move(n.safe(e.alt,{before:l,after:`]`,...c.current()})),l+=c.move(`](`),s(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(s=n.enter(`destinationLiteral`),l+=c.move(`<`),l+=c.move(n.safe(e.url,{before:l,after:`>`,...c.current()})),l+=c.move(`>`)):(s=n.enter(`destinationRaw`),l+=c.move(n.safe(e.url,{before:l,after:e.title?` `:`)`,...c.current()}))),s(),e.title&&(s=n.enter(`title${a}`),l+=c.move(` `+i),l+=c.move(n.safe(e.title,{before:l,after:i,...c.current()})),l+=c.move(i),s()),l+=c.move(`)`),o(),l}function Bat(){return`!`}Vat.peek=Hat;function Vat(e,t,n,r){let i=e.referenceType,a=n.enter(`imageReference`),o=n.enter(`label`),s=n.createTracker(r),c=s.move(`![`),l=n.safe(e.alt,{before:c,after:`]`,...s.current()});c+=s.move(l+`][`),o();let u=n.stack;n.stack=[],o=n.enter(`reference`);let d=n.safe(n.associationId(e),{before:c,after:`]`,...s.current()});return o(),n.stack=u,a(),i===`full`||!l||l!==d?c+=s.move(d+`]`):i===`shortcut`?c=c.slice(0,-1):c+=s.move(`]`),c}function Hat(){return`!`}Uat.peek=Wat;function Uat(e,t,n){let r=e.value||``,i="`",a=-1;for(;RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=` `+r+` `);++a<n.unsafe.length;){let e=n.unsafe[a],t=n.compilePattern(e),i;if(e.atBreak)for(;i=t.exec(r);){let e=i.index;r.charCodeAt(e)===10&&r.charCodeAt(e-1)===13&&e--,r=r.slice(0,e)+` `+r.slice(i.index+1)}}return i+r+i}function Wat(){return"`"}function Gat(e,t){let n=BZ(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type===`text`&&(n===e.url||`mailto:`+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}Kat.peek=qat;function Kat(e,t,n,r){let i=V3(n),a=i===`"`?`Quote`:`Apostrophe`,o=n.createTracker(r),s,c;if(Gat(e,n)){let t=n.stack;n.stack=[],s=n.enter(`autolink`);let r=o.move(`<`);return r+=o.move(n.containerPhrasing(e,{before:r,after:`>`,...o.current()})),r+=o.move(`>`),s(),n.stack=t,r}s=n.enter(`link`),c=n.enter(`label`);let l=o.move(`[`);return l+=o.move(n.containerPhrasing(e,{before:l,after:`](`,...o.current()})),l+=o.move(`](`),c(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(c=n.enter(`destinationLiteral`),l+=o.move(`<`),l+=o.move(n.safe(e.url,{before:l,after:`>`,...o.current()})),l+=o.move(`>`)):(c=n.enter(`destinationRaw`),l+=o.move(n.safe(e.url,{before:l,after:e.title?` `:`)`,...o.current()}))),c(),e.title&&(c=n.enter(`title${a}`),l+=o.move(` `+i),l+=o.move(n.safe(e.title,{before:l,after:i,...o.current()})),l+=o.move(i),c()),l+=o.move(`)`),s(),l}function qat(e,t,n){return Gat(e,n)?`<`:`[`}Jat.peek=Yat;function Jat(e,t,n,r){let i=e.referenceType,a=n.enter(`linkReference`),o=n.enter(`label`),s=n.createTracker(r),c=s.move(`[`),l=n.containerPhrasing(e,{before:c,after:`]`,...s.current()});c+=s.move(l+`][`),o();let u=n.stack;n.stack=[],o=n.enter(`reference`);let d=n.safe(n.associationId(e),{before:c,after:`]`,...s.current()});return o(),n.stack=u,a(),i===`full`||!l||l!==d?c+=s.move(d+`]`):i===`shortcut`?c=c.slice(0,-1):c+=s.move(`]`),c}function Yat(){return`[`}function W3(e){let t=e.options.bullet||`*`;if(t!==`*`&&t!==`+`&&t!==`-`)throw Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function Xat(e){let t=W3(e),n=e.options.bulletOther;if(!n)return t===`*`?`-`:`*`;if(n!==`*`&&n!==`+`&&n!==`-`)throw Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function Zat(e){let t=e.options.bulletOrdered||`.`;if(t!==`.`&&t!==`)`)throw Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function Qat(e){let t=e.options.rule||`*`;if(t!==`*`&&t!==`-`&&t!==`_`)throw Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function $at(e,t,n,r){let i=n.enter(`list`),a=n.bulletCurrent,o=e.ordered?Zat(n):W3(n),s=e.ordered?o===`.`?`)`:`.`:Xat(n),c=t&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!e.ordered){let t=e.children?e.children[0]:void 0;if((o===`*`||o===`-`)&&t&&(!t.children||!t.children[0])&&n.stack[n.stack.length-1]===`list`&&n.stack[n.stack.length-2]===`listItem`&&n.stack[n.stack.length-3]===`list`&&n.stack[n.stack.length-4]===`listItem`&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),Qat(n)===o&&t){let t=-1;for(;++t<e.children.length;){let n=e.children[t];if(n&&n.type===`listItem`&&n.children&&n.children[0]&&n.children[0].type===`thematicBreak`){c=!0;break}}}}c&&(o=s),n.bulletCurrent=o;let l=n.containerFlow(e,r);return n.bulletLastUsed=o,n.bulletCurrent=a,i(),l}function eot(e){let t=e.options.listItemIndent||`one`;if(t!==`tab`&&t!==`one`&&t!==`mixed`)throw Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function tot(e,t,n,r){let i=eot(n),a=n.bulletCurrent||W3(n);t&&t.type===`list`&&t.ordered&&(a=(typeof t.start==`number`&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+a);let o=a.length+1;(i===`tab`||i===`mixed`&&(t&&t.type===`list`&&t.spread||e.spread))&&(o=Math.ceil(o/4)*4);let s=n.createTracker(r);s.move(a+` `.repeat(o-a.length)),s.shift(o);let c=n.enter(`listItem`),l=n.indentLines(n.containerFlow(e,s.current()),u);return c(),l;function u(e,t,n){return t?(n?``:` `.repeat(o))+e:(n?a:a+` `.repeat(o-a.length))+e}}function not(e,t,n,r){let i=n.enter(`paragraph`),a=n.enter(`phrasing`),o=n.containerPhrasing(e,r);return a(),i(),o}const rot=DQ([`break`,`delete`,`emphasis`,`footnote`,`footnoteReference`,`image`,`imageReference`,`inlineCode`,`inlineMath`,`link`,`linkReference`,`mdxJsxTextElement`,`mdxTextExpression`,`strong`,`text`,`textDirective`]);function iot(e,t,n,r){return(e.children.some(function(e){return rot(e)})?n.containerPhrasing:n.containerFlow).call(n,e,r)}function aot(e){let t=e.options.strong||`*`;if(t!==`*`&&t!==`_`)throw Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}oot.peek=sot;function oot(e,t,n,r){let i=aot(n),a=n.enter(`strong`),o=n.createTracker(r),s=o.move(i+i),c=o.move(n.containerPhrasing(e,{after:i,before:s,...o.current()})),l=c.charCodeAt(0),u=U3(r.before.charCodeAt(r.before.length-1),l,i);u.inside&&(c=H3(l)+c.slice(1));let d=c.charCodeAt(c.length-1),f=U3(r.after.charCodeAt(0),d,i);f.inside&&(c=c.slice(0,-1)+H3(d));let p=o.move(i+i);return a(),n.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},s+c+p}function sot(e,t,n){return n.options.strong||`*`}function cot(e,t,n,r){return n.safe(e.value,r)}function lot(e){let t=e.options.ruleRepetition||3;if(t<3)throw Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function uot(e,t,n){let r=(Qat(n)+(n.options.ruleSpaces?` `:``)).repeat(lot(n));return n.options.ruleSpaces?r.slice(0,-1):r}const dot={blockquote:xat,break:Tat,code:kat,definition:jat,emphasis:Nat,hardBreak:Tat,heading:Iat,html:Lat,image:zat,imageReference:Vat,inlineCode:Uat,link:Kat,linkReference:Jat,list:$at,listItem:tot,paragraph:not,root:iot,strong:oot,text:cot,thematicBreak:uot};function fot(){return{enter:{table:pot,tableData:got,tableHeader:got,tableRow:hot},exit:{codeText:_ot,table:mot,tableData:G3,tableHeader:G3,tableRow:G3}}}function pot(e){let t=e._align;this.enter({type:`table`,align:t.map(function(e){return e===`none`?null:e}),children:[]},e),this.data.inTable=!0}function mot(e){this.exit(e),this.data.inTable=void 0}function hot(e){this.enter({type:`tableRow`,children:[]},e)}function G3(e){this.exit(e)}function got(e){this.enter({type:`tableCell`,children:[]},e)}function _ot(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,vot));let n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function vot(e,t){return t===`|`?t:e}function yot(e){let t=e||{},n=t.tableCellPadding,r=t.tablePipeAlign,i=t.stringLength,a=n?` `:`|`;return{unsafe:[{character:`\r`,inConstruct:`tableCell`},{character:`
`,inConstruct:`tableCell`},{atBreak:!0,character:`|`,after:`[	 :-]`},{character:`|`,inConstruct:`tableCell`},{atBreak:!0,character:`:`,after:`-`},{atBreak:!0,character:`-`,after:`[:|-]`}],handlers:{inlineCode:f,table:o,tableCell:c,tableRow:s}};function o(e,t,n,r){return l(u(e,n,r),e.align)}function s(e,t,n,r){let i=l([d(e,n,r)]);return i.slice(0,i.indexOf(`
`))}function c(e,t,n,r){let i=n.enter(`tableCell`),o=n.enter(`phrasing`),s=n.containerPhrasing(e,{...r,before:a,after:a});return o(),i(),s}function l(e,t){return vat(e,{align:t,alignDelimiters:r,padding:n,stringLength:i})}function u(e,t,n){let r=e.children,i=-1,a=[],o=t.enter(`table`);for(;++i<r.length;)a[i]=d(r[i],t,n);return o(),a}function d(e,t,n){let r=e.children,i=-1,a=[],o=t.enter(`tableRow`);for(;++i<r.length;)a[i]=c(r[i],e,t,n);return o(),a}function f(e,t,n){let r=dot.inlineCode(e,t,n);return n.stack.includes(`tableCell`)&&(r=r.replace(/\|/g,`\\$&`)),r}}function bot(){return{exit:{taskListCheckValueChecked:Sot,taskListCheckValueUnchecked:Sot,paragraph:Cot}}}function xot(){return{unsafe:[{atBreak:!0,character:`-`,after:`[:|-]`}],handlers:{listItem:wot}}}function Sot(e){let t=this.stack[this.stack.length-2];t.type,t.checked=e.type===`taskListCheckValueChecked`}function Cot(e){let t=this.stack[this.stack.length-2];if(t&&t.type===`listItem`&&typeof t.checked==`boolean`){let e=this.stack[this.stack.length-1];e.type;let n=e.children[0];if(n&&n.type===`text`){let r=t.children,i=-1,a;for(;++i<r.length;){let e=r[i];if(e.type===`paragraph`){a=e;break}}a===e&&(n.value=n.value.slice(1),n.value.length===0?e.children.shift():e.position&&n.position&&typeof n.position.start.offset==`number`&&(n.position.start.column++,n.position.start.offset++,e.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function wot(e,t,n,r){let i=e.children[0],a=typeof e.checked==`boolean`&&i&&i.type===`paragraph`,o=`[`+(e.checked?`x`:` `)+`] `,s=n.createTracker(r);a&&s.move(o);let c=dot.listItem(e,t,n,{...r,...s.current()});return a&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,l)),c;function l(e){return e+o}}function Tot(){return[Lit(),oat(),dat(),fot(),bot()]}function Eot(e){return{extensions:[Rit(),sat(e),fat(),yot(e),xot()]}}var Dot={tokenize:Rot,partial:!0},Oot={tokenize:zot,partial:!0},kot={tokenize:Bot,partial:!0},Aot={tokenize:Vot,partial:!0},jot={tokenize:Hot,partial:!0},Mot={name:`wwwAutolink`,tokenize:Iot,previous:Uot},Not={name:`protocolAutolink`,tokenize:Lot,previous:Wot},K3={name:`emailAutolink`,tokenize:Fot,previous:Got},q3={};function Pot(){return{text:q3}}for(var J3=48;J3<123;)q3[J3]=K3,J3++,J3===58?J3=65:J3===91&&(J3=97);q3[43]=K3,q3[45]=K3,q3[46]=K3,q3[95]=K3,q3[72]=[K3,Not],q3[104]=[K3,Not],q3[87]=[K3,Mot],q3[119]=[K3,Mot];function Fot(e,t,n){let r=this,i,a;return o;function o(t){return!Y3(t)||!Got.call(r,r.previous)||X3(r.events)?n(t):(e.enter(`literalAutolink`),e.enter(`literalAutolinkEmail`),s(t))}function s(t){return Y3(t)?(e.consume(t),s):t===64?(e.consume(t),c):n(t)}function c(t){return t===46?e.check(jot,u,l)(t):t===45||t===95||QZ(t)?(a=!0,e.consume(t),c):u(t)}function l(t){return e.consume(t),i=!0,c}function u(o){return a&&i&&ZZ(r.previous)?(e.exit(`literalAutolinkEmail`),e.exit(`literalAutolink`),t(o)):n(o)}}function Iot(e,t,n){let r=this;return i;function i(t){return t!==87&&t!==119||!Uot.call(r,r.previous)||X3(r.events)?n(t):(e.enter(`literalAutolink`),e.enter(`literalAutolinkWww`),e.check(Dot,e.attempt(Oot,e.attempt(kot,a),n),n)(t))}function a(n){return e.exit(`literalAutolinkWww`),e.exit(`literalAutolink`),t(n)}}function Lot(e,t,n){let r=this,i=``,a=!1;return o;function o(t){return(t===72||t===104)&&Wot.call(r,r.previous)&&!X3(r.events)?(e.enter(`literalAutolink`),e.enter(`literalAutolinkHttp`),i+=String.fromCodePoint(t),e.consume(t),s):n(t)}function s(t){if(ZZ(t)&&i.length<5)return i+=String.fromCodePoint(t),e.consume(t),s;if(t===58){let n=i.toLowerCase();if(n===`http`||n===`https`)return e.consume(t),c}return n(t)}function c(t){return t===47?(e.consume(t),a?l:(a=!0,c)):n(t)}function l(t){return t===null||$Z(t)||nQ(t)||aQ(t)||iQ(t)?n(t):e.attempt(Oot,e.attempt(kot,u),n)(t)}function u(n){return e.exit(`literalAutolinkHttp`),e.exit(`literalAutolink`),t(n)}}function Rot(e,t,n){let r=0;return i;function i(t){return(t===87||t===119)&&r<3?(r++,e.consume(t),i):t===46&&r===3?(e.consume(t),a):n(t)}function a(e){return e===null?n(e):t(e)}}function zot(e,t,n){let r,i,a;return o;function o(t){return t===46||t===95?e.check(Aot,c,s)(t):t===null||nQ(t)||aQ(t)||t!==45&&iQ(t)?c(t):(a=!0,e.consume(t),o)}function s(t){return t===95?r=!0:(i=r,r=void 0),e.consume(t),o}function c(e){return i||r||!a?n(e):t(e)}}function Bot(e,t){let n=0,r=0;return i;function i(o){return o===40?(n++,e.consume(o),i):o===41&&r<n?a(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?e.check(Aot,t,a)(o):o===null||nQ(o)||aQ(o)?t(o):(e.consume(o),i)}function a(t){return t===41&&r++,e.consume(t),i}}function Vot(e,t,n){return r;function r(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(e.consume(o),r):o===38?(e.consume(o),a):o===93?(e.consume(o),i):o===60||o===null||nQ(o)||aQ(o)?t(o):n(o)}function i(e){return e===null||e===40||e===91||nQ(e)||aQ(e)?t(e):r(e)}function a(e){return ZZ(e)?o(e):n(e)}function o(t){return t===59?(e.consume(t),r):ZZ(t)?(e.consume(t),o):n(t)}}function Hot(e,t,n){return r;function r(t){return e.consume(t),i}function i(e){return QZ(e)?n(e):t(e)}}function Uot(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||nQ(e)}function Wot(e){return!ZZ(e)}function Got(e){return!(e===47||Y3(e))}function Y3(e){return e===43||e===45||e===46||e===95||QZ(e)}function X3(e){let t=e.length,n=!1;for(;t--;){let r=e[t][1];if((r.type===`labelLink`||r.type===`labelImage`)&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}var Kot={tokenize:est,partial:!0};function qot(){return{document:{91:{name:`gfmFootnoteDefinition`,tokenize:Zot,continuation:{tokenize:Qot},exit:$ot}},text:{91:{name:`gfmFootnoteCall`,tokenize:Xot},93:{name:`gfmPotentialFootnoteCall`,add:`after`,tokenize:Jot,resolveTo:Yot}}}}function Jot(e,t,n){let r=this,i=r.events.length,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]),o;for(;i--;){let e=r.events[i][1];if(e.type===`labelImage`){o=e;break}if(e.type===`gfmFootnoteCall`||e.type===`labelLink`||e.type===`label`||e.type===`image`||e.type===`link`)break}return s;function s(i){if(!o||!o._balanced)return n(i);let s=XZ(r.sliceSerialize({start:o.end,end:r.now()}));return s.codePointAt(0)!==94||!a.includes(s.slice(1))?n(i):(e.enter(`gfmFootnoteCallLabelMarker`),e.consume(i),e.exit(`gfmFootnoteCallLabelMarker`),t(i))}}function Yot(e,t){let n=e.length;for(;n--;)if(e[n][1].type===`labelImage`&&e[n][0]===`enter`){e[n][1];break}e[n+1][1].type=`data`,e[n+3][1].type=`gfmFootnoteCallLabelMarker`;let r={type:`gfmFootnoteCall`,start:Object.assign({},e[n+3][1].start),end:Object.assign({},e[e.length-1][1].end)},i={type:`gfmFootnoteCallMarker`,start:Object.assign({},e[n+3][1].end),end:Object.assign({},e[n+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;let a={type:`gfmFootnoteCallString`,start:Object.assign({},i.end),end:Object.assign({},e[e.length-1][1].start)},o={type:`chunkString`,contentType:`string`,start:Object.assign({},a.start),end:Object.assign({},a.end)},s=[e[n+1],e[n+2],[`enter`,r,t],e[n+3],e[n+4],[`enter`,i,t],[`exit`,i,t],[`enter`,a,t],[`enter`,o,t],[`exit`,o,t],[`exit`,a,t],e[e.length-2],e[e.length-1],[`exit`,r,t]];return e.splice(n,e.length-n+1,...s),e}function Xot(e,t,n){let r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]),a=0,o;return s;function s(t){return e.enter(`gfmFootnoteCall`),e.enter(`gfmFootnoteCallLabelMarker`),e.consume(t),e.exit(`gfmFootnoteCallLabelMarker`),c}function c(t){return t===94?(e.enter(`gfmFootnoteCallMarker`),e.consume(t),e.exit(`gfmFootnoteCallMarker`),e.enter(`gfmFootnoteCallString`),e.enter(`chunkString`).contentType=`string`,l):n(t)}function l(s){if(a>999||s===93&&!o||s===null||s===91||nQ(s))return n(s);if(s===93){e.exit(`chunkString`);let a=e.exit(`gfmFootnoteCallString`);return i.includes(XZ(r.sliceSerialize(a)))?(e.enter(`gfmFootnoteCallLabelMarker`),e.consume(s),e.exit(`gfmFootnoteCallLabelMarker`),e.exit(`gfmFootnoteCall`),t):n(s)}return nQ(s)||(o=!0),a++,e.consume(s),s===92?u:l}function u(t){return t===91||t===92||t===93?(e.consume(t),a++,l):l(t)}}function Zot(e,t,n){let r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]),a,o=0,s;return c;function c(t){return e.enter(`gfmFootnoteDefinition`)._container=!0,e.enter(`gfmFootnoteDefinitionLabel`),e.enter(`gfmFootnoteDefinitionLabelMarker`),e.consume(t),e.exit(`gfmFootnoteDefinitionLabelMarker`),l}function l(t){return t===94?(e.enter(`gfmFootnoteDefinitionMarker`),e.consume(t),e.exit(`gfmFootnoteDefinitionMarker`),e.enter(`gfmFootnoteDefinitionLabelString`),e.enter(`chunkString`).contentType=`string`,u):n(t)}function u(t){if(o>999||t===93&&!s||t===null||t===91||nQ(t))return n(t);if(t===93){e.exit(`chunkString`);let n=e.exit(`gfmFootnoteDefinitionLabelString`);return a=XZ(r.sliceSerialize(n)),e.enter(`gfmFootnoteDefinitionLabelMarker`),e.consume(t),e.exit(`gfmFootnoteDefinitionLabelMarker`),e.exit(`gfmFootnoteDefinitionLabel`),f}return nQ(t)||(s=!0),o++,e.consume(t),t===92?d:u}function d(t){return t===91||t===92||t===93?(e.consume(t),o++,u):u(t)}function f(t){return t===58?(e.enter(`definitionMarker`),e.consume(t),e.exit(`definitionMarker`),i.includes(a)||i.push(a),cQ(e,p,`gfmFootnoteDefinitionWhitespace`)):n(t)}function p(e){return t(e)}}function Qot(e,t,n){return e.check(pQ,t,e.attempt(Kot,t,n))}function $ot(e){e.exit(`gfmFootnoteDefinition`)}function est(e,t,n){let r=this;return cQ(e,i,`gfmFootnoteDefinitionIndent`,5);function i(e){let i=r.events[r.events.length-1];return i&&i[1].type===`gfmFootnoteDefinitionIndent`&&i[2].sliceSerialize(i[1],!0).length===4?t(e):n(e)}}function tst(e){let t=(e||{}).singleTilde,n={name:`strikethrough`,tokenize:i,resolveAll:r};return t??=!0,{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}};function r(e,t){let n=-1;for(;++n<e.length;)if(e[n][0]===`enter`&&e[n][1].type===`strikethroughSequenceTemporary`&&e[n][1]._close){let r=n;for(;r--;)if(e[r][0]===`exit`&&e[r][1].type===`strikethroughSequenceTemporary`&&e[r][1]._open&&e[n][1].end.offset-e[n][1].start.offset===e[r][1].end.offset-e[r][1].start.offset){e[n][1].type=`strikethroughSequence`,e[r][1].type=`strikethroughSequence`;let i={type:`strikethrough`,start:Object.assign({},e[r][1].start),end:Object.assign({},e[n][1].end)},a={type:`strikethroughText`,start:Object.assign({},e[r][1].end),end:Object.assign({},e[n][1].start)},o=[[`enter`,i,t],[`enter`,e[r][1],t],[`exit`,e[r][1],t],[`enter`,a,t]],s=t.parser.constructs.insideSpan.null;s&&GZ(o,o.length,0,dQ(s,e.slice(r+1,n),t)),GZ(o,o.length,0,[[`exit`,a,t],[`enter`,e[n][1],t],[`exit`,e[n][1],t],[`exit`,i,t]]),GZ(e,r-1,n-r+3,o),n=r+o.length-2;break}}for(n=-1;++n<e.length;)e[n][1].type===`strikethroughSequenceTemporary`&&(e[n][1].type=`data`);return e}function i(e,n,r){let i=this.previous,a=this.events,o=0;return s;function s(t){return i===126&&a[a.length-1][1].type!==`characterEscape`?r(t):(e.enter(`strikethroughSequenceTemporary`),c(t))}function c(a){let s=uQ(i);if(a===126)return o>1?r(a):(e.consume(a),o++,c);if(o<2&&!t)return r(a);let l=e.exit(`strikethroughSequenceTemporary`),u=uQ(a);return l._open=!u||u===2&&!!s,l._close=!s||s===2&&!!u,n(a)}}}var nst=class{constructor(){this.map=[]}add(e,t,n){rst(this,e,t,n)}consume(e){if(this.map.sort(function(e,t){return e[0]-t[0]}),this.map.length===0)return;let t=this.map.length,n=[];for(;t>0;)--t,n.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];n.push(e.slice()),e.length=0;let r=n.pop();for(;r;){for(let t of r)e.push(t);r=n.pop()}this.map.length=0}};function rst(e,t,n,r){let i=0;if(!(n===0&&r.length===0)){for(;i<e.map.length;){if(e.map[i][0]===t){e.map[i][1]+=n,e.map[i][2].push(...r);return}i+=1}e.map.push([t,n,r])}}function ist(e,t){let n=!1,r=[];for(;t<e.length;){let i=e[t];if(n){if(i[0]===`enter`)i[1].type===`tableContent`&&r.push(e[t+1][1].type===`tableDelimiterMarker`?`left`:`none`);else if(i[1].type===`tableContent`){if(e[t-1][1].type===`tableDelimiterMarker`){let e=r.length-1;r[e]=r[e]===`left`?`center`:`right`}}else if(i[1].type===`tableDelimiterRow`)break}else i[0]===`enter`&&i[1].type===`tableDelimiterRow`&&(n=!0);t+=1}return r}function ast(){return{flow:{null:{name:`table`,tokenize:ost,resolveAll:sst}}}}function ost(e,t,n){let r=this,i=0,a=0,o;return s;function s(e){let t=r.events.length-1;for(;t>-1;){let e=r.events[t][1].type;if(e===`lineEnding`||e===`linePrefix`)t--;else break}let i=t>-1?r.events[t][1].type:null,a=i===`tableHead`||i===`tableRow`?S:c;return a===S&&r.parser.lazy[r.now().line]?n(e):a(e)}function c(t){return e.enter(`tableHead`),e.enter(`tableRow`),l(t)}function l(e){return e===124?u(e):(o=!0,a+=1,u(e))}function u(t){return t===null?n(t):tQ(t)?a>1?(a=0,r.interrupt=!0,e.exit(`tableRow`),e.enter(`lineEnding`),e.consume(t),e.exit(`lineEnding`),p):n(t):rQ(t)?cQ(e,u,`whitespace`)(t):(a+=1,o&&(o=!1,i+=1),t===124?(e.enter(`tableCellDivider`),e.consume(t),e.exit(`tableCellDivider`),o=!0,u):(e.enter(`data`),d(t)))}function d(t){return t===null||t===124||nQ(t)?(e.exit(`data`),u(t)):(e.consume(t),t===92?f:d)}function f(t){return t===92||t===124?(e.consume(t),d):d(t)}function p(t){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(t):(e.enter(`tableDelimiterRow`),o=!1,rQ(t)?cQ(e,m,`linePrefix`,r.parser.constructs.disable.null.includes(`codeIndented`)?void 0:4)(t):m(t))}function m(t){return t===45||t===58?g(t):t===124?(o=!0,e.enter(`tableCellDivider`),e.consume(t),e.exit(`tableCellDivider`),h):x(t)}function h(t){return rQ(t)?cQ(e,g,`whitespace`)(t):g(t)}function g(t){return t===58?(a+=1,o=!0,e.enter(`tableDelimiterMarker`),e.consume(t),e.exit(`tableDelimiterMarker`),_):t===45?(a+=1,_(t)):t===null||tQ(t)?b(t):x(t)}function _(t){return t===45?(e.enter(`tableDelimiterFiller`),v(t)):x(t)}function v(t){return t===45?(e.consume(t),v):t===58?(o=!0,e.exit(`tableDelimiterFiller`),e.enter(`tableDelimiterMarker`),e.consume(t),e.exit(`tableDelimiterMarker`),y):(e.exit(`tableDelimiterFiller`),y(t))}function y(t){return rQ(t)?cQ(e,b,`whitespace`)(t):b(t)}function b(n){return n===124?m(n):n===null||tQ(n)?!o||i!==a?x(n):(e.exit(`tableDelimiterRow`),e.exit(`tableHead`),t(n)):x(n)}function x(e){return n(e)}function S(t){return e.enter(`tableRow`),C(t)}function C(n){return n===124?(e.enter(`tableCellDivider`),e.consume(n),e.exit(`tableCellDivider`),C):n===null||tQ(n)?(e.exit(`tableRow`),t(n)):rQ(n)?cQ(e,C,`whitespace`)(n):(e.enter(`data`),w(n))}function w(t){return t===null||t===124||nQ(t)?(e.exit(`data`),C(t)):(e.consume(t),t===92?T:w)}function T(t){return t===92||t===124?(e.consume(t),w):w(t)}}function sst(e,t){let n=-1,r=!0,i=0,a=[0,0,0,0],o=[0,0,0,0],s=!1,c=0,l,u,d,f=new nst;for(;++n<e.length;){let p=e[n],m=p[1];p[0]===`enter`?m.type===`tableHead`?(s=!1,c!==0&&(cst(f,t,c,l,u),u=void 0,c=0),l={type:`table`,start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[[`enter`,l,t]])):m.type===`tableRow`||m.type===`tableDelimiterRow`?(r=!0,d=void 0,a=[0,0,0,0],o=[0,n+1,0,0],s&&(s=!1,u={type:`tableBody`,start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[[`enter`,u,t]])),i=m.type===`tableDelimiterRow`?2:u?3:1):i&&(m.type===`data`||m.type===`tableDelimiterMarker`||m.type===`tableDelimiterFiller`)?(r=!1,o[2]===0&&(a[1]!==0&&(o[0]=o[1],d=Z3(f,t,a,i,void 0,d),a=[0,0,0,0]),o[2]=n)):m.type===`tableCellDivider`&&(r?r=!1:(a[1]!==0&&(o[0]=o[1],d=Z3(f,t,a,i,void 0,d)),a=o,o=[a[1],n,0,0])):m.type===`tableHead`?(s=!0,c=n):m.type===`tableRow`||m.type===`tableDelimiterRow`?(c=n,a[1]===0?o[1]!==0&&(d=Z3(f,t,o,i,n,d)):(o[0]=o[1],d=Z3(f,t,a,i,n,d)),i=0):i&&(m.type===`data`||m.type===`tableDelimiterMarker`||m.type===`tableDelimiterFiller`)&&(o[3]=n)}for(c!==0&&cst(f,t,c,l,u),f.consume(t.events),n=-1;++n<t.events.length;){let e=t.events[n];e[0]===`enter`&&e[1].type===`table`&&(e[1]._align=ist(t.events,n))}return e}function Z3(e,t,n,r,i,a){let o=r===1?`tableHeader`:r===2?`tableDelimiter`:`tableData`;n[0]!==0&&(a.end=Object.assign({},Q3(t.events,n[0])),e.add(n[0],0,[[`exit`,a,t]]));let s=Q3(t.events,n[1]);if(a={type:o,start:Object.assign({},s),end:Object.assign({},s)},e.add(n[1],0,[[`enter`,a,t]]),n[2]!==0){let i=Q3(t.events,n[2]),a=Q3(t.events,n[3]),o={type:`tableContent`,start:Object.assign({},i),end:Object.assign({},a)};if(e.add(n[2],0,[[`enter`,o,t]]),r!==2){let r=t.events[n[2]],i=t.events[n[3]];if(r[1].end=Object.assign({},i[1].end),r[1].type=`chunkText`,r[1].contentType=`text`,n[3]>n[2]+1){let t=n[2]+1,r=n[3]-n[2]-1;e.add(t,r,[])}}e.add(n[3]+1,0,[[`exit`,o,t]])}return i!==void 0&&(a.end=Object.assign({},Q3(t.events,i)),e.add(i,0,[[`exit`,a,t]]),a=void 0),a}function cst(e,t,n,r,i){let a=[],o=Q3(t.events,n);i&&(i.end=Object.assign({},o),a.push([`exit`,i,t])),r.end=Object.assign({},o),a.push([`exit`,r,t]),e.add(n+1,0,a)}function Q3(e,t){let n=e[t],r=n[0]===`enter`?`start`:`end`;return n[1][r]}var lst={name:`tasklistCheck`,tokenize:dst};function ust(){return{text:{91:lst}}}function dst(e,t,n){let r=this;return i;function i(t){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(t):(e.enter(`taskListCheck`),e.enter(`taskListCheckMarker`),e.consume(t),e.exit(`taskListCheckMarker`),a)}function a(t){return nQ(t)?(e.enter(`taskListCheckValueUnchecked`),e.consume(t),e.exit(`taskListCheckValueUnchecked`),o):t===88||t===120?(e.enter(`taskListCheckValueChecked`),e.consume(t),e.exit(`taskListCheckValueChecked`),o):n(t)}function o(t){return t===93?(e.enter(`taskListCheckMarker`),e.consume(t),e.exit(`taskListCheckMarker`),e.exit(`taskListCheck`),s):n(t)}function s(r){return tQ(r)?t(r):rQ(r)?e.check({tokenize:fst},t,n)(r):n(r)}}function fst(e,t,n){return cQ(e,r,`whitespace`);function r(e){return e===null?n(e):t(e)}}function pst(e){return JZ([Pot(),qot(),tst(e),ast(),ust()])}var mst={};function hst(e){let t=this,n=e||mst,r=t.data(),i=r.micromarkExtensions||=[],a=r.fromMarkdownExtensions||=[],o=r.toMarkdownExtensions||=[];i.push(pst(n)),a.push(Tot()),o.push(Eot(n))}function gst(e){let[,t]=y.useState({}),n=y.useRef();return n.current=e?.value,y.useEffect(()=>{if(!e)return;let r=e.subscribe(e=>{n.current!==e&&t({})});return()=>r.unsubscribe()},[e]),e?.value}function _st(e){return y.useSyncExternalStore(y.useCallback(t=>{let n=e?.pipe(_me(1)).subscribe(t);return()=>n?.unsubscribe()},[e]),y.useCallback(()=>e?.value,[e]))}var vst=y.useSyncExternalStore?_st:gst;function $3(e){return vst(e)}function yst({children:e,components:t}){return(0,I.jsxs)(`div`,{className:`msp-markdown`,children:[(0,I.jsx)(bst,{}),(0,I.jsx)(AXe,{skipHtml:!0,components:{a:wst,img:xst,...t},remarkPlugins:[hst],children:e})]})}function bst(){let e=(0,y.useRef)(null),t=$3((0,y.useContext)(KX)?.managers.markdownExtensions.state.audioPlayer);return(0,y.useEffect)(()=>{if(e.current)return e.current.appendChild(t),()=>{t?.remove()}},[t]),t?(0,I.jsx)(`div`,{className:`msp-markdown-audio-player`,ref:e}):null}function xst({src:e,element:t,alt:n}){let r=(0,y.useContext)(KX);if(!e)return t;e6(r);let i=r?.managers.markdownExtensions.parseArgs(e);if(i)return r?.managers.markdownExtensions.tryRender(i,Cst)??t;{let t=r?.managers.markdownExtensions.tryResolveUri(e);if(typeof t?.then==`function`)return(0,I.jsx)(Sst,{alt:n,data:t});if(typeof t==`string`&&t)return(0,I.jsx)(`img`,{src:t,alt:n})}return(0,I.jsx)(`img`,{src:e,alt:n})}function Sst({alt:e,data:t}){let[n,r]=(0,y.useState)(void 0);return(0,y.useEffect)(()=>{let e=!0;return t.then(t=>{e&&r(t)}).catch(t=>{console.error(`Failed to load static image`,t),e&&r(void 0)}),()=>{e=!1}},[t]),n?(0,I.jsx)(`img`,{src:n,alt:e}):null}const Cst=[{name:`color-swatch`,reactRenderFn:({args:e})=>{let t=e[`color-swatch`];return t?(0,I.jsx)(`span`,{style:{display:`inline-block`,width:`0.75em`,height:`0.75em`,backgroundColor:t,borderRadius:`25%`}}):null}},{name:`color-palette`,reactRenderFn:({args:e})=>{let t=e[`color-palette-name`],n=e[`color-palette-colors`],r=e[`color-palette-width`]??`150px`,i=e[`color-palette-height`]??`0.5em`,a=`color-palette-discrete`in e;if(!t&&!n)return null;let o=n?G7e(n):aE[t.toLowerCase()]?.list;return o?.length?(0,I.jsx)(`span`,{style:{display:`inline-block`,minWidth:r,height:i,background:(a?U7e:W7e)(o),borderRadius:`2px`}}):(console.warn(`Color palette could not be resolved.`,e),null)}}];function wst({href:e,children:t,element:n}){let r=(0,y.useContext)(KX);if(!e)return n;e6(r);let i=r?.managers.markdownExtensions.parseArgs(e);return i?(0,I.jsx)(`a`,{href:`#`,onClick:e=>{e.preventDefault(),r?.managers.markdownExtensions.tryExecute(`click`,i)},onMouseEnter:()=>r?.managers.markdownExtensions.tryExecute(`mouse-enter`,i),onMouseLeave:()=>r?.managers.markdownExtensions.tryExecute(`mouse-leave`,i),children:t}):e[0]===`#`?(e6(r),(0,I.jsx)(`a`,{href:`#`,onClick:t=>{t.preventDefault(),r?.managers.snapshot.applyKey(e.substring(1))},children:t})):e?(0,I.jsxs)(`a`,{href:e,target:`_blank`,rel:`noopener noreferrer`,children:[t,``]}):t}function e6(e){e||console.warn(`Markdown component requires a PluginReactContext to be set.`)}var Tst=class extends qX{constructor(){super(...arguments),this.state={show:!1,label:``},this.update=()=>{let e=this.plugin.state.data,t=e.selectQ(e=>e.ofTransformer(IY.Model.ModelFromTrajectory));if(t.length===0){this.setState({show:!1});return}let n=``,r=0,i=new Set;for(let a of t){if(!a.sourceRef)continue;let t=e.cells.get(a.sourceRef).obj;if(t&&t.data.frameCount>1){if(i.has(a.sourceRef)){this.setState({show:!1});return}if(i.add(a.sourceRef),r++,!n){let e=a.transform.params.modelIndex;n=`Model ${Math.round(e+1)} / ${t.data.frameCount}`}}}r>1&&(n=``),this.setState({show:r>0,label:n})},this.reset=()=>jx.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:J2.create({action:`reset`})}),this.prev=()=>jx.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:J2.create({action:`advance`,by:-1})}),this.next=()=>jx.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:J2.create({action:`advance`,by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){let e=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||e&&!this.state.label||!this.plugin.config.get(WQ.Viewport.ShowTrajectoryControls)?null:(0,I.jsxs)(`div`,{className:`msp-traj-controls`,children:[!e&&(0,I.jsx)(HX,{svg:CGe,title:`First Model`,onClick:this.reset,disabled:e}),!e&&(0,I.jsx)(HX,{svg:wX,title:`Previous Model`,onClick:this.prev,disabled:e}),!e&&(0,I.jsx)(HX,{svg:TX,title:`Next Model`,onClick:this.next,disabled:e}),!!this.state.label&&(0,I.jsx)(`span`,{children:this.state.label})]})}},Est=class extends qX{constructor(){super(...arguments),this.state={isBusy:!1,show:!0,showAnimation:!1},this.change=e=>{e.target.value!==`none`&&this.update(e.target.value)},this.prev=()=>{let e=this.plugin.managers.snapshot,t=e.getNextId(e.state.current,-1);t&&this.update(t)},this.next=()=>{let e=this.plugin.managers.snapshot,t=e.getNextId(e.state.current,1);t&&this.update(t)},this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()},this.toggleShowAnimation=()=>{this.setState({showAnimation:!this.state.showAnimation})},this.toggleStateAnimation=()=>{this.state.isBusy?(this.plugin.managers.animation.stop(),this.plugin.managers.markdownExtensions.audio.pause()):this.plugin.managers.animation.play(J0,{})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,e=>this.setState({isBusy:e})),this.subscribe(this.plugin.behaviors.state.isAnimating,e=>this.setState({isBusy:e}))}componentWillUnmount(){super.componentWillUnmount()}async update(e){this.setState({isBusy:!0}),await jx.State.Snapshots.Apply(this.plugin,{id:e}),this.setState({isBusy:!1})}get isStateTransitionPlaying(){return this.plugin.managers.animation.isAnimatingStateTransition}render(){let e=this.plugin.managers.snapshot,t=e.state.entries.size;if(!t||!this.state.show)return null;let n=e.state.current,r=e.state.isPlaying,i=e.getEntry(n),a=!!i?.snapshot.transition,o=r||this.state.isBusy&&!this.isStateTransitionPlaying;return(0,I.jsxs)(`div`,{className:`msp-state-snapshot-viewport-controls`,children:[(0,I.jsxs)(`select`,{className:`msp-form-control`,value:n||`none`,onChange:this.change,disabled:o,children:[!n&&(0,I.jsx)(`option`,{value:`none`},`none`),e.state.entries.valueSeq().map((e,n)=>(0,I.jsxs)(`option`,{value:e.snapshot.id,children:[`[${n+1}/${t}]`,` `,e.name||new Date(e.timestamp).toLocaleString()]},e.snapshot.id))]}),(0,I.jsx)(HX,{svg:r?jX:EX,title:r?`Pause`:`Cycle States`,onClick:this.togglePlay,disabled:r?!1:this.state.isBusy&&!this.isStateTransitionPlaying}),!r&&(0,I.jsxs)(I.Fragment,{children:[t>1&&(0,I.jsx)(HX,{svg:wX,title:`Previous State`,onClick:this.prev,disabled:o}),t>1&&(0,I.jsx)(HX,{svg:TX,title:`Next State`,onClick:this.next,disabled:o}),a&&(0,I.jsx)(HX,{svg:mWe,className:`msp-state-snapshot-animation-button`,title:`Snapshot Transition`,onClick:this.toggleShowAnimation,disabled:!a,toggleState:this.state.showAnimation})]}),a&&this.state.showAnimation&&!r&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-state-snapshot-animation-slider msp-form-control`,children:[(0,I.jsx)(e4,{value:Math.round(100*(e.state.currentAnimationTimeMs??0))/100,min:0,step:Y0.getMinFrameDuration(i?.snapshot),max:Y0.getStateTransitionDuration(i?.snapshot)??1e3,onChange:()=>{},onChangeImmediate:t=>e.setSnapshotAnimationFrame(t,!0),hideInput:!0,disabled:this.state.isBusy}),`\xA0`]}),(0,I.jsx)(HX,{svg:this.state.isBusy?jX:DX,title:this.state.isBusy?`Stop`:`Replay`,onClick:this.toggleStateAnimation,toggleState:!1})]})]})}};function Dst(){let e=y.useContext(KX),[t,n]=y.useState(0);y.useEffect(()=>{let t=e.managers.snapshot.events.changed.subscribe(()=>n(e=>e+1));return()=>t.unsubscribe()},[e]);let r=e.managers.snapshot.state.current;if(!r)return null;let i=e.managers.snapshot.getEntry(r);return(i?.description)?.trim()?(0,I.jsx)(`div`,{id:`snapinfo`,className:`msp-snapshot-description-wrapper`,children:i.descriptionFormat===`plaintext`&&i.description||(0,I.jsx)(yst,{children:i.description})}):null}var Ost=class extends qX{constructor(){super(...arguments),this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.plugin.managers.snapshot.state.isPlaying?this.setState({isPlaying:!0,isExpanded:!1}):this.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{e?this.setState({isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}):this.setState({isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,e=>{e?this.setState({isAnimating:!0,isExpanded:!1}):this.setState({isAnimating:!1})})}render(){let e=this.plugin.managers.snapshot.state.isPlaying;if(e||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(WQ.Viewport.ShowAnimation))return null;let t=this.state.isAnimating;return(0,I.jsxs)(`div`,{className:`msp-animation-viewport-controls`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-semi-transparent-background`}),(0,I.jsx)(HX,{svg:t||e?jX:EGe,transparent:!0,title:t?`Stop`:`Select Animation`,onClick:t||e?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:t||e?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty})]}),this.state.isExpanded&&!this.state.isBusy&&(0,I.jsx)(`div`,{className:`msp-animation-viewport-controls-select`,children:(0,I.jsx)(w9e,{onStart:this.toggleExpanded})})]})}},kst=class extends qX{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,I.jsx)(`div`,{className:`msp-selection-viewport-controls`,children:(0,I.jsx)(Let,{})}):null}},Ast=class extends qX{constructor(){super(...arguments),this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,e=>this.setState({labels:e.labels}))}render(){return this.state.labels.length===0?null:(0,I.jsx)(`div`,{className:`msp-highlight-info`,children:this.state.labels.map((e,t)=>e.indexOf(`
`)>=0?(0,I.jsx)(`div`,{className:`msp-highlight-markdown-row`,children:(0,I.jsx)(AXe,{skipHtml:!0,children:e})},``+t):(0,I.jsx)(`div`,{className:`msp-highlight-simple-row`,dangerouslySetInnerHTML:{__html:e}},``+t))})}},jst=class extends qX{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let e=[];return this.plugin.customStructureControls.forEach((t,n)=>{e.push((0,I.jsx)(t,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),e.length>0?(0,I.jsx)(I.Fragment,{children:e}):null}},Mst=class extends qX{render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-section-header`,children:[(0,I.jsx)(XY,{svg:kWe}),`Structure Tools`]}),(0,I.jsx)(Xet,{}),(0,I.jsx)(Uet,{}),(0,I.jsx)(xit,{}),(0,I.jsx)(Eit,{}),(0,I.jsx)(vet,{}),this.plugin.config.get(WQ.VolumeStreaming.Enabled)&&(0,I.jsx)(Vrt,{}),(0,I.jsx)(Hrt,{}),(0,I.jsx)(jst,{})]})}},Nst=class extends qX{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:e,state:t})=>{let n=this.current;n.ref!==e||n.state!==t||this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){let{state:e,nodeRef:t}=this.props,n=e.cells.get(t),r=e.actions.fromCell(n,this.plugin);if(r.length===0)return null;let i=n.transform.transformer.definition,a=n.obj?n.obj.label:i.display&&i.display.name||i.name;return(0,I.jsxs)(`div`,{className:`msp-state-actions`,children:[!this.props.hideHeader&&(0,I.jsxs)(`div`,{className:`msp-section-header`,children:[(0,I.jsx)(XY,{svg:WWe}),` `,`Actions (${a})`]}),r.map((n,r)=>(0,I.jsx)(P3,{state:e,action:n,nodeRef:t,initiallyCollapsed:r===0?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${n.id}`))]})}},Pst=class extends qX{render(){return(0,I.jsxs)(`div`,{children:[(0,I.jsx)(BX,{icon:AX,title:`Plugin State`}),(0,I.jsx)(`div`,{style:{marginBottom:`10px`},children:(0,I.jsx)(WX,{header:`Save Options`,initiallyExpanded:!1,children:(0,I.jsx)(Ist,{})})}),(0,I.jsx)(Lst,{}),(0,I.jsx)(Bst,{}),(0,I.jsx)(BX,{title:`Save as File`,accent:`blue`}),(0,I.jsx)(Fst,{}),this.plugin.spec.components?.remoteState!==`none`&&(0,I.jsx)(Ust,{})]})}},Fst=class extends qX{constructor(){super(...arguments),this.downloadToFileJson=()=>{var e,t;(t=(e=this.props).onAction)==null||t.call(e),jx.State.Snapshots.DownloadToFile(this.plugin,{type:`json`})},this.downloadToFileZip=()=>{var e,t;(t=(e=this.props).onAction)==null||t.call(e),jx.State.Snapshots.DownloadToFile(this.plugin,{type:`zip`})},this.open=e=>{var t,n;if(!e.target.files||!e.target.files[0]){this.plugin.log.error(`No state file selected`);return}(n=(t=this.props).onAction)==null||n.call(t),jx.State.Snapshots.OpenFile(this.plugin,{file:e.target.files[0]})}}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(VX,{icon:bX,onClick:this.downloadToFileJson,title:`Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.`,children:`State`}),(0,I.jsx)(VX,{icon:bX,onClick:this.downloadToFileZip,title:`Save the state including the input data.`,children:`Session`}),(0,I.jsxs)(`div`,{className:`msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file`,children:[(0,I.jsx)(XY,{svg:mGe,inline:!0}),` Open `,(0,I.jsx)(`input`,{onChange:this.open,type:`file`,multiple:!1,accept:`.molx,.molj`})]})]}),(0,I.jsxs)(`div`,{className:`msp-help-text`,style:{padding:`10px`},children:[(0,I.jsx)(XY,{svg:FX}),` This is an experimental feature and stored states/sessions might not be openable in a future version.`]})]})}},Ist=class extends qX{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,I.jsx)(a4,{params:Y0.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}},Lst=class e extends qX{constructor(){super(...arguments),this.state={params:V.getDefaultValues(e.Params)},this.add=()=>{jx.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})},this.updateParams=e=>this.setState({params:e}),this.clear=()=>{jx.State.Snapshots.Clear(this.plugin,{})}}shouldComponentUpdate(e,t){return!Dx(this.props,e)||!Dx(this.state,t)}render(){return(0,I.jsx)(`div`,{children:(0,I.jsx)(zst,{parent:this})})}};Lst.Params={name:V.Text(),description:V.Text()};function Rst(e,t,n){return t?e.managers.snapshot.state.entries.some(e=>(!n||e.snapshot.id!==n)&&e.key===t):!1}function zst({parent:e}){let[t,n]=y.useState({key:``,name:``,description:``}),r=()=>{jx.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),n({key:``,name:``,description:``})},i=Rst(e.plugin,t.key);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Vst,{state:t,setState:n,apply:r}),(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(HX,{onClick:e.clear,svg:vX,title:`Remove All`}),(0,I.jsx)(VX,{onClick:r,icon:i?void 0:aX,style:{textAlign:`right`},commit:i?`off`:`on`,disabled:i,children:i?`Key must be unique`:`Add`})]})]})}var Bst=class extends qX{constructor(){super(...arguments),this.state={editingId:void 0},this.edit=e=>{let t=e.currentTarget.getAttribute(`data-id`);if(!t)return;let n=this.state.editingId;this.setState({editingId:t===n?void 0:t})},this.doneEdit=()=>this.setState({editingId:void 0}),this.apply=e=>{let t=e.currentTarget.getAttribute(`data-id`);t&&jx.State.Snapshots.Apply(this.plugin,{id:t})},this.remove=e=>{let t=e.currentTarget.getAttribute(`data-id`);t&&jx.State.Snapshots.Remove(this.plugin,{id:t})},this.moveUp=e=>{let t=e.currentTarget.getAttribute(`data-id`);t&&jx.State.Snapshots.Move(this.plugin,{id:t,dir:-1})},this.moveDown=e=>{let t=e.currentTarget.getAttribute(`data-id`);t&&jx.State.Snapshots.Move(this.plugin,{id:t,dir:1})},this.replace=e=>{let t=e.currentTarget.getAttribute(`data-id`);t&&jx.State.Snapshots.Replace(this.plugin,{id:t})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){let e=this.plugin.managers.snapshot.state.current,t=[];return this.plugin.managers.snapshot.state.entries.forEach(n=>{t.push((0,I.jsxs)(`li`,{className:`msp-flex-row`,children:[(0,I.jsxs)(VX,{"data-id":n.snapshot.id,onClick:this.apply,className:`msp-no-overflow`,children:[(0,I.jsxs)(`span`,{style:{fontWeight:n.snapshot.id===e?`bold`:void 0},children:[!!n.key&&`[${n.key}] `,n.name||new Date(n.timestamp).toLocaleString()]}),` `,(0,I.jsx)(`small`,{children:`${n.snapshot.durationInMs?Ry(n.snapshot.durationInMs,!1):``}`})]}),(0,I.jsx)(HX,{svg:MX,"data-id":n.snapshot.id,title:`Edit`,onClick:this.edit,flex:`28px`}),(0,I.jsx)(HX,{svg:lX,"data-id":n.snapshot.id,title:`Move Up`,onClick:this.moveUp,flex:`20px`}),(0,I.jsx)(HX,{svg:oX,"data-id":n.snapshot.id,title:`Move Down`,onClick:this.moveDown,flex:`20px`}),(0,I.jsx)(HX,{svg:OGe,"data-id":n.snapshot.id,title:`Replace`,onClick:this.replace,flex:`20px`}),(0,I.jsx)(HX,{svg:vX,"data-id":n.snapshot.id,title:`Remove`,onClick:this.remove,flex:`20px`})]},n.snapshot.id)),this.state.editingId===n.snapshot.id&&t.push((0,I.jsx)(Hst,{entry:n,plugin:this.plugin,done:this.doneEdit},`${n.snapshot.id}-edit`));let r=n.image&&this.plugin.managers.asset.get(n.image)?.file;r&&t.push((0,I.jsx)(`li`,{className:`msp-state-image-row`,children:(0,I.jsx)(VX,{"data-id":n.snapshot.id,onClick:this.apply,children:(0,I.jsx)(`img`,{draggable:!1,src:URL.createObjectURL(r)})})},`${n.snapshot.id}-image`))}),(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(`ul`,{style:{listStyle:`none`,marginTop:`10px`},className:`msp-state-list`,children:t})})}};function Vst({state:e,setState:t,apply:n}){let r=y.useRef(),i=y.useRef(),[a,o]=y.useState(!1);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(GX,{label:`Name`,control:(0,I.jsx)(`input`,{type:`text`,value:e.name,placeholder:`Name`,onChange:n=>t({...e,name:n.target.value}),onKeyUp:e=>{var t;e.key===`Enter`&&((t=r.current)==null||t.focus())}})}),(0,I.jsx)(GX,{label:(0,I.jsxs)(I.Fragment,{children:[`Key`,(0,I.jsx)(Y7e,{show:a,toggle:()=>o(e=>!e)})]}),control:(0,I.jsx)(`input`,{type:`text`,ref:r,value:e.key,placeholder:`Key (optional)`,onChange:n=>t({...e,key:n.target.value}),onKeyUp:e=>{var t;e.key===`Enter`&&((t=i.current)==null||t.focus())}})}),a&&(0,I.jsx)(`div`,{className:`msp-control-offset`,children:(0,I.jsx)(J7e,{description:`Optional snapshot key used to activate snapshots from descriptions, labels, etc.`})}),(0,I.jsx)(`div`,{className:`msp-flex-row msp-text-area-wrapper`,style:{marginBottom:1},children:(0,I.jsx)(`textarea`,{ref:i,placeholder:`Markdown Description

- Use [title](#key) to link to a snapshot`,className:`msp-form-control`,value:e.description,onChange:n=>t({...e,description:n.target.value}),onKeyUp:t=>{t.key===`Enter`&&t.ctrlKey&&n(e)}})})]})}function Hst({entry:e,plugin:t,done:n}){let[r,i]=y.useState({key:e.key??``,name:e.name??``,description:e.description??``,descriptionFormat:e.descriptionFormat}),a=()=>{t.managers.snapshot.update(e,r),n()},o=Rst(t,r.key,e.snapshot.id);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Vst,{state:r,setState:i,apply:a}),(0,I.jsx)(`div`,{className:`msp-flex-row`,style:{marginBottom:1},children:(0,I.jsx)(VX,{onClick:a,icon:o?void 0:hX,style:{textAlign:`right`},commit:o?`off`:`on`,disabled:o,children:o?`Key must be unique`:`Apply`})})]})}var Ust=class extends qX{constructor(){super(...arguments),this.Params={name:V.Text(),options:V.Group({description:V.Text(),playOnLoad:V.Boolean(!1),serverUrl:V.Text(this.plugin.config.get(WQ.State.CurrentServer))})},this.state={params:V.getDefaultValues(this.Params),entries:Nw(),isBusy:!1},this.ListOnlyParams={options:V.Group({serverUrl:V.Text(this.plugin.config.get(WQ.State.CurrentServer))},{isFlat:!0})},this._mounted=!1,this.refresh=async()=>{try{this.setState({isBusy:!0}),this.plugin.config.set(WQ.State.CurrentServer,this.state.params.options.serverUrl);let e=await this.plugin.runTask(this.plugin.fetch({url:this.serverUrl(`list`),type:`json`}))||[];e.sort((e,t)=>e.isSticky===t.isSticky?e.timestamp-t.timestamp:e.isSticky?-1:1);let t=Nw().asMutable();for(let n of e)t.set(n.id,{...n,url:this.serverUrl(`get/${n.id}`),removeUrl:this.serverUrl(`remove/${n.id}`)});this._mounted&&this.setState({entries:t.asImmutable(),isBusy:!1})}catch(e){console.error(e),this.plugin.log.error(`Error fetching remote snapshots`),this._mounted&&this.setState({entries:Nw(),isBusy:!1})}},this.upload=async()=>{this.setState({isBusy:!0}),this.plugin.config.set(WQ.State.CurrentServer,this.state.params.options.serverUrl),await jx.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl}),this.plugin.log.message(`Snapshot uploaded.`),this._mounted&&(this.setState({isBusy:!1}),this.refresh())},this.fetch=async e=>{let t=e.currentTarget.getAttribute(`data-id`);if(!t)return;let n=this.state.entries.get(t);if(n){this.setState({isBusy:!0});try{await jx.State.Snapshots.Fetch(this.plugin,{url:n.url})}finally{this._mounted&&this.setState({isBusy:!1})}}},this.remove=async e=>{let t=e.currentTarget.getAttribute(`data-id`);if(!t)return;let n=this.state.entries.get(t);if(n){this.setState({entries:this.state.entries.remove(t)});try{await fetch(n.removeUrl)}catch(e){console.error(e)}}}}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(e){return e?Q0(this.state.params.options.serverUrl,e):this.state.params.options.serverUrl}render(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{title:`Remote States`,accent:`blue`}),!this.props.listOnly&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(a4,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:e=>{this.setState({params:{...this.state.params,[e.name]:e.value}})},isDisabled:this.state.isBusy}),(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[(0,I.jsx)(HX,{onClick:this.refresh,disabled:this.state.isBusy,svg:DX}),(0,I.jsx)(VX,{icon:HWe,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:`Upload`})]})]}),(0,I.jsx)(Wst,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,I.jsxs)(`div`,{style:{marginTop:`10px`},children:[(0,I.jsx)(a4,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:e=>{this.setState({params:{...this.state.params,[e.name]:e.value}})},isDisabled:this.state.isBusy}),(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{onClick:this.refresh,disabled:this.state.isBusy,icon:DX,children:`Refresh`})})]})]})}},Wst=class extends JX{constructor(){super(...arguments),this.open=async e=>{let t=e.currentTarget.getAttribute(`data-id`);if(!t)return;let n=this.props.entries.get(t);if(!n)return;e.preventDefault();let r=`${window.location}`,i=r.indexOf(`?`);i>0&&(r=r.substr(0,i)),window.open(`${r}?snapshot-url=${encodeURIComponent(n.url)}`,`_blank`)}}render(){return(0,I.jsx)(`ul`,{style:{listStyle:`none`,marginTop:`10px`},className:`msp-state-list`,children:this.props.entries.valueSeq().map(e=>(0,I.jsxs)(`li`,{className:`msp-flex-row`,children:[(0,I.jsxs)(VX,{"data-id":e.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:`Click to download, right-click to open in a new tab.`,children:[e.name||new Date(e.timestamp).toLocaleString(),` `,(0,I.jsx)(`small`,{children:e.description})]}),!e.isSticky&&this.props.remove&&(0,I.jsx)(HX,{svg:vX,"data-id":e.id,title:`Remove`,onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},e.id))})}},Gst=class extends qX{constructor(){super(...arguments),this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,e=>{e.cell.transform.parent===yE.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{e.parent===yE.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(e,t){let n=e.state.tree.root.ref,r=e.state.tree.children.get(n).size===0;return t.showActions===r?null:{showActions:r}}render(){let e=this.props.state.tree.root.ref;return this.state.showActions?(0,I.jsxs)(`div`,{style:{margin:`10px`,cursor:`default`},children:[(0,I.jsx)(`p`,{children:`Nothing to see here yet.`}),(0,I.jsxs)(`p`,{children:[`Structures and Volumes can be loaded from the `,(0,I.jsx)(XY,{svg:SX}),` tab.`]})]}):(0,I.jsx)(Kst,{cell:this.props.state.cells.get(e),depth:0})}},Kst=class e extends qX{constructor(){super(...arguments),this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:e.isNull(this.props.cell),showLabel:e.showLabel(this.props.cell)}}is(e){return e.ref===this.ref&&e.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{this.props.cell===t.cell&&this.is(t)&&t.state.cells.has(this.ref)&&(this.state.isCollapsed!==!!t.cell.state.isCollapsed||this.state.isNull!==e.isNull(t.cell)||this.state.showLabel!==e.showLabel(t.cell))&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,e=>{this.props.cell.parent===e.state&&this.ref===e.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{this.props.cell.parent===e.state&&this.ref===e.parent&&this.forceUpdate()})}static getDerivedStateFromProps(t,n){let r=e.isNull(t.cell),i=e.showLabel(t.cell);return!!t.cell.state.isCollapsed===n.isCollapsed&&n.isNull===r&&n.showLabel===i?null:{isCollapsed:!!t.cell.state.isCollapsed,isNull:r,showLabel:i}}static hasDecorator(e){let t=e.parent.tree.children.get(e.transform.ref);if(t.size!==1)return!1;let n=t.first();return!!n&&!!e.parent?.tree.transforms.get(n).transformer.definition.isDecorator}static isNull(e){return!e||!e.parent||e.obj===Mx.Null||!e.parent.tree.transforms.has(e.transform.ref)}static showLabel(t){return t.transform.ref!==yE.RootRef&&(t.status!==`ok`||!t.state.isGhost&&!e.hasDecorator(t))}render(){if(this.state.isNull)return null;let t=this.props.cell,n=t.parent.tree.children.get(this.ref);if(!this.state.showLabel)return n.size===0?null:(0,I.jsx)(I.Fragment,{children:n.map(n=>(0,I.jsx)(e,{cell:t.parent.cells.get(n),depth:this.props.depth},n))});let r=this.props.depth+1;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(qst,{cell:t,depth:this.props.depth}),n.size===0?void 0:(0,I.jsx)(`div`,{style:{display:this.state.isCollapsed?`none`:`block`},children:n.map(n=>(0,I.jsx)(e,{cell:t.parent.cells.get(n),depth:r},n))})]})}},qst=class extends qX{constructor(){super(...arguments),this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},this.setCurrent=e=>{e?.preventDefault(),e?.currentTarget.blur(),jx.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})},this.setCurrentRoot=e=>{e?.preventDefault(),e?.currentTarget.blur(),this.props.cell.parent&&jx.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:yE.RootRef})},this.remove=e=>{e?.preventDefault(),jx.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})},this.toggleVisible=e=>{e.preventDefault(),jx.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.toggleExpanded=e=>{e.preventDefault(),jx.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.highlight=e=>{e.preventDefault(),jx.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.clearHighlight=e=>{e.preventDefault(),jx.Interactivity.ClearHighlights(this.plugin),e.currentTarget.blur()},this.hideApply=()=>{this.setCurrentRoot()},this.selectAction=e=>{e&&(e?.value)()}}is(e){return e.ref===this.ref&&e.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(mD(e=>this.is(e)),hD(33)),e=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,e=>{if(!this.is(e)){this.state.isCurrent&&e.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed);return}e.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed)})}_setCurrent(e,t){e?this.setState({isCurrent:e,action:`options`,currentAction:void 0,isCollapsed:t}):this.setState({isCurrent:e,action:void 0,currentAction:void 0,isCollapsed:t})}static getDerivedStateFromProps(e,t){let n=e.cell.parent.current===e.cell.transform.ref,r=!!e.cell.state.isCollapsed;return t.isCollapsed===r&&t.isCurrent===n?null:{isCurrent:n,isCollapsed:r,action:void 0,currentAction:void 0}}get actions(){let e=this.props.cell,t=[...e.parent.actions.fromCell(e,this.plugin)];if(t.length!==0)return t.sort((e,t)=>e.definition.display.name<t.definition.display.name?-1:e.definition.display.name===t.definition.display.name?0:1),[Y2.Header(`Apply Action`),...t.map(e=>Y2.Item(e.definition.display.name,()=>this.setState({action:`apply`,currentAction:e})))]}updates(e){let t=this.props.cell,n=SD.getDecoratorChain(t.parent,t.transform.ref),r=[];for(let i=n.length-1;i>=0;i--){let a=n[i];r.push((0,I.jsx)(T4,{state:t.parent,transform:a.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:e},`${a.transform.transformer.id}-${i}`))}return(0,I.jsx)(`div`,{className:`msp-tree-updates-wrapper`,children:r})}render(){let e=this.props.cell,t=e.transform;if(!e)return null;let n=this.is(e.parent.behaviors.currentObject.value),r=e.status!==`error`&&e.status!==`ok`,i;if(e.status===`error`||!e.obj){let n=e.status===`error`?e.errorText:t.transformer.definition.display.name;i=(0,I.jsxs)(VX,{className:`msp-btn-tree-label msp-no-hover-outline`,noOverflow:!0,title:n,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:r,children:[e.status===`error`&&(0,I.jsxs)(`b`,{children:[`[`,e.status,`]`]}),` `,(0,I.jsx)(`span`,{children:n})]})}else{let t=e.obj,n=`${t.label} ${t.description?t.description:``}`;i=(0,I.jsxs)(VX,{className:`msp-btn-tree-label msp-type-class-${t.type.typeClass}`,noOverflow:!0,disabled:r,title:n,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,I.jsx)(`span`,{children:t.label}),` `,t.description?(0,I.jsx)(`small`,{children:t.description}):void 0]})}let a=e.parent.tree.children.get(this.ref),o=e.state,s=(0,I.jsx)(HX,{svg:o.isCollapsed?cX:sX,flex:`20px`,disabled:r,onClick:this.toggleExpanded,transparent:!0,className:`msp-no-hover-outline`,style:{visibility:a.size>0?`visible`:`hidden`}}),c=e.state.isLocked?void 0:(0,I.jsx)(HX,{svg:vX,onClick:this.remove,disabled:r,small:!0,toggleState:!1}),l=(0,I.jsx)(HX,{svg:o.isHidden?NX:PX,toggleState:!1,disabled:r,small:!0,onClick:this.toggleVisible}),u={marginLeft:`${this.props.depth*8}px`},d=(0,I.jsxs)(`div`,{className:`msp-flex-row msp-tree-row${n?` msp-tree-row-current`:``}`,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:u,children:[s,i,c,l]});if(!n)return d;if(this.state.action===`apply`&&this.state.currentAction)return(0,I.jsxs)(`div`,{style:{marginBottom:`1px`},children:[d,(0,I.jsx)(LX,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:_X,headerLeftMargin:`${this.props.depth*8+21}px`,children:(0,I.jsx)(P3,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]});if(this.state.action===`options`){let e=this.actions;return(0,I.jsxs)(`div`,{style:{marginBottom:`1px`},children:[d,this.updates(`${this.props.depth*8+21}px`),e&&(0,I.jsx)(`div`,{style:{marginLeft:`${this.props.depth*8+21}px`,marginTop:`-1px`},children:(0,I.jsx)(Y2,{items:e,onSelect:this.selectAction})})]})}return d}},Jst=class extends qX{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let e=[];return this.plugin.customImportControls.forEach((t,n)=>{e.push((0,I.jsx)(t,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),e.length>0?(0,I.jsx)(I.Fragment,{children:e}):null}},Yst=class extends qX{constructor(){super(...arguments),this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value},this.set=e=>{if(this.state.tab===e){this.setState({tab:`none`},()=>this.plugin.behaviors.layout.leftPanelTabName.next(`none`)),jx.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:`collapsed`}}});return}this.setState({tab:e},()=>this.plugin.behaviors.layout.leftPanelTabName.next(e)),this.plugin.layout.state.regionState.left!==`full`&&jx.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:`full`}}})},this.tabs={none:(0,I.jsx)(I.Fragment,{}),root:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{icon:SX,title:`Home`}),(0,I.jsx)(Nst,{state:this.plugin.state.data,nodeRef:yE.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,I.jsx)(Jst,{}),this.plugin.spec.components?.remoteState!==`none`&&(0,I.jsx)(Ust,{listOnly:!0})]}),data:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{icon:iX,title:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Qst,{}),` State Tree`]})}),(0,I.jsx)(Gst,{state:this.plugin.state.data})]}),states:(0,I.jsx)(Pst,{}),settings:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{icon:MX,title:`Plugin Settings`}),(0,I.jsx)(Zst,{})]}),help:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{icon:xX,title:`Help`}),(0,I.jsx)(Iet,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,e=>{this.state.tab!==e&&this.setState({tab:e}),e===`none`&&this.plugin.layout.state.regionState.left!==`collapsed`&&jx.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:`collapsed`}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:e})=>{this.state.tab===`data`&&e.cells.size===1&&this.set(`root`)})}render(){let e=this.state.tab;return(0,I.jsxs)(`div`,{className:`msp-left-panel-controls`,children:[(0,I.jsxs)(`div`,{className:`msp-left-panel-controls-buttons`,children:[(0,I.jsx)(HX,{svg:SX,toggleState:e===`root`,transparent:!0,onClick:()=>this.set(`root`),title:`Home`}),(0,I.jsx)(Xst,{set:this.set}),(0,I.jsx)(HX,{svg:AX,toggleState:e===`states`,transparent:!0,onClick:()=>this.set(`states`),title:`Plugin State`}),(0,I.jsx)(HX,{svg:xX,toggleState:e===`help`,transparent:!0,onClick:()=>this.set(`help`),title:`Help`}),(0,I.jsx)(`div`,{className:`msp-left-panel-controls-buttons-bottom`,children:(0,I.jsx)(HX,{svg:MX,toggleState:e===`settings`,transparent:!0,onClick:()=>this.set(`settings`),title:`Settings`})})]}),(0,I.jsx)(`div`,{className:`msp-scrollable-container`,children:this.tabs[e]})]})}},Xst=class extends qX{constructor(){super(...arguments),this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,e=>{this.tab===`data`?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,e=>{this.tab!==`data`&&this.setState({changed:!0})})}render(){return(0,I.jsx)(HX,{svg:iX,toggleState:this.tab===`data`,transparent:!0,onClick:()=>this.props.set(`data`),title:`State Tree`,style:{position:`relative`},extraContent:this.state.changed?(0,I.jsx)(`div`,{className:`msp-left-panel-controls-button-data-dirty`}):void 0})}},Zst=class extends qX{constructor(){super(...arguments),this.setSettings=e=>{jx.Canvas3D.SetSettings(this.plugin,{settings:{[e.name]:e.value}})},this.setCanvas3DContextProps=e=>{var t;(t=this.plugin.canvas3dContext)==null||t.setProps({[e.name]:e.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(gD(500,void 0,{leading:!0,trailing:!0})),e=>{(e.radiusMax!==void 0||e.radius!==void 0)&&this.forceUpdate()})}render(){return(0,I.jsxs)(I.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(BX,{title:`Viewport`}),(0,I.jsx)(a4,{params:W0,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,I.jsx)(a4,{params:K0.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,I.jsx)(BX,{title:`Behavior`}),(0,I.jsx)(Gst,{state:this.plugin.state.behaviors})]})}},Qst=class extends qX{constructor(){super(...arguments),this.remove=e=>{e.preventDefault(),jx.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:yE.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,e=>{e.cell.transform.parent===yE.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{e.parent===yE.RootRef&&this.forceUpdate()})}render(){return this.plugin.state.data.tree.children.get(yE.RootRef).size===0?null:(0,I.jsx)(HX,{svg:vX,onClick:this.remove,title:`Remove All`,style:{display:`inline-block`},small:!0,className:`msp-no-hover-outline`,transparent:!0})}},$st=5,t6={selected:`rgb(51, 255, 25)`,highlighted:`rgb(255, 102, 153)`,focused:``},ect=class extends qX{constructor(){super(...arguments),this.parentDiv=y.createRef(),this.lastMouseOverSeqIdx=-1,this.highlightQueue=new sD,this.markerColors={...t6},this.customColorThemeWrapper=void 0,this.customColorFunction=void 0,this.lociHighlightProvider=(e,t)=>{this.props.sequenceWrapper.markResidue(e.loci,t)&&this.updateMarker()},this.lociSelectionProvider=(e,t)=>{this.props.sequenceWrapper.markResidue(e.loci,t)&&this.updateMarker()},this.contextMenu=e=>{e.preventDefault()},this.mouseDownLoci=void 0,this.mouseDown=e=>{e.stopPropagation();let t=this.getSeqIdx(e);this.mouseDownLoci=this.getLoci(t)},this.mouseUp=e=>{if(e.stopPropagation(),this.mouseDownLoci===void 0)return;let t=this.getSeqIdx(e),n=this.getLoci(t);if(n){let t=W1(e.nativeEvent),r=G1(e.nativeEvent),i=K1(e.nativeEvent),a=n;if(!$.areEqual(this.mouseDownLoci,n)){let e=this.mouseDownLoci.elements[0],t=n.elements[0],r=Math.min(K.min(e.indices),K.min(t.indices)),i=Math.max(K.max(e.indices),K.max(t.indices));a=$(n.structure,[{unit:e.unit,indices:K.ofRange(r,i)}])}this.click(a,t,r,i)}this.mouseDownLoci=void 0},this.location=iL.create(void 0),this.mouseMove=e=>{e.stopPropagation();let t=W1(e.nativeEvent),n=G1(e.nativeEvent),r=K1(e.nativeEvent),i=e.target;if(!i||!i.getAttribute){if(this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1,this.highlightQueue.next({seqIdx:-1,buttons:t,button:n,modifiers:r});return}let a=i.hasAttribute(`data-seqid`)?+i.getAttribute(`data-seqid`):-1;if(this.lastMouseOverSeqIdx!==a)if(this.lastMouseOverSeqIdx=a,this.mouseDownLoci!==void 0){let e=this.getLoci(a);this.hover(e,J1.Flag.None,J1.Flag.None,r)}else this.highlightQueue.next({seqIdx:a,buttons:t,button:n,modifiers:r})},this.mouseLeave=e=>{if(e.stopPropagation(),this.mouseDownLoci=void 0,this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1;let t=W1(e.nativeEvent),n=G1(e.nativeEvent),r=K1(e.nativeEvent);this.highlightQueue.next({seqIdx:-1,buttons:t,button:n,modifiers:r})}}get sequenceNumberPeriod(){return this.props.sequenceNumberPeriod===void 0?this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1:this.props.sequenceNumberPeriod}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe(gD(3*16.666,void 0,{leading:!0,trailing:!0})),e=>{let t=this.getLoci(e.seqIdx<0?void 0:e.seqIdx);this.hover(t,e.buttons,e.button,e.modifiers)}),this.subscribe(this.plugin.managers.structure.focus.behaviors.current,e=>{this.updateFocus(e?.loci),this.updateMarker()}),this.updateColors(),jx.Canvas3D.SetSettings.subscribe(this.plugin,()=>{this.updateColors(),this.updateMarker()});let e=this.plugin.customUIState.experimentalSequenceColorTheme;e&&this.subscribe(e,e=>{!e&&!this.customColorThemeWrapper||(this.customColorThemeWrapper=tct(this.plugin,e,()=>this.forceUpdate()),this.forceUpdate())})}updateColors(){this.plugin.canvas3d?(this.markerColors.highlighted=tE.toHexStyle(this.plugin.canvas3d.props.renderer.highlightColor),this.markerColors.selected=tE.toHexStyle(this.plugin.canvas3d.props.renderer.selectColor)):(this.markerColors.highlighted=t6.highlighted,this.markerColors.selected=t6.selected)}updateFocus(e){this.props.sequenceWrapper.markResidue(pq,`unfocus`),e&&this.props.sequenceWrapper.markResidue(e,`focus`)}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(e){if(e!==void 0){let t=this.props.sequenceWrapper.getLoci(e);if(!$.isEmpty(t))return t}}getSeqIdx(e){let t,n=e.target;return n&&n.getAttribute&&(t=n.hasAttribute(`data-seqid`)?+n.getAttribute(`data-seqid`):void 0),t}hover(e,t,n,r){let i={current:rJ.Loci.Empty,buttons:t,button:n,modifiers:r};if(e!==void 0&&!$.isEmpty(e)&&(i.current={loci:e},this.mouseDownLoci)){let t=this.mouseDownLoci.elements[0],n=e.elements[0],r=Math.min(K.min(t.indices),K.min(n.indices)),a=Math.max(K.max(t.indices),K.max(n.indices));i.current={loci:$(e.structure,[{unit:t.unit,indices:K.ofRange(r,a)}])}}this.plugin.behaviors.interaction.hover.next(i)}click(e,t,n,r){let i={current:rJ.Loci.Empty,buttons:t,button:n,modifiers:r};e!==void 0&&!$.isEmpty(e)&&(i.current={loci:e}),this.plugin.behaviors.interaction.click.next(i)}getBackgroundColor(e){let t=this.props.sequenceWrapper;return t.isHighlighted(e)&&this.markerColors.highlighted?this.markerColors.highlighted:t.isSelected(e)&&this.markerColors.selected?this.markerColors.selected:t.isFocused(e)&&this.markerColors.focused?this.markerColors.focused:this.customColorFunction?this.customColorFunction(e):``}getResidueClass(e,t){let n=this.props.sequenceWrapper,r=[n.residueClass(e)];return t.length>1&&r.push(e===0?`msp-sequence-residue-long-begin`:`msp-sequence-residue-long`),n.isHighlighted(e)&&r.push(`msp-sequence-residue-highlighted`),n.isSelected(e)&&r.push(`msp-sequence-residue-selected`),n.isFocused(e)&&r.push(`msp-sequence-residue-focused`),r.join(` `)}residue(e,t){return(0,I.jsx)(`span`,{"data-seqid":e,style:{backgroundColor:this.getBackgroundColor(e)},className:this.getResidueClass(e,t),children:`\u200b${t}\u200b`},e)}getSequenceNumberClass(e,t,n){let r=[`msp-sequence-number`];return t.startsWith(`-`)?n.length>1&&e>0?r.push(`msp-sequence-number-long-negative`):r.push(`msp-sequence-number-negative`):n.length>1&&e>0&&r.push(`msp-sequence-number-long`),r.join(` `)}getSequenceNumber(e){let t=``,n=this.props.sequenceWrapper.getLoci(e),r=$.getFirstLocation(n,this.location);return r&&(Q.isAtomic(r.unit)?t=`${Pz.residue.auth_seq_id(r)}${Pz.residue.pdbx_PDB_ins_code(r)||``}`:Q.isCoarse(r.unit)&&(t=`${e+1}`)),t}padSeqNum(e){return e.length<$st?e+Array($st-e.length+1).join(`\xA0`):e}getSequenceNumberSpan(e,t){let n=this.getSequenceNumber(e);return(0,I.jsx)(`span`,{className:this.getSequenceNumberClass(e,n,t),children:this.padSeqNum(n)},`marker-${e}`)}updateMarker(){if(!this.parentDiv.current)return;let e=this.parentDiv.current.children,t=!this.props.hideSequenceNumbers,n=this.sequenceNumberPeriod,r=this.props.sequenceWrapper,i=r.length,a=0;for(let o=0;o<i;o++){t&&o%n===0&&o<i&&a++;let s=e[a];if(!s)return;a++;let c=this.getResidueClass(o,r.residueLabel(o));s.className!==c&&(s.className=c);let l=this.getBackgroundColor(o);s.style.backgroundColor!==l&&(s.style.backgroundColor=l)}}render(){let e=this.props.sequenceWrapper,t=[];this.customColorThemeWrapper&&(this.customColorFunction=this.customColorThemeWrapper.getColorFunction(e));let n=!this.props.hideSequenceNumbers,r=this.sequenceNumberPeriod;for(let i=0,a=e.length;i<a;++i){let o=e.residueLabel(i);n&&i%r===0&&i<a&&(t[t.length]=this.getSequenceNumberSpan(i,o)),t[t.length]=this.residue(i,o)}return this.updateFocus(this.plugin.managers.structure.focus.behaviors.current.value?.loci),this.updateMarker(),(0,I.jsx)(`div`,{className:`msp-sequence-wrapper`,onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:t})}};function tct(e,t,n){let r=iL.create();function i(e,t,n){let i=e.getLoci(t);if(!i||$.isEmpty(i))return``;$.getFirstLocation(i,r);let a=n(r,!1);return a<0?``:tE.toHexStyle(a)}let a=gA(r=>{if(!t)return;let a=r.getLoci(0)?.structure;if(!a)return;let o,s=t.getProps?.call(t,{structure:a})??t.provider.defaultValues;t.provider.ensureCustomProperties?e.runTask(hb.create(`Attach custom properties for coloring theme`,async r=>{try{await t.provider.ensureCustomProperties?.attach({assetManager:e.managers.asset,runtime:r},{structure:a})}catch(e){console.warn(`Failed to attach custom properties needed for coloring theme ${t.provider.name}:`,e)}finally{o=t.provider.factory({structure:a},s).color,n()}})):o=t.provider.factory({structure:a},s).color;let c={};return e=>o?c[e]??(c[e]=i(r,e,o)):``});return{themeName:t?.provider.name,getColorFunction:a}}var n6=class{mark(e,t){let n=this.getSeqIndices(e);return K.size(n)===0?!1:fq(this.markerArray,n,t)}markResidue(e,t){return t===`focus`?this.markResidueFocus(e,!0):t===`unfocus`?this.markResidueFocus(e,!1):mq(e)?fq(this.markerArray,G.ofLength(this.length),t):this.mark(e,t)}markResidueFocus(e,t){let n=t?1:0;if(mq(e))return this.focusMarkerArray.fill(n,0,this.length),!0;{let t=this.getSeqIndices(e);return K.forEach(t,e=>this.focusMarkerArray[e]=n),K.size(t)>0}}isHighlighted(e){return!!(this.markerArray[e]&1)}isSelected(e){return!!(this.markerArray[e]&2)}isFocused(e){return!!this.focusMarkerArray[e]}constructor(e,t){this.data=e,this.length=t,this.markerArray=new Uint8Array(t),this.focusMarkerArray=new Uint8Array(t)}},nct=class extends n6{seqId(e){return this.sequence.seqId.value(e)}residueLabel(e){return this.sequence.label.value(e)||this.sequence.code.value(e)}residueColor(e){return this.missing.has(this.modelNum,this.asymId,this.seqId(e))?gk.grey:gk.black}residueClass(e){return this.missing.has(this.modelNum,this.asymId,this.seqId(e))?`msp-sequence-missing`:`msp-sequence-present`}getSeqIndices(e){let{structure:t}=this.data,n=e=>this.sequence.index(e);if($.is(e)){if(!nB.areRootsEquivalent(e.structure,t))return G.Empty;e=$.remap(e,t);let r=[];for(let t of e.elements)this.unitMap.has(t.unit.id)&&(Q.isAtomic(t.unit)?ict(r,t,n):act(r,t,n));return Vk.deduplicate(Vk.ofSortedArray(r))}else if(nB.isLoci(e))return nB.areRootsEquivalent(e.structure,t)?this.observed:G.Empty;return G.Empty}getLoci(e){let t=rct(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(e));return VR.toLociWithSourceUnits($R.run(t,this.data.structure))}constructor(e){let t=iL.create(e.structure,e.units[0],e.units[0].elements[0]),n=e.units[0].model.sequence.byEntityKey[Pz.entity.key(t)],r=n.sequence.length;super(e,r),this.unitMap=new Map;for(let t of e.units)this.unitMap.set(t.id,t);this.sequence=n.sequence,this.missing=e.units[0].model.properties.missingResidues,this.modelNum=e.units[0].model.modelNum,this.asymId=Q.isAtomic(e.units[0])?Pz.chain.label_asym_id(t):Pz.coarse.asym_id(t);let i=[];for(let e=0;e<r;++e)this.missing.has(this.modelNum,this.asymId,this.seqId(e))&&i.push(e);this.observed=K.subtract(G.ofBounds(0,r),Vk.ofSortedArray(i))}};function rct(e,t,n){return Wz.generators.atoms({unitTest:n=>Pz.unit.chainGroupId(n.element)===e&&Pz.unit.operator_name(n.element)===t,residueTest:e=>e.element.unit.kind===Q.Kind.Atomic?Pz.residue.label_seq_id(e.element)===n:Pz.coarse.seq_id_begin(e.element)<=n&&Pz.coarse.seq_id_end(e.element)>=n})}function ict(e,t,n){let{model:r,elements:i}=t.unit,{index:a}=r.atomicHierarchy.residueAtomSegments,{label_seq_id:o}=r.atomicHierarchy.residues;return K.forEachSegment(t.indices,e=>a[i[e]],t=>{let r=n(o.value(t));e.push(r)}),!0}function act(e,t,n){let{model:r,elements:i}=t.unit,a=Q.isSpheres(t.unit)?r.coarseHierarchy.spheres.seq_id_begin:r.coarseHierarchy.gaussians.seq_id_begin,o=Q.isSpheres(t.unit)?r.coarseHierarchy.spheres.seq_id_end:r.coarseHierarchy.gaussians.seq_id_end;return K.forEach(t.indices,t=>{let r=i[t];for(let t=n(a.value(r)),i=n(o.value(r));t<=i;t++)e.push(t)}),!0}var oct=class extends n6{residueLabel(e){return this.sequence[e]}residueColor(e){return gk.black}residueClass(e){return`msp-sequence-present`}getSeqIndices(e){let{structure:t}=this.data;if($.is(e)){if(!nB.areRootsEquivalent(e.structure,t))return G.Empty;e=$.remap(e,t);let n=[];for(let t of e.elements){let e=this.unitMap.get(t.unit.id);if(e){let{index:r}=t.unit.model.atomicHierarchy.residueAtomSegments;K.forEach(t.indices,t=>{let i=this.sequenceIndices.get(r[e.elements[t]]);i!==void 0&&n.push(i)})}}return Vk.deduplicate(Vk.ofSortedArray(n))}else if(nB.isLoci(e))return nB.areRootsEquivalent(e.structure,t)?G.ofBounds(0,this.length):G.Empty;return G.Empty}getLoci(e){let t=[],n=this.residueIndices.get(e);if(n!==void 0){let r=this.seqToUnit.get(e),{offsets:i}=r.model.atomicHierarchy.residueAtomSegments,a=Vk.findPredecessorIndex(r.elements,i[n]),o=Vk.findPredecessorIndex(r.elements,i[n+1]);t.push({unit:r,indices:G.ofBounds(a,o)})}return $(this.data.structure,t)}constructor(e){let t=[],n=new Map,r=new Map,i=new Map;for(let a=0,o=e.units.length;a<o;++a){let o=e.units[a],{residueAtomSegments:s,atoms:c}=o.model.atomicHierarchy,l=uA.transientSegments(s,o.elements);for(;l.hasNext;){let{index:e}=l.move();n.set(e,t.length),r.set(t.length,e),i.set(t.length,o),t.push(c.label_comp_id.value(s.offsets[e]))}}let a=t.length;super(e,a),this.unitMap=new Map;for(let t of e.units)this.unitMap.set(t.id,t);this.sequence=t,this.sequenceIndices=n,this.residueIndices=r,this.seqToUnit=i}},r6=class extends n6{residueLabel(e){return this.label}residueColor(e){return gk.black}residueClass(e){return`msp-sequence-present`}getSeqIndices(e){let{structure:t}=this.data;if($.is(e)){if(!nB.areRootsEquivalent(e.structure,t))return G.Empty;e=$.remap(e,t);for(let t of e.elements){let e=this.unitIndices.get(t.unit.id);if(e&&K.isSubset(e,t.indices))return G.ofSingleton(0)}}else if(nB.isLoci(e))return nB.areRootsEquivalent(e.structure,t)?G.ofSingleton(0):G.Empty;return G.Empty}getLoci(e){return this.loci}constructor(e){let t=0,n=0,r=[],i=iL.create(e.structure),a=new Map,o=[];for(let r=0,s=e.units.length;r<s;++r){let s=e.units[r];iL.set(i,e.structure,s,s.elements[0]);let c=s.model.sequence.byEntityKey[Pz.entity.key(i)];c&&(t+=c.sequence.length),n+=s.elements.length;let l=G.ofBounds(0,s.elements.length);a.set(s.id,l),o.push({unit:s,indices:l})}t>0&&r.push(`${t} residues`),r.push(`${n} elements`),super(e,1),this.label=`Whole Chain (${r.join(`, `)})`,this.unitIndices=a,this.loci=$(this.data.structure,o)}},sct=class extends n6{residueLabel(e){return`X`}residueColor(e){return gk.black}residueClass(e){return`msp-sequence-present`}getSeqIndices(e){let{structure:t,units:n}=this.data;if($.is(e)){if(!nB.areRootsEquivalent(e.structure,t))return G.Empty;e=$.remap(e,t);for(let t of e.elements){let e=this.unitIndices.get(t.unit.id);if(e&&K.isSubset(e,t.indices))return t.indices}}else if(nB.isLoci(e)){if(!nB.areRootsEquivalent(e.structure,t))return G.Empty;for(let e=0,t=n.length;e<t;++e)return this.unitIndices.get(n[e].id)}return G.Empty}getLoci(e){let{units:t}=this.data,n=[],r=0;for(let i=0,a=t.length;i<a;++i){let a=t[i];if(e<r+a.elements.length){n.push({unit:a,indices:G.ofSingleton(e-r)});break}r+=a.elements.length}return $(this.data.structure,n)}constructor(e){let t=0,n=new Map,r=[];for(let i=0,a=e.units.length;i<a;++i){let a=e.units[i];t+=a.elements.length;let o=G.ofBounds(0,a.elements.length);n.set(a.id,o),r.push({unit:a,indices:o})}super(e,t),this.unitIndices=n}},i6=5e3,a6=1e3,cct=30;function lct(e){let t=Pz.unit.pdbx_struct_oper_list_ids(e),n=Pz.unit.struct_ncs_oper_id(e),r=Pz.unit.hkl(e),i=Pz.unit.spgrOp(e);return`${t.sort().join(`,`)}|${n}|${r}|${i}`}function o6(e){let[t,n]=e.split(`|`);return[parseInt(t),n]}function uct(e,t){let{structure:n,modelEntityId:r,chainGroupId:i,operatorKey:a}=e,o=iL.create(n),[s,c]=o6(r),l=[];for(let e of n.units)iL.set(o,n,e,e.elements[0]),n.getModelIndex(e.model)===s&&Pz.entity.id(o)===c&&e.chainGroupId===i&&lct(o)===a&&l.push(e);if(l.length>0){let e={structure:n,units:l},r=l[0],i;if(r.polymerElements.length){let t=iL.create(n,r,r.elements[0]),a=r.model.sequence.byEntityKey[Pz.entity.key(t)];if(a&&a.sequence.length<=i6)i=new nct(e);else{let t=l.reduce((e,t)=>e+t.polymerElements.length,0);i=Q.isAtomic(r)||t>i6?new r6(e):new sct(e)}}else Q.isAtomic(r)?i=l.reduce((e,t)=>e+t.residueCount,0)>i6?new r6(e):new oct(e):(console.warn(`should not happen, expecting coarse units to be polymeric`),i=new r6(e));return i.markResidue(t.getLoci(n),lq.Select),i}else return`No sequence available`}function s6(e,t=!1){let n=[],r=iL.create(e),i=new Set;for(let a of e.units){iL.set(r,e,a,a.elements[0]);let o=Pz.entity.id(r),s=e.getModelIndex(a.model),c=`${s}|${o}`;if(i.has(c)||t&&Pz.entity.type(r)!==`polymer`)continue;let l=Pz.entity.pdbx_description(r).join(`, `);e.models.length&&(e.representativeModel?l+=` (Model ${e.models[s].modelNum})`:l.startsWith(`Polymer `)&&(l+=` (${e.models[s].entry})`));let u=`${o}: ${l}`;if(n.push([c,u]),i.add(c),n.length>a6)return[[``,`Too many entities`]]}return n.length===0&&n.push([``,`No entities`]),n}function c6(e,t){let n=[],r=iL.create(e),i=new Set,[a,o]=o6(t);for(let t of e.units){if(iL.set(r,e,t,t.elements[0]),e.getModelIndex(t.model)!==a||Pz.entity.id(r)!==o)continue;let s=t.chainGroupId;if(i.has(s))continue;let c=IJ(r,{granularity:`chain`,hidePrefix:!0,htmlStyling:!1});if(n.push([s,c]),i.add(s),n.length>a6)return[[-1,`Too many chains`]]}return n.length===0&&n.push([-1,`No chains`]),n}function l6(e,t,n){let r=[],i=iL.create(e),a=new Set,[o,s]=o6(t);for(let t of e.units){if(iL.set(i,e,t,t.elements[0]),e.getModelIndex(t.model)!==o||Pz.entity.id(i)!==s||t.chainGroupId!==n)continue;let c=lct(i);if(a.has(c))continue;let l=t.conformation.operator.name;if(r.push([c,l]),a.add(c),r.length>a6)return[[``,`Too many operators`]]}return r.length===0&&r.push([``,`No operators`]),r}function dct(e){let t=[],n=[],r=e.select(FE.Generators.rootsOfType(H.Molecule.Structure));for(let e of r)e.obj?.data&&(n.push(e.obj.data),t.push([e.transform.ref,e.obj.data.label]));return t.length===0&&t.push([``,`No structure`]),{options:t,all:n}}var u6=V.Select(`single`,[[`single`,`Chain`],[`polymers`,`Polymers`],[`all`,`Everything`]]),fct=class extends qX{constructor(){super(...arguments),this.state={structureOptions:{options:[],all:[]},structure:nB.Empty,structureRef:``,modelEntityId:``,chainGroupId:-1,operatorKey:``,mode:`single`,sequenceViewModeParam:u6},this.setParamProps=e=>{let t={...this.state};switch(e.name){case`mode`:if(t.mode=e.value,this.state.mode===t.mode)return;if(t.mode===`all`||t.mode===`polymers`)break;case`structure`:e.name===`structure`&&(t.structureRef=e.value),t.structure=this.getStructure(t.structureRef),t.modelEntityId=s6(t.structure)[0][0],t.chainGroupId=c6(t.structure,t.modelEntityId)[0][0],t.operatorKey=l6(t.structure,t.modelEntityId,t.chainGroupId)[0][0];break;case`entity`:t.modelEntityId=e.value,t.chainGroupId=c6(t.structure,t.modelEntityId)[0][0],t.operatorKey=l6(t.structure,t.modelEntityId,t.chainGroupId)[0][0];break;case`chain`:t.chainGroupId=e.value,t.operatorKey=l6(t.structure,t.modelEntityId,t.chainGroupId)[0][0];break;case`operator`:t.operatorKey=e.value;break}this.setState(t)}}componentDidMount(){this.plugin.state.data.select(FE.Generators.rootsOfType(H.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:e,obj:t})=>{e===this.state.structureRef&&t&&t.type===H.Molecule.Structure.type&&t.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:e})=>{e&&e.type===H.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:e})=>{e&&e.type===H.Molecule.Structure.type&&this.sync()});let e=this.plugin.spec.components?.sequenceViewer?.modeOptions;if(e){let t=new Set(e),n={...u6,options:u6.options.filter(([e])=>t.has(e))};this.setState({sequenceViewModeParam:n})}}sync(){jE(dct(this.plugin.state.data).all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(e){let t=this.plugin.state.data.select(e)[0];return!e||!t||!t.obj?nB.Empty:t.obj.data}getSequenceWrapper(e){return{wrapper:uct(this.state,this.plugin.managers.structure.selection),label:`${V.optionLabel(e.chain,this.state.chainGroupId)} | ${V.optionLabel(e.entity,this.state.modelEntityId)}`}}getSequenceWrappers(e){if(this.state.mode===`single`)return[this.getSequenceWrapper(e)];let t=this.getStructure(this.state.structureRef),n=[];for(let[e,r]of s6(t,this.state.mode===`polymers`))for(let[i,a]of c6(t,e))for(let[o]of l6(t,e,i))if(n.push({wrapper:uct({structure:t,modelEntityId:e,chainGroupId:i,operatorKey:o},this.plugin.managers.structure.selection),label:`${a} | ${r}`}),n.length>cct)return[];return n}getInitialState(){let e=dct(this.plugin.state.data),t=e.options[0][0],n=this.getStructure(t),r=s6(n)[0][0],i=c6(n,r)[0][0],a=l6(n,r,i)[0][0];this.state.structure&&this.state.structure===n&&(r=this.state.modelEntityId,i=this.state.chainGroupId,a=this.state.operatorKey);let o=this.plugin.spec.components?.sequenceViewer?.defaultMode,s=this.props.defaultMode??o??`single`;return{structureOptions:e,structure:n,structureRef:t,modelEntityId:r,chainGroupId:i,operatorKey:a,mode:s,sequenceViewModeParam:this.state.sequenceViewModeParam}}get params(){let{structureOptions:e,structure:t,modelEntityId:n,chainGroupId:r}=this.state,i=s6(t),a=c6(t,n),o=l6(t,n,r);return{structure:V.Select(e.options[0][0],e.options,{shortLabel:!0}),entity:V.Select(i[0][0],i,{shortLabel:!0}),chain:V.Select(a[0][0],a,{shortLabel:!0,twoColumns:!0,label:`Chain`}),operator:V.Select(o[0][0],o,{shortLabel:!0,twoColumns:!0}),mode:this.state.sequenceViewModeParam}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===nB.Empty)return(0,I.jsx)(`div`,{className:`msp-sequence`,children:(0,I.jsxs)(`div`,{className:`msp-sequence-select`,children:[(0,I.jsx)(XY,{svg:xX,style:{cursor:`help`,position:`absolute`,right:0,top:0},title:`Shows a sequence of one or more chains. Use the controls to alter selection.`}),(0,I.jsx)(`span`,{children:`Sequence`}),(0,I.jsx)(`span`,{style:{fontWeight:`normal`},children:`No structure available`})]})});let e=this.params,t=this.values,n=this.getSequenceWrappers(e);return(0,I.jsxs)(`div`,{className:`msp-sequence`,children:[(0,I.jsxs)(`div`,{className:`msp-sequence-select`,children:[(0,I.jsx)(XY,{svg:xX,style:{cursor:`help`,position:`absolute`,right:0,top:0},title:`This shows a single sequence. Use the controls to show a different sequence. 
Use Ctrl or Cmd key to add a sequence range to focus; use Shift key to extend last focused/selected range.`}),(0,I.jsx)(`span`,{children:`Sequence of`}),(0,I.jsx)(u4,{title:`[Structure] ${V.optionLabel(e.structure,t.structure)}`,param:e.structure,name:`structure`,value:t.structure,onChange:this.setParamProps}),(0,I.jsx)(u4,{title:`[Mode]`,param:this.state.sequenceViewModeParam,name:`mode`,value:t.mode,onChange:this.setParamProps}),t.mode===`single`&&(0,I.jsx)(u4,{title:`[Entity] ${V.optionLabel(e.entity,t.entity)}`,param:e.entity,name:`entity`,value:t.entity,onChange:this.setParamProps}),t.mode===`single`&&(0,I.jsx)(u4,{title:`[Chain] ${V.optionLabel(e.chain,t.chain)}`,param:e.chain,name:`chain`,value:t.chain,onChange:this.setParamProps}),e.operator.options.length>1&&(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(u4,{title:`[Instance] ${V.optionLabel(e.operator,t.operator)}`,param:e.operator,name:`operator`,value:t.operator,onChange:this.setParamProps})})]}),(0,I.jsx)(pct,{children:n.map((e,n)=>{let r=typeof e.wrapper==`string`?(0,I.jsx)(`div`,{className:`msp-sequence-wrapper`,children:e.wrapper},n):(0,I.jsx)(ect,{sequenceWrapper:e.wrapper},n);return t.mode===`single`?r:(0,I.jsxs)(y.Fragment,{children:[(0,I.jsx)(`div`,{className:`msp-sequence-chain-label`,children:e.label}),r]},n)})})]})}};function pct({children:e}){return(0,I.jsx)(`div`,{className:`msp-sequence-wrapper-non-empty`,children:e})}function mct(){let e=(0,y.useContext)(KX),[t,n]=(0,y.useState)(Nw());return(0,y.useEffect)(()=>{let t=e.events.task.progress.subscribe(t=>{let r=!!e.spec.components?.hideTaskOverlay;t.level===`background`&&(r||!t.useOverlay)&&n(e=>e.set(t.id,t))}),r=e.events.task.finished.subscribe(({id:e})=>{n(t=>t.delete(e))});return()=>{t.unsubscribe(),r.unsubscribe()}},[e]),(0,I.jsxs)(`div`,{className:`msp-background-tasks`,children:[t.valueSeq().map(e=>(0,I.jsx)(gct,{event:e},e.id)),(0,I.jsx)(hct,{})]})}function hct(){let e=$3((0,y.useContext)(KX).canvas3d?.commitQueueSize);return e?(0,I.jsx)(`div`,{className:`msp-task-state`,children:(0,I.jsx)(`div`,{children:(0,I.jsxs)(`div`,{children:[`Commiting renderables... `,e,` remaining`]})})}):null}var gct=class extends qX{constructor(){super(...arguments),this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,`User Request`)}}render(){let e=this.props.event.progress.root,t=_ct(this.props.event.progress.root)-1,n=e.progress.isIndeterminate?void 0:(0,I.jsxs)(I.Fragment,{children:[`[`,e.progress.current,`/`,e.progress.max,`]`]}),r=t>0?(0,I.jsxs)(I.Fragment,{children:[`[`,t,` subtask(s)]`]}):void 0;return(0,I.jsx)(`div`,{className:`msp-task-state`,children:(0,I.jsxs)(`div`,{children:[e.progress.canAbort&&(0,I.jsx)(HX,{svg:mX,onClick:this.abort,title:`Abort`}),(0,I.jsxs)(`div`,{children:[e.progress.message,` `,n,` `,r]})]})})}};function _ct(e){if(e.children.length===0)return 1;let t=0;for(let n of e.children)t+=_ct(n);return t}function vct(){let e=(0,y.useContext)(KX),[t,n]=(0,y.useState)(Nw());return(0,y.useEffect)(()=>{let t=e.events.task.progress.subscribe(e=>{e.useOverlay&&n(t=>t.set(e.id,e))}),r=e.events.task.finished.subscribe(({id:e})=>{n(t=>t.delete(e))});return()=>{t.unsubscribe(),r.unsubscribe()}},[e]),t.size===0?null:(0,I.jsx)(`div`,{className:`msp-overlay-tasks`,children:t.valueSeq().map(e=>(0,I.jsx)(gct,{event:e},e.id))})}var yct=class extends qX{constructor(){super(...arguments),this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){let e=this.props.entry,t=typeof e.message==`string`?(0,I.jsx)(`div`,{dangerouslySetInnerHTML:{__html:e.message}}):(0,I.jsx)(`div`,{children:(0,I.jsx)(e.message,{})});return(0,I.jsxs)(`div`,{className:`msp-toast-entry`,children:[(0,I.jsx)(`div`,{className:`msp-toast-title`,onClick:()=>this.hide(),children:e.title}),(0,I.jsx)(`div`,{className:`msp-toast-message`,children:t}),(0,I.jsx)(`div`,{className:`msp-toast-clear`}),(0,I.jsx)(`div`,{className:`msp-toast-hide`,children:(0,I.jsx)(HX,{svg:mX,onClick:this.hide,title:`Hide`,className:`msp-no-hover-outline`})})]})}},bct=class extends qX{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){let e=this.plugin.managers.toast.state;if(!e.entries.count())return null;let t=[];return e.entries.forEach((e,n)=>t.push(e)),t.sort(function(e,t){return e.serialNumber-t.serialNumber}),(0,I.jsx)(`div`,{className:`msp-toast-container`,children:t.map(e=>(0,I.jsx)(yct,{entry:e},e.serialNumber))})}},xct=class extends qX{constructor(){super(...arguments),this.container=y.createRef(),this.mounted=!1,this.state={noWebGl:!1,showLogo:!0},this.handleLogo=()=>{this.setState({showLogo:!this.plugin.canvas3d?.reprCount.value})}}async applyMount(){try{let e=await this.plugin.mountAsync(this.container.current,{checkeredCanvasBackground:!0});if(!this.mounted)return;e||this.setState({noWebGl:!0}),this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)}catch(e){console.error(e),this.setState({noWebGl:!0})}}componentDidMount(){if(this.mounted=!0,!this.container.current){this.setState({noWebGl:!0});return}this.applyMount()}componentWillUnmount(){this.mounted=!1,super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){if(this.props.noWebGl){let e=this.props.noWebGl;return(0,I.jsx)(e,{})}return(0,I.jsx)(`div`,{className:`msp-no-webgl`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`p`,{children:(0,I.jsx)(`b`,{children:`WebGL does not seem to be available.`})}),(0,I.jsx)(`p`,{children:`This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser.`}),(0,I.jsxs)(`p`,{children:[`For a list of supported browsers, refer to `,(0,I.jsx)(`a`,{href:`http://caniuse.com/#feat=webgl`,target:`_blank`,children:`http://caniuse.com/#feat=webgl`}),`.`]})]})})}render(){if(this.state.noWebGl)return this.renderMissing();let e=this.props.logo;return(0,I.jsx)(`div`,{className:this.props.parentClassName||`msp-viewport`,style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&e&&(0,I.jsx)(e,{})})}};const Sct=y.memo(e=>{let{plugin:t,cropFrameColor:n}=e,r=t.helpers.viewportScreenshot,[i,a]=(0,y.useState)(null),o=(0,y.useRef)(null),s=(0,y.useRef)(e);return(0,y.useEffect)(()=>{s.current=e},Object.values(e)),(0,y.useEffect)(()=>{i!==o.current&&a(o.current)}),(0,y.useEffect)(()=>{let e=!1,n=[];function i(e,t){e&&n.push(e.subscribe(t))}function a(){let n=s.current;!n.suspend&&o.current&&Cct(t,r,o.current,n.customBackground,n.borderColor,n.borderWidth),o.current||(e=!0)}let c=setInterval(()=>{e&&(e=!1,a())},1e3/8);i(t.events.canvas3d.settingsUpdated,()=>e=!0),i(t.canvas3d?.didDraw,()=>e=!0),i(t.state.data.behaviors.isUpdating,t=>{t||(e=!0)}),i(r?.behaviors.values,()=>e=!0),i(r?.behaviors.cropParams,()=>e=!0);let l;typeof ResizeObserver<`u`&&(l=new ResizeObserver(()=>e=!0));let u=o.current;return l?.observe(u),a(),()=>{clearInterval(c),n.forEach(e=>e.unsubscribe()),l?.unobserve(u)}},[r]),(0,y.useLayoutEffect)(()=>{o.current&&Cct(t,r,o.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)(`div`,{style:{position:`relative`,width:`100%`,height:`100%`},children:[(0,I.jsx)(`canvas`,{ref:o,onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},style:{display:`block`,width:`100%`,height:`100%`}}),(0,I.jsx)(wct,{plugin:t,canvas:i,color:n})]})})},(e,t)=>HT(e,t));async function Cct(e,t,n,r,i,a){let o=hb.create(`Render Screenshot`,async e=>{if(!t)return;let o=await t.getPreview(e);if(!o)return;let s=n.getContext(`2d`);if(!s)return;let{canvas:c,width:l,height:u}=o,d=n.clientWidth,f=n.clientHeight;n.width=d,n.height=f,s.clearRect(0,0,d,f);let p=Ect(l,u,d,f);if(r)s.fillStyle=r,s.fillRect(p.x,p.y,p.width,p.height);else if(t.values.transparent)for(let e=0;e<p.width;e+=13)for(let t=0;t<p.height;t+=13){s.fillStyle=(e+t)%2?`#ffffff`:`#bfbfbf`;let n=p.x+e,r=p.y+t,i=e+13>p.width?p.width-e:13,a=t+13>p.height?p.height-t:13;s.fillRect(n,r,i,a)}if(s.drawImage(c,p.x,p.y,p.width,p.height),i&&a){let e=a;s.rect(p.x,p.y,p.width,p.height),s.rect(p.x+e,p.y+e,p.width-2*e,p.height-2*e),s.fillStyle=i,s.fill(`evenodd`)}});return e.runTask(o,{useOverlay:!0})}function wct({plugin:e,canvas:t,color:n=`rgba(255, 87, 45, 0.75)`}){let r=e.helpers.viewportScreenshot,i=$3(r?.behaviors.values),a=$3(r?.behaviors.cropParams),o=$3(r?.behaviors.relativeCrop),s=(0,y.useRef)({x:0,y:0,width:0,height:0});$3(i?.resolution.name===`viewport`?e.canvas3d?.resized:void 0);let[c,l]=y.useState(``),[u,d]=(0,y.useState)([0,0]),[f,p]=(0,y.useState)([0,0]);if(!r||!t||!o)return null;let{width:m,height:h}=r.getSizeAndViewport(),g=Ect(m,h,t.clientWidth,t.clientHeight),_={x:g.x+Math.floor(g.width*o.x),y:g.y+Math.floor(g.height*o.y),width:Math.ceil(g.width*o.width),height:Math.ceil(g.height*o.height)},v=Tct(_),b=Tct(g);if(c===`move`?(v.l+=f[0]-u[0],v.r+=f[0]-u[0],v.t+=f[1]-u[1],v.b+=f[1]-u[1]):c&&(c.indexOf(`left`)>=0?v.l+=f[0]-u[0]:c.indexOf(`right`)>=0&&(v.r+=f[0]-u[0]),c.indexOf(`top`)>=0?v.t+=f[1]-u[1]:c.indexOf(`bottom`)>=0&&(v.b+=f[1]-u[1])),v.l>v.r){let e=v.l;v.l=v.r,v.r=e}if(v.t>v.b){let e=v.t;v.t=v.b,v.b=e}v.l=Math.min(b.r-40,Math.max(b.l,v.l)),v.r=Math.max(b.l+40,Math.min(b.r,v.r)),v.t=Math.min(b.b-40,Math.max(b.t,v.t)),v.b=Math.max(b.t+40,Math.min(b.b,v.b)),_.x=v.l,_.y=v.t,_.width=v.r-v.l+1,_.height=v.b-v.t+1,s.current=_;let x=e=>{e.preventDefault(),p([e.pageX,e.pageY])},S=e=>{e.preventDefault();let t=e.touches[0];p([t.pageX,t.pageY])},C=e=>{e.preventDefault(),l(e.currentTarget.getAttribute(`data-drag`));let t=e.touches[0],n=[t.pageX,t.pageY];d(n),p(n),window.addEventListener(`touchend`,E),window.addEventListener(`touchmove`,S)},w=e=>{e.preventDefault(),l(e.currentTarget.getAttribute(`data-drag`));let t=[e.pageX,e.pageY];d(t),p(t),window.addEventListener(`mouseup`,T),window.addEventListener(`mousemove`,x)},T=()=>{window.removeEventListener(`mouseup`,T),window.removeEventListener(`mousemove`,x),D()},E=()=>{window.removeEventListener(`touchend`,E),window.removeEventListener(`touchmove`,S),D()};function D(){let e=s.current;a?.auto&&r?.behaviors.cropParams.next({...a,auto:!1}),r?.behaviors.relativeCrop.next({x:(e.x-g.x)/g.width,y:(e.y-g.y)/g.height,width:e.width/g.width,height:e.height/g.height}),l(``);let t=[0,0];d(t),p(t)}let O=e=>{e.preventDefault(),e.stopPropagation()},k=`3px solid ${n}`,A=`transparent`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(`div`,{"data-drag":`move`,style:{position:`absolute`,left:_.x,top:_.y,width:_.width,height:_.height,border:k,cursor:`move`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`left`,style:{position:`absolute`,left:_.x-4,top:_.y+4,width:16,height:_.height-4,background:A,cursor:`w-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`right`,style:{position:`absolute`,left:v.r-8,top:_.y,width:16,height:_.height-4,background:A,cursor:`w-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`top`,style:{position:`absolute`,left:_.x-4,top:_.y-4,width:_.width+8,height:16,background:A,cursor:`n-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`bottom`,style:{position:`absolute`,left:_.x-4,top:v.b-8,width:_.width+8,height:16,background:A,cursor:`n-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`top, left`,style:{position:`absolute`,left:v.l-4,top:v.t-4,width:16,height:16,background:A,cursor:`nw-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`bottom, right`,style:{position:`absolute`,left:v.r-8,top:v.b-8,width:16,height:16,background:A,cursor:`nw-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`top, right`,style:{position:`absolute`,left:v.r-8,top:v.t-4,width:16,height:16,background:A,cursor:`ne-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O}),(0,I.jsx)(`div`,{"data-drag":`bottom, left`,style:{position:`absolute`,left:v.l-4,top:v.b-8,width:16,height:16,background:A,cursor:`ne-resize`},onMouseDown:w,onTouchStart:C,draggable:!1,onContextMenu:O})]})}function Tct(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function Ect(e,t,n,r){let i=e/t;if(i<=n/r){let e=r*i;return{x:Math.round((n-e)/2),y:0,width:Math.round(e),height:r}}else{let e=n/i;return{x:0,y:Math.round((r-e)/2),width:n,height:Math.round(e)}}}function Dct(e,t){return e===`orthographic`?1/(2*Math.tan(t/2)):1/(2*Math.sin(t/2))}function Oct(e,t,n,r){let i=B.sub(B(),t,e),a=Dct(n,r)||1;return B.scaleAndAdd(i,e,i,1/a)}var kct=class extends qX{constructor(){super(...arguments),this.state={showPreview:!0,isDisabled:!1},this.download=()=>{var e;(e=this.plugin.helpers.viewportScreenshot)==null||e.download(),this.props.close()},this.copy=async()=>{try{await this.plugin.helpers.viewportScreenshot?.copyToClipboard(),jx.Toast.Show(this.plugin,{message:`Copied to clipboard.`,title:`Screenshot`,timeoutMs:1500})}catch{return this.copyImg()}},this.copyImg=async()=>{let e=await this.plugin.helpers.viewportScreenshot?.getImageDataUri();this.setState({imageData:e})},this.open=e=>{!e.target.files||!e.target.files[0]||jx.State.Snapshots.OpenFile(this.plugin,{file:e.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,e=>{this.setState({isDisabled:e})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){let e=!!navigator.clipboard?.write;return(0,I.jsxs)(`div`,{children:[this.state.showPreview&&(0,I.jsxs)(`div`,{className:`msp-image-preview`,children:[(0,I.jsx)(Sct,{plugin:this.plugin}),(0,I.jsx)(Nct,{plugin:this.plugin})]}),(0,I.jsxs)(`div`,{className:`msp-flex-row`,children:[!this.state.imageData&&(0,I.jsx)(VX,{icon:KWe,onClick:e?this.copy:this.copyImg,disabled:this.state.isDisabled,children:`Copy`}),this.state.imageData&&(0,I.jsx)(VX,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:`Clear`}),(0,I.jsx)(VX,{icon:bX,onClick:this.download,disabled:this.state.isDisabled,children:`Download`})]}),this.state.imageData&&(0,I.jsxs)(`div`,{className:`msp-row msp-copy-image-wrapper`,children:[(0,I.jsx)(`div`,{children:`Right click below + Copy Image`}),(0,I.jsx)(`img`,{src:this.state.imageData,style:{width:`100%`,height:32,display:`block`}})]}),(0,I.jsx)(Mct,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,I.jsxs)(WX,{header:`State`,children:[(0,I.jsx)(Fst,{onAction:this.props.close}),(0,I.jsx)(WX,{header:`Save Options`,initiallyExpanded:!1,noOffset:!0,children:(0,I.jsx)(Ist,{})})]}),(0,I.jsx)(WX,{header:`Camera`,children:(0,I.jsx)(jct,{plugin:this.plugin})})]})}};function d6(e){return`${e?.map(e=>Sx(e,2)).join(`, `)}`}function f6({title:e,children:t}){return(0,I.jsxs)(`div`,{className:`msp-control-row`,children:[(0,I.jsx)(`span`,{className:`msp-control-row-label`,children:e}),(0,I.jsx)(`div`,{className:`msp-control-row-text`,style:{fontSize:`0.85rem`,overflow:`hidden`,whiteSpace:`nowrap`},children:t})]})}function Act(e){if(e)return Oct(e.target,e.position,e.mode,e.fov)}function jct({plugin:e}){let[,t]=(0,y.useState)({});(0,y.useEffect)(()=>{let n=e.canvas3d?.didDraw.subscribe(()=>t({}));return()=>n?.unsubscribe()},[e]);let n=e.canvas3d?.camera.state,r=Act(n),i=B.sub(B(),n?.target??B.origin,n?.position??B.origin);return B.normalize(i,i),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(f6,{title:`Position`,children:d6(n?.position)}),(0,I.jsx)(f6,{title:`FoV Norm. Pos.`,children:d6(r)}),(0,I.jsx)(f6,{title:`Target`,children:d6(n?.target)}),(0,I.jsx)(f6,{title:`Direction`,children:d6(i)}),(0,I.jsx)(f6,{title:`Up`,children:d6(n?.up)}),(0,I.jsx)(f6,{title:`Distance`,children:Sx(B.distance(n?.position??B.origin,n?.target??B.origin),2)}),(0,I.jsx)(f6,{title:`Radius`,children:Sx(n?.radius??0,2)}),(0,I.jsx)(VX,{onClick:()=>{if(!navigator.clipboard)return;let e=`{
    position: [${r?.map(e=>Sx(e,2)).join(`, `)}],
    target: [${n?.target.map(e=>Sx(e,2)).join(`, `)}],
    up: [${n?.up.map(e=>Sx(e,2)).join(`, `)}],
}`;navigator.clipboard.writeText(e)},style:{marginTop:1},title:`Copy JSON usable in MolViewSpec, uses FoV Normalized Position`,children:`Copy MVS JSON`})]})}function Mct({plugin:e,isDisabled:t}){let n=e.helpers.viewportScreenshot,r=$3(n?.behaviors.values);return n?(0,I.jsx)(a4,{params:n.params,values:r,onChangeValues:e=>n.behaviors.values.next(e),isDisabled:t}):null}function Nct({plugin:e}){let t=e.helpers.viewportScreenshot,n=$3(t?.behaviors.cropParams);return $3(t?.behaviors.relativeCrop),!t||!n?null:(0,I.jsxs)(`div`,{style:{width:`100%`,height:`24px`,marginTop:`8px`},children:[(0,I.jsx)(UX,{icon:QWe,title:`Auto-crop`,inline:!0,isSelected:n.auto,style:{background:`transparent`,float:`left`,width:`auto`,height:`24px`,lineHeight:`24px`},toggle:()=>t.toggleAutocrop(),label:`Auto-crop `+(n.auto?`On`:`Off`)}),!n.auto&&(0,I.jsx)(VX,{icon:JWe,title:`Crop`,style:{background:`transparent`,float:`right`,height:`24px`,lineHeight:`24px`,width:`24px`,padding:`0`},onClick:()=>t.autocrop()}),!n.auto&&!t.isFullFrame&&(0,I.jsx)(VX,{icon:XWe,title:`Reset Crop`,style:{background:`transparent`,float:`right`,height:`24px`,lineHeight:`24px`,width:`24px`,padding:`0`},onClick:()=>t.resetCrop()})]})}function Pct(e){return({values:t,update:n,apply:r})=>({params:typeof e.params==`function`?e.params:t=>e.params,getTarget:e.target,getValues:t,update(t,r){return vD(e.target(r),e=>n(t,e,r))},apply:r||(()=>{})})}var Fct=class extends qX{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(gD(500,void 0,{leading:!0,trailing:!0})),e=>{(e.radiusMax!==void 0||e.radius!==void 0)&&this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(K7e,{mapping:Lct}),(0,I.jsx)(j4,{})]}):null}},p6={sequence:`Sequence`,log:`Log`,left:`Left Panel`,right:`Right Panel`},Ict={animate:W0.trackball.params.animate,camera:W0.camera,background:V.Group({color:V.Color(tE(16579577),{label:`Background`,description:`Custom background color`}),transparent:V.Boolean(!1),style:W0.postprocessing.params.background},{pivot:`color`}),lighting:V.Group({occlusion:W0.postprocessing.params.occlusion,shadow:W0.postprocessing.params.shadow,outline:W0.postprocessing.params.outline,dof:W0.postprocessing.params.dof,fog:W0.cameraFog},{isFlat:!0}),clipping:V.Group({...W0.cameraClipping.params},{pivot:`radius`}),layout:V.MultiSelect([],V.objectToOptions(p6)),advanced:V.Group({illumination:W0.illumination,multiSample:W0.multiSample,hiZ:W0.hiZ,sharpening:W0.postprocessing.params.sharpening,bloom:W0.postprocessing.params.bloom,resolutionMode:K0.Params.resolutionMode,pixelScale:K0.Params.pixelScale,transparency:K0.Params.transparency})},Lct=Pct({params:e=>{let t=V.clone(Ict),n=e.spec.components?.controls;if(n){let e=[];n.top!==`none`&&e.push([`sequence`,p6.sequence]),n.bottom!==`none`&&e.push([`log`,p6.log]),n.left!==`none`&&e.push([`left`,p6.left]),n.right!==`none`&&e.push([`right`,p6.right]),t.layout.options=e}let r=e.config.get(WQ.Background.Styles)||[];return r.length>0&&Object.assign(t.background.params.style,{presets:UT(r),isFlat:!1}),t},target(e){let t=e.spec.components?.controls,n=e.layout.state.regionState,r=[];n.top!==`hidden`&&(!t||t.top!==`none`)&&r.push(`sequence`),n.bottom!==`hidden`&&(!t||t.bottom!==`none`)&&r.push(`log`),n.left!==`hidden`&&(!t||t.left!==`none`)&&r.push(`left`),n.right!==`hidden`&&(!t||t.right!==`none`)&&r.push(`right`);let{pixelScale:i,transparency:a,resolutionMode:o}=e.canvas3dContext?.props;return{canvas:e.canvas3d?.props,layout:r,resolutionMode:o,pixelScale:i,transparency:a}}})({values(e,t){let{canvas:n}=e,r=n.renderer;return{layout:e.layout,animate:n.trackball.animate,camera:n.camera,background:{color:r.backgroundColor,transparent:n.transparentBackground,style:n.postprocessing.background},lighting:{occlusion:n.postprocessing.occlusion,shadow:n.postprocessing.shadow,outline:n.postprocessing.outline,dof:n.postprocessing.dof,fog:n.cameraFog},clipping:{...n.cameraClipping},advanced:{illumination:n.illumination,multiSample:n.multiSample,hiZ:n.hiZ,sharpening:n.postprocessing.sharpening,bloom:n.postprocessing.bloom,resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){let n=t.canvas;n.trackball.animate=e.animate,n.camera=e.camera,n.transparentBackground=e.background.transparent,n.renderer.backgroundColor=e.background.color,n.postprocessing.occlusion=e.lighting.occlusion,n.postprocessing.shadow=e.lighting.shadow,n.postprocessing.outline=e.lighting.outline,n.postprocessing.background=e.background.style,n.cameraFog=e.lighting.fog,n.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},n.illumination=e.advanced.illumination,n.multiSample=e.advanced.multiSample,n.hiZ=e.advanced.hiZ,n.postprocessing.sharpening=e.advanced.sharpening,n.postprocessing.bloom=e.advanced.bloom,n.postprocessing.dof=e.lighting.dof,t.layout=e.layout,t.resolutionMode=e.advanced.resolutionMode,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},async apply(e,t){var n;await jx.Canvas3D.SetSettings(t,{settings:e.canvas});let r=e.layout.indexOf(`left`)<0,i=vD(t.layout.state,n=>{n.regionState.top=e.layout.indexOf(`sequence`)>=0?`full`:`hidden`,n.regionState.bottom=e.layout.indexOf(`log`)>=0?`full`:`hidden`,n.regionState.left=r?`hidden`:t.behaviors.layout.leftPanelTabName.value===`none`?`collapsed`:`full`,n.regionState.right=e.layout.indexOf(`right`)>=0?`full`:`hidden`});await jx.Layout.Update(t,{state:i}),r&&jx.State.SetCurrentObject(t,{state:t.state.data,ref:yE.RootRef}),(n=t.canvas3dContext)==null||n.setProps({resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency})}}),Rct=class extends qX{constructor(){super(...arguments),this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},this.state={...this.allCollapsedState,isCameraResetEnabled:!0},this.resetCamera=()=>{jx.Camera.Reset(this.plugin,{})},this.toggleSettingsExpanded=this.toggle(`isSettingsExpanded`),this.toggleScreenshotExpanded=this.toggle(`isScreenshotExpanded`),this.toggleControls=()=>{jx.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})},this.toggleExpanded=()=>{jx.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded,expandToFullscreen:!1}})},this.toggleFullscreen=()=>{jx.Layout.Update(this.plugin,{state:{expandToFullscreen:!this.plugin.layout.state.expandToFullscreen}})},this.toggleXR=()=>{this.plugin.canvas3d&&(this.plugin.canvas3d.xr.isPresenting.value?this.plugin.canvas3d.xr.end():this.plugin.canvas3d.xr.request())},this.toggleIllumination=()=>{this.plugin.canvas3d&&jx.Canvas3D.SetSettings(this.plugin,{settings:{illumination:{...this.plugin.canvas3d.props.illumination,enabled:!this.plugin.canvas3d.props.illumination.enabled}}})},this.setSettings=e=>{jx.Canvas3D.SetSettings(this.plugin,{settings:{[e.name]:e.value}})},this.setLayout=e=>{jx.Layout.Update(this.plugin,{state:{[e.name]:e.value}})},this.screenshot=()=>{var e;(e=this.plugin.helpers.viewportScreenshot)==null||e.download()},this.enableCameraReset=e=>{this.setState(t=>({...t,isCameraResetEnabled:e}))}}toggle(e){return t=>{this.setState(t=>({...t,...this.allCollapsedState,[e]:!this.state[e]})),t?.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&(this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(gD(500,void 0,{leading:!0,trailing:!0})),e=>this.enableCameraReset(e.radius!==0&&e.radiusMax!==0)),this.subscribe(this.plugin.canvas3d.xr.isSupported,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.xr.isPresenting,()=>this.forceUpdate()))}icon(e,t,n,r=!0,i=!1){return(0,I.jsx)(HX,{svg:e,toggleState:r,onClick:t,title:n,style:{background:`transparent`},disabled:i})}render(){let e=this.plugin.config.get(WQ.Viewport.ShowXR),t=!!this.plugin.canvas3d?.xr.isSupported.value,n=!!this.plugin.canvas3d?.xr.isPresenting.value,r=e===`always`||e===`auto`&&t,i=t?n?`Exit XR`:`Enter XR`:`Augmented/Virtual Reality unavailable`,a=this.plugin.layout.state;return(0,I.jsxs)(`div`,{className:`msp-viewport-controls`,children:[(0,I.jsxs)(`div`,{className:`msp-viewport-controls-buttons`,children:[this.plugin.config.get(WQ.Viewport.ShowReset)&&(0,I.jsxs)(`div`,{className:`msp-hover-box-wrapper`,children:[(0,I.jsx)(`div`,{className:`msp-semi-transparent-background`}),this.icon(bWe,this.resetCamera,`Reset Zoom`),(0,I.jsx)(`div`,{className:`msp-hover-box-body`,children:(0,I.jsxs)(`div`,{className:`msp-flex-column`,children:[(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:`Set camera zoom to fit the visible scene into view`,children:`Reset Zoom`})}),(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{onClick:()=>jx.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:`Align principal component axes of the loaded structures to the screen axes (lay flat)`,children:`Orient Axes`})}),(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{onClick:()=>jx.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:`Align Cartesian axes to the screen axes`,children:`Reset Axes`})})]})}),(0,I.jsx)(`div`,{className:`msp-hover-box-spacer`})]}),this.plugin.config.get(WQ.Viewport.ShowScreenshotControls)&&(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-semi-transparent-background`}),this.icon(jWe,this.toggleScreenshotExpanded,`Screenshot / State Snapshot`,this.state.isScreenshotExpanded)]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-semi-transparent-background`}),this.plugin.config.get(WQ.Viewport.ShowControls)&&this.icon(DWe,this.toggleControls,`Toggle Controls Panel`,this.plugin.layout.state.showControls),this.plugin.config.get(WQ.Viewport.ShowExpand)&&(0,I.jsxs)(`div`,{className:`msp-hover-box-wrapper`,children:[this.icon(iGe,this.toggleExpanded,`Toggle Expanded Viewport`,this.plugin.layout.state.isExpanded),(0,I.jsx)(`div`,{className:`msp-hover-box-body`,children:(0,I.jsx)(`div`,{className:`msp-flex-column`,children:(0,I.jsx)(`div`,{className:`msp-flex-row`,children:(0,I.jsx)(VX,{onClick:this.toggleFullscreen,children:a.expandToFullscreen?`Exit Fullscreen`:`Fullscreen`})})})}),(0,I.jsx)(`div`,{className:`msp-hover-box-spacer`})]}),!this.plugin.config.get(WQ.Viewport.ShowExpand)&&this.plugin.config.get(WQ.Viewport.ShowToggleFullscreen)&&this.icon(SWe,this.toggleFullscreen,`Toggle Full Screen`,this.plugin.layout.state.expandToFullscreen),this.plugin.config.get(WQ.Viewport.ShowSettings)&&this.icon(MX,this.toggleSettingsExpanded,`Settings / Controls Info`,this.state.isSettingsExpanded),this.plugin.config.get(WQ.Viewport.ShowIllumination)&&this.icon(PGe,this.toggleIllumination,`Illumination`,this.plugin.canvas3d?.props.illumination.enabled||!1),r&&this.icon(IGe,this.toggleXR,i,n,!t)]}),this.plugin.config.get(WQ.Viewport.ShowSelectionMode)&&(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`msp-semi-transparent-background`}),(0,I.jsx)(M4,{})]})]}),this.state.isScreenshotExpanded&&(0,I.jsx)(`div`,{className:`msp-viewport-controls-panel`,children:(0,I.jsx)(LX,{header:`Screenshot / State`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:_X,noTopMargin:!0,childrenClassName:`msp-viewport-controls-panel-controls`,children:(0,I.jsx)(kct,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,I.jsx)(`div`,{className:`msp-viewport-controls-panel`,children:(0,I.jsx)(LX,{header:`Settings / Controls Info`,title:`Click to close.`,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:_X,noTopMargin:!0,childrenClassName:`msp-viewport-controls-panel-controls`,children:(0,I.jsx)(Fct,{})})})]})}};const zct=()=>(0,I.jsx)(`a`,{className:`msp-logo`,href:`https://molstar.org`,target:`_blank`}),Bct=()=>(0,I.jsx)(xct,{logo:zct});var Vct=s({DownloadFile:()=>Hct,OpenFiles:()=>h6});async function m6(e,t,n,r){let i=W2(e.file?.name??``),a=t.dataFormats.binaryExtensions.has(i.ext),{data:o}=await t.builders.data.readFile({file:e,isBinary:a}),s=n===`auto`?t.dataFormats.auto(i,o.cell?.obj):t.dataFormats.get(n);if(!s){t.log.warn(`OpenFiles: could not find data provider for '${i.ext}'`),await t.state.data.build().delete(o).commit();return}let c=await s.parse(t,o);r&&await s.visuals?.call(s,t,c)}const h6=cE.build({display:{name:`Open Files`,description:`Load one or more files and optionally create default visuals`},from:H.Root,params:(e,t)=>{let{extensions:n,options:r}=t.dataFormats;return{files:V.FileList({accept:Array.from(n.values()).map(e=>`.${e}`).join(`,`)+`,.gz,.zip`,multiple:!0}),format:V.MappedStatic(`auto`,{auto:V.EmptyGroup(),specific:V.Select(r[0][0],r)}),visuals:V.Boolean(!0,{description:`Add default visuals`})}}})(({params:e,state:t},n)=>hb.create(`Open Files`,async r=>{n.behaviors.layout.leftPanelTabName.next(`data`),await t.transaction(async()=>{if(e.files===null){n.log.error(`No file(s) selected`);return}for(let t of e.files)try{if(t.file&&t.name.toLowerCase().endsWith(`.zip`)){let i=await Zb(r,await t.file.arrayBuffer());for(let[t,r]of Object.entries(i))!(r instanceof Uint8Array)||r.length===0||await m6(gx.File(new File([r],t)),n,`auto`,e.visuals)}else await m6(t,n,e.format.name===`auto`?`auto`:e.format.params,e.visuals)}catch(e){console.error(e),n.log.error(`Error opening file '${t.name}'`)}}).runInContext(r)})),Hct=cE.build({display:{name:`Download File`,description:`Load one or more file from an URL`},from:H.Root,params:(e,t)=>{let n=[...t.dataFormats.options,[`zip`,`Zip`],[`gzip`,`Gzip`]];return{url:V.Url(``),format:V.Select(n[0][0],n),isBinary:V.Boolean(!1),visuals:V.Boolean(!0,{description:`Add default visuals`})}}})(({params:e,state:t},n)=>hb.create(`Open Files`,async r=>{n.behaviors.layout.leftPanelTabName.next(`data`),await t.transaction(async()=>{try{if(e.format===`zip`||e.format===`gzip`){let t=await n.builders.data.download({url:e.url,isBinary:!0});if(e.format===`zip`){let i=await Zb(r,(t.obj?.data).buffer);for(let[t,r]of Object.entries(i))!(r instanceof Uint8Array)||r.length===0||await m6(gx.File(new File([r],t)),n,`auto`,e.visuals)}else{let r=W2(gx.getUrl(e.url)).name;await m6(gx.File(new File([t.obj?.data],r)),n,`auto`,e.visuals)}}else{let t=n.dataFormats.get(e.format);if(!t){n.log.warn(`DownloadFile: could not find data provider for '${e.format}'`);return}let r=await n.builders.data.download({url:e.url,isBinary:e.isBinary}),i=await t.parse(n,r);e.visuals&&await t.visuals?.call(t,n,i)}}catch(t){console.error(t),n.log.error(`Error downloading '${typeof e.url==`string`?e.url:e.url.url}'`)}}).runInContext(r)}));function Uct({plugin:e}){return e.isInitialized?(0,I.jsx)(KX.Provider,{value:e,children:(0,I.jsx)(Gct,{})}):(0,I.jsx)(Wct,{plugin:e})}function Wct({plugin:e}){let[t,n]=y.useState({kind:`pending`});return y.useEffect(()=>{n({kind:`pending`});let t=!0;return e.initialized.then(()=>{t&&n({kind:`initialized`})}).catch(e=>{t&&n({kind:`error`,message:`${e}`})}),()=>{t=!1}},[e]),t.kind===`pending`?null:t.kind===`error`?(0,I.jsx)(`div`,{className:`msp-plugin`,children:(0,I.jsxs)(`div`,{className:`msp-plugin-init-error`,children:[`Initialization error: `,t.message]})}):(0,I.jsx)(KX.Provider,{value:e,children:(0,I.jsx)(Gct,{})})}var Gct=class extends qX{constructor(){super(...arguments),this.onDrop=e=>{e.preventDefault();let t=[];if(e.dataTransfer.items)for(let n=0;n<e.dataTransfer.items.length;n++){if(e.dataTransfer.items[n].kind!==`file`)continue;let r=e.dataTransfer.items[n].getAsFile();r&&t.push(r)}else for(let n=0;n<e.dataTransfer.files.length;n++){let r=e.dataTransfer.files[n];r&&t.push(r)}let n=t.filter(e=>{let t=e.name.toLowerCase();return t.endsWith(`.molx`)||t.endsWith(`.molj`)});n.length>0?jx.State.Snapshots.OpenFile(this.plugin,{file:n[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(h6,{files:t.map(e=>gx.File(e)),format:{name:`auto`,params:{}},visuals:!0}))},this.onDragOver=e=>{e.preventDefault()},this.showDragOverlay=new cD(!1),this.onDragEnter=e=>{let t=!1;if(e.dataTransfer.items&&e.dataTransfer.items.length>0){for(let n=0;n<e.dataTransfer.items.length;n++)if(e.dataTransfer.items[n].kind===`file`){t=!0;break}}else for(let n=0;n<e.dataTransfer.types.length;n++)if(e.dataTransfer.types[n]===`Files`){t=!0;break}t&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(e,t){return(0,I.jsx)(`div`,{className:`msp-layout-region msp-layout-${e}`,children:(0,I.jsx)(`div`,{className:`msp-layout-static`,children:t?(0,I.jsx)(t,{}):null})})}get layoutVisibilityClassName(){let e=this.plugin.layout.state,t=this.plugin.spec.components?.controls??{},n=[];return(t.top===`none`||!e.showControls||e.regionState.top===`hidden`)&&n.push(`msp-layout-hide-top`),t.left===`none`||!e.showControls||e.regionState.left===`hidden`?n.push(`msp-layout-hide-left`):e.regionState.left===`collapsed`&&n.push(`msp-layout-collapse-left`),(t.right===`none`||!e.showControls||e.regionState.right===`hidden`)&&n.push(`msp-layout-hide-right`),(t.bottom===`none`||!e.showControls||e.regionState.bottom===`hidden`)&&n.push(`msp-layout-hide-bottom`),n.join(` `)}get layoutClassName(){let e=this.plugin.layout.state,t=[`msp-plugin-content`];return e.isExpanded?t.push(`msp-layout-expanded`):t.push(`msp-layout-standard`,`msp-layout-standard-${e.controlsDisplay}`),t.join(` `)}render(){let e=this.plugin.layout.state,t=this.plugin.spec.components?.controls||{},n=this.plugin.spec.components?.viewport?.view||Yct,r=this.plugin.spec.components?.sequenceViewer?.view||fct;return(0,I.jsx)(`div`,{className:`msp-plugin`,children:(0,I.jsxs)(`div`,{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,I.jsxs)(`div`,{className:this.layoutVisibilityClassName,children:[this.region(`main`,n),e.showControls&&t.top!==`none`&&this.region(`top`,t.top||r),e.showControls&&t.left!==`none`&&this.region(`left`,t.left||Yst),e.showControls&&t.right!==`none`&&this.region(`right`,t.right||Jct),e.showControls&&t.bottom!==`none`&&this.region(`bottom`,t.bottom||Xct)]}),!this.plugin.spec.components?.hideTaskOverlay&&(0,I.jsx)(vct,{}),!this.plugin.spec.components?.disableDragOverlay&&(0,I.jsx)(qct,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}};function Kct(e,t,n){e.preventDefault(),e.stopPropagation(),n.next(!1);let r=[];if(e.dataTransfer.items)for(let t=0;t<e.dataTransfer.items.length;t++){if(e.dataTransfer.items[t].kind!==`file`)continue;let n=e.dataTransfer.items[t].getAsFile();n&&r.push(n)}else for(let t=0;t<e.dataTransfer.files.length;t++){let n=e.dataTransfer.files[t];n&&r.push(n)}t.managers.dragAndDrop.handle(r)}function qct({plugin:e,showDragOverlay:t}){let n=$3(t),r=e=>{e.dataTransfer.dropEffect=`copy`,e.preventDefault(),e.stopPropagation()};return(0,I.jsx)(`div`,{className:`msp-drag-drop-overlay`,style:{display:n?`flex`:`none`},onDragEnter:r,onDragOver:r,onDragLeave:()=>t.next(!1),onDrop:n=>Kct(n,e,t),children:`Load File(s)`})}var Jct=class extends qX{render(){return(0,I.jsx)(`div`,{className:`msp-scrollable-container`,children:(0,I.jsx)(this.plugin.spec.components?.structureTools||Mst,{})})}},Yct=class extends qX{render(){let e=this.plugin.spec.components?.viewport?.controls||Rct,t=this.plugin.spec.components?.selectionTools?.controls||kst,n=this.plugin.spec.components?.viewport?.snapshotDescription||Dst;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Bct,{}),(0,I.jsxs)(`div`,{className:`msp-viewport-top-left-controls`,children:[(0,I.jsx)(Ost,{}),(0,I.jsx)(Tst,{}),(0,I.jsx)(Est,{}),(0,I.jsx)(n,{})]}),(0,I.jsx)(t,{}),(0,I.jsx)(e,{}),(0,I.jsx)(mct,{}),(0,I.jsxs)(`div`,{className:`msp-highlight-toast-wrapper`,children:[(0,I.jsx)(Ast,{}),(0,I.jsx)(bct,{})]})]})}},Xct=class extends qX{constructor(){super(...arguments),this.wrapper=y.createRef(),this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){let e=this.wrapper.current;e&&(e.scrollTop=e.scrollHeight-e.clientHeight-1)}render(){let e=this.state.entries,t=e.size,n=[];for(let r=Math.max(0,t-10),i=0;r<t;r++){let t=e.get(r);n.push((0,I.jsxs)(`li`,{children:[(0,I.jsx)(`div`,{className:`msp-log-entry-badge msp-log-entry-`+t.type}),(0,I.jsx)(`div`,{className:`msp-log-timestamp`,children:bde(t.timestamp)}),(0,I.jsx)(`div`,{className:`msp-log-entry`,children:t.message})]},i++))}return(0,I.jsx)(`div`,{ref:this.wrapper,className:`msp-log`,style:{position:`absolute`,top:`0`,right:`0`,bottom:`0`,left:`0`,overflowY:`auto`},children:(0,I.jsx)(`ul`,{className:`msp-list-unstyled`,children:n})})}},g6;(function(e){class t{constructor(){this.providers=Nw().asMutable(),this.defaultAutoAttachValues=new Map}getParams(e){let t={},n=[],r=[];if(e){let i=this.providers.values();for(;;){let a=i.next();if(a.done)break;let o=a.value;o.isApplicable(e)&&(o.isHidden||(n.push([o.descriptor.name,o.label]),this.defaultAutoAttachValues.get(o.descriptor.name)&&r.push(o.descriptor.name)),t[o.descriptor.name]=V.Group({...o.getParams(e)},{label:o.label,isHidden:o.isHidden}))}}return{autoAttach:V.MultiSelect(r,n),properties:V.Group(t,{isFlat:!0})}}setDefaultAutoAttach(e,t){this.defaultAutoAttachValues.set(e,t)}get(e){if(!this.providers.get(e))throw Error(`Custom property '${e}' is not registered.`);return this.providers.get(e)}register(e,t){this.providers.set(e.descriptor.name,e),this.defaultAutoAttachValues.set(e.descriptor.name,t)}unregister(e){this.providers.delete(e),this.defaultAutoAttachValues.delete(e)}}e.Registry=t})(g6||={});var Zct=class{get dataState(){return this.plugin.state.data}rawData(e,t){return this.dataState.build().toRoot().apply(Pve,e,t).commit({revertOnError:!0})}download(e,t){return this.dataState.build().toRoot().apply(jve,e,t).commit({revertOnError:!0})}downloadBlob(e,t){return this.dataState.build().toRoot().apply(Mve,e,t).commit({revertOnError:!0})}async readFile(e,t){return{data:await this.dataState.build().toRoot().apply(Fve,e,t).commit({revertOnError:!0}),fileInfo:W2(e.file?.file?.name??``)}}constructor(e){this.plugin=e}},Qct=class{get dataState(){return this.plugin.state.data}resolveProvider(e){return typeof e==`string`?I2[e]??px(this._providers,t=>t.id===e):e}hasPreset(e){for(let t of this._providers)if(!t.isApplicable||t.isApplicable(e,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(e){if(!e)return this.providers;let t=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push(n);return t}getPresetSelect(e){let t=[];for(let n of this._providers)e&&n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push([n.id,n.display.name,n.display.group]);return V.Select(`auto`,t)}getPresetsWithOptions(e){let t=[],n=Object.create(null);for(let r of this._providers)r.isApplicable&&!r.isApplicable(e,this.plugin)||(t.push([r.id,r.display.name]),n[r.id]=r.params?V.Group(r.params(e,this.plugin)):V.EmptyGroup());return t.length===0?V.MappedStatic(``,{"":V.EmptyGroup()}):V.MappedStatic(t[0][0],n,{options:t})}registerPreset(e){if(this.providerMap.has(e.id))throw Error(`Representation provider with id '${e.id}' already registered.`);this._providers.push(e),this.providerMap.set(e.id,e)}unregisterPreset(e){this.providerMap.delete(e.id),EE(this._providers,e)}applyPreset(e,t,n){let r=this.resolveProvider(t);if(!r)return;let i=this.plugin.state.data,a=Fx.resolveAndCheck(i,e);if(!a){Zy||console.warn(`Applying structure repr. provider to bad cell.`);return}let o=r.params?.call(r,a.obj,this.plugin)||{},s=n||(r.params?V.getDefaultValues(o):{}),c=this.plugin.config.get(WQ.Structure.DefaultRepresentationPresetParams);s=V.merge(o,c,s);let l=hb.create(`${r.display.name}`,()=>r.apply(a,s,this.plugin));return this.plugin.runTask(l)}async addRepresentation(e,t,n){let r=this.dataState.build(),i=this.buildRepresentation(r,e,t,n);if(i)return await r.commit(),i}buildRepresentation(e,t,n,r){if(!t)return;let i=Fx.resolveAndCheck(this.dataState,t)?.obj?.data;if(!i)return;let a=R1(this.plugin,i,n);return r?.tag?e.to(t).applyOrUpdateTagged(r.tag,PY,a,{state:r?.initialState}).selector:e.to(t).apply(PY,a,{state:r?.initialState}).selector}constructor(e){this.plugin=e,this._providers=[],this.providerMap=new Map,this.defaultProvider=I2.auto,WT(I2,e=>this.registerPreset(e))}};function _6(e){return e}(function(e){e.CommonParams=(e,t)=>({modelProperties:V.Optional(V.Group(lE.getParamDefinition(IY.Model.CustomModelProperties,void 0,t))),structureProperties:V.Optional(V.Group(lE.getParamDefinition(IY.Model.CustomStructureProperties,void 0,t))),representationPreset:V.Optional(V.Text(`auto`))})})(_6||={});var v6=_6.CommonParams,$ct=_6({id:`preset-trajectory-default`,display:{name:`Default (Assembly)`,group:`Preset`,description:`Shows the first assembly or, if that is unavailable, the first model.`},isApplicable:e=>!0,params:(e,t)=>({model:V.Optional(V.Group(lE.getParamDefinition(IY.Model.ModelFromTrajectory,e,t))),showUnitcell:V.Optional(V.Boolean(!1)),structure:V.Optional(WH.getParams(void 0,`assembly`).type),representationPresetParams:V.Optional(V.Group(A2.CommonParams)),...v6(e,t)}),async apply(e,t,n){let r=n.builders.structure,i=await r.createModel(e,t.model),a=await r.insertModelProperties(i,t.modelProperties),o=await r.createStructure(a||i,t.structure),s=await r.insertStructureProperties(o,t.structureProperties),c=t.showUnitcell===void 0||t.showUnitcell?await r.tryCreateUnitcell(a,void 0,{isHidden:!0}):void 0,l=t.representationPreset||n.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id;return{model:i,modelProperties:a,unitcell:c,structure:o,structureProperties:s,representation:await n.builders.structure.representation.applyPreset(s,l,t.representationPresetParams)}}}),elt=_6({id:`preset-trajectory-all-models`,display:{name:`All Models`,group:`Preset`,description:`Shows all models; colored by trajectory-index.`},isApplicable:e=>e.data.frameCount>1,params:(e,t)=>({useDefaultIfSingleModel:V.Optional(V.Boolean(!1)),representationPresetParams:V.Optional(V.Group(A2.CommonParams)),...v6(e,t)}),async apply(e,t,n){let r=Fx.resolveAndCheck(n.state.data,e)?.obj?.data;if(!r)return{};if(r.frameCount===1&&t.useDefaultIfSingleModel)return $ct.apply(e,t,n);let i=n.builders.structure,a=[],o=[];for(let s=0;s<r.frameCount;s++){let c=await i.createModel(e,{modelIndex:s}),l=await i.insertModelProperties(c,t.modelProperties,{isCollapsed:!0}),u=await i.createStructure(l||c,{name:`model`,params:{}}),d=await i.insertStructureProperties(u,t.structureProperties);a.push(c),o.push(u);let f=u.obj?Tq(u.obj.data,{elementCountFactor:r.frameCount}):`medium`,p=t.representationPreset||n.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id;await i.representation.applyPreset(d,p,{theme:{globalName:`trajectory-index`},quality:f})}return{models:a,structures:o}}}),tlt=(e,t)=>({model:V.Optional(V.Group(lE.getParamDefinition(IY.Model.ModelFromTrajectory,e,t))),...v6(e,t)});async function nlt(e,t,n,r){let i=r.builders.structure,a=await i.createModel(t,n.model),o=await i.insertModelProperties(a,n.modelProperties),s=await i.createStructure(o||a,{name:`symmetry`,params:e}),c=await i.insertStructureProperties(s,n.structureProperties),l=await i.tryCreateUnitcell(o,void 0,{isHidden:!1}),u=n.representationPreset||r.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id;return{model:a,modelProperties:o,unitcell:l,structure:s,structureProperties:c,representation:await r.builders.structure.representation.applyPreset(c,u,{theme:{globalName:e.theme}})}}var rlt=_6({id:`preset-trajectory-unitcell`,display:{name:`Unit Cell`,group:`Preset`,description:`Shows the fully populated unit cell.`},isApplicable:e=>DB.hasCrystalSymmetry(e.data.representative),params:tlt,async apply(e,t,n){return await nlt({ijkMin:B.create(0,0,0),ijkMax:B.create(0,0,0)},e,t,n)}}),ilt=_6({id:`preset-trajectory-supercell`,display:{name:`Super Cell`,group:`Preset`,description:`Shows the super cell, i.e. the central unit cell and all adjacent unit cells.`},isApplicable:e=>DB.hasCrystalSymmetry(e.data.representative),params:tlt,async apply(e,t,n){return await nlt({ijkMin:B.create(-1,-1,-1),ijkMax:B.create(1,1,1),theme:`operator-hkl`},e,t,n)}}),alt=_6({id:`preset-trajectory-crystal-contacts`,display:{name:`Crystal Contacts`,group:`Preset`,description:`Showsasymetric unit and chains from neighbours within 5 , i.e., symmetry mates.`},isApplicable:e=>DB.hasCrystalSymmetry(e.data.representative),params:(e,t)=>({model:V.Optional(V.Group(lE.getParamDefinition(IY.Model.ModelFromTrajectory,e,t))),...v6(e,t)}),async apply(e,t,n){let r=n.builders.structure,i=await r.createModel(e,t.model),a=await r.insertModelProperties(i,t.modelProperties),o=await r.createStructure(a||i,{name:`symmetry-mates`,params:{radius:5}}),s=await r.insertStructureProperties(o,t.structureProperties),c=await r.tryCreateUnitcell(a,void 0,{isHidden:!0}),l=t.representationPreset||n.config.get(WQ.Structure.DefaultRepresentationPreset)||I2.auto.id;return{model:i,modelProperties:a,unitcell:c,structure:o,structureProperties:s,representation:await n.builders.structure.representation.applyPreset(s,l,{theme:{globalName:`operator-name`,carbonColor:`operator-name`,focus:{name:`element-symbol`,params:{carbonColor:{name:`operator-name`,params:JW.defaultValues}}}}})}}});const y6={default:$ct,"all-models":elt,unitcell:rlt,supercell:ilt,crystalContacts:alt};var olt=class{resolveProvider(e){return typeof e==`string`?y6[e]??px(this._providers,t=>t.id===e):e}hasPreset(e){for(let t of this._providers)if(!t.isApplicable||t.isApplicable(e,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(e){if(!e)return this.providers;let t=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push(n);return t}getPresetSelect(e){let t=[];for(let n of this._providers)e&&n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push([n.id,n.display.name]);return V.Select(`auto`,t)}getPresetsWithOptions(e){let t=[],n=Object.create(null);for(let r of this._providers)r.isApplicable&&!r.isApplicable(e,this.plugin)||(t.push([r.id,r.display.name]),n[r.id]=r.params?V.Group(r.params(e,this.plugin)):V.EmptyGroup());return t.length===0?V.MappedStatic(``,{"":V.EmptyGroup()}):V.MappedStatic(t[0][0],n,{options:t})}registerPreset(e){if(this.providerMap.has(e.id))throw Error(`Hierarchy provider with id '${e.id}' already registered.`);this._providers.push(e),this.providerMap.set(e.id,e)}unregisterPreset(e){this.providerMap.delete(e.id),EE(this._providers,e)}applyPreset(e,t,n){let r=this.resolveProvider(t);if(!r)return;let i=this.plugin.state.data,a=Fx.resolveAndCheck(i,e);if(!a){Zy||console.warn(`Applying hierarchy preset provider to bad cell.`);return}let o=n||(r.params?V.getDefaultValues(r.params(a.obj,this.plugin)):{}),s=hb.create(`${r.display.name}`,()=>r.apply(a,o,this.plugin));return this.plugin.runTask(s)}constructor(e){this.plugin=e,this._providers=[],this.providerMap=new Map,this.defaultProvider=y6.default,WT(y6,e=>this.registerPreset(e))}},slt=class{get dataState(){return this.plugin.state.data}async parseTrajectoryData(e,t){let n=typeof t==`string`?this.plugin.dataFormats.get(t):t;if(!n)throw Error(`'${t}' is not a supported data format.`);let{trajectory:r}=await n.parse(this.plugin,e);return r}parseTrajectoryBlob(e,t){return this.dataState.build().to(e).apply(IY.Data.ParseBlob,t,{state:{isGhost:!0}}).apply(IY.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(e,t){let n=Fx.resolveAndCheck(this.dataState,e);if(!n)throw Error(`Invalid data cell.`);return H.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(e,t):this.parseTrajectoryData(e,t)}createModel(e,t,n){return this.dataState.build().to(e).apply(IY.Model.ModelFromTrajectory,t||{modelIndex:0},{state:n}).commit({revertOnError:!0})}insertModelProperties(e,t,n){return this.dataState.build().to(e).apply(IY.Model.CustomModelProperties,t,{state:n}).commit({revertOnError:!0})}tryCreateUnitcell(e,t,n){let r=this.dataState,i=Fx.resolveAndCheck(r,e)?.obj?.data;if(!i)return;let a=bB.Provider.get(i)?.spacegroup.cell;if(!oA.isZero(a))return r.build().to(e).apply(IY.Representation.ModelUnitcell3D,t,{state:n}).commit({revertOnError:!0})}createStructure(e,t,n,r){let i=this.dataState;if(!t){let n=Fx.resolveAndCheck(i,e);if(n){let e=bB.Provider.get(n.obj?.data);(!e||e?.assemblies.length===0)&&(t={name:`model`,params:{}})}}return i.build().to(e).apply(IY.Model.StructureFromModel,{type:t||{name:`assembly`,params:{}}},{state:n,tags:r}).commit({revertOnError:!0})}insertStructureProperties(e,t){return this.dataState.build().to(e).apply(IY.Model.CustomStructureProperties,t).commit({revertOnError:!0})}isComponentTransform(e){return e.transform.transformer===IY.Model.StructureComponent}async tryCreateComponent(e,t,n,r){let i=this.dataState,a=i.build().to(e),o=`structure-component-${n}`,s=a.applyOrUpdateTagged(o,IY.Model.StructureComponent,t,{tags:r?[...r,o]:[o]});await s.commit();let c=s.selector;if(!c.isOk||(c.cell?.obj)?.data.elementCount===0){await i.build().delete(c.ref).commit();return}return c}tryCreateComponentFromExpression(e,t,n,r){return this.tryCreateComponent(e,{type:{name:`expression`,params:t},nullIfEmpty:!0,label:(r?.label||``).trim()},n,r?.tags)}tryCreateComponentStatic(e,t,n){return this.tryCreateComponent(e,{type:{name:`static`,params:t},nullIfEmpty:!0,label:(n?.label||``).trim()},`static-${t}`,n?.tags)}tryCreateComponentFromSelection(e,t,n,r){return this.plugin.runTask(hb.create(`Query Component`,async i=>{let{label:a,tags:o}=r||{};a=(a||``).trim();let s=Fx.resolveAndCheck(this.dataState,e)?.obj?.data;if(!s)return;let c=t.referencesCurrent?{type:{name:`bundle`,params:qR.fromSelection(await t.getSelection(this.plugin,i,s))},nullIfEmpty:!0,label:a||t.label}:{type:{name:`expression`,params:t.expression},nullIfEmpty:!0,label:a||t.label};return t.ensureCustomProperties&&await t.ensureCustomProperties({runtime:i,assetManager:this.plugin.managers.asset,errorContext:this.plugin.errorContext},s),this.tryCreateComponent(e,c,n,o)}))}constructor(e){this.plugin=e,this.hierarchy=new olt(this.plugin),this.representation=new Qct(this.plugin)}},clt;(function(e){function t(e){let{name:t}=e;return{descriptor:e,get(e){return e._propertyData[t]},set(n,r){n.customProperties.add(e),n._propertyData[t]=r}}}e.create=t})(clt||={});var b6;(function(e){e.Descriptor={name:`recommended_iso_value`},e.Provider=clt.create(e.Descriptor)})(b6||={});const x6=`Volume`;async function S6(e,t){if(!t)return;let{entryId:n}=t;if(!(!n||!n.toLowerCase().startsWith(`emd`)))return e.runTask(hb.create(`Try Set Recommended IsoValue`,async r=>{try{let i=await vtt(e,r,n);b6.Provider.set(t,zP.IsoValue.absolute(i))}catch(e){console.warn(e)}}))}function llt(e){let t=b6.Provider.get(e);if(t)return t.kind===`relative`?t:zP.adjustedIsoValue(e,t.absoluteValue,`absolute`)}async function C6(e,t){let n={},r=t.volume.data&&llt(t.volume.data);return r&&(n.isoValue=r),[await e.build().to(t.volume).apply(IY.Representation.VolumeRepresentation3D,I4(e,t.volume.data,{type:`isosurface`,typeParams:n})).commit()]}const ult=L2({label:`CCP4/MRC/MAP`,description:`CCP4/MRC/MAP`,category:x6,binaryExtensions:[`ccp4`,`mrc`,`map`],parse:async(e,t,n)=>{let r=e.build().to(t).apply(IY.Data.ParseCcp4,{},{state:{isGhost:!0}}),i=r.apply(IY.Volume.VolumeFromCcp4,{entryId:n?.entryId});return await r.commit({revertOnError:!0}),await S6(e,i.selector.data),{format:r.selector,volume:i.selector}},visuals:C6}),dlt=L2({label:`DSN6/BRIX`,description:`DSN6/BRIX`,category:x6,binaryExtensions:[`dsn6`,`brix`],parse:async(e,t,n)=>{let r=e.build().to(t).apply(IY.Data.ParseDsn6,{},{state:{isGhost:!0}}),i=r.apply(IY.Volume.VolumeFromDsn6,{entryId:n?.entryId});return await r.commit({revertOnError:!0}),await S6(e,i.selector.data),{format:r.selector,volume:i.selector}},visuals:C6}),flt=L2({label:`DX`,description:`DX`,category:x6,stringExtensions:[`dx`],binaryExtensions:[`dxbin`],parse:async(e,t,n)=>{let r=e.build().to(t).apply(IY.Data.ParseDx,{},{state:{isGhost:!0}}).apply(IY.Volume.VolumeFromDx,{entryId:n?.entryId});return await r.commit({revertOnError:!0}),await S6(e,r.selector.data),{volume:r.selector}},visuals:C6}),plt=L2({label:`Cube`,description:`Cube`,category:x6,stringExtensions:[`cub`,`cube`],parse:async(e,t,n)=>{let r=e.build().to(t).apply(IY.Data.ParseCube,{},{state:{isGhost:!0}}),i=r.apply(IY.Volume.VolumeFromCube,{entryId:n?.entryId}),a=r.apply(IY.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(IY.Model.ModelFromTrajectory).apply(IY.Model.StructureFromModel);return await r.commit({revertOnError:!0}),await S6(e,i.selector.data),{format:r.selector,volume:i.selector,structure:a.selector}},visuals:async(e,t)=>{let n=e.build(),r=[],i=t.volume.cell?.obj?.data;if(i&&zP.isOrbitals(i)){let a=n.to(t.volume).apply(IY.Representation.VolumeRepresentation3D,I4(e,i,{type:`isosurface`,typeParams:{isoValue:zP.IsoValue.relative(1),alpha:.4},color:`uniform`,colorParams:{value:gk.blue}})),o=n.to(t.volume).apply(IY.Representation.VolumeRepresentation3D,I4(e,i,{type:`isosurface`,typeParams:{isoValue:zP.IsoValue.relative(-1),alpha:.4},color:`uniform`,colorParams:{value:gk.red}}));r.push(a.selector,o.selector)}else{let a=n.to(t.volume).apply(IY.Representation.VolumeRepresentation3D,I4(e,i,{type:`isosurface`,typeParams:{isoValue:zP.IsoValue.relative(2),alpha:.4},color:`uniform`,colorParams:{value:gk.grey}}));r.push(a.selector)}let a=await e.builders.structure.representation.applyPreset(t.structure,`auto`);await n.commit();let o=[];return WT(a?.representations,e=>{e&&o.push(e)}),[...r,...o]}}),mlt=L2({label:`DensityServer CIF`,description:`DensityServer CIF`,category:x6,stringExtensions:[`cif`],binaryExtensions:[`bcif`],isApplicable:(e,t)=>R2(e,t)===`dscif`,parse:async(e,t,n)=>{let r=await e.build().to(t).apply(IY.Data.ParseCif).commit(),i=e.build().to(r),a=r.obj.data.blocks;if(a.length===0)throw Error(`no data blocks`);let o=[],s=0;for(let e of a){if(e.header.toUpperCase()===`SERVER`)continue;let t=Array.isArray(n?.entryId)?n?.entryId[s]:n?.entryId;e.categories.volume_data_3d_info?.rowCount>0&&(o.push(i.apply(IY.Volume.VolumeFromDensityServerCif,{blockHeader:e.header,entryId:t}).selector),s++)}await i.commit();for(let t of o)await S6(e,t.data);return{volumes:o}},visuals:async(e,t)=>{let{volumes:n}=t,r=e.build(),i=[];if(n.length>0){let t=n[0].data&&llt(n[0].data)||zP.IsoValue.relative(1.5);i[0]=r.to(n[0]).apply(IY.Representation.VolumeRepresentation3D,FY.getDefaultParamsStatic(e,`isosurface`,{isoValue:t,alpha:1},`uniform`,{value:gk.teal})).selector}if(n.length>1){let t=FY.getDefaultParamsStatic(e,`isosurface`,{isoValue:zP.IsoValue.relative(3),alpha:.3},`uniform`,{value:gk.green}),a=FY.getDefaultParamsStatic(e,`isosurface`,{isoValue:zP.IsoValue.relative(-3),alpha:.3},`uniform`,{value:gk.red});i[i.length]=r.to(n[1]).apply(IY.Representation.VolumeRepresentation3D,t).selector,i[i.length]=r.to(n[1]).apply(IY.Representation.VolumeRepresentation3D,a).selector}return await r.commit(),i}}),hlt=L2({label:`Segmentation CIF`,description:`Segmentation CIF`,category:x6,stringExtensions:[`cif`],binaryExtensions:[`bcif`],isApplicable:(e,t)=>R2(e,t)===`segcif`,parse:async(e,t)=>{let n=await e.build().to(t).apply(IY.Data.ParseCif).commit(),r=e.build().to(n),i=n.obj.data.blocks;if(i.length===0)throw Error(`no data blocks`);let a=[];for(let e of i)e.header.toUpperCase()!==`SERVER`&&e.categories.volume_data_3d_info?.rowCount>0&&a.push(r.apply(IY.Volume.VolumeFromSegmentationCif,{blockHeader:e.header}).selector);return await r.commit(),{volumes:a}},visuals:async(e,t)=>{let{volumes:n}=t,r=e.build(),i=[];return n.length>0&&zP.Segmentation.get(n[0].data)&&(i[i.length]=r.to(n[0]).apply(IY.Representation.VolumeRepresentation3D,FY.getDefaultParams(e,`segment`,n[0].data,{alpha:1,instanceGranularity:!0},`volume-segment`,{})).selector),await r.commit(),i}}),glt=[[`ccp4`,ult],[`dsn6`,dlt],[`cube`,plt],[`dx`,flt],[`dscif`,mlt],[`segcif`,hlt]],_lt=[[`ply`,L2({label:`PLY`,description:`PLY`,category:`Shape`,stringExtensions:[`ply`],parse:async(e,t)=>{let n=e.state.data.build().to(t).apply(IY.Data.ParsePly,{},{state:{isGhost:!0}}),r=n.apply(IY.Model.ShapeFromPly);return await n.commit(),{format:n.selector,shape:r.selector}},visuals(e,t){return e.state.data.build().to(t.shape).apply(IY.Representation.ShapeRepresentation3D).commit()}})]];var vlt=class{get types(){return this._list.map(e=>[e.name,e.provider.label])}get extensions(){if(this._extensions)return this._extensions;let e=new Set;return this._list.forEach(({provider:t})=>{var n,r;(n=t.stringExtensions)==null||n.forEach(t=>e.add(t)),(r=t.binaryExtensions)==null||r.forEach(t=>e.add(t))}),this._extensions=e,e}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;let e=new Set;return this._list.forEach(({provider:t})=>t.binaryExtensions?.forEach(t=>e.add(t))),this._binaryExtensions=e,e}get options(){if(this._options)return this._options;let e=[];return this._list.forEach(({name:t,provider:n})=>e.push([t,n.label,n.category||``])),this._options=e,e}constructor(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(let[e,t]of glt)this.add(e,t);for(let[e,t]of s7e)this.add(e,t);for(let[e,t]of p7e)this.add(e,t);for(let[e,t]of _lt)this.add(e,t);for(let[e,t]of n7e)this.add(e,t)}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(e,t){this._clear(),this._list.push({name:e,provider:t}),this._map.set(e,t)}remove(e){this._clear(),this._list.splice(this._list.findIndex(t=>t.name===e),1),this._map.delete(e)}auto(e,t){for(let n=0,r=this.list.length;n<r;++n){let r=this._list[n].provider,i=!1;if((r.binaryExtensions?.includes(e.ext)||r.stringExtensions?.includes(e.ext))&&(i=!0),i&&(!r.isApplicable||r.isApplicable(e,t.data)))return r}}get(e){if(this._map.has(e))return this._map.get(e);throw Error(`unknown data format name '${e}'`)}get list(){return this._list}},ylt=class extends BY{get isEmpty(){return this._animations.length===0}get current(){return this._current}get animations(){return this._animations}get isAnimatingStateTransition(){return this._current.anim.name===`built-in.animate-state-snapshot-transition`}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||={current:V.Select(this._animations[0]&&this._animations[0].name,this._animations.map(e=>[e.name,e.display.name]),{label:`Animation`})},this._params}updateParams(e){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...e}});let t=this.map.get(this.state.params.current),n=t.params(this.context);this._current={anim:t,params:n,paramValues:V.getDefaultValues(n),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(e){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...e},this.triggerUpdate())}register(e){if(this.map.has(e.name)){this.context.log.error(`Animation '${e.name}' is already registered.`);return}this._params=void 0,this.map.set(e.name,e),this._animations.push(e),this._animations.length===1?this.updateParams({current:e.name}):this.triggerUpdate()}async play(e,t){await this.stop(),this.map.has(e.name)||this.register(e),this.updateParams({current:e.name}),this.updateCurrentParams(t),await this.start()}async tick(e,t,n){this.currentTime=e,!this.isStopped&&(t||n?await this.applyFrame(n):this.applyAsync())}async start(){this.updateState({animationState:`playing`}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate();let e=this._current.anim,t=this._current.anim.initialState(this._current.paramValues,this.context);if(e.setup){let n=await e.setup(this._current.paramValues,t,this.context);n&&(t=n)}this._current.lastTime=0,this._current.startedTime=-1,this._current.state=t,this.isStopped=!1}async stop(){if(this.isStopped=!0,this.state.animationState!==`stopped`){let e=this._current.anim;e.teardown&&await e.teardown(this._current.paramValues,this._current.state,this.context),this.updateState({animationState:`stopped`}),this.triggerUpdate()}this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1)}stopStateTransitionAnimation(){if(this.isAnimatingStateTransition)return this.stop()}get isAnimating(){return this.state.animationState===`playing`}async applyAsync(){if(!this.isApplying){this.isApplying=!0;try{await this.applyFrame()}finally{this.isApplying=!1}}}async applyFrame(e){let t=this.currentTime;this._current.startedTime<0&&(this._current.startedTime=t);let n=await this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:t-this._current.startedTime,animation:e},{params:this._current.paramValues,plugin:this.context});n.kind===`finished`?this.stop():n.kind===`next`&&(this._current.state=n.state,this._current.lastTime=t-this._current.startedTime),this.triggerApply()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(e){this.isEmpty||(this.updateState({animationState:e.state.animationState}),this.updateParams(e.state.params),e.current&&(this.current.paramValues=e.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(e.current.state):e.current.state,this.triggerUpdate(),this.state.animationState===`playing`&&this.resume()))}async resume(){this._current.lastTime=0,this._current.startedTime=-1;let e=this._current.anim;this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),e.setup&&await e.setup(this._current.paramValues,this._current.state,this.context),this.isStopped=!1}constructor(e){super({params:{current:``},animationState:`stopped`}),this.context=e,this.map=new Map,this._animations=[],this.currentTime=0,this._params=void 0,this.events={updated:this.ev(),applied:this.ev()},this.isStopped=!0,this.isApplying=!1}};function blt(e,t,n){let r=n[0],i=n[1],a=n[2],o=-r*t[0]-i*t[1]-a*t[2],s=e[0],c=e[1],l=e[2];return(r*s+i*c+a*l+o)/Math.sqrt(r*r+i*i+a*a)}function xlt(e,t,n,r){let i=blt(e,t,r);return{aroundX:blt(e,t,n)<0,aroundY:i<0}}function Slt(e,t,n){if(!e.canvas3d)return;let{origin:r,dirA:i,dirB:a,dirC:o}=n.principalAxes.boxAxes,s=B.clone(i),c=B.clone(o);if(n.positionToFlip){let{aroundX:e,aroundY:t}=xlt(n.positionToFlip,r,s,a);e&&(B.negate(c,c),B.negate(s,s)),t&&B.negate(c,c)}let l=B.scale(B(),r,-100);return B.dot(l,s)<=0&&B.negate(c,c),B.dot(B.unitY,c)<=0&&B.negate(s,s),e.canvas3d.camera.getFocus(r,t,s,c,l0.createDefaultSnapshot())}function Clt(e,t){if(!e.canvas3d)return;let n=t.targets?.map(t=>{let n=t.targetRef===void 0?klt(e):Elt(e,t.targetRef);if(!n)return;let r=t.radius??n.radius*(t.radiusFactor??1)+(t.extraRadius??0);return q.create(n.center,r)}).filter(e=>e!==void 0),r=n&&n.length>0?T6(n):klt(e);return Tlt(e.canvas3d.camera,{center:r.center,radius:Math.max(r.radius,t.minRadius??0),up:t.up,direction:t.direction})}var wlt=B();function Tlt(e,t){let n=t.center,r=Math.max(t.radius,.01),i=t.direction??B.sub(B(),e.target,e.position),a=B.orthogonalize(B(),i,t.up??e.up),o=e.getTargetDistance(r),s=B.setMagnitude(wlt,i,o);return{target:n,position:B.sub(B(),n,s),up:a,radius:r}}function Elt(e,t){let n=Dlt([],e,t);if(n.length!==0)return n.length===1?n[0]:T6(n)}function Dlt(e,t,n){let r=Olt(t,t.state.data.cells.get(n));return r?e.push(...r):t.state.data.tree.children.get(n).forEach(n=>Dlt(e,t,n)),e}function Olt(e,t){let n=t?.obj;if(n){if(!n.data){console.warn(`Focus: no data`);return}if(n.data instanceof nB){let r=FE.getDecorated(e.state.data,t.transform.ref)?.obj?.data??n?.data,i=yq.getBoundingSphere(nB.Loci(r));return i?[i]:[]}else if(H.isRepresentation3D(n)){let e=[];for(let t of n.data.repr.renderObjects){let n=t.values.boundingSphere.ref.value;n.radius>0&&e.push(n)}return e}}}function klt(e){return T6(Alt(e,!1).map(e=>e.values.boundingSphere.ref.value).filter(e=>e.radius>0))}function Alt(e,t){let n=Array.from(e.state.data.cells.values()).filter(e=>e.obj&&H.isRepresentation3D(e.obj));return t||(n=n.filter(e=>!e.state.isHidden)),n.flatMap(e=>e.obj.data.repr.renderObjects)}var w6=void 0;function T6(e){w6??=new RA(`98`),w6.reset();for(let t of e)w6.includeSphere(t);w6.finishedIncludeStep();for(let t of e)w6.radiusSphere(t);return w6.getSphere()}var jlt=3;const E6={identity:TT.create(1,0,0,0,1,0,0,0,1),rotX90:TT.create(1,0,0,0,0,1,0,-1,0),rotY90:TT.create(0,0,-1,0,1,0,1,0,0),rotZ90:TT.create(0,1,0,-1,0,0,0,0,1),rotX270:TT.create(1,0,0,0,0,-1,0,1,0),rotY270:TT.create(0,0,1,0,1,0,-1,0,0),rotZ270:TT.create(0,-1,0,1,0,0,0,0,1),rotX180:TT.create(1,0,0,0,-1,0,0,0,-1),rotY180:TT.create(-1,0,0,0,1,0,0,0,-1),rotZ180:TT.create(-1,0,0,0,-1,0,0,0,1)};function Mlt(e,t){return Nlt(Plt(e,jlt),t)}function Nlt(e,t){if(e.length===0)return console.warn(`Skipping PCA, no atoms`),{rotation:E6.identity,origin:B.zero()};let n=Qk.calculateMomentsAxes(e),r=Qk.calculateNormalizedAxes(n),i=Rlt(r.dirA,r.dirB,r.dirC);zlt(i);let a=t?Flt(i,t):Ilt(e,i,n.origin);return TT.mul(i,a,i),{rotation:i,origin:r.origin}}function Plt(e,t){let n;return n=D6(e,{onlyTrace:!0}),n.length>=3*t||(n=D6(e,{skipHydrogens:!0,skipWater:!0}),n.length>=3*t)||(n=D6(e,{})),n}function D6(e,t){let{onlyTrace:n,skipHydrogens:r,skipWater:i}=t,{x:a,y:o,z:s,type_symbol:c,label_comp_id:l}=Pz.atom,u=[];for(let t of e){let e=iL.create(t);for(let d of t.units){e.unit=d;let t=n?d.polymerElements:d.elements;for(let n=0;n<t.length;n++)e.element=t[n],!(r&&c(e)===`H`)&&(i&&l(e)===`HOH`||u.push(a(e),o(e),s(e)))}}return u}function Flt(e,t){let n=E6.identity,r=0,i=TT();for(let a of[E6.identity,E6.rotX180,E6.rotY180,E6.rotZ180]){let o=TT.innerProduct(TT.mul(i,a,e),t);o>r&&(n=a,r=o)}return n}function Ilt(e,t,n){let r=B.create(TT.getValue(t,0,0),TT.getValue(t,0,1),TT.getValue(t,0,2)),i=B.create(TT.getValue(t,1,0),TT.getValue(t,1,1),TT.getValue(t,1,2)),a=B.create(TT.getValue(t,2,0),TT.getValue(t,2,1),TT.getValue(t,2,2)),o=Math.floor(e.length/3),s=B(),c=0,l=0,u=0;for(let t=0;t<o;t++)B.fromArray(s,e,3*t),B.sub(s,s,n),c+=t*B.dot(s,r),l+=t*B.dot(s,i),u+=Llt(t,o)*B.dot(s,a);let d=u<0,f=d?c+l<0:c-l<0;return f&&d?E6.rotY180:d?E6.rotX180:f?E6.rotZ180:E6.identity}function Llt(e,t){let n=Math.floor(t/2);return e<n?t%2?n-e:n-e-1:e-n}function Rlt(e,t,n){let r=TT();return TT.setValue(r,0,0,e[0]),TT.setValue(r,0,1,e[1]),TT.setValue(r,0,2,e[2]),TT.setValue(r,1,0,t[0]),TT.setValue(r,1,1,t[1]),TT.setValue(r,1,2,t[2]),TT.setValue(r,2,0,n[0]),TT.setValue(r,2,1,n[1]),TT.setValue(r,2,2,n[2]),r}function zlt(e){TT.determinant(e)<0&&(TT.setValue(e,2,0,-TT.getValue(e,2,0)),TT.setValue(e,2,1,-TT.getValue(e,2,1)),TT.setValue(e,2,2,-TT.getValue(e,2,2)))}function Blt(e,t){let n=TT.invert(TT(),t),r=B.distance(e.position,e.target),i=B.transformMat3(B(),B.create(0,0,r),n),a=B.transformMat3(B(),B.create(0,1,0),n),o=B.add(B(),e.target,i);return{...e,position:o,up:a}}var O6={minRadius:1,extraRadius:4,durationMs:250},Vlt=class{transformedLoci(e){if($.is(e)){let t=this.plugin.helpers.substructureParent.get(e.structure)?.obj?.data;t&&(e=$.remap(e,t))}return e}focusRenderObjects(e,t){if(!e)return;let n=[];for(let t of e){let e=t.values.boundingSphere.ref.value;e.radius!==0&&n.push(e)}this.focusSpheres(n,e=>e,t)}focusLoci(e,t){let n;if(Array.isArray(e)&&e.length>1){let t=[];for(let n of e){let e=yq.getBoundingSphere(this.transformedLoci(n));e&&t.push(e)}if(t.length===0)return;this.boundaryHelper.reset();for(let e of t)this.boundaryHelper.includeSphere(e);this.boundaryHelper.finishedIncludeStep();for(let e of t)this.boundaryHelper.radiusSphere(e);n=this.boundaryHelper.getSphere()}else if(Array.isArray(e)){if(e.length===0)return;n=yq.getBoundingSphere(this.transformedLoci(e[0]))}else n=yq.getBoundingSphere(this.transformedLoci(e));n&&this.focusSphere(n,t)}focusSpheres(e,t,n){let r=[];for(let n of e){let e=t(n);e&&r.push(e)}if(r.length!==0){if(r.length===1)return this.focusSphere(r[0],n);this.boundaryHelper.reset();for(let e of r)this.boundaryHelper.includeSphere(e);this.boundaryHelper.finishedIncludeStep();for(let e of r)this.boundaryHelper.radiusSphere(e);this.focusSphere(this.boundaryHelper.getSphere(),n)}}focusSphere(e,t){var n;let{canvas3d:r}=this.plugin;if(!r)return;let{extraRadius:i,minRadius:a,durationMs:o}={...O6,...t},s=Math.max(e.radius+i,a);if(t?.principalAxes){let e=Slt(this.plugin,s,t);(n=this.plugin.canvas3d)==null||n.requestCameraReset({durationMs:o,snapshot:e})}else{let t=r.camera.getFocus(e.center,s);r.requestCameraReset({durationMs:o,snapshot:t})}}focusObject(e){if(!this.plugin.canvas3d)return;let t=Clt(this.plugin,{...e,targets:e.targets?.map(e=>({...e,extraRadius:e.extraRadius??O6.extraRadius})),minRadius:e.minRadius??O6.minRadius});this.plugin.canvas3d.requestCameraReset({snapshot:t,durationMs:e.durationMs??O6.durationMs})}orientAxes(e,t){if(!this.plugin.canvas3d)return;e||=this.plugin.state.data.selectQ(e=>e.ofType(H.Molecule.Structure)).filter(e=>e.obj&&!e.transform.transformer.definition.isDecorator&&!e.obj.data.parent).map(e=>e.obj?.data).filter(e=>!!e);let{rotation:n}=Mlt(e),r=Blt(this.plugin.canvas3d.camera.getSnapshot(),n);this.setSnapshot(r,t)}resetAxes(e){if(!this.plugin.canvas3d)return;let t=Blt(this.plugin.canvas3d.camera.getSnapshot(),TT.Identity);this.setSnapshot(t,e)}setSnapshot(e,t){var n;(n=this.plugin.canvas3d)==null||n.requestCameraReset({snapshot:e,durationMs:t})}reset(e,t){var n;(n=this.plugin.canvas3d)==null||n.requestCameraReset({snapshot:e,durationMs:t})}constructor(e){this.plugin=e,this.boundaryHelper=new RA(`98`)}},Hlt=class{clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(e){this.providers.push(e),this.providers.sort((e,t)=>(t.priority||0)-(e.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(e){this.providers=this.providers.filter(t=>t!==e),this.isDirty=!0,this.showLabels()}mark(e,t){let n=this.locis.findIndex(t=>rJ.Loci.areEqual(e,t));n===-1&&t===lq.Highlight?(this.locis.push(e),this.isDirty=!0):n!==-1&&t===lq.RemoveHighlight&&(DE(this.locis,n),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(let e of this.providers)for(let t of this.locis){if(yq.isEmpty(t.loci))continue;let n=e.label(t.loci,t.repr);if(n){let t=e.group?e.group(n):n.toString(),r=this.groupedLabels.get(t);r?r.push(n):this.groupedLabels.set(t,[n])}}this.labels.length=0,this.groupedLabels.forEach((e,t)=>{let n=e.length,r=n>1&&e[0]!==e[1]?t:e[0];this.labels.push(n===1?r:`${r} <small>|| \u00D7 ${n}</small>`)}),this.isDirty=!1}return this.labels}constructor(e){this.ctx=e,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,e.managers.interactivity.lociHighlights.addProvider((e,t,n)=>{this.providers.length!==0&&(this.mark(e,t),n||this.showLabels())})}},k6=new RA(`98`),Ult=24,Wlt=class extends BY{get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats}getEntry(e){let t=this.plugin.helpers.substructureParent.get(e,!0);if(!t)return;let n=t.transform.ref;if(!this.entries.has(n)){let t=new A6($(e,[]));return this.entries.set(n,t),t}return this.entries.get(n)}calcStats(){let e=0,t=0,n=uB.create();this.entries.forEach(r=>{let{elements:i}=r.selection;if(i.length){e+=1;for(let e=0,n=i.length;e<n;++e)t+=K.size(i[e].indices);uB.add(n,n,uB.ofLoci(r.selection))}});let r=MJ(n,{countsOnly:!0});return{structureCount:e,elementCount:t,label:r}}add(e){if(!$.is(e))return!1;let t=this.getEntry(e.structure);if(!t)return!1;let n=t.selection;return t.selection=$.union(t.selection,e),this.tryAddHistory(e),this.referenceLoci=e,this.events.loci.add.next(e),!$.areEqual(n,t.selection)}remove(e){if(!$.is(e))return!1;let t=this.getEntry(e.structure);if(!t)return!1;let n=t.selection;return t.selection=$.subtract(t.selection,e),this.referenceLoci=e,this.events.loci.remove.next(e),!$.areEqual(n,t.selection)}intersect(e){if(!$.is(e))return!1;let t=this.getEntry(e.structure);if(!t)return!1;let n=t.selection;return t.selection=$.intersect(t.selection,e),this.referenceLoci=e,!$.areEqual(n,t.selection)}set(e){if(!$.is(e))return!1;let t=this.getEntry(e.structure);if(!t)return!1;let n=t.selection;return t.selection=e,this.tryAddHistory(e),this.referenceLoci=void 0,!$.areEqual(n,t.selection)}modifyHistory(e,t,n,r=!1){let i=this.additionsHistory,a=i.indexOf(e);if(a<0)return;let o;switch(t){case`remove`:DE(i,a);break;case`up`:o=a-1;break;case`down`:o=a+1;break}if(o!==void 0){let e=n?Math.min(i.length,n):i.length;for(;;)if(o%=e,o<0&&(o+=e),!r||i[a].loci.structure===i[o].loci.structure){let e=i[a];i[a]=i[o],i[o]=e;break}else o+=t===`up`?-1:1}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(e){if(yq.isEmpty(e))return;let t=0,n;for(let r of this.additionsHistory){if(yq.areEqual(r.loci,e)){n=r;break}t++}if(n){DE(this.additionsHistory,t),this.additionsHistory.unshift(n),this.events.additionsHistoryUpdated.next(void 0);return}let r=MJ(uB.ofLoci(e),{reverse:!0});this.additionsHistory.unshift({id:zy.create22(),loci:e,label:r}),this.additionsHistory.length>Ult&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(e){let t=[];for(let n of this.state.additionsHistory)n.loci.structure.root===e.root&&t.push(n);for(let e of t)this.modifyHistory(e,`remove`);t.length!==0&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(e,t){this.entries.has(e)&&(this.entries.delete(e),t?.data&&this.clearHistoryForStructure(t.data),this.referenceLoci?.structure===t?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(e,t,n){if(t===n||t?.data===n.data)return;let r=this.plugin.helpers.substructureParent.get(n.data,!0);if(!r||e!==r.transform.ref||!this.entries.has(e))return;let i=this.plugin.helpers.substructureParent.get(n.data)?.obj?.data;if(i)if(!t?.data||nB.areUnitIdsAndIndicesEqual(t.data,n.data)){this.entries.set(e,Klt(this.entries.get(e),i)),this.referenceLoci?.structure.root===i.root&&(this.referenceLoci=$.remap(this.referenceLoci,i));let t=!1;for(let e of this.state.additionsHistory)e.loci.structure.root===i.root&&(e.loci=$.remap(e.loci,i),t=!0);t&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(e,new A6($(i,[]))),this.referenceLoci?.structure.root===i.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(i),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){let e=this.entries.keys(),t=[];for(;;){let n=e.next();if(n.done)break;let r=this.entries.get(n.value);$.isEmpty(r.selection)||t.push(r.selection),r.selection=$(r.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),t}getLoci(e){let t=this.getEntry(e);return t?t.selection:hq}getStructure(e){let t=this.getEntry(e);if(t)return t.structure}structureHasSelection(e){let t=e.cell?.obj?.data;if(!t)return!1;let n=this.getEntry(t);return!!n&&!$.isEmpty(n.selection)}has(e){if($.is(e)){let t=this.getEntry(e.structure);if(t)return $.isSubset(t.selection,e)}return!1}tryGetRange(e){if($.is(e)&&this.getEntry(e.structure))return qlt(this.referenceLoci,e)}elementCount(){let e=0;return this.entries.forEach(t=>{e+=$.size(t.selection)}),e}getBoundary(){let e=B.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=B.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);k6.reset();let n=[];this.entries.forEach(e=>{let t=e.selection;$.isEmpty(t)||n.push($.getBoundary(t))});for(let r=0,i=n.length;r<i;++r){let{box:i,sphere:a}=n[r];B.min(e,e,i.min),B.max(t,t,i.max),k6.includePositionRadius(a.center,a.radius)}k6.finishedIncludeStep();for(let e=0,t=n.length;e<t;++e){let{sphere:t}=n[e];k6.radiusPositionRadius(t.center,t.radius)}return{box:{min:e,max:t},sphere:k6.getSphere()}}getPrincipalAxes(){let e=mx(this.entries.values());return $.getPrincipalAxesMany(e.map(e=>e.selection))}modify(e,t){let n=!1;switch(e){case`add`:n=this.add(t);break;case`remove`:n=this.remove(t);break;case`intersect`:n=this.intersect(t);break;case`set`:n=this.set(t);break}n&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(e=>!!e.cell.obj).map(e=>e.cell.obj.data)}triggerInteraction(e,t,n=!0){switch(e){case`add`:this.plugin.managers.interactivity.lociSelects.select({loci:t},n);break;case`remove`:this.plugin.managers.interactivity.lociSelects.deselect({loci:t},n);break;case`intersect`:this.plugin.managers.interactivity.lociSelects.selectJoin({loci:t},n);break;case`set`:this.plugin.managers.interactivity.lociSelects.selectOnly({loci:t},n);break}}fromLoci(e,t,n=!0){this.triggerInteraction(e,t,n)}fromCompiledQuery(e,t,n=!0){for(let r of this.applicableStructures){let i=t(new ZR(r));this.triggerInteraction(e,VR.toLociWithSourceUnits(i),n)}}fromSelectionQuery(e,t,n=!0){this.plugin.runTask(hb.create(`Structure Selection`,async r=>{for(let i of this.applicableStructures){let a=await t.getSelection(this.plugin,r,i);this.triggerInteraction(e,VR.toLociWithSourceUnits(a),n)}}))}fromSelections(e){let t=Fx.resolveAndCheck(this.plugin.state.data,e);if(!(!t||!t.obj)){if(!H.Molecule.Structure.Selections.is(t.obj)){console.warn(`fromSelections applied to wrong object type.`,t.obj);return}this.clear();for(let e of t.obj?.data)this.fromLoci(`set`,e.loci)}}getSnapshot(){let e=[];return this.entries.forEach((t,n)=>{e.push({ref:n,bundle:qR.fromLoci(t.selection)})}),{entries:e}}setSnapshot(e){this.entries.clear();for(let{ref:t,bundle:n}of e.entries){let e=this.plugin.state.data.select(FE.Generators.byRef(t))[0]?.obj?.data;if(!e)continue;let r=qR.toLoci(n,e);this.fromLoci(`set`,r,!1)}}constructor(e){super({entries:new Map,additionsHistory:[],stats:Glt()}),this.plugin=e,this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}},e.helpers.substructureParent.events.removed.subscribe(e=>this.onRemove(e.ref,e.obj)),e.helpers.substructureParent.events.updated.subscribe(e=>this.onUpdate(e.ref,e.oldObj,e.obj))}};function Glt(){return{structureCount:0,elementCount:0,label:`Nothing Selected`}}var A6=class{get selection(){return this._selection}set selection(e){this._selection=e,this._structure=void 0}get structure(){return this._structure||(yq.isEmpty(this._selection)?this._structure=void 0:this._structure=$.toStructure(this._selection)),this._structure}constructor(e){this._structure=void 0,this._selection=e}};function Klt(e,t){return new A6($.remap(e.selection,t))}function qlt(e,t){if(!$.is(e)||!$.is(t)||e.structure!==t.structure||t.elements.length!==1)return;let n=t.elements[0];if(!n)return;let r;for(let t of e.elements)if(n.unit===t.unit){r=t;break}if(r&&n.unit===r.unit)return Jlt(t.structure,r,n)}function Jlt(e,t,n){let r=Math.min(K.min(t.indices),K.min(n.indices)),i=Math.max(K.max(t.indices),K.max(n.indices));return $(e,[{unit:t.unit,indices:K.ofRange(r,i)}])}var Ylt=8,Xlt=class extends BY{get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(e){if($.isEmpty(e.loci))return;let t=0,n;for(let r of this.state.history){if($.areEqual(r.loci,e.loci)){n=r;break}t++}if(n){DE(this.state.history,t),this.state.history.unshift(e),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(e),this.state.history.length>Ylt&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(e){this.tryAddHistory(e),(!this.state.current||!$.areEqual(this.state.current.loci,e.loci))&&(this.state.current=e,this.behaviors.current.next(e))}tryGetRange(e){return qlt(this.referenceLoci,e)}setFromLoci(e){let t=yq.normalize(e);if(!$.is(t)||$.isEmpty(t)){this.clear();return}this.set({loci:t,label:kJ(t,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}),this.referenceLoci=t}addFromLoci(e){let t=this.state.current&&$.is(e)&&e.structure===this.state.current.loci.structure?$.union(e,this.state.current.loci):e;this.setFromLoci(t);let n=yq.normalize(e);this.referenceLoci=$.is(n)?n:void 0}toggleFromLoci(e){let{kind:t,loci:n}=Zlt(this.state.current?.loci,e);this.setFromLoci(n);let r=yq.normalize(e);this.referenceLoci=$.is(r)&&t!==`subtract`?r:void 0}extendFromLoci(e){let t=this.tryGetRange(e)??e;this.toggleFromLoci(t)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0)),this.referenceLoci=void 0}getSnapshot(){if(!this.current)return{};let e=this.plugin.helpers.substructureParent.get(this.current.loci.structure)?.transform.ref;return e?{current:{label:this.current.label,ref:e,bundle:qR.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(e){if(!e.current){this.clear();return}let{label:t,ref:n,bundle:r,category:i}=e.current,a=this.plugin.state.data.select(FE.Generators.byRef(n))[0]?.obj?.data;if(!a)return;let o=qR.toLoci(r,a);this.set({label:t,loci:o,category:i})}constructor(e){super({history:[]}),this.plugin=e,this.events={historyUpdated:this.ev()},this.behaviors={current:this.ev.behavior(void 0)},e.state.data.events.object.removed.subscribe(({obj:e})=>{if(!H.Molecule.Structure.is(e))return;this.current?.loci.structure===e.data&&this.clear();let t=[];for(let n of this.history)n.loci.structure===e.data&&t.push(n);t.length!==this.history.length&&(this.history.length=0,this.history.push(...t),this.events.historyUpdated.next(void 0))});let t=q();e.state.data.events.object.updated.subscribe(({oldData:e,obj:n,action:r})=>{if(H.Molecule.Structure.is(n)&&e!==n.data&&r===`in-place`){let r=this.state.current,i=n.data;if(r&&r.loci.structure===e){let e=$.remap(r.loci,i);this.state.current={...r,loci:e},this.behaviors.current.next(this.state.current),yq.getBoundingSphere(e,t);let n=this.plugin.canvas3d?.camera,a=n.getTargetDistance(t.radius+4);(B.distance(n.target,t.center)>t.radius||a>n.viewport.height/n.zoom)&&this.plugin.managers.camera.focusSphere(t,{durationMs:0})}}})}};function Zlt(e,t){return e&&$.is(t)&&t.structure===e.structure?$.isSubset(e,t)?{kind:`subtract`,loci:$.subtract(e,t)}:{kind:`add`,loci:$.union(t,e)}:{kind:`new`,loci:t}}const Qlt=[{name:`center-camera`,execute:({event:e,args:t,manager:n})=>{e===`click`&&`center-camera`in t&&n.plugin.managers.camera.reset()}},{name:`apply-snapshot`,execute:({event:e,args:t,manager:n})=>{if(e!==`click`)return;let r=t[`apply-snapshot`];r&&n.plugin.managers.snapshot.applyKey(r)}},{name:`next-snapshot`,execute:({event:e,args:t,manager:n})=>{if(e!==`click`||!(`next-snapshot`in t))return;let r=+t[`next-snapshot`]||1;r&&(r=r<0?-1:1,n.plugin.managers.snapshot.applyNext(r))}},{name:`focus-refs`,execute:({event:e,args:t,manager:n})=>{if(e!==`click`)return;let r=j6(t[`focus-refs`]);if(!r?.length)return;let i=n.findCells(r);if(!i.length)return;let a=eut(n.plugin,i);if(!a.length)return;let o=a.map(e=>Elt(n.plugin,e.transform.ref)).filter(e=>!!e);o.length&&n.plugin.managers.camera.focusSpheres(o,e=>e,{extraRadius:3})}},{name:`highlight-refs`,execute:({event:e,args:t,manager:n})=>{let r=j6(t[`highlight-refs`]);if(r?.length){if(e===`mouse-leave`&&r.length){n.plugin.managers.interactivity.lociHighlights.clearHighlights();return}else if(e===`mouse-enter`){let e=n.findCells(r);for(let t of eut(n.plugin,e)){if(!t.obj?.data)continue;let{repr:e}=t.obj.data;for(let t of e.getAllLoci())n.plugin.managers.interactivity.lociHighlights.highlight({loci:t,repr:e},!1)}}}}},{name:`query`,execute:({event:e,args:t,manager:n})=>{let r=t.query;if(!r?.length)return;let i=t.lang||`mol-script`,a=j6(t.action||`highlight`),o=parseFloat(t[`focus-radius`]||`3`);if(e===`mouse-leave`){a.includes(`highlight`)&&n.plugin.managers.interactivity.lociHighlights.clearHighlights();return}let s;try{s=HH.toQuery({language:i,expression:r})}catch(e){console.warn(`Failed to parse query '${r}' (${i})`,e);return}let c=n.plugin.state.data.selectQ(e=>e.rootsOfType(H.Molecule.Structure));if(e===`mouse-enter`){if(!a.includes(`focus`))return;n.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let e of c){if(!e.obj?.data)continue;let t=s(new ZR(e.obj.data)),r=VR.toLociWithSourceUnits(t);n.plugin.managers.interactivity.lociHighlights.highlight({loci:r},!1)}}if(e===`click`){if(!a.includes(`focus`))return;let e=c.map(e=>FE.getDecorated(n.plugin.state.data,e.transform.ref)).map(e=>{if(!e.obj?.data)return;let t=s(new ZR(e.obj.data));if(VR.isEmpty(t))return;let n=VR.toLociWithSourceUnits(t);return $.getBoundary(n).sphere}).filter(e=>!!e);e.length&&n.plugin.managers.camera.focusSpheres(e,e=>e,{extraRadius:o})}}},{name:`play-audio`,execute:({event:e,args:t,manager:n})=>{if(e!==`click`)return;let r=t[`play-audio`];r?.length&&n.audio.play(r)}},{name:`toggle-audio`,execute:({event:e,args:t,manager:n})=>{if(e!==`click`||!(`toggle-audio`in t))return;let r=t[`toggle-audio`];n.audio.play(r,{toggle:!0})}},{name:`pause-audio`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`pause-audio`in t)||n.audio.pause()}},{name:`stop-audio`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`stop-audio`in t)||n.audio.stop()}},{name:`dispose-audio`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`dispose-audio`in t)||n.audio.dispose()}},{name:`play-transition`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`play-transition`in t)||n.plugin.managers.animation.play(J0,{})}},{name:`play-snapshots`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`play-snapshots`in t)||n.plugin.managers.snapshot.play({restart:!0})}},{name:`stop-animation`,execute:({event:e,args:t,manager:n})=>{e!==`click`||!(`stop-animation`in t)||n.plugin.managers.snapshot.stop()}}];var $lt=class{registerArgsParser(e,t,n){this.removeArgsParser(e),this.argsParsers.push([e,t,n]),this.argsParsers.sort((e,t)=>t[1]-e[1])}removeArgsParser(e){let t=this.argsParsers.findIndex(t=>t[0]===e);t>=0&&this.argsParsers.splice(t,1)}parseArgs(e){for(let[,,t]of this.argsParsers){let n=t(e);if(n)return n}}registerRefResolver(e,t){this.refResolvers[e]=t}removeRefResolver(e){delete this.refResolvers[e]}registerUriResolver(e,t){this.uriResolvers[e]=t}removeUriResolver(e){delete this.uriResolvers[e]}registerExtension(e){let t=this.extension.findIndex(t=>t.name===e.name);t>=0?this.extension[t]=e:this.extension.push(e)}removeExtension(e){let t=this.extension.findIndex(t=>t.name===e);t>=0&&this.extension.splice(t,1)}_tryRender(e,t){try{return e.reactRenderFn?.call(e,t)}catch(t){return console.error(`Failed to render markdown extension '${e.name}'`,t),null}}tryRender(e,t){let n={args:e,manager:this};for(let e of this.extension){let t=this._tryRender(e,n);if(t)return t}for(let e of t){let t=this._tryRender(e,n);if(t)return t}return null}tryExecute(e,t){var n;let r={event:e,args:t,manager:this};for(let e of this.extension)try{(n=e.execute)==null||n.call(e,r)}catch(t){console.error(`Failed to execute markdown extension '${e.name}'`,t)}}tryResolveUri(e){for(let t of Object.values(this.uriResolvers)){let n=t(this.plugin,e);if(n)return n}}findCells(e){let t=new Set,n=[];for(let r of Object.values(this.refResolvers))for(let i of r(this.plugin,e))i&&!t.has(i.transform.ref)&&(t.add(i.transform.ref),n.push(i));return n}resolveAudioPlayer(){if(this.state.audioPlayer.value)return this.state.audioPlayer.value;let e=document.createElement(`audio`);return e.controls=!0,e.preload=`auto`,e.style.width=`100%`,e.style.height=`32px`,this.state.audioPlayer.next(e),e}get audioPlayer(){return this.state.audioPlayer.value}constructor(e){this.plugin=e,this.state={audioPlayer:new cD(null)},this.extension=[],this.refResolvers={default:(e,t)=>t.map(t=>e.state.data.cells.get(t)).filter(e=>!!e)},this.uriResolvers={},this.argsParsers=[[`default`,100,tut]],this.audio={play:async(e,t)=>{try{let n=this.resolveAudioPlayer(),r=!1;if(e?.trim()){let t=this.tryResolveUri(e),i=e;typeof t?.then==`function`?i=await t:t&&(i=t),r=n.src!==i,r&&(n.src=i,n.load())}!r&&t?.toggle?n.paused?await n.play():n.pause():(n.currentTime=0,await n.play())}catch(e){console.error(`Failed to play audio`,e)}},pause:()=>{var e;(e=this.audioPlayer)==null||e.pause()},stop:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0)},dispose:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.state.audioPlayer.next(null))}};for(let e of Qlt)this.registerExtension(e)}};function j6(e){return e?.split(`,`).map(e=>e.trim()).filter(e=>e.length>0)??[]}function eut(e,t){return t.length?e.state.data.selectQ(e=>e.byValue(...t).subtree().filter(e=>H.isRepresentation3D(e.obj))):[]}function tut(e){if(!e?.startsWith(`!`))return;let t=decodeURIComponent(e.substring(1)).split(`&`).map(e=>e.trim()).filter(e=>e.length>0).map(e=>e.split(`=`,2).map(e=>e.trim()));if(t.length!==0)return Object.fromEntries(t)}var nut=[[`full`,`Full`],[`collapsed`,`Collapsed`],[`hidden`,`Hidden`]],M6=[[`full`,`Full`],[`hidden`,`Hidden`]];const rut={isExpanded:V.Boolean(!1),showControls:V.Boolean(!0),regionState:V.Group({left:V.Select(`full`,nut),top:V.Select(`full`,M6),right:V.Select(`full`,M6),bottom:V.Select(`full`,M6)}),controlsDisplay:V.Value(`outside`,{isHidden:!0}),expandToFullscreen:V.Boolean(!1)};var iut=class extends BY{updateProps(e){let t=!!this.state.isExpanded;if(this.updateState(e),this.root&&typeof e.isExpanded==`boolean`&&e.isExpanded!==t&&this.handleExpand(),this.state.expandToFullscreen){let e=document.getElementsByTagName(`body`)[0];e&&this.tryRequestFullscreen(e)}else document.fullscreenElement&&this.tryExitFullscreen();this.events.updated.next(void 0)}setProps(e){this.updateState(e)}setRoot(e){this.root=e,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}async tryRequestFullscreen(e){if(!document.fullscreenElement)try{await e.requestFullscreen()}catch(e){console.error(e)}}async tryExitFullscreen(){if(document.fullscreenElement)try{await document.exitFullscreen()}catch(e){console.error(e)}}handleExpand(){try{let e=document.getElementsByTagName(`body`)[0],t=document.getElementsByTagName(`head`)[0];if(!e||!t||!this.root)return;if(this.state.isExpanded){let n=t.children,r=[],i=!1;for(let e=0;e<n.length;e++)n[e]===this.expandedViewport?i=!0:(n[e].name||``).toLowerCase()===`viewport`&&r.push(n[e]);for(let e of r)t.removeChild(e);i||t.appendChild(this.expandedViewport);let a=e.style,o=this.getScrollElement(),s=o.scrollLeft,c=o.scrollTop;this.rootState={top:a.top,bottom:a.bottom,right:a.right,left:a.left,scrollTop:c,scrollLeft:s,position:a.position,overflow:a.overflow,viewports:r,zIndex:this.root.style.zIndex,width:a.width,height:a.height,maxWidth:a.maxWidth,maxHeight:a.maxHeight,margin:a.margin,marginLeft:a.marginLeft,marginRight:a.marginRight,marginTop:a.marginTop,marginBottom:a.marginBottom},a.overflow=`hidden`,a.position=`fixed`,a.top=`0`,a.bottom=`0`,a.right=`0`,a.left=`0`,a.width=`100%`,a.height=`100%`,a.maxWidth=`100%`,a.maxHeight=`100%`,a.margin=`0`,a.marginLeft=`0`,a.marginRight=`0`,a.marginTop=`0`,a.marginBottom=`0`}else{let n=t.children;for(let e=0;e<n.length;e++)if(n[e]===this.expandedViewport){t.removeChild(this.expandedViewport);break}if(this.state.expandToFullscreen&&document.fullscreenElement&&document.exitFullscreen(),this.rootState){let n=this.rootState;for(let e of n.viewports)t.appendChild(e);let r=e.style;r.top=n.top,r.bottom=n.bottom,r.left=n.left,r.right=n.right,r.width=n.width,r.height=n.height,r.maxWidth=n.maxWidth,r.maxHeight=n.maxHeight,r.margin=n.margin,r.marginLeft=n.marginLeft,r.marginRight=n.marginRight,r.marginTop=n.marginTop,r.marginBottom=n.marginBottom,r.position=n.position,r.overflow=n.overflow||``;let i=this.getScrollElement();i.scrollTop=n.scrollTop,i.scrollLeft=n.scrollLeft,this.rootState=void 0,this.root.style.zIndex=n.zIndex}}}catch(e){let t=`Layout change error, you might have to reload the page.`;this.context.log.error(t),console.error(t,e)}}dispose(){super.dispose(),document.removeEventListener(`fullscreenchange`,this.fullscreenChangeHandler),document.removeEventListener(`webkitfullscreenchange`,this.fullscreenChangeHandler)}constructor(e){super({...V.getDefaultValues(rut),...e.spec.layout&&e.spec.layout.initial}),this.context=e,this.events={updated:this.ev()},this.rootState=void 0,this.fullscreenChangeHandler=()=>{document.fullscreenElement||this.updateProps({expandToFullscreen:!1})},document.addEventListener(`fullscreenchange`,this.fullscreenChangeHandler),document.addEventListener(`webkitfullscreenchange`,this.fullscreenChangeHandler),jx.Layout.Update.subscribe(e,e=>this.updateProps(e.state)),typeof document<`u`&&(this.expandedViewport=document.createElement(`meta`),this.expandedViewport.name=`viewport`,this.expandedViewport.content=`width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0`)}};const N6={includeTypes:V.MultiSelect(Ib(kI.Names),V.objectToOptions(kI.Names)),excludeTypes:V.MultiSelect([],V.objectToOptions(kI.Names)),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),aromaticBonds:V.Boolean(!0,{description:`Display aromatic bonds with dashes`}),multipleBonds:V.Select(`symmetric`,V.arrayToOptions([`off`,`symmetric`,`offset`]))};V.getDefaultValues(N6);const P6={...v1,...N6,adjustCylinderLength:V.Boolean(!1,{description:`Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds.`})};V.getDefaultValues(P6);const F6={...h1e,...N6};V.getDefaultValues(F6);function I6(e,t,n){return!kI.is(e,n)||kI.is(t,n)}function aut(e,t,n){let r=t.elements,{a:i,b:a,edgeProps:o}=t.bonds,{flags:s}=o,{ignoreHydrogens:c,ignoreHydrogensVariant:l,includeTypes:u,excludeTypes:d}=n,f=kI.fromNames(u),p=kI.fromNames(d),m=kI.isAll(f)&&kI.Flag.None===p,{child:h}=e,g=h?.unitMap.get(t.id);if(h&&!g)throw Error(`expected childUnit to exist if child exists`);if(!(m&&!c&&!h))return n=>{let o=i[n],u=a[n];return g&&!Vk.has(g.elements,r[o])||!m&&I6(f,p,s[n])?!0:c?!!(l$(e,t,r[o],l)||l$(e,t,r[u],l)):!1}}function out(e,t){let{edges:n}=e.interUnitBonds,{ignoreHydrogens:r,ignoreHydrogensVariant:i,includeTypes:a,excludeTypes:o}=t,s=kI.fromNames(a),c=kI.fromNames(o),l=kI.isAll(s)&&kI.Flag.None===c,{child:u}=e;if(!(l&&!r&&!u))return t=>{if(u){let r=n[t],i=u.unitMap.get(r.unitA);if(!i)return!0;let a=e.unitMap.get(r.unitA).elements[r.indexA];if(!Vk.has(i.elements,a))return!0}if(r){let r=n[t],a=e.unitMap.get(r.unitA),o=e.unitMap.get(r.unitB);if(l$(e,a,a.elements[r.indexA],i)||l$(e,o,o.elements[r.indexB],i))return!0}return!!(!l&&I6(s,c,n[t].props.flag))}}function L6(e,t){return Q.Traits.is(e.traits,Q.Trait.Water)?!t.ignoreHydrogens||t.ignoreHydrogensVariant===`non-polar`:!0}function R6(e,t){for(let{units:n}of e.unitSymmetryGroups)if(Q.isAtomic(n[0])&&L6(n[0],t))return!0;return!1}var z6;(function(e){function t(e,t){let{group:n,structure:r}=e,i=n.units[0],a=Q.isAtomic(i)?i.bonds.edgeCount*2:0,o=n.units.length,s=fR.Location(r,void 0,void 0,r,void 0,void 0),c=(e,t)=>{let r=n.units[t];return s.aUnit=r,s.bUnit=r,s.aIndex=r.bonds.a[e],s.bIndex=r.bonds.b[e],s};if(t?.includeLocation2){let e=fR.Location(r,void 0,void 0,r,void 0,void 0);return tj(a,o,1,c,!1,()=>!1,(t,r)=>{let i=n.units[r];return e.aUnit=i,e.bUnit=i,e.aIndex=i.bonds.b[t],e.bIndex=i.bonds.a[t],e})}return tj(a,o,1,c)}e.fromGroup=t;function n(e,t){let n=e.interUnitBonds.edgeCount,r=fR.Location(e,void 0,void 0,e,void 0,void 0),i=t=>{let n=e.interUnitBonds.edges[t];return r.aUnit=e.unitMap.get(n.unitA),r.aIndex=n.indexA,r.bUnit=e.unitMap.get(n.unitB),r.bIndex=n.indexB,r};if(t?.includeLocation2){let t=fR.Location(e,void 0,void 0,e,void 0,void 0);return tj(n,1,1,i,!0,()=>!1,n=>{let r=e.interUnitBonds.edges[n];return t.aUnit=e.unitMap.get(r.unitB),t.aIndex=r.indexB,t.bUnit=e.unitMap.get(r.unitA),t.bIndex=r.indexA,t})}return tj(n,1,1,i,!0)}e.fromStructure=n;function r(e,t){let{bondCount:n,unitIndex:r,unitGroupIndex:i,unitEdgeIndex:a}=e.intraUnitBondMapping,o=n,s=fR.Location(e,void 0,void 0,e,void 0,void 0),c=t=>{let n=e.unitSymmetryGroups[r[t]].units[i[t]],o=a[t];return s.aUnit=n,s.bUnit=n,s.aIndex=n.bonds.a[o],s.bIndex=n.bonds.b[o],s};if(t?.includeLocation2){let t=fR.Location(e,void 0,void 0,e,void 0,void 0);return tj(o,1,1,c,!0,()=>!1,n=>{let o=e.unitSymmetryGroups[r[n]].units[i[n]],s=a[n];return t.aUnit=o,t.bUnit=o,t.aIndex=o.bonds.b[s],t.bIndex=o.bonds.a[s],t})}return tj(o,1,1,c,!0)}e.fromStructureGroups=r})(z6||={});function B6(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i];if(a===iJ.Null){let t=K.ofRange(0,r.elements.length);return $(e.target,[{unit:r,indices:t}])}else if(Q.isAtomic(r)){let{target:t}=e,n=r.bonds.a[a],i=r.bonds.b[a];return fR.Loci(t,[fR.Location(t,r,n,t,r,i),fR.Location(t,r,i,t,r,n)])}}return hq}function V6(e,t,n,r){let i=!1;if(fR.isLoci(e)){let{structure:r,group:a}=t;if(!nB.areEquivalent(e.structure,r))return!1;let o=a.units[0];if(!Q.isAtomic(o))return!1;let s=o.bonds.edgeCount*2;for(let t of e.bonds){if(t.aUnit!==t.bUnit)continue;let e=a.unitIndexMap.get(t.aUnit.id);if(e!==void 0){let r=o.bonds.getDirectedEdgeIndex(t.aIndex,t.bIndex);r!==-1&&n(G.ofSingleton(e*s+r))&&(i=!0)}}}else if($.is(e)){let{structure:a,group:o}=t;if(!nB.areEquivalent(e.structure,a))return!1;let s=o.units[0];if(!Q.isAtomic(s))return!1;let c=s.bonds.edgeCount*2;for(let t of e.elements){let e=o.unitIndexMap.get(t.unit.id);if(e!==void 0){let{offset:a,b:o}=s.bonds;K.forEach(t.indices,s=>{for(let l=a[s],u=a[s+1];l<u;l++)(!r||K.has(t.indices,o[l]))&&n(G.ofSingleton(e*c+l))&&(i=!0)})}}}return i}function H6(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){let{target:e}=t;if(i===iJ.Null)return nB.Loci(e);{let n=t.interUnitBonds.edges[i],r=t.unitMap.get(n.unitA),a=t.unitMap.get(n.unitB);return fR.Loci(e,[fR.Location(e,r,n.indexA,e,a,n.indexB),fR.Location(e,a,n.indexB,e,r,n.indexA)])}}return hq}var U6=new Map;function W6(e,t,n,r){let i=!1;if(fR.isLoci(e)){if(!nB.areEquivalent(e.structure,t))return!1;for(let r of e.bonds){let e=t.interUnitBonds.getBondIndexFromLocation(r);e!==-1&&n(G.ofSingleton(e))&&(i=!0)}}else if($.is(e)){if(!nB.areEquivalent(e.structure,t)||r&&e.elements.length===1)return!1;for(let t of e.elements)U6.set(t.unit.id,t.indices);for(let a of e.elements){let{unit:e}=a;if(Q.isAtomic(e))for(let o of t.interUnitBonds.getConnectedUnits(e.id)){let s=U6.get(o.unitB);(!r||s)&&K.forEach(a.indices,a=>{if(o.connectedIndices.includes(a)){for(let c of o.getEdges(a))if(!r||s&&K.has(s,c.indexB)){let r=t.interUnitBonds.getEdgeIndex(a,e.id,c.indexB,o.unitB);n(G.ofSingleton(r))&&(i=!0)}}})}}U6.clear()}return i}function G6(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){let e=t.intraUnitBondMapping;return B6({objectId:r,instanceId:e.unitGroupIndex[i],groupId:e.unitEdgeIndex[i]},{structure:t,group:t.unitSymmetryGroups[e.unitIndex[i]]},n)}return hq}function K6(e,t,n,r){let{unitGroupOffset:i}=t.intraUnitBondMapping,a=!1;if(fR.isLoci(e)){if(!nB.areEquivalent(e.structure,t))return!1;for(let r of e.bonds){if(r.aUnit!==r.bUnit)continue;let e=t.unitSymmetryGroupsIndexMap.get(r.aUnit.id),o=t.unitSymmetryGroups[e],s=o.units[0];if(!Q.isAtomic(s))continue;let c=i[e],l=s.bonds.edgeCount*2,u=o.unitIndexMap.get(r.aUnit.id);if(u!==void 0){let e=s.bonds.getDirectedEdgeIndex(r.aIndex,r.bIndex);e!==-1&&n(G.ofSingleton(u*l+e+c))&&(a=!0)}}}else if($.is(e)){if(!nB.areEquivalent(e.structure,t))return!1;for(let o of e.elements){let e=t.unitSymmetryGroupsIndexMap.get(o.unit.id),s=t.unitSymmetryGroups[e],c=s.units[0];if(!Q.isAtomic(c))continue;let l=i[e],u=c.bonds.edgeCount*2,d=s.unitIndexMap.get(o.unit.id);if(d!==void 0){let{offset:e,b:t}=c.bonds;K.forEach(o.indices,i=>{for(let s=e[i],c=e[i+1];s<c;s++)(!r||K.has(o.indices,t[s]))&&n(G.ofSingleton(d*u+s+l))&&(a=!0)})}}}return a}var q6=kI.is;function J6(e,t,n,r){let i=e.elements,{edgeCount:a,a:o,b:s,edgeProps:c,offset:l}=e.bonds,{order:u,flags:d}=c,{sizeFactor:f,sizeAspectRatio:p,adjustCylinderLength:m,aromaticBonds:h,includeTypes:g,excludeTypes:_,multipleBonds:v}=r,y=v===`off`,b=v===`symmetric`,x=I6(kI.fromNames(g),kI.fromNames(_),kI.Flag.Computed),S=B(),C=B(),w=e.conformation,T,E=iL.create(t,e),D=fR.Location(t,e,void 0,t,e,void 0),{child:O}=t;if(r.includeParent&&O){let t=O.unitMap.get(e.id);if(!t)throw Error(`expected childUnit to exist`);T=e=>{let n=i[o[e]],r=i[s[e]];return Vk.has(t.elements,n)&&!Vk.has(t.elements,r)}}let k=e=>(D.aIndex=o[e],D.bIndex=s[e],n.size.size(D)*f),A=e=>(E.element=i[o[e]],n.size.size(E)*f),j=e=>(E.element=i[s[e]],n.size.size(E)*f),{elementRingIndices:M,elementAromaticRingIndices:N}=e.rings,ee=h?e.resonance.delocalizedTriplets:void 0;return{linkCount:a*2,referencePosition:e=>{let t=o[e],n=s[e],r=ee?.getThirdElement(t,n);if(r!==void 0)return w.invariantPosition(i[r],S);t>n&&([t,n]=[n,t]),l[t+1]-l[t]===1&&([t,n]=[n,t]);let a=N.get(t)||M.get(t),c=0;for(let e=l[t],r=l[t+1];e<r;++e){let r=s[e];if(r!==n&&r!==t)if(a){let e=N.get(r)||M.get(r);if(!e)continue;let t=AE(a,e);t>c&&(c=t,w.invariantPosition(i[r],S))}else return w.invariantPosition(i[r],S)}return c>0?S:null},position:(e,t,n,r)=>{if(w.invariantPosition(i[o[n]],e),w.invariantPosition(i[s[n]],t),r&&m){let r=A(n),i=j(n),a=Math.min(r,i)*p,o=Math.sqrt(Math.max(0,r*r-a*a))-.05,s=Math.sqrt(Math.max(0,i*i-a*a))-.05;if(o<=.01&&s<=.01)return;B.normalize(C,B.sub(C,t,e)),B.scaleAndAdd(e,e,C,o),B.scaleAndAdd(t,t,C,-s)}},style:e=>{let t=u[e],n=d[e];if(q6(n,kI.Flag.MetallicCoordination)||q6(n,kI.Flag.HydrogenBond))return C1.Dashed;if(t===3)return y?C1.Solid:b?C1.Triple:C1.OffsetTriple;if(h){let t=o[e],r=s[e],i=N.get(t),a=N.get(r),c=i&&a?AE(i,a):0;if(q6(n,kI.Flag.Aromatic)||c&&!x)return c===2?C1.MirroredAromatic:C1.Aromatic}return t!==2||y?C1.Solid:b?C1.Double:C1.OffsetDouble},radius:e=>k(e)*p,ignore:aut(t,e,r),stub:T}}function sut(e,t,n,r,i,a){if(!Q.isAtomic(t)||!L6(t,i)||!t.bonds.edgeCount)return CF.createEmpty(a);let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return CF.createEmpty(a);let{cylinders:c,boundingSphere:l}=k1(e,J6(t,n,r,i),i,a);if(l)c.setBoundingSphere(l);else if(c.cylinderCount>0){let e=q.expand(q(),(s??t).boundary.sphere,1*i.sizeFactor);c.setBoundingSphere(e)}return c}function cut(e,t,n,r,i,a){if(!Q.isAtomic(t)||!L6(t,i)||!t.bonds.edgeCount)return HM.createEmpty(a);let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return HM.createEmpty(a);let{mesh:c,boundingSphere:l}=O1(e,J6(t,n,r,i),i,a);if(l)c.setBoundingSphere(l);else if(c.triangleCount>0){let e=q.expand(q(),(s??t).boundary.sphere,1*i.sizeFactor);c.setBoundingSphere(e)}return c}const Y6={...b$,...w$,...P6,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:V.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:V.Boolean(!0),includeParent:V.Boolean(!1)};function lut(e,t,n,r){return n.tryUseImpostor&&r$(r)?uut(e):dut(e)}function uut(e){return T$({defaultProps:V.getDefaultValues(Y6),createGeometry:sut,createLocationIterator:(e,t)=>z6.fromGroup(e,{includeLocation2:t.colorMode===`interpolate`}),getLoci:B6,eachLocation:V6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!aq.areEqual(r.size,i.size),t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0);let s=a.group.units[0],c=o.group.units[0];Q.isAtomic(s)&&Q.isAtomic(c)&&(KI.areEqual(s.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function dut(e){return x$({defaultProps:V.getDefaultValues(Y6),createGeometry:cut,createLocationIterator:e=>z6.fromGroup(e),getLoci:B6,eachLocation:V6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds;let s=a.group.units[0],c=o.group.units[0];Q.isAtomic(s)&&Q.isAtomic(c)&&(KI.areEqual(s.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}function fut(e,t,n){let r=[],{bondCount:i,unitIndex:a,unitEdgeIndex:o,unitGroupIndex:s}=e.intraUnitBondMapping,{child:c}=e;for(let i of e.unitSymmetryGroups){let a=i.units[0],o=c?.unitMap.get(a.id),s=Q.isAtomic(a)&&!(c&&!o)?J6(a,e,t,n):_1e;r.push({group:i,props:s})}return{linkCount:i,referencePosition:e=>{let{group:t,props:n}=r[a[e]];if(!n.referencePosition)return null;let i=n.referencePosition(o[e]);if(!i)return null;let c=t.units[s[e]];return B.transformMat4(i,i,c.conformation.operator.matrix),i},position:(e,t,n,i)=>{let{group:c,props:l}=r[a[n]];l.position(e,t,o[n],i);let u=c.units[s[n]];B.transformMat4(e,e,u.conformation.operator.matrix),B.transformMat4(t,t,u.conformation.operator.matrix)},style:e=>{let{props:t}=r[a[e]];return t.style?t.style(o[e]):C1.Solid},radius:e=>{let{props:t}=r[a[e]];return t.radius(o[e])},ignore:e=>{let{props:t}=r[a[e]];return t.ignore?t.ignore(o[e]):!1},stub:e=>{let{props:t}=r[a[e]];return t.stub?t.stub(o[e]):!1}}}function put(e,t,n,r,i){if(!R6(t,r)||!t.intraUnitBondMapping.bondCount)return CF.createEmpty(i);let{cylinders:a,boundingSphere:o}=k1(e,fut(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.cylinderCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}function mut(e,t,n,r,i){if(!R6(t,r)||!t.intraUnitBondMapping.bondCount)return HM.createEmpty(i);let{mesh:a,boundingSphere:o}=O1(e,fut(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.triangleCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}const hut={...m$,...TZe,...P6,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:V.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:V.Boolean(!0),includeParent:V.Boolean(!1)};function gut(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?_ut(e):vut(e)}function _ut(e){return EZe({defaultProps:V.getDefaultValues(hut),createGeometry:put,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructureGroups(e,{includeLocation2:t.colorMode===`interpolate`}):nj,getLoci:G6,eachLocation:K6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds,t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0),R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function vut(e){return h$({defaultProps:V.getDefaultValues(hut),createGeometry:mut,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructureGroups(e):nj,getLoci:G6,eachLocation:K6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!aq.areEqual(r.size,i.size),R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var X6=new fR.ElementBondIterator;function yut(e,t,n,r){for(X6.setElement(t,n,r);X6.hasNext;){let t=X6.move();return t.otherUnit.conformation.position(t.otherUnit.elements[t.otherIndex],e),e}return null}var but=B();function xut(e,t,n){let r=iL.create(e),i=fR.Location(e,void 0,void 0,e,void 0,void 0),{edgeCount:a,edges:o}=e.interUnitBonds,{sizeFactor:s,sizeAspectRatio:c,adjustCylinderLength:l,aromaticBonds:u,multipleBonds:d}=n,f=d===`off`,p=d===`symmetric`,m=B(),h,{child:g}=e;n.includeParent&&g&&(h=t=>{let n=o[t],r=g.unitMap.get(n.unitA),i=g.unitMap.get(n.unitB),a=e.unitMap.get(n.unitA).elements[n.indexA],s=e.unitMap.get(n.unitB).elements[n.indexB];return r&&Vk.has(r.elements,a)&&(!i||!Vk.has(i.elements,s))});let _=n=>{let r=o[n];return i.aUnit=e.unitMap.get(r.unitA),i.aIndex=r.indexA,i.bUnit=e.unitMap.get(r.unitB),i.bIndex=r.indexB,t.size.size(i)*s},v=n=>{let i=o[n];return r.unit=e.unitMap.get(i.unitA),r.element=r.unit.elements[i.indexA],t.size.size(r)*s},y=n=>{let i=o[n];return r.unit=e.unitMap.get(i.unitB),r.element=r.unit.elements[i.indexB],t.size.size(r)*s};return{linkCount:a,referencePosition:t=>{let n=o[t],r,i,a,s;if(n.unitA<n.unitB)r=e.unitMap.get(n.unitA),i=e.unitMap.get(n.unitB),a=n.indexA,s=n.indexB;else if(n.unitA>n.unitB)r=e.unitMap.get(n.unitB),i=e.unitMap.get(n.unitA),a=n.indexB,s=n.indexA;else throw Error(`same units in createInterUnitBondCylinderMesh`);return yut(but,e,r,a)||yut(but,e,i,s)},position:(t,n,r,i)=>{let a=o[r],s=e.unitMap.get(a.unitA),u=e.unitMap.get(a.unitB);if(s.conformation.position(s.elements[a.indexA],t),u.conformation.position(u.elements[a.indexB],n),i&&l){let e=v(r),i=y(r),a=Math.min(e,i)*c,o=Math.sqrt(Math.max(0,e*e-a*a))-.05,s=Math.sqrt(Math.max(0,i*i-a*a))-.05;if(o<=.01&&s<=.01)return;B.normalize(m,B.sub(m,n,t)),B.scaleAndAdd(t,t,m,o),B.scaleAndAdd(n,n,m,-s)}},style:e=>{let t=o[e].props.order,n=_x.create(o[e].props.flag);return kI.is(n,kI.Flag.MetallicCoordination)||kI.is(n,kI.Flag.HydrogenBond)?C1.Dashed:t===3?f?C1.Solid:p?C1.Triple:C1.OffsetTriple:u&&kI.is(n,kI.Flag.Aromatic)?C1.Aromatic:t!==2||f?C1.Solid:p?C1.Double:C1.OffsetDouble},radius:e=>_(e)*c,ignore:out(e,n),stub:h}}function Sut(e,t,n,r,i){if(!R6(t,r)||!t.interUnitBonds.edgeCount)return CF.createEmpty(i);let{cylinders:a,boundingSphere:o}=k1(e,xut(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.cylinderCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}function Cut(e,t,n,r,i){if(!R6(t,r)||!t.interUnitBonds.edgeCount)return HM.createEmpty(i);let{mesh:a,boundingSphere:o}=O1(e,xut(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.triangleCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}const Z6={...m$,...TZe,...P6,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:V.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:V.Boolean(!0),includeParent:V.Boolean(!1)};function wut(e,t,n,r){return n.tryUseImpostor&&r$(r)?Tut(e):Eut(e)}function Tut(e){return EZe({defaultProps:V.getDefaultValues(Z6),createGeometry:Sut,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructure(e,{includeLocation2:t.colorMode===`interpolate`}):nj,getLoci:H6,eachLocation:W6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds,t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0),R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function Eut(e){return h$({defaultProps:V.getDefaultValues(Z6),createGeometry:Cut,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructure(e):nj,getLoci:H6,eachLocation:W6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!aq.areEqual(r.size,i.size),R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var Q6=B.add;function $6(e,t,n){let{ignoreHydrogens:r,ignoreHydrogensVariant:i,traceOnly:a}=n,o=Q.isCoarse(t),{child:s}=e,c=s?.unitMap.get(t.id);if(s&&!c)throw Error(`expected childUnit to exist if child exists`);if(!(!s&&!r&&!a))return n=>!!c&&!Vk.has(c.elements,n)||!o&&r&&l$(e,t,n,i)||a&&!u$(t,n)}function Dut(e,t,n,r,i,a){let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return HM.createEmpty(a);let{detail:c,sizeFactor:l,stride:u}=i,{elements:d,conformation:f}=t,p=d.length,m=p*rN(c),h=YN.createState(m,m/2,a),g=B(),_=$6(n,t,i),v=iL.create(n,t),y=r.size.size,b=B(),x=0,S=0;for(let e=0;e<p;e++){if(u&&e%u!==0||_&&_(d[e]))continue;f.invariantPosition(d[e],g),Q6(b,b,g),S+=1,v.element=d[e];let t=y(v);t>x&&(x=t),h.currentGroup=e,oN(h,g,t*l,c)}let C=YN.getMesh(h);if(S===0)return C;let w;B.scale(b,b,1/S);let T=a?q.clone(a.boundingSphere):void 0;return w=T&&B.distance(b,T.center)/T.radius<.1?T:q.expand(q(),(s??t).boundary.sphere,x*l+.05),C.setBoundingSphere(w),C}function Out(e,t,n,r,i,a){let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return HP.createEmpty(a);let{sizeFactor:c,stride:l}=i,{elements:u,conformation:d}=t,f=u.length,p=S3.create(f,f/2,a),m=B(),h=$6(n,t,i),g=iL.create(n,t),_=r.size.size,v=B(),y=0,b=0;if(l&&l>1||h||r.size.granularity!==`uniform`)for(let e=0;e<f;e++){if(l&&e%l!==0||h&&h(u[e]))continue;d.invariantPosition(u[e],m),p.add(m[0],m[1],m[2],e),Q6(v,v,m),b+=1,g.element=u[e];let t=_(g);t>y&&(y=t)}else{for(let e=0;e<f;e++)d.invariantPosition(u[e],m),p.add(m[0],m[1],m[2],e),Q6(v,v,m);b=f,y=_(g)}let x=p.getSpheres();if(b===0)return x;let S;B.scale(v,v,1/b);let C=a?q.clone(a.boundingSphere):void 0;return S=C&&B.distance(v,C.center)/C.radius<.1?C:q.expand(q(),(s??t).boundary.sphere,y*c+.05),x.setBoundingSphere(S),x}function e8(e,t,n){let r=!1;if(!$.is(e))return!1;let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;let o=a.elements.length,{unitIndexMap:s}=a;for(let t of e.elements){let e=s.get(t.unit.id);if(e!==void 0){let i=e*o;if(G.is(t.indices)){let e=i+G.start(t.indices),a=i+G.end(t.indices);n(G.ofBounds(e,a))&&(r=!0)}else for(let e=0,a=t.indices.length;e<a;e++){let o=t.indices[e],s=e+1;for(;s<a&&t.indices[s]===o;)s++;e=s-1;let c=t.indices[e];r=n(G.ofRange(i+o,i+c))||r}}}return r}function t8(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i],o=a===iJ.Null?K.ofRange(0,r.elements.length):K.ofSingleton(a);return $(e.target,[{unit:r,indices:o}])}return hq}function kut(e,t,n,r,i){let{child:a}=t,{detail:o,sizeFactor:s,stride:c}=r,{getSerialIndex:l}=t.serialMapping,u=t.elementCount*rN(o),d=YN.createState(u,u/2,i),f=n.size.size,p=B(),m=0,h=0;for(let e of t.units){let n=a?.unitMap.get(e.id);if(a&&!n)continue;let{elements:i,conformation:u}=e,g=i.length,_=B(),v=$6(t,e,r),y=iL.create(t,e);for(let t=0;t<g;t++){let n=i[t];if(c&&t%c!==0||v&&v(n))continue;u.position(n,_),Q6(p,p,_),h+=1,y.element=n;let r=f(y);r>m&&(m=r),d.currentGroup=l(e,n),oN(d,_,r*s,o)}}let g=YN.getMesh(d);if(h===0)return g;let _;B.scale(p,p,1/h);let v=i?q.clone(i.boundingSphere):void 0;return _=v&&B.distance(p,v.center)/v.radius<1?v:q.expand(q(),(a??t).boundary.sphere,m*s+.05),g.setBoundingSphere(_),g}function Aut(e,t,n,r,i){let{child:a}=t,{sizeFactor:o,stride:s}=r,{getSerialIndex:c}=t.serialMapping,l=t.elementCount,u=S3.create(l,l/2,i),d=n.size.size,f=B(),p=0,m=0;for(let e of t.units){let i=a?.unitMap.get(e.id);if(a&&!i)continue;let{elements:o,conformation:l}=e,h=o.length,g=B(),_=$6(t,e,r),v=iL.create(t,e);if(s&&s>1||_||n.size.granularity!==`uniform`)for(let t=0;t<h;t++){let n=o[t];if(s&&t%s!==0||_&&_(n))continue;l.position(n,g),u.add(g[0],g[1],g[2],c(e,n)),Q6(f,f,g),m+=1,v.element=n;let r=d(v);r>p&&(p=r)}else{for(let t=0;t<h;t++){let n=o[t];l.position(n,g),u.add(g[0],g[1],g[2],c(e,n)),Q6(f,f,g)}m+=h,p=d(v)}}let h=u.getSpheres();if(m===0)return h;let g;B.scale(f,f,1/m);let _=i?q.clone(i.boundingSphere):void 0;return g=_&&B.distance(f,_.center)/_.radius<1?_:q.expand(q(),(a??t).boundary.sphere,p*o+.05),h.setBoundingSphere(g),h}function n8(e,t,n){let r=!1;if(!$.is(e)||!nB.areEquivalent(e.structure,t))return!1;let{cumulativeUnitElementCount:i}=t.serialMapping;for(let a of e.elements){let e=t.unitIndexMap.get(a.unit.id);if(e!==void 0)if(G.is(a.indices)){let t=i[e]+G.start(a.indices),o=i[e]+G.end(a.indices);n(G.ofBounds(t,o))&&(r=!0)}else for(let t=0,o=a.indices.length;t<o;t++){let o=i[e]+a.indices[t];n(G.ofSingleton(o))&&(r=!0)}}return r}function r8(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){if(i===iJ.Null)return nB.Loci(t);{let{unitIndices:e,cumulativeUnitElementCount:n}=t.serialMapping,r=e[i],a=t.units[r],o=i-n[r],s=K.ofSingleton(o);return $(t,[{unit:a,indices:s}])}}return hq}var i8;(function(e){function t(e){let{group:t,structure:n}=e,r=t.elements.length,i=t.units.length,a=iL.create(n);return tj(r,i,1,(e,n)=>{let r=t.units[n];return a.unit=r,a.element=r.elements[e],a})}e.fromGroup=t;function n(e){let{units:t,elementCount:n}=e,r=n,{unitIndices:i,elementIndices:a}=e.serialMapping,o=iL.create(e);return tj(r,1,1,e=>(o.unit=t[i[e]],o.element=a[e],o),!0)}e.fromStructure=n})(i8||={});const jut={sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1),tryUseImpostor:V.Boolean(!0),stride:V.Numeric(1,{min:1,max:100,step:1})},a8={...b$,...S$,...jut};function Mut(e,t,n,r){return n.tryUseImpostor&&t$(r)?Nut(e):Put(e)}function Nut(e){return C$({defaultProps:V.getDefaultValues(a8),createGeometry:Out,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function Put(e){return x$({defaultProps:V.getDefaultValues(a8),createGeometry:Dut,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}const Fut={...m$,...CZe,...jut};function Iut(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth&&r.extensions.textureFloat?Lut(e):Rut(e)}function Lut(e){return wZe({defaultProps:V.getDefaultValues(Fut),createGeometry:Aut,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function Rut(e){return h$({defaultProps:V.getDefaultValues(Fut),createGeometry:kut,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var zut={"element-sphere":(e,t)=>v$(`Element sphere`,e,t,Mut),"intra-bond":(e,t)=>v$(`Intra-unit bond cylinder`,e,t,lut),"inter-bond":(e,t)=>GQ(`Inter-unit bond cylinder`,e,t,wut),"structure-element-sphere":(e,t)=>GQ(`Structure element sphere`,e,t,Iut),"structure-intra-bond":(e,t)=>GQ(`Structure intra-unit bond cylinder`,e,t,gut)};const But={...a8,traceOnly:V.Boolean(!1,{isHidden:!0}),...Y6,...Z6,includeParent:V.Boolean(!1),unitKinds:d$([`atomic`]),sizeFactor:V.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:V.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:V.MultiSelect([`element-sphere`,`intra-bond`,`inter-bond`],V.objectToOptions(zut)),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory)};function Vut(e,t){let n=But;return nB.getSize(t)>=nB.Size.Huge?(n=V.clone(n),n.visuals.defaultValue=[`element-sphere`,`intra-bond`]):t.unitSymmetryGroups.length>5e3&&(n=V.clone(n),n.visuals.defaultValue=[`structure-element-sphere`,`structure-intra-bond`]),n}function Hut(e,t){return rJ.createMulti(`Ball & Stick`,e,t,O$,zut)}const Uut=k$({name:`ball-and-stick`,label:`Ball & Stick`,description:`Displays atoms as spheres and bonds as cylinders.`,factory:Hut,getParams:Vut,defaultValues:V.getDefaultValues(But),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent});function Wut(e,t,n,r,i){let{links:a,elements:o}=t.carbohydrates,{linkSizeFactor:s}=r,c=iL.create(t),{mesh:l,boundingSphere:u}=O1(e,{linkCount:a.length,position:(e,t,n)=>{let r=a[n];B.copy(e,o[r.carbohydrateIndexA].geometry.center),B.copy(t,o[r.carbohydrateIndexB].geometry.center)},radius:e=>{let t=o[a[e].carbohydrateIndexA],r=t.unit.rings.all[t.ringIndex];return c.unit=t.unit,c.element=t.unit.elements[r[0]],n.size.size(c)*s}},r,i);if(u)l.setBoundingSphere(u);else if(l.triangleCount>0){let e=q.expand(q(),t.boundary.sphere,1*s);l.setBoundingSphere(e)}return l}const Gut={...b$,...v1,linkSizeFactor:V.Numeric(.3,{min:0,max:3,step:.01})};function Kut(e){return h$({defaultProps:V.getDefaultValues(Gut),createGeometry:Wut,createLocationIterator:qut,getLoci:Jut,eachLocation:Yut,setUpdateState:(e,t,n)=>{e.createGeometry=t.linkSizeFactor!==n.linkSizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function qut(e){let{elements:t,links:n}=e.carbohydrates,r=n.length,i=iL.create(e);return tj(r,1,1,e=>{let r=t[n[e].carbohydrateIndexA],a=r.unit.rings.all[r.ringIndex];return i.unit=r.unit,i.element=r.unit.elements[a[0]],i},!0)}function Jut(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){if(i===iJ.Null)return nB.Loci(t);{let{links:e,elements:n}=t.carbohydrates,r=e[i],a=n[r.carbohydrateIndexA],o=n[r.carbohydrateIndexB];return $.union(i$(t,a.unit,a.residueIndex,a.altId),i$(t,o.unit,o.residueIndex,o.altId))}}return hq}var o8=new Set;function Yut(e,t,n){let r=!1;if(!$.is(e)||!nB.areEquivalent(e.structure,t))return!1;let{getLinkIndices:i}=t.carbohydrates;for(let{unit:t,indices:a}of e.elements)Q.isAtomic(t)&&(o8.clear(),K.forEach(a,e=>{let a=i(t,t.elements[e]);for(let e=0,t=a.length;e<t;++e)o8.has(a[e])||(o8.add(a[e]),n(G.ofSingleton(a[e]))&&(r=!0))}));return r}var Xut=B.create(0,0,-.5),Zut=B.create(0,0,.5),s8=B(),c8=B(),l8=B(),Qut=B();function $ut(e){let t=e.length/3,n=(t===3?1:t===4?2:t)+t,r=JM(n,t===4?t*3+4:n*3);for(let n=0;n<t;++n){let i=(n+1)%t;B.set(s8,e[n*3],e[n*3+1],-.5),B.set(c8,e[i*3],e[i*3+1],-.5),r.add(s8,c8,Zut)}if(t===3)B.set(s8,e[0],e[1],-.5),B.set(c8,e[3],e[4],-.5),B.set(l8,e[6],e[7],-.5),r.add(l8,c8,s8);else if(t===4)B.set(s8,e[0],e[1],-.5),B.set(c8,e[3],e[4],-.5),B.set(l8,e[6],e[7],-.5),B.set(Qut,e[9],e[10],-.5),r.addQuad(Qut,l8,c8,s8);else for(let n=0;n<t;++n){let i=(n+1)%t;B.set(s8,e[n*3],e[n*3+1],-.5),B.set(c8,e[i*3],e[i*3+1],-.5),r.add(Xut,c8,s8)}return r.getPrimitive()}var edt;function tdt(){return edt||=$ut(cN(8,!0)),edt}var u8;function ndt(){if(!u8){let e=cN(8,!0),t=new Float32Array(30);for(let n=0;n<8;++n)t[n*3]=e[n*3],t[n*3+1]=e[n*3+1],t[n*3+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,u8=KM(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return u8}const rdt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3};var d8=B.zero(),f8=B.zero(),p8=B.zero(),m8=B.zero(),h8=B.zero();function idt(e){let{outerRadius:t,innerRadius:n,thickness:r,pointCount:i}={...rdt,...e},a=JM(i*2*2),o=new Float32Array(i*2),s=new Float32Array(i*2);for(let e=0;e<i;++e){let r=e*2,a=e*2+1,c=(r+1)/i*Math.PI,l=(a+1)/i*Math.PI;s[r]=Math.cos(c)*t,s[a]=Math.sin(c)*t,o[r]=Math.cos(l)*n,o[a]=Math.sin(l)*n}B.set(d8,0,0,r/2),B.set(f8,0,0,-r/2);for(let e=0;e<i;++e){let t=(e+1)%i;B.set(p8,s[e*2],s[e*2+1],0),B.set(m8,o[e*2],o[e*2+1],0),B.set(h8,s[t*2],s[t*2+1],0),a.add(d8,p8,m8),a.add(m8,p8,f8),a.add(d8,m8,h8),a.add(h8,m8,f8)}return a.getPrimitive()}const adt=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],odt=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],sdt=[0,2,4,0,4,3,1,2,5,1,5,3];var cdt;function ldt(){return cdt||=KM(adt,odt),cdt}var udt;function ddt(){return udt||=KM(adt,sdt),udt}var g8=z.identity(),_8=B(),fdt=B(),pdt=2*.806,mdt=EP(),hdt=kTe(),gdt=tdt(),_dt=ndt(),vdt=idt({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),ydt=ldt(),bdt=ddt(),xdt=aTe(),Sdt=oTe(),Cdt=sTe(),wdt=cTe(),Tdt=lTe();function Edt(e,t,n,r,i){let a=YN.createState(256,128,i),{detail:o,sizeFactor:s}=r,c=t.carbohydrates,l=c.elements.length,u=iL.create(t);for(let e=0;e<l;++e){let t=c.elements[e],r=t.unit.rings.all[t.ringIndex],i=zEe(t.component.type,r.length);u.unit=t.unit,u.element=t.unit.elements[r[0]];let l=n.size.size(u),d=l*s,f=l*s*pdt,{center:p,normal:m,direction:h}=t.geometry;switch(B.add(fdt,p,h),z.targetTo(g8,p,fdt,m),z.setTranslation(g8,p),a.currentGroup=e*2,i){case WF.FilledSphere:oN(a,p,d,o);break;case WF.FilledCube:z.scaleUniformly(g8,g8,f),YN.addPrimitive(a,g8,mdt);break;case WF.CrossedCube:z.scaleUniformly(g8,g8,f),YN.addPrimitive(a,g8,hdt),z.mul(g8,g8,z.rotZ90X180),a.currentGroup+=1,YN.addPrimitive(a,g8,hdt);break;case WF.FilledCone:z.scaleUniformly(g8,g8,f*1.2),YN.addPrimitive(a,g8,gdt);break;case WF.DevidedCone:z.scaleUniformly(g8,g8,f*1.2),YN.addPrimitive(a,g8,_dt),z.mul(g8,g8,z.rotZ90),a.currentGroup+=1,YN.addPrimitive(a,g8,_dt);break;case WF.FlatBox:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f,f/2)),YN.addPrimitive(a,g8,mdt);break;case WF.FilledStar:z.scaleUniformly(g8,g8,f),z.mul(g8,g8,z.rotZY90),YN.addPrimitive(a,g8,vdt);break;case WF.FilledDiamond:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f*1.4,f*1.4,f*1.4)),YN.addPrimitive(a,g8,ydt);break;case WF.DividedDiamond:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f*1.4,f*1.4,f*1.4)),YN.addPrimitive(a,g8,bdt),z.mul(g8,g8,z.rotY90),a.currentGroup+=1,YN.addPrimitive(a,g8,bdt);break;case WF.FlatDiamond:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f/2,f/2)),YN.addPrimitive(a,g8,xdt);break;case WF.DiamondPrism:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f,f/2)),YN.addPrimitive(a,g8,xdt);break;case WF.PentagonalPrism:case WF.Pentagon:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f,f/2)),YN.addPrimitive(a,g8,Sdt);break;case WF.HexagonalPrism:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f,f/2)),YN.addPrimitive(a,g8,Cdt);break;case WF.HeptagonalPrism:z.mul(g8,g8,z.rotZY90),z.scale(g8,g8,B.set(_8,f,f,f/2)),YN.addPrimitive(a,g8,Tdt);break;case WF.FlatHexagon:default:z.mul(g8,g8,z.rotZYZ90),z.scale(g8,g8,B.set(_8,f/1.5,f,f/2)),YN.addPrimitive(a,g8,wdt);break}}return YN.getMesh(a)}const Ddt={...m$,detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),sizeFactor:V.Numeric(1.75,{min:0,max:10,step:.01})};function Odt(e){return h$({defaultProps:V.getDefaultValues(Ddt),createGeometry:Edt,createLocationIterator:kdt,getLoci:Adt,eachLocation:jdt,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}},e)}function kdt(e){let t=e.carbohydrates.elements,n=t.length*2,r=iL.create(e);function i(e,n){let i=t[Math.floor(e/2)],a=i.unit.rings.all[i.ringIndex];return r.unit=i.unit,r.element=i.unit.elements[a[0]],r}function a(e,t){return e%2==1}return tj(n,1,1,i,!0,a)}function Adt(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){if(i===iJ.Null)return nB.Loci(t);{let e=t.carbohydrates.elements[Math.floor(i/2)];return i$(t,e.unit,e.residueIndex,e.altId)}}return hq}var v8=new Set;function jdt(e,t,n){let{getElementIndices:r}=t.carbohydrates,i=!1;if(!$.is(e)||!nB.areEquivalent(e.structure,t))return!1;for(let{unit:t,indices:a}of e.elements)Q.isAtomic(t)&&(v8.clear(),K.forEach(a,e=>{let a=r(t,t.elements[e]);for(let e=0,t=a.length;e<t;++e)v8.has(a[e])||(v8.add(a[e]),n(G.ofSingleton(a[e]*2))&&(i=!0))}));return i}function Mdt(e,t,n,r,i){let{terminalLinks:a,elements:o}=t.carbohydrates,{terminalLinkSizeFactor:s}=r,c=iL.create(t),{mesh:l,boundingSphere:u}=O1(e,{linkCount:a.length,position:(e,t,n)=>{let r=a[n];r.fromCarbohydrate?(B.copy(e,o[r.carbohydrateIndex].geometry.center),r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],t)):(r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],e),B.copy(t,o[r.carbohydrateIndex].geometry.center))},radius:e=>{let t=a[e];if(t.fromCarbohydrate){let e=o[t.carbohydrateIndex],n=e.unit.rings.all[e.ringIndex];c.unit=e.unit,c.element=e.unit.elements[n[0]]}else c.unit=t.elementUnit,c.element=t.elementUnit.elements[t.elementIndex];return n.size.size(c)*s},style:e=>{let t=a[e],n=t.elementUnit.elements[t.elementIndex],r=IL(t.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(n));return FL.has(r)?C1.Dashed:C1.Solid}},r,i);if(u)l.setBoundingSphere(u);else if(l.triangleCount>0){let e=q.expand(q(),t.boundary.sphere,1*s);l.setBoundingSphere(e)}return l}const Ndt={...b$,...v1,terminalLinkSizeFactor:V.Numeric(.2,{min:0,max:3,step:.01})};function Pdt(e){return h$({defaultProps:V.getDefaultValues(Ndt),createGeometry:Mdt,createLocationIterator:Fdt,getLoci:Idt,eachLocation:Ldt,setUpdateState:(e,t,n)=>{e.createGeometry=t.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function Fdt(e){let{elements:t,terminalLinks:n}=e.carbohydrates,r=n.length,i=iL.create(e);return tj(r,1,1,e=>{let r=n[e];if(r.fromCarbohydrate){let e=t[r.carbohydrateIndex],n=e.unit.rings.all[e.ringIndex];i.unit=e.unit,i.element=e.unit.elements[n[0]]}else i.unit=r.elementUnit,i.element=r.elementUnit.elements[r.elementIndex];return i},!0)}function Idt(e,t,n){let{objectId:r,groupId:i}=e;if(n===r){if(i===iJ.Null)return nB.Loci(t);{let{terminalLinks:e,elements:n}=t.carbohydrates,r=e[i],a=n[r.carbohydrateIndex];return $.union(i$(t,a.unit,a.residueIndex,a.altId),nZe(t,r.elementUnit,r.elementUnit.elements[r.elementIndex]))}}return hq}var y8=new Set;function Ldt(e,t,n){let r=!1;if(!$.is(e)||!nB.areEquivalent(e.structure,t))return!1;let{getTerminalLinkIndices:i}=t.carbohydrates;for(let{unit:t,indices:a}of e.elements)Q.isAtomic(t)&&(y8.clear(),K.forEach(a,e=>{let a=i(t,t.elements[e]);for(let e=0,t=a.length;e<t;++e)y8.has(a[e])||(y8.add(a[e]),n(G.ofSingleton(a[e]))&&(r=!0))}));return r}var Rdt={"carbohydrate-symbol":(e,t)=>GQ(`Carbohydrate symbol mesh`,e,t,Odt),"carbohydrate-link":(e,t)=>GQ(`Carbohydrate link cylinder`,e,t,Kut),"carbohydrate-terminal-link":(e,t)=>GQ(`Carbohydrate terminal link cylinder`,e,t,Pdt)};const zdt={...Ddt,...Gut,...Ndt,visuals:V.MultiSelect([`carbohydrate-symbol`,`carbohydrate-link`,`carbohydrate-terminal-link`],V.objectToOptions(Rdt)),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.2,{min:0,max:1,step:.01},EM.ShadingCategory)};function Bdt(e,t){return zdt}function Vdt(e,t){return rJ.createMulti(`Carbohydrate`,e,t,O$,Rdt)}const Hdt=k$({name:`carbohydrate`,label:`Carbohydrate`,description:`Displays carbohydrate symbols (3D SNFG).`,factory:Vdt,getParams:Bdt,defaultValues:V.getDefaultValues(zdt),defaultColorTheme:{name:`carbohydrate-symbol`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.models.some(e=>DB.hasCarbohydrate(e))});function Udt(e,t){switch(e.kind){case Q.Kind.Atomic:return Wdt(e,t);case Q.Kind.Spheres:case Q.Kind.Gaussians:return Gdt(e,t)}}function Wdt(e,t){let n=e.model.atomicRanges.cyclicPolymerMap,r=OR.transientSegments(J8(e),e.elements),i=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),a=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:o}=e.model.atomicHierarchy.derived.residue,s=-1,c=-1,l=!0,u=-1,d=0;for(;r.hasNext;){for(l=!0,u=d,i.setSegment(r.move());i.hasNext;){if(l){let e=i.move().index;if(++d,!i.hasNext)continue;l=!1,c=e}let e=i.move().index;s=c,c=e,t(a[s],a[c],d-1,d,o[s]),++d}n.has(c)&&(s=c,c=n.get(s),t(a[s],a[c],d-1,u,o[s]))}}function Gdt(e,t){let n=OR.transientSegments(J8(e),e.elements),{elements:r}=e,i=!0,a=0;for(;n.hasNext;){i=!0;let e=n.move(),o=e.start,s=e.end;for(let e=o,n=s;e<n;++e){if(i){if(++e,++a,e>n)continue;i=!1}t(r[e-1],r[e],a-1,a,0),++a}}}function Kdt(e,t){switch(e.kind){case Q.Kind.Atomic:return qdt(e,t);case Q.Kind.Spheres:case Q.Kind.Gaussians:return Jdt(e,t)}}function qdt(e,t){let n=OR.transientSegments(J8(e),e.elements),r=uA.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,a=0;for(;n.hasNext;)for(r.setSegment(n.move());r.hasNext;){let e=r.move().index;t(i[e],a),++a}}function Jdt(e,t){let n=OR.transientSegments(J8(e),e.elements),{elements:r}=e,i=0;for(;n.hasNext;){let e=n.move(),a=e.start,o=e.end;for(let e=a,n=o;e<n;++e)t(r[e],i),++i}}function Ydt(e,t){switch(t.kind){case Q.Kind.Atomic:return new Zdt(e,t);case Q.Kind.Spheres:case Q.Kind.Gaussians:return new Qdt(e,t)}}function Xdt(e,t){return{centerA:iL.create(e,t),centerB:iL.create(e,t)}}var Zdt=class{move(){let{elements:e,residueIndex:t}=this.unit,n=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[t[e[n.start]]],this.value.centerB.element=this.traceElementIndex[t[e[n.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}constructor(e,t){this.unit=t,this.hasNext=!1,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=OR.transientSegments(vft(t),t.elements),this.value=Xdt(e,t),this.hasNext=this.gapIt.hasNext}},Qdt=class{move(){let e=this.gapIt.move();return this.value.centerA.element=this.unit.elements[e.start],this.value.centerB.element=this.unit.elements[e.end-1],this.hasNext=this.gapIt.hasNext,this.value}constructor(e,t){this.unit=t,this.hasNext=!1,this.gapIt=OR.transientSegments(vft(t),t.elements),this.value=Xdt(e,t),this.hasNext=this.gapIt.hasNext}};function $dt(e){let{x:t,y:n,z:r}=e.atomicConformation,{polymerType:i,traceElementIndex:a}=e.atomicHierarchy.derived.residue,o=i.length,s=K.ofBounds(0,e.atomicConformation.atomId.rowCount),c=OR.transientSegments(e.atomicRanges.polymerRanges,s),l=uA.transientSegments(e.atomicHierarchy.residueAtomSegments,s),u=new Float32Array(o*3),d=new Float32Array(o*3),f=0,p=-1,m=-1,h=B(),g=B(),_=B(),v=B(),y=B(),b=B(),x=B(),S=B(),C=B(),w=B(),T=B(),E=B(),D=B(),O=B();for(;c.hasNext;){let e=c.move();for(l.setSegment(e),f=-1,m=-1;l.hasNext;){f+=1;let{index:e}=l.move();f===0&&(m=e),p=e-2;let i=p*3;B.copy(h,g),B.copy(g,_),B.copy(_,v);let o=a[e];if(B.set(v,t[o],n[o],r[o]),f<3)continue;B.sub(y,g,h),B.sub(b,_,g),B.sub(x,v,_),B.sub(T,y,b),B.sub(E,b,x),B.cross(D,T,E),B.normalize(D,D),B.toArray(D,d,i);let s=Math.cos(B.angle(T,E)),c=B.magnitude(T),w=B.magnitude(E),k=Math.sqrt(w*c)/Math.max(2,2*(1-s));B.scale(S,T,k/c),B.sub(S,g,S),B.toArray(S,u,i),B.scale(C,E,k/w),B.sub(C,_,C),B.toArray(C,u,i+3),B.copy(O,D)}let i=m*3;B.fromArray(S,u,i+3),B.fromArray(C,u,i+6),B.normalize(D,B.sub(D,S,C));let o=a[m];B.set(h,t[o],n[o],r[o]),B.copy(w,h),B.projectPointOnVector(w,w,D,S),B.toArray(w,u,i);let s=p+2,k=s*3;B.fromArray(S,u,k-3),B.fromArray(C,u,k-6),B.normalize(D,B.sub(D,S,C));let A=a[s];B.set(h,t[A],n[A],r[A]),B.copy(w,h),B.projectPointOnVector(w,w,D,S),B.toArray(w,u,k)}return{centers:u}}const b8=dB.createProvider({label:`Helix Orientation`,descriptor:PP({name:`molstar_helix_orientation`}),type:`dynamic`,defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:async(e,t)=>({value:$dt(t)})});function x8(e){return OI.is(e,OI.Flag.Helix)}function eft(e){return OI.is(e,OI.Flag.Beta)}function S8(e,t,n={}){switch(e.kind){case Q.Kind.Atomic:return new nft(e,t,n);case Q.Kind.Spheres:case Q.Kind.Gaussians:return new rft(e,t)}}var C8=OI.create(OI.Flag.NA);function tft(e,t){return{center:iL.create(e,t),centerPrev:iL.create(e,t),centerNext:iL.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:C8,moleculeType:iI.Unknown,coarseBackboneFirst:!1,coarseBackboneLast:!1,p0:B(),p1:B(),p2:B(),p3:B(),p4:B(),d12:B(),d23:B()}}var w8;(function(e){e[e.nextPolymer=0]=`nextPolymer`,e[e.nextResidue=1]=`nextResidue`})(w8||={});var T8=B(),E8=B(),D8=B(),nft=class{atomicPos(e,t){t!==-1&&(e[0]=this.atomicConformation.x[t],e[1]=this.atomicConformation.y[t],e[2]=this.atomicConformation.z[t])}pos(e,t,n){let r=this.traceElementIndex[t];this.helixOrientationCenters&&x8(n)?B.fromArray(e,this.helixOrientationCenters,t*3):this.atomicPos(e,r)}updateResidueSegmentRange(e){let{index:t}=this.residueAtomSegments;this.residueSegmentMin=t[this.polymerRanges[e.index*2]],this.residueSegmentMax=t[this.polymerRanges[e.index*2+1]]}getResidueIndex(e){if(e<this.residueSegmentMin){let t=this.cyclicPolymerMap.get(this.residueSegmentMin);e=t===void 0?this.residueSegmentMin:t-(this.residueSegmentMin-e-1)}else if(e>this.residueSegmentMax){let t=this.cyclicPolymerMap.get(this.residueSegmentMax);e=t===void 0?this.residueSegmentMax:t+(e-this.residueSegmentMax-1)}return e}getSecStruc(e){if(this.secondaryStructure){let{type:t,getIndex:n}=this.secondaryStructure,r=t[n(e)];return x8(r)?OI.Flag.Helix:r}else return C8}setControlPoint(e,t,n,r,i){eft(i)||this.helixOrientationCenters&&x8(i)?B.scale(e,B.add(e,t,B.add(e,r,B.add(e,n,n))),1/4):B.copy(e,n)}setFromToVector(e,t,n){this.helixOrientationCenters&&x8(n)?B.set(e,1,0,0):(this.atomicPos(E8,this.directionFromElementIndex[t]),this.atomicPos(D8,this.directionToElementIndex[t]),B.sub(e,D8,E8))}setDirection(e,t,n,r){B.matchDirection(E8,t,n),B.matchDirection(D8,r,n),B.scale(e,B.add(e,E8,B.add(e,D8,B.add(e,n,n))),1/4)}move(){let{residueIt:e,polymerIt:t,value:n}=this;if(this.state===w8.nextPolymer){for(;t.hasNext;)if(this.polymerSegment=t.move(),e.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),e.hasNext){this.state=w8.nextResidue;let e=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],t=this.getResidueIndex(e-1);this.currSecStrucType=e===t?C8:this.getSecStruc(t),this.nextSecStrucType=this.getSecStruc(e),this.currCoarseBackbone=this.directionFromElementIndex[t]===-1||this.directionToElementIndex[t]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[e]===-1||this.directionToElementIndex[e]===-1;break}}if(this.state===w8.nextResidue){let{index:t}=e.move(),r=this.getResidueIndex(t-3),i=this.getResidueIndex(t-2),a=this.getResidueIndex(t-1),o=this.getResidueIndex(t+1),s=this.getResidueIndex(t+2),c=this.getResidueIndex(t+3);this.prevSecStrucType=this.getSecStruc(a),this.currSecStrucType=this.getSecStruc(t),this.nextSecStrucType=t===o?C8:this.getSecStruc(o),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1,n.secStrucType=this.currSecStrucType,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,n.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,n.first=t===this.residueSegmentMin,n.last=t===this.residueSegmentMax,n.moleculeType=this.moleculeType[t],n.initial=t===a,n.final=t===o,n.centerPrev.element=this.traceElementIndex[a],n.center.element=this.traceElementIndex[t],n.centerNext.element=this.traceElementIndex[o];let l=this.getSecStruc(r),u=this.getSecStruc(i),d=this.getSecStruc(a),f=this.getSecStruc(t),p=this.getSecStruc(o),m=this.getSecStruc(s),h=this.getSecStruc(c);this.pos(this.p0,r,l),this.pos(this.p1,i,u),this.pos(this.p2,a,d),this.pos(this.p3,t,f),this.pos(this.p4,o,p),this.pos(this.p5,s,m),this.pos(this.p6,c,h);let g=x8(l),_=x8(u),v=x8(d),y=x8(f),b=x8(p),x=x8(m),S=x8(h);this.helixOrientationCenters&&!(y&&n.secStrucFirst&&n.secStrucLast)&&(y===v?y===_?y!==g&&(y?B.copy(this.p0,this.p1):g&&(B.scale(T8,B.sub(T8,this.p0,this.p1),2),B.add(this.p0,this.p1,T8))):y?(B.copy(this.p0,this.p2),B.copy(this.p1,this.p2)):_&&(B.scale(T8,B.sub(T8,this.p1,this.p2),2),B.add(this.p1,this.p2,T8),B.add(this.p0,this.p1,T8)):y?(B.copy(this.p0,this.p3),B.copy(this.p1,this.p3),B.copy(this.p2,this.p3)):v&&(B.scale(T8,B.sub(T8,this.p2,this.p3),2),B.add(this.p2,this.p3,T8),B.add(this.p1,this.p2,T8),B.add(this.p0,this.p1,T8)),y===b?y===x?y!==S&&(y?B.copy(this.p6,this.p5):S&&(B.scale(T8,B.sub(T8,this.p6,this.p5),2),B.add(this.p6,this.p5,T8))):y?(B.copy(this.p5,this.p4),B.copy(this.p6,this.p4)):x&&(B.scale(T8,B.sub(T8,this.p5,this.p4),2),B.add(this.p5,this.p4,T8),B.add(this.p6,this.p5,T8)):y?(B.copy(this.p4,this.p3),B.copy(this.p5,this.p3),B.copy(this.p6,this.p3)):b&&(B.scale(T8,B.sub(T8,this.p4,this.p3),2),B.add(this.p4,this.p3,T8),B.add(this.p5,this.p4,T8),B.add(this.p6,this.p5,T8))),this.currCoarseBackbone?(B.triangleNormal(this.d01,this.p1,this.p2,this.p3),B.triangleNormal(this.d12,this.p2,this.p3,this.p4),B.triangleNormal(this.d23,this.p3,this.p4,this.p5),B.triangleNormal(this.d34,this.p4,this.p5,this.p6)):(this.setFromToVector(this.d01,a,d),this.setFromToVector(this.d12,t,f),this.setFromToVector(this.d23,o,p),this.setFromToVector(this.d34,s,m));let C=y&&this.helixOrientationCenters,w=1.5;t===a||f!==d&&C?(B.setMagnitude(T8,B.sub(T8,this.p3,this.p4),w),B.add(this.p2,this.p3,T8),B.add(this.p1,this.p2,T8),B.add(this.p0,this.p1,T8)):a===i||f!==u&&C?(B.setMagnitude(T8,B.sub(T8,this.p2,this.p3),w),B.add(this.p1,this.p2,T8),B.add(this.p0,this.p1,T8)):(i===r||f!==l&&C)&&(B.setMagnitude(T8,B.sub(T8,this.p1,this.p2),w),B.add(this.p0,this.p1,T8)),t===o||f!==p&&C?(B.setMagnitude(T8,B.sub(T8,this.p3,this.p2),w),B.add(this.p4,this.p3,T8),B.add(this.p5,this.p4,T8),B.add(this.p6,this.p5,T8)):o===s||f!==m&&C?(B.setMagnitude(T8,B.sub(T8,this.p4,this.p3),w),B.add(this.p5,this.p4,T8),B.add(this.p6,this.p5,T8)):(s===c||f!==h&&C)&&(B.setMagnitude(T8,B.sub(T8,this.p5,this.p4),w),B.add(this.p6,this.p5,T8)),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,u),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,d),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,f),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,p),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,m),this.setDirection(n.d12,this.d01,this.d12,this.d23),this.setDirection(n.d23,this.d12,this.d23,this.d34),e.hasNext||(this.state=w8.nextPolymer)}return this.hasNext=e.hasNext||t.hasNext,this.value}constructor(e,t,n={}){if(this.unit=e,this.state=w8.nextPolymer,this.p0=B(),this.p1=B(),this.p2=B(),this.p3=B(),this.p4=B(),this.p5=B(),this.p6=B(),this.d01=B(),this.d12=B(),this.d23=B(),this.d34=B(),this.hasNext=!1,this.atomicConformation=e.model.atomicConformation,this.residueAtomSegments=e.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=e.model.atomicRanges.polymerRanges,this.traceElementIndex=e.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=e.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=e.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=e.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=e.model.atomicRanges.cyclicPolymerMap,this.polymerIt=OR.transientSegments(this.polymerRanges,e.elements),this.residueIt=uA.transientSegments(this.residueAtomSegments,e.elements),this.value=tft(t,e),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=Tz.get(t).value?.get(e.invariantId)),n.useHelixOrientation){let t=b8.get(e.model).value;if(!t)throw Error(`missing helix-orientation`);this.helixOrientationCenters=t.centers}}},O8;(function(e){e[e.nextPolymer=0]=`nextPolymer`,e[e.nextElement=1]=`nextElement`})(O8||={});var rft=class{getElementIndex(e){return Math.min(Math.max(this.polymerSegment.start,e),this.polymerSegment.end-1)}pos(e,t){let n=this.unit.elements[t];e[0]=this.conformation.x[n],e[1]=this.conformation.y[n],e[2]=this.conformation.z[n]}move(){if(this.state===O8.nextPolymer){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=O8.nextElement;break}}if(this.state===O8.nextElement){let e=this.getElementIndex(this.elementIndex-2),t=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),r=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[t],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,e),this.pos(this.value.p1,t),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,r);let i=.5;this.elementIndex===t?(B.scale(T8,B.sub(T8,this.value.p2,this.value.p3),i),B.add(this.value.p1,this.value.p2,T8),B.add(this.value.p0,this.value.p1,T8)):t===e&&(B.scale(T8,B.sub(T8,this.value.p1,this.value.p2),i),B.add(this.value.p0,this.value.p1,T8)),this.elementIndex===n?(B.scale(T8,B.sub(T8,this.value.p2,this.value.p1),i),B.add(this.value.p3,this.value.p2,T8),B.add(this.value.p4,this.value.p3,T8)):n===r&&(B.scale(T8,B.sub(T8,this.value.p3,this.value.p2),i),B.add(this.value.p4,this.value.p3,T8)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=O8.nextPolymer)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}constructor(e,t){switch(this.unit=e,this.state=O8.nextPolymer,this.hasNext=!1,this.polymerIt=OR.transientSegments(J8(e),e.elements),this.value=tft(t,e),B.set(this.value.d12,1,0,0),B.set(this.value.d23,1,0,0),e.kind){case Q.Kind.Spheres:this.conformation=e.model.coarseConformation.spheres;break;case Q.Kind.Gaussians:this.conformation=e.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}},k8=B.fromArray,A8=B.toArray,j8=B.normalize,ift=B.sub,M8=B.spline,aft=B.slerp,oft=B.copy,sft=B.cross,N8=B.orthogonalize,cft=B.matchDirection,lft=B.scale,uft=B.add;function P8(e){let t=e+1,n=t*3;return{curvePoints:new Float32Array(n),tangentVectors:new Float32Array(n),normalVectors:new Float32Array(n),binormalVectors:new Float32Array(n),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function F8(e,t,n,r){dft(e,t,n,r),gft(e,t)}var I8=B(),L8=B(),R8=B();function dft(e,t,n,r){let{curvePoints:i,tangentVectors:a,linearSegments:o}=e,{p0:s,p1:c,p2:l,p3:u,p4:d,secStrucFirst:f,secStrucLast:p}=t,m=1-r,h=f?.5:n,g=p?.5:n;for(let e=0;e<=o;++e){let t=e*1/o;if(t<m){let e=OT(h,n,t);M8(R8,s,c,l,u,t+r,e),M8(I8,s,c,l,u,t+r+.01,h),M8(L8,s,c,l,u,t+r-.01,h)}else{let e=OT(n,g,t);M8(R8,c,l,u,d,t-m,e),M8(I8,c,l,u,d,t-m+.01,e),M8(L8,c,l,u,d,t-m-.01,e)}A8(R8,i,e*3),j8(z8,ift(z8,I8,L8)),A8(z8,a,e*3)}}var fft=B(),z8=B(),B8=B(),V8=B(),H8=B(),pft=B(),mft=B(),hft=B(),U8=B(),W8=B();function gft(e,t){let{curvePoints:n,tangentVectors:r,normalVectors:i,binormalVectors:a}=e,{d12:o,d23:s}=t,c=n.length/3;k8(mft,r,0),k8(hft,r,(c-1)*3),N8(U8,mft,o),N8(W8,hft,s),cft(W8,W8,U8),oft(H8,U8);let l=c-1;for(let e=0;e<c;++e){let t=jT(0,l,e)*l,n=e===0?0:1/(c-t);k8(z8,r,e*3),N8(B8,z8,aft(fft,H8,W8,n)),A8(B8,i,e*3),oft(H8,B8),j8(V8,sft(V8,z8,B8)),A8(V8,a,e*3)}for(let e=1;e<l;++e)k8(H8,i,(e-1)*3),k8(B8,i,e*3),k8(pft,i,(e+1)*3),lft(B8,uft(B8,H8,uft(B8,pft,B8)),1/3),A8(B8,i,e*3),k8(z8,r,e*3),j8(V8,sft(V8,z8,B8)),A8(V8,a,e*3)}function G8(e,t,n,r,i,a,o,s){let{widthValues:c,heightValues:l,linearSegments:u}=e,d=1-s;for(let e=0;e<=u;++e){let f=e*1/u;f<d?(c[e]=OT(t,n,f+s),l[e]=OT(i,a,f+s)):(c[e]=OT(n,r,f-d),l[e]=OT(a,o,f-d))}}const _ft=.5,K8=.5,q8=.3;function J8(e){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicRanges.polymerRanges;case Q.Kind.Spheres:return e.model.coarseHierarchy.spheres.polymerRanges;case Q.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.polymerRanges}}function vft(e){switch(e.kind){case Q.Kind.Atomic:return e.model.atomicRanges.gapRanges;case Q.Kind.Spheres:return e.model.coarseHierarchy.spheres.gapRanges;case Q.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.gapRanges}}var Y8;(function(e){function t(e,t){let{group:n,structure:r}=e,i=n.units[0].polymerElements,a=i.length,o=n.units.length,s=iL.create(r),c=(e,t)=>(s.unit=n.units[t],s.element=i[e],s),l=!!t?.asSecondary;function u(e,t){return l}return tj(a,o,1,c,!1,u)}e.fromGroup=t})(Y8||={});var yft;(function(e){function t(e,t){let{group:n,structure:r}=e,i=n.units[0].gapElements,a=i.length,o=n.units.length,s=iL.create(r),c=(e,t)=>(s.unit=n.units[t],s.element=i[e],s),l=!!t?.asSecondary;function u(e,t){return l}return tj(a,o,1,c,!1,u)}e.fromGroup=t})(yft||={});function X8(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i];if(a===iJ.Null){let t=K.ofRange(0,r.elements.length);return $(e.target,[{unit:r,indices:t}])}else if(Q.isAtomic(r))return tZe(e,r,r.polymerElements[a]);else{let{elements:t}=r,n=r.polymerElements[a],i=K.indexOf(t,n);if(i!==-1){let t=K.ofSingleton(i);return $(e,[{unit:r,indices:t}])}}}return hq}function bft(e,t,n,r,i,a){let o=-1,s=-1;for(let e=i;e<=a;e++){let r=n[e];if(!(r<0)&&(o=K.indexOf(t,r),o>=0)){s=e;break}}if(o<0)return!1;let c=o;for(let e=a;e>s;e--){let r=n[e];if(r<0)continue;let i=K.indexOf(t,r);if(i>=0){c=i;break}}return r(G.ofRange(e+o,e+c))}function xft(e,t,n,r,i){let a=!1,{elements:o}=i.unit,{traceElementIndex:s}=i.unit.model.atomicHierarchy.derived.residue,{index:c}=i.unit.model.atomicHierarchy.residueAtomSegments,l=n(i.unit);if(G.is(i.indices))if(G.start(i.indices)===0&&G.end(i.indices)===i.unit.elements.length)a=r(G.ofBounds(e,e+t))||a;else{let t=c[o[G.min(i.indices)]],n=c[o[G.max(i.indices)]];a=bft(e,l,s,r,t,n)||a}else{let{indices:t}=i;for(let n=0,i=t.length;n<i;n++){let u=c[o[t[n]]],d=u,f=n+1;for(;f<i;){let e=c[o[t[f]]];if(e-d>1)break;d=e,f++}n=f-1,a=bft(e,l,s,r,u,d)||a}}return a}function Sft(e){return e.polymerElements}function Z8(e,t,n){let r=!1;if(!$.is(e))return!1;let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;let o=a.units[0].polymerElements.length;for(let t of e.elements){if(!a.unitIndexMap.has(t.unit.id))continue;let e=a.unitIndexMap.get(t.unit.id)*o;if(Q.isAtomic(t.unit))r=xft(e,o,Sft,n,t)||r;else if(G.is(t.indices)){let i=e+G.start(t.indices),a=e+G.end(t.indices);r=n(G.ofBounds(i,a))||r}else for(let i=0,a=t.indices.length;i<a;i++){let o=t.indices[i],s=i+1;for(;s<a&&t.indices[s]===o;)s++;i=s-1;let c=t.indices[i];r=n(G.ofRange(e+o,e+c))||r}}return r}function Cft(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i],o=K.indexOf(r.elements,r.gapElements[a]),s=K.indexOf(r.elements,r.gapElements[a%2?a-1:a+1]);if(o!==-1&&s!==-1)return fR.Loci(e,[fR.Location(e,r,o,e,r,s),fR.Location(e,r,s,e,r,o)])}return hq}function wft(e,t,n){let r=!1;if(fR.isLoci(e)){let{structure:i,group:a}=t;if(!nB.areRootsEquivalent(e.structure,i))return!1;e=fR.remapLoci(e,i);let o=a.units[0].gapElements.length;for(let t of e.bonds){let e=a.unitIndexMap.get(t.aUnit.id);if(e!==void 0){let i=K.indexOf(t.aUnit.gapElements,t.aUnit.elements[t.aIndex]),a=K.indexOf(t.bUnit.gapElements,t.bUnit.elements[t.bIndex]);i!==-1&&a!==-1&&n(G.ofSingleton(e*o+i))&&(r=!0)}}}else if($.is(e)){let{structure:i,group:a}=t;if(!nB.areRootsEquivalent(e.structure,i))return!1;e=$.remap(e,i);let o=a.units[0].gapElements.length;for(let t of e.elements){let e=a.unitIndexMap.get(t.unit.id);e!==void 0&&K.forEach(t.indices,i=>{let a=K.indexOf(t.unit.gapElements,t.unit.elements[i]);a!==-1&&(n(G.ofSingleton(e*o+a))&&(r=!0),K.getAt(t.unit.gapElements,a+1)===t.unit.elements[i]&&n(G.ofSingleton(e*o+a+1))&&(r=!0))})}}return r}var Q8;(function(e){function t(e){let{group:t,structure:n}=e,r=t.units[0],i=Q.isAtomic(r)?r.nucleotideElements:[],a=i.length,o=t.units.length,s=iL.create(n);return tj(a,o,1,(e,n)=>(s.unit=t.units[n],s.element=i[e],s))}e.fromGroup=t})(Q8||={});function $8(e,t,n){let{objectId:r,instanceId:i,groupId:a}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i];if(Q.isAtomic(r))if(a===iJ.Null){let t=G.ofRange(0,r.elements.length);return $(e.target,[{unit:r,indices:t}])}else return tZe(e,r,r.nucleotideElements[a])}return hq}function Tft(e){return e.nucleotideElements}function e5(e,t,n){let r=!1;if(!$.is(e))return!1;let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;let o=a.units[0];if(!Q.isAtomic(o))return!1;let{nucleotideElements:s}=o,c=s.length;for(let t of e.elements){if(!Q.isAtomic(t.unit)||!a.unitIndexMap.has(t.unit.id))continue;let e=a.unitIndexMap.get(t.unit.id)*c;Q.isAtomic(t.unit)&&(r=xft(e,c,Tft,n,t)||r)}return r}var Eft=B(),Dft=B();function t5(e,t){let{model:n,conformation:r}=e,{residueAtomSegments:i,atoms:a,index:o}=n.atomicHierarchy,{label_comp_id:s}=a,c=s.value(i.offsets[t]),l=aDe(c),u=oDe(c);if(!l&&!u){let e=o.findAtomOnResidue(t,`C4`),n=o.findAtomOnResidue(t,`N9`);e!==-1&&n!==-1&&B.distance(r.invariantPosition(e,Eft),r.invariantPosition(n,Dft))<1.6?l=!0:u=!0}return{isPurine:l,isPyrimidine:u}}function n5(){return{trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1}}function r5(e,t,n){let r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.N1=r.findAtomOnResidue(n,`N1`),e.C2=r.findAtomOnResidue(n,`C2`),e.N3=r.findAtomOnResidue(n,`N3`),e.C4=r.findAtomOnResidue(n,`C4`),e.C5=r.findAtomOnResidue(n,`C5`),e.C5===-1&&(e.C5=r.findAtomOnResidue(n,`N5`)),e.C6=r.findAtomOnResidue(n,`C6`),e.N7=r.findAtomOnResidue(n,`N7`),e.N7===-1&&(e.N7=r.findAtomOnResidue(n,`C7`)),e.C8=r.findAtomOnResidue(n,`C8`),e.N9=r.findAtomOnResidue(n,`N9`),e}function i5(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1&&e.N7!==-1&&e.C8!==-1&&e.N9!==-1}function a5(e,t,n){let r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.N1=r.findAtomOnResidue(n,`N1`),e.N1===-1&&(e.N1=r.findAtomOnResidue(n,`C1`)),e.C2=r.findAtomOnResidue(n,`C2`),e.N3=r.findAtomOnResidue(n,`N3`),e.C4=r.findAtomOnResidue(n,`C4`),e.C5=r.findAtomOnResidue(n,`C5`),e.C6=r.findAtomOnResidue(n,`C6`),e}function o5(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1}function s5(e,t,n){let r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.C1_1=r.findAtomOnResidue(n,`C1'`),e.C2_1=r.findAtomOnResidue(n,`C2'`),e.C3_1=r.findAtomOnResidue(n,`C3'`),e.C4_1=r.findAtomOnResidue(n,`C4'`),e.O4_1=r.findAtomOnResidue(n,`O4'`),e}function c5(e){return e.trace!==-1&&e.C1_1!==-1&&e.C2_1!==-1&&e.C3_1!==-1&&e.C4_1!==-1&&e.O4_1!==-1}var l5=B(),u5=B(),Oft=B(),kft=B(),Aft=B(),jft=B(),d5=B(),f5=B(),p5=B(),Mft=B(),m5=z.identity(),Nft=B(),Pft=EP();const Fft={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:V.Numeric(1,{min:0,max:2,step:.01}),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo)};V.getDefaultValues(Fft);function Ift(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,thicknessFactor:c,radialSegments:l}=i,u=o*(Pft.vertices.length/3+l*2),d=YN.createState(u,u/4,a),{elements:f,model:p,conformation:m}=t,{chainAtomSegments:h,residueAtomSegments:g}=p.atomicHierarchy,{moleculeType:_}=p.atomicHierarchy.derived.residue,v=uA.transientSegments(h,f),y=uA.transientSegments(g,f),b=1*s,x=c*s*2,S={radiusTop:b,radiusBottom:b,radialSegments:l,bottomCap:!0},C=0;for(;v.hasNext;)for(y.setSegment(v.move());y.hasNext;){let{index:e}=y.move();if(EI(_[e])){let n=n5(),r=-1,i=-1,a=-1,o=-1,s=-1,c=4.5,{isPurine:l,isPyrimidine:u}=t5(t,e);l?(c=4.5,r5(n,t,e),r=n.N1,i=n.C4,a=n.C6,o=n.C2,s=n.N9):u&&(c=3,a5(n,t,e),r=n.N3,i=n.C6,a=n.C4,o=n.C2,s=n.N1),s!==-1&&n.trace!==-1&&(m.invariantPosition(s,Aft),m.invariantPosition(n.trace,jft),d.currentGroup=C,PN(d,Aft,jft,1,S),r!==-1&&i!==-1&&a!==-1&&o!==-1&&(m.invariantPosition(r,l5),m.invariantPosition(i,u5),m.invariantPosition(a,Oft),m.invariantPosition(o,kft),B.normalize(d5,B.sub(d5,u5,l5)),B.normalize(f5,B.sub(f5,kft,Oft)),B.normalize(p5,B.cross(p5,d5,f5)),z.targetTo(m5,l5,u5,p5),B.scaleAndAdd(Mft,l5,d5,c/2-.2),z.scale(m5,m5,B.set(Nft,4.5,x,c)),z.setTranslation(m5,Mft),YN.addPrimitive(d,m5,Pft))),++C}}let w=YN.getMesh(d),T=q.expand(q(),t.boundary.sphere,b);return w.setBoundingSphere(T),w}const Lft={...b$,...Fft};function Rft(e){return x$({defaultProps:V.getDefaultValues(Lft),createGeometry:Ift,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor||t.radialSegments!==n.radialSegments}},e)}var h5=B(),g5=B(),_5=B(),v5=B(),y5=B(),b5=B(),x5=B(),zft=B(),Bft=B(),S5=B(),C5=B();const Vft={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:V.Numeric(1,{min:0,max:2,step:.01}),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo)};V.getDefaultValues(Vft);var w5=new Float32Array(54),Hft=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Uft=new Uint32Array([8,12,14,16,6,4,2,0,10]),Wft=new Uint32Array([9,11,1,3,5,7,17,15,13]),T5=new Float32Array(36),Gft=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Kft=new Uint32Array([0,10,8,6,4,2]),qft=new Uint32Array([1,3,5,7,9,11]),E5=B();function Jft(e,t,...n){for(let r=0,i=n.length;r<i;++r){let i=n[r];B.toArray(B.add(E5,i,t),e,r*2*3),B.toArray(B.sub(E5,i,t),e,(r*2+1)*3)}}function Yft(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,thicknessFactor:c,radialSegments:l,detail:u}=i,d=o*(26+l*2),f=YN.createState(d,d/4,a),{elements:p,model:m,conformation:h}=t,{chainAtomSegments:g,residueAtomSegments:_}=m.atomicHierarchy,{moleculeType:v}=m.atomicHierarchy.derived.residue,y=uA.transientSegments(g,p),b=uA.transientSegments(_,p),x=1*s,S=c*s,C={radiusTop:x,radiusBottom:x,radialSegments:l},w=0;for(;y.hasNext;)for(b.setSegment(y.move());b.hasNext;){let{index:e}=b.move();if(EI(v[e])){let n=n5();f.currentGroup=w;let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),n.N9!==-1&&n.trace!==-1&&(h.invariantPosition(n.N9,S5),h.invariantPosition(n.trace,h5),f.currentGroup=w,PN(f,S5,h5,1,C),oN(f,S5,x,u)),i5(n)&&(h.invariantPosition(n.N1,g5),h.invariantPosition(n.C2,_5),h.invariantPosition(n.N3,v5),h.invariantPosition(n.C4,y5),h.invariantPosition(n.C5,b5),h.invariantPosition(n.C6,x5),h.invariantPosition(n.N7,zft),h.invariantPosition(n.C8,Bft),B.triangleNormal(C5,g5,y5,b5),B.scale(C5,C5,S),Jft(w5,C5,g5,_5,v5,y5,b5,x5,zft,Bft,S5),YN.addTriangleStrip(f,w5,Hft),YN.addTriangleFan(f,w5,Uft),YN.addTriangleFan(f,w5,Wft))):i&&(a5(n,t,e),n.N1!==-1&&n.trace!==-1&&(h.invariantPosition(n.N1,g5),h.invariantPosition(n.trace,h5),f.currentGroup=w,PN(f,g5,h5,1,C),oN(f,g5,x,u)),o5(n)&&(h.invariantPosition(n.C2,_5),h.invariantPosition(n.N3,v5),h.invariantPosition(n.C4,y5),h.invariantPosition(n.C5,b5),h.invariantPosition(n.C6,x5),B.triangleNormal(C5,g5,y5,b5),B.scale(C5,C5,S),Jft(T5,C5,g5,_5,v5,y5,b5,x5),YN.addTriangleStrip(f,T5,Gft),YN.addTriangleFan(f,T5,Kft),YN.addTriangleFan(f,T5,qft))),++w}}let T=YN.getMesh(f),E=q.expand(q(),t.boundary.sphere,x);return T.setBoundingSphere(E),T}const Xft={...b$,...Vft};function Zft(e){return x$({defaultProps:V.getDefaultValues(Xft),createGeometry:Yft,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor||t.radialSegments!==n.radialSegments}},e)}var D5=B(),O5=B(),k5=B(),A5=B(),j5=B(),M5=B(),Qft=B(),$ft=B(),ept=B(),N5=B(),P5=B(),F5=B(),I5=B(),L5=B(),R5=B(),z5=B(),B5=B();const tpt={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:V.Numeric(1,{min:0,max:2,step:.01})};V.getDefaultValues(tpt);var V5=new Float32Array(54),npt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),rpt=new Uint32Array([8,12,14,16,6,4,2,0,10]),ipt=new Uint32Array([9,11,1,3,5,7,17,15,13]),H5=new Float32Array(36),apt=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),opt=new Uint32Array([0,10,8,6,4,2,10]),spt=new Uint32Array([1,3,5,7,9,11,3]),U5=new Float32Array(36),cpt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),lpt=new Uint32Array([0,10,8,6,4,2]),upt=new Uint32Array([1,3,5,7,9,11]),dpt=B();function W5(e,t,...n){for(let r=0,i=n.length;r<i;++r){let i=n[r];B.toArray(B.add(dpt,i,t),e,r*2*3),B.toArray(B.sub(dpt,i,t),e,(r*2+1)*3)}}function fpt(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,thicknessFactor:c}=i,l=o*25,u=YN.createState(l,l/4,a),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,_=uA.transientSegments(m,d),v=uA.transientSegments(h,d),y=s*c,b=0;for(;_.hasNext;)for(v.setSegment(_.move());v.hasNext;){let{index:e}=v.move();if(EI(g[e])){let n=n5();u.currentGroup=b,s5(n,t,e),c5(n)&&(p.invariantPosition(n.C1_1,N5),p.invariantPosition(n.C2_1,P5),p.invariantPosition(n.C3_1,F5),p.invariantPosition(n.C4_1,I5),p.invariantPosition(n.O4_1,L5),B.triangleNormal(z5,F5,I5,N5),B.scale(R5,B.add(R5,L5,B.add(R5,I5,B.add(R5,F5,B.add(R5,N5,P5)))),.2),B.scale(B5,z5,y),W5(H5,B5,R5,F5,I5,L5,N5,P5),YN.addTriangleStrip(u,H5,apt),YN.addTriangleFanWithNormal(u,H5,opt,z5),B.negate(z5,z5),YN.addTriangleFanWithNormal(u,H5,spt,z5));let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),i5(n)&&(p.invariantPosition(n.N1,D5),p.invariantPosition(n.C2,O5),p.invariantPosition(n.N3,k5),p.invariantPosition(n.C4,A5),p.invariantPosition(n.C5,j5),p.invariantPosition(n.C6,M5),p.invariantPosition(n.N7,Qft),p.invariantPosition(n.C8,$ft),p.invariantPosition(n.N9,ept),B.triangleNormal(z5,D5,A5,j5),B.scale(B5,z5,y),W5(V5,B5,D5,O5,k5,A5,j5,M5,Qft,$ft,ept),YN.addTriangleStrip(u,V5,npt),YN.addTriangleFanWithNormal(u,V5,rpt,z5),B.negate(z5,z5),YN.addTriangleFanWithNormal(u,V5,ipt,z5))):i&&(a5(n,t,e),o5(n)&&(p.invariantPosition(n.N1,D5),p.invariantPosition(n.C2,O5),p.invariantPosition(n.N3,k5),p.invariantPosition(n.C4,A5),p.invariantPosition(n.C5,j5),p.invariantPosition(n.C6,M5),B.triangleNormal(z5,D5,A5,j5),B.scale(B5,z5,y),W5(U5,B5,D5,O5,k5,A5,j5,M5),YN.addTriangleStrip(u,U5,cpt),YN.addTriangleFanWithNormal(u,U5,lpt,z5),B.negate(z5,z5),YN.addTriangleFanWithNormal(u,U5,upt,z5))),++b}}let x=YN.getMesh(u),S=q.expand(q(),t.boundary.sphere,y);return x.setBoundingSphere(S),x}const ppt={...b$,...tpt};function mpt(e){return x$({defaultProps:V.getDefaultValues(ppt),createGeometry:fpt,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor}},e)}var G5=B(),K5=B(),q5=B(),J5=B(),Y5=B(),X5=B(),Z5=B(),Q5=B(),$5=B(),e7=B(),t7=B(),n7=B(),r7=B(),i7=B(),a7=B();const o7={...b$,...w$,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo),tryUseImpostor:V.Boolean(!0)};function hpt(e,t,n,r){return n.tryUseImpostor&&r$(r)?_pt(e):ypt(e)}function gpt(e,t,n,r,i,a){if(!Q.isAtomic(t))return CF.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return CF.createEmpty(a);let s=o*15,c=_1.create(s,s/4,a),{elements:l,model:u,conformation:d}=t,{chainAtomSegments:f,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:m}=u.atomicHierarchy.derived.residue,h=uA.transientSegments(f,l),g=uA.transientSegments(p,l),_=0;for(;h.hasNext;)for(g.setSegment(h.move());g.hasNext;){let{index:e}=g.move();if(EI(m[e])){let n=n5();s5(n,t,e),c5(n)&&(d.invariantPosition(n.C1_1,t7),d.invariantPosition(n.C2_1,n7),d.invariantPosition(n.C3_1,r7),d.invariantPosition(n.C4_1,i7),d.invariantPosition(n.O4_1,a7),d.invariantPosition(n.trace,G5),c.add(r7[0],r7[1],r7[2],G5[0],G5[1],G5[2],1,!0,!0,2,_),c.add(r7[0],r7[1],r7[2],i7[0],i7[1],i7[2],1,!0,!0,2,_),c.add(i7[0],i7[1],i7[2],a7[0],a7[1],a7[2],1,!0,!0,2,_),c.add(a7[0],a7[1],a7[2],t7[0],t7[1],t7[2],1,!0,!0,2,_),c.add(t7[0],t7[1],t7[2],n7[0],n7[1],n7[2],1,!0,!0,2,_),c.add(n7[0],n7[1],n7[2],r7[0],r7[1],r7[2],1,!0,!0,2,_));let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),n.C1_1!==-1&&n.N9!==-1?(d.invariantPosition(n.C1_1,t7),d.invariantPosition(n.N9,e7),c.add(e7[0],e7[1],e7[2],t7[0],t7[1],t7[2],1,!0,!0,2,_)):n.N9!==-1&&n.trace!==-1&&(d.invariantPosition(n.N9,e7),d.invariantPosition(n.trace,G5),c.add(e7[0],e7[1],e7[2],G5[0],G5[1],G5[2],1,!0,!0,2,_)),i5(n)&&(d.invariantPosition(n.N1,K5),d.invariantPosition(n.C2,q5),d.invariantPosition(n.N3,J5),d.invariantPosition(n.C4,Y5),d.invariantPosition(n.C5,X5),d.invariantPosition(n.C6,Z5),d.invariantPosition(n.N7,Q5),d.invariantPosition(n.C8,$5),d.invariantPosition(n.N9,e7),c.add(e7[0],e7[1],e7[2],$5[0],$5[1],$5[2],1,!0,!0,2,_),c.add($5[0],$5[1],$5[2],Q5[0],Q5[1],Q5[2],1,!0,!0,2,_),c.add(Q5[0],Q5[1],Q5[2],X5[0],X5[1],X5[2],1,!0,!0,2,_),c.add(X5[0],X5[1],X5[2],Z5[0],Z5[1],Z5[2],1,!0,!0,2,_),c.add(Z5[0],Z5[1],Z5[2],K5[0],K5[1],K5[2],1,!0,!0,2,_),c.add(K5[0],K5[1],K5[2],q5[0],q5[1],q5[2],1,!0,!0,2,_),c.add(q5[0],q5[1],q5[2],J5[0],J5[1],J5[2],1,!0,!0,2,_),c.add(J5[0],J5[1],J5[2],Y5[0],Y5[1],Y5[2],1,!0,!0,2,_),c.add(Y5[0],Y5[1],Y5[2],X5[0],X5[1],X5[2],1,!0,!0,2,_),c.add(Y5[0],Y5[1],Y5[2],e7[0],e7[1],e7[2],1,!0,!0,2,_))):i&&(a5(n,t,e),n.C1_1!==-1&&n.N1!==-1?(d.invariantPosition(n.N1,K5),d.invariantPosition(n.C1_1,t7),c.add(K5[0],K5[1],K5[2],t7[0],t7[1],t7[2],1,!0,!0,2,_)):n.N1!==-1&&n.trace!==-1&&(d.invariantPosition(n.N1,K5),d.invariantPosition(n.trace,G5),c.add(K5[0],K5[1],K5[2],G5[0],G5[1],G5[2],1,!0,!0,2,_)),o5(n)&&(d.invariantPosition(n.N1,K5),d.invariantPosition(n.C2,q5),d.invariantPosition(n.N3,J5),d.invariantPosition(n.C4,Y5),d.invariantPosition(n.C5,X5),d.invariantPosition(n.C6,Z5),c.add(K5[0],K5[1],K5[2],Z5[0],Z5[1],Z5[2],1,!0,!0,2,_),c.add(Z5[0],Z5[1],Z5[2],X5[0],X5[1],X5[2],1,!0,!0,2,_),c.add(X5[0],X5[1],X5[2],Y5[0],Y5[1],Y5[2],1,!0,!0,2,_),c.add(Y5[0],Y5[1],Y5[2],J5[0],J5[1],J5[2],1,!0,!0,2,_),c.add(J5[0],J5[1],J5[2],q5[0],q5[1],q5[2],1,!0,!0,2,_),c.add(q5[0],q5[1],q5[2],K5[0],K5[1],K5[2],1,!0,!0,2,_))),++_}}let v=c.getCylinders(),y=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(y),v}function _pt(e){return T$({defaultProps:V.getDefaultValues(o7),createGeometry:gpt,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function vpt(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,radialSegments:c}=i,l=o*(c*15),u=YN.createState(l,l/4,a),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,_=uA.transientSegments(m,d),v=uA.transientSegments(h,d),y={radiusTop:1*s,radiusBottom:1*s,radialSegments:c},b=0;for(;_.hasNext;)for(v.setSegment(_.move());v.hasNext;){let{index:e}=v.move();if(EI(g[e])){let n=n5();u.currentGroup=b,s5(n,t,e),c5(n)&&(p.invariantPosition(n.C1_1,t7),p.invariantPosition(n.C2_1,n7),p.invariantPosition(n.C3_1,r7),p.invariantPosition(n.C4_1,i7),p.invariantPosition(n.O4_1,a7),p.invariantPosition(n.trace,G5),PN(u,r7,G5,1,y),PN(u,r7,i7,1,y),PN(u,i7,a7,1,y),PN(u,a7,t7,1,y),PN(u,t7,n7,1,y),PN(u,n7,r7,1,y));let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),n.C1_1!==-1&&n.N9!==-1?(p.invariantPosition(n.C1_1,t7),p.invariantPosition(n.N9,e7),PN(u,e7,t7,1,y)):n.N9!==-1&&n.trace!==-1&&(p.invariantPosition(n.N9,e7),p.invariantPosition(n.trace,G5),PN(u,e7,G5,1,y)),i5(n)&&(p.invariantPosition(n.N1,K5),p.invariantPosition(n.C2,q5),p.invariantPosition(n.N3,J5),p.invariantPosition(n.C4,Y5),p.invariantPosition(n.C5,X5),p.invariantPosition(n.C6,Z5),p.invariantPosition(n.N7,Q5),p.invariantPosition(n.C8,$5),p.invariantPosition(n.N9,e7),PN(u,e7,$5,1,y),PN(u,$5,Q5,1,y),PN(u,Q5,X5,1,y),PN(u,X5,Z5,1,y),PN(u,Z5,K5,1,y),PN(u,K5,q5,1,y),PN(u,q5,J5,1,y),PN(u,J5,Y5,1,y),PN(u,Y5,X5,1,y),PN(u,Y5,e7,1,y))):i&&(a5(n,t,e),n.C1_1!==-1&&n.N1!==-1?(p.invariantPosition(n.N1,K5),p.invariantPosition(n.C1_1,t7),PN(u,K5,t7,1,y)):n.N1!==-1&&n.trace!==-1&&(p.invariantPosition(n.N1,K5),p.invariantPosition(n.trace,G5),PN(u,K5,G5,1,y)),o5(n)&&(p.invariantPosition(n.N1,K5),p.invariantPosition(n.C2,q5),p.invariantPosition(n.N3,J5),p.invariantPosition(n.C4,Y5),p.invariantPosition(n.C5,X5),p.invariantPosition(n.C6,Z5),PN(u,K5,Z5,1,y),PN(u,Z5,X5,1,y),PN(u,X5,Y5,1,y),PN(u,Y5,J5,1,y),PN(u,J5,q5,1,y),PN(u,q5,K5,1,y))),++b}}let x=YN.getMesh(u),S=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return x.setBoundingSphere(S),x}function ypt(e){return x$({defaultProps:V.getDefaultValues(o7),createGeometry:vpt,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var s7=B(),c7=B(),l7=B(),u7=B(),d7=B(),f7=B(),p7=B(),m7=B(),h7=B(),g7=B(),_7=B(),v7=B(),y7=B(),b7=B(),x7=B();const S7={...b$,...S$,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),tryUseImpostor:V.Boolean(!0)};function bpt(e,t,n,r){return n.tryUseImpostor&&t$(r)?Spt(e):wpt(e)}function xpt(e,t,n,r,i,a){if(!Q.isAtomic(t))return HP.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HP.createEmpty(a);let s=o*15,c=S3.create(s,s/4,a),{elements:l,model:u,conformation:d}=t,{chainAtomSegments:f,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:m}=u.atomicHierarchy.derived.residue,h=uA.transientSegments(f,l),g=uA.transientSegments(p,l),_=0;for(;h.hasNext;)for(g.setSegment(h.move());g.hasNext;){let{index:e}=g.move();if(EI(m[e])){let n=n5();s5(n,t,e),c5(n)&&(d.invariantPosition(n.C1_1,_7),d.invariantPosition(n.C2_1,v7),d.invariantPosition(n.C3_1,y7),d.invariantPosition(n.C4_1,b7),d.invariantPosition(n.O4_1,x7),d.invariantPosition(n.trace,s7),c.add(s7[0],s7[1],s7[2],_),c.add(y7[0],y7[1],y7[2],_),c.add(b7[0],b7[1],b7[2],_),c.add(x7[0],x7[1],x7[2],_),c.add(_7[0],_7[1],_7[2],_),c.add(v7[0],v7[1],v7[2],_));let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),i5(n)&&(d.invariantPosition(n.N1,c7),d.invariantPosition(n.C2,l7),d.invariantPosition(n.N3,u7),d.invariantPosition(n.C4,d7),d.invariantPosition(n.C5,f7),d.invariantPosition(n.C6,p7),d.invariantPosition(n.N7,m7),d.invariantPosition(n.C8,h7),d.invariantPosition(n.N9,g7),c.add(g7[0],g7[1],g7[2],_),c.add(h7[0],h7[1],h7[2],_),c.add(m7[0],m7[1],m7[2],_),c.add(f7[0],f7[1],f7[2],_),c.add(p7[0],p7[1],p7[2],_),c.add(c7[0],c7[1],c7[2],_),c.add(l7[0],l7[1],l7[2],_),c.add(u7[0],u7[1],u7[2],_),c.add(d7[0],d7[1],d7[2],_))):i&&(a5(n,t,e),o5(n)&&(d.invariantPosition(n.N1,c7),d.invariantPosition(n.C2,l7),d.invariantPosition(n.N3,u7),d.invariantPosition(n.C4,d7),d.invariantPosition(n.C5,f7),d.invariantPosition(n.C6,p7),c.add(c7[0],c7[1],c7[2],_),c.add(p7[0],p7[1],p7[2],_),c.add(f7[0],f7[1],f7[2],_),c.add(d7[0],d7[1],d7[2],_),c.add(u7[0],u7[1],u7[2],_),c.add(l7[0],l7[1],l7[2],_))),++_}}let v=c.getSpheres(),y=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(y),v}function Spt(e){return C$({defaultProps:V.getDefaultValues(S7),createGeometry:xpt,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function Cpt(e,t,n,r,i,a){if(!Q.isAtomic(t))return HM.createEmpty(a);let o=t.nucleotideElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,detail:c}=i,l=o*rN(c),u=YN.createState(l,l/2,a),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,_=uA.transientSegments(m,d),v=uA.transientSegments(h,d),y=1*s,b=0;for(;_.hasNext;)for(v.setSegment(_.move());v.hasNext;){let{index:e}=v.move();if(EI(g[e])){let n=n5();u.currentGroup=b,s5(n,t,e),c5(n)&&(p.invariantPosition(n.C1_1,_7),p.invariantPosition(n.C2_1,v7),p.invariantPosition(n.C3_1,y7),p.invariantPosition(n.C4_1,b7),p.invariantPosition(n.O4_1,x7),p.invariantPosition(n.trace,s7),oN(u,s7,y,c),oN(u,b7,y,c),oN(u,x7,y,c),oN(u,_7,y,c),oN(u,v7,y,c),oN(u,y7,y,c));let{isPurine:r,isPyrimidine:i}=t5(t,e);r?(r5(n,t,e),i5(n)&&(p.invariantPosition(n.N1,c7),p.invariantPosition(n.C2,l7),p.invariantPosition(n.N3,u7),p.invariantPosition(n.C4,d7),p.invariantPosition(n.C5,f7),p.invariantPosition(n.C6,p7),p.invariantPosition(n.N7,m7),p.invariantPosition(n.C8,h7),p.invariantPosition(n.N9,g7),oN(u,h7,y,c),oN(u,m7,y,c),oN(u,f7,y,c),oN(u,p7,y,c),oN(u,c7,y,c),oN(u,l7,y,c),oN(u,u7,y,c),oN(u,d7,y,c),oN(u,f7,y,c),oN(u,g7,y,c))):i&&(a5(n,t,e),o5(n)&&(p.invariantPosition(n.N1,c7),p.invariantPosition(n.C2,l7),p.invariantPosition(n.N3,u7),p.invariantPosition(n.C4,d7),p.invariantPosition(n.C5,f7),p.invariantPosition(n.C6,p7),oN(u,p7,y,c),oN(u,f7,y,c),oN(u,d7,y,c),oN(u,u7,y,c),oN(u,l7,y,c),oN(u,c7,y,c))),++b}}let x=YN.getMesh(u),S=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return x.setBoundingSphere(S),x}function wpt(e){return x$({defaultProps:V.getDefaultValues(S7),createGeometry:Cpt,createLocationIterator:Q8.fromGroup,getLoci:$8,eachLocation:e5,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var C7=B.zero(),w7=B.zero(),T7=B.zero(),Tpt=B.zero(),E7=cN(3,!1);function Ept(){let e=JM(8);for(let t=0;t<3;++t){let n=(t+1)%3;B.set(C7,E7[t*3],E7[t*3+1],-.5),B.set(w7,E7[n*3],E7[n*3+1],-.5),B.set(T7,E7[n*3],E7[n*3+1],.5),B.set(Tpt,E7[t*3],E7[t*3+1],.5),e.add(C7,w7,T7),e.add(T7,Tpt,C7)}return B.set(C7,E7[0],E7[1],-.5),B.set(w7,E7[3],E7[4],-.5),B.set(T7,E7[6],E7[7],-.5),e.add(T7,w7,C7),B.set(C7,E7[0],E7[1],.5),B.set(w7,E7[3],E7[4],.5),B.set(T7,E7[6],E7[7],.5),e.add(C7,w7,T7),e.getPrimitive()}var Dpt;function Opt(){return Dpt||=Ept(),Dpt}var D7=z.identity(),kpt=B.zero(),Apt=B.zero(),jpt=B.zero(),O7=B.zero(),Mpt=4,Npt=4,Ppt=6,Fpt=Opt();const Ipt={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01})};V.getDefaultValues(Ipt);function Lpt(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s}=i,c=o*24,l=YN.createState(c,c/10,a),u=P8(1),{normalVectors:d,binormalVectors:f}=u,p=0,m=S8(t,n);for(;m.hasNext;){let e=m.move();l.currentGroup=p;let t=EI(e.moleculeType),n=OI.is(e.secStrucType,OI.Flag.Beta);if(F8(u,e,t||n?.5:.9,t?.3:.5),n&&!e.secStrucLast||!n){let n=r.size.size(e.center)*s,i=Mpt*n,a=Npt*n,o=Ppt*n,c=t?f:d;B.fromArray(Apt,c,0),B.fromArray(jpt,c,3),B.normalize(O7,B.add(O7,Apt,jpt)),z.targetTo(D7,e.p3,e.p1,O7),z.mul(D7,D7,z.rotY90Z180),z.scale(D7,D7,B.set(kpt,o,a,i)),z.setTranslation(D7,e.p2),YN.addPrimitive(l,D7,Fpt)}++p}let h=YN.getMesh(l),g=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return h.setBoundingSphere(g),h}const Rpt={...b$,...Ipt};function zpt(e){return x$({defaultProps:V.getDefaultValues(Rpt),createGeometry:Lpt,createLocationIterator:e=>Y8.fromGroup(e),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor}},e)}var k7=10;const Bpt={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo)};V.getDefaultValues(Bpt);function Vpt(e,t,n,r,i,a){let o=t.gapElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,radialSegments:c}=i,l=k7*c*2*o*2,u=YN.createState(l,l/10,a),d=B(),f=B(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:c},m=0,h=Ydt(n,t);for(;h.hasNext;){let{centerA:e,centerB:n}=h.move();e.element===n.element||(t.conformation.invariantPosition(e.element,d),t.conformation.invariantPosition(n.element,f),p.radiusTop=p.radiusBottom=r.size.size(e)*s,u.currentGroup=m,FN(u,d,f,.5,k7,!1,p),p.radiusTop=p.radiusBottom=r.size.size(n)*s,u.currentGroup=m+1,FN(u,f,d,.5,k7,!1,p)),m+=2}let g=YN.getMesh(u),_=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return g.setBoundingSphere(_),g}const A7={...b$,...Bpt};function j7(e){return x$({defaultProps:V.getDefaultValues(A7),createGeometry:Vpt,createLocationIterator:e=>yft.fromGroup(e,{asSecondary:!0}),getLoci:Cft,eachLocation:wft,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments}},e)}var M7=B(),N7=B(),Hpt=B(),P7=B(),F7=B(),I7=B(),L7=B(),R7=B(),z7=B(),B7=B(),V7=B(),H7=B(),U7=B(),W7=B(),G7=B(),K7=B.fromArray,q7=B.scale,J7=B.add,Y7=B.sub,Upt=B.magnitude,Wpt=B.negate,X7=B.copy,Gpt=B.cross,Kpt=B.set,Z7=_O.add3,qpt=_O.add;function Q7(e,t,n,r,i,a,o,s,c){let{vertices:l,normals:u,indices:d}=t,f=l.elementCount;if(K7(M7,r,e),q7(L7,M7,o),q7(I7,M7,s),K7(N7,i,e),q7(P7,N7,a),Gpt(B7,N7,M7),K7(z7,n,e),J7(H7,J7(H7,z7,P7),I7),Y7(U7,J7(U7,z7,P7),L7),Y7(W7,Y7(W7,z7,P7),L7),J7(G7,Y7(G7,z7,P7),I7),o<s?(Z7(l,G7[0],G7[1],G7[2]),Z7(l,W7[0],W7[1],W7[2]),Z7(l,U7[0],U7[1],U7[2]),Z7(l,H7[0],H7[1],H7[2]),X7(F7,I7)):(Z7(l,H7[0],H7[1],H7[2]),Z7(l,U7[0],U7[1],U7[2]),Z7(l,W7[0],W7[1],W7[2]),Z7(l,G7[0],G7[1],G7[2]),X7(F7,L7)),c){for(let e=0;e<4;++e)Z7(u,-B7[0],-B7[1],-B7[2]);Z7(d,f,f+1,f+2),Z7(d,f+2,f+3,f)}else{for(let e=0;e<4;++e)Z7(u,B7[0],B7[1],B7[2]);Z7(d,f+2,f+1,f),Z7(d,f,f+3,f+2)}}function $7(e,t,n,r,i,a,o,s,c,l){let{currentGroup:u,vertices:d,normals:f,indices:p,groups:m}=e,h=d.elementCount,g=0;s>0?(K7(M7,t,0),K7(N7,t,i*3),g=s/Upt(Y7(Hpt,N7,M7))):Kpt(R7,0,0,0);for(let e=0;e<=i;++e){let c=a[e],l=o[e],u=s===0?l:s*(1-e/i),p=e*3;K7(F7,n,p),q7(F7,F7,u),K7(P7,r,p),q7(P7,P7,c),s>0&&(K7(M7,n,p),K7(N7,r,p),q7(R7,Gpt(R7,M7,N7),g)),K7(z7,t,p),K7(B7,n,p),K7(V7,r,p),J7(M7,J7(M7,z7,P7),F7),J7(N7,B7,R7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),J7(M7,Y7(M7,z7,P7),F7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),Wpt(N7,V7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),Y7(M7,Y7(M7,z7,P7),F7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),J7(N7,Wpt(N7,B7),R7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),Y7(M7,J7(M7,z7,P7),F7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),X7(N7,V7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2]),J7(M7,J7(M7,z7,P7),F7),Z7(d,M7[0],M7[1],M7[2]),Z7(f,N7[0],N7[1],N7[2])}for(let e=0;e<i;++e){for(let t=0;t<2;t++)Z7(p,h+e*8+2*t,h+(e+1)*8+2*t+1,h+e*8+2*t+1),Z7(p,h+e*8+2*t,h+(e+1)*8+2*t,h+(e+1)*8+2*t+1);for(let t=2;t<4;t++)Z7(p,h+e*8+2*t,h+(e+1)*8+2*t,h+e*8+2*t+1),Z7(p,h+(e+1)*8+2*t,h+(e+1)*8+2*t+1,h+e*8+2*t+1)}if(c){let i=a[0],c=o[0],l=s===0?c:s;Q7(0,e,t,n,r,i,l,l,!1)}else if(s>0){let i=a[0],c=o[0];Q7(0,e,t,n,r,i,s,-c,!1),Q7(0,e,t,n,r,i,-s,c,!1)}if(l&&s===0){let s=a[i],c=o[i];Q7(i*3,e,t,n,r,s,c,c,!0)}let _=(i+1)*8+(c?4:s>0?8:0)+(l&&s===0?4:0);for(let e=0,t=_;e<t;++e)qpt(m,u)}var e9=B(),t9=B(),n9=B(),r9=B(),i9=B(),a9=B();function o9(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}function s9(e,t,n,r,i,a){e[0]=t[0]*i+n[0]*a+r[0],e[1]=t[1]*i+n[1]*a+r[1],e[2]=t[2]*i+n[2]*a+r[2]}var c9=B.fromArray,Jpt=B.normalize,l9=B.scaleAndAdd,u9=B.cross,Ypt=B.slerp,Xpt=B.dot,Zpt=B.unitX,d9=_O.add3,f9=new Map;function Qpt(e,t){let n=t?1:0,r=pE(e,n);if(!f9.has(r)){let t=[],i=[];for(let r=0;r<e;++r){let a=(r*2+n)/e*Math.PI;t[r]=Math.cos(a),i[r]=Math.sin(a)}f9.set(r,{cos:t,sin:i})}return f9.get(r)}function p9(e,t,n,r,i,a,o,s,c,l,u,d=!1){let{currentGroup:f,vertices:p,normals:m,indices:h,groups:g}=e,_=p.elementCount,{cos:v,sin:y}=Qpt(a,u===`rounded`),b=Math.round(a/4),x=b*3,S=d&&i&&(c||l),C,w=S&&c&&l;w&&(C=i/2);for(let e=0;e<=i;++e){let l=e*3;c9(i9,n,l),c9(a9,r,l),c9(r9,t,l);let d=o[e],f=s[e],h;if(S){let t=w?e<=C:c;h=w?Math.max(2**-52,Math.sqrt(1-((t?C-e:e-C)/C)**2)):Math.max(2**-52,Math.sqrt(1-((t?i-e:e)/i)**2)),d*=h,f*=h,u9(t9,t?a9:i9,t?i9:a9),Jpt(t9,t9)}let g=u===`rounded`&&f>d;for(let e=0;e<a;++e)g?(s9(n9,i9,a9,r9,d*v[e],d*y[e]),l9(n9,n9,i9,Xpt(a9,Zpt)<0?e<b||e>=x?f-d:-f+d:e>=b&&e<x?-f+d:f-d),e===b||e===b-1?o9(e9,i9,a9,0,1):e===x||e===x-1?o9(e9,i9,a9,0,-1):o9(e9,i9,a9,v[e],y[e])):(s9(n9,i9,a9,r9,f*v[e],d*y[e]),o9(e9,i9,a9,d*v[e],f*y[e])),Jpt(e9,e9),d9(p,n9[0],n9[1],n9[2]),S&&Ypt(e9,t9,e9,h),d9(m,e9[0],e9[1],e9[2])}let T=Math.round(a/2);for(let e=0;e<i;++e){for(let t=0;t<T;++t)d9(h,_+e*a+(t+1)%a,_+(e+1)*a+(t+1)%a,_+e*a+t),d9(h,_+(e+1)*a+(t+1)%a,_+(e+1)*a+t,_+e*a+t);for(let t=T;t<a;++t)d9(h,_+e*a+(t+1)%a,_+(e+1)*a+t,_+e*a+t),d9(h,_+(e+1)*a+(t+1)%a,_+(e+1)*a+t,_+e*a+(t+1)%a)}if(c){let e=p.elementCount;c9(i9,n,0),c9(a9,r,0),c9(r9,t,0),u9(e9,a9,i9),d9(p,r9[0],r9[1],r9[2]),d9(m,e9[0],e9[1],e9[2]);let i=S?0:o[0],c=S?0:s[0],l=u===`rounded`&&c>i;l&&(c-=i),_=p.elementCount;for(let t=0;t<a;++t)l?(s9(n9,i9,a9,r9,i*v[t],i*y[t]),l9(n9,n9,i9,t<b||t>=x?c:-c)):s9(n9,i9,a9,r9,c*v[t],i*y[t]),d9(p,n9[0],n9[1],n9[2]),d9(m,e9[0],e9[1],e9[2]),d9(h,_+(t+1)%a,_+t,e)}if(l){let e=i*3,c=p.elementCount;c9(i9,n,e),c9(a9,r,e),c9(r9,t,e),u9(e9,i9,a9),d9(p,r9[0],r9[1],r9[2]),d9(m,e9[0],e9[1],e9[2]);let l=S?0:o[i],d=S?0:s[i],f=u===`rounded`&&d>l;f&&(d-=l),_=p.elementCount;for(let e=0;e<a;++e)f?(s9(n9,i9,a9,r9,l*v[e],l*y[e]),l9(n9,n9,i9,e<b||e>=x?d:-d)):s9(n9,i9,a9,r9,d*v[e],l*y[e]),d9(p,n9[0],n9[1],n9[2]),d9(m,e9[0],e9[1],e9[2]),d9(h,_+e,_+(e+1)%a,c)}let E=(i+1)*a+(c?a+1:0)+(l?a+1:0);_O.addRepeat(g,E,f)}var m9=B.fromArray,$pt=B.magnitude,h9=B.sub,emt=B.add,g9=B.scale,tmt=B.negate,nmt=B.copy,rmt=B.cross,_9=_O.add3,imt=_O.add,v9=B(),y9=B(),amt=B(),b9=B(),x9=B(),omt=B(),S9=B(),smt=B(),C9=B();function w9(e,t,n,r,i,a,o,s){let{currentGroup:c,vertices:l,normals:u,indices:d,groups:f}=e,p=l.elementCount,m=0;s>0&&(m9(v9,t,0),m9(y9,t,i*3),m=s/$pt(h9(amt,y9,v9)));for(let e=0;e<=i;++e){let c=a[e],d=o[e],f=s===0?d:s*(1-e/i),p=e*3;m9(x9,n,p),g9(x9,x9,f),m9(b9,r,p),g9(b9,b9,c),s>0&&(m9(v9,n,p),m9(y9,r,p),g9(omt,rmt(omt,v9,y9),m)),m9(S9,t,p),m9(smt,n,p),m9(C9,r,p),emt(v9,S9,x9),tmt(y9,C9),_9(l,v9[0],v9[1],v9[2]),_9(u,y9[0],y9[1],y9[2]),h9(v9,S9,x9),_9(l,v9[0],v9[1],v9[2]),_9(u,y9[0],y9[1],y9[2]),emt(v9,S9,x9),nmt(y9,C9),_9(l,v9[0],v9[1],v9[2]),_9(u,y9[0],y9[1],y9[2]),h9(v9,S9,x9),_9(l,v9[0],v9[1],v9[2]),_9(u,y9[0],y9[1],y9[2])}for(let e=0;e<i;++e)_9(d,p+e*4,p+(e+1)*4+1,p+e*4+1),_9(d,p+e*4,p+(e+1)*4,p+(e+1)*4+1),_9(d,p+e*4+2+1,p+(e+1)*4+2+1,p+e*4+2),_9(d,p+e*4+2,p+(e+1)*4+2+1,p+(e+1)*4+2);let h=(i+1)*4;for(let e=0,t=h;e<t;++e)imt(f,c)}const cmt={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:V.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:V.Numeric(1.5,{min:0,max:3,step:.1},{description:`Size factor for sheet arrows`}),tubularHelices:V.Boolean(!1,{description:`Draw alpha helices as tubes`}),roundCap:V.Boolean(!1,{description:`Draw round caps on tubular alpha helices`}),helixProfile:V.Select(`elliptical`,V.arrayToOptions([`elliptical`,`rounded`,`square`]),{description:`Protein helix trace profile`}),nucleicProfile:V.Select(`square`,V.arrayToOptions([`elliptical`,`rounded`,`square`]),{description:`Nucleic strand trace profile`}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),linearSegments:V.Numeric(8,{min:1,max:48,step:1},EM.CustomQualityParamInfo),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo)};V.getDefaultValues(cmt);var T9=B();function lmt(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,detail:c,linearSegments:l,radialSegments:u,aspectRatio:d,arrowFactor:f,tubularHelices:p,roundCap:m,helixProfile:h,nucleicProfile:g}=i,_=l*u*o+(u+1)*o*2,v=YN.createState(_,_/10,a),y=Q.isCoarse(t),b=P8(l),{curvePoints:x,normalVectors:S,binormalVectors:C,widthValues:w,heightValues:T}=b,E=0,D=S8(t,n,{ignoreSecondaryStructure:!1,useHelixOrientation:p});for(;D.hasNext;){let e=D.move();v.currentGroup=E;let t=EI(e.moleculeType),n=OI.is(e.secStrucType,OI.Flag.Beta),i=OI.is(e.secStrucType,OI.Flag.Helix),a=i&&!p?.9:_ft,o=t?q8:K8;F8(b,e,a,o);let _=r.size.size(e.centerPrev)*s,O=r.size.size(e.center)*s,k=r.size.size(e.centerNext)*s;y&&(_*=d/2,O*=d/2,k*=d/2);let A=e.secStrucFirst||e.coarseBackboneFirst||e.first,j=e.secStrucLast||e.coarseBackboneLast||e.last,M=i&&p&&m,N=l;if(e.initial){N=Math.max(Math.round(l*o),1);let t=l-N;x.copyWithin(0,t*3),C.copyWithin(0,t*3),S.copyWithin(0,t*3),B.fromArray(T9,x,3),B.normalize(T9,B.sub(T9,e.p2,T9)),B.scaleAndAdd(T9,e.p2,T9,O*2),B.toArray(T9,x,0)}else e.final&&(N=Math.max(Math.round(l*(1-o)),1),B.fromArray(T9,x,N*3-3),B.normalize(T9,B.sub(T9,e.p2,T9)),B.scaleAndAdd(T9,e.p2,T9,O*2),B.toArray(T9,x,N*3));if(e.initial===!0&&e.final===!0)oN(v,e.p2,O*2,c);else if(n){let t=_*d,n=O*d,r=k*d,i=e.secStrucLast?n*f:0;G8(b,_,O,k,t,n,r,o),u===2?w9(v,x,S,C,N,w,T,i):$7(v,x,S,C,N,w,T,i,A,j)}else{let e,n,r;i?p?(_*=d*1.5,O*=d*1.5,k*=d*1.5,e=_,n=O,r=k):(e=_*d,n=O*d,r=k*d):t?(e=_*d,n=O*d,r=k*d):(e=_,n=O,r=k),G8(b,_,O,k,e,n,r,o);let[a,s]=t?[C,S]:[S,C];if(t)for(let e=0,t=a.length;e<t;e++)a[e]*=-1;let c=t?g:h;u===2?t?w9(v,x,a,s,N,T,w,0):w9(v,x,a,s,N,w,T,0):u===4?$7(v,x,a,s,N,w,T,0,A,j):n===O?p9(v,x,a,s,N,u,w,T,A,j,`elliptical`,M):c===`square`?$7(v,x,a,s,N,w,T,0,A,j):p9(v,x,a,s,N,u,w,T,A,j,c)}++E}let O=YN.getMesh(v),k=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return O.setBoundingSphere(k),O}const umt={...b$,...cmt};function dmt(e){return x$({defaultProps:V.getDefaultValues(umt),createGeometry:lmt,createLocationIterator:e=>Y8.fromGroup(e,{asSecondary:!0}),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.tubularHelices!==n.tubularHelices||t.roundCap!==n.roundCap||t.detail!==n.detail||t.linearSegments!==n.linearSegments||t.radialSegments!==n.radialSegments||t.aspectRatio!==n.aspectRatio||t.arrowFactor!==n.arrowFactor||t.helixProfile!==n.helixProfile||t.nucleicProfile!==n.nucleicProfile;let s=Tz.get(a.structure).version;e.info.secondaryStructureHash!==s&&(e.info.secondaryStructureHash!==void 0&&(e.createGeometry=!0),e.info.secondaryStructureHash=s)},initUpdateState:(e,t,n,r)=>{let i=Tz.get(r.structure).version;e.info.secondaryStructureHash=i}},e)}var fmt={"polymer-trace":(e,t)=>v$(`Polymer trace mesh`,e,t,dmt),"polymer-gap":(e,t)=>v$(`Polymer gap cylinder`,e,t,j7),"nucleotide-block":(e,t)=>v$(`Nucleotide block mesh`,e,t,Rft),"nucleotide-ring":(e,t)=>v$(`Nucleotide ring mesh`,e,t,Zft),"nucleotide-atomic-ring-fill":(e,t)=>v$(`Nucleotide atomic ring fill`,e,t,mpt),"nucleotide-atomic-bond":(e,t)=>v$(`Nucleotide atomic bond`,e,t,hpt),"nucleotide-atomic-element":(e,t)=>v$(`Nucleotide atomic element`,e,t,bpt),"direction-wedge":(e,t)=>v$(`Polymer direction wedge`,e,t,zpt)};const pmt={...umt,...A7,...Lft,...Xft,...o7,...S7,...ppt,...Rpt,sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),visuals:V.MultiSelect([`polymer-trace`,`polymer-gap`,`nucleotide-ring`,`nucleotide-atomic-ring-fill`,`nucleotide-atomic-bond`,`nucleotide-atomic-element`],V.objectToOptions(fmt)),bumpFrequency:V.Numeric(2,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory),colorMode:V.Select(`default`,V.arrayToOptions([`default`,`interpolate`]),{...EM.ShadingCategory,isHidden:!0})};function mmt(e,t){let n=V.clone(pmt),r=!1,i=!1;return t.units.forEach(e=>{!r&&Q.isAtomic(e)&&e.nucleotideElements.length&&(r=!0),!i&&e.gapElements.length&&(i=!0)}),n.visuals.defaultValue=[`polymer-trace`],r&&n.visuals.defaultValue.push(`nucleotide-ring`),i&&n.visuals.defaultValue.push(`polymer-gap`),n}function hmt(e,t){return rJ.createMulti(`Cartoon`,e,t,O$,fmt)}const gmt=k$({name:`cartoon`,label:`Cartoon`,description:`Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.`,factory:hmt,getParams:mmt,defaultValues:V.getDefaultValues(pmt),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:async(e,t)=>{await Tz.attach(e,t,void 0,!0);for(let n of t.models)await b8.attach(e,n,void 0,!0)},detach:e=>{Tz.ref(e,!1);for(let t of e.models)b8.ref(t,!1)}}});var _mt=B.add;function vmt(e,t,n,r,i,a){let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return HM.createEmpty(a);let{detail:c,sizeFactor:l}=i,{elements:u,model:d}=t,f=u.length,p=f*rN(c),m=YN.createState(p,p/2,a),h=xB.Provider.get(d);if(!h)return HM.createEmpty(a);let g=B(),_=TT(),v=B(),y=B(),b=B(),{elementToAnsiotrop:x,data:S}=h,{U:C}=S,w=S._schema.U.space,T=t.conformation,E=iL.create(n);E.unit=t;let D=$6(n,t,i),O=B(),k=0;for(let e=0;e<f;e++){let t=u[e],n=x[t];if(n!==-1&&!(D&&D(u[e]))){E.element=t,T.invariantPosition(t,g),_mt(O,O,g),k+=1,m.currentGroup=e,BD.toMat3(_,w,C.value(n)),TT.symmtricFromLower(_,_),TT.symmetricEigenvalues(v,_),TT.eigenvector(y,_,v[1]),TT.eigenvector(b,_,v[2]);for(let e=0;e<3;++e)v[e]=l*1.5958*Math.sqrt(Math.abs(v[e]));wT(v[0],v[1],1e-6)&&wT(v[1],v[2],1e-6)?oN(m,g,v[0],c):rY(m,g,b,y,v,c)}}let A=YN.getMesh(m);if(k===0)return A;let j;B.scale(O,O,1/k);let M=a?q.clone(a.boundingSphere):void 0;return j=M&&B.distance(O,M.center)/M.radius<.1?M:q.expand(q(),(s??t).boundary.sphere,1*l*2),A.setBoundingSphere(j),A}const ymt={...b$,sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1)};function bmt(e){return x$({defaultProps:V.getDefaultValues(ymt),createGeometry:vmt,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens}},e)}function xmt(e,t,n,r,i){let{child:a}=t,{detail:o,sizeFactor:s}=r,{getSerialIndex:c}=t.serialMapping,l=t.elementCount*rN(o),u=YN.createState(l,l/2,i),d=B(),f=TT(),p=B(),m=B(),h=B(),g=B(),_=0;for(let e of t.units){let n=a?.unitMap.get(e.id);if(a&&!n)return HM.createEmpty(i);let{elements:l,model:v}=e,y=l.length,b=xB.Provider.get(v);if(!b)return HM.createEmpty(i);let x=$6(t,e,r),{elementToAnsiotrop:S,data:C}=b,{U:w}=C,T=C._schema.U.space,E=e.conformation,D=iL.create(t);D.unit=e;for(let t=0;t<y;t++){let n=l[t],r=S[n];if(r!==-1&&!(x&&x(l[t]))){D.element=n,E.position(n,d),_mt(g,g,d),_+=1,u.currentGroup=c(e,l[t]),BD.toMat3(f,T,w.value(r)),TT.symmtricFromLower(f,f),TT.symmetricEigenvalues(p,f),TT.eigenvector(m,f,p[1]),TT.eigenvector(h,f,p[2]);for(let e=0;e<3;++e)p[e]=s*1.5958*Math.sqrt(Math.abs(p[e]));wT(p[0],p[1],1e-6)&&wT(p[1],p[2],1e-6)?oN(u,d,p[0],o):rY(u,d,h,m,p,o)}}}let v=YN.getMesh(u);if(_===0)return v;let y;B.scale(g,g,1/_);let b=i?q.clone(i.boundingSphere):void 0;return y=b&&B.distance(g,b.center)/b.radius<1?b:q.expand(q(),(a??t).boundary.sphere,1*s*2),v.setBoundingSphere(y),v}const Smt={...m$,sizeFactor:V.Numeric(1,{min:0,max:10,step:.1}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1)};function Cmt(e){return h$({defaultProps:V.getDefaultValues(Smt),createGeometry:xmt,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens}},e)}var wmt={"ellipsoid-mesh":(e,t)=>v$(`Ellipsoid Mesh`,e,t,bmt),"intra-bond":(e,t)=>v$(`Intra-unit bond cylinder`,e,t,lut),"inter-bond":(e,t)=>GQ(`Inter-unit bond cylinder`,e,t,wut),"structure-ellipsoid-mesh":(e,t)=>GQ(`Structure Ellipsoid Mesh`,e,t,Cmt),"structure-intra-bond":(e,t)=>GQ(`Structure intra-unit bond cylinder`,e,t,gut)};const Tmt={...ymt,...Y6,...Z6,includeParent:V.Boolean(!1),adjustCylinderLength:V.Boolean(!1,{isHidden:!0}),unitKinds:d$([`atomic`]),sizeFactor:V.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:V.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:V.Boolean(!0),visuals:V.MultiSelect([`ellipsoid-mesh`,`intra-bond`,`inter-bond`],V.objectToOptions(wmt)),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory)};function Emt(e,t){let n=Tmt;return nB.getSize(t)>=nB.Size.Huge?(n=V.clone(n),n.visuals.defaultValue=[`ellipsoid-mesh`,`intra-bond`]):t.unitSymmetryGroups.length>5e3&&(n=V.clone(n),n.visuals.defaultValue=[`structure-ellipsoid-mesh`,`structure-intra-bond`]),n}function Dmt(e,t){return rJ.createMulti(`Ellipsoid`,e,t,O$,wmt)}const Omt=k$({name:`ellipsoid`,label:`Ellipsoid`,description:`Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.`,factory:Dmt,getParams:Emt,defaultValues:V.getDefaultValues(Tmt),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.elementCount>0&&e.models.some(e=>xB.Provider.isApplicable(e)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent});var kmt={drawCount:JP(`number`),instanceCount:JP(`number`),aRadius:WP(`float32`,1,0),aPosition:WP(`float32`,3,0),aGroup:WP(`float32`,1,0),uCurrentSlice:J(`f`),uCurrentX:J(`f`),uCurrentY:J(`f`),uBboxMin:J(`v3`,`material`),uBboxSize:J(`v3`,`material`),uGridDim:J(`v3`,`material`),uGridTexDim:J(`v3`,`material`),uGridTexScale:J(`v2`,`material`),uAlpha:J(`f`,`material`),uResolution:J(`f`,`material`),uRadiusFactorInv:J(`f`,`material`),tMinDistanceTex:GP(`texture`,`rgba`,`float`,`nearest`,`material`),dGridTexType:qP(`string`,[`2d`,`3d`]),dCalcType:qP(`string`,[`density`,`minDistance`,`groupId`])},E9=`gaussian-density`;function Amt(e){return e.namedFramebuffers[E9]||(e.namedFramebuffers[E9]=e.resources.framebuffer()),e.namedFramebuffers[E9]}function jmt(e,t,n,r,i,a){let o=`${E9}-${e}`;return t.namedTextures[o]||(t.namedTextures[o]=t.resources.texture(n,r,i,a)),t.namedTextures[o]}function Mmt(e,t,n,r,i,a){return e.isWebGL2?Nmt(e,t,n,r,i,a):D9(e,t,n,r,!1,i,a)}function D9(e,t,n,r,i,a,o){$y&&e.timer.mark(`GaussianDensityTexture2d`);let s=Imt(e,t,n,r,i,a,o);return $y&&e.timer.markEnd(`GaussianDensityTexture2d`),Pmt(s)}function Nmt(e,t,n,r,i,a){$y&&e.timer.mark(`GaussianDensityTexture3d`);let o=Lmt(e,t,n,r,i,a);return $y&&e.timer.markEnd(`GaussianDensityTexture3d`),Pmt(o)}function Pmt({texture:e,scale:t,bbox:n,gridDim:r,gridTexDim:i,gridDataDim:a,gridTexScale:o,radiusFactor:s,resolution:c,maxRadius:l}){return{transform:Fmt(t,n),texture:e,bbox:n,gridDim:r,gridTexDim:i,gridDataDim:a,gridTexScale:o,radiusFactor:s,resolution:c,maxRadius:l}}function Fmt(e,t){let n=z.identity();return z.fromScaling(n,e),z.setTranslation(n,t.min),n}function Imt(e,t,n,r,i,a,o){let{gl:s,resources:c,state:l,extensions:{colorBufferFloat:u,textureFloat:d,colorBufferHalfFloat:f,textureHalfFloat:p,blendMinMax:m}}=e,{smoothness:h,resolution:g}=a,{drawCount:_,positions:v,radii:y,groups:b,scale:x,expandedBox:S,dim:C,maxRadius:w}=Rmt(t,n,r,a),[T,E,D]=C,{texDimX:O,texDimY:k,texCols:A,powerOfTwoSize:j}=Gmt(C),M=B.create(O,k,0),N=R.create(O/j,k/j),ee=w*2,te=i?j:O,P=i?j:k,ne=jmt(`min-dist-2d`,e,`image-uint8`,`rgba`,`ubyte`,`nearest`);ne.define(te,P);let re=zmt(e,_,v,y,b,ne,S,C,M,N,h,g,ee),{uCurrentSlice:ie,uCurrentX:ae,uCurrentY:oe}=re.values,se=Amt(e);se.bind(),Vmt(e),o||=f&&p?c.texture(`image-float16`,`rgba`,`fp16`,`linear`):u&&d?c.texture(`image-float32`,`rgba`,`float`,`linear`):c.texture(`image-uint8`,`rgba`,`ubyte`,`linear`),o.define(te,P);function ce(e,t){l.currentRenderItemId=-1,e.attachFramebuffer(se,0),t&&(l.viewport(0,0,te,P),l.scissor(0,0,te,P),s.clear(s.COLOR_BUFFER_BIT)),L.update(oe,0);let n=0,r=0,i=0;for(let e=0;e<D;++e)n>=A&&(n-=A,r+=E,i=0,L.update(oe,r)),L.update(ae,i),L.update(ie,e),l.viewport(i,r,T,E),l.scissor(i,r,T,E),re.render(),++n,i+=T;s.flush()}return Umt(e,re),ce(o,!0),m&&(Hmt(e,re),ce(ne,!0),Wmt(e,re),ce(o,!1)),{texture:o,scale:x,bbox:S,gridDim:C,gridTexDim:M,gridDataDim:C,gridTexScale:N,radiusFactor:ee,resolution:g,maxRadius:w}}function Lmt(e,t,n,r,i,a){let{gl:o,resources:s,state:c,extensions:{colorBufferFloat:l,textureFloat:u,colorBufferHalfFloat:d,textureHalfFloat:f}}=e,{smoothness:p,resolution:m}=i,{drawCount:h,positions:g,radii:_,groups:v,scale:y,expandedBox:b,dim:x,maxRadius:S}=Rmt(t,n,r,i),[C,w,T]=x,E=jmt(`min-dist-3d`,e,`volume-uint8`,`rgba`,`ubyte`,`nearest`);E.define(C,w,T);let D=R.create(1,1),O=S*2,k=zmt(e,h,g,_,v,E,b,x,x,D,p,m,O),{uCurrentSlice:A}=k.values,j=Amt(e);j.bind(),Vmt(e),c.viewport(0,0,C,w),c.scissor(0,0,C,w),a||=d&&f?s.texture(`volume-float16`,`rgba`,`fp16`,`linear`):l&&u?s.texture(`volume-float32`,`rgba`,`float`,`linear`):s.texture(`volume-uint8`,`rgba`,`ubyte`,`linear`),a.define(C,w,T);function M(e,t){c.currentRenderItemId=-1;for(let n=0;n<T;++n)L.update(A,n),e.attachFramebuffer(j,0,n),t&&o.clear(o.COLOR_BUFFER_BIT),k.render();o.flush()}return Umt(e,k),M(a,!0),Hmt(e,k),M(E,!0),Wmt(e,k),M(a,!1),{texture:a,scale:y,bbox:b,gridDim:x,gridTexDim:x,gridDataDim:x,gridTexScale:D,radiusFactor:O,resolution:m,maxRadius:S}}function Rmt(e,t,n,r){let{resolution:i,radiusOffset:a}=r,o=1/i,{indices:s,x:c,y:l,z:u,id:d}=e,f=K.size(s),p=new Float32Array(f*3),m=new Float32Array(f),h=new Float32Array(f),g=0;for(let e=0;e<f;++e){let t=K.getAt(s,e);p[e*3]=c[t],p[e*3+1]=l[t],p[e*3+2]=u[t];let r=n(t)+a;g<r&&(g=r),m[e]=r,h[e]=d?d[e]:e}let _=g*2+i*4,v=$k.expand($k(),t,B.create(_,_,_)),y=$k.scale($k(),v,o),b=$k.size(B(),y);return B.ceil(b,b),{drawCount:f,positions:p,radii:m,groups:h,scale:B.create(i,i,i),expandedBox:v,dim:b,maxRadius:g}}function zmt(e,t,n,r,i,a,o,s,c,l,u,d,f){if(e.namedComputeRenderables[E9]){let p=B.sub(B(),o.max,o.min),m=e.namedComputeRenderables[E9].values;L.updateIfChanged(m.drawCount,t),L.updateIfChanged(m.instanceCount,1),L.update(m.aRadius,r),L.update(m.aPosition,n),L.update(m.aGroup,i),L.updateIfChanged(m.uCurrentSlice,0),L.updateIfChanged(m.uCurrentX,0),L.updateIfChanged(m.uCurrentY,0),L.update(m.uBboxMin,o.min),L.update(m.uBboxSize,p),L.update(m.uGridDim,s),L.update(m.uGridTexDim,c),L.update(m.uGridTexScale,l),L.updateIfChanged(m.uAlpha,u),L.updateIfChanged(m.uResolution,d),L.updateIfChanged(m.uRadiusFactorInv,1/f),L.update(m.tMinDistanceTex,a),L.updateIfChanged(m.dGridTexType,a.getDepth()>0?`3d`:`2d`),L.updateIfChanged(m.dCalcType,`density`),e.namedComputeRenderables[E9].update()}else e.namedComputeRenderables[E9]=Bmt(e,t,n,r,i,a,o,s,c,l,u,d,f);return e.namedComputeRenderables[E9]}function Bmt(e,t,n,r,i,a,o,s,c,l,u,d,f){let p=B.sub(B(),o.max,o.min),m={drawCount:L.create(t),instanceCount:L.create(1),aRadius:L.create(r),aPosition:L.create(n),aGroup:L.create(i),uCurrentSlice:L.create(0),uCurrentX:L.create(0),uCurrentY:L.create(0),uBboxMin:L.create(o.min),uBboxSize:L.create(p),uGridDim:L.create(s),uGridTexDim:L.create(c),uGridTexScale:L.create(l),uAlpha:L.create(u),uResolution:L.create(d),uRadiusFactorInv:L.create(1/f),tMinDistanceTex:L.create(a),dGridTexType:L.create(a.getDepth()>0?`3d`:`2d`),dCalcType:L.create(`density`)},h={...kmt};return hF(aF(e,`points`,fj(E9,`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`,`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`),h,m),m)}function Vmt(e){let{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0)}function Hmt(e,t){let{gl:n,state:r}=e;if(L.update(t.values.dCalcType,`minDistance`),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),!e.extensions.blendMinMax)throw Error(`GPU gaussian surface calculation requires EXT_blend_minmax`);r.blendEquation(e.extensions.blendMinMax.MAX)}function Umt(e,t){let{gl:n,state:r}=e;L.update(t.values.dCalcType,`density`),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),r.blendEquation(n.FUNC_ADD)}function Wmt(e,t){let{gl:n,state:r}=e;L.update(t.values.dCalcType,`groupId`),t.update(),r.colorMask(!0,!0,!0,!1),r.blendFunc(n.ONE,n.ZERO),r.blendEquation(n.FUNC_ADD)}function Gmt(e){let t=e[0]*e[1]*e[2],n=Math.sqrt(t),r=2**Math.ceil(Math.log(n)/Math.log(2)),i=0,a=e[1],o=1,s=e[2];return r<e[0]*e[2]?(s=Math.floor(r/e[0]),o=Math.ceil(e[2]/s),i=s*e[0],a*=o):i=e[0]*e[2],{texDimX:i,texDimY:a,texRows:o,texCols:s,powerOfTwoSize:a<r?r:r*2}}async function Kmt(e,t,n,r,i){let{resolution:a,radiusOffset:o,smoothness:s}=i,c=1/a,{indices:l,x:u,y:d,z:f,id:p}=t,m=K.size(l),h=new Float32Array(m),g=0;for(let e=0;e<m;++e){let t=r(K.getAt(l,e))+o;g<t&&(g=t),h[e]=t}let _=g*2+a,v=$k.expand($k(),n,B.create(_,_,_)),y=v.min,b=$k.scale($k(),v,c),x=$k.size(B(),b);B.ceil(x,x);let S=BD.Space(x,[0,1,2],Float32Array),C=S.create(),w=BD.create(S,C),T=S.create();T.fill(-1);let E=BD.create(S,T),[D,O,k]=x,A=k,j=A*O,M=eA(x[0],y[0],a),N=eA(x[1],y[1],a),ee=eA(x[2],y[2],a),te=S.create(),P=s,ne=Math.ceil(1e5/((g**3)**3*c));function re(e,t){for(let n=e;n<t;++n){let e=K.getAt(l,n),t=u[e],r=d[e],i=f[e],a=h[n],o=1/(a*a),s=a*2,m=s*s,g=Math.ceil(s*c),_=Math.floor(c*(t-y[0])),v=Math.floor(c*(r-y[1])),b=Math.floor(c*(i-y[2])),x=Math.max(0,_-g),S=Math.max(0,v-g),w=Math.max(0,b-g),E=Math.min(D,_+g+2),ne=Math.min(O,v+g+2),re=Math.min(k,b+g+2);for(let e=x;e<E;++e){let a=M[e]-t,s=e*j;for(let e=S;e<ne;++e){let t=N[e]-r,c=a*a+t*t,l=e*A+s;for(let e=w;e<re;++e){let t=ee[e]-i,r=c+t*t;if(r<=m){let t=V3e(-P*(r*o)),i=e+l;C[i]+=t,t>te[i]&&(te[i]=t,T[i]=p?p[n]:n)}}}}}}async function ie(){for(let t=0;t<m;t+=ne)re(t,Math.min(t+ne,m)),e.shouldUpdate&&await e.update({message:`filling density grid`,current:t,max:m})}await ie();let ae=z.identity();return z.fromScaling(ae,B.create(a,a,a)),z.setTranslation(ae,v.min),{field:w,idField:E,transform:ae,radiusFactor:1,resolution:a,maxRadius:g}}const O9={resolution:V.Numeric(1,{min:.1,max:20,step:.1},{description:`Grid resolution/cell spacing.`,...EM.CustomQualityParamInfo}),radiusOffset:V.Numeric(0,{min:0,max:10,step:.1},{description:`Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces.`}),smoothness:V.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:`Smoothness of the gausian surface, lower is smoother.`}),...o$};V.getDefaultValues(O9);function qmt(e,t){let n=e.maxTextureSize/3;return n*n/Math.max(1,t?t.units.length/16:1)}function Jmt(e,t,n,r){let{position:i,boundary:a,radius:o}=s$(e,t,n,r),s=a$(a.box,r);return hb.create(`Gaussian Density`,async e=>await Kmt(e,i,a.box,o,s))}function Ymt(e,t,n,r,i,a){let{position:o,boundary:s,radius:c}=s$(e,t,n,r),l=a$(s.box,r,qmt(i,e));return Mmt(i,o,s.box,c,l,a)}function Xmt(e,t,n,r,i,a,o){let{position:s,boundary:c,radius:l}=s$(e,t,n,i),u=a$(c.box,i,qmt(a,e));return D9(a,s,c.box,l,r,u,o)}function Zmt(e,t,n){let{position:r,boundary:i,radius:a}=c$(e,t,n),o=a$(i.box,n);return hb.create(`Gaussian Density`,async e=>await Kmt(e,r,i.box,a,o))}function Qmt(e,t,n,r,i){let{position:a,boundary:o,radius:s}=c$(e,t,n),c=a$(o.box,n);return Mmt(r,a,o.box,s,c,i)}function $mt(e,t,n,r,i,a){let{box:o}=e.lookup3d.boundary,{position:s,boundary:c,radius:l}=c$(e,t,r);return D9(i,s,o,l,n,a$(c.box,r),a)}var eht={...O9,...CM,ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),tryUseGpu:V.Boolean(!0),includeParent:V.Boolean(!1,{isHidden:!0})};const k9={...b$,...HZe,...eht},tht={...m$,...NZe,...eht};function nht(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.textureFloatLinear&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function A9(e,t,n){if(t.resolution>1)return!1;let r=n.maxTextureSize/3,{areaCells:i,maxAreaCells:a}=sZe(e.boundary.box,t.resolution,r*r);return i<a}function rht(e,t,n,r){return n.tryUseGpu&&r&&nht(r)&&A9(t,n,r)?uht(e):oht(e)}function iht(e,t,n,r){return n.tryUseGpu&&r&&nht(r)&&A9(t,n,r)?fht(e):cht(e)}async function aht(e,t,n,r,i,a){let{smoothness:o}=i,{transform:s,field:c,idField:l,radiusFactor:u,resolution:d,maxRadius:f}=await Jmt(n,t,r.size,i).runInContext(e.runtime),p=await K4({isoLevel:Math.exp(-o)/u,scalarField:c,idField:l},a).runAsChild(e.runtime);p.meta.resolution=d,HM.transform(p,s),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(p),L.updateIfChanged(p.varyingGroup,!1)):L.updateIfChanged(p.varyingGroup,!0);let m=q.expand(q(),t.boundary.sphere,f);return p.setBoundingSphere(m),p}function oht(e){return x$({defaultProps:V.getDefaultValues(k9),createGeometry:aht,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&A9(e.structure,t,n),processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&(Vq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;(t=e.meta.colorTexture)==null||t.destroy()}},e)}async function sht(e,t,n,r,i){let{smoothness:a}=r,{transform:o,field:s,idField:c,radiusFactor:l,resolution:u,maxRadius:d}=await Zmt(t,n.size,r).runInContext(e.runtime),f=await K4({isoLevel:Math.exp(-a)/l,scalarField:s,idField:c},i).runAsChild(e.runtime);f.meta.resolution=u,HM.transform(f,o),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(f),L.updateIfChanged(f.varyingGroup,!1)):L.updateIfChanged(f.varyingGroup,!0);let p=q.expand(q(),t.boundary.sphere,d);return f.setBoundingSphere(p),f}function cht(e){return h$({defaultProps:V.getDefaultValues(tht),createGeometry:sht,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&A9(e,t,n),processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&(Vq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;(t=e.meta.colorTexture)==null||t.destroy()}},e)}var j9=`gaussian-surface`;function lht(e,t,n,r,i,a){let{webgl:o}=e;if(!o)throw Error(`webgl context required to create gaussian surface texture-mesh`);let{namedTextures:s,resources:c,extensions:{colorBufferFloat:l,textureFloat:u,colorBufferHalfFloat:d,textureHalfFloat:f}}=o;s[j9]||(s[j9]=d&&f?c.texture(`image-float16`,`rgba`,`fp16`,`linear`):l&&u?c.texture(`image-float32`,`rgba`,`float`,`linear`):c.texture(`image-uint8`,`rgba`,`ubyte`,`linear`));let p=B.create(0,1,2),m=t.elements.length,h=e=>{$y&&o.timer.mark(`createGaussianSurfaceTextureMesh`);let a=Xmt(n,t,r.size,!0,i,o,s[j9]),c=Math.exp(-i.smoothness)/a.radiusFactor,l=e?.doubleBuffer.get(),u=a3(o,a.texture,a.gridDim,a.gridTexDim,a.gridDataDim,a.gridTexScale,a.transform,c,!1,!0,p,!0,l?.vertex,l?.group,l?.normal);$y&&o.timer.markEnd(`createGaussianSurfaceTextureMesh`);let d=q.expand(q(),t.boundary.sphere,a.maxRadius),f=UP.create(u.vertexCount,m,u.vertexTexture,u.groupTexture,u.normalTexture,d,e);return f.meta.resolution=a.resolution,f},g=h(a);return g.meta.webgl=o,g.meta.reset=()=>{h(g)},g}function uht(e){return UZe({defaultProps:V.getDefaultValues(k9),createGeometry:lht,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!A9(e.structure,t,n),processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&i&&(Xq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy(),(t=e.meta.colorTexture)==null||t.destroy()}},e)}function dht(e,t,n,r,i){let{webgl:a}=e;if(!a)throw Error(`webgl context required to create structure gaussian surface texture-mesh`);let{namedTextures:o,resources:s,extensions:{colorBufferFloat:c,textureFloat:l,colorBufferHalfFloat:u,textureHalfFloat:d}}=a;o[j9]||(o[j9]=u&&d?s.texture(`image-float16`,`rgba`,`fp16`,`linear`):c&&l?s.texture(`image-float32`,`rgba`,`float`,`linear`):s.texture(`image-uint8`,`rgba`,`ubyte`,`linear`));let f=B.create(0,1,2),p=t.elementCount,m=e=>{$y&&a.timer.mark(`createStructureGaussianSurfaceTextureMesh`);let i=$mt(t,n.size,!0,r,a,o[j9]),s=Math.exp(-r.smoothness)/i.radiusFactor,c=e?.doubleBuffer.get(),l=a3(a,i.texture,i.gridDim,i.gridTexDim,i.gridDataDim,i.gridTexScale,i.transform,s,!1,!0,f,!0,c?.vertex,c?.group,c?.normal);$y&&a.timer.markEnd(`createStructureGaussianSurfaceTextureMesh`);let u=q.expand(q(),t.boundary.sphere,i.maxRadius),d=UP.create(l.vertexCount,p,l.vertexTexture,l.groupTexture,l.normalTexture,u,e);return d.meta.resolution=i.resolution,d},h=m(i);return h.meta.webgl=a,h.meta.reset=()=>{m(h)},h}function fht(e){return PZe({defaultProps:V.getDefaultValues(tht),createGeometry:dht,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!A9(e,t,n),processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&i&&(Xq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy(),(t=e.meta.colorTexture)==null||t.destroy()}},e)}async function pht(e,t,n,r,i,a){let{smoothness:o}=i,{transform:s,field:c,idField:l,maxRadius:u}=await Jmt(n,t,r.size,i).runInContext(e.runtime),d=await q4({isoLevel:Math.exp(-o),scalarField:c,idField:l},a).runAsChild(e.runtime);vP.transform(d,s);let f=q.expand(q(),t.boundary.sphere,u);return d.setBoundingSphere(f),d}const mht={...E$,...O9,sizeFactor:V.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:V.Boolean(!1),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),includeParent:V.Boolean(!1,{isHidden:!0})};function hht(e){return D$({defaultProps:V.getDefaultValues(mht),createGeometry:pht,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)}},e)}var ght={"gaussian-surface-mesh":(e,t)=>v$(`Gaussian surface mesh`,e,t,rht),"structure-gaussian-surface-mesh":(e,t)=>GQ(`Structure-Gaussian surface mesh`,e,t,iht),"gaussian-surface-wireframe":(e,t)=>v$(`Gaussian surface wireframe`,e,t,hht)};const _ht={...k9,...mht,visuals:V.MultiSelect([`gaussian-surface-mesh`],V.objectToOptions(ght)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.5,{min:0,max:1,step:.01},EM.ShadingCategory)};function vht(e,t){return _ht}function yht(e,t){return rJ.createMulti(`Gaussian Surface`,e,t,O$,ght)}const bht=k$({name:`gaussian-surface`,label:`Gaussian Surface`,description:`Displays a gaussian molecular surface.`,factory:yht,getParams:vht,defaultValues:V.getDefaultValues(_ht),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0}),xht={...kZe,background:V.Boolean(!1),backgroundMargin:V.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:V.Color(gk.black),backgroundOpacity:V.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:V.Numeric(.25,{min:0,max:.5,step:.01}),level:V.Select(`residue`,[[`chain`,`Chain`],[`residue`,`Residue`],[`element`,`Element`]],{isEssential:!0}),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),chainScale:V.Numeric(10,{min:0,max:20,step:.1}),residueScale:V.Numeric(1,{min:0,max:20,step:.1}),elementScale:V.Numeric(.5,{min:0,max:20,step:.1})};function Sht(e){return AZe({defaultProps:V.getDefaultValues(xht),createGeometry:Cht,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.level!==n.level||t.level===`chain`&&t.chainScale!==n.chainScale||t.level===`residue`&&t.residueScale!==n.residueScale||t.level===`element`&&t.elementScale!==n.elementScale||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function Cht(e,t,n,r,i){switch(r.level){case`chain`:return wht(e,t,n,r,i);case`residue`:return Tht(e,t,n,r,i);case`element`:return Eht(e,t,n,r,i)}}var M9=B(),N9=new RA(`98`);function wht(e,t,n,r,i){let a=iL.create(t),{units:o,serialMapping:s}=t,{auth_asym_id:c,label_asym_id:l}=Pz.chain,{cumulativeUnitElementCount:u}=s,d=o.length,{chainScale:f}=r,p=DJ.create(r,d,d/2,i);for(let e=0,t=o.length;e<t;++e){let t=o[e];a.unit=t,a.element=t.elements[0];let{center:n,radius:r}=t.lookup3d.boundary.sphere;B.transformMat4(M9,n,t.conformation.operator.matrix);let i=c(a),s=l(a),d=i===s?s:`${s} [${i}]`;p.add(d,M9[0],M9[1],M9[2],r,f,u[e])}return p.getText()}function Tht(e,t,n,r,i){let a=iL.create(t),{units:o,serialMapping:s}=t,{label_comp_id:c}=Pz.atom,{auth_seq_id:l}=Pz.residue,{cumulativeUnitElementCount:u}=s,d=t.polymerResidueCount*2,{residueScale:f}=r,p=DJ.create(r,d,d/2,i);for(let e=0,t=o.length;e<t;++e){let t=o[e],n=t.conformation,{elements:r}=t;a.unit=t,a.element=t.elements[0];let i=t.model.atomicHierarchy.residueAtomSegments.index,s=u[e],d=0,m=r.length;for(;d<m;){let e=d,t=i[r[d]];for(d++;d<m&&i[r[d]]===t;)d++;N9.reset();for(let t=e;t<d;t++)n.position(r[t],M9),N9.includePosition(M9);N9.finishedIncludeStep();for(let t=e;t<d;t++)n.position(r[t],M9),N9.radiusPosition(M9);a.element=r[e];let{center:o,radius:u}=N9.getSphere(),h=l(a),g=`${c(a)} ${h}`;p.add(g,o[0],o[1],o[2],u,f,s+e)}}return p.getText()}function Eht(e,t,n,r,i){let a=iL.create(t),{units:o,serialMapping:s}=t,{label_atom_id:c,label_alt_id:l}=Pz.atom,{cumulativeUnitElementCount:u}=s,d=n.size,f=t.elementCount,{elementScale:p}=r,m=DJ.create(r,f,f/2,i);for(let e=0,n=o.length;e<n;++e){let n=o[e],i=n.conformation,{elements:s}=n;a.unit=n;let f=u[e],h=$6(t,n,{...r,traceOnly:!1});for(let e=0,t=s.length;e<t;e++){if(h&&h(s[e]))continue;a.element=s[e],i.position(a.element,M9);let t=c(a),n=l(a),r=n?`${t}%${n}`:t;m.add(r,M9[0],M9[1],M9[2],d.size(a),p,f+e)}}return m.getText()}var Dht={"label-text":(e,t)=>GQ(`Label text`,e,t,Sht)};const Oht={...xht,visuals:V.MultiSelect([`label-text`],V.objectToOptions(Dht))};function kht(e,t){return Oht}function Aht(e,t){let n=rJ.createMulti(`Label`,e,t,O$,Dht);return n.setState({pickable:!1,markerActions:lq.None}),n}const jht=k$({name:`label`,label:`Label`,description:`Displays labels.`,factory:Aht,getParams:kht,defaultValues:V.getDefaultValues(Oht),defaultColorTheme:{name:`uniform`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0});function Mht(e,t){return e[0]=e[1]=e[2]=1,t[0]===0?t[1]===0?t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]):e[1]=(t[0]+t[2])/-t[1]:e[0]=(t[1]+t[2])/-t[0],e}function Nht(e){let t=0,n=2*Math.PI/e,r=new Float32Array(e),i=new Float32Array(e);for(let a=0;a<e;a++)r[a]=Math.cos(t),i[a]=Math.sin(t),t+=n;return{cosTable:r,sinTable:i}}const P9={probeRadius:V.Numeric(1.4,{min:0,max:10,step:.1},{description:`Radius of the probe tracing the molecular surface.`}),resolution:V.Numeric(.5,{min:.01,max:20,step:.01},{description:`Grid resolution/cell spacing.`}),probePositions:V.Numeric(36,{min:12,max:90,step:1},{description:`Number of positions tested for probe target intersection.`})};V.getDefaultValues(P9);async function Pht(e,t,n,r,i,a){let o=-1;function s(e,t,n,r,i){if(o!==-1){let a=o;if(a!==r&&a!==i&&c(a,e,t,n))return a;o=-1}for(let a=0,s=T.count;a<s;++a){let s=K.getAt(E,T.indices[a]);if(s!==r&&s!==i&&c(s,e,t,n))return o=s,s}return-1}function c(e,t,n,r){let i=j[e],a=D[e]-t,o=O[e]-n,s=k[e]-r;return a*a+o*o+s*s<i*i}function l(e,t){for(let n=e;n<t;++n){let e=K.getAt(E,n),t=D[e],r=O[e],i=k[e],a=j[e],o=a*a;w.find(t,r,i,a);let c=Math.ceil(a*x),l=Math.floor(x*(t-te)),u=Math.floor(x*(r-P)),d=Math.floor(x*(i-ne)),f=Math.max(0,l-c),p=Math.max(0,u-c),m=Math.max(0,d-c),h=Math.min(ae,l+c+2),g=Math.min(oe,u+c+2),_=Math.min(se,d+c+2);for(let c=f;c<h;++c){let l=he[c]-t,u=c*le;for(let c=p;c<g;++c){let d=ge[c]-r,f=l*l+d*d,p=c*ce+u;for(let c=m;c<_;++c){let u=_e[c]-i,m=f+u*u;if(m<o){let o=c+p;pe[o]<0&&(pe[o]*=-1);let f=Math.sqrt(m),h=a/f;if(s(l*h+t,d*h+r,u*h+i,e,-1)===-1){let e=a-f;e<pe[o]&&(pe[o]=e,me[o]=A[n])}}}}}}}async function u(){for(let t=0;t<M;t+=ve)l(t,Math.min(t+ve,M)),e.shouldUpdate&&await e.update({message:`projecting points`,current:t,max:M})}let d=B(),f=B(),p=B(),m=B();function h(e,t){let n=j[e],r=j[t],i=d[0]=D[t]-D[e],a=d[1]=O[t]-O[e],c=d[2]=k[t]-k[e],l=i*i+a*a+c*c,u=Math.sqrt(l),h=n*((n*n+u*u-r*r)/(2*n*u));B.normalize(d,d),Mht(p,d),B.normalize(p,p),B.cross(m,d,p),B.normalize(m,m);let g=Math.sqrt(n*n-h*h);B.scale(p,p,g),B.scale(m,m,g),B.scale(d,d,h),f[0]=d[0]+D[e],f[1]=d[1]+O[e],f[2]=d[2]+k[e],o=-1;for(let n=0;n<b;++n){let r=ue[n],i=de[n],a=f[0]+r*p[0]+i*m[0],o=f[1]+r*p[1]+i*m[1],c=f[2]+r*p[2]+i*m[2];if(s(a,o,c,e,t)===-1){let n=Math.floor(x*(a-te)),r=Math.floor(x*(o-P)),i=Math.floor(x*(c-ne)),s=Math.max(0,n-S),l=Math.max(0,r-S),u=Math.max(0,i-S),f=Math.min(ae,n+S+2),p=Math.min(oe,r+S+2),m=Math.min(se,i+S+2);for(let n=s;n<f;++n){let r=a-he[n],i=n*le;for(let n=l;n<p;++n){let a=o-ge[n],s=r*r+a*a,l=n*ce+i;for(let n=u;n<m;++n){let i=c-_e[n],o=s+i*i,u=n+l,f=pe[u];if(f>0&&o<f*f){pe[u]=Math.sqrt(o);let n=r*d[0]+a*d[1]+i*d[2];me[u]=A[K.indexOf(E,n<0?t:e)]}}}}}}}function g(e,t){for(let n=e;n<t;++n){let e=K.getAt(E,n);w.find(D[e],O[e],k[e],j[e]);for(let t=0,n=T.count;t<n;++t){let n=K.getAt(E,T.indices[t]);e<n&&h(e,n)}}}async function _(){for(let t=0;t<M;t+=ve)g(t,Math.min(t+ve,M)),e.shouldUpdate&&await e.update({message:`projecting torii`,current:t,max:M})}let{resolution:v,probeRadius:y,probePositions:b}=a,x=1/v,S=Math.max(5,2+Math.floor(y*x)),C=B.create(r,r,r);B.scale(C,C,2);let w=yA(t,n,C),T=w.result;i===null&&(i=w.boundary.box);let{indices:E,x:D,y:O,z:k,id:A,radius:j}=t,M=K.size(E),N=r+v,ee=$k.expand($k(),i,B.create(N,N,N)),[te,P,ne]=ee.min,re=$k.scale($k(),ee,x),ie=$k.size(B(),re);B.ceil(ie,ie);let[ae,oe,se]=ie,ce=se,le=ce*oe,{cosTable:ue,sinTable:de}=Nht(b),fe=BD.Space(ie,[0,1,2],Float32Array),pe=fe.create(),me=fe.create();pe.fill(-1001),me.fill(-1);let he=eA(ae,te,v),ge=eA(oe,P,v),_e=eA(se,ne,v),ve=Math.ceil(1e5/((r**3)**3*x));await u(),await _();let ye=BD.create(fe,pe),be=BD.create(fe,me),xe=z.identity();return z.fromScaling(xe,B.create(v,v,v)),z.setTranslation(xe,ee.min),{field:ye,idField:be,transform:xe,resolution:v,maxRadius:r}}function Fht(e,t,n,r){let{probeRadius:i}=r,{position:a,boundary:o,radius:s}=s$(e,t,n,r),{indices:c}=a,l=K.size(c),u=new Float32Array(K.end(c)),d=0;for(let e=0;e<l;++e){let t=K.getAt(c,e),n=s(t);d<n&&(d=n),u[t]=n+i}return{position:{...a,radius:u},boundary:o,maxRadius:d}}function Iht(e,t,n,r){let{position:i,boundary:a,maxRadius:o}=Fht(e,t,n,r),s=a$(a.box,r);return hb.create(`Molecular Surface`,async e=>await zht(e,i,a,o,a.box,s))}function Lht(e,t,n){let{probeRadius:r}=n,{position:i,boundary:a,radius:o}=c$(e,t,n),{indices:s}=i,c=K.size(s),l=new Float32Array(K.end(s)),u=0;for(let e=0;e<c;++e){let t=K.getAt(s,e),n=o(t);u<n&&(u=n),l[t]=n+r}return{position:{...i,radius:l},boundary:a,maxRadius:u}}function Rht(e,t,n){let{position:r,boundary:i,maxRadius:a}=Lht(e,t,n),o=a$(i.box,n);return hb.create(`Molecular Surface`,async e=>await zht(e,r,i,a,i.box,o))}async function zht(e,t,n,r,i,a){return Pht(e,t,n,r,i,a)}var Bht={...P9,resolution:{...P9.resolution,...EM.CustomQualityParamInfo},probePositions:{...P9.probePositions,...EM.CustomQualityParamInfo}};const F9={...b$,...Bht,...o$,...CM};async function Vht(e,t,n,r,i,a){let{transform:o,field:s,idField:c,resolution:l,maxRadius:u}=await Iht(n,t,r.size,i).runInContext(e.runtime),d=await K4({isoLevel:i.probeRadius,scalarField:s,idField:c},a).runAsChild(e.runtime);if(i.includeParent){let e=Math.ceil(2/i.resolution);HM.smoothEdges(d,{iterations:e,maxNewEdgeLength:Math.sqrt(2)})}HM.transform(d,o),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(d),L.updateIfChanged(d.varyingGroup,!1)):L.updateIfChanged(d.varyingGroup,!0);let f=q.expand(q(),t.boundary.sphere,u);return d.setBoundingSphere(f),d.meta.resolution=l,d}function Hht(e){return x$({defaultProps:V.getDefaultValues(F9),createGeometry:Vht,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&(Vq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;(t=e.meta.colorTexture)==null||t.destroy()}},e)}async function Uht(e,t,n,r,i){let{transform:a,field:o,idField:s,resolution:c,maxRadius:l}=await Rht(t,n.size,r).runInContext(e.runtime),u=await K4({isoLevel:r.probeRadius,scalarField:o,idField:s},i).runAsChild(e.runtime);if(r.includeParent){let e=Math.ceil(2/r.resolution);HM.smoothEdges(u,{iterations:e,maxNewEdgeLength:Math.sqrt(2)})}HM.transform(u,a),e.webgl&&!e.webgl.isWebGL2?(HM.uniformTriangleGroup(u),L.updateIfChanged(u.varyingGroup,!1)):L.updateIfChanged(u.varyingGroup,!0);let d=q.expand(q(),t.boundary.sphere,l);return u.setBoundingSphere(d),u.meta.resolution=c,u}function Wht(e){return h$({defaultProps:V.getDefaultValues(F9),createGeometry:Uht,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name===n.smoothColors.name?t.smoothColors.name===`on`&&n.smoothColors.name===`on`&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0)):e.updateColor=!0},processValues:(e,t,n,r,i)=>{let{resolution:a,colorTexture:o}=t.meta,s=TM(n.smoothColors,r.color.preferSmoothing,a);s&&(Vq(e,s.resolution,s.stride,i,o),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t;(t=e.meta.colorTexture)==null||t.destroy()}},e)}const Ght={...E$,...P9,...o$,sizeFactor:V.Numeric(1.5,{min:0,max:10,step:.1})};async function Kht(e,t,n,r,i,a){let{transform:o,field:s,idField:c,maxRadius:l}=await Iht(n,t,r.size,i).runInContext(e.runtime),u=await q4({isoLevel:i.probeRadius,scalarField:s,idField:c},a).runAsChild(e.runtime);vP.transform(u,o);let d=q.expand(q(),t.boundary.sphere,l);return u.setBoundingSphere(d),u}function qht(e){return D$({defaultProps:V.getDefaultValues(Ght),createGeometry:Kht,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)}},e)}var Jht={"molecular-surface-mesh":(e,t)=>v$(`Molecular surface mesh`,e,t,Hht),"structure-molecular-surface-mesh":(e,t)=>GQ(`Structure Molecular surface mesh`,e,t,Wht),"molecular-surface-wireframe":(e,t)=>v$(`Molecular surface wireframe`,e,t,qht)};const Yht={...F9,...Ght,visuals:V.MultiSelect([`molecular-surface-mesh`],V.objectToOptions(Jht)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.5,{min:0,max:1,step:.01},EM.ShadingCategory)};function Xht(e,t){return Yht}function Zht(e,t){return rJ.createMulti(`Molecular Surface`,e,t,O$,Jht)}const Qht=k$({name:`molecular-surface`,label:`Molecular Surface`,description:`Displays a molecular surface.`,factory:Zht,getParams:Xht,defaultValues:V.getDefaultValues(Yht),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0}),$ht={...b$,sizeFactor:V.Numeric(1,{min:0,max:2,step:.1}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo)};function egt(e){return x$({defaultProps:V.getDefaultValues($ht),createGeometry:ngt,createLocationIterator:rgt,getLoci:igt,eachLocation:agt,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}},e)}function tgt(e){if(Q.Traits.is(e.traits,Q.Trait.MultiChain)||Q.Traits.is(e.traits,Q.Trait.Partitioned))return!1;if(Q.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;let t=e.residueIndex[e.elements[0]],n=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(n===iI.Ion||n===iI.Water)}function ngt(e,t,n,r,i,a){if(!tgt(t))return HM.createEmpty(a);let{detail:o,sizeFactor:s}=i,c=YN.createState(256,256/2,a),l=t.principalAxes.boxAxes,{origin:u,dirA:d,dirB:f}=l,p=Yk.size(B(),l);B.scale(p,p,s/2);let m=B.create(p[2],p[1],p[0]);c.currentGroup=0,rY(c,u,d,f,m,o+1);let h=YN.getMesh(c),g=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return h.setBoundingSphere(g),h}function rgt(e){let{group:t,structure:n}=e,r=t.units.length,i=iL.create(n);return tj(1,r,1,(e,n)=>{let r=t.units[n];return i.unit=r,i.element=r.elements[e],i})}function igt(e,t,n){let{objectId:r,instanceId:i}=e;if(n===r){let{structure:e,group:n}=t,r=n.units[i],a=K.ofBounds(0,r.elements.length);return $(e,[{unit:r,indices:a}])}return hq}function agt(e,t,n){let r=!1;if(!$.is(e))return!1;let{structure:i,group:a}=t;if(!nB.areEquivalent(e.structure,i))return!1;let o=a.elements.length;for(let t of e.elements){let e=a.unitIndexMap.get(t.unit.id);e!==void 0&&K.size(t.indices)===o&&n(G.ofSingleton(e))&&(r=!0)}return r}var ogt={"orientation-ellipsoid-mesh":(e,t)=>v$(`Orientation ellipsoid mesh`,e,t,egt)};const sgt={...$ht,visuals:V.MultiSelect([`orientation-ellipsoid-mesh`],V.objectToOptions(ogt)),bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory)};function cgt(e,t){return sgt}function lgt(e,t){return rJ.createMulti(`Orientation`,e,t,O$,ogt)}const ugt=k$({name:`orientation`,label:`Orientation`,description:`Displays orientation ellipsoids for polymer chains.`,factory:lgt,getParams:cgt,defaultValues:V.getDefaultValues(sgt),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.elementCount>0});var I9=B.add;const L9={...RZe,pointSizeAttenuation:V.Boolean(!1),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1),stride:V.Numeric(1,{min:1,max:100,step:1})};function dgt(e,t,n,r,i,a){let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return iP.createEmpty(a);let{stride:c}=i,l=t.elements,u=l.length,d=C3.create(u,u/10,a),f=B(),p=t.conformation,m=$6(n,t,i),h=B(),g=0;if(c&&c>1||m)for(let e=0;e<u;++e)c&&e%c!==0||m&&m(l[e])||(p.invariantPosition(l[e],f),I9(h,h,f),g+=1,d.add(f[0],f[1],f[2],e));else for(let e=0;e<u;++e)p.invariantPosition(l[e],f),I9(h,h,f),g+=1,d.add(f[0],f[1],f[2],e);let _=d.getPoints();if(g===0)return _;let v;B.scale(h,h,1/g);let y=a?q.clone(a.boundingSphere):void 0;return v=y&&B.distance(h,y.center)/y.radius<.1?y:q.expand(q(),(s??t).boundary.sphere,1*i.sizeFactor),_.setBoundingSphere(v),_}function fgt(e){return zZe({defaultProps:V.getDefaultValues(L9),createGeometry:dgt,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride}},e)}function pgt(e,t,n,r,i){let{child:a}=t,{stride:o}=r,{getSerialIndex:s}=t.serialMapping,c=t.elementCount,l=C3.create(c,c/2,i),u=B(),d=0;for(let e of t.units){let n=a?.unitMap.get(e.id);if(a&&!n)return iP.createEmpty(i);let{elements:c,conformation:f}=e,p=c.length,m=B(),h=$6(t,e,r);if(o&&o>1||h)for(let t=0;t<p;t++){let n=c[t];o&&t%o!==0||h&&h(n)||(f.position(n,m),l.add(m[0],m[1],m[2],s(e,n)),I9(u,u,m),d+=1)}else{for(let t=0;t<p;t++){let n=c[t];f.position(n,m),l.add(m[0],m[1],m[2],s(e,n)),I9(u,u,m)}d+=p}}let f=l.getPoints();if(d===0)return f;let p;B.scale(u,u,1/d);let m=i?q.clone(i.boundingSphere):void 0;return p=m&&B.distance(u,m.center)/m.radius<1?m:q.expand(q(),(a??t).boundary.sphere,1*r.sizeFactor),f.setBoundingSphere(p),f}const mgt={...DZe,pointSizeAttenuation:V.Boolean(!1),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1),stride:V.Numeric(1,{min:1,max:100,step:1})};function hgt(e){return OZe({defaultProps:V.getDefaultValues(mgt),createGeometry:pgt,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride}},e)}var ggt={"element-point":(e,t)=>v$(`Element points`,e,t,fgt),"structure-element-point":(e,t)=>GQ(`Structure element points`,e,t,hgt)};const _gt={...L9,density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory),visuals:V.MultiSelect([`element-point`],V.objectToOptions(ggt))};function vgt(e,t){let n=_gt;return t.unitSymmetryGroups.length>5e3&&(n=V.clone(n),n.visuals.defaultValue=[`structure-element-point`]),n}function ygt(e,t){return rJ.createMulti(`Point`,e,t,O$,ggt)}const bgt=k$({name:`point`,label:`Point`,description:`Displays elements (atoms, coarse spheres) as points.`,factory:ygt,getParams:vgt,defaultValues:V.getDefaultValues(_gt),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.elementCount>0}),xgt={sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),linearSegments:V.Numeric(8,{min:1,max:48,step:1},EM.CustomQualityParamInfo),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo)};V.getDefaultValues(xgt);var R9=B();function Sgt(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HM.createEmpty(a);let{sizeFactor:s,detail:c,linearSegments:l,radialSegments:u}=i,d=l*u*o+(u+1)*o*2,f=YN.createState(d,d/10,a),p=P8(l),{curvePoints:m,normalVectors:h,binormalVectors:g,widthValues:_,heightValues:v}=p,y=0,b=S8(t,n,{ignoreSecondaryStructure:!0});for(;b.hasNext;){let e=b.move();f.currentGroup=y;let t=EI(e.moleculeType)?q8:K8;F8(p,e,_ft,t);let n=e.coarseBackboneFirst||e.first,i=e.coarseBackboneLast||e.last,a=r.size.size(e.centerPrev)*s,o=r.size.size(e.center)*s,d=r.size.size(e.centerNext)*s;G8(p,a,o,d,a,o,d,t);let x=l;if(e.initial){x=Math.max(Math.round(l*t),1);let n=l-x;m.copyWithin(0,n*3),g.copyWithin(0,n*3),h.copyWithin(0,n*3),_.copyWithin(0,n*3),v.copyWithin(0,n*3),B.fromArray(R9,m,3),B.normalize(R9,B.sub(R9,e.p2,R9)),B.scaleAndAdd(R9,e.p2,R9,o*2),B.toArray(R9,m,0)}else e.final&&(x=Math.max(Math.round(l*(1-t)),1),B.fromArray(R9,m,x*3-3),B.normalize(R9,B.sub(R9,e.p2,R9)),B.scaleAndAdd(R9,e.p2,R9,o*2),B.toArray(R9,m,x*3));e.initial===!0&&e.final===!0?oN(f,e.p2,o*2,c):u===2?w9(f,m,h,g,x,_,v,0):u===4?$7(f,m,h,g,x,_,v,0,n,i):p9(f,m,h,g,x,u,_,v,n,i,`elliptical`),++y}let x=YN.getMesh(f),S=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return x.setBoundingSphere(S),x}const Cgt={...b$,...xgt};function wgt(e){return x$({defaultProps:V.getDefaultValues(Cgt),createGeometry:Sgt,createLocationIterator:e=>Y8.fromGroup(e,{asSecondary:!0}),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.linearSegments!==n.linearSegments||t.radialSegments!==n.radialSegments}},e)}var Tgt={"polymer-tube":(e,t)=>v$(`Polymer tube mesh`,e,t,wgt),"polymer-gap":(e,t)=>v$(`Polymer gap cylinder`,e,t,j7)};const Egt={...Cgt,...A7,sizeFactor:V.Numeric(.2,{min:0,max:10,step:.01}),visuals:V.MultiSelect([`polymer-tube`,`polymer-gap`],V.objectToOptions(Tgt)),bumpFrequency:V.Numeric(2,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory)};function Dgt(e,t){let n=V.clone(Egt),r=!1,i=!1;return t.units.forEach(e=>{!r&&Q.isAtomic(e)&&e.nucleotideElements.length&&(r=!0),!i&&e.gapElements.length&&(i=!0)}),n.visuals.defaultValue=[`polymer-tube`],i&&n.visuals.defaultValue.push(`polymer-gap`),n}function Ogt(e,t){return rJ.createMulti(`Putty`,e,t,O$,Tgt)}const kgt=k$({name:`putty`,label:`Putty`,description:`Displays a tube smoothly following the trace atoms of polymers.`,factory:Ogt,getParams:Dgt,defaultValues:V.getDefaultValues(Egt),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`uncertainty`},isApplicable:e=>e.polymerResidueCount>0});var Agt={"element-sphere":(e,t)=>v$(`Sphere mesh/impostor`,e,t,Mut),"structure-element-sphere":(e,t)=>GQ(`Structure sphere mesh/impostor`,e,t,Iut)};const z9={...a8,bumpFrequency:V.Numeric(1,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.5,{min:0,max:1,step:.01},EM.ShadingCategory),visuals:V.MultiSelect([`element-sphere`],V.objectToOptions(Agt))};var B9;function jgt(e,t){let n=z9;return t.isCoarseGrained&&(B9||(B9=V.clone(z9),B9.sizeFactor.defaultValue=2),n=B9),t.unitSymmetryGroups.length>5e3&&(n=V.clone(n),n.visuals.defaultValue=[`structure-element-sphere`]),n}function Mgt(e,t){return rJ.createMulti(`Spacefill`,e,t,O$,Agt)}const Ngt=k$({name:`spacefill`,label:`Spacefill`,description:`Displays atomic/coarse elements as spheres.`,factory:Mgt,getParams:jgt,defaultValues:V.getDefaultValues(z9),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0});var V9=kI.is;function Pgt(e,t,n,r){let i=iL.create(t,e),a=e.elements,{edgeCount:o,a:s,b:c,edgeProps:l,offset:u}=e.bonds,{order:d,flags:f}=l,{sizeFactor:p,aromaticBonds:m,includeTypes:h,excludeTypes:g,multipleBonds:_}=r,v=_===`off`,y=_===`symmetric`,b=I6(kI.fromNames(h),kI.fromNames(g),kI.Flag.Computed),x=B(),S=e.conformation,{elementRingIndices:C,elementAromaticRingIndices:w}=e.rings,T=m?e.resonance.delocalizedTriplets:void 0;return{linkCount:o*2,referencePosition:e=>{let t=s[e],n=c[e],r=T?.getThirdElement(t,n);if(r!==void 0)return S.invariantPosition(a[r],x);t>n&&([t,n]=[n,t]),u[t+1]-u[t]===1&&([t,n]=[n,t]);let i=w.get(t)||C.get(t),o=0;for(let e=u[t],r=u[t+1];e<r;++e){let r=c[e];if(r!==n&&r!==t)if(i){let e=w.get(r)||C.get(r);if(!e)continue;let t=AE(i,e);t>o&&(o=t,S.invariantPosition(a[r],x))}else return S.invariantPosition(a[r],x)}return o>0?x:null},position:(e,t,n,r)=>{S.invariantPosition(a[s[n]],e),S.invariantPosition(a[c[n]],t)},style:e=>{let t=d[e],n=f[e];if(V9(n,kI.Flag.MetallicCoordination)||V9(n,kI.Flag.HydrogenBond))return C1.Dashed;if(t===3)return v?C1.Solid:y?C1.Triple:C1.OffsetTriple;if(m){let t=s[e],r=c[e],i=w.get(t),a=w.get(r),o=i&&a?AE(i,a):0;if(V9(n,kI.Flag.Aromatic)||o&&!b)return o===2?C1.MirroredAromatic:C1.Aromatic}return t!==2||v?C1.Solid:y?C1.Double:C1.OffsetDouble},radius:e=>{i.element=a[s[e]];let t=n.size.size(i);i.element=a[c[e]];let r=n.size.size(i);return Math.min(t,r)*p},ignore:aut(t,e,r)}}function Fgt(e,t,n,r,i,a){if(!Q.isAtomic(t)||!L6(t,i)||!t.bonds.edgeCount)return vP.createEmpty(a);let{child:o}=n,s=o?.unitMap.get(t.id);if(o&&!s)return vP.createEmpty(a);let{lines:c,boundingSphere:l}=A1(e,Pgt(t,n,r,i),i,a);if(l)c.setBoundingSphere(l);else if(c.lineCount>0){let e=q.expand(q(),(s??t).boundary.sphere,1*i.sizeFactor);c.setBoundingSphere(e)}return c}const Igt={...E$,...F6,includeParent:V.Boolean(!1)};function Lgt(e){return D$({defaultProps:V.getDefaultValues(Igt),createGeometry:Fgt,createLocationIterator:e=>z6.fromGroup(e),getLoci:B6,eachLocation:V6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds;let s=a.group.units[0],c=o.group.units[0];Q.isAtomic(s)&&Q.isAtomic(c)&&(KI.areEqual(s.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))}},e)}function Rgt(e,t,n){let r=[],{bondCount:i,unitIndex:a,unitEdgeIndex:o,unitGroupIndex:s}=e.intraUnitBondMapping,{child:c}=e;for(let i of e.unitSymmetryGroups){let a=i.units[0],o=c?.unitMap.get(a.id),s=Q.isAtomic(a)&&!(c&&!o)?Pgt(a,e,t,n):_1e;r.push({group:i,props:s})}return{linkCount:i,referencePosition:e=>{let{group:t,props:n}=r[a[e]];if(!n.referencePosition)return null;let i=n.referencePosition(o[e]);if(!i)return null;let c=t.units[s[e]];return B.transformMat4(i,i,c.conformation.operator.matrix),i},position:(e,t,n,i)=>{let{group:c,props:l}=r[a[n]];l.position(e,t,o[n],i);let u=c.units[s[n]];B.transformMat4(e,e,u.conformation.operator.matrix),B.transformMat4(t,t,u.conformation.operator.matrix)},style:e=>{let{props:t}=r[a[e]];return t.style?t.style(o[e]):C1.Solid},radius:e=>{let{props:t}=r[a[e]];return t.radius(o[e])},ignore:e=>{let{props:t}=r[a[e]];return t.ignore?t.ignore(o[e]):!1},stub:e=>{let{props:t}=r[a[e]];return t.stub?t.stub(o[e]):!1}}}function zgt(e,t,n,r,i){if(!R6(t,r)||!t.intraUnitBondMapping.bondCount)return vP.createEmpty(i);let{lines:a,boundingSphere:o}=A1(e,Rgt(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.lineCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}const Bgt={...g$,...F6,includeParent:V.Boolean(!1)};function Vgt(e){return _$({defaultProps:V.getDefaultValues(Bgt),createGeometry:zgt,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructureGroups(e):nj,getLoci:G6,eachLocation:K6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.multipleBonds!==n.multipleBonds,R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)}},e)}var H9=new fR.ElementBondIterator;function Hgt(e,t,n,r){for(H9.setElement(t,n,r);H9.hasNext;){let t=H9.move();return t.otherUnit.conformation.position(t.otherUnit.elements[t.otherIndex],e),e}return null}function Ugt(e,t,n){let{edgeCount:r,edges:i}=e.interUnitBonds,{sizeFactor:a,aromaticBonds:o,multipleBonds:s}=n,c=s===`off`,l=s===`symmetric`,u=B(),d=iL.create();return{linkCount:r,referencePosition:t=>{let n=i[t],r,a,o,s;if(n.unitA<n.unitB)r=e.unitMap.get(n.unitA),a=e.unitMap.get(n.unitB),o=n.indexA,s=n.indexB;else if(n.unitA>n.unitB)r=e.unitMap.get(n.unitB),a=e.unitMap.get(n.unitA),o=n.indexB,s=n.indexA;else throw Error(`same units in createInterUnitBondLines`);return Hgt(u,e,r,o)||Hgt(u,e,a,s)},position:(t,n,r,a)=>{let o=i[r],s=e.unitMap.get(o.unitA),c=e.unitMap.get(o.unitB);s.conformation.position(s.elements[o.indexA],t),c.conformation.position(c.elements[o.indexB],n)},style:e=>{let t=i[e].props.order,n=_x.create(i[e].props.flag);return kI.is(n,kI.Flag.MetallicCoordination)||kI.is(n,kI.Flag.HydrogenBond)?C1.Dashed:t===3?c?C1.Solid:l?C1.Triple:C1.OffsetTriple:o&&kI.is(n,kI.Flag.Aromatic)?C1.Aromatic:t!==2||c?C1.Solid:l?C1.Double:C1.OffsetDouble},radius:n=>{let r=i[n];d.structure=e,d.unit=e.unitMap.get(r.unitA),d.element=d.unit.elements[r.indexA];let o=t.size.size(d);d.unit=e.unitMap.get(r.unitB),d.element=d.unit.elements[r.indexB];let s=t.size.size(d);return Math.min(o,s)*a},ignore:out(e,n)}}function Wgt(e,t,n,r,i){if(!R6(t,r)||!t.interUnitBonds.edgeCount)return vP.createEmpty(i);let{lines:a,boundingSphere:o}=A1(e,Ugt(t,n,r),r,i);if(o)a.setBoundingSphere(o);else if(a.lineCount>0){let{child:e}=t,n=q.expand(q(),(e??t).boundary.sphere,1*r.sizeFactor);a.setBoundingSphere(n)}return a}const Ggt={...g$,...F6,includeParent:V.Boolean(!1)};function Kgt(e){return _$({defaultProps:V.getDefaultValues(Ggt),createGeometry:Wgt,createLocationIterator:(e,t)=>R6(e,t)?z6.fromStructure(e):nj,getLoci:H6,eachLocation:W6,setUpdateState:(e,t,n,r,i,a,o)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!Cx(t.includeTypes,n.includeTypes)||!Cx(t.excludeTypes,n.excludeTypes)||t.multipleBonds!==n.multipleBonds,R6(a,t)&&a.interUnitBonds!==o.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)}},e)}var qgt=B.add,U9=B.scaleAndAdd,W9=B.unitX,G9=B.unitY,K9=B.unitZ;const Jgt={...E$,lineSizeAttenuation:V.Boolean(!1),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1),crosses:V.Select(`lone`,V.arrayToOptions([`lone`,`all`])),crossSize:V.Numeric(.35,{min:0,max:2,step:.01})};function Ygt(e,t,n,r,i,a){let{child:o}=n;if(o&&!o.unitMap.get(t.id))return vP.createEmpty(a);let s=t.elements,c=s.length,l=_P.create(c,c/10,a),u=B(),d=B(),f=B(),p=t.conformation,m=$6(n,t,i),h=i.crossSize/2,g=i.crosses===`lone`,_=B(),v=0;for(let e=0;e<c;++e)m&&m(s[e])||g&&Q.isAtomic(t)&&L6(t,i)&&XQ(n,t,e)!==0||(p.invariantPosition(s[e],u),qgt(_,_,u),v+=1,U9(d,u,W9,h),U9(f,u,W9,-h),l.add(d[0],d[1],d[2],f[0],f[1],f[2],e),U9(d,u,G9,h),U9(f,u,G9,-h),l.add(d[0],d[1],d[2],f[0],f[1],f[2],e),U9(d,u,K9,h),U9(f,u,K9,-h),l.add(d[0],d[1],d[2],f[0],f[1],f[2],e));let y=l.getLines();if(v===0)return y;let b;B.scale(_,_,1/v);let x=a?q.clone(a.boundingSphere):void 0;return b=x&&B.distance(_,x.center)/x.radius<.1?x:q.expand(q(),t.boundary.sphere,1*i.sizeFactor),y.setBoundingSphere(b),y}function Xgt(e){return D$({defaultProps:V.getDefaultValues(Jgt),createGeometry:Ygt,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.crosses!==n.crosses||t.crossSize!==n.crossSize}},e)}function Zgt(e,t,n,r,i){let{child:a}=t,{getSerialIndex:o}=t.serialMapping,s=t.elementCount,c=_P.create(s,s/2,i),l=B(),u=B(),d=B(),f=r.crossSize/2,p=r.crosses===`lone`,m=B(),h=0;for(let e of t.units){let n=a?.unitMap.get(e.id);if(a&&!n)return vP.createEmpty(i);let{elements:s,conformation:g}=e,_=s.length,v=$6(t,e,r);for(let n=0;n<_;n++){if(v&&v(s[n])||p&&Q.isAtomic(e)&&L6(e,r)&&XQ(t,e,n)!==0)continue;g.position(s[n],l),qgt(m,m,l),h+=1;let i=o(e,s[n]);U9(u,l,W9,f),U9(d,l,W9,-f),c.add(u[0],u[1],u[2],d[0],d[1],d[2],i),U9(u,l,G9,f),U9(d,l,G9,-f),c.add(u[0],u[1],u[2],d[0],d[1],d[2],i),U9(u,l,K9,f),U9(d,l,K9,-f),c.add(u[0],u[1],u[2],d[0],d[1],d[2],i)}}let g=c.getLines();if(h===0)return g;let _;B.scale(m,m,1/h);let v=i?q.clone(i.boundingSphere):void 0;return _=v&&B.distance(m,v.center)/v.radius<1?v:q.expand(q(),(a??t).boundary.sphere,1*r.sizeFactor),g.setBoundingSphere(_),g}const Qgt={...g$,lineSizeAttenuation:V.Boolean(!1),ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),traceOnly:V.Boolean(!1),crosses:V.Select(`lone`,V.arrayToOptions([`lone`,`all`])),crossSize:V.Numeric(.35,{min:0,max:2,step:.01})};function $gt(e){return _$({defaultProps:V.getDefaultValues(Qgt),createGeometry:Zgt,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.crosses!==n.crosses||t.crossSize!==n.crossSize}},e)}var e_t={"intra-bond":(e,t)=>v$(`Intra-unit bond line`,e,t,Lgt),"inter-bond":(e,t)=>GQ(`Inter-unit bond line`,e,t,Kgt),"element-point":(e,t)=>v$(`Points`,e,t,fgt),"element-cross":(e,t)=>v$(`Crosses`,e,t,Xgt),"structure-intra-bond":(e,t)=>GQ(`Structure intra-unit bond line`,e,t,Vgt),"structure-element-point":(e,t)=>GQ(`Structure element points`,e,t,hgt),"structure-element-cross":(e,t)=>GQ(`Structure element crosses`,e,t,$gt)};const t_t={...Igt,...Ggt,...L9,...Jgt,pointStyle:V.Select(`circle`,V.objectToOptions(iP.StyleTypes)),multipleBonds:V.Select(`offset`,V.arrayToOptions([`off`,`symmetric`,`offset`])),includeParent:V.Boolean(!1),sizeFactor:V.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:d$([`atomic`]),visuals:V.MultiSelect([`intra-bond`,`inter-bond`,`element-point`,`element-cross`],V.objectToOptions(e_t)),density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory)};function n_t(e,t){let n=t_t;return nB.getSize(t)>=nB.Size.Huge?(n=V.clone(n),n.visuals.defaultValue=[`intra-bond`,`element-point`,`element-cross`]):t.unitSymmetryGroups.length>5e3&&(n=V.clone(n),n.visuals.defaultValue=[`structure-intra-bond`,`structure-element-point`,`structure-element-cross`]),n}function r_t(e,t){return rJ.createMulti(`Line`,e,t,O$,e_t)}const i_t=k$({name:`line`,label:`Line`,description:`Displays bonds as lines and atoms as points or croses.`,factory:r_t,getParams:n_t,defaultValues:V.getDefaultValues(t_t),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent});function a_t(e,t,n,r,i){let{webgl:a}=e;if(!a)throw Error("GaussianDensityVolume requires `webgl`");let o=B.create(0,1,2),s={min:0,max:1,mean:.04,sigma:.01},c=e=>{let i=e?e.gridTexture.ref.value:void 0,c=Qmt(t,n.size,r,a,i),{transform:l,texture:u,bbox:d,gridDim:f}=c,p=z.mul(z(),l,z.fromScaling(z(),f)),m=z.getScaling(B(),l),h=VP.create(d,f,l,p,m,u,s,!0,o,`byte`,e),g=q.expand(q(),t.boundary.sphere,c.maxRadius);return h.setBoundingSphere(g),h},l=c(i);return l.meta.reset=()=>{c(l)},l}const o_t={...jZe,...O9,ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),includeParent:V.Boolean(!1,{isHidden:!0})};function s_t(e){return MZe({defaultProps:V.getDefaultValues(o_t),createGeometry:a_t,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)},dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}function c_t(e,t,n,r,i,a){let{webgl:o}=e;if(!o)throw Error("GaussianDensityVolume requires `webgl`");let s=B.create(0,1,2),c={min:0,max:1,mean:.04,sigma:.01},l=e=>{let a=e?e.gridTexture.ref.value:void 0,l=Ymt(n,t,r.size,i,o,a),{transform:u,texture:d,bbox:f,gridDim:p}=l,m=z.mul(z(),u,z.fromScaling(z(),p)),h=z.getScaling(B(),u),g=VP.create(f,p,u,m,h,d,c,!0,s,`byte`,e),_=q.expand(q(),t.boundary.sphere,l.maxRadius);return g.setBoundingSphere(_),g},u=l(a);return u.meta.reset=()=>{l(u)},u}const l_t={...BZe,...O9,ignoreHydrogens:V.Boolean(!1),ignoreHydrogensVariant:V.Select(`all`,V.arrayToOptions([`all`,`non-polar`])),includeParent:V.Boolean(!1,{isHidden:!0})};function u_t(e){return VZe({defaultProps:V.getDefaultValues(l_t),createGeometry:c_t,createLocationIterator:i8.fromGroup,getLoci:t8,eachLocation:e8,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)},dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}var d_t={"gaussian-volume":(e,t)=>GQ(`Gaussian volume`,e,t,s_t),"units-gaussian-volume":(e,t)=>v$(`Units-Gaussian volume`,e,t,u_t)};const f_t={...o_t,jumpLength:V.Numeric(4,{min:0,max:20,step:.1}),visuals:V.MultiSelect([`gaussian-volume`],V.objectToOptions(d_t))};function p_t(e,t){return f_t}function m_t(e,t){return rJ.createMulti(`Gaussian Volume`,e,t,O$,d_t)}const h_t=k$({name:`gaussian-volume`,label:`Gaussian Volume`,description:`Displays a gaussian molecular density using direct volume rendering.`,factory:m_t,getParams:p_t,defaultValues:V.getDefaultValues(f_t),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0});var g_t=B.scale,__t=B.add,v_t=B.sub;const q9={...b$,...w$,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:V.Numeric(16,{min:2,max:56,step:2},EM.CustomQualityParamInfo),tryUseImpostor:V.Boolean(!0)};function y_t(e,t,n,r){return n.tryUseImpostor&&r$(r)?x_t(e):C_t(e)}function b_t(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return CF.createEmpty(a);let s=o*2,c=_1.create(s,s/4,a),l=t.conformation,u=B(),d=B(),f=B();Udt(t,function(e,t,n,r,i){l.invariantPosition(e,u),l.invariantPosition(t,d);let a=EI(i)?q8:K8;__t(f,u,g_t(f,v_t(f,d,u),a)),c.add(u[0],u[1],u[2],f[0],f[1],f[2],1,!1,!1,2,n),c.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,2,r)});let p=c.getCylinders(),m=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return p.setBoundingSphere(m),p}function x_t(e){return T$({defaultProps:V.getDefaultValues(q9),createGeometry:b_t,createLocationIterator:e=>Y8.fromGroup(e),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function S_t(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HM.createEmpty(a);let{radialSegments:s,sizeFactor:c}=i,l=s*2*o*2,u=YN.createState(l,l/10,a),d=t.conformation,f=B(),p=B(),m={radiusTop:1,radiusBottom:1,radialSegments:s},h=iL.create(n,t),g=iL.create(n,t);Udt(t,function(e,t,n,i,a){h.element=e,g.element=t,d.invariantPosition(h.element,f),d.invariantPosition(g.element,p);let o=EI(a)?q8:K8;m.radiusTop=m.radiusBottom=r.size.size(h)*c,u.currentGroup=n,PN(u,f,p,o,m),m.radiusTop=m.radiusBottom=r.size.size(g)*c,u.currentGroup=i,PN(u,p,f,1-o,m)});let _=YN.getMesh(u),v=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return _.setBoundingSphere(v),_}function C_t(e){return x$({defaultProps:V.getDefaultValues(q9),createGeometry:S_t,createLocationIterator:e=>Y8.fromGroup(e),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}const J9={...b$,...S$,sizeFactor:V.Numeric(.3,{min:0,max:10,step:.01}),detail:V.Numeric(0,{min:0,max:3,step:1},EM.CustomQualityParamInfo),tryUseImpostor:V.Boolean(!0)};function w_t(e,t,n,r){return n.tryUseImpostor&&t$(r)?E_t(e):O_t(e)}function T_t(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HP.createEmpty(a);let s=S3.create(o,o/2,a),c=t.conformation,l=B();Kdt(t,(e,t)=>{c.invariantPosition(e,l),s.add(l[0],l[1],l[2],t)});let u=s.getSpheres(),d=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return u.setBoundingSphere(d),u}function E_t(e){return C$({defaultProps:V.getDefaultValues(J9),createGeometry:T_t,createLocationIterator:e=>Y8.fromGroup(e),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}function D_t(e,t,n,r,i,a){let o=t.polymerElements.length;if(!o)return HM.createEmpty(a);let{detail:s,sizeFactor:c}=i,l=o*rN(s),u=YN.createState(l,l/2,a),d=t.conformation,f=B(),p=iL.create(n,t);Kdt(t,(e,t)=>{p.element=e,d.invariantPosition(p.element,f),u.currentGroup=t,oN(u,f,r.size.size(p)*c,s)});let m=YN.getMesh(u),h=q.expand(q(),t.boundary.sphere,1*i.sizeFactor);return m.setBoundingSphere(h),m}function O_t(e){return x$({defaultProps:V.getDefaultValues(J9),createGeometry:D_t,createLocationIterator:e=>Y8.fromGroup(e),getLoci:X8,eachLocation:Z8,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}var k_t={"polymer-backbone-cylinder":(e,t)=>v$(`Polymer backbone cylinder`,e,t,y_t),"polymer-backbone-sphere":(e,t)=>v$(`Polymer backbone sphere`,e,t,w_t),"polymer-gap":(e,t)=>v$(`Polymer gap cylinder`,e,t,j7)};const A_t={...J9,...q9,...A7,sizeAspectRatio:V.Numeric(1,{min:.1,max:3,step:.1}),visuals:V.MultiSelect([`polymer-backbone-cylinder`,`polymer-backbone-sphere`,`polymer-gap`],V.objectToOptions(k_t)),bumpFrequency:V.Numeric(0,{min:0,max:10,step:.1},EM.ShadingCategory),density:V.Numeric(.1,{min:0,max:1,step:.01},EM.ShadingCategory),colorMode:V.Select(`default`,V.arrayToOptions([`default`,`interpolate`]),{...EM.ShadingCategory,isHidden:!0})};function j_t(e,t){let n=V.clone(A_t),r=!1;return t.units.forEach(e=>{!r&&e.gapElements.length&&(r=!0)}),n.visuals.defaultValue=[`polymer-backbone-cylinder`,`polymer-backbone-sphere`],r&&n.visuals.defaultValue.push(`polymer-gap`),n}function M_t(e,t){return rJ.createMulti(`Backbone`,e,t,O$,k_t)}const N_t=k$({name:`backbone`,label:`Backbone`,description:`Displays polymer backbone with cylinders and spheres.`,factory:M_t,getParams:j_t,defaultValues:V.getDefaultValues(A_t),defaultColorTheme:{name:`chain-id`},defaultSizeTheme:{name:`uniform`},isApplicable:e=>e.polymerResidueCount>0});var P_t=B.set,F_t=B.transformMat4,I_t=B.squaredDistance;const L_t={...FZe,interpolation:V.Select(`nearest`,V.objectToOptions(xF)),imageResolution:V.Numeric(.5,{min:.01,max:20,step:.01},{description:`Grid resolution/cell spacing.`,...EM.CustomQualityParamInfo}),mode:V.Select(`frame`,V.arrayToOptions([`frame`,`plane`]),{description:`Frame: slice through the structure along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal.`}),offset:V.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>e.mode!==`frame`,description:`Relative offset from center.`}),axis:V.Select(`c`,V.arrayToOptions([`a`,`b`,`c`]),{isEssential:!0,hideIf:e=>e.mode!==`frame`}),rotation:V.Group({axis:V.Vec3(B.create(1,0,0),{},{description:`Axis of rotation`}),angle:V.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:`Axis rotation angle in Degrees`})},{isExpanded:!0,hideIf:e=>e.mode!==`frame`}),plane:V.Group({point:V.Vec3(B.create(0,0,0),{},{description:`Plane point`}),normal:V.Vec3(B.create(1,0,0),{},{description:`Plane normal`})},{isExpanded:!0,hideIf:e=>e.mode!==`plane`}),extent:V.Select(`frame`,V.arrayToOptions([`frame`,`sphere`]),{description:`Extent of the plane, either box (frame) or sphere.`}),margin:V.Numeric(4,{min:0,max:50,step:1},{immediateUpdate:!0,description:`Margin around the structure in Angstrom`}),frame:V.Select(`principalAxes`,V.arrayToOptions([`principalAxes`,`boundingBox`])),antialias:V.Boolean(!0,{description:`Antialiasing of structure edges.`}),cutout:V.Boolean(!1,{description:`Cutout the structure from the image.`}),defaultColor:V.Color(tE(13421772),{description:`Default color for parts of the image that are not covered by the color theme.`}),includeParent:V.Boolean(!1,{description:`Show parent structure (but within extent of this structure).`})};function R_t(e){return IZe({defaultProps:V.getDefaultValues(L_t),createGeometry:B_t,createLocationIterator:i8.fromStructure,getLoci:r8,eachLocation:n8,setUpdateState:(e,t,n,r,i)=>{e.createGeometry=t.imageResolution!==n.imageResolution||t.mode!==n.mode||t.margin!==n.margin||t.frame!==n.frame||t.extent!==n.extent||!B.equals(t.rotation.axis,n.rotation.axis)||t.rotation.angle!==n.rotation.angle||t.offset!==n.offset||t.axis!==n.axis||!B.equals(t.plane.point,n.plane.point)||!B.equals(t.plane.normal,n.plane.normal)||t.antialias!==n.antialias||t.cutout!==n.cutout||t.defaultColor!==n.defaultColor||!YK.areEqual(r.color,i.color)||!aq.areEqual(r.size,i.size)}},e)}function z_t(e,t){let{mode:n,axis:r,frame:i,extent:a,margin:o,rotation:s,plane:c,includeParent:l}=t;l&&e.child&&(e=e.child);let u=B(),d=B(),f=B(),p=B(),m=B(),h=B(),g=0,_=0,v=0,y,b,x;if(i===`principalAxes`){let t=nB.getPrincipalAxes(e).boxAxes;[g,_,v]=Yk.size(B(),t),y=t.dirA,b=t.dirB,x=t.dirC,B.copy(h,t.origin)}else [g,_,v]=$k.size(B(),e.boundary.box),y=B.create(1,0,0),b=B.create(0,1,0),x=B.create(0,0,1),B.copy(h,e.boundary.sphere.center);if(B.set(d,g,_,v),r===`c`?(B.set(u,g,_,v),B.copy(f,y),B.copy(p,b),B.copy(m,x)):r===`b`?(B.set(u,g,v,_),B.copy(f,y),B.copy(m,b),B.copy(p,x)):(B.set(u,_,v,g),B.copy(m,y),B.copy(f,b),B.copy(p,x)),s.angle!==0){let e=B();B.scaleAndAdd(e,e,y,s.axis[0]),B.scaleAndAdd(e,e,b,s.axis[1]),B.scaleAndAdd(e,e,x,s.axis[2]),B.normalize(e,e);let t=z.fromRotation(z(),FT(s.angle),e);B.transformDirection(f,f,t),B.transformDirection(p,p,t),B.transformDirection(m,m,t)}if(a===`sphere`||s.angle!==0){let t=e.boundary.sphere.radius*2,n=B.magnitude($k.size(B(),$k.fromSphere3D($k(),e.boundary.sphere)));B.set(u,n,n,t),a===`sphere`&&B.set(d,t,t,t)}B.addScalar(u,u,o*2),B.addScalar(d,d,o*2);let S=MT.identity();return i===`principalAxes`&&MT.fromBasis(S,B.normalize(B(),y),B.normalize(B(),b),B.normalize(B(),x)),n===`plane`&&(B.copy(h,c.point),B.copy(m,c.normal),B.cross(f,m,B.unitX),B.dot(f,f)<1e-6&&B.cross(f,m,B.unitY),B.normalize(f,f),B.cross(p,m,f),B.normalize(p,p)),{size:u,major:f,minor:p,normal:m,center:h,trim:{type:a===`sphere`?2:3,center:h,scale:d,rotation:S,transform:z.identity()}}}function B_t(e,t,n,r,i){let{imageResolution:a,offset:o,antialias:s,cutout:c,defaultColor:l}=r,u=1/a,d=`color`in n.color&&n.color.color?n.color.color:()=>tE(16777215),{size:f,major:p,minor:m,normal:h,center:g,trim:_}=z_t(t,r),v=B.create(f[0],f[1],1),y=B.setMagnitude(B(),h,f[2]/2),b=Math.floor(f[1]*u),x=Math.floor(f[0]*u),S=z.identity(),C=B(),w=B();B.add(C,g,p),z.targetTo(S,g,C,m),B.scaleAndAdd(w,g,y,o),z.setTranslation(S,w),z.mul(S,S,z.rotY90),z.scale(S,S,v);let{getSerialIndex:T}=t.serialMapping,E=n.color.granularity.startsWith(`vertex`),D=sF.fromNormalAndCoplanarPoint(sF(),B.normalize(B(),h),w),O=z.invert(z(),S),k=rj(B(),B()),A=iL.create(t),{units:j}=t,M=0;for(let e=0,t=j.length;e<t;++e){let{elements:t}=j[e];A.unit=j[e];for(let e=0,r=t.length;e<r;++e){A.element=t[e];let r=n.size.size(A);r>M&&(M=r)}}let N=new Uint8Array(b*x*4),ee=new Uint8Array(b*x*4),te=new Float32Array(b*x);te.fill(Number.MAX_VALUE);let P=B(),ne=B(),re=B();if(E){let e=0;for(let t=0;t<x;++t)for(let n=0;n<b;++n){let r=DT(n+.5,0,b-1)/b-.5,i=DT(t+.5,0,x-1)/x-.5;B.set(C,i,-r,0),B.transformMat4(C,C,S),B.copy(k.position,C);let a=d(k,!1);tE.toArray(a,N,e),N[e+3]=c?0:255,e+=4}}else for(let e=0,t=b*x*4;e<t;e+=4)tE.toArray(l,N,e),N[e+3]=c?0:255;for(let e=0,t=j.length;e<t;++e){let{elements:t,conformation:r}=j[e];A.unit=j[e];for(let e=0,i=t.length;e<i;++e){let i=t[e];A.element=i,r.position(i,P);let o=sF.distanceToPoint(D,P);if(Math.abs(o)>M)continue;let f=n.size.size(A);if(Math.abs(o)>f)continue;let p=Math.cos(Math.abs(o)/f),m=s?a*p:0,h=f+m/2,g=h*h;B.scaleAndAdd(ne,P,D.normal,-o),B.transformMat4(re,ne,O),B.addScalar(re,re,.5);let _=Math.floor(re[0]*x),v=b-Math.ceil(re[1]*b),y=Math.ceil(f*u),w=Math.max(0,_-y),j=Math.max(0,v-y),ie=Math.min(x,_+y+2),ae=Math.min(b,v+y+2);B.copy(k.position,ne);let oe=E?l:d(A,!1),se=T(A.unit,A.element);for(let e=w;e<ie;++e)for(let t=j;t<ae;++t){P_t(C,DT(e+.5,0,x-1)/x-.5,-(DT(t+.5,0,b-1)/b-.5),0),F_t(C,C,S);let n=I_t(C,P);if(n>g)continue;let r=e*b+t;if(n<te[r]){let e=r*4,t=Math.sqrt(n)-f+m/2,i=t>0?1-t/m:1;E?i===1?te[r]=n:c&&(ee[e]!==0||ee[e+1]!==0||ee[e+2]!==0)&&(i=1):i===1?(te[r]=n,tE.toArray(oe,N,e)):c?(tE.toArray(oe,N,e),(ee[e]!==0||ee[e+1]!==0||ee[e+2]!==0)&&(i=1)):tE.toArray(tE.interpolate(tE.fromArray(N,e),oe,i),N,e),XN(se,ee,e),ee[e+3]=s?Math.round(255*i):255,c&&(N[r*4+3]=s?Math.round(255*i):255)}}}}let ie={width:b,height:x,array:N,flipY:!0},ae={width:b,height:x,array:ee,flipY:!0},oe={width:1,height:1,array:new Float32Array(1),flipY:!0},se=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);return DA(S,se,0,4),SF.create(ie,se,ae,oe,_,-1,i)}var V_t={"plane-image":(e,t)=>GQ(`Plane image`,e,t,R_t)};const H_t={...L_t,visuals:V.MultiSelect([`plane-image`],V.objectToOptions(V_t))};function U_t(e,t){return H_t}function W_t(e,t){return rJ.createMulti(`Plane`,e,t,O$,V_t)}const G_t=k$({name:`plane`,label:`Plane`,description:`Displays planes.`,factory:W_t,getParams:U_t,defaultValues:V.getDefaultValues(H_t),defaultColorTheme:{name:`element-symbol`},defaultSizeTheme:{name:`physical`},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent});var K_t=class e extends nJ{constructor(){super(),WT(e.BuiltIn,(e,t)=>{if(e.name!==t)throw Error(`Fix BuiltInStructureRepresentations to have matching names. ${e.name} ${t}`);this.add(e)})}};(function(e){e.BuiltIn={cartoon:gmt,backbone:N_t,"ball-and-stick":Uut,carbohydrate:Hdt,ellipsoid:Omt,"gaussian-surface":bht,"gaussian-volume":h_t,label:jht,line:i_t,"molecular-surface":Qht,orientation:ugt,plane:G_t,point:bgt,putty:kgt,spacefill:Ngt}})(K_t||={});var q_t=1e3/30,J_t=class{get isAnimating(){return this._isAnimating}async tick(e,t){var n;if(await this.plugin.managers.animation.tick(e,t?.isSynchronous,t?.animation),(n=this.plugin.canvas3d)==null||n.tick(e,t),$y){let e=this.plugin.canvas3d?.webgl.timer.resolve();if(e)for(let t of e)Aj([t])}}resetTime(e){var t;(t=this.plugin.canvas3d)==null||t.resetTime(e)}start(e){var t;(t=this.plugin.canvas3d)==null||t.resume(),this._isAnimating=!0,this.resetTime(0),this.properTimeT=0,this.lastTickT=Ly(),e?.immediate?this.frame():this.currentFrame=this.plugin.canvas3d?.requestAnimationFrame(this.frame)}stop(e){var t,n;this._isAnimating=!1,this.currentFrame!==void 0&&((t=this.plugin.canvas3d)==null||t.cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),e?.noDraw&&((n=this.plugin.canvas3d)==null||n.pause(e?.noDraw))}constructor(e){this.plugin=e,this.lastTickT=0,this.properTimeT=0,this.currentFrame=void 0,this._isAnimating=!1,this.frame=(e,t)=>{let n=Ly(),r=n-this.lastTickT;this.lastTickT=n,this.properTimeT+=Math.min(r,q_t),this.tick(this.properTimeT,{xrFrame:t}),this._isAnimating&&(this.currentFrame=this.plugin.canvas3d?.requestAnimationFrame(this.frame))}}},Y_t=class{getDecorator(e){let t=this.plugin.state.data.tree,n=t.children.get(e);if(n.size!==1)return e;let r=n.first();return r&&t.transforms.get(r).transformer.definition.isDecorator?this.getDecorator(r):e}get(e,t=!1){let n=this.root.get(e);if(n)return t?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))}addMapping(e,t,n){if(!H.Molecule.Structure.is(n))return!1;if(this.tracked.set(t,n.data),this.root.has(n.data)){let e=this.root.get(n.data);e.count++}else{let r=e.select(FE.Generators.byRef(t).rootOfType([H.Molecule.Structure]))[0];r?this.root.set(n.data,{ref:r.transform.ref,count:1}):this.root.set(n.data,{ref:t,count:1})}return!0}removeMapping(e){if(!this.tracked.has(e))return!1;let t=this.tracked.get(e);this.tracked.delete(e);let n=this.root.get(t);return n.count>1?n.count--:this.root.delete(t),!0}updateMapping(e,t,n,r){return H.Molecule.Structure.is(r)?(this.removeMapping(t),this.addMapping(e,t,r),!0):!1}dispose(){this.ev.dispose()}constructor(e){this.plugin=e,this.ev=_D.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,e.state.data.events.object.created.subscribe(e=>{this.addMapping(e.state,e.ref,e.obj)}),e.state.data.events.object.removed.subscribe(e=>{this.removeMapping(e.ref)&&this.events.removed.next({ref:e.ref,obj:e.obj})}),e.state.data.events.object.updated.subscribe(e=>{this.updateMapping(e.state,e.ref,e.oldObj,e.obj)&&this.events.updated.next({ref:e.ref,oldObj:e.oldObj,obj:e.obj})})}},X_t=class{constructor(){this.ev=_D.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(e){if(this.abortRequests.has(e.progress.taskId))return e.progress.taskId;for(let t of e.children){let e=this.tryGetAbortTaskId(t);if(e!==void 0)return e}}track(e,t){return n=>{if(n.canAbort&&n.requestAbort){let e=this.tryGetAbortTaskId(n.root);e!==void 0&&n.requestAbort(this.abortRequests.get(e))}let r=Ly()-n.root.progress.startedTime;this.events.progress.next({id:e,useOverlay:this.options.get(t)?.useOverlay,level:r<250?`none`:`background`,progress:n})}}async run(e,t){let n=this.id++,r;t?.createNewContext||this.currentContext.length===0?r={ctx:Cue(e,this.track(n,e.id),100),refCount:1}:(r=this.currentContext[this.currentContext.length-1],r.refCount++);try{return this.options.set(e.id,{useOverlay:!!t?.useOverlay}),this.runningTasks.add(e.id),await rb(r.ctx,e)}finally{this.options.delete(e.id),this.runningTasks.delete(e.id),this.events.finished.next({id:n}),this.abortRequests.delete(e.id),r.refCount--,r.refCount===0&&EE(this.currentContext,r)}}requestAbortAll(e){this.runningTasks.forEach(t=>this.abortRequests.set(t,e))}requestAbort(e,t){let n=typeof e==`number`?e:e.root.progress.taskId;this.abortRequests.set(n,t)}dispose(){this.ev.dispose()}};(function(e){function t(e){return new Promise(t=>setTimeout(t,e))}function n(e){return hb.create(`Test`,async n=>{let r=0;for(;r<e;)await t(100+Math.random()*200),n.shouldUpdate&&await n.update({message:`Step `+r,current:r,max:e,isIndeterminate:!1}),r++})}e.testTask=n})(X_t||={});var Z_t=class extends BY{findByKey(e){return this.state.entries.find(t=>!!t&&t.key===e)}show(e){let t=this.state.entries,n,r=++this.serialId,i;e.key&&(n=this.findByKey(e.key))?(n.timeout!==void 0&&clearTimeout(n.timeout),i=n.serialNumber,t=t.remove(n.id)):i=++this.serialNumber,n={id:r,serialNumber:i,key:e.key,title:e.title,message:e.message,timeout:this.timeout(r,e.timeoutMs),hide:()=>this.hideId(r)},this.updateState({entries:t.set(r,n)})&&this.events.changed.next(void 0)}timeout(e,t){if(t!==void 0)return t<0&&(t=500),setTimeout(()=>{let t=this.state.entries.get(e);t.timeout=void 0,this.hide(t)},t)}hideId(e){this.hide(this.state.entries.get(e))}hide(e){e&&(e.timeout!==void 0&&clearTimeout(e.timeout),e.hide=void 0,this.updateState({entries:this.state.entries.delete(e.id)})&&this.events.changed.next(void 0))}constructor(e){super({entries:Nw()}),this.events={changed:this.ev()},this.serialNumber=0,this.serialId=0,jx.Toast.Show.subscribe(e,e=>this.show(e)),jx.Toast.Hide.subscribe(e,e=>this.hide(this.findByKey(e.key)))}};function Q_t(){let e=document.createElement(`canvas`);return e.getContext&&e.getContext(`2d`)?e.toDataURL(`image/webp`).indexOf(`data:image/webp`)===0:!1}var $_t=class extends zY{createParams(){let e=8192;if(this.plugin.canvas3d){let{webgl:t}=this.plugin.canvas3d;e=Math.floor(Math.min(t.maxRenderbufferSize,t.maxTextureSize)/2)}return{resolution:V.MappedStatic(`viewport`,{viewport:V.Group({}),hd:V.Group({}),"full-hd":V.Group({}),"ultra-hd":V.Group({}),custom:V.Group({width:V.Numeric(1920,{min:128,max:e,step:1}),height:V.Numeric(1080,{min:128,max:e,step:1})},{isFlat:!0})},{options:[[`viewport`,`Viewport`],[`hd`,`HD (1280 x 720)`],[`full-hd`,`Full HD (1920 x 1080)`],[`ultra-hd`,`Ultra HD (3840 x 2160)`],[`custom`,`Custom`]]}),format:V.MappedStatic(`png`,{png:V.Group({}),webp:V.Group({quality:V.Numeric(.9,{min:0,max:1,step:.01})}),jpeg:V.Group({quality:V.Numeric(.9,{min:0,max:1,step:.01})})},{options:[[`png`,`PNG`],[`jpeg`,`JPEG`],...Q_t()?[[`webp`,`WebP`]]:[]]}),transparent:V.Boolean(!1),axes:F0.axes,illumination:V.Group({extraIterations:V.Numeric(1,{min:0,max:5,step:1}),targetIterationTimeMs:V.Numeric(300,{min:100,max:3e3,step:10})})}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){return{width:this.plugin.canvas3d?.webgl.gl.drawingBufferWidth||0,height:this.plugin.canvas3d?.webgl.gl.drawingBufferHeight||0}}getSize(){let e=this.values;switch(e.resolution.name){case`viewport`:return this.getCanvasSize();case`hd`:return{width:1280,height:720};case`full-hd`:return{width:1920,height:1080};case`ultra-hd`:return{width:3840,height:2160};default:return{width:e.resolution.params.width,height:e.resolution.params.height}}}getPostprocessingProps(){let e=this.plugin.canvas3d,t=e.props.postprocessing.occlusion;return{...e.props.postprocessing,occlusion:t.name===`on`?{name:`on`,params:{...t.params,samples:128,resolutionScale:e.webgl.pixelRatio,transparentThreshold:1}}:t}}getIlluminationProps(e){let t=this.plugin.canvas3d.props.illumination,{extraIterations:n,targetIterationTimeMs:r}=this.values.illumination;return{...t,enabled:e?!1:t.enabled,maxIterations:Math.ceil(Math.log2(2**(t.maxIterations+n)*t.rendersPerFrame[1])),targetFps:1e3/r,denoiseThreshold:[t.denoiseThreshold[0],t.denoiseThreshold[0]],rendersPerFrame:[1,1]}}createPass(e){let t=this.plugin.canvas3d,{colorBufferFloat:n,textureFloat:r}=t.webgl.extensions;return t.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...t.props.multiSample,mode:e?`off`:`on`,sampleLevel:n&&r?4:2,reuseOcclusion:!1},postprocessing:this.getPostprocessingProps(),marking:{...t.props.marking},illumination:this.getIlluminationProps(e)})}get previewPass(){return this._previewPass||=this.createPass(!0)}get imagePass(){if(this._imagePass){let e=this.plugin.canvas3d;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:this.getPostprocessingProps(),marking:{...e.props.marking},illumination:this.getIlluminationProps(!1)}),this._imagePass}return this._imagePass=this.createPass(!1)}getFilename(e){typeof e!=`string`&&(e=this.extension);let t=this.plugin.state.data.select(FE.Generators.rootsOfType(H.Molecule.Model)).map(e=>e.obj.data),n=new Set;return t.forEach(e=>n.add(e.entryId.toUpperCase())),`${$F.toArray(n).join(`-`)||`molstar-image`}${e}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){let e=this.relativeCrop;return wT(e.x,0,1e-5)&&wT(e.y,0,1e-5)&&wT(e.width,1,1e-5)&&wT(e.height,1,1e-5)}autocrop(e=this.cropParams.relativePadding){let{data:t,width:n,height:r}=this.previewData.image,i=this.previewData.transparent,a=i?this.previewData.background:4278190080|this.previewData.background,o=n,s=0,c=r,l=0;for(let e=0;e<r;e++){let r=e*n;for(let u=0;u<n;u++){let n=4*(r+u);if(i){if(t[n+3]===0)continue}else if((t[n]<<16|t[n+1]<<8|t[n+2]|t[n+3]<<24)===a)continue;u<o&&(o=u),u>s&&(s=u),e<c&&(c=e),e>l&&(l=e)}}if(o>s){let e=o;o=s,s=e}if(c>l){let e=c;c=l,l=e}let u=s-o+1,d=l-c+1;o-=e*u,s+=e*u,c-=e*d,l+=e*d;let f={x:Math.max(0,o/n),y:Math.max(0,c/r),width:Math.min(1,(s-o+1)/n),height:Math.min(1,(l-c+1)/r)};this.behaviors.relativeCrop.next(f)}async getPreview(e,t=320){let{width:n,height:r}=this.getSize();if(n<=0||r<=0)return;let i=n/r,a=0,o=0;i>1?(a=t,o=Math.round(t/i)):(o=t,a=Math.round(t*i));let s=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:s.postprocessing,marking:s.marking});let c=await this.previewPass.getImageData(e,a,o),l=this.previewCanvas;l.width=c.width,l.height=c.height,this.previewData.image=c,this.previewData.background=s.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;let u=l.getContext(`2d`);if(!u)throw Error(`Could not create canvas 2d context`);return u.putImageData(c,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:l,width:a,height:o}}getSizeAndViewport(){let{width:e,height:t}=this.getSize(),n=this.relativeCrop,r={x:Math.floor(n.x*e),y:Math.floor(n.y*t),width:Math.ceil(n.width*e),height:Math.ceil(n.height*t)};return r.width+r.x>e&&(r.width=e-r.x),r.height+r.y>t&&(r.height=t-r.y),{width:e,height:t,viewport:r}}async draw(e){let{width:t,height:n,viewport:r}=this.getSizeAndViewport();if(!(t<=0||n<=0)){this.plugin.animationLoop.stop({noDraw:!0});try{await e.update(`Rendering image...`);let i=this.imagePass;await i.updateBackground();let a=await i.getImageData(e,t,n,r);await e.update(`Encoding image...`);let o=this.canvas;o.width=a.width,o.height=a.height;let s=o.getContext(`2d`);if(!s)throw Error(`Could not create canvas 2d context`);s.putImageData(a,0,0)}finally{this.plugin.animationLoop.start({immediate:!0})}}}copyToClipboardTask(){let e=navigator.clipboard;if(!e?.write){this.plugin.log.error(`clipboard.write not supported!`);return}return hb.create(`Copy Image`,async t=>{await this.draw(t),await t.update(`Converting image...`);let n=this.mimeType,r=await X0(this.canvas,n,this.quality),i=new ClipboardItem({[n]:r});await e.write([i]),this.plugin.log.message(`Image copied to clipboard.`)})}get mimeType(){return`image/${this.values.format?.name??`png`}`}get extension(){switch(this.values.format?.name){case`jpeg`:return`.jpg`;default:return`.${this.values.format?.name??`png`}`}}get quality(){switch(this.values.format?.name){case`webp`:case`jpeg`:return this.values.format?.params?.quality??.9;default:return}}getImageDataUri(){return this.plugin.runTask(hb.create(`Generate Image`,async e=>(await this.draw(e),await e.update(`Converting image...`),this.canvas.toDataURL(this.mimeType))))}copyToClipboard(){let e=this.copyToClipboardTask();if(e)return this.plugin.runTask(e)}downloadTask(e){return hb.create(`Download Image`,async t=>{await this.draw(t),await t.update(`Downloading image...`),j6e(await X0(this.canvas,this.mimeType,this.quality),e??this.getFilename(this.extension))})}download(e){return this.plugin.runTask(this.downloadTask(e),{useOverlay:!0})}constructor(e){super(),this.plugin=e,this._params=void 0,this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,format:{name:`png`,params:{}},axes:{name:`off`,params:{}},resolution:this.params.resolution.defaultValue,illumination:this.params.illumination.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})},this.events={previewed:this.ev()},this.canvas=function(){return document.createElement(`canvas`)}(),this.previewCanvas=function(){return document.createElement(`canvas`)}(),this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:tE(0),transparent:!1}}},evt=class{addHandler(e,t){let n=this.handlers.findIndex(t=>t[0]===e);n<0?this.handlers.push([e,t]):this.handlers[n][1]=t}removeHandler(e){let t=this.handlers.findIndex(t=>t[0]===e);t>=0&&this.handlers.splice(t,1)}async handle(e){for(let t=this.handlers.length-1;t>=0;t--){let n=this.handlers[t][1];if(await n(e,this.plugin))return}tvt(this.plugin,e)}dispose(){this.handlers.length=0}constructor(e){this.plugin=e,this.handlers=[]}};function tvt(e,t){let n=t.filter(e=>{let t=e.name.toLowerCase();return t.endsWith(`.molx`)||t.endsWith(`.molj`)});n.length>0?jx.State.Snapshots.OpenFile(e,{file:n[0]}):e.runTask(e.state.data.applyAction(h6,{files:t.map(e=>gx.File(e)),format:{name:`auto`,params:{}},visuals:!0}))}var nvt=class{constructor(){this.errors=Object.create(null)}get(e){return this.errors[e]??[]}add(e,t){e in this.errors&&Array.isArray(this.errors[e])?this.errors[e].push(t):this.errors[e]=[t]}clear(e){delete this.errors[e]}},rvt=class{mount(e){var t;this.parent.parentElement!==e&&((t=this.parent.parentElement)==null||t.removeChild(this.parent)),e.appendChild(this.parent)}unmount(){var e;(e=this.parent.parentElement)==null||e.removeChild(this.parent)}constructor(e){this.options=e;let t=document.createElement(`div`);Object.assign(t.style,{position:`absolute`,left:0,top:0,right:0,bottom:0,"-webkit-user-select":`none`,"user-select":`none`,"-webkit-tap-highlight-color":`rgba(0,0,0,0)`,"-webkit-touch-callout":`none`,"touch-action":`manipulation`});let n=e?.canvas;n||(n=document.createElement(`canvas`),e?.checkeredCanvasBackground&&Object.assign(n.style,{"background-image":`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)`,"background-size":`60px 60px`,"background-position":`0 0, 30px 30px`}),t.appendChild(n)),this.canvas=n,this.parent=t}},ivt=class{get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}async initViewerAsync(e,t,n){return this._initViewer(e,t,n)}async initContainerAsync(e){return this._initContainer(e)}async mountAsync(e,t){return this._mount(e,t)}_initContainer(e){if(this.container)return!0;let t=new rvt({checkeredCanvasBackground:e?.checkeredCanvasBackground,canvas:e?.canvas3dContext?.canvas});return this._initViewer(t.canvas,t.parent,e?.canvas3dContext)?(this.container=t,!0):!1}_mount(e,t){var n;if(this.disposed)throw Error(`Cannot mount a disposed context`);return this._initContainer(t)?((n=this.container)==null||n.mount(e),this.handleResize(),!0):!1}unmount(){var e;(e=this.container)==null||e.unmount()}_initViewer(e,t,n){var r,i;try{this.layout.setRoot(t),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n||=K0.fromCanvas(e,this.managers.asset,{antialias:!(this.config.get(WQ.General.DisableAntialiasing)??!1),preserveDrawingBuffer:!(this.config.get(WQ.General.DisablePreserveDrawingBuffer)??!1),preferWebGl1:this.config.get(WQ.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(this.config.get(WQ.General.AllowMajorPerformanceCaveat)??!1),powerPreference:this.config.get(WQ.General.PowerPreference)||`high-performance`,handleResize:this.handleResize},{pixelScale:this.config.get(WQ.General.PixelScale)||1,pickScale:this.config.get(WQ.General.PickScale)||.25,transparency:this.config.get(WQ.General.Transparency)||`wboit`,resolutionMode:this.config.get(WQ.General.ResolutionMode)||`auto`}),this.canvas3dContext=n,this.canvas3d=b6e.create(this.canvas3dContext),this.canvas3dInit.next(!0);let a=this.spec.canvas3d,o=tE(16579577);return a?(a.renderer?.backgroundColor===void 0&&(a=vD(a,e=>{e.renderer?e.renderer.backgroundColor=o:e.renderer={backgroundColor:o}})),(i=this.canvas3d)==null||i.setProps(a)):(r=this.canvas3d)==null||r.setProps({renderer:{backgroundColor:o}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new $_t(this),this.subs.push(this.canvas3d.interaction.click.subscribe(e=>this.behaviors.interaction.click.next(e))),this.subs.push(this.canvas3d.interaction.drag.subscribe(e=>this.behaviors.interaction.drag.next(e))),this.subs.push(this.canvas3d.interaction.hover.subscribe(e=>this.behaviors.interaction.hover.next(e))),this.subs.push(this.canvas3d.input.resize.pipe(hD(50),gD(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(e=>this.behaviors.interaction.key.next(e))),this.subs.push(this.canvas3d.input.keyUp.subscribe(e=>this.behaviors.interaction.keyReleased.next(e))),this.subs.push(this.canvas3d.xr.isPresenting.subscribe(e=>this.log.info(`WebXR ${e?`enabled`:`disabled`}`))),this.subs.push(this.canvas3d.xr.requestFailed.subscribe(e=>this.log.error(`WebXR request failed: ${e}`))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),Xy.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(e){return this.log.error(``+e),console.error(e),Xy.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](e)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(e){this.behaviors.interaction.selectionMode.next(e)}dataTransaction(e,t){return this.runTask(this.state.data.transaction(e,t))}clear(e=!1){var t;return e&&((t=this.canvas3d)==null||t.setProps(G0)),jx.State.RemoveObject(this,{state:this.state.data,ref:yE.RootRef})}dispose(e){var t,n;if(!this.disposed){for(let e of this.subs)e.unsubscribe();this.subs=[],this.layout.dispose(),this.managers.markdownExtensions.audio.dispose(),this.animationLoop.stop(),this.commands.dispose(),(t=this.canvas3d)==null||t.dispose(),e?.doNotDisposeCanvas3DContext||(n=this.canvas3dContext)==null||n.dispose(e),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),WT(this.managers,e=>(e?.dispose)?.call(e)),WT(this.managers.structure,e=>(e?.dispose)?.call(e)),WT(this.managers.volume,e=>(e?.dispose)?.call(e)),this.unmount(),this.container=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push(pD(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(e=>{this.behaviors.state.isUpdating.value!==e&&this.behaviors.state.isUpdating.next(e)}));let e=this.config.get(WQ.General.IsBusyTimeoutMs)||750,t=this.behaviors.state.isBusy,n,r=()=>{t.value||t.next(!0)},i=()=>{n!==void 0&&clearTimeout(n),n=void 0};this.subs.push(pD(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(a=>{let o=this.behaviors.state.isUpdating.value,s=this.behaviors.state.isAnimating.value;o||s?t.value||(i(),n=setTimeout(r,e)):(i(),t.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(e=>{var t;e||(t=this.managers.interactivity)==null||t.lociSelects.deselectAll()}))}initBuiltInBehavior(){E2.State.registerDefault(this),E2.Representation.registerDefault(this),E2.Camera.registerDefault(this),E2.Misc.registerDefault(this),this.subs.push(pD(this.state.data.events.log,this.state.behaviors.events.log).subscribe(e=>this.events.log.next(e)))}async initBehaviors(){let e=this.state.behaviors.build();for(let t of Object.keys(B1.Categories))e.toRoot().apply(B1.CreateCategory,{label:B1.Categories[t]},{ref:t,state:{isLocked:!0}});for(let t of this.spec.behaviors)B1.getCategoryId(t.transformer)===`custom-props`&&e.to(B1.getCategoryId(t.transformer)).apply(t.transformer,t.defaultParams,{ref:t.transformer.id});await this.runTask(this.state.behaviors.updateTree(e,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),e=this.state.behaviors.build();for(let t of this.spec.behaviors)B1.getCategoryId(t.transformer)!==`custom-props`&&e.to(B1.getCategoryId(t.transformer)).apply(t.transformer,t.defaultParams,{ref:t.transformer.id});await this.runTask(this.state.behaviors.updateTree(e,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))}initCustomFormats(){if(this.spec.customFormats)for(let e of this.spec.customFormats)this.dataFormats.add(e[0],e[1])}initAnimations(){if(this.spec.animations)for(let e of this.spec.animations)this.managers.animation.register(e)}initDataActions(){if(this.spec.actions)for(let e of this.spec.actions)this.state.data.actions.add(e.action)}async init(){try{this.subs.push(this.events.log.subscribe(e=>this.log.entries=this.log.entries.push(e))),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new E4(this),this.managers.lociLabels=new Hlt(this),this.builders.structure=new slt(this),this.initAnimations(),this.initDataActions(),await this.initBehaviors(),this.log.message(`Mol* Plugin ${S6e} [${C6e.toLocaleString()}]`),Zy||this.log.message(`Development mode enabled`),Qy&&this.log.message(`Debug mode enabled`),this._isInitialized=!0,this.initializedPromiseCallbacks[0]()}catch(e){throw this.initializedPromiseCallbacks[1](e),e}}constructor(e){this.spec=e,this.runTask=(e,t)=>this.managers.task.run(e,t),this.resolveTask=e=>{if(e)return hb.is(e)?this.runTask(e):e},this.subs=[],this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}],this._isInitialized=!1,this.initializedPromiseCallbacks=[()=>{},()=>{}],this.disposed=!1,this.container=void 0,this.ev=_D.create(),this.config=new LXe(this.spec.config),this.state=new Y0(this),this.commands=new xde,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:rJ.Loci.Empty,modifiers:q1.None,buttons:0,button:0}),click:this.ev.behavior({current:rJ.Loci.Empty,modifiers:q1.None,buttons:0,button:0}),drag:this.ev.behavior({current:rJ.Loci.Empty,modifiers:q1.None,buttons:0,button:0,pageStart:R(),pageEnd:R()}),key:this.ev.behavior(X1e),keyReleased:this.ev.behavior(X1e),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior(`root`)},canvas3d:{initialized:this.canvas3dInit.pipe(mD(e=>!!e),mme(1))}},this.canvas3dInitialized=new Promise((e,t)=>{this.initCanvas3dPromiseCallbacks=[e,t]}),this.initialized=new Promise((e,t)=>{this.initializedPromiseCallbacks=[e,t]}),this.layout=new iut(this),this.animationLoop=new J_t(this),this.representation={structure:{registry:new K_t,themes:{colorThemeRegistry:YK.createRegistry(),sizeThemeRegistry:aq.createRegistry()}},volume:{registry:new A3,themes:{colorThemeRegistry:YK.createRegistry(),sizeThemeRegistry:aq.createRegistry()}}},this.query={structure:{registry:new kFe}},this.dataFormats=new vlt,this.builders={data:new Zct(this),structure:void 0},this.helpers={substructureParent:new Y_t(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new C4(this),component:new h4(this),measurement:new FUe(this),selection:new Wlt(this),focus:new Xlt(this)},volume:{hierarchy:new z4(this)},interactivity:void 0,camera:new Vlt(this),animation:new ylt(this),snapshot:new Z0(this),lociLabels:void 0,toast:new Z_t(this),asset:new mde,task:new X_t,markdownExtensions:new $lt(this),dragAndDrop:new evt(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new g6.Registry,this.customStructureProperties=new g6.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.errorContext=new nvt,this.customState=Object.create(null),this.handleResize=()=>{var e;let t=this.canvas3dContext?.canvas,n=this.layout.root;n&&t&&(T6e(t,n,this.canvas3dContext.pixelScale),this.canvas3dContext.syncPixelScale(),(e=this.canvas3d)==null||e.requestResize())},this.log={entries:bw(),entry:e=>this.events.log.next(e),error:e=>this.events.log.next(xD.error(e)),message:e=>this.events.log.next(xD.message(e)),info:e=>this.events.log.next(xD.info(e)),warn:e=>this.events.log.next(xD.warning(e))},this.fetch=rx,WEe(this.config.get(WQ.Structure.SaccharideCompIdMapType)??`default`)}},avt=class extends ivt{initCustomParamEditors(){if(this.spec.customParamEditors)for(let[e,t]of this.spec.customParamEditors)this.customParamEditors.set(e.id,t)}dispose(e){super.dispose(e),this.layout.dispose()}constructor(e){super(e),this.spec=e,this.customParamEditors=new Map,this.customUIState={},this.initCustomParamEditors()}};const ovt=LY.create({name:`built-in.animate-assembly-unwind`,display:{name:`Unwind Assembly`},isExportable:!0,params:e=>{let t=[[`all`,`All`]],n=e.state.data.select(FE.Generators.rootsOfType(H.Molecule.Structure));for(let e of n)t.push([e.transform.ref,e.obj.data.models[0].label]);return{durationInMs:V.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:V.Boolean(!1),target:V.Select(t[0][0],t)}},canApply(e){let t=e.state.data,n=yE.RootRef;return{canApply:t.select(FE.Generators.ofType(H.Molecule.Structure.Representation3D,n)).length>0}},getDuration:e=>({kind:`fixed`,durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,n){let r=n.state.data,i=!e.target||e.target===`all`?yE.RootRef:e.target,a=r.select(FE.Generators.ofType(H.Molecule.Structure.Representation3D,i)),o=r.build(),s=!1;for(let e of a)r.select(FE.Generators.ofTransformer(IY.Representation.UnwindStructureAssemblyRepresentation3D,e.transform.ref)).length>0||(s=!0,o.to(e).apply(IY.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:`animate-assembly-unwind`}));if(s)return o.commit({doNotUpdateCurrent:!0})},teardown(e,t,n){let r=n.state.data,i=r.select(FE.Generators.ofType(H.Molecule.Structure.Representation3DState).withTag(`animate-assembly-unwind`));if(i.length===0)return;let a=r.build();for(let e of i)a.delete(e.transform.ref);return a.commit()},async apply(e,t,n){let r=n.plugin.state.data,i=!n.params.target||n.params.target===`all`?yE.RootRef:n.params.target,a=r.select(FE.Generators.ofTransformer(IY.Representation.UnwindStructureAssemblyRepresentation3D,i));if(a.length===0)return{kind:`finished`};let o=r.build(),s=(t.current-t.lastApplied)/n.params.durationInMs,c=e.t+s,l=!1;n.params.playOnce&&c>=1?(l=!0,c=1):c%=1;for(let e of a)o.to(e).update({t:c});return await jx.State.Update(n.plugin,{state:r,tree:o,options:{doNotLogTiming:!0}}),l?{kind:`finished`}:{kind:`next`,state:{t:c}}}});var Y9=B(),svt=B(),cvt=MT();const lvt=LY.create({name:`built-in.animate-camera-spin`,display:{name:`Camera Spin`,description:`Spin the 3D scene around the x-axis in view space`},isExportable:!0,params:()=>({durationInMs:V.Numeric(4e3,{min:100,max:2e4,step:100}),speed:V.Numeric(1,{min:1,max:10,step:1},{description:`How many times to spin in the specified duration.`}),direction:V.Select(`cw`,[[`cw`,`Clockwise`],[`ccw`,`Counter Clockwise`]],{cycle:!0})}),initialState:(e,t)=>({snapshot:t.canvas3d?.camera.getSnapshot()}),getDuration:e=>({kind:`fixed`,durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r;(r=n.canvas3d)==null||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,n){var r;if(t.current===0)return{kind:`next`,state:e};let i=e.snapshot;if(i.radiusMax<1e-4)return{kind:`finished`};let a=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):DT(t.current/n.params.durationInMs,0,1),o=2*Math.PI*a*n.params.speed*(n.params.direction===`ccw`?-1:1);B.sub(Y9,i.position,i.target),B.normalize(svt,i.up),MT.setAxisAngle(cvt,svt,o),B.transformQuat(Y9,Y9,cvt);let s=B.add(B(),i.target,Y9);return(r=n.plugin.canvas3d)==null||r.requestCameraReset({snapshot:{...i,position:s},durationMs:0}),a>=.99999?{kind:`finished`}:{kind:`next`,state:e}}});var uvt=s({AssignColorVolume:()=>fvt,DownloadDensity:()=>dvt}),dvt=cE.build({from:H.Root,display:{name:`Download Density`,description:`Load a density from the provided source and create its default visual.`},params:(e,t)=>{let{options:n}=t.dataFormats;return{source:V.MappedStatic(`pdb-xray`,{"pdb-xray":V.Group({provider:V.Group({id:V.Text(`1tqn`,{label:`Id`}),server:V.Select(`pdbe`,[[`pdbe`,`PDBe`]])},{pivot:`id`}),type:V.Select(`2fofc`,[[`2fofc`,`2Fo-Fc`],[`fofc`,`Fo-Fc`]])},{isFlat:!0}),"pdb-xray-ds":V.Group({provider:V.Group({id:V.Text(`1tqn`,{label:`Id`}),server:V.Select(`pdbe`,[[`pdbe`,`PDBe`],[`rcsb`,`RCSB PDB`]])},{pivot:`id`}),detail:V.Numeric(3,{min:0,max:6,step:1},{label:`Detail`})},{isFlat:!0}),"pdb-emd-ds":V.Group({provider:V.Group({id:V.Text(`emd-8004`,{label:`Id`}),server:V.Select(`pdbe`,[[`pdbe`,`PDBe`],[`rcsb`,`RCSB PDB`]])},{pivot:`id`}),detail:V.Numeric(3,{min:0,max:6,step:1},{label:`Detail`})},{isFlat:!0}),url:V.Group({url:V.Url(``),isBinary:V.Boolean(!1),format:V.Select(`auto`,n)},{isFlat:!0})},{options:[[`pdb-xray`,`PDB X-ray maps`],[`pdb-emd-ds`,`PDB EMD Density Server`],[`pdb-xray-ds`,`PDB X-ray Density Server`],[`url`,`URL`]]})}}})(({params:e},t)=>hb.create(`Download Density`,async n=>{let r=e.source,i,a;switch(r.name){case`url`:i=r.params;break;case`pdb-xray`:i={url:gx.Url(r.params.type===`2fofc`?`https://www.ebi.ac.uk/pdbe/coordinates/files/${r.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${r.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${r.params.provider.id}`};break;case`pdb-emd-ds`:i=r.params.provider.server===`pdbe`?{url:gx.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${r.params.provider.id.toLowerCase()}/cell?detail=${r.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${r.params.provider.id}`}:{url:gx.Url(`https://maps.rcsb.org/em/${r.params.provider.id.toLowerCase()}/cell?detail=${r.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${r.params.provider.id}`};break;case`pdb-xray-ds`:i=r.params.provider.server===`pdbe`?{url:gx.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${r.params.provider.id.toLowerCase()}/cell?detail=${r.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${r.params.provider.id}`}:{url:gx.Url(`https://maps.rcsb.org/x-ray/${r.params.provider.id.toLowerCase()}/cell?detail=${r.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${r.params.provider.id}`};break;default:Lb(r)}let o=await t.builders.data.download(i),s;switch(r.name){case`url`:i=r.params,a=r.params.format===`auto`?t.dataFormats.auto(W2(gx.getUrl(i.url)),o.cell?.obj):t.dataFormats.get(r.params.format);break;case`pdb-xray`:s=r.params.provider.id,a=t.dataFormats.get(`ccp4`);break;case`pdb-emd-ds`:case`pdb-xray-ds`:s=r.params.provider.id,a=t.dataFormats.get(`dscif`);break;default:Lb(r)}if(!a){t.log.warn(`DownloadDensity: Format provider not found.`);return}let c=await a.parse(t,o,{entryId:s});await a.visuals?.call(a,t,c)}));const fvt=cE.build({display:{name:`Assign Volume Colors`,description:`Assigns another volume to be available for coloring.`},from:H.Volume.Data,isApplicable(e){return!e.data.colorVolume},params(e,t){let n=t.state.data.select(FE.Generators.root.subtree().ofType(H.Volume.Data).filter(t=>!!t.obj&&!t.obj?.data.colorVolume&&t.obj!==e));return n.length===0?{ref:V.Text(``,{isHidden:!0,label:`Volume`})}:{ref:V.Select(n[0].transform.ref,n.map(e=>[e.transform.ref,e.obj.label]),{label:`Volume`})}}})(({ref:e,params:t,state:n},r)=>r.build().to(e).apply(IY.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit()),X9={Structure:m7e,Volume:uvt,DataFormat:Vct},pvt=LY.create({name:`built-in.animate-state-interpolation`,display:{name:`Animate State (experimental)`},params:()=>({transtionDurationInMs:V.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:()=>({}),async apply(e,t,n){let r=n.plugin.managers.snapshot.state.entries;if(r.size<2)return{kind:`finished`};let i=t.current%n.params.transtionDurationInMs/n.params.transtionDurationInMs,a=Math.floor(t.current/n.params.transtionDurationInMs)%r.size,o=Math.ceil(t.current/n.params.transtionDurationInMs);o===a&&o++,o%=r.size;let s=r.get(a).snapshot,c=r.get(o).snapshot;if(!s.data||!c.data)return{kind:`skip`};let l=s.data.tree.transforms,u=c.data.tree.transforms,d=n.plugin.state.data,f=d.build();for(let e of l)for(let t of u){if(t.ref!==e.ref||t.version===e.version)continue;let r=yE.fromJSON(e),a=yE.fromJSON(t),o=d.cells.get(e.ref);if(!o)continue;let s;s=r.transformer.definition.interpolate?r.transformer.definition.interpolate(r.params,a.params,i,n.plugin):i<=.5?r.params:a.params,Ex(o,s)||f.to(e.ref).update(s)}return await jx.State.Update(n.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}}),{kind:`next`,state:{}}}}),mvt=LY.create({name:`built-in.animate-structure-spin`,display:{name:`Spin Structure`},isExportable:!0,params:()=>({durationInMs:V.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:`fixed`,durationMs:e.durationInMs}),async setup(e,t,n){let r=n.state.data,i=r.select(FE.Generators.ofType(H.Molecule.Structure.Representation3D)),a=r.build(),o=!1;for(let e of i)r.select(FE.Generators.ofTransformer(IY.Representation.SpinStructureRepresentation3D,e.transform.ref)).length>0||(o=!0,a.to(e.transform.ref).apply(IY.Representation.SpinStructureRepresentation3D,{t:0},{tags:`animate-structure-spin`}));if(o)return a.commit({doNotUpdateCurrent:!0})},teardown(e,t,n){let r=n.state.data,i=r.select(FE.Generators.ofType(H.Molecule.Structure.Representation3DState).withTag(`animate-structure-spin`));if(i.length===0)return;let a=r.build();for(let e of i)a.delete(e.transform.ref);return a.commit()},async apply(e,t,n){let r=n.plugin.state.data,i=r.select(FE.Generators.ofTransformer(IY.Representation.SpinStructureRepresentation3D));if(i.length===0)return{kind:`finished`};let a=r.build(),o=(t.current-t.lastApplied)/n.params.durationInMs,s=(e.t+o)%1;for(let e of i)a.to(e).update({...e.params?.values,t:s});return await jx.State.Update(n.plugin,{state:r,tree:a,options:{doNotLogTiming:!0}}),{kind:`next`,state:{t:s}}}});var Z9=B(),hvt=B(),gvt=MT();const _vt=LY.create({name:`built-in.animate-camera-rock`,display:{name:`Camera Rock`,description:`Rock the 3D scene around the x-axis in view space`},isExportable:!0,params:()=>({durationInMs:V.Numeric(4e3,{min:100,max:2e4,step:100}),speed:V.Numeric(1,{min:1,max:10,step:1},{description:`How many times to rock from side to side.`}),angle:V.Numeric(10,{min:0,max:180,step:1},{description:`How many degrees to rotate in each direction.`})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:`fixed`,durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r;(r=n.canvas3d)==null||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,n){var r;if(t.current===0)return{kind:`next`,state:e};let i=e.snapshot;if(i.radiusMax<1e-4)return{kind:`finished`};let a=t.animation?t.animation?.currentFrame/(t.animation.frameCount+1):DT(t.current/n.params.durationInMs,0,1),o=Math.sin(a*n.params.speed*Math.PI*2)*FT(n.params.angle);B.sub(Z9,i.position,i.target),B.normalize(hvt,i.up),MT.setAxisAngle(gvt,hvt,o),B.transformQuat(Z9,Z9,gvt);let s=B.add(B(),i.target,Z9);return(r=n.plugin.canvas3d)==null||r.requestCameraReset({snapshot:{...i,position:s},durationMs:0}),a>=.99999?{kind:`finished`}:{kind:`next`,state:e}}});var Q9;(function(e){function t(e,t){return{action:e,customControl:t&&t.customControl,autoUpdate:t&&t.autoUpdate}}e.Action=t;function n(e,t={}){return{transformer:e,defaultParams:t}}e.Behavior=n})(Q9||={});const vvt=()=>({actions:[Q9.Action(X9.Structure.DownloadStructure),Q9.Action(X9.Volume.DownloadDensity),Q9.Action(X9.DataFormat.DownloadFile),Q9.Action(X9.DataFormat.OpenFiles),Q9.Action(X9.Structure.LoadTrajectory),Q9.Action(X9.Structure.EnableModelCustomProps),Q9.Action(X9.Structure.EnableStructureCustomProps),Q9.Action(j3),Q9.Action(Lrt),Q9.Action(M3),Q9.Action(IY.Data.Download),Q9.Action(IY.Data.ParseCif),Q9.Action(IY.Data.ParseCcp4),Q9.Action(IY.Data.ParseDsn6),Q9.Action(IY.Model.TrajectoryFromMmCif),Q9.Action(IY.Model.TrajectoryFromCifCore),Q9.Action(IY.Model.TrajectoryFromPDB),Q9.Action(IY.Model.TransformStructureConformation),Q9.Action(IY.Model.StructureInstances),Q9.Action(IY.Model.StructureFromModel),Q9.Action(IY.Model.StructureFromTrajectory),Q9.Action(IY.Model.ModelFromTrajectory),Q9.Action(IY.Model.StructureSelectionFromScript),Q9.Action(IY.Representation.StructureRepresentation3D),Q9.Action(IY.Representation.StructureSelectionsDistance3D),Q9.Action(IY.Representation.StructureSelectionsAngle3D),Q9.Action(IY.Representation.StructureSelectionsDihedral3D),Q9.Action(IY.Representation.StructureSelectionsLabel3D),Q9.Action(IY.Representation.StructureSelectionsOrientation3D),Q9.Action(IY.Representation.ModelUnitcell3D),Q9.Action(IY.Representation.StructureBoundingBox3D),Q9.Action(IY.Representation.ExplodeStructureRepresentation3D),Q9.Action(IY.Representation.SpinStructureRepresentation3D),Q9.Action(IY.Representation.UnwindStructureAssemblyRepresentation3D),Q9.Action(IY.Representation.OverpaintStructureRepresentation3DFromScript),Q9.Action(IY.Representation.TransparencyStructureRepresentation3DFromScript),Q9.Action(IY.Representation.ClippingStructureRepresentation3DFromScript),Q9.Action(IY.Representation.SubstanceStructureRepresentation3DFromScript),Q9.Action(IY.Representation.ThemeStrengthRepresentation3D),Q9.Action(fvt),Q9.Action(IY.Volume.VolumeFromCcp4),Q9.Action(IY.Volume.VolumeFromDsn6),Q9.Action(IY.Volume.VolumeFromCube),Q9.Action(IY.Volume.VolumeFromDx),Q9.Action(IY.Representation.VolumeRepresentation3D),Q9.Action(IY.Volume.VolumeTransform),Q9.Action(IY.Volume.VolumeInstances)],behaviors:[Q9.Behavior(D2.Representation.HighlightLoci),Q9.Behavior(D2.Representation.SelectLoci),Q9.Behavior(D2.Representation.DefaultLociLabelProvider),Q9.Behavior(D2.Representation.FocusLoci),Q9.Behavior(D2.Camera.FocusLoci),Q9.Behavior(D2.Camera.CameraAxisHelper),Q9.Behavior(D2.Camera.CameraControls),Q9.Behavior(D2.State.SnapshotControls),Q9.Behavior(k2),Q9.Behavior(D2.CustomProps.StructureInfo),Q9.Behavior(D2.CustomProps.AccessibleSurfaceArea),Q9.Behavior(D2.CustomProps.BestDatabaseSequenceMapping),Q9.Behavior(D2.CustomProps.Interactions),Q9.Behavior(D2.CustomProps.SecondaryStructure),Q9.Behavior(D2.CustomProps.ValenceModel),Q9.Behavior(D2.CustomProps.CrossLinkRestraint)],animations:[RY,lvt,_vt,x6e,J0,ovt,mvt,pvt]});var yvt={color:V.Color(gk.black,{description:`Display color of the volume.`}),wireframe:V.Boolean(!1,{description:`Control display of the volume as a wireframe.`}),opacity:V.Numeric(.3,{min:0,max:1,step:.01},{description:`Opacity of the volume.`})},bvt=new Map([[`em`,[-5,5]],[`2fo-fc`,[0,3]],[`fo-fc(+ve)`,[1,5]],[`fo-fc(-ve)`,[-5,-1]]]),$9=class extends qX{constructor(){super(...arguments),this.ref=FE.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name),this.getVisible=()=>{let e=this.plugin.state.data,t=this.ref;return t?!e.cells.get(t).state.isHidden:!1},this.toggleVisible=()=>{let e=this.plugin.state.data,t=this.ref;t&&$0(e,t,!e.cells.get(t).state.isHidden)}}componentDidUpdate(){this.ref=FE.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,e=>{this.ref===e.ref&&this.forceUpdate()})}render(){let e=this.props,{isRelative:t,stats:n}=e,r=e.channels[e.name],{min:i,max:a,mean:o,sigma:s}=n,c=Math.round(100*(r.isoValue.kind===`relative`?r.isoValue.relativeValue:r.isoValue.absoluteValue))/100,l=(i-o)/s,u=(a-o)/s;if(!this.props.isUnbounded){let e=bvt.get(this.props.name);this.props.name===`em`?(l=Math.max(e[0],l),u=Math.min(e[1],u)):(l=e[0],u=e[1])}let d=o+s*l,f=o+s*u,p=bO(t?Math.round((f-d)/s)/100:s/100,2),m=t?l:d,h=t?u:f;return(0,I.jsx)(BGe,{label:e.label+(e.isRelative?` `:``),colorStripe:r.color,pivot:(0,I.jsxs)(`div`,{className:`msp-volume-channel-inline-controls`,children:[(0,I.jsx)(e4,{value:c,min:m,max:h,step:p,onChange:n=>e.changeIso(e.name,n,t),onChangeImmediate:n=>e.changeIso(e.name,n,t),disabled:e.params.isDisabled,onEnter:e.params.events.onEnter}),(0,I.jsx)(HX,{svg:this.getVisible()?PX:NX,onClick:this.toggleVisible,toggleState:!1,disabled:e.params.isDisabled})]}),controls:(0,I.jsx)(a4,{onChange:({name:t,value:n})=>e.changeParams(e.name,t,n),params:yvt,values:r,onEnter:e.params.events.onEnter,isDisabled:e.params.isDisabled})})}},xvt=class extends qX{constructor(){super(...arguments),this.changeIso=(e,t,n)=>{let r=this.props.params;this.newParams({...r,entry:{name:r.entry.name,params:{...r.entry.params,channels:{...r.entry.params.channels,[e]:{...r.entry.params.channels[e],isoValue:n?zP.IsoValue.relative(t):zP.IsoValue.absolute(t)}}}}})},this.changeParams=(e,t,n)=>{let r=this.props.params;this.newParams({...r,entry:{name:r.entry.name,params:{...r.entry.params,channels:{...r.entry.params.channels,[e]:{...r.entry.params.channels[e],[t]:n}}}}})},this.changeOption=({name:e,value:t})=>{let n=this.props.params;if(e===`entry`)this.newParams({...n,entry:{name:t,params:n.entry.params}});else{let e=this.props.b.data,r=e.info.kind===`em`,i=t.params.isRelative,a=e.info.header.sampling[0],o=n.entry.params.channels,s={...n.entry.params.view.name===t.name?n.entry.params.view.params:this.props.info.params.entry.map(n.entry.name).params.view.map(t.name).defaultValue};t.name===`selection-box`?s.radius=t.params.radius:t.name===`camera-target`?(s.radius=t.params.radius,s.dynamicDetailLevel=t.params.dynamicDetailLevel):t.name===`box`?(s.bottomLeft=t.params.bottomLeft,s.topRight=t.params.topRight):t.name===`auto`&&(s.radius=t.params.radius,s.selectionDetailLevel=t.params.selectionDetailLevel),s.isUnbounded=!!t.params.isUnbounded,this.newParams({...n,entry:{name:n.entry.name,params:{...n.entry.params,view:{name:t.name,params:s},detailLevel:t.params.detailLevel,channels:r?{em:this.convert(o.em,a.valuesInfo[0],i)}:{"2fo-fc":this.convert(o[`2fo-fc`],a.valuesInfo[0],i),"fo-fc(+ve)":this.convert(o[`fo-fc(+ve)`],a.valuesInfo[1],i),"fo-fc(-ve)":this.convert(o[`fo-fc(-ve)`],a.valuesInfo[1],i)}}}})}}}areInitial(e){return V.areEqual(this.props.info.params,e,this.props.info.initialValues)}newParams(e){this.props.events.onChange(e,this.areInitial(e))}convert(e,t,n){return{...e,isoValue:n?zP.IsoValue.toRelative(e.isoValue,t):zP.IsoValue.toAbsolute(e.isoValue,t)}}render(){if(!this.props.b)return null;let e=this.props.b.data,t=e.info.kind===`em`,n=t?`em`:`2fo-fc`,r=this.props.params,i=this.props.info.params.entry.map(r.entry.name),a=i.params.detailLevel,o={...a,label:`Dynamic Detail`,defaultValue:i.params.view.map(`camera-target`).params.dynamicDetailLevel.defaultValue},s={...a,label:`Selection Detail`,defaultValue:i.params.view.map(`auto`).params.selectionDetailLevel.defaultValue},c=e.info.header.sampling[0],l=r.entry.params.channels[n].isoValue.kind===`relative`,u=V.Boolean(l,{description:`Use normalized or absolute isocontour scale.`,label:`Normalized`}),d=!!r.entry.params.view.params.isUnbounded,f=V.Boolean(d,{description:`Show full/limited range of iso-values for more fine-grained control.`,label:`Unbounded`}),p=r.entry.params.view.name===`off`,m={entry:V.Select(r.entry.name,e.data.entries.map(e=>[e.dataId,e.dataId]),{isHidden:p,description:`Which entry with volume data to display.`}),view:V.MappedStatic(r.entry.params.view.name,{off:V.Group({isRelative:V.Boolean(l,{isHidden:!0}),isUnbounded:V.Boolean(d,{isHidden:!0})},{description:`Display off.`}),box:V.Group({bottomLeft:V.Vec3(B.zero()),topRight:V.Vec3(B.zero()),detailLevel:a,isRelative:u,isUnbounded:f},{description:`Static box defined by cartesian coords.`}),"selection-box":V.Group({radius:V.Numeric(5,{min:0,max:50,step:.5},{description:`Radius in  within which the volume is shown.`}),detailLevel:a,isRelative:u,isUnbounded:f},{description:`Box around focused element.`}),"camera-target":V.Group({radius:V.Numeric(.5,{min:0,max:1,step:.05},{description:`Radius within which the volume is shown (relative to the field of view).`}),detailLevel:{...a,isHidden:!0},dynamicDetailLevel:o,isRelative:u,isUnbounded:f},{description:`Box around camera target.`}),cell:V.Group({detailLevel:a,isRelative:u,isUnbounded:f},{description:`Box around the structure's bounding box.`}),auto:V.Group({radius:V.Numeric(5,{min:0,max:50,step:.5},{description:`Radius in  within which the volume is shown.`}),detailLevel:a,selectionDetailLevel:s,isRelative:u,isUnbounded:f},{description:`Box around focused element.`})},{options:_4.ViewTypeOptions,description:`Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.`})},h={entry:r.entry.name,view:{name:r.entry.params.view.name,params:{detailLevel:r.entry.params.detailLevel,radius:r.entry.params.view.params.radius,bottomLeft:r.entry.params.view.params.bottomLeft,topRight:r.entry.params.view.params.topRight,selectionDetailLevel:r.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:r.entry.params.view.params.dynamicDetailLevel,isRelative:l,isUnbounded:d}}};return p?(0,I.jsx)(a4,{onChange:this.changeOption,params:m,values:h,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,I.jsxs)(I.Fragment,{children:[!t&&(0,I.jsx)($9,{label:`2Fo-Fc`,name:`2fo-fc`,bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:l,params:this.props,stats:c.valuesInfo[0],isUnbounded:d}),!t&&(0,I.jsx)($9,{label:`Fo-Fc(+ve)`,name:`fo-fc(+ve)`,bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:l,params:this.props,stats:c.valuesInfo[1],isUnbounded:d}),!t&&(0,I.jsx)($9,{label:`Fo-Fc(-ve)`,name:`fo-fc(-ve)`,bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:l,params:this.props,stats:c.valuesInfo[1],isUnbounded:d}),t&&(0,I.jsx)($9,{label:`EM`,name:`em`,bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:l,params:this.props,stats:c.valuesInfo[0],isUnbounded:d}),(0,I.jsx)(a4,{onChange:this.changeOption,params:m,values:h,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}};const Svt=()=>({...vvt(),customParamEditors:[[M3,xvt]]});async function Cvt(e){let{spec:t,target:n,onBeforeUIRender:r,render:i}=e,a=new avt(t||Svt());await a.init(),r&&await r(a),i((0,y.createElement)(Uct,{plugin:a}),n);try{await a.canvas3dInitialized}catch{}return a}var wvt=_();function Tvt(e,t){(0,wvt.createRoot)(t).render(e)}const Evt={...Svt(),layout:{initial:{isExpanded:!1,showControls:!1,controlsDisplay:`reactive`}},config:[[WQ.Viewport.ShowAnimation,!1],[WQ.Viewport.ShowSelectionMode,!1],[WQ.General.PixelScale,2]]},Dvt=()=>{let e=(0,y.useRef)(null),t=(0,y.useRef)(!1),{setPlugin:n}=Iy();return(0,y.useEffect)(()=>{!e.current||t.current||(async()=>{t.current=!0;try{let t=await Cvt({target:e.current,spec:{...Evt},render:Tvt}),r=t.canvas3d;if(r){r.webgl.isWebGL2?console.log(`HyperMol: Running on WebGL2 `):console.log(`HyperMol: Running on WebGL1`);let e=r.props.renderer;r.setProps({renderer:{...e,backgroundColor:tE(15921385)},postprocessing:{occlusion:{name:`on`,params:{...r.props.postprocessing.occlusion.params,samples:32,radius:5}},outline:{name:`on`,params:{...r.props.postprocessing.outline.params,color:tE(5592405),scale:1}}}})}n(t),await GY(t,`1BNA`)}catch(e){console.error(`Failed to initialize Mol*`,e)}})()},[n]),(0,I.jsx)(`div`,{ref:e,style:{position:`absolute`,top:0,left:0,right:0,bottom:0,backgroundColor:`#F2F0E9`}})},Ovt={token:{colorPrimary:`#DA7756`,colorInfo:`#DA7756`,colorBgBase:`#F2F0E9`,colorBgContainer:`#FCFAF7`,colorText:`#45423C`,colorTextSecondary:`#8A8680`,colorBorder:`#E0DDD5`,borderRadius:8,borderRadiusLG:12,fontFamily:`"Inter", -apple-system, BlinkMacSystemFont, sans-serif`},components:{Layout:{bodyBg:`#F2F0E9`,siderBg:`#EBE8E2`},Button:{primaryShadow:`0 2px 0 rgba(218, 119, 86, 0.15)`},Input:{activeBorderColor:`#DA7756`,hoverBorderColor:`#E89A7D`},Select:{colorPrimary:`#DA7756`}}};(0,_().createRoot)(document.getElementById(`root`)).render((0,I.jsx)(y.StrictMode,{children:(0,I.jsx)(()=>(0,I.jsx)(fu,{theme:Ovt,children:(0,I.jsx)(Ym,{children:(0,I.jsx)(mue,{children:(0,I.jsx)(ZUe,{children:(0,I.jsx)(Dvt,{})})})})}),{})}));